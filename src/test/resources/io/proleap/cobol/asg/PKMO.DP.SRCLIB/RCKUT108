000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    RCKUT108.                                         00040000
000500 AUTHOR.        JOE LAROSA.                                       00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   MAY 2000.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS BATCH DB2 PROGRAM READS A FILE CONTAINING ASN PACKSLIP  * 00100000
001100*  INFORMATION, VALIDATES THE EXPECTED CARTON QUANTITY (COUNT)  * 00110000
001200*  AND ITEM QUANTITY, AND CREATES AN OUTPUT FILE WHEN ANY       * 00120000
001300*  DIFFERENCES ARE DISCOVERED.                                  * 00130000
001400***************************************************************** 00140000
001807* CHANGE HISTORY                                                * 00141001
001300*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)              * 00142001
001300*     DATE:    11/12/2014                                       * 00143001
001300*      RECOMPILE THE PROGRAM AS THE PO NUMBER FIELD IN THE      * 00145001
001300*      COPYBOOK RCRD052 AND RCRD053 IS INCREASED TO 9 FROM 7.   * 00146001
001400***************************************************************** 00147001
001500 ENVIRONMENT DIVISION.                                            00150000
001600 INPUT-OUTPUT SECTION.                                            00160000
001700                                                                  00170000
001800 FILE-CONTROL.                                                    00180000
001900                                                                  00190000
002000     SELECT INPUT-FILE     ASSIGN TO UT-S-INP01.                  00200000
002100     SELECT OUTPUT-FILE    ASSIGN TO UT-S-OUT01.                  00210000
002200                                                                  00220000
002300***************************************************************** 00230000
002400 DATA DIVISION.                                                   00240000
002500***************************************************************** 00250000
002600 FILE SECTION.                                                    00260000
002700                                                                  00270000
002800 FD  INPUT-FILE                                                   00280000
002900     RECORDING MODE IS F                                          00290000
003000     LABEL RECORDS ARE STANDARD                                   00300000
003100     RECORD CONTAINS 150                                          00310000
003200     BLOCK CONTAINS 0 RECORDS                                     00320000
003300     DATA RECORD IS INPUT-RECORD.                                 00330000
003400 01  INPUT-RECORD                PIC X(150).                      00340000
003500                                                                  00350000
003600 FD  OUTPUT-FILE                                                  00360000
003700     RECORDING MODE IS F                                          00370000
003800     LABEL RECORDS ARE STANDARD                                   00380000
003900     RECORD CONTAINS 300                                          00390000
004000     BLOCK CONTAINS 0 RECORDS                                     00400000
004100     DATA RECORD IS OUTPUT-RECORD.                                00410000
004200 01  OUTPUT-RECORD               PIC X(300).                      00420000
004300                                                                  00430000
004400***************************************************************** 00440000
004500 WORKING-STORAGE SECTION.                                         00450000
004600                                                                  00460000
004700 01  PS-PROGRAM-SWITCHES.                                         00470000
004800     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00480000
004900         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00490000
005000         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00500000
005100     05  PS-TPURCHS-SW                PIC X(01)  VALUE 'N'.       00510000
005200         88  PS-TPURCHS-YES                      VALUE 'Y'.       00520000
005300         88  PS-TPURCHS-NO                       VALUE 'N'.       00530000
005400     05  PS-SHUUPC-CSR-SW             PIC X(01)  VALUE 'N'.       00540000
005500         88  PS-SHUUPC-CSR-EOF-YES               VALUE 'Y'.       00550000
005600         88  PS-SHUUPC-CSR-EOF-NO                VALUE 'N'.       00560000
005700     05  PS-PKITEM-CSR-SW             PIC X(01)  VALUE 'N'.       00570000
005800         88  PS-PKITEM-CSR-EOF-YES               VALUE 'Y'.       00580000
005900         88  PS-PKITEM-CSR-EOF-NO                VALUE 'N'.       00590000
006000     05  PS-END-OF-TABLE-SW           PIC X(01)  VALUE 'N'.       00600000
006100         88  PS-END-OF-TABLE                     VALUE 'Y'.       00610000
006200         88  PS-NOT-END-OF-TABLE                 VALUE 'N'.       00620000
006300     05  PS-VENDOR-ITEM-ERR-SW        PIC X(01)  VALUE 'N'.       00630000
006400         88  PS-VENDOR-ITEM-ERR-YES              VALUE 'Y'.       00640000
006500         88  PS-VENDOR-ITEM-ERR-NO               VALUE 'N'.       00650000
006600                                                                  00660000
006700 01  PC-PROGRAM-CONSTANTS.                                        00670000
006800     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'RCKUT108'.00680000
006900     05  PC-MAX-RETRIES               PIC S9(4)  VALUE +3         00690000
007000                                                 COMP SYNC.       00700000
007100     05  PC-DEFAULT-CC-DATE           PIC X(10)  VALUE            00710000
007200                                                     '9999-09-09'.00720000
007300     05  PC-SYSTEM-DATE               PIC 9(06)  VALUE ZERO.      00730000
007400                                                                  00740000
007500 01  PV-PROGRAM-VARIABLES.                                        00750000
007600     05  PV-RETRY-COUNT               PIC S9(4)  VALUE +0         00760000
007700                                                 COMP SYNC.       00770000
007800     05  PV-SUB                       PIC S9(3)  VALUE +0         00780000
007900                                                 COMP-3.          00790000
008000     05  PV-DISP-PO                   PIC 999999999.              00800000
008100     05  PV-DISP-SEQ                  PIC 9999.                   00810000
008200     05  PV-DISP-LINE1                PIC 99999.                  00820000
008300     05  PV-DISP-LINE2                PIC 99999.                  00830000
008400     05  PV-SQLCODE                   PIC S9(9)  VALUE +0.        00840000
008500     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00850000
008600     05  PV-DISP-COUNT                PIC Z,ZZZ,ZZ9.              00860000
008700     05  PV-DISP-ERRS                 PIC ZZ,ZZ9.                 00870000
008800     05  PV-DISP-ITMS                 PIC ZZ,ZZ9.                 00880000
008900     05  PV-RECORDS-READ              PIC S9(9)  VALUE +0.        00890000
009000     05  PV-RECORDS-WRITTEN           PIC S9(9)  VALUE +0.        00900000
009100     05  PV-VENDORS-WRITTEN           PIC S9(9)  VALUE +0.        00910000
009200     05  PV-CARTON-MISMATCH           PIC S9(9)  VALUE +0.        00920000
009300     05  PV-VALID-IND-CNT             PIC S9(9)  VALUE +0.        00930000
009400     05  PV-INPKSU-COUNT              PIC S9(9)  VALUE +0 COMP.   00940000
009500                                                                  00950000
009600 01  DK-DATABASE-KEYS.                                            00960000
009700     05  DK-PO-NBR                    PIC S9(9)  VALUE +0 COMP.   00970000
009800     05  DK-ENT-ID                    PIC S9(9)  VALUE +0 COMP.   00980000
009900     05  DK-SEQ-NBR                   PIC S9(4)  VALUE +0 COMP.   00990000
010000     05  DK-ASN-NBR                   PIC X(30)  VALUE SPACES.    01000000
010100     05  DK-BOL-NBR                   PIC X(30)  VALUE SPACES.    01010000
010200     05  DK-EDI-VEND-ID               PIC X(17)  VALUE SPACES.    01020000
010300                                                                  01030000
010400 01  PV-ABEND-FIELDS.                                             01040000
010500     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         01050000
010600                                                 COMP SYNC.       01060000
010700     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RCKUT108'.01070000
010800     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01080000
010900     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01090000
011000     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01100000
011100     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    01110000
011200     05  PV-ABEND-STRUCTURE-3         PIC  X(08) VALUE SPACES.    01120000
011300     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01130000
011400     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01140000
011500     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01150000
011600     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01160000
011700     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    01170000
011800                                                                  01180000
011900 01  VENDOR-SUMMARY-TABLE.                                        01190000
012000     05  SUMMARY-TABLE  OCCURS 900 TIMES INDEXED BY VS-IDX.       01200000
012100         10  SUMMARY-VEND-NAME       PIC  X(25).                  01210000
012200         10  SUMMARY-VEND-COUNT      PIC  S9(7) COMP-3.           01220000
012300         10  SUMMARY-VEND-ERRS       PIC  S9(5) COMP-3.           01230000
012400         10  SUMMARY-ITEM-ERRS       PIC  S9(5) COMP-3.           01240000
012500                                                                  01250000
012600***********************************************************       01260000
012700*  COPYBOOK USED FOR THE INPUT FILE.                      *       01270000
012800***********************************************************       01280000
012900     COPY RCRD052.                                                01290000
013000                                                                  01300000
013100***********************************************************       01310000
013200*  COPYBOOK USED FOR THE OUTPUT FILE.                     *       01320000
013300***********************************************************       01330000
013400     COPY RCRD053.                                                01340000
013500                                                                  01350000
013600***********************************************************       01360000
013700*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       01370000
013800***********************************************************       01380000
013900     COPY DPWS004.                                                01390000
014000                                                                  01400000
014100***********************************************************       01410000
014200*  DB2 SQL COMMUNICATION AREA                             *       01420000
014300***********************************************************       01430000
014400     EXEC SQL                                                     01440000
014500          INCLUDE SQLCA                                           01450000
014600     END-EXEC.                                                    01460000
014700                                                                  01470000
014800***********************************************************       01480000
014900*  DB2 DCLGEN FOR RC - PACK SLIP                          *       01490000
015000***********************************************************       01500000
015100     EXEC SQL                                                     01510000
015200          INCLUDE TPKSLIP                                         01520000
015300     END-EXEC.                                                    01530000
015400                                                                  01540000
015500***********************************************************       01550000
015600*  DB2 DCLGEN FOR RC - PACK SLIP ITEM                     *       01560000
015700***********************************************************       01570000
015800     EXEC SQL                                                     01580000
015900          INCLUDE TPKITEM                                         01590000
016000     END-EXEC.                                                    01600000
016100                                                                  01610000
016200***********************************************************       01620000
016300*  DB2 DCLGEN FOR PO - PURCHASE TABLE                     *       01630000
016400***********************************************************       01640000
016500     EXEC SQL                                                     01650000
016600          INCLUDE TPURCHS                                         01660000
016700     END-EXEC.                                                    01670000
016800                                                                  01680000
016900***********************************************************       01690000
017000*  DB2 DCLGEN FOR SU - INBOUND EDI PACKLIST/VENDOR        *       01700000
017100*                      SHIPMENT UNIT ASSOCIATION          *       01710000
017200***********************************************************       01720000
017300     EXEC SQL                                                     01730000
017400          INCLUDE TINPKSU                                         01740000
017500     END-EXEC.                                                    01750000
017600                                                                  01760000
017700***********************************************************       01770000
017800*  DB2 DCLGEN FOR SU - SHIPMENT UNIT/UPC ASSOCIATION      *       01780000
017900***********************************************************       01790000
018000     EXEC SQL                                                     01800000
018100          INCLUDE TSHUUPC                                         01810000
018200     END-EXEC.                                                    01820000
018300                                                                  01830000
018400***********************************************************       01840000
018500*  DB2 DCLGEN FOR EX - EXTERNAL ENTERPRISE                *       01850000
018600***********************************************************       01860000
018700     EXEC SQL                                                     01870000
018800          INCLUDE TEXTENT                                         01880000
018900     END-EXEC.                                                    01890000
019000                                                                  01900000
019100***********************************************************       01910000
019200*  DB2 DCLGEN FOR SN - ADVANCE SHIP NOTICE HEADER         *       01920000
019300***********************************************************       01930000
019400     EXEC SQL                                                     01940000
019500          INCLUDE TASNHDR                                         01950000
019600     END-EXEC.                                                    01960000
019700                                                                  01970000
019800******************************************************************01980000
019900* SHUUPC CURSOR                                                  *01990000
020000******************************************************************02000000
020100     EXEC SQL                                                     02010000
020200       DECLARE SHUUPC-CSR CURSOR FOR                              02020000
020300         SELECT B.TRN_NBR                                         02030000
020400              , B.TRN_LNE_NBR                                     02040000
020500              , SUM(B.SHPD_QTY)                                   02050000
020600           FROM TINPKSU A                                         02060000
020700              , TSHUUPC B                                         02070000
020800          WHERE A.PO_NBR        = :DK-PO-NBR                      02080000
020900            AND A.SEQ_NBR       = :DK-SEQ-NBR                     02090000
021000            AND A.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                  02100000
021100            AND B.TRN_TYP_CDE   = 'PO'                            02110000
      /           AND B.TRN_LNE_NBR   <> 0                              02111000
021200       GROUP BY B.TRN_NBR                                         02120000
021300              , B.TRN_LNE_NBR                                     02130000
021400       ORDER BY B.TRN_LNE_NBR                                     02140000
021500     END-EXEC.                                                    02150000
021600                                                                  02160000
021700******************************************************************02170000
021800* PKITEM CURSOR                                                  *02180000
021900******************************************************************02190000
022000     EXEC SQL                                                     02200000
022100       DECLARE PKITEM-CSR CURSOR FOR                              02210000
022200         SELECT A.PKSL_LNE_NBR                                    02220000
022300              , A.PKSL_ITM_QTY                                    02230000
022400           FROM TPKITEM A                                         02240000
022500          WHERE A.PO_NBR        = :DK-PO-NBR                      02250000
022600            AND A.SEQ_NBR       = :DK-SEQ-NBR                     02260000
022700            AND A.VER_STAT_CDE  = 'A'                             02270000
022800       ORDER BY A.PKSL_LNE_NBR                                    02280000
022900     END-EXEC.                                                    02290000
023000                                                                  02300000
023100***************************************************************** 02310000
023200 PROCEDURE DIVISION.                                              02320000
023300***************************************************************** 02330000
023400     DISPLAY '**** BEGINNING RCKUT108 ****'.                      02340000
023500     DISPLAY ' '.                                                 02350000
023600                                                                  02360000
023700     OPEN INPUT  INPUT-FILE                                       02370000
023800          OUTPUT OUTPUT-FILE                                      02380000
023900                                                                  02390000
024000     PERFORM 0500-PREPARE-VEND-TABLE.                             02400000
024100                                                                  02410000
024200     PERFORM 1000-READ-INPUT-FILE.                                02420000
024300                                                                  02430000
024400     PERFORM 2000-PROCESS-INPUT-FILE                              02440000
024500       UNTIL PS-EOF-INPUT-YES.                                    02450000
024600* WRITE TYPE '4' VENDOR SUMMARY RECORDS.                          02460000
024700     SET PS-NOT-END-OF-TABLE TO TRUE.                             02470000
024800     PERFORM 5000-WRITE-SUMMARY-TABLE                             02480000
024900       VARYING VS-IDX FROM 1 BY 1                                 02490000
025000         UNTIL SUMMARY-VEND-NAME (VS-IDX) = SPACES                02500000
025100            OR PS-END-OF-TABLE.                                   02510000
025200                                                                  02520000
025300     CLOSE INPUT-FILE                                             02530000
025400           OUTPUT-FILE.                                           02540000
025500                                                                  02550000
025600     MOVE PV-RECORDS-READ    TO PV-DISP-COUNT.                    02560000
025700     DISPLAY '  INPUT RECORDS READ       = ' PV-DISP-COUNT.       02570000
025800     DISPLAY ' '.                                                 02580000
025900     MOVE PV-VALID-IND-CNT   TO PV-DISP-COUNT.                    02590000
026000     DISPLAY '  VALID CARTON LABEL IND   = ' PV-DISP-COUNT.       02600000
026100     MOVE PV-CARTON-MISMATCH TO PV-DISP-COUNT.                    02610000
026200     DISPLAY '  PACKSLIP ERRORS(TYPE #1) = ' PV-DISP-COUNT.       02620000
026300     DISPLAY ' '.                                                 02630000
026400     MOVE PV-RECORDS-WRITTEN TO PV-DISP-COUNT.                    02640000
026500     DISPLAY '  MISMATCH RECORDS WRITTEN = ' PV-DISP-COUNT.       02650000
026600                                                                  02660000
026700     PERFORM 0100-DISPLAY-SUMMARY-TABLE                           02670000
026800       VARYING VS-IDX FROM 1 BY 1                                 02680000
026900         UNTIL SUMMARY-VEND-NAME (VS-IDX) = SPACES                02690000
027000            OR PS-END-OF-TABLE.                                   02700000
027100                                                                  02710000
027200     MOVE PV-VENDORS-WRITTEN TO PV-DISP-COUNT.                    02720000
027300     DISPLAY '  SUMMARY VENDORS WRITTEN  = ' PV-DISP-COUNT.       02730000
027400     DISPLAY ' '.                                                 02740000
027500     DISPLAY '****  END OF  RCKUT108  ****'.                      02750000
027600                                                                  02760000
027700     GOBACK.                                                      02770000
027800                                                                  02780000
027900***************************************************************** 02790000
028000 0100-DISPLAY-SUMMARY-TABLE.                                      02800000
028100*JPL************************************************************* 02810000
028200     MOVE SUMMARY-VEND-COUNT (VS-IDX) TO PV-DISP-COUNT.           02820000
028300     MOVE SUMMARY-VEND-ERRS  (VS-IDX) TO PV-DISP-ERRS.            02830000
028400     MOVE SUMMARY-ITEM-ERRS  (VS-IDX) TO PV-DISP-ITMS.            02840000
028500     DISPLAY ' *VENDOR NAME/CNT/ERRS = '                          02850000
028600             SUMMARY-VEND-NAME (VS-IDX)                           02860000
028700             ' / ' PV-DISP-COUNT                                  02870000
028800             ' / ' PV-DISP-ERRS                                   02880000
028900             ' / ' PV-DISP-ITMS.                                  02890000
029000                                                                  02900000
029100     ADD +1 TO PV-VENDORS-WRITTEN.                                02910000
029200                                                                  02920000
029300***************************************************************** 02930000
029400 0500-PREPARE-VEND-TABLE.                                         02940000
029500***************************************************************** 02950000
029600     MOVE '0500-PREPARE-VEND-TABLE ' TO PV-ABEND-PARAGRAPH.       02960000
029700                                                                  02970000
029800     PERFORM                                                      02980000
029900       VARYING VS-IDX FROM 1 BY 1 UNTIL VS-IDX > 900              02990000
030000         MOVE SPACES TO SUMMARY-VEND-NAME (VS-IDX)                03000000
030100         MOVE ZEROES TO SUMMARY-VEND-COUNT (VS-IDX)               03010000
030200         MOVE ZEROES TO SUMMARY-VEND-ERRS (VS-IDX)                03020000
030300         MOVE ZEROES TO SUMMARY-ITEM-ERRS (VS-IDX)                03030000
030400     END-PERFORM.                                                 03040000
030500                                                                  03050000
030600***************************************************************** 03060000
030700 1000-READ-INPUT-FILE.                                            03070000
030800***************************************************************** 03080000
030900     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       03090000
031000                                                                  03100000
031100     READ INPUT-FILE                                              03110000
031200       INTO RC052-ASN-RECVR-PKSLIP-RECORD                         03120000
031300         AT END                                                   03130000
031400             SET PS-EOF-INPUT-YES TO TRUE                         03140000
031500                                                                  03150000
031600         NOT AT END                                               03160000
031700             SET PS-EOF-INPUT-NO  TO TRUE                         03170000
031800             ADD +1 TO PV-RECORDS-READ                            03180000
031900     END-READ.                                                    03190000
032000                                                                  03200000
032100***************************************************************** 03210000
032200 2000-PROCESS-INPUT-FILE.                                         03220000
032300***************************************************************** 03230000
032400     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       03240000
032500                                                                  03250000
032600*SAVE VENDOR DATA TO TABLE.                                       03260000
032700     PERFORM 4000-LOAD-VENDOR-DATA.                               03270000
032800     IF PS-END-OF-TABLE                                           03280000
032900         MOVE '4000-LOAD-VENDOR-DATA' TO PV-ABEND-PARAGRAPH       03290000
033000         MOVE 'TABLE TOO SMALL - OVER 900 VENDORS PROCESSED'      03300000
033100                                      TO PV-ABEND-OPERATION       03310000
033200         MOVE 'SUMMARY '              TO PV-ABEND-STRUCTURE-1     03320000
033300         PERFORM Z999-SQL-ABEND                                   03330000
033400     END-IF.                                                      03340000
033500                                                                  03350000
033600* USE INPUT PO# TO GET ENTITY-ID (TPURCHS).                       03360000
033700     MOVE RC052-PO-NBR TO DK-PO-NBR                               03370000
033800                          PV-DISP-PO.                             03380000
033900     SET PS-TPURCHS-YES TO TRUE.                                  03390000
034000     PERFORM 2010-SELECT-TPURCHS.                                 03400000
034100                                                                  03410000
034200* USE ENTITY-ID TO GET VALID-CARTON-LABEL-INDICATOR (TEXTENT).    03420000
034300     IF PS-TPURCHS-NO                                             03430000
034400         MOVE 'N' TO EXTENT-VLD-CART-LBL-IND                      03440000
034500     ELSE                                                         03450000
034600         MOVE PURCHS-ENT-ID TO DK-ENT-ID                          03460000
034700         PERFORM 2020-SELECT-TEXTENT                              03470000
034800     END-IF.                                                      03480000
034900                                                                  03490000
035000* IF VALID-CARTON-LABEL-INDICATOR = 'Y', GET PACK SLIP RECORD.    03500000
035100     IF EXTENT-VLD-CART-LBL-IND = 'Y'                             03510000
035200         ADD +1 TO PV-VALID-IND-CNT                               03520000
035300         MOVE RC052-PO-NBR  TO DK-PO-NBR                          03530000
035400         MOVE RC052-SEQ-NBR TO DK-SEQ-NBR                         03540000
035500                               PV-DISP-SEQ                        03550000
035600         PERFORM 2030-SELECT-TPKSLIP                              03560000
035700         IF SQLCODE = +0                                          03570000
035800             MOVE PKSLIP-ASN-NBR    TO DK-ASN-NBR                 03580000
035900             MOVE PKSLIP-BOL-NBR    TO DK-BOL-NBR                 03590000
036000             MOVE RC052-EDI-VEND-ID TO DK-EDI-VEND-ID             03600000
036100             PERFORM 2040-SELECT-TASNHDR                          03610000
036200             PERFORM 2100-CONTINUE-VALIDATION                     03620000
036300         ELSE                                                     03630000
036400             PERFORM 3000-LOAD-EXTRACT-ERR1-RECORD                03640000
036500             SET RC053-TPKSLIP-NOTFND TO TRUE                     03650000
036600             WRITE OUTPUT-RECORD                                  03660000
036700              FROM RC053-ASN-RECVR-PKSLIP-ERRREC                  03670000
036800             ADD +1 TO PV-RECORDS-WRITTEN                         03680000
036900             ADD +1 TO PV-CARTON-MISMATCH                         03690000
037000             PERFORM 4100-ACCUM-VENDOR-ERR1                       03700000
037100         END-IF                                                   03710000
037200     END-IF.                                                      03720000
037300                                                                  03730000
037400* GET NEXT INPUT RECORD.                                          03740000
037500     PERFORM 1000-READ-INPUT-FILE.                                03750000
037600                                                                  03760000
037700***************************************************************** 03770000
037800 2010-SELECT-TPURCHS.                                             03780000
037900***************************************************************** 03790000
038000     MOVE '2010-SELECT-TPURCHS     ' TO PV-ABEND-PARAGRAPH.       03800000
038100                                                                  03810000
038200     EXEC SQL                                                     03820000
038300       SELECT ENT_ID                                              03830000
038400         INTO :PURCHS-ENT-ID                                      03840000
038500         FROM TPURCHS                                             03850000
038600        WHERE PO_NBR         = :DK-PO-NBR                         03860000
038700          AND VER_STATUS_CDE = 'A'                                03870000
038800     END-EXEC.                                                    03880000
038900                                                                  03890000
039000     EVALUATE TRUE                                                03900000
039100         WHEN SQLCODE = +0                                        03910000
039200             CONTINUE                                             03920000
039300                                                                  03930000
039400         WHEN SQLCODE = +100                                      03940000
039500             SET PS-TPURCHS-NO TO TRUE                            03950000
039600                                                                  03960000
039700         WHEN SQLWARN0 NOT = SPACE                                03970000
039800         WHEN SQLCODE  NOT = +0                                   03980000
039900             MOVE '2010-SELECT-TPURCHS' TO PV-ABEND-PARAGRAPH     03990000
040000             MOVE PV-DISP-PO            TO PV-ABEND-OPERATION     04000000
040100             MOVE 'GET ENT ID'          TO PV-ABEND-STRUCTURE-1   04010000
040200             MOVE 'TPURCHS'             TO PV-ABEND-STRUCTURE-2   04020000
040300             PERFORM Z999-SQL-ABEND                               04030000
040400     END-EVALUATE.                                                04040000
040500                                                                  04050000
040600***************************************************************** 04060000
040700 2020-SELECT-TEXTENT.                                             04070000
040800***************************************************************** 04080000
040900     MOVE '2020-SELECT-TEXTENT     ' TO PV-ABEND-PARAGRAPH.       04090000
041000                                                                  04100000
041100     EXEC SQL                                                     04110000
041200       SELECT VLD_CART_LBL_IND                                    04120000
041300         INTO :EXTENT-VLD-CART-LBL-IND                            04130000
041400         FROM TEXTENT A                                           04140000
041500        WHERE A.ENT_ID = :DK-ENT-ID                               04150000
041600     END-EXEC.                                                    04160000
041700                                                                  04170000
041800     EVALUATE TRUE                                                04180000
041900         WHEN SQLCODE = +0                                        04190000
042000             CONTINUE                                             04200000
042100                                                                  04210000
042200         WHEN SQLCODE = +100                                      04220000
042300             MOVE 'N' TO EXTENT-VLD-CART-LBL-IND                  04230000
042400                                                                  04240000
042500         WHEN SQLWARN0 NOT = SPACE                                04250000
042600         WHEN SQLCODE  NOT = +0                                   04260000
042700             MOVE '2020-SELECT-TEXTENT'  TO PV-ABEND-PARAGRAPH    04270000
042800             MOVE 'GET CARTON LABEL IND' TO PV-ABEND-STRUCTURE-1  04280000
042900             MOVE 'TEXTENT'              TO PV-ABEND-STRUCTURE-2  04290000
043000             PERFORM Z999-SQL-ABEND                               04300000
043100     END-EVALUATE.                                                04310000
043200                                                                  04320000
043300***************************************************************** 04330000
043400 2030-SELECT-TPKSLIP.                                             04340000
043500***************************************************************** 04350000
043600     MOVE '2030-SELECT-TPKSLIP     ' TO PV-ABEND-PARAGRAPH.       04360000
043700                                                                  04370000
043800     EXEC SQL                                                     04380000
043900       SELECT PO_NBR                                              04390000
044000            , SEQ_NBR                                             04400000
044100            , OPER_UNT_ID                                         04410000
044200            , STR_DEST_NBR                                        04420000
044300            , BOL_NBR                                             04430000
044400            , EXPTED_PKG_QTY                                      04440000
044500            , ASN_NBR                                             04450000
044600         INTO :PKSLIP-PO-NBR                                      04460000
044700            , :PKSLIP-SEQ-NBR                                     04470000
044800            , :PKSLIP-OPER-UNT-ID                                 04480000
044900            , :PKSLIP-STR-DEST-NBR                                04490000
045000            , :PKSLIP-BOL-NBR                                     04500000
045100            , :PKSLIP-EXPTED-PKG-QTY                              04510000
045200            , :PKSLIP-ASN-NBR                                     04520000
045300         FROM TPKSLIP A                                           04530000
045400        WHERE A.PO_NBR        = :DK-PO-NBR                        04540000
045500          AND A.SEQ_NBR       = :DK-SEQ-NBR                       04550000
045600          AND A.VER_STAT_CDE  = 'A'                               04560000
045700     END-EXEC.                                                    04570000
045800                                                                  04580000
045900     EVALUATE TRUE                                                04590000
046000         WHEN SQLCODE = +0                                        04600000
046100             CONTINUE                                             04610000
046200                                                                  04620000
046300         WHEN SQLCODE = +100                                      04630000
046400             MOVE ZEROES TO PKSLIP-EXPTED-PKG-QTY                 04640000
046500                                                                  04650000
046600         WHEN SQLWARN0 NOT = SPACE                                04660000
046700         WHEN SQLCODE  NOT = +0                                   04670000
046800             MOVE '2030-SELECT-TPKSLIP' TO PV-ABEND-PARAGRAPH     04680000
046900             MOVE PV-DISP-PO            TO PV-ABEND-OPERATION     04690000
047000             MOVE 'GET PACK SLIP INFO ' TO PV-ABEND-STRUCTURE-1   04700000
047100             MOVE 'TPKSLIP'             TO PV-ABEND-STRUCTURE-2   04710000
047200             PERFORM Z999-SQL-ABEND                               04720000
047300     END-EVALUATE.                                                04730000
047400                                                                  04740000
047500***************************************************************** 04750000
047600 2040-SELECT-TASNHDR.                                             04760000
047700***************************************************************** 04770000
047800     MOVE '2040-SELECT-TASNHDR     ' TO PV-ABEND-PARAGRAPH.       04780000
047900                                                                  04790000
048000     EXEC SQL                                                     04800000
048100       SELECT EDIISA_CNTL_NBR                                     04810000
048200         INTO :ASNHDR-EDIISA-CNTL-NBR                             04820000
048300         FROM TASNHDR A                                           04830000
048400        WHERE A.OPERCO_NBR    = '03'                              04840000
048500          AND A.EDI_VEND_ID   = :DK-EDI-VEND-ID                   04850000
048600          AND A.ASNHDR_NBR    = :DK-ASN-NBR                       04860000
048700***       AND A.BOL_NBR       = :DK-BOL-NBR                       04870000
048800     END-EXEC.                                                    04880000
048900                                                                  04890000
049000     EVALUATE TRUE                                                04900000
049100         WHEN SQLCODE = +0                                        04910000
049200             CONTINUE                                             04920000
049300                                                                  04930000
049400         WHEN SQLCODE = +100                                      04940000
049500             MOVE ZEROES TO ASNHDR-EDIISA-CNTL-NBR                04950000
049600                                                                  04960000
049700         WHEN SQLWARN0 NOT = SPACE                                04970000
049800         WHEN SQLCODE  NOT = +0                                   04980000
049900             MOVE '2040-SELECT-TASNHDR' TO PV-ABEND-PARAGRAPH     04990000
050000             MOVE PV-DISP-PO            TO PV-ABEND-OPERATION     05000000
050100             MOVE 'GET ADV SHP NOT HDR' TO PV-ABEND-STRUCTURE-1   05010000
050200             MOVE 'TASNHDR'             TO PV-ABEND-STRUCTURE-2   05020000
050300             PERFORM Z999-SQL-ABEND                               05030000
050400     END-EVALUATE.                                                05040000
050500                                                                  05050000
050600***************************************************************** 05060000
050700 2100-CONTINUE-VALIDATION.                                        05070000
050800***************************************************************** 05080000
050900     MOVE '2100-CONTINUE-VALIDATION' TO PV-ABEND-PARAGRAPH.       05090000
051000                                                                  05100000
051100*************************                                         05110000
051200* CHECK CARTON QUANTITY *                                         05120000
051300*************************                                         05130000
051400                                                                  05140000
051500* COUNT NUMBER OF ROWS ON TINPKSU FOR PO/SEQ.                     05150000
051600     MOVE RC052-PO-NBR  TO DK-PO-NBR.                             05160000
051700     MOVE RC052-SEQ-NBR TO DK-SEQ-NBR.                            05170000
051800     MOVE ZEROES TO PV-INPKSU-COUNT.                              05180000
051900     PERFORM 2110-COUNT-TINPKSU.                                  05190000
052000                                                                  05200000
052100* WRITE ERROR RECORD IF PKSLIP-EXPECTED-QTY NOT = COUNT.          05210000
052200     IF PKSLIP-EXPTED-PKG-QTY NOT = PV-INPKSU-COUNT               05220000
052300         PERFORM 3000-LOAD-EXTRACT-ERR1-RECORD                    05230000
052400         MOVE PKSLIP-OPER-UNT-ID     TO RC053-DC                  05240000
052500         MOVE PKSLIP-STR-DEST-NBR    TO RC053-DEST-STORE          05250000
052600         MOVE PKSLIP-EXPTED-PKG-QTY  TO RC053-TPKSLIP-EXP-QTY     05260000
052700         MOVE PKSLIP-ASN-NBR         TO RC053-ASN-NBR             05270000
052800         MOVE PV-INPKSU-COUNT        TO RC053-TINPKSU-PKG-COUNT   05280000
052900         MOVE ASNHDR-EDIISA-CNTL-NBR TO RC053-EDIISA-CNTL-NBR     05290000
053000         SET RC053-TINPKSU-NOTFND    TO TRUE                      05300000
053100         WRITE OUTPUT-RECORD                                      05310000
053200          FROM RC053-ASN-RECVR-PKSLIP-ERRREC                      05320000
053300         ADD +1 TO PV-CARTON-MISMATCH                             05330000
053400         ADD +1 TO PV-RECORDS-WRITTEN                             05340000
053500         PERFORM 4100-ACCUM-VENDOR-ERR1                           05350000
053600     END-IF.                                                      05360000
053700                                                                  05370000
053800***********************                                           05380000
053900* CHECK ITEM QUANTITY *                                           05390000
054000***********************                                           05400000
054100     SET PS-SHUUPC-CSR-EOF-YES TO TRUE.                           05410000
054200     SET PS-PKITEM-CSR-EOF-YES TO TRUE.                           05420000
054300                                                                  05430000
054400     SET PS-VENDOR-ITEM-ERR-NO TO TRUE.                           05440000
054500                                                                  05450000
054600* OPEN CURSORS.                                                   05460000
054700     PERFORM 2120-OPEN-SHUUPC-CSR.                                05470000
054800     PERFORM 2130-OPEN-PKITEM-CSR.                                05480000
054900                                                                  05490000
055000* GET FIRST ROW FROM EACH CURSOR.                                 05500000
055100     PERFORM 2160-FETCH-SHUUPC-CSR.                               05510000
055200     PERFORM 2170-FETCH-PKITEM-CSR.                               05520000
055300                                                                  05530000
055400* COMPARE CURSORS, WRITE ERRORS WHEN DIFFERENT.                   05540000
055500     PERFORM 2200-COMPARE-CURSORS                                 05550000
055600       UNTIL PS-SHUUPC-CSR-EOF-YES                                05560000
055700         AND PS-PKITEM-CSR-EOF-YES.                               05570000
055800                                                                  05580000
055900* CLOSE CURSORS.                                                  05590000
056000     PERFORM 2140-CLOSE-SHUUPC-CSR.                               05600000
056100     PERFORM 2150-CLOSE-PKITEM-CSR.                               05610000
056200                                                                  05620000
056300***************************************************************** 05630000
056400 2110-COUNT-TINPKSU.                                              05640000
056500***************************************************************** 05650000
056600     MOVE '2110-COUNT-TINPKSU      ' TO PV-ABEND-PARAGRAPH.       05660000
056700                                                                  05670000
056800     EXEC SQL                                                     05680000
056900         SELECT COUNT(*)                                          05690000
057000           INTO :PV-INPKSU-COUNT                                  05700000
057100           FROM TINPKSU A                                         05710000
057200          WHERE A.PO_NBR      = :DK-PO-NBR                        05720000
057300            AND A.SEQ_NBR     = :DK-SEQ-NBR                       05730000
057400     END-EXEC.                                                    05740000
057500                                                                  05750000
057600     EVALUATE TRUE                                                05760000
057700         WHEN SQLCODE = +0                                        05770000
057800         WHEN SQLCODE = +100                                      05780000
057900             CONTINUE                                             05790000
058000                                                                  05800000
058100         WHEN SQLWARN0 NOT = SPACE                                05810000
058200         WHEN SQLCODE  NOT = +0                                   05820000
058300             MOVE '2110-COUNT-TINPKSU' TO PV-ABEND-PARAGRAPH      05830000
058400             MOVE PV-DISP-PO           TO PV-ABEND-OPERATION      05840000
058500             MOVE 'COUNT INPKSU ROWS ' TO PV-ABEND-STRUCTURE-1    05850000
058600             MOVE 'TINPKSU'            TO PV-ABEND-STRUCTURE-2    05860000
058700             PERFORM Z999-SQL-ABEND                               05870000
058800     END-EVALUATE.                                                05880000
058900                                                                  05890000
059000***************************************************************** 05900000
059100 2120-OPEN-SHUUPC-CSR.                                            05910000
059200***************************************************************** 05920000
059300     MOVE '2120-OPEN-SHUUPC-CSR    ' TO PV-ABEND-PARAGRAPH.       05930000
059400                                                                  05940000
059500     EXEC SQL                                                     05950000
059600         OPEN SHUUPC-CSR                                          05960000
059700     END-EXEC                                                     05970000
059800                                                                  05980000
059900     EVALUATE TRUE                                                05990000
060000         WHEN SQLCODE = ZERO                                      06000000
060100             SET PS-SHUUPC-CSR-EOF-NO TO TRUE                     06010000
060200                                                                  06020000
060300         WHEN OTHER                                               06030000
060400             PERFORM Z999-SQL-ABEND                               06040000
060500       END-EVALUATE.                                              06050000
060600                                                                  06060000
060700***************************************************************** 06070000
060800 2130-OPEN-PKITEM-CSR.                                            06080000
060900***************************************************************** 06090000
061000     MOVE '2130-OPEN-PKITEM-CSR    ' TO PV-ABEND-PARAGRAPH.       06100000
061100                                                                  06110000
061200     EXEC SQL                                                     06120000
061300         OPEN PKITEM-CSR                                          06130000
061400     END-EXEC                                                     06140000
061500                                                                  06150000
061600     EVALUATE TRUE                                                06160000
061700         WHEN SQLCODE = ZERO                                      06170000
061800             SET PS-PKITEM-CSR-EOF-NO TO TRUE                     06180000
061900                                                                  06190000
062000         WHEN OTHER                                               06200000
062100             PERFORM Z999-SQL-ABEND                               06210000
062200       END-EVALUATE.                                              06220000
062300                                                                  06230000
062400***************************************************************** 06240000
062500 2140-CLOSE-SHUUPC-CSR.                                           06250000
062600***************************************************************** 06260000
062700     MOVE '2140-CLOSE-SHUUPC-CSR   ' TO PV-ABEND-PARAGRAPH.       06270000
062800                                                                  06280000
062900     EXEC SQL                                                     06290000
063000         CLOSE SHUUPC-CSR                                         06300000
063100     END-EXEC                                                     06310000
063200                                                                  06320000
063300     EVALUATE TRUE                                                06330000
063400         WHEN SQLCODE = ZERO                                      06340000
063500             CONTINUE                                             06350000
063600         WHEN OTHER                                               06360000
063700             PERFORM Z999-SQL-ABEND                               06370000
063800       END-EVALUATE.                                              06380000
063900                                                                  06390000
064000***************************************************************** 06400000
064100 2150-CLOSE-PKITEM-CSR.                                           06410000
064200***************************************************************** 06420000
064300     MOVE '2150-CLOSE-PKITEM-CSR   ' TO PV-ABEND-PARAGRAPH.       06430000
064400                                                                  06440000
064500     EXEC SQL                                                     06450000
064600         CLOSE PKITEM-CSR                                         06460000
064700     END-EXEC                                                     06470000
064800                                                                  06480000
064900     EVALUATE TRUE                                                06490000
065000         WHEN SQLCODE = ZERO                                      06500000
065100             CONTINUE                                             06510000
065200         WHEN OTHER                                               06520000
065300             PERFORM Z999-SQL-ABEND                               06530000
065400       END-EVALUATE.                                              06540000
065500                                                                  06550000
065600***************************************************************** 06560000
065700 2160-FETCH-SHUUPC-CSR.                                           06570000
065800***************************************************************** 06580000
065900     MOVE '2160-FETCH-SHUUPC-CSR   ' TO PV-ABEND-PARAGRAPH.       06590000
066000                                                                  06600000
066100     EXEC SQL                                                     06610000
066200         FETCH SHUUPC-CSR                                         06620000
066300          INTO :SHUUPC-TRN-NBR                                    06630000
066400             , :SHUUPC-TRN-LNE-NBR                                06640000
066500             , :SHUUPC-SHPD-QTY                                   06650000
066600     END-EXEC.                                                    06660000
066700                                                                  06670000
066800     EVALUATE TRUE                                                06680000
066900         WHEN SQLCODE = +0                                        06690000
067000             SET PS-SHUUPC-CSR-EOF-NO  TO TRUE                    06700000
067100                                                                  06710000
067200         WHEN SQLCODE = +100                                      06741000
067300             MOVE ZEROES TO SHUUPC-TRN-LNE-NBR                    06742000
067400                            SHUUPC-SHPD-QTY                       06743000
067500             SET PS-SHUUPC-CSR-EOF-YES TO TRUE                    06750000
067600                                                                  06760000
067200         WHEN SQLCODE = -304                                      06761000
067300             MOVE 9999999 TO SHUUPC-SHPD-QTY                      06762000
                   DISPLAY 'PO   NBR : ' PV-DISP-PO                     06763000
                   DISPLAY 'RCVR NBR:  ' PV-DISP-SEQ                    06764000
067700         WHEN SQLWARN0 NOT = SPACE                                06770000
067800         WHEN SQLCODE  NOT = +0                                   06780000
067900             MOVE '2160-FETCH-SHUUPC-CSR' TO PV-ABEND-PARAGRAPH   06790000
068000             MOVE PV-DISP-PO              TO PV-ABEND-OPERATION   06800000
068100             MOVE 'FETCH SHUUPC CURSOR'   TO PV-ABEND-STRUCTURE-1 06810000
068200             MOVE 'TSHUUPC'               TO PV-ABEND-STRUCTURE-2 06820000
068300             PERFORM Z999-SQL-ABEND                               06830000
068400     END-EVALUATE.                                                06840000
068500                                                                  06850000
068600***************************************************************** 06860000
068700 2170-FETCH-PKITEM-CSR.                                           06870000
068800***************************************************************** 06880000
068900     MOVE '2170-FETCH-PKITEM-CSR   ' TO PV-ABEND-PARAGRAPH.       06890000
069000                                                                  06900000
069100     EXEC SQL                                                     06910000
069200         FETCH PKITEM-CSR                                         06920000
069300          INTO :PKITEM-PKSL-LNE-NBR                               06930000
069400             , :PKITEM-PKSL-ITM-QTY                               06940000
069500     END-EXEC.                                                    06950000
069600                                                                  06960000
069700     EVALUATE TRUE                                                06970000
069800         WHEN SQLCODE = +0                                        06980000
069900             SET PS-PKITEM-CSR-EOF-NO  TO TRUE                    06990000
070000                                                                  07000000
070100         WHEN SQLCODE = +100                                      07010000
070200             MOVE ZEROES TO PKITEM-PKSL-LNE-NBR                   07020000
070300                            PKITEM-PKSL-ITM-QTY                   07030000
070400             SET PS-PKITEM-CSR-EOF-YES TO TRUE                    07040000
070500                                                                  07050000
070600         WHEN SQLWARN0 NOT = SPACE                                07060000
070700         WHEN SQLCODE  NOT = +0                                   07070000
070800             MOVE '2160-FETCH-SHUUPC-CSR' TO PV-ABEND-PARAGRAPH   07080000
070900             MOVE PV-DISP-PO              TO PV-ABEND-OPERATION   07090000
071000             MOVE 'FETCH SHUUPC CURSOR'   TO PV-ABEND-STRUCTURE-1 07100000
071100             MOVE 'TSHUUPC'               TO PV-ABEND-STRUCTURE-2 07110000
071200             PERFORM Z999-SQL-ABEND                               07120000
071300     END-EVALUATE.                                                07130000
071400                                                                  07140000
071500***************************************************************** 07150000
071600 2200-COMPARE-CURSORS.                                            07160000
071700***************************************************************** 07170000
071800     MOVE '2200-COMPARE-CURSORS    ' TO PV-ABEND-PARAGRAPH.       07180000
071900                                                                  07190000
072000     IF PS-SHUUPC-CSR-EOF-YES                                     07200000
072100       AND PS-PKITEM-CSR-EOF-NO                                   07210000
072200         PERFORM 3100-LOAD-EXTRACT-ERR2-RECORD                    07220000
072300         MOVE PKITEM-PKSL-LNE-NBR  TO RC053-PKSL-LINE-NBR         07230000
072400         MOVE PKITEM-PKSL-ITM-QTY  TO RC053-TPKITEM-EXP-QTY       07240000
072500         SET RC053-TSHUUPC-NOTFND  TO TRUE                        07250000
072600         WRITE OUTPUT-RECORD                                      07260000
072700          FROM RC053-ASN-RECVR-PKSLIP-ERRREC                      07270000
072800         ADD +1 TO PV-RECORDS-WRITTEN                             07280000
072900         IF PS-VENDOR-ITEM-ERR-NO                                 07290000
073000           AND PV-INPKSU-COUNT > ZERO                             07300000
073100             PERFORM 4200-ACCUM-VENDOR-ERR2                       07310000
073200         END-IF                                                   07320000
073300         PERFORM 2170-FETCH-PKITEM-CSR                            07330000
073400     END-IF.                                                      07340000
073500                                                                  07350000
073600     IF PS-SHUUPC-CSR-EOF-NO                                      07360000
073700       AND PS-PKITEM-CSR-EOF-YES                                  07370000
073800         PERFORM 3100-LOAD-EXTRACT-ERR2-RECORD                    07380000
073900         MOVE SHUUPC-TRN-LNE-NBR   TO RC053-TRN-LINE-NBR          07390000
074000         MOVE SHUUPC-SHPD-QTY      TO RC053-TSHUUPC-SHP-QTY       07400000
074100         SET RC053-TPKITEM-NOTFND  TO TRUE                        07410000
074200         WRITE OUTPUT-RECORD                                      07420000
074300          FROM RC053-ASN-RECVR-PKSLIP-ERRREC                      07430000
074400         ADD +1 TO PV-RECORDS-WRITTEN                             07440000
074500         IF PS-VENDOR-ITEM-ERR-NO                                 07450000
074600           AND PV-INPKSU-COUNT > ZERO                             07460000
074700             PERFORM 4200-ACCUM-VENDOR-ERR2                       07470000
074800         END-IF                                                   07480000
074900         PERFORM 2160-FETCH-SHUUPC-CSR                            07490000
075000     END-IF.                                                      07500000
075100                                                                  07510000
075200     IF PS-SHUUPC-CSR-EOF-NO                                      07520000
075300       AND PS-PKITEM-CSR-EOF-NO                                   07530000
075400         IF PKITEM-PKSL-LNE-NBR = SHUUPC-TRN-LNE-NBR              07540000
075500             IF PKITEM-PKSL-ITM-QTY NOT = SHUUPC-SHPD-QTY         07550000
075600                 PERFORM 3100-LOAD-EXTRACT-ERR2-RECORD            07560000
075700                 MOVE PKITEM-PKSL-LNE-NBR TO RC053-PKSL-LINE-NBR  07570000
075800                 MOVE SHUUPC-TRN-LNE-NBR  TO RC053-TRN-LINE-NBR   07580000
075900                 MOVE PKITEM-PKSL-ITM-QTY TO RC053-TPKITEM-EXP-QTY07590000
076000                 MOVE SHUUPC-SHPD-QTY     TO RC053-TSHUUPC-SHP-QTY07600000
076100                 SET RC053-QTY-MISMATCH   TO TRUE                 07610000
076200                 WRITE OUTPUT-RECORD                              07620000
076300                  FROM RC053-ASN-RECVR-PKSLIP-ERRREC              07630000
076400                 ADD +1 TO PV-RECORDS-WRITTEN                     07640000
076500                 IF PS-VENDOR-ITEM-ERR-NO                         07650000
076600                   AND PV-INPKSU-COUNT > ZERO                     07660000
076700                     PERFORM 4200-ACCUM-VENDOR-ERR2               07670000
076800                 END-IF                                           07680000
076900             END-IF                                               07690000
077000             PERFORM 2160-FETCH-SHUUPC-CSR                        07700000
077100             PERFORM 2170-FETCH-PKITEM-CSR                        07710000
077200         ELSE                                                     07720000
077300         IF PKITEM-PKSL-LNE-NBR > SHUUPC-TRN-LNE-NBR              07730000
077400             PERFORM 3100-LOAD-EXTRACT-ERR2-RECORD                07740000
077500             MOVE SHUUPC-TRN-LNE-NBR  TO RC053-TRN-LINE-NBR       07750000
077600             MOVE SHUUPC-SHPD-QTY     TO RC053-TSHUUPC-SHP-QTY    07760000
077700             SET RC053-TPKITEM-NOTFND TO TRUE                     07770000
077800             WRITE OUTPUT-RECORD                                  07780000
077900              FROM RC053-ASN-RECVR-PKSLIP-ERRREC                  07790000
078000             ADD +1 TO PV-RECORDS-WRITTEN                         07800000
078100             IF PS-VENDOR-ITEM-ERR-NO                             07810000
078200               AND PV-INPKSU-COUNT > ZERO                         07820000
078300                 PERFORM 4200-ACCUM-VENDOR-ERR2                   07830000
078400             END-IF                                               07840000
078500             PERFORM 2160-FETCH-SHUUPC-CSR                        07850000
078600         ELSE                                                     07860000
078700         IF PKITEM-PKSL-LNE-NBR < SHUUPC-TRN-LNE-NBR              07870000
078800             PERFORM 3100-LOAD-EXTRACT-ERR2-RECORD                07880000
078900             MOVE PKITEM-PKSL-LNE-NBR  TO RC053-PKSL-LINE-NBR     07890000
079000             MOVE PKITEM-PKSL-ITM-QTY  TO RC053-TPKITEM-EXP-QTY   07900000
079100             SET RC053-TSHUUPC-NOTFND  TO TRUE                    07910000
079200             WRITE OUTPUT-RECORD                                  07920000
079300              FROM RC053-ASN-RECVR-PKSLIP-ERRREC                  07930000
079400             ADD +1 TO PV-RECORDS-WRITTEN                         07940000
079500             IF PS-VENDOR-ITEM-ERR-NO                             07950000
079600               AND PV-INPKSU-COUNT > ZERO                         07960000
079700                 PERFORM 4200-ACCUM-VENDOR-ERR2                   07970000
079800             END-IF                                               07980000
079900             PERFORM 2170-FETCH-PKITEM-CSR                        07990000
080000         END-IF                                                   08000000
080100         END-IF                                                   08010000
080200         END-IF                                                   08020000
080300     END-IF.                                                      08030000
080400                                                                  08040000
080500***************************************************************** 08050000
080600 3000-LOAD-EXTRACT-ERR1-RECORD.                                   08060000
080700***************************************************************** 08070000
080800     MOVE '3000-LOAD-EXTRACT-ERR1  ' TO PV-ABEND-PARAGRAPH.       08080000
080900                                                                  08090000
081000     INITIALIZE RC053-ASN-RECVR-PKSLIP-ERRREC.                    08100000
081100                                                                  08110000
081200     MOVE '1'                      TO RC053-TYPE-CODE.            08120000
081300     MOVE RC052-PO-NBR             TO RC053-PO-NBR.               08130000
081400     MOVE RC052-SEQ-NBR            TO RC053-SEQ-NBR.              08140000
081500     MOVE RC052-EDI-VEND-NAME      TO RC053-VENDOR-NAME.          08150000
081600     MOVE RC052-CARRIER-SCAC-CODE  TO RC053-SCAC.                 08160000
081700     MOVE RC052-BILL-OF-LADING-NBR TO RC053-BOL-NBR.              08170000
081800                                                                  08180000
081900     MOVE PURCHS-ENT-ID            TO RC053-TPURCHS-ENT-ID.       08190000
082000                                                                  08200000
082100***************************************************************** 08210000
082200 3100-LOAD-EXTRACT-ERR2-RECORD.                                   08220000
082300***************************************************************** 08230000
082400     MOVE '3100-LOAD-EXTRACT-ERR2  ' TO PV-ABEND-PARAGRAPH.       08240000
082500                                                                  08250000
082600     INITIALIZE RC053-ASN-RECVR-PKSLIP-ERRREC.                    08260000
082700                                                                  08270000
082800     MOVE '2'                      TO RC053-TYPE-CODE.            08280000
082900     MOVE RC052-PO-NBR             TO RC053-PO-NBR.               08290000
083000     MOVE RC052-SEQ-NBR            TO RC053-SEQ-NBR.              08300000
083100     MOVE RC052-EDI-VEND-NAME      TO RC053-VENDOR-NAME.          08310000
083200     MOVE RC052-CARRIER-SCAC-CODE  TO RC053-SCAC.                 08320000
083300     MOVE RC052-BILL-OF-LADING-NBR TO RC053-BOL-NBR.              08330000
083400                                                                  08340000
083500     MOVE PKSLIP-ASN-NBR           TO RC053-ASN-NBR.              08350000
083600     MOVE PKSLIP-OPER-UNT-ID       TO RC053-DC.                   08360000
083700     MOVE PKSLIP-STR-DEST-NBR      TO RC053-DEST-STORE.           08370000
083800                                                                  08380000
083900     MOVE PKSLIP-EXPTED-PKG-QTY    TO RC053-TPKSLIP-EXP-QTY.      08390000
084000     MOVE PV-INPKSU-COUNT          TO RC053-TINPKSU-PKG-COUNT.    08400000
084100                                                                  08410000
084200     MOVE PURCHS-ENT-ID            TO RC053-TPURCHS-ENT-ID.       08420000
084300     MOVE ASNHDR-EDIISA-CNTL-NBR   TO RC053-EDIISA-CNTL-NBR.      08430000
084400                                                                  08440000
084500***************************************************************** 08450000
084600 4000-LOAD-VENDOR-DATA.                                           08460000
084700***************************************************************** 08470000
084800     MOVE '4000-LOAD-VENDOR-DATA   ' TO PV-ABEND-PARAGRAPH.       08480000
084900                                                                  08490000
085000     SET VS-IDX TO 1.                                             08500000
085100                                                                  08510000
085200     SEARCH SUMMARY-TABLE                                         08520000
085300       VARYING VS-IDX                                             08530000
085400         AT END SET PS-END-OF-TABLE TO TRUE                       08540000
085500                                                                  08550000
085600         WHEN SUMMARY-VEND-NAME (VS-IDX) = RC052-EDI-VEND-NAME    08560000
085700             ADD +1              TO SUMMARY-VEND-COUNT (VS-IDX)   08570000
085800                                                                  08580000
085900         WHEN SUMMARY-VEND-NAME (VS-IDX) = SPACES                 08590000
086000             MOVE RC052-EDI-VEND-NAME                             08600000
086100                                 TO SUMMARY-VEND-NAME (VS-IDX)    08610000
086200             MOVE 1              TO SUMMARY-VEND-COUNT (VS-IDX)   08620000
086300                                                                  08630000
086400     END-SEARCH.                                                  08640000
086500                                                                  08650000
086600***************************************************************** 08660000
086700 4100-ACCUM-VENDOR-ERR1.                                          08670000
086800***************************************************************** 08680000
086900     MOVE '4100-ACCUM-VENDOR-ERR1   ' TO PV-ABEND-PARAGRAPH.      08690000
087000                                                                  08700000
087100     SET VS-IDX TO 1.                                             08710000
087200                                                                  08720000
087300     SEARCH SUMMARY-TABLE                                         08730000
087400       VARYING VS-IDX                                             08740000
087500         AT END SET PS-END-OF-TABLE TO TRUE                       08750000
087600                                                                  08760000
087700         WHEN SUMMARY-VEND-NAME (VS-IDX) = RC052-EDI-VEND-NAME    08770000
087800             ADD +1              TO SUMMARY-VEND-ERRS  (VS-IDX)   08780000
087900                                                                  08790000
088000     END-SEARCH.                                                  08800000
088100                                                                  08810000
088200***************************************************************** 08820000
088300 4200-ACCUM-VENDOR-ERR2.                                          08830000
088400***************************************************************** 08840000
088500     MOVE '4200-ACCUM-VENDOR-ERR2   ' TO PV-ABEND-PARAGRAPH.      08850000
088600                                                                  08860000
088700     SET VS-IDX TO 1.                                             08870000
088800                                                                  08880000
088900     SEARCH SUMMARY-TABLE                                         08890000
089000       VARYING VS-IDX                                             08900000
089100         AT END SET PS-END-OF-TABLE TO TRUE                       08910000
089200                                                                  08920000
089300         WHEN SUMMARY-VEND-NAME (VS-IDX) = RC052-EDI-VEND-NAME    08930000
089400             ADD +1              TO SUMMARY-ITEM-ERRS (VS-IDX)    08940000
089500             SET PS-VENDOR-ITEM-ERR-YES TO TRUE                   08950000
089600                                                                  08960000
089700     END-SEARCH.                                                  08970000
089800                                                                  08980000
089900***************************************************************** 08990000
090000 5000-WRITE-SUMMARY-TABLE.                                        09000000
090100***************************************************************** 09010000
090200     MOVE '5000-WRITE-SUMMARY-TABLE' TO PV-ABEND-PARAGRAPH.       09020000
090300                                                                  09030000
090400     INITIALIZE RC053-ASN-RECVR-PKSLIP-ERRREC.                    09040000
090500                                                                  09050000
090600     MOVE '4'                         TO RC053-TYPE-CODE.         09060000
090700     MOVE SUMMARY-VEND-NAME  (VS-IDX) TO RC053-VENDOR-NAME.       09070000
090800     MOVE SUMMARY-VEND-COUNT (VS-IDX) TO RC053-TOT-VEND-RECS.     09080000
090900     MOVE SUMMARY-VEND-ERRS  (VS-IDX) TO RC053-VEND-PKSL-ERRS.    09090000
091000     MOVE SUMMARY-ITEM-ERRS  (VS-IDX) TO RC053-PKSL-DTL-ERRS.     09100000
091100                                                                  09110000
091200     WRITE OUTPUT-RECORD FROM RC053-ASN-RECVR-PKSLIP-ERRREC.      09120000
091300                                                                  09130000
091400***************************************************************** 09140000
091500 Z999-SQL-ABEND.                                                  09150000
091600***************************************************************** 09160000
091700     MOVE SQLCODE TO PV-SQLCODE.                                  09170000
091800     MOVE PV-SQLCODE TO PV-DISP-SQLCODE.                          09180000
091900     DISPLAY '*** DB2 ERROR '.                                    09190000
092000     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  09200000
092100     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 09210000
092200     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               09220000
092300     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               09230000
092400     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       09240000
092500     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       09250000
092600     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       09260000
092700     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             09270000
092800                                                                  09280000
092900     IF PV-ABEND-STRUCTURE-2 > SPACES                             09290000
093000         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          09300000
093100     END-IF.                                                      09310000
093200                                                                  09320000
093300     COPY DPPD004.                                                09330000
093400                                                                  09340000
093500     MOVE +4013         TO PV-ABEND-CODE.                         09350000
093600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         09360000
