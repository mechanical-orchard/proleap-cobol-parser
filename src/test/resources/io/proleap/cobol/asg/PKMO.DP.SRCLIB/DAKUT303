       IDENTIFICATION DIVISION.                                         00010016
       PROGRAM-ID.           DAKUT303.                                  00020099
       AUTHOR.               JON FIEDLER.                               00030099
       INSTALLATION.         KOHLS DEPARTMENT STORES.                   00040099
       DATE-WRITTEN          07/18/2000.                                00050099
       DATE-COMPILED.                                                   00060016
                                                                        00070016
      ******************************************************************00080017
      *PURPOSE: THIS PROGRAM EXTRACTS DATA FOR A REPORT THAT WILL SHOW  00090099
      * ANY DA'S THAT HAVE BEEN ENTERED WITH A FUTURE EFFECTIVE DATE    00100099
      * OF 'DEFER DEDUCTION UP TO 60 DAYS' OR 'HOLD CHECK FROM VENDOR   00110099
      * UP TO 60 DAYS'.                                                 00120099
      *                                                                 00130099
      * IT WILL EXTRACT DATA FROM THE TDAALW TABLE THAT HAS AN EFFECTIVE00140099
      * DATE GREATER THEN THE CURRENT DATE AND HAS A STATUS THAT IS NOT 00150099
      * EQUAL TO '60'.                                                  00160099
      *                                                                 00170099
      * THE PROGRAM CALCULATES THE DUE DATE (EFFECTIVE DATE PLUS THE    00180099
      * COLLECTION DAYS) AND THE RETAIL (NET COST AMOUNT/( 1 -          00190099
      * (MARKUP PERCENT/100)).                                          00200099
      ******************************************************************00210099
      *    WR/PITS#     DATE        DESCRIPTION                        *00220099
      *    --------   ----------   ---------------------------------   *00230099
001700*   PM00415778  08-06-2001    ABENDED DUE TO MKUP PCT = NULL     *00240099
001700*                             VALUES.  THIS WAS ON A NON MA      *00250099
001700*                             TYPE RECORD WHERE NKUP_PCT WAS     *00260099
001700*                             NOT REQUIRED.  MODIFIED CODE TO    *00270099
001700*                             CHECK FOR RECORD TYPE CODE FIRST.  *00280099
22405 * 22405  05-31-2001 R JANSSEN  DAII - ASSET RECOVERY ENHANCEMENT  00290099
W30328*W30328  02-22-2006 S JACKSON  10G GATEWAY - REMOVE ALTER SESSION 00300099
854385*854385  02-25-2006 L YANG    10G GATEWAY ISSUE ON 'WHERE' CLAUSE 00310099
S54385*S54385  02-26-2006 S JACKSON FORMAT DA EFF_DTE USE (TO_DATE)FUNC 00320099
S30328*W30021  05-15-2006 P KEBER   CALCULATE RETAIL AMOUNT FOR THE NEW 00321099
S30328*                             "MKDN ALW PROFIT ASST - CST/RTL"    00322099
S30328*                             OFF INVOICE DEBIT TYPE (TYPE PR).   00323099
8613F *8613F   07-17-2015 S BARTELT RMS 9 REMEDIATION. CHANGED FROM    *00324099
8613F *                             AUTO LOGON TO EXTERNAL SIGN ON     *00325099
      ******************************************************************00330017
                                                                        00340016
       ENVIRONMENT DIVISION.                                            00350016
       CONFIGURATION SECTION.                                           00360016
       SOURCE-COMPUTER. IBM-3090.                                       00370016
       OBJECT-COMPUTER. IBM-3090.                                       00380016
                                                                        00390017
       INPUT-OUTPUT SECTION.                                            00400016
       FILE-CONTROL.                                                    00410016
                                                                        00420017
8613F      SELECT ORACLE-LOGIN-FILE          ASSIGN TO ORALOGON.        00431099
22405                                                                   00440099
           SELECT OUT-DA-FILE                ASSIGN TO OUT01.           00450000
                                                                        00460016
       DATA DIVISION.                                                   00470016
       FILE SECTION.                                                    00480016
                                                                        00490017
8613F  FD  ORACLE-LOGIN-FILE                                            00490199
8613F      RECORDING MODE IS F                                          00490299
8613F      LABEL RECORDS ARE STANDARD                                   00490399
8613F      BLOCK CONTAINS 0 RECORDS                                     00490499
8613F      DATA RECORD IS ORACLE-LOGIN-REC.                             00490599
8613F  01  ORACLE-LOGIN-REC.                                            00490699
8613F      05  FILLER                  PIC X(80).                       00490799
                                                                        00491099
       FD  OUT-DA-FILE                                                  00670000
           LABEL RECORDS ARE STANDARD                                   00680000
           RECORDING MODE IS F                                          00690000
           BLOCK CONTAINS 0 RECORDS.                                    00700000
       01  OUT-DA-RECORD            PIC X(175).                         00710099
                                                                        00720000
       WORKING-STORAGE SECTION.                                         00730016
                                                                        00740030
       01  PC-PROGRAM-CONSTANTS.                                        00750016
           05  PC-CALENDAR-ROUTINE        PIC X(8)        VALUE         00760099
                                                           'DPKUT500'.  00770099
           05  PC-PROGRAM-NAME            PIC X(08)       VALUE         00780099
                                                           'DAKUT303'.  00790099
           05  PC-AP-APPROVAL-STAT-CDE    PIC X(02)       VALUE '40'.   00800099
           05  PC-MESSAGES.                                             00810016
               10  PC-SQL-ABEND-MESSAGE   PIC X(23)       VALUE         00820099
               '** ABEND -> SQLERROR = '.                               00830016
               10  PC-PROGRAM-MESSAGE     PIC X(23)       VALUE         00840099
               '** PROGRAM        ** = '.                               00850016
               10  PC-PARAGRAPH-MESSAGE   PIC X(23)       VALUE         00860099
               '** PARAGRAPH-NAME ** = '.                               00870016
               10  PC-DB2-OPER-MESSAGE    PIC X(23)       VALUE         00880099
               '** DB2 OPERATION  ** = '.                               00890016
8613F      05  PC-AUTO-LOGON              PIC X(01)       VALUE '/'.    00891099
                                                                        00900016
       01 PV-PROGRAM-VARIABLES.                                         00910019
           05  PV-ABEND-PARAGRAPH         PIC X(40)       VALUE SPACE.  00920099
           05  PV-ABEND-CODE  COMP SYNC   PIC S9(04)      VALUE +0000.  00930099
           05  PV-DUE-DATE                PIC 9(10).                    00940019
           05  PV-RETAIL-AMT              PIC S9(11)V99.                00950028
           05  PV-PCTG                    PIC S9(04)V9999 VALUE +0.     00960099
           05 PV-TODAYS-DATE.                                           00970024
               10 PV-CURRENT-YEAR         PIC 99.                       00980024
               10 PV-CURRENT-MONTH        PIC 99.                       00990024
               10 PV-CURRENT-DAY          PIC 99.                       01000024
           05 PV-TODAYS-DATE-FORMATTED.                                 01010099
               10 PV-CENTURY              PIC 99          VALUE 20.     01020099
               10 PV-YEAR                 PIC 99.                       01030099
               10 FILLER                  PIC X           VALUE '-'.    01040099
               10 PV-MONTH                PIC 99.                       01050099
               10 FILLER                  PIC X           VALUE '-'.    01060099
               10 PV-DAY                  PIC 99.                       01070099
               10 FILLER                  PIC X           VALUE '-'.    01080099
               10 PV-HOUR                 PIC 99          VALUE ZEROES. 01090099
               10 FILLER                  PIC X           VALUE '.'.    01100099
               10 PV-MINUTE               PIC 99          VALUE ZEROES. 01110099
               10 FILLER                  PIC X           VALUE '.'.    01120099
               10 PV-SECOND               PIC 99          VALUE ZEROES. 01130099
8613F      05  PV-ORACLE-USERID-LEN            PIC S9(04) VALUE ZEROS.  01221099
8613F      05  PV-ORACLE-PASSWORD-LEN          PIC S9(04) VALUE ZEROS.  01222099
                                                                        01230019
       01  PS-PROGRAM-SWITCHES.                                         01240016
           05  PS-DA-TRANS-LEFT-SW        PIC X(01)       VALUE 'Y'.    01250099
               88  PS-NO-MORE-DA-TRANS-LEFT               VALUE 'N'.    01260099
               88  PS-MORE-DA-TRANS-LEFT                  VALUE 'Y'.    01270099
8613F      05  PS-ORACLE-LOGIN-EOF-SW     PIC  X          VALUE 'N'.    01271099
8613F          88  ORACLE-LOGIN-EOF                       VALUE 'Y'.    01272099
                                                                        01280016
8613F  01  CC-ORACLE-CONNECTION.                                        01281099
8613F      05  CC-ORACLE-USERID                PIC X(40).               01282099
8613F          88 CC-AUTO-LOGON                           VALUE '/'.    01283099
8613F      05  CC-ORACLE-PASSWORD              PIC X(40).               01284099
                                                                        01285099
       01  PS-PROGRAM-ACCUMUALTORS.                                     01290016
           05  PA-ROWS-FETCHED            PIC 9(07)       VALUE 0.      01300099
           05  PA-RECORDS-WRITTEN         PIC 9(07)       VALUE 0.      01310099
22405  01  PS-INP01-DONE-SW             PIC X(01)      VALUE 'N'.       01320099
22405      88  INP01-PROCESS-COMPLETE                  VALUE 'Y'.       01330099
                                                                        01340016
       01  WS-MSG-TEXT                    PIC X(512).                   01350019
       01  WS-MAX-SIZE                    PIC S9(09)      COMP          01360099
                                                          VALUE 512.    01370099
       01  WS-MSG-LENGTH                  PIC S9(09)      COMP.         01380099
                                                                        01390016
      *----------------------------------------------------------------*01400016
      *    ORACLE DECLARE SECTION                                       01410016
      *----------------------------------------------------------------*01420016
           EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     01430016
                                                                        01440016
       01  USERNAME                       PIC X(10)       VARYING.      01450099
       01  PASSWD                         PIC X(10)       VARYING.      01460099
       01  PC-ENT01-TYPE-CDE              PIC X(02)       VALUE '01'.   01470099
       01  PV-ORACLE-ID                   PIC X(1)        VALUE '/'.    01480099
       01  PV-ITMCLT-CLUSTR               PIC X(40)       VALUE SPACES. 01490099
                                                                        01500007
       01  PROG-VALUES.                                                 01510061
           05  PV-CLLCTN-DAYS-NBR-NULL    PIC S9(04)      COMP          01520099
                                                          VALUE ZERO.   01530099
           05  PV-MKUP-PCT-NULL           PIC S9(04)      COMP          01540099
                                                          VALUE ZERO.   01550099
                                                                        01560061
      ******************************************************************01570012
      * COBOL DECLARATION FOR TABLE TDAALW                              01580016
      ******************************************************************01590012
           EXEC SQL                                                     01600012
               INCLUDE TDAALW                                           01610012
           END-EXEC.                                                    01620005
                                                                        01630099
           EXEC SQL END DECLARE SECTION END-EXEC.                       01640006
                                                                        01650006
      ******************************************************************01660099
      * ORA COMMUNICATION AREA                                          01670006
      ******************************************************************01680099
        01       SQLCA.                                                 01690006
                 05  SQLCAID               PIC X(8).                    01700006
                 05  SQLCABC               PIC S9(9) COMPUTATIONAL.     01710006
                 05  SQLCODE               PIC S9(9) COMPUTATIONAL.     01720006
                 05  SQLERRM.                                           01730006
                     49 SQLERRML           PIC S9(4) COMPUTATIONAL.     01740006
                     49 SQLERRMC           PIC X(70).                   01750006
                 05  SQLERRP               PIC X(8).                    01760006
                 05  SQLERRD OCCURS 6 TIMES                             01770016
                                           PIC S9(9) COMPUTATIONAL.     01780016
                 05  SQLWARN.                                           01790016
                     10 SQLWARN0           PIC X(1).                    01800016
                     10 SQLWARN1           PIC X(1).                    01810016
                     10 SQLWARN2           PIC X(1).                    01820016
                     10 SQLWARN3           PIC X(1).                    01830016
                     10 SQLWARN4           PIC X(1).                    01840016
                     10 SQLWARN5           PIC X(1).                    01850016
                     10 SQLWARN6           PIC X(1).                    01860016
                     10 SQLWARN7           PIC X(1).                    01870016
                 05  SQLEXT                PIC X(8).                    01880016
      ***************************************************************** 01890030
      * ORA COMMUNICATION AREA2                                         01900016
      ***************************************************************** 01910030
           COPY SQLCA2.                                                 01920016
                                                                        01930017
      ******************************************************************01940017
      * DARD102 COPYBOOK                                                01950099
      ******************************************************************01960017
           COPY DARD102.                                                01970099
                                                                        01980017
      ***************************************************************** 01990030
      *    CALENDAR ROUTINE WORK AREA.                                  02000030
      ***************************************************************** 02010030
           COPY DPWS500.                                                02020034
                                                                        02030030
       PROCEDURE DIVISION.                                              02040016
      ******************************************************************02050099
      * MAIN PROCEDURE                                                  02060099
      ******************************************************************02070099
       0000-MAINLINE-LOGIC.                                             02080016
                                                                        02090016
           PERFORM 1000-INITIALIZATION.                                 02100016
                                                                        02110016
           PERFORM 1100-OPEN-TDAALW-CURSOR.                             02120016
                                                                        02130016
           PERFORM 2000-PROCESS-TDAALW                                  02140016
              UNTIL PS-NO-MORE-DA-TRANS-LEFT.                           02150046
                                                                        02160016
           PERFORM 9900-EOJ-LOGIC.                                      02170014
                                                                        02180016
                                                                        02190016
           GOBACK.                                                      02200016
           EJECT                                                        02210016
      ******************************************************************02220099
      * THIS PROCEDURE LOGONS TO ORACLE, DECLARES THE ORACLE CURSORS,   02230099
      * AND INITIALIZES STARTING VARIABLES.                             02240099
      ******************************************************************02250099
       1000-INITIALIZATION.                                             02260016
8613F      OPEN INPUT   ORACLE-LOGIN-FILE.                              02270099
           OPEN OUTPUT  OUT-DA-FILE.                                    02280001
                                                                        02290016
           ACCEPT PV-TODAYS-DATE FROM DATE.                             02300099
           MOVE PV-CURRENT-YEAR          TO PV-YEAR.                    02310099
           MOVE PV-CURRENT-MONTH         TO PV-MONTH.                   02320099
           MOVE PV-CURRENT-DAY           TO PV-DAY.                     02330099
           MOVE PV-TODAYS-DATE-FORMATTED TO DAALW-EFF-DTE.              02340099
                                                                        02350099
      ****************************************************************  02360016
      * LOGON                                                        *  02370016
      ****************************************************************  02380016
           DISPLAY '**********************************'.                02390000
22405      DISPLAY '**********************************'.                02400099
   |       DISPLAY '*'.                                                 02410099
   |                                                                    02420099
8613F      PERFORM 1001-CONNECT-TO-ORACLE.                              02421099
                                                                        02422099
                                                                        03320010
W30328*    EXEC SQL                                                     03330099
W30328*     ALTER SESSION                                               03340099
W30328*           SET NLS_DATE_FORMAT = 'YYYY-MM-DD.HH24.MI.SS'         03350099
W30328*    END-EXEC.                                                    03360099
                                                                        03370010
      ***************************************************************** 03380010
      *    TDAALW INFORMATION CURSOR -                                  03390010
      ***************************************************************** 03400010
                                                                        03410010
           EXEC SQL                                                     03420010
               DECLARE TDAALW_INFO CURSOR FOR                           03430010
                   SELECT DEPT_NBR                                      03440054
W30328*                  ,EFF_DTE                                       03450099
W30328                  , TO_CHAR(EFF_DTE,'YYYY-MM-DD.HH24.MI.SS')      03460099
                         ,CLLCTN_DAYS_NBR                               03470051
                         ,NET_CST_AMT                                   03480051
                         ,MKUP_PCT                                      03490060
                         ,TYP_CDE                                       03500099
                   FROM TDAALW                                          03510019
                   WHERE STAT_CDE <> '60'                               03520019
PRE10G*            AND EFF_DTE  >= :DAALW-EFF-DTE                       03530099
854385*            AND TO_CHAR(EFF_DTE,'YYYY-MM-DD.HH24.MI.SS')         03540099
854385*                    >= :DAALW-EFF-DTE                            03550099
S54385             AND EFF_DTE  >=                                      03560099
S54385                 TO_DATE(:DAALW-EFF-DTE,'YYYY-MM-DD.HH24.MI.SS')  03570099
           END-EXEC.                                                    03580014
                                                                        03590014
                                                                        03600014
      *EJECT                                                            03610099
8613F * LOGONS TO ORACLE.                                              *03611099
8613F ******************************************************************03612099
8613F *    - READ THE CONTROL CARD TO GET THE CREDENTIALS AND LOGON    *03613099
8613F *    - ORACLE                                                    *03614099
8613F *----------------------------------------------------------------*03615099
8613F  1001-CONNECT-TO-ORACLE.                                          03616099
8613F      DISPLAY '**********************************'.                03617099
8613F      DISPLAY '**------ BEGIN DAKUP200 ------**'.                  03618099
8613F      DISPLAY '**********************************'.                03619099
8613F                                                                   03619199
8613F      MOVE '1001-CONNECT-TO-ORACLE'   TO PV-ABEND-PARAGRAPH.       03619299
8613F                                                                   03619399
8613F      READ ORACLE-LOGIN-FILE INTO CC-ORACLE-CONNECTION             03619499
8613F         AT END                                                    03619599
8613F            SET ORACLE-LOGIN-EOF      TO TRUE.                     03619699
8613F                                                                   03619799
8613F      IF CC-AUTO-LOGON                                             03619899
8613F         DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'         03619999
8613F         EXEC SQL                                                  03620099
8613F              CONNECT :PC-AUTO-LOGON                               03620199
8613F         END-EXEC                                                  03620299
8613F      ELSE                                                         03620399
8613F         INITIALIZE PV-ORACLE-USERID-LEN                           03620499
8613F                    PV-ORACLE-PASSWORD-LEN                         03620599
8613F         INSPECT CC-ORACLE-USERID                                  03620699
8613F                 TALLYING PV-ORACLE-USERID-LEN                     03620799
8613F                 FOR CHARACTERS BEFORE INITIAL SPACE               03620899
8613F         INSPECT CC-ORACLE-PASSWORD                                03620999
8613F                 TALLYING PV-ORACLE-PASSWORD-LEN                   03621099
8613F                 FOR CHARACTERS BEFORE INITIAL SPACE               03621199
8613F         MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN)     TO     03621299
8613F                 USERNAME-ARR                                      03621399
8613F         MOVE PV-ORACLE-USERID-LEN    TO USERNAME-LEN              03621499
8613F         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     03621599
8613F                 PASSWD-ARR                                        03621699
8613F         MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                03621799
8613F         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     03621899
8613F              PASSWD-ARR                                           03621999
8613F         MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                03622099
8613F         MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN)     TO     03622199
8613F              USERNAME-ARR                                         03622299
8613F         MOVE PV-ORACLE-USERID-LEN    TO USERNAME-LEN              03622399
8613F         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     03622499
8613F              PASSWD-ARR                                           03622599
8613F         MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                03622699
8613F         DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER '    03622799
8613F              USERNAME-ARR                                         03622899
8613F         EXEC SQL                                                  03622999
8613F              CONNECT :USERNAME IDENTIFIED BY :PASSWD              03623099
8613F         END-EXEC                                                  03623199
8613F         INITIALIZE CC-ORACLE-PASSWORD                             03623299
8613F                    PASSWD                                         03623399
8613F      END-IF.                                                      03623499
8613F                                                                   03623599
8613F      IF (SQLCODE NOT = 0)                                         03623699
8613F          DISPLAY PV-ABEND-PARAGRAPH                               03623799
8613F          PERFORM 9999-SQL-ERROR                                   03623899
8613F      END-IF.                                                      03623999
      ******************************************************************03624099
      *    OPEN-TDAALW-INFO-CURSOR                                      03630099
      ******************************************************************03640099
       1100-OPEN-TDAALW-CURSOR.                                         03650014
                                                                        03660014
           MOVE '1100-OPEN-TDAALW-CURSOR' TO PV-ABEND-PARAGRAPH.        03670014
                                                                        03680014
           EXEC SQL                                                     03690014
               OPEN TDAALW_INFO                                         03700014
           END-EXEC.                                                    03710014
                                                                        03720014
           EVALUATE TRUE                                                03730014
             WHEN SQLCODE = ZEROS                                       03740014
               CONTINUE                                                 03750014
             WHEN SQLCODE = 1403                                        03760014
               SET PS-NO-MORE-DA-TRANS-LEFT TO TRUE                     03770014
               CONTINUE                                                 03780014
             WHEN OTHER                                                 03790014
               DISPLAY PV-ABEND-PARAGRAPH                               03800014
               PERFORM 9999-SQL-ERROR                                   03810014
           END-EVALUATE.                                                03820014
                                                                        03830014
       EJECT                                                            03840014
      ******************************************************************03850099
      *    FETCH-TDAALW-INFO-INFO                                       03860099
      *      FETCH A ROW FROM THE CURSOR                                03870099
      ******************************************************************03880099
       1200-FETCH-TDAALW-INFO.                                          03890014
                                                                        03900014
           MOVE '1200-FETCH-TDAALW-INFO' TO PV-ABEND-PARAGRAPH.         03910014
                                                                        03920014
           EXEC SQL                                                     03930002
               FETCH TDAALW_INFO                                        03940050
               INTO  :DAALW-DEPT-NBR                                    03950053
                   , :DAALW-EFF-DTE                                     03960052
                   , :DAALW-CLLCTN-DAYS-NBR :PV-CLLCTN-DAYS-NBR-NULL    03970061
                   , :DAALW-NET-CST-AMT                                 03980052
                   , :DAALW-MKUP-PCT        :PV-MKUP-PCT-NULL           03990061
                   , :DAALW-TYP-CDE                                     04000099
           END-EXEC.                                                    04010014
                                                                        04020014
           EVALUATE TRUE                                                04030014
             WHEN SQLCODE = ZEROS                                       04040014
               ADD 1 TO PA-ROWS-FETCHED                                 04050014
             WHEN SQLCODE = 1403                                        04060014
               SET PS-NO-MORE-DA-TRANS-LEFT TO TRUE                     04070014
             WHEN OTHER                                                 04080014
               DISPLAY PV-ABEND-PARAGRAPH                               04090014
               PERFORM 9999-SQL-ERROR                                   04100014
           END-EVALUATE.                                                04110014
                                                                        04120014
       EJECT                                                            04130014
      ******************************************************************04140099
      *    CLOSE-TDAALW-CURSOR                                          04150099
      ******************************************************************04160099
       1300-CLOSE-TDAALW-CURSOR.                                        04170014
                                                                        04180014
           MOVE '1300-CLOSE-TDAALW-INFO-CURSOR' TO PV-ABEND-PARAGRAPH.  04190014
                                                                        04200014
           EXEC SQL                                                     04210014
               CLOSE TDAALW_INFO                                        04220014
           END-EXEC.                                                    04230014
                                                                        04240014
           EVALUATE TRUE                                                04250014
             WHEN SQLCODE = ZEROS                                       04260014
               CONTINUE                                                 04270014
             WHEN OTHER                                                 04280014
               DISPLAY PV-ABEND-PARAGRAPH                               04290014
               PERFORM 9999-SQL-ERROR                                   04300014
           END-EVALUATE.                                                04310014
                                                                        04320014
       EJECT                                                            04330014
      ******************************************************************04340099
      *    2000-PROCESS-TDAALW                                          04350099
      *      PURPOSE: READ AND PROCESS THE TDAALW INFO CURSOR           04360099
      ******************************************************************04370099
       2000-PROCESS-TDAALW.                                             04380014
           PERFORM 1200-FETCH-TDAALW-INFO.                              04390046
           IF PS-MORE-DA-TRANS-LEFT                                     04400046
               PERFORM 2200-PREPARE-DATA                                04410062
               ADD 1 TO PA-RECORDS-WRITTEN                              04420099
               WRITE OUT-DA-RECORD FROM DA102-REC                       04430099
           END-IF.                                                      04440046
           MOVE 0 TO PV-MKUP-PCT-NULL.                                  04450099
           MOVE 0 TO PV-CLLCTN-DAYS-NBR-NULL.                           04460099
                                                                        04470065
      ******************************************************************04480099
      * THIS PROCEDURE FORMATS DATA THAT IS TO BE OUTPUTTED.            04490099
      ******************************************************************04500099
       2200-PREPARE-DATA.                                               04510005
                                                                        04520099
           PERFORM 2300-SUBTRACT-DAYS                                   04530099
              THRU 2300-SUBTRACT-DAYS-EXIT.                             04540099
                                                                        04550054
                                                                        04560099
0801RM*    IF  DAALW-MKUP-PCT IS GREATER THAN ZERO AND                  04570099
0801RM*    DAALW-TYP-CDE IS EQUAL TO 'MA'                               04580099
W30021     IF ((DAALW-TYP-CDE IS EQUAL TO 'MA' OR 'AR' OR 'PR') AND     04590099
22405           DAALW-MKUP-PCT IS GREATER THAN ZERO)                    04600099
                                                                        04610099
             COMPUTE PV-PCTG = (1 - (DAALW-MKUP-PCT / 100))             04620099
             COMPUTE DA102-RTL-AMT ROUNDED =                            04630099
                     DAALW-NET-CST-AMT /                                04640099
                     PV-PCTG                                            04650099
           ELSE                                                         04660099
             MOVE ZERO TO DA102-RTL-AMT                                 04670099
           END-IF.                                                      04680099
                                                                        04690099
           MOVE DAALW-DEPT-NBR    TO DA102-DEPT-NBR.                    04700099
           MOVE DAALW-NET-CST-AMT TO DA102-CST-AMT.                     04710099
                                                                        04720099
           MOVE 0 TO DAALW-CLLCTN-DAYS-NBR.                             04730099
           MOVE 0 TO DAALW-CLLCTN-DAYS-NBR.                             04740099
                                                                        04750099
      ******************************************************************04760099
      * THIS PROCEDURE USES THE CALENDAR ROUTINE TO GET THE DUE DATE BY 04770099
      * ADDING THE NUMBER OF COLLECTION DAYS TO THE EFFECTIVE DATE.     04780099
      ******************************************************************04790099
       2300-SUBTRACT-DAYS.                                              04800030
TEMP       DISPLAY '2300-SUBTRACT-DAYS'.                                04810099
                                                                        04820030
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04830030
           MOVE DAALW-EFF-DTE         TO DPG52-LK-DATE-INPUT.           04840030
           MOVE DAALW-CLLCTN-DAYS-NBR TO DPG51-INCR-DECR-DAYS-9.        04850030
           SET  DPG52-LK-DTE-ISO-FMT  TO TRUE.                          04860030
           MOVE 'A0'                  TO DPG51-CALENDAR-TYPE.           04870030
           SET DPG51-INCREMENT-DATE   TO TRUE.                          04880030
                                                                        04890030
           CALL DP500-KOHLS-CALENDAR-ROUTINE                            04900030
              USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                04910030
                                                                        04920030
           EVALUATE TRUE                                                04930030
               WHEN DPG54-SEVERE-ERROR                                  04940030
                   DISPLAY '** ABEND **'                                04950030
                   DISPLAY '** PGM = DAKUT303'                          04960099
                   DISPLAY '** 2300-SUBRAACT-DAYS'                      04970099
                   DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE.'   04980030
                   DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE.'   04990030
                   DISPLAY '** ERROR MESSAGE = '                        05000030
                             DPG54-ERROR-MESSAGE                        05010030
                   DISPLAY '** DPG51 = ' DPG51                          05020030
                   DISPLAY '** DPG52 = ' DPG52                          05030030
                   DISPLAY '** DPG53 = ' DPG53                          05040030
                   DISPLAY '** DPG54 = ' DPG54                          05050030
                   MOVE +4003 TO PV-ABEND-CODE                          05060031
                   CALL 'ILBOABN0' USING PV-ABEND-CODE                  05070031
                WHEN OTHER                                              05080030
                   CONTINUE                                             05090030
           END-EVALUATE.                                                05100030
                                                                        05110030
           MOVE DPG55-DB2-ISO-DATE-FMT TO DA102-DUE-DTE.                05120099
                                                                        05130030
           DISPLAY 'DATE USED:  ' DA102-DUE-DTE.                        05140099
                                                                        05150030
       2300-SUBTRACT-DAYS-EXIT.                                         05160031
           EXIT.                                                        05170030
                                                                        05180099
      ******************************************************************05300099
      *  THIS PROCEDURE PROCESSES THE END OF JOB LOGIC.                 05310099
      ******************************************************************05320099
       9900-EOJ-LOGIC.                                                  05330014
           PERFORM 1300-CLOSE-TDAALW-CURSOR.                            05340014
                                                                        05350099
           CLOSE  OUT-DA-FILE.                                          05360014
                                                                        05380099
           DISPLAY 'ROWS FETCHED    ' PA-ROWS-FETCHED.                  05390014
           DISPLAY 'RECORDS WRITTEN ' PA-RECORDS-WRITTEN.               05400014
                                                                        05410014
      ******************************************************************05420099
      *   9999-ABEND.                                                   05430099
      *      ERROR ABEND ROUTINE                                        05440099
      ******************************************************************05450099
       9999-SQL-ERROR.                                                  05460000
                                                                        05470000
           MOVE SQLCODE    TO SQLCODE2.                                 05480000
           MOVE SQLERRD(3) TO SQLERRD3.                                 05490000
           DISPLAY '** ABEND **       ** = SQLERROR'.                   05500000
           DISPLAY '** PROGRAM        ** = DAKUT303'.                   05510099
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05520000
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05530000
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   05540000
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  05550000
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                05560000
                                                                        05570000
           MOVE SPACES TO WS-MSG-TEXT.                                  05580000
      *    GET FULL TEXT OF ERROR MESSAGE                               05590000
                                                                        05600000
           CALL 'SQLGLM' USING WS-MSG-TEXT,                             05610000
                               WS-MAX-SIZE,                             05620000
                               WS-MSG-LENGTH.                           05630000
           DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               05640000
                                                                        05650000
           MOVE +4013 TO PV-ABEND-CODE.                                 05660000
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05670000
                                                                        05680000
      *---------------------------------------------------------------* 05690014
      *    END OF SOURCE CODE FOR DAKUT303                            * 05700099
      *---------------------------------------------------------------* 05710014
