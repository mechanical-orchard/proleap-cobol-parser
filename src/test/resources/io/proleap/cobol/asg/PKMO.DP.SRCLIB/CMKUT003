000100******************************************************************00010010
000200 IDENTIFICATION DIVISION.                                         00020010
000300******************************************************************00030010
000400                                                                  00040010
000500 PROGRAM-ID.             CMKUT003.                                00050010
000600 AUTHOR.                 RICK TULLOCH.                            00060010
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070010
000800 DATE-WRITTEN.           06-25-02.                                00080010
000900 DATE-COMPILED.                                                   00090010
001000                                                                  00100010
001100******************************************************************00110010
001200*       THIS PROGRAM PROCESSES AN IEBPTPCH UNLOAD OF             *00120010
001210*  PKMO.CICS.LOADLIB TO DETERMINE WHETHER EACH ENTRY IS A CICS   *00121010
001220*  PROGRAM OR A BMS MAPSET.  THE PROGRAM WILL READ AHEAD TO THE  *00122010
001221*  FIRST IEBPTPCH HEADER TO DETERMINE THE MEMBER NAME.  NOTE:    *00122110
001230*  THE UNLOAD WILL NOT UNLOAD THE LOADLIB IN ASCENDING MEMBER    *00123010
001240*  NAME SEQUENCE.  EACH UNLOADED MEMBER WILL BE PROCESSED BY     *00124010
001250*  READING THE FIRST LOADLIB RECORD AND EXAMINING TWO OFFSETS    *00125010
001260*  FOR CHARACTERISTICS THAT WILL TOGETHER INDICATE THAT THE      *00126010
001270*  MEMBER IS AN ASSEMBLED BMS MAPSET.  ANY MEMBER THAT IS NOT    *00127010
001280*  DETERMINED TO BE A BMS MAPSET WILL BE CONSIDERED A CICS       *00128010
001290*  PROGRAM, EVEN IF IT IS A NON-CICS PROGRAM PLACED IN THE       *00129010
001291*  CICS LOADLIB SO IT WILL BE LOADED AT CICS STARTUP (SUCH       *00129110
001292*  AS A NON-CICS SUBROUTINE, POSSIBLY USED IN BOTH BATCH AND     *00129210
001293*  CICS PROGRAMS.  A CICS LOADLIB PROGRAM RECORD WILL BE WRITTEN *00129310
001294*  WITH THE MEMBER NAME AND DETERMINED TYPE, AND THE IEBPTPCH    *00129410
001295*  UNLOAD WILL BE READ TO THE NEXT HEADER OR END-OF-FILE.        *00129510
001300******************************************************************00130010
001400                                                                  00140010
001500******************************************************************00150010
001600 ENVIRONMENT DIVISION.                                            00160010
001700******************************************************************00170010
001800                                                                  00180010
001900 CONFIGURATION SECTION.                                           00190010
002000                                                                  00200010
002100 SOURCE-COMPUTER.        IBM-3090.                                00210010
002200 OBJECT-COMPUTER.        IBM-3090.                                00220010
002300                                                                  00230010
002400 INPUT-OUTPUT SECTION.                                            00240010
002500                                                                  00250010
002600 FILE-CONTROL.                                                    00260010
002700                                                                  00270010
002800     SELECT CICS-LOADLIB-FILE                                     00280010
002900         ASSIGN TO INP01.                                         00290010
003000                                                                  00300010
003100     SELECT CICS-PROGRAM-FILE                                     00310010
003200         ASSIGN TO OUT01.                                         00320010
003300                                                                  00330010
003400******************************************************************00340010
003500 DATA DIVISION.                                                   00350010
003600******************************************************************00360010
003700                                                                  00370010
003800 FILE SECTION.                                                    00380010
003900                                                                  00390010
004000 FD  CICS-LOADLIB-FILE                                            00400010
004100     RECORDING MODE IS F                                          00410010
004200     LABEL RECORDS ARE STANDARD                                   00420010
004300     BLOCK CONTAINS 0 RECORDS                                     00430010
004400     RECORD CONTAINS 81 CHARACTERS                                00440010
004500     DATA RECORDS IS CL-CICS-LOADLIB-RECORD.                      00450010
004600                                                                  00460010
004700 01  CL-CICS-LOADLIB-RECORD        PIC X(81).                     00470010
004800                                                                  00480010
004900 FD  CICS-PROGRAM-FILE                                            00490010
005000     RECORDING MODE IS F                                          00500010
005100     LABEL RECORDS ARE STANDARD                                   00510010
005200     BLOCK CONTAINS 0 RECORDS                                     00520010
005300     RECORD CONTAINS 12 CHARACTERS.                               00530010
005400                                                                  00540010
005500 01  CP-CICS-PROGRAM-RECORD.                                      00550010
005600     05  CP-PROGRAM-NAME         PIC X(8).                        00560010
005700     05  CP-PROGRAM-TYPE         PIC X(4).                        00570010
005800         88  CP-PT-CICS-PROGRAM               VALUE SPACES.       00580010
005900         88  CP-PT-BMS-MAPSET                 VALUE 'MAP '.       00590010
006000                                                                  00600010
006100 WORKING-STORAGE SECTION.                                         00610010
006200                                                                  00620010
006300 01  ABEND-CODE                  PIC S9(04)   VALUE ZERO          00630010
006400                                              COMP SYNC.          00640010
006500                                                                  00650010
006600 01  PS-PROGRAM-SWITCHES.                                         00660010
006700     05  PS-END-OF-LOADLIB-FILE-SW                                00670010
006800                                 PIC X(1)     VALUE 'N'.          00680010
006900         88  PS-END-OF-LOADLIB-FILE           VALUE 'Y'.          00690010
007000                                                                  00700010
007100 01  PC-PROGRAM-CONSTANTS.                                        00710010
007200     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'CMKUT003'.   00720010
007300     05  PC-HEX-10-COMP          PIC S9(4)    VALUE +16           00730010
007400                                              COMP SYNC.          00740010
007500     05  FILLER                  REDEFINES PC-HEX-10-COMP.        00750010
007600         10  FILLER              PIC X(1).                        00760010
007700         10  PC-HEX-10           PIC X(1).                        00770010
007800     05  PC-HEX-04-COMP          PIC S9(4)    VALUE +4            00780010
007900                                              COMP SYNC.          00790010
008000     05  FILLER                  REDEFINES PC-HEX-04-COMP.        00800010
008100         10  FILLER              PIC X(1).                        00810010
008200         10  PC-HEX-04           PIC X(1).                        00820010
008300                                                                  00830010
008400 01  PV-PROGRAM-VARIABLES.                                        00840010
008500     05  PV-CURRENT-MEMBER-NAME  PIC X(8)     VALUE SPACES.       00850010
008600                                                                  00860010
008700 01  IU-IEBPTPCH-UNLOAD-RECORD.                                   00870010
008800     05  FILLER                  PIC X(1)     VALUE SPACES.       00880010
008900     05  IU-UNLOAD-RECORD        PIC X(80)    VALUE SPACES.       00890010
009000     05  FILLER                  REDEFINES IU-UNLOAD-RECORD.      00900010
009100         10  FILLER              PIC X(11).                       00910010
009200             88  IU-MEMBER-NAME-ID            VALUE 'MEMBER NAME'.00920010
009300         10  FILLER              PIC X(2).                        00930010
009400         10  IU-MEMBER-NAME      PIC X(8).                        00940010
009500         10  FILLER              PIC X(59).                       00950010
009600     05  FILLER                  REDEFINES IU-UNLOAD-RECORD.      00960010
009700         10  FILLER              PIC X(7).                        00970010
009800         10  IU-MAPSET-IND-1     PIC X(1).                        00980010
009900         10  FILLER              PIC X(8).                        00990010
010000         10  IU-MAPSET-IND-2     PIC X(1).                        01000010
010100         10  FILLER              PIC X(63).                       01010010
010200                                                                  01020010
010300******************************************************************01030010
010400 PROCEDURE DIVISION.                                              01040010
010500******************************************************************01050010
010600                                                                  01060010
010700 0000-MAINLINE.                                                   01070010
010800                                                                  01080010
010900     PERFORM 1000-INITIALIZE.                                     01090010
011000                                                                  01100010
011100     PERFORM 2000-PROCESS-UNLOAD-MEMBER                           01110010
011200         UNTIL PS-END-OF-LOADLIB-FILE.                            01120010
011300                                                                  01130010
011400     PERFORM 9000-EOJ-ROUTINE.                                    01140010
011500                                                                  01150010
011600     GOBACK.                                                      01160010
011700                                                                  01170010
011800******************************************************************01180010
011900*  INITIALIZE FOR PROGRAM PROCESSING.  OPEN ALL FILES.  READ THE *01190010
012000*  IEBPTPCH UNLOAD FILE OF THE CICS LOADLIB UNTIL THE FIRST      *01200010
012100*  IEBPTPCH HEADER FOR THE FIRST UNLOADED MEMBER IS DETECTED.    *01210010
012200******************************************************************01220010
012300                                                                  01230010
012400 1000-INITIALIZE.                                                 01240010
012500     OPEN INPUT  CICS-LOADLIB-FILE                                01250010
012600          OUTPUT CICS-PROGRAM-FILE.                               01260010
012700                                                                  01270010
012800     PERFORM 7000-READ-CICS-LOADLIB-FILE                          01280010
012900         UNTIL ((PS-END-OF-LOADLIB-FILE)                          01290010
013000                 OR (IU-MEMBER-NAME-ID)).                         01300010
013100*1000-EXIT.                                                       01310010
013200                                                                  01320010
013300******************************************************************01330010
013400*  PROCESS AN UNLOADED CICS LOADLIB MEMBER.  RETAIN THE MEMBER   *01340010
013500*  NAME FROM THE IEBPTPCH HEADER.  READ THE FIRST UNLOADED CICS  *01350010
013600*  LOADLIB RECORD, AND EXAMINE THE RECORD FOR CHARACTERISTICS    *01360010
013700*  THAT INDICATE THAT THE LOADLIB IS FOR A BMS MAPSET.           *01370010
013710*                                                                *01371010
013800*      NOTE: THE DEFINITIONS OF THE EXACT OFFSETS AND VALUES     *01380010
013810*            WERE UNDEFINED IN THE ORIGINAL DYL-280 PROGRAM, AND *01381010
013811*            CANNOT BE ABSOLUTELY CONFIRMED IN CICS MANUALS.     *01381110
013812*            IT IS BELIEVED THAT THE HIGH ORDER NIBBLE IN AT THE *01381210
013813*            FIRST OFFSET IS THE MAP TYPE IN THE DFHMSD MACRO,   *01381310
013814*            AND THE BIT POSITION TURNED ON AT THE SECORD OFFSET *01381410
013815*            IS REFLECTING THE LANGUAGE TYPE.  BOTH ARE          *01381510
013816*            NECESSARY TO PREVENT FALSELY IDENTIFYING A CICS     *01381610
013817*            PROGRAM AS A BMS MAPSET.                            *01381710
013820*                                                                *01382010
013900*  ANYTHING NOT DETERMINED TO BE A BMS MAPSET WILL BE CONSIDERED *01390010
013901*  A CICS PROGRAM, EVEN IF IT IS A NON-CICS PROGRAM PLACED IN    *01390110
013902*  THE CICS LOADLIB SO IT WILL BE LOADED AT CICS STARTUP (SUCH   *01390210
013903*  AS A NON-CICS SUBROUTINE, POSSIBLY USED IN BOTH BATCH AND     *01390310
013904*  CICS PROGRAMS.  WRITE A CICS LOADLIB PROGRAM RECORD WITH THE  *01390410
013910*  INFORMATION ABOUT THIS MEMBER.  READ AHEAD TO THE NEXT        *01391010
014000*  IEBPTPCH HEADER.                                              *01400010
014100******************************************************************01410010
014200                                                                  01420010
014300 2000-PROCESS-UNLOAD-MEMBER.                                      01430010
014400     MOVE IU-MEMBER-NAME TO CP-PROGRAM-NAME.                      01440010
014500                                                                  01450010
014600     PERFORM 7000-READ-CICS-LOADLIB-FILE.                         01460010
014700                                                                  01470010
014800     IF ((IU-MAPSET-IND-1 = PC-HEX-10)                            01480010
014900             AND (IU-MAPSET-IND-2 = PC-HEX-04))                   01490010
015000         SET CP-PT-BMS-MAPSET TO TRUE                             01500010
015100     ELSE                                                         01510010
015200         SET CP-PT-CICS-PROGRAM TO TRUE                           01520010
015300     END-IF.                                                      01530010
015400                                                                  01540010
015500     PERFORM 8000-WRITE-CICS-PROGRAM-RECORD.                      01550010
015600                                                                  01560010
015700     PERFORM 7000-READ-CICS-LOADLIB-FILE                          01570010
015800         UNTIL ((PS-END-OF-LOADLIB-FILE)                          01580010
015900                 OR (IU-MEMBER-NAME-ID)).                         01590010
016000*2000-EXIT.                                                       01600010
016100                                                                  01610010
016200******************************************************************01620010
016300*  READ A RECORD FROM THE IEBPTPCH UNLOAD OF THE CICS LOADLIB.   *01630010
016400******************************************************************01640010
016500                                                                  01650010
016600 7000-READ-CICS-LOADLIB-FILE.                                     01660010
016700     READ CICS-LOADLIB-FILE                                       01670010
016800         INTO IU-IEBPTPCH-UNLOAD-RECORD                           01680010
016900         AT END                                                   01690010
017000             SET PS-END-OF-LOADLIB-FILE TO TRUE                   01700010
017100     END-READ.                                                    01710010
017200*7000-EXIT.                                                       01720010
017300                                                                  01730010
017400******************************************************************01740010
017500*  WRITE A CICS PROGRAM DEFINITION RECORD.                       *01750010
017600******************************************************************01760010
017700                                                                  01770010
017800 8000-WRITE-CICS-PROGRAM-RECORD.                                  01780010
017900     WRITE CP-CICS-PROGRAM-RECORD.                                01790010
018000*8000-EXIT.                                                       01800010
018100                                                                  01810010
018200******************************************************************01820010
018300*  CLOSE ALL FILES.                                              *01830010
018400******************************************************************01840010
018500                                                                  01850010
018600 9000-EOJ-ROUTINE.                                                01860010
018700     CLOSE CICS-LOADLIB-FILE                                      01870010
018800           CICS-PROGRAM-FILE.                                     01880010
018900*9000-EXIT.                                                       01890010
