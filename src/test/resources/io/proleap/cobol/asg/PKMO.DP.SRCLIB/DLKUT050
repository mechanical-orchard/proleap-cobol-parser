000200 IDENTIFICATION DIVISION.                                         00020000
000400 PROGRAM-ID.    DLKUT050.                                         00040001
000500 AUTHOR.        AYAN SARKAR.                                      00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060002
000700 DATE-WRITTEN.  JUNE 2016.                                        00070050
000800 DATE-COMPILED.                                                   00080000
000810*                                                                 00081002
000900***************************************************************** 00090000
001000* THIS PROGRAM CREATES AN EXTRACT FILE OF LABOR EVENTS FOR A DAY. 00100002
001100* OUTPUT FILE GENERATED FROM THIS PROGRAM IS USED AS INPUT FOR    00110027
001200* CREATING REPORTS.                                               00120002
001300***************************************************************** 00130002
001500*                                                                 00150002
001700 ENVIRONMENT DIVISION.                                            00170000
001800*                                                                 00180002
001900 INPUT-OUTPUT SECTION.                                            00190000
002000                                                                  00200000
002100 FILE-CONTROL.                                                    00210000
002200     SELECT DAILY-LABOR-EVENTS  ASSIGN TO OUT01.                  00220002
003000*                                                                 00300002
003100 DATA DIVISION.                                                   00310002
003400 FILE SECTION.                                                    00340000
003500*                                                                 00350000
003600 FD  DAILY-LABOR-EVENTS                                           00360002
003700     RECORDING MODE IS F                                          00370000
003800     LABEL RECORDS ARE STANDARD                                   00380000
003900     BLOCK CONTAINS 0 RECORDS.                                    00390000
004000 01  DAILY-LABOR-EVENTS-RECORDS        PIC X(150).                00400045
004100*                                                                 00410000
006300***************************************************************** 00630000
006400 WORKING-STORAGE SECTION.                                         00640000
006410***************************************************************** 00641002
006500*                                                                 00650002
006600 01  PS-PROGRAM-SWITCHES.                                         00660000
006700     05  PS-EO-LBR-EVNT-CSR-SW        PIC X(01)  VALUE 'N'.       00670002
006800         88  PS-EO-LBR-EVNT-CSR1                 VALUE 'Y'.       00680002
006900         88  PS-NOT-EO-LBR-EVNT-CSR1             VALUE 'N'.       00690002
006910     05  PS-EO-LBR-EVNT-CSR-SW        PIC X(01)  VALUE 'N'.       00691002
006920         88  PS-EO-LBR-EVNT-CSR2                 VALUE 'Y'.       00692002
006930         88  PS-NOT-EO-LBR-EVNT-CSR2             VALUE 'N'.       00693002
006931     05  PS-SKIP-THIS-REC-SW          PIC X(01)  VALUE 'N'.       00693124
006932         88  PS-SKIP-THIS-REC-YES                VALUE 'Y'.       00693224
006933         88  PS-SKIP-THIS-REC-NO                 VALUE 'N'.       00693324
006940     05  PS-VALID-EVNT-OBJ-ACTN-TXT   PIC X(18)  VALUE SPACE.     00694021
006950         88  PS-VALID-EVNT-OBJ-ACTN-YES                           00695017
006960                                     VALUE  'DOOR SUMMARY      '  00696017
006970                                            'PALLET MANUAL SCAN' ,00697017
006980                                            'CARTON MANUAL SCAN' ,00698017
006990                                            'TRAILER OPEN      ' ,00699017
007000                                            'TRAILER CLOSE     ' .00700017
007100         88  PS-EVNT-OBJ-ACTN-DOOR   VALUE  'DOOR SUMMARY      '. 00710017
007900*                                                                 00790000
008000 01  PV-PROGRAM-VARIABLES.                                        00800000
008100*                                                                 00810002
008200     05  PV-PREV-PRC-DTE              PIC  X(10) VALUE SPACES.    00820047
008201     05  PV-LBR-EVNT-DT               PIC  X(10) VALUE SPACES.    00820147
008210     05  PV-LBR-EVNT-HR               PIC S9(04) COMP             00821044
008220                                                 VALUE ZEROES.    00822044
008300     05  PV-LBR-EVNT-CNT              PIC S9(04) COMP             00830020
008310                                                 VALUE ZEROES.    00831002
008320     05  PV-RECS-EXTRACTED            PIC  9(09) VALUE ZEROES.    00832007
008340     05  PV-RECS-WRITTEN              PIC  9(09) VALUE ZEROES.    00834007
008400     05  PV-PREV-USER-ID              PIC  X(08) VALUE SPACES.    00840002
008600     05  PV-USR-FRST-NM-NULLIND       PIC S9(04) COMP.            00860012
008700     05  PV-EVNT-KY-1-TXT-NULLIND     PIC S9(04) COMP.            00870012
008800     05  PV-DETAIL-TEXT.                                          00880023
008900         10  PV-ASGMT-STRT-DTE        PIC  X(10) VALUE SPACES.    00890023
009500         10  PV-ASGMT-NBR-TXT         PIC  X(10) VALUE SPACES.    00950023
009600         10  PV-ASGMT-NBR-SEQ-NBR     PIC  9(09) VALUE ZEROES.    00960023
015300*                                                                 01530002
015310 01  PC-PROGRAM-CONTANTS.                                         01531007
015311     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'DLKUT050'.01531113
015312     05  PC-TK                        PIC  X(02) VALUE 'TK'.      01531207
015313     05  PC-TP                        PIC  X(02) VALUE 'TP'.      01531307
015320*                                                                 01532007
015400 01  PV-ABEND-FIELDS.                                             01540000
015600     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         01560000
015700                                                 COMP SYNC.       01570000
015800     05  PV-SQLCODE                   PIC  Z(08)9-.               01580000
015900     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01590000
016000     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01600000
016300     05  PV-DB2-OPERATION-MESSAGE     PIC  X(40) VALUE SPACES.    01630015
016600     05  PV-DB2-TABLE-NAME            PIC  X(20) VALUE SPACE.     01660015
016700*                                                                 01670002
016800 01  DK-DB-KEYS.                                                  01680000
016900     05 DK-OPER-UNT-ID                PIC S9(04) COMP.            01690000
016910     05 DK-ASGMT-STRT-DTE             PIC  X(10) VALUE SPACES.    01691024
016920     05 DK-ASGMT-NBR-TXT              PIC  X(10) VALUE SPACES.    01692024
016930     05 DK-ASGMT-NBR-SEQ-NBR          PIC S9(09) COMP.            01693024
017000*                                                                 01700002
017010******************************************************************01701002
017100*  USED FOR DB2 ERROR MESSAGE BUILDING                            01710000
017200******************************************************************01720000
017300     COPY DPWS004.                                                01730000
017900*                                                                 01790002
018500******************************************************************01850000
018600*    PARM TABLE                                                   01860002
018700******************************************************************01870000
018800     EXEC SQL                                                     01880000
018900          INCLUDE TKRPRPM                                         01890000
019000     END-EXEC.                                                    01900000
019010******************************************************************01901005
019020*    CONTROL TABLE                                                01902005
019030******************************************************************01903005
019040     EXEC SQL                                                     01904005
019050          INCLUDE TCOCNTL                                         01905005
019060     END-EXEC.                                                    01906005
019100******************************************************************01910000
019200*  COBOL DECLARATIONS FOR DLT_TEM_ASGMT                           01920002
019300******************************************************************01930000
019400     EXEC SQL                                                     01940000
019500          INCLUDE DLT00003                                        01950002
019600     END-EXEC.                                                    01960000
019700******************************************************************01970000
019800*  COBOL DECLARATIONS FOR DLT_ASGMT                               01980002
019900******************************************************************01990000
020000     EXEC SQL                                                     02000000
020100          INCLUDE DLT00004                                        02010002
020200     END-EXEC.                                                    02020000
020300******************************************************************02030000
020400*  COBOL DECLARATIONS FOR DLT_TMP_EMP                             02040002
020500******************************************************************02050000
020600     EXEC SQL                                                     02060000
020700          INCLUDE DLT00002                                        02070002
020800     END-EXEC.                                                    02080000
020810******************************************************************02081002
020820*  COBOL DECLARATIONS FOR PCT_BUS_EVNT_EXPRT                      02082002
020830******************************************************************02083002
020840     EXEC SQL                                                     02084002
020850          INCLUDE PCT00011                                        02085002
020860     END-EXEC.                                                    02086002
020861******************************************************************02086124
020862*  COBOL DECLARATIONS FOR PCT_BUS_EVNT_DTL                        02086224
020863******************************************************************02086324
020864     EXEC SQL                                                     02086424
020865          INCLUDE PCT00012                                        02086524
020866     END-EXEC.                                                    02086624
020870******************************************************************02087002
020880*  COBOL DECLARATIONS FOR SUT_BUS_EVNT_EXPRT                      02088002
020890******************************************************************02089002
020891     EXEC SQL                                                     02089102
020892          INCLUDE SUT00037                                        02089202
020893     END-EXEC.                                                    02089302
020894******************************************************************02089402
020895*  COBOL DECLARATIONS FOR XLT_USR                                 02089502
020896******************************************************************02089602
020897     EXEC SQL                                                     02089702
020898          INCLUDE XLT00024                                        02089802
020899     END-EXEC.                                                    02089902
021000*                                                                 02100000
021010******************************************************************02101002
021100     EXEC SQL                                                     02110000
021200          INCLUDE SQLCA                                           02120000
021300     END-EXEC.                                                    02130000
021400*                                                                 02140003
021410******************************************************************02141003
021420*  FIRST LABOR EVENT CURSOR                                      *02142003
021430******************************************************************02143003
021440     EXEC SQL                                                     02144003
021500        DECLARE LBR-EVNT-CSR1 CURSOR WITH HOLD FOR                02150003
021510          SELECT CRE_BY_USR_ID                                    02151003
021520                ,DATE(CRE_TMST)                                   02152003
021530                ,HOUR(CRE_TMST)                                   02153003
021540                ,EVNT_OBJ_TXT                                     02154003
021550                ,EVNT_OBJ_ACTN_TXT                                02155003
021560                ,COUNT(*)                                         02156003
021570            FROM PCT_BUS_EVNT_EXPRT                               02157003
021571           WHERE DATE(CRE_TMST)             = :COCNTL-BTCH-PRC-DTE02157119
021572             AND (   CRE_BY_USR_ID LIKE 'TK%'                     02157203
021573                  OR CRE_BY_USR_ID LIKE 'TP%'                     02157303
021574                 )                                                02157403
021575             AND NOT (    EVNT_OBJ_TXT      = 'DC LABOR'          02157519
021576                      AND EVNT_OBJ_ACTN_TXT = 'INDIRECT LABOR'    02157619
021577                     )                                            02157719
021578             AND NOT EVNT_OBJ_ACTN_TXT      = 'NON UCC PRINT'     02157819
021579            GROUP BY CRE_BY_USR_ID                                02157903
021580                    ,DATE(CRE_TMST)                               02158003
021581                    ,HOUR(CRE_TMST)                               02158103
021582                    ,EVNT_OBJ_TXT                                 02158203
021583                    ,EVNT_OBJ_ACTN_TXT                            02158303
021590          UNION                                                   02159019
021591          SELECT CRE_BY_USR_ID                                    02159119
021592                ,DATE(CRE_TMST)                                   02159219
021593                ,HOUR(CRE_TMST)                                   02159319
021594                ,EVNT_OBJ_TXT                                     02159419
021595                ,EVNT_OBJ_ACTN_TXT                                02159519
021596                ,COUNT(*)                                         02159619
021597            FROM SUT_BUS_EVNT_EXPRT                               02159719
021598           WHERE DATE(CRE_TMST)             = :COCNTL-BTCH-PRC-DTE02159819
021599             AND (   CRE_BY_USR_ID LIKE 'TK%'                     02159919
021600                  OR CRE_BY_USR_ID LIKE 'TP%'                     02160019
021601                 )                                                02160119
021602             AND NOT (    EVNT_OBJ_TXT      = 'DC LABOR'          02160219
021603                      AND EVNT_OBJ_ACTN_TXT = 'INDIRECT LABOR'    02160319
021604                     )                                            02160419
021605             AND NOT EVNT_OBJ_ACTN_TXT = 'NON UCC PRINT'          02160519
021606            GROUP BY CRE_BY_USR_ID                                02160619
021607                    ,DATE(CRE_TMST)                               02160719
021608                    ,HOUR(CRE_TMST)                               02160819
021609                    ,EVNT_OBJ_TXT                                 02160919
021610                    ,EVNT_OBJ_ACTN_TXT                            02161019
021611            ORDER BY 1, 2, 3, 4, 5                                02161119
021612          WITH UR                                                 02161219
021613     END-EXEC.                                                    02161303
021614*                                                                 02161403
021615******************************************************************02161504
021616*  SECOND LABOR EVENT CURSOR                                     *02161605
021617******************************************************************02161704
021618     EXEC SQL                                                     02161804
021619        DECLARE LBR-EVNT-CSR2 CURSOR WITH HOLD FOR                02161905
021620           SELECT CRE_BY_USR_ID                                   02162005
021621                 ,DATE(CRE_TMST)                                  02162105
021622                 ,HOUR(CRE_TMST)                                  02162205
021623                 ,EVNT_OBJ_TXT                                    02162305
021624                 ,EVNT_OBJ_ACTN_TXT                               02162405
021625                 ,EVNT_KY_1_TXT                                   02162505
021626                 ,COUNT(*)                                        02162605
021627             FROM PCT_BUS_EVNT_EXPRT                              02162705
021628            WHERE DATE(CRE_TMST)          = :COCNTL-BTCH-PRC-DTE  02162819
021629              AND (   CRE_BY_USR_ID LIKE 'TK%'                    02162919
021630                   OR CRE_BY_USR_ID LIKE 'TP%'                    02163019
021631                  )                                               02163119
021632              AND (    EVNT_OBJ_TXT      = 'DC LABOR'             02163219
021633                   AND EVNT_OBJ_ACTN_TXT = 'INDIRECT LABOR'       02163319
021634                  )                                               02163419
021635            GROUP BY CRE_BY_USR_ID                                02163519
021636                 ,DATE(CRE_TMST)                                  02163619
021637                 ,HOUR(CRE_TMST)                                  02163719
021638                 ,EVNT_OBJ_TXT                                    02163819
021639                 ,EVNT_OBJ_ACTN_TXT                               02163919
021640                 ,EVNT_KY_1_TXT                                   02164019
021641           UNION                                                  02164119
021642           SELECT CRE_BY_USR_ID                                   02164219
021643                 ,DATE(CRE_TMST)                                  02164319
021644                 ,HOUR(CRE_TMST)                                  02164419
021645                 ,EVNT_OBJ_TXT                                    02164519
021646                 ,EVNT_OBJ_ACTN_TXT                               02164619
021647                 ,EVNT_KY_1_TXT                                   02164719
021648                 ,COUNT(*)                                        02164819
021649             FROM SUT_BUS_EVNT_EXPRT                              02164919
021650            WHERE DATE(CRE_TMST)         = :COCNTL-BTCH-PRC-DTE   02165019
021651              AND (   CRE_BY_USR_ID LIKE 'TK%'                    02165119
021652                   OR CRE_BY_USR_ID LIKE 'TP%'                    02165219
021653                  )                                               02165319
021654              AND (    EVNT_OBJ_TXT      = 'DC LABOR'             02165419
021655                   AND EVNT_OBJ_ACTN_TXT = 'INDIRECT LABOR'       02165519
021656                  )                                               02165619
021657            GROUP BY CRE_BY_USR_ID                                02165719
021658                    ,DATE(CRE_TMST)                               02165819
021659                    ,HOUR(CRE_TMST)                               02165919
021660                    ,EVNT_OBJ_TXT                                 02166019
021661                    ,EVNT_OBJ_ACTN_TXT                            02166119
021662                    ,EVNT_KY_1_TXT                                02166219
021663             ORDER BY 1, 2, 3, 4, 5, 6                            02166305
021664            WITH UR                                               02166405
021665     END-EXEC.                                                    02166505
021666*                                                                 02166605
021667******************************************************************02166705
021670* COPYBOOK LAYOUT FOR OUPUT FILE                                  02167003
021700******************************************************************02170003
021710     COPY DLRD020.                                                02171003
021720*                                                                 02172003
021721******************************************************************02172137
021722* COPYBOOK FOR CALLING XLKUT067 MODULE                            02172237
021723******************************************************************02172337
021724     COPY XLWS067.                                                02172437
021725*                                                                 02172537
021730******************************************************************02173003
021800 PROCEDURE DIVISION.                                              02180000
021900***********************************************************       02190000
022000 0000-PROGRAM-MAINLINE.                                           02200000
022100*                                                                 02210000
022200     PERFORM 1000-INITIALIZATION.                                 02220000
022300                                                                  02230008
022400     PERFORM 2000-OPEN-LBR-EVNT-CSR1.                             02240003
022500     PERFORM 2100-FETCH-LBR-EVNT-CSR1                             02250003
022600       UNTIL PS-EO-LBR-EVNT-CSR1.                                 02260003
022700     PERFORM 2200-CLOSE-LBR-EVNT-CSR1.                            02270003
022800                                                                  02280008
022810     PERFORM 3000-OPEN-LBR-EVNT-CSR2.                             02281006
022820     PERFORM 3100-FETCH-LBR-EVNT-CSR2                             02282006
022830       UNTIL PS-EO-LBR-EVNT-CSR2.                                 02283003
022840     PERFORM 3200-CLOSE-LBR-EVNT-CSR2.                            02284006
023200                                                                  02320008
023300     PERFORM 9000-EOJ-ROUTINE.                                    02330000
023400                                                                  02340008
023500     STOP RUN.                                                    02350013
023600*                                                                 02360000
023900******************************************************************02390000
024000 1000-INITIALIZATION.                                             02400000
024010******************************************************************02401008
024100*                                                                 02410000
024400     OPEN OUTPUT DAILY-LABOR-EVENTS.                              02440003
024500                                                                  02450005
024600     PERFORM 1100-GET-PROCSNG-DATE                                02460005
024610                                                                  02461005
024700     SET PS-NOT-EO-LBR-EVNT-CSR1   TO TRUE.                       02470013
024710     SET PS-NOT-EO-LBR-EVNT-CSR2   TO TRUE.                       02471013
024720                                                                  02472005
024800     MOVE SPACE                    TO PV-PREV-USER-ID.            02480007
026200*                                                                 02620000
026300***************************************************************** 02630000
026400 1100-GET-PROCSNG-DATE.                                           02640005
026500***************************************************************** 02650000
026501*                                                                 02650107
026502     EXEC SQL                                                     02650207
026503         SELECT BTCH_PRC_DTE                                      02650307
026504               ,BTCH_PRC_DTE - 1 DAY                              02650447
026505           INTO :COCNTL-BTCH-PRC-DTE                              02650547
026506               ,:PV-PREV-PRC-DTE                                  02650647
026507           FROM TCOCNTL                                           02650747
026508          WHERE OPER_UNT_ID = 90                                  02650847
026509         WITH UR                                                  02650947
026510     END-EXEC.                                                    02651047
026511                                                                  02651147
026512     EVALUATE TRUE                                                02651247
026513        WHEN SQLCODE = 0                                          02651347
026514           CONTINUE                                               02651447
026515        WHEN SQLWARN0 NOT = SPACES                                02651547
026516        WHEN SQLCODE < ZERO                                       02651647
026517        WHEN SQLCODE > ZERO                                       02651747
026518           MOVE '1100-GET-PROCSNG-DATE'                           02651847
026519                                   TO PV-ABEND-PARAGRAPH          02651947
026520           MOVE 'TCOCNTL '         TO PV-DB2-TABLE-NAME           02652047
026521           MOVE 'SELECT TCOCNTL'   TO PV-DB2-OPERATION-MESSAGE    02652147
026522           MOVE SQLCODE            TO PV-SQLCODE                  02652247
026523     END-EVALUATE.                                                02652347
026524*                                                                 02652447
026525***************************************************************** 02652547
026526 2000-OPEN-LBR-EVNT-CSR1.                                         02652647
026530***************************************************************** 02653005
026600*                                                                 02660000
026700     EXEC SQL                                                     02670006
026800          OPEN LBR-EVNT-CSR1                                      02680006
026900     END-EXEC.                                                    02690006
027000                                                                  02700006
027100     EVALUATE TRUE                                                02710006
027200        WHEN SQLCODE = 0                                          02720007
027300           CONTINUE                                               02730007
027400        WHEN SQLWARN0 NOT = SPACES                                02740007
027500        WHEN SQLCODE < ZERO                                       02750007
027600        WHEN SQLCODE > ZERO                                       02760007
027700           MOVE '2100-OPEN-LBR-EVNT-CSR1'                         02770007
027800                                   TO PV-ABEND-PARAGRAPH          02780006
027900           MOVE 'OPEN LBR-EVNT-CSR1'                              02790007
028000                                   TO PV-DB2-OPERATION-MESSAGE    02800015
028010           MOVE SQLCODE            TO PV-SQLCODE                  02801007
028100           PERFORM 9999-SQL-ABEND                                 02810007
028200     END-EVALUATE.                                                02820006
030500*                                                                 03050005
030600******************************************************************03060000
030700 2100-FETCH-LBR-EVNT-CSR1.                                        03070006
030710******************************************************************03071006
030720*                                                                 03072006
030900     EXEC SQL                                                     03090006
031000         FETCH LBR-EVNT-CSR1                                      03100007
031100          INTO :PCT00011-CRE-BY-USR-ID                            03110007
031200              ,:PV-LBR-EVNT-DT                                    03120007
031300              ,:PV-LBR-EVNT-HR                                    03130007
031310              ,:PCT00011-EVNT-OBJ-TXT                             03131007
031320              ,:PCT00011-EVNT-OBJ-ACTN-TXT                        03132007
031330              ,:PV-LBR-EVNT-CNT                                   03133007
031400     END-EXEC.                                                    03140006
031500                                                                  03150006
031600     EVALUATE TRUE                                                03160006
031700        WHEN SQLCODE = ZERO                                       03170006
031710           IF PCT00011-EVNT-OBJ-TXT = 'SHIPPING'                  03171017
031720              MOVE PCT00011-EVNT-OBJ-ACTN-TXT                     03172017
031730                                   TO PS-VALID-EVNT-OBJ-ACTN-TXT  03173017
031740               IF PS-VALID-EVNT-OBJ-ACTN-YES                      03174017
031741                  SET PS-SKIP-THIS-REC-NO  TO TRUE                03174124
031750                  IF PS-EVNT-OBJ-ACTN-DOOR                        03175017
031751                     PERFORM 5500-GET-OTHER-DOORSUM-INFO          03175128
031752                                                                  03175224
031753                     MOVE PCT00012-DTL-TXT-TEXT TO PV-DETAIL-TEXT 03175328
031755                     MOVE PV-ASGMT-STRT-DTE   TO DK-ASGMT-STRT-DTE03175524
031757                     MOVE PV-ASGMT-NBR-TXT    TO DK-ASGMT-NBR-TXT 03175724
031758                     MOVE PV-ASGMT-NBR-SEQ-NBR                    03175824
031759                                           TO DK-ASGMT-NBR-SEQ-NBR03175924
031760                                                                  03176024
031770                     PERFORM 6000-CHECK-DOOR-SUMMARY              03177017
031771                  ELSE                                            03177146
031780                     MOVE PCT00011-CRE-BY-USR-ID TO DL020-USER-ID 03178046
031790                     SET PS-SKIP-THIS-REC-NO     TO TRUE          03179046
031920                  END-IF                                          03192017
031925               ELSE                                               03192524
031927                  SET PS-SKIP-THIS-REC-YES       TO TRUE          03192746
031930               END-IF                                             03193017
031940           ELSE                                                   03194024
031941              MOVE PCT00011-CRE-BY-USR-ID   TO DL020-USER-ID      03194126
031942              SET PS-SKIP-THIS-REC-NO       TO TRUE               03194226
031945           END-IF                                                 03194517
031946           IF PS-SKIP-THIS-REC-NO                                 03194624
031947              MOVE PCT00011-EVNT-OBJ-TXT                          03194724
031948                                   TO DL020-EVENT-TEXT            03194824
031949              MOVE PCT00011-EVNT-OBJ-ACTN-TXT                     03194924
031950                                   TO DL020-EVENT-ACTION-TEXT     03195024
032000              PERFORM 4000-USER-DETAILS                           03200024
032010           END-IF                                                 03201024
032020           ADD +1                  TO PV-RECS-EXTRACTED           03202033
032100        WHEN SQLCODE = +100                                       03210006
032200           SET PS-EO-LBR-EVNT-CSR1 TO TRUE                        03220007
032300        WHEN SQLWARN0 NOT = SPACES                                03230006
032400        WHEN SQLCODE < ZERO                                       03240006
032500        WHEN SQLCODE > ZERO                                       03250006
032600           MOVE '2100-FETCH-LBR-EVNT-CSR1'                        03260007
032700                                   TO PV-ABEND-PARAGRAPH          03270007
032800           MOVE 'FETCH LBR-EVNT-CSR1'                             03280007
032810                                   TO PV-DB2-OPERATION-MESSAGE    03281015
032820           MOVE SQLCODE            TO PV-SQLCODE                  03282007
032830           PERFORM 9999-SQL-ABEND                                 03283007
033000     END-EVALUATE.                                                03300006
052600*                                                                 05260007
052601***************************************************************** 05260107
052602 2200-CLOSE-LBR-EVNT-CSR1.                                        05260207
052603***************************************************************** 05260307
052604*                                                                 05260407
052605     EXEC SQL                                                     05260507
052606         CLOSE LBR-EVNT-CSR1                                      05260607
052607     END-EXEC.                                                    05260707
052608                                                                  05260807
052609     EVALUATE TRUE                                                05260907
052610        WHEN SQLCODE = 0                                          05261007
052611           CONTINUE                                               05261107
052612        WHEN SQLWARN0 NOT = SPACES                                05261207
052613        WHEN SQLCODE < ZERO                                       05261307
052614        WHEN SQLCODE > ZERO                                       05261407
052615           MOVE '2200-CLOSE-LBR-EVNT-CSR1'                        05261507
052616                                   TO PV-ABEND-PARAGRAPH          05261607
052617           MOVE 'CLOSE LBR-EVNT-CSR1'                             05261707
052618                                   TO PV-DB2-OPERATION-MESSAGE    05261815
052619           MOVE SQLCODE            TO PV-SQLCODE                  05261907
052620           PERFORM 9999-SQL-ABEND                                 05262007
052621     END-EVALUATE.                                                05262107
052622*                                                                 05262207
052623***************************************************************** 05262307
052624 3000-OPEN-LBR-EVNT-CSR2.                                         05262407
052625***************************************************************** 05262507
052626*                                                                 05262607
052627     EXEC SQL                                                     05262707
052628         OPEN LBR-EVNT-CSR2                                       05262807
052629     END-EXEC.                                                    05262907
052630                                                                  05263007
052631     EVALUATE TRUE                                                05263107
052632        WHEN SQLCODE = 0                                          05263207
052633           CONTINUE                                               05263307
052634        WHEN SQLWARN0 NOT = SPACES                                05263407
052635        WHEN SQLCODE < ZERO                                       05263507
052636        WHEN SQLCODE > ZERO                                       05263607
052637           MOVE '2100-OPEN-LBR-EVNT-CSR2'                         05263707
052638                                   TO PV-ABEND-PARAGRAPH          05263807
052639           MOVE 'OPEN LBR-EVNT-CSR2'                              05263907
052640                                   TO PV-DB2-OPERATION-MESSAGE    05264015
052641           MOVE SQLCODE            TO PV-SQLCODE                  05264107
052642           PERFORM 9999-SQL-ABEND                                 05264207
052643     END-EVALUATE.                                                05264307
052644*                                                                 05264407
052645******************************************************************05264507
052646 3100-FETCH-LBR-EVNT-CSR2.                                        05264608
052647******************************************************************05264707
052648*                                                                 05264807
052650     EXEC SQL                                                     05265007
052651         FETCH LBR-EVNT-CSR2                                      05265107
052652          INTO :PCT00011-CRE-BY-USR-ID                            05265207
052653              ,:PV-LBR-EVNT-DT                                    05265307
052654              ,:PV-LBR-EVNT-HR                                    05265407
052655              ,:PCT00011-EVNT-OBJ-TXT                             05265507
052656              ,:PCT00011-EVNT-OBJ-ACTN-TXT                        05265607
052657              ,:PCT00011-EVNT-KY-1-TXT :PV-EVNT-KY-1-TXT-NULLIND  05265708
052658              ,:PV-LBR-EVNT-CNT                                   05265808
052659     END-EXEC.                                                    05265908
052660                                                                  05266008
052661     EVALUATE TRUE                                                05266108
052662        WHEN SQLCODE = ZERO                                       05266208
052663           MOVE PCT00011-CRE-BY-USR-ID                            05266334
052664                                   TO DL020-USER-ID               05266434
052665           MOVE PCT00011-EVNT-OBJ-ACTN-TXT                        05266510
052666                                   TO DL020-EVENT-TEXT            05266610
052667           MOVE PCT00011-EVNT-KY-1-TXT                            05266710
052668                                   TO DL020-EVENT-ACTION-TEXT     05266810
052669           PERFORM 4000-USER-DETAILS                              05266908
052670           ADD +1                  TO PV-RECS-EXTRACTED           05267033
052671        WHEN SQLCODE = +100                                       05267108
052672           SET PS-EO-LBR-EVNT-CSR2 TO TRUE                        05267208
052673        WHEN SQLWARN0 NOT = SPACES                                05267308
052674        WHEN SQLCODE < ZERO                                       05267408
052675        WHEN SQLCODE > ZERO                                       05267508
052676           MOVE '2100-FETCH-LBR-EVNT-CSR2'                        05267608
052677                                   TO PV-ABEND-PARAGRAPH          05267708
052678           MOVE 'FETCH LBR-EVNT-CSR2'                             05267808
052679                                   TO PV-DB2-OPERATION-MESSAGE    05267915
052680           MOVE SQLCODE            TO PV-SQLCODE                  05268008
052681           PERFORM 9999-SQL-ABEND                                 05268108
052682     END-EVALUATE.                                                05268208
052683*                                                                 05268308
052684***************************************************************** 05268408
052685 3200-CLOSE-LBR-EVNT-CSR2.                                        05268508
052686***************************************************************** 05268608
052687*                                                                 05268708
052688     EXEC SQL                                                     05268808
052689         CLOSE LBR-EVNT-CSR2                                      05268908
052690     END-EXEC.                                                    05269008
052691                                                                  05269108
052692     EVALUATE TRUE                                                05269208
052693        WHEN SQLCODE = 0                                          05269308
052694           CONTINUE                                               05269408
052695        WHEN SQLWARN0 NOT = SPACES                                05269508
052696        WHEN SQLCODE < ZERO                                       05269608
052697        WHEN SQLCODE > ZERO                                       05269708
052698           MOVE '2200-CLOSE-LBR-EVNT-CSR2'                        05269808
052699                                   TO PV-ABEND-PARAGRAPH          05269908
052700           MOVE 'CLOSE LBR-EVNT-CSR2'                             05270008
052701                                   TO PV-DB2-OPERATION-MESSAGE    05270115
052702           MOVE SQLCODE            TO PV-SQLCODE                  05270208
052703           PERFORM 9999-SQL-ABEND                                 05270308
052704     END-EVALUATE.                                                05270408
052705*                                                                 05270508
052706***************************************************************** 05270608
052710 4000-USER-DETAILS.                                               05271007
052800***************************************************************** 05280000
052900*                                                                 05290000
052901     IF PCT00011-CRE-BY-USR-ID(1:2) = PC-TK THEN                  05290107
052902        PERFORM 4100-GET-USER-LOCATION                            05290207
052903        PERFORM 4200-GET-USER-NAME                                05290307
052904        PERFORM 5000-WRITE-LABOR-EVENT-DETAILS                    05290408
052905     END-IF.                                                      05290507
052906                                                                  05290607
052907     IF PCT00011-CRE-BY-USR-ID(1:2) = PC-TP THEN                  05290707
052908        PERFORM 4300-GET-USER-LOCATION                            05290807
052909        PERFORM 4400-CHECK-PARM-TABLE-FOR-USER                    05290908
052910     END-IF.                                                      05291007
052916*                                                                 05291607
052917***************************************************************** 05291707
052918 4100-GET-USER-LOCATION.                                          05291807
052919***************************************************************** 05291907
052920*                                                                 05292008
052921     EXEC SQL                                                     05292108
052922         SELECT DISTINCT B.DC_NBR                                 05292208
052923           INTO :DLT00004-DC-NBR                                  05292308
052924           FROM DLT_TEM_ASGMT A                                   05292408
052925               ,DLT_ASGMT B                                       05292508
052926          WHERE A.ASGMT_STRT_DTE   IN ( :COCNTL-BTCH-PRC-DTE      05292647
052927                                       ,:PV-PREV-PRC-DTE          05292747
052928                                      )                           05292847
052929            AND A.KOHLS_USR_ID      = :DL020-USER-ID              05292929
052930            AND B.ASGMT_NBR_SEQ_NBR = A.ASGMT_NBR_SEQ_NBR         05293008
052931         WITH UR                                                  05293108
052932     END-EXEC.                                                    05293208
052933                                                                  05293308
052934     EVALUATE TRUE                                                05293408
052935        WHEN SQLCODE = ZERO                                       05293508
052936        WHEN SQLCODE = -811                                       05293608
052937          MOVE DLT00004-DC-NBR     TO DL020-DC-LOC-NBR            05293732
052938        WHEN SQLCODE = +100                                       05293832
052939           IF PCT00011-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT USER ADD'  05293932
052940              PERFORM 4110-GET-DC-LOCATION                        05294032
052941           ELSE                                                   05294132
052942              IF PCT00011-EVNT-OBJ-ACTN-TXT = 'ASSOCIATE ADD' OR  05294232
052943                 PCT00011-EVNT-OBJ-ACTN-TXT = 'INDIRECT LABOR'    05294332
052944                 PERFORM 4120-GET-DC-LOCATION                     05294432
052945              ELSE                                                05294532
052946                 MOVE ZEROES       TO DL020-DC-LOC-NBR            05294632
052947              END-IF                                              05294732
052948          END-IF                                                  05294832
052949        WHEN SQLWARN0 NOT = SPACES                                05294907
052950        WHEN SQLCODE < ZERO                                       05295007
052951        WHEN SQLCODE > ZERO                                       05295107
052952           MOVE '4100-GET-USER-LOCATION'                          05295207
052953                                   TO PV-ABEND-PARAGRAPH          05295307
052954           MOVE 'SELECT LOCATION FOR USER'                        05295407
052955                                   TO PV-DB2-OPERATION-MESSAGE    05295515
052956           MOVE 'DLT_TEM_ASGMT DLT_ASGMT'                         05295607
052957                                   TO PV-DB2-TABLE-NAME           05295707
052958           MOVE SQLCODE            TO PV-SQLCODE                  05295807
052959           PERFORM 9999-SQL-ABEND                                 05295907
052960     END-EVALUATE.                                                05296007
052961*                                                                 05296132
052962***************************************************************** 05296232
052963 4110-GET-DC-LOCATION.                                            05296332
052964***************************************************************** 05296432
052965*                                                                 05296532
052966     EXEC SQL                                                     05296632
052967         SELECT EVNT_KY_2_NBR                                     05296732
052968           INTO :PCT00011-EVNT-KY-2-NBR                           05296832
052969           FROM PCT_BUS_EVNT_EXPRT                                05296932
052970          WHERE DATE(CRE_TMST)      = :COCNTL-BTCH-PRC-DTE        05297032
052971            AND CRE_BY_USR_ID       = :DL020-USER-ID              05297132
052972            AND EVNT_OBJ_ACTN_TXT   = :PCT00011-EVNT-OBJ-ACTN-TXT 05297235
052973         WITH UR                                                  05297332
052974     END-EXEC.                                                    05297432
052975                                                                  05297532
052976     EVALUATE TRUE                                                05297632
052977        WHEN SQLCODE = ZERO                                       05297732
052978        WHEN SQLCODE = -811                                       05297832
052979          MOVE PCT00011-EVNT-KY-2-NBR TO  DL020-DC-LOC-NBR        05297932
052980        WHEN SQLCODE = +100                                       05298032
052981        WHEN SQLCODE = -305                                       05298132
052989           MOVE ZEROES             TO DL020-DC-LOC-NBR            05298932
052992        WHEN SQLWARN0 NOT = SPACES                                05299232
052993        WHEN SQLCODE < ZERO                                       05299332
052994        WHEN SQLCODE > ZERO                                       05299432
052995           MOVE '4110-GET-DC-LOCATION'                            05299532
052996                                   TO PV-ABEND-PARAGRAPH          05299632
052997           MOVE 'SELECT LOCATION FOR USER'                        05299732
052998                                   TO PV-DB2-OPERATION-MESSAGE    05299832
052999           MOVE 'PCT_BUS_EVNT_EXPRT'                              05299932
053000                                   TO PV-DB2-TABLE-NAME           05300032
053001           MOVE SQLCODE            TO PV-SQLCODE                  05300132
053002           PERFORM 9999-SQL-ABEND                                 05300232
053003     END-EVALUATE.                                                05300332
053004*                                                                 05300432
053005***************************************************************** 05300532
053006 4120-GET-DC-LOCATION.                                            05300632
053007***************************************************************** 05300732
053008*                                                                 05300832
053009     EXEC SQL                                                     05300932
053010         SELECT EVNT_KY_1_NBR                                     05301032
053011           INTO :PCT00011-EVNT-KY-1-NBR                           05301132
053012           FROM PCT_BUS_EVNT_EXPRT                                05301232
053013          WHERE DATE(CRE_TMST)      = :COCNTL-BTCH-PRC-DTE        05301332
053014            AND CRE_BY_USR_ID       = :DL020-USER-ID              05301432
053015            AND EVNT_OBJ_ACTN_TXT   = :PCT00011-EVNT-OBJ-ACTN-TXT 05301535
053016         WITH UR                                                  05301632
053017     END-EXEC.                                                    05301732
053018                                                                  05301832
053019     EVALUATE TRUE                                                05301932
053020        WHEN SQLCODE = ZERO                                       05302032
053021        WHEN SQLCODE = -811                                       05302132
053022          MOVE PCT00011-EVNT-KY-1-NBR TO  DL020-DC-LOC-NBR        05302232
053023        WHEN SQLCODE = +100                                       05302332
053024        WHEN SQLCODE = -305                                       05302432
053025           MOVE ZEROES             TO DL020-DC-LOC-NBR            05302532
053026        WHEN SQLWARN0 NOT = SPACES                                05302632
053027        WHEN SQLCODE < ZERO                                       05302732
053028        WHEN SQLCODE > ZERO                                       05302832
053029           MOVE '4120-GET-DC-LOCATION'                            05302932
053030                                   TO PV-ABEND-PARAGRAPH          05303032
053031           MOVE 'SELECT LOCATION FOR USER'                        05303132
053032                                   TO PV-DB2-OPERATION-MESSAGE    05303232
053033           MOVE 'PCT_BUS_EVNT_EXPRT'                              05303332
053034                                   TO PV-DB2-TABLE-NAME           05303432
053035           MOVE SQLCODE            TO PV-SQLCODE                  05303532
053036           PERFORM 9999-SQL-ABEND                                 05303632
053037     END-EVALUATE.                                                05303732
053038*                                                                 05303832
053039***************************************************************** 05303932
053040 4200-GET-USER-NAME.                                              05304032
053041***************************************************************** 05304132
053042*                                                                 05304232
053043     IF DL020-USER-ID = PV-PREV-USER-ID                           05304342
053044        MOVE XL067-COMBINED-NAME-1      TO DL020-USER-NAME        05304442
053045     ELSE                                                         05304542
053046        INITIALIZE XL067-USER-COMMAREA                            05304636
053047                                                                  05304736
053048        SET XL067-SELECT-BOTH-USERS     TO TRUE                   05304836
053049        SET XL067-BY-USER-ID            TO TRUE                   05304936
053050                                                                  05305036
053051        MOVE DL020-USER-ID            TO XL067-KEY-USER-ID        05305137
053052        MOVE 'DLKUT050'               TO XL067-ORIG-CALLING-PGM-NM05305237
053053                                                                  05305336
053056        CALL XL067-USER-PGM USING XL067-USER-COMMAREA             05305642
053058                                                                  05305836
053059        EVALUATE TRUE                                             05305936
053060            WHEN XL067-SUCCESSFUL                                 05306036
053061               MOVE XL067-COMBINED-NAME-1 TO DL020-USER-NAME      05306137
053062               MOVE DL020-USER-ID         TO PV-PREV-USER-ID      05306238
053063            WHEN OTHER                                            05306337
053064               MOVE '4200-GET-USER-NAME'                          05306437
053065                                      TO PV-ABEND-PARAGRAPH       05306537
053066               MOVE 'CALL XLKUT067'   TO PV-DB2-OPERATION-MESSAGE 05306648
053067               DISPLAY 'CHECK XLWS067 COPYBOOK FIELDS'            05306738
053085           PERFORM 9999-SQL-ABEND                                 05308536
053086        END-EVALUATE                                              05308642
053087     END-IF.                                                      05308742
053088*                                                                 05308836
053089***************************************************************** 05308936
053090 4300-GET-USER-LOCATION.                                          05309036
053091***************************************************************** 05309136
053092*                                                                 05309236
053093     EXEC SQL                                                     05309336
053094         SELECT DISTINCT B.DC_NBR                                 05309436
053095           INTO :DLT00004-DC-NBR                                  05309536
053096           FROM DLT_TEM_ASGMT A                                   05309636
053097              , DLT_ASGMT B                                       05309736
053098          WHERE A.ASGMT_STRT_DTE   IN ( :COCNTL-BTCH-PRC-DTE      05309847
053099                                       ,:PV-PREV-PRC-DTE          05309947
053100                                      )                           05310047
053101            AND A.TMP_USR_ID        = :DL020-USER-ID              05310136
053102            AND B.ASGMT_NBR_SEQ_NBR = A.ASGMT_NBR_SEQ_NBR         05310236
053103         WITH UR                                                  05310336
053104     END-EXEC.                                                    05310436
053105                                                                  05310536
053106     EVALUATE TRUE                                                05310636
053107        WHEN SQLCODE = ZERO                                       05310736
053108        WHEN SQLCODE = -811                                       05310836
053109          MOVE DLT00004-DC-NBR     TO DL020-DC-LOC-NBR            05310936
053110        WHEN SQLCODE = +100                                       05311036
053111           IF PCT00011-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT USER ADD'  05311136
053112              PERFORM 4110-GET-DC-LOCATION                        05311236
053113           ELSE                                                   05311336
053114              IF PCT00011-EVNT-OBJ-ACTN-TXT = 'ASSOCIATE ADD' OR  05311436
053115                 PCT00011-EVNT-OBJ-ACTN-TXT = 'INDIRECT LABOR'    05311536
053116                 PERFORM 4120-GET-DC-LOCATION                     05311636
053117              ELSE                                                05311736
053118                 MOVE ZEROES       TO DL020-DC-LOC-NBR            05311836
053119              END-IF                                              05311936
053120          END-IF                                                  05312036
053121        WHEN SQLWARN0 NOT = SPACES                                05312136
053122        WHEN SQLCODE < ZERO                                       05312236
053123        WHEN SQLCODE > ZERO                                       05312336
053124           MOVE '4300-GET-USER-LOCATION'                          05312436
053125                                   TO PV-ABEND-PARAGRAPH          05312536
053126           MOVE 'SELECT LOCATION FOR USER'                        05312636
053127                                   TO PV-DB2-OPERATION-MESSAGE    05312736
053128           MOVE 'DLT_TEM_ASGMT DLT_ASGMT'                         05312836
053129                                   TO PV-DB2-TABLE-NAME           05312936
053130           MOVE SQLCODE            TO PV-SQLCODE                  05313036
053131           PERFORM 9999-SQL-ABEND                                 05313136
053132     END-EVALUATE.                                                05313236
053133*                                                                 05313336
053134***************************************************************** 05313436
053135 4400-CHECK-PARM-TABLE-FOR-USER.                                  05313536
053136***************************************************************** 05313636
053137*                                                                 05313736
053138     EXEC SQL                                                     05313836
053139         SELECT FUNC_TXT                                          05313936
053140           INTO :KRPRPM-FUNC-TXT                                  05314036
053141           FROM TKRPRPM                                           05314136
053142          WHERE INTFC_SYS_CDE    = 'DLX'                          05314236
053143            AND SYS_PRC_FUNC_CDE = 'DLPLDU'                       05314336
053144            AND FUNC_TXT         = :DL020-USER-ID                 05314436
053145         WITH UR                                                  05314536
053146     END-EXEC.                                                    05314636
053147                                                                  05314736
053148     EVALUATE TRUE                                                05314836
053149        WHEN SQLCODE = ZERO                                       05314936
053150           CONTINUE                                               05315036
053151        WHEN SQLCODE = +100                                       05315136
053152           PERFORM 4200-GET-USER-NAME                             05315237
053153           PERFORM 5000-WRITE-LABOR-EVENT-DETAILS                 05315337
053154        WHEN SQLWARN0 NOT = SPACES                                05315436
053155        WHEN SQLCODE < ZERO                                       05315536
053156        WHEN SQLCODE > ZERO                                       05315636
053157           MOVE '4400-CHECK-PARM-TABLE-FOR-USER'                  05315736
053158                                   TO PV-ABEND-PARAGRAPH          05315836
053159           MOVE 'SELECT TKRPRPM'   TO PV-DB2-OPERATION-MESSAGE    05315936
053160           MOVE 'TKRPRPM'          TO PV-DB2-TABLE-NAME           05316036
053161           MOVE SQLCODE            TO PV-SQLCODE                  05316136
053162           PERFORM 9999-SQL-ABEND                                 05316236
053163     END-EVALUATE.                                                05316336
053197*                                                                 05319736
053198***************************************************************** 05319836
053199 5000-WRITE-LABOR-EVENT-DETAILS.                                  05319936
053200***************************************************************** 05320032
053300*                                                                 05330007
053400     MOVE PV-LBR-EVNT-DT           TO DL020-EVENT-DATE            05340008
053500     MOVE PV-LBR-EVNT-HR           TO DL020-EVENT-DATE-HOUR       05350008
053600     MOVE PV-LBR-EVNT-CNT          TO DL020-EVENT-COUNT           05360008
053700                                                                  05370008
053800     WRITE DAILY-LABOR-EVENTS-RECORDS FROM DL020-LBR-EVNT-RECORD. 05380007
053900     ADD +1                        TO PV-RECS-WRITTEN.            05390033
054100*                                                                 05410000
055000***************************************************************** 05500000
055001 5500-GET-OTHER-DOORSUM-INFO.                                     05500128
055002***************************************************************** 05500218
055003*                                                                 05500318
055004     EXEC SQL                                                     05500418
055005         SELECT EVNT_EXPRT_ID                                     05500524
055024               ,EVNT_KY_2_NBR                                     05502424
055025           INTO :PCT00011-EVNT-EXPRT-ID                           05502524
055026               ,:PCT00011-EVNT-KY-2-NBR                           05502624
055077           FROM PCT_BUS_EVNT_EXPRT                                05507724
055080          WHERE EVNT_OBJ_TXT      = 'SHIPPING'                    05508024
055081            AND EVNT_OBJ_ACTN_TXT = 'DOOR SUMMARY'                05508124
055083            AND DATE(CRE_TMST)    = :COCNTL-BTCH-PRC-DTE          05508324
055084            AND CRE_BY_USR_ID     = :PCT00011-CRE-BY-USR-ID       05508424
055086         WITH UR                                                  05508624
055087     END-EXEC                                                     05508718
055088                                                                  05508818
055089     EVALUATE TRUE                                                05508918
055090         WHEN SQLCODE = ZERO                                      05509018
055091         WHEN SQLCODE = -811                                      05509118
055092           MOVE PCT00011-EVNT-EXPRT-ID  TO PCT00012-EVNT-EXPRT-ID 05509224
055093           MOVE PCT00011-EVNT-KY-2-NBR  TO DK-OPER-UNT-ID         05509324
055094           PERFORM 5600-GET-ASGMT-NBR-DETAILS                     05509424
055095         WHEN SQLCODE = +100                                      05509518
055096           SET PS-SKIP-THIS-REC-YES     TO TRUE                   05509624
055097         WHEN SQLWARN0 NOT = SPACE                                05509718
055098         WHEN SQLCODE  NOT = ZERO                                 05509818
055099            MOVE '5500-GET-OTHER-DOORSUM-INFO'                    05509928
055100                                        TO PV-ABEND-PARAGRAPH     05510024
055101            MOVE 'SELECT'               TO PV-ABEND-OPERATION     05510124
055102            MOVE 'PCT_BUS_EVNT_EXPRT'   TO PV-DB2-TABLE-NAME      05510224
055104            PERFORM 9999-SQL-ABEND                                05510428
055105     END-EVALUATE.                                                05510518
055106*                                                                 05510624
055107***************************************************************** 05510724
055108 5600-GET-ASGMT-NBR-DETAILS.                                      05510824
055109***************************************************************** 05510924
055110*                                                                 05511024
055111     EXEC SQL                                                     05511124
055112         SELECT DTL_TXT                                           05511224
055114           INTO :PCT00012-DTL-TXT                                 05511424
055116           FROM PCT_BUS_EVNT_DTL                                  05511624
055117          WHERE EVNT_EXPRT_ID     = :PCT00012-EVNT-EXPRT-ID       05511724
055121         WITH UR                                                  05512124
055122     END-EXEC                                                     05512224
055123                                                                  05512324
055124     EVALUATE TRUE                                                05512424
055125         WHEN SQLCODE = ZERO                                      05512524
055126         WHEN SQLCODE = -811                                      05512624
055129           CONTINUE                                               05512924
055130         WHEN SQLCODE = +100                                      05513024
055131           SET PS-SKIP-THIS-REC-YES     TO TRUE                   05513124
055132         WHEN SQLWARN0 NOT = SPACE                                05513224
055133         WHEN SQLCODE  NOT = ZERO                                 05513324
055134            MOVE '5600-GET-ASGMT-NBR-DETAILS'                     05513424
055135                                        TO PV-ABEND-PARAGRAPH     05513524
055136            MOVE 'SELECT'               TO PV-ABEND-OPERATION     05513624
055137            MOVE 'PCT_BUS_EVNT_DTL'     TO PV-DB2-TABLE-NAME      05513724
055139            PERFORM 9999-SQL-ABEND                                05513928
055140     END-EVALUATE.                                                05514024
055141*                                                                 05514124
055142***************************************************************** 05514224
055143 6000-CHECK-DOOR-SUMMARY.                                         05514324
055144***************************************************************** 05514424
055145*                                                                 05514524
055146     EXEC SQL                                                     05514624
055147         SELECT TEM.KOHLS_USR_ID                                  05514724
055148              , TEM.LVE_TMST                                      05514824
055149          INTO  :DLT00003-KOHLS-USR-ID                            05514924
055150              , :DLT00003-LVE-TMST                                05515024
055151          FROM  DLT_TEM_ASGMT   TEM                               05515124
055152              , DLT_ASGMT       ASG                               05515224
055153         WHERE  ASG.DC_NBR            = :DK-OPER-UNT-ID           05515324
055154           AND  TEM.ASGMT_STRT_DTE    = :DK-ASGMT-STRT-DTE        05515424
055155           AND  TEM.ASGMT_NBR_TXT     = :DK-ASGMT-NBR-TXT         05515524
055156           AND  TEM.ASGMT_NBR_SEQ_NBR = :DK-ASGMT-NBR-SEQ-NBR     05515624
055157           AND  TEM.ASGMT_STRT_DTE    = ASG.ASGMT_STRT_DTE        05515724
055158           AND  TEM.ASGMT_NBR_TXT     = ASG.ASGMT_NBR_TXT         05515824
055159           AND  TEM.ASGMT_NBR_SEQ_NBR = ASG.ASGMT_NBR_SEQ_NBR     05515924
055160           AND  TEM.LVE_RSN_CDE       = 'T'                       05516024
055161          ORDER BY TEM.LVE_TMST DESC                              05516124
055162          FETCH FIRST 1 ROW ONLY                                  05516224
055163         WITH UR                                                  05516324
055164     END-EXEC                                                     05516424
055165                                                                  05516524
055166     EVALUATE TRUE                                                05516624
055167         WHEN SQLCODE = ZERO                                      05516724
055168         WHEN SQLCODE = -811                                      05516824
055169           MOVE DLT00003-KOHLS-USR-ID TO DL020-USER-ID            05516926
055170         WHEN SQLCODE = +100                                      05517024
055171         WHEN SQLCODE = -305                                      05517124
055172           PERFORM 6100-CHECK-DOOR-SUMMARY2                       05517224
055173         WHEN SQLWARN0 NOT = SPACE                                05517324
055174         WHEN SQLCODE  NOT = ZERO                                 05517424
055175            MOVE '6000-CHECK-DOOR-SUMMARY'                        05517524
055176                                       TO PV-ABEND-PARAGRAPH      05517624
055177            MOVE 'SELECT'              TO PV-ABEND-OPERATION      05517724
055178            MOVE 'DLT_TEM_ASGMT'       TO PV-DB2-TABLE-NAME       05517824
055180            PERFORM 9999-SQL-ABEND                                05518028
055181     END-EVALUATE.                                                05518124
055182*                                                                 05518224
055183***************************************************************** 05518324
055184 6100-CHECK-DOOR-SUMMARY2.                                        05518424
055185***************************************************************** 05518524
055186*                                                                 05518624
055187     EXEC SQL                                                     05518724
055188         SELECT TEM.KOHLS_USR_ID                                  05518824
055189              , TEM.LVE_TMST                                      05518924
055190          INTO  :DLT00003-KOHLS-USR-ID                            05519024
055191              , :DLT00003-LVE-TMST                                05519124
055192          FROM  DLT_TEM_ASGMT   TEM                               05519224
055193              , DLT_ASGMT       ASG                               05519324
055194         WHERE  ASG.DC_NBR            = :DK-OPER-UNT-ID           05519424
055195           AND  TEM.ASGMT_STRT_DTE    = :DK-ASGMT-STRT-DTE        05519524
055196           AND  TEM.ASGMT_NBR_TXT     = :DK-ASGMT-NBR-TXT         05519624
055197           AND  TEM.ASGMT_NBR_SEQ_NBR = :DK-ASGMT-NBR-SEQ-NBR     05519724
055198           AND  TEM.ASGMT_STRT_DTE    = ASG.ASGMT_STRT_DTE        05519824
055199           AND  TEM.ASGMT_NBR_TXT     = ASG.ASGMT_NBR_TXT         05519924
055200           AND  TEM.ASGMT_NBR_SEQ_NBR = ASG.ASGMT_NBR_SEQ_NBR     05520024
055201          ORDER BY TEM.LVE_TMST DESC                              05520124
055202          FETCH FIRST 1 ROW ONLY                                  05520224
055203         WITH UR                                                  05520324
055204     END-EXEC                                                     05520424
055205                                                                  05520524
055206     EVALUATE TRUE                                                05520624
055207         WHEN SQLCODE = ZERO                                      05520724
055208         WHEN SQLCODE = -811                                      05520824
055210           MOVE DLT00003-KOHLS-USR-ID TO DL020-USER-ID            05521026
055211         WHEN SQLCODE = +100                                      05521124
055212         WHEN SQLCODE = -305                                      05521224
055213              PERFORM 6200-CHECK-TEMP-DOOR-SUMMARY                05521324
055214         WHEN SQLWARN0 NOT = SPACE                                05521424
055215         WHEN SQLCODE  NOT = ZERO                                 05521524
055216             MOVE '6100-CHECK-DOOR-SUMMARY2'                      05521624
055217                                       TO PV-ABEND-PARAGRAPH      05521724
055218             MOVE 'SELECT'             TO PV-ABEND-OPERATION      05521824
055219             MOVE 'DLT_TEM_ASGMT'      TO PV-DB2-TABLE-NAME       05521928
055221             PERFORM 9999-SQL-ABEND                               05522128
055222     END-EVALUATE.                                                05522224
055223*                                                                 05522324
055224***************************************************************** 05522424
055225 6200-CHECK-TEMP-DOOR-SUMMARY.                                    05522524
055226***************************************************************** 05522624
055227*                                                                 05522724
055228     EXEC SQL                                                     05522824
055229         SELECT TEM.TMP_USR_ID                                    05522924
055230              , TEM.LVE_TMST                                      05523024
055231          INTO  :DLT00003-TMP-USR-ID                              05523124
055232              , :DLT00003-LVE-TMST                                05523224
055233          FROM  DLT_TEM_ASGMT   TEM                               05523324
055234              , DLT_ASGMT       ASG                               05523424
055235         WHERE  ASG.DC_NBR            = :DK-OPER-UNT-ID           05523524
055236           AND  TEM.ASGMT_STRT_DTE    = :DK-ASGMT-STRT-DTE        05523624
055237           AND  TEM.ASGMT_NBR_TXT     = :DK-ASGMT-NBR-TXT         05523724
055238           AND  TEM.ASGMT_NBR_SEQ_NBR = :DK-ASGMT-NBR-SEQ-NBR     05523824
055239           AND  TEM.ASGMT_STRT_DTE    = ASG.ASGMT_STRT_DTE        05523924
055240           AND  TEM.ASGMT_NBR_TXT     = ASG.ASGMT_NBR_TXT         05524024
055241           AND  TEM.ASGMT_NBR_SEQ_NBR = ASG.ASGMT_NBR_SEQ_NBR     05524124
055242          ORDER BY TEM.LVE_TMST DESC                              05524224
055243          FETCH FIRST 1 ROW ONLY                                  05524324
055244         WITH UR                                                  05524424
055245     END-EXEC                                                     05524524
055246                                                                  05524624
055247     EVALUATE TRUE                                                05524724
055248         WHEN SQLCODE = ZERO                                      05524824
055249         WHEN SQLCODE = -811                                      05524924
055250            MOVE DLT00003-TMP-USR-ID  TO DL020-USER-ID            05525026
055252         WHEN SQLCODE = +100                                      05525224
055253         WHEN SQLCODE = -305                                      05525324
055254            SET PS-SKIP-THIS-REC-YES  TO TRUE                     05525426
055255         WHEN SQLWARN0 NOT = SPACE                                05525524
055256         WHEN SQLCODE  NOT = ZERO                                 05525624
055257             MOVE '6200-CHECK-TEMP-DOOR-SUMMARY'                  05525726
055258                                       TO PV-ABEND-PARAGRAPH      05525826
055259             MOVE 'SELECT'             TO PV-ABEND-OPERATION      05525926
055260             MOVE 'DLT_TEM_ASGMT'      TO PV-DB2-TABLE-NAME       05526028
055262             PERFORM 9999-SQL-ABEND                               05526228
055276     END-EVALUATE.                                                05527624
055277*                                                                 05527724
055278***************************************************************** 05527824
055279 9000-EOJ-ROUTINE.                                                05527924
055280***************************************************************** 05528024
055300*                                                                 05530000
055400     CLOSE DAILY-LABOR-EVENTS.                                    05540007
055800                                                                  05580000
056000     DISPLAY '** ' PC-PROGRAM-NAME ' SUMMARY **'.                 05600013
056100     DISPLAY 'PROCESSING DATE        : ' COCNTL-BTCH-PRC-DTE.     05610007
056200     DISPLAY 'LABOR EVENTS EXTRACTED : ' PV-RECS-EXTRACTED.       05620007
056210     DISPLAY 'LABOR EVENTS WRITTEN   : ' PV-RECS-WRITTEN.         05621007
056700*                                                                 05670000
056800******************************************************************05680000
056900* ABEND PROCEDURE                                                *05690000
057000******************************************************************05700000
057100 9999-SQL-ABEND.                                                  05710000
057200     DISPLAY '** ABEND           ** = SQLABEND'.                  05720000
057300     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          05730013
057400     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARAGRAPH.       05740000
057500     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        05750000
057600     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MESSAGE. 05760018
057800     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               05780000
057900     COPY DPPD004.                                                05790000
058000     MOVE +4013                    TO PV-ABEND-CODE.              05800007
058100     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       05810000
058200                                                                  05820000
