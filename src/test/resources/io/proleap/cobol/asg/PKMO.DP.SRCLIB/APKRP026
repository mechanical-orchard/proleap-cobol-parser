000100 IDENTIFICATION DIVISION.                                         00010051
000200 PROGRAM-ID.     APKRP026.                                        00020024
000300 AUTHOR.         DARYL WOELFEL.                                   00030005
000400 DATE-WRITTEN.   05/14/1996.                                      00040051
000500 DATE-COMPILED.                                                   00050051
000600*************************************************************     00060051
000700*    COBOL II                                                     00070051
000800*                                                                 00080051
000900*  THIS PROGRAM REPORTS ON BATCH MATCH INVOICE EXCEPTIONS.        00090051
001000*************************************************************     00100051
001100*                                                                 00110059
001200*  11/17/97  CHANGE THE REPORT TO WRITE OUT THE FOLLOWING ERRORS  00120060
001300*            IMPORT PO WITHOUT A VALID CHANGE CODE                00130060
001400*  MADE BY: CHRIS BOEHNLEIN                        PIT 118171     00140060
001500*                                                                 00150060
001600*  04/22/04  INCREASED THE LENGTH OF DL-STR-NBR TO HOLD A 4 DIGIT 00160060
001700*            STORE NUMBER AS PART STORE CONSTRAINTS PROJECT.      00170060
001800*  MADE BY: MIKE BESKE                             WR25805        00180060
001810*                                                                 00181062
001820*  03/11/07  MATCH BY DC PROJECT.                                 00182070
001830*            ADDED DC NBR TO THE DETAIL HEADER AND DETAIL         00183067
001831*            LINE.  MODIFIED PARAGRAPH B200- TO INCLUDE THE       00183167
001832*            DC NBR.                                              00183267
001840*  MADE BY: ROLF NOHE                              WR21578        00184062
001841*                                                                 00184169
001850*  03/11/07  MATCH BY DC -- ADDED EXCP-9 TO THE EXCP-MESSAGES     00185071
001860*            FOR AN INVALID MATCH LEVEL CODE.  ALSO INCLUDED LOGIC00186069
001870*            IN PARAGRAPH W200-WRITE-EXCP-HEADER FOR EXCP-9.      00187069
001890*  MADE BY: KRYSTEN LEARY                          WR21578        00189069
001900**************************************************************    00190060
002000                                                                  00200060
002100   EJECT                                                          00210060
002200 ENVIRONMENT DIVISION.                                            00220060
002300 CONFIGURATION SECTION.                                           00230060
002400 SOURCE-COMPUTER.    IBM-3090.                                    00240060
002500 OBJECT-COMPUTER.    IBM-3090.                                    00250060
002600                                                                  00260060
002700 INPUT-OUTPUT SECTION.                                            00270060
002800 FILE-CONTROL.                                                    00280060
002900     SELECT INVOICE-FILE  ASSIGN TO UT-S-INP01.                   00290060
003000     SELECT REPORT-FILE   ASSIGN TO UT-S-RPT01.                   00300060
003100                                                                  00310060
003200 DATA DIVISION.                                                   00320060
003300 FILE SECTION.                                                    00330060
003400                                                                  00340060
003500 FD  INVOICE-FILE                                                 00350060
003600     RECORDING MODE IS F                                          00360060
003700     LABEL RECORDS ARE STANDARD                                   00370060
003800     BLOCK CONTAINS 0 RECORDS                                     00380060
003900     DATA RECORD IS AP059-RECORD.                                 00390060
004000 01  AP059-RECORD                PIC X(100).                      00400060
004100                                                                  00410060
004200 FD  REPORT-FILE                                                  00420060
004300     RECORDING MODE IS F                                          00430060
004400     LABEL RECORDS ARE STANDARD                                   00440060
004500     BLOCK CONTAINS 0 RECORDS                                     00450060
004600     DATA RECORD IS REPORT-RECORD.                                00460060
004700 01  REPORT-RECORD               PIC X(132).                      00470060
004800                                                                  00480060
004900 EJECT                                                            00490060
005000 WORKING-STORAGE SECTION.                                         00500060
005100                                                                  00510060
005200 01  PROGRAM-VARIABLES.                                           00520060
005300     05  PV-PROGRAM-NAME         PIC  X(08)  VALUE 'APKRP026'.    00530060
005400     05  PV-CURRENT-DATE.                                         00540060
005500         10  PV-CURRENT-YEAR     PIC  9(02)  VALUE ZEROS.         00550060
005600         10  PV-CURRENT-MONTH    PIC  9(02)  VALUE ZEROS.         00560060
005700         10  PV-CURRENT-DAY      PIC  9(02)  VALUE ZEROS.         00570060
005800     05  PV-CURRENT-TIME.                                         00580060
005900         10  PV-CURRENT-HOUR     PIC  9(02)  VALUE ZEROS.         00590060
006000         10  PV-CURRENT-MINUTE   PIC  9(02)  VALUE ZEROS.         00600060
006100         10  FILLER              PIC  9(02)  VALUE ZEROS.         00610060
006200     05  PV-MAX-LINES            PIC S9(03)  VALUE +60            00620060
006300                                             COMP-3.              00630060
006400     05  PV-LINE-COUNT           PIC S9(03)  VALUE +99            00640060
006500                                             COMP-3.              00650060
006600     05  PV-PAGE-COUNT           PIC S9(05)  VALUE ZEROS          00660060
006700                                             COMP-3.              00670060
006800     05  HOLD-REASON-CODE        PIC  9(03)  VALUE ZEROS.         00680060
006900                                                                  00690060
007000 01  EOF-SW                      PIC  X      VALUE 'N'.           00700060
007100     88  INVC-EOF                            VALUE 'Y'.           00710060
007200                                                                  00720060
007300 01  EXCP-MESSAGES.                                               00730060
007400     05  EXCP-1                  PIC  X(40)                       00740060
007500            VALUE 'PO HAS BULK AND BY STORE INVOICES       '.     00750060
007600     05  EXCP-2                  PIC  X(40)                       00760060
007700            VALUE 'PO HAS INVOICE WITH OB STATUS           '.     00770060
007800     05  EXCP-3                  PIC  X(40)                       00780060
007900            VALUE 'PO HAS INVOICE WITH IB STATUS           '.     00790060
008000     05  EXCP-4                  PIC  X(40)                       00800060
008100            VALUE 'INVOICE TERMS NOT FOUND FOR INVOICE     '.     00810060
008200     05  EXCP-5                  PIC  X(40)                       00820060
008300            VALUE 'PO TERMS NOT FOUND FOR INVOICE          '.     00830060
008400     05  EXCP-6                  PIC  X(40)                       00840060
008500            VALUE 'PO/STORE EXCEEDS MAX NUMBER OF INVOICES '.     00850060
008600     05  EXCP-7                  PIC  X(40)                       00860060
008700            VALUE 'PO HAS INVOICE WITH ZERO COST           '.     00870060
008800     05  EXCP-8                  PIC  X(40)                       00880060
008900            VALUE 'IMPORT PO WITHOUT VALID CHRG PRC CDE    '.     00890060
008910     05  EXCP-9                  PIC  X(40)                       00891069
008920            VALUE 'MATCH LEVEL CODE IS NOT VALID           '.     00892069
009000                                                                  00900060
009100 EJECT                                                            00910060
009200*  INPUT RECORD LAYOUT - BATCH MATCH INVOICE EXCEPTION RECS       00920060
009300     COPY APRD059.                                                00930060
009400                                                                  00940060
009500 EJECT                                                            00950060
009600*----------------------------------------------------------------*00960060
009700*  STANDARD HEADER LAYOUT                                        *00970060
009800*----------------------------------------------------------------*00980060
009900     COPY DPWS132O.                                               00990060
010000                                                                  01000060
010100 EJECT                                                            01010060
010200                                                                  01020060
010300 01  H2-HEADER2.                                                  01030060
010400     05  FILLER                  PIC   X(52) VALUE SPACES.        01040060
010500     05  FILLER                  PIC   X(28) VALUE                01050060
010600         'BATCH MATCH EXCEPTION REPORT'.                          01060060
010700     05  FILLER                  PIC   X(52) VALUE SPACES.        01070060
010800                                                                  01080060
010900 01  DH-DETAIL-HEADER1.                                           01090060
011000     05  FILLER                  PIC   X(06) VALUE 'PO NBR'.      01100060
011100     05  FILLER                  PIC   X(07) VALUE SPACES.        01110060
011200     05  FILLER                  PIC   X(05) VALUE 'STORE'.       01120060
011300     05  FILLER                  PIC   X(05) VALUE SPACES.        01130060
011400     05  FILLER                  PIC   X(07) VALUE 'INVOICE'.     01140060
011500     05  FILLER                  PIC   X(13) VALUE SPACES.        01150060
011600     05  FILLER                  PIC   X(06) VALUE 'VENDOR'.      01160060
011700     05  FILLER                  PIC   X(26) VALUE SPACES.        01170060
011800     05  FILLER                  PIC   X(07) VALUE 'ENTERED'.     01180060
011810     05  FILLER                  PIC   X(04) VALUE SPACES.        01181064
011820     05  FILLER                  PIC   X(06) VALUE 'DC NBR'.      01182061
011830     05  FILLER                  PIC   X(04) VALUE SPACES.        01183068
011840     05  FILLER                  PIC   X(05) VALUE 'MATCH'.       01184068
011900     05  FILLER                  PIC   X(31) VALUE SPACES.        01190068
012000                                                                  01200060
012100 01  DH-DETAIL-HEADER2.                                           01210060
012200     05  FILLER                  PIC   X(13) VALUE SPACES.        01220060
012300     05  FILLER                  PIC   X(06) VALUE 'NUMBER'.      01230060
012400     05  FILLER                  PIC   X(04) VALUE SPACES.        01240060
012500     05  FILLER                  PIC   X(06) VALUE 'NUMBER'.      01250060
012600     05  FILLER                  PIC   X(14) VALUE SPACES.        01260060
012700     05  FILLER                  PIC   X(04) VALUE 'NAME'.        01270060
012800     05  FILLER                  PIC   X(28) VALUE SPACES.        01280060
012900     05  FILLER                  PIC   X(02) VALUE 'BY'.          01290060
012910     05  FILLER                  PIC   X(19) VALUE SPACES.        01291068
012920     05  FILLER                  PIC   X(05) VALUE 'LEVEL'.       01292068
013000     05  FILLER                  PIC   X(31) VALUE SPACES.        01300068
013100                                                                  01310060
013200 01  DL-DETAIL-LINE.                                              01320060
013300     05  DL-PO-NBR               PIC   X(09)   VALUE SPACES.      01330060
013400     05  FILLER                  PIC   X(05)   VALUE SPACES.      01340060
013500     05  DL-STR-NBR              PIC   X(04)   VALUE SPACES.      01350060
013600     05  FILLER                  PIC   X(05)   VALUE SPACES.      01360060
013700     05  DL-INVOICE-ID           PIC   X(15)   VALUE SPACES.      01370060
013800     05  FILLER                  PIC   X(05)   VALUE SPACES.      01380060
013900     05  DL-VENDOR-NAME          PIC   X(30)   VALUE SPACES.      01390060
014000     05  FILLER                  PIC   X(02)   VALUE SPACES.      01400060
014100     05  DL-ENTER-USERID         PIC   X(08)   VALUE SPACES.      01410060
014110     05  FILLER                  PIC   X(03)   VALUE SPACES.      01411065
014120     05  DL-DC-NBR               PIC   X(05)   VALUE SPACES.      01412066
014210     05  FILLER                  PIC   X(07)   VALUE SPACES.      01421068
014220     05  DL-MTCH-LVL-CDE         PIC   X(01)   VALUE SPACES.      01422068
014230     05  FILLER                  PIC   X(34)   VALUE SPACES.      01423068
014300 EJECT                                                            01430060
014400                                                                  01440060
014500 01 EH-EXCP-HEADER.                                               01450060
014600     05  FILLER                  PIC   X(15)                      01460060
014700                                    VALUE 'EXCEPTION TYPE:'.      01470060
014800     05  FILLER                  PIC   X(01)   VALUE SPACES.      01480060
014900     05  EH-EXCP-MESSAGE         PIC   X(40)   VALUE SPACES.      01490060
015000     05  FILLER                  PIC   X(02)   VALUE SPACES.      01500060
015100 EJECT                                                            01510060
015200 01  FILLER                      PIC  X(25)  VALUE                01520060
015300     '** END OF APKRP026 W/S **'.                                 01530060
015400 EJECT                                                            01540060
015500 PROCEDURE DIVISION.                                              01550060
015600 A100-MAIN.                                                       01560060
015700                                                                  01570060
015800     PERFORM B100-INITIALIZE.                                     01580060
015900     PERFORM B200-PROCESS-DATA UNTIL INVC-EOF                     01590060
016000     PERFORM B300-END.                                            01600060
016100     GOBACK.                                                      01610060
016200 EJECT                                                            01620060
016300*----------------------------------------------------------------*01630060
016400*    INITIALIZATION PROCESSING                                   *01640060
016500*----------------------------------------------------------------*01650060
016600 B100-INITIALIZE.                                                 01660060
016700                                                                  01670060
016800     OPEN INPUT  INVOICE-FILE                                     01680060
016900          OUTPUT REPORT-FILE.                                     01690060
017000                                                                  01700060
017100     ACCEPT PV-CURRENT-DATE FROM DATE.                            01710060
017200     MOVE PV-CURRENT-MONTH            TO DP132O-RUN-MONTH.        01720060
017300     MOVE PV-CURRENT-DAY              TO DP132O-RUN-DAY.          01730060
017400     MOVE PV-CURRENT-YEAR             TO DP132O-RUN-YEAR.         01740060
017500                                                                  01750060
017600     ACCEPT PV-CURRENT-TIME FROM TIME.                            01760060
017700     MOVE PV-CURRENT-HOUR             TO DP132O-RUN-HOUR.         01770060
017800     MOVE PV-CURRENT-MINUTE           TO DP132O-RUN-MINUTE.       01780060
017900     MOVE PV-PROGRAM-NAME             TO DP132O-PROGRAM-NAME.     01790060
018000     MOVE 1                           TO DP132O-REPORT-NUMBER.    01800060
018100                                                                  01810060
018200     PERFORM R100-READ-INVOICE-FILE.                              01820060
018300                                                                  01830060
018400 EJECT                                                            01840060
018500 B200-PROCESS-DATA.                                               01850060
018600                                                                  01860060
018700     IF AP059-REASON-CODE NOT = HOLD-REASON-CODE                  01870060
018800         PERFORM W200-WRITE-EXCP-HEADER                           01880060
018900         MOVE AP059-REASON-CODE  TO HOLD-REASON-CODE              01890060
019000     END-IF.                                                      01900060
019100                                                                  01910060
019200     MOVE AP059-PO-NBR           TO DL-PO-NBR.                    01920060
019300     MOVE AP059-STR-NBR          TO DL-STR-NBR.                   01930060
019400     MOVE AP059-INVOICE-ID(1:15) TO DL-INVOICE-ID.                01940060
019500     MOVE AP059-VENDOR-NAME      TO DL-VENDOR-NAME.               01950060
019600     MOVE AP059-ENTER-USERID     TO DL-ENTER-USERID.              01960060
019610     MOVE AP059-DC-NBR           TO DL-DC-NBR.                    01961063
019620     MOVE AP059-MTCH-LVL-CDE     TO DL-MTCH-LVL-CDE.              01962068
019700     PERFORM W100-WRITE-DETAIL-LINE.                              01970060
019800     PERFORM R100-READ-INVOICE-FILE.                              01980060
019900                                                                  01990060
020000 EJECT                                                            02000060
020100 B300-END.                                                        02010060
020200                                                                  02020060
020300     CLOSE INVOICE-FILE                                           02030060
020400           REPORT-FILE.                                           02040060
020500                                                                  02050060
020600 EJECT                                                            02060060
020700                                                                  02070060
020800 R100-READ-INVOICE-FILE.                                          02080060
020900                                                                  02090060
021000     READ INVOICE-FILE INTO AP059-ERROR-RECORD                    02100060
021100         AT END SET INVC-EOF TO TRUE.                             02110060
021200                                                                  02120060
021300 EJECT                                                            02130060
021400 W100-WRITE-DETAIL-LINE.                                          02140060
021500                                                                  02150060
021600     IF PV-LINE-COUNT > PV-MAX-LINES                              02160060
021700         PERFORM W300-WRITE-HEADING                               02170060
021800         PERFORM W200-WRITE-EXCP-HEADER                           02180060
021900     END-IF.                                                      02190060
022000                                                                  02200060
022100     WRITE REPORT-RECORD FROM DL-DETAIL-LINE AFTER 1.             02210060
022200     INITIALIZE DL-DETAIL-LINE.                                   02220060
022300                                                                  02230060
022400     ADD 1  TO PV-LINE-COUNT.                                     02240060
022500                                                                  02250060
022600 EJECT                                                            02260060
022700 W200-WRITE-EXCP-HEADER.                                          02270060
022800                                                                  02280060
022900     IF PV-LINE-COUNT > (PV-MAX-LINES - 4)                        02290060
023000         PERFORM W300-WRITE-HEADING                               02300060
023100     END-IF.                                                      02310060
023200     EVALUATE TRUE                                                02320060
023300         WHEN AP059-INVOICED-BY-ERROR                             02330060
023400             MOVE EXCP-1 TO EH-EXCP-MESSAGE                       02340060
023500         WHEN AP059-INVOICE-OB-STATUS                             02350060
023600             MOVE EXCP-2 TO EH-EXCP-MESSAGE                       02360060
023700         WHEN AP059-INVOICE-IB-STATUS                             02370060
023800             MOVE EXCP-3 TO EH-EXCP-MESSAGE                       02380060
023900         WHEN AP059-NO-INV-TERMS                                  02390060
024000             MOVE EXCP-4 TO EH-EXCP-MESSAGE                       02400060
024100         WHEN AP059-NO-PO-TERMS                                   02410060
024200             MOVE EXCP-5 TO EH-EXCP-MESSAGE                       02420060
024300         WHEN AP059-INVOICE-TBL-OVER-LIMIT                        02430060
024400             MOVE EXCP-6 TO EH-EXCP-MESSAGE                       02440060
024500         WHEN AP059-INVOICE-WITH-ZERO-COST                        02450060
024600             MOVE EXCP-7 TO EH-EXCP-MESSAGE                       02460060
024700         WHEN AP059-IMPORT-NOT-VALID                              02470060
024800             MOVE EXCP-8 TO EH-EXCP-MESSAGE                       02480060
024810         WHEN AP059-MTCH-LVL-INVALID                              02481069
024820             MOVE EXCP-9 TO EH-EXCP-MESSAGE                       02482069
024900     END-EVALUATE.                                                02490060
025000     WRITE REPORT-RECORD FROM EH-EXCP-HEADER AFTER 2.             02500060
025100     MOVE SPACES TO REPORT-RECORD.                                02510060
025200     WRITE REPORT-RECORD AFTER 1.                                 02520060
025300     ADD 3  TO PV-LINE-COUNT.                                     02530060
025400                                                                  02540060
025500 EJECT                                                            02550060
025600 W300-WRITE-HEADING.                                              02560060
025700                                                                  02570060
025800     ADD 1                            TO PV-PAGE-COUNT.           02580060
025900     MOVE PV-PAGE-COUNT               TO DP132O-PAGE-NUMBER.      02590060
026000                                                                  02600060
026100     WRITE REPORT-RECORD FROM                                     02610060
026200                   DP132O-STANDRD-HEADER-132-COLS AFTER PAGE.     02620060
026300     WRITE REPORT-RECORD FROM H2-HEADER2 AFTER 1.                 02630060
026400     WRITE REPORT-RECORD FROM DH-DETAIL-HEADER1 AFTER 2.          02640060
026500     WRITE REPORT-RECORD FROM DH-DETAIL-HEADER2 AFTER 1.          02650060
026600     MOVE 5  TO PV-LINE-COUNT.                                    02660060
