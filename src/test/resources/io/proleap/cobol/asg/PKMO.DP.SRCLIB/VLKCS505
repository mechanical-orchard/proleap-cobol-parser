000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.                VLKCS505.                             00050001
000600 AUTHOR.                    MICHAEL WALTERS.                      00060001
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070001
000800 DATE-WRITTEN.              06-03-96.                             00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200*  CICS PROGRAM - VLKCS505 - V505                                *00120001
001300*                                                                *00130001
001400*       PO SYSTEM PRETICKET DETAIL INQUIRE SCREEN                *00140001
001500*                                                                *00150001
001600*  THIS SCREEN WILL SHOW THE DETAIL OF ONE PRETICKET REQUEST     *00160001
001700******************************************************************00170001
263627*----------------------------------------------------------------*        
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
263627*----------------------------------------------------------------*        
CICS  * CHANGED 11/11/2022    BY JIM HUNTER      WR: CHG0278236                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *****************************************************************         
001800                                                                  00180001
002100 ENVIRONMENT DIVISION.                                            00200001
002200                                                                  00210001
002300 DATA DIVISION.                                                   00220001
002400                                                                  00230001
002500 WORKING-STORAGE SECTION.                                         00240001
002600                                                                  00250001
002700 01  DK-DB2-KEYS.                                                 00260001
002800     05  DK-PO-NUMBER                   PIC S9(09) COMP.          00270001
003000     05  DK-PO-REQ-NBR                  PIC S9(09) COMP.          00280001
003100     05  DK-ENT-ID                      PIC S9(09) COMP.          00290001
003101     05  DK-SEQ-NBR                     PIC S9(04) COMP.          00300003
003102     05  DK-PRIORITY                    PIC S9(04) COMP.          00300106
003103     05  DK-COMMENT-LINE                PIC  X(50).               00301018
003400                                                                  00360001
003500 01  PC-PROGRAM-CONSTANTS.                                        00370001
004000     05  PC-MAX-XTRA-LINES              PIC S9(04) COMP           00380003
004100                                                   VALUE +20.     00381003
004120     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00480001
004200                                                    'VL505A  '.   00490007
004300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00500001
004400                                                    'VLKM505 '.   00510001
004500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00520001
004600                                                    'VLKCS505'.   00530001
004900     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00560001
005000     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00570001
005200     05  PC-FORMAT-INDICATOR            PIC  X(01) .              00580001
005400         88 PC-LIST-FORMAT-IND          VALUE '1'.                00600002
005500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +05     00610012
005600                                                    COMP SYNC.    00620001
005700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00630001
005800                                                    COMP SYNC.    00640001
005900     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00650001
006000                                                    +10000        00660001
006100                                                    COMP-3.       00670001
006400     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00680001
006500                                                    COMP-3.       00690001
007200     05  PC-TSYMSG-NUMBERS.                                       00760001
007400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00800001
007600         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00820001
008300         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  00890001
008400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00900001
008500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00910001
008600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00920001
008700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00930001
008800         10  PC-TSYMSG-00342            PIC  9(05)  VALUE 00342.  00940001
008900         10  PC-TSYMSG-01339            PIC  9(05)  VALUE 01339.  00950015
008901         10  PC-TSYMSG-01395            PIC  9(05)  VALUE 01395.  00950130
008902         10  PC-TSYMSG-01354            PIC  9(05)  VALUE 01354.  00950225
008903         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00951015
009000*                                                                 00960001
009100 01  PS-PROGRAM-SWITCHES.                                         00970001
009200     05  PS-COMMENTS-SW                 PIC  X(01)  VALUE 'Y'.    00980007
009300         88  PS-NO-COMMENTS-LEFT                    VALUE 'N'.    00990007
009400         88  PS-COMMENTS-LEFT                       VALUE 'Y'.    01000007
009500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01010001
009600         88  PS-NO-ERROR                            VALUE 'Y'.    01020001
009700         88  PS-ERROR                               VALUE 'N'.    01030001
010100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01100001
010200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01110001
010300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01120001
011000*                                                                 01160001
011100 01  PV-PROGRAM-VARIABLES.                                        01170001
011300     05  PV-NUMBER-OF-EXTRA-LINES       PIC S9(09) COMP.          01180003
012208     05  PV-DISPLAY-COMP1               PIC  9(09).               01380001
012208     05  PV-CURRENT-DATE                PIC  X(10).               01380001
012209     05  PV-DATE-ISO.                                             01390001
012210         10  PV-DATE-CC-ISO             PIC  X(02).               01400002
012211         10  PV-DATE-YY-ISO             PIC  X(02).               01410002
012212         10  FILLER                     PIC  X VALUE '-'.         01420013
012300         10  PV-DATE-MM-ISO             PIC  X(02).               01430002
012400         10  FILLER                     PIC  X VALUE '-'.         01440013
012500         10  PV-DATE-DD-ISO             PIC  X(02).               01450002
013000     05  PV-DATE-USA-WORK.                                        01500012
013100         10  PV-DATE-MM-UWORK           PIC  X(02).               01510002
013200         10  FILLER                     PIC  X VALUE '/'.         01520001
013300         10  PV-DATE-DD-UWORK           PIC  X(02).               01530002
013400         10  FILLER                     PIC  X VALUE '/'.         01540001
013500         10  PV-DATE-CC-UWORK           PIC  X(02).               01550002
013600         10  PV-DATE-YY-UWORK           PIC  X(02).               01560002
013701     05  PV-DATE-USA.                                             01571012
013702         10  PV-DATE-MM-USA             PIC  X(02).               01572012
013703         10  FILLER                     PIC  X VALUE '/'.         01573012
013704         10  PV-DATE-DD-USA             PIC  X(02).               01574012
013705         10  FILLER                     PIC  X VALUE '/'.         01575012
013706         10  PV-DATE-CC-USA             PIC  X(02).               01576012
013707         10  PV-DATE-YY-USA             PIC  X(02).               01577012
013708                                                                  01578012
013800     05  PV-TIMESTAMP           PIC X(26).                        01580001
013900     05  PV-TIMESTAMP-SPLIT.                                      01590001
014000         10  FILLER             PIC X(14).                        01600001
014100         10  PV-MINUTE          PIC X(02).                        01610001
014200         10  FILLER             PIC X(02).                        01620001
014300         10  PV-SECOND          PIC X(01).                        01630001
014400         10  FILLER             PIC X(01).                        01640001
014500         10  PV-NANOSEC-1-3     PIC X(03).                        01650001
014600         10  PV-NANOSEC-4-6     PIC X(03).                        01660001
014700                                                                  01670001
014800     05  PV-RANDOM-KEY          PIC 9(09).                        01680001
014900     05  FILLER REDEFINES PV-RANDOM-KEY.                          01690001
015000         10  PV-RND-NANOSEC-4-6 PIC X(03).                        01700001
015100         10  PV-RND-NANOSEC-1-3 PIC X(03).                        01710001
015200         10  PV-RND-MINUTE      PIC X(02).                        01720001
015300         10  PV-RND-SECOND      PIC X(01).                        01730001
015400                                                                  01740001
016300     05  PV-SUB                         PIC S9(04)  VALUE +0      01830001
016400                                                    COMP SYNC.    01840001
016500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01850001
016600                                                    COMP SYNC.    01860001
016700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01870001
016800                                                    COMP-3.       01880001
016900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01890001
017000                                                    COMP-3.       01900001
017100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01910001
017200                                                    COMP-3.       01920001
017300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01930001
017400                                                    COMP-3.       01940001
017500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01950001
017600                                                    COMP-3.       01960001
017700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01970001
017800                                                    COMP-3.       01980001
018100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02010001
018200                                                    COMP SYNC.    02020001
018300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02030001
018400                                                    COMP SYNC.    02040001
018500     05  PV-ITEM                        PIC S9(04)  VALUE +0      02050001
018600                                                    COMP SYNC.    02060001
018700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02070001
018800                                                    COMP SYNC.    02080001
018900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02090001
019000                                                    COMP SYNC.    02100001
019100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02110001
019200                                                    COMP SYNC.    02120001
019300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02130001
019400                                                    COMP SYNC.    02140001
021100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02310001
021200                                                    COMP SYNC.    02320001
021200                                                                  02320001
021300******************************************************************02330001
021400**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02340001
021500**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02350001
021600**  APPLICATION-SPECIFIC COMMAREA.                              **02360001
021700******************************************************************02370001
021800 01  LQW-LIST-QUEUE-WORK-AREA.                                    02380001
021900     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02390001
022000     05  LQW-ITEM-ENTRIES               OCCURS 05 TIMES           02400001
022100                                        INDEXED BY LQW-IDX.       02410001
022200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02420001
041300         10  LQW-COMMENT-SEQ-NBR        PIC S9(04)  COMP.         02430002
041301         10  LQW-COMMENT-LINE           PIC  X(50).               02440011
041302         10  LQW-COMMENT-MOD-SW         PIC  X(01).               02450003
041303             88 LQW-COMMENT-NO-UPD      VALUE ' '.                02460003
041304             88 LQW-COMMENT-UPD         VALUE 'U'.                02461003
041305             88 LQW-COMMENT-DEL         VALUE 'D'.                02462003
041306                                                                  02470001
041308*---------------------------------------------------------------* 02490001
041309*  RECORD LAYOUT FOR THE LINE SELECTION TEMP STORAGE QUEUE.     * 02500001
041310*---------------------------------------------------------------* 02510001
041312     COPY VLWS006.                                                02530024
041313                                                                  02540001
041315*---------------------------------------------------------------* 02630001
041316*    MAP LAYOUT                                                 * 02640001
041317*---------------------------------------------------------------* 02650001
041319     COPY VLKM505.                                                02670001
041320*                                                                 02680001
041321 01  MR-OCCURS-LAYOUT                   REDEFINES  VL505AO.       02690007
041322     05  FILLER                         PIC X(182).               02700026
041323     05  MR-SCROLL-AREA                 OCCURS 05 TIMES.          02710001
041324         10  MR-COMMENT-LINEL           PIC S9(04) COMP.          02710103
041325         10  MR-COMMENT-LINEA           PIC  X(01).               02710203
041326         10  MR-COMMENT-LINEC           PIC  X(01).               02711003
041327         10  MR-COMMENT-LINEH           PIC  X(01).               02720003
041328         10  MR-COMMENT-LINE            PIC  X(50).               02730011
041329                                                                  02830001
041332*---------------------------------------------------------------* 02860001
041333*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02870001
041334*---------------------------------------------------------------* 02880001
041336     COPY DPWS015.                                                02900001
041337                                                                  02910001
041338*---------------------------------------------------------------* 02920001
041339*    FUNCTION KEYS COPYBOOK.                                    * 02930001
041340*---------------------------------------------------------------* 02940001
041342     COPY DPWS016.                                                02960001
041343                                                                  02970001
041345*---------------------------------------------------------------* 02980101
041346*    CALENDER ROUTINE WORKING STORAGE                           * 02980207
041347*---------------------------------------------------------------* 02980301
041349     COPY DPWS500.                                                02980508
041360                                                                  02980707
041370*---------------------------------------------------------------* 02980807
041380*    NUMERIC EDIT LAYOUT.                                       * 02980907
041390*---------------------------------------------------------------* 02981007
041500     COPY DPWS010I.                                               02981207
041501                                                                  02981307
041502*---------------------------------------------------------------* 02981401
041503*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API           * 02981501
041504*---------------------------------------------------------------* 02981601
041506     COPY DPWS030.                                                02982001
CICS       COPY DPWS930.                                                02982001
041507                                                                  02983001
041509*---------------------------------------------------------------* 02985001
041510*    STANDARD COMMAREA.                                         * 02986001
041511*---------------------------------------------------------------* 02987001
041513     COPY DPWS020.                                                02989001
041514     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02990001
041515                                                                  03000001
041516*---------------------------------------------------------------* 03010001
041517* INTER-APPLICATION COMMAREA.                                   * 03020001
041518*   VLWS005 - IS THE INPUT LAYOUT WHEN COMING FROM THE PURCHASE * 03030024
041519*             ORDER ADD/UPDATE PROGRAM (VLKCS003)               * 03040001
041520*   VLWS005 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03050024
041521*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03060001
041522*---------------------------------------------------------------* 03070001
041524         10  INTER-APPL-COMM-AREA       PIC X(200).               03090001
041525     COPY VLWS005.                                                03100024
041523                                                                  03080001
041526*---------------------------------------------------------------* 03110001
041527*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03120001
041528*---------------------------------------------------------------* 03130001
041529         10  ASC-SPECIFIC-COMMAREA.                               03140001
041530             15  ASC-PO-REQ-NBR                      PIC S9(09)   03150001
041531                                                     COMP.        03160001
041532             15  ASC-ENT-ID                          PIC S9(09)   03170001
041533                                                     COMP.        03180001
041532             15  ASC-CMNT-ID                         PIC S9(09)   03170001
041533                                                     COMP.        03180001
041534             15  ASC-MAX-COMMENT-SEQ-NBR             PIC S9(04)   03181003
041535                                                     COMP.        03182003
041536             15  ASC-CURRENT-DATE                    PIC  X(10).  03183008
041537             15  ASC-SCREEN-FIELDS.                               03190001
041538                 20  ASC-PO-NUMBER                   PIC S9(09)   03200001
041539                                                     COMP.        03210001
041540                 20  ASC-DPT-NBR                     PIC  X(03).  03212001
041541                 20  ASC-REQUEST-DATE                PIC  X(10).  03212101
041542                 20  ASC-VENDOR-DUE-DATE             PIC  X(10).  03213001
041543                 20  ASC-VENDOR-NAME                 PIC  X(40).  03213101
041544                 20  ASC-PRINT-DUE-DATE              PIC  X(10).  03214001
041545                 20  ASC-REQ-STAT-CDE                PIC  X(01).  03220001
286900                     88 ASC-VALID-STATUS                          03231001
286901                        VALUE 'A', 'H', 'R', 'I'.                 03232025
286902                     88 ASC-ACTIVE-STATUS             VALUE 'A'.  03233001
286903                     88 ASC-CANCELLED-STATUS          VALUE 'C'.  03240001
286904                     88 ASC-HOLD-STATUS               VALUE 'H'.  03250001
286905                     88 ASC-INPROCESS-STATUS          VALUE 'I'.  03260001
286906                     88 ASC-PRINT-STATUS              VALUE 'P'.  03270001
286907                     88 ASC-RUSH-STATUS               VALUE 'R'.  03280001
286908                     88 ASC-SHIPPED-STATUS            VALUE 'S'.  03290001
286909                 20  ASC-PRIORITY.                                03356015
286910                     25 ASC-PRIORITY-N               PIC  9(02).  03357015
286911             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03390001
286912                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03400001
286913                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03410001
286914                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03420001
286915                                                                  03430001
286916                 20  ASC-ITEM-ARRAY.                              03440001
286917                     25  ASC-ITEM-ENTRIES OCCURS 05 TIMES.        03450001
286918                         30  ASC-LIST-ITEM-NUMBER                 03460001
286919                                                     PIC S9(09)   03470001
286920                                                     COMP-3.      03480001
286921                         30  ASC-COMMENT-SEQ-NBR     PIC S9(04)   03490002
286922                                                         COMP.    03491002
286923                         30  ASC-COMMENT-LINE        PIC  X(50).  03500011
286924                         30  ASC-COMMENT-MOD-SW      PIC  X(01).  03531003
286925                             88 ASC-COMMENT-NO-UPD   VALUE ' '.   03531103
286926                             88 ASC-COMMENT-UPD      VALUE 'U'.   03531203
286927                             88 ASC-COMMENT-DEL      VALUE 'D'.   03531303
286928                                                                  03532003
286929             15  ASC-BLK-SUB                         PIC S9(04)   03540001
286930                                                          COMP    03550001
286931                                                          SYNC.   03560001
286932             15  ASC-ITEM-SUB                        PIC S9(04)   03570001
286933                                                          COMP    03580001
286934                                                          SYNC.   03590001
286935             15  ASC-SEL-SUB                         PIC S9(04)   03600001
286936                                                         COMP.    03610001
286937             15  ASC-SEL-ITEM                        PIC S9(04)   03620001
286938                                                         COMP.    03630001
286939             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  03640001
286940                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03650001
286941             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03660001
286942                                                          COMP-3. 03670001
286943             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03680001
286944                                                          COMP-3. 03690001
286945             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   03700001
286946                                                          COMP-3. 03710001
286947             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03720001
286948                                                          COMP-3. 03730001
286949             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03740001
286950                                                          COMP-3. 03750001
286951             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03760001
286952                                                          COMP-3. 03770001
286953             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03780001
286954                                                          COMP    03790001
286955                                                          SYNC.   03800001
286956             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03810001
286957                                                          COMP-3. 03820001
286958             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03830001
286959                                                          COMP-3. 03840001
286960             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03850001
286961                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03860001
286962                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03870001
286963             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03880001
286964                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03890001
286965                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03900001
286966             15  ASC-LIST-QUEUE-NAME.                             03910001
286967                 20  ASC-LIST-TERM-ID                PIC  X(04).  03920001
286968                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03930001
286969                                                          COMP-3. 03940001
286970                 20  ASC-LIST-SEQ                    PIC  9(01).  03950001
286971             15  ASC-SEL-QUEUE-NAME.                              03960001
286972                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03970001
286973                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03980001
286974                                                          COMP-3. 03990001
286975                 20  ASC-SEL-SEQ                     PIC  9(01).  04000001
286976                                                                  04010001
286977             15  ASC-START-ITEM-REQUEST.                          04020001
286978                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04030001
286979                                                                  04040001
286980*---------------------------------------------------------------* 04050001
286981*    ABEND PROCESSING COPYBOOK.                                 * 04060001
286982*---------------------------------------------------------------* 04070001
286984     COPY DPWS013.                                                04090001
286985                                                                  04100001
286994*---------------------------------------------------------------* 04190001
286995*    DB2 AREA FOR THE PRETICKET COMMENT TABLE                   * 04200005
286996*---------------------------------------------------------------* 04210001
286997     EXEC SQL                                                     04220001
286998          INCLUDE TPTKCMT                                         04230005
286999     END-EXEC.                                                    04240001
287000                                                                  04250001
287001*---------------------------------------------------------------* 04251005
287002*    DB2 AREA FOR THE PRETICKET REQUEST/SHIPMENT ASSOCIATION TBL* 04252005
287003*---------------------------------------------------------------* 04253005
287004     EXEC SQL                                                     04254005
287005          INCLUDE TREQSHP                                         04255005
287006     END-EXEC.                                                    04256005
287007                                                                  04257005
287008*---------------------------------------------------------------* 04260001
287009*    DB2 AREA FOR THE PRETICKET REQUEST SHIPMENT TABLE          * 04270001
287010*---------------------------------------------------------------* 04280001
287011     EXEC SQL                                                     04290001
287012          INCLUDE TPTKSHP                                         04300001
287013     END-EXEC.                                                    04310001
287014                                                                  04320001
287015*---------------------------------------------------------------* 04321001
287016*    DB2 AREA FOR THE PRETICKET REQUEST HEADER TABLE            * 04322001
287017*---------------------------------------------------------------* 04323001
287018     EXEC SQL                                                     04324001
287019          INCLUDE TPTKREQ                                         04325001
287020     END-EXEC.                                                    04326001
287021                                                                  04327001
287036*---------------------------------------------------------------* 04391501
287037*    DB2 AREA FOR THE EXTERNAL ENTERPRISE NAME TABLE            * 04391601
287038*---------------------------------------------------------------* 04391701
287039     EXEC SQL                                                     04391801
287040          INCLUDE TENTNME                                         04391901
287041     END-EXEC.                                                    04392001
287042                                                                  04392101
287043*---------------------------------------------------------------* 04392201
287044*    DB2 AREA FOR THE PRETICKET REQUEST LINE ITEM TABLE         * 04392301
287045*---------------------------------------------------------------* 04392401
287046     EXEC SQL                                                     04392501
287047          INCLUDE TPTKLNE                                         04392601
287048     END-EXEC.                                                    04392701
287049                                                                  04392801
287050*---------------------------------------------------------------* 04392901
287051*    DB2 AREA FOR COMMUNICATIONS                                * 04393001
287052*---------------------------------------------------------------* 04394001
287053     EXEC SQL                                                     04395001
287054          INCLUDE SQLCA                                           04396001
287055     END-EXEC.                                                    04397001
287056                                                                  04398001
287058*---------------------------------------------------------------* 04400001
287059* COMMENT_CURSOR - GETS THE DETAIL OF ALL THE COMMENTS  FOR THIS* 04410002
287060* PURCHASE ORDER.                                               * 04420001
287061*---------------------------------------------------------------* 04430001
287063     EXEC SQL                                                     04450001
287064          DECLARE COMMENT_CURSOR CURSOR                           04460002
287065          FOR SELECT                                              04470001
287066                B.SEQ_NBR                                         04480002
287067              , B.PRE_TKT_CMNT_DESC                               04490002
287067              , A.CMNT_ID                                         04490002
287068          FROM                                                    04520001
287069                TPTKREQ A                                         04530002
287069              , TPTKCMT B                                         04530002
287070          WHERE                                                   04570001
287071                A.PO_REQ_NBR     = :DK-PO-REQ-NBR                 04580001
                  AND A.CMNT_ID        = B.CMNT_ID                              
287072          ORDER BY 1                                              04640001
287074     END-EXEC.                                                    04660001
287075                                                                  04670001
287077 LINKAGE SECTION.                                                 04690001
287078                                                                  04700001
287079 01  DFHCOMMAREA.                                                 04710001
287080     05  FILLER                         OCCURS  1 TO 4072 TIMES   04720001
287081                                        DEPENDING ON EIBCALEN.    04730001
287082         10  FILLER                     PIC X.                    04740001
287083                                                                  04750001
287085 PROCEDURE DIVISION.                                              04770001
287086******************************************************************04780001
287087**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04790001
287088**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04800001
287089**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04810001
287090******************************************************************04820001
287091 0000-MAIN-MODULE.                                                04830001
287092     INITIALIZE DP030-CICS-API-FIELDS.                            04840001
287093     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04850001
287094     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04860001
287095     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04870001
287096     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04880001
287097     MOVE LENGTH OF VL505AI        TO DP030-MAP-LENGTH (1).       04890007
287098     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04900001
287099     PERFORM 0001-CALL-CICS-ARCH-API.                             04910001
287100*                                                                 04920001
287101     PERFORM 1000-CONTROL-PROCESSING                              04930001
287102*                                                                 04940001
287103     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04950001
287104     PERFORM 0001-CALL-CICS-ARCH-API.                             04960001
287105                                                                  04970001
287106******************************************************************04980001
287107**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04990001
287108**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05000001
287109******************************************************************05010001
287110 0001-CALL-CICS-ARCH-API.                                         05020001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
287112                                    DFHCOMMAREA                           
287113                                    DP030-CICS-API-FIELDS                 
287114                                    DP020-STANDARD-COMMAREA               
287115                                    VL505AI.                              
287116*                                                                 05080001
287117     IF  DP030-RC-CALL-SUCCESSFUL                                 05090001
287118         CONTINUE                                                 05100001
287119     ELSE                                                         05110001
287120         SET DP013-NO-ROLLBACK                                    05120001
287121             DP013-XCTL-DISPLAY-RESTART                           05130001
287122             DP013-CICS-ABEND      TO TRUE                        05140001
287123         MOVE '0001-CALL-CICS-ARCH-API'                           05150001
287124                                   TO DP013-PARAGRAPH             05160001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
287127         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05190001
287128         PERFORM DP013-0000-PROCESS-ABEND                         05200001
287129     END-IF.                                                      05210001
287139                                                                  05310001
287130*----------------------------------------------------------------*05220001
287131* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05230001
287132* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05240001
287133*                                                                *05250001
287134* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05260001
287135*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05270001
287136*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05280001
287137*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05290001
287138*----------------------------------------------------------------*05300001
287140 1000-CONTROL-PROCESSING.                                         05320001
287142     EVALUATE TRUE                                                05340001
287143         WHEN DP020-NEXT-ACT-INITIAL                              05350001
287144             INITIALIZE ASC-SPECIFIC-COMMAREA                     05360001
287145             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05370001
287146                                      ASC-SEL-TERM-ID             05380001
287147             MOVE DP020-SRC-TASK-NUMBER                           05390001
287148                                   TO ASC-LIST-TASK-NUMBER        05400001
287149                                      ASC-SEL-TASK-NUMBER         05410001
287150             MOVE DP020-INT-APPL-FORMAT-IND                       05420001
287151                                   TO  PC-FORMAT-INDICATOR        05430001
287152             MOVE PC-LIST-QUEUE-SEQ                               05440001
287153                                   TO ASC-LIST-SEQ                05450001
287154             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05460001
287155             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05470001
287156***-----$TEMPLATE NOTE$-------------------------------------------05480001
287157*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05490001
287158*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05500001
287159*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05510001
287160***---------------------------------------------------------------05520001
287161             IF  PS-COMMAREA-NOT-VALID                            05530001
287162                 MOVE PC-TSYMSG-99901                             05540001
287163                                   TO DP020-MSG-NUMBER            05550001
287164                 SET DP020-MSG-FATAL                              05560001
287165                                   TO TRUE                        05570001
287166                 SET DP020-NEXT-ACT-APPL-ERROR                    05580001
287167                                   TO TRUE                        05590001
287168             ELSE                                                 05600001
287169                 PERFORM 4000-BUILD-INITIAL-PANEL                 05610001
287170             END-IF                                               05620001
287172         WHEN DP020-NEXT-ACT-READ-MAP                             05640001
287173             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05650001
287174                                   TO PV-TOP-ITEM                 05660001
287175             PERFORM 2000-PROCESS-PANEL                           05670001
287177         WHEN DP020-NEXT-ACT-RETURN                               05690001
287178             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05700001
287179                                   TO PV-TOP-ITEM                 05710001
287180             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05720001
287181             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05730001
287182             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05740001
287184         WHEN OTHER                                               05760001
287185             SET DP013-LOGIC-ABEND TO TRUE                        05770001
287186             SET DP013-NO-ROLLBACK TO TRUE                        05780001
287187             MOVE '1000-CONTROL-PROCESSING'                       05790001
287188                                   TO DP013-PARAGRAPH             05800001
287189             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05810001
287190                                   TO DP013-MESSAGE-TEXT(1)       05820001
287191             PERFORM DP013-0000-PROCESS-ABEND                     05830001
287192     END-EVALUATE.                                                05840001
287193                                                                  05850001
287195*----------------------------------------------------------------*05870001
287196* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05880001
287197* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05890001
287198*----------------------------------------------------------------*05900001
287200 1100-PROCESS-INTER-APPL-COMM.                                    05920001
287202     SET PS-COMMAREA-VALID         TO TRUE.                       05940001
287203     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05950001
287204     EVALUATE TRUE                                                05960001
287205         WHEN PC-LIST-FORMAT-IND                                  06050001
287206             SET ASC-USE-SELECTION-QUEUE TO TRUE                  06060001
287207             MOVE VL005-NUMBER-OF-TS-ITEMS                        06070024
287208                               TO ASC-NUMBER-OF-TS-ITEMS          06080001
287209             MOVE VL005-SEL-QUEUE-NAME                            06090024
287210                               TO ASC-SEL-QUEUE-NAME              06100001
287211             PERFORM 1120-PREPARE-LIST-ENTRY                      06110001
287212         WHEN OTHER                                               06120001
287213             SET PS-COMMAREA-NOT-VALID TO TRUE                    06130001
287214     END-EVALUATE.                                                06140001
287215                                                                  06150001
287216*----------------------------------------------------------------*06160001
287217*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *06170001
287218*----------------------------------------------------------------*06180001
287220 1120-PREPARE-LIST-ENTRY.                                         06200001
287222     MOVE VL006-MAX-ITEMS TO ASC-SEL-SUB.                         06220024
287223     MOVE ZERO            TO ASC-SEL-ITEM.                        06230001
287224     PERFORM 1130-GET-NEXT-REQUEST.                               06240001
287225                                                                  06250001
287226*----------------------------------------------------------------*06260001
287227*    GET THE NEXT REQUEST IF A LIST OF REQUESTS IS BEING         *06270001
287228*    PROCESSED.                                                  *06280001
287229*----------------------------------------------------------------*06290001
287231 1130-GET-NEXT-REQUEST.                                           06310001
287233     ADD +1                       TO ASC-SEL-SUB.                 06330001
287234     IF  ASC-SEL-SUB > VL006-MAX-ITEMS                            06340024
287235         ADD +1                   TO ASC-SEL-ITEM                 06350001
287236         MOVE +1                  TO ASC-SEL-SUB                  06360001
287237     END-IF.                                                      06370001
287238     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                06380001
287239         PERFORM 9100-READ-SEL-QUEUE                              06390001
287240         IF  VL006-ITEM (ASC-SEL-SUB) > ZERO                      06400024
287241                                                                  06410001
287242             MOVE VL006-PO-REQ-NBR (ASC-SEL-SUB)                  06420024
287243                                       TO ASC-PO-REQ-NBR          06430001
287244                                          DK-PO-REQ-NBR           06440001
287245             MOVE VL006-ENT-ID (ASC-SEL-SUB)                      06450024
287246                                       TO ASC-ENT-ID              06460001
287247                                          DK-ENT-ID               06470001
287248             SET VL006-INQ (ASC-SEL-SUB) TO TRUE                  06480024
287249             PERFORM 9200-REWRITE-SEL-QUEUE                       06490001
287250         ELSE                                                     06500001
287251             SUBTRACT +1 FROM ASC-SEL-SUB                         06510001
287252             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             06520001
287253             SET DP020-MSG-INFORMATIONAL TO TRUE                  06530001
287254         END-IF                                                   06540001
287255     ELSE                                                         06550001
287256         SUBTRACT +1 FROM ASC-SEL-ITEM                            06560001
287257         MOVE VL006-MAX-ITEMS     TO ASC-SEL-SUB                  06570024
287258         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             06580001
287259         SET DP020-MSG-INFORMATIONAL TO TRUE                      06590001
287260     END-IF.                                                      06600001
287261                                                                  06610001
287264*----------------------------------------------------------------*06640001
287265* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06650001
287266* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06660001
287267* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06670001
287268* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06680001
287269* FUNCTION KEYS CAN GET THIS FAR.                                *06690001
287270*----------------------------------------------------------------*06700001
287272 2000-PROCESS-PANEL.                                              06720001
287273     EVALUATE TRUE                                                06730001
287274         WHEN DP020-SRC-AID = DP016-CLEAR                         06740001
287275             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06750001
287276             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06760001
287278         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06780001
287279             MOVE ASC-PO-NUMBER    TO DK-PO-NUMBER                06790001
287280             MOVE ASC-PO-REQ-NBR   TO DK-PO-REQ-NBR               06800001
287281             MOVE ASC-ENT-ID       TO DK-ENT-ID                   06810001
287282             MOVE DP020-INT-APPL-FORMAT-IND                       06820001
287283                                   TO  PC-FORMAT-INDICATOR        06830001
287284             PERFORM 2050-DELETE-LIST-QUEUE                       06840001
287285             PERFORM 4000-BUILD-INITIAL-PANEL                     06850001
287288         WHEN OTHER                                               06880001
287289             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06880103
287290             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06880203
287291             IF  PS-NO-ERROR                                      06880303
287292                 SET DP030-CONTINUE-GO TO TRUE                    06880403
287294                 PERFORM 2100-CHECK-FUNCTION-KEY                  06880603
287295             ELSE                                                 06880703
287296                 SET DP030-OVERRIDE-GO TO TRUE                    06880803
287298             END-IF                                               06890003
287299     END-EVALUATE.                                                06900001
287300                                                                  06910001
287301*----------------------------------------------------------------*06920001
287302*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06930001
287303*----------------------------------------------------------------*06940001
287304 2050-DELETE-LIST-QUEUE.                                          06950001
287306     EXEC CICS                                                    06970001
287307         DELETEQ TS                                               06980001
287308             QUEUE (ASC-LIST-QUEUE-NAME)                          06990001
287309             RESP  (PV-CICS-RESP)                                 07000001
287310     END-EXEC.                                                    07010001
287311                                                                  07020001
287312     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07021001
287313        (PV-CICS-RESP = DFHRESP(QIDERR))                          07021101
287314         CONTINUE                                                 07021201
287315     ELSE                                                         07021301
287316         SET DP013-CICS-ABEND      TO TRUE                        07021401
287317         SET DP013-NO-ROLLBACK     TO TRUE                        07021501
287319         MOVE '2050-DELETE-LIST-QUEUE'                            07021701
287320                                   TO DP013-PARAGRAPH             07021801
287321         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07021901
287322                                   TO DP013-MESSAGE-TEXT (1)      07022001
287323         PERFORM DP013-0000-PROCESS-ABEND                         07022101
287324     END-IF.                                                      07022201
287325                                                                  07022301
287326     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07022401
287327                                                                  07022501
287328*----------------------------------------------------------------*07022601
287329* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07022701
287330* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07022801
287331* CICS ARCHITECTURE API.                                         *07022901
287332*----------------------------------------------------------------*07023001
287333 2100-CHECK-FUNCTION-KEY.                                         07024001
287334     EVALUATE TRUE                                                07025001
287336* UPDATE KEY WAS PRESSED                                          07030003
287337         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07040007
287338             PERFORM 7000-UPDATE-REQUEST                          07050007
287340* REASON KEY WAS PRESSED                                          07030003
287341         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              07040007
287342             MOVE ASC-PO-REQ-NBR TO VL005-PO-REQ-NBR                    01
287279             MOVE ASC-PO-NUMBER  TO VL005-PO-NUMBER               06790001
287345* ENTER KEY WAS PRESSED                                           07111003
287350         WHEN DP020-SRC-AID = DP016-ENTER                         07112003
287360             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07113003
287370             IF  PS-ERROR                                         07114003
287380                 CONTINUE                                         07115003
287390             ELSE                                                 07116003
287400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07117003
287500             END-IF                                               07118003
287503         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07130001
287504             PERFORM 2110-BROWSE-BACKWARD                         07140001
287505             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07150001
287507         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07170001
287508             PERFORM 2120-BROWSE-FORWARD                          07180001
287509             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07190001
287511         WHEN OTHER                                               07210001
287512             SET DP013-NO-ROLLBACK                                07220001
287513                 DP013-XCTL-DISPLAY-RESTART                       07230001
287514                 DP013-CICS-ABEND  TO TRUE                        07240001
287515             MOVE '2100-CHECK-FUNCTION-KEY'                       07250001
287516                                   TO DP013-PARAGRAPH             07260001
287517             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07270001
287518                                   TO DP013-MESSAGE-TEXT (1)      07280001
287519             PERFORM DP013-0000-PROCESS-ABEND                     07290001
287520     END-EVALUATE.                                                07300001
287530                                                                  07310001
287540*----------------------------------------------------------------*07320001
287550*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07330001
287560*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07340001
287570*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07350001
287580*    MESSAGE.                                                    *07360001
287590*----------------------------------------------------------------*07370001
287700 2110-BROWSE-BACKWARD.                                            07390001
287800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07400001
287900         GIVING PV-TOP-ITEM.                                      07410001
288000*                                                                 07420001
288100     IF  ((PV-TOP-ITEM < +1)                                      07430001
288200       OR (PV-TOP-ITEM = +1))                                     07440001
288300         MOVE +1                   TO PV-TOP-ITEM                 07450001
288400*        -- TOP OF LIST --                                        07460001
288500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07470001
288600         SET DP020-MSG-INFORMATIONAL TO TRUE                      07480001
288700     END-IF.                                                      07490001
288800                                                                  07500001
289000*----------------------------------------------------------------*07520001
289100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07530001
289200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07531001
289300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07532001
289400*----------------------------------------------------------------*07532101
289600 2120-BROWSE-FORWARD.                                             07532301
289800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07532501
289900         GIVING PV-TOP-ITEM.                                      07532601
290000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07532701
290100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07532801
290200                                   TO PV-TOP-ITEM                 07532901
290300*        -- BOTTOM OF LIST --                                     07533001
290400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07533101
290500         SET DP020-MSG-INFORMATIONAL                              07533201
290600                                   TO TRUE                        07533301
290700     ELSE                                                         07533401
290800         COMPUTE PV-BOTTOM-ITEM =                                 07533501
290900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07533601
291000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07533701
291100*            -- BOTTOM OF LIST --                                 07533801
291200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07533901
291300             SET DP020-MSG-INFORMATIONAL                          07534001
291400                                   TO TRUE                        07534101
291500         END-IF                                                   07534201
291600     END-IF.                                                      07534301
291700                                                                  07534401
291800*----------------------------------------------------------------*07534501
291900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07534601
292000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07534701
292100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07534801
292200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07534901
292300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07535001
292400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07535101
292500*----------------------------------------------------------------*07535201
292700 2130-CHECK-FOR-JUMP-BROWSE.                                      07535401
292800     SET PS-NO-ERROR               TO TRUE.                       07535501
292900     IF (ASC-START-ITEM-REQUEST = SPACE)                          07535601
293000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07535701
293100                                   TO PV-TOP-ITEM                 07535801
293200     ELSE                                                         07535901
293300         MOVE ASC-START-ITEM-REQUEST                              07536001
293400                                   TO DP010I-UNEDITED-FIELD       07536101
293500         MOVE +5                   TO DP010I-MAXIMUM-DIGITS       07536201
293600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07536301
293700         SET DP010I-NEGATIVE-NOT-ALLOWED                          07536401
293800                                   TO TRUE                        07536501
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
294000                                                                  07536701
294100         IF  NOT DP010I-ERROR-DETECTED                            07536801
294200             MOVE DP010I-NUMERIC-FIELD                            07536901
294300                                   TO  ASC-START-ITEM-REQUEST-N   07537001
294400             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07537101
294500                 IF  ASC-START-ITEM-REQUEST-N >                   07537201
294600                                          ASC-NUMBER-OF-ITEMS-READ07537301
294700                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07537401
294800                     COMPUTE PV-TOP-ITEM =                        07537501
294900                             ASC-NUMBER-OF-ITEMS-READ             07537601
295000                             - PC-ITEMS-PER-PANEL + 1             07537701
295100                     IF  PV-TOP-ITEM < +1                         07537801
295200                         MOVE +1   TO PV-TOP-ITEM                 07537901
295300                         MOVE PC-TSYMSG-00070                     07538001
295400                                   TO DP020-MSG-NUMBER            07538101
295500                         SET DP020-MSG-INFORMATIONAL              07538201
295600                                   TO TRUE                        07538301
295700                     END-IF                                       07538401
295800                 ELSE                                             07538501
295900                     MOVE ASC-START-ITEM-REQUEST-N                07538601
296000                                   TO PV-TOP-ITEM                 07538701
296100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07538801
296200                     COMPUTE PV-BOTTOM-ITEM =                     07538901
296300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07539001
296400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07539101
296500*                        -- BOTTOM OF LIST --                     07539201
296600                         MOVE PC-TSYMSG-00070                     07539301
296700                                   TO DP020-MSG-NUMBER            07539401
296800                         SET DP020-MSG-INFORMATIONAL              07539501
296900                                   TO TRUE                        07539601
297000                     END-IF                                       07539701
297100                 END-IF                                           07539801
297200             ELSE                                                 07539901
297300*                --- VALUE OUT OF RANGE ----                      07540001
297400                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         07540101
297600                 MOVE -1            TO ASTRTITL                   07540301
297700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07540401
297900                 MOVE DP015-REVERSE TO ASTRTITH                   07540601
298100                 MOVE DP015-RED     TO ASTRTITC                   07540801
298200                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           07540901
298400                 SET DP020-MSG-FATAL TO TRUE                      07541101
298600                 SET PS-ERROR       TO TRUE                       07541301
298700             END-IF                                               07541401
298900         ELSE                                                     07541601
299000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07541701
299100             MOVE -1               TO ASTRTITL                    07541801
299200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07541901
299300             MOVE DP015-REVERSE    TO ASTRTITH                    07542001
299400             MOVE DP015-RED        TO ASTRTITC                    07542101
299500             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               07542201
299700             SET DP020-MSG-FATAL   TO TRUE                        07542401
299800             SET PS-ERROR          TO TRUE                        07542501
299900         END-IF                                                   07542601
300000     END-IF.                                                      07542701
300001                                                                  07542801
300002******************************************************************07542903
300003** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **07543003
300004** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **07543103
300005******************************************************************07543203
300006 2200-MOVE-SCREEN-TO-COMMAREA.                                    07543303
300008     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             07543503
300009     MOVE +1                       TO PV-SUB.                     07543603
300010                                                                  07543703
300020     PERFORM 3100-SET-SUBSCRIPTS.                                 07543803
300021                                                                  07543903
300022     IF  APDDTEL > ZERO                                           07544003
300023         MOVE APDDTEI          TO PV-DATE-USA-WORK                07544112
300024         MOVE PV-DATE-CC-UWORK TO PV-DATE-CC-ISO                  07544212
300024         MOVE PV-DATE-YY-UWORK TO PV-DATE-YY-ISO                  07544212
300024         MOVE PV-DATE-MM-UWORK TO PV-DATE-MM-ISO                  07544212
300024         MOVE PV-DATE-DD-UWORK TO PV-DATE-DD-ISO                  07544212
300026         MOVE PV-DATE-ISO      TO ASC-PRINT-DUE-DATE              07544403
300027         MOVE 'A'              TO ASC-REQ-STAT-CDE                07544526
300028                                  ASTATO                          07544628
300029         MOVE 'ACTIVE'         TO ASTDESCO                        07544728
300030     ELSE                                                         07544803
300031         IF  APDDTEF = DP015-ERASE-EOF                            07544903
300032             MOVE ASC-CURRENT-DATE TO ASC-PRINT-DUE-DATE          07545022
300033             MOVE 'A'              TO ASC-REQ-STAT-CDE            07545126
300034                                      ASTATO                      07545228
300035         MOVE 'ACTIVE'             TO ASTDESCO                    07545328
300036         END-IF                                                   07545403
300037     END-IF.                                                      07545503
300038                                                                  07545626
300039     IF  APRTYL   > ZERO                                          07545726
300040         MOVE APRTYI           TO ASC-PRIORITY                    07545826
300050         MOVE 'A'              TO ASC-REQ-STAT-CDE                07545926
300060                                  ASTATO                          07546028
300061         MOVE 'ACTIVE'         TO ASTDESCO                        07546128
300062     ELSE                                                         07546226
300063         IF  APRTYF   = DP015-ERASE-EOF                           07546326
300064             INITIALIZE ASC-PRIORITY                              07546426
300065         END-IF                                                   07546526
300066     END-IF.                                                      07546626
300067                                                                  07546703
300068     IF  ASTATL > ZERO                                            07546803
300069         MOVE ASTATI           TO ASC-REQ-STAT-CDE                07546903
300070     ELSE                                                         07547003
300071         IF  ASTATF   = DP015-ERASE-EOF                           07547103
300072             INITIALIZE ASC-REQ-STAT-CDE                          07547203
300073         END-IF                                                   07547303
300074     END-IF.                                                      07547403
300075                                                                  07547503
300077     IF  ASTRTITL > ZERO                                          07547721
300078         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          07547821
300079     ELSE                                                         07547921
300080         IF  ASTRTITF = DP015-ERASE-EOF                           07548021
300081             INITIALIZE ASC-START-ITEM-REQUEST                    07548121
300082         END-IF                                                   07548221
300083     END-IF.                                                      07548321
300084                                                                  07548403
300085     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          07548503
300086         VARYING PV-SUB                                           07548603
300087         FROM 1 BY 1                                              07548703
300088         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      07548803
300076                                                                  07547603
300089******************************************************************07548903
300090** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**07549003
300091******************************************************************07549103
300092 2210-MOVE-LINES-TO-COMMAREA.                                     07550003
300093     IF  MR-COMMENT-LINEL (PV-SUB) > ZERO                         07550303
               IF MR-COMMENT-LINE (PV-SUB) = SPACES                             
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                         
                       ASC-COMMENT-DEL (ASC-BLK-SUB ASC-ITEM-SUB)               
                                         TO TRUE                                
               ELSE                                                             
300094             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 07550403
300095                 ASC-COMMENT-UPD(ASC-BLK-SUB ASC-ITEM-SUB)        07550603
300096                                   TO TRUE                        07550703
               END-IF                                                           
300097         MOVE MR-COMMENT-LINE (PV-SUB)                            07550903
300098                                   TO ASC-COMMENT-LINE            07551003
300099                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      07551103
300100     ELSE                                                         07551403
300101         IF  MR-COMMENT-LINEA (PV-SUB) = DP015-ERASE-EOF          07551503
300102                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)             07551603
300103                     ASC-COMMENT-DEL(ASC-BLK-SUB ASC-ITEM-SUB)    07551703
300104                                   TO TRUE                        07551803
300105                 MOVE SPACE        TO ASC-COMMENT-LINE            07551903
300106                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      07552003
300107         END-IF                                                   07552303
300108     END-IF.                                                      07552403
300110                                                                  07557203
300111     ADD +1                        TO ASC-ITEM-SUB.               07557303
300112     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        07557403
300113         ADD +1                    TO ASC-BLK-SUB                 07557503
300114         MOVE +1                   TO ASC-ITEM-SUB                07557603
300115     END-IF.                                                      07557703
300110                                                                  07557203
300116******************************************************************07557803
300117** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **07557903
300118** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **07558003
300119******************************************************************07558103
300120 3000-EDIT-DATA-IN-COMMAREA.                                      07558203
300122     SET PS-NO-ERROR               TO TRUE.                       07558403
300123     PERFORM 3200-RESET-ATTRIBUTES.                               07558503
300124     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     07558603
300125**                                                                07558703
300126* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              07558803
300127* EDITTING IS DONE FROM THE BOTTOM UP.                            07558903
300128**                                                                07559003
300129     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       07559103
300130         ASC-ITEMS-DISPLAYED - 1.                                 07559203
300131     PERFORM 3100-SET-SUBSCRIPTS.                                 07559303
300132                                                                  07560703
300133* EDIT THE PRIORITY NUMBER                                        07560803
300134     IF ASC-PRIORITY = SPACES                                     07560903
300135         MOVE '99'   TO ASC-PRIORITY                              07561003
300136     ELSE                                                         07561103
300137         MOVE ASC-PRIORITY         TO DP010I-UNEDITED-FIELD       07562503
300138         MOVE +2                   TO DP010I-MAXIMUM-DIGITS       07562603
300139         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07562703
300140         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07562803
300142                                                                  07563003
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
300144                                                                  07563203
300145         EVALUATE TRUE                                            07563303
300146           WHEN DP010I-NO-ERROR-DETECTED                          07563403
300147             CONTINUE                                             07563503
300148           WHEN DP010I-NEG-NOT-ALLOWED                            07565203
300149           WHEN DP010I-MAX-DIGITS-EXCEEDED                        07565303
300150              MOVE PC-TSYMSG-00342   TO DP020-MSG-NUMBER          07565403
300151              SET DP020-MSG-FATAL    TO TRUE                      07565503
300152              MOVE -1                TO APRTYL                    07565603
300153              SET DP030-SET-CURSOR-APPL-1                         07565703
300154                                     TO TRUE                      07565803
300155              MOVE DP015-RED         TO APRTYC                    07565903
300156              MOVE DP015-REVERSE     TO APRTYH                    07566003
300157              SET PS-ERROR TO TRUE                                07566103
300158           WHEN OTHER                                             07566203
300159              MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER          07566303
300160              SET DP020-MSG-FATAL    TO TRUE                      07566403
300161              MOVE -1                TO APRTYL                    07566503
300162              SET DP030-SET-CURSOR-APPL-1                         07566603
300163                                     TO TRUE                      07566703
300164              MOVE DP015-RED         TO APRTYC                    07566803
300165              MOVE DP015-REVERSE     TO APRTYH                    07566903
300166              SET PS-ERROR TO TRUE                                07567003
300167         END-EVALUATE                                             07567103
300168     END-IF.                                                      07567203
300169                                                                  07567303
300170* EDIT THE STATUS CODE                                            07567403
300171     IF ASC-VALID-STATUS                                          07567503
300172         CONTINUE                                                 07570526
300173     ELSE                                                         07570603
300174         MOVE PC-TSYMSG-01354   TO DP020-MSG-NUMBER               07570725
300175         SET DP020-MSG-FATAL    TO TRUE                           07570803
300176         MOVE -1                TO ASTATL                         07570903
300177         SET DP030-SET-CURSOR-APPL-1                              07571003
300178                                TO TRUE                           07571103
300179         MOVE DP015-RED         TO ASTATC                         07571203
300180         MOVE DP015-REVERSE     TO ASTATH                         07571303
300181         SET PS-ERROR TO TRUE                                     07571403
300182     END-IF.                                                      07571503
300183                                                                  07571629
339402     EVALUATE TRUE                                                07571729
339403         WHEN ASC-ACTIVE-STATUS                                   07571829
339404             MOVE 'ACTIVE'         TO ASTDESCO                    07571929
339406         WHEN ASC-CANCELLED-STATUS                                07572129
339407             MOVE 'CANCELED'       TO ASTDESCO                    07572229
339409         WHEN ASC-HOLD-STATUS                                     07572429
339410             MOVE 'HOLD'           TO ASTDESCO                    07572529
339412         WHEN ASC-INPROCESS-STATUS                                07572729
339413             MOVE 'INPROCESS'      TO ASTDESCO                    07572829
339415         WHEN ASC-PRINT-STATUS                                    07573029
339416             MOVE 'PRINTED'        TO ASTDESCO                    07573129
339418         WHEN ASC-RUSH-STATUS                                     07573329
339419             MOVE 'RUSH'           TO ASTDESCO                    07573429
339421         WHEN ASC-SHIPPED-STATUS                                  07573629
339422             MOVE 'SHIPPED'        TO ASTDESCO                    07573729
339424         WHEN OTHER                                               07573929
339425             MOVE SPACES           TO ASTDESCO                    07574029
339426     END-EVALUATE.                                                07574129
339427                                                                  07574203
339428* EDIT THE PRINT DUE DATE                                         07574303
339432     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              07574703
339432                                                                  07574703
339433     SET DPG51-ACTUAL-CALENDAR-ONLY                               07574803
339434         DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                    07574903
339435                                                                  07575003
339436     MOVE ASC-PRINT-DUE-DATE          TO DPG52-LK-DATE-INPUT.     07575203
339437     SET DPG52-LK-DTE-ISO-FMT         TO TRUE.                    07575303
339438                                                                  07575403
339439     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    07575503
339440                                             DPG54 DPG55 DPG56.   07575603
339441                                                                  07575703
339442     EVALUATE TRUE                                                07575803
339443         WHEN DPG54-NO-ERROR                                      07575903
339444             IF ASC-PRINT-DUE-DATE  < ASC-CURRENT-DATE            07576115
339445*                DISPLAY VENDOR DATE B4 CURRENT ERROR MSG         07576203
339446*                CHANGE COLOR BELOW!!!!!!!                        07576303
339447                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07576403
339449                 MOVE PC-TSYMSG-01395     TO DP020-MSG-NUMBER     07576630
339450                 MOVE -1                  TO APDDTEL              07576703
339451                 MOVE DP015-REVERSE       TO APDDTEH              07576803
339452                 MOVE DP015-RED           TO APDDTEC              07576903
339453                 SET PS-ERROR                                     07577023
339454                     DP020-MSG-FATAL      TO TRUE                 07578023
339455             END-IF                                               07578703
339456         WHEN DPG54-DATE-INVALID                                  07578803
339457*            DISPLAY INVALID DATE ERROR MESSAGE                   07578903
339458             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 07579003
339459             MOVE PC-TSYMSG-01339         TO DP020-MSG-NUMBER     07579115
339460             MOVE -1                      TO APDDTEL              07579203
339461             MOVE DP015-REVERSE           TO APDDTEH              07579303
339462             MOVE DP015-RED               TO APDDTEC              07579403
339463             SET PS-ERROR                                         07579523
339464                 DP020-MSG-FATAL          TO TRUE                 07579623
339466             SET DP013-LOGIC-ABEND TO TRUE                        07579803
339467             SET DP013-NO-ROLLBACK TO TRUE                        07579903
339468             MOVE '3000-EDIT-DATA-IN-COMMAREA'                    07580003
339469                                   TO DP013-PARAGRAPH             07580103
339470             MOVE 'ERROR CALLING DPKUT500 DATE ROUTINE'           07580203
339471                                   TO DP013-MESSAGE-TEXT(1)       07580303
339472             MOVE DPG54-ERROR-MESSAGE                             07580403
339473                                   TO DP013-MESSAGE-TEXT(2)       07580503
339474             PERFORM DP013-0000-PROCESS-ABEND                     07580603
339475     END-EVALUATE.                                                07580703
339477                                                                  07582203
339478*----------------------------------------------------------------*07582303
339479*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *07582403
339480*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*07582503
339481*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *07582603
339482*                                                                *07582703
339483*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *07582803
339484*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *07582903
339485*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *07583003
339486*    US IN THE 2ND BLOCK OF THE ARRAY.                           *07583103
339487*----------------------------------------------------------------*07583203
339489 3100-SET-SUBSCRIPTS.                                             07583403
339491     COMPUTE ASC-ITEM-SUB =                                       07583603
339492         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        07583703
339493                                                                  07583803
339494     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         07583903
339495         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            07584003
339496                                                                  07584103
339497         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               07584203
339498     ELSE                                                         07584303
339499         MOVE +1                     TO ASC-BLK-SUB               07584403
339500     END-IF.                                                      07584503
339504                                                                  07584903
339501******************************************************************07584603
339502** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **07584703
339503******************************************************************07584803
339505 3200-RESET-ATTRIBUTES.                                           07585003
339507     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA                    07585203
339508                                      APDDTEA                     07585303
339509                                      ASTATA                      07585403
339510                                      APRTYA.                     07585503
339511     MOVE DP015-GREEN              TO ASTRTITC                    07585603
339512                                      APDDTEC                     07585703
339513                                      ASTATC                      07585803
339514                                      APRTYC.                     07585903
339515     MOVE DP015-UNDERLINE          TO ASTRTITH                    07586003
339516                                      APDDTEH                     07586103
339517                                      ASTATH                      07586203
339518                                      APRTYH.                     07586303
339519                                                                  07586403
339520     PERFORM                                                      07586503
339521         VARYING PV-SUB                                           07586603
339522         FROM 1 BY 1                                              07586703
339523         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        07586803
339524         MOVE DP015-UNP-ALP-NOR-OFF                               07586903
339525                              TO MR-COMMENT-LINEA (PV-SUB)        07587003
339526         MOVE DP015-GREEN     TO MR-COMMENT-LINEC (PV-SUB)        07587103
339527         MOVE DP015-UNDERLINE TO MR-COMMENT-LINEH (PV-SUB)        07587203
339528     END-PERFORM.                                                 07588003
339535                                                                  07600401
339529*----------------------------------------------------------------*07599801
339530*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *07599901
339531*    INITIALIZE ALL COUNTERS AND FLAGS.                          *07600001
339532*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *07600101
339533*    DISPLAY THE PANEL TO USER.                                  *07600201
339534*----------------------------------------------------------------*07600301
339536 4000-BUILD-INITIAL-PANEL.                                        07600501
339538     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             07600701
339539                                ASC-BLOCK-ENTRIES (2).            07600801
339540     MOVE +1                 TO ASC-BLK-SUB.                      07600901
339541     SET ASC-ITEMS-LEFT-ON-DB                                     07601001
339542         PS-COMMENTS-LEFT    TO TRUE.                             07610003
339543                                                                  07620001
339544     MOVE +0                 TO ASC-ITEM-SUB                      07630001
339545                                ASC-NUMBER-OF-ITEMS-READ          07640001
339546                                ASC-NUMBER-OF-SELECTED-ITEMS      07650001
339547                                ASC-HIGHEST-BLOCK-WRITTEN         07660001
339548                                ASC-START-OF-SELECTED-RANGE       07670001
339549                                ASC-END-OF-SELECTED-RANGE         07680001
339550                                ASC-ITEM-AT-TOP-OF-PANEL          07690003
339551                                PV-NUMBER-OF-EXTRA-LINES.         07691003
339552                                                                  07700001
339553     PERFORM 4030-GET-CURRENT-DATE.                               07701009
339554                                                                  07702009
339555* GET REQUEST INFORMATION                                         07710001
339556     PERFORM 4100-GET-REQUEST-INFO.                               07720001
339557                                                                  07730001
339558* LOAD ALL REQUEST SHIPMENTS INTO A QUEUE TO ALLOW DISPLAY        07780001
339560     PERFORM 4010-OPEN-CURSOR.                                    07810002
339562     PERFORM 4300-READ-ITEMS-FROM-DB.                             07830002
339564     PERFORM 4020-CLOSE-CURSOR.                                   07850002
339566     MOVE +1                   TO  PV-TOP-ITEM.                   07870002
339567     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          07880002
339568         SET DP020-MSG-INFORMATIONAL                              07890002
339569                               TO TRUE                            07900002
339570         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               07910002
339571     ELSE                                                         07920002
339572         SET DP030-SET-CURSOR-APPL-1                              07930002
339573                               TO TRUE                            07940002
339574     END-IF.                                                      07950002
339575                                                                  07960002
339576     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        07970001
339577                                                                  07980001
339578*----------------------------------------------------------------*07990001
339579* OPEN THE CURSOR                                                *08000001
339580*----------------------------------------------------------------*08010001
339581 4010-OPEN-CURSOR.                                                08020001
339583     PERFORM                                                      08040001
339584         WITH TEST AFTER                                          08050001
339585         VARYING PV-RETRY-COUNTER                                 08060001
339586         FROM 1 BY 1                                              08070001
339587         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08080001
339588                   OR (SQLCODE = ZERO))                           08090001
339590                                                                  08110001
339591         EXEC SQL                                                 08120001
339592             OPEN COMMENT_CURSOR                                  08130002
339593         END-EXEC                                                 08140001
339594                                                                  08150001
339595         EVALUATE TRUE                                            08160001
339596             WHEN SQLCODE = ZERO                                  08170001
339597             WHEN SQLCODE = -904                                  08180001
339598             WHEN SQLCODE = -913                                  08190001
339599                 CONTINUE                                         08200001
339600             WHEN SQLWARN0 NOT = SPACES                           08210001
339601             WHEN SQLCODE < ZERO                                  08220001
339602             WHEN SQLCODE > ZERO                                  08230001
339603                 MOVE '4010-OPEN-CURSOR'                          08240001
339604                                   TO DP013-PARAGRAPH             08250001
339605                 MOVE 'OPEN SHIPMENT CURSOR'                      08260001
339606                                   TO DP013-MESSAGE-TEXT (1)      08270001
339607                 MOVE SQLCA        TO DP013-SQLCA                 08280001
339608                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    08290001
339609                 MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)    08300001
339610                 SET DP013-DB2-ABEND                              08310001
339611                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08320001
339612                 PERFORM DP013-0000-PROCESS-ABEND                 08330001
339613         END-EVALUATE                                             08340001
339614     END-PERFORM.                                                 08350001
339615                                                                  08360001
339616     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08370001
339617         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             08380001
339618         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   08390001
339619                                   TO DP013-MESSAGE-TEXT (1)      08400001
339620         MOVE SQLCA                TO DP013-SQLCA                 08410001
339621         MOVE 'TREQSHP '           TO DP013-DB2-TABLE-NAME (1)    08420001
339622         MOVE 'TPTKSHP '           TO DP013-DB2-TABLE-NAME (2)    08430001
339623         SET DP013-DB2-ABEND                                      08440001
339624             DP013-XCTL-DISPLAY-RESTART TO TRUE                   08450001
339626         PERFORM DP013-0000-PROCESS-ABEND                         08470001
339627     END-IF.                                                      08480001
339628                                                                  08490001
339629*----------------------------------------------------------------*08500001
339630* CLOSE THE PO_ITEM_CURSOR.                                      *08510001
339631*----------------------------------------------------------------*08520001
339633 4020-CLOSE-CURSOR.                                               08540001
339635     EXEC SQL                                                     08560001
339636         CLOSE COMMENT_CURSOR                                     08570002
339637     END-EXEC                                                     08580001
339638                                                                  08590001
339639     EVALUATE TRUE                                                08600001
339640         WHEN SQLCODE = ZERO                                      08610001
339641             CONTINUE                                             08620001
339642         WHEN SQLWARN0 NOT = SPACES                               08630001
339643         WHEN SQLCODE < ZERO                                      08640001
339644         WHEN SQLCODE > ZERO                                      08650001
339645             MOVE '4020-CLOSE-CURSOR'                             08660001
339646                               TO DP013-PARAGRAPH                 08670001
339647             MOVE 'CLOSE COMMENT_CURSOR'                          08680002
339648                               TO DP013-MESSAGE-TEXT (1)          08690001
339649             MOVE SQLCA        TO DP013-SQLCA                     08700001
339650             MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)        08710001
339651             MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)        08720001
339652             SET DP013-DB2-ABEND                                  08730001
339653                 DP013-XCTL-DISPLAY-RESTART TO TRUE               08740001
339654             PERFORM DP013-0000-PROCESS-ABEND                     08750001
339655     END-EVALUATE.                                                08760001
339657                                                                  08780001
339658*----------------------------------------------------------------*08781009
339659* SET THE CURRENT DATE.                                          *08782009
339660*----------------------------------------------------------------*08783009
339662 4030-GET-CURRENT-DATE.                                           08785009
339664     EXEC SQL                                                     08787009
339665         SET :ASC-CURRENT-DATE = CURRENT DATE                     08788009
339666     END-EXEC                                                     08789009
339667                                                                  08789109
339668     EVALUATE TRUE                                                08789209
339669         WHEN SQLCODE = ZERO                                      08789309
339670             CONTINUE                                             08789409
339671         WHEN SQLWARN0 NOT = SPACES                               08789509
339672         WHEN SQLCODE < ZERO                                      08789609
339673         WHEN SQLCODE > ZERO                                      08789709
339674             MOVE '4030-GET-CURRENT-DATE'                         08789809
339675                               TO DP013-PARAGRAPH                 08789909
339676             MOVE SQLCA        TO DP013-SQLCA                     08790209
339677             SET DP013-DB2-ABEND                                  08790509
339678                 DP013-XCTL-DISPLAY-RESTART TO TRUE               08790609
339679             PERFORM DP013-0000-PROCESS-ABEND                     08790709
339680     END-EVALUATE.                                                08790809
339682                                                                  08791009
339683*----------------------------------------------------------------*08792001
339684*    SELECT THE PRETICKET REQUEST INFORMATION FROM THE PRETICKET *08800001
339685*    HEADER TABLE                                                *08810001
339686*----------------------------------------------------------------*08820001
339688 4100-GET-REQUEST-INFO.                                           08840001
339690     PERFORM                                                      08860001
339691         WITH TEST AFTER                                          08870001
339692         VARYING PV-RETRY-COUNTER                                 08880001
339693         FROM 1 BY 1                                              08890001
339694         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08900001
339695                   OR (SQLCODE = ZERO))                           08910001
339696                                                                  08920001
339697         EXEC SQL                                                 08930001
339698             SELECT                                               08940001
339699                   A.PO_NBR                                       08950001
339700                 , A.DEPT_NBR                                     08970002
339701                 , A.REQ_CREN_DTE                                 08980001
339702                 , A.VND_DUE_DTE                                  09000001
339703                 , B.ENT_NAME_DESC                                09010001
339704                 , A.PRT_BY_DTE                                   09010102
339705                 , A.REQ_STAT_CDE                                 09011002
339706                 , A.PRTY_STAT_CDE                                09012002
339707             INTO                                                 09020001
339708                   :PTKREQ-PO-NBR                                 09021002
339709                 , :PTKREQ-DEPT-NBR                               09022002
339710                 , :PTKREQ-REQ-CREN-DTE                           09023002
339711                 , :PTKREQ-VND-DUE-DTE                            09024002
339712                 , :ENTNME-ENT-NAME-DESC                          09025002
339713                 , :PTKREQ-PRT-BY-DTE                             09026002
339714                 , :PTKREQ-REQ-STAT-CDE                           09027002
339715                 , :PTKREQ-PRTY-STAT-CDE                          09028010
339716             FROM                                                 09100001
339717                  TPTKREQ A                                       09110001
339718                , TENTNME B                                       09120001
339719             WHERE                                                09130001
339720                   A.PO_REQ_NBR = :DK-PO-REQ-NBR                  09140001
339721               AND A.ENT_ID     = B.ENT_ID                        09150001
339722               AND B.TYPE_CDE   = '01'                            09160001
339723         END-EXEC                                                 09170001
339724                                                                  09180001
339725         EVALUATE TRUE                                            09190001
339726             WHEN SQLCODE = ZERO                                  09200001
339727                 MOVE PTKREQ-PO-NBR         TO ASC-PO-NUMBER      09210001
339728                                               DK-PO-NUMBER       09220001
339729                 MOVE PTKREQ-DEPT-NBR       TO ASC-DPT-NBR        09230007
339731                 MOVE PTKREQ-PRTY-STAT-CDE  TO ASC-PRIORITY-N     09241015
339732                 MOVE PTKREQ-REQ-CREN-DTE   TO ASC-REQUEST-DATE   09250011
339733                                                                  09310001
339734                 MOVE PTKREQ-PRT-BY-DTE     TO ASC-PRINT-DUE-DATE 09320011
339735                                                                  09350002
339736                 MOVE PTKREQ-VND-DUE-DTE    TO ASC-VENDOR-DUE-DATE09390011
339737                                                                  09450002
339738                 MOVE ENTNME-ENT-NAME-DESC  TO ASC-VENDOR-NAME    09460001
339739                                                                  09470001
339740                 MOVE PTKREQ-REQ-STAT-CDE   TO ASC-REQ-STAT-CDE   09480001
339741                                                                  09790001
339742             WHEN SQLCODE = -904                                  09800001
339743             WHEN SQLCODE = -913                                  09810001
339744                 CONTINUE                                         09820001
339746             WHEN SQLWARN0 NOT = SPACES                           09840001
339747             WHEN SQLCODE < ZERO                                  09850001
339748             WHEN SQLCODE > ZERO                                  09860001
339749                 MOVE '4100-GET-REQUEST-INFO'                     09870001
339750                                   TO DP013-PARAGRAPH             09880001
339751                 MOVE 'SELECT THE PRETICKET REQUEST INFORMATION'  09890001
339752                                   TO DP013-MESSAGE-TEXT (1)      09900001
339753                 MOVE DK-PO-REQ-NBR TO DP013-MESSAGE-TEXT (2)     09910001
339754                 MOVE SQLCA        TO DP013-SQLCA                 09920001
339755                 MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)    09930001
339756                 SET DP013-DB2-ABEND                              09940001
339757                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09950001
339758                 PERFORM DP013-0000-PROCESS-ABEND                 09960001
339759         END-EVALUATE                                             09970001
339760     END-PERFORM.                                                 09980001
339761*                                                                 09990001
339762     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10000001
339763         MOVE '4100-GET-REQUEST-INFO'                             10010001
339764                                   TO DP013-PARAGRAPH             10020001
339765         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING REQUEST INFO'   10030001
339766                                   TO DP013-MESSAGE-TEXT (1)      10040001
339767         MOVE DK-PO-REQ-NBR        TO DP013-MESSAGE-TEXT (2)      10050001
339768         MOVE SQLCA                TO DP013-SQLCA                 10060001
339769         MOVE 'TPTKREQ '           TO DP013-DB2-TABLE-NAME (1)    10070001
339770         SET DP013-DB2-ABEND                                      10080001
339771             DP013-XCTL-DISPLAY-RESTART                           10090001
339772                                   TO TRUE                        10100001
339773         PERFORM DP013-0000-PROCESS-ABEND                         10110001
339774     END-IF.                                                      10120001
339775                                                                  10130001
339778*----------------------------------------------------------------*12094001
339779*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *12095001
339780*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *12096001
339781*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *12097001
339782*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *12098001
339783*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *12099001
339784*                                                                *12100001
339785*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *12110001
339786*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *12120001
339787*    UPON INITIALIZATION.                                        *12130001
339788*----------------------------------------------------------------*12140001
339790 4300-READ-ITEMS-FROM-DB.                                         12160001
339792     PERFORM                                                      12180001
339793         VARYING PV-READ-COUNT                                    12190001
339794         FROM 1 BY 1                                              12200001
339795         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    12210001
339796            OR (PS-NO-COMMENTS-LEFT))                             12220015
339797                                                                  12230001
339798         IF ASC-ITEMS-LEFT-ON-DB                                  12231003
339799             PERFORM 4310-FETCH                                   12240003
339800         END-IF                                                   12241003
339801                                                                  12250001
339802* AFTER ALL THE EXISTING LINES HAVE BEEN READ, ADD BLANK LINES    12251003
339803* FOR THE USER TO ENTER NEW COMMENTS ON (PC-MAX-XTRA-LINES)       12252003
339804         IF  PS-COMMENTS-LEFT                                     12260003
339805             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                12270001
339806                 ADD +1            TO ASC-ITEM-SUB                12280001
339807             ELSE                                                 12290001
339808                 ADD +1            TO ASC-BLK-SUB                 12300001
339809                 MOVE +1           TO ASC-ITEM-SUB                12310001
339810                                                                  12320001
339811                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         12330001
339812                     MOVE +1       TO ASC-BLK-SUB                 12340001
339813                     SET ASC-BLOCK-MODIFIED (1)                   12350001
339814                                   TO TRUE                        12360001
339815                     PERFORM 5100-WRITE-TEMP-STORAGE              12370001
339816                     MOVE ASC-BLOCK-ENTRIES                       12380001
339817                               (PC-MAX-BLOCKS-IN-ARRAY)           12390001
339818                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 12400001
339819                     ADD +1        TO ASC-BLK-SUB                 12410001
339820                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   12420001
339821                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      12430001
339822                                   TO TRUE                        12440001
339823                 END-IF                                           12450001
339824             END-IF                                               12460001
339825             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    12470001
339826                                                                  12470103
339827             MOVE ASC-NUMBER-OF-ITEMS-READ                        12470216
339828                                   TO ASC-LIST-ITEM-NUMBER        12470316
339829                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12470416
339830* FOR EACH LINE ON THE DATABASE, MOVE IT TO THE SCREEN            12470503
339831             IF  ASC-ITEMS-LEFT-ON-DB                             12471003
339832                MOVE PTKCMT-SEQ-NBR                               12480003
339833                         TO  ASC-MAX-COMMENT-SEQ-NBR              12490003
339834                             ASC-COMMENT-SEQ-NBR                  12491003
339835                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12500001
339836                MOVE PTKCMT-PRE-TKT-CMNT-DESC                     12510003
339837                         TO  ASC-COMMENT-LINE                     12520003
339838                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12530001
339836                MOVE PTKCMT-CMNT-ID TO ASC-CMNT-ID                12510003
339839             ELSE                                                 12540003
339840* AFTER THE DATABASE IS READ, ADD 20 EXTRA LINES FOR THE USER TO  12541003
339841* ENTER NEW COMMENTS ON                                           12542007
339842                ADD +1   TO  PV-NUMBER-OF-EXTRA-LINES             12550003
339843                IF PV-NUMBER-OF-EXTRA-LINES = PC-MAX-XTRA-LINES   12551003
339844                    SET PS-NO-COMMENTS-LEFT TO TRUE               12553008
339845                END-IF                                            12554007
339846                MOVE +0  TO  ASC-COMMENT-SEQ-NBR                  12570003
339847                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12580003
339848                MOVE SPACES                                       12590003
339849                         TO  ASC-COMMENT-LINE                     12591003
339850                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12592003
339851             END-IF                                               12593003
339852         END-IF                                                   12600001
339853     END-PERFORM.                                                 12610001
339854                                                                  12620001
339855     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          12630001
339856         MOVE +1               TO ASC-BLK-SUB                     12640001
339857         PERFORM 5100-WRITE-TEMP-STORAGE                          12650001
339858         ADD +1                TO ASC-BLK-SUB                     12660001
339859         PERFORM 5100-WRITE-TEMP-STORAGE                          12670001
339860                                                                  12680001
339861         MOVE 1                TO ASC-BLK-SUB                     12690001
339862                                  PV-BLOCK-NUMBER                 12700001
339863         PERFORM 4410-READ-TEMP-STORAGE                           12710001
339864         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             12720001
339865             MOVE 2            TO ASC-BLK-SUB                     12730001
339866                                  PV-BLOCK-NUMBER                 12740001
339867             PERFORM 4410-READ-TEMP-STORAGE                       12750001
339868         END-IF                                                   12760001
339869     END-IF.                                                      12770001
339870                                                                  12780001
339872*----------------------------------------------------------------*12800001
339873*    FETCH THE MESSAGE CURSOR.                                   *12810001
339874*----------------------------------------------------------------*12820001
339876 4310-FETCH.                                                      12840001
339878     EXEC SQL                                                     12860001
339879          FETCH COMMENT_CURSOR                                    12870002
339880          INTO  :PTKCMT-SEQ-NBR                                   12871004
339881              , :PTKCMT-PRE-TKT-CMNT-DESC                         12872002
339881              , :PTKCMT-CMNT-ID                                   12872002
339882     END-EXEC                                                     12920001
339883                                                                  12930001
339884     EVALUATE TRUE                                                12940001
339885         WHEN SQLCODE = ZERO                                      12950001
339886         WHEN SQLCODE = +100                                      12960001
339887              CONTINUE                                            12970001
339888         WHEN SQLWARN0 NOT = SPACE                                12980001
339889         WHEN SQLCODE NOT = ZERO                                  12990001
339890              MOVE '4310-FETCH-CURSOR'                            13000001
339891                               TO DP013-PARAGRAPH                 13010001
339892              MOVE 'FETCH COMMENT_CURSOR'                         13020002
339893                               TO DP013-MESSAGE-TEXT (1)          13030001
339894              MOVE DK-PO-REQ-NBR                                  13040001
339895                               TO DP013-MESSAGE-TEXT (2)          13050001
339896              MOVE SQLCA       TO DP013-SQLCA                     13060001
339897              SET DP013-DB2-ABEND                                 13070001
339898                               TO TRUE                            13080001
339899              PERFORM DP013-0000-PROCESS-ABEND                    13090001
339900     END-EVALUATE.                                                13100001
339901                                                                  13110001
339902     IF  SQLCODE EQUAL +100                                       13120001
339903         SET ASC-NO-ITEMS-LEFT-ON-DB                              13130001
339904                                   TO TRUE                        13140001
339905     END-IF.                                                      13150001
339906                                                                  13160001
339908*----------------------------------------------------------------*13180001
339909* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *13190001
339910*----------------------------------------------------------------*13200001
339912 4400-MOVE-COMMAREA-TO-SCREEN.                                    13220001
339913     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             13230001
339914         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          13240001
339915         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          13250001
339916             MOVE +1    TO ASC-BLK-SUB                            13260001
339917             PERFORM 5100-WRITE-TEMP-STORAGE                      13270001
339918             ADD +1     TO ASC-BLK-SUB                            13280001
339919             PERFORM 5100-WRITE-TEMP-STORAGE                      13290001
339920             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             13300001
339921                 GIVING PV-BLOCK-NUMBER                           13310001
339922                 REMAINDER PV-REMAINDER                           13320001
339923             IF  PV-REMAINDER > ZERO                              13330001
339924                 ADD +1 TO PV-BLOCK-NUMBER                        13340001
339925             END-IF                                               13350001
339926             MOVE +1    TO ASC-BLK-SUB                            13360001
339927             PERFORM 4410-READ-TEMP-STORAGE                       13370001
339928             ADD +1     TO ASC-BLK-SUB                            13380001
339929                           PV-BLOCK-NUMBER                        13390001
339930             PERFORM 4410-READ-TEMP-STORAGE                       13400001
339931     END-IF.                                                      13410001
339932     MOVE +1            TO ASC-BLK-SUB.                           13420001
339933     COMPUTE ASC-ITEM-SUB =                                       13430001
339934         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              13440001
339935         + PC-ITEMS-PER-PANEL).                                   13450001
339936                                                                  13460001
339937     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13470001
339938         ADD +1         TO ASC-BLK-SUB                            13480001
339939         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13490001
339940     END-IF.                                                      13500001
339941                                                                  13510001
339942     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           13520001
339943         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                13530001
339944     PERFORM 4420-FORMAT-LIST-LINES                               13540001
339945         VARYING PV-SUB                                           13550001
339946         FROM PC-ITEMS-PER-PANEL BY -1                            13560001
339947         UNTIL PV-SUB < +1.                                       13570001
339948                                                                  13580001
339949     COMPUTE ASC-ITEMS-DISPLAYED =                                13590001
339950         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          13600001
339951     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    13610001
339952                                      ASTRTITO.                   13620001
339953     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    13630001
339954     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    13640001
339957                                                                  13660103
339958     MOVE ASC-PO-NUMBER            TO APONBRO.                    13672001
339959     MOVE ASC-DPT-NBR              TO ADEPTO.                     13680003
339960                                                                  13680111
339961     MOVE ASC-REQUEST-DATE         TO PV-DATE-ISO.                13680211
300024     MOVE PV-DATE-CC-ISO           TO PV-DATE-CC-USA              07544212
300024     MOVE PV-DATE-YY-ISO           TO PV-DATE-YY-USA              07544212
300024     MOVE PV-DATE-MM-ISO           TO PV-DATE-MM-USA              07544212
300024     MOVE PV-DATE-DD-ISO           TO PV-DATE-DD-USA              07544212
339963     MOVE PV-DATE-USA              TO ARDATEO.                    13680411
339964                                                                  13680511
339965     MOVE ASC-VENDOR-DUE-DATE      TO PV-DATE-ISO.                13680611
300024     MOVE PV-DATE-CC-ISO           TO PV-DATE-CC-USA              07544212
300024     MOVE PV-DATE-YY-ISO           TO PV-DATE-YY-USA              07544212
300024     MOVE PV-DATE-MM-ISO           TO PV-DATE-MM-USA              07544212
300024     MOVE PV-DATE-DD-ISO           TO PV-DATE-DD-USA              07544212
339967     MOVE PV-DATE-USA              TO AVDDTEO.                    13680811
339968                                                                  13680911
339969     MOVE ASC-VENDOR-NAME          TO AVNDNMEO.                   13681003
339970                                                                  13681111
339971     MOVE ASC-PRINT-DUE-DATE       TO PV-DATE-ISO.                13681211
300024     MOVE PV-DATE-CC-ISO           TO PV-DATE-CC-USA              07544212
300024     MOVE PV-DATE-YY-ISO           TO PV-DATE-YY-USA              07544212
300024     MOVE PV-DATE-MM-ISO           TO PV-DATE-MM-USA              07544212
300024     MOVE PV-DATE-DD-ISO           TO PV-DATE-DD-USA              07544212
339973     MOVE PV-DATE-USA              TO APDDTEO.                    13681411
339974                                                                  13681511
339975     MOVE ASC-PRIORITY-N           TO APRTYO.                     13681626
339976     MOVE ASC-REQ-STAT-CDE         TO ASTATO.                     13682003
339977                                                                  13700003
339980     IF  DP020-MSG-NUMBER-X = SPACE                               13850001
339981         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  13860001
339982*            --- MORE ITEMS TO DISPLAY ----                       13870001
339983             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            13880001
339984             SET DP020-MSG-INFORMATIONAL TO TRUE                  13890001
340000         END-IF                                                   13900001
340100     END-IF.                                                      13910001
339977                                                                  13700003
340200*----------------------------------------------------------------*13920001
340300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *13930001
340400*----------------------------------------------------------------*13940001
340600 4410-READ-TEMP-STORAGE.                                          13960001
340800     EXEC CICS                                                    13980001
340900         READQ TS                                                 13990001
341000             QUEUE (ASC-LIST-QUEUE-NAME)                          14000001
341100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               14010001
341200             ITEM  (PV-BLOCK-NUMBER)                              14020001
341300             RESP  (PV-CICS-RESP)                                 14030001
341400     END-EXEC.                                                    14040001
341500                                                                  14050001
341600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       14060001
341700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     14070001
341800         CONTINUE                                                 14080001
341900     ELSE                                                         14090001
342000         SET DP013-CICS-ABEND     TO TRUE                         14100001
342100         SET DP013-NO-ROLLBACK    TO TRUE                         14110001
342200         MOVE '4410-READ-TEMP-STORAGE'                            14120001
342300                                  TO DP013-PARAGRAPH              14130001
342400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      14140001
342500                                  TO DP013-MESSAGE-TEXT(1)        14150001
342600         PERFORM DP013-0000-PROCESS-ABEND                         14160001
342700     END-IF.                                                      14170001
342800                                                                  14180001
342900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             14190001
343000                                                                  14200001
343100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         14210001
343200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               14220001
343300     END-IF.                                                      14230001
343400                                                                  14240001
343500*----------------------------------------------------------------*14250001
343600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *14260001
343700*----------------------------------------------------------------*14270001
343900 4420-FORMAT-LIST-LINES.                                          14290001
344100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      14310001
344200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                14320001
344300         MOVE SPACE              TO MR-COMMENT-LINE (PV-SUB)      14330003
346300     ELSE                                                         14370001
348200         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           14390001
348400             MOVE ASC-COMMENT-LINE (ASC-BLK-SUB ASC-ITEM-SUB)     14400003
348500                            TO MR-COMMENT-LINE (PV-SUB)           14410003
351300         END-IF                                                   14480001
351400     END-IF.                                                      14490001
351500     SUBTRACT +1 FROM ASC-ITEM-SUB                                14500001
351600     IF  ASC-ITEM-SUB < + 1                                       14510001
351700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  14520001
351800         MOVE +1                 TO ASC-BLK-SUB                   14530001
351900     END-IF.                                                      14540001
360700                                                                  14550001
360800*----------------------------------------------------------------*14560001
360900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *14570001
361000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *14580001
361100*----------------------------------------------------------------*14590001
361300 5100-WRITE-TEMP-STORAGE.                                         14610001
361400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     14620001
361500                                   TO PV-LIST-ITEM-NUMBER.        14630001
361600     COMPUTE PV-BLOCK-NUMBER =                                    14640001
361700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14650001
361800                                                                  14660001
361900     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             14670001
362000     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             14680001
362100         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      14690001
362200             PERFORM 5105-REWRITE-ASC-LISTQ                       14700001
362300         END-IF                                                   14710001
362400     ELSE                                                         14720001
362500         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       14730001
362600         ASC-HIGHEST-BLOCK-WRITTEN + 1                            14740001
362700         PERFORM 5110-WRITE-ASC-LISTQ                             14750001
362800         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   14760001
362900     END-IF.                                                      14770001
363000                                                                  14780001
363100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             14790001
363000                                                                  14780001
363200******************************************************************14800001
363300** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **14810001
363400** SPECIFIC COMMAREA.                                           **14820001
363500******************************************************************14830001
363600 5105-REWRITE-ASC-LISTQ.                                          14840001
363700     EXEC CICS                                                    14850001
363800         WRITEQ TS                                                14860001
363900             QUEUE (ASC-LIST-QUEUE-NAME)                          14870001
364000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               14880001
364100             ITEM  (PV-BLOCK-NUMBER)                              14890001
364200             REWRITE                                              14900001
364300             RESP  (PV-CICS-RESP)                                 14910001
364400     END-EXEC.                                                    14920001
364500                                                                  14930001
364600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           14940001
364700         CONTINUE                                                 14950001
364800     ELSE                                                         14960001
364900         SET DP013-CICS-ABEND            TO TRUE                  14970001
365000         SET DP013-NO-ROLLBACK           TO TRUE                  14980001
365100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       14990001
365200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     15000001
365300                                         TO DP013-MESSAGE-TEXT(1) 15010001
365400         PERFORM DP013-0000-PROCESS-ABEND                         15020001
365500     END-IF.                                                      15030001
365600                                                                  15040001
365700******************************************************************15050001
365800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **15060001
365900** SPECIFIC COMMAREA.                                           **15070001
366000******************************************************************15080001
366100 5110-WRITE-ASC-LISTQ.                                            15090001
366200     EXEC CICS                                                    15100001
366300         WRITEQ TS                                                15110001
366400             QUEUE (ASC-LIST-QUEUE-NAME)                          15120001
366500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               15130001
366600             ITEM  (PV-BLOCK-NUMBER)                              15140001
366700             RESP  (PV-CICS-RESP)                                 15150001
366800     END-EXEC.                                                    15160001
366900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      15170001
367000         SET DP013-CICS-ABEND      TO TRUE                        15180001
367100         SET DP013-NO-ROLLBACK     TO TRUE                        15190001
367200         MOVE '5110-WRITE-ASC-LISTQ'                              15200001
367300                                   TO DP013-PARAGRAPH             15210001
367400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           15220001
367500                                   TO DP013-MESSAGE-TEXT(1)       15230001
367600         PERFORM DP013-0000-PROCESS-ABEND                         15240001
367700     END-IF.                                                      15250001
367800                                                                  15260001
374200******************************************************************15270001
374300** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **15280001
374400** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **15290001
374500** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **15300001
374600** THE USER.                                                    **15310001
374700******************************************************************15320001
374800 6000-REFRESH-PANEL-FROM-TEMP.                                    15330001
374900     IF  ASC-UPDATE-TSQ                                           15340001
375000         SET ASC-NO-TSQ-UPDATE TO TRUE                            15350001
375100         MOVE ZERO                 TO PV-SAVE-ITEM                15360001
375200                                      PV-SEL-QUEUE-ITEM           15370001
375300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        15380001
375400                                   TO PV-HOLD-SELECTED-ITEMS      15390001
375500         MOVE +1                   TO PV-ITEMS-PROCESSED          15400001
376000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         15410001
376100                    ASC-BLOCK-ENTRIES (2)                         15420001
376200     END-IF.                                                      15430001
376300                                                                  15440001
412100*----------------------------------------------------------------*15440107
412200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *15440207
412300*----------------------------------------------------------------*15440307
412500 6111-WRITE-LIST-QUEUE.                                           15440507
412700     EXEC CICS                                                    15440707
412800         WRITEQ TS                                                15440807
412900             QUEUE (ASC-LIST-QUEUE-NAME)                          15440907
413000             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     15441007
413100             ITEM  (PV-SAVE-ITEM)                                 15441107
413200             REWRITE                                              15441207
413300             RESP  (PV-CICS-RESP)                                 15441307
413400     END-EXEC.                                                    15441407
413500                                                                  15441507
413600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          15441607
413700         CONTINUE                                                 15441707
413800     ELSE                                                         15441807
413900         SET DP013-CICS-ABEND  TO  TRUE                           15441907
414000         SET DP013-NO-ROLLBACK TO  TRUE                           15442007
414100         MOVE '6111-WRITE-LIST-QUEUE'                             15442107
414200                               TO  DP013-PARAGRAPH                15442207
414300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  15442307
414400                               TO  DP013-MESSAGE-TEXT(1)          15442407
414500         PERFORM DP013-0000-PROCESS-ABEND                         15442507
414600     END-IF.                                                      15442607
414700                                                                  15442707
414802*----------------------------------------------------------------*15460001
414803*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*15470001
414804*----------------------------------------------------------------*15480001
414806 6112-READ-LIST-QUEUE.                                            15500001
414808     EXEC CICS                                                    15520001
414809         READQ TS                                                 15530001
414810             QUEUE (ASC-LIST-QUEUE-NAME)                          15540001
414811             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     15550001
414812             ITEM  (PV-ITEM)                                      15560001
414813             RESP  (PV-CICS-RESP)                                 15570001
414814     END-EXEC.                                                    15580001
414815                                                                  15590001
414816     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          15600001
414817         CONTINUE                                                 15610001
414818     ELSE                                                         15620001
414819         SET DP013-CICS-ABEND        TO TRUE                      15630001
414820         SET DP013-NO-ROLLBACK       TO TRUE                      15640001
414821         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           15650001
414822         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    15660001
414823                                     TO DP013-MESSAGE-TEXT(1)     15670001
414824         PERFORM DP013-0000-PROCESS-ABEND                         15680001
414825     END-IF.                                                      15690001
414826                                                                  15700001
417400*----------------------------------------------------------------*15700103
417500*    UPDATE THE INFORMATION WITH THE SCREEN INFORMATION          *15700203
417600*----------------------------------------------------------------*15700303
417700 7000-UPDATE-REQUEST.                                             15700403
418000     MOVE +1                   TO  ASC-BLK-SUB.                   15700703
418100     PERFORM 5100-WRITE-TEMP-STORAGE.                             15700803
418200     ADD +1                    TO  ASC-BLK-SUB.                   15700903
418300     PERFORM 5100-WRITE-TEMP-STORAGE.                             15701003
418400                                                                  15701103
418401     PERFORM 7100-UPDATE-REQUEST-HEADER.                          15701203
418402                                                                  15701303
418500     PERFORM 7200-UPDATE-COMMENT-LINES                            15701403
418600             VARYING PV-ITEM                                      15701503
418700             FROM 1 BY 1                                          15701603
418800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     15701703
418900                                                                  15701803
287239     PERFORM 9100-READ-SEL-QUEUE.                                 06390001
287248     SET VL006-UPD (ASC-SEL-SUB) TO TRUE.                         06480024
           PERFORM 9200-REWRITE-SEL-QUEUE.                              06490001
                                                                                
419000     MOVE PC-TSYMSG-00059      TO DP020-MSG-NUMBER.               15701903
419100     SET DP020-MSG-INFORMATIONAL TO TRUE.                         15702003
419200                                                                  15703003
445800*----------------------------------------------------------------*15703103
445900*  UPDATE A PRETICKET REQUEST HEADER RECORD TO DB2 TABLE TPTKREQ *15703203
446000*----------------------------------------------------------------*15703303
446200 7100-UPDATE-REQUEST-HEADER.                                      15703503
446400     MOVE ASC-PRIORITY-N TO DK-PRIORITY.                          15703715
446401                                                                  15703806
446402     PERFORM                                                      15703903
446500         WITH TEST AFTER                                          15704003
446600         VARYING PV-RETRY-COUNTER                                 15704103
446700         FROM 1 BY 1                                              15704203
446800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15704303
446900             OR (SQLCODE = +0))                                   15704403
447000                                                                  15704503
447100         EXEC SQL                                                 15704603
447200              UPDATE TPTKREQ                                      15704703
447300              SET                                                 15704803
447400                  PRTY_STAT_CDE   = :DK-PRIORITY                  15704906
447600                , REQ_STAT_CDE    = :ASC-REQ-STAT-CDE             15705003
447800                , PRT_BY_DTE      = :ASC-PRINT-DUE-DATE           15705103
447900              WHERE                                               15705203
448000                  PO_REQ_NBR      = :ASC-PO-REQ-NBR               15705303
448100         END-EXEC                                                 15705403
448200                                                                  15705503
448300         EVALUATE TRUE                                            15705603
448400             WHEN SQLCODE = +0                                    15705703
448600                 CONTINUE                                         15705903
448800             WHEN SQLWARN0 NOT = SPACE                            15706103
448900             WHEN SQLCODE < +0                                    15706203
449000             WHEN SQLCODE > +0                                    15706303
449100                 MOVE '7100-UPDATE-HEADER'                        15706403
449200                                   TO DP013-PARAGRAPH             15706503
449300                 MOVE 'UPDATE PRETICKET REQUEST HEADER TABLE'     15706603
449400                                   TO DP013-MESSAGE-TEXT (1)      15706703
449500                 MOVE ASC-PO-REQ-NBR                              15706803
449600                                   TO DP013-MESSAGE-TEXT (2)      15706903
449700                 MOVE SQLCA        TO DP013-SQLCA                 15707003
449800                 MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)    15707103
449900                 SET DP013-DB2-ABEND                              15707203
450000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15707303
450100                 PERFORM DP013-0000-PROCESS-ABEND                 15707403
450300         END-EVALUATE                                             15707603
450400     END-PERFORM.                                                 15707703
450500                                                                  15707803
450700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15708003
450800         MOVE '7100-UPDATE-HEADER' TO DP013-PARAGRAPH             15708103
450900         MOVE 'MAXIMUM RETRIES EXCEEDED UPDATE HEADER TABLE'      15708203
451000                                   TO DP013-MESSAGE-TEXT (1)      15708303
451100         MOVE ASC-PO-REQ-NBR       TO DP013-MESSAGE-TEXT (2)      15708403
451200         MOVE SQLCA                TO DP013-SQLCA                 15708503
451300         MOVE 'TPTKREQ '           TO DP013-DB2-TABLE-NAME (1)    15708603
451400         SET DP013-DB2-ABEND                                      15708703
451500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   15708803
451700         PERFORM DP013-0000-PROCESS-ABEND                         15709003
451800     END-IF.                                                      15709103
452000                                                                  15709303
452100*----------------------------------------------------------------*15709403
452200*  SCROLL THROUGH ALL THE COMMENT LINES AND INSERT, UPDATE OR    *15709503
452300*  DELETE ACCORDINGLY                                            *15709603
452500*----------------------------------------------------------------*15709803
452700 7200-UPDATE-COMMENT-LINES.                                       15710003
452900     PERFORM 6112-READ-LIST-QUEUE.                                15710203
453000                                                                  15710303
453100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       15710403
453200         PERFORM                                                  15710503
453300         VARYING LQW-IDX                                          15710603
453400         FROM 1 BY 1                                              15710703
453500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            15710803
453600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          15710903
453900            MOVE LQW-COMMENT-LINE (LQW-IDX)                       15711203
454000                                        TO  DK-COMMENT-LINE       15711303
454100            MOVE LQW-COMMENT-SEQ-NBR (LQW-IDX)                    15711403
454101                                        TO  DK-SEQ-NBR            15711503
454102            EVALUATE TRUE                                         15711703
454103                 WHEN LQW-COMMENT-NO-UPD (LQW-IDX)                15711803
454104                     CONTINUE                                     15711903
454106                 WHEN LQW-COMMENT-UPD (LQW-IDX)                   15712103
454108                     IF LQW-COMMENT-SEQ-NBR (LQW-IDX) = +0        15712803
454109                         ADD +1 TO ASC-MAX-COMMENT-SEQ-NBR        15713018
454110                         MOVE ASC-MAX-COMMENT-SEQ-NBR             15713118
454120                                TO DK-SEQ-NBR                     15713218
454130                                   LQW-COMMENT-SEQ-NBR (LQW-IDX)  15713319
                               IF ASC-CMNT-ID = +0                              
                                   PERFORM 7205-GET-CMNT-ID                     
                                       UNTIL SQLCODE = +100                     
                                   PERFORM 7206-UPDATE-REQUEST                  
                               END-IF                                           
454140                         PERFORM 7210-INSERT-COMMENT              15713503
454150                     ELSE                                         15713603
454170                         PERFORM 7220-UPDATE-COMMENT              15713803
454180                     END-IF                                       15713903
454200                 WHEN LQW-COMMENT-DEL (LQW-IDX)                   15714103
454300                     IF LQW-COMMENT-SEQ-NBR (LQW-IDX) = +0        15714219
454400                         CONTINUE                                 15714319
454500                     ELSE                                         15714419
454600                         PERFORM 7230-DELETE-COMMENT              15714519
454600                         PERFORM 7240-CHECK-COMMENT               15714519
454700                     END-IF                                       15714620
459200             END-EVALUATE                                         15717803
459400         END-PERFORM                                              15718003
459500                                                                  15718103
459600         MOVE PV-ITEM          TO PV-SAVE-ITEM                    15718203
459700         PERFORM 6111-WRITE-LIST-QUEUE                            15718303
459800     END-IF.                                                      15718403
459900                                                                  15718503
460001*----------------------------------------------------------------*15718703
460002* IF THIS IS THE FIRST COMMENT FOR THIS REQUEST, GENERATE A      *15718803
460002* RANDOMLY GENERATED COMMENT ID NUMBER.                          *15718803
460003*----------------------------------------------------------------*15718903
460005 7205-GET-CMNT-ID.                                                15719203
449400     EXEC SQL                                                     44940000
449500         SET :PV-TIMESTAMP = CURRENT TIMESTAMP                    44950000
449600     END-EXEC                                                     44960000
449700                                                                  44970000
449800     IF SQLCODE = +0                                              44980000
449900         CONTINUE                                                 44990000
450000     ELSE                                                         45000000
450100         MOVE '7205-INSERT-HEADER-RECORD'                         45010000
450200                           TO DP013-PARAGRAPH                     45020000
450300         MOVE 'SET TIMESTAMP FOR RND KEY GENERATION'              45030000
450400                           TO DP013-MESSAGE-TEXT (1)              45040000
450500         MOVE SQLCA        TO DP013-SQLCA                         45050000
450600         SET DP013-DB2-ABEND                                      45060000
450700             DP013-XCTL-DISPLAY-RESTART TO TRUE                   45070000
450800         PERFORM DP013-0000-PROCESS-ABEND                         45080000
450900     END-IF                                                       45090000
451000                                                                  45100000
451100     MOVE PV-TIMESTAMP   TO PV-TIMESTAMP-SPLIT                    45110000
451200     MOVE PV-MINUTE      TO PV-RND-MINUTE                         45120000
451300     MOVE PV-SECOND      TO PV-RND-SECOND                         45130000
451400     MOVE PV-NANOSEC-1-3 TO PV-RND-NANOSEC-1-3                    45140000
451500     MOVE PV-NANOSEC-4-6 TO PV-RND-NANOSEC-4-6                    45150000
451700     MOVE PV-RANDOM-KEY  TO ASC-CMNT-ID                           45170000
451800                                                                  45180000
451900     EXEC SQL                                                     45190000
452000          SELECT CMNT_ID                                          45200000
452000          INTO   :PTKCMT-CMNT-ID                                        00
                FROM   TPTKCMT                                                  
                WHERE  CMNT_ID = :ASC-CMNT-ID                                   
455400     END-EXEC                                                     45540000
455500                                                                  45550000
455600     EVALUATE TRUE                                                45560000
455700         WHEN SQLCODE = +0                                        45570000
455800         WHEN SQLCODE = -811                                      45580000
455800         WHEN SQLCODE = +100                                      45580000
455900             CONTINUE                                             45590000
456100         WHEN SQLWARN0 NOT = SPACE                                45610000
456200         WHEN SQLCODE < +0                                        45620000
456300         WHEN SQLCODE > +0                                        45630000
456400             MOVE '7205-GET-CMNT-ID'                              45640000
456500                               TO DP013-PARAGRAPH                 45650000
456600             MOVE 'CHECK THE COMMENT TABLE FOR DUPLICATE IDS'     45660000
456700                               TO DP013-MESSAGE-TEXT (1)          45670000
456800             MOVE ASC-CMNT-ID                                     45680000
456900                               TO PV-DISPLAY-COMP1                45690000
457000             MOVE PV-DISPLAY-COMP1                                45700000
457100                               TO DP013-MESSAGE-TEXT (2)          45710000
457600             MOVE SQLCA        TO DP013-SQLCA                     45760000
457700             MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (1)        45770000
457800             SET DP013-DB2-ABEND                                  45780000
457900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               45790000
458000             PERFORM DP013-0000-PROCESS-ABEND                     45800000
458100                                                                  45810000
458200     END-EVALUATE.                                                45820000
460000                                                                  15718603
460001*----------------------------------------------------------------*15718703
460002* FIRST UPDATE THE REQUEST TO POINT AT THE COMMENTS THAT WILL    *15718803
460002* BE CREATED                                                     *15718803
460003*----------------------------------------------------------------*15718903
460005 7206-UPDATE-REQUEST.                                             15719203
451900     EXEC SQL                                                     45190000
                UPDATE TPTKREQ                                                  
                SET CMNT_ID      = :ASC-CMNT-ID                                 
                WHERE PO_REQ_NBR = :ASC-PO-REQ-NBR                              
455400     END-EXEC                                                     45540000
455500                                                                  45550000
455600     EVALUATE TRUE                                                45560000
455700         WHEN SQLCODE = +0                                        45570000
455900             CONTINUE                                             45590000
456100         WHEN SQLWARN0 NOT = SPACE                                45610000
456200         WHEN SQLCODE < +0                                        45620000
456300         WHEN SQLCODE > +0                                        45630000
456400             MOVE '7206-UPDATE-REQUEST'                           45640000
456500                               TO DP013-PARAGRAPH                 45650000
456600             MOVE 'UPDATE THE REQUEST WITH THE COMMENT ID'        45660000
456700                               TO DP013-MESSAGE-TEXT (1)          45670000
456800             MOVE ASC-PO-REQ-NBR                                  45680000
456900                               TO PV-DISPLAY-COMP1                45690000
457000             MOVE PV-DISPLAY-COMP1                                45700000
457100                               TO DP013-MESSAGE-TEXT (2)          45710000
456800             MOVE ASC-CMNT-ID                                     45680000
456900                               TO PV-DISPLAY-COMP1                45690000
457000             MOVE PV-DISPLAY-COMP1                                45700000
457100                               TO DP013-MESSAGE-TEXT (3)          45710000
457600             MOVE SQLCA        TO DP013-SQLCA                     45760000
457700             MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (1)        45770000
457800             SET DP013-DB2-ABEND                                  45780000
457900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               45790000
458000             PERFORM DP013-0000-PROCESS-ABEND                     45800000
458200     END-EVALUATE.                                                45820000
460000                                                                  15718603
460001*----------------------------------------------------------------*15718703
460002* INSERT A ROW TO THE PRETICKET COMMENT TABLE.                   *15718803
460003*----------------------------------------------------------------*15718903
460005 7210-INSERT-COMMENT.                                             15719203
460006     EXEC SQL                                                     15719603
460007         INSERT INTO TPTKCMT                                      15719703
460008                 ( CMNT_ID                                        15719803
460009                  ,SEQ_NBR                                        15719903
460010                  ,PRE_TKT_CMNT_DESC                              15720003
460020                  ,CMNT_CRER_ID                                   15720103
460020                  ,CMNT_TYP_CDE                                   15720103
460030                 )                                                15720203
460040         VALUES  ( :ASC-CMNT-ID                                   15720303
460050                  ,:DK-SEQ-NBR                                    15720418
460060                  ,:DK-COMMENT-LINE                               15720503
460070                  ,:DP020-USERID                                  15720603
                        ,'R'                                                    
460080                 )                                                15720703
460090     END-EXEC.                                                    15720803
460091                                                                  15720903
460092     EVALUATE TRUE                                                15721003
460093         WHEN SQLCODE = +0                                        15721103
460094             CONTINUE                                             15721203
460096         WHEN SQLWARN0 NOT = SPACE                                15721403
460097         WHEN SQLCODE < +0                                        15721503
460098         WHEN SQLCODE > +0                                        15721603
460099             MOVE '7210-INSERT-COMMENT'                           15721703
460100                               TO DP013-PARAGRAPH                 15721803
460101             MOVE 'INSERT ROW TO PRETICKET COMMENT TABLE'         15721903
460102                               TO DP013-MESSAGE-TEXT (1)          15722003
460104             MOVE ASC-CMNT-ID  TO DP013-MESSAGE-TEXT (2)          15722203
460105             MOVE DK-SEQ-NBR   TO DP013-MESSAGE-TEXT (3)          15722418
460106             MOVE SQLCA        TO DP013-SQLCA                     15722503
460107             MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (1)        15722603
460108             SET DP013-DB2-ABEND                                  15722703
460109                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15722803
460110             PERFORM DP013-0000-PROCESS-ABEND                     15722903
460112     END-EVALUATE.                                                15723103
460114                                                                  15723303
460115*----------------------------------------------------------------*15723403
460116* UPDATE A ROW ON THE PRETICKET COMMENT TABLE.                   *15723503
460117*----------------------------------------------------------------*15723603
460119 7220-UPDATE-COMMENT.                                             15723803
460130     EXEC SQL                                                     15724603
460140         UPDATE TPTKCMT                                           15724703
460150            SET PRE_TKT_CMNT_DESC = :DK-COMMENT-LINE              15724803
460160         WHERE CMNT_ID     = :ASC-CMNT-ID                         15724903
460170           AND SEQ_NBR     = :DK-SEQ-NBR                          15725003
460180     END-EXEC.                                                    15725703
460181                                                                  15725803
460182     EVALUATE TRUE                                                15725903
460183         WHEN SQLCODE = +0                                        15726003
460184             CONTINUE                                             15726103
460186         WHEN SQLCODE = +100                                      15726318
460187             PERFORM 7210-INSERT-COMMENT                          15726918
460189         WHEN SQLWARN0 NOT = SPACE                                15727103
460190         WHEN SQLCODE < +0                                        15727203
460191         WHEN SQLCODE > +0                                        15727303
460192             MOVE '7220-UPDATE-COMMENT'                           15727403
460193                               TO DP013-PARAGRAPH                 15727503
460194             MOVE 'UPDATE ROW ON PRETICKET COMMENT TABLE'         15727603
460195                               TO DP013-MESSAGE-TEXT (1)          15727703
460196             MOVE ASC-PO-REQ-NBR                                  15727803
460197                               TO DP013-MESSAGE-TEXT (2)          15727903
460198             MOVE DK-SEQ-NBR   TO DP013-MESSAGE-TEXT (2)          15728003
460199             MOVE SQLCA        TO DP013-SQLCA                     15728103
460200             MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (1)        15728203
460201             SET DP013-DB2-ABEND                                  15728303
460202                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15728403
460203             PERFORM DP013-0000-PROCESS-ABEND                     15728503
460205     END-EVALUATE.                                                15728703
460206                                                                  15728803
460209*----------------------------------------------------------------*15729103
460210* DELETE A ROW FROM THE PRETICKET COMMENT TABLE.                 *15729203
460211*----------------------------------------------------------------*15729303
460213 7230-DELETE-COMMENT.                                             15729503
460215     EXEC SQL                                                     15729703
460216         DELETE FROM TPTKCMT                                      15729804
460217         WHERE CMNT_ID     = :ASC-CMNT-ID                         15729903
460218           AND SEQ_NBR     = :DK-SEQ-NBR                          15730003
460219     END-EXEC.                                                    15730103
460220                                                                  15730203
460221     EVALUATE TRUE                                                15730303
460222         WHEN SQLCODE = +0                                        15730403
460223             CONTINUE                                             15730503
460225         WHEN SQLWARN0 NOT = SPACE                                15730703
460226         WHEN SQLCODE < +0                                        15730803
460227         WHEN SQLCODE > +0                                        15730903
460228             MOVE '7230-DELETE-COMMENT'                           15731003
460229                               TO DP013-PARAGRAPH                 15731103
460230             MOVE 'DELETE ROW FROM PRETICKET COMMENT TABLE'       15731203
460231                               TO DP013-MESSAGE-TEXT (1)          15731303
460232             MOVE ASC-PO-REQ-NBR                                  15731403
460233                               TO DP013-MESSAGE-TEXT (2)          15731503
460234             MOVE DK-SEQ-NBR   TO DP013-MESSAGE-TEXT (2)          15731603
460235             MOVE SQLCA        TO DP013-SQLCA                     15731703
460236             MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (1)        15731803
460237             SET DP013-DB2-ABEND                                  15731903
460238                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15732003
460239             PERFORM DP013-0000-PROCESS-ABEND                     15732103
460240                                                                  15732203
460241     END-EVALUATE.                                                15732303
460208                                                                  15729003
460209*----------------------------------------------------------------*15729103
460210* DELETE A ROW FROM THE PRETICKET COMMENT TABLE.                 *15729203
460211*----------------------------------------------------------------*15729303
460213 7240-CHECK-COMMENT.                                              15729503
460215     EXEC SQL                                                     15729703
460216         SELECT SEQ_NBR                                           15729804
460217           INTO :PTKCMT-SEQ-NBR                                         03
460218           FROM TPTKCMT                                                 03
               WHERE  CMNT_ID = :ASC-CMNT-ID                                    
460219     END-EXEC.                                                    15730103
460220                                                                  15730203
460221     EVALUATE TRUE                                                15730303
460222         WHEN SQLCODE = +100                                      15730403
                   PERFORM 7250-UPDATE-REQUEST-DEL                              
460222         WHEN SQLCODE = +0                                        15730403
460222         WHEN SQLCODE = -811                                      15730403
460223             CONTINUE                                             15730503
460225         WHEN SQLWARN0 NOT = SPACE                                15730703
460226         WHEN SQLCODE < +0                                        15730803
460227         WHEN SQLCODE > +0                                        15730903
460228             MOVE '7240-CHECK-COMMENT'                                  03
460229                               TO DP013-PARAGRAPH                 15731103
460230             MOVE 'CHECK FOR COMMENTS ON THE COMMENT TABLE'       15731203
460231                               TO DP013-MESSAGE-TEXT (1)          15731303
460233             MOVE ASC-CMNT-ID  TO DP013-MESSAGE-TEXT (2)          15731503
460235             MOVE SQLCA        TO DP013-SQLCA                     15731703
460236             MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (1)        15731803
460237             SET DP013-DB2-ABEND                                  15731903
460238                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15732003
460239             PERFORM DP013-0000-PROCESS-ABEND                     15732103
460241     END-EVALUATE.                                                15732303
460208                                                                  15729003
460209*----------------------------------------------------------------*15729103
460210* UPDATE THE COMMENT ID ON THE REQUEST TABLE WITH ZERO           *15729203
460211*----------------------------------------------------------------*15729303
460213 7250-UPDATE-REQUEST-DEL.                                         15729503
460215     EXEC SQL                                                     15729703
460216         UPDATE TPTKREQ                                           15729804
460217           SET CMNT_ID     = 0                                          03
460218         WHERE PO_REQ_NBR  = :ASC-PO-REQ-NBR                      15730003
460219     END-EXEC.                                                    15730103
460220                                                                  15730203
460221     EVALUATE TRUE                                                15730303
460222         WHEN SQLCODE = +0                                        15730403
460223             CONTINUE                                             15730503
460225         WHEN SQLWARN0 NOT = SPACE                                15730703
460226         WHEN SQLCODE < +0                                        15730803
460227         WHEN SQLCODE > +0                                        15730903
460228             MOVE '7250-UPDATE-REQUEST-DEL'                       15731003
460229                               TO DP013-PARAGRAPH                 15731103
460230             MOVE 'UPDATE REQUEST CMNT-ID WITH ZERO'              15731203
460231                               TO DP013-MESSAGE-TEXT (1)          15731303
460232             MOVE ASC-PO-REQ-NBR                                  15731403
460233                               TO DP013-MESSAGE-TEXT (2)          15731503
460235             MOVE SQLCA        TO DP013-SQLCA                     15731703
460236             MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)        15731803
460237             SET DP013-DB2-ABEND                                  15731903
460238                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15732003
460239             PERFORM DP013-0000-PROCESS-ABEND                     15732103
460241     END-EVALUATE.                                                15732303
460244                                                                  15732603
460245*----------------------------------------------------------------*15732701
460246* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *15732801
460247*----------------------------------------------------------------*15733001
460249 9100-READ-SEL-QUEUE.                                             15750001
460250     EXEC CICS                                                    15760001
460251         READQ TS                                                 15770001
460252             QUEUE (ASC-SEL-QUEUE-NAME)                           15780001
460253             INTO  (VL006-LINE-SEL-REC)                           15790024
460254             ITEM  (ASC-SEL-ITEM)                                 15800001
460255             RESP  (PV-CICS-RESP)                                 15810001
460256     END-EXEC.                                                    15820001
460257                                                                  15830001
460258     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       15840001
460259         CONTINUE                                                 15850001
460260     ELSE                                                         15860001
460261         SET DP013-LOGIC-ABEND                                    15870001
460262             DP013-NO-ROLLBACK     TO TRUE                        15880001
460263         MOVE '9100-READ-SEL-QUEUE'                               15890001
460264                                   TO DP013-PARAGRAPH             15900001
460265         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   15910001
460266                                   TO DP013-MESSAGE-TEXT (1)      15920001
460267         PERFORM DP013-0000-PROCESS-ABEND                         15930001
460268     END-IF.                                                      15940001
460268                                                                  15940001
460269*----------------------------------------------------------------*15950001
460270* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *15960001
460271*----------------------------------------------------------------*15970001
460272 9200-REWRITE-SEL-QUEUE.                                          15980001
460273     EXEC CICS                                                    15990001
460274          WRITEQ TS                                               16000001
460275              QUEUE  (ASC-SEL-QUEUE-NAME)                         16010001
460276              FROM   (VL006-LINE-SEL-REC)                         16020024
460277              ITEM   (ASC-SEL-ITEM)                               16030001
460278              RESP   (PV-CICS-RESP)                               16040001
460279              REWRITE                                             16050001
460280     END-EXEC.                                                    16060001
460290                                                                  16070001
460300     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   16080001
460400         SET DP013-CICS-ABEND                                     16090001
460500             DP013-NO-ROLLBACK     TO TRUE                        16100001
460600         MOVE '9200-REWRITE-SEL-QUEUE'                            16110001
460700                                   TO DP013-PARAGRAPH             16120001
460800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   16130001
460900                                   TO DP013-MESSAGE-TEXT (1)      16140001
461000         PERFORM DP013-0000-PROCESS-ABEND                         16150001
461100     END-IF.                                                      16160001
461200                                                                  16170001
461400*----------------------------------------------------------------*16190001
461500*    ABEND PROCESSOR MODULE                                      *16200001
461600*----------------------------------------------------------------*16210001
461800     COPY DPPD013.                                                16230001
