000100 TITLE 'TRAILER STATUS UPDATE'.                                   00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    SUKCS802.                                         00030000
000400 AUTHOR.        COGNIZANT.                                        00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  MAY 2016.                                         00060000
000700 DATE-COMPILED.                                                   00070000
000710******************************************************************00071000
000711* S802 this transaction for webservice updateTrailerStatus        00071100
000712******************************************************************00071200
000713******************************************************************00071300
000714* I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES 00071400
000715* SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.        00071500
000716* THIS PROGRAM USES MQSERIES.                                     00071600
000717******************************************************************00071700
000718*                                                               * 00071826
000719*  CHANGED 05/25/21 BY ANIL VEDURUPARTHI                        * 00071927
000720*  PRB0076066 - Store Receiving Application Allowing            * 00072029
000721*  a Trailer to be SO/SU Status on Their Physical Inventory Day * 00072129
000722*                                                               * 00072227
000723******************************************************************00072327
000724                                                                  00072400
000725 DATA DIVISION.                                                   00072500
000726 WORKING-STORAGE SECTION.                                         00072600
000730                                                                  00073000
000740 01  DK-DB2-KEYS.                                                 00074000
000750     05  DK-TRIP-ID                   PIC S9(09) COMP VALUE ZERO. 00075000
000760     05  DK-NEXT-STAT-CDE             PIC  X(02) VALUE SPACES.    00076000
000770     05  DK-CURR-STAT-CDE             PIC  X(02) VALUE SPACES.    00077000
000771     05  DK-STR-NBR                   PIC S9(04) VALUE ZERO       00077129
000772                                                 COMP.            00077229
000780                                                                  00078000
000790 01  PC-PROGRAM-CONSTANTS.                                        00079000
000800     05  PC-DEFAULT-TMST              PIC  X(26) VALUE            00080000
000900                                    '9999-09-09-09.09.09.999999'. 00090000
001000     05  PC-MQPUT-RETRY-COUNTER       PIC  9(3)  VALUE ZERO.      00100000
001100     05  PC-SUCCESS                   PIC  X(20) VALUE            00110000
001200                                       'SUCCESSFUL UPDATE'.       00120000
001300     05  PC-FAILURE                   PIC  X(20) VALUE            00130000
001400                                       'UPDATE FAILED'.           00140000
001500     05  PC-MSG-VAR-IND               PIC  X(04) VALUE '&VAR'.    00150000
001600******************************************************************00160000
001700*   SYSTEM MESSAGES                                              *00170000
001800******************************************************************00180000
001900*   59.  UPDATE(S) SUCCESSFUL                                     00190000
002000*  334.  STORE NUMBER MUST BE NUMERIC                             00200000
002100* 1570.  A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK          00210000
002200* 2612.  YOU DO NOT HAVE AUTHORITY TO UPDATE                      00220000
002300* 2816.  INVALID TRAILER STATUS FOR UPDATE FUNCTION               00230000
002400* 3051.  INVALID TRAILER SEAL # ENTERED                           00240000
002500* 3053.  OUTBOUND TRIP ID NOT FOUND                               00250000
002600* 3340.  TRAILER STATUS WAS PREVIOUSLY UPDATED TO &VAR STATUS     00260000
002700* 3777.  TRAILER BELONGS TO A DIFFERENT DESTINATION STORE         00270000
002800* 3778.  OUTBOUND TRIP ID REQUIRED                                00280000
002900* 3779.  TRAILER STATUS SHOULD BE 'SO' OR 'SU'                    00290000
003000* 3780.  TRAILER SEAL DOES NOT MATCH                              00300000
003100******************************************************************00310000
003200     05  PC-TSYMSG-NUMBERS.                                       00320000
003300         10  PC-TSYMSG-00007         PIC 9(05) VALUE  00007.      00330000
003400         10  PC-TSYMSG-00059         PIC 9(05) VALUE  00059.      00340000
003500         10  PC-TSYMSG-00334         PIC 9(05) VALUE  00334.      00350000
003600         10  PC-TSYMSG-01570         PIC 9(05) VALUE  01570.      00360000
003700         10  PC-TSYMSG-02612         PIC 9(05) VALUE  02612.      00370000
003800         10  PC-TSYMSG-02816         PIC 9(05) VALUE  02816.      00380000
003900         10  PC-TSYMSG-03051         PIC 9(05) VALUE  03051.      00390000
004000         10  PC-TSYMSG-03053         PIC 9(05) VALUE  03053.      00400000
004100         10  PC-TSYMSG-03340         PIC 9(05) VALUE  03340.      00410000
004200         10  PC-TSYMSG-03777         PIC 9(05) VALUE  03777.      00420000
004300         10  PC-TSYMSG-03778         PIC 9(05) VALUE  03778.      00430000
004400         10  PC-TSYMSG-03779         PIC 9(05) VALUE  03779.      00440000
004410         10  PC-TSYMSG-03412         PIC 9(05) VALUE  03412.      00441014
004500         10  PC-TSYMSG-03780         PIC 9(05) VALUE  03780.      00450000
004600         10  PC-TSYMSG-03787         PIC 9(05) VALUE  03787.      00460000
004700 01  PS-PROGRAM-SWITCHES.                                         00470000
004800     05  PS-ERROR-SW              PIC X(01)   VALUE 'N'.          00480000
004900         88  PS-ERROR                         VALUE 'Y'.          00490000
005000         88  PS-NO-ERROR                      VALUE 'N'.          00500000
005100     05  PS-ACCESS-SW             PIC  X(01)  VALUE 'N'.          00510000
005200         88  PS-ACCESS-ALLOWED                VALUE 'Y'.          00520000
005300         88  PS-ACCESS-NOT-ALLOWED            VALUE 'N'.          00530000
005310     05  PS-REDIRECT-SW           PIC  X(01)  VALUE 'N'.          00531006
005320         88  PS-REDIRECT-FOUND                VALUE 'Y'.          00532005
005330         88  PS-REDIRECT-NOT-FOUND            VALUE 'N'.          00533005
005400     05  PS-PROCESS-MQ            PIC X(01)   VALUE 'N'.          00540000
005500         88  PROCESS-MQ-NO                    VALUE 'N'.          00550000
005600         88  PROCESS-MQ                       VALUE 'Y'.          00560000
005700     05  PS-SEND-MANIFEST-TO-MLS-SW   PIC X(01)   VALUE 'N'.      00570000
005800         88  PS-SEND-MANIFEST-TO-MLS-YES          VALUE 'Y'.      00580000
005900         88  PS-SEND-MANIFEST-TO-MLS-NO           VALUE 'N'.      00590000
006000     05  PS-SEND-MANIFEST-TO-OMS-SW   PIC X(01)   VALUE 'N'.      00600000
006100         88  PS-SEND-MANIFEST-TO-OMS-YES          VALUE 'Y'.      00610000
006200         88  PS-SEND-MANIFEST-TO-OMS-NO           VALUE 'N'.      00620000
006300     05  PS-MQPUT-SUCCESSFUL-IND      PIC X(01)   VALUE SPACES.   00630000
006400         88  PS-MQPUT-SUCCESSFUL                  VALUE 'Y'.      00640000
006500     05  PS-VALID-STATUS-CHANGE-SW    PIC X(01)   VALUE 'N'.      00650000
006600         88  PS-VALID-STATUS-CHANGE               VALUE 'Y'.      00660000
006700         88  PS-NOT-VALID-STATUS-CHANGE           VALUE 'N'.      00670000
006800                                                                  00680000
006900 01  PV-PROGRAM-VARIABLES.                                        00690000
007000     05  PV-TSYMSG-NUMBER         PIC  9(05)  VALUE  0.           00700000
007100     05  PV-SQLCODE               PIC  9(09)  VALUE  0.           00710000
007200     05  PV-MQCC                  PIC  9(09)  VALUE  0.           00720000
007300     05  PV-STORE-NBR             PIC S9(04)  COMP.               00730000
007400     05  PV-PROGRAM-FUNCTION      PIC  X(08)  VALUE SPACES.       00740000
007500     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00750000
007600                                              COMP SYNC.          00760000
007700     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00770000
007800                                              COMP SYNC.          00780000
007900     05  PV-LOCK-RETRY-COUNTER    PIC S9(04)  VALUE +0            00790000
008000                                              COMP SYNC.          00800000
008100     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            00810000
008200                                              COMP SYNC.          00820000
008300     05  PV-CICS-RESP             PIC S9(04)  VALUE +0            00830000
008400                                              COMP SYNC.          00840000
008500     05  PV-MSG-VAR-LENGTH        PIC S9(04)  VALUE +0            00850000
008600                                             COMP SYNC.           00860000
008700     05  PV-MSG-VAR-LEAD-SPACE    PIC S9(04)  VALUE +0            00870000
008800                                             COMP SYNC.           00880000
008900     05  PV-CHAR-POS              PIC S9(04)  VALUE +0            00890000
009000                                             COMP SYNC.           00900000
009100     05  PV-MSG-VAR-SAVE          PIC  X(70)  VALUE SPACE.        00910000
009200     05  PV-MSG-REMAINDER         PIC  X(70)  VALUE SPACE.        00920000
009300     05  PV-MSG-VAR-IND           PIC  X(04)  VALUE SPACE.        00930000
009400     05  PV-MSG-STRING-PTR        PIC S9(04)  VALUE ZERO          00940000
009500                                                 COMP SYNC.       00950000
009600     05  PV-MQ-HANDLE-CNT         PIC 9(05) VALUE ZEROES.         00960000
009700     05  PV-MQ-HANDLE-NOT-REP     PIC 9(05) VALUE ZEROES.         00970000
009800     05  PV-XML-BANNER            PIC X(39) VALUE                 00980000
009900         '<?xml version="1.0" encoding="UTF-8" ?>'.               00990000
010000     05  PV-SHIPPED-TMST-OUT      PIC X(19).                      01000000
010100     05  PV-SHIPPED-TMST-OUT-R    REDEFINES                       01010000
010200         PV-SHIPPED-TMST-OUT.                                     01020000
010300         10  PV-SHIPPED-DATE         PIC X(10).                   01030000
010400         10  PV-T                    PIC X(01).                   01040000
010500         10  PV-SHIPPED-TIME         PIC X(08).                   01050000
010600                                                                  01060000
010700     05  PV-SHIPPED-TMST             PIC X(26).                   01070000
010800     05  PV-SHIPPED-TMST-DATE-HHMM   REDEFINES                    01080000
010900         PV-SHIPPED-TMST.                                         01090000
011000         10  PV-SHIPPED-CCYY         PIC X(04).                   01100000
011100         10  FILLER                  PIC X(01).                   01110000
011200         10  PV-SHIPPED-MM           PIC X(02).                   01120000
011300         10  FILLER                  PIC X(01).                   01130000
011400         10  PV-SHIPPED-DD           PIC X(02).                   01140000
011500         10  FILLER                  PIC X(01).                   01150000
011600         10  PV-SHIPPED-HH           PIC X(02).                   01160000
011700         10  FILLER                  PIC X(01).                   01170000
011800         10  PV-SHIPPED-MN           PIC X(02).                   01180000
011900         10  FILLER                  PIC X(01).                   01190000
012000         10  PV-SHIPPED-SC           PIC X(02).                   01200000
012100         10  FILLER                  PIC X(07).                   01210000
012200     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP SYNC.01220000
012300     05  PV-PARAGRAPH                PIC X(48) VALUE SPACES.      01230000
012400     05  PV-MSG-LENGTH2              PIC S9(9) BINARY.            01240000
012500     05  PV-DC-NBR                   PIC 9(04).                   01250000
012600     05  PV-MSG-LENGTH-DISPLAY       PIC S9(9).                   01260000
012700     05  PV-MSGBUFFER.                                            01270000
012800         10  PV-MSGBUFFER-banner     PIC X(39) VALUE SPACES.      01280000
012900         10  PV-MSGBUFFER-data       PIC X(999999) VALUE SPACES.  01290000
013000     05  PV-CICS-MSG-AREA.                                        01300000
013100         10 PV-PROGRAM-NAME          PIC X(10) VALUE ' SUKCS802 '.01310008
013200         10 PV-PARA-NAME             PIC X(25) VALUE SPACES.      01320000
013300         10 PV-ERROR-MSG             PIC X(86) VALUE SPACES.      01330000
013400     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01340000
013500                                                     COMP SYNC.   01350000
013510     05  PV-SEAL-UPPER-CASE          PIC X(20).                   01351013
013600                                                                  01360000
013610     05  PV-DISP-STR                 PIC  9(04) VALUE ZERO.       01361029
013700****************************************************************  01370000
013800*      M Q   S E R I E S    W O R K I N G   S T O R A G E         01380000
013900*                   M  Q    C O P Y B O O K S                     01390000
014000****************************************************************  01400000
014100 01  MQM-OBJECT-DESCRIPTOR.                                       01410000
014200     COPY CMQODV.                                                 01420000
014300                                                                  01430000
014400 01  MQM-MESSAGE-DESCRIPTOR.                                      01440000
014500     COPY CMQMDV.                                                 01450000
014600                                                                  01460000
014700 01  MQM-GET-MESSAGE-OPTIONS.                                     01470000
014800     COPY CMQGMOV.                                                01480000
014900                                                                  01490000
015000 01  MQM-PUT-MESSAGE-OPTIONS.                                     01500000
015100     COPY CMQPMOV.                                                01510000
015200                                                                  01520000
015300 01  MQM-CONSTANTS.                                               01530000
015400     COPY CMQV.                                                   01540000
015500                                                                  01550000
015600     COPY ISWS002.                                                01560000
015700                                                                  01570000
015800****************************************************************  01580000
015900*  MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS PUT AND        01590000
016000*  OPEN, CONNECT, DISCONNECT. (CICS PARMS)                        01600000
016100****************************************************************  01610000
016200 01  PC-MQCONN                   PIC X(8)  VALUE 'CSQCCONN'.      01620000
016300 01  PC-MQOPEN                   PIC X(8)  VALUE 'CSQCOPEN'.      01630000
016400 01  PC-MQINQ                    PIC X(8)  VALUE 'CSQCINQ'.       01640000
016500 01  PC-MQGET                    PIC X(8)  VALUE 'CSQCGET'.       01650000
016600 01  PC-MQPUT                    PIC X(8)  VALUE 'CSQCPUT'.       01660000
016700 01  PC-MQCLOSE                  PIC X(8)  VALUE 'CSQCCLOS'.      01670000
016800 01  PC-MQCOMM                   PIC X(8)  VALUE 'CSQCCOMM'.      01680000
016900 01  PC-MQDISC                   PIC X(8)  VALUE 'CSQCDISC'.      01690000
017000 01  PC-MQBACK                   PIC X(8)  VALUE 'CSQCBACK'.      01700000
017100 01  PC-MQCHECK                  PIC X(8)  VALUE 'MQR2C'.         01710000
017200                                                                  01720000
017300 01  MQ-WORKING-STORAGE.                                          01730000
017400     05  PC-QMGR-NAME                 PIC X(4)  VALUE SPACES.     01740000
017500         88  PC-PROD-QMGR-NAME                  VALUE 'QKSP'.     01750000
017600         88  PC-ACCEPT-QMGR-NAME                VALUE 'QKSQ'.     01760000
017700         88  PC-TEST-QMGR-NAME                  VALUE 'QKST'.     01770000
017800     05  PC-RESPONSE-QNAME            PIC X(30) VALUE SPACES.     01780000
017900     05  PC-WAIT-15-SECS              PIC S9(9) VALUE 15000.      01790000
018000     05  PC-WAIT-6-SECS               PIC S9(9) VALUE 6000.       01800000
018100     05  PC-DELAY-INTERVAL.                                       01810000
018200         10  FILLER                   PIC X(2)  VALUE SPACES.     01820000
018300         10  PC-DELAY-TIME            PIC 9(8)  VALUE 1500.       01830000
018400****************************************************************  01840000
018500*  QUEUE HANDLES                                                  01850000
018600****************************************************************  01860000
018700 01  PV-MQ-PROGRAM-VARIABLES.                                     01870000
018800     05  PV-QM-NAME              PIC X(48).                       01880000
018900     05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        01890000
019000     05  PV-OPEN-OPTIONS         PIC S9(9) BINARY.                01900000
019100     05  PV-HANDLE               PIC S9(9) BINARY VALUE 0.        01910000
019200     05  PV-COMPLETION-CODE      PIC S9(9) BINARY.                01920000
019300     05  PV-REASON               PIC S9(9) BINARY.                01930000
019400     05  PV-ERROR-MESSAGE        PIC X(48) VALUE SPACES.          01940000
019500     05  PV-CON-REASON           PIC S9(9) BINARY.                01950000
019600     05  PV-MSG-LENGTH           PIC S9(9) BINARY VALUE +60.      01960000
019700     05  PV-DATA-LENGTH          PIC S9(9) BINARY.                01970000
019800     05  PV-REASON-TEXT          PIC X(30) VALUE SPACES.          01980000
019900     05  PV-ACTION               PIC X(60)        VALUE SPACES.   01990000
020000     05  PV-INTRGTN-TYP-CDE      PIC X(10) VALUE SPACES.          02000000
020100     05  PV-APPL-FUNC-DESCE      PIC X(10) VALUE SPACES.          02010000
020200     05  PV-MSG                  PIC X(60) VALUE SPACES.          02020000
020300***************************************************************** 02030000
020400*    PROGRAM VARIABLES FOR QUEUE MANAGER AND QUEUE NAMES.         02040000
020500***************************************************************** 02050000
020600 01  PV-Q-MANAGER-VARIABLES.                                      02060000
020700     05  PV-QMGR-NAME                 PIC X(48).                  02070000
020800     05  PV-QUE-NAME                  PIC X(48).                  02080000
020900     05  PV-HANDLE-XXX           PIC S9(9) BINARY VALUE 0.        02090000
021000     05  PV-QMGR-NAME-PUTAWY          PIC X(48).                  02100000
021100     05  PV-QUE-NAME-PUTAWY           PIC X(48).                  02110000
021110     05  PV-HANDLE-PUTAWY        PIC S9(9) BINARY VALUE 0.        02111000
021120     05  PV-QMGR-NAME-ERROR           PIC X(48).                  02112000
021130     05  PV-QUE-NAME-ERROR            PIC X(48).                  02113000
021140     05  PV-HANDLE-ERROR         PIC S9(9) BINARY VALUE 0.        02114000
021150                                                                  02115000
021151***************************************************************** 02115100
021152*    DB2 VIEW DECLARATION - WSV_PRVDR_QUE                         02115200
021153***************************************************************** 02115300
021154     EXEC SQL                                                     02115400
021155          INCLUDE WSV00005                                        02115500
021156     END-EXEC.                                                    02115600
021157                                                                  02115700
021158***************************************************************** 02115815
021159*    DB2 VIEW DECLARATION - XLT_MDSE_INV_PARM                     02115915
021160***************************************************************** 02116015
021161     EXEC SQL                                                     02116115
021162          INCLUDE XLT00025                                        02116215
021163     END-EXEC.                                                    02116315
021164                                                                  02116415
021165*----------------------------------------------------------------*02116515
021166*    THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT   *02116615
021167*    SUB-ROUTINE (DPKUT100).                                     *02116715
021170*----------------------------------------------------------------*02117000
021171     COPY DPWS010I.                                               02117100
021172                                                                  02117200
021173* RECORD LAYOUT FOR MQ RECORD FOR OMS                             02117300
021174                                                                  02117400
021175 01  TrailerManifest.                                             02117500
021176      05  StatusCode                   PIC X(02) VALUE SPACES.    02117600
021177      05  ShipmentTS                   PIC X(19) VALUE SPACES.    02117700
021178      05  Store                        PIC 9(04) VALUE ZERO.      02117800
021179* Dmh 11/28/16 change to char                                     02117910
021180      05  OutboundTripId               PIC X(09) VALUE spaces.    02118000
021181                                                                  02118100
021190 01  PV-XML                      PIC X(1000)     VALUE SPACES.    02119000
021200 01  PV-HOLD-MSGBUFFER.                                           02120000
021300     05  PV-MSGBUFFER-CHAR OCCURS   1000 TIMES                    02130000
021400                                     PIC X(01).                   02140000
021500                                                                  02150000
021600 01  PV-DISPLAY                  PIC X(132)      VALUE SPACES.    02160000
021700 01  XML-LENGTH                  PIC 9(9)    COMP.                02170000
021800                                                                  02180000
021900     COPY ISWS007.                                                02190000
022000     COPY ISWS008.                                                02200000
022100     COPY ISWS009.                                                02210000
022200                                                                  02220000
022300* RECORD LAYOUT FOR mq RECORD FOR mls WORK REQUEST                02230000
022310     COPY SURD102.                                                02231000
022320                                                                  02232000
022330* INPUT LAYOUT                                                    02233000
022340     COPY SURD118.                                                02234000
022341                                                                  02234100
022342* OUTPUT LAYOUT                                                   02234200
022343     COPY SURD119.                                                02234300
022344                                                                  02234400
022345     COPY DPRD507I.                                               02234500
022349/                                                                 02234925
022350     EXEC SQL                                                     02235025
022351         INCLUDE TSUOBTR                                          02235125
022352     END-EXEC.                                                    02235225
022353                                                                  02235325
022360     EXEC SQL                                                     02236000
022370         INCLUDE TSUOBTS                                          02237000
022380     END-EXEC.                                                    02238000
022390                                                                  02239000
022400     EXEC SQL                                                     02240000
022500         INCLUDE SUT00005                                         02250000
022600     END-EXEC.                                                    02260000
022700                                                                  02270000
022800     EXEC SQL                                                     02280000
022900          INCLUDE XLT00010                                        02290000
023000     END-EXEC.                                                    02300000
023100                                                                  02310000
023200     EXEC SQL                                                     02320000
023300         INCLUDE SUT00006                                         02330000
023400     END-EXEC.                                                    02340000
023500                                                                  02350000
023600     EXEC SQL                                                     02360000
023700         INCLUDE TKRPRPM                                          02370000
023800     END-EXEC.                                                    02380000
023900/                                                                 02390000
024000     EXEC SQL                                                     02400000
024100          INCLUDE SQLCA                                           02410000
024200     END-EXEC.                                                    02420000
024300                                                                  02430000
024310     EXEC SQL                                                     02431005
024320          INCLUDE WST00008                                        02432005
024330     END-EXEC.                                                    02433005
024340                                                                  02434005
024350     EXEC SQL                                                     02435005
024360          INCLUDE WST00009                                        02436005
024370     END-EXEC.                                                    02437005
024380                                                                  02438005
024390     EXEC SQL                                                     02439005
024391          INCLUDE WST00010                                        02439105
024392     END-EXEC.                                                    02439205
024393                                                                  02439305
024400 LINKAGE SECTION.                                                 02440000
024500                                                                  02450000
024600 01  DFHCOMMAREA.                                                 02460000
024700     05  FILLER                         OCCURS  1 TO 4072 TIMES   02470000
024800                                        DEPENDING ON EIBCALEN.    02480000
024900         10  FILLER                     PIC  X(01).               02490000
025000                                                                  02500000
025100 PROCEDURE DIVISION.                                              02510000
025200***************************************************************** 02520000
025300** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02530000
025400** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02540000
025500** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02550000
025600**                                                             ** 02560000
025700** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02570000
025800** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02580000
025900***************************************************************** 02590000
026000 0000-MAIN-MODULE.                                                02600000
026100                                                                  02610000
026200     PERFORM 1000-INITIALIZE.                                     02620000
026300     PERFORM 1100-CHECK-WEBSERV-AVAIL.                            02630000
026400     IF EIBCALEN > 0                                              02640000
026500                                                                  02650000
026600        MOVE DFHCOMMAREA(1:EIBCALEN) TO                           02660000
026700                                      SU118-INP-TRLR-STAT-UPD     02670000
026800                                                                  02680000
026900        PERFORM 1500-VALIDATE-INPUT-FIELDS                        02690000
027000                                                                  02700000
027100        IF PS-NO-ERROR                                            02710000
027200                                                                  02720000
027300           PERFORM 2000-UPDATE-TRAILER-STATUS                     02730000
027400                                                                  02740000
027500        END-IF                                                    02750000
027600     END-IF.                                                      02760000
027700                                                                  02770000
027800     IF PS-NO-ERROR                                               02780000
027900                                                                  02790000
028000        MOVE PC-SUCCESS         TO SU119-RESP-MSG                 02800000
028100        MOVE PC-TSYMSG-00059    TO PV-TSYMSG-NUMBER               02810000
028200                                                                  02820000
028300        PERFORM 9010-SYNCPOINT                                    02830000
028400     END-IF.                                                      02840000
028500                                                                  02850000
028600     PERFORM 9999-RETURN-TRAN.                                    02860029
028700                                                                  02870029
028800                                                                  02880000
028900 1000-INITIALIZE.                                                 02890000
029000                                                                  02900000
029100     INITIALIZE        SU118-INP-TRLR-STAT-UPD                    02910000
029200                       SU119-OUT-TRLR-STAT-UPD.                   02920000
029300     MOVE 'N'       TO PS-ERROR-SW.                               02930000
029400                                                                  02940000
029500 1100-CHECK-WEBSERV-AVAIL.                                        02950000
029600                                                                  02960000
029700      EXEC SQL                                                    02970000
029800        SELECT FUNC_TXT                                           02980000
029900          INTO :KRPRPM-FUNC-TXT                                   02990000
030000          FROM TKRPRPM                                            03000000
030100        WHERE LOC_ID            = 90                              03010000
030200          AND INTFC_SYS_CDE     = 'KHL'                           03020000
030300          AND SYS_PRC_FUNC_CDE  = 'STWEB2'                        03030000
030400          AND FUNC_PRC_STAT_CDE = 'AC'                            03040000
030500          AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP              03050000
030600          AND FUNC_END_TMST    >=  CURRENT TIMESTAMP              03060000
030700          AND FUNC_TXT          = 'Y'                             03070000
030800        WITH UR                                                   03080000
030900      END-EXEC.                                                   03090000
031000                                                                  03100000
031100     EVALUATE TRUE                                                03110000
031200         WHEN SQLCODE = ZERO                                      03120000
031300                                                                  03130000
031400                  CONTINUE                                        03140000
031500                                                                  03150000
031600         WHEN SQLCODE = +100                                      03160000
031700                                                                  03170000
031800              MOVE PC-TSYMSG-03787           TO PV-TSYMSG-NUMBER  03180000
031900              MOVE 'WEB SERVICE updateTrailerStatus NOT AVAILABLE'03190000
032000                                               TO PV-ERROR-MSG    03200000
032100              MOVE '1100-CHECK-WEBSERV-AVAIL ' TO PV-PARA-NAME    03210000
032200              PERFORM 9997-CSSL-LOG-RETURN                        03220000
032300                                                                  03230000
032400         WHEN SQLCODE NOT = ZERO                                  03240000
032500                                                                  03250000
032600              MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER 03260000
032700              MOVE SQLCODE                    TO PV-SQLCODE       03270000
032800              MOVE '1100-CHECK-WEBSERV-AVAIL' TO PV-PARA-NAME     03280000
032900              STRING 'SELECT TKRPRPM FAILED WITH SQLCODE:'        03290000
033000              PV-SQLCODE DELIMITED BY SIZE INTO  PV-ERROR-MSG     03300000
033100              PERFORM 9997-CSSL-LOG-RETURN                        03310000
033200                                                                  03320000
033300     END-EVALUATE.                                                03330000
033400 1500-VALIDATE-INPUT-FIELDS.                                      03340000
033500                                                                  03350000
033520     IF  SU118-TRLR-SEAL-ID NOT EQUAL SPACES                      03352013
033540         MOVE FUNCTION UPPER-CASE(SU118-TRLR-SEAL-ID)             03354013
033550             TO PV-SEAL-UPPER-CASE                                03355013
033570         MOVE PV-SEAL-UPPER-CASE  TO  SU118-TRLR-SEAL-ID          03357013
033580     END-IF.                                                      03358013
033590                                                                  03359013
033600     IF SU118-USER-ID > SPACES                                    03360000
033700        CONTINUE                                                  03370000
033800     ELSE                                                         03380000
033900        SET PS-ERROR TO TRUE                                      03390000
034000        MOVE PC-FAILURE       TO SU119-RESP-MSG                   03400000
034100        MOVE PC-TSYMSG-00007  TO PV-TSYMSG-NUMBER                 03410000
034200     END-IF.                                                      03420000
034300                                                                  03430000
034400                                                                  03440000
034500     IF PS-NO-ERROR                                               03450000
034600        IF SU118-STORE-NBR IS GREATER THAN ZEROES                 03460000
034700                                                                  03470000
034710            MOVE SU118-STORE-NBR  TO PV-STORE-NBR                 03471000
034720        ELSE                                                      03472000
034730                                                                  03473000
034740           SET  PS-ERROR         TO TRUE                          03474000
034750           MOVE PC-FAILURE       TO SU119-RESP-MSG                03475000
034760           MOVE PC-TSYMSG-00334  TO PV-TSYMSG-NUMBER              03476000
034770                                                                  03477000
034780        END-IF                                                    03478000
034790     END-IF.                                                      03479000
034791                                                                  03479100
034792     IF PS-NO-ERROR                                               03479200
034793        IF SU118-OTBND-TRIP-ID > 0                                03479300
034794                                                                  03479400
034795            PERFORM 1700-GET-TRAILER-STATUS-STORE                 03479500
034796                                                                  03479600
034797            IF PV-STORE-NBR  NOT EQUAL SUOBTR-DEST-OPER-UNT-ID    03479700
034798                                                                  03479800
034799*CHANGES START                                                    03479904
034800               PERFORM 2100-CHECK-TRLR-REDIRECT                   03480004
034801                                                                  03480104
034802               IF PS-REDIRECT-FOUND                               03480205
034803                  IF PV-STORE-NBR = WST00010-ATTR-ELEM-NBR        03480305
034804                                                                  03480405
034805                     CONTINUE                                     03480505
034806                                                                  03480605
034807                  ELSE                                            03480705
034808                     SET  PS-ERROR         TO TRUE                03480805
034809                     MOVE PC-FAILURE       TO SU119-RESP-MSG      03480905
034810                     MOVE PC-TSYMSG-03777  TO PV-TSYMSG-NUMBER    03481005
034811                  END-IF                                          03481105
034812               ELSE                                               03481205
034813                                                                  03481305
034814                  SET  PS-ERROR         TO TRUE                   03481405
034815                  MOVE PC-FAILURE       TO SU119-RESP-MSG         03481505
034816                  MOVE PC-TSYMSG-03777  TO PV-TSYMSG-NUMBER       03481605
034817               END-IF                                             03481705
034821                                                                  03482105
034822            END-IF                                                03482205
034823        ELSE                                                      03482305
034824                                                                  03482405
034825            SET PS-ERROR TO TRUE                                  03482505
034826            MOVE PC-FAILURE       TO SU119-RESP-MSG               03482605
034827            MOVE PC-TSYMSG-03778  TO PV-TSYMSG-NUMBER             03482705
034828                                                                  03482805
034829        END-IF                                                    03482905
034830     END-IF.                                                      03483014
034831                                                                  03483105
034834     IF PS-NO-ERROR                                               03483414
034836        MOVE PV-STORE-NBR TO DK-STR-NBR                           03483614
034837                                                                  03483714
034838        PERFORM 2110-CHECK-4-INVENTORY                            03483829
034839                                                                  03483914
034846     END-IF.                                                      03484614
034847                                                                  03484714
034848     IF PS-NO-ERROR                                               03484814
034849        IF SU118-TRLR-STATUS IS GREATER THAN SPACE AND            03484914
034850           ((SU118-TRLR-STATUS = 'SO') OR                         03485014
034851             (SU118-TRLR-STATUS = 'SU'))                          03485114
034852                                                                  03485214
034853            IF SU118-TRLR-STATUS = SUOBTS-TRIP-STAT-CDE           03485314
034854                                                                  03485414
034855               SET  PS-ERROR         TO TRUE                      03485514
034856               MOVE PC-FAILURE       TO SU119-RESP-MSG            03485614
034857               MOVE PC-TSYMSG-03340  TO PV-TSYMSG-NUMBER          03485714
034858                                                                  03485814
034859            ELSE                                                  03485914
034860                                                                  03486014
034861               MOVE SU118-TRLR-STATUS    TO DK-NEXT-STAT-CDE      03486114
034862               MOVE SUOBTS-TRIP-STAT-CDE TO DK-CURR-STAT-CDE      03486214
034863               PERFORM 1800-VALIDATE-STAT-CDE                     03486314
034864                                                                  03486414
034865               IF PS-NOT-VALID-STATUS-CHANGE                      03486514
034866                                                                  03486614
034867                  SET  PS-ERROR         TO TRUE                   03486714
034868                  MOVE PC-FAILURE       TO SU119-RESP-MSG         03486814
034869                  MOVE PC-TSYMSG-02816  TO PV-TSYMSG-NUMBER       03486914
034870                                                                  03487014
034871               END-IF                                             03487114
034872            END-IF                                                03487214
034873        ELSE                                                      03487314
034874                                                                  03487414
034875            SET  PS-ERROR          TO TRUE                        03487514
034876            MOVE PC-FAILURE        TO SU119-RESP-MSG              03487614
034877            MOVE PC-TSYMSG-03779   TO PV-TSYMSG-NUMBER            03487714
034878                                                                  03487814
034879        END-IF                                                    03487914
034880     END-IF.                                                      03488029
034881                                                                  03488129
034882                                                                  03488229
034883 1700-GET-TRAILER-STATUS-STORE.                                   03488329
034884                                                                  03488429
034885     MOVE SU118-OTBND-TRIP-ID TO DK-TRIP-ID                       03488529
034886                                                                  03488629
034887      EXEC SQL                                                    03488729
034888         SELECT                                                   03488829
034889            OBTS.OTBND_TRIP_ID                                    03488929
034890           ,OBTR.DEST_OPER_UNT_ID                                 03489000
034900           ,OBTS.TRIP_STAT_CDE                                    03490000
035000          INTO                                                    03500000
035100            :SUOBTS-OTBND-TRIP-ID                                 03510000
035200           ,:SUOBTR-DEST-OPER-UNT-ID                              03520000
035300           ,:SUOBTS-TRIP-STAT-CDE                                 03530000
035400          FROM                                                    03540000
035500              TSUOBTS OBTS                                        03550000
035600            , TSUOBTR OBTR                                        03560000
035700          WHERE                                                   03570000
035800                OBTS.OTBND_TRIP_ID = :DK-TRIP-ID                  03580000
035900            AND OBTS.OTBND_TRIP_ID = OBTR.OTBND_TRIP_ID           03590000
036000            AND OBTR.TRIP_ACTV_CDE = 'A'                          03600000
036100            AND OBTS.OTBND_STAT_TMST IN                           03610000
036200                    (SELECT  MAX(OBTS1.OTBND_STAT_TMST)           03620000
036300                               FROM  TSUOBTS OBTS1                03630000
036400              WHERE  OBTS1.OTBND_TRIP_ID = OBTS.OTBND_TRIP_ID)    03640000
036500      END-EXEC.                                                   03650000
036600                                                                  03660000
036700      EVALUATE TRUE                                               03670000
036800         WHEN SQLCODE = ZERO                                      03680000
036900                                                                  03690000
037000            CONTINUE                                              03700000
037100                                                                  03710000
037200         WHEN SQLCODE = 100                                       03720000
037300                                                                  03730000
037400            SET  PS-ERROR          TO TRUE                        03740000
037500            MOVE PC-FAILURE        TO SU119-RESP-MSG              03750000
037600            MOVE PC-TSYMSG-03053   TO PV-TSYMSG-NUMBER            03760000
037700                                                                  03770000
037800            STRING 'OUTBOUND TRIP ID NOT FOUND FOR TRIP ID: '     03780000
037900                SU118-OTBND-TRIP-ID DELIMITED BY SIZE INTO        03790000
038000                                                 PV-ERROR-MSG     03800000
038100            MOVE ' 1700-GET-TRAILER-STATUS-STORE ' TO             03810000
038200                                                 PV-PARA-NAME     03820000
038300            PERFORM 9997-CSSL-LOG-RETURN                          03830000
038400                                                                  03840000
038500         WHEN SQLCODE NOT = ZERO                                  03850000
038600                                                                  03860000
038700              MOVE PC-TSYMSG-01570   TO PV-TSYMSG-NUMBER          03870000
038800              MOVE SQLCODE           TO PV-SQLCODE                03880000
038900              MOVE '1700-GET-TRAILER-STATUS-STORE'                03890000
039000                               TO PV-PARA-NAME                    03900000
039100              STRING 'SELECT TSUOBTS FAILED WITH SQLCODE:'        03910000
039200              PV-SQLCODE ' FOR OUTBOUND TRIP ID '                 03920000
039300              SU118-OTBND-TRIP-ID DELIMITED BY SIZE INTO          03930000
039400                               PV-ERROR-MSG                       03940000
039500              PERFORM 9997-CSSL-LOG-RETURN                        03950000
039600                                                                  03960000
039700      END-EVALUATE.                                               03970029
039800                                                                  03980029
039900      EJECT                                                       03990000
040000 1800-VALIDATE-STAT-CDE.                                          04000000
040100                                                                  04010000
040200         EXEC SQL                                                 04020000
040300            SELECT CURR_TRIP_STAT_CDE                             04030000
040400              INTO :SUT00005-CURR-TRIP-STAT-CDE                   04040000
040500              FROM SUT_STAT_ASSN                                  04050000
040600             WHERE CURR_TRIP_STAT_CDE  = :DK-CURR-STAT-CDE        04060000
040700               AND NEXT_TRIP_STAT_CDE  = :DK-NEXT-STAT-CDE        04070000
040800         END-EXEC.                                                04080000
040900                                                                  04090000
041000      EVALUATE TRUE                                               04100000
041100         WHEN SQLCODE = ZERO                                      04110000
041200            SET PS-VALID-STATUS-CHANGE TO TRUE                    04120000
041300         WHEN SQLCODE = +100                                      04130000
041400            SET PS-NOT-VALID-STATUS-CHANGE TO TRUE                04140000
041500         WHEN SQLCODE NOT = ZERO                                  04150000
041600              MOVE PC-TSYMSG-01570   TO PV-TSYMSG-NUMBER          04160000
041700              MOVE SQLCODE           TO PV-SQLCODE                04170000
041800              MOVE ' 1800-VALIDATE-STAT-CDE '                     04180000
041900                                     TO PV-PARA-NAME              04190000
042000              STRING 'SELECT SUT_STAT_ASSN FAILED WITH SQLCODE:'  04200000
042100              PV-SQLCODE DELIMITED BY SIZE INTO PV-ERROR-MSG      04210000
042200                                                                  04220000
042300              PERFORM 9997-CSSL-LOG-RETURN                        04230000
042400                                                                  04240000
042500      END-EVALUATE.                                               04250029
042600                                                                  04260029
042700      EJECT                                                       04270000
042800 2000-UPDATE-TRAILER-STATUS.                                      04280000
042900                                                                  04290000
043000      IF SU118-TRLR-STATUS     = 'SO'                             04300000
043100         PERFORM 2101-CHECK-SEAL                                  04310000
043200      END-IF                                                      04320000
043300                                                                  04330000
043400      IF PS-NO-ERROR                                              04340000
043500         PERFORM 7000-SELECT-TSUOBTS                              04350000
043600         IF PS-NO-ERROR                                           04360000
043700            PERFORM 7100-INSERT-TSUOBTS                           04370000
043800            PERFORM 7030-CHECK-SEND-TO-MLS                        04380000
043900            IF PS-SEND-MANIFEST-TO-MLS-YES                        04390000
044000               PERFORM 8000-MQ-PROCESSING                         04400000
044100            END-IF                                                04410000
044110*CHANGES START                                                    04411002
044200*           IF SU118-TRLR-STATUS     = 'SU'                       04420002
044300*              PERFORM 7040-CHECK-SEND-TO-OMS                     04430002
044400*              IF PS-SEND-MANIFEST-TO-OMS-YES                     04440002
044500*                 PERFORM 8001-MQ-PROCESSING                      04450002
044600*              END-IF                                             04460002
044700*           END-IF                                                04470002
044710*CHANGES END                                                      04471003
044800            PERFORM 7200-INSERT-WRKR-AUD                          04480000
044900         END-IF                                                   04490000
045000      END-IF.                                                     04500029
045100                                                                  04510029
045200                                                                  04520000
045300 2101-CHECK-SEAL.                                                 04530000
045400     PERFORM 7010-SELECT-SEAL-ID                                  04540000
045500     IF SUOBTS-TRLR-SEAL-ID NOT = SU118-TRLR-SEAL-ID              04550000
045600                                                                  04560000
045700**       SET  PS-ERROR TO TRUE                                    04570001
045800**       MOVE PC-FAILURE        TO SU119-RESP-MSG                 04580001
045900**       MOVE PC-TSYMSG-03780   TO PV-TSYMSG-NUMBER               04590001
045910         IF SU118-TRLR-SEAL-ID > SPACES                           04591001
045920                                                                  04592001
045930            CONTINUE                                              04593001
045940                                                                  04594001
045950         ELSE                                                     04595001
045960            SET  PS-ERROR TO TRUE                                 04596001
045970            MOVE PC-FAILURE        TO SU119-RESP-MSG              04597001
045980            MOVE PC-TSYMSG-03051   TO PV-TSYMSG-NUMBER            04598001
046000                                                                  04600000
046100     END-IF.                                                      04610000
046200                                                                  04620000
046300 2100-CHECK-TRLR-REDIRECT.                                        04630004
046400                                                                  04640000
046500     MOVE SU118-OTBND-TRIP-ID         TO DK-TRIP-ID               04650000
046510     MOVE 'N'                         TO PS-REDIRECT-SW           04651005
046600                                                                  04660000
046700     EXEC SQL                                                     04670000
046800         SELECT                                                   04680000
046900               D.ATTR_ELEM_NBR                                    04690004
048700         INTO                                                     04870000
048800             :WST00010-ATTR-ELEM-NBR                              04880006
050600         FROM WST_INTGRTN_TYP A                                   05060004
050610            , WST_ATTR_DEFN   B                                   05061004
050620            , WST_ATTR_ELEM   C                                   05062004
050630            , WST_ATTR_ELEM   D                                   05063004
050640            , WST_ATTR_ELEM   E                                   05064004
050650            , WST_ATTR_ELEM   F                                   05065004
050700         WHERE                                                    05070000
050800              A.INTGRTN_TYP_CDE   = 'TRLRDIVERT'                  05080004
050900          AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE             05090004
051000          AND B.ATTR_DEFN_SEQ_NBR = 1                             05100004
051100          AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE             05110004
051200          AND C.ATTR_DEFN_SEQ_NBR = 1                             05120004
051210          AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE             05121004
051220          AND D.ATTR_DEFN_SEQ_NBR = 2                             05122004
051230          AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE             05123004
051240          AND E.ATTR_DEFN_SEQ_NBR = 3                             05124004
051250          AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE             05125004
051260          AND F.ATTR_DEFN_SEQ_NBR = 4                             05126004
051270          AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR           05127004
051280          AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR           05128004
051290          AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR           05129004
051291          AND C.ATTR_ELEM_NBR     = :DK-TRIP-ID                   05129104
051292          AND E.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP             05129204
051293          AND F.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP             05129304
051300     END-EXEC.                                                    05130000
051400                                                                  05140000
051500     EVALUATE TRUE                                                05150000
051600         WHEN SQLCODE = ZERO                                      05160000
051601         WHEN SQLCODE = -811                                      05160131
051610                                                                  05161005
051700              SET PS-REDIRECT-FOUND     TO TRUE                   05170005
051710                                                                  05171005
051800         WHEN SQLCODE = 100                                       05180000
051900                                                                  05190000
053010              SET PS-REDIRECT-NOT-FOUND TO TRUE                   05301005
053020                                                                  05302005
053100         WHEN SQLCODE NOT = ZERO                                  05310000
053200                                                                  05320000
053300              MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER    05330000
053400              MOVE SQLCODE                 TO PV-SQLCODE          05340000
053500              MOVE ' 2100-CHECK-TRLR-REDIRECT' TO  PV-PARA-NAME   05350004
053600              STRING 'SELECT WST_ATTR_ELEM FAILED WITH SQLCODE:'  05360004
053700              PV-SQLCODE ' FOR OUTBOUND TRIP ID '                 05370000
053800              SU118-OTBND-TRIP-ID DELIMITED BY SIZE INTO          05380000
053900                                            PV-ERROR-MSG          05390000
054000              PERFORM 9997-CSSL-LOG-RETURN                        05400000
054100                                                                  05410000
054200      END-EVALUATE.                                               05420029
054300                                                                  05430029
054400      EJECT                                                       05440000
054401****************************************************************  05440114
054402* IF A STORE IS PERFORMING AN INVENTORY TODAY, DO NOT ALLOW THEM  05440214
054403* TO UPDATE THE STATUS OF A TRAILER.                              05440314
054404*                                                                 05440429
054405* NOTE: +0 MEANS STORE IS PERFORMING PHYSICAL INVENTORY           05440529
054406*       NO TRAILER UPDATES ARE ALLOWED DURING PHYSICAL INVENTORY  05440629
054407****************************************************************  05440729
054408 2110-CHECK-4-INVENTORY.                                          05440829
054409                                                                  05440929
054410     EXEC SQL                                                     05441029
054411         SELECT  PLND_INV_DTE                                     05441129
054412         INTO    :XLT00025-PLND-INV-DTE                           05441229
054413           FROM  XLT_MDSE_INV_PARM                                05441329
054414          WHERE  LOC_NBR          =  :DK-STR-NBR                  05441429
054415            AND  SCN_INV_IND      = 'Y'                           05441529
054416            AND  SCHD_PHY_CNT_CDE = 'PI'                          05441629
054417            AND  PLND_INV_DTE     = CURRENT DATE                  05441729
054418            AND  ACTV_IND         = 'Y'                           05441829
054419            AND  LOC_INV_STAT_CDE = 'IN'                          05441929
054420     END-EXEC.                                                    05442029
054422                                                                  05442229
054423     EVALUATE TRUE                                                05442329
054424         WHEN SQLCODE = ZERO                                      05442429
054425              SET PS-ERROR  TO TRUE                               05442529
054426              MOVE PC-FAILURE        TO SU119-RESP-MSG            05442629
054427              MOVE PC-TSYMSG-03412   TO PV-TSYMSG-NUMBER          05442729
054430                                                                  05443029
054431         WHEN SQLCODE = +100                                      05443129
054432         WHEN SQLCODE = -305                                      05443230
054433              CONTINUE                                            05443330
054434                                                                  05443430
054435         WHEN SQLCODE NOT = ZERO                                  05443530
054436                                                                  05443630
054437              MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER    05443730
054438              MOVE DK-STR-NBR              TO PV-DISP-STR         05443830
054439              MOVE SQLCODE                 TO PV-SQLCODE          05443930
054440              MOVE ' 2110-CHECK-4-INVENTORY ' TO  PV-PARA-NAME    05444030
054441              STRING 'SELECT XLT_MDSE_INV_PARM WITH SQL: '        05444130
054442              PV-SQLCODE ' FOR INVENTORY CHECK '                  05444230
054443              PV-DISP-STR        DELIMITED BY SIZE                05444330
054444                                         INTO PV-ERROR-MSG        05444430
054445              PERFORM 9997-CSSL-LOG-RETURN                        05444530
054446                                                                  05444630
054460     END-EVALUATE.                                                05446029
054461                                                                  05446129
054462 7000-SELECT-TSUOBTS.                                             05446229
054463                                                                  05446329
054464     MOVE SU118-OTBND-TRIP-ID         TO DK-TRIP-ID               05446429
054465                                                                  05446529
054466     EXEC SQL                                                     05446629
054467         SELECT                                                   05446729
054470             BTS.OTBND_TRIP_ID                                    05447004
054480         ,   BTS.OTBND_STAT_TMST                                  05448004
054490         ,   BTS.TRIP_STAT_CDE                                    05449004
054491         ,   BTS.STAT_OPER_UNT_ID                                 05449104
054492         ,   BTS.OTBND_STAT_USR_ID                                05449204
054493         ,   BTS.DOOR_ID                                          05449304
054494         ,   BTS.TRLR_SEAL_ID                                     05449404
054495         ,   BTS.SHIP_SCAC_CDE                                    05449504
054496         ,   BTS.SHIP_DRV_LAST_NM                                 05449604
054497         ,   BTS.SHIP_DRV_FRST_NM                                 05449704
054498         ,   BTS.SHIP_DRV_ID                                      05449804
054499         ,   BTS.TRLR_PRKG_LOC_DESC                               05449904
054500         ,   BTS.TRLR_PRKG_SLOT_NBR                               05450004
054501         ,   BTS.FINCL_POST_TMST                                  05450104
054502         ,   BTS.CPCTY_PCT                                        05450204
054503         ,   BTS.UNUSD_PLLT_QTY                                   05450304
054504         ,   BTS.LOD_BR_QTY                                       05450404
054505                                                                  05450504
054506         INTO                                                     05450604
054507             :SUOBTS-OTBND-TRIP-ID                                05450704
054508         ,   :SUOBTS-OTBND-STAT-TMST                              05450804
054509         ,   :SUOBTS-TRIP-STAT-CDE                                05450904
054510         ,   :SUOBTS-STAT-OPER-UNT-ID                             05451004
054511         ,   :SUOBTS-OTBND-STAT-USR-ID                            05451104
054512         ,   :SUOBTS-DOOR-ID                                      05451204
054513         ,   :SUOBTS-TRLR-SEAL-ID                                 05451304
054514         ,   :SUOBTS-SHIP-SCAC-CDE                                05451404
054515         ,   :SUOBTS-SHIP-DRV-LAST-NM                             05451504
054516         ,   :SUOBTS-SHIP-DRV-FRST-NM                             05451604
054517         ,   :SUOBTS-SHIP-DRV-ID                                  05451704
054518         ,   :SUOBTS-TRLR-PRKG-LOC-DESC                           05451804
054519         ,   :SUOBTS-TRLR-PRKG-SLOT-NBR                           05451904
054520         ,   :SUOBTS-FINCL-POST-TMST                              05452004
054521         ,   :SUOBTS-CPCTY-PCT                                    05452104
054522         ,   :SUOBTS-UNUSD-PLLT-QTY                               05452204
054523         ,   :SUOBTS-LOD-BR-QTY                                   05452304
054524                                                                  05452404
054525         FROM TSUOBTS BTS                                         05452504
054526         WHERE                                                    05452604
054527             BTS.OTBND_TRIP_ID           = :DK-TRIP-ID            05452704
054528         AND BTS.OTBND_STAT_TMST IN                               05452804
054529             (SELECT  MAX(BTS1.OTBND_STAT_TMST)                   05452904
054530                   FROM  TSUOBTS BTS1                             05453004
054531              WHERE  BTS1.OTBND_TRIP_ID = BTS.OTBND_TRIP_ID)      05453104
054532     END-EXEC.                                                    05453204
054533                                                                  05453304
054534     EVALUATE TRUE                                                05453404
054535         WHEN SQLCODE = ZERO                                      05453504
054536              CONTINUE                                            05453604
054537         WHEN SQLCODE = 100                                       05453704
054538                                                                  05453804
054539            SET  PS-ERROR          TO TRUE                        05453904
054540            MOVE PC-FAILURE        TO SU119-RESP-MSG              05454004
054541            MOVE PC-TSYMSG-03053   TO PV-TSYMSG-NUMBER            05454104
054542                                                                  05454204
054543            STRING 'OUTBOUND TRIP ID NOT FOUND FOR TRIP ID: '     05454304
054544                SU118-OTBND-TRIP-ID DELIMITED BY SIZE INTO        05454404
054545                                                 PV-ERROR-MSG     05454504
054546            MOVE ' 7000-SELECT-TSUOBTS '     TO  PV-PARA-NAME     05454604
054547                                                                  05454704
054548            PERFORM 9997-CSSL-LOG-RETURN                          05454804
054549                                                                  05454904
054550         WHEN SQLCODE NOT = ZERO                                  05455004
054551                                                                  05455104
054552              MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER    05455204
054553              MOVE SQLCODE                 TO PV-SQLCODE          05455304
054554              MOVE ' 7000-SELECT-TSUOBTS ' TO  PV-PARA-NAME       05455404
054555              STRING 'SELECT TSUOBTS FAILED WITH SQLCODE:'        05455504
054556              PV-SQLCODE ' FOR OUTBOUND TRIP ID '                 05455604
054557              SU118-OTBND-TRIP-ID DELIMITED BY SIZE INTO          05455704
054558                                            PV-ERROR-MSG          05455804
054559              PERFORM 9997-CSSL-LOG-RETURN                        05455904
054560                                                                  05456004
054561      END-EVALUATE.                                               05456129
054562                                                                  05456229
054563      EJECT                                                       05456304
054570 7010-SELECT-SEAL-ID.                                             05457004
054600                                                                  05460000
054700     MOVE SU118-OTBND-TRIP-ID         TO DK-TRIP-ID               05470000
054800                                                                  05480000
054900     EXEC SQL                                                     05490000
055000         SELECT                                                   05500000
055100             BTS.TRLR_SEAL_ID                                     05510000
055200         INTO                                                     05520000
055300             :SUOBTS-TRLR-SEAL-ID                                 05530000
055400         FROM TSUOBTS BTS                                         05540000
055500         WHERE                                                    05550000
055600             BTS.OTBND_TRIP_ID           = :DK-TRIP-ID            05560000
055700         AND BTS.TRIP_STAT_CDE           = 'DS'                   05570000
055800         AND BTS.OTBND_STAT_TMST IN                               05580000
055900             (SELECT  MAX(BTS1.OTBND_STAT_TMST)                   05590000
056000                   FROM  TSUOBTS BTS1                             05600000
056100              WHERE  BTS1.OTBND_TRIP_ID = BTS.OTBND_TRIP_ID       05610000
056200                 AND BTS1.TRIP_STAT_CDE           = 'DS' )        05620000
056300                                                                  05630000
056400     END-EXEC.                                                    05640000
056500                                                                  05650000
056600     EVALUATE TRUE                                                05660000
056700         WHEN SQLCODE = ZERO                                      05670000
056800              CONTINUE                                            05680000
056900          WHEN SQLCODE = 100                                      05690000
057000                                                                  05700000
057100            SET  PS-ERROR          TO TRUE                        05710000
057200            MOVE PC-FAILURE        TO SU119-RESP-MSG              05720000
057300            MOVE PC-TSYMSG-03053   TO PV-TSYMSG-NUMBER            05730000
057400                                                                  05740000
057500            STRING 'OUTBOUND TRIP ID NOT FOUND FOR TRIP ID: '     05750000
057600                SU118-OTBND-TRIP-ID DELIMITED BY SIZE INTO        05760000
057700                                                 PV-ERROR-MSG     05770000
057800            MOVE ' 7010-SELECT-SEAL-ID '     TO  PV-PARA-NAME     05780000
057900                                                                  05790000
058000            PERFORM 9997-CSSL-LOG-RETURN                          05800000
058100                                                                  05810000
058200         WHEN SQLCODE NOT = ZERO                                  05820000
058300                                                                  05830000
058400              MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER    05840000
058500              MOVE SQLCODE                 TO PV-SQLCODE          05850000
058600              MOVE ' 7010-SELECT-SEAL-ID ' TO PV-PARA-NAME        05860000
058700              STRING 'SELECT TSUOBTS FAILED WITH SQLCODE:'        05870000
058800              PV-SQLCODE ' FOR OUTBOUND TRIP ID '                 05880000
058900              SU118-OTBND-TRIP-ID DELIMITED BY SIZE INTO          05890000
059000                                            PV-ERROR-MSG          05900000
059100              PERFORM 9997-CSSL-LOG-RETURN                        05910000
059200                                                                  05920000
059300      END-EVALUATE.                                               05930029
059400                                                                  05940029
059500      EJECT                                                       05950000
059600                                                                  05960000
059700******************************************************************05970000
059800* CHECK IF WE ARE SENDING TRAILER OPEN RECORD TO MLS SYSTEM.     *05980000
059900* MERCHANDISE LOCATION SYSTEM.                                   *05990000
060000******************************************************************06000000
060100 7030-CHECK-SEND-TO-MLS.                                          06010000
060200                                                                  06020000
060300     EXEC SQL                                                     06030000
060400         SELECT FUNC_TXT                                          06040000
060500           INTO :KRPRPM-FUNC-TXT                                  06050000
060600           FROM TKRPRPM                                           06060000
060700          WHERE LOC_ID            =  90                           06070000
060800            AND INTFC_SYS_CDE     = 'KHL'                         06080000
060900            AND FUNC_PRC_STAT_CDE = 'AC'                          06090000
061000            AND SYS_PRC_FUNC_CDE  = 'MLSMFS'                      06100000
061100            AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP            06110000
061200            AND FUNC_END_TMST    >=  CURRENT TIMESTAMP            06120000
061300         WITH UR                                                  06130000
061400     END-EXEC.                                                    06140000
061500                                                                  06150000
061600     EVALUATE TRUE                                                06160000
061700         WHEN SQLCODE = ZERO                                      06170000
061800              IF  KRPRPM-FUNC-TXT  = 'Y'                          06180000
061900                  SET PS-SEND-MANIFEST-TO-MLS-YES TO TRUE         06190000
062000              ELSE                                                06200000
062100                  SET PS-SEND-MANIFEST-TO-MLS-NO  TO TRUE         06210000
062200              END-IF                                              06220000
062300                                                                  06230000
062400         WHEN SQLCODE = +100                                      06240000
062500              SET PS-SEND-MANIFEST-TO-MLS-NO  TO TRUE             06250000
062600                                                                  06260000
062700         WHEN SQLCODE NOT = ZERO                                  06270000
062800              SET PS-SEND-MANIFEST-TO-MLS-NO  TO TRUE             06280000
062900              MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER    06290000
063000              MOVE SQLCODE                 TO PV-SQLCODE          06300000
063100              MOVE ' 7030-CHECK-SEND-TO-MLS ' TO PV-PARA-NAME     06310000
063200              STRING 'SELECT TKRPRPM FAILED WITH SQLCODE:'        06320000
063300              PV-SQLCODE DELIMITED BY SIZE INTO  PV-ERROR-MSG     06330000
063400              PERFORM 9997-CSSL-LOG-RETURN                        06340000
063500                                                                  06350000
063600     END-EVALUATE.                                                06360000
063700                                                                  06370000
063800******************************************************************06380000
063900* CHECK IF WE ARE SENDING TRAILER OPEN RECORD TO OMS SYSTEM.     *06390000
064000* ORDER MANAGEMENT SYSTEM.                                       *06400000
064100******************************************************************06410000
064200*7040-CHECK-SEND-TO-OMS.                                          06420002
064300*                                                                 06430002
064400*    EXEC SQL                                                     06440002
064500*        SELECT FUNC_TXT                                          06450002
064600*          INTO :KRPRPM-FUNC-TXT                                  06460002
064700*          FROM TKRPRPM                                           06470002
064800*         WHERE LOC_ID            =  90                           06480002
064900*           AND INTFC_SYS_CDE     = 'KHL'                         06490002
065000*           AND FUNC_PRC_STAT_CDE = 'AC'                          06500002
065100*           AND SYS_PRC_FUNC_CDE  = 'OMSMFS'                      06510002
065200*           AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP            06520002
065300*           AND FUNC_END_TMST    >=  CURRENT TIMESTAMP            06530002
065400*        WITH UR                                                  06540002
065500*    END-EXEC.                                                    06550002
065600*                                                                 06560002
065700*    EVALUATE TRUE                                                06570002
065800*        WHEN SQLCODE = ZERO                                      06580002
065900*             IF  KRPRPM-FUNC-TXT  = 'Y'                          06590002
066000*                 SET PS-SEND-MANIFEST-TO-OMS-YES TO TRUE         06600002
066100*             ELSE                                                06610002
066200*                 SET PS-SEND-MANIFEST-TO-MLS-NO  TO TRUE         06620002
066300*             END-IF                                              06630002
066400*                                                                 06640002
066500*        WHEN SQLCODE = +100                                      06650002
066600*             SET PS-SEND-MANIFEST-TO-MLS-NO  TO TRUE             06660002
066700*                                                                 06670002
066800*        WHEN SQLCODE NOT = 0                                     06680002
066900*             SET PS-SEND-MANIFEST-TO-MLS-NO  TO TRUE             06690002
067000*             MOVE PC-TSYMSG-01570           TO PV-TSYMSG-NUMBER  06700002
067100*             MOVE SQLCODE                    TO PV-SQLCODE       06710002
067200*             MOVE ' 7040-CHECK-SEND-TO-OMS ' TO PV-PARA-NAME     06720002
067300*             STRING 'SELECT TKRPRPM FAILED WITH SQLCODE:'        06730002
067400*             PV-SQLCODE DELIMITED BY SIZE INTO  PV-ERROR-MSG     06740002
067500*             PERFORM 9997-CSSL-LOG-RETURN                        06750002
067600*                                                                 06760002
067700*    END-EVALUATE.                                                06770002
067800                                                                  06780000
067900 7100-INSERT-TSUOBTS.                                             06790000
068000                                                                  06800000
068100     EXEC SQL                                                     06810000
068200       INSERT INTO TSUOBTS                                        06820000
068300           ( OTBND_TRIP_ID                                        06830000
068400            ,OTBND_STAT_TMST                                      06840000
068500            ,TRIP_STAT_CDE                                        06850000
068600            ,STAT_OPER_UNT_ID                                     06860000
068700            ,OTBND_STAT_USR_ID                                    06870000
068800            ,DOOR_ID                                              06880000
068900            ,TRLR_SEAL_ID                                         06890000
069000            ,SHIP_SCAC_CDE                                        06900000
069100            ,SHIP_DRV_LAST_NM                                     06910000
069200            ,SHIP_DRV_FRST_NM                                     06920000
069300            ,SHIP_DRV_ID                                          06930000
069400            ,TRLR_PRKG_LOC_DESC                                   06940000
069500            ,TRLR_PRKG_SLOT_NBR                                   06950000
069600            ,FINCL_POST_TMST                                      06960000
069700            ,CPCTY_PCT                                            06970000
069800            ,UNUSD_PLLT_QTY                                       06980000
069900            ,LOD_BR_QTY                                           06990000
070000           )                                                      07000000
070100       VALUES                                                     07010000
070200         (                                                        07020000
070300             :SUOBTS-OTBND-TRIP-ID                                07030000
070400         ,   CURRENT TIMESTAMP                                    07040000
070500         ,   :SU118-TRLR-STATUS                                   07050000
070600         ,   :PV-STORE-NBR                                        07060000
070700         ,   :SU118-USER-ID                                       07070000
070800         ,   :SUOBTS-DOOR-ID                                      07080000
070900         ,   :SU118-TRLR-SEAL-ID                                  07090000
071000         ,   :SUOBTS-SHIP-SCAC-CDE                                07100000
071100         ,   :SUOBTS-SHIP-DRV-LAST-NM                             07110000
071200         ,   :SUOBTS-SHIP-DRV-FRST-NM                             07120000
071300         ,   :SUOBTS-SHIP-DRV-ID                                  07130000
071400         ,   :SUOBTS-TRLR-PRKG-LOC-DESC                           07140000
071500         ,   :SUOBTS-TRLR-PRKG-SLOT-NBR                           07150000
071600         ,   :PC-DEFAULT-TMST                                     07160000
071700         ,   :SUOBTS-CPCTY-PCT                                    07170000
071800         ,   :SUOBTS-UNUSD-PLLT-QTY                               07180000
071900         ,   :SUOBTS-LOD-BR-QTY                                   07190000
072000         )                                                        07200000
072100     END-EXEC.                                                    07210000
072200                                                                  07220000
072300     EVALUATE TRUE                                                07230000
072400         WHEN SQLCODE = ZERO                                      07240000
072500              CONTINUE                                            07250000
072600         WHEN SQLCODE NOT = ZERO                                  07260000
072700              MOVE PC-TSYMSG-01570           TO PV-TSYMSG-NUMBER  07270000
072800              MOVE SQLCODE                   TO PV-SQLCODE        07280000
072900              MOVE ' 7100-INSERT-TSUOBTS  '  TO PV-PARA-NAME      07290000
073000              STRING 'INSERT TSUOBTS FAILED WITH SQLCODE:'        07300000
073100              PV-SQLCODE ' OUTBOUND TRIP#' SU118-OTBND-TRIP-ID    07310000
073200              ' STATUS:' SU118-TRLR-STATUS                        07320000
073300                         DELIMITED BY SIZE INTO  PV-ERROR-MSG     07330000
073400              PERFORM 9997-CSSL-LOG-RETURN                        07340000
073500                                                                  07350000
073600      END-EVALUATE.                                               07360000
073700                                                                  07370000
073800                                                                  07380000
073900 7200-INSERT-WRKR-AUD.                                            07390000
074000                                                                  07400000
074100     MOVE SU118-OTBND-TRIP-ID TO SUT00006-OTBND-TRIP-ID           07410000
074200     IF  SU118-TRLR-STATUS    =  'SO'                             07420000
074300         MOVE 'SUKC802A'  TO  PV-PROGRAM-FUNCTION                 07430000
074400     ELSE                                                         07440000
074500         MOVE 'SUKC802B'  TO  PV-PROGRAM-FUNCTION                 07450000
074600     END-IF.                                                      07460000
074700                                                                  07470000
074800     EXEC SQL                                                     07480000
074900         INSERT INTO SUT_TRIP_WRKR_AUD                            07490000
075000             (                                                    07500000
075100               OTBND_TRIP_ID                                      07510000
075200             , USR_ID                                             07520000
075300             , CRE_TMST                                           07530000
075400             , CRE_BY_PGM_NM                                      07540000
075500                 )                                                07550000
075600                                                                  07560000
075700             VALUES                                               07570000
075800                                                                  07580000
075900                 (                                                07590000
076000                 :SUT00006-OTBND-TRIP-ID                          07600000
076100             ,   :SU118-USER-ID                                   07610000
076200             ,   CURRENT TIMESTAMP                                07620000
076300             ,   :PV-PROGRAM-FUNCTION                             07630000
076400                 )                                                07640000
076500     END-EXEC.                                                    07650000
076600                                                                  07660000
076700     EVALUATE TRUE                                                07670000
076800         WHEN SQLCODE = ZERO                                      07680000
076900              CONTINUE                                            07690000
077000         WHEN SQLCODE NOT = ZERO                                  07700000
077100              MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER   07710000
077200              MOVE SQLCODE                  TO PV-SQLCODE         07720000
077300              MOVE ' 7200-INSERT-WRKR-AUD ' TO PV-PARA-NAME       07730000
077400              STRING 'INSERT WORKER AUDIT FAILED WITH SQLCODE:'   07740000
077500              PV-SQLCODE ' OUTBOUND TRIP#' SU118-OTBND-TRIP-ID    07750000
077600                         DELIMITED BY SIZE INTO  PV-ERROR-MSG     07760000
077700              PERFORM 9997-CSSL-LOG-RETURN                        07770000
077800                                                                  07780000
077900     END-EVALUATE.                                                07790000
078000                                                                  07800000
078100******************************************************************07810000
078200*                                                                 07820000
078300******************************************************************07830000
078400 7300-MOVE-FOR-XML.                                               07840000
078500                                                                  07850000
078600     INITIALIZE PV-SHIPPED-TMST-OUT.                              07860000
078700     MOVE SUOBTS-OTBND-STAT-TMST TO PV-SHIPPED-TMST.              07870000
078800     MOVE PV-SHIPPED-TMST(1:10) TO PV-SHIPPED-DATE.               07880000
078900     MOVE PV-SHIPPED-HH         TO PV-SHIPPED-TIME(1:2).          07890000
079000     MOVE ':'                   TO PV-SHIPPED-TIME(3:1)           07900000
079100                                   PV-SHIPPED-TIME(6:1).          07910000
079200     MOVE 'T'                   TO PV-T.                          07920000
079300     MOVE PV-SHIPPED-MN         TO PV-SHIPPED-TIME(4:2).          07930000
079400     MOVE PV-SHIPPED-SC         TO PV-SHIPPED-TIME(7:2).          07940000
079500     MOVE PV-SHIPPED-TMST-OUT    TO ShipmentTS.                   07950000
079600     MOVE SUOBTS-OTBND-TRIP-ID   TO OutboundTripId.               07960000
079700     MOVE SU118-TRLR-STATUS      TO StatusCode.                   07970000
079800     MOVE PV-STORE-NBR           TO Store.                        07980000
079900                                                                  07990000
080000****************************************************************  08000000
080100* CREATE XML                                                      08010000
080200****************************************************************  08020000
080300 7400-CREATE-MSGS.                                                08030000
080400                                                                  08040000
080500     PERFORM 7500-GENERATE-XML.                                   08050000
080600                                                                  08060000
080700     MOVE PV-XML-BANNER              TO PV-MSGBUFFER-banner.      08070000
080800     MOVE PV-XML(1:XML-LENGTH)       TO PV-MSGBUFFER-data.        08080000
080900     COMPUTE PV-MSG-LENGTH2 = XML-LENGTH                          08090000
081000                           + LENGTH OF PV-XML-BANNER.             08100000
081100     MOVE PV-MSG-LENGTH2 TO PV-MSG-LENGTH-DISPLAY.                08110000
081200     INITIALIZE PS-MQPUT-SUCCESSFUL-IND                           08120000
081300                PC-MQPUT-RETRY-COUNTER.                           08130000
081400                                                                  08140000
081500**************************************OMS**********************   08150000
081600 7500-GENERATE-XML.                                               08160000
081700                                                                  08170000
081800     MOVE SPACES TO PV-XML.                                       08180000
081900     XML GENERATE PV-XML                                          08190000
082000         FROM TrailerManifest                                     08200000
082100         COUNT IN XML-LENGTH                                      08210000
082200         WITH ATTRIBUTES                                          08220000
082300         ON EXCEPTION                                             08230000
082400             DISPLAY TrailerManifest ' PV=' PV-XML                08240000
082500             PERFORM 7600-XML-ERROR                               08250000
082600         NOT ON EXCEPTION                                         08260000
082700             CONTINUE                                             08270000
082800     END-XML.                                                     08280000
082900                                                                  08290000
083000***************************************************************   08300000
083100 7600-XML-ERROR.                                                  08310000
083200                                                                  08320000
083300     PERFORM 9000-EXPLAIN-XML-RESPONSE                            08330000
083400     PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                    08340000
083500                UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           08350000
083600         DISPLAY XML-MSG(XML-LINE-IDX)                            08360000
083700     END-PERFORM.                                                 08370000
083800        MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER          08380000
083900        MOVE '7500-GENERATE-XML '    TO PV-PARA-NAME              08390000
084000        MOVE 'XML GENERATION ERROR'  TO PV-ERROR-MSG              08400000
084100        PERFORM 9997-CSSL-LOG-RETURN.                             08410029
084200                                                                  08420029
084300     COPY ISPD007.                                                08430000
084400     COPY ISPD008.                                                08440000
084500     COPY ISPD009.                                                08450000
084600                                                                  08460000
084700                                                                  08470000
084800***************************************************************** 08480000
084900 8000-MQ-PROCESSING.                                              08490000
085000***************************MLS*********************************** 08500000
085100                                                                  08510000
085200* MQ PROCESSING                                                   08520000
085300       SET PROCESS-MQ-NO TO TRUE.                                 08530000
085400       PERFORM 8100-SELECT-XLTLOC.                                08540000
085500       IF PROCESS-MQ                                              08550000
085600           PERFORM 8200-GET-INPUT-QUEUE-INFO                      08560000
085700           PERFORM 8300-MQSERIES-CONNECT                          08570000
085800           PERFORM 8400-MQSERIES-OPEN                             08580000
085900           PERFORM 8500-PUT-MQ-MESG-ON-QUEUE                      08590000
086000           PERFORM 8600-MQ-CLOSE-QUEUE                            08600000
086100           PERFORM 8700-MQ-DISCONNECT.                            08610000
086200                                                                  08620000
086300*                                                                 08630000
086400***************************************************************** 08640000
086500 8001-MQ-PROCESSING.                                              08650000
086600***************************OMS*********************************** 08660000
086700                                                                  08670000
086800* MQ PROCESSING                                                   08680000
086900       IF PROCESS-MQ                                              08690000
087000           PERFORM 7300-MOVE-FOR-XML                              08700000
087100           PERFORM 7400-CREATE-MSGS                               08710000
087200           PERFORM 8201-GET-INPUT-QUEUE-INFO                      08720000
087300           PERFORM 8300-MQSERIES-CONNECT                          08730000
087400           PERFORM 8400-MQSERIES-OPEN                             08740000
087500           PERFORM 8501-PUT-MQ-MESG-ON-QUEUE                      08750000
087600           PERFORM 8600-MQ-CLOSE-QUEUE                            08760000
087700           PERFORM 8700-MQ-DISCONNECT.                            08770000
087800                                                                  08780000
087900***************************************************************** 08790000
088000 8100-SELECT-XLTLOC.                                              08800000
088100***************************************************************** 08810000
088200                                                                  08820000
088300* ONLY CREATE MQ MESSAGE IF A STORE ('DS') AND NOT EDI            08830000
088400                                                                  08840000
088500         EXEC SQL                                                 08850000
088600            SELECT  LOC_NBR                                       08860000
088700              INTO :XLT00010-LOC-NBR                              08870000
088800              FROM  XLT_LOC                                       08880000
088900             WHERE  LOC_NBR = :PV-STORE-NBR                       08890000
089000               AND  LOC_TYP_CDE = 'DS'                            08900000
089100               AND  E_BUS_IND = 'N'                               08910000
089200         END-EXEC.                                                08920000
089300                                                                  08930000
089400         EVALUATE TRUE                                            08940000
089500             WHEN SQLCODE = +0                                    08950000
089600                 SET PROCESS-MQ TO TRUE                           08960000
089700             WHEN SQLCODE = +100                                  08970000
089800                 SET PROCESS-MQ-NO TO TRUE                        08980000
089900                                                                  08990000
090000             WHEN SQLWARN0 NOT = SPACES                           09000000
090100             WHEN SQLCODE < +0                                    09010000
090200             WHEN SQLCODE > +0                                    09020000
090300                 MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER 09030000
090400                 MOVE '8100-SELECT-XLTLOC'    TO PV-PARA-NAME     09040000
090500                 MOVE SQLCODE                 TO PV-SQLCODE       09050000
090600                 STRING 'SELECT XLT_LOC FAILED WITH SQLCODE:'     09060000
090700                 PV-SQLCODE ' STORE NUMBER#' SU118-STORE-NBR      09070000
090800                         DELIMITED BY SIZE INTO  PV-ERROR-MSG     09080000
090900                 PERFORM 9997-CSSL-LOG-RETURN                     09090000
091000                                                                  09100000
091100         END-EVALUATE.                                            09110000
091200                                                                  09120000
091300***************************************************************** 09130000
091400 8200-GET-INPUT-QUEUE-INFO.                                       09140000
091500***************************************************************** 09150000
091600                                                                  09160000
091700*SELECT  QUEUE MANAGER AND INPUT QUEUE NAME                       09170000
091800                                                                  09180000
091900       INITIALIZE DCLWSV00005.                                    09190000
092000       MOVE 'QUEUE'  TO WSV00005-APPL-FUNC-DESC.                  09200000
092100       MOVE 'MLSMFSTQ'    TO WSV00005-INTGRTN-TYP-CDE.            09210000
092200                                                                  09220000
092300       EXEC SQL                                                   09230000
092400           SELECT                                                 09240000
092500                 LCL_QUE_MGR                                      09250000
092600                ,RMT_QUE_MGR                                      09260000
092700                ,QUE_NM                                           09270000
092800           INTO                                                   09280000
092900                :WSV00005-LCL-QUE-MGR                             09290000
093000               ,:WSV00005-RMT-QUE-MGR                             09300000
093100               ,:WSV00005-QUE-NM                                  09310000
093200           FROM  WSV_PRVDR_QUE                                    09320000
093300          WHERE  APPL_FUNC_DESC  = :WSV00005-APPL-FUNC-DESC       09330000
093400            AND  INTGRTN_TYP_CDE = :WSV00005-INTGRTN-TYP-CDE      09340000
093500       END-EXEC.                                                  09350000
093600                                                                  09360000
093700       EVALUATE TRUE                                              09370000
093800           WHEN SQLCODE = +0                                      09380000
093900               INITIALIZE PV-QMGR-NAME                            09390000
094000               MOVE WSV00005-LCL-QUE-MGR-TEXT  TO PV-QMGR-NAME    09400000
094100               INITIALIZE PV-QUE-NAME                             09410000
094200               MOVE WSV00005-QUE-NM-TEXT       TO PV-QUE-NAME     09420000
094300           WHEN SQLCODE = +100                                    09430000
094400           WHEN SQLWARN0 NOT = SPACES                             09440000
094500           WHEN SQLCODE  NOT = ZERO                               09450000
094600              MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER    09460000
094700              MOVE '8200-GET-INPUT-QUEUE-INFO' TO PV-PARA-NAME    09470000
094800              MOVE SQLCODE                 TO PV-SQLCODE          09480000
094900              STRING 'SELECT QUEUE NAME FROM WSV-PRVDR-QUE '      09490000
095000              'SQLCODE:' PV-SQLCODE                               09500000
095100                         DELIMITED BY SIZE INTO  PV-ERROR-MSG     09510000
095200              PERFORM 9997-CSSL-LOG-RETURN                        09520000
095300                                                                  09530000
095400       END-EVALUATE.                                              09540000
095500                                                                  09550000
095600***************************************************************** 09560000
095700 8201-GET-INPUT-QUEUE-INFO.                                       09570000
095800***************************************************************** 09580000
095900                                                                  09590000
096000*SELECT  QUEUE MANAGER AND INPUT QUEUE NAME                       09600000
096100                                                                  09610000
096200       INITIALIZE DCLWSV00005.                                    09620000
096300       MOVE 'QUEUE'  TO WSV00005-APPL-FUNC-DESC.                  09630000
096400       MOVE 'OMSMFSTQ'    TO WSV00005-INTGRTN-TYP-CDE.            09640000
096500                                                                  09650000
096600       EXEC SQL                                                   09660000
096700           SELECT                                                 09670000
096800                 LCL_QUE_MGR                                      09680000
096900                ,RMT_QUE_MGR                                      09690000
097000                ,QUE_NM                                           09700000
097100           INTO                                                   09710000
097200                :WSV00005-LCL-QUE-MGR                             09720000
097300               ,:WSV00005-RMT-QUE-MGR                             09730000
097400               ,:WSV00005-QUE-NM                                  09740000
097500           FROM  WSV_PRVDR_QUE                                    09750000
097600          WHERE  APPL_FUNC_DESC  = :WSV00005-APPL-FUNC-DESC       09760000
097700            AND  INTGRTN_TYP_CDE = :WSV00005-INTGRTN-TYP-CDE      09770000
097800       END-EXEC.                                                  09780000
097900                                                                  09790000
098000       EVALUATE TRUE                                              09800000
098100           WHEN SQLCODE = +0                                      09810000
098200               INITIALIZE PV-QMGR-NAME                            09820000
098300               MOVE WSV00005-LCL-QUE-MGR-TEXT  TO PV-QMGR-NAME    09830000
098400               INITIALIZE PV-QUE-NAME                             09840000
098500               MOVE WSV00005-QUE-NM-TEXT       TO PV-QUE-NAME     09850000
098600           WHEN SQLCODE = +100                                    09860000
098700           WHEN SQLWARN0 NOT = SPACES                             09870000
098800           WHEN SQLCODE  NOT = ZERO                               09880000
098900              MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER    09890000
099000              MOVE '8201-GET-INPUT-QUEUE-INFO' TO PV-PARA-NAME    09900000
099100              MOVE SQLCODE                 TO PV-SQLCODE          09910000
099200              STRING 'SELECT QUEUE NAME FROM WSV-PRVDR-QUE '      09920000
099300              'SQLCODE:' PV-SQLCODE                               09930000
099400                         DELIMITED BY SIZE INTO  PV-ERROR-MSG     09940000
099500              PERFORM 9997-CSSL-LOG-RETURN                        09950000
099600                                                                  09960000
099700       END-EVALUATE.                                              09970000
099800                                                                  09980000
099900******************************************************************09990000
100000* CONNECT TO XXX QUEUE MANAGER.                                   10000000
100100******************************************************************10010000
100200 8300-MQSERIES-CONNECT.                                           10020000
100300                                                                  10030000
100400     CALL PC-MQCONN USING PV-QMGR-NAME                            10040000
100500                          PV-HCONN                                10050000
100600                          PV-COMPLETION-CODE                      10060000
100700                          PV-REASON.                              10070000
100800                                                                  10080000
100900                                                                  10090000
101000*    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              10100000
101100*    AND EXIT                                                     10110000
101200                                                                  10120000
101300     MOVE PV-REASON TO PV-CON-REASON.                             10130000
101400     IF PV-COMPLETION-CODE = MQCC-OK THEN                         10140000
101500         CONTINUE                                                 10150000
101600     ELSE                                                         10160000
101700         MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER         10170000
101800         MOVE PV-COMPLETION-CODE      TO PV-MQCC                  10180000
101900         MOVE '8300-MQSERIES-CONNECT' TO PV-PARA-NAME             10190000
102000         STRING 'CONNECT TO MQ QUEUE FAILED COMPLETION CODE:'     10200000
102100         PV-MQCC    DELIMITED BY SIZE INTO  PV-ERROR-MSG          10210000
102200                                                                  10220000
102300         PERFORM 9997-CSSL-LOG-RETURN                             10230000
102400     END-IF.                                                      10240000
102500***************************************************************** 10250000
102600*** OPEN THE ITEM QUEUE FOR PUTS TO WS-PRVDR-QUE                  10260000
102700***************************************************************** 10270000
102800 8400-MQSERIES-OPEN.                                              10280000
102900                                                                  10290000
103000     INITIALIZE PV-QMGR-NAME.                                     10300000
103100     MOVE WSV00005-RMT-QUE-MGR-TEXT  TO PV-QMGR-NAME              10310000
103200                                                                  10320000
103300     COMPUTE PV-OPEN-OPTIONS        = MQOO-OUTPUT                 10330000
103400                                    + MQOO-SET-IDENTITY-CONTEXT   10340000
103500                                    + MQOO-FAIL-IF-QUIESCING.     10350000
103600                                                                  10360000
103700                                                                  10370000
103800                                                                  10380000
103900     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            10390000
104000     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        10400000
104100     MOVE PV-QUE-NAME              TO MQOD-OBJECTNAME.            10410000
104200                                                                  10420000
104300     CALL PC-MQOPEN USING PV-HCONN                                10430000
104400                          MQM-OBJECT-DESCRIPTOR                   10440000
104500                          PV-OPEN-OPTIONS                         10450000
104600                          PV-HANDLE                               10460000
104700                          PV-COMPLETION-CODE                      10470000
104800                          PV-REASON.                              10480000
104900                                                                  10490000
105000                                                                  10500000
105100*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE AND EXIT.          10510000
105200                                                                  10520000
105300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         10530000
105400         CONTINUE                                                 10540000
105500     ELSE                                                         10550000
105600         MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER         10560000
105700         MOVE PV-COMPLETION-CODE      TO PV-MQCC                  10570000
105800         MOVE '8400-MQSERIES-OPEN'    TO PV-PARA-NAME             10580000
105900         STRING 'OPEN MQ QUEUE FAILED COMPLETION CODE:'           10590000
106000         PV-MQCC    DELIMITED BY SIZE INTO  PV-ERROR-MSG          10600000
106100                                                                  10610000
106200         PERFORM 9997-CSSL-LOG-RETURN                             10620000
106300      END-IF.                                                     10630000
106400                                                                  10640000
106500***************************************************************** 10650000
106600* PUT THE OUTGOING MQ MESSAGE ON QUEUE                            10660000
106700***************************************************************** 10670000
106800 8500-PUT-MQ-MESG-ON-QUEUE.                                       10680000
106900                                                                  10690000
107000*SET OPTIONS.                                                     10700000
107100     MOVE MQFMT-STRING     TO MQMD-FORMAT.                        10710000
107200     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   10720000
107300     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  10730000
107400                               MQPMO-SET-IDENTITY-CONTEXT.        10740000
107500                                                                  10750000
107600*THE MSG LENGTH FOR THE TRANSACTION IS SET IN WORKING STORAGE.    10760000
107700                                                                  10770000
107800     INITIALIZE SU102-EXTRACT-RECORD.                             10780000
107900     MOVE   SUOBTS-OTBND-TRIP-ID      TO SU102-OTBND-TRIP-ID.     10790000
108000     MOVE   SUOBTS-OTBND-STAT-TMST    TO SU102-SHIPPED-TMST.      10800000
108100     MOVE   SU118-TRLR-STATUS         TO SU102-TRIP-STAT-CDE.     10810000
108200     MOVE   PV-STORE-NBR              TO SU102-DEST-LOC-NBR.      10820000
108300     MOVE SU102-EXTRACT-RECORD        TO PV-MSG.                  10830000
108400                                                                  10840000
108500                                                                  10850000
108600*PUT MSG.                                                         10860000
108700     CALL PC-MQPUT USING PV-HCONN                                 10870000
108800                         PV-HANDLE                                10880000
108900                         MQM-MESSAGE-DESCRIPTOR                   10890000
109000                         MQM-PUT-MESSAGE-OPTIONS                  10900000
109100                         PV-MSG-LENGTH                            10910000
109200                         PV-MSG                                   10920000
109300                         PV-COMPLETION-CODE                       10930000
109400                         PV-REASON.                               10940000
109500                                                                  10950000
109600*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         10960000
109700*AND BREAK OUT OF LOOP                                            10970000
109800     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        10980000
109900         MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER         10990000
110000         MOVE PV-COMPLETION-CODE      TO PV-MQCC                  11000000
110100         MOVE '8500-PUT-MQ-MESG-ON-QUEUE' TO PV-PARA-NAME         11010000
110200         STRING 'PUT MESSAGE ON MQ QUEUE FAILED COMPLETION CODE:' 11020000
110300         PV-MQCC    DELIMITED BY SIZE INTO  PV-ERROR-MSG          11030000
110400                                                                  11040000
110500         PERFORM 9997-CSSL-LOG-RETURN                             11050000
110600     END-IF.                                                      11060000
110700                                                                  11070000
110800***************************************************************** 11080000
110900* PUT THE OUTGOING MQ MESSAGE ON QUEUE - OMS                      11090000
111000***************************************************************** 11100000
111100 8501-PUT-MQ-MESG-ON-QUEUE.                                       11110000
111200                                                                  11120000
111300*SET OPTIONS.                                                     11130000
111400     MOVE MQFMT-STRING     TO MQMD-FORMAT.                        11140000
111500     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   11150000
111600     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  11160000
111700                               MQPMO-SET-IDENTITY-CONTEXT.        11170000
111800                                                                  11180000
111900*PUT MSG.                                                         11190000
112000     CALL PC-MQPUT USING PV-HCONN                                 11200000
112100                         PV-HANDLE                                11210000
112200                         MQM-MESSAGE-DESCRIPTOR                   11220000
112300                         MQM-PUT-MESSAGE-OPTIONS                  11230000
112400                         PV-MSG-LENGTH2                           11240000
112500                         PV-MSGBUFFER                             11250000
112600                         PV-COMPLETION-CODE                       11260000
112700                         PV-REASON.                               11270000
112800                                                                  11280000
112900*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         11290000
113000*AND BREAK OUT OF LOOP                                            11300000
113100     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        11310000
113200         MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER         11320000
113300         MOVE PV-COMPLETION-CODE      TO PV-MQCC                  11330000
113400         MOVE '8501-PUT-MQ-MESG-ON-QUEUE' TO PV-PARA-NAME         11340000
113500         STRING 'PUT MESSAGE ON MQ QUEUE FAILED COMPLETION CODE:' 11350000
113600         PV-MQCC    DELIMITED BY SIZE INTO  PV-ERROR-MSG          11360000
113700                                                                  11370000
113800         PERFORM 9997-CSSL-LOG-RETURN                             11380000
113900     END-IF.                                                      11390000
114000                                                                  11400000
114100***************************************************************** 11410000
114200* MQ SERIES CLOSE QUEUE FOR THE xxx TRANSACTIONS.                 11420000
114300***************************************************************** 11430000
114400 8600-MQ-CLOSE-QUEUE.                                             11440000
114500                                                                  11450000
114600     MOVE PV-QUE-NAME               TO MQOD-OBJECTNAME.           11460000
114700     MOVE PV-QMGR-NAME              TO MQOD-OBJECTQMGRNAME.       11470000
114800                                                                  11480000
114900     CALL PC-MQCLOSE USING PV-HCONN                               11490000
115000                           PV-HANDLE                              11500000
115100                           MQCO-NONE                              11510000
115200                           PV-COMPLETION-CODE                     11520000
115300                           PV-REASON.                             11530000
115400                                                                  11540000
115500*    IF MQ CLOSE FAILED THEN DISPLAY ERROR MESSAGE                11550000
115600*    AND EXIT                                                     11560000
115700                                                                  11570000
115800     IF PV-COMPLETION-CODE = MQCC-OK THEN                         11580000
115900         CONTINUE                                                 11590000
116000     ELSE                                                         11600000
116100         MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER         11610000
116200         MOVE PV-COMPLETION-CODE      TO PV-MQCC                  11620000
116300         MOVE '8600-MQ-CLOSE-QUEUE'   TO PV-PARA-NAME             11630000
116400         STRING 'CLOSE MQ QUEUE FAILED COMPLETION CODE:'          11640000
116500         PV-MQCC    DELIMITED BY SIZE INTO  PV-ERROR-MSG          11650000
116600                                                                  11660000
116700         PERFORM 9997-CSSL-LOG-RETURN                             11670000
116800     END-IF.                                                      11680000
116900                                                                  11690000
117000***************************************************************** 11700000
117100* DISCONNECT FROM QUEUE MANAGER.                                  11710000
117200***************************************************************** 11720000
117300 8700-MQ-DISCONNECT.                                              11730000
117400                                                                  11740000
117500     IF PV-CON-REASON NOT = MQRC-ALREADY-CONNECTED                11750000
117600         CALL PC-MQDISC USING PV-HCONN                            11760000
117700                              PV-COMPLETION-CODE                  11770000
117800                              PV-REASON.                          11780000
117900                                                                  11790000
118000*    IF MQ DISCONNECT FAILED THEN DISPLAY ERROR MESSAGE           11800000
118100*    AND EXIT                                                     11810000
118200                                                                  11820000
118300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         11830000
118400         CONTINUE                                                 11840000
118500     ELSE                                                         11850000
118600         MOVE PC-TSYMSG-01570         TO PV-TSYMSG-NUMBER         11860000
118700         MOVE PV-COMPLETION-CODE      TO PV-MQCC                  11870000
118800         MOVE '8700-MQ-DISCONNECT'    TO PV-PARA-NAME             11880000
118900         STRING 'DISCONNECT MQ QUEUE FAILED COMPLETION CODE:'     11890000
119000         PV-MQCC    DELIMITED BY SIZE INTO  PV-ERROR-MSG          11900000
119100                                                                  11910000
119200         PERFORM 9997-CSSL-LOG-RETURN                             11920000
119300     END-IF.                                                      11930000
119400                                                                  11940000
119500 9997-CSSL-LOG-RETURN.                                            11950000
119600                                                                  11960000
119700     PERFORM 9995-CSSL-LOG.                                       11970000
119800                                                                  11980000
119900     PERFORM 9999-RETURN-TRAN.                                    11990000
120000                                                                  12000000
120100 9995-CSSL-LOG.                                                   12010000
120200                                                                  12020000
120300      MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.     12030000
120400                                                                  12040000
120500      EXEC CICS                                                   12050000
120600           WRITEQ TD                                              12060000
120700            QUEUE   ('CSSL')                                      12070000
120800             FROM   (PV-CICS-MSG-AREA)                            12080000
120900           LENGTH   (PV-COMMAREA-LENGTH)                          12090000
121000             RESP   (PV-CICS-RESPONSE)                            12100000
121100      END-EXEC.                                                   12110000
121200                                                                  12120000
121210* DMH 10/25/17 - BEGIN                                            12121007
121211      INITIALIZE  PV-CICS-MSG-AREA.                               12121107
121212      STRING ' SUKCS802-'                                         12121208
121213             ' TRIP:' SU118-OTBND-TRIP-ID                         12121307
121214             ' SEAL:' SU118-TRLR-SEAL-ID                          12121412
121215             ' STR:'  SU118-STORE-NBR                             12121507
121216             ' ST:'   SU118-TRLR-STATUS                           12121607
121217             ' USR:'  SU118-USER-ID                               12121707
121218                      DELIMITED BY SIZE                           12121807
121219                 INTO PV-CICS-MSG-AREA.                           12121907
121220                                                                  12122007
121221      MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.     12122107
121222                                                                  12122207
121223      EXEC CICS                                                   12122307
121224           WRITEQ TD                                              12122407
121225            QUEUE   ('CSSL')                                      12122507
121226             FROM   (PV-CICS-MSG-AREA)                            12122607
121227           LENGTH   (PV-COMMAREA-LENGTH)                          12122707
121228             RESP   (PV-CICS-RESPONSE)                            12122807
121229      END-EXEC.                                                   12122907
121230                                                                  12123007
121240* DMH 10/25/17 - BEGIN                                            12124007
121300                                                                  12130007
121400 9010-SYNCPOINT.                                                  12140000
121500                                                                  12150000
121600      EXEC CICS                                                   12160000
121700           SYNCPOINT                                              12170000
121800      END-EXEC.                                                   12180000
121900                                                                  12190000
122000 9999-RETURN-TRAN.                                                12200000
122100                                                                  12210000
122200      MOVE PV-TSYMSG-NUMBER      TO DP507I-MSG-NUMBER             12220000
122300                                    SU119-MSG-ID                  12230000
122400                                                                  12240000
122500      PERFORM 9010-READ-SYSTEM-MESSAGE                            12250000
122600      MOVE DP507I-MSG-TEXT       TO SU119-ERROR-TEXT              12260000
122700                                                                  12270000
122800      IF PV-TSYMSG-NUMBER = 03340                                 12280000
122900         PERFORM 9312-SUBSTITUTE-MSG-VAR                          12290000
123000                                                                  12300000
123100      END-IF.                                                     12310000
123200                                                                  12320000
123300     IF PS-ERROR                                                  12330000
123400        INITIALIZE PV-PARA-NAME                                   12340000
123500        MOVE SU119-ERROR-TEXT        TO PV-ERROR-MSG              12350000
123600        STRING 'ERROR MESSAGE ID:' SU119-MSG-ID                   12360000
123700        DELIMITED BY SIZE INTO PV-PARA-NAME                       12370000
123800        PERFORM 9995-CSSL-LOG                                     12380000
123900     END-IF                                                       12390000
124000                                                                  12400000
124100     MOVE SU119-OUT-TRLR-STAT-UPD TO DFHCOMMAREA.                 12410000
124200                                                                  12420000
124300     EXEC CICS                                                    12430029
124310          RETURN                                                  12431029
124320      END-EXEC.                                                   12432029
124400                                                                  12440029
124500 9010-READ-SYSTEM-MESSAGE.                                        12450000
124600     EXEC CICS READ                                               12460000
124700               DATASET ('DPSYSMSG')                               12470000
124800               RIDFLD  (DP507I-MSG-NUMBER)                        12480000
124900               INTO    (DP507I-MESSAGES-INPUT-RECORD)             12490000
125000               RESP    (PV-CICS-RESPONSE)                         12500000
125100     END-EXEC.                                                    12510000
125200*                                                                 12520000
125300     IF  PV-CICS-RESPONSE NOT = 0                                 12530000
125400         SET PS-ERROR           TO TRUE                           12540000
125500         MOVE ' ** ABEND **   UNABLE TO TRANSLATE MESSAGE NUMBER' 12550000
125600                                TO DP507I-MSG-TEXT                12560000
125700     END-IF.                                                      12570000
125800                                                                  12580000
125900 9312-SUBSTITUTE-MSG-VAR.                                         12590000
126000     MOVE +1               TO PV-MSG-VAR-LEAD-SPACE.              12600000
126100     MOVE SU119-ERROR-TEXT TO PV-MSG-VAR-SAVE.                    12610000
126200     INITIALIZE SU119-ERROR-TEXT                                  12620000
126300                PV-MSG-VAR-IND                                    12630000
126400                PV-MSG-STRING-PTR                                 12640000
126500                PV-MSG-REMAINDER.                                 12650000
126600*                                                                 12660000
126700     UNSTRING DP507I-MSG-TEXT DELIMITED BY PC-MSG-VAR-IND         12670000
126800         INTO SU119-ERROR-TEXT                                    12680000
126900                 DELIMITER IN PV-MSG-VAR-IND                      12690000
127000                 COUNT     IN PV-MSG-STRING-PTR                   12700000
127100              PV-MSG-REMAINDER                                    12710000
127200     END-UNSTRING.                                                12720000
127300                                                                  12730000
127400     IF  PV-MSG-STRING-PTR > ZERO                                 12740000
127500         ADD +1            TO PV-MSG-STRING-PTR                   12750000
127600     ELSE                                                         12760000
127700         MOVE +1           TO PV-MSG-STRING-PTR                   12770000
127800     END-IF.                                                      12780000
127900     IF  PV-MSG-VAR-SAVE > SPACE                                  12790000
128000         IF  PV-MSG-VAR-SAVE(1:1) > SPACE                         12800000
128100             CONTINUE                                             12810000
128200         ELSE                                                     12820000
128300             INSPECT PV-MSG-VAR-SAVE                              12830000
128400                 TALLYING PV-MSG-VAR-LEAD-SPACE                   12840000
128500                 FOR LEADING SPACE                                12850000
128600         END-IF                                                   12860000
128700     ELSE                                                         12870000
128800         MOVE '?'         TO PV-MSG-VAR-SAVE                      12880000
128900     END-IF.                                                      12890000
129000*==> FIND LAST NON-BLANK CHARACTER OF THE MSG VAR.                12900000
129100     MOVE LENGTH OF PV-MSG-VAR-SAVE                               12910000
129200                          TO PV-MSG-VAR-LENGTH.                   12920000
129300     PERFORM                                                      12930000
129400         VARYING PV-CHAR-POS                                      12940000
129500         FROM PV-MSG-VAR-LENGTH                                   12950000
129600         BY -1                                                    12960000
129700         UNTIL PV-CHAR-POS < 1                                    12970000
129800           OR PV-MSG-VAR-SAVE(PV-CHAR-POS:1) > SPACE              12980000
129900             CONTINUE                                             12990000
130000     END-PERFORM.                                                 13000000
130100     COMPUTE PV-MSG-VAR-LENGTH =                                  13010000
130200         PV-CHAR-POS - PV-MSG-VAR-LEAD-SPACE + 1.                 13020000
130300     MOVE SUOBTS-TRIP-STAT-CDE                                    13030000
130400                     TO SU119-ERROR-TEXT(PV-MSG-STRING-PTR:2)     13040000
130500     ADD +2                TO PV-MSG-STRING-PTR.                  13050000
130600     IF  PV-MSG-STRING-PTR < LENGTH OF SU119-ERROR-TEXT           13060000
130700         MOVE PV-MSG-REMAINDER                                    13070000
130800                         TO SU119-ERROR-TEXT(PV-MSG-STRING-PTR:)  13080000
130900     END-IF.                                                      13090000
131000*                                                                 13100000
131010                                                                  13101024
