000100 IDENTIFICATION DIVISION.                                         09/18/95
000200 PROGRAM-ID.    RCKCS233.                                         RCKCS233
000300 AUTHOR.        LOUIE CRISOSTOMO.                                    LV002
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          RCKCS233
000500 DATE-WRITTEN.  03-02-94.                                         RCKCS233
000600 DATE-COMPILED.                                                   RCKCS233
000700******************************************************************RCKCS233
000800*    E233 - CREATE RECDIS ROUTINE                                 RCKCS233
000900*                                                                 RCKCS233
001000*    THIS IS A CALLED ROUTINE TO CREATE A RECEIPT DISTRIBUTION    RCKCS233
001100*    RECORD (TRECDIS).  FIRST, IT RETRIEVES EACH STORE'S FUTURE   RCKCS233
001200*    PLANNED QUANTITY AND PRIOR RECEIPTS.  THEN, IT CALCULATES    RCKCS233
001300*    EACH STORE'S OPEN-TO-RECEIVE BY SUBTRACTING PRIOR RECEIPTS   RCKCS233
001400*    FROM THE PLANNED QUANTITY.  THE UNITS RECEIVED IS PRORATED   RCKCS233
001500*    BASED ON EACH STORE'S OPEN-TO-RECEIVE QUANTITY PER TOTAL     RCKCS233
001600*    OPEN-TO-RECEIVE.  THE TRECDIS RECORD IS THEN CREATED USING   RCKCS233
001700*    THE PO, RECEIVER, LINE, STORE, ALLOCATED UNITS AND OPEN-     RCKCS233
001800*    TO-RECEIVE UNITS AMONG OTHER NON-IMPORTANT DATA.  IF THE     RCKCS233
001900*    RECEIVER IS A SPECIFIC PLAN, THE PLANNED QUANTITY IS USED    RCKCS233
002000*    AS ALLOCATED UNITS AND THE TALLPLN IS INACTIVATED.           RCKCS233
002100*                                                                 RCKCS233
      ******************************************************************RCKCS233
      * 03/08/2010 TOM PRIMEAU  WR#38216                                        
      *    HARDCODING CHANGES FOR RC                                            
      *    MOVE CALL TO XLKUT071 TO PARAGRAPH 2233-PROCESS-PLAN                 
      *    SO THAT IT IS DONE BEFORE '870' CHECK.                               
      *    REMOVED HARDCODED 870 CHECK IN 2233-PROCESS-PLAN.                    
      ******************************************************************        
002300 ENVIRONMENT DIVISION.                                            RCKCS233
002400 CONFIGURATION SECTION.                                           RCKCS233
002500 SOURCE-COMPUTER.        IBM-3090.                                RCKCS233
002600 OBJECT-COMPUTER.        IBM-3090.                                RCKCS233
002700 DATA DIVISION.                                                   RCKCS233
002800 WORKING-STORAGE SECTION.                                         RCKCS233
002900                                                                  RCKCS233
003000 01  PC-PROGRAM-CONSTANTS.                                        RCKCS233
003100     05  PC-MAX-RETRIES               PIC S9(4) VALUE +3          RCKCS233
003200                                                COMP SYNC.        RCKCS233
003300     05  PC-Y                         PIC X(01) VALUE 'Y'.        RCKCS233
003400     05  PC-03                        PIC X(02) VALUE '03'.       RCKCS233
003500     05  PC-DS                        PIC X(02) VALUE 'DS'.       RCKCS233
003600     05  PC-DC                        PIC X(02) VALUE 'DC'.       RCKCS233
003700     05  PC-CS                        PIC X(02) VALUE 'CS'.       RCKCS233
003800     05  PC-RV                        PIC X(02) VALUE 'RV'.       RCKCS233
003900     05  PC-CM                        PIC X(02) VALUE 'CM'.       RCKCS233
004000     05  PC-IP                        PIC X(02) VALUE 'IP'.       RCKCS233
004100     05  PC-IN                        PIC X(02) VALUE 'IN'.       RCKCS233
004200     05  PC-AC                        PIC X(02) VALUE 'AC'.       RCKCS233
004300     05  PC-VE                        PIC X(02) VALUE 'VE'.       RCKCS233
004400     05  PC-A                         PIC X(01) VALUE 'A'.        RCKCS233
004500     05  PC-C                         PIC X(01) VALUE 'C'.        RCKCS233
004800     05  PC-R                         PIC X(01) VALUE 'R'.        RCKCS233
004900     05  PC-U                         PIC X(01) VALUE 'U'.        RCKCS233
005000                                                                          
005100     05  PC-ALPHA-1                   PIC X(01) VALUE '1'.        RCKCS233
005200     05  PC-ALPHA-2                   PIC X(01) VALUE '2'.        RCKCS233
005300     05  PC-ALPHA-3                   PIC X(01) VALUE '3'.        RCKCS233
005400     05  PC-ALPHA-4                   PIC X(01) VALUE '4'.        RCKCS233
005500     05  PC-ALPHA-5                   PIC X(01) VALUE '5'.        RCKCS233
005600     05  PC-ALPHA-6                   PIC X(01) VALUE '6'.        RCKCS233
005700     05  PC-ALPHA-7                   PIC X(01) VALUE '7'.        RCKCS233
005800     05  PC-ALPHA-8                   PIC X(01) VALUE '8'.        RCKCS233
005900     05  PC-ALPHA-9                   PIC X(01) VALUE '9'.        RCKCS233
006000                                                                          
006100     05  PC-10-PERCENT          PIC S9V99 VALUE +0.10 COMP-3.     RCKCS233
006200     05  PC-20-PERCENT          PIC S9V99 VALUE +0.20 COMP-3.     RCKCS233
006300     05  PC-30-PERCENT          PIC S9V99 VALUE +0.30 COMP-3.     RCKCS233
006400     05  PC-40-PERCENT          PIC S9V99 VALUE +0.40 COMP-3.     RCKCS233
006500     05  PC-49-PERCENT          PIC S9V99 VALUE +0.49 COMP-3.     RCKCS233
006600     05  PC-50-PERCENT          PIC S9V99 VALUE +0.50 COMP-3.     RCKCS233
006700     05  PC-60-PERCENT          PIC S9V99 VALUE +0.60 COMP-3.     RCKCS233
006800     05  PC-70-PERCENT          PIC S9V99 VALUE +0.70 COMP-3.     RCKCS233
006900     05  PC-80-PERCENT          PIC S9V99 VALUE +0.80 COMP-3.     RCKCS233
007000     05  PC-90-PERCENT          PIC S9V99 VALUE +0.90 COMP-3.     RCKCS233
007100                                                                          
007200     05  PC-1                         PIC S9(9) COMP VALUE +1.    RCKCS233
007300     05  PC-10                        PIC S9(4) COMP VALUE +10.   RCKCS233
007400     05  PC-100                       PIC S9(4) COMP VALUE +100.  RCKCS233
007500     05  PC-261                       PIC S9(4) COMP VALUE +261.  RCKCS233
007600     05  PC-262                       PIC S9(4) COMP VALUE +262.  RCKCS233
007700     05  PC-510                       PIC S9(4) COMP VALUE +510.  RCKCS233
007800     05  PC-511                       PIC S9(4) COMP VALUE +511.  RCKCS233
007900     05  PC-513                       PIC S9(4) COMP VALUE +513.  RCKCS233
008000     05  PC-514                       PIC S9(4) COMP VALUE +514.  RCKCS233
008100     05  PC-515                       PIC S9(4) COMP VALUE +515.  RCKCS233
008200     05  PC-517                       PIC S9(4) COMP VALUE +517.  RCKCS233
008300     05  PC-518                       PIC S9(4) COMP VALUE +518.  RCKCS233
008400     05  PC-520                       PIC S9(4) COMP VALUE +520.  RCKCS233
008500     05  PC-521                       PIC S9(4) COMP VALUE +521.  RCKCS233
008600     05  PC-525                       PIC S9(4) COMP VALUE +525.  RCKCS233
008700     05  PC-526                       PIC S9(4) COMP VALUE +526.  RCKCS233
008800     05  PC-600                       PIC S9(4) COMP VALUE +600.  RCKCS233
008900     05  PC-RCKCS233                  PIC X(08) VALUE 'RCKCS233'. RCKCS233
009000     05  PC-TMKCS521                  PIC X(08) VALUE 'TMKCS521'. RCKCS233
009100     05  PC-ARRAY-MAX                 PIC S9(4) COMP VALUE +500.  RCKCS233
009200     05  PC-99999                     PIC S9(9) COMP VALUE +99999.RCKCS233
009300     05  PC-999                       PIC S9(9) COMP VALUE +999.  RCKCS233
009400     05  PC-OVER                      PIC X(05) VALUE ' OVER'.    RCKCS233
009500     05  PC-SHORT                     PIC X(05) VALUE 'SHORT'.    RCKCS233
009500     05  PC-NEW-STORE                 PIC X(11) VALUE             RCKCS233
009900         ' NEW STORE '.                                           RCKCS233
009500     05  PC-IMPORT                    PIC X(11) VALUE             RCKCS233
009900         '   IMPORT  '.                                           RCKCS233
009500     05  PC-IMPORT-PIC-AD             PIC X(11) VALUE             RCKCS233
009900         'IMP PIC AD '.                                           RCKCS233
009600     05  PC-DEFAULT-DATE              PIC X(10)  VALUE            RCKCS233
009700                                                 '9999-09-09'.    RCKCS233
009800     05  PC-PKS-NBR-NOT-FND           PIC X(10) VALUE             RCKCS233
009900         'NOT FOUND '.                                            RCKCS233
010000     05  PC-UNITS-RECEIVED            PIC X(30) VALUE             RCKCS233
010100         '             UNITS RECEIVED : '.                        RCKCS233
010200     05  PC-STORE-ORDER-QTY           PIC X(30) VALUE             RCKCS233
010300         '              STR ORDER QTY : '.                        RCKCS233
010400     05  PC-STORE-UNITS-OTR           PIC X(30) VALUE             RCKCS233
010500         '  STR UNITS OPEN-TO-RECEIVE : '.                        RCKCS233
010600     05  PC-STORE                     PIC X(30) VALUE             RCKCS233
010700         '                        STR : '.                        RCKCS233
010800     05  PC-STR-CLS-TEXT.                                         RCKCS233
010900         10  PC-STORE-TEXT            PIC X(13) VALUE             RCKCS233
011000         'STORE NUMBER '.                                         RCKCS233
011100         10  PC-STORE-NUMBER          PIC 9(04).                  RCKCS233
011200         10  FILLER                   PIC X(07) VALUE             RCKCS233
011300         ' CLOSED'.                                               RCKCS233
011400         10  FILLER                   PIC X(226) VALUE SPACES.    RCKCS233
011500     05  PC-STR-NOT-RCVG-TEXT.                                    RCKCS233
011600         10  PC-STR-TEXT              PIC X(13) VALUE             RCKCS233
011700         'STORE NUMBER '.                                         RCKCS233
011800         10  PC-STR-NO                PIC 9(04).                  RCKCS233
011900         10  PC-NOT-RCVG-TEXT         PIC X(23) VALUE             RCKCS233
012000         ' NOT OPEN FOR RECEIVING'.                               RCKCS233
012100         10  FILLER                   PIC X(210) VALUE SPACES.    RCKCS233
012200     05  PC-INNR-PACK-TEXT.                                       RCKCS233
012300         10  PC-INNR-PACK-TEXT-1.                                 RCKCS233
012400             15  PC-IP-TEXT-1         PIC X(30) VALUE             RCKCS233
012500             '              INNR PACK QTY : '.                    RCKCS233
012600             15  PC-IP-QTY-1          PIC ZZZZ9.                  RCKCS233
012700             15  FILLER               PIC X(15) VALUE SPACES.     RCKCS233
012800         10  PC-INNR-PACK-TEXT-2.                                 RCKCS233
012900             15  PC-IP-TEXT-2         PIC X(30).                  RCKCS233
013000             15  PC-IP-QTY-2          PIC ZZZZ9.                  RCKCS233
013100             15  FILLER               PIC X(15) VALUE SPACES.     RCKCS233
013200         10  PC-INNR-PACK-TEXT-3.                                 RCKCS233
013300             15  PC-IP-TEXT-3         PIC X(30).                  RCKCS233
013400             15  PC-IP-STR            PIC ZZZZ9.                  RCKCS233
013500             15  FILLER               PIC X(15) VALUE SPACES.     RCKCS233
013600         10  PC-INNR-PACK-TEXT-4.                                 RCKCS233
013700             15  PC-IP-TEXT-4         PIC X(30).                  RCKCS233
013800             15  PC-IP-QTY-4          PIC ZZZZ9.                  RCKCS233
013900             15  FILLER               PIC X(15) VALUE SPACES.     RCKCS233
014000         10  FILLER                   PIC X(50) VALUE SPACES.     RCKCS233
014100                                                                  RCKCS233
014200     05  PC-ZERO-OTR-TEXT.                                        RCKCS233
014300         10  PC-ZERO-OTR-TEXT-1.                                  RCKCS233
014400             15  PC-ZO-TEXT-1         PIC X(25) VALUE             RCKCS233
014500             '         UNITS RECEIVED: '.                         RCKCS233
014600             15  PC-ZO-RCVD           PIC ZZZZZZZZ9.              RCKCS233
014700             15  FILLER               PIC X(16) VALUE SPACES.     RCKCS233
014800         10  PC-ZERO-OTR-TEXT-2.                                  RCKCS233
014900             15  PC-ZO-TEXT-2         PIC X(25) VALUE             RCKCS233
015000             '  UNITS OPEN-TO-RECEIVE: '.                         RCKCS233
015100             15  PC-ZO-OTR            PIC ZZZZZZZZ9.              RCKCS233
015200             15  FILLER               PIC X(16) VALUE SPACES.     RCKCS233
016100         10  FILLER                   PIC X(150) VALUE SPACES.    RCKCS233
014100                                                                  RCKCS233
014200     05  PC-OVER-SHORT-TEXT.                                      RCKCS233
014300         10  PC-OVER-SHORT-TEXT-0.                                RCKCS233
014400             15  PC-OS-TEXT-0.                                    RCKCS233
014400                 20  PC-OS-TEXT-0-LEGEND PIC X(11) VALUE          RCKCS233
014400                    SPACES.                                       RCKCS233
014400                 20  PC-OS-TEXT-0-OVRSHT PIC X(05).               RCKCS233
014400                 20  FILLER              PIC X(09) VALUE          RCKCS233
014400                    ' % USED: '.                                  RCKCS233
014400                 20  FILLER              PIC X(07) VALUE          RCKCS233
014400                    SPACES.                                       RCKCS233
014400                 20  PC-OS-TEXT-0-PCT    PIC Z9.                  RCKCS233
014400                 20  FILLER              PIC X(01) VALUE          RCKCS233
014400                    '%'.                                          RCKCS233
014400                 20  FILLER              PIC X(15) VALUE          RCKCS233
014400                    SPACES.                                       RCKCS233
014300         10  PC-OVER-SHORT-TEXT-1.                                RCKCS233
014400             15  PC-OS-TEXT-1         PIC X(25) VALUE             RCKCS233
014500             '         UNITS RECEIVED: '.                         RCKCS233
014600             15  PC-OS-RCVD           PIC ZZZZZZZZ9.              RCKCS233
014700             15  FILLER               PIC X(16) VALUE SPACES.     RCKCS233
014800         10  PC-OVER-SHORT-TEXT-2.                                RCKCS233
014900             15  PC-OS-TEXT-2         PIC X(25) VALUE             RCKCS233
015000             '  UNITS OPEN-TO-RECEIVE: '.                         RCKCS233
015100             15  PC-OS-OTR            PIC ZZZZZZZZ9.              RCKCS233
015200             15  FILLER               PIC X(16) VALUE SPACES.     RCKCS233
015300         10  PC-OVER-SHORT-TEXT-3.                                RCKCS233
015400             15  PC-OS-TEXT-3         PIC X(18) VALUE             RCKCS233
015500             '            UNITS '.                                RCKCS233
015600             15  PC-OS-TEXT-4         PIC X(05).                  RCKCS233
015700             15  PC-OS-TEXT-5         PIC X(02) VALUE             RCKCS233
015800                                    ': '.                         RCKCS233
015900             15  PC-OS-DIFF           PIC ZZZZZZZZ9.              RCKCS233
016000             15  FILLER               PIC X(16) VALUE SPACES.     RCKCS233
016100         10  FILLER                   PIC X(100) VALUE SPACES.    RCKCS233
016200                                                                  RCKCS233
016300     05  PC-MASTER-SPECIFIC-TEXT.                                 RCKCS233
016400         10  FILLER                   PIC X(50) VALUE             RCKCS233
016500             'UNMATCHED SPECIFIC PLAN.   MASTER PLAN USED.'.      RCKCS233
016600         10  FILLER.                                              RCKCS233
016700             15  FILLER               PIC X(25) VALUE             RCKCS233
016800             '      SPECIFIC PLAN QTY: '.                         RCKCS233
016900             15  PC-OS-SPECIFIC-QTY   PIC ZZZZZZZZ9.              RCKCS233
017000             15  FILLER               PIC X(16) VALUE SPACES.     RCKCS233
017100         10  FILLER.                                              RCKCS233
017200             15  FILLER               PIC X(25) VALUE             RCKCS233
017300             '         UNITS RECEIVED: '.                         RCKCS233
017400             15  PC-OS-MS-RCVD        PIC ZZZZZZZZ9.              RCKCS233
017500             15  FILLER               PIC X(16) VALUE SPACES.     RCKCS233
017600         10  FILLER.                                              RCKCS233
017700             15  FILLER               PIC X(25) VALUE             RCKCS233
017800             '  UNITS OPEN-TO-RECEIVE: '.                         RCKCS233
017900             15  PC-OS-MS-OTR         PIC ZZZZZZZZ9.              RCKCS233
018000             15  FILLER               PIC X(16) VALUE SPACES.     RCKCS233
018100         10  FILLER.                                              RCKCS233
018200             15  FILLER               PIC X(18) VALUE             RCKCS233
018300             '            UNITS '.                                RCKCS233
018400             15  PC-OS-MS-TEXT        PIC X(05).                  RCKCS233
018500             15  FILLER               PIC X(02) VALUE             RCKCS233
018600                                    ': '.                         RCKCS233
018700             15  PC-OS-MS-DIFF        PIC ZZZZZZZZ9.              RCKCS233
018800             15  FILLER               PIC X(16) VALUE SPACES.     RCKCS233
018900                                                                  RCKCS233
019000 01  PS-PROGRAM-SWITCHES.                                         RCKCS233
019100     05  PS-DONE-SW                   PIC  X    VALUE 'N'.        RCKCS233
019200         88  PS-NOT-DONE                        VALUE 'N'.        RCKCS233
019300         88  PS-DONE                            VALUE 'Y'.        RCKCS233
019400     05  PS-PLAN-SW                   PIC  X    VALUE 'M'.        RCKCS233
019500         88  PS-MASTER-PLAN                     VALUE 'M'.        RCKCS233
019600         88  PS-SPECIFIC-PLAN                   VALUE 'S'.        RCKCS233
019700     05  PS-MESSAGE-SW                PIC  X    VALUE 'N'.        RCKCS233
019800         88  PS-USE-SPECIFIC-MSG                VALUE 'Y'.        RCKCS233
019900     05  PS-TALLPLN-SW                PIC  X    VALUE 'N'.        RCKCS233
020000         88  PS-INACT-TALLPLN                   VALUE 'Y'.        RCKCS233
020100     05  PS-MORE-PLAN-SW              PIC  X    VALUE 'Y'.        RCKCS233
020200         88  PS-NO-MORE-PLAN                    VALUE 'N'.        RCKCS233
020300         88  PS-MORE-PLAN                       VALUE 'Y'.        RCKCS233
020400     05  PS-MORE-RECEIPT-SW           PIC  X    VALUE 'Y'.        RCKCS233
020500         88  PS-NO-MORE-RECEIPT                 VALUE 'N'.        RCKCS233
020600         88  PS-MORE-RECEIPT                    VALUE 'Y'.        RCKCS233
021000     05  PS-PKSLIP-FOUND-SW           PIC  X    VALUE 'N'.        RCKCS233
021100         88  PS-PKSLIP-NBR-FOUND                VALUE 'Y'.        RCKCS233
021200         88  PS-PKSLIP-NBR-NOT-FOUND            VALUE 'N'.        RCKCS233
021300     05  PS-UNITS-PROCESSED-SW        PIC  X    VALUE 'Y'.        RCKCS233
021400         88  PS-UNITS-PROCESSED                 VALUE 'Y'.        RCKCS233
021500         88  PS-NO-UNITS-PROCESSED              VALUE 'N'.        RCKCS233
021600     05  PS-TSPSTDS-FOUND-SW          PIC  X    VALUE 'N'.        RCKCS233
021700         88  PS-TSPSTDS-FOUND                   VALUE 'Y'.        RCKCS233
021800         88  PS-TSPSTDS-NOT-FOUND               VALUE 'N'.        RCKCS233
021900     05  PS-TSPSTDS-MATCH-SW          PIC  X    VALUE 'N'.        RCKCS233
022000         88  PS-TSPSTDS-MATCH                   VALUE 'Y'.        RCKCS233
022100         88  PS-TSPSTDS-NOT-MATCH               VALUE 'N'.        RCKCS233
022200                                                                          
022300     05  PS-STORE-SW                  PIC  X    VALUE 'N'.        RCKCS233
022400         88  PS-STORE-IN-TABLE                  VALUE 'Y'.        RCKCS233
022500         88  PS-STORE-NOT-IN-TABLE              VALUE 'N'.        RCKCS233
022300     05  PS-OVER-SHORT-SW             PIC  X VALUE SPACES.        RCKCS233
022400         88  PS-OVER                            VALUE 'O'.        RCKCS233
022500         88  PS-SHORT                           VALUE 'S'.        RCKCS233
           05  PS-PRORATION-SW              PIC  X VALUE SPACE.                 
               88  PS-PRORATION-OLD                   VALUE 'O'.                
               88  PS-PRORATION-MA                    VALUE 'M'.                
022600                                                                  RCKCS233
022700 01  PT-PROGRAM-TABLE.                                            RCKCS233
022800     05  PT-STORE-TABLE               OCCURS 500 TIMES.           RCKCS233
022900         10  PT-STR-NBR               PIC S9(4) VALUE 0 COMP.     RCKCS233
023000         10  PT-STR-PLAN-QTY          PIC S9(9) VALUE 0 COMP.     RCKCS233
023100         10  PT-STR-REC-QTY           PIC S9(9) VALUE 0 COMP.     RCKCS233
023200         10  PT-STR-OTR-UNITS         PIC S9(9) VALUE 0 COMP.     RCKCS233
023300         10  PT-STR-OTR-PACKS         PIC S9(9) VALUE 0 COMP.     RCKCS233
023400         10  PT-STR-OTR-TOTALS        PIC S9(9) VALUE 0 COMP.     RCKCS233
023500         10  PT-STR-ALLOC-PCT         PIC S99V9(5) VALUE 0 COMP-3.RCKCS233
023600         10  PT-STR-ALLOC-UNITS       PIC S9(9) VALUE 0 COMP.     RCKCS233
023700         10  PT-STR-ALLOC-PACKS       PIC S9(9) VALUE 0 COMP.     RCKCS233
023800         10  PT-STR-ALLOC-TOTALS      PIC S9(9) VALUE 0 COMP.     RCKCS233
023900                                                                          
024000         10  PT-STR-ALLOC-SEQ-CDE     PIC X(1)  VALUE SPACE.      RCKCS233
024100         10  PT-STR-RNK-SEQ-NBR       PIC S9(5) VALUE 0 COMP-3.   RCKCS233
024200         10  PT-STR-OTR-TOTALS-MA     PIC S9(9) VALUE 0 COMP.     RCKCS233
024300                                                                  RCKCS233
024400 01  PV-PROGRAM-VARIABLES.                                        RCKCS233
024500     05  PV-SUB-1                     PIC S9(4) VALUE ZERO        RCKCS233
024600                                                COMP SYNC.        RCKCS233
024700     05  PV-SUB-2                     PIC S9(4) VALUE ZERO        RCKCS233
024800                                                COMP SYNC.        RCKCS233
024900     05  PV-STR-SUB                   PIC S9(4) VALUE ZERO        RCKCS233
025000                                                COMP SYNC.        RCKCS233
025100     05  PV-OTR-SUB                   PIC S9(4) VALUE ZERO        RCKCS233
025200                                                COMP SYNC.        RCKCS233
025300     05  PV-RETRY-COUNTER             PIC S9(4) VALUE ZERO        RCKCS233
025400                                                COMP SYNC.        RCKCS233
025500     05  PV-DB2-COUNT                 PIC S9(9) COMP VALUE ZERO.  RCKCS233
025600                                                                  RCKCS233
025700     05  PV-SUM-STR-PLAN-QTY          PIC S9(9) COMP.             RCKCS233
025800     05  PV-SUM-STR-REC-QTY           PIC S9(9) COMP.             RCKCS233
025900     05  PV-SUM-STR-OTR-UNITS         PIC S9(9) COMP.             RCKCS233
026000     05  PV-UNITS-TO-ALLOC            PIC S9(9) COMP.             RCKCS233
026100     05  PV-PACKS-TO-ALLOC            PIC S9(9) COMP.             RCKCS233
026200     05  PV-LEFT-TO-ALLOC             PIC S9(9) COMP-3.           RCKCS233
026300     05  PV-PACKS-PLANNED             PIC S9(4) COMP.             RCKCS233
026400     05  PV-ALLOCATED-PACKS           PIC S9(4) COMP.             RCKCS233
026500     05  PV-UNITS-FOR-STORE           PIC S9(9) COMP.             RCKCS233
026600     05  PV-PACKS-FOR-STORE           PIC S9(4) COMP.             RCKCS233
026700     05  PV-REMAINDER                 PIC S9(9) COMP.             RCKCS233
026800     05  PV-RATIO                     PIC S9V9999 COMP-3.         RCKCS233
027000     05  PV-PCT-OVR-SHT               PIC S999V99 COMP-3.         RCKCS233
027100     05  PV-PCT-OVR-SHT-TEMP          PIC S999    COMP-3.         RCKCS233
027200     05  PV-TEMP                      PIC X(50).                  RCKCS233
027300     05  PV-TEMP-AMT                  PIC 9(9).                   RCKCS233
027400     05  PV-TEMP-QTY                  PIC 9(5).                   RCKCS233
027500     05  PV-CURRENT-DATE              PIC X(10).                  RCKCS233
027800                                                                  RCKCS233
028100     05  PV-FCLTY.                                                RCKCS233
028200         10  PV-FCLTY-N               PIC 9.                      RCKCS233
028300     05  PV-PO.                                                   RCKCS233
028400         10  PV-PO-N                  PIC 9(8).                   RCKCS233
028500     05  PV-LINE.                                                 RCKCS233
028600         10  PV-LINE-N                PIC 999.                    RCKCS233
028700     05  PV-REC-SEQ-NBR.                                          RCKCS233
028800         10  PV-REC-SEQ-NBR-N         PIC 999.                    RCKCS233
028900                                                                          
029000                                                                          
029100     05  PV-ALLOC-OUTR-PK-QTY         PIC S9(7)   COMP-3.         RCKCS233
029200     05  PV-ALLOC-OUTR-PACKS          PIC S9(7)   COMP-3.         RCKCS233
029300     05  PV-ALLOC-OUTR-UNITS          PIC S9(7)   COMP-3.         RCKCS233
029400     05  PV-ALLOC-TOTAL               PIC S9(7)V9(4)   COMP-3.    RCKCS233
029500     05  PV-ALLOC-TOTAL-INTEGER       PIC S9(7)        COMP-3.    RCKCS233
029600     05  PV-ALLOC-TOTAL-DECIMAL       PIC SV9(4)       COMP-3.    RCKCS233
029700     05  PV-TOTAL-ALLOCATED           PIC S9(7)   COMP-3.         RCKCS233
029800     05  PV-FILL-FIRST-OTR-UNITS      PIC S9(7)   COMP-3.         RCKCS233
029900     05  PV-FILL-FIRST-OTR-PACKS      PIC S9(7)   COMP-3.         RCKCS233
030000     05  PV-FILL-FIRST-OTR-TOTALS     PIC S9(7)   COMP-3.         RCKCS233
030100     05  PV-STANDARD-OTR-UNITS        PIC S9(7)   COMP-3.         RCKCS233
030200     05  PV-STANDARD-OTR-PACKS        PIC S9(7)   COMP-3.         RCKCS233
030300     05  PV-STANDARD-OTR-TOTALS       PIC S9(7)   COMP-3.         RCKCS233
030400     05  PV-FILL-LAST-OTR-UNITS       PIC S9(7)   COMP-3.         RCKCS233
030500     05  PV-FILL-LAST-OTR-PACKS       PIC S9(7)   COMP-3.         RCKCS233
030600     05  PV-FILL-LAST-OTR-TOTALS      PIC S9(7)   COMP-3.         RCKCS233
030700     05  PV-CSTOCK-OTR-UNITS          PIC S9(7)   COMP-3.         RCKCS233
030800     05  PV-CSTOCK-OTR-PACKS          PIC S9(7)   COMP-3.         RCKCS233
030900     05  PV-CSTOCK-OTR-TOTALS         PIC S9(7)   COMP-3.         RCKCS233
031000     05  PV-OVER-SHORT-UNITS          PIC S9(7)   COMP-3.         RCKCS233
031100     05  PV-OVER-SHORT-PACKS          PIC S9(7)   COMP-3.         RCKCS233
031200     05  PV-OVER-SHORT-TOTALS         PIC S9(7)   COMP-3.         RCKCS233
031300     05  PV-OVER-SHORT-AMT            PIC S9(7)   COMP-3.         RCKCS233
031300     05  PV-REMAINING-STR-OTR         PIC S9(7)   COMP-3.         RCKCS233
031500     05  PV-LOOP-COUNT                PIC S9(7)   COMP-3.         RCKCS233
031600     05  PV-PK-SIZE-RND-CDE           PIC X(01)  VALUE SPACE.     RCKCS233
031700         88  PV-VALID-PK-SIZE-RND-CDE     VALUES ARE                      
031800             '1'  '2'  '3'  '4'  '5'  '6'  '7'  '8'  '9'                  
031900             'D'  'R'  'U'.                                               
032000                                                                          
032100     05  PV-HOLD-ALLOC-SEQ-CODE       PIC X(01).                  RCKCS233
031500     05  PV-SHIPT-OVRG-PCT            PIC S9(2)V  COMP-3.         RCKCS233
031500     05  PV-SHIPT-SHTG-PCT            PIC S9(2)V  COMP-3.         RCKCS233
032200                                                                          
032300                                                                  RCKCS233
032400 01  PRV-PROGRAM-RETURN-VARIABLES.                                RCKCS233
032500     05  PRV-00                       PIC X(42) VALUE             RCKCS233
032600         '00PROGRAM CALL WAS SUCCESSFUL             '.            RCKCS233
032700     05  PRV-01                       PIC X(42) VALUE             RCKCS233
032800         '01DIDNT ALLOCATE TO STORES DUE TO TROUBLE '.            RCKCS233
032900     05  PRV-30                       PIC X(42) VALUE             RCKCS233
033000         '30INVALID LINE NUMBER                     '.            RCKCS233
033300     05  PRV-32                       PIC X(42) VALUE             RCKCS233
033400         '32DB2-ERROR - TSPSTDS DELETE              '.            RCKCS233
033700     05  PRV-34                       PIC X(42) VALUE             RCKCS233
033800         '34DB2-ERROR - TSPSTDS SELECT              '.            RCKCS233
034700     05  PRV-3A                       PIC X(42) VALUE             RCKCS233
034800         '3ADB2-ERROR - TALLPLN SELECT              '.            RCKCS233
034900     05  PRV-3B                       PIC X(42) VALUE             RCKCS233
035000         '3BDB2-ERROR - TMESTDS SELECT              '.            RCKCS233
035100     05  PRV-3C                       PIC X(42) VALUE             RCKCS233
035200         '3CDB2-ERROR - TRECITM SELECT              '.            RCKCS233
035300     05  PRV-3D                       PIC X(42) VALUE             RCKCS233
035400         '3DRECORD NOT FOUND - PLAN-CSR FETCH       '.            RCKCS233
035500     05  PRV-3E                       PIC X(42) VALUE             RCKCS233
035600         '3EDB2-ERROR - PLAN-CSR OPEN               '.            RCKCS233
035700     05  PRV-3F                       PIC X(42) VALUE             RCKCS233
035800         '3FDB2-ERROR - PLAN-CSR FETCH              '.            RCKCS233
035900     05  PRV-3G                       PIC X(42) VALUE             RCKCS233
036000         '3GDB2-ERROR - PLAN-CSR CLOSE              '.            RCKCS233
036100     05  PRV-3H                       PIC X(42) VALUE             RCKCS233
036200         '3HSTORE ARRAY HAS REACHED MAXIMUM LIMIT   '.            RCKCS233
036300     05  PRV-3I                       PIC X(42) VALUE             RCKCS233
036400         '3IDB2-ERROR - RECEIPT-CSR OPEN            '.            RCKCS233
036500     05  PRV-3J                       PIC X(42) VALUE             RCKCS233
036600         '3JDB2-ERROR - RECEIPT-CSR FETCH           '.            RCKCS233
036700     05  PRV-3K                       PIC X(42) VALUE             RCKCS233
036800         '3KDB2-ERROR - RECEIPT-CSR CLOSE           '.            RCKCS233
036900     05  PRV-3L                       PIC X(42) VALUE             RCKCS233
037000         '3LDB2-ERROR - TRECDIS SELECT              '.            RCKCS233
037100     05  PRV-3M                       PIC X(42) VALUE             RCKCS233
037200         '3MDB2-ERROR - TCOCNTL SELECT              '.            RCKCS233
037500     05  PRV-3O                       PIC X(42) VALUE             RCKCS233
037600         '3ODB2-ERROR - TRECEIV SELECT              '.            RCKCS233
038500     05  PRV-3T                       PIC X(42) VALUE             RCKCS233
038600         '3TDB2-ERROR - TRECDIS INSERT              '.            RCKCS233
038700     05  PRV-3U                       PIC X(42) VALUE             RCKCS233
038800         '3UDB2-ERROR - TALLPLN UPDATE              '.            RCKCS233
038900     05  PRV-3V                       PIC X(42) VALUE             RCKCS233
039000         '3VDB2-SEL ERR - XLT_LOC, XLT_DC_LOC_ASGMT '.            RCKCS233
039100     05  PRV-3W                       PIC X(42) VALUE             RCKCS233
039200         '3WDB2-ERROR - TPURITM SELECT              '.            RCKCS233
039300     05  PRV-3X                       PIC X(42) VALUE             RCKCS233
039400         '3XDB2-ERROR - REDISTRO-CSR OPEN           '.            RCKCS233
039500     05  PRV-3Y                       PIC X(42) VALUE             RCKCS233
039600         '3YDB2-ERROR - REDISTRO-CSR FETCH          '.            RCKCS233
039700     05  PRV-3Z                       PIC X(42) VALUE             RCKCS233
039800         '3ZDB2-ERROR - REDISTRO-CSR CLOSE          '.            RCKCS233
039900     05  PRV-TM500-RETURN-MSG.                                    RCKCS233
040000         10  PRV-PGM                  PIC X(3).                   RCKCS233
040100         10  FILLER                   PIC X(1).                   RCKCS233
040200         10  PRV-PARA                 PIC X(4).                   RCKCS233
040300         10  FILLER                   PIC X(1).                   RCKCS233
040400         10  PRV-TBL                  PIC X(7).                   RCKCS233
040500         10  FILLER                   PIC X(1).                   RCKCS233
040600         10  PRV-OP                   PIC 9(4).                   RCKCS233
040700         10  FILLER                   PIC X(1).                   RCKCS233
040800         10  PRV-FCLTY                PIC X(1).                   RCKCS233
040900         10  FILLER                   PIC X(1).                   RCKCS233
041000         10  PRV-PO                   PIC X(8).                   RCKCS233
041100         10  FILLER                   PIC X(1).                   RCKCS233
041200         10  PRV-LINE                 PIC X(3).                   RCKCS233
041300         10  FILLER                   PIC X(1).                   RCKCS233
041400         10  PRV-REC-SEQ-NBR          PIC X(3).                   RCKCS233
041600                                                                  RCKCS233
041700******************************************************************RCKCS233
041800*    COPYBOOK AREA                                                RCKCS233
041900******************************************************************RCKCS233
042000     COPY TMWS500.                                                RCKCS233
005770*----------------------------------------------------------------*        
005780*  COPYBOOK FOR LOCATION CALL MODULE                                      
005790*-----------------------------------------------------------------        
005800     COPY XLWS071.                                                        
042100                                                                  RCKCS233
042200******************************************************************RCKCS233
042300*    DB2 SQL COMMUNICATION AREA                                   RCKCS233
042400******************************************************************RCKCS233
042500     EXEC SQL                                                     RCKCS233
042600          INCLUDE SQLCA                                           RCKCS233
042700     END-EXEC.                                                    RCKCS233
042800                                                                  RCKCS233
042900******************************************************************RCKCS233
043000*    DB2 DCLGEN FOR PURCHASE ITEM TABLE                           RCKCS233
043100******************************************************************RCKCS233
043200     EXEC SQL                                                     RCKCS233
043300          INCLUDE TPURITM                                         RCKCS233
043400     END-EXEC.                                                    RCKCS233
043500                                                                  RCKCS233
043600******************************************************************RCKCS233
043700*    DB2 DCLGEN FOR ALLOCATION PLAN TABLE                         RCKCS233
043800******************************************************************RCKCS233
043900     EXEC SQL                                                     RCKCS233
044000          INCLUDE TALLPLN                                         RCKCS233
044100     END-EXEC.                                                    RCKCS233
044200                                                                  RCKCS233
044300******************************************************************RCKCS233
044400*    DB2 DCLGEN FOR MERCHANDISE STORE DISTRIBUTION PLAN TABLE     RCKCS233
044500******************************************************************RCKCS233
044600     EXEC SQL                                                     RCKCS233
044700          INCLUDE TMESTDS                                         RCKCS233
044800     END-EXEC.                                                    RCKCS233
044900                                                                  RCKCS233
046400******************************************************************RCKCS233
046500*    DB2 DCLGEN FOR RECEIVER TABLE                                RCKCS233
046600******************************************************************RCKCS233
046700     EXEC SQL                                                     RCKCS233
046800          INCLUDE TRECEIV                                         RCKCS233
046900     END-EXEC.                                                    RCKCS233
047000                                                                  RCKCS233
047100******************************************************************RCKCS233
047200*    DB2 DCLGEN FOR TROUBLE NOTIFICATIONS TABLE                   RCKCS233
047300******************************************************************RCKCS233
047400     EXEC SQL                                                     RCKCS233
047500          INCLUDE TTRBNTF                                         RCKCS233
047600     END-EXEC.                                                    RCKCS233
047700                                                                  RCKCS233
047800******************************************************************RCKCS233
047900*    DB2 DCLGEN FOR RECEIPT ITEM TABLE                            RCKCS233
048000******************************************************************RCKCS233
048100     EXEC SQL                                                     RCKCS233
048200          INCLUDE TRECITM                                         RCKCS233
048300     END-EXEC.                                                    RCKCS233
048400                                                                  RCKCS233
048500******************************************************************RCKCS233
048600*    DB2 DCLGEN FOR RECEIPT DISTRIBUTION TABLE                    RCKCS233
048700******************************************************************RCKCS233
048800     EXEC SQL                                                     RCKCS233
048900          INCLUDE TRECDIS                                         RCKCS233
049000     END-EXEC.                                                    RCKCS233
049100                                                                  RCKCS233
049200******************************************************************RCKCS233
049300*    DB2 DCLGEN FOR COMPANY CONTROL TABLE                         RCKCS233
049400******************************************************************RCKCS233
049500     EXEC SQL                                                     RCKCS233
049600          INCLUDE TCOCNTL                                         RCKCS233
049700     END-EXEC.                                                    RCKCS233
049800                                                                  RCKCS233
050500/                                                                 RCKCS233
050600******************************************************************RCKCS233
050700*    DB2 DCLGEN FOR SPECIFIC PLAN DISTRIBUTION TABLE              RCKCS233
050800******************************************************************RCKCS233
050900     EXEC SQL                                                     RCKCS233
051000          INCLUDE TSPSTDS                                         RCKCS233
051100     END-EXEC.                                                    RCKCS233
051200/                                                                 RCKCS233
051300******************************************************************RCKCS233
051400*    DECLARE PLAN CURSOR                                          RCKCS233
051500******************************************************************RCKCS233
051600     EXEC SQL                                                     RCKCS233
051700          DECLARE PLAN-CSR CURSOR FOR                             RCKCS233
051800          SELECT STR_NBR                                          RCKCS233
051900               , STR_DISTRO_QTY                                   RCKCS233
052000               , ALLOC_SEQ_CDE                                    RCKCS233
052100               , RNK_SEQ_NBR                                      RCKCS233
052200            FROM TMESTDS                                          RCKCS233
052300           WHERE PO_NBR     = :TM500-PO-NBR                       RCKCS233
052400             AND PO_LNE_NBR = :PURITM-PO-LNE-NBR                  RCKCS233
052500             AND PLAN_NBR   = :ALLPLN-PLAN-NBR                    RCKCS233
052600           ORDER BY STR_NBR                                       RCKCS233
052700     END-EXEC.                                                    RCKCS233
052800                                                                  RCKCS233
052900******************************************************************RCKCS233
053000*    DECLARE SPECIFIC PLAN CURSOR                                 RCKCS233
053100******************************************************************RCKCS233
053200     EXEC SQL                                                     RCKCS233
053300          DECLARE SPECIFIC-PLAN-CSR CURSOR FOR                    RCKCS233
053400          SELECT STR_NBR                                          RCKCS233
053500               , STR_DISTRO_QTY                                   RCKCS233
053600            FROM TSPSTDS                                          RCKCS233
053700           WHERE PO_NBR     = :TM500-PO-NBR                       RCKCS233
053800             AND PO_LNE_NBR = :PURITM-PO-LNE-NBR                  RCKCS233
053900             AND PLAN_NBR   = :ALLPLN-PLAN-NBR                    RCKCS233
054000           ORDER BY STR_NBR                                       RCKCS233
054100     END-EXEC.                                                    RCKCS233
054200                                                                  RCKCS233
054300******************************************************************RCKCS233
054400*    DECLARE RE-DISTRO CURSOR                                     RCKCS233
054500******************************************************************RCKCS233
054600     EXEC SQL                                                     RCKCS233
054700          DECLARE REDISTRO-CSR CURSOR FOR                         RCKCS233
054800          SELECT REC_SEQ_NBR                                      RCKCS233
054900            FROM TRECITM                                          RCKCS233
055000           WHERE ORD_NBR         = :TM500-PO-NBR                  RCKCS233
055100             AND ORD_LNE_NBR     = :TM500-PO-LNE-NBR              RCKCS233
055200             AND OPER_UNT_ID     = :TM500-OPER-UNT-ID             RCKCS233
055300             AND REC_SEQ_NBR    ^= :TM500-REC-SEQ-NBR             RCKCS233
055300             AND VER_STATUS_CDE  = :PC-A                          RCKCS233
055400             AND (CRE_TMST       < :RECITM-CRE-TMST OR            RCKCS233
055500                  STATUS_CDE     = :PC-VE)                        RCKCS233
055600           ORDER BY REC_SEQ_NBR                                   RCKCS233
055700     END-EXEC.                                                    RCKCS233
055800                                                                  RCKCS233
055900******************************************************************RCKCS233
056000*    DECLARE RECEIPT CURSOR                                       RCKCS233
056100******************************************************************RCKCS233
056200     EXEC SQL                                                     RCKCS233
056300          DECLARE RECEIPT-CSR CURSOR FOR                          RCKCS233
056400          SELECT DISTINCT REC_SEQ_NBR                             RCKCS233
056500            FROM TRECITM                                          RCKCS233
056600           WHERE ORD_NBR         = :TM500-PO-NBR                  RCKCS233
056700             AND ORD_LNE_NBR     = :TM500-PO-LNE-NBR              RCKCS233
056800             AND OPER_UNT_ID     = :TM500-OPER-UNT-ID             RCKCS233
056900             AND REC_SEQ_NBR    ^= :TM500-REC-SEQ-NBR             RCKCS233
057000             AND VER_STATUS_CDE  = :PC-A                          RCKCS233
057100             AND STATUS_CDE     IN (:PC-IP, :PC-CM, :PC-VE)       RCKCS233
057200           ORDER BY REC_SEQ_NBR                                   RCKCS233
057300     END-EXEC.                                                    RCKCS233
057400/                                                                 RCKCS233
057500 LINKAGE SECTION.                                                 RCKCS233
057600                                                                  RCKCS233
057700 01  DFHCOMMAREA.                                                 RCKCS233
057800     05  FILLER                       OCCURS 1 TO 600  TIMES      RCKCS233
057900                                      DEPENDING ON EIBCALEN.      RCKCS233
058000         10  FILLER                   PIC X.                      RCKCS233
058100                                                                  RCKCS233
058200/                                                                 RCKCS233
058300 PROCEDURE DIVISION.                                              RCKCS233
058400                                                                  RCKCS233
058500 0000-MAIN-MODULE.                                                RCKCS233
058600                                                                  RCKCS233
058700     PERFORM 1000-INITIAL-PROCESS.                                RCKCS233
058800                                                                  RCKCS233
058900     IF PS-NOT-DONE                                               RCKCS233
059000         PERFORM 2000-MAIN-PROCESS                                RCKCS233
059100     END-IF.                                                      RCKCS233
059200                                                                  RCKCS233
059300     MOVE TM500-FIELDS TO DFHCOMMAREA.                            RCKCS233
059400                                                                  RCKCS233
059500     GOBACK.                                                      RCKCS233
059600                                                                  RCKCS233
059700                                                                  RCKCS233
059800 1000-INITIAL-PROCESS.                                            RCKCS233
059900                                                                  RCKCS233
060000     INITIALIZE TM500-FIELDS.                                     RCKCS233
060100     INITIALIZE PT-PROGRAM-TABLE.                                 RCKCS233
060200     INITIALIZE PV-PROGRAM-VARIABLES.                             RCKCS233
060300                                                                  RCKCS233
060400     IF EIBCALEN = 0                                              RCKCS233
060500         SET PS-DONE           TO TRUE                            RCKCS233
060600     ELSE                                                         RCKCS233
060700         MOVE DFHCOMMAREA      TO TM500-FIELDS                    RCKCS233
060800         MOVE PRV-00           TO TM500-RETURN-DATA               RCKCS233
060900     END-IF.                                                      RCKCS233
061000                                                                  RCKCS233
061100     IF TM500-PO-LNE-NBR < 1 OR TM500-PO-LNE-NBR > PC-999         RCKCS233
061200         SET PS-DONE TO TRUE                                      RCKCS233
061300         MOVE PRV-30 TO TM500-RETURN-DATA                         RCKCS233
061400                                                                  RCKCS233
061500         MOVE SPACES TO PRV-TM500-RETURN-MSG                      RCKCS233
061600         MOVE '1000' TO PRV-PARA                                  RCKCS233
061700         MOVE SPACES TO PRV-TBL                                   RCKCS233
061800         PERFORM 9999-RETURN-MSG                                  RCKCS233
061900     END-IF.                                                      RCKCS233
062000                                                                  RCKCS233
213800     EXEC SQL                                                     RCKCS233
213900          SET :PV-CURRENT-DATE = CURRENT DATE                     RCKCS233
214000     END-EXEC.                                                    RCKCS233
062100                                                                  RCKCS233
062200 2000-MAIN-PROCESS.                                               RCKCS233
062300******************************************************************RCKCS233
062400*    THIS PARAGRAPH CALLS THE FOLLOWING PARAGRAPH:                RCKCS233
062500*    - 2100 CHECKS IF THE RECEIPT IS A SPECIFIC OR MASTER PLAN    RCKCS233
062600*    - 2200 BUILDS A TABLE OF STORES TO ALLOCATE UNITS RECEIVED   RCKCS233
062700*    - 2300 SORTS THE STORES TABLE                                RCKCS233
062800*    - 2400 CHECKS IF THE RECEIPT IS OVER OR SHORT OF PLAN        RCKCS233
062900*    - 2500 PRORATES THE UNITS RECEIVED                           RCKCS233
063100*    - 2700 ALLOCATES THE UNITS RECEIVED                          RCKCS233
063200*    - 2800 INACTIVATES THE TALLPLN RECORDS IF ITS A SPECIFIC PLANRCKCS233
063300*    -      WHERE TMESTDS QTY DOES NOT MATCH TALLPLAN QTY.        RCKCS233
063400*    - 4000 PRORATES THE UNITS RECEIVED USING NEW MA CRITERIA     RCKCS233
063500******************************************************************RCKCS233
063600                                                                  RCKCS233
063700     PERFORM 2100-FIND-OUT-PLAN.                                  RCKCS233
063800                                                                  RCKCS233
063900     IF PS-NOT-DONE                                               RCKCS233
064000         PERFORM 2200-BUILD-STORE-ARRAY                           RCKCS233
064100     END-IF.                                                      RCKCS233
064200                                                                  RCKCS233
064300     IF PS-NOT-DONE                                               RCKCS233
064400         PERFORM 2300-SORT-STORE-ARRAY                            RCKCS233
064500     END-IF.                                                      RCKCS233
064600                                                                  RCKCS233
064700     IF PS-NOT-DONE AND TM500-CREATE-AUTO                         RCKCS233
064800         PERFORM 2400-OVER-OR-SHORT                               RCKCS233
064900     END-IF.                                                      RCKCS233
065000                                                                  RCKCS233
065100                                                                          
065200     IF PS-NOT-DONE AND TM500-CREATE-AUTO                         RCKCS233
065300*       IF ALLPLN-DISTRO-REQ-ID  =  0                                     
              IF PS-PRORATION-OLD                                               
065400           PERFORM 2500-PRORATE-QTY                               RCKCS233
065500        ELSE                                                              
065600           PERFORM 4000-MA-PRORATION                              RCKCS233
065700        END-IF                                                    RCKCS233
065800     END-IF.                                                      RCKCS233
065900                                                                          
066500     MOVE 1 TO PV-SUB-1.                                          RCKCS233
066600                                                                  RCKCS233
066700     IF TM500-CREATE-AUTO                                         RCKCS233
066800         PERFORM 2700-ALLOCATE-STORES                             RCKCS233
066900           UNTIL PV-SUB-1 > PV-STR-SUB OR PS-DONE                 RCKCS233
067000     END-IF.                                                      RCKCS233
067100                                                                  RCKCS233
067200*    IF PS-NOT-DONE AND                                           RCKCS233
067300*       PS-INACT-TALLPLN                                          RCKCS233
067400*            PERFORM 2800-INACTIVATE-ALLPLN                       RCKCS233
067500*    END-IF.                                                      RCKCS233
067600                                                                  RCKCS233
067700     IF PS-NOT-DONE AND                                           RCKCS233
067800            (PS-SPECIFIC-PLAN OR PS-USE-SPECIFIC-MSG) AND         RCKCS233
067900            TM500-CREATE-AUTO                                     RCKCS233
068000        PERFORM 2900-DELETE-SPSTDS                                RCKCS233
068100     END-IF.                                                      RCKCS233
068200                                                                  RCKCS233
068300                                                                  RCKCS233
068400 2100-FIND-OUT-PLAN.                                              RCKCS233
068500******************************************************************RCKCS233
068600*    THIS PARAGRAPH CALLS THE FOLLOWING PARAGRAPH:                RCKCS233
068700*    - 2110 INQUIRES IN TABLE TPURITM FOR PO-LNE-NBR              RCKCS233
068800*    - 2120 INQUIRES IN TABLE TALLPLN FOR CURR-SPLIT-QTY          RCKCS233
068900*    - 2140 INQUIRES IN TABLE TSPSTDS FOR STR-PLAN-QTY.  THIS TABL   CL**2
069000*         IS MAINTAINED USING THE CLIENT/SERVER ALLOCATIONS ENGINE   CL**2
069100*    - 2130 INQUIRES IN TABLE TMESTDS FOR STR-PLAN-QTY ONLY IF       CL**2
069200*         NO TSPSTDS ALLOCATION IS FOUND                             CL**2
069300*                                                                    CL**2
069400*    IT THEN DETERMINES WHETHER THE RECEIPT SHOULD EITHER         RCKCS233
069500*    BE A MASTER OR SPECIFIC PLAN.                                RCKCS233
069600******************************************************************RCKCS233
069700                                                                  RCKCS233
069800     PERFORM 2110-GET-TPURITM-RECORD.                             RCKCS233
069900                                                                  RCKCS233
070000     IF PS-NOT-DONE                                               RCKCS233
070100         PERFORM 2120-GET-TALLPLN-RECORD                          RCKCS233
070200     END-IF.                                                      RCKCS233
070300                                                                  RCKCS233
070400     SET PS-TSPSTDS-NOT-FOUND TO TRUE.                            RCKCS233
070500                                                                  RCKCS233
070600     IF PS-NOT-DONE                                               RCKCS233
070700         PERFORM 2140-GET-TSPSTDS-RECORD                          RCKCS233
070800     END-IF.                                                      RCKCS233
070900                                                                  RCKCS233
071000     IF PS-NOT-DONE                                               RCKCS233
071100         IF PS-TSPSTDS-NOT-FOUND                                  RCKCS233
071200             PERFORM 2130-GET-TMESTDS-RECORD                      RCKCS233
071300         END-IF                                                   RCKCS233
071400     END-IF.                                                      RCKCS233
071500                                                                  RCKCS233
071600     IF PS-NOT-DONE                                               RCKCS233
071700         IF PS-TSPSTDS-FOUND                                      RCKCS233
071800             SET PS-SPECIFIC-PLAN     TO TRUE                     RCKCS233
071900         ELSE                                                     RCKCS233
072000             SET PS-MASTER-PLAN       TO TRUE                     RCKCS233
072100             IF ALLPLN-CURR-SPLIT-QTY = PV-SUM-STR-PLAN-QTY       RCKCS233
072200                 CONTINUE                                         RCKCS233
072300             ELSE                                                 RCKCS233
072400                 SET PS-INACT-TALLPLN TO TRUE                     RCKCS233
072500             END-IF                                               RCKCS233
072600         END-IF                                                   RCKCS233
072700     END-IF.                                                      RCKCS233
072800                                                                  RCKCS233
072900                                                                  RCKCS233
073000 2110-GET-TPURITM-RECORD.                                         RCKCS233
073100******************************************************************RCKCS233
073200*    THIS PARAGRAPH RETRIEVES A RECORD FROM TABLE TPURITM.        RCKCS233
073300******************************************************************RCKCS233
073400                                                                  RCKCS233
073500     PERFORM WITH TEST AFTER                                      RCKCS233
073600         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
073700         UNTIL   SQLCODE = +0 OR                                  RCKCS233
073800                 PS-DONE OR                                       RCKCS233
073900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
074000                                                                  RCKCS233
074100         EXEC SQL                                                 RCKCS233
074200              SELECT PO_LNE_NBR                                   RCKCS233
074300                INTO :PURITM-PO-LNE-NBR                           RCKCS233
074400                FROM TPURITM                                      RCKCS233
074500               WHERE PO_NBR         = :TM500-PO-NBR               RCKCS233
074600                 AND APP_PO_LNE_NBR = :TM500-PO-LNE-NBR           RCKCS233
074700                 AND VER_STATUS_CDE = :PC-A                       RCKCS233
074800         END-EXEC                                                 RCKCS233
074900                                                                  RCKCS233
075000         EVALUATE TRUE                                            RCKCS233
075100             WHEN SQLCODE = +0                                    RCKCS233
075200                  CONTINUE                                        RCKCS233
075300                                                                  RCKCS233
075400             WHEN SQLCODE = -904                                  RCKCS233
075500             WHEN SQLCODE = -911                                  RCKCS233
075600             WHEN SQLCODE = -913                                  RCKCS233
075700                  CONTINUE                                        RCKCS233
075800                                                                  RCKCS233
075900             WHEN OTHER                                           RCKCS233
076000                  SET  PS-DONE TO TRUE                            RCKCS233
076100                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
076200                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
076300                  MOVE PRV-3W  TO TM500-RETURN-DATA               RCKCS233
076400                                                                  RCKCS233
076500                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
076600                  MOVE '2110'    TO PRV-PARA                      RCKCS233
076700                  MOVE 'TPURITM' TO PRV-TBL                       RCKCS233
076800                  PERFORM 9999-RETURN-MSG                         RCKCS233
076900         END-EVALUATE                                             RCKCS233
077000     END-PERFORM.                                                 RCKCS233
077100                                                                  RCKCS233
077200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
077300         SET  PS-DONE TO TRUE                                     RCKCS233
077400         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
077500         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
077600         MOVE PRV-3W  TO TM500-RETURN-DATA                        RCKCS233
077700                                                                  RCKCS233
077800         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
077900         MOVE '2110'    TO PRV-PARA                               RCKCS233
078000         MOVE 'TPURITM' TO PRV-TBL                                RCKCS233
078100         PERFORM 9999-RETURN-MSG                                  RCKCS233
078200     END-IF.                                                      RCKCS233
078300                                                                  RCKCS233
078400                                                                  RCKCS233
078500 2120-GET-TALLPLN-RECORD.                                         RCKCS233
078600******************************************************************RCKCS233
078700*    THIS PARAGRAPH RETRIEVES THE PLAN NUMBER AND THE             RCKCS233
078800*    CURR-SPLIT-QTY FROM TABLE TALLPLN.                           RCKCS233
078900******************************************************************RCKCS233
079000                                                                  RCKCS233
079100     PERFORM WITH TEST AFTER                                      RCKCS233
079200         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
079300         UNTIL   SQLCODE = +0 OR                                  RCKCS233
079400                 PS-DONE OR                                       RCKCS233
079500                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
079600                                                                  RCKCS233
079700         EXEC SQL                                                 RCKCS233
079800              SELECT PLAN_NBR                                     RCKCS233
079900                   , CURR_SPLIT_QTY                               RCKCS233
080000                   , DISTRO_REQ_ID                                RCKCS233
080100                   , PK_SIZE_RND_CDE                              RCKCS233
080200                   , ALLOC_OUTR_PK_QTY                            RCKCS233
080300                INTO :ALLPLN-PLAN-NBR                             RCKCS233
080400                   , :ALLPLN-CURR-SPLIT-QTY                       RCKCS233
080500                   , :ALLPLN-DISTRO-REQ-ID                        RCKCS233
080600                   , :ALLPLN-PK-SIZE-RND-CDE                      RCKCS233
080700                   , :ALLPLN-ALLOC-OUTR-PK-QTY                    RCKCS233
080800                FROM TALLPLN                                      RCKCS233
080900               WHERE PO_NBR     = :TM500-PO-NBR                   RCKCS233
081000                 AND PO_LNE_NBR = :PURITM-PO-LNE-NBR              RCKCS233
081100                 AND DEST_NBR   = :TM500-OPER-UNT-ID              RCKCS233
081200                 AND STATUS_CDE = :PC-AC                          RCKCS233
081300         END-EXEC                                                 RCKCS233
081400                                                                  RCKCS233
081500         EVALUATE TRUE                                            RCKCS233
081600             WHEN SQLCODE = +0                                    RCKCS233
081700                  CONTINUE                                        RCKCS233
081800                                                                  RCKCS233
081900             WHEN SQLCODE = -904                                  RCKCS233
082000             WHEN SQLCODE = -911                                  RCKCS233
082100             WHEN SQLCODE = -913                                  RCKCS233
082200                  CONTINUE                                        RCKCS233
082300                                                                  RCKCS233
082400             WHEN OTHER                                           RCKCS233
082500                  SET  PS-DONE TO TRUE                            RCKCS233
082600                  MOVE PRV-3A  TO TM500-RETURN-DATA               RCKCS233
082700                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
082800                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
082900                                                                  RCKCS233
083000                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
083100                  MOVE '2120'    TO PRV-PARA                      RCKCS233
083200                  MOVE 'TALLPLN' TO PRV-TBL                       RCKCS233
083300                  PERFORM 9999-RETURN-MSG                         RCKCS233
083400         END-EVALUATE                                             RCKCS233
083500     END-PERFORM.                                                 RCKCS233
083600                                                                  RCKCS233
083700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
083800         SET  PS-DONE TO TRUE                                     RCKCS233
083900         MOVE PRV-3A  TO TM500-RETURN-DATA                        RCKCS233
084000         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
084100         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
084200                                                                  RCKCS233
084300         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
084400         MOVE '2120'    TO PRV-PARA                               RCKCS233
084500         MOVE 'TALLPLN' TO PRV-TBL                                RCKCS233
084600         PERFORM 9999-RETURN-MSG                                  RCKCS233
084700     END-IF.                                                      RCKCS233
084800                                                                  RCKCS233
084900                                                                  RCKCS233
085000 2130-GET-TMESTDS-RECORD.                                         RCKCS233
085100******************************************************************RCKCS233
085200*    THIS PARAGRAPH RETRIEVES THE SUM OF ALL THE STORE PLAN       RCKCS233
085300*    QTYS FROM TABLE TMESTDS.                                        CL**2
085400******************************************************************RCKCS233
085500                                                                  RCKCS233
085600     PERFORM WITH TEST AFTER                                      RCKCS233
085700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
085800         UNTIL   SQLCODE = +0 OR                                  RCKCS233
085900                 SQLCODE = -305 OR                                RCKCS233
086000                 PS-DONE OR                                       RCKCS233
086100                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
086200                                                                  RCKCS233
086300         EXEC SQL                                                 RCKCS233
086400              SELECT SUM(STR_DISTRO_QTY)                          RCKCS233
086500                INTO :PV-SUM-STR-PLAN-QTY                         RCKCS233
086600                FROM TMESTDS                                      RCKCS233
086700               WHERE PO_NBR     = :TM500-PO-NBR                   RCKCS233
086800                 AND PO_LNE_NBR = :PURITM-PO-LNE-NBR              RCKCS233
086900                 AND PLAN_NBR   = :ALLPLN-PLAN-NBR                RCKCS233
087000         END-EXEC                                                 RCKCS233
087100                                                                  RCKCS233
087200         EVALUATE TRUE                                            RCKCS233
087300             WHEN SQLCODE = +0                                    RCKCS233
087400                  IF PV-SUM-STR-PLAN-QTY < 0                      RCKCS233
087500                      MOVE 0 TO PV-SUM-STR-PLAN-QTY               RCKCS233
087600                  END-IF                                          RCKCS233
087700                                                                  RCKCS233
087800             WHEN SQLCODE = -305                                  RCKCS233
087900                  MOVE 0 TO PV-SUM-STR-PLAN-QTY                   RCKCS233
088000                                                                  RCKCS233
088100             WHEN SQLCODE = -904                                  RCKCS233
088200             WHEN SQLCODE = -911                                  RCKCS233
088300             WHEN SQLCODE = -913                                  RCKCS233
088400                  CONTINUE                                        RCKCS233
088500                                                                  RCKCS233
088600             WHEN OTHER                                           RCKCS233
088700                  SET PS-DONE  TO TRUE                            RCKCS233
088800                  MOVE PRV-3B  TO TM500-RETURN-DATA               RCKCS233
088900                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
089000                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
089100                                                                  RCKCS233
089200                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
089300                  MOVE '2130'    TO PRV-PARA                      RCKCS233
089400                  MOVE 'TMESTDS' TO PRV-TBL                       RCKCS233
089500                  PERFORM 9999-RETURN-MSG                         RCKCS233
089600         END-EVALUATE                                             RCKCS233
089700     END-PERFORM.                                                 RCKCS233
089800                                                                  RCKCS233
089900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
090000         SET PS-DONE  TO TRUE                                     RCKCS233
090100         MOVE PRV-3B  TO TM500-RETURN-DATA                        RCKCS233
090200         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
090300         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
090400                                                                  RCKCS233
090500         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
090600         MOVE '2130'    TO PRV-PARA                               RCKCS233
090700         MOVE 'TMESTDS' TO PRV-TBL                                RCKCS233
090800         PERFORM 9999-RETURN-MSG                                  RCKCS233
090900     END-IF.                                                      RCKCS233
091000/                                                                 RCKCS233
091100 2140-GET-TSPSTDS-RECORD.                                         RCKCS233
091200******************************************************************RCKCS233
091300*    THIS PARAGRAPH RETRIEVES THE SUM OF ALL THE STORE PLAN       RCKCS233
091400*    QTYS FROM TABLE TSPSTDS.  IF DATA IS FOUND HERE IT WILL         CL**2
091500*    BE USED FOR PRORATION INSTEAD OF DATA IN THE TMESTDS TABLE.     CL**2
091600******************************************************************RCKCS233
091700                                                                  RCKCS233
091800     PERFORM WITH TEST AFTER                                      RCKCS233
091900         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
092000         UNTIL   SQLCODE = +0 OR                                  RCKCS233
092100                 SQLCODE = -305 OR                                RCKCS233
092200                 PS-DONE OR                                       RCKCS233
092300                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
092400                                                                  RCKCS233
092500         EXEC SQL                                                 RCKCS233
092600              SELECT SUM(STR_DISTRO_QTY)                          RCKCS233
092700                INTO :PV-SUM-STR-PLAN-QTY                         RCKCS233
092800                FROM TSPSTDS                                      RCKCS233
092900               WHERE PO_NBR     = :TM500-PO-NBR                   RCKCS233
093000                 AND PO_LNE_NBR = :PURITM-PO-LNE-NBR              RCKCS233
093100                 AND PLAN_NBR   = :ALLPLN-PLAN-NBR                RCKCS233
093200         END-EXEC                                                 RCKCS233
093300                                                                  RCKCS233
093400         EVALUATE TRUE                                            RCKCS233
093500             WHEN SQLCODE = +0                                    RCKCS233
093600                  SET PS-TSPSTDS-FOUND TO TRUE                    RCKCS233
093700                  IF PV-SUM-STR-PLAN-QTY < ZERO                   RCKCS233
093800                      MOVE ZERO TO PV-SUM-STR-PLAN-QTY            RCKCS233
093900                  END-IF                                          RCKCS233
094000                                                                  RCKCS233
094100             WHEN SQLCODE = -305                                  RCKCS233
094200                  MOVE ZERO TO PV-SUM-STR-PLAN-QTY                RCKCS233
094300                                                                  RCKCS233
094400             WHEN SQLCODE = -904                                  RCKCS233
094500             WHEN SQLCODE = -911                                  RCKCS233
094600             WHEN SQLCODE = -913                                  RCKCS233
094700                  CONTINUE                                        RCKCS233
094800                                                                  RCKCS233
094900             WHEN OTHER                                           RCKCS233
095000                  SET PS-DONE  TO TRUE                            RCKCS233
095100                  MOVE PRV-34  TO TM500-RETURN-DATA               RCKCS233
095200                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
095300                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
095400                                                                  RCKCS233
095500                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
095600                  MOVE '2140'    TO PRV-PARA                      RCKCS233
095700                  MOVE 'TSPSTDS' TO PRV-TBL                       RCKCS233
095800                  PERFORM 9999-RETURN-MSG                         RCKCS233
095900         END-EVALUATE                                             RCKCS233
096000     END-PERFORM.                                                 RCKCS233
096100                                                                  RCKCS233
096200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
096300         SET PS-DONE  TO TRUE                                     RCKCS233
096400         MOVE PRV-34  TO TM500-RETURN-DATA                        RCKCS233
096500         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
096600         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
096700                                                                  RCKCS233
096800         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
096900         MOVE '2140'    TO PRV-PARA                               RCKCS233
097000         MOVE 'TSPSTDS' TO PRV-TBL                                RCKCS233
097100         PERFORM 9999-RETURN-MSG                                  RCKCS233
097200     END-IF.                                                      RCKCS233
097300                                                                  RCKCS233
097400                                                                  RCKCS233
097500 2200-BUILD-STORE-ARRAY.                                          RCKCS233
097600******************************************************************RCKCS233
097700*    THIS PARAGRAPH CALLS THE FOLLOWING PARAGRAPH:                RCKCS233
097800*    - 2210 RETRIEVES THE INNR-PACK-QTY FROM TABLE TRECITM        RCKCS233
097900*    - 2220 VALIDATES THE INNR-PACK-QTY                           RCKCS233
098000*    - 2230 RETRIEVES ALL ITS STORE'S PLAN FROM TABLE TMESTDS     RCKCS233
098100*    - 2240 RETRIEVES ALL ITS STORE'S PREVIOUS RECEIPTS FROM      RCKCS233
098200*           TABLE TRECDIS IF ITS A MASTER PLAN                    RCKCS233
098300*    - 2250 CALCULATES EACH STORES OPEN TO RECEIVE (OTR) QUANTITY RCKCS233
098400******************************************************************RCKCS233
098500                                                                  RCKCS233
098600     PERFORM 2210-GET-INNR-PACK-QTY.                              RCKCS233
098700                                                                  RCKCS233
098800     IF PS-NOT-DONE                                               RCKCS233
098900         PERFORM 2220-VALIDATE-PACK                               RCKCS233
099000     END-IF.                                                      RCKCS233
099100                                                                  RCKCS233
099200     IF PS-NOT-DONE                                               RCKCS233
099300         PERFORM 2230-GET-STORE-PLAN                              RCKCS233
099400     END-IF.                                                      RCKCS233
099500                                                                  RCKCS233
099600     IF PS-NOT-DONE AND PS-MASTER-PLAN                            RCKCS233
099700         PERFORM 2240-GET-STORE-RECEIPTS                          RCKCS233
099800     END-IF.                                                      RCKCS233
099900                                                                  RCKCS233
100000     MOVE 1 TO PV-SUB-1.                                          RCKCS233
100100     MOVE 0 TO PV-OTR-SUB.                                        RCKCS233
100200     MOVE 0 TO PV-SUM-STR-REC-QTY.                                RCKCS233
100300     MOVE 0 TO PV-SUM-STR-OTR-UNITS.                              RCKCS233
100400                                                                  RCKCS233
100500     PERFORM 2250-CALC-STR-OPEN-TO-REC                            RCKCS233
100600       UNTIL PV-SUB-1 > PV-STR-SUB OR PS-DONE.                    RCKCS233
100700                                                                  RCKCS233
100800                                                                  RCKCS233
100900 2210-GET-INNR-PACK-QTY.                                          RCKCS233
101000******************************************************************RCKCS233
101100*    THIS PARAGRAPH RETRIEVES THE RECITM-INNR-PACK-QTY FROM       RCKCS233
101200*    TABLE TRECITM.  ANOTHER TERM FOR THIS IS UNITS-PER-PACK.        CL**2
101300******************************************************************RCKCS233
101400                                                                  RCKCS233
101500     PERFORM WITH TEST AFTER                                      RCKCS233
101600         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
101700         UNTIL   SQLCODE = +0 OR                                  RCKCS233
101800                 PS-DONE OR                                       RCKCS233
101900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
102000                                                                  RCKCS233
102100         EXEC SQL                                                 RCKCS233
102200              SELECT INNR_PACK_QTY                                RCKCS233
102300                INTO :RECITM-INNR-PACK-QTY                        RCKCS233
102400                FROM TRECITM                                      RCKCS233
102500               WHERE ORD_NBR        = :TM500-PO-NBR               RCKCS233
102600                 AND ORD_LNE_NBR    = :TM500-PO-LNE-NBR           RCKCS233
102700                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          RCKCS233
102800                 AND OPER_UNT_ID    = :TM500-OPER-UNT-ID          RCKCS233
102900                 AND VER_STATUS_CDE = :PC-A                       RCKCS233
103000         END-EXEC                                                 RCKCS233
103100                                                                  RCKCS233
103200         EVALUATE TRUE                                            RCKCS233
103300             WHEN SQLCODE = +0                                    RCKCS233
103400                  CONTINUE                                        RCKCS233
103500                                                                  RCKCS233
103600             WHEN SQLCODE = -904                                  RCKCS233
103700             WHEN SQLCODE = -911                                  RCKCS233
103800             WHEN SQLCODE = -913                                  RCKCS233
103900                  CONTINUE                                        RCKCS233
104000                                                                  RCKCS233
104100             WHEN OTHER                                           RCKCS233
104200                  SET  PS-DONE TO TRUE                            RCKCS233
104300                  MOVE PRV-3C  TO TM500-RETURN-DATA               RCKCS233
104400                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
104500                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
104600                                                                  RCKCS233
104700                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
104800                  MOVE '2210'    TO PRV-PARA                      RCKCS233
104900                  MOVE 'TRECITM' TO PRV-TBL                       RCKCS233
105000                  PERFORM 9999-RETURN-MSG                         RCKCS233
105100         END-EVALUATE                                             RCKCS233
105200     END-PERFORM.                                                 RCKCS233
105300                                                                  RCKCS233
105400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
105500         SET  PS-DONE TO TRUE                                     RCKCS233
105600         MOVE PRV-3C  TO TM500-RETURN-DATA                        RCKCS233
105700         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
105800         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
105900                                                                  RCKCS233
106000         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
106100         MOVE '2210'    TO PRV-PARA                               RCKCS233
106200         MOVE 'TRECITM' TO PRV-TBL                                RCKCS233
106300         PERFORM 9999-RETURN-MSG                                  RCKCS233
106400     END-IF.                                                      RCKCS233
106500                                                                  RCKCS233
106600                                                                  RCKCS233
106700 2220-VALIDATE-PACK.                                              RCKCS233
106800******************************************************************RCKCS233
106900*    THIS PARAGRAPH VALIDATES UNITS RECEIVED MAKING SURE THAT     RCKCS233
107000*    IT IS EVENLY DIVISIBLE BY THE INNR-PACK-QTY OF TABLE TRECITM.   CL**2
107100*    ALTHOUGH NO TROUBLE IS CREATED HERE IF THE UNITS-TO-ALLOCATE    CL**2
107200*    IS NOT AN EVEN MULTIPLE OF THE INNER-PACK-QTY, A SIMILAR        CL**2
107300*    CALCULATION IS DONE IN PARAGRAPH 2233-PROCESS-PLAN TO           CL**2
107400*    CREATE A 525 TROUBLE.                                           CL**2
107500******************************************************************RCKCS233
107600                                                                  RCKCS233
107700     IF RECITM-INNR-PACK-QTY = 0                                  RCKCS233
107800         MOVE 1 TO RECITM-INNR-PACK-QTY                           RCKCS233
107900     END-IF.                                                      RCKCS233
108000                                                                  RCKCS233
108100     DIVIDE RECITM-INNR-PACK-QTY                                  RCKCS233
108200       INTO TM500-UNITS-TO-ALLOC                                  RCKCS233
108300            GIVING PV-PACKS-TO-ALLOC                              RCKCS233
108400            REMAINDER PV-UNITS-TO-ALLOC.                          RCKCS233
108500                                                                  RCKCS233
108600     MOVE TM500-UNITS-TO-ALLOC TO PV-LEFT-TO-ALLOC.               RCKCS233
108700                                                                  RCKCS233
108800                                                                  RCKCS233
108900 2230-GET-STORE-PLAN.                                             RCKCS233
109000******************************************************************RCKCS233
109100*    THIS PARAGRAPH RETRIEVES THE PLAN FOR EACH STORE AND STORES  RCKCS233
109200*    THEM IN AN ARRAY OF STORES.                                  RCKCS233
109300*    IF TSPSTDS IS BEING USED TO DEFINE A SPECIFIC ALLOCATION,       CL**2
109400*    THEN THE CURSOR PROCESSING WILL REFER TO SPECIFIC-PLAN-CSR      CL**2
109500*    INSTEAD OF PLAN-CSR.                                            CL**2
109600******************************************************************RCKCS233
109700                                                                  RCKCS233
           SET PS-PRORATION-MA TO TRUE                                          
TOP800     SET PS-MORE-PLAN TO TRUE.                                    RCKCS233
109900                                                                  RCKCS233
110000     PERFORM 2231-OPEN-PLAN-CSR.                                  RCKCS233
110100                                                                  RCKCS233
110200     IF PS-NOT-DONE                                               RCKCS233
110300         PERFORM 2232-FETCH-PLAN-CSR                              RCKCS233
110400                                                                  RCKCS233
110500         IF PS-NO-MORE-PLAN                                       RCKCS233
110600             SET PS-DONE TO TRUE                                  RCKCS233
110700             MOVE PRV-3D TO TM500-RETURN-DATA                     RCKCS233
110800                                                                  RCKCS233
110900             MOVE SPACES    TO PRV-TM500-RETURN-MSG               RCKCS233
111000             MOVE '2230'    TO PRV-PARA                           RCKCS233
111100             MOVE SPACES    TO PRV-TBL                            RCKCS233
111200             PERFORM 9999-RETURN-MSG                              RCKCS233
111300         ELSE                                                     RCKCS233
111400             MOVE 0 TO PV-STR-SUB                                 RCKCS233
111500                                                                  RCKCS233
111600             PERFORM 2233-PROCESS-PLAN                            RCKCS233
111700               UNTIL PS-NO-MORE-PLAN OR PS-DONE                   RCKCS233
111800         END-IF                                                   RCKCS233
111900                                                                  RCKCS233
112000         PERFORM 2234-CLOSE-PLAN-CSR                              RCKCS233
112100     END-IF.                                                      RCKCS233
112200                                                                  RCKCS233
112300                                                                  RCKCS233
112400 2231-OPEN-PLAN-CSR.                                              RCKCS233
112500******************************************************************RCKCS233
112600*    THIS PARAGRAPH OPENS A PLAN CURSOR ON EITHER TMESTDS OR         CL**2
112700*    TSPSTDS.                                                        CL**2
112800******************************************************************RCKCS233
112900                                                                  RCKCS233
113000     IF PS-SPECIFIC-PLAN                                          RCKCS233
113100         EXEC SQL                                                 RCKCS233
113200              OPEN SPECIFIC-PLAN-CSR                              RCKCS233
113300         END-EXEC                                                 RCKCS233
113400     ELSE                                                         RCKCS233
113500         EXEC SQL                                                 RCKCS233
113600              OPEN PLAN-CSR                                       RCKCS233
113700         END-EXEC                                                 RCKCS233
113800     END-IF.                                                      RCKCS233
113900                                                                  RCKCS233
114000     IF SQLCODE NOT = +0                                          RCKCS233
114100         SET PS-DONE  TO TRUE                                     RCKCS233
114200         MOVE PRV-3E  TO TM500-RETURN-DATA                        RCKCS233
114300         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
114400         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
114500                                                                  RCKCS233
114600         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
114700         MOVE '2231'    TO PRV-PARA                               RCKCS233
114800         MOVE SPACES    TO PRV-TBL                                RCKCS233
114900         PERFORM 9999-RETURN-MSG                                  RCKCS233
115000     END-IF.                                                      RCKCS233
115100                                                                  RCKCS233
115200                                                                  RCKCS233
115300 2232-FETCH-PLAN-CSR.                                             RCKCS233
115400******************************************************************RCKCS233
115500*    THIS PARAGRAPH GETS THE STORE NUMBER AND ITS PLANNED         RCKCS233
115600*    QUANTITY FROM EITHER TMESTDS OR TSPSTDS TABLES.                 CL**2
115700******************************************************************RCKCS233
115800                                                                  RCKCS233
115900     IF PS-SPECIFIC-PLAN                                          RCKCS233
116000         EXEC SQL                                                 RCKCS233
116100              FETCH SPECIFIC-PLAN-CSR                             RCKCS233
116200               INTO :SPSTDS-STR-NBR                               RCKCS233
116300                  , :SPSTDS-STR-DISTRO-QTY                        RCKCS233
116400         END-EXEC                                                 RCKCS233
116500     ELSE                                                         RCKCS233
116600         EXEC SQL                                                 RCKCS233
116700              FETCH PLAN-CSR                                      RCKCS233
116800               INTO :MESTDS-STR-NBR                               RCKCS233
116900                  , :MESTDS-STR-DISTRO-QTY                        RCKCS233
117000                  , :MESTDS-ALLOC-SEQ-CDE                         RCKCS233
117100                  , :MESTDS-RNK-SEQ-NBR                           RCKCS233
117200         END-EXEC                                                 RCKCS233
117300     END-IF.                                                      RCKCS233
117400                                                                  RCKCS233
117500     EVALUATE TRUE                                                RCKCS233
117600         WHEN SQLCODE = +0                                        RCKCS233
117100              IF MESTDS-RNK-SEQ-NBR = ZERO                        RCKCS233
                        SET PS-PRORATION-OLD TO TRUE                            
                    END-IF                                                      
117700*             CONTINUE                                            RCKCS233
117800                                                                  RCKCS233
117900         WHEN SQLCODE = +100                                      RCKCS233
118000              SET PS-NO-MORE-PLAN TO TRUE                         RCKCS233
118100                                                                  RCKCS233
118200         WHEN OTHER                                               RCKCS233
118300              SET PS-DONE  TO TRUE                                RCKCS233
118400              MOVE PRV-3F  TO TM500-RETURN-DATA                   RCKCS233
118500              MOVE SQLCA   TO TM500-SQLCA                         RCKCS233
118600              MOVE SQLCODE TO TM500-SQLCODE                       RCKCS233
118700                                                                  RCKCS233
118800              MOVE SPACES    TO PRV-TM500-RETURN-MSG              RCKCS233
118900              MOVE '2232'    TO PRV-PARA                          RCKCS233
119000              MOVE SPACES    TO PRV-TBL                           RCKCS233
119100              PERFORM 9999-RETURN-MSG                             RCKCS233
119200     END-EVALUATE.                                                RCKCS233
119300                                                                  RCKCS233
119400                                                                  RCKCS233
119500 2233-PROCESS-PLAN.                                               RCKCS233
119600******************************************************************RCKCS233
119700*    THIS PARAGRAPH STORES THE STORE NUMBER AND ITS PLANNED       RCKCS233
119800*    QUANTITY IN AN ARRAY.  IT ALSO CREATES PRE-PACK (525) TROUBLERCKCS233
119900*    IF THE PLANNED QUANTITY IS NOT EVENLY DIVISIBLE BY              CL**2
120000*    THE INNR-PACK-QTY.  DATA COMES EITHER FROM TMESTDS OR           CL**2
120100*    TSPSTDS.                                                        CL**2
120200******************************************************************RCKCS233
120300                                                                  RCKCS233
120400     IF PV-STR-SUB < PC-ARRAY-MAX                                 RCKCS233
120500         ADD 1 TO PV-STR-SUB                                      RCKCS233
120600                                                                  RCKCS233
120700         IF PS-SPECIFIC-PLAN                                      RCKCS233
120800             MOVE SPSTDS-STR-NBR                                  RCKCS233
120900                             TO PT-STR-NBR (PV-STR-SUB)           RCKCS233
121000             MOVE SPSTDS-STR-DISTRO-QTY                           RCKCS233
121100                             TO PT-STR-PLAN-QTY (PV-STR-SUB)      RCKCS233
121200         ELSE                                                     RCKCS233
121300             MOVE MESTDS-STR-NBR                                  RCKCS233
121400                         TO PT-STR-NBR (PV-STR-SUB)               RCKCS233
121500             MOVE MESTDS-STR-DISTRO-QTY                           RCKCS233
121600                         TO PT-STR-PLAN-QTY (PV-STR-SUB)          RCKCS233
121700             MOVE MESTDS-ALLOC-SEQ-CDE                            RCKCS233
121800                         TO PT-STR-ALLOC-SEQ-CDE  (PV-STR-SUB)    RCKCS233
121900             MOVE MESTDS-RNK-SEQ-NBR                              RCKCS233
122000                         TO PT-STR-RNK-SEQ-NBR (PV-STR-SUB)       RCKCS233
122100         END-IF                                                   RCKCS233
122200                                                                  RCKCS233
122300         MOVE 0 TO PV-REMAINDER                                   RCKCS233
122400         MOVE 0 TO PV-PACKS-PLANNED                               RCKCS233
122500                                                                  RCKCS233
122600         IF PS-SPECIFIC-PLAN                                      RCKCS233
122700             DIVIDE RECITM-INNR-PACK-QTY                          RCKCS233
122800                               INTO SPSTDS-STR-DISTRO-QTY         RCKCS233
122900                    GIVING PV-PACKS-PLANNED                       RCKCS233
123000                    REMAINDER PV-REMAINDER                        RCKCS233
123100         ELSE                                                     RCKCS233
123200             DIVIDE RECITM-INNR-PACK-QTY                          RCKCS233
123300                               INTO MESTDS-STR-DISTRO-QTY         RCKCS233
123400                    GIVING PV-PACKS-PLANNED                       RCKCS233
123500                    REMAINDER PV-REMAINDER                        RCKCS233
123600         END-IF                                                   RCKCS233
W38216     IF PS-NOT-DONE                                               RCKCS233
W38216         PERFORM 2233-CHK-STORE                                   RCKCS233
W38216     END-IF                                                       RCKCS233
W38216                                                                  RCKCS233
W38216         IF (PV-REMAINDER NOT = 0 AND                             RCKCS233
W38216             XL071-E-BUS-IND NOT = 'Y' AND                        RCKCS233
W38216             XL071-LOC-TYP-CDE = 'DC')                                    
123900             SET PS-DONE TO TRUE                                  RCKCS233
124000                                                                  RCKCS233
124100             MOVE PC-C   TO TM500-CRUD-IND                        RCKCS233
124200             MOVE PC-525 TO TM500-TRBL-RSN-CDE                    RCKCS233
124300                                                                  RCKCS233
124400             SET  TM500-ADD-DETAILS  TO TRUE                      RCKCS233
124500             MOVE PC-RCKCS233        TO TM500-CRE-UID             RCKCS233
124600                                                                  RCKCS233
124700             COMPUTE PV-TEMP-QTY      = RECITM-INNR-PACK-QTY * 1  RCKCS233
124800             MOVE PV-TEMP-QTY        TO PC-IP-QTY-1               RCKCS233
124900                                                                  RCKCS233
125000             MOVE PC-UNITS-RECEIVED  TO PC-IP-TEXT-2              RCKCS233
125100             COMPUTE PV-TEMP-QTY      = TM500-UNITS-TO-ALLOC * 1  RCKCS233
125200             MOVE PV-TEMP-QTY        TO PC-IP-QTY-2               RCKCS233
125300                                                                  RCKCS233
125400             MOVE PC-STORE           TO PC-IP-TEXT-3              RCKCS233
125500                                                                  RCKCS233
125600             IF PS-SPECIFIC-PLAN                                  RCKCS233
125700                 COMPUTE PV-TEMP-QTY  = SPSTDS-STR-NBR * 1        RCKCS233
125800             ELSE                                                 RCKCS233
125900                 COMPUTE PV-TEMP-QTY  = MESTDS-STR-NBR * 1        RCKCS233
126000             END-IF                                               RCKCS233
126100                                                                  RCKCS233
126200             MOVE PV-TEMP-QTY        TO PC-IP-STR                 RCKCS233
126300                                                                  RCKCS233
126400             MOVE PC-STORE-ORDER-QTY TO PC-IP-TEXT-4              RCKCS233
126500                                                                  RCKCS233
126600             IF PS-SPECIFIC-PLAN                                  RCKCS233
126700                 COMPUTE PV-TEMP-QTY  = SPSTDS-STR-DISTRO-QTY * 1 RCKCS233
126800             ELSE                                                 RCKCS233
126900                 COMPUTE PV-TEMP-QTY  = MESTDS-STR-DISTRO-QTY * 1 RCKCS233
127000             END-IF                                               RCKCS233
127100                                                                  RCKCS233
127200             MOVE PV-TEMP-QTY        TO PC-IP-QTY-4               RCKCS233
127300                                                                  RCKCS233
127400             MOVE PC-INNR-PACK-TEXT  TO TM500-FREEFORM-TEXT       RCKCS233
127500                                                                  RCKCS233
127600             PERFORM 3000-CREATE-TROUBLE-RECORD                   RCKCS233
127700                                                                  RCKCS233
127800             MOVE PRV-01 TO TM500-RETURN-DATA                     RCKCS233
127900             SET TM500-IN-TROUBLE TO TRUE                         RCKCS233
128000             SET TM500-NO-DETAILS TO TRUE                         RCKCS233
128100         END-IF                                                   RCKCS233
128200     ELSE                                                         RCKCS233
128300         SET PS-DONE TO TRUE                                      RCKCS233
128400         MOVE PRV-3H TO TM500-RETURN-DATA                         RCKCS233
128500                                                                  RCKCS233
128600         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
128700         MOVE '2233'    TO PRV-PARA                               RCKCS233
128800         MOVE SPACES    TO PRV-TBL                                RCKCS233
128900         PERFORM 9999-RETURN-MSG                                  RCKCS233
129000     END-IF.                                                      RCKCS233
129500                                                                  RCKCS233
130000     IF PS-NOT-DONE                                               RCKCS233
130100         PERFORM 2232-FETCH-PLAN-CSR                              RCKCS233
130200     END-IF.                                                      RCKCS233
130300                                                                  RCKCS233
130400                                                                  RCKCS233
130500 2233-CHK-STORE.                                                  RCKCS233
130600******************************************************************RCKCS233
130700*  THIS INQUIRES XLT_LOC VIA XLKUT071 IF THE STORE IS CLOSED.     RCKCS233
130800*  IF SO, IT CREATES STORE CLOSED (261) TROUBLE.                  RCKCS233
130900*  DATA COMES FROM EITHER TMESTDS OR TSPSTDS.                        CL**2
131000******************************************************************RCKCS233
131100                                                                  RCKCS233
049310     INITIALIZE XL071-COMMAREA-REC.                                       
131200     IF PS-SPECIFIC-PLAN                                          RCKCS233
131300         MOVE SPSTDS-STR-NBR TO XL071-LOCATION-NUMBER             RCKCS233
131400     ELSE                                                         RCKCS233
131500         MOVE MESTDS-STR-NBR TO XL071-LOCATION-NUMBER             RCKCS233
131600     END-IF.                                                      RCKCS233
131900                                                                  RCKCS233
049340     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                          
049350                                        XL071-COMMAREA                    
049360                                        XL071-COMMAREA-REC.               
132500                                                                  RCKCS233
059790     EVALUATE TRUE                                                06080099
               WHEN XL071-NO-ERRORS                                             
133200             IF (XL071-LOC-TYP-CDE  = PC-DS                       RCKCS233
133300                             OR PC-DC                             RCKCS233
133400                             OR PC-CS                             RCKCS233
133500                             OR PC-RV)                            RCKCS233
13300                AND (PV-CURRENT-DATE < XL071-CLO-DTE)              RCKCS233
129700                 PERFORM 2233-CHK-IF-RECEIVING                    RCKCS233
                   ELSE                                                         
134500                 SET PS-DONE             TO TRUE                  RCKCS233
134700                 MOVE PC-C               TO TM500-CRUD-IND        RCKCS233
134800                 MOVE PC-261             TO TM500-TRBL-RSN-CDE    RCKCS233
135000                 SET  TM500-ADD-DETAILS  TO TRUE                  RCKCS233
135100                 MOVE PC-RCKCS233        TO TM500-CRE-UID         RCKCS233
135200                 MOVE XL071-LOCATION-NUMBER                       RCKCS233
135200                                         TO PC-STORE-NUMBER       RCKCS233
135300                 MOVE PC-STR-CLS-TEXT    TO TM500-FREEFORM-TEXT   RCKCS233
135500                 PERFORM 3000-CREATE-TROUBLE-RECORD               RCKCS233
135700                 MOVE PRV-01             TO TM500-RETURN-DATA     RCKCS233
135800                 SET TM500-NO-DETAILS    TO TRUE                  RCKCS233
135900                 SET TM500-IN-TROUBLE    TO TRUE                  RCKCS233
                   END-IF                                                       
136600         WHEN OTHER                                               RCKCS233
136700             SET PS-DONE          TO TRUE                         RCKCS233
136800             MOVE XL071-SQLCA     TO TM500-SQLCA                  RCKCS233
136900             MOVE XL071-SQLCODE-N TO TM500-SQLCODE                RCKCS233
137000             MOVE PRV-3V          TO TM500-RETURN-DATA            RCKCS233
137200             MOVE SPACES          TO PRV-TM500-RETURN-MSG         RCKCS233
137300             MOVE '2233 STORE'    TO PRV-PARA                     RCKCS233
137400             MOVE 'XLT_LOC'       TO PRV-TBL                      RCKCS233
137500             PERFORM 9999-RETURN-MSG                              RCKCS233
137600     END-EVALUATE.                                                RCKCS233
137800                                                                  RCKCS233
139200 2233-CHK-IF-RECEIVING.                                           RCKCS233
139300******************************************************************RCKCS233
139400*  THIS PARAGRAPH INQUIRES IF THE STORE IS OPEN FOR               RCKCS233
139500*  RECEIVING.  IF NOT, IT CREATES STORE NOT OPEN (262) TROUBLE.   RCKCS233
139700******************************************************************RCKCS233
139800                                                                  RCKCS233
059700     IF (PV-CURRENT-DATE    NOT < XL071-ASGMT-EFF-BEG-DTE)        05990099
059700       AND (PV-CURRENT-DATE NOT > XL071-ASGMT-EFF-STP-DTE)        05990099
143400         CONTINUE                                                 RCKCS233
143100     ELSE                                                         RCKCS233
143700         SET PS-DONE                TO TRUE                       RCKCS233
143900         MOVE PC-C                  TO TM500-CRUD-IND             RCKCS233
144000         MOVE PC-262                TO TM500-TRBL-RSN-CDE         RCKCS233
144200         SET  TM500-ADD-DETAILS     TO TRUE                       RCKCS233
144300         MOVE PC-RCKCS233           TO TM500-CRE-UID              RCKCS233
144400         MOVE XL071-LOCATION-NUMBER TO PC-STR-NO                  RCKCS233
144500         MOVE PC-STR-NOT-RCVG-TEXT  TO TM500-FREEFORM-TEXT        RCKCS233
144700         PERFORM 3000-CREATE-TROUBLE-RECORD                       RCKCS233
144900         MOVE PRV-01                TO TM500-RETURN-DATA          RCKCS233
145000         SET TM500-NO-DETAILS       TO TRUE                       RCKCS233
145100         SET TM500-IN-TROUBLE       TO TRUE                       RCKCS233
           END-IF.                                                              
148300                                                                  RCKCS233
148400 2234-CLOSE-PLAN-CSR.                                             RCKCS233
148500******************************************************************RCKCS233
148600*    THIS PARAGRAPH CLOSES THE PLAN CURSOR.                       RCKCS233
148700******************************************************************RCKCS233
148800                                                                  RCKCS233
148900     IF PS-SPECIFIC-PLAN                                          RCKCS233
149000         EXEC SQL                                                 RCKCS233
149100              CLOSE SPECIFIC-PLAN-CSR                             RCKCS233
149200         END-EXEC                                                 RCKCS233
149300     ELSE                                                         RCKCS233
149400         EXEC SQL                                                 RCKCS233
149500              CLOSE PLAN-CSR                                      RCKCS233
149600         END-EXEC                                                 RCKCS233
149700     END-IF.                                                      RCKCS233
149800                                                                  RCKCS233
149900     IF SQLCODE NOT = +0                                          RCKCS233
150000         SET PS-DONE  TO TRUE                                     RCKCS233
150100         MOVE PRV-3G  TO TM500-RETURN-DATA                        RCKCS233
150200         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
150300         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
150400                                                                  RCKCS233
150500         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
150600         MOVE '2234'    TO PRV-PARA                               RCKCS233
150700         MOVE SPACES    TO PRV-TBL                                RCKCS233
150800         PERFORM 9999-RETURN-MSG                                  RCKCS233
150900     END-IF.                                                      RCKCS233
151000                                                                  RCKCS233
151100                                                                  RCKCS233
151200 2240-GET-STORE-RECEIPTS.                                         RCKCS233
151300******************************************************************RCKCS233
151400*    THIS PARAGRAPH RETRIEVES THE RECEIPTS FOR EACH STORE AND     RCKCS233
151500*    STORES THEM IN AN ARRAY OF STORES.                           RCKCS233
151600******************************************************************RCKCS233
151700                                                                  RCKCS233
151800     IF TM500-REDISTRO-YES                                        RCKCS233
151900         PERFORM 2241-GET-PRIOR-RECEIPTS                          RCKCS233
152000     ELSE                                                         RCKCS233
152100         PERFORM 2242-GET-ALL-RECEIPTS                            RCKCS233
152200     END-IF.                                                      RCKCS233
152300                                                                  RCKCS233
152400                                                                  RCKCS233
152500 2241-GET-PRIOR-RECEIPTS.                                         RCKCS233
152600******************************************************************RCKCS233
152700*    THIS PARAGRAPH RETRIEVES ONLY THOSE RECEIPTS THAT WERE       RCKCS233
152800*    RECEIVED PRIOR TO THIS RECEIPT IN PROCESS.  THIS LOGIC       RCKCS233
152900*    IS ONLY CALLED FOR RE-DISTROING RECEIVERS.                   RCKCS233
153000******************************************************************RCKCS233
153100                                                                  RCKCS233
153200     PERFORM 2241-GET-MIN-TMST.                                   RCKCS233
153300                                                                  RCKCS233
153400     SET PS-MORE-RECEIPT TO TRUE.                                 RCKCS233
153500                                                                  RCKCS233
153600     IF PS-NOT-DONE                                               RCKCS233
153700         PERFORM 2241-OPEN-REDISTRO-CSR                           RCKCS233
153800                                                                  RCKCS233
153900         IF PS-NOT-DONE                                           RCKCS233
154000             PERFORM 2241-FETCH-REDISTRO-CSR                      RCKCS233
154100                                                                  RCKCS233
154200             PERFORM 2243-PROCESS-RECEIPT                         RCKCS233
154300               UNTIL PS-NO-MORE-RECEIPT OR PS-DONE                RCKCS233
154400                                                                  RCKCS233
154500             PERFORM 2241-CLOSE-REDISTRO-CSR                      RCKCS233
154600         END-IF                                                   RCKCS233
154700     END-IF.                                                      RCKCS233
154800                                                                  RCKCS233
154900                                                                  RCKCS233
155000 2241-GET-MIN-TMST.                                               RCKCS233
155100******************************************************************RCKCS233
155200*    THIS PARAGRAPH RETRIEVES THE EARLIEST RECORD FROM TABLE      RCKCS233
155300*    TRECITM.                                                     RCKCS233
155400******************************************************************RCKCS233
155500                                                                  RCKCS233
155600     PERFORM WITH TEST AFTER                                      RCKCS233
155700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
155800         UNTIL   SQLCODE = +0 OR                                  RCKCS233
155900                 PS-DONE OR                                       RCKCS233
156000                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
156100                                                                  RCKCS233
156200         EXEC SQL                                                 RCKCS233
156300              SELECT CRE_TMST                                     RCKCS233
156400                INTO :RECITM-CRE-TMST                             RCKCS233
156500                FROM TRECITM                                      RCKCS233
156600               WHERE ORD_NBR        = :TM500-PO-NBR               RCKCS233
156700                 AND ORD_LNE_NBR    = :TM500-PO-LNE-NBR           RCKCS233
156800                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          RCKCS233
156900                 AND OPER_UNT_ID    = :TM500-OPER-UNT-ID          RCKCS233
157000         END-EXEC                                                 RCKCS233
157100                                                                  RCKCS233
157200         EVALUATE TRUE                                            RCKCS233
157300             WHEN SQLCODE = ZERO                                  RCKCS233
157400                  CONTINUE                                        RCKCS233
157500                                                                  RCKCS233
157600             WHEN SQLCODE = -904                                  RCKCS233
157700             WHEN SQLCODE = -911                                  RCKCS233
157800             WHEN SQLCODE = -913                                  RCKCS233
157900                  CONTINUE                                        RCKCS233
158000                                                                  RCKCS233
158100             WHEN OTHER                                           RCKCS233
158200                  SET  PS-DONE TO TRUE                            RCKCS233
158300                  MOVE PRV-3C  TO TM500-RETURN-DATA               RCKCS233
158400                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
158500                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
158600                                                                  RCKCS233
158700                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
158800                  MOVE '2241'    TO PRV-PARA                      RCKCS233
158900                  MOVE 'TRECITM' TO PRV-TBL                       RCKCS233
159000                  PERFORM 9999-RETURN-MSG                         RCKCS233
159100         END-EVALUATE                                             RCKCS233
159200     END-PERFORM.                                                 RCKCS233
159300                                                                  RCKCS233
159400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
159500         SET  PS-DONE TO TRUE                                     RCKCS233
159600         MOVE PRV-3C  TO TM500-RETURN-DATA                        RCKCS233
159700         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
159800         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
159900                                                                  RCKCS233
160000         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
160100         MOVE '2241'    TO PRV-PARA                               RCKCS233
160200         MOVE 'TRECITM' TO PRV-TBL                                RCKCS233
160300         PERFORM 9999-RETURN-MSG                                  RCKCS233
160400     END-IF.                                                      RCKCS233
160500                                                                  RCKCS233
160600                                                                  RCKCS233
160700 2241-OPEN-REDISTRO-CSR.                                          RCKCS233
160800******************************************************************RCKCS233
160900*    THIS PARAGRAPH OPENS THE REDISTRO CURSOR.                    RCKCS233
161000******************************************************************RCKCS233
161100                                                                  RCKCS233
161200     EXEC SQL                                                     RCKCS233
161300          OPEN REDISTRO-CSR                                       RCKCS233
161400     END-EXEC.                                                    RCKCS233
161500                                                                  RCKCS233
161600     IF SQLCODE NOT = +0                                          RCKCS233
161700         SET PS-DONE  TO TRUE                                     RCKCS233
161800         MOVE PRV-3X  TO TM500-RETURN-DATA                        RCKCS233
161900         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
162000         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
162100                                                                  RCKCS233
162200         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
162300         MOVE '2241'    TO PRV-PARA                               RCKCS233
162400         MOVE SPACES    TO PRV-TBL                                RCKCS233
162500         PERFORM 9999-RETURN-MSG                                  RCKCS233
162600     END-IF.                                                      RCKCS233
162700                                                                  RCKCS233
162800                                                                  RCKCS233
162900 2241-FETCH-REDISTRO-CSR.                                         RCKCS233
163000******************************************************************RCKCS233
163100*    THIS PARAGRAPH RETRIEVES THE REC-SEQ-NBR FROM TABLE TRECITM. RCKCS233
163200******************************************************************RCKCS233
163300                                                                  RCKCS233
163400     EXEC SQL                                                     RCKCS233
163500          FETCH REDISTRO-CSR                                      RCKCS233
163600           INTO :RECITM-REC-SEQ-NBR                               RCKCS233
163700     END-EXEC.                                                    RCKCS233
163800                                                                  RCKCS233
163900     EVALUATE TRUE                                                RCKCS233
164000         WHEN SQLCODE = +0                                        RCKCS233
164100              CONTINUE                                            RCKCS233
164200                                                                  RCKCS233
164300         WHEN SQLCODE = +100                                      RCKCS233
164400              SET PS-NO-MORE-RECEIPT TO TRUE                      RCKCS233
164500                                                                  RCKCS233
164600         WHEN OTHER                                               RCKCS233
164700              SET PS-DONE  TO TRUE                                RCKCS233
164800              MOVE PRV-3Y  TO TM500-RETURN-DATA                   RCKCS233
164900              MOVE SQLCA   TO TM500-SQLCA                         RCKCS233
165000              MOVE SQLCODE TO TM500-SQLCODE                       RCKCS233
165100                                                                  RCKCS233
165200              MOVE SPACES    TO PRV-TM500-RETURN-MSG              RCKCS233
165300              MOVE '2241'    TO PRV-PARA                          RCKCS233
165400              MOVE SPACES    TO PRV-TBL                           RCKCS233
165500              PERFORM 9999-RETURN-MSG                             RCKCS233
165600     END-EVALUATE.                                                RCKCS233
165700                                                                  RCKCS233
165800                                                                  RCKCS233
165900 2241-CLOSE-REDISTRO-CSR.                                         RCKCS233
166000******************************************************************RCKCS233
166100*    THIS PARAGRAPH CLOSES THE REDISTRO CURSOR.                   RCKCS233
166200******************************************************************RCKCS233
166300                                                                  RCKCS233
166400     EXEC SQL                                                     RCKCS233
166500          CLOSE REDISTRO-CSR                                      RCKCS233
166600     END-EXEC.                                                    RCKCS233
166700                                                                  RCKCS233
166800     IF SQLCODE NOT = +0                                          RCKCS233
166900         SET PS-DONE  TO TRUE                                     RCKCS233
167000         MOVE PRV-3Z  TO TM500-RETURN-DATA                        RCKCS233
167100         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
167200         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
167300                                                                  RCKCS233
167400         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
167500         MOVE '2241'    TO PRV-PARA                               RCKCS233
167600         MOVE SPACES    TO PRV-TBL                                RCKCS233
167700         PERFORM 9999-RETURN-MSG                                  RCKCS233
167800     END-IF.                                                      RCKCS233
167900                                                                  RCKCS233
168000                                                                  RCKCS233
168100 2242-GET-ALL-RECEIPTS.                                           RCKCS233
168200******************************************************************RCKCS233
168300*    THIS PARAGRAPH RETRIEVES ALL THE PO'S RECEIPTS.              RCKCS233
168400******************************************************************RCKCS233
168500                                                                  RCKCS233
168600     SET PS-MORE-RECEIPT TO TRUE.                                 RCKCS233
168700                                                                  RCKCS233
168800     PERFORM 2242-OPEN-RECEIPT-CSR.                               RCKCS233
168900                                                                  RCKCS233
169000     IF PS-NOT-DONE                                               RCKCS233
169100         PERFORM 2242-FETCH-RECEIPT-CSR                           RCKCS233
169200                                                                  RCKCS233
169300         PERFORM 2243-PROCESS-RECEIPT                             RCKCS233
169400           UNTIL PS-NO-MORE-RECEIPT OR PS-DONE                    RCKCS233
169500                                                                  RCKCS233
169600         PERFORM 2242-CLOSE-RECEIPT-CSR                           RCKCS233
169700     END-IF.                                                      RCKCS233
169800                                                                  RCKCS233
169900                                                                  RCKCS233
170000 2242-OPEN-RECEIPT-CSR.                                           RCKCS233
170100******************************************************************RCKCS233
170200*    THIS PARAGRAPH OPENS THE RECEIPT CURSOR.                     RCKCS233
170300******************************************************************RCKCS233
170400                                                                  RCKCS233
170500     EXEC SQL                                                     RCKCS233
170600          OPEN RECEIPT-CSR                                        RCKCS233
170700     END-EXEC.                                                    RCKCS233
170800                                                                  RCKCS233
170900     IF SQLCODE NOT = +0                                          RCKCS233
171000         SET PS-DONE  TO TRUE                                     RCKCS233
171100         MOVE PRV-3I  TO TM500-RETURN-DATA                        RCKCS233
171200         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
171300         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
171400                                                                  RCKCS233
171500         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
171600         MOVE '2242'    TO PRV-PARA                               RCKCS233
171700         MOVE SPACES    TO PRV-TBL                                RCKCS233
171800         PERFORM 9999-RETURN-MSG                                  RCKCS233
171900     END-IF.                                                      RCKCS233
172000                                                                  RCKCS233
172100                                                                  RCKCS233
172200 2242-FETCH-RECEIPT-CSR.                                          RCKCS233
172300******************************************************************RCKCS233
172400*    THIS PARAGRAPH RETRIEVES THE REC-SEQ-NBR FROM TABLE TRECITM. RCKCS233
172500******************************************************************RCKCS233
172600                                                                  RCKCS233
172700     EXEC SQL                                                     RCKCS233
172800          FETCH RECEIPT-CSR                                       RCKCS233
172900           INTO :RECITM-REC-SEQ-NBR                               RCKCS233
173000     END-EXEC.                                                    RCKCS233
173100                                                                  RCKCS233
173200     EVALUATE TRUE                                                RCKCS233
173300         WHEN SQLCODE = +0                                        RCKCS233
173400              CONTINUE                                            RCKCS233
173500                                                                  RCKCS233
173600         WHEN SQLCODE = +100                                      RCKCS233
173700              SET PS-NO-MORE-RECEIPT TO TRUE                      RCKCS233
173800                                                                  RCKCS233
173900         WHEN OTHER                                               RCKCS233
174000              SET PS-DONE  TO TRUE                                RCKCS233
174100              MOVE PRV-3J  TO TM500-RETURN-DATA                   RCKCS233
174200              MOVE SQLCA   TO TM500-SQLCA                         RCKCS233
174300              MOVE SQLCODE TO TM500-SQLCODE                       RCKCS233
174400                                                                  RCKCS233
174500              MOVE SPACES    TO PRV-TM500-RETURN-MSG              RCKCS233
174600              MOVE '2242'    TO PRV-PARA                          RCKCS233
174700              MOVE SPACES    TO PRV-TBL                           RCKCS233
174800              PERFORM 9999-RETURN-MSG                             RCKCS233
174900     END-EVALUATE.                                                RCKCS233
175000                                                                  RCKCS233
175100                                                                  RCKCS233
175200 2243-PROCESS-RECEIPT.                                            RCKCS233
175300******************************************************************RCKCS233
175400*    THIS PARAGRAPH GETS A RECDIS RECORD FOR EVERY RECITM RECORD. RCKCS233
175500******************************************************************RCKCS233
175600                                                                  RCKCS233
175700     MOVE 1 TO PV-SUB-1.                                          RCKCS233
175800                                                                  RCKCS233
175900     PERFORM 2243-GET-STATUS-CDE.                                 RCKCS233
176000                                                                  RCKCS233
176100     PERFORM 2243-GET-RECDIS-RECORD                               RCKCS233
176200       UNTIL PV-SUB-1 > PV-STR-SUB OR PS-DONE.                    RCKCS233
176300                                                                  RCKCS233
176400     IF PS-NOT-DONE                                               RCKCS233
176500         IF TM500-REDISTRO-YES                                    RCKCS233
176600             PERFORM 2241-FETCH-REDISTRO-CSR                      RCKCS233
176700         ELSE                                                     RCKCS233
176800             PERFORM 2242-FETCH-RECEIPT-CSR                       RCKCS233
176900         END-IF                                                   RCKCS233
177000     END-IF.                                                      RCKCS233
177100                                                                  RCKCS233
177200                                                                  RCKCS233
177300 2243-GET-STATUS-CDE.                                             RCKCS233
177400******************************************************************RCKCS233
177500*    THIS PARAGRAPH RETRIEVES THE STATUS-CDE FROM TABLE TRECITM.  RCKCS233
177600******************************************************************RCKCS233
177700                                                                  RCKCS233
177800     PERFORM WITH TEST AFTER                                      RCKCS233
177900         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
178000         UNTIL   SQLCODE = +0 OR                                  RCKCS233
178100                 SQLCODE = +100 OR                                RCKCS233
178200                 PS-DONE OR                                       RCKCS233
178300                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
178400                                                                  RCKCS233
178500         EXEC SQL                                                 RCKCS233
178600              SELECT STATUS_CDE                                   RCKCS233
178700                INTO :RECITM-STATUS-CDE                           RCKCS233
178800                FROM TRECITM                                      RCKCS233
178900               WHERE ORD_NBR        = :TM500-PO-NBR               RCKCS233
179000                 AND ORD_LNE_NBR    = :TM500-PO-LNE-NBR           RCKCS233
179100                 AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR         RCKCS233
179200                 AND OPER_UNT_ID    = :TM500-OPER-UNT-ID          RCKCS233
179300                 AND VER_STATUS_CDE = :PC-A                       RCKCS233
179400                 AND STATUS_CDE    IN (:PC-IP, :PC-CM, :PC-VE)    RCKCS233
179500         END-EXEC                                                 RCKCS233
179600                                                                  RCKCS233
179700         EVALUATE TRUE                                            RCKCS233
179800             WHEN SQLCODE = +0                                    RCKCS233
179900                  CONTINUE                                        RCKCS233
180000                                                                  RCKCS233
180100             WHEN SQLCODE = +100                                  RCKCS233
180200                  COMPUTE PV-SUB-1 = PV-STR-SUB + 1               RCKCS233
180300                                                                  RCKCS233
180400             WHEN SQLCODE = -904                                  RCKCS233
180500             WHEN SQLCODE = -911                                  RCKCS233
180600             WHEN SQLCODE = -913                                  RCKCS233
180700                  CONTINUE                                        RCKCS233
180800                                                                  RCKCS233
180900             WHEN OTHER                                           RCKCS233
181000                  SET  PS-DONE TO TRUE                            RCKCS233
181100                  MOVE PRV-3C  TO TM500-RETURN-DATA               RCKCS233
181200                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
181300                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
181400                                                                  RCKCS233
181500                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
181600                  MOVE '2243'    TO PRV-PARA                      RCKCS233
181700                  MOVE 'TRECITM' TO PRV-TBL                       RCKCS233
181800                  PERFORM 9999-RETURN-MSG                         RCKCS233
181900         END-EVALUATE                                             RCKCS233
182000     END-PERFORM.                                                 RCKCS233
182100                                                                  RCKCS233
182200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
182300         SET  PS-DONE TO TRUE                                     RCKCS233
182400         MOVE PRV-3C  TO TM500-RETURN-DATA                        RCKCS233
182500         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
182600         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
182700                                                                  RCKCS233
182800         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
182900         MOVE '2243'    TO PRV-PARA                               RCKCS233
183000         MOVE 'TRECITM' TO PRV-TBL                                RCKCS233
183100         PERFORM 9999-RETURN-MSG                                  RCKCS233
183200     END-IF.                                                      RCKCS233
183300                                                                  RCKCS233
183400                                                                  RCKCS233
183500 2243-GET-RECDIS-RECORD.                                          RCKCS233
183600******************************************************************RCKCS233
183700*    THIS PARAGRAPH RETRIEVES THE RECDIS RECORD FOR A GIVEN STORE.RCKCS233
183800*    IT THEN ADDS INTO THE STORE ARRAY THE CORRECT STORE RECEIPTS RCKCS233
183900*    DEPENDING UPON THE STATUS CODE OF THE RECITM.                RCKCS233
184000******************************************************************RCKCS233
184100                                                                  RCKCS233
184200     MOVE PT-STR-NBR (PV-SUB-1) TO RECDIS-STR-NBR.                RCKCS233
184300                                                                  RCKCS233
184400     PERFORM WITH TEST AFTER                                      RCKCS233
184500         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
184600         UNTIL   SQLCODE = +0 OR                                  RCKCS233
184700                 SQLCODE = +100 OR                                RCKCS233
184800                 PS-DONE OR                                       RCKCS233
184900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
185000                                                                  RCKCS233
185100         EXEC SQL                                                 RCKCS233
185200              SELECT EXPTED_ITM_QTY                               RCKCS233
185300                   , AP_VERIFY_ITM_QTY                            RCKCS233
185400                INTO :RECDIS-EXPTED-ITM-QTY                       RCKCS233
185500                   , :RECDIS-AP-VERIFY-ITM-QTY                    RCKCS233
185600                FROM TRECDIS                                      RCKCS233
185700               WHERE ORD_NBR        = :TM500-PO-NBR               RCKCS233
185800                 AND ORD_LNE_NBR    = :TM500-PO-LNE-NBR           RCKCS233
185900                 AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR         RCKCS233
186000                 AND OPER_UNT_ID    = :TM500-OPER-UNT-ID          RCKCS233
186000                 AND FCLTY_ID       = 1                                   
186200                 AND STR_NBR        = :RECDIS-STR-NBR             RCKCS233
186300                 AND STR_FCLTY_ID   = 1                           RCKCS233
186400         END-EXEC                                                 RCKCS233
186500                                                                  RCKCS233
186600         EVALUATE TRUE                                            RCKCS233
186700             WHEN SQLCODE = +0                                    RCKCS233
186800                  IF RECITM-STATUS-CDE = PC-VE                    RCKCS233
186900                      ADD RECDIS-AP-VERIFY-ITM-QTY                RCKCS233
187000                       TO PT-STR-REC-QTY (PV-SUB-1)               RCKCS233
187100                  ELSE                                            RCKCS233
187200                      ADD RECDIS-EXPTED-ITM-QTY                   RCKCS233
187300                       TO PT-STR-REC-QTY (PV-SUB-1)               RCKCS233
187400                  END-IF                                          RCKCS233
187500                                                                  RCKCS233
187600             WHEN SQLCODE = +100                                  RCKCS233
187700                  CONTINUE                                        RCKCS233
187800                                                                  RCKCS233
187900             WHEN SQLCODE = -904                                  RCKCS233
188000             WHEN SQLCODE = -911                                  RCKCS233
188100             WHEN SQLCODE = -913                                  RCKCS233
188200                  CONTINUE                                        RCKCS233
188300                                                                  RCKCS233
188400             WHEN OTHER                                           RCKCS233
188500                  SET  PS-DONE TO TRUE                            RCKCS233
188600                  MOVE PRV-3L  TO TM500-RETURN-DATA               RCKCS233
188700                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
188800                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
188900                                                                  RCKCS233
189000                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
189100                  MOVE '2243'    TO PRV-PARA                      RCKCS233
189200                  MOVE 'TRECDIS' TO PRV-TBL                       RCKCS233
189300                  PERFORM 9999-RETURN-MSG                         RCKCS233
189400         END-EVALUATE                                             RCKCS233
189500     END-PERFORM.                                                 RCKCS233
189600                                                                  RCKCS233
189700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
189800         SET  PS-DONE TO TRUE                                     RCKCS233
189900         MOVE PRV-3L  TO TM500-RETURN-DATA                        RCKCS233
190000         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
190100         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
190200                                                                  RCKCS233
190300         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
190400         MOVE '2243'    TO PRV-PARA                               RCKCS233
190500         MOVE 'TRECDIS' TO PRV-TBL                                RCKCS233
190600         PERFORM 9999-RETURN-MSG                                  RCKCS233
190700     END-IF.                                                      RCKCS233
190800                                                                  RCKCS233
190900     ADD 1 TO PV-SUB-1.                                           RCKCS233
191000                                                                  RCKCS233
191100                                                                  RCKCS233
191200 2242-CLOSE-RECEIPT-CSR.                                          RCKCS233
191300******************************************************************RCKCS233
191400*    THIS PARAGRAPH CLOSES THE RECEIPT CURSOR.                    RCKCS233
191500******************************************************************RCKCS233
191600                                                                  RCKCS233
191700     EXEC SQL                                                     RCKCS233
191800          CLOSE RECEIPT-CSR                                       RCKCS233
191900     END-EXEC.                                                    RCKCS233
192000                                                                  RCKCS233
192100     IF SQLCODE NOT = +0                                          RCKCS233
192200         SET PS-DONE  TO TRUE                                     RCKCS233
192300         MOVE PRV-3K  TO TM500-RETURN-DATA                        RCKCS233
192400         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
192500         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
192600                                                                  RCKCS233
192700         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
192800         MOVE '2242'    TO PRV-PARA                               RCKCS233
192900         MOVE SPACES    TO PRV-TBL                                RCKCS233
193000         PERFORM 9999-RETURN-MSG                                  RCKCS233
193100     END-IF.                                                      RCKCS233
193200                                                                  RCKCS233
193300                                                                  RCKCS233
193400 2250-CALC-STR-OPEN-TO-REC.                                       RCKCS233
193500******************************************************************RCKCS233
193600*    THIS PARAGRAPH CALCULATES THE OPEN-TO-RECEIVE QUANTITIES OF  RCKCS233
193700*    EACH STORE AND CALCULATES THE RECEIVED AND OPEN-TO-RECEIVE   RCKCS233
193800*    TOTALS OF ALL STORES.                                        RCKCS233
193900******************************************************************RCKCS233
194000                                                                  RCKCS233
194100     ADD PT-STR-REC-QTY (PV-SUB-1)                                RCKCS233
194200       TO PV-SUM-STR-REC-QTY.                                     RCKCS233
194300                                                                  RCKCS233
194400     IF PT-STR-PLAN-QTY (PV-SUB-1) >                              RCKCS233
194500        PT-STR-REC-QTY (PV-SUB-1)                                 RCKCS233
194600         ADD 1 TO PV-OTR-SUB                                      RCKCS233
194700         COMPUTE PT-STR-OTR-TOTALS(PV-SUB-1) =                    RCKCS233
194800                 PT-STR-PLAN-QTY  (PV-SUB-1) -                    RCKCS233
194900                 PT-STR-REC-QTY   (PV-SUB-1)                      RCKCS233
195000     ELSE                                                         RCKCS233
195100         MOVE 0 TO PT-STR-OTR-TOTALS(PV-SUB-1)                    RCKCS233
195200     END-IF.                                                      RCKCS233
195300                                                                  RCKCS233
195400     ADD PT-STR-OTR-TOTALS(PV-SUB-1)                              RCKCS233
195500      TO PV-SUM-STR-OTR-UNITS.                                    RCKCS233
195600                                                                  RCKCS233
195700     DIVIDE RECITM-INNR-PACK-QTY                                  RCKCS233
195800       INTO PT-STR-OTR-TOTALS (PV-SUB-1)                          RCKCS233
195900            GIVING PT-STR-OTR-PACKS (PV-SUB-1)                    RCKCS233
196000            REMAINDER PT-STR-OTR-UNITS (PV-SUB-1).                RCKCS233
196100                                                                  RCKCS233
196200     MOVE 0 TO PT-STR-ALLOC-PCT   (PV-SUB-1).                     RCKCS233
196300     MOVE 0 TO PT-STR-ALLOC-UNITS (PV-SUB-1).                     RCKCS233
196400     MOVE 0 TO PT-STR-ALLOC-PACKS (PV-SUB-1).                     RCKCS233
196500     MOVE 0 TO PT-STR-ALLOC-TOTALS(PV-SUB-1).                     RCKCS233
196600                                                                  RCKCS233
196700     ADD 1 TO PV-SUB-1.                                           RCKCS233
196800                                                                  RCKCS233
196900                                                                  RCKCS233
197000 2300-SORT-STORE-ARRAY.                                           RCKCS233
197100******************************************************************RCKCS233
197200*    THIS PARAGRAPH CALLS 2310 TO BUBBLE SORT THE STORES TABLE.   RCKCS233
197300******************************************************************RCKCS233
197400                                                                  RCKCS233
197500     MOVE 1 TO PV-SUB-1.                                          RCKCS233
197600                                                                  RCKCS233
197700     PERFORM 2310-BUBBLE-SORT                                     RCKCS233
197800       UNTIL PV-SUB-1 NOT < PV-STR-SUB.                           RCKCS233
197900                                                                  RCKCS233
198000                                                                  RCKCS233
198100 2310-BUBBLE-SORT.                                                RCKCS233
198200******************************************************************RCKCS233
198300*    THIS PARAGRAPH CALLS 2311 TO SORT THE STORES TABLE.          RCKCS233
198400******************************************************************RCKCS233
198500                                                                  RCKCS233
198600     COMPUTE PV-SUB-2 = PV-SUB-1 + 1.                             RCKCS233
198700                                                                  RCKCS233
198800     PERFORM 2311-LOOP-BUBBLE-SORT                                RCKCS233
198900       UNTIL PV-SUB-2 > PV-STR-SUB.                               RCKCS233
199000                                                                  RCKCS233
199100     ADD 1 TO PV-SUB-1.                                           RCKCS233
199200                                                                  RCKCS233
199300                                                                  RCKCS233
199400 2311-LOOP-BUBBLE-SORT.                                           RCKCS233
199500******************************************************************RCKCS233
199600*    THIS PARAGRAPH SORTS THE STORES TABLE IN DESCENDING ORDER    RCKCS233
199700*    OF UNITS TO BE RECEIVED AND THEN BY STORE NUMBER.            RCKCS233
199800******************************************************************RCKCS233
199900                                                                  RCKCS233
200000     IF PT-STR-OTR-TOTALS (PV-SUB-1) < PT-STR-OTR-TOTALS(PV-SUB-2)RCKCS233
200100     OR (PT-STR-OTR-TOTALS(PV-SUB-1) = PT-STR-OTR-TOTALS(PV-SUB-2)RCKCS233
200200                              AND                                 RCKCS233
200300               PT-STR-NBR (PV-SUB-1) > PT-STR-NBR (PV-SUB-2))     RCKCS233
200400                                                                  RCKCS233
200500         MOVE PT-STORE-TABLE (PV-SUB-1) TO PV-TEMP                RCKCS233
200600         MOVE PT-STORE-TABLE (PV-SUB-2) TO                        RCKCS233
200700              PT-STORE-TABLE (PV-SUB-1)                           RCKCS233
200800         MOVE PV-TEMP                   TO                        RCKCS233
200900              PT-STORE-TABLE (PV-SUB-2)                           RCKCS233
201000     END-IF.                                                      RCKCS233
201100                                                                  RCKCS233
201200     ADD 1 TO PV-SUB-2.                                           RCKCS233
201300                                                                  RCKCS233
201400                                                                  RCKCS233
201500 2400-OVER-OR-SHORT.                                              RCKCS233
201600******************************************************************RCKCS233
201700*    THIS PARAGRAPH CALLS THE FOLLOWING PARAGRAPH:                RCKCS233
201800*    - 2410 RETRIEVES THE OVER/SHORT PERCENT ALLOWED TO PROCESS   RCKCS233
201900*    - 2420 DETERMINES IF THE UNITS RECEIVED WERE SHORT OR OVER   RCKCS233
202000*           THE SUM OF THE STORE'S OPEN TO RECEIVE (OTR)          RCKCS233
202100*    IF THE SUM OF OTR IS ZERO IT CREATES A ZERO OTR (518) TROUBLERCKCS233
202200******************************************************************RCKCS233
202300                                                                  RCKCS233
202400     IF PV-SUM-STR-OTR-UNITS > 0                                  RCKCS233
202500         PERFORM 2410-GET-OVER-SHORT-PCT                          RCKCS233
202600                                                                  RCKCS233
202700         IF PS-NOT-DONE                                           RCKCS233
202800             PERFORM 2420-OVER-OR-SHORT-TROUBLE                   RCKCS233
202900         END-IF                                                   RCKCS233
203000     ELSE                                                         RCKCS233
203100         MOVE PC-C   TO TM500-CRUD-IND                            RCKCS233
203200         MOVE PC-518 TO TM500-TRBL-RSN-CDE                        RCKCS233
263900*** DISPLAY ZERO OTR MSG                                          RCKCS233
263900         SET  TM500-ADD-DETAILS    TO TRUE                        RCKCS233
264000         MOVE PC-RCKCS233          TO TM500-CRE-UID               RCKCS233
203200         MOVE TM500-UNITS-TO-ALLOC TO PC-ZO-RCVD                  RCKCS233
203200         MOVE ZERO                 TO PC-ZO-OTR                   RCKCS233
203200         MOVE PC-ZERO-OTR-TEXT     TO TM500-FREEFORM-TEXT         RCKCS233
203300         PERFORM 3000-CREATE-TROUBLE-RECORD                       RCKCS233
203400                                                                  RCKCS233
203500         SET TM500-IN-TROUBLE TO TRUE                             RCKCS233
203600     END-IF.                                                      RCKCS233
203700                                                                  RCKCS233
203800                                                                  RCKCS233
203900 2410-GET-OVER-SHORT-PCT.                                         RCKCS233
204000******************************************************************RCKCS233
204100*    THIS PARAGRAPH CALLS THE FOLLOWING PARAGRAPH:                RCKCS233
204200*    - 2411 RETRIEVES TYPE-CODE                                   RCKCS233
204300*    - 2412 RETRIEVES A VALID DC NUMBER                           RCKCS233
204400*    - 2413 RETRIEVES THE SHIPMENT ALLOWABLE PERCENTAGE           RCKCS233
204400*    - 2414 TO CHECK THE NEW STORE INDICATOR AND MOVE THE         RCKCS233
204400*           NEW STORE OVER/SHORT PERCENTAGE TO A WORK FIELD       RCKCS233
204400*           IF ITS A NEW STORE OR THE REGULAR OVER/SHORT          RCKCS233
204400*           PERCENTAGE WHEN ITS AN OLD STORE                      RCKCS233
204400*    - 2415 TO CHECK IF IT IS AN IMPORT ORDER AND IF IT IS        RCKCS233
204400*           TO MOVE IMPORT OVER/SHORT PCT TO A WORK FIELD.        RCKCS233
204400*           IF IT IS AN IMPORT AND A PICTURED AD USE THE IMPORT   RCKCS233
204400*           AD OVER/SHORT PERCENTAAGES.  HOWEVER NEW STORE ORDERS RCKCS233
204400*           WILL    *** ALWAYS *** USE THE NEW STORE PARAMETERS   RCKCS233
204400*           EVEN IF IT IS AN IMPORT ORDER.                        RCKCS233
204500******************************************************************RCKCS233
204600                                                                  RCKCS233
204700     PERFORM 2411-GET-TYPE-CODE.                                  RCKCS233
204800                                                                  RCKCS233
205900     IF PS-NOT-DONE                                               RCKCS233
206000         PERFORM 2413-GET-SHIPT-PCT                               RCKCS233
206000         PERFORM 2414-CHK4-NEW-STORE                              RCKCS233
206000         PERFORM 2415-CHK4-IMPORT                                 RCKCS233
206100     END-IF.                                                      RCKCS233
206200                                                                  RCKCS233
206300                                                                  RCKCS233
206400 2411-GET-TYPE-CODE.                                              RCKCS233
206500******************************************************************RCKCS233
206600*    THIS PARAGRAPH RETRIEVES THE TYPE-CODE OF XLT_LOC.           RCKCS233
206700******************************************************************RCKCS233
206800                                                                  RCKCS233
049310     INITIALIZE XL071-COMMAREA-REC.                                       
206900     MOVE TM500-OPER-UNT-ID TO XL071-LOCATION-NUMBER.             RCKCS233
131900                                                                  RCKCS233
049340     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                          
049350                                        XL071-COMMAREA                    
049360                                        XL071-COMMAREA-REC.               
207100                                                                  RCKCS233
209800     EVALUATE TRUE                                                RCKCS233
209900         WHEN XL071-NO-ERRORS                                     RCKCS233
205000             IF XL071-LOC-TYP-CDE = PC-DS                         RCKCS233
205100                                 OR PC-CS                         RCKCS233
205200                                     OR PC-RV                     RCKCS233
205300                 PERFORM 2412-GET-DC-NUMBER                       RCKCS233
205400             ELSE                                                 RCKCS233
205500                 MOVE TM500-OPER-UNT-ID TO COCNTL-OPER-UNT-ID     RCKCS233
210000             END-IF                                               RCKCS233
210600                                                                  RCKCS233
210700         WHEN OTHER                                               RCKCS233
210800              SET PS-DONE          TO TRUE                        RCKCS233
210900              MOVE XL071-SQLCA     TO TM500-SQLCA                 RCKCS233
211000              MOVE XL071-SQLCODE-N TO TM500-SQLCODE               RCKCS233
211100              MOVE PRV-3V          TO TM500-RETURN-DATA           RCKCS233
211300              MOVE SPACES          TO PRV-TM500-RETURN-MSG        RCKCS233
211400              MOVE '2411'          TO PRV-PARA                    RCKCS233
211500              MOVE 'XLT_LOC'       TO PRV-TBL                     RCKCS233
211600              PERFORM 9999-RETURN-MSG                             RCKCS233
211700     END-EVALUATE.                                                RCKCS233
211900                                                                  RCKCS233
213300 2412-GET-DC-NUMBER.                                              RCKCS233
213400******************************************************************RCKCS233
213500*    THIS PARAGRAPH RETRIEVES A VALID DC NUMBER.                  RCKCS233
213600******************************************************************RCKCS233
213700                                                                  RCKCS233
214200     EVALUATE TRUE                                                RCKCS233
214300         WHEN PV-CURRENT-DATE = XL071-ASGMT-EFF-BEG-DTE           RCKCS233
214400              MOVE XL071-ASGMT-DC-NBR TO COCNTL-OPER-UNT-ID       RCKCS233
214500                                                                  RCKCS233
214600         WHEN (PV-CURRENT-DATE > XL071-ASGMT-EFF-BEG-DTE) AND     RCKCS233
214700              (PV-CURRENT-DATE < XL071-ASGMT-EFF-STP-DTE)         RCKCS233
214800              MOVE XL071-ASGMT-DC-NBR TO COCNTL-OPER-UNT-ID       RCKCS233
214900                                                                  RCKCS233
215000         WHEN PV-CURRENT-DATE = XL071-ASGMT-EFF-STP-DTE           RCKCS233
215100              MOVE XL071-ASGMT-DC-NBR TO COCNTL-OPER-UNT-ID       RCKCS233
216200                                                                  RCKCS233
216300         WHEN OTHER                                               RCKCS233
216400              SET PS-DONE TO TRUE                                 RCKCS233
216500     END-EVALUATE.                                                RCKCS233
216600                                                                  RCKCS233
216800 2413-GET-SHIPT-PCT.                                              RCKCS233
216900******************************************************************RCKCS233
217000*    THIS PARAGRAPH GETS THE OVERAGE AND SHORTAGE PERCENT FROM    RCKCS233
217100*    TABLE TCOCNTL.                                               RCKCS233
217200******************************************************************RCKCS233
217300                                                                  RCKCS233
217400     PERFORM WITH TEST AFTER                                      RCKCS233
217500         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
217600         UNTIL   SQLCODE = +0 OR                                  RCKCS233
217700                 PS-DONE OR                                       RCKCS233
217800                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
217900                                                                  RCKCS233
218000         EXEC SQL                                                 RCKCS233
218100              SELECT SHIPT_OVRG_PCT                               RCKCS233
218200                   , SHIPT_SHTG_PCT                               RCKCS233
218200                   , NW_STR_OVRG_PCT                              RCKCS233
218200                   , NW_STR_SHTG_PCT                              RCKCS233
218200                   , IMPRT_OVRG_PCT                               RCKCS233
218200                   , IMPRT_SHTG_PCT                               RCKCS233
218200                   , IMPRT_AD_OVRG_PCT                            RCKCS233
218200                   , IMPRT_AD_SHTG_PCT                            RCKCS233
218200                   , IMPRTPPK_OVRG_PCT                            RCKCS233
218200                   , IMPRTPPK_SHTG_PCT                            RCKCS233
218300                INTO :COCNTL-SHIPT-OVRG-PCT                       RCKCS233
218400                   , :COCNTL-SHIPT-SHTG-PCT                       RCKCS233
218400                   , :COCNTL-NW-STR-OVRG-PCT                      RCKCS233
218400                   , :COCNTL-NW-STR-SHTG-PCT                      RCKCS233
218200                   , :COCNTL-IMPRT-OVRG-PCT                       RCKCS233
218200                   , :COCNTL-IMPRT-SHTG-PCT                       RCKCS233
218200                   , :COCNTL-IMPRT-AD-OVRG-PCT                    RCKCS233
218200                   , :COCNTL-IMPRT-AD-SHTG-PCT                    RCKCS233
218200                   , :COCNTL-IMPRTPPK-OVRG-PCT                    RCKCS233
218200                   , :COCNTL-IMPRTPPK-SHTG-PCT                    RCKCS233
218500                FROM TCOCNTL                                      RCKCS233
218600               WHERE OPER_UNT_ID = :COCNTL-OPER-UNT-ID            RCKCS233
218700                 AND FCLTY_ID    = :TM500-FCLTY-ID                RCKCS233
218800         END-EXEC                                                 RCKCS233
218900                                                                  RCKCS233
219000         EVALUATE TRUE                                            RCKCS233
219100             WHEN SQLCODE = +0                                    RCKCS233
219200                  CONTINUE                                        RCKCS233
219300                                                                  RCKCS233
219400             WHEN SQLCODE = -904                                  RCKCS233
219500             WHEN SQLCODE = -911                                  RCKCS233
219600             WHEN SQLCODE = -913                                  RCKCS233
219700                  CONTINUE                                        RCKCS233
219800                                                                  RCKCS233
219900             WHEN OTHER                                           RCKCS233
220000                  SET  PS-DONE TO TRUE                            RCKCS233
220100                  MOVE PRV-3M  TO TM500-RETURN-DATA               RCKCS233
220200                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
220300                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
220400                                                                  RCKCS233
220500                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
220600                  MOVE '2413'    TO PRV-PARA                      RCKCS233
220700                  MOVE 'TCOCNTL' TO PRV-TBL                       RCKCS233
220800                  PERFORM 9999-RETURN-MSG                         RCKCS233
220900         END-EVALUATE                                             RCKCS233
221000     END-PERFORM.                                                 RCKCS233
221100                                                                  RCKCS233
221200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
221300         SET  PS-DONE TO TRUE                                     RCKCS233
221400         MOVE PRV-3M  TO TM500-RETURN-DATA                        RCKCS233
221500         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
221600         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
221700                                                                  RCKCS233
221800         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
221900         MOVE '2413'    TO PRV-PARA                               RCKCS233
222000         MOVE 'TCOCNTL' TO PRV-TBL                                RCKCS233
222100         PERFORM 9999-RETURN-MSG                                  RCKCS233
222200     END-IF.                                                      RCKCS233
222300                                                                  RCKCS233
222400                                                                  RCKCS233
222500 2414-CHK4-NEW-STORE.                                             RCKCS233
222600******************************************************************RCKCS233
222700*    THIS PARAGRAPH CHECKS THE NEW STORE INDICATOR AND THEN       RCKCS233
222800*    MOVES THE CORRESPONDING OVER/SHORT %                         RCKCS233
223100******************************************************************RCKCS233
223200                                                                  RCKCS233
223200     IF TM500-NEW-STR-PO-IND = PC-Y                               RCKCS233
223200         MOVE COCNTL-NW-STR-OVRG-PCT TO PV-SHIPT-OVRG-PCT         RCKCS233
223200         MOVE COCNTL-NW-STR-SHTG-PCT TO PV-SHIPT-SHTG-PCT         RCKCS233
223200     ELSE                                                         RCKCS233
223200         MOVE COCNTL-SHIPT-OVRG-PCT  TO PV-SHIPT-OVRG-PCT         RCKCS233
223200         MOVE COCNTL-SHIPT-SHTG-PCT  TO PV-SHIPT-SHTG-PCT         RCKCS233
223200     END-IF.                                                      RCKCS233
223200                                                                  RCKCS233
222500 2415-CHK4-IMPORT.                                                RCKCS233
222600******************************************************************RCKCS233
222600*   THIS PARAGRAPH FIRST CHECKS IF THE PO NUMBER IS AN IMPORT AND         
222600*   IF THE PACKAGING TYPE IS EITHER "M" OR "I" (MULTIPLE OR               
222600*   INNER PACK), IF IT IS, IT LOOKS AT CERTAIN PARMS, IF NOT              
222700*   IT WILL CHECK  THE NEW STORE INDICATOR; IF IT IS A                    
222800*    NEW STORE, IT CONTINUES ON ITS WAY (NEW STORE PARMS OVERRIDE         
222800*    IMPORT PARMS. IF ITS NOT A NEW STORE PO, AND IT IS AN                
222800*    PREPACK IMPORT (PKGNG-CODE = "M" OR "I", THEN ANOTHER PARMS          
      *    APPLY.  IF IT IS NOT, IF IT NOT A NEW STORE, PREPACK AND IT          
222800*    IS AN IMPORT, THEN OTHER PARMS APPLY.  THIS IS ESPECIALLY            
222800*    TRUE WHEN IT IS AN IMPORT AND A PICTURED AD.                         
223100******************************************************************RCKCS233
223200                                                                  RCKCS233
223200     IF TM500-NEW-STR-PO-IND = PC-Y                                       
223200        CONTINUE                                                          
           ELSE                                                                 
223200        IF TM500-IMPORT-PO-IND = PC-Y                                     
223200           IF TM500-AD-ITM-IND = PC-Y                                     
223200               MOVE COCNTL-IMPRT-AD-OVRG-PCT                              
223200                                        TO PV-SHIPT-OVRG-PCT      RCKCS233
223200               MOVE COCNTL-IMPRT-AD-SHTG-PCT                              
223200                                        TO PV-SHIPT-SHTG-PCT      RCKCS233
223200           ELSE                                                           
223200               MOVE COCNTL-IMPRT-OVRG-PCT                                 
223200                                        TO PV-SHIPT-OVRG-PCT      RCKCS233
223200               MOVE COCNTL-IMPRT-SHTG-PCT                                 
223200                                        TO PV-SHIPT-SHTG-PCT      RCKCS233
223200           END-IF                                                         
223200        ELSE                                                              
223200**** NOT AN IMPORT, USE REGULAR PARAMETERS                        RCKCS233
223200            MOVE COCNTL-SHIPT-OVRG-PCT  TO PV-SHIPT-OVRG-PCT              
223200            MOVE COCNTL-SHIPT-SHTG-PCT  TO PV-SHIPT-SHTG-PCT              
223200        END-IF                                                            
223200     END-IF.                                                              
223200                                                                  RCKCS233
222500 2420-OVER-OR-SHORT-TROUBLE.                                      RCKCS233
222600******************************************************************RCKCS233
222700*    THIS PARAGRAPH CALLS THE FOLLOWING PARAGRAPH:                RCKCS233
222800*    - 2421 WHICH PROCESS OVERAGE TROUBLE                         RCKCS233
222900*    - 2422 WHICH PROCESS SHORTAGE TROUBLE                        RCKCS233
223000*    - 2711 RETRIEVES PACK BY STORE INDICATOR                     RCKCS233
223100******************************************************************RCKCS233
223200                                                                  RCKCS233
223300     PERFORM 2711-GET-PACK-BY-ST-IND.                             RCKCS233
223400                                                                          
223500                                                                          
223600     IF PS-NOT-DONE                                               RCKCS233
223700        IF PS-SPECIFIC-PLAN                                       RCKCS233
223800* A TSPSTDS ROW EXISTS                                            RCKCS233
223900           EVALUATE TRUE                                          RCKCS233
224000             WHEN TM500-UNITS-TO-ALLOC  = PV-SUM-STR-OTR-UNITS    RCKCS233
224100                  CONTINUE                                        RCKCS233
224200             WHEN TM500-UNITS-TO-ALLOC NOT = PV-SUM-STR-OTR-UNITS RCKCS233
224300                                                                  RCKCS233
224400                     SET PS-USE-SPECIFIC-MSG  TO TRUE             RCKCS233
224500                     MOVE PV-SUM-STR-PLAN-QTY TO                  RCKCS233
224600                                         PC-OS-SPECIFIC-QTY       RCKCS233
224700                     SET PS-MASTER-PLAN TO TRUE                   RCKCS233
224800                                                                          
225000                     SET PS-TSPSTDS-NOT-FOUND TO TRUE             RCKCS233
225100                                                                  RCKCS233
225200                     PERFORM 2130-GET-TMESTDS-RECORD              RCKCS233
225300                                                                  RCKCS233
225400                     IF PS-NOT-DONE                               RCKCS233
225500                        PERFORM 2200-BUILD-STORE-ARRAY            RCKCS233
225600                     END-IF                                       RCKCS233
225700                     IF PS-NOT-DONE                               RCKCS233
225800                        PERFORM 2300-SORT-STORE-ARRAY             RCKCS233
225900                     END-IF                                       RCKCS233
226000                                                                  RCKCS233
226100                     IF PS-NOT-DONE                               RCKCS233
226200                         EVALUATE TRUE                            RCKCS233
226300                         WHEN TM500-UNITS-TO-ALLOC >              RCKCS233
226400                                    PV-SUM-STR-OTR-UNITS          RCKCS233
226500                             PERFORM 2421-OVERAGE-TROUBLE         RCKCS233
226600                         WHEN TM500-UNITS-TO-ALLOC =              RCKCS233
226700                                    PV-SUM-STR-OTR-UNITS          RCKCS233
226800                             CONTINUE                             RCKCS233
226900                         WHEN TM500-UNITS-TO-ALLOC <              RCKCS233
227000                                    PV-SUM-STR-OTR-UNITS          RCKCS233
227100                             PERFORM 2422-SHORTAGE-TROUBLE        RCKCS233
227200                         END-EVALUATE                             RCKCS233
227300                     END-IF                                       RCKCS233
227400           END-EVALUATE                                           RCKCS233
227500        ELSE                                                      RCKCS233
227600           EVALUATE TRUE                                          RCKCS233
227700             WHEN TM500-UNITS-TO-ALLOC = PV-SUM-STR-OTR-UNITS     RCKCS233
227800                  CONTINUE                                        RCKCS233
227900                                                                  RCKCS233
228000             WHEN TM500-UNITS-TO-ALLOC > PV-SUM-STR-OTR-UNITS     RCKCS233
228100                  PERFORM 2421-OVERAGE-TROUBLE                    RCKCS233
228200                                                                  RCKCS233
228300             WHEN TM500-UNITS-TO-ALLOC < PV-SUM-STR-OTR-UNITS     RCKCS233
228400                  PERFORM 2422-SHORTAGE-TROUBLE                   RCKCS233
228500                                                                  RCKCS233
228600           END-EVALUATE                                           RCKCS233
228700         END-IF                                                   RCKCS233
228800     END-IF.                                                      RCKCS233
228900                                                                  RCKCS233
229000                                                                          
229100                                                                  RCKCS233
229200 2421-OVERAGE-TROUBLE.                                            RCKCS233
229300******************************************************************RCKCS233
229400*    THIS PARAGRAPH PROCESSES THE OVERAGE TROUBLE RECORD.         RCKCS233
229500******************************************************************RCKCS233
229600                                                                  RCKCS233
236100*** SET FLAG TO INDICATE THIS IS OVER IN ORDER TO MOVE            RCKCS233
236100*** CORRECT INFO TO OVER/SHORT TEXT LINES LATER                   RCKCS233
236100     SET PS-OVER          TO TRUE                                 RCKCS233
229600                                                                  RCKCS233
229700     IF ((TM500-UNITS-TO-ALLOC - PV-SUM-STR-OTR-UNITS) /          RCKCS233
229800        PV-SUM-STR-OTR-UNITS) < PC-10                             RCKCS233
229900         COMPUTE PV-RATIO ROUNDED =                               RCKCS233
230000             (TM500-UNITS-TO-ALLOC - PV-SUM-STR-OTR-UNITS) /      RCKCS233
230100             PV-SUM-STR-OTR-UNITS                                 RCKCS233
230200         COMPUTE PV-PCT-OVR-SHT ROUNDED = PV-RATIO * PC-100       RCKCS233
230300         MOVE PV-PCT-OVR-SHT TO PV-PCT-OVR-SHT-TEMP               RCKCS233
230400                                                                  RCKCS233
230500         IF PV-PCT-OVR-SHT > PV-PCT-OVR-SHT-TEMP                  RCKCS233
230600             COMPUTE TM500-OVER-SHORT-PCT =                       RCKCS233
230700                 PV-PCT-OVR-SHT-TEMP + 1                          RCKCS233
230800         ELSE                                                     RCKCS233
230900             MOVE PV-PCT-OVR-SHT-TEMP TO TM500-OVER-SHORT-PCT     RCKCS233
231000         END-IF                                                   RCKCS233
231100     ELSE                                                         RCKCS233
231200         COMPUTE PV-PCT-OVR-SHT ROUNDED = PC-99999 / PC-100       RCKCS233
231300         MOVE PC-999 TO TM500-OVER-SHORT-PCT                      RCKCS233
231400     END-IF.                                                      RCKCS233
231500                                                                  RCKCS233
231600     IF RECEIV-PACK-BY-ST-IND = PC-Y                              RCKCS233
231700         MOVE PC-C            TO TM500-CRUD-IND                   RCKCS233
231800         MOVE PC-520          TO TM500-TRBL-RSN-CDE               RCKCS233
231900                                                                  RCKCS233
232000         COMPUTE PV-TEMP-AMT   = TM500-UNITS-TO-ALLOC -           RCKCS233
232100                                 PV-SUM-STR-OTR-UNITS             RCKCS233
232200         MOVE PV-TEMP-AMT     TO PC-OS-DIFF                       RCKCS233
232300                                 PC-OS-MS-DIFF                    RCKCS233
232400         MOVE PC-OVER         TO PC-OS-TEXT-4                     RCKCS233
232500                                 PC-OS-MS-TEXT                    RCKCS233
232600                                                                  RCKCS233
232700         PERFORM 2423-CREATE-OS-TEXT                              RCKCS233
232800                                                                  RCKCS233
232900         PERFORM 3000-CREATE-TROUBLE-RECORD                       RCKCS233
233000                                                                  RCKCS233
233100         SET TM500-NO-DETAILS TO TRUE                             RCKCS233
233200                                                                  RCKCS233
233300     ELSE                                                         RCKCS233
233400* PV-SHIPT-OVRG-PCT CONTAINS  COCNTL-SHIPT-OVRG-PCT IF            RCKCS233
233400* TM500-NEW-STR-PO-IND IS SET TO 'N'                              RCKCS233
233400* PV-SHIPT-OVRG-PCT CONTAINS  COCNTL-NW-STR-OVRG-PCT IF           RCKCS233
233400* TM500-NEW-STR-PO-IND IS SET TO 'Y'                              RCKCS233
233400*                                                                 RCKCS233
233400* IF THIS IS AN IMPORT PO WHICH IS NOT A NEW STORE PO             RCKCS233
233400* PV-SHIPT-OVRG-PCT CONTAINS  COCNTL-IMPRT-OVRG-PCT IF            RCKCS233
233400* TM500-IMPORT-PO-IND IS SET TO 'Y'                               RCKCS233
233400* IF THIS IS AN IMPORT PO WHICH IS ALSO AN AD ITEM (INDICATED BY  RCKCS233
233400* TM500-AD-ITM-IND = 'Y') AND IT'S NOT A NEW STORE ORDER          RCKCS233
233400* PV-SHIPT-OVRG-PCT CONTAINS  COCNTL-IMPRT-AD-OVRG-PCT IF         RCKCS233
233400* TM500-IMPORT-PO-IND IS SET TO 'Y'                               RCKCS233
233400                                                                  RCKCS233
233400         IF PV-PCT-OVR-SHT > PV-SHIPT-OVRG-PCT                    RCKCS233
233400* OVER OUTSIDE LIMITS                                             RCKCS233
233500             MOVE PC-C            TO TM500-CRUD-IND               RCKCS233
233600                                                                  RCKCS233
233700* IF A ROW WAS FOUND ON THE NEW SPECIFIC PLAN TABLE, TSPSTDS,     RCKCS233
233800* THERE WILL BE A 521 OVERAGE TROUBLE.  OTHERWISE THE USER        RCKCS233
233900* MAY HAVE CHANGED THE ORIGINAL TMESTDS QUANTITIES.  THE TALLPLN  RCKCS233
234000* SPLIT QTY ALWAYS STARTS OUT AS EQUAL TO THE SUM OF THE TMESTDS  RCKCS233
234100* STORE QTYS.  IF THEY'RE DIFFERENT, THE USER WANTS TO USE        RCKCS233
234200* TMESTDS AS A SPECIFIC PLAN INSTEAD OF A MASTER PLAN.            RCKCS233
234300* TROUBLE REASON 517 IS CREATED WHEN THIS HAPPENS.                RCKCS233
234400                                                                  RCKCS233
234500             IF PS-TSPSTDS-FOUND                                  RCKCS233
234600                 MOVE PC-521  TO TM500-TRBL-RSN-CDE               RCKCS233
234700             ELSE                                                 RCKCS233
234800                IF ALLPLN-CURR-SPLIT-QTY = PV-SUM-STR-PLAN-QTY    RCKCS233
234900                     MOVE PC-521  TO TM500-TRBL-RSN-CDE           RCKCS233
235000                ELSE                                              RCKCS233
235100                     MOVE PC-517  TO TM500-TRBL-RSN-CDE           RCKCS233
235200                END-IF                                            RCKCS233
235300             END-IF                                               RCKCS233
235400                                                                  RCKCS233
235500             COMPUTE PV-TEMP-AMT   = TM500-UNITS-TO-ALLOC -       RCKCS233
235600                                     PV-SUM-STR-OTR-UNITS         RCKCS233
235700             MOVE PV-TEMP-AMT     TO PC-OS-DIFF                   RCKCS233
235800                                     PC-OS-MS-DIFF                RCKCS233
235900             MOVE PC-OVER         TO PC-OS-TEXT-4                 RCKCS233
236000                                     PC-OS-MS-TEXT                RCKCS233
236100                                                                  RCKCS233
236200             PERFORM 2423-CREATE-OS-TEXT                          RCKCS233
236300                                                                  RCKCS233
236400             PERFORM 3000-CREATE-TROUBLE-RECORD                   RCKCS233
236500                                                                  RCKCS233
236600             SET TM500-IN-TROUBLE TO TRUE                         RCKCS233
236700             SET TM500-NO-DETAILS TO TRUE                         RCKCS233
236800                                                                  RCKCS233
236900         ELSE                                                     RCKCS233
237000             MOVE PC-C            TO TM500-CRUD-IND               RCKCS233
237100                                                                  RCKCS233
237200*  AN OVERAGE BASED ON A CHANGED TMESTDS WILL CREATE A 517        RCKCS233
237300*  TROUBLE BECAUSE THERE'S NO TOLERANCE WHEN USING A 'SPECIFIC'   RCKCS233
237400*  PLAN.                                                          RCKCS233
237500             IF PS-TSPSTDS-FOUND                                  RCKCS233
237600                 MOVE PC-520      TO TM500-TRBL-RSN-CDE           RCKCS233
237700             ELSE                                                 RCKCS233
237800                IF ALLPLN-CURR-SPLIT-QTY = PV-SUM-STR-PLAN-QTY    RCKCS233
237900                     MOVE PC-520  TO TM500-TRBL-RSN-CDE           RCKCS233
238000                ELSE                                              RCKCS233
238100                     MOVE PC-517  TO TM500-TRBL-RSN-CDE           RCKCS233
238200                     SET TM500-IN-TROUBLE TO TRUE                 RCKCS233
238300                END-IF                                            RCKCS233
238400             END-IF                                               RCKCS233
238500                                                                  RCKCS233
238600             COMPUTE PV-TEMP-AMT   = TM500-UNITS-TO-ALLOC -       RCKCS233
238700                                     PV-SUM-STR-OTR-UNITS         RCKCS233
238800             MOVE PV-TEMP-AMT     TO PC-OS-DIFF                   RCKCS233
238900                                     PC-OS-MS-DIFF                RCKCS233
239000             MOVE PC-OVER         TO PC-OS-TEXT-4                 RCKCS233
239100                                     PC-OS-MS-TEXT                RCKCS233
239200                                                                  RCKCS233
239300             PERFORM 2423-CREATE-OS-TEXT                          RCKCS233
239400                                                                  RCKCS233
239500             PERFORM 3000-CREATE-TROUBLE-RECORD                   RCKCS233
239600                                                                  RCKCS233
239700             SET TM500-NO-DETAILS TO TRUE                         RCKCS233
239800                                                                  RCKCS233
239900         END-IF                                                   RCKCS233
240000     END-IF.                                                      RCKCS233
240100                                                                  RCKCS233
240200                                                                  RCKCS233
240300 2422-SHORTAGE-TROUBLE.                                           RCKCS233
240400******************************************************************RCKCS233
240500*    THIS PARAGRAPH PROCESSES THE SHORTAGE TROUBLE RECORD.        RCKCS233
240600******************************************************************RCKCS233
240700                                                                  RCKCS233
236100*** SET FLAG TO INDICATE THIS IS SHORT IN ORDER TO MOVE           RCKCS233
236100*** CORRECT INFO TO OVER/SHORT TEXT LINES LATER                   RCKCS233
244400     SET PS-SHORT         TO TRUE.                                RCKCS233
244400                                                                  RCKCS233
240800     IF ((PV-SUM-STR-OTR-UNITS - TM500-UNITS-TO-ALLOC) /          RCKCS233
240900        PV-SUM-STR-OTR-UNITS) < PC-10                             RCKCS233
241000         COMPUTE PV-RATIO ROUNDED =                               RCKCS233
241100             (PV-SUM-STR-OTR-UNITS - TM500-UNITS-TO-ALLOC) /      RCKCS233
241200             PV-SUM-STR-OTR-UNITS                                 RCKCS233
241300                                                                  RCKCS233
241400         COMPUTE PV-PCT-OVR-SHT ROUNDED = PV-RATIO * PC-100       RCKCS233
241500                                                                  RCKCS233
241600         MOVE PV-PCT-OVR-SHT TO PV-PCT-OVR-SHT-TEMP               RCKCS233
241700                                                                  RCKCS233
241800         IF PV-PCT-OVR-SHT > PV-PCT-OVR-SHT-TEMP                  RCKCS233
241900             COMPUTE TM500-OVER-SHORT-PCT =                       RCKCS233
242000                 PV-PCT-OVR-SHT-TEMP + 1                          RCKCS233
242100         ELSE                                                     RCKCS233
242200             MOVE PV-PCT-OVR-SHT-TEMP TO TM500-OVER-SHORT-PCT     RCKCS233
242300         END-IF                                                   RCKCS233
242400     ELSE                                                         RCKCS233
242500         COMPUTE PV-PCT-OVR-SHT ROUNDED = PC-99999 / PC-100       RCKCS233
242600         MOVE PC-999 TO TM500-OVER-SHORT-PCT                      RCKCS233
242700     END-IF.                                                      RCKCS233
242800                                                                  RCKCS233
242900     IF RECEIV-PACK-BY-ST-IND = PC-Y                              RCKCS233
243000* SHORT WITHIN                                                    RCKCS233
243100         MOVE PC-C            TO TM500-CRUD-IND                   RCKCS233
243200         IF PS-SPECIFIC-PLAN                                      RCKCS233
243300             MOVE PC-515      TO TM500-TRBL-RSN-CDE               RCKCS233
243400         ELSE                                                     RCKCS233
243500             MOVE PC-510      TO TM500-TRBL-RSN-CDE               RCKCS233
243600         END-IF                                                   RCKCS233
243700                                                                  RCKCS233
243800         COMPUTE PV-TEMP-AMT   = PV-SUM-STR-OTR-UNITS -           RCKCS233
243900                                 TM500-UNITS-TO-ALLOC             RCKCS233
244000         MOVE PV-TEMP-AMT     TO PC-OS-DIFF                       RCKCS233
244100                                 PC-OS-MS-DIFF                    RCKCS233
244200         MOVE PC-SHORT        TO PC-OS-TEXT-4                     RCKCS233
244300                                 PC-OS-MS-TEXT                    RCKCS233
244400                                                                  RCKCS233
244500         PERFORM 2423-CREATE-OS-TEXT                              RCKCS233
244600                                                                  RCKCS233
244700         PERFORM 3000-CREATE-TROUBLE-RECORD                       RCKCS233
244800                                                                  RCKCS233
244900         SET TM500-NO-DETAILS TO TRUE                             RCKCS233
245000                                                                  RCKCS233
245100     ELSE                                                         RCKCS233
233400* PV-SHIPT-OVRG-PCT CONTAINS  COCNTL-SHIPT-SHTG-PCT IF            RCKCS233
233400* TM500-NEW-STR-PO-IND IS SET TO 'N'                              RCKCS233
233400* PV-SHIPT-OVRG-PCT CONTAINS  COCNTL-NW-STR-SHTG-PCT IF           RCKCS233
233400* TM500-NEW-STR-PO-IND IS SET TO 'Y'                              RCKCS233
233400*                                                                 RCKCS233
233400* IF THIS IS AN IMPORT PO WHICH IS NOT A NEW STORE PO             RCKCS233
233400* PV-SHIPT-SHTG-PCT CONTAINS  COCNTL-IMPRT-SHTG-PCT IF            RCKCS233
233400* TM500-IMPORT-PO-IND IS SET TO 'Y'                               RCKCS233
233400* IF THIS IS AN IMPORT PO WHICH IS ALSO AN AD ITEM (INDICATED BY  RCKCS233
233400* TM500-AD-ITM-IND = 'Y') AND IT'S NOT A NEW STORE ORDER          RCKCS233
233400* PV-SHIPT-SHTG-PCT CONTAINS  COCNTL-IMPRT-AD-SHTG-PCT IF         RCKCS233
233400* TM500-IMPORT-PO-IND IS SET TO 'Y'                               RCKCS233
233400                                                                  RCKCS233
245200         IF PV-PCT-OVR-SHT > PV-SHIPT-SHTG-PCT                    RCKCS233
245300* SHORT OUTSIDE LIMITS                                            RCKCS233
245400             MOVE PC-C            TO TM500-CRUD-IND               RCKCS233
245500             PERFORM 2422A-PRORATE-TROUBLE THRU 2422A-EXIT        RCKCS233
245600                                                                  RCKCS233
245700             COMPUTE PV-TEMP-AMT   = PV-SUM-STR-OTR-UNITS -       RCKCS233
245800                                     TM500-UNITS-TO-ALLOC         RCKCS233
245900             MOVE PV-TEMP-AMT     TO PC-OS-DIFF                   RCKCS233
246000                                     PC-OS-MS-DIFF                RCKCS233
246100             MOVE PC-SHORT        TO PC-OS-TEXT-4                 RCKCS233
246200                                     PC-OS-MS-TEXT                RCKCS233
246300                                                                  RCKCS233
246400             PERFORM 2423-CREATE-OS-TEXT                          RCKCS233
246500                                                                  RCKCS233
246600             PERFORM 3000-CREATE-TROUBLE-RECORD                   RCKCS233
246700                                                                  RCKCS233
246800             SET TM500-NO-DETAILS TO TRUE                         RCKCS233
246900                                                                  RCKCS233
247000         ELSE                                                     RCKCS233
247100             MOVE PC-C            TO TM500-CRUD-IND               RCKCS233
247200             IF PS-SPECIFIC-PLAN                                  RCKCS233
247300                 MOVE PC-515  TO TM500-TRBL-RSN-CDE               RCKCS233
247400             ELSE                                                 RCKCS233
247500                 MOVE PC-510  TO TM500-TRBL-RSN-CDE               RCKCS233
247600             END-IF                                               RCKCS233
247700                                                                  RCKCS233
247800             COMPUTE PV-TEMP-AMT   = PV-SUM-STR-OTR-UNITS -       RCKCS233
247900                                     TM500-UNITS-TO-ALLOC         RCKCS233
248000             MOVE PV-TEMP-AMT     TO PC-OS-DIFF                   RCKCS233
248100                                     PC-OS-MS-DIFF                RCKCS233
248200             MOVE PC-SHORT        TO PC-OS-TEXT-4                 RCKCS233
248300                                     PC-OS-MS-TEXT                RCKCS233
248400                                                                  RCKCS233
248500             PERFORM 2423-CREATE-OS-TEXT                          RCKCS233
248600                                                                  RCKCS233
248700             PERFORM 3000-CREATE-TROUBLE-RECORD                   RCKCS233
248800                                                                  RCKCS233
248900             SET TM500-NO-DETAILS TO TRUE                         RCKCS233
249000                                                                  RCKCS233
249100         END-IF                                                   RCKCS233
249200     END-IF.                                                      RCKCS233
249300/                                                                 RCKCS233
249400 2422A-PRORATE-TROUBLE.                                           RCKCS233
249500                                                                  RCKCS233
249600     EVALUATE TRUE                                                RCKCS233
249700     WHEN TM500-AD-YES                                            RCKCS233
249800         MOVE PC-526              TO TM500-TRBL-RSN-CDE           RCKCS233
249900         SET TM500-IN-TROUBLE     TO TRUE                         RCKCS233
250000         GO TO 2422A-EXIT                                         RCKCS233
250100     WHEN PS-SPECIFIC-PLAN                                        RCKCS233
250200         MOVE PC-514              TO TM500-TRBL-RSN-CDE           RCKCS233
250300         SET TM500-IN-TROUBLE     TO TRUE                         RCKCS233
250400         GO TO 2422A-EXIT                                         RCKCS233
250500     END-EVALUATE.                                                RCKCS233
250600                                                                  RCKCS233
250700     PERFORM 2422A1-COUNT-RECEIVERS.                              RCKCS233
250800                                                                  RCKCS233
250900     IF PV-DB2-COUNT > PC-1                                       RCKCS233
251000         PERFORM 2422A2-FIND-TROUBLE                              RCKCS233
251100         IF PV-DB2-COUNT > ZERO                                   RCKCS233
251200             MOVE PC-513      TO TM500-TRBL-RSN-CDE               RCKCS233
251300             MOVE PC-Y        TO TM500-PRORATE-IND                RCKCS233
251400         ELSE                                                     RCKCS233
251500             MOVE PC-511      TO TM500-TRBL-RSN-CDE               RCKCS233
251600             SET TM500-IN-TROUBLE                                 RCKCS233
251700                                  TO TRUE                         RCKCS233
251800     ELSE                                                         RCKCS233
251900         MOVE PC-511          TO TM500-TRBL-RSN-CDE               RCKCS233
252000         SET TM500-IN-TROUBLE TO TRUE                             RCKCS233
252100     END-IF.                                                      RCKCS233
252200                                                                  RCKCS233
252300 2422A-EXIT.                                                      RCKCS233
252400     EXIT.                                                        RCKCS233
252500                                                                  RCKCS233
252600 2422A1-COUNT-RECEIVERS.                                          RCKCS233
252700******************************************************************RCKCS233
252800*    THIS PARAGRAPH COUNTS ACTIVE RECEIVERS ON THE PO.            RCKCS233
252900******************************************************************RCKCS233
253000                                                                  RCKCS233
253100     MOVE ZERO                    TO PV-DB2-COUNT.                RCKCS233
253200     PERFORM WITH TEST AFTER                                      RCKCS233
253300         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
253400         UNTIL   SQLCODE = ZERO                                   RCKCS233
253500                 OR                                               RCKCS233
253600                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
253700                                                                  RCKCS233
253800         EXEC SQL                                                 RCKCS233
253900              SELECT COUNT(*)                                     RCKCS233
254000                INTO :PV-DB2-COUNT                                RCKCS233
254100                FROM TRECEIV                                      RCKCS233
254200               WHERE ORD_NBR        = :TM500-PO-NBR               RCKCS233
254300                 AND VER_STATUS_CDE = :PC-A                       RCKCS233
254400         END-EXEC                                                 RCKCS233
254500                                                                  RCKCS233
254600         EVALUATE TRUE                                            RCKCS233
254700             WHEN SQLCODE = +0                                    RCKCS233
254800                  CONTINUE                                        RCKCS233
254900                                                                  RCKCS233
255000             WHEN SQLCODE = -904                                  RCKCS233
255100             WHEN SQLCODE = -911                                  RCKCS233
255200             WHEN SQLCODE = -913                                  RCKCS233
255300                  CONTINUE                                        RCKCS233
255400                                                                  RCKCS233
255500             WHEN OTHER                                           RCKCS233
255600                  SET  PS-DONE TO TRUE                            RCKCS233
255700                  MOVE PRV-3O  TO TM500-RETURN-DATA               RCKCS233
255800                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
255900                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
256000                                                                  RCKCS233
256100                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
256200                  MOVE '2422A'   TO PRV-PARA                      RCKCS233
256300                  MOVE 'TRECEIV' TO PRV-TBL                       RCKCS233
256400                  PERFORM 9999-RETURN-MSG                         RCKCS233
256500         END-EVALUATE                                             RCKCS233
256600     END-PERFORM.                                                 RCKCS233
256700                                                                  RCKCS233
256800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
256900         SET  PS-DONE TO TRUE                                     RCKCS233
257000         MOVE PRV-3O  TO TM500-RETURN-DATA                        RCKCS233
257100         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
257200         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
257300                                                                  RCKCS233
257400         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
257500         MOVE '2422A'   TO PRV-PARA                               RCKCS233
257600         MOVE 'TRECEIV' TO PRV-TBL                                RCKCS233
257700         PERFORM 9999-RETURN-MSG                                  RCKCS233
257800     END-IF.                                                      RCKCS233
257900                                                                  RCKCS233
258000 2422A2-FIND-TROUBLE.                                             RCKCS233
258100                                                                  RCKCS233
258200     MOVE ZERO                    TO PV-DB2-COUNT.                RCKCS233
258300     PERFORM WITH TEST AFTER                                      RCKCS233
258400         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
258500         UNTIL   SQLCODE = ZERO                                   RCKCS233
258600                 OR                                               RCKCS233
258700                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
258800                                                                  RCKCS233
258900         EXEC SQL                                                 RCKCS233
259000              SELECT COUNT(*)                                     RCKCS233
259100                INTO :PV-DB2-COUNT                                RCKCS233
259200                FROM TTRBNTF                                      RCKCS233
259300               WHERE PO_NBR         = :TM500-PO-NBR               RCKCS233
259400                 AND PO_LNE_NBR     = :TM500-PO-LNE-NBR           RCKCS233
259500                 AND TRBL_RSN_CDE   = :PC-511                     RCKCS233
259600                 AND PRORATE_IND    = :PC-Y                       RCKCS233
259700                 AND REC_SEQ_NBR   ^= :TM500-REC-SEQ-NBR          RCKCS233
259800         END-EXEC                                                 RCKCS233
259900                                                                  RCKCS233
260000         EVALUATE TRUE                                            RCKCS233
260100             WHEN SQLCODE = ZERO                                  RCKCS233
260200                  CONTINUE                                        RCKCS233
260300                                                                  RCKCS233
260400             WHEN SQLCODE = -904                                  RCKCS233
260500             WHEN SQLCODE = -911                                  RCKCS233
260600             WHEN SQLCODE = -913                                  RCKCS233
260700                  CONTINUE                                        RCKCS233
260800                                                                  RCKCS233
260900             WHEN OTHER                                           RCKCS233
261000                  SET  PS-DONE TO TRUE                            RCKCS233
261100                  MOVE PRV-3O  TO TM500-RETURN-DATA               RCKCS233
261200                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
261300                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
261400                                                                  RCKCS233
261500                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
261600                  MOVE '2422A'   TO PRV-PARA                      RCKCS233
261700                  MOVE 'TTRBNTF' TO PRV-TBL                       RCKCS233
261800                  PERFORM 9999-RETURN-MSG                         RCKCS233
261900         END-EVALUATE                                             RCKCS233
262000     END-PERFORM.                                                 RCKCS233
262100                                                                  RCKCS233
262200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
262300         SET  PS-DONE TO TRUE                                     RCKCS233
262400         MOVE PRV-3O  TO TM500-RETURN-DATA                        RCKCS233
262500         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
262600         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
262700                                                                  RCKCS233
262800         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
262900         MOVE '2422A'   TO PRV-PARA                               RCKCS233
263000         MOVE 'TTRBNTF' TO PRV-TBL                                RCKCS233
263100         PERFORM 9999-RETURN-MSG                                  RCKCS233
263200     END-IF.                                                      RCKCS233
263300/                                                                 RCKCS233
263400 2423-CREATE-OS-TEXT.                                             RCKCS233
263500******************************************************************RCKCS233
263600*    THIS PARAGRAPH CREATES THE FREEFORM TEXT OF TROUBLE RECORD.  RCKCS233
263700******************************************************************RCKCS233
263800                                                                  RCKCS233
263900     SET  TM500-ADD-DETAILS  TO TRUE.                             RCKCS233
264000     MOVE PC-RCKCS233        TO TM500-CRE-UID.                    RCKCS233
264100                                                                  RCKCS233
264200     MOVE TM500-UNITS-TO-ALLOC TO PC-OS-RCVD                      RCKCS233
264300                                  PC-OS-MS-RCVD                   RCKCS233
264400                                                                  RCKCS233
264500     MOVE PV-SUM-STR-OTR-UNITS  TO PC-OS-OTR                      RCKCS233
264600                                   PC-OS-MS-OTR                   RCKCS233
264700                                                                  RCKCS233
264700*** SET UP PC-OVER-SHORT-TEXT-0 LINE                              RCKCS233
264700     PERFORM 2424-SET-UP-TEXT.                                    RCKCS233
264700                                                                  RCKCS233
264700     IF PS-OVER                                                   RCKCS233
264700         MOVE PC-OVER           TO PC-OS-TEXT-0-OVRSHT            RCKCS233
264700         MOVE PV-SHIPT-OVRG-PCT TO PC-OS-TEXT-0-PCT               RCKCS233
264700     ELSE                                                         RCKCS233
264700         MOVE PC-SHORT          TO PC-OS-TEXT-0-OVRSHT            RCKCS233
264700         MOVE PV-SHIPT-SHTG-PCT TO PC-OS-TEXT-0-PCT               RCKCS233
264700     END-IF.                                                      RCKCS233
264700                                                                  RCKCS233
264800     IF PS-USE-SPECIFIC-MSG                                       RCKCS233
264900         MOVE PC-MASTER-SPECIFIC-TEXT TO TM500-FREEFORM-TEXT      RCKCS233
265000     ELSE                                                         RCKCS233
265100         MOVE PC-OVER-SHORT-TEXT      TO TM500-FREEFORM-TEXT      RCKCS233
265200     END-IF.                                                      RCKCS233
265300                                                                  RCKCS233
265300     MOVE SPACES TO PS-OVER-SHORT-SW.                             RCKCS233
265400                                                                  RCKCS233
265600******************************************************************RCKCS233
265700*    THIS PARAGRAPH CHECKS WHAT TEXT SHOULD BE MOVED -- IS IT     RCKCS233
265700*    A PREPACK IMPORT, A NEW STORE, AN IMPORT OR AN IMPORT        RCKCS233
265700*    PICTURED AD?                                                         
265800******************************************************************RCKCS233
264700 2424-SET-UP-TEXT.                                                RCKCS233
264700     MOVE SPACES            TO PC-OS-TEXT-0-LEGEND                RCKCS233
                                                                                
           IF TM500-NEW-STR-PO-IND = PC-Y                                       
264700         MOVE PC-NEW-STORE            TO PC-OS-TEXT-0-LEGEND              
           ELSE                                                                 
              IF TM500-IMPORT-PO-IND = PC-Y AND                                 
264700           TM500-AD-ITM-IND NOT = PC-Y                                    
264700            MOVE PC-IMPORT            TO PC-OS-TEXT-0-LEGEND              
264700        ELSE                                                              
264700           IF TM500-IMPORT-PO-IND = PC-Y AND                              
264700              TM500-AD-ITM-IND = PC-Y                                     
264700               MOVE PC-IMPORT-PIC-AD  TO PC-OS-TEXT-0-LEGEND              
264700     END-IF.                                                      RCKCS233
264700                                                                  RCKCS233
265500 2500-PRORATE-QTY.                                                RCKCS233
265600******************************************************************RCKCS233
265700*    THIS PARAGRAPH PRORATES THE UNITS RECEIVED.                  RCKCS233
265800******************************************************************RCKCS233
265900                                                                  RCKCS233
266000*-----------------------------------------------------------------RCKCS233
266100*    IF THE UNITS RECEIVED < UNITS OPEN TO RECEIVE (OTR)         *RCKCS233
266200*       IF AD ITEM                                               *RCKCS233
266300*          IF PACKS RECEIVED < NO OF STORES OPEN TO RECEIVE      *RCKCS233
266400*             CREATE TROUBLE 526 (SHT PIC AD)                    *RCKCS233
266500*             ALLOCATE 1 UNIT TO EACH STORE UNTIL OUT OF UNITS   *RCKCS233
266600*          ELSE                                                  *RCKCS233
266700*             ALLOCATE 1 PACK TO EACH STORE                      *RCKCS233
266800*                                                                *RCKCS233
266900*                                                                *RCKCS233
267000     MOVE 1 TO PV-SUB-1.                                          RCKCS233
267100                                                                  RCKCS233
267200     IF PV-LEFT-TO-ALLOC < PV-SUM-STR-OTR-UNITS                   RCKCS233
267300         IF TM500-AD-YES                                          RCKCS233
267400             IF PV-PACKS-TO-ALLOC < PV-OTR-SUB                    RCKCS233
267500                                                                  RCKCS233
267600                 PERFORM 2501-ALLOC-ONE-UNIT                      RCKCS233
267700                   UNTIL PV-LEFT-TO-ALLOC NOT > 0                 RCKCS233
267800                                                                  RCKCS233
267900                 MOVE 0 TO PV-PACKS-TO-ALLOC                      RCKCS233
268000                 MOVE 0 TO PV-UNITS-TO-ALLOC                      RCKCS233
268100             ELSE                                                 RCKCS233
268200                 PERFORM 2510-ALLOC-ONE-PACK                      RCKCS233
268300             END-IF                                               RCKCS233
268400         END-IF                                                   RCKCS233
268500*                                                                *RCKCS233
268600*                                                                *RCKCS233
268700*-----------------------------------------------------------------RCKCS233
268800*    IF THE UNITS RECEIVED < UNITS OPEN TO RECEIVE (OTR)         *RCKCS233
268900*       IF PACKS RECEIVED > NO OF STORES OPEN TO RECEIVE         *RCKCS233
269000*          ALLOCATE PACKS ACCORDING TO ITS PERCENT OF TOTAL OTR  *RCKCS233
269100*       IF THERE ARE STILL PACKS TO ALLOCATE                     *RCKCS233
269200*          ALLOCATE 1 PACK TO STORES WITH OTR PACKS BUT DID NOT  *RCKCS233
269300*          RECEIVE A PACK YET                                    *RCKCS233
269400*       IF THERE ARE STILL PACKS TO ALLOCATE                     *RCKCS233
269500*          ALLOCATE 1 PACK TO STORES THAT STILL HAS PACKS OTR    *RCKCS233
269600*       IF THERE ARE STILL PACKS TO ALLOCATE                     *RCKCS233
269700*          ALLOCATE THE NEEDED UNITS TO STORES WITH OTR UNITS    *RCKCS233
269800*          BUT DID NOT RECEIVE A UNIT YET                        *RCKCS233
269900*       IF THERE ARE STILL UNITS TO ALLOCATE                     *RCKCS233
270000*          ALLOCATE THE NEEDED UNITS TO STORES THAT STILL HAS    *RCKCS233
270100*          UNITS OTR UNTIL OUT OF UNITS                          *RCKCS233
270200*                                                                *RCKCS233
270300*                                                                *RCKCS233
270400         IF PV-PACKS-TO-ALLOC > PV-OTR-SUB                        RCKCS233
270500             PERFORM 2520-ALLOC-PACKS-PER-OTR                     RCKCS233
270600         END-IF                                                   RCKCS233
270700                                                                  RCKCS233
270800         IF PV-PACKS-TO-ALLOC > 0                                 RCKCS233
270900             PERFORM 2530-ALLOC-PACK-PER-ZERO-ALLOC               RCKCS233
271000         END-IF                                                   RCKCS233
271100                                                                  RCKCS233
271200         IF PV-PACKS-TO-ALLOC > 0                                 RCKCS233
271300             PERFORM 2510-ALLOC-ONE-PACK                          RCKCS233
271400         END-IF                                                   RCKCS233
271500                                                                  RCKCS233
271600         IF PV-PACKS-TO-ALLOC > 0                                 RCKCS233
271700             PERFORM 2540-ALLOC-UNIT-PER-ZERO-ALLOC               RCKCS233
271800         END-IF                                                   RCKCS233
271900                                                                  RCKCS233
272000         SET PS-UNITS-PROCESSED TO TRUE                           RCKCS233
272100                                                                  RCKCS233
272200         PERFORM 2550-ALLOC-UNITS                                 RCKCS233
272300           UNTIL PV-LEFT-TO-ALLOC NOT > 0                         RCKCS233
272400              OR PS-NO-UNITS-PROCESSED                            RCKCS233
272500*                                                                *RCKCS233
272600*                                                                *RCKCS233
272700*-----------------------------------------------------------------RCKCS233
272800*    IF THE UNITS RECEIVED >= UNITS OPEN TO RECEIVE (OTR)        *RCKCS233
272900*       ALLOCATE ALL UNITS NEEDED TO THE STORES WITH OTR         *RCKCS233
273000*       IF PACKS LEFTOVER > NO OF STORES PLANNED TO RECEIVE      *RCKCS233
273100*          ALLOCATE PACKS ACCORDING TO ITS PERCENT OF PLAN       *RCKCS233
273200*       IF THERE ARE STILL PACKS TO ALLOCATE                     *RCKCS233
273300*          ALLOCATE 1 PACK TO STORES THAT HAS NOT RECEIVED MORE  *RCKCS233
273400*          THAN WHAT WAS PLANNED TO RECEIVE                      *RCKCS233
273500*       IF THERE ARE STILL PACKS TO ALLOCATE                     *RCKCS233
273600*          ALLOCATE 1 PACK TO STORES UNTIL OUT OF PACKS          *RCKCS233
273700*       IF THERE ARE STILL UNITS TO ALLOCATE                     *RCKCS233
273800*          ALLOCATE THE LEFTOVER UNITS TO THE NEXT STORE         *RCKCS233
273900*                                                                *RCKCS233
274000*                                                                *RCKCS233
274100     ELSE                                                         RCKCS233
274200         PERFORM 2560-ALLOC-ALL-STRS                              RCKCS233
274300           UNTIL PV-SUB-1 > PV-STR-SUB                            RCKCS233
274400                                                                  RCKCS233
274500         DIVIDE RECITM-INNR-PACK-QTY                              RCKCS233
274600           INTO PV-LEFT-TO-ALLOC                                  RCKCS233
274700                GIVING PV-PACKS-TO-ALLOC                          RCKCS233
274800                REMAINDER PV-UNITS-TO-ALLOC                       RCKCS233
274900                                                                  RCKCS233
275000         IF PV-PACKS-TO-ALLOC > PV-STR-SUB                        RCKCS233
275100             PERFORM 2570-ALLOC-PACKS-PER-PLAN                    RCKCS233
275200         END-IF                                                   RCKCS233
275300                                                                  RCKCS233
275400         IF PV-PACKS-TO-ALLOC > 0                                 RCKCS233
275500             PERFORM 2580-ALLOC-PACK-PER-ZERO-ALLOC               RCKCS233
275600         END-IF                                                   RCKCS233
275700                                                                  RCKCS233
275800         IF PV-PACKS-TO-ALLOC > 0 OR PV-UNITS-TO-ALLOC > 0        RCKCS233
275900             PERFORM 2590-ALLOC-LEFTOVERS                         RCKCS233
276000         END-IF                                                   RCKCS233
276100     END-IF.                                                      RCKCS233
276200                                                                  RCKCS233
276300 2501-ALLOC-ONE-UNIT.                                             RCKCS233
276400******************************************************************RCKCS233
276500*    THIS PARAGRAPH CALLS PARAGRAPH 2501 WHICH ALLOCATES 1 UNIT   RCKCS233
276600*    TO EACH STORE UNTIL NO MORE UNITS OR NO MORE STORES          RCKCS233
276700******************************************************************RCKCS233
276800                                                                  RCKCS233
276900     MOVE 1 TO PV-SUB-1.                                          RCKCS233
277000                                                                  RCKCS233
277100     PERFORM 2501-PRORATE-ONE-UNIT                                RCKCS233
277200       UNTIL PV-SUB-1 > PV-STR-SUB                                RCKCS233
277300          OR PV-LEFT-TO-ALLOC NOT > 0.                            RCKCS233
277400                                                                  RCKCS233
277500                                                                  RCKCS233
277600 2501-PRORATE-ONE-UNIT.                                           RCKCS233
277700******************************************************************RCKCS233
277800*    THIS PARAGRAPH ALLOCATES 1 UNIT IF THE STORE STILL HAS UNITS RCKCS233
277900*    OPEN TO RECEIVE.                                             RCKCS233
278000******************************************************************RCKCS233
278100                                                                  RCKCS233
278200     IF PT-STR-OTR-TOTALS  (PV-SUB-1)  >                          RCKCS233
278300        PT-STR-ALLOC-TOTALS(PV-SUB-1)                             RCKCS233
278400                                                                  RCKCS233
278500         ADD 1 TO PT-STR-ALLOC-TOTALS(PV-SUB-1)                   RCKCS233
278600         SUBTRACT 1 FROM PV-LEFT-TO-ALLOC                         RCKCS233
278700     END-IF.                                                      RCKCS233
278800                                                                  RCKCS233
278900     ADD 1 TO PV-SUB-1.                                           RCKCS233
279000                                                                  RCKCS233
279100                                                                  RCKCS233
279200 2510-ALLOC-ONE-PACK.                                             RCKCS233
279300******************************************************************RCKCS233
279400*    THIS PARAGRAPH CALLS PARAGRAPH 2511 WHICH ALLOCATES 1 PACK   RCKCS233
279500*    TO EACH STORE UNTIL NO MORE PACKS OR NO MORE STORES          RCKCS233
279600******************************************************************RCKCS233
279700                                                                  RCKCS233
279800     MOVE 1 TO PV-SUB-1.                                          RCKCS233
279900                                                                  RCKCS233
280000     PERFORM 2511-PRORATE-ONE-PACK                                RCKCS233
280100       UNTIL PV-SUB-1 > PV-STR-SUB                                RCKCS233
280200          OR PV-PACKS-TO-ALLOC NOT > 0.                           RCKCS233
280300                                                                  RCKCS233
280400                                                                  RCKCS233
280500 2511-PRORATE-ONE-PACK.                                           RCKCS233
280600******************************************************************RCKCS233
280700*    THIS PARAGRAPH ALLOCATES 1 PACK IF THE STORE STILL HAS PACKS RCKCS233
280800*    OPEN TO RECEIVE.                                             RCKCS233
280900******************************************************************RCKCS233
281000                                                                  RCKCS233
281100     IF PT-STR-OTR-PACKS   (PV-SUB-1)  >                          RCKCS233
281200        PT-STR-ALLOC-PACKS (PV-SUB-1)                             RCKCS233
281300                                                                  RCKCS233
281400         ADD 1                    TO PT-STR-ALLOC-PACKS (PV-SUB-1)RCKCS233
281500         ADD RECITM-INNR-PACK-QTY TO PT-STR-ALLOC-TOTALS(PV-SUB-1)RCKCS233
281600                                                                  RCKCS233
281700         SUBTRACT 1                    FROM PV-PACKS-TO-ALLOC     RCKCS233
281800         SUBTRACT RECITM-INNR-PACK-QTY FROM PV-LEFT-TO-ALLOC      RCKCS233
281900                                                                  RCKCS233
282000     END-IF.                                                      RCKCS233
282100                                                                  RCKCS233
282200     ADD 1 TO PV-SUB-1.                                           RCKCS233
282300                                                                  RCKCS233
282400                                                                  RCKCS233
282500 2520-ALLOC-PACKS-PER-OTR.                                        RCKCS233
282600******************************************************************RCKCS233
282700*    THIS PARAGRAPH CALLS THE FOLLOWING PARAGRAPH:                RCKCS233
282800*    - 2521 CALCULATES EACH STORE PERCENTAGE FROM THE TOTAL OTR   RCKCS233
282900*    - 2522 ALLOCATES PACKS ACCORDING TO EACH STORES CALCULATED   RCKCS233
283000*           PERCENTAGE OF TOTAL OTR                               RCKCS233
283100******************************************************************RCKCS233
283200                                                                  RCKCS233
283300     MOVE 1 TO PV-SUB-1.                                          RCKCS233
283400                                                                  RCKCS233
283500     PERFORM 2521-CALC-OTR-STR-PCT                                RCKCS233
283600       UNTIL PV-SUB-1 > PV-STR-SUB.                               RCKCS233
283700                                                                  RCKCS233
283800     MOVE 1 TO PV-SUB-1.                                          RCKCS233
283900     MOVE 0 TO PV-ALLOCATED-PACKS.                                RCKCS233
284000                                                                  RCKCS233
284100     PERFORM 2522-PRORATE-PER-PCT                                 RCKCS233
284200       UNTIL PV-SUB-1 > PV-STR-SUB.                               RCKCS233
284300                                                                  RCKCS233
284400     SUBTRACT PV-ALLOCATED-PACKS FROM PV-PACKS-TO-ALLOC.          RCKCS233
284500                                                                  RCKCS233
284600                                                                  RCKCS233
284700 2521-CALC-OTR-STR-PCT.                                           RCKCS233
284800******************************************************************RCKCS233
284900*    THIS PARAGRAPH CALCULATES THE STORE'S PERCENTAGE FROM THE    RCKCS233
285000*    TOTAL OTR.                                                   RCKCS233
285100******************************************************************RCKCS233
285200                                                                  RCKCS233
285300     COMPUTE PT-STR-ALLOC-PCT (PV-SUB-1) =                        RCKCS233
285400             PT-STR-OTR-TOTALS(PV-SUB-1) /                        RCKCS233
285500             PV-SUM-STR-OTR-UNITS.                                RCKCS233
285600                                                                  RCKCS233
285700     ADD 1 TO PV-SUB-1.                                           RCKCS233
285800                                                                  RCKCS233
285900                                                                  RCKCS233
286000 2522-PRORATE-PER-PCT.                                            RCKCS233
286100******************************************************************RCKCS233
286200*    THIS PARAGRAPH ALLOCATES THE PACKS ACCORDING TO ITS PERCENT  RCKCS233
286300*    FROM TOTAL OTR, ROUNDED DOWN.                                RCKCS233
286400******************************************************************RCKCS233
286500                                                                  RCKCS233
286600     IF PT-STR-OTR-PACKS (PV-SUB-1) >                             RCKCS233
286700         PT-STR-ALLOC-PACKS (PV-SUB-1)                            RCKCS233
286800         COMPUTE PV-PACKS-FOR-STORE =                             RCKCS233
286900                 PT-STR-ALLOC-PCT (PV-SUB-1) *                    RCKCS233
287000                 PV-PACKS-TO-ALLOC                                RCKCS233
287100                                                                  RCKCS233
287200         COMPUTE PV-UNITS-FOR-STORE =                             RCKCS233
287300                 PV-PACKS-FOR-STORE *                             RCKCS233
287400                 RECITM-INNR-PACK-QTY                             RCKCS233
287500                                                                  RCKCS233
287600         ADD PV-PACKS-FOR-STORE TO PV-ALLOCATED-PACKS             RCKCS233
287700         ADD PV-PACKS-FOR-STORE TO PT-STR-ALLOC-PACKS (PV-SUB-1)  RCKCS233
287800         ADD PV-UNITS-FOR-STORE TO PT-STR-ALLOC-TOTALS(PV-SUB-1)  RCKCS233
287900                                                                  RCKCS233
288000         SUBTRACT PV-UNITS-FOR-STORE FROM PV-LEFT-TO-ALLOC        RCKCS233
288100     END-IF.                                                      RCKCS233
288200                                                                  RCKCS233
288300     ADD 1 TO PV-SUB-1.                                           RCKCS233
288400                                                                  RCKCS233
288500                                                                  RCKCS233
288600 2530-ALLOC-PACK-PER-ZERO-ALLOC.                                  RCKCS233
288700******************************************************************RCKCS233
288800*    THIS PARAGRAPH CALLS PARAGRAPH 2531 WHICH ALLOCATES 1 PACK   RCKCS233
288900*    TO EACH STORE THAT HAS PACKS OPEN TO RECEIVE AND HAS NOT     RCKCS233
289000*    RECEIVED ANY PACKS YET.                                      RCKCS233
289100******************************************************************RCKCS233
289200                                                                  RCKCS233
289300     MOVE 1 TO PV-SUB-1.                                          RCKCS233
289400                                                                  RCKCS233
289500     PERFORM 2531-PRORATE-ONE-PACK                                RCKCS233
289600       UNTIL PV-SUB-1 > PV-STR-SUB                                RCKCS233
289700          OR PV-PACKS-TO-ALLOC NOT > 0.                           RCKCS233
289800                                                                  RCKCS233
289900                                                                  RCKCS233
290000 2531-PRORATE-ONE-PACK.                                           RCKCS233
290100******************************************************************RCKCS233
290200*    THIS PARAGRAPH ALLOCATES 1 PACK TO EACH STORE THAT HAS       RCKCS233
290300*    PACKS OPEN TO RECEIVE AND HAS NOT RECEIVED ANY PACKS YET.    RCKCS233
290400******************************************************************RCKCS233
290500                                                                  RCKCS233
290600     IF (PT-STR-OTR-PACKS   (PV-SUB-1)     > 0) AND               RCKCS233
290700        (PT-STR-ALLOC-PACKS (PV-SUB-1) NOT > 0)                   RCKCS233
290800                                                                  RCKCS233
290900         ADD 1                    TO PT-STR-ALLOC-PACKS (PV-SUB-1)RCKCS233
291000         ADD RECITM-INNR-PACK-QTY TO PT-STR-ALLOC-TOTALS(PV-SUB-1)RCKCS233
291100                                                                  RCKCS233
291200         SUBTRACT 1                    FROM PV-PACKS-TO-ALLOC     RCKCS233
291300         SUBTRACT RECITM-INNR-PACK-QTY FROM PV-LEFT-TO-ALLOC      RCKCS233
291400     END-IF.                                                      RCKCS233
291500                                                                  RCKCS233
291600     ADD 1 TO PV-SUB-1.                                           RCKCS233
291700                                                                  RCKCS233
291800                                                                  RCKCS233
291900 2540-ALLOC-UNIT-PER-ZERO-ALLOC.                                  RCKCS233
292000******************************************************************RCKCS233
292100*    THIS PARAGRAPH CALLS PARAGRAPH 2541 WHICH ALLOCATES THE      RCKCS233
292200*    NEEDED UNITS TO THE STORES WITH OTR BUT HAS NOT RECEIVED     RCKCS233
292300*    ANY UNITS YET.                                               RCKCS233
292400******************************************************************RCKCS233
292500                                                                  RCKCS233
292600     MOVE 1 TO PV-SUB-1.                                          RCKCS233
292700                                                                  RCKCS233
292800     PERFORM 2541-PRORATE-UNITS                                   RCKCS233
292900       UNTIL PV-SUB-1 > PV-STR-SUB                                RCKCS233
293000          OR PV-LEFT-TO-ALLOC NOT > 0.                            RCKCS233
293100                                                                  RCKCS233
293200                                                                  RCKCS233
293300 2541-PRORATE-UNITS.                                              RCKCS233
293400******************************************************************RCKCS233
293500*    THIS PARAGRAPH ALLOCATES THE NEEDED UNITS TO THE STORES WITH RCKCS233
293600*    OTR BUT HAS NOT RECEIVED ANY UNITS YET.                      RCKCS233
293700******************************************************************RCKCS233
293800                                                                  RCKCS233
293900     IF (PT-STR-ALLOC-TOTALS(PV-SUB-1) NOT > 0) AND               RCKCS233
294000        (PT-STR-OTR-TOTALS  (PV-SUB-1)     > 0)                   RCKCS233
294100                                                                  RCKCS233
294200         IF PV-LEFT-TO-ALLOC > PT-STR-OTR-TOTALS(PV-SUB-1)        RCKCS233
294300             ADD PT-STR-OTR-TOTALS(PV-SUB-1)                      RCKCS233
294400              TO PT-STR-ALLOC-UNITS (PV-SUB-1)                    RCKCS233
294500                                                                  RCKCS233
294600             ADD PT-STR-OTR-TOTALS(PV-SUB-1)                      RCKCS233
294700              TO PT-STR-ALLOC-TOTALS(PV-SUB-1)                    RCKCS233
294800                                                                  RCKCS233
294900             SUBTRACT PT-STR-OTR-TOTALS(PV-SUB-1)                 RCKCS233
295000                 FROM PV-LEFT-TO-ALLOC                            RCKCS233
295100         ELSE                                                     RCKCS233
295200             ADD PV-LEFT-TO-ALLOC                                 RCKCS233
295300              TO PT-STR-ALLOC-UNITS (PV-SUB-1)                    RCKCS233
295400                                                                  RCKCS233
295500             ADD PV-LEFT-TO-ALLOC                                 RCKCS233
295600              TO PT-STR-ALLOC-TOTALS(PV-SUB-1)                    RCKCS233
295700                                                                  RCKCS233
295800             MOVE 0 TO PV-LEFT-TO-ALLOC                           RCKCS233
295900         END-IF                                                   RCKCS233
296000     END-IF.                                                      RCKCS233
296100                                                                  RCKCS233
296200     ADD 1 TO PV-SUB-1.                                           RCKCS233
296300                                                                  RCKCS233
296400                                                                  RCKCS233
296500 2550-ALLOC-UNITS.                                                RCKCS233
296600******************************************************************RCKCS233
296700*    THIS PARAGRAPH CALLS PARAGRAPH 2551 WHICH ALLOCATES THE      RCKCS233
296800*    NEEDED UNITS TO THE STORES THAT STILL HAS OTR.               RCKCS233
296900******************************************************************RCKCS233
297000                                                                  RCKCS233
297100     SET PS-NO-UNITS-PROCESSED TO TRUE.                           RCKCS233
297200                                                                  RCKCS233
297300     IF PV-SUB-1 > PV-STR-SUB                                     RCKCS233
297400         MOVE 1 TO PV-SUB-1                                       RCKCS233
297500     END-IF.                                                      RCKCS233
297600                                                                  RCKCS233
297700     PERFORM 2551-PRORATE-UNITS                                   RCKCS233
297800       UNTIL PV-SUB-1 > PV-STR-SUB                                RCKCS233
297900          OR PV-LEFT-TO-ALLOC NOT > 0.                            RCKCS233
298000                                                                  RCKCS233
298100                                                                  RCKCS233
298200 2551-PRORATE-UNITS.                                              RCKCS233
298300******************************************************************RCKCS233
298400*    THIS PARAGRAPH ALLOCATES THE NEEDED UNITS TO THE STORES THAT RCKCS233
298500*    STILL HAS OTR.                                               RCKCS233
298600******************************************************************RCKCS233
298700                                                                  RCKCS233
298800     IF PT-STR-OTR-TOTALS   (PV-SUB-1) >                          RCKCS233
298900        PT-STR-ALLOC-TOTALS (PV-SUB-1)                            RCKCS233
299000                                                                  RCKCS233
299100         SET PS-UNITS-PROCESSED TO TRUE                           RCKCS233
299200                                                                  RCKCS233
299300         IF PV-LEFT-TO-ALLOC >                                    RCKCS233
299400            (PT-STR-OTR-TOTALS (PV-SUB-1) -                       RCKCS233
299500             PT-STR-ALLOC-TOTALS (PV-SUB-1))                      RCKCS233
299600                                                                  RCKCS233
299700             COMPUTE PV-LEFT-TO-ALLOC =                           RCKCS233
299800                     PV-LEFT-TO-ALLOC -                           RCKCS233
299900                     (PT-STR-OTR-TOTALS (PV-SUB-1) -              RCKCS233
300000                      PT-STR-ALLOC-TOTALS (PV-SUB-1))             RCKCS233
300100                                                                  RCKCS233
300200             MOVE PT-STR-OTR-TOTALS   (PV-SUB-1)                  RCKCS233
300300               TO PT-STR-ALLOC-TOTALS (PV-SUB-1)                  RCKCS233
300400         ELSE                                                     RCKCS233
300500             ADD PV-LEFT-TO-ALLOC                                 RCKCS233
300600              TO PT-STR-ALLOC-TOTALS(PV-SUB-1)                    RCKCS233
300700                                                                  RCKCS233
300800             MOVE 0 TO PV-LEFT-TO-ALLOC                           RCKCS233
300900         END-IF                                                   RCKCS233
301000     END-IF.                                                      RCKCS233
301100                                                                  RCKCS233
301200     ADD 1 TO PV-SUB-1.                                           RCKCS233
301300                                                                  RCKCS233
301400                                                                  RCKCS233
301500 2560-ALLOC-ALL-STRS.                                             RCKCS233
301600******************************************************************RCKCS233
301700*    THIS PARAGRAPH ALLOCATES THE STORES OTR UNITS.               RCKCS233
301800******************************************************************RCKCS233
301900                                                                  RCKCS233
302000     IF PT-STR-OTR-PACKS (PV-SUB-1) > 0                           RCKCS233
302100         COMPUTE PV-LEFT-TO-ALLOC =                               RCKCS233
302200                 PV-LEFT-TO-ALLOC -                               RCKCS233
302300                 (PT-STR-OTR-PACKS (PV-SUB-1) *                   RCKCS233
302400                  RECITM-INNR-PACK-QTY)                           RCKCS233
302500                                                                  RCKCS233
302600         ADD PT-STR-OTR-PACKS (PV-SUB-1)                          RCKCS233
302700          TO PT-STR-ALLOC-PACKS (PV-SUB-1)                        RCKCS233
302800                                                                  RCKCS233
302900         COMPUTE PT-STR-ALLOC-TOTALS (PV-SUB-1) =                 RCKCS233
303000                 PT-STR-ALLOC-TOTALS (PV-SUB-1) +                 RCKCS233
303100                 (PT-STR-OTR-PACKS (PV-SUB-1) *                   RCKCS233
303200                  RECITM-INNR-PACK-QTY)                           RCKCS233
303300     END-IF.                                                      RCKCS233
303400                                                                  RCKCS233
303500     IF PT-STR-OTR-UNITS (PV-SUB-1) > 0                           RCKCS233
303600         SUBTRACT PT-STR-OTR-UNITS (PV-SUB-1)                     RCKCS233
303700             FROM PV-LEFT-TO-ALLOC                                RCKCS233
303800                                                                  RCKCS233
303900         ADD PT-STR-OTR-UNITS (PV-SUB-1)                          RCKCS233
304000          TO PT-STR-ALLOC-UNITS (PV-SUB-1)                        RCKCS233
304100                                                                  RCKCS233
304200         ADD PT-STR-OTR-UNITS (PV-SUB-1)                          RCKCS233
304300          TO PT-STR-ALLOC-TOTALS (PV-SUB-1)                       RCKCS233
304400     END-IF.                                                      RCKCS233
304500                                                                  RCKCS233
304600     ADD 1 TO PV-SUB-1.                                           RCKCS233
304700                                                                  RCKCS233
304800                                                                  RCKCS233
304900 2570-ALLOC-PACKS-PER-PLAN.                                       RCKCS233
305000******************************************************************RCKCS233
305100*    THIS PARAGRAPH CALLS THE FOLLOWING PARAGRAPH:                RCKCS233
305200*    - 2571 CALCULATES EACH STORE PERCENTAGE FROM THE TOTAL PLAN  RCKCS233
305300*    - 2572 ALLOCATES PACKS ACCORDING TO EACH STORES CALCULATED   RCKCS233
305400*           PERCENTAGE OF TOTAL PLAN                              RCKCS233
305500******************************************************************RCKCS233
305600                                                                  RCKCS233
305700     MOVE 1 TO PV-SUB-1.                                          RCKCS233
305800                                                                  RCKCS233
305900     PERFORM 2571-CALC-ALL-STR-PCT                                RCKCS233
306000       UNTIL PV-SUB-1 > PV-STR-SUB.                               RCKCS233
306100                                                                  RCKCS233
306200     MOVE 0 TO PV-ALLOCATED-PACKS.                                RCKCS233
306300     MOVE 1 TO PV-SUB-1.                                          RCKCS233
306400                                                                  RCKCS233
306500     PERFORM 2572-PRORATE-PER-PCT                                 RCKCS233
306600       UNTIL PV-SUB-1 > PV-STR-SUB.                               RCKCS233
306700                                                                  RCKCS233
306800     SUBTRACT PV-ALLOCATED-PACKS FROM PV-PACKS-TO-ALLOC.          RCKCS233
306900                                                                  RCKCS233
307000                                                                  RCKCS233
307100 2571-CALC-ALL-STR-PCT.                                           RCKCS233
307200******************************************************************RCKCS233
307300*    THIS PARAGRAPH CALCULATES THE STORE'S PERCENTAGE FROM THE    RCKCS233
307400*    TOTAL PLAN.                                                  RCKCS233
307500******************************************************************RCKCS233
307600                                                                  RCKCS233
307700     COMPUTE PT-STR-ALLOC-PCT (PV-SUB-1) =                        RCKCS233
307800             PT-STR-PLAN-QTY  (PV-SUB-1) /                        RCKCS233
307900             PV-SUM-STR-PLAN-QTY                                  RCKCS233
308000                                                                  RCKCS233
308100     ADD 1 TO PV-SUB-1.                                           RCKCS233
308200                                                                  RCKCS233
308300                                                                  RCKCS233
308400 2572-PRORATE-PER-PCT.                                            RCKCS233
308500******************************************************************RCKCS233
308600*    THIS PARAGRAPH ALLOCATES THE PACKS ACCORDING TO ITS PERCENT  RCKCS233
308700*    FROM TOTAL PLAN, ROUNDED DOWN.                               RCKCS233
308800******************************************************************RCKCS233
308900                                                                  RCKCS233
309000     COMPUTE PV-PACKS-FOR-STORE =                                 RCKCS233
309100             PT-STR-ALLOC-PCT (PV-SUB-1) *                        RCKCS233
309200             PV-PACKS-TO-ALLOC.                                   RCKCS233
309300                                                                  RCKCS233
309400     COMPUTE PV-UNITS-FOR-STORE =                                 RCKCS233
309500             PV-PACKS-FOR-STORE *                                 RCKCS233
309600             RECITM-INNR-PACK-QTY.                                RCKCS233
309700                                                                  RCKCS233
309800     ADD PV-PACKS-FOR-STORE TO PV-ALLOCATED-PACKS.                RCKCS233
309900     ADD PV-PACKS-FOR-STORE TO PT-STR-ALLOC-PACKS (PV-SUB-1).     RCKCS233
310000     ADD PV-UNITS-FOR-STORE TO PT-STR-ALLOC-TOTALS(PV-SUB-1).     RCKCS233
310100                                                                  RCKCS233
310200     SUBTRACT PV-UNITS-FOR-STORE FROM PV-LEFT-TO-ALLOC.           RCKCS233
310300                                                                  RCKCS233
310400     ADD 1 TO PV-SUB-1.                                           RCKCS233
310500                                                                  RCKCS233
310600                                                                  RCKCS233
310700 2580-ALLOC-PACK-PER-ZERO-ALLOC.                                  RCKCS233
310800******************************************************************RCKCS233
310900*    THIS PARAGRAPH CALLS PARAGRAPH 2581 WHICH ALLOCATES 1 PACK   RCKCS233
311000*    TO EACH STORE THAT HAS NOT RECEIVED OVER IT'S PLANNED UNITS. RCKCS233
311100******************************************************************RCKCS233
311200                                                                  RCKCS233
311300     MOVE 1 TO PV-SUB-1.                                          RCKCS233
311400                                                                  RCKCS233
311500     PERFORM 2581-PRORATE-ONE-PACK                                RCKCS233
311600       UNTIL PV-SUB-1 > PV-STR-SUB                                RCKCS233
311700          OR PV-PACKS-TO-ALLOC NOT > 0.                           RCKCS233
311800                                                                  RCKCS233
311900                                                                  RCKCS233
312000 2581-PRORATE-ONE-PACK.                                           RCKCS233
312100******************************************************************RCKCS233
312200*    THIS PARAGRAPH ALLOCATES 1 PACK TO EACH STORE THAT HAS NOT   RCKCS233
312300*    RECEIVED OVER IT'S PLANNED UNITS.                            RCKCS233
312400******************************************************************RCKCS233
312500                                                                  RCKCS233
312600     IF PT-STR-ALLOC-PACKS (PV-SUB-1) NOT >                       RCKCS233
312700        PT-STR-OTR-PACKS (PV-SUB-1)                               RCKCS233
312800                                                                  RCKCS233
312900         ADD 1                    TO PT-STR-ALLOC-PACKS (PV-SUB-1)RCKCS233
313000         ADD RECITM-INNR-PACK-QTY TO PT-STR-ALLOC-TOTALS(PV-SUB-1)RCKCS233
313100                                                                  RCKCS233
313200         SUBTRACT 1                    FROM PV-PACKS-TO-ALLOC     RCKCS233
313300         SUBTRACT RECITM-INNR-PACK-QTY FROM PV-LEFT-TO-ALLOC      RCKCS233
313400     END-IF.                                                      RCKCS233
313500                                                                  RCKCS233
313600     ADD 1 TO PV-SUB-1.                                           RCKCS233
313700                                                                  RCKCS233
313800                                                                  RCKCS233
313900 2590-ALLOC-LEFTOVERS.                                            RCKCS233
314000******************************************************************RCKCS233
314100*    THIS PARAGRAPH CALLS PARAGRAPH 2591 WHICH ALLOCATES 1 PACK   RCKCS233
314200*    TO EACH STORE UNTIL OUT OF PACKS.  THEN IT ALLOCATES THE     RCKCS233
314300*    UNITS LEFTOVER TO THE NEXT STORE AVAILABLE.                  RCKCS233
314400******************************************************************RCKCS233
314500                                                                  RCKCS233
314600     IF PV-SUB-1 > PV-STR-SUB                                     RCKCS233
314700         MOVE 1 TO PV-SUB-1                                       RCKCS233
314800     END-IF.                                                      RCKCS233
314900                                                                  RCKCS233
315000     PERFORM 2591-PRORATE-ONE-PACK                                RCKCS233
315100       UNTIL PV-SUB-1 > PV-STR-SUB                                RCKCS233
315200          OR PV-PACKS-TO-ALLOC NOT > 0.                           RCKCS233
315300                                                                  RCKCS233
315400     IF PV-UNITS-TO-ALLOC > 0                                     RCKCS233
315500         IF PV-SUB-1 > PV-STR-SUB                                 RCKCS233
315600            ADD PV-UNITS-TO-ALLOC TO PT-STR-ALLOC-UNITS (1)       RCKCS233
315700            ADD PV-UNITS-TO-ALLOC TO PT-STR-ALLOC-TOTALS(1)       RCKCS233
315800         ELSE                                                     RCKCS233
315900            ADD PV-UNITS-TO-ALLOC TO PT-STR-ALLOC-UNITS (PV-SUB-1)RCKCS233
316000            ADD PV-UNITS-TO-ALLOC TO PT-STR-ALLOC-TOTALS(PV-SUB-1)RCKCS233
316100         END-IF                                                   RCKCS233
316200     END-IF.                                                      RCKCS233
316300                                                                  RCKCS233
316400                                                                  RCKCS233
316500 2591-PRORATE-ONE-PACK.                                           RCKCS233
316600******************************************************************RCKCS233
316700*    THIS PARAGRAPH ALLOCATES 1 PACK TO EACH STORE.               RCKCS233
316800******************************************************************RCKCS233
316900                                                                  RCKCS233
317000     ADD 1                    TO PT-STR-ALLOC-PACKS (PV-SUB-1).   RCKCS233
317100     ADD RECITM-INNR-PACK-QTY TO PT-STR-ALLOC-TOTALS(PV-SUB-1).   RCKCS233
317200                                                                  RCKCS233
317300     SUBTRACT 1                    FROM PV-PACKS-TO-ALLOC.        RCKCS233
317400     SUBTRACT RECITM-INNR-PACK-QTY FROM PV-LEFT-TO-ALLOC.         RCKCS233
317500                                                                  RCKCS233
317600     ADD 1 TO PV-SUB-1.                                           RCKCS233
323900/                                                                 RCKCS233
324000 2700-ALLOCATE-STORES.                                            RCKCS233
324100******************************************************************RCKCS233
324200*    THIS PARAGRAPH CALLS THE FOLLOWING PARAGRAPH:                RCKCS233
324300*    - 2710 PREPARES TO ADD A RECDIS RECORD                       RCKCS233
324400*    - 2720 ADDS A RECDIS RECORD                                  RCKCS233
324500******************************************************************RCKCS233
324600                                                                  RCKCS233
324700     PERFORM 2710-PREPARE-TRECDIS.                                RCKCS233
324800                                                                  RCKCS233
324900     IF PS-NOT-DONE                                               RCKCS233
325000         PERFORM 2720-INSERT-TRECDIS                              RCKCS233
325100     END-IF.                                                      RCKCS233
325200                                                                  RCKCS233
325300     ADD 1 TO PV-SUB-1.                                           RCKCS233
325400                                                                  RCKCS233
325500                                                                  RCKCS233
325600 2710-PREPARE-TRECDIS.                                            RCKCS233
325700******************************************************************RCKCS233
325800*    THIS PARAGRAPH PREPARES TO ADD A RECDIS RECORD.              RCKCS233
325900*    IT CALLS THE FOLLOWING PARAGRAPH:                            RCKCS233
326000*    - 2711 RETRIEVES THE PACK-BY-STORE INDICATOR IN TRECEIV TABLERCKCS233
326100*    - 2712 RETRIEVES THE PACK SLIP NUMBER                        RCKCS233
326200*    - 2713 RETRIEVES THE FIRST PACK SLIP NUMBER                  RCKCS233
326300******************************************************************RCKCS233
326400                                                                  RCKCS233
326500     MOVE TM500-PO-NBR                  TO RECDIS-ORD-NBR.        RCKCS233
326600     MOVE TM500-PO-LNE-NBR              TO RECDIS-ORD-LNE-NBR.    RCKCS233
326700     MOVE TM500-REC-SEQ-NBR             TO RECDIS-REC-SEQ-NBR.    RCKCS233
326800     MOVE TM500-OPER-UNT-ID             TO RECDIS-OPER-UNT-ID.    RCKCS233
326900     MOVE TM500-NOTIF-UID               TO RECDIS-CRE-UID.        RCKCS233
327000     MOVE PC-A                          TO RECDIS-VER-STATUS-CDE. RCKCS233
327100     MOVE PT-STR-ALLOC-TOTALS(PV-SUB-1) TO RECDIS-EXPTED-ITM-QTY  RCKCS233
327200                                           RECDIS-VERIFY-ITM-QTY.         
327300     MOVE PT-STR-NBR (PV-SUB-1)         TO RECDIS-STR-NBR.        RCKCS233
327400     MOVE PT-STR-OTR-TOTALS(PV-SUB-1)   TO RECDIS-PLAN-ITM-QTY.   RCKCS233
327500                                                                  RCKCS233
327600     MOVE 1 TO RECDIS-FCLTY-ID.                                   RCKCS233
327700     MOVE 1 TO RECDIS-STR-FCLTY-ID.                               RCKCS233
327800     MOVE 0 TO RECDIS-AP-VERIFY-ITM-QTY.                          RCKCS233
327900                                                                  RCKCS233
329100                                                                  RCKCS233
329800** 8/8/94  --> A/P PRC CODE/DATE <--                              RCKCS233
329900     MOVE SPACES           TO  RECDIS-AP-PRC-CDE.                 RCKCS233
330000     MOVE PC-DEFAULT-DATE  TO  RECDIS-AP-PRC-DTE.                 RCKCS233
330100*                                                                 RCKCS233
330200                                                                  RCKCS233
330300 2711-GET-PACK-BY-ST-IND.                                         RCKCS233
330400******************************************************************RCKCS233
330500*    THIS PARAGRAPH RETRIEVES THE PACK BY STORE INDICATOR         RCKCS233
330600******************************************************************RCKCS233
330700                                                                  RCKCS233
330800     PERFORM WITH TEST AFTER                                      RCKCS233
330900         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
331000         UNTIL   SQLCODE = +0 OR                                  RCKCS233
331100                 PS-DONE OR                                       RCKCS233
331200                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
331300                                                                  RCKCS233
331400         EXEC SQL                                                 RCKCS233
331500              SELECT PACK_BY_ST_IND                               RCKCS233
331600                INTO :RECEIV-PACK-BY-ST-IND                       RCKCS233
331700                FROM TRECEIV                                      RCKCS233
331800               WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID          RCKCS233
331900                 AND FCLTY_ID       = :TM500-FCLTY-ID             RCKCS233
332000                 AND ORD_NBR        = :TM500-PO-NBR               RCKCS233
332100                 AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR          RCKCS233
332200                 AND VER_STATUS_CDE = :PC-A                       RCKCS233
332300         END-EXEC                                                 RCKCS233
332400                                                                  RCKCS233
332500         EVALUATE TRUE                                            RCKCS233
332600             WHEN SQLCODE = +0                                    RCKCS233
332700                  CONTINUE                                        RCKCS233
332800                                                                  RCKCS233
332900             WHEN SQLCODE = -904                                  RCKCS233
333000             WHEN SQLCODE = -911                                  RCKCS233
333100             WHEN SQLCODE = -913                                  RCKCS233
333200                  CONTINUE                                        RCKCS233
333300                                                                  RCKCS233
333400             WHEN OTHER                                           RCKCS233
333500                  SET  PS-DONE TO TRUE                            RCKCS233
333600                  MOVE PRV-3O  TO TM500-RETURN-DATA               RCKCS233
333700                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
333800                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
333900                                                                  RCKCS233
334000                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
334100                  MOVE '2711'    TO PRV-PARA                      RCKCS233
334200                  MOVE 'TRECEIV' TO PRV-TBL                       RCKCS233
334300                  PERFORM 9999-RETURN-MSG                         RCKCS233
334400         END-EVALUATE                                             RCKCS233
334500     END-PERFORM.                                                 RCKCS233
334600                                                                  RCKCS233
334700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
334800         SET  PS-DONE TO TRUE                                     RCKCS233
334900         MOVE PRV-3O  TO TM500-RETURN-DATA                        RCKCS233
335000         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
335100         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
335200                                                                  RCKCS233
335300         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
335400         MOVE '2711'    TO PRV-PARA                               RCKCS233
335500         MOVE 'TRECEIV' TO PRV-TBL                                RCKCS233
335600         PERFORM 9999-RETURN-MSG                                  RCKCS233
335700     END-IF.                                                      RCKCS233
335800/                                                                 RCKCS233
335900                                                                  RCKCS233
351500 2720-INSERT-TRECDIS.                                             RCKCS233
351600******************************************************************RCKCS233
351700*    THIS PARAGRAPH ADDS A RECDIS RECORD                          RCKCS233
351800******************************************************************RCKCS233
351900                                                                  RCKCS233
352000     PERFORM WITH TEST AFTER                                      RCKCS233
352100         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
352200         UNTIL   SQLCODE = +0 OR                                  RCKCS233
352300                 PS-DONE OR                                       RCKCS233
352400                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
352500                                                                  RCKCS233
352600         EXEC SQL                                                 RCKCS233
352700              INSERT INTO TRECDIS                                 RCKCS233
352800                     (ORD_NBR                                     RCKCS233
352900                   ,  ORD_LNE_NBR                                 RCKCS233
353000                   ,  REC_SEQ_NBR                                 RCKCS233
353100                   ,  OPER_UNT_ID                                 RCKCS233
353200                   ,  FCLTY_ID                                    RCKCS233
353300                   ,  CRE_TMST                                    RCKCS233
353400                   ,  CRE_UID                                     RCKCS233
353500                   ,  VER_STATUS_CDE                              RCKCS233
353600                   ,  EXPTED_ITM_QTY                              RCKCS233
353700                   ,  VERIFY_ITM_QTY                              RCKCS233
353800                   ,  AP_VERIFY_ITM_QTY                           RCKCS233
353900                   ,  STR_NBR                                     RCKCS233
354000                   ,  STR_FCLTY_ID                                RCKCS233
354100                   ,  PLAN_ITM_QTY                                RCKCS233
354300                   ,  AP_PRC_CDE                                  RCKCS233
354400                   ,  AP_PRC_DTE)                                 RCKCS233
354500              VALUES (:RECDIS-ORD-NBR                             RCKCS233
354600                   ,  :RECDIS-ORD-LNE-NBR                         RCKCS233
354700                   ,  :RECDIS-REC-SEQ-NBR                         RCKCS233
354800                   ,  :RECDIS-OPER-UNT-ID                         RCKCS233
354900                   ,  :RECDIS-FCLTY-ID                            RCKCS233
355000                   ,  CURRENT TIMESTAMP                           RCKCS233
355100                   ,  :RECDIS-CRE-UID                             RCKCS233
355200                   ,  :RECDIS-VER-STATUS-CDE                      RCKCS233
355300                   ,  :RECDIS-EXPTED-ITM-QTY                      RCKCS233
355400                   ,  :RECDIS-VERIFY-ITM-QTY                      RCKCS233
355500                   ,  :RECDIS-AP-VERIFY-ITM-QTY                   RCKCS233
355600                   ,  :RECDIS-STR-NBR                             RCKCS233
355700                   ,  :RECDIS-STR-FCLTY-ID                        RCKCS233
355800                   ,  :RECDIS-PLAN-ITM-QTY                        RCKCS233
356000                   ,  :RECDIS-AP-PRC-CDE                          RCKCS233
356100                   ,  :RECDIS-AP-PRC-DTE)                         RCKCS233
356200         END-EXEC                                                 RCKCS233
356300                                                                  RCKCS233
356400         EVALUATE TRUE                                            RCKCS233
356500             WHEN SQLCODE = +0                                    RCKCS233
356600                  CONTINUE                                        RCKCS233
356700                                                                  RCKCS233
356800             WHEN SQLCODE = -904                                  RCKCS233
356900             WHEN SQLCODE = -911                                  RCKCS233
357000             WHEN SQLCODE = -913                                  RCKCS233
357100                  CONTINUE                                        RCKCS233
357200                                                                  RCKCS233
357300             WHEN OTHER                                           RCKCS233
357400                  SET  PS-DONE TO TRUE                            RCKCS233
357500                  MOVE PRV-3T  TO TM500-RETURN-DATA               RCKCS233
357600                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
357700                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
357800                                                                  RCKCS233
357900                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
358000                  MOVE '2720'    TO PRV-PARA                      RCKCS233
358100                  MOVE 'TRECDIS' TO PRV-TBL                       RCKCS233
358200                  PERFORM 9999-RETURN-MSG                         RCKCS233
358300         END-EVALUATE                                             RCKCS233
358400     END-PERFORM.                                                 RCKCS233
358500                                                                  RCKCS233
358600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
358700         SET  PS-DONE TO TRUE                                     RCKCS233
358800         MOVE PRV-3T  TO TM500-RETURN-DATA                        RCKCS233
358900         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
359000         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
359100                                                                  RCKCS233
359200         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
359300         MOVE '2720'    TO PRV-PARA                               RCKCS233
359400         MOVE 'TRECDIS' TO PRV-TBL                                RCKCS233
359500         PERFORM 9999-RETURN-MSG                                  RCKCS233
359600     END-IF.                                                      RCKCS233
359700                                                                  RCKCS233
359800                                                                  RCKCS233
359900*2800-INACTIVATE-ALLPLN.                                          RCKCS233
360000******************************************************************RCKCS233
360100*    THIS PARAGRAPH UPDATES THE STATUS CODE OF THE TALLPLN RECORD RCKCS233
360200*    TO INACTIVATE.                                               RCKCS233
360300******************************************************************RCKCS233
360400                                                                  RCKCS233
360500*    PERFORM WITH TEST AFTER                                      RCKCS233
360600*        VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
360700*        UNTIL   SQLCODE = +0 OR                                  RCKCS233
360800*                PS-DONE OR                                       RCKCS233
360900*                PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
361000                                                                  RCKCS233
361100*        EXEC SQL                                                 RCKCS233
361200*             UPDATE TALLPLN                                      RCKCS233
361300*                SET STATUS_CDE = :PC-IN                          RCKCS233
361400*              WHERE PO_NBR     = :TM500-PO-NBR                   RCKCS233
361500*                AND PO_LNE_NBR = :PURITM-PO-LNE-NBR              RCKCS233
361600*                AND DEST_NBR   = :TM500-OPER-UNT-ID              RCKCS233
361700*                AND STATUS_CDE = :PC-AC                          RCKCS233
361800*        END-EXEC                                                 RCKCS233
361900                                                                  RCKCS233
362000*        EVALUATE TRUE                                            RCKCS233
362100*            WHEN SQLCODE = +0                                    RCKCS233
362200*                 CONTINUE                                        RCKCS233
362300                                                                  RCKCS233
362400*            WHEN SQLCODE = -904                                  RCKCS233
362500*            WHEN SQLCODE = -911                                  RCKCS233
362600*            WHEN SQLCODE = -913                                  RCKCS233
362700*                 CONTINUE                                        RCKCS233
362800                                                                  RCKCS233
362900*            WHEN OTHER                                           RCKCS233
363000*                 SET  PS-DONE TO TRUE                            RCKCS233
363100*                 MOVE PRV-3U  TO TM500-RETURN-DATA               RCKCS233
363200*                 MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
363300*                 MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
363400                                                                  RCKCS233
363500*                 MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
363600*                 MOVE '2800'    TO PRV-PARA                      RCKCS233
363700*                 MOVE 'TALLPLN' TO PRV-TBL                       RCKCS233
363800*                 PERFORM 9999-RETURN-MSG                         RCKCS233
363900*        END-EVALUATE                                             RCKCS233
364000*    END-PERFORM.                                                 RCKCS233
364100                                                                  RCKCS233
364200*    IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
364300*        SET  PS-DONE TO TRUE                                     RCKCS233
364400*        MOVE PRV-3U  TO TM500-RETURN-DATA                        RCKCS233
364500*        MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
364600*        MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
364700                                                                  RCKCS233
364800*        MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
364900*        MOVE '2800'    TO PRV-PARA                               RCKCS233
365000*        MOVE 'TALLPLN' TO PRV-TBL                                RCKCS233
365100*        PERFORM 9999-RETURN-MSG                                  RCKCS233
365200*    END-IF.                                                      RCKCS233
365300                                                                  RCKCS233
365400 2900-DELETE-SPSTDS.                                              RCKCS233
365500******************************************************************RCKCS233
365600*    THIS PARAGRAPH DELETES ALL ROWS OF THE TSPSTDS RECORD        RCKCS233
365700*    BASED ON PO, LINE AND PLAN.                                  RCKCS233
365800******************************************************************RCKCS233
365900                                                                  RCKCS233
366000     PERFORM WITH TEST AFTER                                      RCKCS233
366100         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    RCKCS233
366200         UNTIL   SQLCODE = +0 OR                                  RCKCS233
366300                 PS-DONE OR                                       RCKCS233
366400                 PV-RETRY-COUNTER > PC-MAX-RETRIES                RCKCS233
366500                                                                  RCKCS233
366600         EXEC SQL                                                 RCKCS233
366700              DELETE                                              RCKCS233
366800                FROM TSPSTDS                                      RCKCS233
366900               WHERE PO_NBR     = :TM500-PO-NBR                   RCKCS233
367000                 AND PO_LNE_NBR = :PURITM-PO-LNE-NBR              RCKCS233
367100                 AND PLAN_NBR   = :ALLPLN-PLAN-NBR                RCKCS233
367200         END-EXEC                                                 RCKCS233
367300                                                                  RCKCS233
367400         EVALUATE TRUE                                            RCKCS233
367500             WHEN SQLCODE = +0                                    RCKCS233
367600                  CONTINUE                                        RCKCS233
367700                                                                  RCKCS233
367800             WHEN SQLCODE = -904                                  RCKCS233
367900             WHEN SQLCODE = -911                                  RCKCS233
368000             WHEN SQLCODE = -913                                  RCKCS233
368100                  CONTINUE                                        RCKCS233
368200                                                                  RCKCS233
368300             WHEN OTHER                                           RCKCS233
368400                  SET  PS-DONE TO TRUE                            RCKCS233
368500                  MOVE PRV-32  TO TM500-RETURN-DATA               RCKCS233
368600                  MOVE SQLCA   TO TM500-SQLCA                     RCKCS233
368700                  MOVE SQLCODE TO TM500-SQLCODE                   RCKCS233
368800                                                                  RCKCS233
368900                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          RCKCS233
369000                  MOVE '2900'    TO PRV-PARA                      RCKCS233
369100                  MOVE 'TSPSTDS' TO PRV-TBL                       RCKCS233
369200                  PERFORM 9999-RETURN-MSG                         RCKCS233
369300         END-EVALUATE                                             RCKCS233
369400     END-PERFORM.                                                 RCKCS233
369500                                                                  RCKCS233
369600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         RCKCS233
369700         SET  PS-DONE TO TRUE                                     RCKCS233
369800         MOVE PRV-32  TO TM500-RETURN-DATA                        RCKCS233
369900         MOVE SQLCA   TO TM500-SQLCA                              RCKCS233
370000         MOVE SQLCODE TO TM500-SQLCODE                            RCKCS233
370100                                                                  RCKCS233
370200         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   RCKCS233
370300         MOVE '2900'    TO PRV-PARA                               RCKCS233
370400         MOVE 'TSPSTDS' TO PRV-TBL                                RCKCS233
370500         PERFORM 9999-RETURN-MSG                                  RCKCS233
370600     END-IF.                                                      RCKCS233
370700                                                                  RCKCS233
370800                                                                  RCKCS233
370900                                                                  RCKCS233
371000 3000-CREATE-TROUBLE-RECORD.                                      RCKCS233
371100******************************************************************RCKCS233
371200*    THIS PARAGRAPH CALLS MODULE TMKCS521                         RCKCS233
371300******************************************************************RCKCS233
371400                                                                  RCKCS233
371500**** IF TM500-FREEFORM-TEXT > SPACES AND                          RCKCS233
371600****    TM500-ADD-DETAILS AND TM500-RESOLVE-AUTO AND TM500-UPDATE RCKCS233
371700****     SET TM500-NO-DETAILS TO TRUE                             RCKCS233
371800**** END-IF.                                                      RCKCS233
371900                                                                  RCKCS233
372000     EXEC CICS                                                    RCKCS233
372100         LINK PROGRAM  (PC-TMKCS521)                              RCKCS233
372200              COMMAREA (TM500-FIELDS)                             RCKCS233
372300              LENGTH   (PC-600)                                   RCKCS233
372400     END-EXEC.                                                    RCKCS233
372500                                                                  RCKCS233
372600**** IF TM500-FREEFORM-TEXT > SPACES AND                          RCKCS233
372700****    TM500-NO-DETAILS AND TM500-RESOLVE-AUTO AND TM500-UPDATE  RCKCS233
372800****     SET TM500-ADD-DETAILS TO TRUE                            RCKCS233
372900**** END-IF.                                                      RCKCS233
373000                                                                  RCKCS233
373100     EVALUATE TRUE                                                RCKCS233
373200         WHEN TM500-CALL-SUCCESSFUL                               RCKCS233
373300         WHEN TM500-DUPLICATE-TROUBLE                             RCKCS233
373400         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        RCKCS233
373500              CONTINUE                                            RCKCS233
373600                                                                  RCKCS233
373700         WHEN OTHER                                               RCKCS233
373800              SET PS-DONE TO TRUE                                 RCKCS233
373900     END-EVALUATE.                                                RCKCS233
374000                                                                  RCKCS233
374100                                                                  RCKCS233
374200 4000-MA-PRORATION.                                               RCKCS233
374300******************************************************************RCKCS233
374400*    THIS PARAGRAPH CALLS THE FOLLOWING PARAGRAPHS BASED          RCKCS233
374500*    ON THE DIFFERENCE BETWEEN THE RECEIPT QTY AND THE OTR        RCKCS233
374600*    - 4050-MOVE-OTR  MOVES THE OTR TO A MA OTR WORK FIELD        RCKCS233
374700*                     AND MANAGES THE ALLOCATION SEQ CODE                 
374800*    - 4100-MA-SORT-STORE-ARRAY                                           
374900*                     DETERMINES SORT SEQUENCE TO BE USED                 
375000*                     AND DIRECTS TO APPROPRIATE SORT ROUTINES            
375100*    - 4200-MA-SEQ-CODE-TOTALS                                            
375200*                     ADDS UP FILL FIRST, STANDARD, FILL LAST,    RCKCS233
375300*                     AND CENTRAL STOCK QUANTITIES                        
375400*    - 4300-ALLOCATE-OTR-QUANTITIES                                       
375500*                     ALLOCATES OTR QUANTITIES                            
375600*    - 4400-ALLOCATE-SHORTAGE                                             
375700*                     MANAGES ALLOCATION WHEN RECEIPT QTY IS              
375800*                     LESS THAN THE OTR                                   
375900*    - 4900-ALLOCATE-OVERAGE                                              
376000*                     MANAGES ALLOCATION WHEN RECEIPT QTY IS              
376100*                     GREATER THAN THE OTR                                
376200******************************************************************RCKCS233
376300                                                                          
376400     IF  ALLPLN-ALLOC-OUTR-PK-QTY  =  0                           RCKCS233
376500         MOVE  +1  TO  PV-ALLOC-OUTR-PK-QTY                       RCKCS233
376600     ELSE                                                         RCKCS233
376700         MOVE ALLPLN-ALLOC-OUTR-PK-QTY TO PV-ALLOC-OUTR-PK-QTY    RCKCS233
376800     END-IF                                                               
376900                                                                          
377000     DIVIDE    RECITM-INNR-PACK-QTY                               RCKCS233
377100       INTO    PV-ALLOC-OUTR-PK-QTY                               RCKCS233
377200     GIVING    PV-ALLOC-OUTR-PACKS                                RCKCS233
377300     REMAINDER PV-ALLOC-OUTR-UNITS.                               RCKCS233
377400                                                                  RCKCS233
377500                                                                          
377600     IF  PV-ALLOC-OUTR-UNITS  NOT =  0                                    
377700         MOVE  RECITM-INNR-PACK-QTY  TO  PV-ALLOC-OUTR-PK-QTY             
377800     END-IF                                                               
377900                                                                          
378000                                                                          
378100     MOVE ALLPLN-PK-SIZE-RND-CDE  TO  PV-PK-SIZE-RND-CDE.                 
378200                                                                          
378300     IF  NOT  PV-VALID-PK-SIZE-RND-CDE                                    
378400         MOVE  PC-ALPHA-5  TO  ALLPLN-PK-SIZE-RND-CDE                     
378500     END-IF                                                               
378600                                                                          
378700                                                                  RCKCS233
378800                                                                          
378900     MOVE 1 TO PV-SUB-1.                                          RCKCS233
379000                                                                  RCKCS233
379100     SET  PS-STORE-NOT-IN-TABLE  TO  TRUE.                        RCKCS233
379200                                                                  RCKCS233
379300     PERFORM 4050-MOVE-OTR                                        RCKCS233
379400       UNTIL PV-SUB-1  >  PV-STR-SUB.                             RCKCS233
379500                                                                          
379600                                                                  RCKCS233
379700     PERFORM 4100-MA-SORT-STORE-ARRAY.                            RCKCS233
379800                                                                  RCKCS233
379900                                                                  RCKCS233
380000     IF  PV-LEFT-TO-ALLOC  =  PV-SUM-STR-OTR-UNITS                        
380100         PERFORM 4300-ALLOCATE-OTR-QUANTITES                      RCKCS233
380200     ELSE                                                         RCKCS233
380300     IF  PV-LEFT-TO-ALLOC  <  PV-SUM-STR-OTR-UNITS                        
380400         PERFORM 4200-MA-SEQ-CODE-TOTALS                          RCKCS233
380500         PERFORM 4400-ALLOCATE-SHORTAGE                           RCKCS233
380600     ELSE                                                         RCKCS233
380700         PERFORM 4300-ALLOCATE-OTR-QUANTITES                      RCKCS233
380800         PERFORM 4900-ALLOCATE-OVERAGE                            RCKCS233
380900     END-IF                                                               
381000     END-IF.                                                              
381100                                                                  RCKCS233
381200                                                                  RCKCS233
381300                                                                  RCKCS233
381400 4050-MOVE-OTR.                                                   RCKCS233
381500******************************************************************RCKCS233
381600*    MOVES THE OTR TO THE MA OTR AND CHECKS SEQUENCE CODE         RCKCS233
381700******************************************************************RCKCS233
381800                                                                          
381900     IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  >  PC-ALPHA-4          RCKCS233
382000         MOVE  PC-ALPHA-4  TO  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)   RCKCS233
382100     END-IF                                                               
382200                                                                          
382300                                                                          
382400     IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  NOT =  PC-ALPHA-1      RCKCS233
382500     AND PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  NOT =  PC-ALPHA-2      RCKCS233
382600     AND PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  NOT =  PC-ALPHA-3      RCKCS233
382700     AND PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  NOT =  PC-ALPHA-4      RCKCS233
382800         MOVE  PC-ALPHA-2  TO  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)   RCKCS233
382900     END-IF                                                               
383000                                                                          
383100                                                                          
383200                                                                          
383300     IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-1          RCKCS233
383400     OR  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-2          RCKCS233
383500     OR  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-3          RCKCS233
383600         SET  PS-STORE-IN-TABLE  TO  TRUE                         RCKCS233
383700     END-IF                                                               
383800                                                                          
383900                                                                          
384000     MOVE  PT-STR-OTR-TOTALS     (PV-SUB-1)                       RCKCS233
384100       TO  PT-STR-OTR-TOTALS-MA  (PV-SUB-1).                      RCKCS233
384200                                                                  RCKCS233
384300                                                                  RCKCS233
384400     ADD 1 TO PV-SUB-1.                                           RCKCS233
384500                                                                  RCKCS233
384600                                                                          
384700                                                                          
384800 4100-MA-SORT-STORE-ARRAY.                                        RCKCS233
384900******************************************************************RCKCS233
385000*    THIS PARAGRAPH CALLS THE APPROPRIATE SORT PARAGRAPHS         RCKCS233
385100*    BASED ON THE PICTURED AD FLAG.                               RCKCS233
385200******************************************************************RCKCS233
385300                                                                  RCKCS233
385400     MOVE 1 TO PV-SUB-1.                                          RCKCS233
385500                                                                  RCKCS233
385600     PERFORM 4110-SORT-SEQ-CODE                                   RCKCS233
385700       UNTIL PV-SUB-1 NOT < PV-STR-SUB.                           RCKCS233
385800                                                                          
385900                                                                  RCKCS233
386000     IF  TM500-AD-YES                                             RCKCS233
386100     AND PV-LEFT-TO-ALLOC  <  PV-SUM-STR-OTR-UNITS                        
386200         MOVE 1 TO PV-SUB-1                                       RCKCS233
386300         PERFORM 4120-SORT-OTR                                    RCKCS233
386400           UNTIL PV-SUB-1 NOT < PV-STR-SUB                        RCKCS233
386500         MOVE 1 TO PV-SUB-1                                       RCKCS233
386600         PERFORM 4130-SORT-OTR-RANK                               RCKCS233
386700           UNTIL PV-SUB-1 NOT < PV-STR-SUB                        RCKCS233
386800     ELSE                                                                 
386900         MOVE 1 TO PV-SUB-1                                       RCKCS233
387000         PERFORM 4140-SORT-CODE-RANK                              RCKCS233
387100           UNTIL PV-SUB-1 NOT < PV-STR-SUB                        RCKCS233
387200     END-IF.                                                              
387300                                                                  RCKCS233
387400                                                                  RCKCS233
387500 4110-SORT-SEQ-CODE.                                              RCKCS233
387600******************************************************************RCKCS233
387700*    THIS PARAGRAPH CALLS 4111 TO SORT THE STORES TABLE.          RCKCS233
387800******************************************************************RCKCS233
387900                                                                          
388000     COMPUTE PV-SUB-2 = PV-SUB-1 + 1.                             RCKCS233
388100                                                                  RCKCS233
388200     PERFORM 4111-LOOP-SORT-SEQ-CODE                              RCKCS233
388300       UNTIL PV-SUB-2 > PV-STR-SUB.                               RCKCS233
388400                                                                  RCKCS233
388500     ADD 1 TO PV-SUB-1.                                           RCKCS233
388600                                                                  RCKCS233
388700                                                                  RCKCS233
388800 4111-LOOP-SORT-SEQ-CODE.                                         RCKCS233
388900******************************************************************RCKCS233
389000*    THIS PARAGRAPH SORTS THE STORES TABLE IN ASCENDING ORDER     RCKCS233
389100*    OF ALLOCATION SEQUENCE CODE.                                 RCKCS233
389200******************************************************************RCKCS233
389300                                                                  RCKCS233
389400     IF (PT-STR-ALLOC-SEQ-CDE  (PV-SUB-2)  <                      RCKCS233
389500         PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1))                        RCKCS233
389600                                                                          
389700         MOVE PT-STORE-TABLE (PV-SUB-1) TO PV-TEMP                RCKCS233
389800         MOVE PT-STORE-TABLE (PV-SUB-2) TO                        RCKCS233
389900              PT-STORE-TABLE (PV-SUB-1)                           RCKCS233
390000         MOVE PV-TEMP                   TO                        RCKCS233
390100              PT-STORE-TABLE (PV-SUB-2)                           RCKCS233
390200     END-IF.                                                      RCKCS233
390300                                                                  RCKCS233
390400     ADD 1 TO PV-SUB-2.                                           RCKCS233
390500                                                                  RCKCS233
390600                                                                          
390700                                                                  RCKCS233
390800                                                                  RCKCS233
390900 4120-SORT-OTR.                                                   RCKCS233
391000******************************************************************RCKCS233
391100*    THIS PARAGRAPH CALLS 4121 TO SORT THE STORES TABLE.          RCKCS233
391200******************************************************************RCKCS233
391300                                                                  RCKCS233
391400     COMPUTE PV-SUB-2 = PV-SUB-1 + 1.                             RCKCS233
391500                                                                  RCKCS233
391600     PERFORM 4121-LOOP-SORT-OTR                                   RCKCS233
391700       UNTIL PV-SUB-2 > PV-STR-SUB.                               RCKCS233
391800                                                                  RCKCS233
391900     ADD 1 TO PV-SUB-1.                                           RCKCS233
392000                                                                  RCKCS233
392100                                                                  RCKCS233
392200 4121-LOOP-SORT-OTR.                                              RCKCS233
392300******************************************************************RCKCS233
392400*    THIS PARAGRAPH SORTS THE STORES TABLE IN ASCENDING ORDER     RCKCS233
392500*    OF ALLOCATION SEQUENCE CODE AND DESCENDING OTR               RCKCS233
392600******************************************************************RCKCS233
392700                                                                  RCKCS233
392800     IF (PT-STR-ALLOC-SEQ-CDE  (PV-SUB-2)  =                      RCKCS233
392900         PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1))                        RCKCS233
393000                              AND                                         
393100        (PT-STR-OTR-TOTALS-MA   (PV-SUB-2)  >                     RCKCS233
393200         PT-STR-OTR-TOTALS-MA   (PV-SUB-1))                       RCKCS233
393300                                                                          
393400         MOVE PT-STORE-TABLE (PV-SUB-1) TO PV-TEMP                RCKCS233
393500         MOVE PT-STORE-TABLE (PV-SUB-2) TO                        RCKCS233
393600              PT-STORE-TABLE (PV-SUB-1)                           RCKCS233
393700         MOVE PV-TEMP                   TO                        RCKCS233
393800              PT-STORE-TABLE (PV-SUB-2)                           RCKCS233
393900     END-IF.                                                      RCKCS233
394000                                                                  RCKCS233
394100     ADD 1 TO PV-SUB-2.                                           RCKCS233
394200                                                                  RCKCS233
394300                                                                          
394400                                                                  RCKCS233
394500                                                                  RCKCS233
394600 4130-SORT-OTR-RANK.                                              RCKCS233
394700******************************************************************RCKCS233
394800*    THIS PARAGRAPH CALLS 4131 TO SORT THE STORES TABLE.          RCKCS233
394900******************************************************************RCKCS233
395000                                                                  RCKCS233
395100     COMPUTE PV-SUB-2 = PV-SUB-1 + 1.                             RCKCS233
395200                                                                  RCKCS233
395300     PERFORM 4131-LOOP-SORT-OTR-RANK                              RCKCS233
395400       UNTIL PV-SUB-2 > PV-STR-SUB.                               RCKCS233
395500                                                                  RCKCS233
395600     ADD 1 TO PV-SUB-1.                                           RCKCS233
395700                                                                  RCKCS233
395800                                                                  RCKCS233
395900 4131-LOOP-SORT-OTR-RANK.                                         RCKCS233
396000******************************************************************RCKCS233
396100*    THIS PARAGRAPH SORTS THE STORES TABLE IN ASCENDING ORDER     RCKCS233
396200*    OF ALLOCATION SEQUENCE CODE AND DESCENDING OTR AND           RCKCS233
396300*    ASCENDING RANK SEQUENCE.                                     RCKCS233
396400******************************************************************RCKCS233
396500                                                                  RCKCS233
396600     IF (PT-STR-ALLOC-SEQ-CDE  (PV-SUB-2)  =                      RCKCS233
396700         PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1))                        RCKCS233
396800                              AND                                         
396900        (PT-STR-OTR-TOTALS-MA   (PV-SUB-2)  =                     RCKCS233
397000         PT-STR-OTR-TOTALS-MA   (PV-SUB-1))                       RCKCS233
397100                              AND                                         
397200        (PT-STR-RNK-SEQ-NBR    (PV-SUB-2)  <                      RCKCS233
397300         PT-STR-RNK-SEQ-NBR    (PV-SUB-1))                        RCKCS233
397400                                                                          
397500         MOVE PT-STORE-TABLE (PV-SUB-1) TO PV-TEMP                RCKCS233
397600         MOVE PT-STORE-TABLE (PV-SUB-2) TO                        RCKCS233
397700              PT-STORE-TABLE (PV-SUB-1)                           RCKCS233
397800         MOVE PV-TEMP                   TO                        RCKCS233
397900              PT-STORE-TABLE (PV-SUB-2)                           RCKCS233
398000     END-IF.                                                      RCKCS233
398100                                                                  RCKCS233
398200     ADD 1 TO PV-SUB-2.                                           RCKCS233
398300                                                                  RCKCS233
398400                                                                  RCKCS233
398500                                                                  RCKCS233
398600 4140-SORT-CODE-RANK.                                             RCKCS233
398700******************************************************************RCKCS233
398800*    THIS PARAGRAPH CALLS 4141 TO SORT THE STORES TABLE.          RCKCS233
398900******************************************************************RCKCS233
399000                                                                  RCKCS233
399100     COMPUTE PV-SUB-2 = PV-SUB-1 + 1.                             RCKCS233
399200                                                                  RCKCS233
399300     PERFORM 4141-LOOP-SORT-CODE-RANK                             RCKCS233
399400       UNTIL PV-SUB-2 > PV-STR-SUB.                               RCKCS233
399500                                                                  RCKCS233
399600     ADD 1 TO PV-SUB-1.                                           RCKCS233
399700                                                                  RCKCS233
399800                                                                          
399900                                                                  RCKCS233
400000 4141-LOOP-SORT-CODE-RANK.                                        RCKCS233
400100******************************************************************RCKCS233
400200*    THIS PARAGRAPH SORTS THE STORES TABLE IN ASCENDING ORDER     RCKCS233
400300*    OF ALLOCATION SEQUENCE CODE AND STORE RANK.                  RCKCS233
400400******************************************************************RCKCS233
400500                                                                  RCKCS233
400600     IF (PT-STR-ALLOC-SEQ-CDE  (PV-SUB-2)  =                      RCKCS233
400700         PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1))                        RCKCS233
400800                              AND                                         
400900        (PT-STR-RNK-SEQ-NBR    (PV-SUB-2)  <                      RCKCS233
401000         PT-STR-RNK-SEQ-NBR    (PV-SUB-1))                        RCKCS233
401100                                                                          
401200         MOVE PT-STORE-TABLE (PV-SUB-1) TO PV-TEMP                RCKCS233
401300         MOVE PT-STORE-TABLE (PV-SUB-2) TO                        RCKCS233
401400              PT-STORE-TABLE (PV-SUB-1)                           RCKCS233
401500         MOVE PV-TEMP                   TO                        RCKCS233
401600              PT-STORE-TABLE (PV-SUB-2)                           RCKCS233
401700     END-IF.                                                      RCKCS233
401800                                                                  RCKCS233
401900     ADD 1 TO PV-SUB-2.                                           RCKCS233
402000                                                                  RCKCS233
402100                                                                          
402200                                                                          
402300 4200-MA-SEQ-CODE-TOTALS.                                         RCKCS233
402400******************************************************************RCKCS233
402500*   COMPUTE TOTAL OPEN-TO-RECEIVE FOR FILL FIRST, STANDARD,       RCKCS233
402600*   FILL LAST AND CENTRAL STOCK LOCATIONS.                        RCKCS233
402700******************************************************************RCKCS233
402800                                                                  RCKCS233
402900     MOVE  0  TO  PV-FILL-FIRST-OTR-UNITS                         RCKCS233
403000                  PV-FILL-FIRST-OTR-PACKS                         RCKCS233
403100                  PV-FILL-FIRST-OTR-TOTALS                        RCKCS233
403200                  PV-STANDARD-OTR-UNITS                           RCKCS233
403300                  PV-STANDARD-OTR-PACKS                           RCKCS233
403400                  PV-STANDARD-OTR-TOTALS                          RCKCS233
403500                  PV-FILL-LAST-OTR-UNITS                          RCKCS233
403600                  PV-FILL-LAST-OTR-PACKS                          RCKCS233
403700                  PV-FILL-LAST-OTR-TOTALS                         RCKCS233
403800                  PV-CSTOCK-OTR-UNITS                             RCKCS233
403900                  PV-CSTOCK-OTR-PACKS                             RCKCS233
404000                  PV-CSTOCK-OTR-TOTALS.                           RCKCS233
404100                                                                  RCKCS233
404200                                                                  RCKCS233
404300     MOVE  1  TO  PV-SUB-1.                                               
404400                                                                  RCKCS233
404500     PERFORM 4210-COMPUTE-ALLOC-SEQ-AMOUNTS                               
404600       UNTIL PV-SUB-1  >  PV-STR-SUB.                                     
404700                                                                          
404800                                                                          
404900 4210-COMPUTE-ALLOC-SEQ-AMOUNTS.                                          
405000******************************************************************RCKCS233
405100*    THIS PARAGRAPH ADDS UP OTR QUANTITIES BY ALLOC SEQ CODE      RCKCS233
405200******************************************************************RCKCS233
405300                                                                          
405400      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-1         RCKCS233
405500          COMPUTE PV-FILL-FIRST-OTR-UNITS                         RCKCS233
405600               =  PV-FILL-FIRST-OTR-UNITS                         RCKCS233
405700               +  PT-STR-OTR-UNITS  (PV-SUB-1)                            
405800          COMPUTE PV-FILL-FIRST-OTR-PACKS                         RCKCS233
405900               =  PV-FILL-FIRST-OTR-PACKS                         RCKCS233
406000               +  PT-STR-OTR-PACKS  (PV-SUB-1)                            
406100          COMPUTE PV-FILL-FIRST-OTR-TOTALS                        RCKCS233
406200               =  PV-FILL-FIRST-OTR-TOTALS                        RCKCS233
406300               +  PT-STR-OTR-TOTALS-MA (PV-SUB-1)                         
406400      ELSE                                                        RCKCS233
406500      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)   =  PC-ALPHA-2        RCKCS233
406600          COMPUTE PV-STANDARD-OTR-UNITS                           RCKCS233
406700               =  PV-STANDARD-OTR-UNITS                           RCKCS233
406800               +  PT-STR-OTR-UNITS  (PV-SUB-1)                            
406900          COMPUTE PV-STANDARD-OTR-PACKS                           RCKCS233
407000               =  PV-STANDARD-OTR-PACKS                           RCKCS233
407100               +  PT-STR-OTR-PACKS  (PV-SUB-1)                            
407200          COMPUTE PV-STANDARD-OTR-TOTALS                          RCKCS233
407300               =  PV-STANDARD-OTR-TOTALS                          RCKCS233
407400               +  PT-STR-OTR-TOTALS-MA (PV-SUB-1)                         
407500      ELSE                                                        RCKCS233
407600      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-3         RCKCS233
407700          COMPUTE PV-FILL-LAST-OTR-UNITS                          RCKCS233
407800               =  PV-FILL-LAST-OTR-UNITS                          RCKCS233
407900               +  PT-STR-OTR-UNITS  (PV-SUB-1)                            
408000          COMPUTE PV-FILL-LAST-OTR-PACKS                          RCKCS233
408100               =  PV-FILL-LAST-OTR-PACKS                          RCKCS233
408200               +  PT-STR-OTR-PACKS  (PV-SUB-1)                            
408300          COMPUTE PV-FILL-LAST-OTR-TOTALS                         RCKCS233
408400               =  PV-FILL-LAST-OTR-TOTALS                         RCKCS233
408500               +  PT-STR-OTR-TOTALS-MA (PV-SUB-1)                         
408600      ELSE                                                        RCKCS233
408700      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-4         RCKCS233
408800          COMPUTE PV-CSTOCK-OTR-UNITS                             RCKCS233
408900               =  PV-CSTOCK-OTR-UNITS                             RCKCS233
409000               +  PT-STR-OTR-UNITS  (PV-SUB-1)                            
409100          COMPUTE PV-CSTOCK-OTR-PACKS                             RCKCS233
409200               =  PV-CSTOCK-OTR-PACKS                             RCKCS233
409300               +  PT-STR-OTR-PACKS  (PV-SUB-1)                            
409400          COMPUTE PV-CSTOCK-OTR-TOTALS                            RCKCS233
409500               =  PV-CSTOCK-OTR-TOTALS                            RCKCS233
409600               +  PT-STR-OTR-TOTALS-MA (PV-SUB-1)                         
409700      END-IF                                                      RCKCS233
409800      END-IF                                                      RCKCS233
409900      END-IF                                                      RCKCS233
410000      END-IF.                                                     RCKCS233
410100                                                                          
410200                                                                          
410300     ADD  1  TO  PV-SUB-1.                                                
410400                                                                          
410500                                                                          
410600                                                                          
410700 4300-ALLOCATE-OTR-QUANTITES.                                     RCKCS233
410800******************************************************************RCKCS233
410900*    THIS PARAGRAPH CALLS 4310 TO ALLOCATE OTR QUANTITIES.        RCKCS233
411000******************************************************************RCKCS233
411100                                                                  RCKCS233
411200     MOVE  1  TO  PV-SUB-1.                                               
411300                                                                  RCKCS233
411400     PERFORM 4310-LOOP-ALLOC-OTR-AMOUNTS                                  
411500       UNTIL PV-SUB-1  >  PV-STR-SUB.                                     
411600                                                                          
411700                                                                          
411800                                                                          
411900 4310-LOOP-ALLOC-OTR-AMOUNTS.                                             
412000******************************************************************RCKCS233
412100*    THIS PARAGRAPH ALLOCS THE OTR QUANTITIES TO EACH STORE       RCKCS233
412200******************************************************************RCKCS233
412300                                                                          
412400     MOVE  PT-STR-OTR-TOTALS-MA (PV-SUB-1)                        RCKCS233
412500       TO  PT-STR-ALLOC-TOTALS  (PV-SUB-1).                       RCKCS233
412600                                                                          
412700     SUBTRACT PT-STR-OTR-TOTALS-MA (PV-SUB-1)                             
412800         FROM PV-LEFT-TO-ALLOC.                                           
412900                                                                          
413000                                                                          
413100     ADD  1  TO  PV-SUB-1.                                                
413200                                                                          
413300                                                                          
413400                                                                          
413500 4400-ALLOCATE-SHORTAGE.                                          RCKCS233
413600******************************************************************RCKCS233
413700*  THIS PARAGRAPH CALLS PARAGRAPHS TO ALLOCATE A SHORTAGE         RCKCS233
413800******************************************************************RCKCS233
413900                                                                          
414000      IF  TM500-AD-YES                                            RCKCS233
414100          PERFORM  5000-ALLOCATE-PICTURED-AD                      RCKCS233
414200      END-IF                                                              
414300                                                                          
414400                                                                          
414500      IF PV-LEFT-TO-ALLOC > 0                                     RCKCS233
414600       IF PV-LEFT-TO-ALLOC > PV-FILL-FIRST-OTR-TOTALS             RCKCS233
414700       OR PV-LEFT-TO-ALLOC = PV-FILL-FIRST-OTR-TOTALS             RCKCS233
414800         PERFORM  4410-FILL-FIRST-OTR-QUANTITES                   RCKCS233
414900         IF PV-LEFT-TO-ALLOC > PV-STANDARD-OTR-TOTALS             RCKCS233
415000         OR PV-LEFT-TO-ALLOC = PV-STANDARD-OTR-TOTALS             RCKCS233
415100            PERFORM  4510-STANDARD-OTR-QUANTITES                  RCKCS233
415200            IF PV-LEFT-TO-ALLOC > PV-FILL-LAST-OTR-TOTALS         RCKCS233
415300            OR PV-LEFT-TO-ALLOC = PV-FILL-LAST-OTR-TOTALS         RCKCS233
415400               PERFORM  4610-FILL-LAST-OTR-QUANTITES              RCKCS233
415500               IF PV-LEFT-TO-ALLOC > PV-CSTOCK-OTR-TOTALS         RCKCS233
415600               OR PV-LEFT-TO-ALLOC = PV-CSTOCK-OTR-TOTALS         RCKCS233
415700                  PERFORM  4710-CSTOCK-OTR-QUANTITES              RCKCS233
415800               ELSE                                                       
415900                  PERFORM  4750-PRORATE-CSTOCK-QTYS               RCKCS233
416000               END-IF                                                     
416100            ELSE                                                          
416200               PERFORM  4650-PRORATE-FILL-LAST-QTYS               RCKCS233
416300            END-IF                                                        
416400         ELSE                                                             
416500            PERFORM  4550-PRORATE-STANDARD-QTYS                   RCKCS233
416600         END-IF                                                           
416700       ELSE                                                               
416800         PERFORM  4450-PRORATE-FILL-FIRST-QTYS                    RCKCS233
416900       END-IF                                                             
417000      END-IF.                                                             
417100                                                                          
417200                                                                          
417300                                                                          
417400 4410-FILL-FIRST-OTR-QUANTITES.                                   RCKCS233
417500******************************************************************RCKCS233
417600*    THIS PARAGRAPH CALLS 4420 TO ALLOCATE FILL FIRST OTR QTYS.   RCKCS233
417700******************************************************************RCKCS233
417800                                                                  RCKCS233
417900     MOVE  1  TO  PV-SUB-1.                                               
418000                                                                  RCKCS233
418100     PERFORM  4420-LOOP-ALLOC-FILL-FIRST                                  
418200       UNTIL  PV-SUB-1  >  PV-STR-SUB                                     
418300          OR  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  >  PC-ALPHA-1.    RCKCS233
418400                                                                          
418500                                                                          
418600                                                                          
418700 4420-LOOP-ALLOC-FILL-FIRST.                                              
418800******************************************************************RCKCS233
418900*    THIS PARAGRAPH ALLOCS THE OTR QTYS TO EACH FILL FIRST STORE  RCKCS233
419000******************************************************************RCKCS233
419100                                                                          
419200      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-1         RCKCS233
419300          ADD   PT-STR-OTR-TOTALS-MA (PV-SUB-1)                   RCKCS233
419400            TO  PT-STR-ALLOC-TOTALS  (PV-SUB-1)                   RCKCS233
419500          SUBTRACT PT-STR-OTR-TOTALS-MA (PV-SUB-1)                        
419600              FROM PV-LEFT-TO-ALLOC                                       
419700      END-IF.                                                             
419800                                                                          
419900      ADD  1  TO  PV-SUB-1.                                               
420000                                                                          
420100                                                                          
420200                                                                          
420300 4450-PRORATE-FILL-FIRST-QTYS.                                    RCKCS233
420400******************************************************************RCKCS233
420500*    THIS PARAGRAPH CALLS 4460 TO CALC/ROUND ALLOC QUANTITIES.    RCKCS233
420600******************************************************************RCKCS233
420700                                                                  RCKCS233
420800     IF  PV-LEFT-TO-ALLOC  >  0                                           
420900         MOVE  1  TO  PV-SUB-1                                            
421000         MOVE  0  TO  PV-TOTAL-ALLOCATED                                  
421100                                                                  RCKCS233
421200         PERFORM  4460-LOOP-CALC-FILL-FIRST                               
421300           UNTIL  PV-SUB-1  >  PV-STR-SUB                                 
421400              OR  PV-FILL-FIRST-OTR-TOTALS  <  1                          
421500              OR  PT-STR-ALLOC-SEQ-CDE (PV-SUB-1) > PC-ALPHA-1    RCKCS233
421600                                                                          
421700         IF  PV-TOTAL-ALLOCATED  NOT =  PV-LEFT-TO-ALLOC                  
421800             MOVE  PC-ALPHA-1  TO  PV-HOLD-ALLOC-SEQ-CODE         RCKCS233
421900             PERFORM  4810-BALANCE-MA-PRORATION                           
422000         END-IF                                                           
422100                                                                          
422200         MOVE  0  TO  PV-LEFT-TO-ALLOC                                    
422300                                                                          
422400     END-IF.                                                              
422500                                                                          
422600                                                                          
422700                                                                          
422800 4460-LOOP-CALC-FILL-FIRST.                                               
422900******************************************************************RCKCS233
423000*    THIS PARAGRAPH CALCS/ROUNDS ALLOC QTYS FOR FILL FIRST STORES RCKCS233
423100******************************************************************RCKCS233
423200                                                                          
423300      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-1         RCKCS233
423400          COMPUTE  PV-ALLOC-TOTAL                                         
423500              =  ((PT-STR-OTR-TOTALS-MA (PV-SUB-1)                        
423600              /    PV-FILL-FIRST-OTR-TOTALS) * PV-LEFT-TO-ALLOC)          
423700              /  RECITM-INNR-PACK-QTY                             RCKCS233
423800          PERFORM 4800-ROUND-PACKS                                        
423900          COMPUTE  PV-TOTAL-ALLOCATED                                     
424000              =    PV-TOTAL-ALLOCATED                                     
424100              +    PV-ALLOC-TOTAL                                 RCKCS233
424200      END-IF                                                              
424300                                                                          
424400      ADD  1  TO  PV-SUB-1.                                               
424500                                                                          
424600                                                                          
424700                                                                          
424800 4510-STANDARD-OTR-QUANTITES.                                     RCKCS233
424900******************************************************************RCKCS233
425000*    THIS PARAGRAPH CALLS 4520 TO ALLOCATE STANDARD OTR QTYS      RCKCS233
425100******************************************************************RCKCS233
425200                                                                  RCKCS233
425300     MOVE  1  TO  PV-SUB-1.                                               
425400                                                                  RCKCS233
425500     PERFORM  4520-LOOP-ALLOC-STANDARD                                    
425600       UNTIL  PV-SUB-1  >  PV-STR-SUB                                     
425700          OR  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  >  PC-ALPHA-2.    RCKCS233
425800                                                                          
425900                                                                          
426000                                                                          
426100 4520-LOOP-ALLOC-STANDARD.                                                
426200******************************************************************RCKCS233
426300*    THIS PARAGRAPH ALLOCS THE OTR QTYS TO EACH STANDARD STORE    RCKCS233
426400******************************************************************RCKCS233
426500                                                                          
426600      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-2         RCKCS233
426700          ADD   PT-STR-OTR-TOTALS-MA (PV-SUB-1)                   RCKCS233
426800            TO  PT-STR-ALLOC-TOTALS  (PV-SUB-1)                   RCKCS233
426900          SUBTRACT PT-STR-OTR-TOTALS-MA (PV-SUB-1)                        
427000              FROM PV-LEFT-TO-ALLOC                                       
427100      END-IF                                                              
427200                                                                          
427300      ADD  1  TO  PV-SUB-1.                                               
427400                                                                          
427500                                                                          
427600                                                                          
427700 4550-PRORATE-STANDARD-QTYS.                                      RCKCS233
427800******************************************************************RCKCS233
427900*    THIS PARAGRAPH CALLS 4560 TO CALC/ROUND ALLOC QUANTITIES.    RCKCS233
428000******************************************************************RCKCS233
428100                                                                  RCKCS233
428200     IF  PV-LEFT-TO-ALLOC  >  0                                           
428300         MOVE  1  TO  PV-SUB-1                                            
428400         MOVE  0  TO  PV-TOTAL-ALLOCATED                                  
428500                                                                  RCKCS233
428600         PERFORM  4560-LOOP-CALC-STANDARD                                 
428700           UNTIL  PV-SUB-1  >  PV-STR-SUB                                 
428800              OR  PV-STANDARD-OTR-TOTALS  <  1                            
428900              OR  PT-STR-ALLOC-SEQ-CDE (PV-SUB-1) > PC-ALPHA-2    RCKCS233
429000                                                                          
429100         IF  PV-TOTAL-ALLOCATED  NOT =  PV-LEFT-TO-ALLOC                  
429200             MOVE  PC-ALPHA-2  TO  PV-HOLD-ALLOC-SEQ-CODE         RCKCS233
429300             PERFORM  4810-BALANCE-MA-PRORATION                           
429400         END-IF                                                           
429500                                                                          
429600         MOVE  0  TO  PV-LEFT-TO-ALLOC                                    
429700                                                                          
429800     END-IF.                                                              
429900                                                                          
430000                                                                          
430100                                                                          
430200 4560-LOOP-CALC-STANDARD.                                                 
430300******************************************************************RCKCS233
430400*    THIS PARAGRAPH CALCS/ROUNDS ALLOC QTYS FOR STANDARD STORES   RCKCS233
430500******************************************************************RCKCS233
430600                                                                          
430700      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-2         RCKCS233
430800          COMPUTE  PV-ALLOC-TOTAL                                         
430900              =  ((PT-STR-OTR-TOTALS-MA (PV-SUB-1)                        
431000              /    PV-STANDARD-OTR-TOTALS) * PV-LEFT-TO-ALLOC)            
431100              /  RECITM-INNR-PACK-QTY                             RCKCS233
431200          PERFORM 4800-ROUND-PACKS                                        
431300          COMPUTE  PV-TOTAL-ALLOCATED                                     
431400              =    PV-TOTAL-ALLOCATED                                     
431500              +    PV-ALLOC-TOTAL                                 RCKCS233
431600      END-IF                                                              
431700                                                                          
431800      ADD  1  TO  PV-SUB-1.                                               
431900                                                                          
432000                                                                          
432100                                                                          
432200                                                                          
432300 4610-FILL-LAST-OTR-QUANTITES.                                    RCKCS233
432400******************************************************************RCKCS233
432500*    THIS PARAGRAPH CALLS 4620 TO ALLOCATE FILL LAST OTR QTYS.    RCKCS233
432600******************************************************************RCKCS233
432700                                                                  RCKCS233
432800     MOVE  1  TO  PV-SUB-1.                                               
432900                                                                  RCKCS233
433000     PERFORM  4620-LOOP-ALLOC-FILL-LAST                                   
433100       UNTIL  PV-SUB-1  >  PV-STR-SUB                                     
433200          OR  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  >  PC-ALPHA-3.    RCKCS233
433300                                                                          
433400                                                                          
433500                                                                          
433600 4620-LOOP-ALLOC-FILL-LAST.                                               
433700******************************************************************RCKCS233
433800*    THIS PARAGRAPH ALLOCS THE OTR QTYS TO EACH FILL LAST STORE   RCKCS233
433900******************************************************************RCKCS233
434000                                                                          
434100      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-3         RCKCS233
434200          ADD   PT-STR-OTR-TOTALS-MA (PV-SUB-1)                   RCKCS233
434300            TO  PT-STR-ALLOC-TOTALS  (PV-SUB-1)                   RCKCS233
434400          SUBTRACT PT-STR-OTR-TOTALS-MA (PV-SUB-1)                        
434500              FROM PV-LEFT-TO-ALLOC                                       
434600      END-IF                                                              
434700                                                                          
434800      ADD  1  TO  PV-SUB-1.                                               
434900                                                                          
435000                                                                          
435100                                                                          
435200                                                                          
435300 4650-PRORATE-FILL-LAST-QTYS.                                     RCKCS233
435400******************************************************************RCKCS233
435500*    THIS PARAGRAPH CALLS 4660 TO CALC/ROUND ALLOC QUANTITIES.    RCKCS233
435600******************************************************************RCKCS233
435700                                                                  RCKCS233
435800     IF  PV-LEFT-TO-ALLOC  >  0                                           
435900         MOVE  1  TO  PV-SUB-1                                            
436000         MOVE  0  TO  PV-TOTAL-ALLOCATED                                  
436100                                                                  RCKCS233
436200         PERFORM  4660-LOOP-CALC-FILL-LAST                                
436300           UNTIL  PV-SUB-1  >  PV-STR-SUB                                 
436400              OR  PV-FILL-LAST-OTR-TOTALS  <  1                           
436500              OR  PT-STR-ALLOC-SEQ-CDE (PV-SUB-1) > PC-ALPHA-3    RCKCS233
436600                                                                          
436700         IF  PV-TOTAL-ALLOCATED  NOT =  PV-LEFT-TO-ALLOC                  
436800             MOVE  PC-ALPHA-3  TO  PV-HOLD-ALLOC-SEQ-CODE         RCKCS233
436900             PERFORM  4810-BALANCE-MA-PRORATION                           
437000         END-IF                                                           
437100                                                                          
437200         MOVE  0  TO  PV-LEFT-TO-ALLOC                                    
437300                                                                          
437400     END-IF.                                                              
437500                                                                          
437600                                                                          
437700                                                                          
437800 4660-LOOP-CALC-FILL-LAST.                                                
437900******************************************************************RCKCS233
438000*    THIS PARAGRAPH CALCS/ROUNDS ALLOC QTYS FOR FILL LAST STORES  RCKCS233
438100******************************************************************RCKCS233
438200                                                                          
438300      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-3         RCKCS233
438400          COMPUTE  PV-ALLOC-TOTAL                                         
438500              =  ((PT-STR-OTR-TOTALS-MA (PV-SUB-1)                        
438600              /    PV-FILL-LAST-OTR-TOTALS) * PV-LEFT-TO-ALLOC)           
438700              /  RECITM-INNR-PACK-QTY                             RCKCS233
438800          PERFORM 4800-ROUND-PACKS                                        
438900          COMPUTE  PV-TOTAL-ALLOCATED                                     
439000              =    PV-TOTAL-ALLOCATED                                     
439100              +    PV-ALLOC-TOTAL                                 RCKCS233
439200      END-IF                                                              
439300                                                                          
439400      ADD  1  TO  PV-SUB-1.                                               
439500                                                                          
439600                                                                          
439700                                                                          
439800                                                                          
439900 4710-CSTOCK-OTR-QUANTITES.                                       RCKCS233
440000******************************************************************RCKCS233
440100*    THIS PARAGRAPH CALLS 4720 TO ALLOCATE CENTRAL STK OTR QTYS.  RCKCS233
440200******************************************************************RCKCS233
440300                                                                  RCKCS233
440400     MOVE  1  TO  PV-SUB-1.                                               
440500                                                                  RCKCS233
440600     PERFORM  4720-LOOP-ALLOC-CSTOCK                                      
440700       UNTIL  PV-SUB-1  >  PV-STR-SUB                                     
440800          OR  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  >  PC-ALPHA-4.    RCKCS233
440900                                                                          
441000                                                                          
441100                                                                          
441200 4720-LOOP-ALLOC-CSTOCK.                                                  
441300******************************************************************RCKCS233
441400*    THIS PARAGRAPH ALLOCS THE OTR QTYS TO EACH CENTRAL STOCK     RCKCS233
441500*    LOCATION.                                                    RCKCS233
441600******************************************************************RCKCS233
441700                                                                          
441800      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-4         RCKCS233
441900          ADD   PT-STR-OTR-TOTALS-MA (PV-SUB-1)                   RCKCS233
442000            TO  PT-STR-ALLOC-TOTALS  (PV-SUB-1)                   RCKCS233
442100          SUBTRACT PT-STR-OTR-TOTALS-MA (PV-SUB-1)                        
442200              FROM PV-LEFT-TO-ALLOC                                       
442300      END-IF                                                              
442400                                                                          
442500      ADD  1  TO  PV-SUB-1.                                               
442600                                                                          
442700                                                                          
442800                                                                          
442900 4750-PRORATE-CSTOCK-QTYS.                                        RCKCS233
443000******************************************************************RCKCS233
443100*    THIS PARAGRAPH CALLS 4760 TO CALC/ROUND ALLOC QUANTITIES.    RCKCS233
443200******************************************************************RCKCS233
443300                                                                  RCKCS233
443400     IF  PV-LEFT-TO-ALLOC  >  0                                           
443500         MOVE  1  TO  PV-SUB-1                                            
443600         MOVE  0  TO  PV-TOTAL-ALLOCATED                                  
443700                                                                  RCKCS233
443800         PERFORM  4760-LOOP-CALC-CSTOCK                                   
443900           UNTIL  PV-SUB-1  >  PV-STR-SUB                                 
444000              OR  PV-CSTOCK-OTR-TOTALS  <  1                              
444100              OR  PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)  >  PC-ALPHA-4  RCKCS233
444200                                                                          
444300         IF  PV-TOTAL-ALLOCATED  NOT =  PV-LEFT-TO-ALLOC                  
444400             MOVE  PC-ALPHA-4  TO  PV-HOLD-ALLOC-SEQ-CODE         RCKCS233
444500             PERFORM  4810-BALANCE-MA-PRORATION                           
444600         END-IF                                                           
444700                                                                          
444800         MOVE  0  TO  PV-LEFT-TO-ALLOC                                    
444900                                                                          
445000     END-IF.                                                              
445100                                                                          
445200                                                                          
445300                                                                          
445400 4760-LOOP-CALC-CSTOCK.                                                   
445500******************************************************************RCKCS233
445600*    THIS PARAGRAPH CALCS/ROUNDS ALLOC QTYS FOR CENTRAL STOCK     RCKCS233
445700******************************************************************RCKCS233
445800                                                                          
445900      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-4         RCKCS233
446000          COMPUTE  PV-ALLOC-TOTAL                                         
446100              =  ((PT-STR-OTR-TOTALS-MA (PV-SUB-1)                        
446200              /    PV-CSTOCK-OTR-TOTALS) * PV-LEFT-TO-ALLOC)              
446300              /  PV-ALLOC-OUTR-PK-QTY                             RCKCS233
446400          PERFORM 4800-ROUND-PACKS                                        
446500          COMPUTE  PV-TOTAL-ALLOCATED                                     
446600              =    PV-TOTAL-ALLOCATED                                     
446700              +    PV-ALLOC-TOTAL                                 RCKCS233
446800      END-IF                                                              
446900                                                                          
447000      ADD  1  TO  PV-SUB-1.                                               
447100                                                                          
447200                                                                          
447300                                                                          
447400 4800-ROUND-PACKS.                                                        
447500******************************************************************RCKCS233
447600*    THIS PARAGRAPH ROUNDS ALLOCS TO THE NEAREST PACK BASED UPON  RCKCS233
447700*    THE MA PACK/SIZE ROUNDING RULE                               RCKCS233
447800******************************************************************RCKCS233
447900                                                                          
448000                                                                          
448100     MOVE  PV-ALLOC-TOTAL                                         RCKCS233
448200       TO  PV-ALLOC-TOTAL-INTEGER.                                RCKCS233
448300                                                                          
448400     MOVE  PV-ALLOC-TOTAL                                         RCKCS233
448500       TO  PV-ALLOC-TOTAL-DECIMAL.                                RCKCS233
448600                                                                          
448700                                                                          
448800                                                                          
448900     IF  ALLPLN-PK-SIZE-RND-CDE  =   PC-ALPHA-1                           
449000         IF  PV-ALLOC-TOTAL-DECIMAL  >  PC-10-PERCENT                     
449100         OR  PV-ALLOC-TOTAL-DECIMAL  =  PC-10-PERCENT                     
449200             ADD  1  TO  PV-ALLOC-TOTAL-INTEGER                           
449300         END-IF                                                           
449400     ELSE                                                                 
449500     IF  ALLPLN-PK-SIZE-RND-CDE  =   PC-ALPHA-2                           
449600         IF  PV-ALLOC-TOTAL-DECIMAL  >  PC-20-PERCENT                     
449700         OR  PV-ALLOC-TOTAL-DECIMAL  =  PC-20-PERCENT                     
449800             ADD  1  TO  PV-ALLOC-TOTAL-INTEGER                           
449900         END-IF                                                           
450000     ELSE                                                                 
450100     IF  ALLPLN-PK-SIZE-RND-CDE  =   PC-ALPHA-3                           
450200         IF  PV-ALLOC-TOTAL-DECIMAL  >  PC-30-PERCENT                     
450300         OR  PV-ALLOC-TOTAL-DECIMAL  =  PC-30-PERCENT                     
450400             ADD  1  TO  PV-ALLOC-TOTAL-INTEGER                           
450500         END-IF                                                           
450600     ELSE                                                                 
450700     IF  ALLPLN-PK-SIZE-RND-CDE  =   PC-ALPHA-4                           
450800         IF  PV-ALLOC-TOTAL-DECIMAL  >  PC-40-PERCENT                     
450900         OR  PV-ALLOC-TOTAL-DECIMAL  =  PC-40-PERCENT                     
451000             ADD  1  TO  PV-ALLOC-TOTAL-INTEGER                           
451100         END-IF                                                           
451200     ELSE                                                                 
451300     IF  ALLPLN-PK-SIZE-RND-CDE  =   PC-ALPHA-5                           
451400         IF  PV-ALLOC-TOTAL-DECIMAL  >  PC-50-PERCENT                     
451500         OR  PV-ALLOC-TOTAL-DECIMAL  =  PC-50-PERCENT                     
451600             ADD  1  TO  PV-ALLOC-TOTAL-INTEGER                           
451700         END-IF                                                           
451800     ELSE                                                                 
451900     IF  ALLPLN-PK-SIZE-RND-CDE  =   PC-ALPHA-6                           
452000         IF  PV-ALLOC-TOTAL-DECIMAL  >  PC-60-PERCENT                     
452100         OR  PV-ALLOC-TOTAL-DECIMAL  =  PC-60-PERCENT                     
452200             ADD  1  TO  PV-ALLOC-TOTAL-INTEGER                           
452300         END-IF                                                           
452400     ELSE                                                                 
452500     IF  ALLPLN-PK-SIZE-RND-CDE  =   PC-ALPHA-7                           
452600         IF  PV-ALLOC-TOTAL-DECIMAL  >  PC-70-PERCENT                     
452700         OR  PV-ALLOC-TOTAL-DECIMAL  =  PC-70-PERCENT                     
452800             ADD  1  TO  PV-ALLOC-TOTAL-INTEGER                           
452900         END-IF                                                           
453000     ELSE                                                                 
453100     IF  ALLPLN-PK-SIZE-RND-CDE  =   PC-ALPHA-8                           
453200         IF  PV-ALLOC-TOTAL-DECIMAL  >  PC-80-PERCENT                     
453300         OR  PV-ALLOC-TOTAL-DECIMAL  =  PC-80-PERCENT                     
453400             ADD  1  TO  PV-ALLOC-TOTAL-INTEGER                           
453500         END-IF                                                           
453600     ELSE                                                                 
453700     IF  ALLPLN-PK-SIZE-RND-CDE  =   PC-ALPHA-9                           
453800         IF  PV-ALLOC-TOTAL-DECIMAL  >  PC-90-PERCENT                     
453900         OR  PV-ALLOC-TOTAL-DECIMAL  =  PC-90-PERCENT                     
454000             ADD  1  TO  PV-ALLOC-TOTAL-INTEGER                           
454100         END-IF                                                           
454200     ELSE                                                                 
454300     IF  ALLPLN-PK-SIZE-RND-CDE  =   PC-U                                 
454400         IF  PV-ALLOC-TOTAL-DECIMAL  NOT =  0                             
454500             ADD  1  TO  PV-ALLOC-TOTAL-INTEGER                           
454600         END-IF                                                           
454700     ELSE                                                                 
454800     IF  ALLPLN-PK-SIZE-RND-CDE  =   PC-R                                 
454900         IF  PV-ALLOC-TOTAL-DECIMAL  >  PC-49-PERCENT                     
455000             ADD  1  TO  PV-ALLOC-TOTAL-INTEGER                           
455100         END-IF                                                           
455200     END-IF                                                               
455300     END-IF                                                               
455400     END-IF                                                               
455500     END-IF                                                               
455600     END-IF                                                               
455700     END-IF                                                               
455800     END-IF                                                               
455900     END-IF                                                               
456000     END-IF                                                               
456100     END-IF                                                               
456200     END-IF                                                               
456300                                                                          
456400                                                                          
456500                                                                          
456600     IF PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)  =  PC-ALPHA-4            RCKCS233
456700        COMPUTE PV-ALLOC-TOTAL                                            
456800            =   PV-ALLOC-TOTAL-INTEGER  *  PV-ALLOC-OUTR-PK-QTY           
456900     ELSE                                                                 
457000        COMPUTE PV-ALLOC-TOTAL                                            
457100            =   PV-ALLOC-TOTAL-INTEGER  *  RECITM-INNR-PACK-QTY           
457200     END-IF                                                               
457300                                                                          
457400                                                                          
457500     COMPUTE  PT-STR-ALLOC-TOTALS  (PV-SUB-1)                             
457600         =    PT-STR-ALLOC-TOTALS  (PV-SUB-1)                             
457700         +    PV-ALLOC-TOTAL.                                             
457800                                                                          
457900                                                                          
458000                                                                          
458100 4810-BALANCE-MA-PRORATION.                                               
458200******************************************************************RCKCS233
458300*  THIS PARAGRAPH CALLS ROUTINES WHICH BALANCE THE ALLOC IN TOTAL RCKCS233
458400******************************************************************RCKCS233
458500                                                                          
458600                                                                          
458700     COMPUTE  PV-OVER-SHORT-TOTALS                                        
458800         =    PV-LEFT-TO-ALLOC    -  PV-TOTAL-ALLOCATED                   
458900                                                                          
459000                                                                  RCKCS233
459100     IF  PV-HOLD-ALLOC-SEQ-CODE  =  PC-ALPHA-4                    RCKCS233
459200         DIVIDE      PV-ALLOC-OUTR-PK-QTY                         RCKCS233
459300           INTO      PV-OVER-SHORT-TOTALS                         RCKCS233
459400         GIVING      PV-OVER-SHORT-PACKS                          RCKCS233
459500         REMAINDER   PV-OVER-SHORT-UNITS                          RCKCS233
459600     ELSE                                                                 
459700         DIVIDE      RECITM-INNR-PACK-QTY                         RCKCS233
459800           INTO      PV-OVER-SHORT-TOTALS                         RCKCS233
459900         GIVING      PV-OVER-SHORT-PACKS                          RCKCS233
460000         REMAINDER   PV-OVER-SHORT-UNITS                          RCKCS233
460100     END-IF                                                               
460200                                                                          
460300                                                                          
460400     IF  PV-OVER-SHORT-TOTALS  NOT =  0                           RCKCS233
460500      IF PV-OVER-SHORT-PACKS  >  0                                RCKCS233
460600      OR PV-OVER-SHORT-UNITS  >  0                                RCKCS233
460700         MOVE  1  TO  PV-SUB-1                                            
460800                      PV-LOOP-COUNT                                       
460900         IF  PV-OVER-SHORT-PACKS  >  0                            RCKCS233
461000             PERFORM 4820-LOOP-ALLOC-MORE-PACKS                           
461100               UNTIL PV-OVER-SHORT-PACKS  <  1                            
461200         END-IF                                                           
461300         MOVE  1  TO  PV-LOOP-COUNT                                       
461400         IF  PV-OVER-SHORT-UNITS  >  0                            RCKCS233
461500             PERFORM 4830-LOOP-ALLOC-MORE-UNITS                           
461600               UNTIL PV-OVER-SHORT-UNITS  <  1                            
461700         END-IF                                                           
461800      ELSE                                                                
461900         MOVE  PV-STR-SUB  TO  PV-SUB-1                                   
462000         IF  PV-OVER-SHORT-PACKS  <  0                            RCKCS233
462100             MOVE  1  TO  PV-LOOP-COUNT                                   
462200             PERFORM  4840-LOOP-SUBTRACT-PACKS                            
462300               UNTIL PV-OVER-SHORT-PACKS  >  -1                           
462400         END-IF                                                           
462500         IF  PV-OVER-SHORT-UNITS  <  0                            RCKCS233
462600             MOVE  1  TO  PV-LOOP-COUNT                                   
462700             PERFORM  4850-LOOP-SUBTRACT-UNITS                            
462800               UNTIL PV-OVER-SHORT-UNITS  >  -1                           
462900         END-IF                                                           
463000      END-IF                                                              
463100     END-IF.                                                              
463200                                                                          
463300                                                                          
463400                                                                          
463500 4820-LOOP-ALLOC-MORE-PACKS.                                              
463600******************************************************************RCKCS233
463700*    THIS PARAGRAPH ALLOCATES ADDITIONAL PACKS                    RCKCS233
463800******************************************************************RCKCS233
463900                                                                          
464000     IF   PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)                         RCKCS233
464100       =  PV-HOLD-ALLOC-SEQ-CODE                                  RCKCS233
                IF TM500-AD-YES                                                 
031300             COMPUTE  PV-REMAINING-STR-OTR                        RCKCS233
464400               EQUAL  PT-STR-OTR-TOTALS-MA (PV-SUB-1)             RCKCS233
464400                  -   PT-STR-ALLOC-TOTALS  (PV-SUB-1)             RCKCS233
                        +   RECITM-INNR-PACK-QTY                                
                ELSE                                                            
031300             COMPUTE  PV-REMAINING-STR-OTR                        RCKCS233
464400               EQUAL  PT-STR-OTR-TOTALS-MA (PV-SUB-1)             RCKCS233
464400                  -   PT-STR-ALLOC-TOTALS  (PV-SUB-1)             RCKCS233
                END-IF                                                          
464200          IF PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)  =  PC-ALPHA-4       RCKCS233
031300             IF  PV-REMAINING-STR-OTR  >  PV-ALLOC-OUTR-PK-QTY    RCKCS233
031300             OR  PV-REMAINING-STR-OTR  =  PV-ALLOC-OUTR-PK-QTY    RCKCS233
467300             OR  PV-LOOP-COUNT  > (PV-STR-SUB * 2)                RCKCS233
464300                 ADD PV-ALLOC-OUTR-PK-QTY                         RCKCS233
464400                  TO PT-STR-ALLOC-TOTALS  (PV-SUB-1)              RCKCS233
464500                 SUBTRACT  1  FROM  PV-OVER-SHORT-PACKS           RCKCS233
                   END-IF                                                       
464600           ELSE                                                           
031300             IF  PV-REMAINING-STR-OTR  >  RECITM-INNR-PACK-QTY    RCKCS233
031300             OR  PV-REMAINING-STR-OTR  =  RECITM-INNR-PACK-QTY    RCKCS233
467300             OR  PV-LOOP-COUNT  > (PV-STR-SUB * 2)                RCKCS233
464700                 ADD RECITM-INNR-PACK-QTY                         RCKCS233
464800                  TO PT-STR-ALLOC-TOTALS  (PV-SUB-1)              RCKCS233
464900                 SUBTRACT  1  FROM  PV-OVER-SHORT-PACKS           RCKCS233
                   END-IF                                                       
465000           END-IF                                                         
465100     END-IF                                                               
465200                                                                  RCKCS233
465300                                                                          
465400                                                                          
465500     ADD  1  TO  PV-LOOP-COUNT.                                           
465600                                                                          
465700                                                                          
465800     IF  PV-SUB-1  =  PV-STR-SUB                                          
465900         MOVE  1  TO  PV-SUB-1                                            
466000     ELSE                                                                 
466100         ADD   1  TO  PV-SUB-1                                            
466200     END-IF.                                                              
466300                                                                          
466400                                                                          
466500                                                                          
466600 4830-LOOP-ALLOC-MORE-UNITS.                                              
466700******************************************************************RCKCS233
466800*    THIS PARAGRAPH ALLOCATES ADDITIONAL UNITS                    RCKCS233
466900******************************************************************RCKCS233
467000                                                                          
467100     IF  PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)                          RCKCS233
467200         =  PV-HOLD-ALLOC-SEQ-CODE                                RCKCS233
467300     OR  PV-LOOP-COUNT  > (PV-STR-SUB * 2)                        RCKCS233
               IF TM500-AD-YES                                                  
031300            COMPUTE  PV-REMAINING-STR-OTR                         RCKCS233
464400              EQUAL  PT-STR-OTR-TOTALS-MA (PV-SUB-1)              RCKCS233
464400                 -   PT-STR-ALLOC-TOTALS  (PV-SUB-1)              RCKCS233
                       +   RECITM-INNR-PACK-QTY                                 
               ELSE                                                             
031300            COMPUTE  PV-REMAINING-STR-OTR                         RCKCS233
464400              EQUAL  PT-STR-OTR-TOTALS-MA (PV-SUB-1)              RCKCS233
464400                 -   PT-STR-ALLOC-TOTALS  (PV-SUB-1)              RCKCS233
               END-IF                                                           
467400         IF PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)  NOT =  PC-ALPHA-4    RCKCS233
031300             IF  PV-REMAINING-STR-OTR  >  PV-OVER-SHORT-UNITS     RCKCS233
031300             OR  PV-REMAINING-STR-OTR  =  PV-OVER-SHORT-UNITS     RCKCS233
467300             OR  PV-LOOP-COUNT  > (PV-STR-SUB * 2)                RCKCS233
467500                 ADD PV-OVER-SHORT-UNITS                          RCKCS233
467600                  TO PT-STR-ALLOC-TOTALS      (PV-SUB-1)          RCKCS233
467700                 MOVE  0  TO  PV-OVER-SHORT-UNITS                 RCKCS233
                   END-IF                                                       
467800         ELSE                                                             
467900            IF  PS-STORE-NOT-IN-TABLE                             RCKCS233
031300                IF  PV-REMAINING-STR-OTR  >  PV-OVER-SHORT-UNITS  RCKCS233
031300                OR  PV-REMAINING-STR-OTR  =  PV-OVER-SHORT-UNITS  RCKCS233
467300                OR  PV-LOOP-COUNT  > (PV-STR-SUB * 2)             RCKCS233
468000                    ADD PV-OVER-SHORT-UNITS                       RCKCS233
468100                     TO PT-STR-ALLOC-TOTALS  (PV-SUB-1)           RCKCS233
468200                    MOVE  0  TO  PV-OVER-SHORT-UNITS              RCKCS233
                       END-IF                                                   
468300            END-IF                                                        
468400         END-IF                                                           
468500     END-IF                                                               
468600                                                                          
468700                                                                          
468800                                                                          
468900     ADD  1  TO  PV-LOOP-COUNT.                                           
469000                                                                          
469100                                                                          
469200     IF  PV-SUB-1  =  PV-STR-SUB                                          
469300         MOVE  1  TO  PV-SUB-1                                            
469400     ELSE                                                                 
469500         ADD   1  TO  PV-SUB-1                                            
469600     END-IF.                                                              
469700                                                                          
469800                                                                          
469900                                                                          
470000 4840-LOOP-SUBTRACT-PACKS.                                                
470100******************************************************************RCKCS233
470200*    THIS PARAGRAPH SUBTRACTS PACKS TO BALANCE THE ALLOCATION     RCKCS233
470300******************************************************************RCKCS233
470400                                                                          
470500                                                                          
470600     IF  TM500-AD-YES                                             RCKCS233
470700     AND PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)  NOT =  PC-ALPHA-4       RCKCS233
470800     AND PV-LOOP-COUNT  <  (PV-STR-SUB * 2)                       RCKCS233
470900         COMPUTE   PV-OVER-SHORT-AMT                              RCKCS233
471000             =     PT-STR-ALLOC-TOTALS  (PV-SUB-1)                        
471100             -     RECITM-INNR-PACK-QTY                                   
471200     ELSE                                                                 
471300         MOVE  PT-STR-ALLOC-TOTALS  (PV-SUB-1)                            
471400           TO  PV-OVER-SHORT-AMT                                  RCKCS233
471500     END-IF                                                               
471600                                                                          
471700                                                                          
471800     IF PT-STR-ALLOC-SEQ-CDE (PV-SUB-1) = PV-HOLD-ALLOC-SEQ-CODE  RCKCS233
471900     AND PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)  NOT =  PC-ALPHA-4       RCKCS233
472000        IF  PV-OVER-SHORT-AMT  NOT <  RECITM-INNR-PACK-QTY        RCKCS233
472100            SUBTRACT   RECITM-INNR-PACK-QTY                       RCKCS233
472200                FROM   PT-STR-ALLOC-TOTALS  (PV-SUB-1)            RCKCS233
472300            ADD  1 TO  PV-OVER-SHORT-PACKS                        RCKCS233
472400        END-IF                                                            
472500     ELSE                                                                 
472600        IF PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)                        RCKCS233
472700         = PV-HOLD-ALLOC-SEQ-CODE                                 RCKCS233
472800        AND PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)  =  PC-ALPHA-4        RCKCS233
472900            IF  PV-OVER-SHORT-AMT  NOT <  PV-ALLOC-OUTR-PK-QTY    RCKCS233
473000                SUBTRACT   PV-ALLOC-OUTR-PK-QTY                   RCKCS233
473100                    FROM   PT-STR-ALLOC-TOTALS  (PV-SUB-1)        RCKCS233
473200                ADD  1 TO  PV-OVER-SHORT-PACKS                    RCKCS233
473300            END-IF                                                        
473400        END-IF                                                            
473500     END-IF                                                               
473600                                                                          
473700                                                                  RCKCS233
473800                                                                          
473900     ADD  1  TO  PV-LOOP-COUNT.                                           
474000                                                                          
474100                                                                          
474200     IF  PV-SUB-1  =  1                                                   
474300         MOVE  PV-STR-SUB  TO  PV-SUB-1                                   
474400     ELSE                                                                 
474500         SUBTRACT  1   FROM    PV-SUB-1                                   
474600     END-IF.                                                              
474700                                                                          
474800                                                                          
474900                                                                          
475000 4850-LOOP-SUBTRACT-UNITS.                                                
475100******************************************************************RCKCS233
475200*    THIS PARAGRAPH SUBTRACTS UNITS TO BALANCE THE ALLOCATION     RCKCS233
475300******************************************************************RCKCS233
475400                                                                          
475500                                                                          
475600     IF  TM500-AD-YES                                             RCKCS233
475700     AND PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)  NOT =  PC-ALPHA-4       RCKCS233
475800     AND PV-LOOP-COUNT  <  (PV-STR-SUB * 2)                       RCKCS233
475900         COMPUTE   PV-OVER-SHORT-AMT                              RCKCS233
476000             =     PT-STR-ALLOC-TOTALS  (PV-SUB-1)                        
476100             -     RECITM-INNR-PACK-QTY                                   
476200     ELSE                                                                 
476300         MOVE  PT-STR-ALLOC-TOTALS  (PV-SUB-1)                            
476400           TO  PV-OVER-SHORT-AMT                                  RCKCS233
476500     END-IF                                                               
476600                                                                          
476700                                                                          
476800     IF PT-STR-ALLOC-SEQ-CDE (PV-SUB-1) = PV-HOLD-ALLOC-SEQ-CODE  RCKCS233
476900     AND PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)  NOT =  PC-ALPHA-4       RCKCS233
477000        IF (PV-OVER-SHORT-UNITS * -1)  NOT >  PV-OVER-SHORT-AMT   RCKCS233
477100           ADD  PV-OVER-SHORT-UNITS                               RCKCS233
477200            TO  PT-STR-ALLOC-TOTALS(PV-SUB-1)                     RCKCS233
477300           MOVE  0  TO  PV-OVER-SHORT-UNITS                       RCKCS233
477400        END-IF                                                            
477500     END-IF                                                               
477600                                                                          
477700                                                                          
477800                                                                          
477900     IF PV-LOOP-COUNT  >  (PV-STR-SUB * 2)                        RCKCS233
478000        IF (PV-OVER-SHORT-UNITS * -1)  NOT >  PV-OVER-SHORT-AMT   RCKCS233
478100           ADD  PV-OVER-SHORT-UNITS                               RCKCS233
478200            TO  PT-STR-ALLOC-TOTALS(PV-SUB-1)                     RCKCS233
478300           MOVE  0  TO  PV-OVER-SHORT-UNITS                       RCKCS233
478400        END-IF                                                            
478500     END-IF                                                               
478600                                                                          
478700                                                                  RCKCS233
478800                                                                          
478900     ADD  1  TO  PV-LOOP-COUNT.                                           
479000                                                                          
479100                                                                          
479200     IF  PV-SUB-1  =  1                                                   
479300         MOVE  PV-STR-SUB  TO  PV-SUB-1                                   
479400     ELSE                                                                 
479500         SUBTRACT  1   FROM    PV-SUB-1                                   
479600     END-IF.                                                              
479700                                                                          
479800                                                                          
479900 4900-ALLOCATE-OVERAGE.                                           RCKCS233
480000******************************************************************RCKCS233
480100*    THIS PARAGRAPH CALLS 4910 TO ALLOCATE OVERAGE QTYS.          RCKCS233
480200******************************************************************RCKCS233
480300                                                                  RCKCS233
480400                                                                          
480500     MOVE  1  TO  PV-SUB-1.                                               
480600                                                                          
480700     PERFORM 4910-LOOP-ALLOC-OVER-QUANTITY                                
480800       UNTIL PV-LEFT-TO-ALLOC  <  1.                                      
480900                                                                          
481000                                                                          
481100                                                                          
481200 4910-LOOP-ALLOC-OVER-QUANTITY.                                           
481300******************************************************************RCKCS233
481400*    THIS PARAGRAPH ALLOCS THE OVERAGE QUANTITIES TO EACH STORE   RCKCS233
481500******************************************************************RCKCS233
481600                                                                          
481700     IF PT-STR-ALLOC-SEQ-CDE (PV-SUB-1) NOT =  PC-ALPHA-4         RCKCS233
481800       IF PV-LEFT-TO-ALLOC > RECITM-INNR-PACK-QTY                 RCKCS233
481900        ADD RECITM-INNR-PACK-QTY TO PT-STR-ALLOC-TOTALS(PV-SUB-1) RCKCS233
482000        SUBTRACT RECITM-INNR-PACK-QTY FROM PV-LEFT-TO-ALLOC       RCKCS233
482100       ELSE                                                               
482200        ADD  PV-LEFT-TO-ALLOC    TO PT-STR-ALLOC-TOTALS(PV-SUB-1)         
482300        MOVE  0                  TO PV-LEFT-TO-ALLOC                      
482400       END-IF                                                     RCKCS233
482500     END-IF                                                       RCKCS233
482600                                                                  RCKCS233
482700                                                                          
482800     IF PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)  =  PC-ALPHA-4            RCKCS233
482900       IF PS-STORE-NOT-IN-TABLE                                   RCKCS233
483000         IF PV-LEFT-TO-ALLOC > PV-ALLOC-OUTR-PK-QTY               RCKCS233
483100           ADD PV-ALLOC-OUTR-PK-QTY                               RCKCS233
483200            TO PT-STR-ALLOC-TOTALS(PV-SUB-1)                      RCKCS233
483300           SUBTRACT PV-ALLOC-OUTR-PK-QTY FROM PV-LEFT-TO-ALLOC    RCKCS233
483400         ELSE                                                             
483500           ADD  PV-LEFT-TO-ALLOC TO PT-STR-ALLOC-TOTALS(PV-SUB-1)         
483600           MOVE  0               TO PV-LEFT-TO-ALLOC                      
483700         END-IF                                                   RCKCS233
483800       END-IF                                                     RCKCS233
483900     END-IF                                                       RCKCS233
484000                                                                  RCKCS233
484100                                                                          
484200     IF  PV-SUB-1  =  PV-STR-SUB                                          
484300         MOVE  1  TO  PV-SUB-1                                            
484400     ELSE                                                                 
484500         ADD   1  TO  PV-SUB-1                                            
484600     END-IF.                                                              
484700                                                                          
484800                                                                          
484900 5000-ALLOCATE-PICTURED-AD.                                       RCKCS233
485000******************************************************************RCKCS233
485100*    THIS PARAGRAPH CALLS 4490 TO ALLOCATE PICTURED AD QTYS.      RCKCS233
485200******************************************************************RCKCS233
485300                                                                  RCKCS233
485400     MOVE  1  TO  PV-SUB-1.                                               
485500                                                                  RCKCS233
485600     PERFORM 5010-LOOP-ALLOC-PICTURED-AD                                  
485700       UNTIL PV-SUB-1  >  PV-STR-SUB                                      
485800          OR PT-STR-ALLOC-SEQ-CDE (PV-SUB-1)  >  PC-ALPHA-3               
485900          OR PV-LEFT-TO-ALLOC  <  1.                                      
486000                                                                          
486100                                                                          
486200 5010-LOOP-ALLOC-PICTURED-AD.                                             
486300******************************************************************RCKCS233
486400*    THIS PARAGRAPH ALLOCS THE 1 PACK TO SATISFY PICTURED AD      RCKCS233
486500******************************************************************RCKCS233
486600                                                                          
486700     IF  PT-STR-ALLOC-SEQ-CDE (PV-SUB-1) NOT =  PC-ALPHA-4        RCKCS233
486800     AND PT-STR-REC-QTY       (PV-SUB-1) < RECITM-INNR-PACK-QTY   RCKCS233
486900      IF PV-LEFT-TO-ALLOC > RECITM-INNR-PACK-QTY                  RCKCS233
487000        ADD RECITM-INNR-PACK-QTY TO PT-STR-ALLOC-TOTALS(PV-SUB-1) RCKCS233
487100        SUBTRACT RECITM-INNR-PACK-QTY                             RCKCS233
487200            FROM PT-STR-OTR-TOTALS-MA  (PV-SUB-1)                 RCKCS233
487300        SUBTRACT RECITM-INNR-PACK-QTY FROM PV-LEFT-TO-ALLOC       RCKCS233
487400        PERFORM  5020-SUBTRACT-INNR-PACK-QTY                              
487500      ELSE                                                                
487600        ADD PV-LEFT-TO-ALLOC    TO PT-STR-ALLOC-TOTALS(PV-SUB-1)          
487700        SUBTRACT PV-LEFT-TO-ALLOC                                 RCKCS233
487800            FROM PT-STR-OTR-TOTALS-MA  (PV-SUB-1)                 RCKCS233
487900        MOVE  0                 TO PV-LEFT-TO-ALLOC                       
488000      END-IF                                                      RCKCS233
488100     END-IF                                                       RCKCS233
488200                                                                  RCKCS233
488300                                                                  RCKCS233
488400     ADD   1  TO  PV-SUB-1.                                               
488500                                                                          
488600                                                                          
488700                                                                          
488800 5020-SUBTRACT-INNR-PACK-QTY.                                             
488900******************************************************************RCKCS233
489000*    THIS PARAGRAPH SUBTRACTS PICTURED AD ALLOCATION QTYS FROM    RCKCS233
489100*    THE APPROPRIATE SEQUENCE CODE GROUP                          RCKCS233
489200******************************************************************RCKCS233
489300                                                                          
489400      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-1         RCKCS233
489500          COMPUTE PV-FILL-FIRST-OTR-TOTALS                        RCKCS233
489600               =  PV-FILL-FIRST-OTR-TOTALS                        RCKCS233
489700               -  RECITM-INNR-PACK-QTY                            RCKCS233
489800      ELSE                                                        RCKCS233
489900      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-2         RCKCS233
490000          COMPUTE PV-STANDARD-OTR-TOTALS                          RCKCS233
490100               =  PV-STANDARD-OTR-TOTALS                          RCKCS233
490200               -  RECITM-INNR-PACK-QTY                            RCKCS233
490300      ELSE                                                        RCKCS233
490400      IF  PT-STR-ALLOC-SEQ-CDE  (PV-SUB-1)  =  PC-ALPHA-3         RCKCS233
490500          COMPUTE PV-FILL-LAST-OTR-TOTALS                         RCKCS233
490600               =  PV-FILL-LAST-OTR-TOTALS                         RCKCS233
490700               -  RECITM-INNR-PACK-QTY                            RCKCS233
490800      END-IF                                                      RCKCS233
490900      END-IF                                                      RCKCS233
491000      END-IF.                                                     RCKCS233
491100/                                                                         
491500 9999-RETURN-MSG.                                                 RCKCS233
491600******************************************************************RCKCS233
491700*    THIS PARAGRAPH BUILDS AN ABEND MESSAGE                       RCKCS233
491800******************************************************************RCKCS233
491900                                                                  RCKCS233
492000     COMPUTE PRV-OP = TM500-OPER-UNT-ID * 1.                      RCKCS233
492100     COMPUTE PV-FCLTY-N = TM500-FCLTY-ID * 1.                     RCKCS233
492200     COMPUTE PV-PO-N = TM500-PO-NBR      * 1.                     RCKCS233
492300     COMPUTE PV-LINE-N = TM500-PO-LNE-NBR * 1.                    RCKCS233
492400     COMPUTE PV-REC-SEQ-NBR-N = TM500-REC-SEQ-NBR * 1.            RCKCS233
492500                                                                  RCKCS233
492600     MOVE '233'                 TO PRV-PGM.                       RCKCS233
492800     MOVE PV-FCLTY              TO PRV-FCLTY.                     RCKCS233
492900     MOVE PV-PO                 TO PRV-PO.                        RCKCS233
493000     MOVE PV-LINE               TO PRV-LINE.                      RCKCS233
493100     MOVE PV-REC-SEQ-NBR        TO PRV-REC-SEQ-NBR.               RCKCS233
493200                                                                  RCKCS233
493300     MOVE PRV-TM500-RETURN-MSG  TO TM500-RETURN-MSG.              RCKCS233
