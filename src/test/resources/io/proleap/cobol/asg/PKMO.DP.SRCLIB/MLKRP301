       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    MLKRP301.                                                 
       AUTHOR.        TAISA KONTAROVICH.                                        
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  06-07-2002.                                               
       DATE-COMPILED.                                                           
      ******************************************************************        
      *                                                                         
      * MLKRP301 - DESCRIPTION.............                                     
      *                                                                         
      * THIS PROGRAM WILL READ A COMPOSITE TRANSACTION FILE AND CREATE          
      * A REPORT CONTAINING A GRAND TOTAL.                                      
      *                                                                         
      ******************************************************************        
      ******************************************************************        
      *                                                                         
       ENVIRONMENT DIVISION.                                                    
      *                                                                         
       CONFIGURATION SECTION.                                                   
      *                                                                         
       SOURCE-COMPUTER.        IBM-3090.                                        
       OBJECT-COMPUTER.        IBM-3090.                                        
      *                                                                         
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT OPTIONAL CONTROL-DATE-FILE                                    
               ASSIGN TO INP01.                                                 
                                                                                
           SELECT OPTIONAL COMPOSIT-FILE                                        
               ASSIGN TO INP02.                                                 
                                                                                
           SELECT REPORT-FILE                                                   
               ASSIGN TO RPT01.                                                 
                                                                                
      ******************************************************************        
       DATA DIVISION.                                                           
      ******************************************************************        
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD  CONTROL-DATE-FILE                                                    
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  CONTROL-DATE-RECORD             PIC X(80).                           
                                                                                
       FD  COMPOSIT-FILE                                                        
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
W26603     COPY MLRD020.                                                        
                                                                                
       FD  REPORT-FILE                                                          
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  REPORT-RECORD                   PIC X(132).                          
                                                                                
      *                                                                         
      ******************************************************************        
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
                                                                                
       01 ABEND-AREAS.                                                          
           05  ABEND-CODE                  PIC S9(04)      VALUE ZEROES         
                               COMP SYNC.                                       
               88  INVALID-TRANS-TYPE-ABEND                VALUE +4003.         
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-END-OF-CONTROL-FILE-SW   PIC X           VALUE 'N'.           
               88  PS-END-OF-CONTROL                       VALUE 'Y'.           
           05  PS-END-OF-COMPOSIT-FILE-SW  PIC X           VALUE 'N'.           
               88  PS-END-OF-COMPOSIT                      VALUE 'Y'.           
                                                                                
       01  PA-PROGRAM-ACCUMULATORS.                                             
      * RECORD COUNT                                                            
           05  PA-INPUT-RECORDS            PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-RECORD-PROCESSED         PIC S9(07)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PURCH-READ               PIC S9(07)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-SALE-READ                PIC S9(07)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-TRANSFER-READ            PIC S9(07)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-MARKDOWN-READ            PIC S9(07)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-MARKUP-READ              PIC S9(07)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-ADJUSTMENT-READ          PIC S9(07)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-INPUT-RECORDS-TOT        PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-RECORD-PROCESSED-TOT     PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PURCH-READ-TOT           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-SALE-READ-TOT            PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-TRANSFER-READ-TOT        PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-MARKDOWN-READ-TOT        PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-MARKUP-READ-TOT          PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-ADJUSTMENT-READ-TOT      PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-RECORD-PROCESSED-GRND-TOT PIC S9(09)     VALUE ZEROES         
                               COMP-3.                                          
      * DOLLAR TALLY                                                            
           05  PA-PURCH-FREIGHT-TOT        PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PURCH-DISCOUNT-TOT       PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PURCH-NET-COST-TOT       PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
TAISAK     05  PA-PURCH-ADJ-NET-COST-TOT  PIC S9(08)V99   VALUE ZEROES          
TAISAK                         COMP-3.                                          
TAISAK     05  PA-PURCH-REC-NET-COST-TOT  PIC S9(08)V99   VALUE ZEROES          
TAISAK                         COMP-3.                                          
TAISAK     05  PA-PURCH-TRF-NET-COST-TOT  PIC S9(08)V99   VALUE ZEROES          
TAISAK                         COMP-3.                                          
           05  PA-PURCH-GRO-COST-TOT       PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PURCH-EXT-RTL-TOT        PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
TAISAK     05  PA-PURCH-ADJ-EXT-RTL-TOT    PIC S9(08)V99   VALUE ZEROES         
TAISAK                         COMP-3.                                          
TAISAK     05  PA-PURCH-REC-EXT-RTL-TOT    PIC S9(08)V99   VALUE ZEROES         
TAISAK                         COMP-3.                                          
TAISAK     05  PA-PURCH-TRF-EXT-RTL-TOT    PIC S9(08)V99   VALUE ZEROES         
TAISAK                         COMP-3.                                          
           05  PA-SALE-RTL-TOT             PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-XFER-RTL-TOT             PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKDOWN-OLD-RTL-TOT    PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKDOWN-NEW-RTL-TOT    PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKDOWN-EXT-RTL-TOT    PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKUP-OLD-RTL-TOT      PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKUP-NEW-RTL-TOT      PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKUP-EXT-RTL-TOT      PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-ADJ-RTL-TOT              PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-ADJ-COST-TOT             PIC S9(08)V99   VALUE ZEROES         
                               COMP-3.                                          
      * DOLLAR GRAND TALLY                                                      
           05  PA-PURCH-FREIGHT-GRND-TOT   PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PURCH-DISCOUNT-GRND-TOT  PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PURCH-NET-COST-GRND-TOT  PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
TAISAK     05  PA-PURCH-ADJ-NCOST-GRND-TOT PIC S9(10)V99   VALUE ZEROES         
TAISAK                         COMP-3.                                          
TAISAK     05  PA-PURCH-REC-NCOST-GRND-TOT PIC S9(10)V99   VALUE ZEROES         
TAISAK                         COMP-3.                                          
TAISAK     05  PA-PURCH-TRF-NCOST-GRND-TOT PIC S9(10)V99   VALUE ZEROES         
TAISAK                         COMP-3.                                          
           05  PA-PURCH-GRO-COST-GRND-TOT  PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PURCH-EXT-RTL-GRND-TOT   PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
TAISAK     05  PA-PURCH-ADJ-ERTL-GRND-TOT   PIC S9(10)V99   VALUE ZEROES        
TAISAK                         COMP-3.                                          
TAISAK     05  PA-PURCH-REC-ERTL-GRND-TOT   PIC S9(10)V99   VALUE ZEROES        
TAISAK                         COMP-3.                                          
TAISAK     05  PA-PURCH-TRF-ERTL-GRND-TOT   PIC S9(10)V99   VALUE ZEROES        
TAISAK                         COMP-3.                                          
           05  PA-SALE-RTL-GRND-TOT        PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-XFER-RTL-GRND-TOT        PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKDOWN-OLD-RTL-GRND-TOT PIC S9(10)V99 VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKDOWN-NEW-RTL-GRND-TOT PIC S9(10)V99 VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKDOWN-EXT-RTL-GRND-TOT PIC S9(10)V99 VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKUP-OLD-RTL-GRND-TOT PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKUP-NEW-RTL-GRND-TOT PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PC-MKUP-EXT-RTL-GRND-TOT PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-ADJ-RTL-GRND-TOT         PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PA-ADJ-COST-GRND-TOT        PIC S9(10)V99   VALUE ZEROES         
                               COMP-3.                                          
      *                                                                         
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-PROGRAM-NAME             PIC X(08)       VALUE                
               'MLBRP020'.                                                      
           05  PC-REPORT-NUMBER            PIC X(01)       VALUE '1'.           
           05  PC-MAX-LINE-COUNT           PIC S9(04)      VALUE +58            
                               COMP.                                            
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-CLASS-NBR-HOLD           PIC 9(04)       VALUE ZEROES.        
           05  PV-DEPT-NBR-HOLD            PIC 9(04)       VALUE ZEROES.        
           05  PV-STORE-NBR-HOLD           PIC 9(05)       VALUE ZEROES.        
           05  PV-TRANS-CDE-HOLD           PIC X(02)       VALUE SPACES.        
               88  PV-PURCHASE-TRN                         VALUE '10'.          
               88  PV-SALE-TRN                             VALUE '20'.          
               88  PV-TRANSFER-TRN                         VALUE '30'.          
               88  PV-PRICE-CHANGE-TRN                     VALUE                
                   '40' '50'.                                                   
               88  PV-MARKDOWN-TRN                         VALUE '40'.          
               88  PV-MARKUP-TRN                           VALUE '50'.          
               88  PV-ADJUSTMENT-TRN                       VALUE '80'.          
           05  PV-TIME-HHMMSS.                                                  
               10  PV-TIME-HHMMSS-HH       PIC X(02)       VALUE SPACES.        
               10  PV-TIME-HHMMSS-MM       PIC X(02)       VALUE SPACES.        
               10  PV-TIME-HHMMSS-SS       PIC X(02)       VALUE SPACES.        
           05  PV-DATE-YYMMDD.                                                  
               10  PV-DATE-YYMMDD-YY       PIC X(02)       VALUE SPACES.        
               10  PV-DATE-YYMMDD-MM       PIC X(02)       VALUE SPACES.        
               10  PV-DATE-YYMMDD-DD       PIC X(02)       VALUE SPACES.        
           05  PV-ADVANCE-LINE             PIC S9(04)      VALUE +1             
                               COMP.                                            
           05  PV-LINE-COUNT               PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
           05  PV-PAGE-COUNT               PIC S9(05)      VALUE ZEROES         
                               COMP.                                            
           05  PV-CALC-EXT-RTL             PIC S9(09)V99   VALUE ZEROES         
                               COMP-3.                                          
      *                                                                         
       01  CC-CONTROL-CARD.                                                     
           05  CC-CURRENT-DATE.                                                 
               10  CC-CURR-CC              PIC X(02)       VALUE SPACES.        
               10  CC-CURR-YY              PIC X(02)       VALUE SPACES.        
               10  FILLER                  PIC X(01)       VALUE '-'.           
               10  CC-CURR-MM              PIC X(02)       VALUE SPACES.        
               10  FILLER                  PIC X(01)       VALUE '-'.           
               10  CC-CURR-DD              PIC X(02)       VALUE SPACES.        
               10  FILLER                  PIC X(01)       VALUE SPACE.         
               10  CC-REPORT-TYPE          PIC X(08)       VALUE SPACES.        
                   88  CC-VALID-RPT                        VALUES ARE           
                       'ALL' SPACES                                             
                       'STORE'                                                  
                       'STOREDPT'                                               
                       'STORECLS'                                               
                       'DEPT'                                                   
                       'DEPTCLS'                                                
                       'CLASS'.                                                 
                   88  CC-ALL-RPT                          VALUES ARE           
                       'ALL' SPACES.                                            
                   88  CC-VALID-STORE-RPT                  VALUES ARE           
                       'ALL' SPACES                                             
                       'STORE'                                                  
                       'STOREDPT'                                               
                       'STORECLS'.                                              
                   88  CC-STORE-RPT                        VALUE                
                       'STORE'.                                                 
                   88  CC-STORE-DEPT-RPT                   VALUE                
                       'STOREDPT'.                                              
                   88  CC-STORE-CLASS-RPT                  VALUE                
                       'STORECLS'.                                              
                   88  CC-VALID-DEPT-RPT                   VALUES ARE           
                       'ALL' SPACES                                             
                       'STOREDPT'                                               
                       'DEPT'                                                   
                       'DEPTCLS'.                                               
                   88  CC-DEPT-RPT                         VALUE                
                       'DEPT'.                                                  
                   88  CC-DEPT-CLASS-RPT                   VALUE                
                       'DEPTCLS'.                                               
                   88  CC-VALID-CLASS-RPT                  VALUES ARE           
                       'ALL' SPACES                                             
                       'STORECLS'                                               
                       'DEPTCLS'                                                
                       'CLASS'.                                                 
                   88  CC-CLASS-RPT                        VALUE                
                       'CLASS'.                                                 
               10  FILLER                  PIC X(01)       VALUE SPACES.        
               10  CC-TRAN-TYPE            PIC X(10)       VALUE SPACES.        
                   88  CC-PURCH-TRN                        VALUE                
                       'PURCHASE'.                                              
                   88  CC-SALE-TRN                         VALUE                
                       'SALE'.                                                  
                   88  CC-TRANSFER-TRN                     VALUE                
                       'TRANSFER'.                                              
                   88  CC-PRICE-CHANGE-TRN                 VALUE                
                       'PRICECHG'.                                              
                   88  CC-MARKUP-TRN                       VALUE                
                       'MARKUP'.                                                
                   88  CC-MARKDOWN-TRN                     VALUE                
                       'MARKDOWN'.                                              
                   88  CC-ADJUSTMENT-TRN                   VALUE                
                       'ADJUSTMENT'.                                            
                   88  CC-ALL-TRN                          VALUES ARE           
                       'ALL' SPACES.                                            
               10  FILLER                  PIC X(01)       VALUE SPACES.        
               10  CC-SPECIAL-REQ          PIC X(08)       VALUE SPACES.        
                   88  CC-09910-REQ                        VALUE                
                       '09910'.                                                 
                   88  CC-DATE-FILTER-REQ                  VALUE                
                       'USE DATE'.                                              
                                                                                
W26603*01  ML020-COMPOSITE-RECORD.                                              
W26603*    COPY MLRD020.                                                        
                                                                                
      *01  01  DP132O-CNFDL-HDR-132-COLS.                                       
           COPY DPWS132O.                                                       
                                                                                
      ******************************************************************        
      ***  REPORT TITLE LINE 1                                                  
      ******************************************************************        
       01  HEADER-TITLE-LINE-1.                                                 
           05  FILLER                      PIC X(51)       VALUE SPACES.        
           05  FILLER                      PIC X(29)       VALUE                
               'COMPOSITE TRANSACTIONS DETAIL'.                                 
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(22)       VALUE SPACES.        
               88  HD1-09910-REVERSAL                      VALUE                
                   '(099-10 REVERSALS)    '.                                    
               88  HD1-09910-ALLOCATION                    VALUE                
                   '(099-10 RE-ALLOCATION)'.                                    
               88  HD1-DATE-FILTER                         VALUE                
                   '(DATE FILTERED)       '.                                    
           05  FILLER                      PIC X(29)       VALUE SPACES.        
                                                                                
      ******************************************************************        
      ***  COLUMN HEADING LINE 1                                                
      ******************************************************************        
       01  RP-COLUMN-HEADER-LINE-1.                                             
           05  FILLER                      PIC X(10)       VALUE                
                                                           'TRANS TYPE'.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(05)       VALUE                
                                                           'STORE'.             
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(04)       VALUE 'DEPT'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(05)       VALUE                
                                                           'CLASS'.             
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-CH-FREIGHT                           VALUE                
                   '       FREIGHT '.                                           
               88  RP-CH-SALES                             VALUE                
                   '         SALES '.                                           
               88  RP-CH-XFER-RETAIL                       VALUE                
                   '  TRANSFER RTL '.                                           
               88  RP-CH-OLD-PRICE                         VALUE                
                   '     OLD PRICE '.                                           
               88  RP-CH-ADJ-RETAIL                        VALUE                
                   '   ADJ. RETAIL '.                                           
               88  RP-CH-1-OFF                             VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-CH-DISCOUNT                          VALUE                
                   '      DISCOUNT '.                                           
               88  RP-CH-NEW-PRICE                         VALUE                
                   '     NEW PRICE '.                                           
               88  RP-CH-ADJ-COST                          VALUE                
                   '     ADJ. COST '.                                           
               88  RP-CH-2-OFF                             VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-CH-EXT-RETAIL                        VALUE                
                   '   EXT. RETAIL '.                                           
               88  RP-CH-3-OFF                             VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-CH-NET-COST                          VALUE                
                   '      NET COST '.                                           
               88  RP-CH-4-OFF                             VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-CH-GRO-COST                          VALUE                
                   '    GROSS COST '.                                           
               88  RP-CH-5-OFF                             VALUE SPACES.        
           05  FILLER                      PIC X(08)       VALUE SPACES.        
                                                                                
      ******************************************************************        
      ***  COLUMN HEADING LINE 2                                                
      ******************************************************************        
       01  RP-COLUMN-HEADER-LINE-2.                                             
           05  FILLER                      PIC X(10)      VALUE ALL '-'.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(05)      VALUE ALL '-'.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(04)      VALUE ALL '-'.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(04)      VALUE ALL '-'.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-CL-1-ON                             VALUE ALL '-'.        
               88  RP-CL-1-OFF                             VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-CL-2-ON                             VALUE ALL '-'.        
               88  RP-CL-2-OFF                             VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-CL-3-ON                             VALUE ALL '-'.        
               88  RP-CL-3-OFF                             VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-CL-4-ON                             VALUE ALL '-'.        
               88  RP-CL-4-OFF                             VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-CL-5-ON                             VALUE ALL '-'.        
               88  RP-CL-5-OFF                             VALUE SPACES.        
           05  FILLER                      PIC X(08)       VALUE SPACES.        
                                                                                
      ******************************************************************        
      ***  REPORT DETAIL LINES                                                  
      ******************************************************************        
       01  RP-DETAIL-LINE.                                                      
           05  RP-DL-TRAN-TYPE             PIC X(10)       VALUE SPACES.        
               88  RP-DL-PURCH-DR                          VALUE                
                   'PURCH DR'.                                                  
               88  RP-DL-PURCH-CR                          VALUE                
                   'PURCH CR'.                                                  
               88  RP-DL-SALE                              VALUE                
                   'SALE'.                                                      
               88  RP-DL-TRANSFER                          VALUE                
                   'TRANSFER'.                                                  
               88  RP-DL-MARKDOWN                          VALUE                
                   'MARK DOWN'.                                                 
               88  RP-DL-MARKUP                            VALUE                
                   'MARK UP'.                                                   
               88  RP-DL-ADJUSTMENT                        VALUE                
                   'ADJUSTMENT'.                                                
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-DL-STORE-NBR             PIC Z9999       VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-DL-DEPT                  PIC Z999        VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-DL-CLASS                 PIC Z999        VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-DL-TOTAL-1               PIC Z,ZZZ,ZZZ,ZZ9.99-                
                                                           VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-DL-TOTAL-2               PIC Z,ZZZ,ZZZ,ZZ9.99-                
                                                           VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-DL-TOTAL-3               PIC Z,ZZZ,ZZZ,ZZ9.99-                
                                                           VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-DL-TOTAL-4               PIC Z,ZZZ,ZZZ,ZZ9.99-                
                                                           VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-DL-TOTAL-5               PIC Z,ZZZ,ZZZ,ZZ9.99-                
                                                           VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(08)       VALUE SPACES.        
                                                                                
      ******************************************************************        
      ***  REPORT SUB-TOTAL LINE 1                                              
      ******************************************************************        
       01  RP-SUB-TOTAL-LINE-1.                                                 
           05  FILLER                      PIC X(10)      VALUE SPACES.         
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(05)       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(04)       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(04)       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-SL-TOTAL-1-ON                       VALUE ALL '-'.        
               88  RP-SL-TOTAL-1-OFF                       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-SL-TOTAL-2-ON                       VALUE ALL '-'.        
               88  RP-SL-TOTAL-2-OFF                       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-SL-TOTAL-3-ON                       VALUE ALL '-'.        
               88  RP-SL-TOTAL-3-OFF                       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-SL-TOTAL-4-ON                       VALUE ALL '-'.        
               88  RP-SL-TOTAL-4-OFF                       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(17)       VALUE SPACES.        
               88  RP-SL-TOTAL-5-ON                       VALUE ALL '-'.        
               88  RP-SL-TOTAL-5-OFF                       VALUE SPACES.        
           05  FILLER                      PIC X(08)       VALUE SPACES.        
                                                                                
      ******************************************************************        
      ***  REPORT SUB-TOTAL LINE 2                                              
      ******************************************************************        
       01  RP-SUB-TOTAL-LINE-2.                                                 
TAISAK     05  FILLER                      PIC X(1)       VALUE SPACES.         
TAISAK     05  RP-SL-TOT-TYPE              PIC X(16)      VALUE SPACES.         
TAISAK*    05  FILLER                      PIC X(02)       VALUE SPACES.        
TAISAK*    05  FILLER                      PIC X(05)       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(04)       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(04)       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-ST-TOTAL-1               PIC Z,ZZZ,ZZZ,ZZ9.99-                
                                                           VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-ST-TOTAL-2               PIC Z,ZZZ,ZZZ,ZZ9.99-                
                                                           VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-ST-TOTAL-3               PIC Z,ZZZ,ZZZ,ZZ9.99-                
                                                           VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-ST-TOTAL-4               PIC Z,ZZZ,ZZZ,ZZ9.99-                
                                                           VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-ST-TOTAL-5               PIC Z,ZZZ,ZZZ,ZZ9.99-                
                                                           VALUE ZEROES         
                               BLANK WHEN ZEROES.                               
           05  FILLER                      PIC X(08)       VALUE SPACES.        
                                                                                
      ******************************************************************        
      ***  REPORT END OF REPORT LINE                                            
      ******************************************************************        
       01  RP-END-OF-REPORT-LINE.                                               
           05  FILLER                      PIC X(55)       VALUE SPACES.        
           05  FILLER                      PIC X(21)       VALUE                
               '*** END OF REPORT ***'.                                         
                                                                                
       EJECT                                                                    
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
       0000-MAINLINE-MLBRP020.                                                  
                                                                                
           PERFORM 1000-INITIALIZATION.                                         
                                                                                
           PERFORM 4100-READ-COMPOSIT-FILE.                                     
           PERFORM 2000-MAIN-PROCESS                                            
               UNTIL PS-END-OF-COMPOSIT.                                        
                                                                                
           PERFORM 8000-EOJ.                                                    
                                                                                
           STOP RUN.                                                            
                                                                                
                                                                                
       1000-INITIALIZATION.                                                     
                                                                                
           OPEN INPUT  CONTROL-DATE-FILE                                        
                       COMPOSIT-FILE                                            
                OUTPUT REPORT-FILE.                                             
                                                                                
           ACCEPT PV-DATE-YYMMDD FROM DATE.                                     
           ACCEPT PV-TIME-HHMMSS FROM TIME.                                     
                                                                                
           MOVE ZEROES TO PV-PAGE-COUNT.                                        
                                                                                
           PERFORM 4000-READ-DATE-FILE.                                         
           IF PS-END-OF-CONTROL                                                 
               DISPLAY ' NO CONTROL, DEFAULT TO DATE: '                         
                       PV-DATE-YYMMDD                                           
               MOVE PV-DATE-YYMMDD-MM  TO DP132O-RUN-MONTH                      
                                          CC-CURR-MM                            
               MOVE PV-DATE-YYMMDD-DD  TO DP132O-RUN-DAY                        
                                          CC-CURR-DD                            
               MOVE PV-DATE-YYMMDD-YY  TO DP132O-RUN-YEAR                       
                                          CC-CURR-YY                            
               SET CC-ALL-TRN          TO TRUE                                  
           ELSE                                                                 
               DISPLAY ' REQUEST CONTROL: ' CC-CONTROL-CARD                     
               MOVE CC-CURR-MM         TO DP132O-RUN-MONTH                      
               MOVE CC-CURR-DD         TO DP132O-RUN-DAY                        
               MOVE CC-CURR-YY         TO DP132O-RUN-YEAR                       
           END-IF.                                                              
                                                                                
           MOVE PV-TIME-HHMMSS-HH  TO DP132O-RUN-HOUR.                          
           MOVE PV-TIME-HHMMSS-MM  TO DP132O-RUN-MINUTE.                        
           MOVE PC-PROGRAM-NAME    TO DP132O-PROGRAM-NAME.                      
           MOVE PC-REPORT-NUMBER   TO DP132O-REPORT-NUMBER.                     
                                                                                
                                                                                
       2000-MAIN-PROCESS.                                                       
                                                                                
           MOVE ZEROES              TO PV-LINE-COUNT.                           
                                                                                
           MOVE ZEROES              TO PA-RECORD-PROCESSED-TOT.                 
                                                                                
           MOVE ML020-TRANS-CDE     TO PV-TRANS-CDE-HOLD.                       
           EVALUATE TRUE                                                        
               WHEN PV-PURCHASE-TRN                                             
                   CONTINUE                                                     
               WHEN PV-SALE-TRN                                                 
                   SET RP-DL-SALE       TO TRUE                                 
               WHEN PV-TRANSFER-TRN                                             
                   SET RP-DL-TRANSFER   TO TRUE                                 
               WHEN PV-PRICE-CHANGE-TRN                                         
                   IF PV-MARKDOWN-TRN                                           
                       SET RP-DL-MARKDOWN   TO TRUE                             
                   ELSE                                                         
                       SET RP-DL-MARKUP     TO TRUE                             
                   END-IF                                                       
               WHEN PV-ADJUSTMENT-TRN                                           
                   SET RP-DL-ADJUSTMENT TO TRUE                                 
               WHEN OTHER                                                       
                   SET INVALID-TRANS-TYPE-ABEND TO TRUE                         
                   PERFORM 9900-COMMON-ABEND-ROUTINE                            
           END-EVALUATE.                                                        
                                                                                
           MOVE ZEROES              TO RP-ST-TOTAL-1                            
                                       RP-ST-TOTAL-2                            
                                       RP-ST-TOTAL-3                            
                                       RP-ST-TOTAL-4                            
                                       RP-ST-TOTAL-5.                           
                                                                                
           PERFORM 2100-TRANS-PROCESS                                           
               UNTIL PS-END-OF-COMPOSIT                                         
                   OR ML020-TRANS-CDE NOT = PV-TRANS-CDE-HOLD.                  
                                                                                
           IF PA-RECORD-PROCESSED-TOT > 0                                       
               ADD PA-RECORD-PROCESSED-TOT                                      
                   TO PA-RECORD-PROCESSED-GRND-TOT                              
               PERFORM 5400-WRITE-TOTAL-LINES                                   
           END-IF.                                                              
                                                                                
                                                                                
       2100-TRANS-PROCESS.                                                      
                                                                                
           MOVE ZEROES              TO PA-RECORD-PROCESSED.                     
                                                                                
           MOVE ZEROES              TO RP-DL-TOTAL-1                            
                                       RP-DL-TOTAL-2                            
                                       RP-DL-TOTAL-3                            
                                       RP-DL-TOTAL-4                            
                                       RP-DL-TOTAL-5.                           
                                                                                
           MOVE ZEROES              TO PV-STORE-NBR-HOLD                        
                                       PV-DEPT-NBR-HOLD                         
                                       PV-CLASS-NBR-HOLD.                       
                                                                                
           IF CC-VALID-STORE-RPT                                                
               MOVE ML020-STORE-NBR-9   TO PV-STORE-NBR-HOLD                    
           END-IF.                                                              
                                                                                
           IF CC-VALID-DEPT-RPT                                                 
               MOVE ML020-DEPT-NBR      TO PV-DEPT-NBR-HOLD                     
           END-IF.                                                              
                                                                                
           IF CC-VALID-CLASS-RPT                                                
               MOVE ML020-CLASS-NBR     TO PV-CLASS-NBR-HOLD                    
           END-IF.                                                              
                                                                                
           MOVE ZEROES              TO PA-PURCH-READ                            
                                       PA-SALE-READ                             
                                       PA-TRANSFER-READ                         
                                       PA-MARKDOWN-READ                         
                                       PA-MARKUP-READ                           
                                       PA-ADJUSTMENT-READ.                      
                                                                                
           MOVE ZEROES              TO PA-PURCH-FREIGHT-TOT                     
                                       PA-PURCH-DISCOUNT-TOT                    
                                       PA-PURCH-NET-COST-TOT                    
TAISAK                                 PA-PURCH-ADJ-NET-COST-TOT                
TAISAK                                 PA-PURCH-REC-NET-COST-TOT                
TAISAK                                 PA-PURCH-TRF-NET-COST-TOT                
                                       PA-PURCH-GRO-COST-TOT                    
                                       PA-PURCH-EXT-RTL-TOT                     
TAISAK                                 PA-PURCH-ADJ-EXT-RTL-TOT                 
TAISAK                                 PA-PURCH-REC-EXT-RTL-TOT                 
TAISAK                                 PA-PURCH-TRF-EXT-RTL-TOT                 
                                       PA-SALE-RTL-TOT                          
                                       PA-XFER-RTL-TOT                          
                                       PA-PC-MKDOWN-OLD-RTL-TOT                 
                                       PA-PC-MKDOWN-NEW-RTL-TOT                 
                                       PA-PC-MKDOWN-EXT-RTL-TOT                 
                                       PA-PC-MKUP-OLD-RTL-TOT                   
                                       PA-PC-MKUP-NEW-RTL-TOT                   
                                       PA-PC-MKUP-EXT-RTL-TOT                   
                                       PA-ADJ-RTL-TOT                           
                                       PA-ADJ-COST-TOT.                         
                                                                                
           PERFORM 2200-PROCESS-COMPOSIT-FILE                                   
               UNTIL PS-END-OF-COMPOSIT                                         
                   OR ML020-TRANS-CDE NOT = PV-TRANS-CDE-HOLD                   
                   OR (CC-VALID-STORE-RPT                                       
                       AND ML020-STORE-NBR-9 NOT = PV-STORE-NBR-HOLD)           
                   OR (CC-VALID-DEPT-RPT                                        
                       AND ML020-DEPT-NBR NOT = PV-DEPT-NBR-HOLD)               
                   OR (CC-VALID-CLASS-RPT                                       
                       AND ML020-CLASS-NBR NOT = PV-CLASS-NBR-HOLD).            
                                                                                
           IF PA-RECORD-PROCESSED > 0                                           
               ADD PA-RECORD-PROCESSED TO PA-RECORD-PROCESSED-TOT               
TAISAK*        PERFORM 5300-WRITE-SUBTOTAL-LINES                                
           END-IF.                                                              
                                                                                
           ADD PA-PURCH-READ       TO PA-PURCH-READ-TOT.                        
           ADD PA-SALE-READ        TO PA-SALE-READ-TOT.                         
           ADD PA-TRANSFER-READ    TO PA-TRANSFER-READ-TOT.                     
           ADD PA-MARKDOWN-READ    TO PA-MARKDOWN-READ-TOT.                     
           ADD PA-MARKUP-READ      TO PA-MARKUP-READ-TOT.                       
           ADD PA-ADJUSTMENT-READ  TO PA-ADJUSTMENT-READ-TOT.                   
                                                                                
           ADD PA-PURCH-FREIGHT-TOT   TO PA-PURCH-FREIGHT-GRND-TOT.             
           ADD PA-PURCH-DISCOUNT-TOT                                            
               TO PA-PURCH-DISCOUNT-GRND-TOT.                                   
           ADD PA-PURCH-NET-COST-TOT  TO PA-PURCH-NET-COST-GRND-TOT.            
TAISAK     ADD PA-PURCH-ADJ-NET-COST-TOT  TO                                    
TAISAK                             PA-PURCH-ADJ-NCOST-GRND-TOT.                 
TAISAK     ADD PA-PURCH-REC-NET-COST-TOT  TO                                    
TAISAK                             PA-PURCH-REC-NCOST-GRND-TOT.                 
TAISAK     ADD PA-PURCH-TRF-NET-COST-TOT  TO                                    
TAISAK                             PA-PURCH-TRF-NCOST-GRND-TOT.                 
           ADD PA-PURCH-GRO-COST-TOT  TO PA-PURCH-GRO-COST-GRND-TOT.            
           ADD PA-PURCH-EXT-RTL-TOT   TO PA-PURCH-EXT-RTL-GRND-TOT.             
TAISAK     ADD PA-PURCH-ADJ-EXT-RTL-TOT   TO                                    
TAISAK                                   PA-PURCH-ADJ-ERTL-GRND-TOT.            
TAISAK     ADD PA-PURCH-REC-EXT-RTL-TOT   TO                                    
TAISAK                                   PA-PURCH-REC-ERTL-GRND-TOT.            
TAISAK     ADD PA-PURCH-TRF-EXT-RTL-TOT   TO                                    
TAISAK                                   PA-PURCH-TRF-ERTL-GRND-TOT.            
           ADD PA-SALE-RTL-TOT        TO PA-SALE-RTL-GRND-TOT.                  
           ADD PA-XFER-RTL-TOT        TO PA-XFER-RTL-GRND-TOT.                  
           ADD PA-PC-MKDOWN-OLD-RTL-TOT                                         
               TO PA-PC-MKDOWN-OLD-RTL-GRND-TOT.                                
           ADD PA-PC-MKDOWN-NEW-RTL-TOT                                         
               TO PA-PC-MKDOWN-NEW-RTL-GRND-TOT.                                
           ADD PA-PC-MKDOWN-EXT-RTL-TOT                                         
               TO PA-PC-MKDOWN-EXT-RTL-GRND-TOT.                                
           ADD PA-PC-MKUP-OLD-RTL-TOT                                           
               TO PA-PC-MKUP-OLD-RTL-GRND-TOT.                                  
           ADD PA-PC-MKUP-NEW-RTL-TOT                                           
               TO PA-PC-MKUP-NEW-RTL-GRND-TOT.                                  
           ADD PA-PC-MKUP-EXT-RTL-TOT                                           
               TO PA-PC-MKUP-EXT-RTL-GRND-TOT.                                  
           ADD PA-ADJ-RTL-TOT         TO PA-ADJ-RTL-GRND-TOT.                   
           ADD PA-ADJ-COST-TOT        TO PA-ADJ-COST-GRND-TOT.                  
                                                                                
                                                                                
       2200-PROCESS-COMPOSIT-FILE.                                              
                                                                                
           MOVE ML020-STORE-NBR-9   TO RP-DL-STORE-NBR                          
           MOVE ML020-DEPT-NBR      TO RP-DL-DEPT.                              
           MOVE ML020-CLASS-NBR     TO RP-DL-CLASS.                             
           EVALUATE TRUE                                                        
               WHEN PV-PURCHASE-TRN                                             
                   ADD +1                  TO PA-PURCH-READ                     
                   IF CC-ALL-TRN OR CC-PURCH-TRN                                
                       PERFORM 3100-PROCESS-PURCH                               
                   END-IF                                                       
               WHEN PV-SALE-TRN                                                 
                   ADD +1                  TO PA-SALE-READ                      
                   IF CC-ALL-TRN OR CC-SALE-TRN                                 
                       PERFORM 3200-PROCESS-SALES                               
                   END-IF                                                       
               WHEN PV-TRANSFER-TRN                                             
                   ADD +1                  TO PA-TRANSFER-READ                  
                   IF CC-ALL-TRN OR CC-TRANSFER-TRN                             
                       PERFORM 3300-PROCESS-TRANSFER                            
                   END-IF                                                       
               WHEN PV-PRICE-CHANGE-TRN                                         
                   IF PV-MARKDOWN-TRN                                           
                       ADD +1                  TO PA-MARKDOWN-READ              
                   ELSE                                                         
                       ADD +1                  TO PA-MARKUP-READ                
                   END-IF                                                       
                   IF CC-ALL-TRN OR CC-PRICE-CHANGE-TRN                         
                       OR (CC-MARKDOWN-TRN  AND PV-MARKDOWN-TRN)                
                       OR (CC-MARKUP-TRN    AND PV-MARKUP-TRN)                  
                       PERFORM 3400-PROCESS-PRICE-CHANGE                        
                   END-IF                                                       
               WHEN PV-ADJUSTMENT-TRN                                           
                   ADD +1                  TO PA-ADJUSTMENT-READ                
                   IF CC-ALL-TRN OR CC-ADJUSTMENT-TRN                           
                       PERFORM 3500-PROCESS-ADJUSTMENT                          
                   END-IF                                                       
           END-EVALUATE.                                                        
                                                                                
           PERFORM 4100-READ-COMPOSIT-FILE.                                     
                                                                                
                                                                                
       3100-PROCESS-PURCH.                                                      
                                                                                
           IF (NOT CC-DATE-FILTER-REQ)                                          
               OR (CC-CURR-MM = ML020-PURCH-DOC-MM                              
                   AND CC-CURR-DD = ML020-PURCH-DOC-DD)                         
               IF ML020-PURCH-DR                                                
                   MULTIPLY -1 BY ML020-PURCH-FRGT-AMT                          
                   MULTIPLY -1 BY ML020-PURCH-DISC-AMT                          
                   MULTIPLY -1 BY ML020-PURCH-EXTD-RTL-AMT                      
                   MULTIPLY -1 BY ML020-PURCH-EXTD-NET-COST-AMT                 
                   MULTIPLY -1 BY ML020-PURCH-EXTD-GRO-COST-AMT                 
                   SET RP-DL-PURCH-DR   TO TRUE                                 
               ELSE                                                             
                   SET RP-DL-PURCH-CR   TO TRUE                                 
               END-IF                                                           
               MOVE ML020-PURCH-FRGT-AMT     TO RP-DL-TOTAL-1                   
               MOVE ML020-PURCH-DISC-AMT     TO RP-DL-TOTAL-2                   
               MOVE ML020-PURCH-EXTD-RTL-AMT TO RP-DL-TOTAL-3                   
               MOVE ML020-PURCH-EXTD-NET-COST-AMT TO RP-DL-TOTAL-4              
               MOVE ML020-PURCH-EXTD-GRO-COST-AMT TO RP-DL-TOTAL-5              
                                                                                
               ADD ML020-PURCH-FRGT-AMT      TO PA-PURCH-FREIGHT-TOT            
               ADD ML020-PURCH-DISC-AMT      TO PA-PURCH-DISCOUNT-TOT           
TAISAK         IF ML020-PURCH-TYP-RECEIPT                                       
TAISAK             ADD ML020-PURCH-EXTD-NET-COST-AMT TO                         
TAISAK                 PA-PURCH-REC-NET-COST-TOT                                
TAISAK             ADD ML020-PURCH-EXTD-RTL-AMT TO                              
TAISAK                 PA-PURCH-REC-EXT-RTL-TOT                                 
TAISAK         ELSE                                                             
TAISAK*            IF ML020-PURCH-TYP-ADJUSTMENT                                
TAISAK                ADD ML020-PURCH-EXTD-NET-COST-AMT TO                      
TAISAK                    PA-PURCH-ADJ-NET-COST-TOT                             
TAISAK                ADD ML020-PURCH-EXTD-RTL-AMT TO                           
TAISAK                    PA-PURCH-ADJ-EXT-RTL-TOT                              
TAISAK*            ELSE                                                         
TAISAK*               IF ML020-PURCH-TYP-TRANSFER                               
TAISAK*                  ADD ML020-PURCH-EXTD-NET-COST-AMT TO                   
TAISAK*                      PA-PURCH-TRF-NET-COST-TOT                          
TAISAK*                  ADD ML020-PURCH-EXTD-RTL-AMT TO                        
TAISAK*                      PA-PURCH-TRF-EXT-RTL-TOT                           
TAISAK*               END-IF                                                    
TAISAK*            END-IF                                                       
TAISAK         END-IF                                                           
               ADD ML020-PURCH-EXTD-RTL-AMT  TO PA-PURCH-EXT-RTL-TOT            
               ADD ML020-PURCH-EXTD-NET-COST-AMT                                
                   TO PA-PURCH-NET-COST-TOT                                     
               ADD ML020-PURCH-EXTD-GRO-COST-AMT                                
                   TO PA-PURCH-GRO-COST-TOT                                     
                                                                                
TAISAK         ADD +1                  TO PA-RECORD-PROCESSED                   
TAISAK*        PERFORM 5200-WRITE-DETAIL-RECORD                                 
           END-IF.                                                              
                                                                                
                                                                                
       3200-PROCESS-SALES.                                                      
                                                                                
           IF (NOT CC-DATE-FILTER-REQ)                                          
               OR (CC-CURR-MM = ML020-SALE-DTE-MM                               
                   AND CC-CURR-DD = ML020-SALE-DTE-DD                           
                   AND CC-CURR-YY = ML020-SALE-DTE-YY)                          
               MOVE ML020-SALE-EXTD-RTL-AMT  TO RP-DL-TOTAL-1                   
                                                                                
               ADD ML020-SALE-EXTD-RTL-AMT   TO PA-SALE-RTL-TOT                 
                                                                                
TAISAK         ADD +1                  TO PA-RECORD-PROCESSED                   
TAISAK*        PERFORM 5200-WRITE-DETAIL-RECORD                                 
           END-IF.                                                              
                                                                                
                                                                                
       3300-PROCESS-TRANSFER.                                                   
                                                                                
           IF (NOT CC-DATE-FILTER-REQ)                                          
               OR (CC-CURR-MM = ML020-XFER-MM                                   
                   AND CC-CURR-YY = ML020-XFER-DD)                              
      *        MOVE ML020-XFER-EXTD-RTL-AMT  TO RP-DL-TOTAL-1                   
               COMPUTE PV-CALC-EXT-RTL = ML020-XFER-PER-UNT-RTL-AMT             
                                         * ML020-XFER-QTY                       
               MOVE PV-CALC-EXT-RTL          TO RP-DL-TOTAL-1                   
                                                                                
      *        ADD ML020-XFER-EXTD-RTL-AMT   TO PA-XFER-RTL-TOT                 
               ADD PV-CALC-EXT-RTL           TO PA-XFER-RTL-TOT                 
                                                                                
TAISAK         ADD +1                  TO PA-RECORD-PROCESSED                   
TAISAK*        PERFORM 5200-WRITE-DETAIL-RECORD                                 
           END-IF.                                                              
                                                                                
                                                                                
       3400-PROCESS-PRICE-CHANGE.                                               
                                                                                
           IF (NOT CC-DATE-FILTER-REQ)                                          
               OR (CC-CURR-MM = ML020-PC-DTE-MM                                 
                   AND CC-CURR-YY = ML020-PC-DTE-DD)                            
               COMPUTE PV-CALC-EXT-RTL = (ML020-PC-OLD-PR-AMT                   
                                         - ML020-PC-NEW-PR-AMT)                 
                                         * ML020-PC-QTY                         
                                                                                
               MOVE ML020-PC-OLD-PR-AMT    TO RP-DL-TOTAL-1                     
               MOVE ML020-PC-NEW-PR-AMT    TO RP-DL-TOTAL-2                     
               MOVE PV-CALC-EXT-RTL        TO RP-DL-TOTAL-3                     
                                                                                
RWJ            IF PV-MARKDOWN-TRN                                               
                 ADD ML020-PC-OLD-PR-AMT   TO PA-PC-MKDOWN-OLD-RTL-TOT          
                 ADD ML020-PC-NEW-PR-AMT   TO PA-PC-MKDOWN-NEW-RTL-TOT          
                 ADD PV-CALC-EXT-RTL       TO PA-PC-MKDOWN-EXT-RTL-TOT          
RWJ            ELSE                                                             
RWJ              ADD ML020-PC-OLD-PR-AMT   TO PA-PC-MKUP-OLD-RTL-TOT            
RWJ              ADD ML020-PC-NEW-PR-AMT   TO PA-PC-MKUP-NEW-RTL-TOT            
RWJ              ADD PV-CALC-EXT-RTL       TO PA-PC-MKUP-EXT-RTL-TOT            
RWJ            END-IF                                                           
RWJ                                                                             
TAISAK         ADD +1                  TO PA-RECORD-PROCESSED                   
TAISAK*        PERFORM 5200-WRITE-DETAIL-RECORD                                 
           END-IF.                                                              
                                                                                
                                                                                
       3500-PROCESS-ADJUSTMENT.                                                 
                                                                                
           IF (NOT CC-DATE-FILTER-REQ)                                          
               OR (CC-CURR-MM = ML020-ADJ-DTE-MM                                
                   AND CC-CURR-DD = ML020-ADJ-DTE-DD                            
                   AND CC-CURR-YY = ML020-ADJ-DTE-YY)                           
               MOVE ML020-ADJ-AT-RTL-AMT     TO RP-DL-TOTAL-1                   
               MOVE ML020-ADJ-AT-COST-AMT    TO RP-DL-TOTAL-2                   
                                                                                
               ADD ML020-ADJ-AT-RTL-AMT      TO PA-ADJ-RTL-TOT                  
               ADD ML020-ADJ-AT-COST-AMT     TO PA-ADJ-COST-TOT                 
                                                                                
TAISAK         ADD +1                  TO PA-RECORD-PROCESSED                   
TAISAK*        PERFORM 5200-WRITE-DETAIL-RECORD                                 
           END-IF.                                                              
                                                                                
                                                                                
       4000-READ-DATE-FILE.                                                     
                                                                                
           READ CONTROL-DATE-FILE INTO CC-CONTROL-CARD                          
               AT END                                                           
                   SET PS-END-OF-CONTROL TO TRUE                                
           END-READ.                                                            
                                                                                
                                                                                
       4100-READ-COMPOSIT-FILE.                                                 
                                                                                
           ADD +1              TO PA-INPUT-RECORDS.                             
                                                                                
W26603     READ COMPOSIT-FILE NEXT                                              
               AT END                                                           
                   SET PS-END-OF-COMPOSIT TO TRUE                               
                   SUBTRACT 1        FROM PA-INPUT-RECORDS                      
           END-READ.                                                            
                                                                                
                                                                                
       5100-WRITE-REPORT-TITLES.                                                
                                                                                
           ADD 1                       TO PV-PAGE-COUNT.                        
           MOVE PV-PAGE-COUNT          TO DP132O-PAGE-NUMBER.                   
                                                                                
           WRITE REPORT-RECORD      FROM DP132O-STANDRD-HEADER-132-COLS         
               AFTER ADVANCING PAGE.                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN CC-09910-REQ                                                
                   IF ML020-DEPT-NBR = 99                                       
                       SET HD1-09910-REVERSAL   TO TRUE                         
                   ELSE                                                         
                       SET HD1-09910-ALLOCATION TO TRUE                         
                   END-IF                                                       
               WHEN CC-DATE-FILTER-REQ                                          
                   SET HD1-DATE-FILTER      TO TRUE                             
           END-EVALUATE.                                                        
           WRITE REPORT-RECORD      FROM HEADER-TITLE-LINE-1                    
               AFTER ADVANCING 1 LINE.                                          
                                                                                
           SET RP-CH-2-OFF                                                      
               RP-CH-3-OFF                                                      
               RP-CH-4-OFF                                                      
               RP-CH-5-OFF          TO TRUE.                                    
           SET RP-CL-2-OFF                                                      
               RP-CL-3-OFF                                                      
               RP-CL-4-OFF                                                      
               RP-CL-5-OFF          TO TRUE.                                    
           SET RP-SL-TOTAL-2-OFF                                                
               RP-SL-TOTAL-3-OFF                                                
               RP-SL-TOTAL-4-OFF                                                
               RP-SL-TOTAL-5-OFF    TO TRUE.                                    
                                                                                
           EVALUATE TRUE                                                        
               WHEN PV-PURCHASE-TRN                                             
                   SET RP-CH-FREIGHT                                            
                       RP-CH-DISCOUNT                                           
                       RP-CH-EXT-RETAIL                                         
                       RP-CH-NET-COST                                           
                       RP-CH-GRO-COST       TO TRUE                             
                   SET RP-CL-1-ON                                               
                       RP-CL-2-ON                                               
                       RP-CL-3-ON                                               
                       RP-CL-4-ON                                               
                       RP-CL-5-ON           TO TRUE                             
                   SET RP-SL-TOTAL-1-ON                                         
                       RP-SL-TOTAL-2-ON                                         
                       RP-SL-TOTAL-3-ON                                         
                       RP-SL-TOTAL-4-ON                                         
                       RP-SL-TOTAL-5-ON     TO TRUE                             
               WHEN PV-SALE-TRN                                                 
                   SET RP-CH-SALES          TO TRUE                             
                   SET RP-CL-1-ON           TO TRUE                             
                   SET RP-SL-TOTAL-1-ON     TO TRUE                             
               WHEN PV-TRANSFER-TRN                                             
                   SET RP-CH-XFER-RETAIL    TO TRUE                             
                   SET RP-CL-1-ON           TO TRUE                             
                   SET RP-SL-TOTAL-1-ON     TO TRUE                             
               WHEN PV-PRICE-CHANGE-TRN                                         
                   SET RP-CH-OLD-PRICE                                          
                       RP-CH-NEW-PRICE                                          
                       RP-CH-EXT-RETAIL     TO TRUE                             
                   SET RP-CL-1-ON                                               
                       RP-CL-2-ON                                               
                       RP-CL-3-ON           TO TRUE                             
                   SET RP-SL-TOTAL-1-ON                                         
                       RP-SL-TOTAL-2-ON                                         
                       RP-SL-TOTAL-3-ON     TO TRUE                             
               WHEN PV-ADJUSTMENT-TRN                                           
                   SET RP-CH-ADJ-RETAIL                                         
                       RP-CH-ADJ-COST       TO TRUE                             
                   SET RP-CL-1-ON                                               
                       RP-CL-2-ON           TO TRUE                             
                   SET RP-SL-TOTAL-1-ON                                         
                       RP-SL-TOTAL-2-ON     TO TRUE                             
           END-EVALUATE.                                                        
           WRITE REPORT-RECORD      FROM RP-COLUMN-HEADER-LINE-1                
               AFTER ADVANCING 2 LINE.                                          
                                                                                
           WRITE REPORT-RECORD      FROM RP-COLUMN-HEADER-LINE-2                
               AFTER ADVANCING 1 LINE.                                          
                                                                                
           MOVE +5                     TO PV-LINE-COUNT.                        
                                                                                
                                                                                
      *5200-WRITE-DETAIL-RECORD.                                                
                                                                                
      *    ADD +1                  TO PA-RECORD-PROCESSED.                      
                                                                                
      *    IF PV-LINE-COUNT + PV-ADVANCE-LINE > PC-MAX-LINE-COUNT               
      *        OR PV-LINE-COUNT = ZEROES                                        
      *        PERFORM 5100-WRITE-REPORT-TITLES                                 
      *    END-IF.                                                              
                                                                                
      *    WRITE REPORT-RECORD      FROM RP-DETAIL-LINE                         
      *        AFTER ADVANCING PV-ADVANCE-LINE LINE.                            
                                                                                
      *    ADD PV-ADVANCE-LINE         TO PV-LINE-COUNT.                        
      *    MOVE +1                     TO PV-ADVANCE-LINE.                      
                                                                                
                                                                                
      *5300-WRITE-SUBTOTAL-LINES.                                               
                                                                                
      *    IF PV-LINE-COUNT + 3 > PC-MAX-LINE-COUNT                             
      *        OR PV-LINE-COUNT = ZEROES                                        
      *        PERFORM 5100-WRITE-REPORT-TITLES                                 
      *    END-IF.                                                              
                                                                                
      *    EVALUATE TRUE                                                        
      *        WHEN PV-PURCHASE-TRN                                             
      *            MOVE PA-PURCH-FREIGHT-TOT     TO RP-ST-TOTAL-1               
      *            MOVE PA-PURCH-DISCOUNT-TOT    TO RP-ST-TOTAL-2               
      *            MOVE PA-PURCH-EXT-RTL-TOT     TO RP-ST-TOTAL-3               
      *            MOVE PA-PURCH-NET-COST-TOT    TO RP-ST-TOTAL-4               
      *            MOVE PA-PURCH-GRO-COST-TOT    TO RP-ST-TOTAL-5               
      *        WHEN PV-SALE-TRN                                                 
      *            MOVE PA-SALE-RTL-TOT          TO RP-ST-TOTAL-1               
      *        WHEN PV-TRANSFER-TRN                                             
      *            MOVE PA-XFER-RTL-TOT          TO RP-ST-TOTAL-1               
      *        WHEN PV-PRICE-CHANGE-TRN                                         
      *            IF PV-MARKDOWN-TRN                                           
      *                MOVE PA-PC-MKDOWN-OLD-RTL-TOT TO RP-ST-TOTAL-1           
      *                MOVE PA-PC-MKDOWN-NEW-RTL-TOT TO RP-ST-TOTAL-2           
      *                MOVE PA-PC-MKDOWN-EXT-RTL-TOT TO RP-ST-TOTAL-3           
      *            ELSE                                                         
      *                MOVE PA-PC-MKUP-OLD-RTL-TOT   TO RP-ST-TOTAL-1           
      *                MOVE PA-PC-MKUP-NEW-RTL-TOT   TO RP-ST-TOTAL-2           
      *                MOVE PA-PC-MKUP-EXT-RTL-TOT   TO RP-ST-TOTAL-3           
      *            END-IF                                                       
      *        WHEN PV-ADJUSTMENT-TRN                                           
      *            MOVE PA-ADJ-RTL-TOT           TO RP-ST-TOTAL-1               
      *            MOVE PA-ADJ-COST-TOT          TO RP-ST-TOTAL-2               
      *    END-EVALUATE.                                                        
                                                                                
      *    WRITE REPORT-RECORD      FROM RP-SUB-TOTAL-LINE-1                    
      *        AFTER ADVANCING 2 LINES.                                         
                                                                                
      *    WRITE REPORT-RECORD      FROM RP-SUB-TOTAL-LINE-2                    
      *        AFTER ADVANCING 1 LINES.                                         
                                                                                
      *    ADD  +3                     TO PV-LINE-COUNT.                        
      *    MOVE +3                     TO PV-ADVANCE-LINE.                      
                                                                                
                                                                                
       5400-WRITE-TOTAL-LINES.                                                  
                                                                                
           IF PV-LINE-COUNT + 3 > PC-MAX-LINE-COUNT                             
               OR PV-LINE-COUNT = ZEROES                                        
               PERFORM 5100-WRITE-REPORT-TITLES                                 
           END-IF.                                                              
                                                                                
           EVALUATE TRUE                                                        
               WHEN PV-PURCHASE-TRN                                             
TAISAK             MOVE 'TOT PURCHASE TRN'            TO RP-SL-TOT-TYPE         
                   MOVE PA-PURCH-FREIGHT-GRND-TOT     TO RP-ST-TOTAL-1          
                   MOVE PA-PURCH-DISCOUNT-GRND-TOT    TO RP-ST-TOTAL-2          
                   MOVE PA-PURCH-EXT-RTL-GRND-TOT     TO RP-ST-TOTAL-3          
                   MOVE PA-PURCH-NET-COST-GRND-TOT    TO RP-ST-TOTAL-4          
                   MOVE PA-PURCH-GRO-COST-GRND-TOT    TO RP-ST-TOTAL-5          
               WHEN PV-SALE-TRN                                                 
TAISAK             MOVE 'TOT SALES TRN   '            TO RP-SL-TOT-TYPE         
                   MOVE PA-SALE-RTL-GRND-TOT          TO RP-ST-TOTAL-1          
               WHEN PV-TRANSFER-TRN                                             
TAISAK             MOVE 'TOT TRANSFER TRN'            TO RP-SL-TOT-TYPE         
                   MOVE PA-XFER-RTL-GRND-TOT          TO RP-ST-TOTAL-1          
               WHEN PV-PRICE-CHANGE-TRN                                         
                   IF PV-MARKDOWN-TRN                                           
TAISAK             MOVE 'TOT MARKDOWN TRN'                                      
TAISAK                     TO RP-SL-TOT-TYPE                                    
                       MOVE PA-PC-MKDOWN-OLD-RTL-GRND-TOT                       
                           TO RP-ST-TOTAL-1                                     
                       MOVE PA-PC-MKDOWN-NEW-RTL-GRND-TOT                       
                           TO RP-ST-TOTAL-2                                     
                       MOVE PA-PC-MKDOWN-EXT-RTL-GRND-TOT                       
                       TO RP-ST-TOTAL-3                                         
                   ELSE                                                         
TAISAK                 MOVE 'TOT MARKDOWN CAN'                                  
TAISAK                     TO RP-SL-TOT-TYPE                                    
                       MOVE PA-PC-MKUP-OLD-RTL-GRND-TOT                         
                           TO RP-ST-TOTAL-1                                     
                       MOVE PA-PC-MKUP-NEW-RTL-GRND-TOT                         
                           TO RP-ST-TOTAL-2                                     
                       MOVE PA-PC-MKUP-EXT-RTL-GRND-TOT                         
                           TO RP-ST-TOTAL-3                                     
                   END-IF                                                       
               WHEN PV-ADJUSTMENT-TRN                                           
TAISAK             MOVE 'TOT ADJUST TRN  '                                      
TAISAK                     TO RP-SL-TOT-TYPE                                    
                   MOVE PA-ADJ-RTL-GRND-TOT           TO RP-ST-TOTAL-1          
                   MOVE PA-ADJ-COST-GRND-TOT          TO RP-ST-TOTAL-2          
           END-EVALUATE.                                                        
                                                                                
           WRITE REPORT-RECORD      FROM RP-SUB-TOTAL-LINE-1                    
               AFTER ADVANCING 2 LINES.                                         
                                                                                
           WRITE REPORT-RECORD      FROM RP-SUB-TOTAL-LINE-2                    
               AFTER ADVANCING 1 LINES.                                         
                                                                                
           ADD  +3                     TO PV-LINE-COUNT.                        
                                                                                
           IF PV-LINE-COUNT + 3 > PC-MAX-LINE-COUNT                             
               OR PV-LINE-COUNT = ZEROES                                        
               PERFORM 5100-WRITE-REPORT-TITLES                                 
           END-IF.                                                              
                                                                                
           EVALUATE TRUE                                                        
               WHEN PV-PURCHASE-TRN                                             
                   MOVE '     ADJUSTMENTS'           TO RP-SL-TOT-TYPE          
                   MOVE ZERO                           TO RP-ST-TOTAL-1         
                   MOVE ZERO                           TO RP-ST-TOTAL-2         
                   MOVE PA-PURCH-ADJ-ERTL-GRND-TOT     TO RP-ST-TOTAL-3         
                   MOVE PA-PURCH-ADJ-NCOST-GRND-TOT    TO RP-ST-TOTAL-4         
                   MOVE ZERO                           TO RP-ST-TOTAL-5         
                   WRITE REPORT-RECORD      FROM RP-SUB-TOTAL-LINE-2            
                   AFTER ADVANCING 1 LINE                                       
                   MOVE '     RECEIPTS   '            TO RP-SL-TOT-TYPE         
                   MOVE ZERO                           TO RP-ST-TOTAL-1         
                   MOVE ZERO                           TO RP-ST-TOTAL-2         
                   MOVE PA-PURCH-REC-ERTL-GRND-TOT     TO RP-ST-TOTAL-3         
                   MOVE PA-PURCH-REC-NCOST-GRND-TOT    TO RP-ST-TOTAL-4         
                   MOVE ZERO                           TO RP-ST-TOTAL-5         
                   WRITE REPORT-RECORD      FROM RP-SUB-TOTAL-LINE-2            
                   AFTER ADVANCING 1 LINE                                       
TAISAK*        WHEN PV-SALE-TRN                                                 
TAISAK*        WHEN PV-TRANSFER-TRN                                             
TAISAK*        WHEN PV-PRICE-CHANGE-TRN                                         
TAISAK*        WHEN PV-ADJUSTMENT-TRN                                           
           END-EVALUATE.                                                        
                                                                                
           ADD  +2                     TO PV-LINE-COUNT.                        
           MOVE +3                     TO PV-ADVANCE-LINE.                      
       8000-EOJ.                                                                
                                                                                
           CLOSE CONTROL-DATE-FILE                                              
                 COMPOSIT-FILE                                                  
                 REPORT-FILE.                                                   
           DISPLAY ' STATISTICS -            '.                                 
           DISPLAY '   PURCH READ:           ' PA-PURCH-READ-TOT.               
           DISPLAY '   SALES READ:           ' PA-SALE-READ-TOT.                
           DISPLAY '   TRANSFER READ:        ' PA-TRANSFER-READ-TOT.            
           DISPLAY '   MARKDOWN READ:        ' PA-MARKDOWN-READ-TOT.            
           DISPLAY '   MARKUP READ:          ' PA-MARKUP-READ-TOT.              
           DISPLAY '   ADJUSTMENT READ:      ' PA-ADJUSTMENT-READ-TOT.          
           DISPLAY '                         '                                  
           DISPLAY '   TOTAL INPUT RECORDS:  ' PA-INPUT-RECORDS.                
           DISPLAY '   RECORDS PROCESSED:    '                                  
                   PA-RECORD-PROCESSED-GRND-TOT.                                
                                                                                
       9900-COMMON-ABEND-ROUTINE.                                               
                                                                                
           DISPLAY ABEND-CODE.                                                  
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
