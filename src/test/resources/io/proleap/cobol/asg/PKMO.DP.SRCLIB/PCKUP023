000200***************************************************************** 00020000
000300 IDENTIFICATION DIVISION.                                         00030000
000400***************************************************************** 00040000
000500 PROGRAM-ID.    PCKUP023.                                         00050000
000600 AUTHOR.        EKTA AGRAWAL.                                     00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN.  JUNE 2010.                                        00080000
000900 DATE-COMPILED.                                                   00090000
001000***************************************************************** 00100000
001100*  THIS PROGRAM READS THE SUMARRIZED RCVR LNE DTL RCORDS FOR THE* 00110000
001200*  IR CARTONS AND UPDATES THE PCT_RCVR_LNE_DTL TABLE.           * 00120000
001300*                                                               * 00130000
001400***************************************************************** 00140000
001500 ENVIRONMENT DIVISION.                                            00150000
001600 INPUT-OUTPUT SECTION.                                            00160000
001700                                                                  00170000
001800 FILE-CONTROL.                                                    00180000
001900                                                                  00190000
002000     SELECT RCVR-LNE-DTL-FILE                                     00200000
002100         ASSIGN TO INP01.                                         00210000
002200                                                                  00220000
002300***************************************************************** 00230000
002400 DATA DIVISION.                                                   00240000
002500***************************************************************** 00250000
002600 FILE SECTION.                                                    00260000
002700                                                                  00270000
002800 FD  RCVR-LNE-DTL-FILE                                            00280000
002900     RECORDING MODE IS F                                          00290000
003000     BLOCK CONTAINS 0 RECORDS                                     00300000
003100     LABEL RECORDS ARE STANDARD.                                  00310000
003200                                                                  00320000
003300 01 RCVR-LNE-DTL-RECORD    PIC X(107).                            00330000
003400                                                                  00340000
003500***************************************************************** 00350000
003600 WORKING-STORAGE SECTION.                                         00360000
003700                                                                  00370000
003800 01  PS-PROGRAM-SWITCHES.                                         00380000
003900     05  PS-END-OF-FILE-SW            PIC  X(01) VALUE 'N'.       00390000
004000         88  PS-END-OF-FILE                      VALUE 'Y'.       00400000
004100         88  PS-NOT-END-OF-FILE                  VALUE 'N'.       00410000
004200                                                                  00420000
004300 01  PV-PROGRAM-VARIABLES.                                        00430000
004400     05  PV-REC-COUNT                 PIC  9(09) VALUE  0.        00440000
004500     05  PV-REC-INSERTED              PIC  9(09) VALUE  0.        00450000
004600     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.        00460000
004610     05  PV-EXTD-RTL-AMT              PIC  9(08)V9(02).           00461000
004700                                                                  00470000
004800 01  PV-ABEND-FIELDS.                                             00480000
004900     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00490000
005000                                                 COMP SYNC.       00500000
005100     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PCKUP023'.00510000
005200     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00520000
005300     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00530000
005400     05  PV-DB2-TABLE-NAME            PIC  X(20) VALUE SPACES.    00540000
005510     05  PV-ABEND-PULL-NBR            PIC  X(7).                  00551000
005520     05  PV-ABEND-PULL-LNE-NBR        PIC  X(7).                  00552000
005530     05  PV-ABEND-OPER-UNT-ID         PIC  X(4).                  00553000
005600                                                                  00560000
005700***********************************************************       00570000
005800*  COPYBOOK USED FOR THE RCVR-LNE-DTL-FILE                *       00580000
005900***********************************************************       00590000
006000     COPY PCWS261.                                                00600000
006100                                                                  00610000
006200***********************************************************       00620000
006300*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00630000
006400***********************************************************       00640000
006500     COPY DPWS004.                                                00650000
006600                                                                  00660000
006700***********************************************************       00670000
006800*  DB2 SQL COMMUNICATION AREA                             *       00680000
006900***********************************************************       00690000
007000     EXEC SQL                                                     00700000
007100          INCLUDE SQLCA                                           00710000
007200     END-EXEC.                                                    00720000
007300                                                                  00730000
007400***********************************************************       00740000
007500*  PCT_RCVR_LNE_DTL TABLE                                 *       00750000
007600***********************************************************       00760000
007700     EXEC SQL                                                     00770000
007800          INCLUDE PCT00007                                        00780000
007900     END-EXEC.                                                    00790000
008000                                                                  00800000
008100***************************************************************** 00810000
008200 PROCEDURE DIVISION.                                              00820000
008300***************************************************************** 00830000
008400     DISPLAY '**** BEGINNING PCKUP023 ****'.                      00840000
008500     DISPLAY '****************************************'.          00850000
008600     DISPLAY ' '.                                                 00860000
008700     PERFORM 0100-INITIALIZATION.                                 00870000
008800                                                                  00880000
008810*PROCESS INPUT FILE.                                              00881000
008820     PERFORM 1000-PROCESS-RCVR-LNE-DTL-FILE                       00882000
008830         UNTIL PS-END-OF-FILE                                     00883000
009200                                                                  00920000
009300     DISPLAY 'NO. OF INPUT RECORDS==>' PV-REC-COUNT.              00930000
009400     DISPLAY 'NO. OF RECORDS INSERTED==>' PV-REC-INSERTED         00940000
009500     DISPLAY ' '.                                                 00950000
009600     DISPLAY '****************************************'.          00960000
009700*CLOSE FILE.                                                      00970000
009800     CLOSE RCVR-LNE-DTL-FILE .                                    00980000
009900     PERFORM 4000-TABLE-COMMIT.                                   00990000
010000                                                                  01000000
010100     DISPLAY '****  END OF PCKUP023  ****'.                       01010000
010200                                                                  01020000
010300     GOBACK.                                                      01030000
010400                                                                  01040000
010500******************************************************************01050000
010600 0100-INITIALIZATION.                                             01060000
010700******************************************************************01070000
010800     MOVE '0100-INITIALIZATION        ' TO PV-ABEND-PARAGRAPH.    01080000
010900                                                                  01090000
011000     OPEN INPUT  RCVR-LNE-DTL-FILE.                               01100000
011400                                                                  01140000
011410******************************************************************01141000
011500 1000-PROCESS-RCVR-LNE-DTL-FILE.                                  01150000
011600******************************************************************01160000
011700     MOVE '1000-PROCESS-RCVR-LNE-DTL-FILE' TO  PV-ABEND-PARAGRAPH.01170000
011800                                                                  01180000
011810*READ INPUT RECORD.                                               01181000
011820     PERFORM 2000-READ-INPUT-FILE.                                01182000
011830                                                                  01183000
011840     IF PS-NOT-END-OF-FILE                                        01184000
011900        ADD +1 TO PV-REC-COUNT                                    01190000
012100        PERFORM 3000-INSERT-RECORD                                01210000
012500     END-IF.                                                      01250000
012800                                                                  01280000
012900***************************************************************** 01290000
013000 2000-READ-INPUT-FILE.                                            01300000
013100***************************************************************** 01310000
013200                                                                  01320000
013300     MOVE '2000-READ-INPUT-FILE       ' TO PV-ABEND-PARAGRAPH.    01330000
013400                                                                  01340000
013500     READ RCVR-LNE-DTL-FILE                                       01350000
013600       INTO PC261-RCVR-LNE-RECORD                                 01360000
013700         AT END                                                   01370000
013800           SET PS-END-OF-FILE TO TRUE.                            01380000
013900                                                                  01390000
014000                                                                  01400000
014100***************************************************************** 01410000
014200 3000-INSERT-RECORD.                                              01420000
014300***************************************************************** 01430000
014400     MOVE '3000-INSERT-RECORD         ' TO PV-ABEND-PARAGRAPH.    01440000
014500     INITIALIZE DCLPCT00007.                                      01450000
014600                                                                  01460000
014700     MOVE PC261-PO-NBR         TO    PCT00007-PO-NBR.             01470000
014710     MOVE PC261-RCVR-SEQ-NBR   TO    PCT00007-RCVR-SEQ-NBR.       01471000
014720     MOVE PC261-PO-LNE-NBR     TO    PCT00007-PO-LNE-NBR.         01472000
014730     MOVE PC261-ACTN-CDE       TO    PCT00007-ACTN-CDE.           01473000
014740     MOVE PC261-WRKD-UNT-TMST  TO    PCT00007-WRKD-UNT-TMST.      01474000
014750     MOVE PC261-BUS-DTE        TO    PCT00007-BUS-DTE.            01475000
014800     MOVE PC261-OPER-UNT-ID    TO    PCT00007-OPER-UNT-ID.        01480000
014900     MOVE PC261-SHFT-NBR       TO    PCT00007-SHFT-NBR.           01490000
015000     MOVE PC261-UNT-QTY        TO    PCT00007-UNT-QTY.            01500000
015100     MOVE PC261-CART-QTY       TO    PCT00007-CART-QTY.           01510000
015200     MOVE PC261-PRCG-AREA-CDE  TO    PCT00007-PRCG-AREA-CDE.      01520000
015300     MOVE PC261-EXTD-RTL-AMT   TO    PV-EXTD-RTL-AMT.             01530000
015400     MOVE PV-EXTD-RTL-AMT      TO    PCT00007-EXTD-RTL-AMT.       01540000
015700                                                                  01570000
015800     EXEC SQL                                                     01580000
015900         INSERT INTO PCT_RCVR_LNE_DTL                             01590000
016000              (PO_NBR                                             01600000
016100              ,RCVR_SEQ_NBR                                       01610000
016200              ,PO_LNE_NBR                                         01620000
016300              ,ACTN_CDE                                           01630000
016400              ,WRKD_UNT_TMST                                      01640000
016500              ,BUS_DTE                                            01650000
016600              ,OPER_UNT_ID                                        01660000
016700              ,SHFT_NBR                                           01670000
016800              ,UNT_QTY                                            01680000
016900              ,CART_QTY                                           01690000
016910              ,PRCG_AREA_CDE                                      01691000
016920              ,EXTD_RTL_AMT)                                      01692000
017000         VALUES                                                   01700000
017100             (:PCT00007-PO-NBR                                    01710000
017200             ,:PCT00007-RCVR-SEQ-NBR                              01720000
017300             ,:PCT00007-PO-LNE-NBR                                01730000
017400             ,:PCT00007-ACTN-CDE                                  01740000
017500             ,:PCT00007-WRKD-UNT-TMST                             01750000
017600             ,:PCT00007-BUS-DTE                                   01760000
017700             ,:PCT00007-OPER-UNT-ID                               01770000
017800             ,:PCT00007-SHFT-NBR                                  01780000
017900             ,:PCT00007-UNT-QTY                                   01790000
018000             ,:PCT00007-CART-QTY                                  01800000
018010             ,:PCT00007-PRCG-AREA-CDE                             01801000
018020             ,:PCT00007-EXTD-RTL-AMT)                             01802000
018100     END-EXEC.                                                    01810000
018200                                                                  01820000
018300     EVALUATE TRUE                                                01830000
018400       WHEN SQLCODE = ZERO                                        01840000
018500           ADD 1 TO PV-REC-INSERTED                               01850000
018600       WHEN SQLCODE = -803                                        01860000
018700           DISPLAY '****PULL NUMBER  ' PC261-PO-NBR               01870000
018800                   ' ALREADY EXIST IN THE TABLE****'              01880000
018900       WHEN OTHER                                                 01890000
019000         MOVE SQLCODE TO PV-SQLCODE                               01900000
019100         MOVE 'PCT_RCVR_LNR_DTL'  TO PV-DB2-TABLE-NAME            01910000
019210         MOVE PCT00007-PO-NBR         TO PV-ABEND-PULL-NBR        01921000
019220         MOVE PCT00007-PO-LNE-NBR     TO PV-ABEND-PULL-LNE-NBR    01922000
019230         MOVE PCT00007-OPER-UNT-ID    TO PV-ABEND-OPER-UNT-ID     01923000
019300         PERFORM 9900-DB2-ABEND                                   01930000
019400     END-EVALUATE.                                                01940000
019500                                                                  01950000
019650***************************************************************** 01965000
019700* COMMIT THE PENDING TABLE CHANGES.                             * 01970000
019800***************************************************************** 01980000
019900 4000-TABLE-COMMIT.                                               01990000
020000                                                                  02000000
020100     EXEC SQL                                                     02010000
020200          COMMIT                                                  02020000
020300     END-EXEC.                                                    02030000
020400                                                                  02040000
020500******************************************************************02050000
020600 9900-DB2-ABEND.                                                  02060000
020700******************************************************************02070000
020800     MOVE '9900-DB2-ABEND             ' TO PV-ABEND-PARAGRAPH.    02080000
020900                                                                  02090000
021000     DISPLAY '*** DB2 ERROR '.                                    02100000
021100     DISPLAY '*** SQLCODE       = ' PV-SQLCODE.                   02110000
021200     DISPLAY '*** PROGRAM       = ' PV-ABEND-PROGRAM.             02120000
021300     DISPLAY '*** PARAGRAPH     = ' PV-ABEND-PARAGRAPH.           02130000
021400     DISPLAY '*** TABLE NAME    = ' PV-DB2-TABLE-NAME.            02140000
021510     DISPLAY '*** PULL NUMBER   = ' PV-ABEND-PULL-NBR.            02151000
021520     DISPLAY '*** PULL LINE NUM = ' PV-ABEND-PULL-LNE-NBR.        02152000
021530     DISPLAY '*** OPER UNIT ID  = ' PV-ABEND-OPER-UNT-ID.         02153000
021600                                                                  02160000
021700     COPY DPPD004.                                                02170000
021800                                                                  02180000
021900     MOVE +4013 TO PV-ABEND-CODE.                                 02190000
022000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02200000
