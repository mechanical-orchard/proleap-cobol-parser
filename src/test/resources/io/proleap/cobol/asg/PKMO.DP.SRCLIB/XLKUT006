000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400 PROGRAM-ID.    XLKUT006.                                         00040002
000500 AUTHOR.        DAN HINTZ.                                        00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   JULY 2002.                                        00070001
000800 DATE-COMPILED.                                                   00080001
000900***************************************************************** 00090001
001000*  THIS BATCH DB2 PROGRAM READS THE FILE CREATED BY IMKUT024    * 00100002
001100*  CONTAINING SKU XREF INFORMATION.  THIS DATA IS INSERTED INTO * 00110002
001200*  THE XLT_SKU TABLE.                                           * 00120002
001400***************************************************************** 00140001
001500 ENVIRONMENT DIVISION.                                            00150001
001600 INPUT-OUTPUT SECTION.                                            00160001
001700                                                                  00170001
001800 FILE-CONTROL.                                                    00180001
001900                                                                  00190001
002000     SELECT SKU-ADDS-IN                                           00200003
002010         ASSIGN TO INP01.                                         00201001
002100                                                                  00210001
002200***************************************************************** 00220001
002300 DATA DIVISION.                                                   00230001
002400***************************************************************** 00240001
002500 FILE SECTION.                                                    00250001
002600                                                                  00260001
002700 FD  SKU-ADDS-IN                                                  00270003
002800     RECORDING MODE IS F                                          00280001
002810     BLOCK CONTAINS 0 RECORDS                                     00281001
002900     LABEL RECORDS ARE STANDARD.                                  00290001
003000                                                                  00300001
003300 01  SKU-ADDS-IN-RECORD           PIC X(500).                     00330012
003700                                                                  00370001
003800                                                                  00380001
003900***************************************************************** 00390001
004000 WORKING-STORAGE SECTION.                                         00400001
004100                                                                  00410001
004200 01  PS-PROGRAM-SWITCHES.                                         00420001
004300     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00430001
004400         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00440001
004500         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00450001
004600                                                                  00460001
004700 01  PC-PROGRAM-CONSTANTS.                                        00470001
004800     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'XLKUT006'.00480002
005000                                                                  00500001
005100 01  PV-PROGRAM-VARIABLES.                                        00510001
005900     05  PV-RECORDS-READ              PIC  9(09) VALUE  0.        00590001
006000     05  PV-RECORDS-INSERTED          PIC  9(09) VALUE  0.        00600001
006400     05  PV-DISP-SKU                  PIC  9(08) VALUE  0.        00640003
           05  PV-DISP-ITM-NBR              PIC  9(15) VALUE  0.        00650010
006700     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.        00670001
006800     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00680001
006900                                                                  00690001
007000                                                                  00700001
007100 01  PV-ABEND-FIELDS.                                             00710001
007200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00720001
007300                                                 COMP SYNC.       00730001
007400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUT006'.00740002
007500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00750001
007600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00760001
007700     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00770001
007900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00790001
008000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00800001
008100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00810001
008200                                                                  00820001
008300                                                                  00830001
008400***********************************************************       00840001
008500*  COPYBOOK USED FOR THE SKU ADDS INPUT FILE              *       00850005
008600***********************************************************       00860001
008700     COPY IMRD053.                                                00870014
008800                                                                  00880001
008900***********************************************************       00890001
009000*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00900001
009100***********************************************************       00910001
009200     COPY DPWS004.                                                00920014
009300                                                                  00930001
009400***********************************************************       00940001
009500*  DB2 SQL COMMUNICATION AREA                             *       00950001
009600***********************************************************       00960001
009700     EXEC SQL                                                     00970001
009800          INCLUDE SQLCA                                           00980001
009900     END-EXEC.                                                    00990001
010000                                                                  01000001
010100***********************************************************       01010001
010200*  XLT_VND_STYLE TABLE                                    *       01020001
010300***********************************************************       01030001
010400     EXEC SQL                                                     01040001
010500          INCLUDE XLT00003                                        01050003
010600     END-EXEC.                                                    01060001
010700                                                                  01070001
010800***************************************************************** 01080001
010900 PROCEDURE DIVISION.                                              01090001
011000***************************************************************** 01100001
011100     DISPLAY '**** BEGINNING XLKUT006 ****'.                      01110002
011200     DISPLAY ' '.                                                 01120001
011300                                                                  01130001
011400     OPEN INPUT  SKU-ADDS-IN.                                     01140003
011500                                                                  01150001
011600     PERFORM 1000-READ-INPUT-FILE.                                01160001
011700                                                                  01170001
012100     PERFORM 2000-PROCESS-INPUT-FILE                              01210001
012200       UNTIL PS-EOF-INPUT-YES.                                    01220001
012300                                                                  01230001
012400     CLOSE SKU-ADDS-IN.                                           01240003
012500                                                                  01250001
012510     PERFORM 3000-TABLE-COMMIT.                                   01251001
012520                                                                  01252001
012600     DISPLAY '  INPUT SKU RECS READ    = ' PV-RECORDS-READ.       01260003
012700     DISPLAY '  XLT_SKU ROWS INSERTED  = ' PV-RECORDS-INSERTED.   01270003
012800     DISPLAY ' '.                                                 01280001
012900     DISPLAY '****  END OF  XLKUT006  ****'.                      01290002
013000                                                                  01300001
013100     GOBACK.                                                      01310001
013200                                                                  01320001
013300                                                                  01330001
013400***************************************************************** 01340001
013500*  READ A SKU ADD EXTRACT RECORD THAT WILL BE USED TO INSERT    * 01350003
013510*  A ROW OF DATA INTO THE XLT_SKU TABLE.                        * 01351003
013600***************************************************************** 01360001
013700 1000-READ-INPUT-FILE.                                            01370001
013800                                                                  01380001
013900     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       01390001
014000                                                                  01400001
014010     INITIALIZE IM053-ITEM-SKU-DOMAIN-REC.                        01401008
014020                                                                  01402001
014100     READ SKU-ADDS-IN                                             01410003
014200          INTO IM053-ITEM-SKU-DOMAIN-REC                          01420008
014300            AT END                                                01430001
014400               SET PS-EOF-INPUT-YES TO TRUE                       01440001
014500                                                                  01450001
014600            NOT AT END                                            01460001
014700               SET PS-EOF-INPUT-NO  TO TRUE                       01470001
014800               ADD +1 TO PV-RECORDS-READ                          01480001
014900     END-READ.                                                    01490001
015000                                                                  01500001
015100                                                                  01510001
015200***************************************************************** 01520001
015300*  LOAD THE INFORMATION FROM THE SKU ADD EXTRACT FILE INTO THE  * 01530003
015310*  HOST VARIABLES AND PERFORM A PARAGRAPH TO INSERT THE NEW ROW * 01531003
015320*  INTO THE XLT_SKU TABLE.                                      * 01532003
015400***************************************************************** 01540001
015500 2000-PROCESS-INPUT-FILE.                                         01550001
015600                                                                  01560001
015700     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       01570001
015800                                                                  01580001
016361     MOVE IM053-INTR-UPC-ID          TO XLT00003-INTR-UPC-ID.     01636108
016362     MOVE IM053-RMS-STYL-ID          TO XLT00003-STYL-ID.         01636208
016363     MOVE IM053-ITM-NBR              TO XLT00003-ITM-NBR.         01636308
016364     MOVE IM053-SKU                  TO XLT00003-SKU-NBR.         01636408
016365     MOVE IM053-SKU-STAT-CDE         TO XLT00003-SKU-STAT-CDE.    01636508
016366     MOVE IM053-SKU-STAT-DESC        TO XLT00003-SKU-STAT-DESC.   01636608
016367     MOVE IM053-INNR-PK-QTY          TO XLT00003-INNR-PK-QTY.     01636708
016368     MOVE IM053-OUTR-PK-QTY          TO XLT00003-OUTR-PK-QTY.     01636808
           MOVE IM053-INTR-UPC-DESC        TO XLT00003-SKU-DESC.        01636911
016370     MOVE IM053-KOHLS-SIZE-CDE       TO XLT00003-KOHLS-SIZE-CDE.  01637008
016371     MOVE IM053-KOHLS-SIZE-DESC      TO XLT00003-SIZE-DESC.       01637108
016372     MOVE IM053-NRF-CLOR-CDE         TO XLT00003-NRF-CLOR-CDE.    01637208
016373     MOVE IM053-SHRT-CLOR-DESC       TO XLT00003-SHRT-CLOR-DESC.  01637409
016374     MOVE IM053-CSTM-CLOR-DESC       TO XLT00003-CSTM-CLOR-DESC.  01637509
016375     MOVE IM053-REGN-PRIC-IND        TO XLT00003-REGN-PRIC-IND.   01637609
016376     MOVE IM053-KY-ITM-IND           TO XLT00003-KY-ITM-IND.      01637709
016377     MOVE IM053-GP-CDE               TO XLT00003-GP-CDE.          01637809
016380                                                                  01638001
016400     PERFORM 2100-INSERT-XLT-SKU.                                 01640003
017700                                                                  01770001
017800     PERFORM 1000-READ-INPUT-FILE.                                01780001
018500                                                                  01850001
018600                                                                  01860001
021600***************************************************************** 02160001
021700*  INSERT A ROW TO THE XLT_SKU TABLE.                           * 02170003
021800***************************************************************** 02180001
021900 2100-INSERT-XLT-SKU.                                             02190003
022000                                                                  02200001
022100     EXEC SQL                                                     02210001
022200          INSERT                                                  02220001
022300          INTO  XLT_SKU                                           02230003
023093              ( INTR_UPC_ID                                       02309303
023094               ,STYL_ID                                           02309403
023095               ,ITM_NBR                                           02309503
023096               ,SKU_NBR                                           02309603
023097               ,SKU_STAT_CDE                                      02309703
023098               ,SKU_STAT_DESC                                     02309803
023099               ,INNR_PK_QTY                                       02309903
023100               ,OUTR_PK_QTY                                       02310003
                     ,SKU_DESC                                          02311011
023120               ,KOHLS_SIZE_CDE                                    02312003
023130               ,SIZE_DESC                                         02313003
023140               ,NRF_CLOR_CDE                                      02314003
023150               ,SHRT_CLOR_DESC                                    02315003
023160               ,CSTM_CLOR_DESC                                    02316003
023170               ,REGN_PRIC_IND                                     02317003
023180               ,KY_ITM_IND                                        02318003
023190               ,GP_CDE                                            02319014
                     ,LAST_UPD_TMST)                                    02319114
023200          VALUES                                                  02320001
023993             (  :XLT00003-INTR-UPC-ID                             02399304
023994               ,:XLT00003-STYL-ID                                 02399403
023995               ,:XLT00003-ITM-NBR                                 02399503
023996               ,:XLT00003-SKU-NBR                                 02399603
023997               ,:XLT00003-SKU-STAT-CDE                            02399703
023998               ,:XLT00003-SKU-STAT-DESC                           02399803
023999               ,:XLT00003-INNR-PK-QTY                             02399903
024000               ,:XLT00003-OUTR-PK-QTY                             02400003
                     ,:XLT00003-SKU-DESC                                02400111
024002               ,:XLT00003-KOHLS-SIZE-CDE                          02400203
024003               ,:XLT00003-SIZE-DESC                               02400303
024004               ,:XLT00003-NRF-CLOR-CDE                            02400403
024005               ,:XLT00003-SHRT-CLOR-DESC                          02400503
024006               ,:XLT00003-CSTM-CLOR-DESC                          02400603
024007               ,:XLT00003-REGN-PRIC-IND                           02400703
024008               ,:XLT00003-KY-ITM-IND                              02400803
024009               ,:XLT00003-GP-CDE                                  02400914
                     ,CURRENT TIMESTAMP)                                02401014
024010     END-EXEC.                                                    02402001
024100                                                                  02410001
024200     EVALUATE TRUE                                                02420001
024300         WHEN SQLCODE = ZERO                                      02430001
024400              ADD +1                 TO PV-RECORDS-INSERTED       02440001
               WHEN SQLCODE = -803                                      02441013
                    CONTINUE                                            02442013
024500         WHEN SQLCODE NOT = +0                                    02450001
024600              MOVE '2100-INSERT-XLT-SKU'                          02460003
024700                                     TO PV-ABEND-PARAGRAPH        02470001
024800              MOVE 'INSERT XLT_SKU'                               02480003
024810                                     TO PV-ABEND-OPERATION        02481001
024821              MOVE IM053-SKU         TO PV-DISP-SKU               02482109
                    MOVE IM053-ITM-NBR     TO PV-DISP-ITM-NBR           02482210
025500              STRING 'ITEM NBR: '             DELIMITED BY SIZE   02550009
025600                     PV-DISP-ITM-NBR          DELIMITED BY SIZE   02560010
026100                     '  SKU NBR: '            DELIMITED BY SIZE   02610003
026200                     PV-DISP-SKU              DELIMITED BY SIZE   02620003
026700                                   INTO PV-DB2-OPERATION-MESSAGE-102670001
026800                                                                  02680001
026900              MOVE 'XLT_SKU'         TO PV-ABEND-TABLE            02690003
027000              PERFORM Z999-SQL-ABEND                              02700001
027100     END-EVALUATE.                                                02710001
027200                                                                  02720001
027300                                                                  02730001
027400***************************************************************** 02740001
027500* COMMIT THE PENDING TABLE CHANGES.                             * 02750001
027600***************************************************************** 02760001
027700 3000-TABLE-COMMIT.                                               02770001
027800                                                                  02780001
027900     EXEC SQL                                                     02790001
028000          COMMIT                                                  02800001
028100     END-EXEC.                                                    02810001
028200                                                                  02820001
028300                                                                  02830001
028400***************************************************************** 02840001
028500*  DISPLAY DB2 ERROR INFORMATION, ROLLBACK ANY PENDING CHANGES, * 02850001
028510*  AND ABEND THE PROGRAM.                                       * 02851001
028600***************************************************************** 02860001
028700 Z999-SQL-ABEND.                                                  02870001
028800                                                                  02880001
028900     MOVE SQLCODE            TO PV-SQLCODE.                       02890001
029000     MOVE PV-SQLCODE         TO PV-DISP-SQLCODE.                  02900001
029100     DISPLAY '*** DB2 ERROR '.                                    02910001
029200     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  02920001
029300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02930001
029400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02940001
029500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02950001
029600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02960001
029700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02970001
029800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02980001
029900     DISPLAY '*** TABLE 1   = ' PV-ABEND-TABLE.                   02990001
030000                                                                  03000001
030100     COPY DPPD004.                                                03010014
030200                                                                  03020001
030300     MOVE +4013         TO PV-ABEND-CODE.                         03030001
030400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03040001
