000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    RCKUT107.                                         00040000
000500 AUTHOR.        JOE LAROSA.                                       00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN.  MARCH 2000.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS PROGRAM READS IN THE DAILY STORE RECEIPT EXTRACT FILE   * 00100000
001100*  (STOREEXT), CHECKS THE COMPANY CONTROL TABLE (TCOCNTL) FOR   * 00110000
001200*  TOLERANCES ON UNIT/DOLLAR PERCENT VARIANCES AND THE DOLLAR   * 00120000
001300*  VARIANCE THRESHOLD AMOUNT.  IF THE STOREEXT RECORD VARIANCES * 00130000
001400*  ARE BEYOND THE TCOCNTL TOLERANCES, AN EXTRACT RECORD IS      * 00140000
001500*  WRITTEN (FORMAT RCRD051).                                    * 00150000
001600***************************************************************** 00160000
001700*  CHANGED 11/21/00 BY DEANNA BRANTNER                            00170000
001800*   WR# 9900 REMOVE HARDCODED TIME ZONES THAT WERE USED DURING    00180014
001900*            TESTING AND THEN FORGOTTEN.                          00190000
002000*  CHANGED 05/29/02 BY DEANNA BRANTNER                            00191014
002100*   WR# 9900 ADDED CODE TO REPORT UNIT VARIANCE PERCENTAGES ON    00192014
002200*            THE WEEKLY REPORT.  SEE PARA - 1221.                 00193014
002300***************************************************************** 00200000
002400***************************************************************** 00210000
002500 ENVIRONMENT DIVISION.                                            00220000
002600***************************************************************** 00230000
002700 INPUT-OUTPUT SECTION.                                            00240000
002800                                                                  00250000
002900 FILE-CONTROL.                                                    00260000
003000                                                                  00270000
003100     SELECT INPUT-STORE-FILE ASSIGN TO UT-S-INP01.                00280000
003200     SELECT EXTRACT-FILE     ASSIGN TO UT-S-OUT01.                00290000
003300                                                                  00300000
003400***************************************************************** 00310000
003500 DATA DIVISION.                                                   00320000
003600***************************************************************** 00330000
003700 FILE SECTION.                                                    00340000
003800                                                                  00350000
003900 FD  INPUT-STORE-FILE                                             00360000
004000     RECORDING MODE IS F                                          00370000
004100     LABEL RECORDS ARE STANDARD                                   00380000
004200     RECORD CONTAINS 300                                          00390000
004300     BLOCK CONTAINS 0 RECORDS                                     00400000
004400     DATA RECORD IS STORE-RECORD.                                 00410000
004500 01  STORE-RECORD                PIC X(300).                      00420010
004600                                                                  00421010
004700 FD  EXTRACT-FILE                                                 00490000
004800     RECORDING MODE IS F                                          00500000
004900     LABEL RECORDS ARE STANDARD                                   00510000
005000     RECORD CONTAINS 170                                          00520000
005100     BLOCK CONTAINS 0 RECORDS                                     00530000
005200     DATA RECORD IS EXTRACT-RECORD.                               00540000
005300 01  EXTRACT-RECORD              PIC X(170).                      00550000
005400                                                                  00560000
005500***************************************************************** 00570000
005600 WORKING-STORAGE SECTION.                                         00580000
005700                                                                  00590000
005800 01  PS-PROGRAM-SWITCHES.                                         00600000
005900     05  PS-END-OF-INPUT-SW           PIC  X(01) VALUE 'N'.       00610000
006000         88  PS-END-OF-INPUT                     VALUE 'Y'.       00620000
006100         88  PS-NOT-END-OF-INPUT                 VALUE 'N'.       00630000
006200     05  PS-END-OF-CURSOR-SW          PIC  X(01) VALUE 'N'.       00640000
006300         88  PS-END-OF-CURSOR-YES                VALUE 'Y'.       00650000
006400         88  PS-END-OF-CURSOR-NO                 VALUE 'N'.       00660000
006500     05  PS-WRITE-EXTRACT-SW          PIC  X(01) VALUE 'N'.       00670000
006600         88  PS-WRITE-EXTRACT-YES                VALUE 'Y'.       00680000
006700         88  PS-WRITE-EXTRACT-NO                 VALUE 'N'.       00690000
006800                                                                  00700000
006900 01  CC-CONTROL-CARD-PARAMETERS.                                  00710000
007000     05  CC-FREQUENCY                 PIC  X(06).                 00720000
007100         88  CC-DAILY                            VALUE 'DAILY '.  00730000
007200         88  CC-WEEKLY                           VALUE 'WEEKLY'.  00740000
007300     05  FILLER                       PIC  X(74) VALUE SPACES.    00750000
007400                                                                  00760000
007500 01  DK-DB2-KEY-FIELDS.                                           00770000
007600     05  DK-ORD-NBR                   PIC S9(09) COMP.            00790000
007700     05  DK-REC-SEQ-NBR               PIC S9(09) COMP.            00800000
007800     05  DK-PO-NBR                    PIC S9(09) COMP.            00810000
007900     05  DK-PO-LNE-NBR                PIC S9(09) COMP.            00820000
008000                                                                  00830000
008100 01  PV-PROGRAM-VARIABLES.                                        00840000
008200     05  PV-SQLCODE                   PIC  9(09) VALUE ZERO.      00850000
008300     05  PV-CURR-PO                   PIC  9(08) VALUE ZERO.      00860000
008400     05  PV-CURR-RCVR                 PIC  9(09) VALUE ZERO.      00870000
008500     05  PV-ACCUM-UNITS-RECVD         PIC  9(09) VALUE ZERO.      00880000
008600     05  PV-ACCUM-UNITS-MARK          PIC  9(09) VALUE ZERO.      00890000
008700     05  PV-UNITS-DIFF                PIC S9(09) VALUE ZERO.      00900000
008800     05  PV-ACCUM-PRICE-RECVD         PIC  9(09)V99 VALUE ZERO.   00910000
008900     05  PV-ACCUM-PRICE-MARK          PIC  9(09)V99 VALUE ZERO.   00920000
009000     05  PV-ACCUM-PRICE-DIFF          PIC S9(09)V99 VALUE ZERO.   00930000
009100     05  PV-ACCUM-PRICE-DIFF-NS       PIC  9(09)V99 VALUE ZERO.   00940000
009200                                                                  00950000
009300     05  PV-RECORDS-READ              PIC S9(08) VALUE ZERO.      00960000
009400     05  PV-RECORDS-WRITTEN           PIC S9(08) VALUE ZERO.      00970000
009500     05  PV-RECORDS-NOT-WRITTEN       PIC S9(08) VALUE ZERO.      00980000
009600                                                                  00990000
009700     05  PV-VAR-PCT                   PIC  9(09)V9(8).            01000000
009800     05  PV-UNIT-VAR-PCT              PIC  9(09)V9(8).            01001014
009900                                                                  01010000
010000     05  PV-OPER-UNT-ID               PIC  9(04).                 01020000
010100     05  PV-SAVE-UNT-VAR-PCT          PIC S9(02)V.                01030000
010200     05  PV-SAVE-DOL-VAR-PCT          PIC S9(02)V.                01040000
010300     05  PV-SAVE-DOL-THRS-AMT         PIC S9(05)V99.              01050000
010400     05  PV-SAVE-TIME-ZONE            PIC  X(03).                 01060000
010500     05  PV-DOLLAR-VARIANCE           PIC  9(06)V999.             01070000
010600     05  PV-PURITM-COST               PIC  9(04)V999.             01080000
010700                                                                  01090000
010800     05  PV-DISPLAY-RECVD             PIC ZZZ,ZZ9-.               01100000
010900     05  PV-DISPLAY-MARK              PIC ZZZ,ZZ9-.               01110000
011000     05  PV-DISPLAY-AMT               PIC ZZZ,ZZZ.99-.            01120000
011100     05  PV-DISPLAY-RECORD            PIC ZZ,ZZZ,ZZ9-.            01130000
011200                                                                  01140000
011300     05  PV-DATE-VERIFIED             PIC  X(26) VALUE SPACE.     01150000
011400     05  FILLER REDEFINES PV-DATE-VERIFIED.                       01160000
011500         10  PV-DATE-VERIFIED-CC      PIC 99.                     01170000
011600         10  PV-DATE-VERIFIED-YY      PIC 99.                     01180000
011700         10  PV-DATE-VERIFIED-1ST     PIC X.                      01190000
011800         10  PV-DATE-VERIFIED-MM      PIC 99.                     01200000
011900         10  PV-DATE-VERIFIED-2ND     PIC X.                      01210000
012000         10  PV-DATE-VERIFIED-DD      PIC 99.                     01220000
012100         10  PV-DATE-VERIFIED-3RD     PIC X.                      01230000
012200         10  PV-DATE-TIMESTAMP.                                   01240000
012300             15  PV-DATE-TIME-HH      PIC 99.                     01250000
012400             15  PV-DATE-TIME-1ST     PIC X(01).                  01260000
012500             15  PV-DATE-TIME-MM      PIC 99.                     01270000
012600             15  PV-DATE-TIME-2ND     PIC X(01).                  01280000
012700             15  PV-DATE-TIME-SS      PIC 99.                     01290000
012800             15  PV-DATE-TIME-3RD     PIC X(01).                  01300000
012900             15  PV-DATE-TIME-6       PIC 999999.                 01310000
013000                                                                  01320000
013100 01 PC-PROGRAM-CONSTANTS.                                         01330000
013200     05 PC-PROGRAM-NAME               PIC  X(08) VALUE 'RCKUT107'.01340000
013300                                                                  01350000
013400 01  PV-ABEND-FIELDS.                                             01360000
013500     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01370000
013600                                                 COMP SYNC.       01380000
013700     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RCKUT107'.01390000
013800     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01400000
013900     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01410000
014000     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01420000
014100     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    01430000
014200     05  PV-ABEND-STRUCTURE-3         PIC  X(08) VALUE SPACES.    01440000
014300     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01450000
014400     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01460000
014500     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01470000
014600     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01480000
014700     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    01490000
014800                                                                  01500000
014900 01  PV-TCOCNTL-TABLE.                                            01510000
015000     05  TCOCNTL-TABLE  OCCURS 50 TIMES INDEXED BY DC-IDX.        01520000
015100         10  PV-TCOCNTL-OPER-UNT-ID   PIC  9(04).                 01530000
015200         10  PV-TCOCNTL-UNT-VAR-PCT   PIC  9(02)V.                01540000
015300         10  PV-TCOCNTL-DOL-VAR-PCT   PIC  9(02)V.                01550000
015400         10  PV-TCOCNTL-DOL-THRS-AMT  PIC  9(05)V99.              01560000
015500         10  PV-STORE-TIME-ZONE       PIC  X(03).                 01570000
015600                                                                  01580000
015700******************************************************************01590000
015800*  USED FOR DB2 ERROR MESSAGE BUILDING                            01600000
015900******************************************************************01610000
016000     COPY DPWS004.                                                01620016
016100                                                                  01630000
016200******************************************************************01640000
016300*   DB2 SQL COMMUNICATION AREA                                    01650000
016400******************************************************************01660000
016500     EXEC SQL                                                     01670000
016600          INCLUDE SQLCA                                           01680000
016700     END-EXEC.                                                    01690000
016800                                                                  01700000
016900******************************************************************01710000
017000*   COMPANY CONTROL TABLE                                         01720000
017100******************************************************************01730000
017200     EXEC SQL                                                     01740000
017300          INCLUDE TCOCNTL                                         01750000
017400     END-EXEC.                                                    01760000
017500*                                                                 01710000
017600*   PARM TABLE                                                    01720000
017700*                                                                 01730000
017800     EXEC SQL                                                     01740000
017900          INCLUDE TKRPRPM                                         01750000
018000     END-EXEC.                                                    01760000
018100                                                                  01770000
018200     EXEC SQL                                                     01780000
018300         DECLARE DC-CSR CURSOR FOR                                01790000
018400          SELECT OPER_UNT_ID                                      01800000
018500               , UNT_VRFN_VARN_PCT                                01810000
018600               , DOL_VRFN_VARN_PCT                                01820000
018700               , DOL_VARN_THRS_AMT                                01830000
018800               , B.FUNC_TXT                                               
018900            FROM TCOCNTL  A                                       01840000
019000            ,    TKRPRPM  B                                               
019100        WHERE A.OPER_UNT_ID      = B.LOC_ID                               
019200          AND B.SYS_PRC_FUNC_CDE = 'STATZN'                               
019300          AND B.INTFC_SYS_CDE    = 'KHL'                                  
019400        ORDER BY OPER_UNT_ID ASC                                  01850000
019500     END-EXEC.                                                    01860000
019600                                                                  01870000
019700******************************************************************01880000
019800*   DB2 DCLGEN FOR THE RECEIVING MASTER TABLE                     01890000
019900******************************************************************01900000
020000     EXEC SQL                                                     01910000
020100          INCLUDE TRECEIV                                         01920000
020200     END-EXEC.                                                    01930000
020300                                                                  02010000
020400******************************************************************02020000
020500*   DB2 DCLGEN FOR THE PURCHASE ITEM TABLE                        02030000
020600******************************************************************02040000
020700     EXEC SQL                                                     02050000
020800          INCLUDE TPURITM                                         02060000
020900     END-EXEC.                                                    02070000
021000                                                                  02080000
021100******************************************************************02090000
021200*   DB2 DCLGEN FOR THE TROUBLE NOTIFY TABLE                       02100000
021300******************************************************************02110000
021400     EXEC SQL                                                     02120000
021500          INCLUDE TTRBNTF                                         02130000
021600     END-EXEC.                                                    02140000
021700                                                                  02150000
021800******************************************************************02160000
021900*   DB2 DCLGEN FOR THE REPORT CONTROL TABLE                       02170000
022000******************************************************************02180000
022100     EXEC SQL                                                     02190000
022200          INCLUDE TTRBRCN                                         02200000
022300     END-EXEC.                                                    02210000
022400                                                                  02220000
022500***********************************************************       02230000
022600*  COPYBOOK USED BY INPUT FILE                            *       02240000
022700***********************************************************       02250000
022800     COPY STOREEXT.                                               02260016
022900                                                                  02270000
023000***********************************************************       02280000
023100*  COPYBOOK USED IN CREATING EXTRACT FILE.                *       02290000
023200***********************************************************       02300000
023300     COPY RCRD051.                                                02310016
023400/                                                                 02320016
023700***********************************************************       02320312
023800 01  STORE-REC.                                                   02321012
023900     05  FILLER                  PIC X(019).                      02321112
024000     05  SE-INP-PO               PIC 9(008).                      02322012
024100     05  FILLER                  PIC X(174).                      02323012
024200     05  SE-INP-RCVR             PIC 9(009).                      02324012
024300     05  FILLER                  PIC X(090).                      02325012
024400                                                                  02326012
024500***********************************************************       02340000
024600 PROCEDURE DIVISION.                                              02350000
024700***********************************************************       02360000
024800     DISPLAY '*** BEGINNING RCKUT107 ***'.                        02370000
024900                                                                  02380000
025000     OPEN INPUT  INPUT-STORE-FILE                                 02390000
025100          OUTPUT EXTRACT-FILE.                                    02400000
025200                                                                  02410000
025300*READ FIRST INPUT RECORD.                                         02420000
025400     SET PS-NOT-END-OF-INPUT TO TRUE.                             02430000
025500     READ INPUT-STORE-FILE                                        02440000
025600       INTO STORE-EXTRACT-LINE                                    02450000
025700         AT END                                                   02460000
025800           SET PS-END-OF-INPUT TO TRUE.                           02470000
025900                                                                  02480000
026000*PROCESS INPUT FILE.                                              02490000
026100     IF PS-END-OF-INPUT                                           02500000
026200         DISPLAY '**** NO INPUT FILE FOUND FOR RCKUT107 ****'     02510000
026300     ELSE                                                         02520000
026400         PERFORM 0100-INITIALIZATION                              02530000
026500         PERFORM 1000-PROCESS-INPUT                               02540000
026600           UNTIL PS-END-OF-INPUT                                  02550000
026700     END-IF.                                                      02560000
026800                                                                  02570000
026900     DISPLAY '****************************************'.          02580000
027000     MOVE PV-RECORDS-READ        TO PV-DISPLAY-RECORD.            02590000
027100     DISPLAY '*** RECORDS READ        ==> ' PV-DISPLAY-RECORD.    02600000
027200     MOVE PV-RECORDS-WRITTEN     TO PV-DISPLAY-RECORD.            02610000
027300     DISPLAY '*** RECORDS WRITTEN     ==> ' PV-DISPLAY-RECORD.    02620000
027400     MOVE PV-RECORDS-NOT-WRITTEN TO PV-DISPLAY-RECORD.            02630000
027500     DISPLAY '*** RECORDS NOT WRITTEN ==> ' PV-DISPLAY-RECORD.    02640000
027600     DISPLAY '****************************************'.          02650000
027700                                                                  02660000
027800*CLOSE FILES.                                                     02670000
027900     CLOSE INPUT-STORE-FILE                                       02680000
028000           EXTRACT-FILE.                                          02690000
028100                                                                  02700000
028200     GOBACK.                                                      02710000
028300                                                                  02720000
028400                                                                  02730000
028500******************************************************************02740000
028600 0100-INITIALIZATION.                                             02750000
028700******************************************************************02760000
028800     MOVE '0100-INITIALATION            ' TO PV-ABEND-PARAGRAPH.  02770000
028900                                                                  02780000
029000     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                02790000
029100     DISPLAY '  CONTROL CARD PARAMETER FOR THIS RUN IS: '         02800000
029200             CC-FREQUENCY.                                        02810000
029300     DISPLAY ' '.                                                 02820000
029400                                                                  02830000
029500     PERFORM 0010-INITIALIZE-TCOCNTL-TABLE.                       02840000
029600     PERFORM 0020-LOAD-TCOCNTL-TABLE.                             02850000
029700                                                                  02860000
029800     MOVE SE-PO               TO SE-INP-PO                        02870012
029900                                 PV-CURR-PO.                      02890012
030000     MOVE SE-REC-SEQ-NBR      TO SE-INP-RCVR                      02901012
030100                                 PV-CURR-RCVR.                    02902012
030200     MOVE ZEROES              TO PV-ACCUM-UNITS-RECVD             02910000
030300                                 PV-ACCUM-UNITS-MARK              02920000
030400                                 PV-ACCUM-PRICE-RECVD             02930000
030500                                 PV-ACCUM-PRICE-MARK              02940000
030600                                 PV-ACCUM-PRICE-DIFF.             02950000
030700     SET PS-WRITE-EXTRACT-YES TO TRUE.                            02960000
030800                                                                  02970000
030900******************************************************************02980000
031000 0010-INITIALIZE-TCOCNTL-TABLE.                                   02990000
031100******************************************************************03000000
031200     MOVE '0010-INITIALIZE-TCOCNTL-TABLE' TO PV-ABEND-PARAGRAPH.  03010000
031300                                                                  03020000
031400     PERFORM                                                      03030000
031500       VARYING DC-IDX FROM 1 BY 1 UNTIL DC-IDX > 50               03040000
031600         MOVE ZEROES TO PV-TCOCNTL-OPER-UNT-ID (DC-IDX)           03050000
031700                        PV-TCOCNTL-UNT-VAR-PCT (DC-IDX)           03060000
031800                        PV-TCOCNTL-DOL-VAR-PCT (DC-IDX)           03070000
031900                        PV-TCOCNTL-DOL-THRS-AMT (DC-IDX)          03080000
032000         MOVE SPACES TO PV-STORE-TIME-ZONE (DC-IDX)               03090000
032100     END-PERFORM.                                                 03100000
032200                                                                  03110000
032300******************************************************************03120000
032400 0020-LOAD-TCOCNTL-TABLE.                                         03130000
032500******************************************************************03140000
032600     MOVE '0020-LOAD-TCOCNTL-TABLE    ' TO PV-ABEND-PARAGRAPH.    03150000
032700                                                                  03160000
032800*OPEN CURSOR.                                                     03170000
032900     EXEC SQL                                                     03180000
033000         OPEN DC-CSR                                              03190000
033100     END-EXEC.                                                    03200000
033200                                                                  03210000
033300     EVALUATE TRUE                                                03220000
033400       WHEN SQLCODE = ZERO                                        03230000
033500           CONTINUE                                               03240000
033600                                                                  03250000
033700       WHEN OTHER                                                 03260000
033800           MOVE '0020-LOAD-TCOCNTL-TABLE' TO PV-ABEND-PARAGRAPH   03270000
033900           MOVE 'OPEN CURSOR' TO PV-DB2-OPERATION-MESSAGE-1       03280000
034000           MOVE 'TCOCNTL'     TO PV-DB2-TABLE-NAME                03290000
034100           PERFORM 9900-DB2-ABEND                                 03300000
034200     END-EVALUATE.                                                03310000
034300                                                                  03320000
034400*LOAD INTERNAL TABLE FROM CURSOR.                                 03330000
034500     SET PS-END-OF-CURSOR-NO TO TRUE                              03340000
034600     PERFORM 0021-FETCH-CURSOR.                                   03350000
034700                                                                  03360000
034800     PERFORM                                                      03370000
034900       VARYING DC-IDX FROM 1 BY 1                                 03380000
035000         UNTIL DC-IDX > 50 OR PS-END-OF-CURSOR-YES                03390000
035100                                                                  03400000
035200         MOVE COCNTL-OPER-UNT-ID                                  03410000
035300                           TO PV-TCOCNTL-OPER-UNT-ID (DC-IDX)     03420000
035400                              SE-LOC-NBR                          03430005
035500         MOVE COCNTL-UNT-VRFN-VARN-PCT                            03440000
035600                           TO PV-TCOCNTL-UNT-VAR-PCT (DC-IDX)     03450000
035700         MOVE COCNTL-DOL-VRFN-VARN-PCT                            03460000
035800                           TO PV-TCOCNTL-DOL-VAR-PCT (DC-IDX)     03470000
035900         MOVE COCNTL-DOL-VARN-THRS-AMT                            03480000
036000                           TO PV-TCOCNTL-DOL-THRS-AMT (DC-IDX)    03490000
036100         MOVE KRPRPM-FUNC-TXT                                             
036200                           TO PV-STORE-TIME-ZONE (DC-IDX)         03490000
036300                                                                  03500000
036500         DISPLAY 'TCOCNTL TABLE = '                               03520000
036600                 PV-TCOCNTL-OPER-UNT-ID (DC-IDX)                  03530000
036700                 ' ' PV-STORE-TIME-ZONE (DC-IDX)                  03540000
036800                 ' UNIT-VAR= ' PV-TCOCNTL-UNT-VAR-PCT (DC-IDX)            
036900                 ' DOL-VAR= ' PV-TCOCNTL-DOL-VAR-PCT (DC-IDX)             
037000                 ' THRS-AMT= ' PV-TCOCNTL-DOL-THRS-AMT (DC-IDX)           
037100                                                                  03550000
037200         PERFORM 0021-FETCH-CURSOR                                03560000
037300     END-PERFORM.                                                 03570000
037400                                                                  03580000
037500*CLOSE CURSOR.                                                    03590000
037600     EXEC SQL                                                     03600000
037700         CLOSE DC-CSR                                             03610000
037800     END-EXEC.                                                    03620000
037900                                                                  03630000
038000     EVALUATE TRUE                                                03640000
038100       WHEN SQLCODE = ZERO                                        03650000
038200           CONTINUE                                               03660000
038300                                                                  03670000
038400       WHEN OTHER                                                 03680000
038500           MOVE '0020-LOAD-TCOCNTL-TABLE' TO PV-ABEND-PARAGRAPH   03690000
038600           MOVE 'CLOSE CURSOR' TO PV-DB2-OPERATION-MESSAGE-1      03700000
038700           MOVE 'TCOCNTL'      TO PV-DB2-TABLE-NAME               03710000
038800           PERFORM 9900-DB2-ABEND                                 03720000
038900     END-EVALUATE.                                                03730000
039000                                                                  03740000
039100******************************************************************03750000
039200 0021-FETCH-CURSOR.                                               03760000
039300******************************************************************03770000
039400     MOVE '0021-FETCH-CURSOR          ' TO PV-ABEND-PARAGRAPH.    03780000
039500                                                                  03790000
039600     EXEC SQL                                                     03800000
039700         FETCH DC-CSR                                             03810000
039800          INTO :COCNTL-OPER-UNT-ID                                03820000
039900             , :COCNTL-UNT-VRFN-VARN-PCT                          03830000
040000             , :COCNTL-DOL-VRFN-VARN-PCT                          03840000
040100             , :COCNTL-DOL-VARN-THRS-AMT                          03850000
040200             , :KRPRPM-FUNC-TXT                                   03850000
040300     END-EXEC.                                                    03860000
040400                                                                  03870000
040500     EVALUATE TRUE                                                03880000
040600       WHEN SQLCODE = ZERO                                        03890000
040700           CONTINUE                                               03900000
040800                                                                  03910000
040900       WHEN SQLCODE = +100                                        03920000
041000           SET PS-END-OF-CURSOR-YES TO TRUE                       03930000
041100                                                                  03940000
041200       WHEN OTHER                                                 03950000
041300           MOVE '0021-FETCH-CURSOR' TO PV-ABEND-PARAGRAPH         03960000
041400           MOVE 'FETCH CURSOR' TO PV-DB2-OPERATION-MESSAGE-1      03970000
041500           MOVE 'TCOCNTL'      TO PV-DB2-TABLE-NAME               03980000
041600           PERFORM 9900-DB2-ABEND                                 03990000
041700     END-EVALUATE.                                                04000000
044300                                                                  04290000
044400***************************************************************** 04300000
044500 1000-PROCESS-INPUT.                                              04310000
044600***************************************************************** 04320000
044700     MOVE '1000-PROCESS-INPUT         ' TO PV-ABEND-PARAGRAPH.    04330000
044800                                                                  04340000
044900     ADD +1 TO PV-RECORDS-READ.                                   04350000
045000                                                                  04360000
045100*EDIT INPUT RECORD.                                               04370000
045200     IF CC-DAILY                                                  04380000
045300       OR CC-WEEKLY                                               04390000
045400         PERFORM 1100-ACCUM-ORDER                                 04400000
045500     END-IF.                                                      04410000
045600                                                                  04420000
045700*READ NEXT INPUT RECORD.                                          04430000
045800     IF CC-DAILY                                                  04440000
045900       OR CC-WEEKLY                                               04450000
046000         PERFORM 2000-READ-INPUT-FILE                             04460000
046100     ELSE                                                         04470000
046200         SET PS-END-OF-INPUT TO TRUE                              04480000
046300     END-IF.                                                      04490000
046400                                                                  04500000
046500***************************************************************** 04510000
046600 1100-ACCUM-ORDER.                                                04520000
046700***************************************************************** 04530000
046800     MOVE '1100-ACCUM-ORDER             ' TO PV-ABEND-PARAGRAPH.  04540000
046900                                                                  04550000
047000*WHEN PO/RCVR CHG, VERIFY ORDER & RESET FOR NEXT PO/RCVR.         04560000
047100     IF (SE-INP-PO NOT = PV-CURR-PO)                              04570012
047200       OR (SE-INP-RCVR NOT = PV-CURR-RCVR)                        04580012
047300         PERFORM 1200-VERIFY-ORDER                                04590000
047400         MOVE SE-INP-PO           TO PV-CURR-PO                   04600012
047500         MOVE SE-INP-RCVR         TO PV-CURR-RCVR                 04610012
047600         MOVE ZEROES              TO PV-ACCUM-UNITS-RECVD         04620000
047700                                     PV-ACCUM-UNITS-MARK          04630000
047800                                     PV-ACCUM-PRICE-RECVD         04640000
047900                                     PV-ACCUM-PRICE-MARK          04650000
048000                                     PV-ACCUM-PRICE-DIFF          04660000
048100         SET PS-WRITE-EXTRACT-YES TO TRUE                         04670000
048200     END-IF.                                                      04680000
048300                                                                  04690000
048400     MOVE STORE-RECORD TO STORE-EXTRACT-LINE.                     04700012
048500                                                                  04711012
048600*ACCUMULATE UNITS.                                                04720000
048700     COMPUTE PV-ACCUM-UNITS-RECVD  = PV-ACCUM-UNITS-RECVD         04730000
048800                                   + SE-RETAIL-UNITS-RECVD.       04740000
048900     COMPUTE PV-ACCUM-UNITS-MARK   = PV-ACCUM-UNITS-MARK          04750000
049000                                   + SE-RETAIL-UNITS-MARK.        04760000
049100                                                                  04770000
049200*GET UNIT PRICE FROM TPURITM AND CALCULATE PRICE DIFFERENCE.      04780000
049300     IF PS-WRITE-EXTRACT-YES                                      04790000
049400         MOVE SE-PO       TO DK-PO-NBR                            04800000
049500         MOVE SE-POLINENO TO DK-PO-LNE-NBR                        04810000
049600         PERFORM 1110-SELECT-TPURITM                              04820000
049700         IF PS-WRITE-EXTRACT-YES                                  04830000
049800             COMPUTE PV-ACCUM-PRICE-RECVD = PV-ACCUM-PRICE-RECVD  04840000
049900                   + (SE-RETAIL-UNITS-RECVD * PV-PURITM-COST)     04850000
050000             COMPUTE PV-ACCUM-PRICE-MARK = PV-ACCUM-PRICE-MARK    04860000
050100                   + (SE-RETAIL-UNITS-MARK * PV-PURITM-COST)      04870000
050200             COMPUTE PV-UNITS-DIFF = SE-RETAIL-UNITS-RECVD        04880000
050300                                   - SE-RETAIL-UNITS-MARK         04890000
050400             COMPUTE PV-ACCUM-PRICE-DIFF = PV-ACCUM-PRICE-DIFF    04900000
050500                                         + (PV-UNITS-DIFF         04910000
050600                                          * PV-PURITM-COST)       04920000
050700             MOVE PV-ACCUM-PRICE-DIFF TO PV-ACCUM-PRICE-DIFF-NS   04930000
050800         END-IF                                                   04940000
050900     END-IF.                                                      04950000
051000                                                                  04960000
051100***************************************************************** 04970000
051200 1110-SELECT-TPURITM.                                             04980000
051300***************************************************************** 04990000
051400     MOVE '1110-SELECT-TPURITM        ' TO PV-ABEND-PARAGRAPH.    05000000
051500                                                                  05010000
051600     MOVE ZEROES TO PV-PURITM-COST.                               05020000
051700                                                                  05030000
051800     INITIALIZE DCLTPURITM.                                       05040000
051900                                                                  05050000
052000     EXEC SQL                                                     05060000
052100       SELECT UNT_COST_AMT                                        05070000
052200         INTO :PURITM-UNT-COST-AMT                                05080000
052300         FROM TPURITM                                             05090000
052400        WHERE PO_NBR          = :DK-PO-NBR                        05100000
052500          AND APP_PO_LNE_NBR  = :DK-PO-LNE-NBR                    05110015
052600          AND VER_STATUS_CDE  = 'A'                               05120000
052700     END-EXEC.                                                    05130000
052800                                                                  05140000
052900     EVALUATE TRUE                                                05150000
053000       WHEN SQLCODE = ZEROES                                      05160000
053100           MOVE PURITM-UNT-COST-AMT TO PV-PURITM-COST             05170000
053200                                                                  05180000
053300       WHEN SQLCODE = +100                                        05190000
053400           SET PS-WRITE-EXTRACT-NO TO TRUE                        05200000
053500           ADD +1 TO PV-RECORDS-NOT-WRITTEN                       05210000
053600           DISPLAY '*** COST NOT FOUND FOR ==> ' SE-PO '/'        05220000
053700                                                 SE-POLINENO      05230000
053800                                                                  05240000
053900       WHEN OTHER                                                 05250000
054000           MOVE '1110-SELECT-TPURITM' TO PV-ABEND-PARAGRAPH       05260000
054100           MOVE 'GET PO COST ' TO PV-DB2-OPERATION-MESSAGE-1      05270000
054200           MOVE 'TPURITM'      TO PV-DB2-TABLE-NAME               05280000
054300           PERFORM 9900-DB2-ABEND                                 05290000
054400     END-EVALUATE.                                                05300000
054500                                                                  05310000
054600***************************************************************** 05320000
054700 1200-VERIFY-ORDER.                                               05330000
054800***************************************************************** 05340000
054900     MOVE '1200-VERIFY-ORDER          ' TO PV-ABEND-PARAGRAPH.    05350000
055000                                                                  05360000
055100*CHECK CARTON QUANTITIES (EXPECTED VS. ACTUAL) - DAILY ONLY.      05370000
055200     IF PS-WRITE-EXTRACT-YES                                      05380000
055300         MOVE PV-CURR-PO   TO DK-ORD-NBR                          05390000
055400         MOVE PV-CURR-RCVR TO DK-REC-SEQ-NBR                      05400000
055500         PERFORM 1210-SELECT-TRECEIV                              05410000
055600     END-IF.                                                      05420000
055700                                                                  05430000
055800*EXPECTED VS. ACTUAL ITEMS MUST NOT MATCH - DAILY ONLY.           05440000
055900     IF PS-WRITE-EXTRACT-YES                                      05450000
056000         IF PV-ACCUM-UNITS-RECVD = PV-ACCUM-UNITS-MARK            05460000
056100             IF CC-DAILY                                          05470000
056200                 SET PS-WRITE-EXTRACT-NO TO TRUE                  05480000
056300                 ADD +1 TO PV-RECORDS-NOT-WRITTEN                 05490000
056400             END-IF                                               05500000
056500         END-IF                                                   05510000
056600     END-IF.                                                      05520000
056700                                                                  05530000
056800*COMPARE ACCUM/CALC VALUES VS. DC TABLE VALUES - DAILY & WEEKLY.  05540000
056900     IF PS-WRITE-EXTRACT-YES                                      05550000
057000         MOVE SE-CURR-OPER-UNT-ID TO PV-OPER-UNT-ID               05560000
057100         IF CC-DAILY                                              05570000
057200             PERFORM 1220-CALC-COMPARE-DLY                        05580000
057300         END-IF                                                   05590000
057400         IF CC-WEEKLY                                             05600000
057500             PERFORM 1221-CALC-COMPARE-WKLY                       05610000
057600         END-IF                                                   05620000
057700     END-IF.                                                      05630000
057800                                                                  05640000
058300*WRITE EXTRACT RECORD.                                            05650000
058400                                                                          
058500     IF PS-WRITE-EXTRACT-YES                                      05660000
058600         PERFORM 1500-CREATE-EXTRACT-RECORD                       05670000
058700         ADD +1 TO PV-RECORDS-WRITTEN                             05680000
058800     END-IF.                                                      05690000
058900                                                                  05700000
059000***************************************************************** 05710000
059100 1210-SELECT-TRECEIV.                                             05720000
059200***************************************************************** 05730000
059300     MOVE '1210-SELECT-TRECEIV        ' TO PV-ABEND-PARAGRAPH.    05740000
059400                                                                  05750000
059500     INITIALIZE DCLTRECEIV.                                       05760000
059600                                                                  05770000
059700     EXEC SQL                                                     05780000
059800       SELECT ORD_NBR                                             05790000
059900            , REC_SEQ_NBR                                         05800000
060000            , EXPTED_CART_CNT                                     05810000
060100            , ACTL_CART_CNT                                       05820000
060200            , EXPTED_ITM_QTY                                      05830000
060300            , ACTL_ITM_QTY                                        05840000
060400            , VERFYD_TMST                                         05850000
060400            , VRFD_USR_ID                                                 
060500         INTO :RECEIV-ORD-NBR                                     05860000
060600            , :RECEIV-REC-SEQ-NBR                                 05870000
060700            , :RECEIV-EXPTED-CART-CNT                             05880000
060800            , :RECEIV-ACTL-CART-CNT                               05890000
060900            , :RECEIV-EXPTED-ITM-QTY                              05900000
061000            , :RECEIV-ACTL-ITM-QTY                                05910000
061100            , :RECEIV-VERFYD-TMST                                 05920000
061100            , :RECEIV-VRFD-USR-ID                                         
061200         FROM TRECEIV                                             05930000
061300        WHERE ORD_NBR      = :DK-ORD-NBR                          05940000
061400         AND  REC_SEQ_NBR  = :DK-REC-SEQ-NBR                      05950000
061500     END-EXEC.                                                    05960000
061600                                                                  05970000
061700     EVALUATE TRUE                                                05980000
061800       WHEN SQLCODE = ZEROS                                       05990000
061900*EXPECTED VS. ACTUAL CARTONS MUST MATCH.                          06000000
062000           IF CC-DAILY                                            06010000
062100             AND (RECEIV-EXPTED-CART-CNT NOT =                    06020000
062200                                         RECEIV-ACTL-CART-CNT)    06030000
062300               SET PS-WRITE-EXTRACT-NO TO TRUE                    06040000
062400               ADD +1 TO PV-RECORDS-NOT-WRITTEN                   06050000
062500           END-IF                                                 06060000
062600                                                                  06070000
062700       WHEN SQLCODE = +100                                        06080000
062800           SET PS-WRITE-EXTRACT-NO TO TRUE                        06090000
062900           ADD +1 TO PV-RECORDS-NOT-WRITTEN                       06100000
063000           DISPLAY '*** ORDER NOT FOUND ==> ' SE-PO '-'           06110000
063100                                            SE-REC-SEQ-NBR        06120000
063200                                                                  06130000
063300       WHEN OTHER                                                 06140000
063400           MOVE '1210-SELECT-TRECEIV' TO PV-ABEND-PARAGRAPH       06150000
063500           MOVE 'SELECT ORDER' TO PV-DB2-OPERATION-MESSAGE-1      06160000
063600           MOVE 'TRECEIV'      TO PV-DB2-TABLE-NAME               06170000
063700           PERFORM 9900-DB2-ABEND                                 06180000
063800     END-EVALUATE.                                                06190000
063900                                                                  06200000
064000***************************************************************** 06210000
064100 1220-CALC-COMPARE-DLY.                                           06220000
064200***************************************************************** 06230000
064300     MOVE '1220-CALC-COMPARE-DLY      ' TO PV-ABEND-PARAGRAPH.    06240000
064400                                                                  06250000
064500*CALCULATE STOREEXT VARIANCE PERCENTAGE.                          06260000
064600     MOVE ZEROES  TO  PV-VAR-PCT.                                 06261007
064700     IF PS-WRITE-EXTRACT-YES                                      06270000
064800         IF PV-ACCUM-UNITS-RECVD = 0                              06290000
064900           OR PV-ACCUM-UNITS-MARK = 0                             06300000
065000             MOVE 100                TO PV-VAR-PCT                06310000
065100         ELSE                                                     06320000
065200             COMPUTE PV-VAR-PCT = ((PV-ACCUM-UNITS-RECVD          06330000
065300                                  - PV-ACCUM-UNITS-MARK)          06340000
065400                                  / PV-ACCUM-UNITS-RECVD)         06350000
065500                                  * 100                           06360000
065600         END-IF                                                   06370000
065700     END-IF.                                                      06380000
065800                                                                  06390000
065900*COMPARE STOREEXT VARIANCE PERCENTAGE TO TABLE PERCENTAGE.        06400000
066000     SET DC-IDX TO 1.                                             06410000
066100     SEARCH TCOCNTL-TABLE                                         06420000
066200       VARYING DC-IDX                                             06430000
066300                                                                  06440000
066400         AT END                                                   06450000
066500             SET PS-WRITE-EXTRACT-NO TO TRUE                      06460000
066600             ADD +1 TO PV-RECORDS-NOT-WRITTEN                     06470000
066700             DISPLAY 'STOREEXT DC NOT FOUND ON TCOCNTL TABLE = '  06480000
066800                      SE-PO ' ' PV-OPER-UNT-ID                    06490000
066900                                                                  06500000
067000         WHEN PV-TCOCNTL-OPER-UNT-ID (DC-IDX) = PV-OPER-UNT-ID    06510000
067100             MOVE PV-TCOCNTL-UNT-VAR-PCT (DC-IDX)                 06520000
067200                                         TO PV-SAVE-UNT-VAR-PCT   06530000
067300             MOVE PV-TCOCNTL-DOL-VAR-PCT (DC-IDX)                 06540000
067400                                         TO PV-SAVE-DOL-VAR-PCT   06550000
067500             MOVE PV-TCOCNTL-DOL-THRS-AMT (DC-IDX)                06560000
067600                                         TO PV-SAVE-DOL-THRS-AMT  06570000
067700             MOVE PV-STORE-TIME-ZONE (DC-IDX)                     06580000
067800                                         TO PV-SAVE-TIME-ZONE     06590000
067900                                                                  06600000
068000             IF PV-VAR-PCT < PV-TCOCNTL-UNT-VAR-PCT (DC-IDX)      06610000
068100                 SET PS-WRITE-EXTRACT-NO TO TRUE                  06620000
068200                 ADD +1 TO PV-RECORDS-NOT-WRITTEN                 06630000
068300             END-IF                                               06640000
068400     END-SEARCH.                                                  06650000
068500                                                                  06660000
068600***************************************************************** 06670000
068700 1221-CALC-COMPARE-WKLY.                                          06680000
068800***************************************************************** 06690000
068900     MOVE '1221-CALC-COMPARE-WKLY     ' TO PV-ABEND-PARAGRAPH.    06700000
069000                                                                  06710000
069100*CALCULATE STOREEXT DOLLAR VARIANCE PERCENTAGE.                   06720000
069200     MOVE ZEROES  TO  PV-VAR-PCT.                                 06721007
069300     IF PS-WRITE-EXTRACT-YES                                      06730000
069400         IF PV-ACCUM-PRICE-RECVD = 0                              06750000
069500           OR PV-ACCUM-PRICE-MARK = 0                             06760000
069600             MOVE 100                TO PV-VAR-PCT                06770000
069700         ELSE                                                     06780000
069800             COMPUTE PV-VAR-PCT = ((PV-ACCUM-PRICE-RECVD          06790000
069900                                  - PV-ACCUM-PRICE-MARK)          06800000
070000                                  / PV-ACCUM-PRICE-RECVD)         06810000
070100                                  * 100                           06820000
070200         END-IF                                                   06830000
070300     END-IF.                                                      06840000
070400                                                                  06850000
070500*COMPARE STOREEXT DOLLAR & PCT VARIANCE VS. DC TABLE VALUES.      06860000
070600     SET DC-IDX TO 1.                                             06870000
070700     SEARCH TCOCNTL-TABLE                                         06880000
070800       VARYING DC-IDX                                             06890000
070900                                                                  06900000
071000         AT END                                                   06910000
071100             SET PS-WRITE-EXTRACT-NO TO TRUE                      06920000
071200             ADD +1 TO PV-RECORDS-NOT-WRITTEN                     06930000
071300             DISPLAY 'STOREEXT DC NOT FOUND ON TCOCNTL TABLE = '  06940000
071400                      SE-PO ' ' PV-OPER-UNT-ID                    06950000
071500                                                                  06960000
071600         WHEN PV-TCOCNTL-OPER-UNT-ID (DC-IDX) = PV-OPER-UNT-ID    06970000
071700             MOVE PV-TCOCNTL-UNT-VAR-PCT (DC-IDX)                 06980000
071800                                         TO PV-SAVE-UNT-VAR-PCT   06990000
071900             MOVE PV-TCOCNTL-DOL-VAR-PCT (DC-IDX)                 07000000
072000                                         TO PV-SAVE-DOL-VAR-PCT   07010000
072100             MOVE PV-TCOCNTL-DOL-THRS-AMT (DC-IDX)                07020000
072200                                         TO PV-SAVE-DOL-THRS-AMT  07030000
072300             MOVE PV-STORE-TIME-ZONE (DC-IDX)                     07040000
072400                                         TO PV-SAVE-TIME-ZONE     07050000
072500*DOLLAR VARIANCE PERCENTAGE MUST BE > THAN DC TABLE.              07060000
072600             IF PV-VAR-PCT < PV-TCOCNTL-DOL-VAR-PCT (DC-IDX)      07070000
072700                 SET PS-WRITE-EXTRACT-NO TO TRUE                  07080000
072800                 ADD +1 TO PV-RECORDS-NOT-WRITTEN                 07090000
072900             END-IF                                               07100000
073000*DOLLAR VARIANCE AMOUNT MUST BE > THAN DC TABLE.                  07110000
073100             IF PV-ACCUM-PRICE-DIFF-NS NOT >                      07120000
073200                            PV-TCOCNTL-DOL-THRS-AMT (DC-IDX)      07130000
073300                 SET PS-WRITE-EXTRACT-NO TO TRUE                  07140000
073400                 ADD +1 TO PV-RECORDS-NOT-WRITTEN                 07150000
073500             END-IF                                               07160000
073600     END-SEARCH.                                                  07170000
073700                                                                  07180000
073800******************************************************************07180114
073900* THE WEEKLY REPORT WAS REPORTING THE DOLLAR VARIANCE IN THE UNIT 07180214
074000* VARIANCE FIELD.  THE CODE BELOW SHOULD CORRECT THAT PROBLEM.    07180314
074100******************************************************************07180414
074200*CALCULATE STOREEXT VARIANCE PERCENTAGE.                          07181014
074300     MOVE ZEROES  TO  PV-UNIT-VAR-PCT.                            07182014
074400     IF PS-WRITE-EXTRACT-YES                                      07183014
074500         IF PV-ACCUM-UNITS-RECVD = 0                              07184014
074600           OR PV-ACCUM-UNITS-MARK = 0                             07185014
074700             MOVE 100                TO PV-UNIT-VAR-PCT           07186014
074800         ELSE                                                     07187014
074900             COMPUTE PV-UNIT-VAR-PCT = ((PV-ACCUM-UNITS-RECVD     07188014
075000                                       - PV-ACCUM-UNITS-MARK)     07189014
075100                                      / PV-ACCUM-UNITS-RECVD)     07189114
075200                                       * 100                      07189214
075300         END-IF                                                   07189314
075400     END-IF.                                                      07189414
075500     MOVE PV-UNIT-VAR-PCT   TO PV-VAR-PCT.                        07189514
075600                                                                  07189614
075700***************************************************************** 07190000
075800 1500-CREATE-EXTRACT-RECORD.                                      07200000
075900***************************************************************** 07210000
076000     MOVE '1500-CREATE-EXTRACT-RECORD ' TO PV-ABEND-PARAGRAPH.    07220000
076100                                                                  07230000
076200     INITIALIZE RC051-RECORD.                                     07240000
076300                                                                  07250000
076400     MOVE SE-CURR-OPER-UNT-ID    TO RC051-CURR-OPER-UNT-ID.       07260000
076500     MOVE SE-VENDOR-NAME-DUNNS   TO RC051-VENDOR-NAME-DUNNS.      07270000
076600     MOVE SE-VENDOR-NO-DUNNS     TO RC051-VENDOR-NO-DUNNS.        07280000
076700     MOVE SE-PO                  TO RC051-PO.                     07290000
076800     MOVE SE-REC-SEQ-NBR         TO RC051-REC-SEQ-NBR.            07300000
076900     MOVE SE-DEPT                TO RC051-DEPT.                   07310000
077000     MOVE SE-PROCESSING-AREA6    TO RC051-PROCESSING-AREA.        07320000
077100     MOVE RECEIV-VERFYD-TMST     TO RC051-VERIFIED-TIMESTAMP.     07330000
077200     MOVE PV-SAVE-UNT-VAR-PCT    TO RC051-UNT-VRFN-VARN-PCT.      07340000
077300     MOVE PV-SAVE-DOL-VAR-PCT    TO RC051-DOL-VRFN-VARN-PCT.      07350000
077400     MOVE PV-SAVE-DOL-THRS-AMT   TO RC051-DOL-VRFN-THRS-AMT.      07360000
077500     MOVE PV-SAVE-TIME-ZONE      TO RC051-DC-TIME-ZONE.           07370000
077600     PERFORM 1510-DETERMINE-SHIFT.                                07380000
077700     MOVE RECEIV-EXPTED-CART-CNT TO RC051-EXPTD-CARTONS.          07390000
077800     MOVE RECEIV-ACTL-CART-CNT   TO RC051-ACTUAL-CARTONS.         07400000
077900     MOVE PV-ACCUM-UNITS-RECVD   TO RC051-EXPTD-UNITS.            07410000
078000     MOVE PV-ACCUM-UNITS-MARK    TO RC051-ACTUAL-UNITS.           07420000
078100     MOVE PV-VAR-PCT             TO RC051-DLY-UNIT-VARIANCE-PCT.  07430000
078200     MOVE PV-ACCUM-PRICE-DIFF    TO RC051-DOLLAR-VARIANCE.        07440000
077100     MOVE RECEIV-VRFD-USR-ID     TO RC051-VRFD-USR-ID.            07330000
078300     PERFORM 1520-CHECK-FOR-STYLE-SUB.                            07450000
078400                                                                  07460000
078500     WRITE EXTRACT-RECORD FROM RC051-RECORD.                      07470000
078600                                                                  07480000
078700***************************************************************** 07490000
078800 1510-DETERMINE-SHIFT.                                            07500000
078900*JPL************************************************************* 07510000
079000     MOVE '1510-DETERMINE-SHIFT       ' TO PV-ABEND-PARAGRAPH.    07520000
079300                                                                  07530000
079400     MOVE RECEIV-VERFYD-TMST TO PV-DATE-VERIFIED.                 07540000
079500                                                                  07550000
079600     EVALUATE PV-SAVE-TIME-ZONE                                           
079700                                                                          
079800       WHEN 'CTZ'                                                 07560000
079900         IF PV-DATE-TIME-HH > 5                                   07570000
080000           AND PV-DATE-TIME-HH < 14                               07580000
080100             MOVE '1' TO RC051-DC-SHIFT                           07590000
080200         ELSE                                                     07600000
080300             IF PV-DATE-TIME-HH > 13                              07610000
080400               AND PV-DATE-TIME-HH < 22                           07620000
080500                 MOVE '2' TO RC051-DC-SHIFT                       07630000
080600             ELSE                                                 07640000
080700                 MOVE '3' TO RC051-DC-SHIFT                       07650000
080800             END-IF                                               07660000
080900         END-IF                                                   07670000
081000                                                                  07690000
081100        WHEN 'ETZ'                                                07700000
081200         IF PV-DATE-TIME-HH > 6                                   07710000
081300           AND PV-DATE-TIME-HH < 15                               07720000
081400             MOVE '1' TO RC051-DC-SHIFT                           07730000
081500         ELSE                                                     07740000
081600             IF PV-DATE-TIME-HH > 14                              07750000
081700               AND PV-DATE-TIME-HH < 23                           07760000
081800                 MOVE '2' TO RC051-DC-SHIFT                       07770000
081900             ELSE                                                 07780000
082000                 MOVE '3' TO RC051-DC-SHIFT                       07790000
082100             END-IF                                               07800000
082200         END-IF                                                   07800000
082300                                                                          
082400        WHEN 'MTZ'                                                07700000
082500         IF PV-DATE-TIME-HH > 4                                   07710000
082600           AND PV-DATE-TIME-HH < 13                               07720000
082700             MOVE '1' TO RC051-DC-SHIFT                           07730000
082800         ELSE                                                     07740000
082900             IF PV-DATE-TIME-HH > 12                              07750000
083000               AND PV-DATE-TIME-HH < 21                           07760000
083100                 MOVE '2' TO RC051-DC-SHIFT                       07770000
083200             ELSE                                                 07780000
083300                 MOVE '3' TO RC051-DC-SHIFT                       07790000
083400             END-IF                                               07800000
083500         END-IF                                                   07800000
083600                                                                          
083700        WHEN 'PTZ'                                                07700000
083800         IF PV-DATE-TIME-HH > 3                                   07710000
083900           AND PV-DATE-TIME-HH < 12                               07720000
084000             MOVE '1' TO RC051-DC-SHIFT                           07730000
084100         ELSE                                                     07740000
084200             IF PV-DATE-TIME-HH > 11                              07750000
084300               AND PV-DATE-TIME-HH < 20                           07760000
084400                 MOVE '2' TO RC051-DC-SHIFT                       07770000
084500             ELSE                                                 07780000
084600                 MOVE '3' TO RC051-DC-SHIFT                       07790000
084700             END-IF                                               07800000
084800         END-IF                                                   07800000
084900     END-EVALUATE.                                                07820000
085000                                                                  07830000
085100***************************************************************** 07840000
085200 1520-CHECK-FOR-STYLE-SUB.                                        07850000
085300***************************************************************** 07860000
085400     MOVE '1520-CHECK-FOR-STYLE-SUB   ' TO PV-ABEND-PARAGRAPH.    07870000
085500                                                                  07880000
085600     MOVE SE-PO          TO DK-PO-NBR.                            07890000
085700     MOVE SE-REC-SEQ-NBR TO DK-REC-SEQ-NBR.                       07900000
085800                                                                  07910000
085900     EXEC SQL                                                     07920000
086000       SELECT NOTIF_NBR                                           07930000
086100         INTO :TRBNTF-NOTIF-NBR                                   07940000
086200         FROM TTRBNTF A                                           07950000
086300            , TTRBRCN B                                           07960000
086400        WHERE A.PO_NBR          = :DK-PO-NBR                      07970000
086500         AND  A.REC_SEQ_NBR     = :DK-REC-SEQ-NBR                 07980000
086600         AND  A.TRBL_RSN_CDE    = B.TRBL_RSN_CDE                  07990000
086700         AND  B.RPT_PGM_NM      = :PC-PROGRAM-NAME                08000000
086800         AND  B.RPT_PGM_RN_NBR  = 1                               08010000
086900     END-EXEC.                                                    08020000
087000                                                                  08030000
087100     EVALUATE TRUE                                                08040000
087200       WHEN SQLCODE = ZEROES                                      08050000
087300       WHEN SQLCODE = -811                                        08060000
087400           MOVE 'Y'              TO RC051-STYLE-SUB               08070000
087500                                                                  08080000
087600       WHEN SQLCODE = +100                                        08090000
087700           MOVE 'N'              TO RC051-STYLE-SUB               08100000
087800                                                                  08110000
087900       WHEN OTHER                                                 08120000
088000           MOVE '1510-CHECK-FOR-STYLE-SUB' TO PV-ABEND-PARAGRAPH  08130000
088100           MOVE 'SELECT TROUBLE' TO PV-DB2-OPERATION-MESSAGE-1    08140000
088200           MOVE 'TTRBNTF'        TO PV-DB2-TABLE-NAME             08150000
088300           PERFORM 9900-DB2-ABEND                                 08160000
088400     END-EVALUATE.                                                08170000
088500                                                                  08180000
088600***************************************************************** 08190000
088700 2000-READ-INPUT-FILE.                                            08200000
088800***************************************************************** 08210000
088900     MOVE '2000-READ-INPUT-FILE       ' TO PV-ABEND-PARAGRAPH.    08220000
089000                                                                  08230000
089100     READ INPUT-STORE-FILE                                        08240000
089200***    INTO STORE-EXTRACT-LINE                                    08250012
089300         AT END                                                   08270000
089400           SET PS-END-OF-INPUT TO TRUE.                           08280000
089500                                                                  08290000
089600        MOVE STORE-RECORD TO STORE-REC.                           08291012
089700/                                                                         
092100******************************************************************08300000
092200 9900-DB2-ABEND.                                                  08310000
092300******************************************************************08320000
092400     MOVE '9900-DB2-ABEND             ' TO PV-ABEND-PARAGRAPH.    08330000
092500                                                                  08340000
092600     MOVE SQLCODE TO PV-SQLCODE.                                  08350000
092700     DISPLAY '*** DB2 ERROR '.                                    08360000
092800     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       08370000
092900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08380000
093000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08390000
093100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08400000
093200     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       08410000
093300     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       08420000
093400     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             08430000
093500                                                                  08440000
093600     COPY DPPD004.                                                08450000
093700                                                                  08460000
093800     MOVE +4013 TO PV-ABEND-CODE.                                 08470000
093900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08480000
094000                                                                  08490000
094100******************************************************************08500000
094200******************************************************************08510000
