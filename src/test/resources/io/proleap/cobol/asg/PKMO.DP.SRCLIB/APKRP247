000010 IDENTIFICATION DIVISION.                                         00001004
000020 PROGRAM-ID.         APKRP247.                                    00002004
000030 AUTHOR.             CHRIS BOEHNLEIN.                             00003004
000040 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00004004
000050 DATE-WRITTEN.       04-21-98.                                    00005004
000060                                                                  00006004
000070******************************************************************00007004
000080* COBOL II WITH SQL                                              *00008004
000090*----------------------------------------------------------------*00009004
000091* CREATE MONTHLY DETAIL IMPORT REPORTS                           *00009104
000092*----------------------------------------------------------------*00009204
000093* THIS PROGRAM PERFORMS DB2 CALLS AGAINST THE LEGACY SYSTEM TO   *00009304
000094* DETERMINE WHAT ENTRIES WERE MADE FOR THE IMPORT PURCHASE       *00009404
000095* ORDERS FROM THE ADJUSTMENT JOURNAL FOR THE PREVIOUS FISCAL     *00009504
000096* MONTH.  THIS PROGRAM FOCUSES SPECIFICALLY ON THE PREPAID DUTY  *00009608
000097* ACCOUNT.                                                  .    *00009708
000098*----------------------------------------------------------------*00009808
000099* DB2 TABLES:                                                    *00009908
000100*  1. INVOICE TABLE                             (TINVOIC)        *00010008
000101*  2. AP CHARGE TYPE TABLE                      (TACCTYP)        *00010108
000102*  3. VENDOR/DEPARTMENT TABLE                   (TVNDDPT)        *00010208
000103*  4. PURCHASE ORDER HEADER TABLE               (TPURCHS)        *00010308
000104*  5. EXTERNAL EXTERPRISE TABLE                 (TEXTENT)        *00010408
000105*  6. AP PAYMENT CONTROL TABLE                  (TAPCNTL)        *00010508
000106*  7. INVOICE CHARGE/ALLOWANCE TABLE            (TALCHRG)        *00010608
000107*  8. AP-EXPENSE INVOICE                        (TEXINVC)         00010708
000108*                                                                *00010808
000109* INPUT:                                                         *00010908
000110*  1. DETAIL IMPORT FILE                        (APRD047)        *00011008
000111*  2. DETAIL ACCOUNT IMPORT FILE                (APRD047)        *00011108
000112*                                                                *00011208
000113* OUTPUT:                                                        *00011308
000114*  1. IMPORT PURCHASE ORDERS FILE                                *00011408
000115*  2. MONTHLY DETAIL IMPORT REPORT                               *00011508
000116*----------------------------------------------------------------*00011608
000117* PROGRAM CHANGES:                                               *00011708
000118*                                                                *00011808
000119* DATE 08/2005                                                   *00011908
000120*   CHANGE MADE: INITIAL IMPLEMENTATION                          *00012008
000121*   MADE BY: KRYSTEN LEARY                WR/IR: WR24554         *00012108
000122*                                                                *00012208
000123* DATE  04/15/2013                                               *00012308
000124*     CHANGE MADE: MODIFIED LOGIC WHERE TRANCODES 68 AND 73 WERE *00012408
000125*     HARD-CODED TO BE REPORTED AS DEBITS TO REMOVE THE HARD-CODE*00012508
000126*     AND REPLACE IT WITH CHECKING THE POSTING TYPE OF 'CHARGE'  *00012608
000127*     TO BE REPORTED AS DEBITS.                                  *00012708
000128*     MADE BY: NANCY EILBES            WR/IR #: CHG0051542       *00012808
000129*                                                                 00012908
000130* DATE  07/14/2015                                                00013008
000131*     CHANGE MADE: MODIFIED CODE TO ACCOMODATE  BROKER REFERENCE  00013108
000132*                  NUMBER TO THE MONTHLY DETAIL IMPORT REPORT     00013208
000133*     MADE BY: MEENAKSHI MITTAL        WR/IR #: CHG0112172       *00013308
000134*                                                                 00013408
000135* DATE  10/05/2016                                                00013508
000136*     CHANGE MADE: NEEDED TO PULL THE CHANGES OUT THAT WE MADE AND00013608
000137*                  ADD THE TEXINVC TABLE TO THE CURSOR TO GET THE 00013708
000138*                  BROKER NUMBER.                                 00013808
000139*     MADE BY: BARB SCHULTZ            WR/IR #: CHG0124387       *00013908
000140* DATE 09/2018                                                   *00014008
000141*   CHANGE MADE: REMOVE COPYBOOK PJRNLEXT. REPLACE REFERENCE     *00014108
000142*                TO PJR-DETAIL-PONUM WITH PV-DISPLAY-PONUM IN    *00014208
000143*                PARA-S800-READ-DUNNS-NBR,S900-GET-BROKER-NBR    *00014308
000144*   MADE BY: GERMAN BANDA                    WR/IR: CHG0209715   *00014408
000145* DATE 05/12/2020                                                *00014508
000146*   CHANGE MADE: REPLACED HARDCODED ACCOUNT NUMBER IN THE REPORT *00014609
000147*   SUB-HEADING WITH THE ACCOUNT DESCRIPTION "PREPAID DUTY".     *00014709
000148*   THIS CHANGE COINCIDES WITH A CHANGE IN THE ACCOUNT NUMBER    *00014808
000149*   BEING USED FOR PREPAID DUTY FOR THE SECOND TIME IN LESS THAN *00014908
000150*   2 YEARS.                                                     *00015008
000151*   MADE BY: NANCY EILBES                    WR/IR: CHG0244277   *00015110
000152******************************************************************00015208
000153                                                                  00015308
000154 ENVIRONMENT DIVISION.                                            00015408
000155 CONFIGURATION SECTION.                                           00015508
000156 SOURCE-COMPUTER.    IBM-3090.                                    00015608
000157 OBJECT-COMPUTER.    IBM-3090.                                    00015708
000158                                                                  00015808
000159 INPUT-OUTPUT SECTION.                                            00015908
000160 FILE-CONTROL.                                                    00016008
000161                                                                  00016108
000162     SELECT DETAIL-IMPORT-FILE-PJ        ASSIGN TO INP01.         00016208
000163     SELECT DETAIL-ACCT-IMPORT-FILE-PJ   ASSIGN TO INP02.         00016308
000164     SELECT WORK-REPORT-FILE             ASSIGN TO OUT01.         00016408
000165     SELECT DETAIL-REPORT-FILE           ASSIGN TO RPT01.         00016508
000166                                                                  00016608
000167 DATA DIVISION.                                                   00016708
000168 FILE SECTION.                                                    00016808
000169                                                                  00016908
000170 FD  DETAIL-IMPORT-FILE-PJ                                        00017008
000171     RECORDING MODE IS F                                          00017108
000172     LABEL RECORDS ARE STANDARD                                   00017208
000173     RECORD CONTAINS 170 CHARACTERS                               00017308
000174     BLOCK CONTAINS 0  RECORDS                                    00017408
000175     DATA RECORD IS DR-DETAIL-IMPORT-RECORD-PJ.                   00017508
000176 01  DR-IMPORT-RECORD-PJ           PIC X(170).                    00017608
000177                                                                  00017708
000178 FD  DETAIL-ACCT-IMPORT-FILE-PJ                                   00017808
000179     RECORDING MODE IS F                                          00017908
000180     LABEL RECORDS ARE STANDARD                                   00018008
000181     RECORD CONTAINS 170 CHARACTERS                               00018108
000182     BLOCK CONTAINS 0  RECORDS                                    00018208
000183     DATA RECORD IS DR-ACCT-IMPORT-RECORD-PJ.                     00018308
000184 01  DR-ACCT-IMPORT-RECORD-PJ      PIC X(170).                    00018408
000185                                                                  00018508
000186 FD  WORK-REPORT-FILE                                             00018608
000187     RECORDING MODE IS F                                          00018708
000188     LABEL RECORDS ARE STANDARD                                   00018808
000189     RECORD CONTAINS 168 CHARACTERS                               00018908
000190     BLOCK CONTAINS 0  RECORDS                                    00019008
000191     DATA RECORD IS WR-WORK-REPORT-RECORD.                        00019108
000192 01  WR-WORK-REPORT-RECORD         PIC X(168).                    00019208
000193                                                                  00019308
000194 FD  DETAIL-REPORT-FILE                                           00019408
000195     RECORDING MODE IS F                                          00019508
000196     LABEL RECORDS ARE STANDARD                                   00019608
000197     BLOCK CONTAINS 0  RECORDS.                                   00019708
000198 01  DETAIL-REPORT-RECORD          PIC X(200).                    00019808
000199                                                                  00019908
000200 WORKING-STORAGE SECTION.                                         00020008
000201*----------------------------------------------------------------*00020108
000202* GL EXTRACT FILE PAYOUT (INPUT)                                 *00020208
000203*----------------------------------------------------------------*00020308
000204     COPY APRD047.                                                00020408
000205                                                                  00020508
000206*----------------------------------------------------------------*00020608
000207* WORKING STORAGE FOR DATE ROUTINE                               *00020708
000208*----------------------------------------------------------------*00020808
000209     COPY DPWS500.                                                00020908
000210                                                                  00021008
000211*----------------------------------------------------------------*00021108
000212* SQLCA FORMATTED MESSAGE AREA                                   *00021208
000213*----------------------------------------------------------------*00021308
000214     COPY DPWS004.                                                00021408
000215                                                                  00021508
000216*----------------------------------------------------------------*00021608
000217* DB2 COMMUNICATIONS                                             *00021708
000218*----------------------------------------------------------------*00021808
000219     COPY SQLCA2.                                                 00021908
000220                                                                  00022008
000221*----------------------------------------------------------------*00022108
000222* STANDARD HEADER LAYOUT                                         *00022208
000223*----------------------------------------------------------------*00022308
000224     COPY DPWS200O.                                               00022408
000225                                                                  00022508
000226 01  PROGRAM-CONSTANTS.                                           00022608
000227     05  PC-PROGRAM-NAME         PIC X(08)   VALUE 'APKRP247'.    00022708
000228     05  PC-MAX-RETRIES          PIC 9(02)   VALUE 3.             00022808
000229                                                                  00022908
000230 01  PROGRAM-COUNTERS.                                            00023008
000231     05  PV-ACCT-READ-CNT        PIC 9(08)   VALUE ZERO.          00023108
000232     05  PV-IMPORT-READ-CNT      PIC 9(08)   VALUE ZERO.          00023208
000233     05  PV-WRITTEN-CNT          PIC 9(02)   VALUE ZERO.          00023308
000234                                                                  00023408
000235 01  PROGRAM-SWITCHES.                                            00023508
000236     05  END-OF-FILE-IMPORT-PJ   PIC X(01)   VALUE 'N'.           00023608
000237         88 END-OF-FILE-IMPORT               VALUE 'Y'.           00023708
000238     05  PS-MORE-TINVOIC         PIC X(01)   VALUE 'N'.           00023808
000239         88 PS-NO-MORE-TINVOIC               VALUE 'Y'.           00023908
000240     05  END-OF-FILE-NO-ACCT     PIC X(01)   VALUE 'N'.           00024008
000241         88 END-OF-FILE-ACCT                 VALUE 'Y'.           00024108
000242                                                                  00024208
000243 01  PROGRAM-VARIABLES.                                           00024308
000244     05  PV-RETRY-COUNTER        PIC 9(02)   VALUE ZEROS.         00024408
000245     05  PV-FIRST-FISCAL-DATE    PIC X(10)   VALUE SPACES.        00024508
000246     05  PV-LAST-FISCAL-DATE     PIC X(10)   VALUE SPACES.        00024608
000247     05  PV-DISPLAY-PONUM        PIC X(09)   VALUE SPACES.        00024708
000248                                                                  00024808
000249 01  DATE-WORK-AREA.                                              00024908
000250     05  SYSTEM-DATE             PIC 9(06)   VALUE ZERO.          00025008
000251     05  FILLER REDEFINES SYSTEM-DATE.                            00025108
000252         10  SYSTEM-YEAR         PIC 9(02).                       00025208
000253         10  SYSTEM-MONTH        PIC 9(02).                       00025308
000254         10  SYSTEM-DAY          PIC 9(02).                       00025408
000255     05  SYSTEM-TIME             PIC 9(08)   VALUE ZERO.          00025508
000256     05  FILLER REDEFINES SYSTEM-TIME.                            00025608
000257         10  SYSTEM-HOUR         PIC 9(02).                       00025708
000258         10  SYSTEM-MINUTE       PIC 9(02).                       00025808
000259         10  SYSTEM-SECOND       PIC 9(02).                       00025908
000260         10  FILLER              PIC 9(02).                       00026008
000261                                                                  00026108
000262 01  ACCOUNT-TABLE.                                               00026208
000263     05 ACCT-TABLE OCCURS 100000 TIMES INDEXED BY X1.             00026308
000264        10 ACCT-PO               PIC X(09)   VALUE SPACES.        00026408
000265        10 ACCT-DATE             PIC X(10)   VALUE SPACES.        00026508
000266                                                                  00026608
000267 01 WS-WORKING-STORAGE.                                           00026708
000268    05  WS-DB2-ACCOUNT.                                           00026808
000269        10  WS-DB2-ACCT          PIC X(05)    VALUE SPACES.       00026908
000270    05  WS-DB2-ACCOUNT2          PIC X(07)    VALUE SPACES.       00027008
000271    05  WS-DETAIL-PONUM          PIC 9(09)    VALUE ZERO.         00027108
000272    05  WS-DUNNS-NUMBER          PIC X(9)     VALUE SPACES.       00027208
000273    05  WS-DT-PONUM              PIC S9(9)    COMP.               00027308
000274    05  WS-DM-TOTAL              PIC S9(11)V99 COMP-3 VALUE ZERO. 00027408
000275    05  WS-CM-TOTAL              PIC S9(11)V99 VALUE ZERO COMP-3. 00027508
000276    05  WS-JN-DATE               PIC X(10)    VALUE SPACES.       00027608
000277    05  WS-HD-PO                 PIC 9(09)    VALUE ZEROS.        00027708
000278    05  WS-HD-DATE               PIC X(10)    VALUE SPACES.       00027808
000279    05  WS-INVOIC-PO-NBR         PIC S9(9)    COMP.               00027908
000280    05  WS-HOLD-ACCT             PIC X(06)    VALUE SPACES.       00028008
000281    05  WS-REQ-ENTR-TRMNL-ID     PIC X(04)    VALUE SPACES.       00028108
000282    05  WS-INVC-ID               PIC X(22)    VALUE SPACES.       00028208
000283                                                                  00028308
000284 01 REPORT-CONTROLS.                                              00028408
000285    05  PAGE-COUNT               PIC S9(04)   COMP-3 VALUE ZERO.  00028508
000286    05  LINE-COUNT               PIC S9(04)   COMP-3 VALUE ZERO.  00028608
000287 01 BLANK-LINE                   PIC X(132)   VALUE SPACES.       00028708
000288                                                                  00028808
000289 01 HDR-LINE-1.                                                   00028908
000290    05  FILLER                  PIC X(78)     VALUE SPACES.       00029008
000291    05  FILLER                  PIC X(46)     VALUE               00029108
000292        'MONTHLY DETAIL IMPORT REPORT FOR PREPAID DUTY'.          00029208
000293    05  FILLER                  PIC X(76)     VALUE SPACES.       00029308
000294                                                                  00029408
000295 01 HDR-LINE-2.                                                   00029508
000296    05  FILLER                  PIC X(78)     VALUE SPACES.       00029608
000297    05  FILLER                  PIC X(15)     VALUE               00029708
000298        'FOR THE PERIOD '.                                        00029808
000299    05  HDR2-START-MM           PIC X(02)     VALUE SPACES.       00029908
000300    05  FILLER                  PIC X(01)     VALUE '-'.          00030008
000301    05  HDR2-START-DD           PIC X(02)     VALUE SPACES.       00030108
000302    05  FILLER                  PIC X(01)     VALUE '-'.          00030208
000303    05  HDR2-START-YYYY         PIC X(04)     VALUE SPACES.       00030308
000304    05  FILLER                  PIC X(09)     VALUE ' THROUGH '.  00030408
000305    05  HDR2-END-MM             PIC X(02)     VALUE SPACES.       00030508
000306    05  FILLER                  PIC X(01)     VALUE '-'.          00030608
000307    05  HDR2-END-DD             PIC X(02)     VALUE SPACES.       00030708
000308    05  FILLER                  PIC X(01)     VALUE '-'.          00030808
000309    05  HDR2-END-YYYY           PIC X(04)     VALUE SPACES.       00030908
000310    05  FILLER                  PIC X(78)     VALUE SPACES.       00031008
000311                                                                  00031108
000312 01 HDR-LINE-3.                                                   00031208
000313    05  FILLER                  PIC X(07)     VALUE 'ACCOUNT'.    00031308
000314    05  FILLER                  PIC X(02)     VALUE SPACES.       00031408
000315    05  FILLER                  PIC X(06)     VALUE 'VENDOR'.     00031508
000316    05  FILLER                  PIC X(05)     VALUE SPACES.       00031608
000317    05  FILLER                  PIC X(02)     VALUE 'PO'.         00031708
000318    05  FILLER                  PIC X(10)     VALUE SPACES.       00031808
000319    05  FILLER                  PIC X(10)     VALUE 'BROKER REF'. 00031908
000320    05  FILLER                  PIC X(07)     VALUE SPACES.       00032008
000321    05  FILLER                  PIC X(07)     VALUE 'INVOICE'.    00032108
000322    05  FILLER                  PIC X(17)     VALUE SPACES.       00032208
000323    05  FILLER                  PIC X(06)     VALUE 'ORIGIN'.     00032308
000324    05  FILLER                  PIC X(03)     VALUE SPACES.       00032408
000325    05  FILLER                  PIC X(05)     VALUE 'DEBIT'.      00032508
000326    05  FILLER                  PIC X(09)     VALUE SPACES.       00032608
000327    05  FILLER                  PIC X(05)     VALUE 'DEBIT'.      00032708
000328    05  FILLER                  PIC X(07)     VALUE SPACES.       00032808
000329    05  FILLER                  PIC X(06)     VALUE 'CREDIT'.     00032908
000330    05  FILLER                  PIC X(08)     VALUE SPACES.       00033008
000331    05  FILLER                  PIC X(06)     VALUE 'CREDIT'.     00033108
000332    05  FILLER                  PIC X(06)     VALUE SPACES.       00033208
000333    05  FILLER                  PIC X(04)     VALUE 'JRNL'.       00033308
000334    05  FILLER                  PIC X(06)     VALUE SPACES.       00033408
000335    05  FILLER                  PIC X(07)     VALUE 'INVOICE'.    00033508
000336    05  FILLER                  PIC X(07)     VALUE SPACES.       00033608
000337    05  FILLER                  PIC X(08)     VALUE 'REVERSAL'.   00033708
000338    05  FILLER                  PIC X(28)     VALUE SPACES.       00033808
000339                                                                  00033908
000340 01 HDR-LINE-4.                                                   00034008
000341    05  FILLER                  PIC X(03)     VALUE 'NBR'.        00034108
000342    05  FILLER                  PIC X(06)     VALUE SPACES.       00034208
000343    05  FILLER                  PIC X(03)     VALUE 'NBR'.        00034308
000344    05  FILLER                  PIC X(08)     VALUE SPACES.       00034408
000345    05  FILLER                  PIC X(03)     VALUE 'NBR'.        00034508
000346    05  FILLER                  PIC X(09)     VALUE SPACES.       00034608
000347    05  FILLER                  PIC X(03)     VALUE 'NBR'.        00034708
000348    05  FILLER                  PIC X(14)     VALUE SPACES.       00034808
000349    05  FILLER                  PIC X(02)     VALUE 'ID'.         00034908
000350    05  FILLER                  PIC X(31)     VALUE SPACES.       00035008
000351    05  FILLER                  PIC X(03)     VALUE 'AMT'.        00035108
000352    05  FILLER                  PIC X(11)     VALUE SPACES.       00035208
000353    05  FILLER                  PIC X(04)     VALUE 'DATE'.       00035308
000354    05  FILLER                  PIC X(08)     VALUE SPACES.       00035408
000355    05  FILLER                  PIC X(03)     VALUE 'AMT'.        00035508
000356    05  FILLER                  PIC X(11)     VALUE SPACES.       00035608
000357    05  FILLER                  PIC X(04)     VALUE 'DATE'.       00035708
000358    05  FILLER                  PIC X(08)     VALUE SPACES.       00035808
000359    05  FILLER                  PIC X(04)     VALUE 'DATE'.       00035908
000360    05  FILLER                  PIC X(08)     VALUE SPACES.       00036008
000361    05  FILLER                  PIC X(03)     VALUE 'AMT'.        00036108
000362    05  FILLER                  PIC X(11)     VALUE SPACES.       00036208
000363    05  FILLER                  PIC X(03)     VALUE 'AMT'.        00036308
000364    05  FILLER                  PIC X(10)     VALUE SPACES.       00036408
000365                                                                  00036508
000366 01 DH-DETAIL-LINE1.                                              00036608
000367    05  DH-ACCOUNT              PIC X(07)     VALUE SPACES.       00036708
000368    05  FILLER                  PIC X(02)     VALUE SPACES.       00036808
000369    05  DH-PO-DUNNS             PIC X(09)     VALUE SPACES.       00036908
000370    05  FILLER                  PIC X(02)     VALUE SPACES.       00037008
000371    05  DH-PO-NUMBER            PIC X(10)     VALUE SPACES.       00037108
000372    05  FILLER                  PIC X(02)     VALUE SPACES.       00037208
000373    05  DH-BROKER-REF           PIC X(15)     VALUE SPACES.       00037308
000374    05  FILLER                  PIC X(02)     VALUE SPACES.       00037408
000375    05  DH-PO-INV               PIC X(22)     VALUE SPACES.       00037508
000376    05  FILLER                  PIC X(02)     VALUE SPACES.       00037608
000377    05  DH-PJ-SOURCE            PIC X(02)     VALUE SPACES.       00037708
000378    05  FILLER                  PIC X(04)     VALUE SPACES.       00037808
000379    05  DH-DEBIT-TOTAL          PIC ---,---,---.99.               00037908
000380    05  FILLER                  PIC X(02)     VALUE SPACES.       00038008
000381    05  DH-DM-MONTH             PIC 9(02)     VALUE ZEROS.        00038108
000382    05  FILLER                  PIC X(01)     VALUE '-'.          00038208
000383    05  DH-DM-DAY               PIC 9(02)     VALUE ZEROS.        00038308
000384    05  FILLER                  PIC X(01)     VALUE '-'.          00038408
000385    05  DH-DM-YEAR              PIC 9(02)     VALUE ZEROS.        00038508
000386    05  FILLER                  PIC X(02)     VALUE SPACES.       00038608
000387    05  DH-CREDIT-TOTAL         PIC ---,---,---.99.               00038708
000388    05  FILLER                  PIC X(02)     VALUE SPACES.       00038808
000389    05  DH-CM-MONTH             PIC 9(02)     VALUE ZEROS.        00038908
000390    05  FILLER                  PIC X(01)     VALUE '-'.          00039008
000391    05  DH-CM-DAY               PIC 9(02)     VALUE ZEROS.        00039108
000392    05  FILLER                  PIC X(01)     VALUE '-'.          00039208
000393    05  DH-CM-YEAR              PIC 9(02)     VALUE ZEROS.        00039308
000394    05  FILLER                  PIC X(02)     VALUE SPACES.       00039408
000395    05  DH-JN-MONTH             PIC 9(02)     VALUE ZEROS.        00039508
000396    05  FILLER                  PIC X(01)     VALUE '-'.          00039608
000397    05  DH-JN-DAY               PIC 9(02)     VALUE ZEROS.        00039708
000398    05  FILLER                  PIC X(01)     VALUE '-'.          00039808
000399    05  DH-JN-YEAR              PIC 9(02)     VALUE ZEROS.        00039908
000400    05  FILLER                  PIC X(02)     VALUE SPACES.       00040008
000401    05  DH-INV                  PIC ---,---,---.99.               00040108
000402    05  FILLER                  PIC X(02)     VALUE SPACES.       00040208
000403    05  DH-PPR                  PIC ---,---,---.99.               00040308
000404                                                                  00040408
000405 01 EOR-END-OF-REPORT.                                            00040508
000406    05  FILLER                  PIC X(87)     VALUE SPACES.       00040608
000407    05  FILLER                  PIC X(25)     VALUE               00040708
000408        '***** END OF REPORT *****'.                              00040808
000409    05  FILLER                  PIC X(87)     VALUE SPACES.       00040908
000410                                                                  00041008
000411*----------------------------------------------------------------*00041108
000412* ABEND CODE AREA                                                *00041208
000413*----------------------------------------------------------------*00041308
000414 01  ABEND-CODE                  PIC S9(04)   VALUE ZERO.         00041408
000415     88  AC-BAD-DATA                          VALUE +4003.        00041508
000416     88  AC-DB2-ERROR                         VALUE +4013.        00041608
000417                                                                  00041708
000418 01  ABEND-AREAS.                                                 00041808
000419     05  AA-ABEND-LIT            PIC X(40)    VALUE               00041908
000420           '*****       ABEND'.                                   00042008
000421     05  AA-PROGRAM-LIT          PIC X(40)    VALUE               00042108
000422             '*****   PROGRAM:         '.                         00042208
000423     05  AA-PARAGRAPH-LIT.                                        00042308
000424         10  FILLER              PIC X(17)    VALUE               00042408
000425             '***** PARAGRAPH: '.                                 00042508
000426         10  AA-PARAGRAPH-NAME   PIC X(35)    VALUE SPACES.       00042608
000427     05  AA-MESSAGE-LINE.                                         00042708
000428         10  FILLER              PIC X(06)    VALUE '*****'.      00042808
000429         10  AA-MESSAGE          PIC X(127)   VALUE SPACES.       00042908
000430     05  AA-DB2-ERROR-LIT        PIC X(40)    VALUE               00043008
000431             '*****    DB2 ERROR'.                                00043108
000432     05  AA-DB2-OPERATION-LIT.                                    00043208
000433         10  FILLER              PIC X(17)    VALUE               00043308
000434             '***** OPERATION: '.                                 00043408
000435         10  AA-DB2-OPERATION.                                    00043508
000436             15  AA-DB2-OP-1     PIC X(25)    VALUE SPACES.       00043608
000437             15  AA-DB2-OP-2     PIC X(25)    VALUE SPACES.       00043708
000438     05  AA-DB2-TABLE-1          PIC X(08)    VALUE SPACES.       00043808
000439     05  AA-DB2-TABLE-2          PIC X(08)    VALUE SPACES.       00043908
000440     05  AA-DB2-TABLE-3          PIC X(08)    VALUE SPACES.       00044008
000441     05  AA-DB2-TABLE-4          PIC X(08)    VALUE SPACES.       00044108
000442                                                                  00044208
000443*----------------------------------------------------------------*00044308
000444* EXTERNAL ENTERPRISE TABLE                                      *00044408
000445*----------------------------------------------------------------*00044508
000446     EXEC SQL                                                     00044608
000447        INCLUDE TEXTENT                                           00044708
000448     END-EXEC.                                                    00044808
000449                                                                  00044908
000450*----------------------------------------------------------------*00045008
000451* AP PAYMENT CONTROL TABLE                                       *00045108
000452*----------------------------------------------------------------*00045208
000453     EXEC SQL                                                     00045308
000454        INCLUDE TAPCNTL                                           00045408
000455     END-EXEC.                                                    00045508
000456                                                                  00045608
000457*----------------------------------------------------------------*00045708
000458* PURCHASE ORDER HEADER TABLE                                    *00045808
000459*----------------------------------------------------------------*00045908
000460     EXEC SQL                                                     00046008
000461        INCLUDE TPURCHS                                           00046108
000462     END-EXEC.                                                    00046208
000463                                                                  00046308
000464*----------------------------------------------------------------*00046408
000465* INVOICE TABLE                                                  *00046508
000466*----------------------------------------------------------------*00046608
000467     EXEC SQL                                                     00046708
000468        INCLUDE TINVOIC                                           00046808
000469     END-EXEC.                                                    00046908
000470                                                                  00047008
000471*----------------------------------------------------------------*00047108
000472* INVOICE CHARGES/ALLOWANCES TABLE                               *00047208
000473*----------------------------------------------------------------*00047308
000474     EXEC SQL                                                     00047408
000475        INCLUDE TALCHRG                                           00047508
000476     END-EXEC.                                                    00047608
000477                                                                  00047708
000478*----------------------------------------------------------------*00047808
000479* AP CHARGE TYPE TABLE                                           *00047908
000480*----------------------------------------------------------------*00048008
000481     EXEC SQL                                                     00048108
000482        INCLUDE TACCTYP                                           00048208
000483     END-EXEC.                                                    00048308
000484                                                                  00048408
000485*----------------------------------------------------------------*00048508
000486* VENDOR/DEPARTMENT TABLE                                         00048608
000487*----------------------------------------------------------------*00048708
000488     EXEC SQL                                                     00048808
000489        INCLUDE TVNDDPT                                           00048908
000490     END-EXEC.                                                    00049008
000491                                                                  00049108
000492*----------------------------------------------------------------*00049208
000493* AP-EXPENSE INVOICE TABLE                                *       00049308
000494*----------------------------------------------------------------*00049408
000495     EXEC SQL                                                     00049508
000496        INCLUDE TEXINVC                                           00049608
000497     END-EXEC.                                                    00049708
000498                                                                  00049808
000499*----------------------------------------------------------------*00049908
000500* DB2 COMMUNICATIONS                                             *00050008
000501*----------------------------------------------------------------*00050108
000502     EXEC SQL                                                     00050208
000503        INCLUDE SQLCA                                             00050308
000504     END-EXEC.                                                    00050408
000505                                                                  00050508
000506*----------------------------------------------------------------*00050608
000507* CURSOR DECLARATION                                             *00050708
000508*----------------------------------------------------------------*00050808
000509     EXEC SQL                                                     00050908
000510         DECLARE INVOICE_CSR CURSOR FOR                           00051008
000511              SELECT                                              00051108
000512                   I.PO_NBR                                       00051208
000513                  ,A.ALW_CHRG_AMT                                 00051308
000514                  ,'      '                                       00051408
000515                  ,I.INVC_ID                                      00051508
000516                  ,I.PPD_RVRSL_IND                                00051608
000517                  ,B.IMPRT_BKR_REF_NBR                            00051708
000518              FROM TINVOIC I                                      00051808
000519                  ,TEXINVC B                                      00051908
000520                  ,TALCHRG A                                      00052008
000521                  ,TACCTYP T                                      00052108
000522              WHERE I.PO_NBR = A.PO_NBR                           00052208
000523                AND I.PO_NBR =  B.PO_NBR                          00052308
000524                AND I.INVC_ID = A.INVC_ID                         00052408
000525                AND I.INVC_ID = B.INVC_ID                         00052508
000526                AND A.ALW_CHRG_CDE = T.ALW_CHRG_CDE               00052608
000527                AND I.INVC_TYP_CDE = 'EI'                         00052708
000528                AND I.STATUS_CDE ^= 'DE'                          00052808
000529                AND I.STATUS_CDE ^= 'PR'                          00052908
000530                AND I.CRE_DTE >= :PV-FIRST-FISCAL-DATE            00053008
000531                AND I.CRE_DTE <= :PV-LAST-FISCAL-DATE             00053108
000532                AND T.GL_ACCT_NBR = :WS-DB2-ACCOUNT2              00053208
000533              ORDER BY I.PO_NBR                                   00053308
000534     END-EXEC.                                                    00053408
000535                                                                  00053508
000536*--------------------------*                                      00053608
000537 PROCEDURE DIVISION.                                              00053708
000538*--------------------------*                                      00053808
000539 0000-MAINLINE-PROCESSING.                                        00053908
000540                                                                  00054008
000541     PERFORM B100-INITIALIZATION.                                 00054108
000542     PERFORM B200-PROCESS-EXTRACT                                 00054208
000543             UNTIL END-OF-FILE-IMPORT AND                         00054308
000544                   PS-NO-MORE-TINVOIC.                            00054408
000545     PERFORM W400-WRITE-END-OF-REPORT.                            00054508
000546     PERFORM B300-TERMINATION.                                    00054608
000547     STOP RUN.                                                    00054708
000548                                                                  00054808
000549*----------------------------------------------------------------*00054908
000550* INITIALIZATION PROCESSING                                      *00055008
000551*----------------------------------------------------------------*00055108
000552 B100-INITIALIZATION.                                             00055208
000553                                                                  00055308
000554     ACCEPT SYSTEM-DATE FROM DATE.                                00055408
000555     MOVE SYSTEM-YEAR                 TO DP200O-RUN-YEAR.         00055508
000556     MOVE SYSTEM-MONTH                TO DP200O-RUN-MONTH.        00055608
000557     MOVE SYSTEM-DAY                  TO DP200O-RUN-DAY.          00055708
000558     ACCEPT SYSTEM-TIME FROM TIME.                                00055808
000559     MOVE SYSTEM-HOUR                 TO DP200O-RUN-HOUR.         00055908
000560     MOVE SYSTEM-MINUTE               TO DP200O-RUN-MINUTE.       00056008
000561     MOVE PC-PROGRAM-NAME             TO DP200O-PROGRAM-NAME.     00056108
000562     MOVE 1                           TO DP200O-REPORT-NUMBER.    00056208
000563     DISPLAY 'RUN DATE = ' SYSTEM-DATE.                           00056308
000564     DISPLAY 'RUN TIME = ' SYSTEM-TIME.                           00056408
000565                                                                  00056508
000566     OPEN INPUT  DETAIL-IMPORT-FILE-PJ                            00056608
000567                 DETAIL-ACCT-IMPORT-FILE-PJ                       00056708
000568          OUTPUT WORK-REPORT-FILE                                 00056808
000569                 DETAIL-REPORT-FILE.                              00056908
000570                                                                  00057008
000571     INITIALIZE DCLTEXTENT                                        00057108
000572                DCLTVNDDPT                                        00057208
000573                DCLTPURCHS                                        00057308
000574                DCLTINVOIC                                        00057408
000575                DCLTACCTYP                                        00057508
000576                DCLTAPCNTL                                        00057608
000577                DCLTALCHRG.                                       00057708
000578                                                                  00057808
000579     PERFORM S100-SELECT-PREV-FISCAL-DATA.                        00057908
000580     PERFORM S200-GET-FIRST-LAST-FISCAL-DT.                       00058008
000581                                                                  00058108
000582     MOVE PV-FIRST-FISCAL-DATE(1:4)           TO HDR2-START-YYYY. 00058208
000583     MOVE PV-FIRST-FISCAL-DATE(6:2)           TO HDR2-START-MM.   00058308
000584     MOVE PV-FIRST-FISCAL-DATE(9:2)           TO HDR2-START-DD.   00058408
000585     MOVE PV-LAST-FISCAL-DATE(1:4)            TO HDR2-END-YYYY.   00058508
000586     MOVE PV-LAST-FISCAL-DATE(6:2)            TO HDR2-END-MM.     00058608
000587     MOVE PV-LAST-FISCAL-DATE(9:2)            TO HDR2-END-DD.     00058708
000588     PERFORM W200-WRITE-REPORT-HEADERS.                           00058808
000589                                                                  00058908
000590     PERFORM S300-GET-ACCT-IMPORT-DATA.                           00059008
000591     PERFORM R100-READ-IMPORT-FILE-PJ.                            00059108
000592     MOVE AP047-GL-ACCT-NBR  TO WS-HOLD-ACCT.                     00059208
000593     MOVE WS-HOLD-ACCT       TO WS-DB2-ACCT.                      00059308
000594     MOVE WS-DB2-ACCOUNT     TO WS-DB2-ACCOUNT2.                  00059408
000595     PERFORM Y100-OPEN-INVOICE-CSR.                               00059508
000596     PERFORM S400-FETCH-INVOICE-CSR.                              00059608
000597                                                                  00059708
000598*----------------------------------------------------------------*00059808
000599* THIS ROUTINE HOLDS THE MAIN LOGIC FOR PROCESSING THE OUTPUT    *00059908
000600*----------------------------------------------------------------*00060008
000601 B200-PROCESS-EXTRACT.                                            00060108
000602                                                                  00060208
000603     EVALUATE TRUE                                                00060308
000604     WHEN INVOIC-PO-NBR = WS-DETAIL-PONUM                         00060408
000605        INITIALIZE DH-DETAIL-LINE1                                00060508
000606        MOVE INVOIC-PO-NBR              TO WS-DT-PONUM            00060608
000607        PERFORM S800-READ-DUNNS-NBR                               00060708
000608        MOVE WS-DUNNS-NUMBER            TO DH-PO-DUNNS            00060808
000609        MOVE EXINVC-IMPRT-BKR-REF-NBR   TO DH-BROKER-REF          00060908
000610        MOVE INVOIC-INVC-ID             TO DH-PO-INV              00061008
000611        MOVE INVOIC-GRO-COST-AMT        TO DH-INV                 00061108
000612        MOVE WS-HOLD-ACCT               TO DH-ACCOUNT             00061208
000613        MOVE INVOIC-PO-NBR              TO DH-PO-NUMBER           00061308
000614        PERFORM W100-WRITE-WORK-REPORT-FILE                       00061408
000615        PERFORM W300-WRITE-REPORT-DETAILS                         00061508
000616        MOVE ZEROS                      TO DH-INV                 00061608
000617        IF AP047-CHARGE                                           00061708
000618**      IF AP047-AP-TRN-CDE = '68' OR '73'                        00061808
000619           MOVE AP047-GRO-COST-AMT      TO DH-DEBIT-TOTAL         00061908
000620           ADD AP047-GRO-COST-AMT       TO WS-DM-TOTAL            00062008
000621        ELSE                                                      00062108
000622           MOVE INVOIC-PO-NBR           TO WS-INVOIC-PO-NBR       00062208
000623           IF INVOIC-PPD-RVRSL-IND = 'Y'                          00062308
000624              MOVE AP047-GRO-COST-AMT   TO DH-PPR                 00062408
000625           END-IF                                                 00062508
000626           MOVE AP047-GRO-COST-AMT      TO DH-CREDIT-TOTAL        00062608
000627           ADD AP047-GRO-COST-AMT       TO WS-CM-TOTAL            00062708
000628        END-IF                                                    00062808
000629        PERFORM S500-GET-DATE-ACTUAL                              00062908
000630        IF AP047-GL-ACCT-NBR NOT EQUAL '10301 '                   00063008
000631           PERFORM S600-GET-JRNL-DATE                             00063108
000632        END-IF                                                    00063208
000633        MOVE AP047-AP-TRN-CDE           TO DH-PJ-SOURCE           00063308
000634        PERFORM W100-WRITE-WORK-REPORT-FILE                       00063408
000635        PERFORM W300-WRITE-REPORT-DETAILS                         00063508
000636        PERFORM R100-READ-IMPORT-FILE-PJ                          00063608
000637        PERFORM S400-FETCH-INVOICE-CSR                            00063708
000638      WHEN INVOIC-PO-NBR > WS-DETAIL-PONUM                        00063808
000639        INITIALIZE DH-DETAIL-LINE1                                00063908
000640        IF AP047-ENT-NME-DESC (1:9) = SPACES                      00064008
000641           MOVE ZEROS                   TO DH-PO-NUMBER           00064108
000642         ELSE                                                     00064208
000643           MOVE WS-DETAIL-PONUM         TO DH-PO-NUMBER           00064308
000644        END-IF                                                    00064408
000645        IF AP047-GL-ACCT-NBR NOT EQUAL '10301 '                   00064508
000646           PERFORM S600-GET-JRNL-DATE                             00064608
000647        END-IF                                                    00064708
000648        PERFORM S500-GET-DATE-ACTUAL                              00064808
000649        MOVE AP047-DOC-NBR              TO DH-PO-INV              00064908
000650        MOVE AP047-AP-TRN-CDE           TO DH-PJ-SOURCE           00065008
000651        MOVE WS-HOLD-ACCT               TO DH-ACCOUNT             00065108
000652        IF AP047-CHARGE                                           00065208
000653**      IF AP047-AP-TRN-CDE = '68' OR '73'                        00065308
000654           MOVE AP047-GRO-COST-AMT      TO DH-DEBIT-TOTAL         00065408
000655           ADD AP047-GRO-COST-AMT       TO WS-DM-TOTAL            00065508
000656        ELSE                                                      00065608
000657           MOVE WS-DETAIL-PONUM         TO WS-INVOIC-PO-NBR       00065708
000658           IF INVOIC-PPD-RVRSL-IND = 'Y'                          00065808
000659              MOVE AP047-GRO-COST-AMT   TO DH-PPR                 00065908
000660           END-IF                                                 00066008
000661           MOVE AP047-GRO-COST-AMT      TO DH-CREDIT-TOTAL        00066108
000662           ADD AP047-GRO-COST-AMT       TO WS-CM-TOTAL            00066208
000663        END-IF                                                    00066308
000664        MOVE AP047-ENT-NME-DESC (1:9)   TO WS-DT-PONUM            00066408
000665        PERFORM S800-READ-DUNNS-NBR                               00066508
000666        MOVE WS-DUNNS-NUMBER            TO DH-PO-DUNNS            00066608
000667        PERFORM S900-GET-BROKER-NBR                               00066708
000668        MOVE EXINVC-IMPRT-BKR-REF-NBR   TO DH-BROKER-REF          00066808
000669        PERFORM W100-WRITE-WORK-REPORT-FILE                       00066908
000670        PERFORM W300-WRITE-REPORT-DETAILS                         00067008
000671        PERFORM R100-READ-IMPORT-FILE-PJ                          00067108
000672      WHEN INVOIC-PO-NBR < WS-DETAIL-PONUM                        00067208
000673        MOVE INVOIC-PO-NBR              TO WS-DT-PONUM            00067308
000674        INITIALIZE DH-DETAIL-LINE1                                00067408
000675        PERFORM S800-READ-DUNNS-NBR                               00067508
000676        MOVE WS-DUNNS-NUMBER            TO DH-PO-DUNNS            00067608
000677        MOVE INVOIC-INVC-ID             TO DH-PO-INV              00067708
000678        MOVE INVOIC-PO-NBR              TO DH-PO-NUMBER           00067808
000679        MOVE EXINVC-IMPRT-BKR-REF-NBR   TO DH-BROKER-REF          00067908
000680        MOVE WS-HOLD-ACCT               TO DH-ACCOUNT             00068008
000681        MOVE INVOIC-GRO-COST-AMT        TO DH-INV                 00068108
000682        MOVE INVOIC-PO-NBR              TO WS-INVOIC-PO-NBR       00068208
000683        IF INVOIC-PPD-RVRSL-IND = 'Y'                             00068308
000684           MOVE INVOIC-GRO-COST-AMT     TO DH-PPR                 00068408
000685        END-IF                                                    00068508
000686        PERFORM W100-WRITE-WORK-REPORT-FILE                       00068608
000687        PERFORM W300-WRITE-REPORT-DETAILS                         00068708
000688        PERFORM S400-FETCH-INVOICE-CSR                            00068808
000689      END-EVALUATE.                                               00068908
000690                                                                  00069008
000691*----------------------------------------------------------------*00069108
000692* END OF PROGRAM PROCESSING                                      *00069208
000693*----------------------------------------------------------------*00069308
000694 B300-TERMINATION.                                                00069408
000695                                                                  00069508
000696      DISPLAY '***********************************************'.  00069608
000697      DISPLAY '**            APKRP247 RECORD COUNTS         **'.  00069708
000698      DISPLAY '***********************************************'.  00069808
000699      DISPLAY 'TOTAL IMPORT RECORDS READ = ' PV-IMPORT-READ-CNT.  00069908
000700      DISPLAY 'TOTAL ACCT RECORDS READ   = ' PV-ACCT-READ-CNT.    00070008
000701      DISPLAY 'TOTAL RECORDS WRITTEN     = ' PV-WRITTEN-CNT.      00070108
000702      DISPLAY '***********************************************'.  00070208
000703      DISPLAY '***********************************************'.  00070308
000704                                                                  00070408
000705      PERFORM Y200-CLOSE-INVOICE-CSR.                             00070508
000706      CLOSE DETAIL-IMPORT-FILE-PJ                                 00070608
000707            DETAIL-ACCT-IMPORT-FILE-PJ                            00070708
000708            WORK-REPORT-FILE                                      00070808
000709            DETAIL-REPORT-FILE.                                   00070908
000710                                                                  00071008
000711*----------------------------------------------------------------*00071108
000712* READS THE INPUT FILE                                           *00071208
000713*----------------------------------------------------------------*00071308
000714 R100-READ-IMPORT-FILE-PJ.                                        00071408
000715                                                                  00071508
000716     READ DETAIL-IMPORT-FILE-PJ INTO AP047-GL-EXTRACT-FILE        00071608
000717          AT END                                                  00071708
000718             SET END-OF-FILE-IMPORT  TO TRUE                      00071808
000719             MOVE '9999999'          TO AP047-ENT-NME-DESC (1:9)  00071908
000720          NOT AT END                                              00072008
000721             ADD 1                   TO PV-IMPORT-READ-CNT.       00072108
000722                                                                  00072208
000723     MOVE AP047-ENT-NME-DESC (1:9)   TO WS-DETAIL-PONUM.          00072308
000724     IF END-OF-FILE-IMPORT                                        00072408
000725        MOVE 999999999               TO WS-DETAIL-PONUM           00072508
000726     END-IF.                                                      00072608
000727                                                                  00072708
000728*----------------------------------------------------------------*00072808
000729* READS THE INPUT FILE CONTAINING ACCOUNT DATA                   *00072908
000730*----------------------------------------------------------------*00073008
000731 R200-READ-ACCT-IMPORT-FILE.                                      00073108
000732                                                                  00073208
000733     READ DETAIL-ACCT-IMPORT-FILE-PJ INTO AP047-GL-EXTRACT-FILE   00073308
000734          AT END                                                  00073408
000735             SET END-OF-FILE-ACCT    TO TRUE                      00073508
000736          NOT AT END                                              00073608
000737             ADD 1                   TO PV-ACCT-READ-CNT.         00073708
000738                                                                  00073808
000739     MOVE AP047-ENT-NME-DESC (1:9)   TO ACCT-PO (X1).             00073908
000740     MOVE AP047-ENT-NME-DESC (10:10) TO ACCT-DATE (X1).           00074008
000741                                                                  00074108
000742*----------------------------------------------------------------*00074208
000743* SELECT THE PREVIOUS FISCAL PERIOD AND YEAR FROM THE TAPCNTL    *00074308
000744* TABLE                                                          *00074408
000745*----------------------------------------------------------------*00074508
000746 S100-SELECT-PREV-FISCAL-DATA.                                    00074608
000747                                                                  00074708
000748     EXEC SQL                                                     00074808
000749        SELECT PREV_PSTG_FYR_NBR                                  00074908
000750             , PREV_PSTG_FMN_NBR                                  00075008
000751          INTO :APCNTL-PREV-PSTG-FYR-NBR                          00075108
000752             , :APCNTL-PREV-PSTG-FMN-NBR                          00075208
000753          FROM TAPCNTL                                            00075308
000754     END-EXEC.                                                    00075408
000755                                                                  00075508
000756     EVALUATE TRUE                                                00075608
000757       WHEN SQLCODE = ZERO                                        00075708
000758         CONTINUE                                                 00075808
000759       WHEN SQLWARN0 NOT = SPACES                                 00075908
000760       WHEN SQLCODE NOT = ZERO                                    00076008
000761         MOVE 'S100-SELECT-PREV-FISCAL-DATA'                      00076108
000762                                         TO AA-PARAGRAPH-NAME     00076208
000763         MOVE 'UNSUCCESSFUL SELECT'      TO AA-DB2-OPERATION      00076308
000764         MOVE 'TAPCNTL'                  TO AA-DB2-TABLE-1        00076408
000765         MOVE SPACES                     TO AA-DB2-TABLE-2        00076508
000766                                            AA-DB2-TABLE-3        00076608
000767                                            AA-DB2-TABLE-4        00076708
000768         PERFORM Z999-DB2-ABEND                                   00076808
000769     END-EVALUATE.                                                00076908
000770                                                                  00077008
000771*----------------------------------------------------------------*00077108
000772* USE THE KOHLS CALENDAR ROUTINE TO GET THE FIRST AND LAST       *00077208
000773* FISCAL DATE OF THE PREVIOUS PERIOD                             *00077308
000774*----------------------------------------------------------------*00077408
000775 S200-GET-FIRST-LAST-FISCAL-DT.                                   00077508
000776                                                                  00077608
000777     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         00077708
000778                                                                  00077808
000779     SET DPG51-FISCAL-454-CALENDAR     TO TRUE.                   00077908
000780     SET DPG52-LK-DTE-FISC-PRD-CC      TO TRUE.                   00078008
000781     MOVE APCNTL-PREV-PSTG-FYR-NBR     TO DPG52-FISCAL-CC-PRD-YR. 00078108
000782     MOVE APCNTL-PREV-PSTG-FMN-NBR     TO DPG52-FISCAL-CC-PRD-PP. 00078208
000783                                                                  00078308
000784     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    00078408
000785                                             DPG54 DPG55 DPG56.   00078508
000786                                                                  00078608
000787     IF DPG54-NO-ERROR                                            00078708
000788        DISPLAY 'PERIOD START DATE: ' DPG56-FIRST-FP-DB2-ISO-FMT  00078808
000789        DISPLAY 'PERIOD END DATE: ' DPG56-LAST-FP-DB2-ISO-FMT     00078908
000790        MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO PV-FIRST-FISCAL-DATE   00079008
000791        MOVE DPG56-LAST-FP-DB2-ISO-FMT  TO PV-LAST-FISCAL-DATE    00079108
000792     ELSE                                                         00079208
000793        MOVE 'S200-GET-FIRST-LAST-FISCAL-DT'                      00079308
000794                                        TO AA-PARAGRAPH-NAME      00079408
000795        MOVE DPG54-ERROR-MESSAGE        TO AA-MESSAGE             00079508
000796        SET AC-BAD-DATA                 TO TRUE                   00079608
000797        PERFORM Z999-DB2-ABEND                                    00079708
000798     END-IF.                                                      00079808
000799                                                                  00079908
000800*----------------------------------------------------------------*00080008
000801* STORES THE ACCOUNT IMPORT DATA INTO INTERNAL TABLE             *00080108
000802*----------------------------------------------------------------*00080208
000803 S300-GET-ACCT-IMPORT-DATA.                                       00080308
000804                                                                  00080408
000805     SET X1 TO 1.                                                 00080508
000806     PERFORM R200-READ-ACCT-IMPORT-FILE                           00080608
000807             VARYING X1 FROM 1 BY 1                               00080708
000808             UNTIL END-OF-FILE-ACCT.                              00080808
000809     MOVE WS-HD-PO         TO ACCT-PO (X1).                       00080908
000810     MOVE WS-HD-DATE       TO ACCT-DATE (X1).                     00081008
000811     INITIALIZE AP047-GL-EXTRACT-FILE.                            00081108
000812                                                                  00081208
000813*----------------------------------------------------------------*00081308
000814* FETCHES THE INVOICE_CSR                                        *00081408
000815*----------------------------------------------------------------*00081508
000816 S400-FETCH-INVOICE-CSR.                                          00081608
000817                                                                  00081708
000818     PERFORM WITH TEST AFTER                                      00081808
000819        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      00081908
000820        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR              00082008
000821                SQLCODE = ZERO OR                                 00082108
000822                SQLCODE = +100                                    00082208
000823        EXEC SQL                                                  00082308
000824           FETCH INVOICE_CSR                                      00082408
000825               INTO   :INVOIC-PO-NBR                              00082508
000826                    , :INVOIC-GRO-COST-AMT                        00082608
000827                    , :WS-REQ-ENTR-TRMNL-ID                       00082708
000828                    , :INVOIC-INVC-ID                             00082808
000829                    , :INVOIC-PPD-RVRSL-IND                       00082908
000830                    , :EXINVC-IMPRT-BKR-REF-NBR                   00083008
000831        END-EXEC                                                  00083108
000832*       DISPLAY INVOIC-PO-NBR ' '                                 00083208
000833*               INVOIC-GRO-COST-AMT ' '                           00083308
000834*               WS-REQ-ENTR-TRMNL-ID ' '                          00083408
000835*               INVOIC-INVC-ID ' '                                00083508
000836*               EXINVC-IMPRT-BKR-REF-NBR ' '                      00083608
000837                                                                  00083708
000838        EVALUATE TRUE                                             00083808
000839            WHEN SQLCODE = ZERO                                   00083908
000840            WHEN SQLCODE = -904                                   00084008
000841            WHEN SQLCODE = -913                                   00084108
000842                 CONTINUE                                         00084208
000843            WHEN SQLCODE = +100                                   00084308
000844                 SET PS-NO-MORE-TINVOIC   TO TRUE                 00084408
000845                 MOVE 999999999           TO INVOIC-PO-NBR        00084508
000846            WHEN SQLWARN0 NOT = SPACES                            00084608
000847            WHEN SQLCODE  NOT = ZERO                              00084708
000848                 MOVE 'S400-FETCH-INVOICE-CSR'                    00084808
000849                                           TO AA-PARAGRAPH-NAME   00084908
000850                 MOVE 'UNSUCCESSFUL FETCH' TO AA-DB2-OPERATION    00085008
000851                 MOVE 'TINVOIC'            TO AA-DB2-TABLE-1      00085108
000852                 MOVE 'TALCHRG'            TO AA-DB2-TABLE-2      00085208
000853                 MOVE 'TACCTYP'            TO AA-DB2-TABLE-3      00085308
000854                 MOVE SPACES               TO AA-DB2-TABLE-4      00085408
000855                 PERFORM Z999-DB2-ABEND                           00085508
000856        END-EVALUATE                                              00085608
000857     END-PERFORM.                                                 00085708
000858                                                                  00085808
000859     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         00085908
000860         MOVE 'S400-FETCH-INVOICE-CSR'    TO AA-PARAGRAPH-NAME    00086008
000861         MOVE 'MAX RETRIES EXCEEDED ON FETCH TINVOIC'             00086108
000862                                          TO AA-DB2-OPERATION     00086208
000863         PERFORM Z999-DB2-ABEND                                   00086308
000864     END-IF.                                                      00086408
000865                                                                  00086508
000866     EVALUATE TRUE                                                00086608
000867        WHEN SQLCODE = ZEROS                                      00086708
000868        WHEN SQLCODE = +100                                       00086808
000869             CONTINUE                                             00086908
000870        WHEN OTHER                                                00087008
000871             MOVE 'S400-FETCH-INVOICE-CSR' TO AA-PARAGRAPH-NAME   00087108
000872             MOVE 'UNSUCCESSFUL FETCH'     TO AA-DB2-OPERATION    00087208
000873             MOVE 'TINVOIC'                TO AA-DB2-TABLE-1      00087308
000874             MOVE 'TALCHRG'                TO AA-DB2-TABLE-2      00087408
000875             MOVE 'TACCTYP'                TO AA-DB2-TABLE-3      00087508
000876             MOVE 'TEXINVC'                TO AA-DB2-TABLE-4      00087608
000877             PERFORM Z999-DB2-ABEND                               00087708
000878     END-EVALUATE.                                                00087808
000879                                                                  00087908
000880*----------------------------------------------------------------*00088008
000881* GET DEBIT, CREDIT, OR JOURNAL DATE                             *00088108
000882*----------------------------------------------------------------*00088208
000883 S500-GET-DATE-ACTUAL.                                            00088308
000884                                                                  00088408
000885     IF AP047-CHARGE                                              00088508
000886**   IF AP047-AP-TRN-CDE = '68' OR '73'                           00088608
000887        MOVE AP047-ENT-NME-DESC(15:2)    TO DH-DM-MONTH           00088708
000888        MOVE AP047-ENT-NME-DESC(18:2)    TO DH-DM-DAY             00088808
000889        MOVE AP047-ENT-NME-DESC(12:2)    TO DH-DM-YEAR            00088908
000890        IF AP047-GL-ACCT-NBR = '10301 '                           00089008
000891           MOVE AP047-ENT-NME-DESC(15:2) TO DH-JN-MONTH           00089108
000892           MOVE AP047-ENT-NME-DESC(18:2) TO DH-JN-DAY             00089208
000893           MOVE AP047-ENT-NME-DESC(12:2) TO DH-JN-YEAR            00089308
000894        END-IF                                                    00089408
000895     ELSE                                                         00089508
000896        MOVE AP047-ENT-NME-DESC(15:2)    TO DH-CM-MONTH           00089608
000897        MOVE AP047-ENT-NME-DESC(18:2)    TO DH-CM-DAY             00089708
000898        MOVE AP047-ENT-NME-DESC(12:2)    TO DH-CM-YEAR            00089808
000899     END-IF.                                                      00089908
000900                                                                  00090008
000901*----------------------------------------------------------------*00090108
000902* GET THE JOURNAL DATE                                           *00090208
000903*----------------------------------------------------------------*00090308
000904 S600-GET-JRNL-DATE.                                              00090408
000905                                                                  00090508
000906     PERFORM S700-SEARCH-ACCT-TABLE.                              00090608
000907     MOVE WS-JN-DATE (6:2)        TO DH-JN-MONTH.                 00090708
000908     MOVE WS-JN-DATE (9:2)        TO DH-JN-DAY.                   00090808
000909     MOVE WS-JN-DATE (3:2)        TO DH-JN-YEAR.                  00090908
000910                                                                  00091008
000911*----------------------------------------------------------------*00091108
000912* SEARCHES THE INTERNAL ACCOUNT TABLE                            *00091208
000913*----------------------------------------------------------------*00091308
000914 S700-SEARCH-ACCT-TABLE.                                          00091408
000915                                                                  00091508
000916     SET X1 TO 1.                                                 00091608
000917     SEARCH ACCT-TABLE                                            00091708
000918         AT END                                                   00091808
000919            MOVE '0000-00-00'    TO WS-JN-DATE                    00091908
000920         WHEN AP047-ENT-NME-DESC (1:9) = ACCT-PO(X1)              00092008
000921             MOVE ACCT-DATE(X1)  TO  WS-JN-DATE                   00092108
000922     END-SEARCH.                                                  00092208
000923                                                                  00092308
000924*----------------------------------------------------------------*00092408
000925* GET THE DUNN NUMBER FROM THE TVNDDPT, TPURCHS, AND TEXTENT     *00092508
000926* TABLES                                                         *00092608
000927*----------------------------------------------------------------*00092708
000928 S800-READ-DUNNS-NBR.                                             00092808
000929                                                                  00092908
000930     EXEC SQL                                                     00093008
000931        SELECT C.DUN_NBR                                          00093108
000932        INTO :WS-DUNNS-NUMBER                                     00093208
000933        FROM TPURCHS B,                                           00093308
000934             TEXTENT C                                            00093408
000935        WHERE  B.ENT_ID = C.ENT_ID                                00093508
000936          AND  B.PO_NBR = :WS-DT-PONUM                            00093608
000937          AND  B.VER_STATUS_CDE = 'A'                             00093708
000938     END-EXEC.                                                    00093808
000939                                                                  00093908
000940     EVALUATE TRUE                                                00094004
000941         WHEN SQLCODE = ZERO                                      00094104
000942              CONTINUE                                            00094204
000943         WHEN SQLCODE = +100                                      00094304
000944              CONTINUE                                            00094404
000945         WHEN SQLWARN0 NOT = SPACES                               00094504
000946         WHEN SQLCODE  NOT = ZERO                                 00094604
000947             MOVE WS-DT-PONUM  TO PV-DISPLAY-PONUM                00094706
000948             DISPLAY 'WS-DT-PONUM ' PV-DISPLAY-PONUM              00094806
000950             MOVE 'S800-READ-DUNNS-NBR'   TO AA-PARAGRAPH-NAME    00095004
000951             MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OPERATION     00095104
000952             MOVE 'TPURCHS'               TO AA-DB2-TABLE-1       00095204
000953             MOVE 'TEXTENT'               TO AA-DB2-TABLE-2       00095304
000954             PERFORM Z999-DB2-ABEND                               00095404
000955     END-EVALUATE.                                                00095504
000956                                                                  00095604
000957*----------------------------------------------------------------*00095704
000958* GET THE BROKER REFERENCE NUMBER FROM TABLE TEXINVC & TINVOIC   *00095804
000959*----------------------------------------------------------------*00095904
000960 S900-GET-BROKER-NBR.                                             00096004
000961                                                                  00096104
000962     MOVE AP047-DOC-NBR TO WS-INVC-ID.                            00096204
000963     INSPECT WS-INVC-ID REPLACING ALL 'DUT' BY '   '.             00096304
000964                                                                  00096404
000965     EXEC SQL                                                     00096504
000966        SELECT IMPRT_BKR_REF_NBR                                  00096604
000967        INTO :EXINVC-IMPRT-BKR-REF-NBR                            00096704
000968        FROM TEXINVC                                              00096804
000969        WHERE PO_NBR = :WS-DT-PONUM                               00096904
000970          AND INVC_ID = :WS-INVC-ID                               00097004
000971     END-EXEC.                                                    00097104
000972                                                                  00097204
000973     EVALUATE TRUE                                                00097304
000974         WHEN SQLCODE = ZERO                                      00097404
000975              CONTINUE                                            00097504
000976         WHEN SQLCODE = +100                                      00097604
000977              MOVE SPACES TO EXINVC-IMPRT-BKR-REF-NBR             00097704
000978         WHEN SQLWARN0 NOT = SPACES                               00097804
000979         WHEN SQLCODE  NOT = ZERO                                 00097904
000980             MOVE WS-DT-PONUM  TO PV-DISPLAY-PONUM                00098006
000981             DISPLAY 'WS-DT-PONUM ' PV-DISPLAY-PONUM              00098106
000983             MOVE 'S900-GET-BROKER-NBR'   TO AA-PARAGRAPH-NAME    00098304
000984             MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OPERATION     00098404
000985             MOVE 'TEXINVC'               TO AA-DB2-TABLE-1       00098504
000986             PERFORM Z999-DB2-ABEND                               00098604
000987     END-EVALUATE.                                                00098704
000988*----------------------------------------------------------------*00098804
000989* WRITE RECORD TO EXTRACT FILE                                   *00098904
000990*----------------------------------------------------------------*00099004
000991 W100-WRITE-WORK-REPORT-FILE.                                     00099104
000992                                                                  00099204
000993     WRITE WR-WORK-REPORT-RECORD FROM DH-DETAIL-LINE1 AFTER 1.    00099304
000994     ADD 1                       TO PV-WRITTEN-CNT.               00099404
001000                                                                  00100004
001001*----------------------------------------------------------------*00100104
001002* WRITE REPORT HEADINGS                                          *00100204
001003*----------------------------------------------------------------*00100304
001004 W200-WRITE-REPORT-HEADERS.                                       00100404
001005                                                                  00100504
001006     INITIALIZE LINE-COUNT.                                       00100604
001007     ADD 1                         TO PAGE-COUNT.                 00100704
001008     MOVE PAGE-COUNT               TO DP200O-PAGE-NUMBER.         00100804
001009     WRITE DETAIL-REPORT-RECORD                                   00100904
001010           FROM DP200O-STANDRD-HEADER-200-COLS AFTER PAGE.        00101004
001011                                                                  00101104
001012     WRITE DETAIL-REPORT-RECORD FROM HDR-LINE-1 AFTER 1.          00101204
001013     WRITE DETAIL-REPORT-RECORD FROM HDR-LINE-2 AFTER 1.          00101304
001014     WRITE DETAIL-REPORT-RECORD FROM BLANK-LINE AFTER 1.          00101404
001015     WRITE DETAIL-REPORT-RECORD FROM HDR-LINE-3 AFTER 1.          00101504
001016     WRITE DETAIL-REPORT-RECORD FROM HDR-LINE-4 AFTER 1.          00101604
001017     ADD 6                      TO LINE-COUNT.                    00101704
001018                                                                  00101804
001019*----------------------------------------------------------------*00101904
001020* WRITES REPORT DETAILS                                          *00102004
001021*----------------------------------------------------------------*00102104
001022 W300-WRITE-REPORT-DETAILS.                                       00102204
001023                                                                  00102304
001024     IF LINE-COUNT > 59                                           00102404
001025        PERFORM W200-WRITE-REPORT-HEADERS                         00102504
001026     END-IF.                                                      00102604
001027                                                                  00102704
001028     WRITE DETAIL-REPORT-RECORD FROM DH-DETAIL-LINE1 AFTER 1.     00102804
001029     ADD 1                      TO LINE-COUNT.                    00102904
001030                                                                  00103004
001031*----------------------------------------------------------------*00103104
001032* WRITES END OF REPORT LINE                                      *00103204
001033*----------------------------------------------------------------*00103304
001034 W400-WRITE-END-OF-REPORT.                                        00103404
001035                                                                  00103504
001036     WRITE DETAIL-REPORT-RECORD FROM EOR-END-OF-REPORT AFTER 1.   00103604
001037                                                                  00103704
001038*----------------------------------------------------------------*00103804
001039* OPENS THE INVOICE_CSR                                          *00103904
001040*----------------------------------------------------------------*00104004
001041 Y100-OPEN-INVOICE-CSR.                                           00104104
001042                                                                  00104204
001043     PERFORM WITH TEST AFTER                                      00104304
001044        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      00104404
001045        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR              00104504
001046                SQLCODE = ZERO                                    00104604
001047        EXEC SQL                                                  00104704
001048            OPEN INVOICE_CSR                                      00104804
001049        END-EXEC                                                  00104904
001050                                                                  00105004
001051        EVALUATE TRUE                                             00105104
001052            WHEN SQLCODE = ZERO                                   00105204
001053            WHEN SQLCODE = -904                                   00105304
001054            WHEN SQLCODE = -913                                   00105404
001055                 CONTINUE                                         00105504
001056            WHEN SQLWARN0 NOT = SPACES                            00105604
001057            WHEN SQLCODE  NOT = ZERO                              00105704
001058                 MOVE 'Y100-OPEN-INVOICE-CSR' TO AA-PARAGRAPH-NAME00105804
001059                 MOVE 'UNSUCCESSFUL OPEN'     TO AA-DB2-OPERATION 00105904
001060                 MOVE 'TINVOIC'               TO AA-DB2-TABLE-1   00106004
001061                 MOVE 'TALCHRG'               TO AA-DB2-TABLE-2   00106104
001062                 MOVE 'TACCTYP'               TO AA-DB2-TABLE-3   00106204
001063                 MOVE SPACES                  TO AA-DB2-TABLE-4   00106304
001064                 PERFORM Z999-DB2-ABEND                           00106404
001065        END-EVALUATE                                              00106504
001066     END-PERFORM.                                                 00106604
001067                                                                  00106704
001068     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         00106804
001069         MOVE 'Y100-OPEN-INVOICE-CSR' TO AA-PARAGRAPH-NAME        00106904
001070         MOVE 'MAX RETRIES EXCEEDED ON OPEN TINVOIC'              00107004
001071                                      TO AA-DB2-OPERATION         00107104
001072         PERFORM Z999-DB2-ABEND                                   00107204
001073     END-IF.                                                      00107304
001074                                                                  00107404
001075     EVALUATE TRUE                                                00107504
001076        WHEN SQLCODE = ZEROS                                      00107604
001077             CONTINUE                                             00107704
001078        WHEN OTHER                                                00107804
001079             MOVE 'Y100-OPEN-INVOICE-CSR' TO AA-PARAGRAPH-NAME    00107904
001080             MOVE 'UNSUCCESSFUL OPEN'     TO AA-DB2-OPERATION     00108004
001081             MOVE 'TINVOIC'               TO AA-DB2-TABLE-1       00108104
001082             MOVE 'TALCHRG'               TO AA-DB2-TABLE-2       00108204
001083             MOVE 'TACCTYP'               TO AA-DB2-TABLE-3       00108304
001084             MOVE SPACES                  TO AA-DB2-TABLE-4       00108404
001085             PERFORM Z999-DB2-ABEND                               00108504
001086     END-EVALUATE.                                                00108604
001087                                                                  00108704
001088*----------------------------------------------------------------*00108804
001089* CLOSES THE INVOICE_CSR                                         *00108904
001090*----------------------------------------------------------------*00109004
001091 Y200-CLOSE-INVOICE-CSR.                                          00109104
001092                                                                  00109204
001093     PERFORM WITH TEST AFTER                                      00109304
001094        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      00109404
001095        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR              00109504
001096                SQLCODE = ZERO                                    00109604
001097         EXEC SQL                                                 00109704
001098             CLOSE INVOICE_CSR                                    00109804
001099         END-EXEC                                                 00109904
001100                                                                  00110004
001101        EVALUATE TRUE                                             00110104
001102            WHEN SQLCODE = ZERO                                   00110204
001103            WHEN SQLCODE = -904                                   00110304
001104            WHEN SQLCODE = -913                                   00110404
001105                 CONTINUE                                         00110504
001106            WHEN SQLWARN0 NOT = SPACES                            00110604
001107            WHEN SQLCODE  NOT = ZERO                              00110704
001108                 MOVE 'Y200-CLOSE-INVOICE-CSR'                    00110804
001109                                           TO AA-PARAGRAPH-NAME   00110904
001110                 MOVE 'UNSUCCESSFUL CLOSE' TO AA-DB2-OPERATION    00111004
001111                 MOVE 'TINVOIC'            TO AA-DB2-TABLE-1      00111104
001112                 MOVE 'TALCHRG'            TO AA-DB2-TABLE-2      00111204
001113                 MOVE 'TACCTYP'            TO AA-DB2-TABLE-3      00111304
001114                 MOVE SPACES               TO AA-DB2-TABLE-4      00111404
001115                 PERFORM Z999-DB2-ABEND                           00111504
001116        END-EVALUATE                                              00111604
001117     END-PERFORM.                                                 00111704
001118                                                                  00111804
001119     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         00111904
001120         MOVE 'Y200-CLOSE-INVOICE-CSR' TO AA-PARAGRAPH-NAME       00112004
001121         MOVE 'MAX RETRIES EXCEEDED ON CLOSE TINVOIC'             00112104
001122                                       TO AA-DB2-OPERATION        00112204
001123         PERFORM Z999-DB2-ABEND                                   00112304
001124     END-IF.                                                      00112404
001125                                                                  00112504
001126     EVALUATE TRUE                                                00112604
001127        WHEN SQLCODE = ZEROS                                      00112704
001128             CONTINUE                                             00112804
001129        WHEN OTHER                                                00112904
001130             MOVE 'Y200-CLOSE-INVOICE-CSR' TO AA-PARAGRAPH-NAME   00113004
001131             MOVE 'UNSUCCESSFUL CLOSE'     TO AA-DB2-OPERATION    00113104
001132             MOVE 'TINVOIC'                TO AA-DB2-TABLE-1      00113204
001133             MOVE 'TALCHRG'                TO AA-DB2-TABLE-2      00113304
001134             MOVE 'TACCTYP'                TO AA-DB2-TABLE-3      00113404
001135             MOVE SPACES                   TO AA-DB2-TABLE-4      00113504
001136             PERFORM Z999-DB2-ABEND                               00113604
001137     END-EVALUATE.                                                00113704
001138                                                                  00113804
001139*----------------------------------------------------------------*00113904
001140* DB2 ABEND ROUTINE                                              *00114004
001141*----------------------------------------------------------------*00114104
001142 Z999-DB2-ABEND.                                                  00114204
001143                                                                  00114304
001144     DISPLAY AA-ABEND-LIT.                                        00114404
001145     DISPLAY AA-DB2-ERROR-LIT.                                    00114504
001146     DISPLAY AA-PROGRAM-LIT.                                      00114604
001147     DISPLAY AA-PARAGRAPH-LIT.                                    00114704
001148     DISPLAY AA-DB2-OPERATION-LIT.                                00114804
001149     DISPLAY AA-DB2-TABLE-1.                                      00114904
001150     DISPLAY AA-DB2-TABLE-2.                                      00115004
001151     DISPLAY AA-DB2-TABLE-3.                                      00115104
001152     DISPLAY AA-DB2-TABLE-4.                                      00115204
001153     SET AC-DB2-ERROR TO TRUE.                                    00115304
001154                                                                  00115404
001155     COPY DPPD004.                                                00115504
001156     CALL 'ILBOABN0' USING ABEND-CODE.                            00115604
