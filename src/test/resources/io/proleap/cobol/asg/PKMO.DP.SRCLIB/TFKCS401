      ******************************************************************00050001
       IDENTIFICATION DIVISION.                                         00060001
      ******************************************************************00070001
                                                                        00080001
       PROGRAM-ID.       TFKCS401.                                      00090001
       AUTHOR.           WILLIAM B. BURT.                               00100001
       INSTALLATION.     KOHLS.                                         00110001
       DATE-WRITTEN      AUGUST, 1996.                                  00120001
       DATE-COMPILED.                                                   00130001
                                                                        00140001
      ******************************************************************00150001
      * THIS PROGRAM RECEIVES FROM AND SENDS DATA STREAMS TO A TELXON   00160001
      * PORTABLE TELE-TRANSACTION COMPUTER (PTC).  THE RECEIVED DATA    00170001
      * IS A REQUEST FOR INFORMATION REGARDING CONTAINER TYPE DATA.     00180001
      * THE TRANSMIT DATA IS THE RESPONSE TO THAT REQUEST.              00190001
      ******************************************************************00200001
      *  DATE 01/15/01                                                  00210001
      *  ADD CODE FOR 2ND LISTNER                                       00220001
      *  MADE BY: STEVEN NOWAK            WR/IR #:                      00230001
      ******************************************************************00240001
      *  DATE 10/05/04                                                  00241007
      *  USE LOC_NBR ON TINVPAR                                         00242007
      *  MADE BY: DAVE WELLER             WR/IR #: 72349                00243007
      ******************************************************************00244007
021605*  DATE 02/16/05                                                  00245007
021605*  STANDARDIZE USAGE OF TFWS007                                   00246008
021605******************************************************************00248008
051705*  DATE 05/17/05 RAY GRAF                                         00249012
051705*  REMOVE PHYSICAL INVENTORY LOGIC                                00249109
051705******************************************************************00249209
                                                                        00250001
      ******************************************************************00260001
       ENVIRONMENT DIVISION.                                            00270001
      ******************************************************************00280001
                                                                        00290001
      ******************************************************************00300001
       DATA DIVISION.                                                   00310001
      ******************************************************************00320001
                                                                        00330001
      ******************************************************************00340001
       WORKING-STORAGE SECTION.                                         00350001
      ******************************************************************00360001
                                                                        00370001
      *                                                                 00380001
      *  LISTENER QUEUE NAMES                                           00390001
      *                                                                 00400001
           COPY RFWS001.                                                00410001
                                                                        00420001
      *                                                                 00430001
      *  RECORD LAYOUT BEING TRANSMITTED FROM THE PTC                   00440001
      *                                                                 00450001
           COPY TFRD003.                                                00460001
                                                                        00470001
      *                                                                 00480001
      *  RECORD LAYOUT BEING TRANSMITTED TO THE PTC                     00490001
      *                                                                 00500001
           COPY TFRD004.                                                00510001
                                                                        00520001
      *                                                                 00530001
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00540001
      *                                                                 00550001
           COPY DPWS013.                                                00560001
                                                                        00570001
      *                                                                 00580001
      *  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  00590001
      *                                                                 00600001
           COPY DPRD507I.                                               00610001
                                                                        00620001
      *                                                                 00630001
      *  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     00640001
      *                                                                 00650001
           COPY DPWS011.                                                00660001
                                                                        00670001
      *                                                                 00680001
      * DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CONTAINER CODE TABLE00690001
      *                                                                 00700001
           EXEC SQL                                                     00710001
               INCLUDE TTFSHCT                                          00720001
           END-EXEC.                                                    00730001
                                                                        00740001
051705*                                                                 00750010
051705* DCLGEN LAYOUT AND COBOL DECLARATION FOR TRANSFER CONTROL TABLE  00760010
051705*                                                                 00770010
051705*    EXEC SQL                                                     00780010
051705*        INCLUDE TTFCNTL                                          00790010
051705*    END-EXEC.                                                    00800010
                                                                        00810001
051705*                                                                 00820010
051705* DCLGEN LAYOUT AND COBOL DECLARATION FOR INVENTORY PARAMETER TBL 00830010
051705*                                                                 00840010
051705*    EXEC SQL                                                     00850010
051705*        INCLUDE TINVPAR                                          00860010
051705*    END-EXEC.                                                    00870010
                                                                        00871010
      *                                                                 00880001
      *  COMMUNICATIONS AREA FOR DB2                                    00890001
      *                                                                 00900001
           EXEC SQL                                                     00910001
               INCLUDE SQLCA                                            00920001
           END-EXEC.                                                    00930001
                                                                        00940001
       01  WS-MQCONN               PIC X(8)  VALUE 'CSQCCONN'.          00950001
       01  WS-MQOPEN               PIC X(8)  VALUE 'CSQCOPEN'.          00960001
       01  WS-MQINQ                PIC X(8)  VALUE 'CSQCINQ'.           00970001
       01  WS-MQGET                PIC X(8)  VALUE 'CSQCGET'.           00980001
       01  WS-MQPUT1               PIC X(8)  VALUE 'CSQCPUT1'.          00990001
       01  WS-MQPUT                PIC X(8)  VALUE 'CSQCPUT'.           01000001
       01  WS-MQBACK               PIC X(8)  VALUE 'CSQCBACK'.          01010001
       01  WS-MQCMIT               PIC X(8)  VALUE 'CSQCCOMM'.          01020001
       01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQCCLOS'.          01030001
       01  WS-MQDISC               PIC X(8)  VALUE 'CSQCDISC'.          01040001
                                                                        01050001
      *    API CONTROL BLOCKS                                           01060001
                                                                        01070001
       01  MQM-OBJECT-DESCRIPTOR.                                       01080001
           COPY CMQODV.                                                 01090001
       01  MQM-MESSAGE-DESCRIPTOR.                                      01100001
           COPY CMQMDV.                                                 01110001
       01  MQM-GET-MESSAGE-OPTIONS.                                     01120001
           COPY CMQGMOV.                                                01130001
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01140001
           COPY CMQPMOV.                                                01150001
                                                                        01160001
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01170001
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01180001
                                                                        01190001
       01  MQM-CONSTANTS.                                               01200001
           COPY CMQV.                                                   01210001
                                                                        01220000
      **---------------------------------------------------------------*01230001
      **  VARIABLES REQUIRED FOR THE USE OF THE LOG MESSAGE ROUTINE    *01240001
      **  (EPPD000)                                                    *01250001
      **---------------------------------------------------------------*01260001
                                                                        01270001
           COPY EPWS000.                                                01280001
021605     COPY TFWS007.                                                01281008
                                                                        01290001
      *                                                                 01300001
051705*01  DK-DB2-KEYS.                                                 01310011
051705*    05  DK-STORE-NBR                   PIC S9(04)  COMP          01311010
051705*                                                   VALUE +0.     01312010
      *                                                                 01350001
       01  PC-PROGRAM-CONSTANTS.                                        01360001
           05  PC-MAX-TYP-CDE-TBL-OCCURS       PIC S9(04)  VALUE +20    01370001
                                                           COMP SYNC.   01380001
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01390001
               'TFKCS401'.                                              01400001
051705*    05 PC-MAX-DATE                      PIC X(10)   VALUE        01410010
051705*                                        '9999-09-09'.            01420010
051705*    05 PC-MIN-DATE                      PIC X(10)   VALUE        01430010
051705*                                        '0001-01-01'.            01440010
           05  PC-NON-RTL-TYP-CDE              PIC  X(02)  VALUE '06'.  01450001
           05  PC-NO                           PIC  X(01)  VALUE 'N'.   01460001
           05  PC-YES                          PIC  X(01)  VALUE 'Y'.   01470001
           05  PC-TRAILER-TYP-IND              PIC  X(01)  VALUE 'T'.   01480001
           05  PC-CONTAINER-TYP-IND            PIC  X(01)  VALUE 'C'.   01490001
021605*    COPY TFWS007                                                 01521008
           05  PC-STOCK-BALANCE-MSG            PIC  X(13)  VALUE        01530001
                                               'STOCK BALANCE'.         01540001
           05  PC-MAX-RETRIES                  PIC S9(03)  VALUE 3      01550001
                                                           COMP-3.      01560001
                                                                        01570001
           05  PC-TSYMSG-NUMBERS.                                       01580001
      *  RESOURCE IS UNAVAILABLE; PLEASE TRY AGAIN LATER                01590001
               10  PC-TSYMSG-01063             PIC  9(05)  VALUE  01063.01600001
      *  DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK           01610001
               10  PC-TSYMSG-01064             PIC  9(05)  VALUE  01064.01620001
      *  CAN'T COMPLETE STOCK BALANCE TRANSFERS UNTIL AFTER INVENTORY   01630001
               10  PC-TSYMSG-02002             PIC  9(05)  VALUE  02002.01640001
      *  COUNTS ARE SCHEDULED. DO YOU WANT TO CONTINUE THIS TRANSFER?   01650001
               10  PC-TSYMSG-02022             PIC  9(05)  VALUE  02022.01660001
                                                                        01670000
       01  PH-PROGRAM-HOLD-VARIABLES.                                   01680001
           05  PH-COMPLETION-CODE          PIC  S9(09) BINARY.          01690001
           05  PH-REASON                   PIC  S9(09) BINARY.          01700001
      *                                                                 01710001
       01  PS-PROGRAM-SWITCHES.                                         01720001
           05  PS-CONTNR-TYP-CDE-DATA-IND      PIC  X(01)  VALUE 'N'.   01730001
               88  PS-MORE-CONTNR-TYP-CDE-DATA             VALUE 'N'.   01740001
               88  PS-END-OF-CONTNR-TYP-CDE-DATA           VALUE 'Y'.   01750001
           05  PS-MQPUT-SUCCESSFUL-IND         PIC  X(01)  VALUE 'N'.   01760001
               88 PS-MQPUT-SUCCESSFUL                      VALUE 'Y'.   01770001
      *                                                                 01780001
       01  PV-PROGRAM-VARIABLES.                                        01790001
           05  PV-QMGR-NAME            PIC X(04) VALUE SPACES.          01800001
               88  PV-PROD-QMGR-NAME             VALUE 'QKSP'.          01810001
               88  PV-TEST-QMGR-NAME             VALUE 'QKST'.          01820001
               88  PV-QA-QMGR-NAME               VALUE 'QKSQ'.          01830001
           05  PV-QM-NAME              PIC X(48).                       01840001
           05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        01850001
           05  PV-OPEN-OPTIONS         PIC S9(9) BINARY VALUE 0.        01860001
           05  PV-COMPLETION-CODE      PIC S9(9) BINARY VALUE 0.        01870001
           05  PV-REASON               PIC S9(9) BINARY VALUE 0.        01880001
           05  PV-CON-REASON           PIC S9(9) BINARY VALUE 0.        01890001
           05  PV-PQ-HANDLE            PIC S9(9) BINARY VALUE 0.        01900001
           05  PV-FMT-OPEN-OUTPUT-HNDL PIC S9(9) BINARY VALUE 0.        01910001
           05  PV-ERROR-MESSAGE        PIC X(48)  VALUE SPACES.         01920001
           05  PV-DATA-LENGTH          PIC S9(9) BINARY.                01930001
           05  PV-MSGBUFFER            PIC X(1000000) VALUE SPACES.     01940001
                                                                        01950000
051705*    05  PV-CURRENT-DATE                 PIC  X(10)  VALUE SPACE. 01960010
051705*    05  PV-XFER-INV-CTOFF-DTE           PIC  X(10)  VALUE SPACE. 01970010
051705*    05  PV-FR-STR-INV-DTE               PIC  X(10)  VALUE SPACE. 01980010
051705*    05  PV-COUNT-BEG-DTE                PIC  X(10)  VALUE        01990010
051705*        '1999-01-01'.                                            02000010
051705*    05  PV-COUNT-END-DTE                PIC  X(10)  VALUE        02010010
051705*        '1999-01-01'.                                            02020010
051705*    05  PV-PHY-INV-PERD-IND             PIC  X(01)  VALUE SPACE. 02030010
           05  PV-RETRY-COUNT                  PIC S9(04)  VALUE +0     02040001
                                                           COMP SYNC.   02050001
051705*    05  PV-NULL-IND                     PIC S9(04)  VALUE +0     02060010
051705*                                                    COMP SYNC.   02070010
           05  PV-TBL-LENGTH                   PIC  9(03)  VALUE ZEROS. 02080001
           05  PV-TOT-REC-LENGTH               PIC  9(04)  VALUE ZEROS. 02090001
           05  PV-FIXED-DATA-LENGTH            PIC  9(04)  VALUE ZEROS. 02100001
           05  PV-ITEM-NBR                     PIC S9(04)  VALUE ZEROS  02110001
                                                           COMP SYNC.   02120001
           05  PV-TSQ-LENGTH                   PIC S9(04)  VALUE ZEROS  02130001
                                                           COMP SYNC.   02140001
           05  PV-TSQ-NAME                     PIC  X(08)  VALUE SPACES.02150001
                                                                        02160001
           05  PV-TCPIPPRQ-RECORD1.                                     02170001
               10  PV-NEXT-RECORD              PIC  9(08)  VALUE ZEROS. 02180001
               10  PV-TOTAL-RECORDS            PIC  9(08)  VALUE ZEROS. 02190001
               10  FILLER                      PIC X(4104) VALUE SPACE. 02200001
           05  PV-TCPIPPRQ-RECORD2.                                     02210001
               10  PV-CURRENT-RECORD           PIC  9(08)  VALUE ZEROS. 02220001
               10  FILLER                      PIC X(4112) VALUE SPACE. 02230001
           05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02240001
                                                           COMP SYNC.   02250001
                                                                        02260001
      *                                                                 02270001
      * CURSOR TO RETRIEVE ALL CONTAINER TYPE CODES                     02280001
      *                                                                 02290001
           EXEC SQL                                                     02300001
              DECLARE  CONTNR_TYP_CDE_CSR CURSOR FOR                    02310001
               SELECT  CONTNR_TYP_CDE,                                  02320001
                       CONTNR_TYP_DESC,                                 02330001
                       SEAL_REQR_IND,                                   02340001
                       TRLR_IND,                                        02350001
                       FIXT_IND                                         02360001
                 FROM  TTFSHCT                                          02370001
             ORDER BY  CONTNR_TYP_CDE                                   02380001
             WITH UR                                                    02381003
           END-EXEC.                                                    02390001
      *                                                                 02400001
      ******************************************************************02410001
       PROCEDURE DIVISION.                                              02420001
      ******************************************************************02430001
       0000-PROGRAM-MAINLINE.                                           02440001
           INITIALIZE TF004-XFER-TO-PTC-RECORD.                         02450001
                                                                        02460001
           PERFORM 1000-RETRIEVE-TEXT.                                  02470001
                                                                        02480001
051705*    PERFORM 1500-ERROR-CHECK-TRANSFERS.                          02490010
                                                                        02500001
           PERFORM 2000-PROCESS-PTC-REQUEST.                            02510001
                                                                        02520001
           GOBACK.                                                      02530001
      *                                                                 02540001
       1000-RETRIEVE-TEXT.                                              02550001
           EXEC CICS                                                    02560001
               RETRIEVE                                                 02570001
                   INTO  (TF003-XFER-FROM-PTC-RECORD)                   02580001
                   RESP  (PV-CICS-RESPONSE)                             02590001
           END-EXEC.                                                    02600001
                                                                        02610001
           EVALUATE TRUE                                                02620001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02630001
                   CONTINUE                                             02640001
               WHEN OTHER                                               02650001
                   MOVE '1000-RETRIEVE-TEXT'                            02660001
                                   TO DP013-PARAGRAPH                   02661001
                   MOVE 'UNABLE TO RECEIVE TEXT'                        02670001
                                   TO DP013-MESSAGE-TEXT (1)            02680001
                   MOVE  TF003-XFER-FROM-PTC-RECORD                     02690001
                                   TO DP013-MESSAGE-TEXT (2)            02700001
                   SET DP013-CICS-ABEND                                 02710001
                       DP013-NO-ROLLBACK                                02720001
                                   TO TRUE                              02721001
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      02730001
                   SET DP011-MSG-FATAL                                  02740001
                                   TO TRUE                              02741001
                   MOVE PC-TSYMSG-01064                                 02750001
                                   TO DP011-MSG-NUMBER                  02751001
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      02760001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   02770001
           END-EVALUATE.                                                02780001
                                                                        02790001
                                                                        02800001
           MOVE TF003-LISTENER-CODE                                     02810001
                                   TO PV-QUEUE-PARM.                    02811001
                                                                        02820001
           IF  PV-VALID-PARM                                            02830001
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      02840001
                                   TO PV-TSQ-NAME                       02841001
                                                                        02850001
           ELSE                                                         02860001
               MOVE '1000-RETRIEVE-TEXT'                                02870001
                                   TO DP013-PARAGRAPH                   02871001
               MOVE 'INVALID PARM VALUE'                                02880001
                                   TO DP013-MESSAGE-TEXT (1)            02881001
               MOVE 'PARM VALUE = '                                     02890001
                                   TO DP013-MESSAGE-TEXT (2)            02891001
               MOVE TF003-LISTENER-CODE                                 02900001
                                   TO DP013-MESSAGE-TEXT (3)            02901001
                                                                        02910001
               SET DP013-LOGIC-ABEND                                    02920001
                   DP013-NO-ROLLBACK                                    02930001
                                   TO TRUE                              02931001
                                                                        02940001
               PERFORM 9999-WRITE-CICS-LOG-MSG                          02950001
                                                                        02960001
               SET DP011-MSG-FATAL TO TRUE                              02970001
                                                                        02980001
               MOVE PC-TSYMSG-01064                                     02990001
                                   TO DP011-MSG-NUMBER                  02991001
                                                                        03000001
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          03010001
               PERFORM 8000-SEND-DATA-TO-LISTENER                       03020001
           END-IF.                                                      03030001
                                                                        03040001
                                                                        03050001
      ******************************************************************03060001
      * CHECK TRANSFERS                                                 03070001
      ******************************************************************03080001
051705*1500-ERROR-CHECK-TRANSFERS.                                      03090010
                                                                        03100001
051705*    IF TF003-XFER-TYP-CDE-X = TF007-STOCK-BALANCE-CORPORATE OR   03110010
051705*                              TF007-STOCK-BALANCE-STORE OR       03120010
051705*                              TF007-CUSTOMER                     03130010
051705*        INITIALIZE DCLTTFCNTL                                    03140010
051705*        PERFORM 1510-READ-CONTROL-TABLE                          03150010
051705*        IF (TF003-XFER-TYP-CDE-X =                               03160010
051705*                 TF007-STOCK-BALANCE-CORPORATE OR                03161010
051705*                 TF007-STOCK-BALANCE-STORE) AND                  03170010
051705*           PV-PHY-INV-PERD-IND = PC-YES                 AND      03180010
051705*           PV-CURRENT-DATE     > PV-XFER-INV-CTOFF-DTE           03190010
051705*               PERFORM 1520-INVENTORY-CUTOFF                     03200010
051705*        END-IF                                                   03210010
051705*    END-IF.                                                      03220010
                                                                        03230001
051705*1510-READ-CONTROL-TABLE.                                         03240010
051705*    EXEC SQL                                                     03250010
051705*        SET  :PV-CURRENT-DATE       =  CURRENT DATE              03260010
051705*    END-EXEC.                                                    03270010
                                                                        03280001
051705*    EVALUATE SQLCODE                                             03290010
051705*        WHEN ZERO                                                03291010
051705*            CONTINUE                                             03292010
051705*        WHEN OTHER                                               03300010
051705*            MOVE '1510-READ-CONTROL-TABLE'                       03330010
051705*                            TO DP013-PARAGRAPH                   03340010
051705*            MOVE 'SELECT THE CURRENT DATE'                       03350010
051705*                            TO DP013-MESSAGE-TEXT (1)            03360010
051705*            MOVE SQLCA      TO DP013-SQLCA                       03370010
051705*            SET DP013-DB2-ABEND                                  03380010
051705*                DP013-NO-ROLLBACK                                03390010
051705*                            TO TRUE                              03391010
051705*            PERFORM 9999-WRITE-CICS-LOG-MSG                      03400010
051705*            SET DP011-MSG-FATAL                                  03410010
051705*                            TO TRUE                              03411010
051705*            MOVE PC-TSYMSG-01064                                 03420010
051705*                            TO DP011-MSG-NUMBER                  03421010
051705*            PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03430010
051705*            PERFORM 8000-SEND-DATA-TO-LISTENER                   03440010
051705*    END-EVALUATE.                                                03450010
051705*    PERFORM                                                      03460010
051705*        WITH TEST AFTER                                          03470010
051705*        VARYING PV-RETRY-COUNT                                   03480010
051705*        FROM 1 BY 1                                              03490010
051705*        UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 03500010
051705*            OR (SQLCODE = +0))                                   03510010
051705*        EXEC SQL                                                 03520010
051705*            SELECT PHY_INV_PERD_IND                              03530010
051705*                  ,XFER_INV_CTOFF_DTE                            03540010
051705*                  ,SCHD_CNT_BEG_DTE                              03550010
051705*                  ,SCHD_CNT_END_DTE                              03560010
051705*             INTO :TFCNTL-PHY-INV-PERD-IND                       03570010
051705*                 ,:TFCNTL-XFER-INV-CTOFF-DTE                     03580010
051705*                 ,:TFCNTL-SCHD-CNT-BEG-DTE                       03590010
051705*                 ,:TFCNTL-SCHD-CNT-END-DTE                       03600010
051705*             FROM TTFCNTL                                        03610010
051705*             WITH UR                                             03611010
051705*        END-EXEC                                                 03620010
051705*        EVALUATE SQLCODE                                         03630010
051705*            WHEN ZERO                                            03640010
051705*                  MOVE TFCNTL-PHY-INV-PERD-IND                   03650010
051705*                            TO PV-PHY-INV-PERD-IND               03660010
051705*                  MOVE TFCNTL-XFER-INV-CTOFF-DTE                 03670010
051705*                            TO PV-XFER-INV-CTOFF-DTE             03680010
051705*                  MOVE TFCNTL-SCHD-CNT-BEG-DTE                   03690010
051705*                            TO PV-COUNT-BEG-DTE                  03700010
051705*                  MOVE TFCNTL-SCHD-CNT-END-DTE                   03710010
051705*                            TO PV-COUNT-END-DTE                  03720010
051705*            WHEN -904                                            03730010
051705*            WHEN -913                                            03740010
051705*                CONTINUE                                         03750010
051705*            WHEN OTHER                                           03760010
051705*                MOVE '1510-READ-CONTROL-TABLE'                   03790010
051705*                            TO DP013-PARAGRAPH                   03800010
051705*                MOVE 'SELECT CONTROL TABLE'                      03810010
051705*                            TO DP013-MESSAGE-TEXT (1)            03820010
051705*                MOVE SQLCA  TO DP013-SQLCA                       03830010
051705*                MOVE 'TTFCNTL'                                   03840010
051705*                            TO DP013-DB2-TABLE-NAME (1)          03841010
051705*                SET DP013-DB2-ABEND                              03850010
051705*                    DP013-NO-ROLLBACK                            03860010
051705*                            TO TRUE                              03861010
051705*                PERFORM 9999-WRITE-CICS-LOG-MSG                  03870010
051705*                SET DP011-MSG-FATAL                              03880010
051705*                            TO TRUE                              03881010
051705*                MOVE PC-TSYMSG-01064                             03890010
051705*                            TO DP011-MSG-NUMBER                  03891010
051705*                PERFORM 9000-FMT-ERR-MSG-TO-PTC                  03900010
051705*                PERFORM 8000-SEND-DATA-TO-LISTENER               03910010
051705*        END-EVALUATE                                             03920010
051705*    END-PERFORM.                                                 03930010
051705*                                                                 03940010
051705*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          03950010
051705*        MOVE '1510-READ-CONTROL-TABLE'                           03960010
051705*                            TO DP013-PARAGRAPH                   03970010
051705*        MOVE 'EXCEEDED MAX RETRIES FOR TFCNTL TABLE'             03980010
051705*                            TO DP013-MESSAGE-TEXT (1)            03990010
051705*        MOVE SQLCA          TO DP013-SQLCA                       04000010
051705*        MOVE 'TTFCNTL'      TO DP013-DB2-TABLE-NAME (1)          04010010
051705*        SET DP013-DB2-ABEND                                      04020010
051705*            DP013-NO-ROLLBACK                                    04030010
051705*                            TO TRUE                              04031010
051705*        PERFORM 9999-WRITE-CICS-LOG-MSG                          04040010
051705*        SET DP011-MSG-FATAL                                      04050010
051705*                            TO TRUE                              04051010
051705*        MOVE PC-TSYMSG-01063                                     04060010
051705*                            TO DP011-MSG-NUMBER                  04061010
051705*        PERFORM 9000-FMT-ERR-MSG-TO-PTC                          04070010
051705*        PERFORM 8000-SEND-DATA-TO-LISTENER                       04080010
051705*    END-IF.                                                      04090010
                                                                        04100001
051705*1520-INVENTORY-CUTOFF.                                           04110010
051705*    MOVE TF003-STR-NBR      TO DK-STORE-NBR.                     04121010
051705*    PERFORM 1530-GET-PLND-INV-DTE.                               04130010
051705*    MOVE INVPAR-PLND-INV-DTE                                     04140010
051705*                            TO PV-FR-STR-INV-DTE.                04141010
051705*    IF PV-CURRENT-DATE <= PV-FR-STR-INV-DTE                      04150010
051705***************************************************************** 04160010
051705*   DO NOT ALLOW STORE TO COMPLETE STOCK BALANCE (STORE OR CORP)  04170010
051705*   BETWEEN TRANSFER CUTOFF DATE AND THE DAY AFTER THE 'FROM'     04180010
051705*   STORE COMPLETED INVENTORY                                     04190010
051705***************************************************************** 04200010
051705*        SET DP011-MSG-FATAL TO TRUE                              04210010
051705*        MOVE PC-TSYMSG-02002                                     04220010
051705*                            TO DP011-MSG-NUMBER                  04221010
051705*        MOVE PC-STOCK-BALANCE-MSG                                04230010
051705*                            TO DP011-MSG-TEXT                    04231010
051705*        PERFORM 9000-FMT-ERR-MSG-TO-PTC                          04240010
051705*        PERFORM 8000-SEND-DATA-TO-LISTENER                       04250010
051705*    END-IF.                                                      04260010
                                                                        04270001
051705*1530-GET-PLND-INV-DTE.                                           04280010
051705*    PERFORM                                                      04290010
051705*        WITH TEST AFTER                                          04300010
051705*        VARYING PV-RETRY-COUNT                                   04310010
051705*        FROM 1 BY 1                                              04320010
051705*        UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 04330010
051705*            OR (SQLCODE = +100)                                  04340010
051705*            OR (SQLCODE = +0))                                   04350010
051705*        EXEC SQL                                                 04360010
051705*            SELECT MAX(PLND_INV_DTE)                             04370010
051705*                INTO :INVPAR-PLND-INV-DTE                        04380010
051705*                     :PV-NULL-IND                                04390010
051705*                FROM TINVPAR                                     04400010
051705*                WHERE  LOC_NBR    = :DK-STORE-NBR          AND   04411010
051705*                       PLND_INV_DTE < :PC-MAX-DATE               04420010
051705*                WITH UR                                          04421010
051705*        END-EXEC                                                 04430010
051705*        EVALUATE SQLCODE                                         04440010
051705*            WHEN ZERO                                            04450010
051705*            WHEN -904                                            04460010
051705*            WHEN -913                                            04470010
051705*                CONTINUE                                         04480010
051705*            WHEN +100                                            04490010
051705*                MOVE PC-MIN-DATE                                 04500010
051705*                            TO INVPAR-PLND-INV-DTE               04501010
051705*            WHEN OTHER                                           04510010
051705*                MOVE '1530-GET-PLND-INV-DTE'                     04540010
051705*                            TO DP013-PARAGRAPH                   04550010
051705*                MOVE 'GET PLANNED INVENTORY DATE'                04560010
051705*                            TO DP013-MESSAGE-TEXT (1)            04570010
051705*                MOVE SQLCA  TO DP013-SQLCA                       04580010
051705*                MOVE 'TINVPAR'                                   04590010
051705*                            TO DP013-DB2-TABLE-NAME (1)          04591010
051705*                SET DP013-DB2-ABEND                              04600010
051705*                    DP013-NO-ROLLBACK                            04610010
051705*                            TO TRUE                              04611010
051705*                PERFORM 9999-WRITE-CICS-LOG-MSG                  04620010
051705*                SET DP011-MSG-FATAL                              04630010
051705*                            TO TRUE                              04631010
051705*                MOVE PC-TSYMSG-01064                             04640010
051705*                            TO DP011-MSG-NUMBER                  04641010
051705*                PERFORM 9000-FMT-ERR-MSG-TO-PTC                  04650010
051705*                PERFORM 8000-SEND-DATA-TO-LISTENER               04660010
051705*        END-EVALUATE                                             04670010
051705*    END-PERFORM.                                                 04680010
                                                                        04690001
051705*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          04700010
051705*        MOVE '1530-GET-PLND-INV-DTE'                             04710010
051705*                            TO DP013-PARAGRAPH                   04720010
051705*        MOVE 'EXCEEDED MAX RETRIES'                              04730010
051705*                            TO DP013-MESSAGE-TEXT (1)            04740010
051705*        MOVE SQLCA          TO DP013-SQLCA                       04750010
051705*        MOVE 'TINVPAR'      TO DP013-DB2-TABLE-NAME (1)          04760010
051705*        SET DP013-DB2-ABEND                                      04770010
051705*            DP013-NO-ROLLBACK                                    04780010
051705*                            TO TRUE                              04781010
051705*        PERFORM 9999-WRITE-CICS-LOG-MSG                          04790010
051705*        SET DP011-MSG-FATAL TO TRUE                              04800010
051705*        MOVE PC-TSYMSG-01063                                     04810010
051705*                            TO DP011-MSG-NUMBER                  04811010
051705*        PERFORM 9000-FMT-ERR-MSG-TO-PTC                          04820010
051705*        PERFORM 8000-SEND-DATA-TO-LISTENER                       04830010
051705*    END-IF.                                                      04840010
051705*    IF PV-NULL-IND < 0                                           04850010
051705*        MOVE PC-MIN-DATE    TO INVPAR-PLND-INV-DTE               04860010
051705*    END-IF.                                                      04870010
                                                                        04880001
       2000-PROCESS-PTC-REQUEST.                                        04890001
           PERFORM 2100-LOAD-CONTNR-TYP-CDE-TBL.                        04900001
                                                                        04910001
051705*    IF PV-CURRENT-DATE >= PV-COUNT-BEG-DTE    AND                04920010
051705*       PV-CURRENT-DATE <= PV-COUNT-END-DTE                       04930010
051705*        SET DP011-MSG-WARNING                                    04940010
051705*                            TO TRUE                              04941010
051705*        MOVE PC-TSYMSG-02022                                     04950010
051705*                            TO DP011-MSG-NUMBER                  04951010
051705*        PERFORM 9000-FMT-ERR-MSG-TO-PTC                          04960010
051705*        PERFORM 8000-SEND-DATA-TO-LISTENER                       04970010
051705*    END-IF.                                                      04980010
                                                                        04990001
           PERFORM 8000-SEND-DATA-TO-LISTENER.                          05000001
      *                                                                 05010001
       2100-LOAD-CONTNR-TYP-CDE-TBL.                                    05020001
           PERFORM 2110-OPEN-CONTNR-TYP-CDE-CSR.                        05030001
           PERFORM 7000-FETCH-CONTNR-TYP-CDE-CSR.                       05040001
           PERFORM 2120-FILL-CONTNR-TYP-CDE-TBL                         05050001
               VARYING TYP-CDE-IDX                                      05060001
               FROM    1 BY 1                                           05070001
               UNTIL   (TYP-CDE-IDX > PC-MAX-TYP-CDE-TBL-OCCURS         05080001
                  OR    PS-END-OF-CONTNR-TYP-CDE-DATA).                 05090001
           PERFORM 2130-CLOSE-CONTNR-TYP-CDE-CSR.                       05100001
      *                                                                 05110001
       2110-OPEN-CONTNR-TYP-CDE-CSR.                                    05120001
           EXEC SQL                                                     05130001
               OPEN CONTNR_TYP_CDE_CSR                                  05140001
           END-EXEC.                                                    05150001
                                                                        05160001
           EVALUATE SQLCODE                                             05170005
               WHEN ZERO                                                05171005
                   CONTINUE                                             05172005
               WHEN OTHER                                               05180005
                   MOVE '2110-OPEN-CONTNR-TYP-CDE-CSR'                  05210001
                                   TO DP013-PARAGRAPH                   05220002
                   MOVE 'OPEN THE CONTNR_TYP_CDE_CSR CURSOR'            05230001
                                   TO DP013-MESSAGE-TEXT (1)            05240002
                   MOVE SQLCA      TO DP013-SQLCA                       05250002
                   MOVE 'TTFSHCT'  TO DP013-DB2-TABLE-NAME (1)          05260002
                   SET DP013-DB2-ABEND                                  05270001
                       DP013-NO-ROLLBACK                                05280002
                                   TO TRUE                              05281002
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      05290001
                   SET DP011-MSG-FATAL                                  05300002
                                   TO TRUE                              05301002
                   MOVE PC-TSYMSG-01064                                 05310002
                                   TO DP011-MSG-NUMBER                  05311002
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05320001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05330001
           END-EVALUATE.                                                05360001
      *                                                                 05370001
       2120-FILL-CONTNR-TYP-CDE-TBL.                                    05380001
           IF  ((TF003-XFER-TYP-CDE-X   =  PC-NON-RTL-TYP-CDE)          05390001
                     OR                                                 05400001
                (TFSHCT-FIXT-IND  =  PC-NO))                            05410001
               ADD 1                                                    05420002
                                   TO TF004-NBR-OF-OCCURS               05421002
               MOVE TFSHCT-CONTNR-TYP-CDE                               05430001
                                   TO  TF004-CONTNR-TYP-CDE-X           05440002
                                       (TYP-CDE-IDX)                    05441002
                                                                        05450001
               IF TFSHCT-TRLR-IND = PC-YES                              05460001
                   MOVE PC-TRAILER-TYP-IND                              05470001
                                   TO TF004-CONTNR-TYP-IND              05480002
                                      (TYP-CDE-IDX)                     05481002
               ELSE                                                     05490001
                   MOVE PC-CONTAINER-TYP-IND                            05500001
                                   TO TF004-CONTNR-TYP-IND              05510002
                                      (TYP-CDE-IDX)                     05511002
               END-IF                                                   05520001
                                                                        05530001
               MOVE TFSHCT-SEAL-REQR-IND                                05540001
                                   TO  TF004-SEAL-REQ-IND               05550002
                                       (TYP-CDE-IDX)                    05551002
                                                                        05560001
               MOVE TFSHCT-CONTNR-TYP-DESC                              05570001
                                   TO  TF004-CONTNR-TYP-CDE-DESC        05580002
                                       (TYP-CDE-IDX)                    05581002
           END-IF.                                                      05590001
                                                                        05600001
           PERFORM 7000-FETCH-CONTNR-TYP-CDE-CSR.                       05610001
      *                                                                 05620001
       2130-CLOSE-CONTNR-TYP-CDE-CSR.                                   05630001
           EXEC SQL                                                     05640001
               CLOSE CONTNR_TYP_CDE_CSR                                 05650001
           END-EXEC.                                                    05660001
                                                                        05670001
           EVALUATE SQLCODE                                             05680005
               WHEN ZERO                                                05681005
                   CONTINUE                                             05682005
               WHEN OTHER                                               05690005
                   MOVE '2130-CLOSE-CONTNR-TYP-CDE-CSR'                 05720001
                                   TO DP013-PARAGRAPH                   05730002
                   MOVE 'CLOSE THE CONTNR_TYP_CDE_SCR CURSOR'           05740001
                                   TO DP013-MESSAGE-TEXT (1)            05750002
                   MOVE SQLCA      TO DP013-SQLCA                       05760002
                   MOVE 'TTFSHCT'  TO DP013-DB2-TABLE-NAME (1)          05770002
                   SET DP013-DB2-ABEND                                  05780001
                       DP013-NO-ROLLBACK                                05790002
                                   TO TRUE                              05791002
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      05800001
                   SET DP011-MSG-FATAL                                  05810002
                                   TO TRUE                              05811002
                   MOVE PC-TSYMSG-01064                                 05820002
                                   TO DP011-MSG-NUMBER                  05821002
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05830001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05840001
           END-EVALUATE.                                                05870001
      *                                                                 05880001
       7000-FETCH-CONTNR-TYP-CDE-CSR.                                   05890001
           INITIALIZE DCLTTFSHCT.                                       05900001
                                                                        05910001
           EXEC SQL                                                     05920001
               FETCH  CONTNR_TYP_CDE_CSR                                05930001
                INTO  :TFSHCT-CONTNR-TYP-CDE,                           05940001
                      :TFSHCT-CONTNR-TYP-DESC,                          05950001
                      :TFSHCT-SEAL-REQR-IND,                            05960001
                      :TFSHCT-TRLR-IND,                                 05970001
                      :TFSHCT-FIXT-IND                                  05980001
           END-EXEC.                                                    05990001
                                                                        06000001
           EVALUATE SQLCODE                                             06010003
               WHEN ZERO                                                06011003
                   CONTINUE                                             06012003
               WHEN -904                                                06020003
               WHEN -913                                                06030003
                   SET DP011-MSG-FATAL                                  06040002
                                   TO TRUE                              06041002
                   MOVE PC-TSYMSG-01063                                 06050002
                                   TO DP011-MSG-NUMBER                  06051002
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06060001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06070001
               WHEN +100                                                06080003
                   SET PS-END-OF-CONTNR-TYP-CDE-DATA                    06090002
                                   TO TRUE                              06091002
               WHEN OTHER                                               06100003
                   MOVE '7000-FETCH-CONTNR-TYP-CDE-CSR'                 06130001
                                   TO DP013-PARAGRAPH                   06140002
                   MOVE 'FETCH CONTNR_TYP_CDE_CSR'                      06150001
                                   TO DP013-MESSAGE-TEXT (1)            06160002
                   MOVE SQLCA      TO DP013-SQLCA                       06170002
                   MOVE 'TTFSHCT'  TO DP013-DB2-TABLE-NAME (1)          06180002
                   SET DP013-DB2-ABEND                                  06190001
                       DP013-NO-ROLLBACK                                06200002
                                   TO TRUE                              06201002
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06210001
                   SET DP011-MSG-FATAL                                  06220002
                                   TO TRUE                              06221002
                   MOVE PC-TSYMSG-01064                                 06230002
                                   TO DP011-MSG-NUMBER                  06231002
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06240001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06250001
           END-EVALUATE.                                                06280001
      *                                                                 06290001
      ******************************************************************06300001
      *  CONNECT TO SOCKET WHICH WAS GIVEN TO US BY THE AL/SYSTEMS PTC  06310001
      *  PROGRAM.  CONNECT THE PATH (SOCKET).                           06320001
      ******************************************************************06330001
       8000-SEND-DATA-TO-LISTENER.                                      06340001
           IF TF003-MQ-INDICATOR-Y                                      06350000
               PERFORM 8500-MQ-SETUP                                    06360001
               PERFORM 8510-MQ-SETUP-REMOTE                             06370001
               PERFORM 8520-PUT-QUEUE                                   06380001
               PERFORM 8600-CLOSE-PUT-Q                                 06390001
               PERFORM 8610-DISCONNECT-QMGR                             06400001
               PERFORM 9100-EXEC-CICS-RETURN                            06410001
           ELSE                                                         06420000
               PERFORM 8110-ENQ-TCPIPPRQ                                06430001
               PERFORM 8120-READQ-TCPIPPRQ-RECORD1                      06440001
               PERFORM 8130-READQ-TCPIPPRQ-RECORD2                      06450001
                                                                        06460001
      *MUST BE HERE                                                     06470001
               PERFORM 8140-REWRITE-TCPIPPRQ-NEXT-REC                   06480001
      *MUST BE HERE                                                     06490001
               ADD 1               TO PV-NEXT-RECORD                    06500002
                                                                        06510001
               IF PV-NEXT-RECORD > PV-TOTAL-RECORDS                     06520001
                   MOVE 3          TO PV-NEXT-RECORD                    06530002
               END-IF                                                   06540001
                                                                        06550001
               PERFORM 8150-REWRITE-TCPIPPRQ-RECORD1                    06560001
               PERFORM 8160-DEQ-TCPIPPRQ                                06570001
                                                                        06580001
               PERFORM 9100-EXEC-CICS-RETURN                            06590001
           END-IF.                                                      06600000
      *                                                                 06610001
      ******************************************************************06620001
       8110-ENQ-TCPIPPRQ.                                               06630001
           EXEC CICS                                                    06640001
               ENQ                                                      06650001
                   RESOURCE  (PV-TSQ-NAME)                              06660001
                   RESP      (PV-CICS-RESPONSE)                         06670001
           END-EXEC.                                                    06680001
                                                                        06690001
           EVALUATE TRUE                                                06700001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06710001
                   CONTINUE                                             06720001
               WHEN OTHER                                               06730001
                   MOVE '8110-ENQ-TCPIPPRQ'                             06740002
                                   TO DP013-PARAGRAPH                   06741002
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q06750001
      -                 'UEUE: '                                        06760001
                                   TO DP013-MESSAGE-TEXT (1)            06770002
                   MOVE PV-TSQ-NAME                                     06780002
                                   TO DP013-MESSAGE-TEXT (2)            06781002
                   SET DP013-CICS-ABEND                                 06790001
                       DP013-NO-ROLLBACK                                06800002
                                   TO TRUE                              06801002
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06810001
                   PERFORM 9100-EXEC-CICS-RETURN                        06820001
           END-EVALUATE.                                                06830001
      *                                                                 06840001
      ******************************************************************06850001
       8120-READQ-TCPIPPRQ-RECORD1.                                     06860001
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           06870002
                                   TO PV-TSQ-LENGTH.                    06871002
                                                                        06880001
           EXEC CICS                                                    06890001
               READQ TS                                                 06900001
                   QUEUE   (PV-TSQ-NAME)                                06910001
                   INTO    (PV-TCPIPPRQ-RECORD1)                        06920001
                   LENGTH  (PV-TSQ-LENGTH)                              06930001
                   ITEM    (1)                                          06940001
                   RESP    (PV-CICS-RESPONSE)                           06950001
           END-EXEC.                                                    06960001
                                                                        06970001
           EVALUATE TRUE                                                06980001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06990001
                   CONTINUE                                             07000001
               WHEN OTHER                                               07010001
                   MOVE '8120-READQ-TCPIPPRQ-RECORD1'                   07020001
                                   TO DP013-PARAGRAPH                   07030002
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 07040001
      -                 'QUEUE: '                                       07050001
                                   TO DP013-MESSAGE-TEXT (1)            07060002
                   MOVE PV-TSQ-NAME                                     07070002
                                   TO DP013-MESSAGE-TEXT (2)            07071002
                   SET DP013-CICS-ABEND                                 07080001
                       DP013-NO-ROLLBACK                                07090002
                                   TO TRUE                              07091002
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07100001
                   PERFORM 9100-EXEC-CICS-RETURN                        07110001
           END-EVALUATE.                                                07120001
      *                                                                 07130001
      ******************************************************************07140001
       8130-READQ-TCPIPPRQ-RECORD2.                                     07150001
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD2                           07160002
                                   TO PV-TSQ-LENGTH.                    07161002
                                                                        07170001
           EXEC CICS                                                    07180001
               READQ TS                                                 07190001
                   QUEUE   (PV-TSQ-NAME)                                07200001
                   INTO    (PV-TCPIPPRQ-RECORD2)                        07210001
                   LENGTH  (PV-TSQ-LENGTH)                              07220001
                   ITEM    (2)                                          07230001
                   RESP    (PV-CICS-RESPONSE)                           07240001
           END-EXEC.                                                    07250001
                                                                        07260001
           EVALUATE TRUE                                                07270001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07280001
                   CONTINUE                                             07290001
               WHEN OTHER                                               07300001
                   MOVE '8130-READQ-TCPIPPRQ-RECORD2'                   07310001
                                   TO DP013-PARAGRAPH                   07320002
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 07330001
      -                 'QUEUE: '                                       07340001
                                   TO DP013-MESSAGE-TEXT (1)            07350002
                   MOVE PV-TSQ-NAME                                     07360002
                                   TO DP013-MESSAGE-TEXT (2)            07361002
                   SET DP013-CICS-ABEND                                 07370001
                       DP013-NO-ROLLBACK                                07380002
                                   TO TRUE                              07381002
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07390001
                   PERFORM 9100-EXEC-CICS-RETURN                        07400001
           END-EVALUATE.                                                07410001
      *                                                                 07420001
      ******************************************************************07430001
       8140-REWRITE-TCPIPPRQ-NEXT-REC.                                  07440001
                                                                        07450001
           MOVE LENGTH OF TF004-XFER-TO-PTC-FIXED-DATA                  07460001
                                   TO  PV-FIXED-DATA-LENGTH.            07470002
                                                                        07480001
           MOVE LENGTH OF TF004-CONTNR-TYP-CDE-TBL                      07490001
                                   TO  PV-TBL-LENGTH.                   07500002
                                                                        07510001
           COMPUTE PV-TOT-REC-LENGTH  =                                 07520001
                                                                        07530001
               (TF004-NBR-OF-OCCURS * PV-TBL-LENGTH)  +                 07540001
                PV-FIXED-DATA-LENGTH.                                   07550001
                                                                        07560001
           MOVE PV-TOT-REC-LENGTH  TO  TF004-TOT-REC-LENGTH.            07570002
           MOVE TF003-MATCHING-NBR-FIELD                                07580002
                                   TO  TF004-MATCHING-NBR-FIELD.        07581002
           MOVE PV-NEXT-RECORD     TO  PV-ITEM-NBR.                     07590002
                                                                        07600001
           EXEC CICS                                                    07610001
               WRITEQ TS                                                07620001
                   QUEUE   (PV-TSQ-NAME)                                07630001
                   FROM    (TF004-XFER-TO-PTC-RECORD)                   07640001
                   LENGTH  (PV-TSQ-LENGTH)                              07650001
                   ITEM    (PV-ITEM-NBR)                                07660001
                       REWRITE                                          07670001
                   RESP    (PV-CICS-RESPONSE)                           07680001
           END-EXEC.                                                    07690001
                                                                        07700001
           EVALUATE TRUE                                                07710001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07720001
                   CONTINUE                                             07730001
               WHEN OTHER                                               07740001
                   MOVE '8140-REWRITE-TCPIPPRQ-NEXT-REC'                07750001
                                   TO DP013-PARAGRAPH                   07760002
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA07770001
      -                 'STORAGE QUEUE: '                               07780001
                                   TO DP013-MESSAGE-TEXT (1)            07790002
                   MOVE PV-TSQ-NAME                                     07800002
                                   TO DP013-MESSAGE-TEXT (2)            07801002
                   SET DP013-CICS-ABEND                                 07810001
                       DP013-NO-ROLLBACK                                07820002
                                   TO TRUE                              07821002
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07830001
                   PERFORM 9100-EXEC-CICS-RETURN                        07840001
           END-EVALUATE.                                                07850001
      *                                                                 07860001
      ******************************************************************07870001
       8150-REWRITE-TCPIPPRQ-RECORD1.                                   07880001
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           07890002
                                   TO PV-TSQ-LENGTH.                    07891002
           MOVE +1                 TO PV-ITEM-NBR.                      07900002
                                                                        07910001
           EXEC CICS                                                    07920001
               WRITEQ TS                                                07930001
                   QUEUE   (PV-TSQ-NAME)                                07940001
                   FROM    (PV-TCPIPPRQ-RECORD1)                        07950001
                   LENGTH  (PV-TSQ-LENGTH)                              07960001
                   ITEM    (PV-ITEM-NBR)                                07970001
                       REWRITE                                          07980001
                   RESP    (PV-CICS-RESPONSE)                           07990001
           END-EXEC.                                                    08000001
                                                                        08010001
           EVALUATE TRUE                                                08020001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08030001
                   CONTINUE                                             08040001
               WHEN OTHER                                               08050001
                   MOVE '8150-REWRITE-TCPIPPRQ-RECORD1'                 08060001
                                   TO DP013-PARAGRAPH                   08070002
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   08080001
                                   TO DP013-MESSAGE-TEXT (1)            08090002
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     08100001
                                   TO DP013-MESSAGE-TEXT (2)            08110002
                   MOVE PV-TSQ-NAME                                     08120002
                                   TO DP013-MESSAGE-TEXT (3)            08121002
                   MOVE PV-TCPIPPRQ-RECORD1                             08130002
                                   TO DP013-MESSAGE-TEXT (4)            08131002
                   SET DP013-CICS-ABEND                                 08140001
                       DP013-NO-ROLLBACK                                08150002
                                   TO TRUE                              08151002
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08160001
                   PERFORM 9100-EXEC-CICS-RETURN                        08170001
           END-EVALUATE.                                                08180001
      *                                                                 08190001
      ******************************************************************08200001
       8160-DEQ-TCPIPPRQ.                                               08210001
           EXEC CICS                                                    08220001
               DEQ                                                      08230001
                   RESOURCE  (PV-TSQ-NAME)                              08240001
                   RESP      (PV-CICS-RESPONSE)                         08250001
           END-EXEC.                                                    08260001
                                                                        08270001
           EVALUATE TRUE                                                08280001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08290001
                   CONTINUE                                             08300001
               WHEN OTHER                                               08310001
                   MOVE '8160-DEQ-TCPIPPRQ'                             08320002
                                   TO DP013-PARAGRAPH                   08321002
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q08330001
      -                 'UEUE: '                                        08340001
                                   TO DP013-MESSAGE-TEXT (1)            08350002
                   MOVE PV-TSQ-NAME                                     08360002
                                   TO DP013-MESSAGE-TEXT (2)            08361002
                   SET DP013-CICS-ABEND                                 08370001
                       DP013-NO-ROLLBACK                                08380002
                                   TO TRUE                              08381002
                 PERFORM 9999-WRITE-CICS-LOG-MSG                        08390001
                 PERFORM 9100-EXEC-CICS-RETURN                          08400001
           END-EVALUATE.                                                08410001
                                                                        08420000
       8500-MQ-SETUP.                                                   08430000
                                                                        08440000
      * DETERMINE THE SYSTEM                                            08450001
                                                                        08460001
           PERFORM EP000-0000-INITIALIZE.                               08470001
           IF EP000-PV-KOHLS-PROD-SYSTEM                                08480001
               SET PV-PROD-QMGR-NAME                                    08490002
                                   TO TRUE                              08491002
           ELSE                                                         08500001
                IF EP000-PV-KOHLS-QA-SYSTEM                             08510001
                    SET PV-QA-QMGR-NAME                                 08520002
                                   TO TRUE                              08521002
                ELSE                                                    08530001
                    SET PV-TEST-QMGR-NAME                               08540001
                                   TO TRUE                              08550002
                END-IF                                                  08560001
           END-IF.                                                      08570001
                                                                        08580001
      ***************************************************************   08590000
      *    CONNECT TO THE QUEUE MANAGER                                 08600001
      ***************************************************************   08610000
                                                                        08620001
           MOVE PV-QMGR-NAME       TO PV-QM-NAME.                       08630002
           CALL WS-MQCONN USING PV-QM-NAME                              08640001
                                PV-HCONN                                08650001
                                PV-COMPLETION-CODE                      08660001
                                PV-REASON.                              08670001
                                                                        08680001
      ***************************************************************   08690000
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              08700001
      *    AND EXIT                                                     08710001
      ***************************************************************   08720000
                                                                        08730001
           MOVE PV-REASON          TO PV-CON-REASON.                    08740002
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   08750001
               MOVE 'MQCONN ERROR' TO PV-ERROR-MESSAGE                  08760002
               MOVE '8500-MQ-SETUP'                                     08770002
                                   TO DP013-PARAGRAPH                   08771002
               MOVE PV-ERROR-MESSAGE                                    08780002
                                   TO DP013-MESSAGE-TEXT (1)            08781002
               MOVE  PV-COMPLETION-CODE                                 08790002
                                   TO DP013-MESSAGE-TEXT (2)            08791002
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            08800002
               SET DP013-CICS-ABEND                                     08810001
                   DP013-NO-ROLLBACK                                    08820002
                                   TO TRUE                              08821002
               PERFORM 9999-WRITE-CICS-LOG-MSG                          08830001
               PERFORM 9100-EXEC-CICS-RETURN                            08840001
           END-IF.                                                      08850001
                                                                        08860001
                                                                        08870000
       8510-MQ-SETUP-REMOTE.                                            08880000
      ***************************************************************   08890000
      *    OPEN THE RF.RESPONSE.Q QUEUE FOR OUTPUT.                     08900001
      *    THIS IS A REMOTE QUEUE.                                      08910001
      ***************************************************************   08920000
                                                                        08930001
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      08940001
                                     MQOO-FAIL-IF-QUIESCING.            08950001
                                                                        08960001
           MOVE TF003-REPLYTOQ     TO MQOD-OBJECTNAME.                  08970002
           MOVE TF003-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              08980002
                                                                        08990000
           CALL WS-MQOPEN USING PV-HCONN                                09000001
                                MQM-OBJECT-DESCRIPTOR                   09010001
                                PV-OPEN-OPTIONS                         09020001
                                PV-PQ-HANDLE                            09030001
                                PV-COMPLETION-CODE                      09040001
                                PV-REASON.                              09050001
                                                                        09060001
      ********************************************************          09070000
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    09080001
      *    AND EXIT.                                                    09090001
      ********************************************************          09100000
      *                                                                 09110001
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   09120001
               PERFORM 8600-CLOSE-PUT-Q                                 09130001
               PERFORM 8610-DISCONNECT-QMGR                             09140001
               MOVE 'MQOPEN WRITE Q'                                    09150002
                                   TO PV-ERROR-MESSAGE                  09151002
               MOVE '8510-MQ-SETUP-REMOTE'                              09160002
                                   TO DP013-PARAGRAPH                   09161002
               MOVE  PV-ERROR-MESSAGE                                   09170002
                                   TO DP013-MESSAGE-TEXT (1)            09171002
               MOVE  PV-COMPLETION-CODE                                 09180002
                                   TO DP013-MESSAGE-TEXT (2)            09181002
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            09190002
               SET DP013-CICS-ABEND                                     09200001
                   DP013-NO-ROLLBACK                                    09210002
                                   TO TRUE                              09211002
               PERFORM 9999-WRITE-CICS-LOG-MSG                          09220001
               PERFORM 9100-EXEC-CICS-RETURN                            09230001
           END-IF.                                                      09240001
           MOVE PV-PQ-HANDLE       TO PV-FMT-OPEN-OUTPUT-HNDL.          09250002
      *                                                                 09260001
      ******************************************************************09270001
       8520-PUT-QUEUE.                                                  09280001
           MOVE TF003-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              09290002
           MOVE TF003-REPLYTOQ     TO MQOD-OBJECTNAME.                  09300002
           MOVE TF003-MSGID        TO MQMD-CORRELID.                    09310002
           MOVE MQMI-NONE          TO MQMD-MSGID.                       09320002
           MOVE MQFMT-STRING       TO MQMD-FORMAT.                      09330002
           MOVE 5000               TO MQMD-EXPIRY.                      09340002
           MOVE LENGTH OF TF004-XFER-TO-PTC-RECORD                      09350001
                                   TO PV-DATA-LENGTH.                   09360002
           MOVE TF004-XFER-TO-PTC-RECORD                                09370002
                                   TO PV-MSGBUFFER.                     09371002
           MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 09380002
                                                                        09390001
           COMPUTE MQPMO-CONTEXT  =  PV-PQ-HANDLE.                      09400001
                                                                        09410000
                                                                        09420000
                                                                        09430001
           CALL WS-MQPUT USING PV-HCONN                                 09440001
                               PV-FMT-OPEN-OUTPUT-HNDL                  09450001
                               MQM-MESSAGE-DESCRIPTOR                   09460001
                               MQM-PUT-MESSAGE-OPTIONS                  09470001
                               PV-DATA-LENGTH                           09480001
                               PV-MSGBUFFER                             09490001
                               PV-COMPLETION-CODE                       09500001
                               PV-REASON.                               09510001
                                                                        09520001
      ***********************************************************       09530000
      *        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 09540001
      *        AND BREAK OUT OF LOOP                                    09550001
      ***********************************************************       09560000
                                                                        09570001
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   09580001
                  MOVE PV-COMPLETION-CODE                               09590002
                                   TO PH-COMPLETION-CODE                09591002
                  MOVE PV-REASON   TO PH-REASON                         09600002
                  PERFORM 8600-CLOSE-PUT-Q                              09610001
                  PERFORM 8610-DISCONNECT-QMGR                          09620001
                  MOVE 'MQPUT ERR' TO PV-ERROR-MESSAGE                  09630002
                  MOVE '8520-PUT-QUEUE'                                 09640002
                                   TO DP013-PARAGRAPH                   09641002
                  MOVE PV-ERROR-MESSAGE                                 09650002
                                   TO DP013-MESSAGE-TEXT (1)            09651002
                  MOVE PH-COMPLETION-CODE                               09660002
                                   TO DP013-MESSAGE-TEXT (2)            09661002
                  MOVE PH-REASON   TO DP013-MESSAGE-TEXT (3)            09670002
                  SET DP013-CICS-ABEND                                  09680001
                      DP013-NO-ROLLBACK                                 09690002
                                   TO TRUE                              09691002
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       09700001
                  PERFORM 9100-EXEC-CICS-RETURN                         09710001
           ELSE                                                         09720001
              SET PS-MQPUT-SUCCESSFUL                                   09730002
                                   TO TRUE                              09731002
           END-IF.                                                      09740001
      *                                                                 09750001
      ******************************************************************09760001
       8600-CLOSE-PUT-Q.                                                09770001
           CALL WS-MQCLOSE USING PV-HCONN                               09780001
                                 PV-PQ-HANDLE                           09790001
                                 MQCO-NONE                              09800001
                                 PV-COMPLETION-CODE                     09810001
                                 PV-REASON.                             09820001
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   09830001
               MOVE 'MQCLOSE PQ HANDLE'                                 09840002
                                   TO PV-ERROR-MESSAGE                  09841002
               MOVE '8600-CLOSE-PUT-Q'                                  09850002
                                   TO DP013-PARAGRAPH                   09851002
               MOVE  PV-ERROR-MESSAGE                                   09860002
                                   TO DP013-MESSAGE-TEXT (1)            09861002
               MOVE  PV-COMPLETION-CODE                                 09870002
                                   TO DP013-MESSAGE-TEXT (2)            09871002
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            09880002
               SET DP013-CICS-ABEND                                     09890001
                   DP013-NO-ROLLBACK                                    09900002
                                   TO TRUE                              09901002
               PERFORM 9999-WRITE-CICS-LOG-MSG                          09910001
               PERFORM 9100-EXEC-CICS-RETURN                            09920001
           END-IF.                                                      09930001
      *                                                                 09940001
      ******************************************************************09950001
       8610-DISCONNECT-QMGR.                                            09960001
                                                                        09970001
           IF PV-CON-REASON IS NOT EQUAL                                09980002
                                    TO MQRC-ALREADY-CONNECTED           09981002
              CALL WS-MQDISC USING PV-HCONN                             09990001
                                   PV-COMPLETION-CODE                   10000001
                                   PV-REASON                            10010001
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                10020001
                  MOVE 'MQDISC'    TO PV-ERROR-MESSAGE                  10030002
                  MOVE '8610-DISCONNECT'                                10040002
                                   TO DP013-PARAGRAPH                   10041002
                  MOVE PV-ERROR-MESSAGE                                 10050002
                                   TO DP013-MESSAGE-TEXT (1)            10051002
                  MOVE PV-COMPLETION-CODE                               10060002
                                   TO DP013-MESSAGE-TEXT (2)            10061002
                  MOVE PV-REASON   TO DP013-MESSAGE-TEXT (3)            10070002
                  SET DP013-CICS-ABEND                                  10080001
                      DP013-NO-ROLLBACK                                 10090002
                                   TO TRUE                              10091002
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       10100001
                  PERFORM 9100-EXEC-CICS-RETURN                         10110001
              END-IF                                                    10120001
           END-IF.                                                      10130001
                                                                        10140001
      *                                                                 10150001
      ******************************************************************10160001
      *    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          10170001
      *    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   10180001
      *    STREAM BEING SENT BACK TO THE PTC.                           10190001
      ******************************************************************10200001
       9000-FMT-ERR-MSG-TO-PTC.                                         10210001
           PERFORM DP011-0000-FORMAT-MSG-LINES.                         10220001
           MOVE DP011-MSG-LEVEL    TO  TF004-ERR-TYP-IND.               10230002
           MOVE DP011-MSG-TEXT     TO  TF004-ERR-MSG.                   10240002
      *                                                                 10250001
       9100-EXEC-CICS-RETURN.                                           10260001
           EXEC CICS                                                    10270001
               RETURN                                                   10280001
           END-EXEC.                                                    10290001
      *                                                                 10300001
       9999-WRITE-CICS-LOG-MSG.                                         10310001
           MOVE PC-CURRENT-PROGRAM-NAME                                 10320002
                                   TO  DP013-PROGRAM.                   10321002
           MOVE DFHEIBLK           TO  DP013-DFHEIBLK.                  10330002
                                                                        10340001
           INITIALIZE DP013-SRC-TASK-NUMBER                             10350001
                      DP013-STACK.                                      10360001
                                                                        10370001
           SET DP013-LINK-RETURN   TO  TRUE.                            10380002
                                                                        10390001
           EXEC CICS                                                    10400001
               LINK                                                     10410001
                   PROGRAM   (DP013-NAME)                               10420001
                   COMMAREA  (DP013-PARAMETERS)                         10430001
                   LENGTH    (DP013-LENGTH)                             10440001
           END-EXEC.                                                    10450001
                                                                        10460001
      *                                                                 10470001
      *    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           10480001
      *                                                                 10490001
                                                                        10500001
           COPY DPPD011.                                                10510001
      *                                                                 10520001
      *    NON-CICS ARCHITECTURE ABEND ROUTINE CALL                     10530001
      *                                                                 10540001
                                                                        10550001
           COPY DPPD014.                                                10560001
                                                                        10570000
           COPY EPPD000.                                                10580001
