000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XLKUT086.                                         00020000
000300 AUTHOR.        LYNN MCADAMS.                                     00030000
000400                                                                  00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  DECEMBER 2004.                                    00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900 ENVIRONMENT DIVISION.                                            00090000
001000 CONFIGURATION SECTION.                                           00100000
001100 SOURCE-COMPUTER. IBM-3090.                                       00110000
001200 OBJECT-COMPUTER. IBM-3090.                                       00120000
001300                                                                  00130000
001400****************************************************************  00140000
001500* THIS MODULE WILL BE USED TO RETRIEVE THE PERMANENT PRICE     *  00150000
001600* CHANGE EFFECTIVE DATE THAT FALLS BETWEEN A GIVEN NUMBER OF   *  00160000
001700* DAYS BEFORE THE CURRENT DATE AND A GIVEN NUMBER OF DAYS      *  00170000
001800* AFTER THE CURRENT DATE.                                      *  00180000
001900*                                                              *  00190000
002000* THIS PROGRAM WILL ALSO PROVIDE THE PERM PRICE CHANGE ID      *  00200000
002100* AND THE NEW RETAIL AMOUNT.                                   *  00210000
002200****************************************************************  00220000
002300****************************************************************  00230000
002400*                                                              *  00240000
002500********* REQUIREMENTS FOR USING THIS SUB-ROUTINE: *************  00250000
002600* THE CALLING PROGRAM MUST PROVIDE THE SKU NUMBER, ITEM        *  00260000
002700* NUMBER, THE NUMBER OF DAYS BEFORE CURRENT DATE AND THE       *  00270000
002800* NUMBER OF DAYS AFTER CURRENT DATE.  IF ANY OF THESE          *  00280000
002900* ARE MISSING IT WILL RESULT IN A NOT FOUND CONDITION.         *  00290000
003000*                                                              *  00300000
003100* THERE WILL BE TWO RETRIEVAL PROCESSES.  THE FIRST RETRIEVAL  *  00310000
003200* PROCESS USES THE OLD TABLES, TCPPCDT AND TCENPPC, USING THE  *  00320000
003300* GIVEN ITEM NUMBER.  THE SECOND RETRIEVAL PROCESS USES THE    *  00330000
003400* NEW TABLES, XLT_PRCHG, XLT_STR_GP_PRCHG AND XLT_PRCHG_MDSE   *  00340000
003500* USING THE SKU NUMBER.                                        *  00350000
003600*                                                              *  00360000
003700****************************************************************  00370000
003800                                                                  00380000
003900 DATA DIVISION.                                                   00390000
004000 WORKING-STORAGE SECTION.                                         00400000
004100 01  WS-WORKING-STORAGE-VALUE     PIC X(35) VALUE                 00410000
004200         '*** WORKING STORAGE STARTS HERE ***'.                   00420000
004300                                                                  00430000
004400 01  PC-PROGRAM-CONSTANTS.                                        00440000
004500     05  PC-CURRENT-PROGRAM-NAME PIC X(08) VALUE 'XLKUT086'.      00450000
004600                                                                  00460000
004700 01  PROGRAM-VARIABLES.                                           00470000
004800     05  PV-SQLCODE                 PIC S9(9).                    00480000
004900     05  PV-DISPLAY-SQLCODE         PIC -------999.               00490000
005000     05  PV-DISPLAY-DB2-TABLE       PIC X(08).                    00500000
005100     05  PV-DISPLAY-ITEM-NBR        PIC 9(15).                    00510000
005200     05  PV-DISPLAY-SKU-NBR         PIC 9(08).                    00520000
005300     05  PV-DISPLAY-BEFORE-DAYS     PIC 9(01).                    00530000
005400     05  PV-DISPLAY-AFTER-DAYS      PIC 9(01).                    00540000
005500     05  PV-SQL-RETURN-CD           PIC  999-.                    00550000
005600                                                                  00560000
005700 01  PV-TRACE.                                                    00570000
005800     05  FILLER                          PIC X(03) VALUE ' T='.   00580000
005900     05  PV-EIBTASKN                     PIC Z(06)9.              00590000
006000     05  PV-PARA                         PIC X(70).               00600000
006100                                                                  00610000
006200 01  PS-SWITCHES.                                                 00620000
006300     05  PS-EOF-OLD-PERM-CSR-SW       PIC X(01)  VALUE 'N'.       00630000
006400         88  PS-EOF-OLD-PERM-CSR                 VALUE 'Y'.       00640000
006500         88  PS-NOT-EOF-OLD-PERM-CSR             VALUE 'N'.       00650000
006600     05  PS-EOF-NEW-PERM-CSR-SW       PIC X(01)  VALUE 'N'.       00660000
006700         88  PS-EOF-NEW-PERM-CSR                 VALUE 'Y'.       00670000
006800         88  PS-NOT-EOF-NEW-PERM-CSR             VALUE 'N'.       00680000
006900 01  DK-DB2-KEYS.                                                 00690000
007000     05  DK-KEY-ITM-NBR           PIC S9(15)V COMP-3.             00700000
007100     05  DK-KEY-SKU-NBR           PIC S9(08)V COMP-3.             00710000
007200     05  DK-KEY-BEFORE-DAYS       PIC  S9(9)  COMP.               00720000
007300     05  DK-KEY-AFTER-DAYS        PIC  S9(9)  COMP.               00730000
007400                                                                  00740000
007500****************************************************************  00750000
007600*  TABLE DECLARATIONS                                          *  00760000
007700****************************************************************  00770000
007800                                                                  00780000
007900*PE-CENTRAL PPC DETAIL TABLE                                      00790000
008000*    EXEC SQL                                                     00800000
008100*        INCLUDE TCPPCDT                                          00810000
008200*    END-EXEC.                                                    00820000
008300                                                                  00830000
008400*PE-CENTRAL PERM PRICE CHANGE                                     00840000
008500*    EXEC SQL                                                     00850000
008600*        INCLUDE TCENPPC                                          00860000
008700*    END-EXEC.                                                    00870000
008800                                                                  00880000
008900*XLT_PRCHG - NEW PERM - PRICE CHANGE TABLE                        00890000
009000     EXEC SQL                                                     00900000
009100         INCLUDE XLT00032                                         00910000
009200     END-EXEC.                                                    00920000
009300                                                                  00930000
009400*XLT_STR_GP_PRCHG - NEW PERM - STORE GROUP PRICE CHANGE TABLE     00940000
009500     EXEC SQL                                                     00950000
009600         INCLUDE XLT00033                                         00960000
009700     END-EXEC.                                                    00970000
009800                                                                  00980000
009900*XLT_PRCHG_MDSE - NEW PERM - PRICE CHANGE MERCHANDISE TABLE       00990000
010000     EXEC SQL                                                     01000000
010100         INCLUDE XLT00034                                         01010000
010200     END-EXEC.                                                    01020000
010300                                                                  01030000
010400*DB2 COMMUNICATIONS AREA                                          01040000
010500     EXEC SQL                                                     01050000
010600          INCLUDE SQLCA                                           01060000
010700     END-EXEC.                                                    01070000
010800                                                                  01080000
010900******************************************************************01090000
011000*  OLD PERM PRICE CURSOR                                          01100000
011100******************************************************************01110000
011200*    EXEC SQL                                                     01120000
011300*        DECLARE  OLD_PERM_CSR CURSOR FOR                         01130000
011400*         SELECT  A.CENPPC_NBR                                    01140000
011500*               , A.NEW_RTL_AMT                                   01150000
011600*               , B.EFF_DTE                                       01160000
011700*           FROM  TCPPCDT A                                       01170000
011800*               , TCENPPC B                                       01180000
011900*          WHERE  A.OPERCO_NBR        =  B.OPERCO_NBR             01190000
012000*            AND  A.CENPPC_NBR        =  B.CENPPC_NBR             01200000
012100*            AND  A.TSK_ITEM_NMBR     =  :DK-KEY-ITM-NBR          01210000
012200*            AND  B.DOC_TYP_CDE       =  'C'                      01220000
012300*            AND  B.STATUS_CDE        IN ('AP', 'IP')             01230000
012400*            AND  B.EFF_DTE                                       01240000
012500*                 BETWEEN CURRENT DATE -                          01250000
012600*                      :DK-KEY-BEFORE-DAYS DAYS                   01260000
012700*                     AND CURRENT DATE +                          01270000
012800*                      :DK-KEY-AFTER-DAYS DAYS                    01280000
012900*          ORDER  BY B.EFF_DTE DESC                               01290000
013000*    END-EXEC.                                                    01300000
013100                                                                  01310000
013200******************************************************************01320000
013300*  NEW PERM PRICE CURSOR                                          01330000
013400******************************************************************01340000
013500     EXEC SQL                                                     01350000
013600         DECLARE  NEW-PERM-CSR CURSOR FOR                         01360000
013700          SELECT A.PRCHG_ID                                       01370000
013800               , B.PRCHG_EFF_DTE                                  01380000
013900               , C.SKU_NBR                                        01390000
014000               , C.UNT_RTL_AMT                                    01400000
014100            FROM XLT_PRCHG        A                               01410000
014200               , XLT_STR_GP_PRCHG B                               01420000
014300               , XLT_PRCHG_MDSE   C                               01430000
014400           WHERE A.PRCHG_ID         =    B.PRCHG_ID               01440000
014500             AND A.PRCHG_ID         =    C.PRCHG_ID               01450000
014600             AND B.STR_GP_TYP_CDE   =    C.STR_GP_TYP_CDE         01460000
014700             AND B.STR_GP_ID        =    C.STR_GP_ID              01470000
014800             AND A.PRCHG_ST_CDE     =    'APR'                    01480000
014900             AND B.STR_GP_TYP_CDE   =    1000                     01490000
015000             AND B.STR_GP_ID        =    1                        01500000
015100             AND C.SKU_NBR          =    :DK-KEY-SKU-NBR          01510000
015200             AND B.PRCHG_EFF_DTE                                  01520000
015300                  BETWEEN  CURRENT DATE -                         01530000
015400                       :DK-KEY-BEFORE-DAYS DAYS                   01540000
015500                      AND CURRENT DATE +                          01550000
015600                       :DK-KEY-AFTER-DAYS DAYS                    01560000
015700        ORDER BY B.PRCHG_EFF_DTE DESC                             01570000
015800     END-EXEC.                                                    01580000
015900                                                                  01590000
016000 LINKAGE SECTION.                                                 01600000
016100     COPY XLWS086.                                                01610000
016200                                                                  01620000
016300******************************************************************01630000
016400 PROCEDURE DIVISION USING XL086-PR-CHG-COMMAREA.                  01640000
016500******************************************************************01650000
016600 0000-MAINLINE.                                                   01660000
016700                                                                  01670000
016800     INITIALIZE XL086-RETURN-DATA.                                01680000
016900     INITIALIZE XL086-PROCESSING-RETURN-CODES.                    01690000
017000                                                                  01700000
017100     PERFORM 1000-GET-PRCHG-EFF-DATE.                             01710002
017200                                                                  01720000
017300     GOBACK.                                                      01730000
017400                                                                  01740000
017500******************************************************************01750000
017600*  GET PERM PRICE EFFECTIVE DATE                                 *01760000
017700******************************************************************01770000
017800 1000-GET-PRCHG-EFF-DATE.                                         01780000
017900                                                                  01790000
018000      IF XL086-OCCURRENCE-ONLY-YES                                01800000
018100         PERFORM 1110-GET-NEW-PERM                                01810000
018200      ELSE                                                        01820000
018300         PERFORM 2210-OPEN-NEW-PERM-CSR                           01830000
018400         PERFORM 2220-FETCH-NEW-PERM-CSR                          01840000
018500         PERFORM 2230-CLOSE-NEW-PERM-CSR                          01850000
018600      END-IF.                                                     01860000
018700                                                                  01870000
018800******************************************************************01880000
018900*  GET PERM PRICE EFFECTIVE DATE                                 *01890000
019000******************************************************************01900000
019100 1110-GET-NEW-PERM.                                               01910000
019200     MOVE XL086-KEY-SKU-NBR     TO DK-KEY-SKU-NBR                 01920000
019300     MOVE XL086-KEY-BEFORE-DAYS TO DK-KEY-BEFORE-DAYS             01930000
019400     MOVE XL086-KEY-AFTER-DAYS  TO DK-KEY-AFTER-DAYS              01940000
019500                                                                  01950000
019600     EXEC SQL                                                     01960000
019700     SELECT B.PRCHG_EFF_DTE                                       01970000
019800          , C.SKU_NBR                                             01980000
019900          , A.PRCHG_ID                                            01990000
020000*         , C.UNT_RTL_AMT                                         02000000
020100       INTO :XL086-EFF-DTE                                        02010000
020200          , :XLT00034-SKU-NBR                                     02020000
020300          , :XLT00034-PRCHG-ID                                    02030000
020400*         , :XLT00034-UNT-RTL-AMT                                 02040000
020500       FROM XLT_PRCHG        A                                    02050000
020600          , XLT_STR_GP_PRCHG B                                    02060000
020700          , XLT_PRCHG_MDSE   C                                    02070000
020800      WHERE A.PRCHG_ID        = B.PRCHG_ID                        02080000
020900        AND A.PRCHG_ID        = C.PRCHG_ID                        02090000
021000        AND B.STR_GP_TYP_CDE  = C.STR_GP_TYP_CDE                  02100000
021100        AND B.STR_GP_ID       = C.STR_GP_ID                       02110000
021200                                                                  02120000
021300        AND A.PRCHG_ST_CDE    = 'APR'                             02130000
021400        AND B.STR_GP_TYP_CDE  = 1000                              02140000
021500        AND B.STR_GP_ID       = 1                                 02150000
021600        AND C.SKU_NBR         = :XL086-KEY-SKU-NBR                02160000
021700        AND B.PRCHG_EFF_DTE                                       02170000
021800            BETWEEN CURRENT DATE - :DK-KEY-BEFORE-DAYS DAYS       02180000
021900                AND CURRENT DATE + :DK-KEY-AFTER-DAYS DAYS        02190000
022000     END-EXEC                                                     02200000
022100                                                                  02210000
022200     EVALUATE TRUE                                                02220000
022300         WHEN SQLCODE = ZERO                                      02230000
022400         WHEN SQLCODE = -811                                      02240000
022500              SET XL086-PPC-DOC-FOUND   TO TRUE                   02250000
022600              SET XL086-SUCCESSFUL      TO TRUE                   02260000
022700         WHEN SQLCODE = +100                                      02270000
022800              SET XL086-PPC-DOC-NOT-FOUND TO TRUE                 02280000
022900              SET XL086-SUCCESSFUL      TO TRUE                   02290000
023000         WHEN OTHER                                               02300000
023100              SET   XL086-SQL-ERROR         TO TRUE               02310000
023200              SET   XL086-PPC-DOC-NOT-FOUND TO TRUE               02320000
023300              MOVE  XL086-KEY-ITM-NBR                             02330000
023400                                  TO  PV-DISPLAY-ITEM-NBR         02340000
023500              MOVE  XL086-KEY-SKU-NBR                             02350000
023600                                  TO  PV-DISPLAY-SKU-NBR          02360000
023700              MOVE  XL086-KEY-BEFORE-DAYS                         02370000
023800                                  TO  PV-DISPLAY-BEFORE-DAYS      02380000
023900              MOVE  XL086-KEY-AFTER-DAYS                          02390000
024000                                  TO  PV-DISPLAY-AFTER-DAYS       02400000
024100              MOVE  SQLCODE       TO  PV-DISPLAY-SQLCODE          02410000
024200                                      PV-SQL-RETURN-CD            02420000
024300                                      XL086-SQLCODE               02430000
024400              MOVE 'XLT_PRCHG'    TO  XL086-DB2-TABLE             02440000
024500                                                                  02450000
024600              STRING  ' XLKUT086-1110-GET-NEW-PERM'               02460000
024700                      ' SQLCODE-'                                 02470000
024800                      PV-DISPLAY-SQLCODE                          02480000
024900                      ' ITEM NBR- '                               02490000
025000                      PV-DISPLAY-ITEM-NBR                         02500000
025100                      ' SKU NBR-'                                 02510000
025200                      PV-DISPLAY-SKU-NBR                          02520000
025300                      ' BEFORE DAYS-'                             02530000
025400                      PV-DISPLAY-BEFORE-DAYS                      02540000
025500                      ' AFTER DAYS-'                              02550000
025600                      PV-DISPLAY-AFTER-DAYS                       02560000
025700                      ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     02570000
025800                                      INTO XL086-CRA-RET-MSG      02580000
025900             MOVE '1110-'               TO XL086-CRA-REQ-ID       02590000
026000             PERFORM 9998-RETURN                                  02600000
026100                                                                  02610000
026200     END-EVALUATE.                                                02620000
026300                                                                  02630000
026400****************************************************************  02640000
026500* OPEN OLD PERM CURSOR                                         *  02650000
026600****************************************************************  02660000
026700*2110-OPEN-OLD-PERM-CSR.                                          02670000
026800*                                                                 02680000
026900*    MOVE ' 2110-OPEN-OLD-PERM-CSR' TO PV-PARA                    02690000
027000*                                                                 02700000
027100*    MOVE XL086-KEY-ITM-NBR     TO DK-KEY-ITM-NBR                 02710000
027200*    MOVE XL086-KEY-BEFORE-DAYS TO DK-KEY-BEFORE-DAYS             02720000
027300*    MOVE XL086-KEY-AFTER-DAYS  TO DK-KEY-AFTER-DAYS              02730000
027400*                                                                 02740000
027500*    EXEC SQL                                                     02750000
027600*         OPEN OLD_PERM_CSR                                       02760000
027700*    END-EXEC.                                                    02770000
027800*                                                                 02780000
027900*    EVALUATE TRUE                                                02790000
028000*        WHEN SQLCODE = ZERO                                      02800000
028100*             SET PS-NOT-EOF-OLD-PERM-CSR TO TRUE                 02810000
028200*        WHEN OTHER                                               02820000
028300*             SET XL086-SQL-ERROR         TO TRUE                 02830000
028400*             MOVE  XL086-KEY-ITM-NBR                             02840000
028500*                                 TO  PV-DISPLAY-ITEM-NBR         02850000
028600*             MOVE  XL086-KEY-BEFORE-DAYS                         02860000
028700*                                 TO  PV-DISPLAY-BEFORE-DAYS      02870000
028800*             MOVE  XL086-KEY-AFTER-DAYS                          02880000
028900*                                 TO  PV-DISPLAY-AFTER-DAYS       02890000
029000*             MOVE  SQLCODE       TO  PV-DISPLAY-SQLCODE          02900000
029100*                                     PV-SQL-RETURN-CD            02910000
029200*                                     XL086-SQLCODE               02920000
029300*             STRING  ' XLKUT086-2110-OPEN-OLD-PERM-CSR-'         02930000
029400*                     PV-DISPLAY-ITEM-NBR                         02940000
029500*                     ' SQLCODE-'                                 02950000
029600*                     PV-DISPLAY-SQLCODE                          02960000
029700*                     ' BEFORE DAYS-'                             02970000
029800*                     PV-DISPLAY-BEFORE-DAYS                      02980000
029900*                     ' AFTER DAYS-'                              02990000
030000*                     PV-DISPLAY-AFTER-DAYS                       03000000
030100*                     ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     03010000
030200*                                     INTO XL086-CRA-RET-MSG      03020000
030300*            MOVE '2110-'               TO XL086-CRA-REQ-ID       03030000
030400*            PERFORM 9998-RETURN                                  03040000
030500*    END-EVALUATE.                                                03050000
030600*                                                                 03060000
030700****************************************************************  03070000
030800* FETCH OLD PERM CURSOR                                        *  03080000
030900****************************************************************  03090000
031000*2120-FETCH-OLD-PERM-CSR.                                         03100000
031100*    MOVE ' 2120-FETCH-OLD-PERM-CSR' TO PV-PARA                   03110000
031200*                                                                 03120000
031300*    EXEC SQL                                                     03130000
031400*         FETCH OLD_PERM_CSR                                      03140000
031500*          INTO   :XL086-DOC-NBR                                  03150000
031600*               , :XL086-NEW-RTL-AMT                              03160000
031700*               , :XL086-EFF-DTE                                  03170000
031800*    END-EXEC.                                                    03180000
031900*                                                                 03190000
032000*    EVALUATE TRUE                                                03200000
032100*        WHEN SQLCODE = ZERO                                      03210000
032200*             SET XL086-PPC-DOC-FOUND   TO TRUE                   03220000
032300*             SET XL086-SUCCESSFUL      TO TRUE                   03230000
032400*        WHEN SQLCODE = +100                                      03240000
032500*             SET PS-EOF-OLD-PERM-CSR TO TRUE                     03250000
032600*             PERFORM 2210-OPEN-NEW-PERM-CSR                      03260000
032700*             PERFORM 2220-FETCH-NEW-PERM-CSR                     03270000
032800*             PERFORM 2230-CLOSE-NEW-PERM-CSR                     03280000
032900*        WHEN OTHER                                               03290000
033000*             SET   XL086-SQL-ERROR         TO TRUE               03300000
033100*             SET   XL086-PPC-DOC-NOT-FOUND TO TRUE               03310000
033200*             MOVE  XL086-KEY-ITM-NBR                             03320000
033300*                                 TO  PV-DISPLAY-ITEM-NBR         03330000
033400*             MOVE  XL086-KEY-BEFORE-DAYS                         03340000
033500*                                 TO  PV-DISPLAY-BEFORE-DAYS      03350000
033600*             MOVE  XL086-KEY-AFTER-DAYS                          03360000
033700*                                 TO  PV-DISPLAY-AFTER-DAYS       03370000
033800*             MOVE  SQLCODE       TO  PV-DISPLAY-SQLCODE          03380000
033900*                                     PV-SQL-RETURN-CD            03390000
034000*                                     XL086-SQLCODE               03400000
034100*             MOVE 'TCENPPC'      TO  XL086-DB2-TABLE             03410000
034200*                                                                 03420000
034300*             STRING  ' XLKUT086-2120-FETCH-OLD-PERM-CSR-'        03430000
034400*                     PV-DISPLAY-ITEM-NBR                         03440000
034500*                     ' SQLCODE-'                                 03450000
034600*                     PV-DISPLAY-SQLCODE                          03460000
034700*                     ' TABLE  -'                                 03470000
034800*                     PV-DISPLAY-DB2-TABLE                        03480000
034900*                     ' BEFORE DAYS-'                             03490000
035000*                     PV-DISPLAY-BEFORE-DAYS                      03500000
035100*                     ' AFTER DAYS-'                              03510000
035200*                     PV-DISPLAY-AFTER-DAYS                       03520000
035300*                     ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     03530000
035400*                                     INTO XL086-CRA-RET-MSG      03540000
035500*            MOVE '2120-'               TO XL086-CRA-REQ-ID       03550000
035600*            PERFORM 9998-RETURN                                  03560000
035700*                                                                 03570000
035800*    END-EVALUATE.                                                03580000
035900*                                                                 03590000
036000****************************************************************  03600000
036100* CLOSE OLD PERM CURSOR                                        *  03610000
036200****************************************************************  03620000
036300*2130-CLOSE-OLD-PERM-CSR.                                         03630000
036400*                                                                 03640000
036500*    MOVE ' 2130-CLOSE-OLD-PERM-CSR' TO PV-PARA                   03650000
036600*                                                                 03660000
036700*    EXEC SQL                                                     03670000
036800*         CLOSE OLD_PERM_CSR                                      03680000
036900*    END-EXEC.                                                    03690000
037000*                                                                 03700000
037100*    EVALUATE TRUE                                                03710000
037200*        WHEN SQLCODE = ZERO                                      03720000
037300*            CONTINUE                                             03730000
037400*        WHEN OTHER                                               03740000
037500*             SET   XL086-SQL-ERROR      TO TRUE                  03750000
037600*             MOVE  XL086-KEY-ITM-NBR                             03760000
037700*                                 TO  PV-DISPLAY-ITEM-NBR         03770000
037800*             MOVE  XL086-KEY-BEFORE-DAYS                         03780000
037900*                                 TO  PV-DISPLAY-BEFORE-DAYS      03790000
038000*             MOVE  XL086-KEY-AFTER-DAYS                          03800000
038100*                                 TO  PV-DISPLAY-AFTER-DAYS       03810000
038200*             MOVE  SQLCODE       TO  PV-DISPLAY-SQLCODE          03820000
038300*                                     PV-SQL-RETURN-CD            03830000
038400*                                     XL086-SQLCODE               03840000
038500*             STRING  ' XLKUT086-2130-CLOSE-OLD-PERM-CSR-'        03850000
038600*                     PV-DISPLAY-ITEM-NBR                         03860000
038700*                     ' SQLCODE-'                                 03870000
038800*                     PV-DISPLAY-SQLCODE                          03880000
038900*                     ' BEFORE DAYS-'                             03890000
039000*                     PV-DISPLAY-BEFORE-DAYS                      03900000
039100*                     ' AFTER DAYS-'                              03910000
039200*                     PV-DISPLAY-AFTER-DAYS                       03920000
039300*                     ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     03930000
039400*                                     INTO XL086-CRA-RET-MSG      03940000
039500*            MOVE '2130-'               TO XL086-CRA-REQ-ID       03950000
039600*            PERFORM 9998-RETURN                                  03960000
039700*    END-EVALUATE.                                                03970000
039800*                                                                 03980000
039900****************************************************************  03990000
040000* OPEN NEW PERM CURSOR                                         *  04000000
040100****************************************************************  04010000
040200 2210-OPEN-NEW-PERM-CSR.                                          04020000
040300     MOVE ' 2210-OPEN-NEW-PERM-CSR' TO PV-PARA                    04030000
040400                                                                  04040000
040500     MOVE XL086-KEY-SKU-NBR     TO DK-KEY-SKU-NBR                 04050000
040600     MOVE XL086-KEY-BEFORE-DAYS TO DK-KEY-BEFORE-DAYS             04060000
040700     MOVE XL086-KEY-AFTER-DAYS  TO DK-KEY-AFTER-DAYS              04070000
040800                                                                  04080000
040900     EXEC SQL                                                     04090000
041000          OPEN NEW-PERM-CSR                                       04100000
041100     END-EXEC.                                                    04110000
041200                                                                  04120000
041300     EVALUATE TRUE                                                04130000
041400         WHEN SQLCODE = ZERO                                      04140000
041500              SET PS-NOT-EOF-NEW-PERM-CSR TO TRUE                 04150000
041600         WHEN OTHER                                               04160000
041700              SET   XL086-SQL-ERROR       TO TRUE                 04170000
041800              MOVE  XL086-KEY-SKU-NBR                             04180000
041900                                  TO  PV-DISPLAY-SKU-NBR          04190000
042000              MOVE  XL086-KEY-BEFORE-DAYS                         04200000
042100                                  TO  PV-DISPLAY-BEFORE-DAYS      04210000
042200              MOVE  XL086-KEY-AFTER-DAYS                          04220000
042300                                  TO  PV-DISPLAY-AFTER-DAYS       04230000
042400              MOVE  SQLCODE       TO  PV-DISPLAY-SQLCODE          04240000
042500                                      PV-SQL-RETURN-CD            04250000
042600                                      XL086-SQLCODE               04260000
042700              MOVE 'XLT_PRCHG'    TO  XL086-DB2-TABLE             04270000
042800              STRING  ' XLKUT086-2210-OPEN-NEW-PERM-CSR-'         04280000
042900                      PV-DISPLAY-SKU-NBR                          04290000
043000                      ' SQLCODE-'                                 04300000
043100                      PV-DISPLAY-SQLCODE                          04310000
043200                      ' TABLE  -'                                 04320000
043300                      PV-DISPLAY-DB2-TABLE                        04330000
043400                      ' BEFORE DAYS-'                             04340000
043500                      PV-DISPLAY-BEFORE-DAYS                      04350000
043600                      ' AFTER DAYS-'                              04360000
043700                      PV-DISPLAY-AFTER-DAYS                       04370000
043800                      ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     04380000
043900                                      INTO XL086-CRA-RET-MSG      04390000
044000             MOVE '2210-'               TO XL086-CRA-REQ-ID       04400000
044100             PERFORM 9998-RETURN                                  04410000
044200                                                                  04420000
044300     END-EVALUATE.                                                04430000
044400                                                                  04440000
044500****************************************************************  04450000
044600* FETCH NEW PERM CURSOR                                        *  04460000
044700****************************************************************  04470000
044800 2220-FETCH-NEW-PERM-CSR.                                         04480000
044900     MOVE ' 2220-FETCH-NEW-PERM-CSR' TO PV-PARA                   04490000
045000                                                                  04500000
045100     EXEC SQL                                                     04510000
045200          FETCH NEW-PERM-CSR                                      04520000
045300           INTO   :XL086-DOC-NBR                                  04530000
045400                , :XL086-EFF-DTE                                  04540000
045500                , :XLT00034-SKU-NBR                               04550000
045600                , :XL086-NEW-RTL-AMT                              04560000
045700     END-EXEC.                                                    04570000
045800                                                                  04580000
045900     EVALUATE TRUE                                                04590000
046000         WHEN SQLCODE = ZERO                                      04600000
046100              SET XL086-PPC-DOC-FOUND     TO TRUE                 04610000
046200              SET XL086-SUCCESSFUL        TO TRUE                 04620000
046300         WHEN SQLCODE = +100                                      04630000
046400              SET PS-EOF-NEW-PERM-CSR     TO TRUE                 04640000
046500              SET XL086-PPC-DOC-NOT-FOUND TO TRUE                 04650000
046600              SET XL086-SUCCESSFUL        TO TRUE                 04660000
046700         WHEN OTHER                                               04670000
046800              SET   XL086-SQL-ERROR         TO TRUE               04680000
046900              SET   XL086-PPC-DOC-NOT-FOUND TO TRUE               04690000
047000              MOVE  XL086-KEY-ITM-NBR                             04700000
047100                                  TO  PV-DISPLAY-ITEM-NBR         04710000
047200              MOVE  XL086-KEY-SKU-NBR                             04720000
047300                                  TO  PV-DISPLAY-SKU-NBR          04730000
047400              MOVE  XL086-KEY-BEFORE-DAYS                         04740000
047500                                  TO  PV-DISPLAY-BEFORE-DAYS      04750000
047600              MOVE  XL086-KEY-AFTER-DAYS                          04760000
047700                                  TO  PV-DISPLAY-AFTER-DAYS       04770000
047800                                                                  04780000
047900              MOVE  SQLCODE       TO  PV-DISPLAY-SQLCODE          04790000
048000                                      PV-SQL-RETURN-CD            04800000
048100                                      XL086-SQLCODE               04810000
048200              MOVE 'XLT_PRCHG'    TO  XL086-DB2-TABLE             04820000
048300                                                                  04830000
048400              STRING  ' XLKUT086-2220-FETCH-NEW-PERM-CSR-'        04840000
048500                      ' SQLCODE-'                                 04850000
048600                      PV-DISPLAY-SQLCODE                          04860000
048700                      ' ITEM NBR- '                               04870000
048800                      PV-DISPLAY-ITEM-NBR                         04880000
048900                      'SKU NBR-'                                  04890000
049000                      PV-DISPLAY-SKU-NBR                          04900000
049100                      ' BEFORE DAYS-'                             04910000
049200                      PV-DISPLAY-BEFORE-DAYS                      04920000
049300                      ' AFTER DAYS-'                              04930000
049400                      PV-DISPLAY-AFTER-DAYS                       04940000
049500                      ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     04950000
049600                                      INTO XL086-CRA-RET-MSG      04960000
049700             MOVE '2220-'               TO XL086-CRA-REQ-ID       04970000
049800             PERFORM 9998-RETURN                                  04980000
049900                                                                  04990000
050000     END-EVALUATE.                                                05000000
050100                                                                  05010000
050200****************************************************************  05020000
050300* CLOSE NEW PERM CURSOR                                        *  05030000
050400****************************************************************  05040000
050500 2230-CLOSE-NEW-PERM-CSR.                                         05050000
050600                                                                  05060000
050700     MOVE ' 2230-CLOSE-NEW-PERM-CSR' TO PV-PARA                   05070000
050800                                                                  05080000
050900     EXEC SQL                                                     05090000
051000          CLOSE NEW-PERM-CSR                                      05100000
051100     END-EXEC.                                                    05110000
051200                                                                  05120000
051300     EVALUATE TRUE                                                05130000
051400         WHEN SQLCODE = ZERO                                      05140000
051500             CONTINUE                                             05150000
051600         WHEN OTHER                                               05160000
051700              SET   XL086-SQL-ERROR         TO TRUE               05170000
051800              MOVE  XL086-KEY-SKU-NBR                             05180000
051900                                  TO  PV-DISPLAY-SKU-NBR          05190000
052000              MOVE  XL086-KEY-BEFORE-DAYS                         05200000
052100                                  TO  PV-DISPLAY-BEFORE-DAYS      05210000
052200              MOVE  XL086-KEY-AFTER-DAYS                          05220000
052300                                  TO  PV-DISPLAY-AFTER-DAYS       05230000
052400              MOVE  SQLCODE       TO  PV-DISPLAY-SQLCODE          05240000
052500                                      PV-SQL-RETURN-CD            05250000
052600                                      XL086-SQLCODE               05260000
052700              STRING  ' 2230-CLOSE-NEW-PERM-CSR-'                 05270000
052800                      PV-DISPLAY-SKU-NBR                          05280000
052900                      ' SQLCODE-'                                 05290000
053000                      PV-DISPLAY-SQLCODE                          05300000
053100                      ' BEFORE DAYS-'                             05310000
053200                      PV-DISPLAY-BEFORE-DAYS                      05320000
053300                      ' AFTER DAYS-'                              05330000
053400                      PV-DISPLAY-AFTER-DAYS                       05340000
053500                      ' TASK= ' PV-EIBTASKN DELIMITED BY SIZE     05350000
053600                                      INTO XL086-CRA-RET-MSG      05360000
053700             MOVE '2230-'               TO XL086-CRA-REQ-ID       05370000
053800             PERFORM 9998-RETURN                                  05380000
053900                                                                  05390000
054000     END-EVALUATE.                                                05400000
054100                                                                  05410000
054200*-----------------------------------------------------------------05420000
054300*  RETURN TO CALLING PROGRAM                                      05430000
054400*-----------------------------------------------------------------05440000
054500 9998-RETURN.                                                     05450000
054600                                                                  05460000
054700     MOVE SQLCA                         TO XL086-SQLCA.           05470000
054800                                                                  05480000
054900******************************************************************05490000
055000**                       END SUB ROUTINE                        **05500000
055100******************************************************************05510000
