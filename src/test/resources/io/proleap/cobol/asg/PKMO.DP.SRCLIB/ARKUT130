000100***************************************************************** 00010035
000200 IDENTIFICATION DIVISION.                                         00020035
000300***************************************************************** 00030035
000400                                                                  00040035
000500 PROGRAM-ID.             ARKUT130.                                00050077
000600 AUTHOR.                 COGNIZANT.                               00060035
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070035
000800 DATE-WRITTEN            JULY  2019.                              00080062
000900 DATE-COMPILED.                                                   00090035
001000                                                                  00100035
001100***************************************************************** 00110035
001200*  PURPOSE:                                                       00120035
001300*  THIS PROGRAM WILL TOKENIZE THE BELOW FIELDS IN THE INPUT FILE  00130062
001400*  1) DAT_CHD_NUM                                                 00140077
001400*  2) DAT_ENTERED_ACCT                                            00150077
001500*  PROTEGRITY MODULE WILL BE INVOKED TO TOKENIZE THE FIELDS       00160062
001600*                                                                 00170035
001700*  INPUT:  CD031 RAWDATA FILE                                     00180077
001800*  OUTPUT: CD031 RAWDATA FILE WITH TOKENIZED ACCOUNT ID           00190077
001900*                                                                 00200035
002000***************************************************************** 00210035
002100*----------------------------------------------------------------*00220035
002200*                                                                *00230035
002300* DATE:        07/24/2019                                        *00240062
002400* WR/IR#:      CHG0230275                                        *00250077
002500* PROGRAMMER:  COGNIZANT                                         *00260035
002600* DESCRIPTION: INITIAL VERSION CREATED FOR FD FILE TRANSFER      *00270065
002700*              PROJECT                                           *00280035
002800*                                                                *00290035
002900*----------------------------------------------------------------*00300035
003000***************************************************************** 00310035
003100 ENVIRONMENT DIVISION.                                            00320035
003200***************************************************************** 00330035
003300                                                                  00340035
003400 CONFIGURATION SECTION.                                           00350035
003500                                                                  00360035
003600 SOURCE-COMPUTER.        IBM-3090.                                00370035
003700                                                                  00380035
003800 OBJECT-COMPUTER.        IBM-3090.                                00390035
003900                                                                  00400035
004000 INPUT-OUTPUT SECTION.                                            00410035
004100                                                                  00420035
004200 FILE-CONTROL.                                                    00430035
004300                                                                  00440035
004400     SELECT CD031-INPUT-FILE                                      00450077
004500         ASSIGN TO INP01.                                         00460035
004600                                                                  00470035
004700     SELECT CD031-TOKEN-FILE                                      00480077
004800         ASSIGN TO OUT01.                                         00490035
004900                                                                  00500035
005000******************************************************************00510035
005100 DATA DIVISION.                                                   00520035
005200******************************************************************00530035
005300                                                                  00540035
005400 FILE SECTION.                                                    00550035
005500                                                                  00560035
005600 FD  CD031-INPUT-FILE                                             00570077
005700     RECORDING MODE IS F                                          00580077
005800     BLOCK CONTAINS 0 RECORDS                                     00590035
005900     LABEL RECORDS ARE STANDARD.                                  00600077
006100                                                                  00620035
006200 01  CD031-INPUT-RECORD          PIC X(700).                      00630077
006300                                                                  00640035
006400 FD  CD031-TOKEN-FILE                                             00650077
006500     RECORDING MODE IS F                                          00660077
006600     BLOCK CONTAINS 0 RECORDS                                     00670035
006700     LABEL RECORDS ARE STANDARD.                                  00680077
006900                                                                  00700035
007000 01  CD031-TOKEN-RECORD          PIC X(700).                      00710077
007100                                                                  00720035
007200******************************************************************00730035
007300 WORKING-STORAGE SECTION.                                         00740035
007400******************************************************************00750035
007500 01  FILLER                            PIC X(50)  VALUE           00760035
007600     ' *** WORKING STORAGE STARTS HERE FOR ARKUT130 *** '.        00770077
007700                                                                  00780035
007800 01  ABEND-CODE                        PIC S9(04) VALUE +0.       00790057
007900                                                                  00800057
008000 01  PS-PROGRAM-SWITCHES.                                         00810035
008100     05  PS-END-OF-FILE-SW             PIC X(01)  VALUE 'N'.      00820077
008200         88  PS-NOT-END-OF-FILE                   VALUE 'N'.      00830077
008300         88  PS-END-OF-FILE                       VALUE 'Y'.      00840077
008400                                                                  00850035
008500 01  PC-CONSTANTS.                                                00860035
008600     05  PC-PROGRAM-NAME               PIC  X(08) VALUE           00870035
008700                                                 'ARKUT130'.      00880077
008800 01  PV-PROGRAM-VARIABLES.                                        00890035
008900     05  PV-CD031-READ-COUNT           PIC  9(07) VALUE ZEROES.   00900077
009000     05  PV-CD031-WRITE-COUNT          PIC  9(07) VALUE ZEROES.   00910077
009100     05  PV-INPUT-LENGTH               PIC  9(09).                00920056
009200                                                                  00930035
009300********                                                          00940059
009400******************************************************************00950062
009500* RECORD LAYOUT FOR SETTLEMENT ADJUSTMENT FILE- INPUT AND OUTPUT *00960062
009600******************************************************************00970062
009700     COPY ARRD130.                                                00980077
009800********                                                          00990059
009900******************************************************************01000035
010000* LAYOUT THAT DEFINES THE PARAMETERS NEEDED TO INVOKE PROTEGRITY *01010035
010100* MODULE                                                         *01020035
010200******************************************************************01030035
010300     COPY PTYCCSIP.                                               01040035
010400                                                                  01050035
010500******************************************************************01060035
010600* LAYOUT THAT DEFINES THE WORKING VARIABLES TO INVOKE PROTEGRITY *01070035
010700* MODULE                                                         *01080035
010800******************************************************************01090035
010900     COPY DPWS031.                                                01100052
011000                                                                  01110035
011100******************************************************************01120035
011200                                                                  01130035
011300 PROCEDURE DIVISION.                                              01140035
011400                                                                  01150035
011500 0000-MAINLINE-PARA.                                              01160035
011600                                                                  01170035
011700     PERFORM 1000-INITIALIZE.                                     01180035
011800                                                                  01190035
011900     PERFORM 2000-PROCESS-RECORDS                                 01200035
012000       UNTIL PS-END-OF-FILE.                                      01210077
012100                                                                  01220035
012200     PERFORM 9000-EOJ-ROUTINE.                                    01230035
012300                                                                  01240035
012400     STOP RUN.                                                    01250035
012500                                                                  01260035
012600******************************************************************01270035
012700* 1000-INITIALIZE                                                 01280035
012800*     INITIALIZE THE VARIABLES, OPEN THE INPUT AND OUTPUT FILES   01290035
012900*     AND READ THE INPUT FILE                                     01300035
013000******************************************************************01310035
013100 1000-INITIALIZE.                                                 01320035
013200                                                                  01330035
013300     DISPLAY 'PROGRAM - ' PC-PROGRAM-NAME.                        01340035
013400     INITIALIZE PV-PROGRAM-VARIABLES.                             01350035
013500     MOVE PC-PROGRAM-NAME               TO DP031-PROGRAM-NAME.    01360055
013600                                                                  01370035
013700     OPEN INPUT  CD031-INPUT-FILE                                 01380077
013800          OUTPUT CD031-TOKEN-FILE.                                01390077
013900                                                                  01400035
014000     PERFORM 2100-READ-CD031.                                     01410077
014100                                                                  01420035
014200******************************************************************01430035
014300* 2000-PROCESS-RECORDS                                            01440035
014400*   1. TOKENIZE THE FIELDS IN THE INPUT FILE                      01450062
014500*   2. WRITE THE RECORDS TO OUTPUT AND READ THE NEXT RECORD TO    01460035
014600*      PROCESS                                                    01470035
014700******************************************************************01480035
014800 2000-PROCESS-RECORDS.                                            01490035
014900                                                                  01500035
015000     IF AR130-DAT-CHD-NUM NOT = SPACES                            01510077
015100        MOVE ZEROES TO PV-INPUT-LENGTH                            01540074
015200        INSPECT FUNCTION REVERSE (AR130-DAT-CHD-NUM)              01550077
015300            TALLYING PV-INPUT-LENGTH FOR LEADING SPACES           01560074
015400        COMPUTE PV-INPUT-LENGTH =                                 01570074
015500            LENGTH OF AR130-DAT-CHD-NUM - PV-INPUT-LENGTH         01580077
018500        INITIALIZE DP031-PROTEG-PGM-PARAMETERS                    01581077
018500        MOVE AR130-DAT-CHD-NUM      TO DP031-CLEAR-TEXT           01582077
015600        PERFORM 2200-TOKENIZE-CHD-ACC-ID                          01590074
019500        MOVE DP031-CIPHER-TEXT      TO AR130-DAT-CHD-NUM          01591077
015700     END-IF.                                                      01600074
015700                                                                  01600177
015000     IF AR130-DAT-ENTERED-ACCT NOT = SPACES                       01601077
015100        MOVE ZEROES TO PV-INPUT-LENGTH                            01602077
015200        INSPECT FUNCTION REVERSE (AR130-DAT-ENTERED-ACCT)         01603077
015300            TALLYING PV-INPUT-LENGTH FOR LEADING SPACES           01604077
015400        COMPUTE PV-INPUT-LENGTH =                                 01605077
015500            LENGTH OF AR130-DAT-ENTERED-ACCT - PV-INPUT-LENGTH    01606077
018500        INITIALIZE DP031-PROTEG-PGM-PARAMETERS                    01606177
018500        MOVE AR130-DAT-ENTERED-ACCT  TO DP031-CLEAR-TEXT          01606277
015600        PERFORM 2200-TOKENIZE-CHD-ACC-ID                          01607077
019500        MOVE DP031-CIPHER-TEXT       TO AR130-DAT-ENTERED-ACCT    01607177
015700     END-IF.                                                      01608077
015700                                                                  01609077
015800     PERFORM 3000-WRITE-CD031.                                    01610077
015900     PERFORM 2100-READ-CD031.                                     01620077
016000                                                                  01630035
016100******************************************************************01640035
016200* 2100-READ-CD031                                                 01650077
016300*      READ THE RECORDS IN SETTLEMENT ADJUSTMENT FILE             01660035
016400******************************************************************01670035
016500 2100-READ-CD031.                                                 01680077
016600                                                                  01690035
016700     READ CD031-INPUT-FILE INTO AR130-RECORDS                     01700077
016800        AT END                                                    01710035
016900           SET PS-END-OF-FILE TO TRUE                             01720077
017000        NOT AT END                                                01730035
017100           ADD 1               TO PV-CD031-READ-COUNT             01740077
017200     END-READ.                                                    01750035
017300                                                                  01760035
017400******************************************************************01770035
017500* 2200-TOKENIZE-CHD-ACC-NBR                                       01780067
017600******************************************************************01790035
017700 2200-TOKENIZE-CHD-ACC-ID.                                        01800068
017800                                                                  01810035
017900     INITIALIZE CSI-PARAMETERS.                                   01820077
018100                                                                  01840044
018200     SET CSI-ENCRYPT-FUNCTION         TO TRUE.                    01850044
018300     SET DP031-ACCTNBR                TO TRUE.                    01860061
018400     MOVE 'AC-ACCT'                   TO DP031-FIELD.             01870059
018600     MOVE PV-INPUT-LENGTH             TO DP031-INPUT-LEN.         01890051
018700     PERFORM DP031-0000-PROTG-TOKEN-DETOKEN.                      01900052
018800                                                                  01910044
018900     IF CSI-RETURN-CODE NOT = ZERO                                01920044
019000        DISPLAY 'ABEND IN RECORD NUMBER - ' PV-CD031-READ-COUNT   01930077
019100        DISPLAY 'INPUT-LENGTH - ' PV-INPUT-LENGTH                 01940058
019200        PERFORM DP031-9999-ABEND                                  01950052
019300     END-IF.                                                      01960044
019400                                                                  01970077
019600                                                                  01990035
019700******************************************************************02000063
019800* 3000-WRITE-CD031                                                02010077
019900*      WRITE THE RECORDS TO OUTPUT                                02020035
020000******************************************************************02030035
020100 3000-WRITE-CD031.                                                02040077
020200                                                                  02050035
020300     WRITE CD031-TOKEN-RECORD FROM AR130-RECORDS.                 02060077
020400     ADD 1                   TO PV-CD031-WRITE-COUNT.             02070077
020500                                                                  02080035
020600******************************************************************02090035
020700* 9000-EOJ-ROUTINE                                                02100035
020800*      CLOSE THE INPUT AND OUTPUT FILES, DISPLAY THE MESSAGES     02110035
020900*      AND TERMINATE THE PROCESS.                                 02120035
021000******************************************************************02130035
021100 9000-EOJ-ROUTINE.                                                02140035
021200                                                                  02150035
021300     CLOSE CD031-INPUT-FILE                                       02160077
021400           CD031-TOKEN-FILE.                                      02170077
021500                                                                  02180035
021600     IF PV-CD031-READ-COUNT = 0                                   02190077
021700        DISPLAY 'INPUT SETTLEMENT ADJUSTMENT FILE IS EMPTY'       02200035
021800     END-IF.                                                      02210035
021900     DISPLAY 'SAF RECORDS READ   : ' PV-CD031-READ-COUNT.         02220077
022000     DISPLAY 'SAF RECORDS WRITTEN: ' PV-CD031-WRITE-COUNT.        02230077
022100                                                                  02240035
022200******************************************************************02250035
022300*      COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE   02260052
022400*      PROTEGRITY MODULE FOR TOKENIZATION                         02270035
022500******************************************************************02280035
022600      COPY DPPD031.                                               02290052
022700                                                                  02300035
022800******************************************************************02310035
