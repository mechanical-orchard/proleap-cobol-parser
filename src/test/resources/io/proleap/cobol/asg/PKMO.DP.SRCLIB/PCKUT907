000100 IDENTIFICATION DIVISION.                                                 
000200 TITLE 'FORMAT SE PURGE RECORDS FOR CHECKPOINT RESTART'.                  
000300                                                                          
000400 PROGRAM-ID.         PCKUT907.                                            
000500 AUTHOR.             DENNIS STEFFEN.                                      
000600 INSTALLATION.       KOHLS DEPARTMENT STORES.                             
000700 DATE-WRITTEN.       AUGUST 2005.                                         
000800 DATE-COMPILED.                                                           
000900 ENVIRONMENT DIVISION.                                                    
001000 CONFIGURATION SECTION.                                                   
001100                                                                          
001200 SOURCE-COMPUTER.    IBM-3090.                                            
001300 OBJECT-COMPUTER.    IBM-3090.                                            
001400                                                                          
001500 INPUT-OUTPUT SECTION.                                                    
001600 FILE-CONTROL.                                                            
001700                                                                          
001800     SELECT SE-PURGE-FILE                ASSIGN TO INP01.                 
001900                                                                          
002000 DATA DIVISION.                                                           
002100 FILE SECTION.                                                            
002200                                                                          
002300 FD  SE-PURGE-FILE                                                        
002400     LABEL RECORDS ARE STANDARD                                           
002500     RECORDING MODE IS F                                                  
002600     BLOCK CONTAINS 0 RECORDS                                             
002700     RECORD CONTAINS 022 CHARACTERS                                       
002800     DATA RECORD IS SE-PURGE-RECORD.                                      
002900 01  SE-PURGE-RECORD      PIC  X(022).                                    
003000                                                                          
003100*                                                                         
003200 WORKING-STORAGE SECTION.                                                 
003300                                                                          
003400 01  ABEND-CODE                  PIC S9(04)     VALUE +0  COMP.           
003500                                                                          
003600 01  PROGRAM-CONSTANTS.                                                   
003700     05  PC-PROGRAM-NAME         PIC X(08)      VALUE 'PCKUT907'.         
003800     05  PC-TRAN-PREP-FUNC-CODES.                                         
003900         10  PC-TRAN-PREP-FUNC-OPEN                                       
004000                                 PIC X(05)      VALUE 'OPEN '.            
004100         10  PC-TRAN-PREP-FUNC-WRITE                                      
004200                                 PIC X(05)      VALUE 'WRITE'.            
004300         10  PC-TRAN-PREP-FUNC-CLOSE                                      
004400                                 PIC X(05)      VALUE 'CLOSE'.            
004500     05  PC-TRANS-RECORD-LENGTH  PIC S9(04)     VALUE +100 COMP.          
004600     05  PV-JOB-NAME             PIC X(08)      VALUE SPACES.             
004700     05  PC-PLAN-NAME            PIC X(08)      VALUE 'PCKUP904'.         
004800                                                                          
004900 01  PROGRAM-VARIABLES.                                                   
005000     05  PV-CHECKPOINT-TYPE      PIC X(01)      VALUE SPACE.              
005100         88  CONTROL-BREAK                      VALUE 'C'.                
005200         88  LOGICAL-TRANSACTION                VALUE 'L'.                
005300         88  TIME-INTERVAL                      VALUE 'T'.                
005400         88  REQUESTED-BY-PROGRAM               VALUE 'R'.                
005500     05  PS-TRANS-EOF-SW     PIC X(01)          VALUE 'N'.                
005600         88  PS-TRANS-EOF                       VALUE 'Y'.                
005700     05  PV-SKIP-CLOSE-SW        PIC X(01)      VALUE 'N'.                
005800         88  SKIP-CLOSE                         VALUE 'Y'.                
005900     05  PV-CURRENT-DATE         PIC X(10).                               
006000                                                                          
006100*     INTRANSIT BALANCE PURGE EXTRACT                                     
006200     COPY PCRD900.                                                        
006300*                                                                         
006400*     TRANSACTION PREPARATION MODULE LINKAGE SECTION.                     
006500*                                                                         
260107     COPY DPWS990.                                                        
015700                                                                          
006600     COPY DPLS000.                                                        
006700                                                                          
006800     EXEC SQL                                                             
006900         INCLUDE SQLCA                                                    
007000     END-EXEC.                                                            
007100     COPY SQLCA2.                                                         
007200                                                                          
007300 PROCEDURE DIVISION.                                                      
007400******************************************************************        
007500* 0000-MAINLINE-PROCESSING                                       *        
007600*      CONTROLS FLOW OF THE PROGRAM.                             *        
007700******************************************************************        
007800 0000-MAINLINE-PROCESSING.                                                
007900                                                                          
008000     PERFORM 1000-INITIALIZE.                                             
008100     PERFORM 2000-PROCESS UNTIL PS-TRANS-EOF                              
008200     PERFORM 9000-EOJ.                                                    
008300                                                                          
008400     GOBACK.                                                              
008500                                                                          
008600 1000-INITIALIZE.                                                         
008700                                                                          
008800     OPEN INPUT SE-PURGE-FILE.                                            
008900                                                                          
009000     ACCEPT PV-JOB-NAME FROM SYSIN.                                       
009100                                                                          
009200     EXEC SQL                                                             
009300          SET :PV-CURRENT-DATE = CURRENT DATE                             
009400     END-EXEC.                                                            
009500                                                                          
009600     PERFORM 8000-READ-ASN-TRANS-FILE.                                    
009700                                                                          
009800     PERFORM 1100-ISSUE-OPEN-REQUEST.                                     
009900                                                                          
010000 1100-ISSUE-OPEN-REQUEST.                                                 
010100                                                                          
010200     MOVE PC-TRAN-PREP-FUNC-OPEN      TO DP000-FUNC-CODE.                 
010300     MOVE PV-JOB-NAME                 TO DP000-JOB-NAME.                  
010400     MOVE PC-PLAN-NAME                TO DP000-PLAN-NAME.                 
010500     PERFORM Z900-CALL-TRANS-PREP-MODULE.                                 
010600     MOVE DP000-CKPT-TYPE-CODE        TO PV-CHECKPOINT-TYPE.              
010700                                                                          
010800 2000-PROCESS.                                                            
010900     PERFORM 2100-MOVE-TRANS-DATA                                         
011000                                                                          
011100     PERFORM 8000-READ-ASN-TRANS-FILE.                                    
011200                                                                          
011300 2100-MOVE-TRANS-DATA.                                                    
011400                                                                          
011500     MOVE LENGTH OF PC900-EXTRACT-RECORD                                  
011600                                      TO DP000-TRANS-REC-LENGTH.          
011700                                                                          
011800     MOVE PC900-EXTRACT-RECORD        TO DP000-TRANS-REC.                 
011900                                                                          
012000     MOVE PC-TRAN-PREP-FUNC-WRITE     TO DP000-FUNC-CODE.                 
012100     MOVE PV-JOB-NAME                 TO DP000-JOB-NAME.                  
012200     MOVE PC-PLAN-NAME                TO DP000-PLAN-NAME.                 
012300                                                                          
012400     PERFORM Z900-CALL-TRANS-PREP-MODULE.                                 
012500                                                                          
012600 8000-READ-ASN-TRANS-FILE.                                                
012700                                                                          
012800     READ SE-PURGE-FILE INTO  PC900-EXTRACT-RECORD                        
012900         AT END                                                           
013000           SET PS-TRANS-EOF           TO TRUE                             
013100     END-READ.                                                            
013200                                                                          
013300 9000-EOJ.                                                                
013400     CLOSE SE-PURGE-FILE.                                                 
013500                                                                          
013600     IF SKIP-CLOSE                                                        
013700        NEXT SENTENCE                                                     
013800     ELSE                                                                 
013900        PERFORM 9100-ISSUE-CLOSE-REQUEST                                  
014000     END-IF.                                                              
014100                                                                          
014200 9100-ISSUE-CLOSE-REQUEST.                                                
014300                                                                          
014400     MOVE PC-TRAN-PREP-FUNC-CLOSE TO DP000-FUNC-CODE.                     
014500     MOVE PV-JOB-NAME TO DP000-JOB-NAME.                                  
014600     MOVE PC-PLAN-NAME TO DP000-PLAN-NAME.                                
014700                                                                          
014800     PERFORM Z900-CALL-TRANS-PREP-MODULE.                                 
014900                                                                          
015000     COPY DPPD000.                                                        
015100*                                                                         
015200*     TRANSACTION PREPARATION MODULE CALL AND ERROR ROUTINES.             
015300*                                                                         
