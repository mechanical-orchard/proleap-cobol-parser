00001 *-----------------------*                                                 
00002  IDENTIFICATION DIVISION.                                                 
00003 *-----------------------*                                                 
00004  PROGRAM-ID.    INKCS036.                                                 
00005  AUTHOR.        JOHN SELWITSCHKA.                                         
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
00007  DATE-WRITTEN.  JUNE 2006.                                                
00008  DATE-COMPILED.                                                           
00009                                                                           
      *---------------------------------------------------------------*         
      *    I036 - INVENTORY COUNT STATUS                                        
      *                                                                         
      *    THIS PROGRAM PROVIDES A SCREEN WHICH DISPLAYS THE STATUS             
      *    OF ALL INVENTORY CYCLES ON A SPECIFIC DATE. THE SCREEN               
      *    INCLUDES THE IP ADDRESSES SO PERSONNEL FROM INFORMATION              
      *    SERVICES, INVENTORY CONTROL OR OPERATIONS, CAN VIEW THE              
      *    NETWORK SETTINGS FOR EACH LOCATION TAKING INVENTORY ON A             
      *    SPECIFIC DATE.                                                       
      *                                                                         
      *----------------------------------------------------------------*        
      *  W28545  06-14-2006  NEW PROGRAM                               *        
      *     - JOHN SELWITSCHKA                                         *        
      *  W28545  06-21-2006  REMOVE DB2TDBA.TINVLAP IS SQL CALL        *        
      *     - SCOTT JACKSON                                            *        
P14210*  PITS PM01014210                                               *        
P14210*          04-30-2007  ONLY DISPLAY STORES THAT ARE IN AN        *        
P14210*                      ACTIVE INVENTORY CYCLE, AND DO NOT                 
P14210*                      DISPLAY ESTIMATED STORES                           
P14210*                      ALSO CLEAN UP TABLE DISPLAY IF DATE                
P14210*                      ENTERED ON SCREEN DOESN'T HAVE ANY                 
P14210*                      STORES TO LIST COMPARED WITH A PREVIOUS            
P14210*                      ENTERED DATE                                       
P14210*     - RONNA MCDONALD                                           *        
      *  W33304  05-01-2008  HOLDING INVENTORY LEDGER OPEN ACROSS               
      *                      PERIODS INVENTORY SHORTAGE REPORTING               
      *     -JILL LIN                                                           
59430 * PRB59430 06-02-2016  ADDED CHANGES TO EXCLUDE CANCELLED STORE           
59430 *                      FROM DISPLAYING IN CICS SCREEN.                    
59430 *     -COGNIZANT                                                          
      * CHG0167028                                                              
      *          04-18-2017  ADDED CHANGES TO CHANGE IP ADDRESS FROM            
      *                      .053 TO .220                                       
      *     -COGNIZANT                                                          
1122RM* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188                 
1122RM* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING         
1122RM* THE CICS ARCHITECTURE API.                                              
0523RM* CHANGED 05/03/2023    BY BOB MCASEY      WR:                            
0523RM* REMOVED THE SUBNET MASK, IP ADDRESS AND GATEWAY ADDRESS FIELDS          
      *                                                                         
RONNA * CHANGED 05/25/2023    BY RONNA MCDONALD  WR: CHG0288464                 
RONNA *                      MODIFY CURSOR SO THAT THE 'FI' RECORDS             
RONNA *                      THAT GET INSERTED BY INK967 GET                    
RONNA *                      INCLUDED IN THE CURSOR                             
RONNA *                                                                         
      *----------------------------------------------------------------*        
      ******************************************************************        
00013  EJECT                                                                    
00014  ENVIRONMENT DIVISION.                                                    
00015                                                                           
00016  DATA DIVISION.                                                           
00017                                                                           
00018  WORKING-STORAGE SECTION.                                                 
00019                                                                           
00020  01  PC-PROGRAM-CONSTANTS.                                                
00021      05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE                 
00022                                                     'IN036A  '.           
00023      05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE                 
00024                                                     'INKM036 '.           
00025      05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE                 
00026                                                     'INKCS036'.           
00027      05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.              
00028      05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.              
00029      05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.            
00030      05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15             
00031                                                     COMP SYNC.            
00032      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2              
00033                                                     COMP SYNC.            
00034      05  PC-MAX-ITEMS                   PIC S9(09)  VALUE                 
00035                                                     +1000000              
00036                                                     COMP-3.               
00037      05  PC-ITEM-NUMBER-LENGTH          PIC S9(04)  VALUE +5              
00038                                                     COMP SYNC.            
00046      05  PC-EMPTY-8                     PIC  X(10)  VALUE                 
00047                                                     '09-09-99'.           
           05  PC-CALENDAR-ROUTINE            PIC  X(08) VALUE                  
                                                          'DPKUT500'.           
           05  PC-INV-IP-ADDR                 PIC X(04) VALUE '.220'.           
           05  PC-GATEWAY-ADDR                PIC X(04) VALUE '.254'.           
00048                                                                           
00049      05  PC-TSYMSG-NUMBERS.                                               
00050          10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.          
00050          10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.          
00051          10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.          
00052          10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.          
00053          10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.          
00054          10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.          
00055          10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.          
00056          10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.          
00057          10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.          
00058          10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.          
00059          10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.          
00060          10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.          
00061          10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.          
00061          10  PC-TSYMSG-00115            PIC  9(05)  VALUE 00115.          
00062          10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.          
00063          10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.          
00063          10  PC-TSYMSG-99904            PIC  9(05)  VALUE 99904.          
00064                                                                           
00065  01  PS-PROGRAM-SWITCHES.                                                 
00066      05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.            
00067          88  PS-NO-ERROR                            VALUE 'Y'.            
00068          88  PS-ERROR                               VALUE 'N'.            
00069      05  PS-START-ITEM-ERROR-SW         PIC  X(01)  VALUE 'Y'.            
00070          88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.            
00071          88  PS-START-ITEM-ERROR                    VALUE 'N'.            
00072      05  PS-TPHYUNT-SW                  PIC  X(01)  VALUE 'N'.            
00073          88  PS-TPHYUNT-FOUND                       VALUE 'Y'.            
00074          88  PS-TPHYUNT-NOT-FOUND                   VALUE 'N'.            
00075                                                                           
00076  01  PV-PROGRAM-VARIABLES.                                                
00077      05  PV-SUB                         PIC S9(04)  VALUE +0              
00078                                                     COMP SYNC.            
00079      05  PV-REMAINDER                   PIC S9(04)  VALUE +0              
00080                                                     COMP SYNC.            
00079      05  PV-LOC-CNT                     PIC S9(04)  VALUE +0              
00080                                                     COMP SYNC.            
00081      05  PV-READ-COUNT                  PIC S9(09)  VALUE +0              
00082                                                     COMP-3.               
00083      05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0              
00084                                                     COMP-3.               
00085      05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0              
00086                                                     COMP-3.               
00087      05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0              
00088                                                     COMP-3.               
00089      05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0              
00090                                                     COMP-3.               
00091      05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0              
00092                                                     COMP-3.               
00093      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0              
00094                                                     COMP-3.               
00095      05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0              
00096                                                     COMP SYNC.            
00097      05  PV-CICS-RESP                   PIC S9(04)  VALUE +0              
00098                                                     COMP SYNC.            
00099      05  PV-ITEM                        PIC S9(04)  VALUE +0              
00100                                                     COMP SYNC.            
00105      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0              
00106                                                     COMP SYNC.            
00107      05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0              
00108                                                     COMP SYNC.            
00109      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0              
00110                                                     COMP SYNC.            
00111      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
00112                                                     COMP SYNC.            
00113      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
00114                                                     COMP SYNC.            
00115      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0              
00116                                                     COMP SYNC.            
00117      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0              
00118                                                     COMP SYNC.            
00119      05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0              
00120                                                     COMP SYNC.            
00121      05  PV-MAX-INV-ID                  PIC S9(09)  VALUE +0              
00122                                                     COMP-3.               
00121      05  PV-MAX-INV-ID-NULL-IND         PIC S9(04)  VALUE +0              
00122                                                     COMP SYNC.            
00121      05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0              
00122                                                     COMP SYNC.            
00123      05  PV-SUM-ITM-EXTD-AMT            PIC S9(7)V99                      
00124                                                     COMP-3.               
00125      05  PV-ISO-DATE.                                                     
00126          10  PV-ISO-CCYY                PIC X(04)  VALUE SPACES.          
00128          10  FILLER                     PIC X(01)  VALUE '-'.             
00129          10  PV-ISO-MM                  PIC X(02)  VALUE SPACES.          
00130          10  FILLER                     PIC X(01)  VALUE '-'.             
00131          10  PV-ISO-DD                  PIC X(02)  VALUE SPACES.          
00132      05  PV-CONVERT-DATE.                                                 
00133          10  PV-CONVERT-MM              PIC X(02)  VALUE SPACES.          
00134          10  PV-DASH1                   PIC X(01)  VALUE '-'.             
00135          10  PV-CONVERT-DD              PIC X(02)  VALUE SPACES.          
00136          10  PV-DASH2                   PIC X(01)  VALUE '-'.             
00137          10  PV-CONVERT-CCYY            PIC X(04)  VALUE SPACES.          
           05  PV-EDIT-ADDRESS.                                                 
               10  PV-EDIT-IP-ADDR            PIC X(11)  VALUE SPACES.          
               10  PV-EDIT-4TH-OCT            PIC X(04)  VALUE SPACES.          
00161                                                                           
00162      EJECT                                                                
00171 *---------------------------------------------------------------*         
00172 *    MAP LAYOUT                                                 *         
00173 *---------------------------------------------------------------*         
00174                                                                           
00175      COPY INKM036.                                                        
00176 *                                                                         
00177  01  MR-OCCURS-LAYOUT                   REDEFINES  IN036AO.               
00178      05  FILLER                         PIC X(27).                        
00179      05  MR-SCROLL-AREA                 OCCURS 15 TIMES.                  
00192          10  MR-LOC-NBRL                PIC S9(04) COMP.                  
00193          10  MR-LOC-NBRA                PIC  X(01).                       
00194          10  MR-LOC-NBRC                PIC  X(01).                       
00195          10  MR-LOC-NBRH                PIC  X(01).                       
00196          10  MR-LOC-NBR-X.                                                
                   15  MR-LOC-NBR             PIC  9(04).                       
00198                                                                           
00199          10  MR-LOC-NAMEL               PIC S9(04) COMP.                  
00200          10  MR-LOC-NAMEA               PIC  X(01).                       
00201          10  MR-LOC-NAMEC               PIC  X(01).                       
00202          10  MR-LOC-NAMEH               PIC  X(01).                       
00203          10  MR-LOC-NAME                PIC  X(11).                       
                                                                                
00205          10  MR-CPLDL                   PIC S9(04) COMP.                  
00206          10  MR-CPLDA                   PIC  X(01).                       
00207          10  MR-CPLDC                   PIC  X(01).                       
00208          10  MR-CPLDH                   PIC  X(01).                       
00209          10  MR-CPLD                    PIC  X(05).                       
00210                                                                           
00211          10  MR-INV-STATL               PIC S9(04) COMP.                  
00212          10  MR-INV-STATA               PIC  X(01).                       
00213          10  MR-INV-STATC               PIC  X(01).                       
00214          10  MR-INV-STATH               PIC  X(01).                       
00215          10  MR-INV-STAT                PIC  X(20).                       
00216                                                                           
00222                                                                           
00235                                                                           
00236      EJECT                                                                
00237 *---------------------------------------------------------------*         
00238 *    ATTRIBUTE SETTINGS COPYBOOK.                               *         
00239 *---------------------------------------------------------------*         
00240                                                                           
00241      COPY DPWS015.                                                        
00242                                                                           
00243 *---------------------------------------------------------------*         
00244 *    FUNCTION KEYS COPYBOOK.                                    *         
00245 *---------------------------------------------------------------*         
00246                                                                           
00247      COPY DPWS016.                                                        
00248                                                                           
00249 *---------------------------------------------------------------*         
00250 *    NUMERIC EDIT LAYOUT.                                       *         
00251 *---------------------------------------------------------------*         
00252                                                                           
00253      COPY DPWS010I.                                                       
00254  EJECT                                                                    
00255 *---------------------------------------------------------------*         
00256 *    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   *         
00257 *---------------------------------------------------------------*         
00258                                                                           
00259      COPY DPWS030.                                                        
1122RM     COPY DPWS930.                                                        
00260  EJECT                                                                    
      *---------------------------------------------------------------*         
      *    COPY BOOK FOR CALENDAR SUBROUTINE (DPKUT500)                         
      *---------------------------------------------------------------*         
                                                                                
           COPY DPWS500.                                                        
                                                                                
00261 *---------------------------------------------------------------*         
00262 *    STANDARD COMMAREA.                                         *         
00263 *---------------------------------------------------------------*         
00264                                                                           
00265      COPY DPWS020.                                                        
00266      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
00267                                                                           
00268 *---------------------------------------------------------------*         
00269 *  THIS IS THE INTER-APPLICATION COMMAREA FOR THE PHYSICAL      *         
00270 *  INVENTORY SCREENS.                                           *         
00271 *---------------------------------------------------------------*         
00272                                                                           
00273          10  INTER-APPL-COMM-AREA       PIC X(200).                       
00275 *---------------------------------------------------------------*         
00276 *  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   *         
00277 *---------------------------------------------------------------*         
00278          10  ASC-SPECIFIC-COMMAREA.                                       
                   15  ASC-PLND-INV-DATE                   PIC  X(10).          
00288              15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                        
00289                  20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).          
00290                      88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.           
00291                      88  ASC-BLOCK-MODIFIED          VALUE 'Y'.           
00292                                                                           
00293                  20  ASC-ITEM-ARRAY.                                      
00294                      25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.                
00295                          30  ASC-LIST-ITEM-NUMBER                         
00296                                                      PIC S9(09)           
00297                                                      COMP-3.              
                               30  ASC-LOC-NBR             PIC  9(05).          
00314                          30  ASC-LOC-NAME            PIC  X(20).          
00315                          30  ASC-CPLD                PIC  X(05).          
00316                          30  ASC-INV-STAT            PIC  X(20).          
0523RM                         30  FILLER                  PIC  X(30).          
00320                                                                           
                   15  ASC-CURRENT-DATE                    PIC X(10).           
00321              15  ASC-BLK-SUB                         PIC S9(04)           
00322                                                           COMP            
00323                                                           SYNC.           
00324              15  ASC-ITEM-SUB                        PIC S9(04)           
00325                                                           COMP            
00326                                                           SYNC.           
00327              15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)           
00328                                                           COMP-3.         
00331              15  ASC-ITEMS-DISPLAYED                 PIC S9(03)           
00332                                                           COMP-3.         
00333              15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)           
00334                                                           COMP-3.         
00335              15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)           
00336                                                           COMP-3.         
00337              15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)           
00338                                                           COMP            
00339                                                           SYNC.           
00344              15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).          
00345                  88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.           
00346                  88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.           
00350              15  ASC-LIST-QUEUE-NAME.                                     
00351                  20  ASC-LIST-TERM-ID                PIC  X(04).          
00352                  20  ASC-LIST-TASK-NUMBER            PIC S9(05)           
00353                                                           COMP-3.         
00354                  20  ASC-LIST-SEQ                    PIC  9(01).          
00360                                                                           
00363      EJECT                                                                
00364 *---------------------------------------------------------------*         
00365 *    ABEND PROCESSING COPYBOOK.                                 *         
00366 *---------------------------------------------------------------*         
00367                                                                           
00368      COPY DPWS013.                                                        
00369                                                                           
00370  EJECT                                                                    
00371 *---------------------------------------------------------------*         
00372 *    DB2 AREA FOR INVENTORY LAPTOP TABLE                                  
00373 *---------------------------------------------------------------*         
00374      EXEC SQL                                                             
                INCLUDE TINVLAP                                                 
00376      END-EXEC.                                                            
00377 *---------------------------------------------------------------*         
00378 *    DB2 AREA FOR INVENTORY PARAMETERS TABLE                              
00379 *---------------------------------------------------------------*         
00380      EXEC SQL                                                             
00381           INCLUDE TINVPAR                                                 
00382      END-EXEC.                                                            
W33304*---------------------------------------------------------------*         
W33304*    DB2 AREA FOR INVENTORY CONTROL TABLE                                 
W33304*---------------------------------------------------------------*         
W33304     EXEC SQL                                                             
W33304          INCLUDE TINCNTL                                                 
W33304     END-EXEC.                                                            
00377 *---------------------------------------------------------------*         
00378 *    DB2 AREA FOR INVENTORY PARAMETERS STATUS TABLE                       
00379 *---------------------------------------------------------------*         
00380      EXEC SQL                                                             
00381           INCLUDE INT00001                                                
00382      END-EXEC.                                                            
                                                                                
00377 *---------------------------------------------------------------*         
00378 *    DB2 AREA FOR LOCATION TABLE                                          
00379 *---------------------------------------------------------------*         
00380      EXEC SQL                                                             
00381           INCLUDE XMT00001                                                
00382      END-EXEC.                                                            
                                                                                
                                                                                
00383 *---------------------------------------------------------------*         
00384 *    DB2 AREA FOR COMMUNICATIONS                                *         
00385 *---------------------------------------------------------------*         
00386      EXEC SQL                                                             
00387           INCLUDE SQLCA                                                   
00388      END-EXEC.                                                            
00389                                                                           
00390                                                                           
00391 *---------------------------------------------------------------*         
00392 *    INVENTORY CYCLE CURSOR                                               
00394 *---------------------------------------------------------------*         
00395                                                                           
00396      EXEC SQL                                                             
00397          DECLARE  INV_COUNT_CSR CURSOR FOR                                
               SELECT   B.JOB_NM                                                
                       ,B.LOC_NBR                                               
                       ,VALUE(A.LPTP_NBR, '  ')                                 
W33304                 ,VALUE(A.INV_STAT_CDE, '  ')                             
                       ,VALUE(A.LPTP_EXT_AMT, 0)                                
                       ,VALUE(A.LPTP_QTY, 0)                                    
                       ,VALUE(A.STR_TRSM_IND, ' ')                              
                       ,B.PHY_CNT_TMST                                          
P14210         FROM     TINCNTL C                    LEFT OUTER JOIN            
P14210                  TINVPAR B ON C.INV_ID = B.INV_ID                        
P14210                                               LEFT OUTER JOIN            
P14210*        FROM     TINVPAR B LEFT OUTER JOIN                               
                        TINVLAP A ON B.LOC_NBR = A.LOC_NBR                      
P14210                           AND B.INV_ID = A.INV_ID                        
               WHERE    B.PLND_INV_DTE = :INVPAR-PLND-INV-DTE                   
W33304           AND    B.SCHD_PHY_CNT_CDE = 'PI'                               
P14210           AND    B.SCAN_INV_IND     = 'Y'                                
                 AND   (A.LPTP_NBR     = 'ST'                                   
                     OR 0 = (SELECT COUNT(*)                                    
                             FROM   TINVLAP D                                   
P14210*                      WHERE  D.LOC_NBR = B.LOC_NBR))                     
P14210                       WHERE  D.LOC_NBR = B.LOC_NBR                       
P14210                         AND  D.INV_ID  = B.INV_ID))                      
59430                AND LOC_INV_STAT_CDE <> 'DB'                               
RONNA                                                                           
RONNA          UNION                                                            
RONNA                                                                           
RONNA          SELECT   B.JOB_NM                                                
RONNA                  ,B.LOC_NBR                                               
RONNA                  ,VALUE(A.LPTP_NBR, '  ')                                 
RONNA                  ,VALUE(A.INV_STAT_CDE, '  ')                             
RONNA                  ,VALUE(A.LPTP_EXT_AMT, 0)                                
RONNA                  ,VALUE(A.LPTP_QTY, 0)                                    
RONNA                  ,VALUE(A.STR_TRSM_IND, ' ')                              
RONNA                  ,B.PHY_CNT_TMST                                          
RONNA          FROM     TINCNTL C                    LEFT OUTER JOIN            
RONNA                   TINVPAR B ON C.INV_ID = B.INV_ID                        
RONNA                                                LEFT OUTER JOIN            
RONNA                   TINVLAP A ON B.LOC_NBR = A.LOC_NBR                      
RONNA                            AND B.INV_ID = A.INV_ID                        
RONNA          WHERE    B.PLND_INV_DTE = :INVPAR-PLND-INV-DTE                   
RONNA            AND    B.SCHD_PHY_CNT_CDE = 'PI'                               
RONNA            AND    B.SCAN_INV_IND     = 'Y'                                
RONNA**          TO INCLUDE FI RECORDS WITH 0 QTY AND EXT AMT                   
RONNA            AND   (A.LPTP_NBR     = 'FI'                                   
RONNA            AND    A.LPTP_QTY = 0                                          
RONNA            AND    A.LPTP_EXT_AMT = 0                                      
RONNA            AND    A.INV_ID = B.INV_ID)                                    
RONNA                                                                           
59430            AND LOC_INV_STAT_CDE <> 'DB'                                   
RONNA          ORDER BY 2                                                       
RONNA                  ,4  DESC                                                 
               WITH UR                                                          
00412      END-EXEC.                                                            
00413                                                                           
00430                                                                           
00431  EJECT                                                                    
00432  LINKAGE SECTION.                                                         
00433                                                                           
00434  01  DFHCOMMAREA.                                                         
00435      05  FILLER                         OCCURS  1 TO 4072 TIMES           
00436                                         DEPENDING ON EIBCALEN.            
00437          10  FILLER                     PIC X.                            
00438                                                                           
00439  EJECT                                                                    
00440  PROCEDURE DIVISION.                                                      
00441 ******************************************************************        
00442 **  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **        
00443 **  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **        
00444 **  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **        
00445 ******************************************************************        
00446  0000-MAIN-MODULE.                                                        
00447      INITIALIZE DP030-CICS-API-FIELDS.                                    
00448      MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
00449      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
00450      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
00451      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
00452      MOVE LENGTH OF IN036AI        TO DP030-MAP-LENGTH (1).               
00453      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
00454      PERFORM 0001-CALL-CICS-ARCH-API.                                     
00455                                                                           
00456      PERFORM 1000-CONTROL-PROCESSING                                      
00457                                                                           
00458      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
00459      PERFORM 0001-CALL-CICS-ARCH-API.                                     
00460                                                                           
00461 ******************************************************************        
00462 **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **        
00463 **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **        
00464 ******************************************************************        
00465  0001-CALL-CICS-ARCH-API.                                                 
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                                       
1122RM     CALL DP930-CICS-ARCH-API                                             
1122RM                     USING DFHEIBLK                                       
00467                            DFHCOMMAREA                                    
00468                            DP030-CICS-API-FIELDS                          
00469                            DP020-STANDARD-COMMAREA                        
00470                            IN036AI.                                       
00471                                                                           
00472      IF  DP030-RC-CALL-SUCCESSFUL                                         
00473          CONTINUE                                                         
00474      ELSE                                                                 
00475          SET DP013-NO-ROLLBACK                                            
00476              DP013-XCTL-DISPLAY-RESTART                                   
00477              DP013-CICS-ABEND      TO TRUE                                
00478          MOVE '0001-CALL-CICS-ARCH-API'                                   
00479                                    TO DP013-PARAGRAPH                     
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX        
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)              
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
00482          MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)              
00483          PERFORM DP013-0000-PROCESS-ABEND                                 
00484      END-IF.                                                              
00485 *----------------------------------------------------------------*        
00486 * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *        
00487 * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *        
00488 *                                                                *        
00489 * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *        
00490 *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *        
00491 *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *        
00492 *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *        
00493 *----------------------------------------------------------------*        
00494                                                                           
00495  1000-CONTROL-PROCESSING.                                                 
00496                                                                           
00497      EVALUATE TRUE                                                        
00498          WHEN DP020-NEXT-ACT-INITIAL                                      
00499              INITIALIZE ASC-SPECIFIC-COMMAREA                             
00500              MOVE EIBTRMID         TO ASC-LIST-TERM-ID                    
00502              MOVE DP020-SRC-TASK-NUMBER                                   
00503                                    TO ASC-LIST-TASK-NUMBER                
00505              MOVE PC-LIST-QUEUE-SEQ                                       
00506                                    TO ASC-LIST-SEQ                        
                   PERFORM 1100-GET-CURRENT-DATE                                
00509              PERFORM 4000-BUILD-INITIAL-PANEL                             
00510                                                                           
00511          WHEN DP020-NEXT-ACT-READ-MAP                                     
00512              MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
00513                                    TO PV-TOP-ITEM                         
00514              PERFORM 2000-PROCESS-PANEL                                   
00515                                                                           
00516          WHEN DP020-NEXT-ACT-RETURN                                       
                   CONTINUE                                                     
00523                                                                           
00524          WHEN OTHER                                                       
00525              SET DP013-LOGIC-ABEND TO TRUE                                
00526              SET DP013-NO-ROLLBACK TO TRUE                                
00527              MOVE '1000-CONTROL-PROCESSING'                               
00528                                    TO DP013-PARAGRAPH                     
00529              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'            
00530                                    TO DP013-MESSAGE-TEXT(1)               
00531              PERFORM DP013-0000-PROCESS-ABEND                             
00532      END-EVALUATE.                                                        
00533                                                                           
00534  EJECT                                                                    
00535 *----------------------------------------------------------------*        
00536 * GET THE CURRENT DATE ON THE FIRST TIME INTO THE PROGRAM        *        
00538 *----------------------------------------------------------------*        
00539                                                                           
00540  1100-GET-CURRENT-DATE.                                                   
00541                                                                           
           EXEC SQL                                                             
               SET :ASC-CURRENT-DATE = CURRENT DATE                             
           END-EXEC.                                                            
                                                                                
           MOVE ASC-CURRENT-DATE    TO INVPAR-PLND-INV-DTE                      
                                       ASC-PLND-INV-DATE                        
                                       AINDT01O.                                
00560                                                                           
00561  EJECT                                                                    
00562 *----------------------------------------------------------------*        
00563 * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *        
00564 * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *        
00565 * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *        
00566 * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *        
00567 * FUNCTION KEYS CAN GET THIS FAR.                                *        
00568 *----------------------------------------------------------------*        
00569                                                                           
00570  2000-PROCESS-PANEL.                                                      
00571      EVALUATE TRUE                                                        
00572          WHEN DP020-SRC-AID = DP016-CLEAR                                 
00573              MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL            
00574              PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
00575              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
00576                                                                           
00577          WHEN DP020-FK-REFRESH (DP020-SRC-AID)                            
00578              PERFORM 2050-DELETE-LIST-QUEUE                               
00579              PERFORM 4000-BUILD-INITIAL-PANEL                             
00580                                                                           
00591          WHEN OTHER                                                       
00592              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
00593              PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
00594              IF  PS-NO-ERROR                                              
00595                  SET DP030-CONTINUE-GO TO TRUE                            
00596                  PERFORM 2100-CHECK-FUNCTION-KEY                          
00597              ELSE                                                         
00598                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
00599                  SET DP030-OVERRIDE-GO TO TRUE                            
00600              END-IF                                                       
00601      END-EVALUATE.                                                        
00602  EJECT                                                                    
00603 *----------------------------------------------------------------*        
00604 *  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *        
00605 *----------------------------------------------------------------*        
00606  2050-DELETE-LIST-QUEUE.                                                  
00607                                                                           
00608      EXEC CICS                                                            
00609          DELETEQ TS                                                       
00610              QUEUE (ASC-LIST-QUEUE-NAME)                                  
00611              RESP  (PV-CICS-RESP)                                         
00612      END-EXEC.                                                            
00613                                                                           
00614      IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                               
00615         (PV-CICS-RESP = DFHRESP(QIDERR))                                  
00616          CONTINUE                                                         
00617      ELSE                                                                 
00618          SET DP013-CICS-ABEND      TO TRUE                                
00619          SET DP013-NO-ROLLBACK     TO TRUE                                
00620                                                                           
00621          MOVE '2050-DELETE-LIST-QUEUE'                                    
00622                                    TO DP013-PARAGRAPH                     
00623          MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'            
00624                                    TO DP013-MESSAGE-TEXT (1)              
00625          PERFORM DP013-0000-PROCESS-ABEND                                 
00626      END-IF.                                                              
00627                                                                           
00628      MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.          
00629  EJECT                                                                    
00630 *----------------------------------------------------------------*        
00631 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*        
00632 * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *        
00633 * CICS ARCHITECTURE API.                                         *        
00634 *----------------------------------------------------------------*        
00635  2100-CHECK-FUNCTION-KEY.                                                 
00636      EVALUATE TRUE                                                        
00637          WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                          
                   CONTINUE                                                     
00655                                                                           
               WHEN DP020-FK-LOCAL-FUNC-12 (DP020-SRC-AID)                      
00648 *            ---- A LIST ITEM MUST BE SELECTED ----                       
00649              MOVE PC-TSYMSG-99904  TO DP020-MSG-NUMBER                    
00651              SET DP020-MSG-WARNING TO TRUE                                
                                                                                
00656          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                          
00657              MOVE +1               TO PV-TOP-ITEM                         
00658              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
00659                                                                           
00660          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                           
00661              PERFORM 2110-BROWSE-BACKWARD                                 
00662              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
                   PERFORM 3200-RESET-ATTRIBUTES                                
00663                                                                           
00664          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                           
00665              PERFORM 2120-BROWSE-FORWARD                                  
00666              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
00667                                                                           
00668          WHEN DP020-SRC-AID = DP016-ENTER                                 
                   IF  AINDT01L > ZERO                                          
                       PERFORM 2050-DELETE-LIST-QUEUE                           
                       PERFORM 4000-BUILD-INITIAL-PANEL                         
                   END-IF                                                       
00671                                                                           
00672          WHEN OTHER                                                       
00673              SET DP013-NO-ROLLBACK                                        
00674                  DP013-XCTL-DISPLAY-RESTART                               
00675                  DP013-CICS-ABEND  TO TRUE                                
00676              MOVE '2100-CHECK-FUNCTION-KEY'                               
00677                                    TO DP013-PARAGRAPH                     
00678              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
00679                                    TO DP013-MESSAGE-TEXT (1)              
00680              PERFORM DP013-0000-PROCESS-ABEND                             
00681      END-EVALUATE.                                                        
00682                                                                           
00683                                                                           
00688 *----------------------------------------------------------------*        
00689 *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *        
00690 *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *        
00691 *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *        
00692 *    MESSAGE.                                                    *        
00693 *----------------------------------------------------------------*        
00694                                                                           
00695  2110-BROWSE-BACKWARD.                                                    
00696      SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL            
00697          GIVING PV-TOP-ITEM.                                              
00698                                                                           
00699      IF  ((PV-TOP-ITEM < +1)                                              
00700        OR (PV-TOP-ITEM = +1))                                             
00701          MOVE +1                   TO PV-TOP-ITEM                         
00702 *        --- TOP OF LIST --                                               
00703          MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER                    
00704          SET DP020-MSG-INFORMATIONAL TO TRUE                              
00705      END-IF.                                                              
00706                                                                           
00707  EJECT                                                                    
00708 *----------------------------------------------------------------*        
00709 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *        
00710 *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *        
00711 *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *        
00712 *----------------------------------------------------------------*        
00713                                                                           
00714  2120-BROWSE-FORWARD.                                                     
00715                                                                           
00716      ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                      
00717          GIVING PV-TOP-ITEM.                                              
00718      IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                           
00719          MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
00720                                    TO PV-TOP-ITEM                         
00721 *        -- BOTTOM OF LIST --                                             
00722          MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER                    
00723          SET DP020-MSG-INFORMATIONAL                                      
00724                                    TO TRUE                                
00725      ELSE                                                                 
00726          COMPUTE PV-BOTTOM-ITEM =                                         
00727              PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                         
00728          IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ                    
00729 *            -- BOTTOM OF LIST --                                         
00730              MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER                    
00731              SET DP020-MSG-INFORMATIONAL                                  
00732                                    TO TRUE                                
00733          END-IF                                                           
00734      END-IF.                                                              
00735  EJECT                                                                    
01028 ******************************************************************        
01029 ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **        
01030 ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **        
01031 ******************************************************************        
01032  2200-MOVE-SCREEN-TO-COMMAREA.                                            
01033                                                                           
01034      MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.                     
01035      MOVE +1                       TO PV-SUB.                             
01046                                                                           
01048      PERFORM 3100-SET-SUBSCRIPTS.                                         
01049      IF  AINDT01L > ZERO                                                  
01050          MOVE AINDT01I         TO ASC-PLND-INV-DATE                       
01051      ELSE                                                                 
01052          IF AINDT01F = DP015-ERASE-EOF                                    
01053              MOVE ASC-CURRENT-DATE TO ASC-PLND-INV-DATE                   
01054          END-IF                                                           
01054      END-IF.                                                              
01055                                                                           
01056      PERFORM 2210-MOVE-LINES-TO-COMMAREA                                  
01057          VARYING PV-SUB                                                   
01058          FROM 1 BY 1                                                      
01059          UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                              
01060 ******************************************************************        
01061 ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**        
01062 ******************************************************************        
01063  2210-MOVE-LINES-TO-COMMAREA.                                             
                                                                                
01076      ADD +1                        TO ASC-ITEM-SUB.                       
01077      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
01078          ADD +1                    TO ASC-BLK-SUB                         
01079          MOVE +1                   TO ASC-ITEM-SUB                        
01080      END-IF.                                                              
                                                                                
01081 ******************************************************************        
01082 ** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **        
01083 ** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **        
01084 ******************************************************************        
                                                                                
01085  3000-EDIT-DATA-IN-COMMAREA.                                              
01086      SET PS-NO-ERROR               TO TRUE.                               
01087      PERFORM 3200-RESET-ATTRIBUTES.                                       
01088      MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                             
                                                                                
      *    INVENTORY DATE MUST BE A VALID DATE                          10093700
           SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   10093800
           SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   10094000
           MOVE ASC-PLND-INV-DATE            TO DPG52-LK-DATE-INPUT.    10094300
           PERFORM 3300-CALL-CALENDAR-ROUTINE.                          10094400
           IF (DPG54-DATE-INVALID) OR                                   10094500
              (DPG54-SEVERE-ERROR)                                      10094600
               MOVE DP015-UNP-NUM-BRT-OFF    TO AINDT01A                10094700
               MOVE DP015-RED                TO AINDT01C                10095100
               MOVE DP015-REVERSE            TO AINDT01H                10095400
               MOVE -1                       TO AINDT01L                10095700
               SET DP030-SET-CURSOR-APPL-1   TO TRUE                    10095800
               IF PS-NO-ERROR                                           10096000
                   MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER        10096100
                   SET PS-ERROR                                         10096200
                       DP020-MSG-FATAL       TO TRUE                    10096300
               END-IF                                                   10096400
           END-IF.                                                      10096400
                                                                        10096400
01110  EJECT                                                                    
01111 *----------------------------------------------------------------*        
01112 *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *        
01113 *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*        
01114 *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *        
01115 *                                                                *        
01116 *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *        
01117 *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *        
01118 *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *        
01119 *    US IN THE 2ND BLOCK OF THE ARRAY.                           *        
01120 *----------------------------------------------------------------*        
01121                                                                           
01122  3100-SET-SUBSCRIPTS.                                                     
01123                                                                           
01124      COMPUTE ASC-ITEM-SUB =                                               
01125          (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.                
01126                                                                           
01127      IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                 
01128          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
01129                                                                           
01130          MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB                       
01131      ELSE                                                                 
01132          MOVE +1                     TO ASC-BLK-SUB                       
01133      END-IF.                                                              
                                                                                
01134 ******************************************************************        
01135 ** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **        
01136 ******************************************************************        
01137                                                                           
01138  3200-RESET-ATTRIBUTES.                                                   
01142                                                                           
01147      MOVE DP015-UNP-ALP-NOR-OFF    TO AINDT01A.                           
           MOVE DP015-GREEN              TO AINDT01C.                           
           MOVE DP015-UNDERLINE          TO AINDT01H.                           
                                                                                
      *----------------------------------------------------------------*12832000
      *    CALENDAR ROUTINE                                             12840000
      *----------------------------------------------------------------*12850000
       3300-CALL-CALENDAR-ROUTINE.                                      12860000
                                                                        12870000
           CALL PC-CALENDAR-ROUTINE USING DPG51                         12880000
                                          DPG52                         12890000
                                          DPG53                         12900000
                                          DPG54                         12910000
                                          DPG55                         12920000
                                          DPG56.                        12930000
                                                                        12940000
01437 *----------------------------------------------------------------*        
01438 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *        
01439 *    INITIALIZE ALL COUNTERS AND FLAGS.                          *        
01440 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *        
01441 *    DISPLAY THE PANEL TO USER.                                  *        
01442 *----------------------------------------------------------------*        
01443                                                                           
01444  4000-BUILD-INITIAL-PANEL.                                                
01445                                                                           
           MOVE -1                 TO AINDT01L.                                 
           SET DP030-SET-CURSOR-APPL-1                                          
                                   TO TRUE.                                     
01446      INITIALIZE                  ASC-BLOCK-ENTRIES (1)                    
01447                                  ASC-BLOCK-ENTRIES (2).                   
01448      MOVE +1                 TO ASC-BLK-SUB.                              
01449      SET ASC-ITEMS-LEFT-ON-DB                                             
01450                              TO TRUE.                                     
01451                                                                           
01452      MOVE +0                 TO ASC-ITEM-SUB                              
01453                                 ASC-NUMBER-OF-ITEMS-READ                  
01455                                 ASC-HIGHEST-BLOCK-WRITTEN                 
01458                                 ASC-ITEM-AT-TOP-OF-PANEL.                 
01459                                                                           
01460                                                                           
01461      PERFORM 4010-OPEN-CURSOR.                                            
01462                                                                           
01463      IF SQLCODE = ZERO                                                    
01464          PERFORM 4300-READ-ITEMS-FROM-DB                                  
01465                                                                           
01466          PERFORM 4020-CLOSE-CURSOR                                        
01467                                                                           
01468          MOVE +1                   TO  PV-TOP-ITEM                        
01469          IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                              
                   SET DP020-MSG-INFORMATIONAL TO TRUE                          
01472 *            ---- NO LIST ITEMS FOUND FOR CRITERIA ----                   
01473              MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                   
P14210             PERFORM 2050-DELETE-LIST-QUEUE                               
P14210             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
01474          ELSE                                                             
01478              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
01479          END-IF                                                           
01480      ELSE                                                                 
01481          SET  DP020-NEXT-ACT-APPL-ERROR                                   
01482               DP020-MSG-WARNING         TO TRUE                           
01483 *        ---- WAIT 15 SECONDS, THEN RETRY ----                            
01484          MOVE PC-TSYMSG-00551  TO  DP020-MSG-NUMBER                       
01485      END-IF.                                                              
01486  EJECT                                                                    
01487 *----------------------------------------------------------------*        
01488 *   OPEN THE CURSOR.                                                      
01489 *   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *        
01490 *   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *        
01491 *   USER.                                                        *        
01492 *----------------------------------------------------------------*        
01493                                                                           
01494  4010-OPEN-CURSOR.                                                        
                                                                                
           MOVE ASC-PLND-INV-DATE        TO INVPAR-PLND-INV-DTE.                
                                                                                
01497      MOVE 'CURSOR:  INV_COUNT_CSR' TO DP013-MESSAGE-TEXT (2)              
01499      EXEC SQL                                                             
01500          OPEN INV_COUNT_CSR                                               
01501      END-EXEC.                                                            
01510                                                                           
01511      EVALUATE TRUE                                                        
01512          WHEN SQLCODE = ZERO                                              
01513              CONTINUE                                                     
01514          WHEN SQLWARN0 NOT = SPACES                                       
01515          WHEN SQLCODE  NOT = ZERO                                         
01516              MOVE '4010-OPEN-CURSOR'                                      
01517                                TO DP013-PARAGRAPH                         
01518              MOVE 'OPEN INVENTORY COUNT STATUS CURSOR '                   
01519                                TO DP013-MESSAGE-TEXT (1)                  
01520              MOVE SQLCA        TO DP013-SQLCA                             
01521              MOVE 'TINVLAP '   TO DP013-DB2-TABLE-NAME (1)                
01521              MOVE 'TINVPAR '   TO DP013-DB2-TABLE-NAME (2)                
01522              SET DP013-DB2-ABEND                                          
01523                  DP013-XCTL-DISPLAY-RESTART TO TRUE                       
01524              PERFORM DP013-0000-PROCESS-ABEND                             
01525      END-EVALUATE.                                                        
01526  EJECT                                                                    
01527 *----------------------------------------------------------------*        
01528 * CLOSE THE CURSOR.                                                       
01529 *   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *        
01530 *   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *        
01531 *   USER.                                                        *        
01532 *----------------------------------------------------------------*        
01533                                                                           
01534  4020-CLOSE-CURSOR.                                                       
                                                                                
01537      EXEC SQL                                                             
01538          CLOSE INV_COUNT_CSR                                              
01539      END-EXEC.                                                            
01540                                                                           
01547      EVALUATE TRUE                                                        
01548          WHEN SQLCODE = ZERO                                              
01549              CONTINUE                                                     
01550          WHEN SQLWARN0 NOT = SPACES                                       
01551          WHEN SQLCODE  NOT = ZERO                                         
01552              MOVE '4020-CLOSE-CURSOR'                                     
01553                                TO DP013-PARAGRAPH                         
01554              MOVE 'CLOSE INVENTORY COUNT STATUS CURSOR'                   
01555                                TO DP013-MESSAGE-TEXT (1)                  
01556              MOVE SQLCA        TO DP013-SQLCA                             
01557              MOVE 'TINVLAP '   TO DP013-DB2-TABLE-NAME (1)                
01557              MOVE 'TINVPAR '   TO DP013-DB2-TABLE-NAME (2)                
01558              SET DP013-DB2-ABEND                                          
01559                  DP013-XCTL-DISPLAY-RESTART TO TRUE                       
01560              PERFORM DP013-0000-PROCESS-ABEND                             
01561      END-EVALUATE.                                                        
01562  EJECT                                                                    
                                                                                
01563 *----------------------------------------------------------------*        
01564 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *        
01565 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *        
01566 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *        
01567 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *        
01568 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *        
01569 *                                                                *        
01570 *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *        
01571 *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *        
01572 *    UPON INITIALIZATION.                                        *        
01573 *----------------------------------------------------------------*        
01574                                                                           
01575  4300-READ-ITEMS-FROM-DB.                                                 
01576                                                                           
01577      PERFORM                                                              
01578          VARYING PV-READ-COUNT                                            
01579          FROM 1 BY 1                                                      
01580          UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                            
01581             OR (ASC-NO-ITEMS-LEFT-ON-DB))                                 
01582                                                                           
01583          PERFORM 4310-FETCH                                               
01584                                                                           
01585          IF  ASC-ITEMS-LEFT-ON-DB                                         
01587              PERFORM 4320-READ-LOC-TABLE                                  
01587              PERFORM 4330-READ-INV-STAT-TABLE                             
01590              IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        
01591                  ADD +1            TO ASC-ITEM-SUB                        
01592              ELSE                                                         
01593                  ADD +1            TO ASC-BLK-SUB                         
01594                  MOVE +1           TO ASC-ITEM-SUB                        
01595                                                                           
01596                  IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 
01597                      MOVE +1       TO ASC-BLK-SUB                         
01598                      SET ASC-BLOCK-MODIFIED (1) TO TRUE                   
01599                      PERFORM 5100-WRITE-TEMP-STORAGE                      
01600                      MOVE ASC-BLOCK-ENTRIES                               
01601                                           (PC-MAX-BLOCKS-IN-ARRAY)        
01602                                  TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)        
01603                      ADD +1        TO ASC-BLK-SUB                         
01604                      INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           
01605                      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              
01606                                                            TO TRUE        
01607                  END-IF                                                   
01608              END-IF                                                       
01609              ADD +1                TO ASC-NUMBER-OF-ITEMS-READ            
01610              MOVE ASC-NUMBER-OF-ITEMS-READ                                
01611                 TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)        
01612 *   -----------MOVE ITEMS FROM DB TO ASC COMMAREA ---------               
                   MOVE INVPAR-LOC-NBR                                          
                     TO ASC-LOC-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)                 
                   MOVE XMT00001-LOC-10-ABBR-NM                                 
                     TO ASC-LOC-NAME (ASC-BLK-SUB ASC-ITEM-SUB)                 
                   MOVE INVPAR-PHY-CNT-TMST (12:2)                              
                     TO ASC-CPLD (ASC-BLK-SUB ASC-ITEM-SUB) (1:2)               
                   MOVE ':'                                                     
                     TO ASC-CPLD (ASC-BLK-SUB ASC-ITEM-SUB) (3:1)               
                   MOVE INVPAR-PHY-CNT-TMST (15:2)                              
                     TO ASC-CPLD (ASC-BLK-SUB ASC-ITEM-SUB) (4:2)               
                   MOVE INT00001-INV-STAT-CDE-DESC                              
                     TO ASC-INV-STAT     (ASC-BLK-SUB ASC-ITEM-SUB)             
01654 *   -----------MOVE ITEMS FROM DB TO ASC COMMAREA ---------               
01655 *          END-IF                                                         
01656          END-IF                                                           
01657      END-PERFORM.                                                         
01658                                                                           
01659      IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                                  
01660          MOVE +1               TO ASC-BLK-SUB                             
01661          PERFORM 5100-WRITE-TEMP-STORAGE                                  
01662          ADD +1                TO ASC-BLK-SUB                             
01663          PERFORM 5100-WRITE-TEMP-STORAGE                                  
01664                                                                           
01665          MOVE 1                TO ASC-BLK-SUB                             
01666                                   PV-BLOCK-NUMBER                         
01667          PERFORM 4410-READ-TEMP-STORAGE                                   
01668          IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                     
01669              MOVE 2            TO ASC-BLK-SUB                             
01670                                   PV-BLOCK-NUMBER                         
01671              PERFORM 4410-READ-TEMP-STORAGE                               
01672          END-IF                                                           
01673      END-IF.                                                              
01674  EJECT                                                                    
01675 *----------------------------------------------------------------*        
01676 *    FETCH THE MESSAGE CURSOR.                                   *        
01677 *----------------------------------------------------------------*        
01678                                                                           
01679  4310-FETCH.                                                              
01680                                                                           
           EXEC SQL                                                             
                FETCH INV_COUNT_CSR                                             
                INTO :INVPAR-JOB-NM                                             
                    ,:INVPAR-LOC-NBR                                            
                    ,:INVLAP-LPTP-NBR                                           
                    ,:INVLAP-INV-STAT-CDE                                       
                    ,:INVLAP-LPTP-EXT-AMT                                       
                    ,:INVLAP-LPTP-QTY                                           
                    ,:INVLAP-STR-TRSM-IND                                       
                    ,:INVPAR-PHY-CNT-TMST                                       
           END-EXEC.                                                            
01701                                                                           
01702      EVALUATE TRUE                                                        
01703          WHEN SQLCODE = ZERO                                              
01704          WHEN SQLCODE = +100                                              
01705               CONTINUE                                                    
01706          WHEN SQLWARN0 NOT = SPACE                                        
01707          WHEN SQLCODE  NOT = ZERO                                         
01708               MOVE '4310-FETCH-CURSOR'                                    
01709                                TO DP013-PARAGRAPH                         
01710               MOVE 'FETCH INVENTORY COUNT STATUS CURSOR'                  
01711                                TO DP013-MESSAGE-TEXT (1)                  
01712               MOVE SQLCA       TO DP013-SQLCA                             
01713               SET DP013-DB2-ABEND                                         
01714                                TO TRUE                                    
01715               PERFORM DP013-0000-PROCESS-ABEND                            
01716      END-EVALUATE.                                                        
01717                                                                           
01718      IF  SQLCODE EQUAL +100                                               
01719          SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                              
01720      END-IF.                                                              
01721                                                                           
01722 *----------------------------------------------------------------*        
01723 *    READ THE INVENTORY PARAMETERS TABLE TO DETERMINE THE                 
01724 *    NUMBER FOR STORES IN THE INVENTORY CYCLE.                            
01725 *----------------------------------------------------------------*        
01726                                                                           
01727  4320-READ-LOC-TABLE.                                                     
01728                                                                           
           MOVE SPACES TO XMT00001-LOC-NM.                                      
                                                                                
01729      EXEC SQL                                                             
01730          SELECT LOC_10_ABBR_NM                                            
01735          INTO  :XMT00001-LOC-10-ABBR-NM                                   
01740          FROM   XMT_LOC                                                   
01741          WHERE LOC_NBR = :INVPAR-LOC-NBR                                  
01746      END-EXEC.                                                            
01747                                                                           
01748      EVALUATE TRUE                                                        
01749          WHEN SQLCODE = 0                                                 
01750              CONTINUE                                                     
01749          WHEN SQLCODE = +100                                              
01750              MOVE 'XMT_LOC NFD' TO XMT00001-LOC-10-ABBR-NM                
01757          WHEN SQLWARN NOT = SPACE                                         
01758          WHEN SQLCODE NOT = ZERO                                          
01759              MOVE '4320-READ-LOC'                                         
01760                                TO DP013-PARAGRAPH                         
01761              MOVE 'READ LOCATION NAME'                                    
01762                                TO DP013-MESSAGE-TEXT(1)                   
01763              MOVE SQLCA        TO DP013-SQLCA                             
01764              MOVE 'XMT_LOC'    TO DP013-DB2-TABLE-NAME (1)                
01765              SET DP013-DB2-ABEND                                          
01766                  DP013-XCTL-DISPLAY-RESTART TO TRUE                       
01767              PERFORM DP013-0000-PROCESS-ABEND                             
01768      END-EVALUATE.                                                        
01769                                                                           
01722 *----------------------------------------------------------------*        
01723 *    READ THE INVENTORY PARAMETERS TABLE TO DETERMINE THE                 
01724 *    NUMBER FOR STORES IN THE INVENTORY CYCLE.                            
01725 *----------------------------------------------------------------*        
01726                                                                           
01727  4330-READ-INV-STAT-TABLE.                                                
01728                                                                           
           MOVE SPACES TO INT00001-INV-STAT-CDE-DESC.                           
                                                                                
01729      EXEC SQL                                                             
01730          SELECT INV_STAT_CDE_DESC                                         
01735          INTO  :INT00001-INV-STAT-CDE-DESC                                
01740          FROM   INT_INV_STAT_CDE                                          
01741          WHERE INV_STAT_CDE = :INVLAP-INV-STAT-CDE                        
01746      END-EXEC.                                                            
01747                                                                           
01748      EVALUATE TRUE                                                        
01749          WHEN SQLCODE = 0                                                 
01750              CONTINUE                                                     
01749          WHEN SQLCODE = +100                                              
01750              MOVE SPACES TO INT00001-INV-STAT-CDE-DESC                    
01757          WHEN SQLWARN NOT = SPACE                                         
01758          WHEN SQLCODE NOT = ZERO                                          
01759              MOVE '4330-READ-INV-STAT'                                    
01760                                TO DP013-PARAGRAPH                         
01761              MOVE 'READ INVENTORY STATUS DESC'                            
01762                                TO DP013-MESSAGE-TEXT(1)                   
01763              MOVE SQLCA        TO DP013-SQLCA                             
01764              MOVE 'INT_INV_STAT_CDE' TO DP013-DB2-TABLE-NAME (1)          
01765              SET DP013-DB2-ABEND                                          
01766                  DP013-XCTL-DISPLAY-RESTART TO TRUE                       
01767              PERFORM DP013-0000-PROCESS-ABEND                             
01768      END-EVALUATE.                                                        
01769                                                                           
01770 *----------------------------------------------------------------*        
01771 * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *        
01772 *----------------------------------------------------------------*        
01773                                                                           
01774  4400-MOVE-COMMAREA-TO-SCREEN.                                            
01775                                                                           
01776      IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                     
01777          AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))                  
01778          OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))                  
01779              MOVE +1    TO ASC-BLK-SUB                                    
01780              PERFORM 5100-WRITE-TEMP-STORAGE                              
01781              ADD +1     TO ASC-BLK-SUB                                    
01782              PERFORM 5100-WRITE-TEMP-STORAGE                              
01783              DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                     
01784                  GIVING PV-BLOCK-NUMBER                                   
01785                  REMAINDER PV-REMAINDER                                   
01786              IF  PV-REMAINDER > ZERO                                      
01787                  ADD +1 TO PV-BLOCK-NUMBER                                
01788              END-IF                                                       
01789              MOVE +1    TO ASC-BLK-SUB                                    
01790              PERFORM 4410-READ-TEMP-STORAGE                               
01791              ADD +1     TO ASC-BLK-SUB                                    
01792                            PV-BLOCK-NUMBER                                
01793              PERFORM 4410-READ-TEMP-STORAGE                               
01794      END-IF.                                                              
01795      MOVE +1            TO ASC-BLK-SUB.                                   
01796      COMPUTE ASC-ITEM-SUB =                                               
01797          ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                      
01798          + PC-ITEMS-PER-PANEL).                                           
01799                                                                           
01800      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
01801          ADD +1         TO ASC-BLK-SUB                                    
01802          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
01803      END-IF.                                                              
01804                                                                           
01805      COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                                   
01806          ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                        
01808      PERFORM 4420-FORMAT-LIST-LINES                                       
01809          VARYING PV-SUB                                                   
01810          FROM PC-ITEMS-PER-PANEL BY -1                                    
01811          UNTIL PV-SUB < +1.                                               
01812                                                                           
01813      COMPUTE ASC-ITEMS-DISPLAYED =                                        
01814          ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).                  
01815      IF PS-NO-START-ITEM-ERROR                                            
01816          MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL        
01819      ELSE                                                                 
               CONTINUE                                                         
01821      END-IF.                                                              
           MOVE ASC-PLND-INV-DATE            TO AINDT01O.                       
                                                                                
01827      IF  DP020-MSG-NUMBER-X = SPACE                                       
01828          IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ          
01829 *            --- MORE ITEMS TO DISPLAY ----                               
01830              MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER                    
01831              SET DP020-MSG-INFORMATIONAL TO TRUE                          
01832          END-IF                                                           
01833      END-IF.                                                              
                                                                                
01834 *----------------------------------------------------------------*        
01835 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *        
01836 *----------------------------------------------------------------*        
01837                                                                           
01838  4410-READ-TEMP-STORAGE.                                                  
01839                                                                           
01840      EXEC CICS                                                            
01841          READQ TS                                                         
01842              QUEUE (ASC-LIST-QUEUE-NAME)                                  
01843              INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
01844              ITEM  (PV-BLOCK-NUMBER)                                      
01845              RESP  (PV-CICS-RESP)                                         
01846      END-EXEC.                                                            
01847                                                                           
01848      IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                               
01849        OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                             
01850          CONTINUE                                                         
01851      ELSE                                                                 
01852          SET DP013-CICS-ABEND     TO TRUE                                 
01853          SET DP013-NO-ROLLBACK    TO TRUE                                 
01854          MOVE '4410-READ-TEMP-STORAGE'                                    
01855                                   TO DP013-PARAGRAPH                      
01856          MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'              
01857                                   TO DP013-MESSAGE-TEXT(1)                
01858          PERFORM DP013-0000-PROCESS-ABEND                                 
01859      END-IF.                                                              
01860                                                                           
01861      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
01862                                                                           
01863      IF  PV-CICS-RESP = DFHRESP (ITEMERR)                                 
01864          INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                       
01865      END-IF.                                                              
01866  EJECT                                                                    
                                                                                
01867 *----------------------------------------------------------------*        
01868 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *        
01869 *----------------------------------------------------------------*        
01870                                                                           
01871  4420-FORMAT-LIST-LINES.                                                  
01872      IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ              
01873          SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                        
01877          MOVE SPACE              TO MR-LOC-NBR-X (PV-SUB)                 
01878                                     MR-LOC-NAME  (PV-SUB)                 
01879                                     MR-CPLD      (PV-SUB)                 
01880                                     MR-INV-STAT  (PV-SUB)                 
01884      ELSE                                                                 
01903          IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL                   
01906              MOVE ASC-LOC-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)                 
01907                                  TO MR-LOC-NBR  (PV-SUB)                  
01908              MOVE ASC-LOC-NAME (ASC-BLK-SUB ASC-ITEM-SUB)                 
01909                                  TO MR-LOC-NAME (PV-SUB)                  
01910              MOVE ASC-CPLD     (ASC-BLK-SUB ASC-ITEM-SUB)                 
01911                                  TO MR-CPLD     (PV-SUB)                  
01921              MOVE ASC-INV-STAT (ASC-BLK-SUB ASC-ITEM-SUB)                 
01921                                  TO MR-INV-STAT (PV-SUB)                  
01961          END-IF                                                           
01962      END-IF.                                                              
                                                                                
01963      SUBTRACT +1 FROM ASC-ITEM-SUB.                                       
01964      IF  ASC-ITEM-SUB < + 1                                               
01965          MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                          
01966          MOVE +1                 TO ASC-BLK-SUB                           
01967      END-IF.                                                              
                                                                                
02056 *----------------------------------------------------------------*        
02057 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *        
02058 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *        
02059 *----------------------------------------------------------------*        
02060                                                                           
02061  5100-WRITE-TEMP-STORAGE.                                                 
02062      MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                             
02063                                    TO PV-LIST-ITEM-NUMBER.                
02064      COMPUTE PV-BLOCK-NUMBER =                                            
02065          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
02066                                                                           
02067      IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)                     
02068      OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)                     
02069          IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                              
02070              PERFORM 5105-REWRITE-ASC-LISTQ                               
02071          END-IF                                                           
02072      ELSE                                                                 
02073          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                               
02074          ASC-HIGHEST-BLOCK-WRITTEN + 1                                    
02075          PERFORM 5110-WRITE-ASC-LISTQ                                     
02076          ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN           
02077      END-IF.                                                              
02078                                                                           
02079      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
02080 ******************************************************************        
02081 ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **        
02082 ** SPECIFIC COMMAREA.                                           **        
02083 ******************************************************************        
02084  5105-REWRITE-ASC-LISTQ.                                                  
02085      EXEC CICS                                                            
02086          WRITEQ TS                                                        
02087              QUEUE (ASC-LIST-QUEUE-NAME)                                  
02088              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
02089              ITEM  (PV-BLOCK-NUMBER)                                      
02090              REWRITE                                                      
02091              RESP  (PV-CICS-RESP)                                         
02092      END-EXEC.                                                            
02093                                                                           
02094      IF  PV-CICS-RESP = DFHRESP(NORMAL)                                   
02095          CONTINUE                                                         
02096      ELSE                                                                 
02097          SET DP013-CICS-ABEND            TO TRUE                          
02098          SET DP013-NO-ROLLBACK           TO TRUE                          
02099          MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH               
02100          MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'             
02101                                          TO DP013-MESSAGE-TEXT(1)         
02102          PERFORM DP013-0000-PROCESS-ABEND                                 
02103      END-IF.                                                              
02104                                                                           
02105 ******************************************************************        
02106 ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **        
02107 ** SPECIFIC COMMAREA.                                           **        
02108 ******************************************************************        
02109  5110-WRITE-ASC-LISTQ.                                                    
02110      EXEC CICS                                                            
02111          WRITEQ TS                                                        
02112              QUEUE (ASC-LIST-QUEUE-NAME)                                  
02113              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
02114              ITEM  (PV-BLOCK-NUMBER)                                      
02115              RESP  (PV-CICS-RESP)                                         
02116      END-EXEC.                                                            
02117      IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                              
02118          SET DP013-CICS-ABEND      TO TRUE                                
02119          SET DP013-NO-ROLLBACK     TO TRUE                                
02120          MOVE '5110-WRITE-ASC-LISTQ'                                      
02121                                    TO DP013-PARAGRAPH                     
02122          MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'                   
02123                                    TO DP013-MESSAGE-TEXT(1)               
02124          PERFORM DP013-0000-PROCESS-ABEND                                 
02125      END-IF.                                                              
02126  EJECT                                                                    
02402 *----------------------------------------------------------------*        
02403 *    ABEND PROCESSOR MODULE                                      *        
02404 *----------------------------------------------------------------*        
02405                                                                           
02406      COPY DPPD013.                                                        
