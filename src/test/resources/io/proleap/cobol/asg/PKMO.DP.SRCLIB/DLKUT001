000100 IDENTIFICATION DIVISION.                                                 
000200 PROGRAM-ID.    DLKUT001.                                                 
000300 AUTHOR.        PAUL OMAN.                                                
000400                                                                          
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  NOVEMBER 2003.                                            
000700 DATE-COMPILED.                                                           
000800                                                                          
000900 ENVIRONMENT DIVISION.                                                    
001000 CONFIGURATION SECTION.                                                   
001100 SOURCE-COMPUTER. IBM-3090.                                               
001200 OBJECT-COMPUTER. IBM-3090.                                               
001300                                                                          
002400****************************************************************          
002500*                                                              *          
002600*     USED TO DETERMINE IF AN ASSOCIATE (KOHL'S OR TEMP) IS    *          
002700*     ALREADY ASSOCIATED WITH AN OPEN ASSIGNMENT.              *          
002800*                                                              *          
002900*  DB2 ACCESS:                                                 *          
003000*     DLT_TEM_ASGMT (DLT00003) TABLE                           *          
003100*                SELECTS                                       *          
003200*                                                              *          
003300*     DLT_ASGMT (DLT00004) TABLE                               *          
003400*                SELECTS                                       *          
003500*                                                              *          
003700****************************************************************          
003800                                                                          
003900 DATA DIVISION.                                                           
004000 WORKING-STORAGE SECTION.                                                 
004100                                                                          
004200 01  PV-CHARACTER-FIELDS.                                                 
004300     05  PV-CURRENT-DATE          PIC X(10)  VALUE SPACES.                
004400     05  PV-KEY-START-DATE        PIC X(10)  VALUE SPACES.                
004500                                                                          
004600 01  PV-COMP-FIELDS.                                                      
004700     05  PV-WORK-SEQ-NBR          PIC S9(04) VALUE 0 COMP.                
004800     05  PV-RETRY-COUNTER         PIC S9(04) VALUE 0 COMP.                
004900     05  PV-USER-ID-COUNT         PIC S9(07) VALUE 0 COMP-3.              
005000     05  PV-KOHLS-USERID-COUNT    PIC S9(07) VALUE 0 COMP-3.              
005100     05  PV-TEMP-USERID-COUNT     PIC S9(07) VALUE 0 COMP-3.              
005200     05  PV-KOHLS-USR-ID-NULL-IND PIC S9(04) VALUE 0 COMP.                
005300     05  PV-TMP-USR-ID-NULL-IND   PIC S9(04) VALUE 0 COMP.                
005400                                                                          
005500 01  PS-SWITCHES.                                                         
005600     05  PS-DISPLAY-PARA-SW           PIC X(01)  VALUE 'N'.               
005700         88  PS-DISPLAY-PARA                     VALUE 'Y'.               
005800         88  PS-DONT-DISPLAY-PARA                VALUE 'N'.               
005900     05  PS-DISPLAY-DETAIL-SW         PIC X(01)  VALUE 'N'.               
006000         88  PS-DISPLAY-DETAIL                   VALUE 'Y'.               
006100         88  PS-DONT-DISPLAY-DETAIL              VALUE 'N'.               
006200     05  PS-KOHLS-USER-COUNT-SW       PIC X(01)  VALUE SPACE.             
006300         88  PS-KOHLS-USER-NONE-FOUND            VALUE '0'.               
006400         88  PS-KOHLS-USER-ONE-FOUND             VALUE '1'.               
006500         88  PS-KOHLS-USER-MANY-FOUND            VALUE '9'.               
006600     05  PS-TEMP-USER-COUNT-SW        PIC X(01)  VALUE SPACE.             
006700         88  PS-TEMP-USER-NONE-FOUND             VALUE '0'.               
006800         88  PS-TEMP-USER-ONE-FOUND              VALUE '1'.               
006900         88  PS-TEMP-USER-MANY-FOUND             VALUE '9'.               
007000                                                                          
007100 01  PC-CONSTANTS.                                                        
007200     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.               
007300     05  PC-N                        PIC X      VALUE 'N'.                
007400     05  PC-ASTERISK-LINE            PIC X(40)  VALUE ALL '*'.            
007500     05  PC-FIVE-BLANKS              PIC X(05)  VALUE SPACES.             
007600     05  PC-TEN-BLANKS               PIC X(10)  VALUE SPACES.             
007700                                                                          
007800****************************************************************          
007900*                                                              *          
008000*                                                              *          
008100****************************************************************          
008200                                                                          
008300*     DLT_ASGMT                                                           
008400     EXEC SQL                                                             
008500         INCLUDE DLT00004                                                 
008600     END-EXEC.                                                            
008700*     DLT_TEM_ASGMT                                                       
008800     EXEC SQL                                                             
008900         INCLUDE DLT00003                                                 
009000     END-EXEC.                                                            
009100                                                                          
009200     EXEC SQL                                                             
009300          INCLUDE SQLCA                                                   
009400     END-EXEC.                                                            
009500                                                                          
009600                                                                          
009700 LINKAGE SECTION.                                                         
009800     COPY DLWS003.                                                        
009900                                                                          
010000                                                                          
010100 PROCEDURE DIVISION USING DL003-ASGMT-COMMAREA.                           
010200                                                                          
010300     SET DL003-SUCCESSFUL  TO TRUE.                                       
010400     SET PS-DISPLAY-PARA   TO TRUE.                                       
010500     SET PS-DISPLAY-DETAIL TO TRUE.                                       
010600     SET PS-DONT-DISPLAY-PARA   TO TRUE.                                  
010700     SET PS-DONT-DISPLAY-DETAIL TO TRUE.                                  
010900                                                                          
011000     PERFORM 3600-CLEAR-OUTPUT-FIELDS.                                    
011100                                                                          
011200     IF PS-DISPLAY-PARA                                                   
011300        DISPLAY ' '                                                       
011400        DISPLAY PC-ASTERISK-LINE                                          
011500        DISPLAY '   BEGIN DLKUT001'                                       
011600        DISPLAY PC-ASTERISK-LINE                                          
011700        DISPLAY ' '.                                                      
011800                                                                          
011900     EVALUATE TRUE                                                        
012000         WHEN DL003-BY-USER-KEY                                           
012100              PERFORM 1000-FIND-SEQUENCE-NBR                              
012200                                                                          
012300         WHEN OTHER                                                       
012400              SET DL003-INVALID-ACCESS TO TRUE                            
012500                                                                          
012600     END-EVALUATE.                                                        
012700                                                                          
012800     IF PS-DISPLAY-PARA                                                   
012900        DISPLAY ' '                                                       
013000        DISPLAY PC-ASTERISK-LINE                                          
013100        DISPLAY '   END DLKUT001'                                         
013200        DISPLAY PC-ASTERISK-LINE                                          
013300        DISPLAY ' '.                                                      
013400     GOBACK.                                                              
013500                                                                          
013600                                                                          
013700 1000-FIND-SEQUENCE-NBR.                                                  
013800                                                                          
013900     IF PS-DISPLAY-PARA                                                   
014000        DISPLAY '1000-FIND-SEQUENCE-NBR'.                                 
014100                                                                          
014200     EVALUATE TRUE                                                        
014300         WHEN DL003-NO-KEY-USER-ID                                        
014400              SET DL003-MISSING-KEY-FIELDS TO TRUE                        
014500                                                                          
014600         WHEN OTHER                                                       
014700              PERFORM 2000-CHECK-ASSIGNMENTS                              
014800                                                                          
014900     END-EVALUATE.                                                        
015000                                                                          
015100****************************************************************          
015200*    PV-KOHLS-USERID-COUNT -                                   *          
015300*             CONTAINS COUNT OF ROWS FOUND FOR KOHLS USERID.   *          
015400*    PV-TEMP-USERID-COUNT -                                    *          
015500*             CONTAINS COUNT OF ROWS FOUND FOR KOHLS USERID.   *          
015600*                                                              *          
015700*    LOGIC PROGRESSES AS FOLLOWS:                              *          
015800*       1ST SELECT IS BY KOHLS USER ID. IF THERE ARE ONE OR    *          
015900*           IF THERE ARE ONE OR MORE ROWS FOR THE KOHLS        *          
016000*           USERID, THEN DO A COUNT FOR THE KOHLS USERID.      *          
016100*                                                              *          
016200*           IF THERE WEREN'T ANY ROWS FOR THE KOHLS USERID,    *          
016300*           THEN DO A SELECT FOR THE TEMPORARY USERID. IF      *          
016400*           THERE ARE ONE OR MORE ROWS FOR THE TEMPORARY       *          
016500*           USERID, THEN DO A COUNT FOR THE TEMPORARY USERID.  *          
016600*                                                              *          
016700****************************************************************          
016800                                                                          
016900 2000-CHECK-ASSIGNMENTS.                                                  
017000                                                                          
017100     IF PS-DISPLAY-PARA                                                   
017200        DISPLAY '2000-CHECK-ASSIGNMENTS'.                                 
017300                                                                          
017400     PERFORM 3000-SELECT-BY-KOHLS-USERID.                                 
017500                                                                          
017600     IF PS-DISPLAY-DETAIL                                                 
017700        DISPLAY PC-FIVE-BLANKS                                            
017800                'PS-KOHLS-USER-COUNT-SW - '                               
017900                 PS-KOHLS-USER-COUNT-SW.                                  
018000                                                                          
018100     EVALUATE TRUE                                                        
018200         WHEN DL003-SQL-ERROR                                             
018300              MOVE SQLCA TO DL003-SQLCA                                   
018400                                                                          
018500         WHEN PS-KOHLS-USER-ONE-FOUND                                     
018600              MOVE 1 TO PV-KOHLS-USERID-COUNT                             
018700              MOVE 0 TO PV-TEMP-USERID-COUNT                              
018800                                                                          
018900              SET DL003-USR-IS-KOHLS TO TRUE                              
019000              SET DL003-ASGMT-FOUND  TO TRUE                              
019100              PERFORM 3400-FORMAT-OUTPUT-FIELDS                           
019200                                                                          
019300         WHEN PS-KOHLS-USER-NONE-FOUND                                    
019400              MOVE 0 TO PV-KOHLS-USERID-COUNT                             
019500              PERFORM 4000-SELECT-BY-TEMP-USERID                          
019600                                                                          
019700              EVALUATE TRUE                                               
019800                  WHEN PS-TEMP-USER-NONE-FOUND                            
019900                       SET DL003-ASGMT-NOT-FOUND TO TRUE                  
020000                       MOVE 0 TO PV-TEMP-USERID-COUNT                     
020100                                                                          
020200                  WHEN PS-TEMP-USER-ONE-FOUND                             
020300                       SET DL003-USR-IS-TMP TO TRUE                       
020400                       PERFORM 3400-FORMAT-OUTPUT-FIELDS                  
020500                       SET DL003-ASGMT-FOUND TO TRUE                      
020600                       MOVE 1 TO PV-TEMP-USERID-COUNT                     
020700                                                                          
020800                  WHEN PS-TEMP-USER-MANY-FOUND                            
020900                       SET DL003-ASGMT-MULT-FOUND TO TRUE                 
021000                       PERFORM 5400-COUNT-BY-TEMP-USERID                  
021100                                                                          
021200              END-EVALUATE                                                
021300                                                                          
021400         WHEN PS-KOHLS-USER-MANY-FOUND                                    
021500              MOVE 0 TO PV-TEMP-USERID-COUNT                              
021600              SET DL003-ASGMT-MULT-FOUND TO TRUE                          
021700              PERFORM 5000-COUNT-BY-KOHLS-USERID                          
021800                                                                          
021900     END-EVALUATE.                                                        
022000                                                                          
022100     COMPUTE DL003-ASGMT-FOUND-QTY = PV-KOHLS-USERID-COUNT +              
022200                                     PV-TEMP-USERID-COUNT.                
022300     MOVE    DL003-ASGMT-FOUND-QTY TO                                     
022400                         DL003-ASGMT-ACTV-USR-QTY.                        
022500                                                                          
022600****************************************************************          
022700*    LOOKUP USING KOHLS USER ID                                *          
022800*                                                              *          
022900****************************************************************          
023000                                                                          
023100                                                                          
023200 3000-SELECT-BY-KOHLS-USERID.                                             
023300                                                                          
023400     IF PS-DISPLAY-PARA                                                   
023500        DISPLAY '3000-SELECT-BY-KOHLS-USERID'.                            
023600                                                                          
023700     PERFORM                                                              
023800         WITH TEST AFTER                                                  
023900         VARYING PV-RETRY-COUNTER                                         
024000         FROM 1 BY 1                                                      
024100         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                          
024200            OR SQLCODE = ZERO                                             
024300            OR SQLCODE = +100                                             
024400            OR SQLCODE = -811                                             
024500                                                                          
024600         EXEC SQL                                                         
024700             SELECT                                                       
024800                    TEM.ASGMT_STRT_DTE                                    
024900                   ,TEM.ASGMT_NBR_TXT                                     
025000                   ,TEM.ASGMT_NBR_SEQ_NBR                                 
025100                   ,TEM.TEM_ASGMT_SEQ_NBR                                 
025200                   ,TEM.KOHLS_USR_ID                                      
025300                   ,TEM.TMP_USR_ID                                        
025400                   ,TEM.JN_TMST                                           
025500                   ,TEM.CRE_BY_USR_ID                                     
025600                                                                          
025700                   ,ASGMT.ASGMT_STRT_TM                                   
025800                   ,ASGMT.WK_TYP_DESC                                     
025900                   ,ASGMT.WK_AREA_DESC                                    
026000                   ,ASGMT.DC_NBR                                          
026100              INTO                                                        
026200                    :DLT00003-ASGMT-STRT-DTE                              
026300                   ,:DLT00003-ASGMT-NBR-TXT                               
026400                   ,:DLT00003-ASGMT-NBR-SEQ-NBR                           
026500                   ,:DLT00003-TEM-ASGMT-SEQ-NBR                           
026600                   ,:DLT00003-KOHLS-USR-ID                                
026700                                  :PV-KOHLS-USR-ID-NULL-IND               
026800                   ,:DLT00003-TMP-USR-ID                                  
026900                                  :PV-TMP-USR-ID-NULL-IND                 
027000                   ,:DLT00003-JN-TMST                                     
027100                   ,:DLT00003-CRE-BY-USR-ID                               
027200                                                                          
027300                   ,:DLT00004-ASGMT-STRT-TM                               
027400                   ,:DLT00004-WK-TYP-DESC                                 
027500                   ,:DLT00004-WK-AREA-DESC                                
027600                   ,:DLT00004-DC-NBR                                      
027700                                                                          
027800              FROM  DLT_TEM_ASGMT   TEM                                   
027900                   ,DLT_ASGMT       ASGMT                                 
028000                                                                          
028100             WHERE  TEM.KOHLS_USR_ID = :DL003-KEY-USER-ID                 
028200               AND  TEM.LVE_RSN_CDE  = :PC-N                              
028300                                                                          
028400               AND  ASGMT.ASGMT_STRT_DTE    = TEM.ASGMT_STRT_DTE          
028500               AND  ASGMT.ASGMT_NBR_TXT     = TEM.ASGMT_NBR_TXT           
028600               AND  ASGMT.ASGMT_NBR_SEQ_NBR =                             
028700                                  TEM.ASGMT_NBR_SEQ_NBR                   
028800               AND  ASGMT.ASGMT_STP_RSN_CDE = :PC-N                       
028900         END-EXEC                                                         
029000                                                                          
029100         EVALUATE TRUE                                                    
029200             WHEN SQLCODE = ZERO                                          
029300                  SET PS-KOHLS-USER-ONE-FOUND TO TRUE                     
029400                  IF PS-DISPLAY-DETAIL                                    
029500                     PERFORM 6000-DISPLAY-DATA                            
029600                  END-IF                                                  
029700                                                                          
029800             WHEN SQLCODE = -904                                          
029900             WHEN SQLCODE = -911                                          
030000             WHEN SQLCODE = -913                                          
030100                  CONTINUE                                                
030200                                                                          
030300             WHEN SQLCODE = -811                                          
030400                  SET PS-KOHLS-USER-MANY-FOUND TO TRUE                    
030500                                                                          
030600             WHEN SQLCODE = +100                                          
030700                  SET PS-KOHLS-USER-NONE-FOUND TO TRUE                    
030800                                                                          
030900             WHEN SQLWARN0 NOT = SPACES                                   
031000             WHEN SQLCODE NOT = ZERO                                      
031100                  MOVE +4             TO PV-RETRY-COUNTER                 
031200         END-EVALUATE                                                     
031300     END-PERFORM.                                                         
031400                                                                          
031500     IF SQLCODE = ZERO OR                                                 
031600        SQLCODE = +100 OR                                                 
031700        SQLCODE = -811                                                    
031800        CONTINUE                                                          
031900     ELSE                                                                 
032000        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                              
032100           MOVE '3000-' TO DL003-SQL-ERROR-PARA                           
032200           MOVE SQLCODE TO DL003-ASGMT-SQLCODE                            
032300           SET DL003-SQL-ERROR      TO TRUE                               
032310           MOVE SQLCA               TO DL003-SQLCA                        
032400        END-IF                                                            
032500     END-IF.                                                              
032600                                                                          
032700****************************************************************          
032800*    LOOKUP USING TEMPORARY USER ID                            *          
032900*                                                              *          
033000****************************************************************          
033100                                                                          
033200 3400-FORMAT-OUTPUT-FIELDS.                                               
033300                                                                          
033400     IF PS-DISPLAY-PARA                                                   
033500        DISPLAY '3400-FORMAT-OUTPUT-FIELDS'.                              
033600                                                                          
033700     MOVE DLT00003-ASGMT-STRT-DTE    TO DL003-ASGMT-START-DTE.            
033800     MOVE DLT00003-ASGMT-NBR-TXT     TO DL003-ASGMT-NBR-TXT.              
033900     MOVE DLT00003-ASGMT-NBR-SEQ-NBR TO DL003-ASGMT-NBR-SEQ-NBR.          
034000     MOVE DLT00003-TEM-ASGMT-SEQ-NBR TO DL003-TEM-ASGMT-SEQ-NBR           
034100                                                                          
034200     MOVE DLT00004-ASGMT-STRT-TM     TO DL003-ASGMT-STRT-TM.              
034300     MOVE DLT00004-WK-TYP-DESC       TO DL003-ASGMT-WK-TYP-DESC.          
034400     MOVE DLT00004-WK-AREA-DESC      TO DL003-ASGMT-WK-AREA-DESC.         
034500     MOVE DLT00004-DC-NBR            TO DL003-ASGMT-DC-NBR.               
034600                                                                          
034700*??  MOVE DLT00003-JN-TMST           TO DL003-ASGMT-JOIN-TMST.            
034800                                                                          
034900     STRING DLT00003-JN-TMST (6:2) '/'                                    
035000            DLT00003-JN-TMST (9:2) '/'                                    
035100            DLT00003-JN-TMST (3:2)                                        
035200            DELIMITED BY SIZE                                             
035300            INTO DL003-ASGMT-JOIN-DTE-RF.                                 
035400                                                                          
035500     STRING DLT00003-JN-TMST (12:2) ':'                                   
035600            DLT00003-JN-TMST (15:2) ':'                                   
035700            DLT00003-JN-TMST (18:2)                                       
035800            DELIMITED BY SIZE                                             
035900            INTO DL003-ASGMT-JOIN-TME.                                    
036000                                                                          
036100****************************************************************          
036200*    CLEAR OUTPUT FIELDS OF ANY VALUES.                        *          
036300*                                                              *          
036400****************************************************************          
036500                                                                          
036600 3600-CLEAR-OUTPUT-FIELDS.                                                
036700                                                                          
036800     IF PS-DISPLAY-PARA                                                   
036900        DISPLAY '3600-CLEAR-OUTPUT-FIELDS'.                               
037000                                                                          
037100     MOVE SPACES TO DL003-ASGMT-START-DTE                                 
037200                    DL003-ASGMT-NBR-TXT                                   
037300                    DL003-ASGMT-STRT-TM                                   
037400                    DL003-ASGMT-WK-TYP-DESC                               
037500                    DL003-ASGMT-WK-AREA-DESC                              
037600                    DL003-ASGMT-JOIN-TMST.                                
037700                                                                          
037800     MOVE 0 TO DL003-ASGMT-NBR-SEQ-NBR                                    
037900               DL003-ASGMT-DC-NBR.                                        
038000                                                                          
038100                                                                          
038200                                                                          
038300****************************************************************          
038400*    LOOKUP USING TEMPORARY USER ID                            *          
038500*                                                              *          
038600****************************************************************          
038700                                                                          
038800 4000-SELECT-BY-TEMP-USERID.                                              
038900                                                                          
039000     IF PS-DISPLAY-PARA                                                   
039100        DISPLAY '4000-SELECT-TEMP-USERID'.                                
039200                                                                          
039300     PERFORM                                                              
039400         WITH TEST AFTER                                                  
039500         VARYING PV-RETRY-COUNTER                                         
039600         FROM 1 BY 1                                                      
039700         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                          
039800            OR SQLCODE = ZERO                                             
039900            OR SQLCODE = +100                                             
040000            OR SQLCODE = -811                                             
040100                                                                          
040200         EXEC SQL                                                         
040300             SELECT                                                       
040400                    TEM.ASGMT_STRT_DTE                                    
040500                   ,TEM.ASGMT_NBR_TXT                                     
040600                   ,TEM.ASGMT_NBR_SEQ_NBR                                 
040700                   ,TEM.TEM_ASGMT_SEQ_NBR                                 
040800                   ,TEM.KOHLS_USR_ID                                      
040900                   ,TEM.TMP_USR_ID                                        
041000                   ,TEM.JN_TMST                                           
041100                   ,TEM.CRE_BY_USR_ID                                     
041200                                                                          
041300                   ,ASGMT.ASGMT_STRT_TM                                   
041400                   ,ASGMT.WK_TYP_DESC                                     
041500                   ,ASGMT.WK_AREA_DESC                                    
041600                   ,ASGMT.DC_NBR                                          
041700              INTO                                                        
041800                    :DLT00003-ASGMT-STRT-DTE                              
041900                   ,:DLT00003-ASGMT-NBR-TXT                               
042000                   ,:DLT00003-ASGMT-NBR-SEQ-NBR                           
042100                   ,:DLT00003-TEM-ASGMT-SEQ-NBR                           
042200                   ,:DLT00003-KOHLS-USR-ID                                
042300                                  :PV-KOHLS-USR-ID-NULL-IND               
042400                   ,:DLT00003-TMP-USR-ID                                  
042500                                  :PV-TMP-USR-ID-NULL-IND                 
042600                   ,:DLT00003-JN-TMST                                     
042700                   ,:DLT00003-CRE-BY-USR-ID                               
042800                                                                          
042900                   ,:DLT00004-ASGMT-STRT-TM                               
043000                   ,:DLT00004-WK-TYP-DESC                                 
043100                   ,:DLT00004-WK-AREA-DESC                                
043200                   ,:DLT00004-DC-NBR                                      
043300                                                                          
043400              FROM  DLT_TEM_ASGMT   TEM                                   
043500                   ,DLT_ASGMT       ASGMT                                 
043600                                                                          
043700             WHERE  TEM.TMP_USR_ID   = :DL003-KEY-USER-ID                 
043800               AND  TEM.LVE_RSN_CDE  = :PC-N                              
043900                                                                          
044000               AND  ASGMT.ASGMT_STRT_DTE    = TEM.ASGMT_STRT_DTE          
044100               AND  ASGMT.ASGMT_NBR_TXT     = TEM.ASGMT_NBR_TXT           
044200               AND  ASGMT.ASGMT_NBR_SEQ_NBR =                             
044300                                  TEM.ASGMT_NBR_SEQ_NBR                   
044400               AND  ASGMT.ASGMT_STP_RSN_CDE = :PC-N                       
044500         END-EXEC                                                         
044600                                                                          
044700         EVALUATE TRUE                                                    
044800             WHEN SQLCODE = ZERO                                          
044900                  SET PS-TEMP-USER-ONE-FOUND TO TRUE                      
045000                                                                          
045100             WHEN SQLCODE = -904                                          
045200             WHEN SQLCODE = -913                                          
045300             WHEN SQLCODE = -911                                          
045400                  CONTINUE                                                
045500                                                                          
045600             WHEN SQLCODE = -811                                          
045700                  SET PS-TEMP-USER-MANY-FOUND TO TRUE                     
045800                                                                          
045900             WHEN SQLCODE = +100                                          
046000                  SET PS-TEMP-USER-NONE-FOUND TO TRUE                     
046100                                                                          
046200             WHEN SQLWARN0 NOT = SPACES                                   
046300             WHEN SQLCODE NOT = ZERO                                      
046400                  MOVE +4             TO PV-RETRY-COUNTER                 
046500         END-EVALUATE                                                     
046600     END-PERFORM.                                                         
046700                                                                          
046800     IF PS-DISPLAY-DETAIL                                                 
046900        DISPLAY PC-FIVE-BLANKS                                            
047000                'PS-TEMP-USER-COUNT-SW - '                                
047100                 PS-TEMP-USER-COUNT-SW.                                   
047200                                                                          
047300     IF SQLCODE = ZERO OR                                                 
047400        SQLCODE = +100 OR                                                 
047500        SQLCODE = -811                                                    
047600        CONTINUE                                                          
047700     ELSE                                                                 
047800        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                              
047900           MOVE '4000-' TO DL003-SQL-ERROR-PARA                           
048000           SET DL003-SQL-ERROR TO TRUE                                    
048100           MOVE SQLCODE TO DL003-ASGMT-SQLCODE                            
048110           MOVE SQLCA               TO DL003-SQLCA                        
048200        END-IF                                                            
048300     END-IF.                                                              
048400                                                                          
048500****************************************************************          
048600*    COUNT ROWS USING KOHLS USER ID                            *          
048700*                                                              *          
048800****************************************************************          
048900                                                                          
049000 5000-COUNT-BY-KOHLS-USERID.                                              
049100                                                                          
049200     IF PS-DISPLAY-PARA                                                   
049300        DISPLAY '5000-COUNT-BY-KOHLS-USERID'.                             
049400                                                                          
049500     PERFORM                                                              
049600         WITH TEST AFTER                                                  
049700         VARYING PV-RETRY-COUNTER                                         
049800         FROM 1 BY 1                                                      
049900         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                          
050000            OR SQLCODE = ZERO                                             
050100            OR SQLCODE = +100                                             
050200                                                                          
050300         EXEC SQL                                                         
050400             SELECT                                                       
050500                    COUNT(*)                                              
050600                                                                          
050700              INTO                                                        
050800                    :PV-KOHLS-USERID-COUNT                                
050900                                                                          
051000              FROM  DLT_TEM_ASGMT   TEM                                   
051100                   ,DLT_ASGMT       ASGMT                                 
051200                                                                          
051300             WHERE  TEM.KOHLS_USR_ID = :DL003-KEY-USER-ID                 
051400               AND  TEM.LVE_RSN_CDE  = :PC-N                              
051500                                                                          
051600               AND  ASGMT.ASGMT_STRT_DTE    = TEM.ASGMT_STRT_DTE          
051700               AND  ASGMT.ASGMT_NBR_TXT     = TEM.ASGMT_NBR_TXT           
051800               AND  ASGMT.ASGMT_NBR_SEQ_NBR =                             
051900                                  TEM.ASGMT_NBR_SEQ_NBR                   
052000               AND  ASGMT.ASGMT_STP_RSN_CDE = :PC-N                       
052100         END-EXEC                                                         
052200**??                TEM.KOHLS_USR_ID                                      
052300**??                :DLT00003-KOHLS-USR-ID                                
052400                                                                          
052500         EVALUATE TRUE                                                    
052600             WHEN SQLCODE = ZERO                                          
052700**??              CONTINUE                                                
052800                  IF PS-DISPLAY-DETAIL                                    
052900                     DISPLAY PC-FIVE-BLANKS                               
053000                             'TOTAL COUNT IS ----> '                      
053100                              PV-KOHLS-USERID-COUNT                       
053200                  END-IF                                                  
053300                                                                          
053400             WHEN SQLCODE = -904                                          
053500             WHEN SQLCODE = -913                                          
053600             WHEN SQLCODE = -911                                          
053700                  CONTINUE                                                
053800                                                                          
053900             WHEN SQLCODE = +100                                          
054000                  CONTINUE                                                
054100                                                                          
054200             WHEN SQLWARN0 NOT = SPACES                                   
054300             WHEN SQLCODE NOT = ZERO                                      
054400                  MOVE +4             TO PV-RETRY-COUNTER                 
054500         END-EVALUATE                                                     
054600     END-PERFORM.                                                         
054700                                                                          
054800     IF SQLCODE NOT = ZERO AND                                            
054900        PV-RETRY-COUNTER > PC-MAX-RETRIES                                 
055000                                                                          
055100        MOVE '5000-' TO DL003-SQL-ERROR-PARA                              
055200        SET DL003-SQL-ERROR TO TRUE                                       
055300        MOVE SQLCODE TO DL003-ASGMT-SQLCODE                               
055310        MOVE SQLCA               TO DL003-SQLCA                           
055400     END-IF.                                                              
055500                                                                          
055600****************************************************************          
055700*    COUNT ROWS USING TEMPORARY USER ID                        *          
055800*                                                              *          
055900****************************************************************          
056000                                                                          
056100 5400-COUNT-BY-TEMP-USERID.                                               
056200                                                                          
056300     IF PS-DISPLAY-PARA                                                   
056400        DISPLAY '5400-COUNT-BY-TEMP-USERID'.                              
056500                                                                          
056600     PERFORM                                                              
056700         WITH TEST AFTER                                                  
056800         VARYING PV-RETRY-COUNTER                                         
056900         FROM 1 BY 1                                                      
057000         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                          
057100            OR SQLCODE = ZERO                                             
057200            OR SQLCODE = +100                                             
057300                                                                          
057400         EXEC SQL                                                         
057500             SELECT                                                       
057600                    COUNT(*)                                              
057700                                                                          
057800              INTO                                                        
057900                    :PV-TEMP-USERID-COUNT                                 
058000                                                                          
058100              FROM  DLT_TEM_ASGMT   TEM                                   
058200                   ,DLT_ASGMT       ASGMT                                 
058300                                                                          
058400             WHERE  TEM.TMP_USR_ID  = :DL003-KEY-USER-ID                  
058500               AND  TEM.LVE_RSN_CDE = :PC-N                               
058600                                                                          
058700               AND  ASGMT.ASGMT_STRT_DTE    = TEM.ASGMT_STRT_DTE          
058800               AND  ASGMT.ASGMT_NBR_TXT     = TEM.ASGMT_NBR_TXT           
058900               AND  ASGMT.ASGMT_NBR_SEQ_NBR =                             
059000                                  TEM.ASGMT_NBR_SEQ_NBR                   
059100               AND  ASGMT.ASGMT_STP_RSN_CDE = :PC-N                       
059200         END-EXEC                                                         
059300**??                TEM.TMP_USR_ID                                        
059400**??                :DLT00003-TMP-USR-ID                                  
059500                                                                          
059600         EVALUATE TRUE                                                    
059700             WHEN SQLCODE = ZERO                                          
059800**??              CONTINUE                                                
059900                  IF PS-DISPLAY-DETAIL                                    
060000                     DISPLAY PC-FIVE-BLANKS                               
060100                             'TOTAL COUNT IS ----> '                      
060200                              PV-TEMP-USERID-COUNT                        
060300                  END-IF                                                  
060400                                                                          
060500             WHEN SQLCODE = -904                                          
060600             WHEN SQLCODE = -913                                          
060700             WHEN SQLCODE = -911                                          
060800                  CONTINUE                                                
060900                                                                          
061000             WHEN SQLCODE = +100                                          
061100                  CONTINUE                                                
061200                                                                          
061300             WHEN SQLWARN0 NOT = SPACES                                   
061400             WHEN SQLCODE NOT = ZERO                                      
061500                  MOVE +4             TO PV-RETRY-COUNTER                 
061600         END-EVALUATE                                                     
061700     END-PERFORM.                                                         
061800                                                                          
061900     IF SQLCODE NOT = ZERO AND                                            
062000        PV-RETRY-COUNTER > PC-MAX-RETRIES                                 
062100                                                                          
062200        MOVE '5400-' TO DL003-SQL-ERROR-PARA                              
062300        SET DL003-SQL-ERROR      TO TRUE                                  
062400        MOVE SQLCODE TO DL003-ASGMT-SQLCODE                               
062410        MOVE SQLCA               TO DL003-SQLCA                           
062500     END-IF.                                                              
062600                                                                          
062700                                                                          
062800 6000-DISPLAY-DATA.                                                       
062900                                                                          
063000     DISPLAY '6000-DISPLAY-DATA - DLT00003 -> '                           
063100              DLT00003-KOHLS-USR-ID                                       
063200             ' - '                                                        
063300              DLT00003-ASGMT-STRT-DTE                                     
063400             ' - '                                                        
063500              DLT00003-ASGMT-NBR-TXT                                      
063600             ' - '                                                        
063700              DLT00003-ASGMT-NBR-SEQ-NBR                                  
063800             ' - '                                                        
063900              DLT00003-TMP-USR-ID                                         
064000             ' - '                                                        
064100              DLT00003-JN-TMST                                            
064200             ' - '                                                        
064300              DLT00003-CRE-BY-USR-ID.                                     
064400                                                                          
064500     DISPLAY '6000-DISPLAY-DATA - DLT00003 -> '                           
064600              DLT00004-ASGMT-STRT-TM                                      
064700             ' - '                                                        
064800              DLT00004-WK-TYP-DESC                                        
064900             ' - '                                                        
065000              DLT00004-WK-AREA-DESC                                       
065100             ' - '                                                        
065200              DLT00004-DC-NBR.                                            
065300                                                                          
065400                                                                          
065500                                                                          
