000100 IDENTIFICATION DIVISION.                                         00010001
000200 TITLE 'TRAILER CHECK-IN'.                                        00020012
000810*                                                                 00081001
000820 PROGRAM-ID.   WSKCS308.                                          00082012
000830 AUTHOR.        PATRICK BURKE.                                    00083001
000840 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00084001
000850 DATE-WRITTEN.  MARCH 2007.                                       00085001
000860 DATE-COMPILED.                                                   00086001
000870 ENVIRONMENT DIVISION.                                            00087001
000880 CONFIGURATION SECTION.                                           00088001
000890 SOURCE-COMPUTER. IBM-3090.                                       00089001
000900 OBJECT-COMPUTER. IBM-3090.                                       00090001
001000                                                                  00100001
001100 DATA DIVISION.                                                   00110001
001200 WORKING-STORAGE SECTION.                                         00120001
001300 01  PV-VARIABLES.                                                00130001
002200     05  PV-CURRENT-TIMESTAMP         PIC X(26) VALUE SPACES.     00220001
002210     05  PV-RECVD-TMST-WM.                                        00221024
002220         10  PV-RECVD-TMST-WM-DATE      PIC X(10).                00222024
002230         10  FILLER                     PIC X(01).                00223024
002240         10  PV-RECVD-TMST-WM-TIME      PIC X(08).                00224025
002250         10  FILLER                     PIC X(07).                00225024
002300     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         00230001
002400                                                COMP SYNC.        00240001
002410     05  PV-SQL-RETURN-CD             PIC -9(04).                 00241070
002443     05  PV-SHIPMNT-NBR               PIC X(20)  VALUE SPACES.    00244301
002444     05  PV-SHIPMNT-NBR-R REDEFINES PV-SHIPMNT-NBR.               00244401
002450         10  PV-K                     PIC X(1).                   00245001
002460         10  PV-RANDOM-NBR            PIC 9(09).                  00246001
002461         10  PV-D                     PIC X(1).                   00246101
002462         10  PV-DUMMY-NBR             PIC 9(04).                  00246201
002463         10  PV-UNUSED                PIC X(05).                  00246301
002464     05  PV-CMPR-STATUS-TME.                                      00246405
002465         10  PV-CMPR-STATUS-TME-HH      PIC 9(02).                00246505
002466         10  FILLER                     PIC X(01).                00246605
002467         10  PV-CMPR-STATUS-TME-MM      PIC 9(02).                00246705
002468         10  FILLER                     PIC X(01).                00246805
002469         10  PV-CMPR-STATUS-TME-SS      PIC 9(02).                00246905
002470     05  PV-CMPR-STATUS-DTE             PIC X(10)  VALUE SPACES.  00247005
002471     05  PV-DB2-HOST-DATE               PIC X(10)  VALUE SPACES.  00247105
002472     05  PV-DB2-HOST-DATE-30            PIC X(10)  VALUE SPACES.  00247205
002473     05  PV-DB2-HOST-TIME               PIC X(08)  VALUE SPACES.  00247305
002474     05  PV-TRBL-RETRY-COUNTER          PIC S9(04)  VALUE +0      00247405
002475                                                    COMP SYNC.    00247505
002476     05  PV-REC-TMST                    PIC X(26)  VALUE SPACES.  00247605
002477     05  PV-DISPLAY-1                   PIC 9(09)  VALUE ZERO.    00247737
002478     05  PV-DISPLAY-2                   PIC 9(09)  VALUE ZERO.    00247838
002479     05  PV-CICS-RESP                   PIC S9(04) VALUE +0       00247938
002480                                                     COMP SYNC.   00248038
002481     05  PV-CICS-MSG-AREA               PIC X(100) VALUE SPACE.   00248138
002482     05  PV-COMMAREA-LENGTH             PIC S9(04) VALUE +0       00248238
002483                                                     COMP SYNC.   00248338
002484                                                                  00248431
002485 01  PS-PROGRAM-SWITCHES.                                         00248531
002486      05  PS-TRIP-STATUS-INSERT-SW          PIC  X(01)  VALUE 'N'.00248631
002490          88  PS-TRIP-STATUS-INSERT-YES              VALUE 'Y'.   00249013
002500          88  PS-TRIP-STATUS-INSERT-NO               VALUE 'N'.   00250013
002600      05  PS-NO-MORE-RECEIVRS-SW         PIC  X(01)  VALUE 'N'.   00260005
002610          88  PS-NO-MORE-RECEIVRS                    VALUE 'Y'.   00261005
002700      05  PS-SHIPMENT-CURSOR-SW          PIC  X(01)  VALUE 'N'.   00270005
002710          88  PS-NO-MORE-SHIPMENTS                   VALUE 'Y'.   00271005
002720      05  PS-CICS-SWITCH-IND             PIC X(01)   VALUE 'N'.   00272032
002730          88  PS-CICS-SWITCH-NO                      VALUE 'N'.   00273032
002740          88  PS-CICS-SWITCH-YES                     VALUE 'Y'.   00274032
002750* JAK 08/2007 ADD ERROR SWITCH                                    00275066
002751      05  PS-ERROR-SW                    PIC X(01)   VALUE 'N'.   00275166
002760          88  PS-ERROR-SW-NO                         VALUE 'N'.   00276066
002770          88  PS-ERROR-SW-YES                        VALUE 'Y'.   00277066
002780      05  PS-RPA-MISDRCT-CK-SW           PIC X(01)   VALUE 'N'.   00278078
002790          88  PS-RPA-MISDRCT-CK                      VALUE 'Y'.   00279078
002791          88  PS-NO-RPA-MISDRCT-CK                   VALUE 'N'.   00279178
002800                                                                  00280005
003300 01  WS-FIELDS.                                                   00330001
003400     05  WS-EXT-SHP-ID                PIC X(20).                  00340001
003410     05  WS-TRIP-ID                   PIC S9(09) COMP.            00341001
003501     05  WS-RCPT-TMST                 PIC X(26).                  00350101
003510     05  WS-VER-NBR                   PIC S9(04) COMP.            00351001
003600                                                                  00360001
003700 01  DK-KEYS.                                                     00370001
003800     05  DK-SHIPT-ID-N                PIC S9(09) COMP.            00380015
003801     05  DK-SHIPT-ID                  PIC X(20).                  00380115
003802     05  DK-SHPMT-ID-LIKE             PIC X(20).                  00380275
003803     05  DK-SHPMT-ID-LIKE-R REDEFINES DK-SHPMT-ID-LIKE.           00380375
003804         10  DK-SHPMT-BEGIN               PIC X(10).              00380474
003805         10  DK-SHPMT-LIKE                PIC X(01).              00380574
003806         10  FILLER                       PIC X(09).              00380674
003807     05  DK-OPER-UNT-ID               PIC S9(04) COMP.            00380774
003810     05  DK-TRIP-ID                   PIC S9(09) VALUE +0         00381006
003820                                                 COMP.            00382006
003830                                                                  00383062
003900*** RS 6/2007 ADD DK KEYS AND DB2 NULL INDICATOR TO PERFORM       00390055
003910*** RS        UPDATES TO TVEHICL AND TAUVHCL TABLES.              00391063
003920                                                                  00392055
004000     05  DK-SCAC-ID                     PIC  X(04)  VALUE SPACE.  00400055
004100     05  DK-VEH-NBR                     PIC  X(10)  VALUE SPACE.  00410055
004110                                                                  00411055
004120 01  DN-DB2-NULL-INDICATORS.                                      00412055
004130     05  DN-CURR-TRIP-ID                PIC S9(04) COMP VALUE +0. 00413055
004140                                                                  00414055
004200 01  PC-CONSTANTS.                                                00420001
004300     05  PC-MAX-RETRIES              PIC S9(04) VALUE +3          00430001
004400                                                COMP.             00440001
004500     05  PC-DEFAULT-NINES            PIC X(26)  VALUE             00450001
004600                              '9999-09-09-09.09.09.999999'.       00460001
004711     05  PC-SHIP-ASN-MOD             PIC X(08)  VALUE             00471101
004712                                                 'WSKCS304'.      00471201
004713     05  PC-SHIP-ASN-MOD-LENGTH      PIC S9(4) VALUE +100         00471301
004714                                                COMP SYNC.        00471401
004715     05  PC-TMKCS520                 PIC X(08)   VALUE            00471504
004716                                                 'TMKCS520'.      00471604
004720     05  PC-ZERO                        PIC S9(04)  VALUE +0      00472007
004721                                                    COMP.         00472107
004724     05  PC-24                          PIC  9(02)  VALUE 24.     00472406
004725     05  PC-59                          PIC  9(02)  VALUE 59.     00472506
004726     05  PC-997                         PIC S9(04)  VALUE +997    00472606
004727                                                    COMP.         00472706
004728     05  PC-998                         PIC S9(04)  VALUE +998    00472806
004729                                                    COMP.         00472906
004730     05  PC-999                         PIC S9(04)  VALUE +999    00473006
004731                                                    COMP.         00473106
004732     05  PC-I                           PIC  X(01)  VALUE 'I'.    00473206
004733     05  PC-N                           PIC  X(01)  VALUE 'N'.    00473306
004734     05  PC-SPACES                      PIC  X(22)  VALUE  SPACES.00473406
004735     05  PC-CREATE-AUTO-MSG             PIC X(42) VALUE           00473505
004736         'CREATED AUTOMATICALLY WHEN TRAILER ARRIVED'.            00473605
004737     05  PC-RESOLVE-AUTO-MSG             PIC X(43) VALUE          00473705
004740         'RESOLVED AUTOMATICALLY WHEN TRAILER ARRIVED'.           00474005
004741                                                                  00474181
004742     05  PC-E838-RPAMSD                 PIC  X(04) VALUE 'E838'.  00474281
004750                                                                  00475005
004790/                                                                 00479001
004791*----------------------------------------------------------------*00479105
004792*  COMMAREA FOR TMKCS520 -- TROUBLE PROCESSING MODULE            *00479205
004793*----------------------------------------------------------------*00479305
004794     COPY TMWS500.                                                00479405
004796/                                                                 00479605
004798*----------------------------------------------------------------*00479830
004799*  LAYOUT FOR THE ABEND COMMUNICATIONS AREA                       00479930
004800*----------------------------------------------------------------*00480030
004801     COPY DPWS013.                                                00480130
004802/                                                                 00480230
004804*----------------------------------------------------------------*00480405
004805* * *  COMM AREA TO BE PASSED TO WSKUT010                         00480501
004806*----------------------------------------------------------------*00480605
004807     COPY WSWS007.                                                00480701
004808                                                                  00480803
004809*----------------------------------------------------------------*00480905
004810* * *  RECEIPT PIX TRANSACTIONS FROM WMOS                         00481001
004811*----------------------------------------------------------------*00481105
004812     COPY WSRD014.                                                00481201
004813                                                                  00481301
004814*---------------------------------------------------------------* 00481478
004815*  RECORD LAYOUT RPA MISDIRECT CALLED MODULE RCKCS838           * 00481578
004816*---------------------------------------------------------------* 00481678
004817     COPY RCWS077.                                                00481778
004818                                                                  00481878
004819*---------------------------------------------------------------* 00481903
004820* * * WST_SHPMT_XREF_HDR VIEW                                     00482001
004821*---------------------------------------------------------------* 00482103
004822     EXEC SQL                                                     00482201
004823         INCLUDE WST00001                                         00482301
004830     END-EXEC.                                                    00483001
004831/                                                                 00483103
004832*---------------------------------------------------------------* 00483276
004833* * * WST_SHPMT_XREF_DTL VIEW                                     00483376
004834*---------------------------------------------------------------* 00483476
004835     EXEC SQL                                                     00483576
004836         INCLUDE WST00002                                         00483676
004837     END-EXEC.                                                    00483776
004838/                                                                 00483876
004839*---------------------------------------------------------------* 00483933
004840* * * WST_ATTR_DEFN VIEW                                          00484033
004841*---------------------------------------------------------------* 00484133
004842     EXEC SQL                                                     00484233
004843         INCLUDE WST00009                                         00484333
004844     END-EXEC.                                                    00484433
004845/                                                                 00484533
004846*---------------------------------------------------------------* 00484633
004847* * * WST_ATTR_ELEM VIEW                                          00484733
004848*---------------------------------------------------------------* 00484833
004849     EXEC SQL                                                     00484933
004850         INCLUDE WST00010                                         00485033
004851     END-EXEC.                                                    00485133
004852/                                                                 00485233
004853*---------------------------------------------------------------* 00485333
004854* * * WST_INTGRTN_TYP VIEW                                        00485433
004855*---------------------------------------------------------------* 00485533
004856     EXEC SQL                                                     00485633
004857         INCLUDE WST00008                                         00485733
004858     END-EXEC.                                                    00485833
004859/                                                                 00485933
004860*---------------------------------------------------------------* 00486003
004861*    DB2 AREA FOR THE TRIP STATUS TABLE                         * 00486103
004862*---------------------------------------------------------------* 00486203
004870     EXEC SQL                                                     00487003
004880          INCLUDE TTRIPST                                         00488003
004890     END-EXEC.                                                    00489003
005000/                                                                 00500003
005001*---------------------------------------------------------------* 00500106
005002*    DB2 AREA FOR THE TSHSTYP TABLE                               00500206
005003*---------------------------------------------------------------* 00500306
005004     EXEC SQL                                                     00500406
005005          INCLUDE TSHSTYP                                         00500506
005006     END-EXEC.                                                    00500606
005007/                                                                 00500706
005008*---------------------------------------------------------------* 00500806
005009*    DB2 AREA FOR THE SHIPMENT TABLE                            * 00500906
005010*---------------------------------------------------------------* 00501006
005011     EXEC SQL                                                     00501106
005012          INCLUDE TSHIPMT                                         00501206
005013     END-EXEC.                                                    00501306
005014/                                                                 00501406
005015*---------------------------------------------------------------* 00501506
005016*    DB2 AREA FOR THE SHIPMT PO TABLE                           * 00501606
005017*---------------------------------------------------------------* 00501706
005018     EXEC SQL                                                     00501806
005019          INCLUDE TSHPTPO                                         00501906
005020     END-EXEC.                                                    00502006
005021/                                                                 00502106
005022*---------------------------------------------------------------* 00502206
005023*    DB2 AREA FOR THE SHIPST PO TABLE                           * 00502306
005024*---------------------------------------------------------------* 00502406
005025     EXEC SQL                                                     00502506
005026          INCLUDE TSHIPST                                         00502606
005027     END-EXEC.                                                    00502706
005028/                                                                 00502806
005029*---------------------------------------------------------------* 00502906
005030*    DB2 AREA FOR THE RECEIVER TABLE                            * 00503006
005031*---------------------------------------------------------------* 00503106
005032     EXEC SQL                                                     00503206
005033          INCLUDE TRECEIV                                         00503306
005034     END-EXEC.                                                    00503406
005035/                                                                 00503506
005036*---------------------------------------------------------------* 00503606
005037*    DB2 AREA FOR TROUBLE NOTIFICATION TABLE                    * 00503706
005038*---------------------------------------------------------------* 00503806
005039     EXEC SQL                                                     00503906
005040          INCLUDE TTRBNTF                                         00504006
005041     END-EXEC.                                                    00504106
005042/                                                                 00504206
005043*----------------------------------------------------------------*00504353
005044*    DB2 DCLGEN FOR THE TVHTRIP TABLE                             00504453
005045*----------------------------------------------------------------*00504553
005046     EXEC SQL                                                     00504653
005047          INCLUDE TVHTRIP                                         00504753
005048     END-EXEC.                                                    00504853
005049                                                                  00504953
005050*---------------------------------------------------------------* 00505053
005051*    DB2 AREA FOR THE VEHICLE TABLE                             * 00505153
005052*---------------------------------------------------------------* 00505253
005053     EXEC SQL                                                     00505353
005054          INCLUDE TVEHICL                                         00505453
005055     END-EXEC.                                                    00505553
005056                                                                  00505653
005057*---------------------------------------------------------------* 00505753
005058*    DB2 AREA FOR VEHICLE AUDIT TABLE                           * 00505853
005059*---------------------------------------------------------------* 00505953
005060     EXEC SQL                                                     00506053
005061          INCLUDE TAUVHCL                                         00506153
005062     END-EXEC.                                                    00506253
005063                                                                  00506353
005064*---------------------------------------------------------------* 00506479
005065*    DB2 AREA FOR PARM TABLE                                    * 00506579
005066*---------------------------------------------------------------* 00506679
005067     EXEC SQL                                                     00506779
005068          INCLUDE TKRPRPM                                         00506879
005069     END-EXEC.                                                    00506979
005070                                                                  00507079
005080*---------------------------------------------------------------* 00508053
005100* * * COMMUNICATIONS AREA FOR DB2                                 00510003
005110*---------------------------------------------------------------* 00511003
005200     EXEC SQL                                                     00520003
005300          INCLUDE SQLCA                                           00530003
005400     END-EXEC.                                                    00540003
005500/                                                                 00550003
005600*---------------------------------------------------------------* 00560003
005700*  CURSOR TO LIST RECEIVERS FOR A TRIP                          * 00570003
005800*---------------------------------------------------------------* 00580003
005900                                                                  00590003
006000     EXEC SQL                                                     00600003
006100          DECLARE RECEIVR-CSR CURSOR FOR                          00610003
006200           SELECT C.ORD_NBR                                       00620003
006300                , C.REC_SEQ_NBR                                   00630003
006510                , C.STATUS_CDE                                    00651061
006520                , C.CRE_TMST                                      00652062
006600            FROM  TSHIPMT A                                       00660003
006700                , TSHPTPO B                                       00670003
006800                , TRECEIV C                                       00680003
006900           WHERE  A.TRIP_ID     = :DK-TRIP-ID                     00690003
007000             AND  A.TRIP_ID IS NOT NULL                           00700003
007100             AND  A.SHIPT_ID    = B.SHIPT_ID                      00710003
007200             AND  B.REC_SEQ_NBR > :PC-ZERO                        00720003
007300             AND  B.REC_SEQ_NBR = C.REC_SEQ_NBR                   00730003
007400             AND  B.PO_NBR      = C.ORD_NBR                       00740003
007500     END-EXEC.                                                    00750003
007601/                                                                 00760103
007610*---------------------------------------------------------------* 00761003
007620*  CURSOR TO LIST SHIPMENTS FOR A TRIP                          * 00762003
007630*---------------------------------------------------------------* 00763003
007650     EXEC SQL                                                     00765003
007660          DECLARE SHIPMENT-CSR CURSOR FOR                         00766003
007670           SELECT SHIPT_ID                                        00767003
007680            FROM  TSHIPMT                                         00768003
007690           WHERE (TRIP_ID = :DK-TRIP-ID                           00769003
007691             AND  TRIP_ID IS NOT NULL)                            00769103
007692         ORDER BY SHIPT_ID                                        00769203
007693     END-EXEC.                                                    00769303
007700/                                                                 00770003
007710******************************************************************00771017
007720 LINKAGE SECTION.                                                 00772017
007730 01  DFHCOMMAREA.                                                 00773017
007740     05  FILLER                         OCCURS  1 TO 4072 TIMES   00774017
007741                                      DEPENDING ON EIBCALEN.      00774117
007742         10  FILLER                   PIC X.                      00774217
007744******************************************************************00774401
007745 PROCEDURE DIVISION.                                              00774501
007746******************************************************************00774601
007747 0000-PROGRAM-MAINLINE.                                           00774701
007748                                                                  00774801
007751     INITIALIZE                        WS007-RECEIPT-PIX-RECORD.  00775116
007752     MOVE DFHCOMMAREA              TO  WS007-RECEIPT-PIX-RECORD.  00775216
007753     MOVE WS007-WSRD014-RECORD     TO WS014-RECEIPT-PIX-RECORD.   00775316
007754     SET PS-ERROR-SW-NO            TO TRUE.                       00775466
007755                                                                  00775566
007756     PERFORM 1000-INITIALIZE.                                     00775666
007757                                                                  00775766
007758     INITIALIZE PV-CICS-MSG-AREA.                                 00775866
007759     STRING   ' ' WS007-SRC-TASK-NUMBER                           00775966
007760              ' WSKCS308 CALLED FROM '                            00776066
007761              WS007-CALLING-PROGRAM-NAME                          00776166
007762              ' TIME '                                            00776266
007763               WS014-CRE-TMST                                     00776366
007764              DELIMITED BY SIZE                                   00776466
007765                                 INTO PV-CICS-MSG-AREA.           00776566
007766     PERFORM 8000-WRITE-TO-CICS-LOG.                              00776666
007767                                                                  00776766
007768     INITIALIZE PV-CICS-MSG-AREA.                                 00776866
007769     STRING   WS007-WSRD014-RECORD(1:80)                          00776966
007770              DELIMITED BY SIZE                                   00777066
007771                                 INTO PV-CICS-MSG-AREA.           00777166
007772     PERFORM 8000-WRITE-TO-CICS-LOG.                              00777266
007773                                                                  00777366
007774     INITIALIZE PV-CICS-MSG-AREA.                                 00777466
007775     STRING   WS007-WSRD014-RECORD(81:80)                         00777566
007776              DELIMITED BY SIZE                                   00777666
007777                                 INTO PV-CICS-MSG-AREA.           00777766
007778     PERFORM 8000-WRITE-TO-CICS-LOG.                              00777866
007779                                                                  00777966
007780     IF WS014-RTE-TO-RCVNG  AND                                   00778066
007781        (WS014-TRLR-CHECK-IN OR WS014-VERIFY-SHIPMT)              00778166
007782                                                                  00778266
007783        IF WS014-TRLR-CHECK-IN                                    00778313
007784           PERFORM 2000-PROCESS-TRLR-CHECK-IN                     00778413
007785        END-IF                                                    00778513
007786        IF WS014-VERIFY-SHIPMT                                    00778613
007787           PERFORM 2100-PROCESS-VERIFY-SHIPMT                     00778713
007788        END-IF                                                    00778813
007789     ELSE                                                         00778901
007790* JAK 08/2007 - CHG ERROR INDICATOR                               00779065
007791****    SET WS007-ERROR TO TRUE                                   00779165
007792        SET WS007-INVALID-REC-TYP    TO TRUE                      00779265
007793        SET PS-ERROR-SW-YES          TO TRUE                      00779366
007794        MOVE '0000-PROGRAM-MAINLINE' TO WS007-SQL-ERROR-PARA      00779466
007795        MOVE 'INVALID RECORD TYPE'   TO WS007-CRA-RET-MSG         00779566
007796                                                                  00779666
007797        SET DP013-DB2-ABEND    TO TRUE                            00779766
007798                                                                  00779866
007799        INITIALIZE PV-CICS-MSG-AREA                               00779966
007800        STRING   ' ' WS007-SRC-TASK-NUMBER                        00780066
007801                 ' WSKCS308-MAIN: INVALID CASE NBR:'              00780166
007802                 WS014-CASE-NUMBER                                00780266
007803                 DELIMITED BY SIZE                                00780366
007804                                    INTO PV-CICS-MSG-AREA         00780466
007810        PERFORM 8000-WRITE-TO-CICS-LOG                            00781030
007820        PERFORM 9999-ABEND                                        00782030
007900     END-IF.                                                      00790001
009816                                                                  00981601
009830*    GOBACK.                                                      00983030
009831     INITIALIZE PV-CICS-MSG-AREA.                                 00983130
009832     STRING   ' ' WS007-SRC-TASK-NUMBER                           00983230
009833              ' EXITING FROM WSKCS308'                            00983330
009834              DELIMITED BY SIZE                                   00983430
009835                                 INTO PV-CICS-MSG-AREA.           00983530
009836     PERFORM 8000-WRITE-TO-CICS-LOG.                              00983630
009837                                                                  00983730
009838     MOVE WS007-RECEIPT-PIX-RECORD      TO DFHCOMMAREA.           00983830
009839                                                                  00983930
009840     EXEC CICS                                                    00984030
009841         RETURN                                                   00984130
009842     END-EXEC.                                                    00984230
009843                                                                  00984330
009844                                                                  00984401
009845******************************************************************00984501
009846* INITIALIZE VARIABLES.                                           00984601
009847* SET SWITCHES.                                                   00984701
009850******************************************************************00985001
010000 1000-INITIALIZE.                                                 01000001
010100                                                                  01010001
010200     INITIALIZE PV-VARIABLES.                                     01020001
010300     MOVE WS014-CRE-TMST TO PV-RECVD-TMST-WM                      01030026
010400     MOVE WS014-DC-LOCATION TO  DK-OPER-UNT-ID.                   01040026
010500                                                                  01050030
010600     PERFORM 1100-CICS-LOGGING.                                   01060030
010700                                                                  01070030
010710/                                                                 01071030
010720 1100-CICS-LOGGING.                                               01072030
010730* READ PARM TO DETERMINE CICS LOGGING                             01073030
010740                                                                  01074030
010750     EXEC SQL                                                     01075030
010760         SELECT  D.ATTR_ELEM_TXT                                  01076030
010770         INTO  :PS-CICS-SWITCH-IND                                01077030
010780         FROM   WST_INTGRTN_TYP A                                 01078030
010790              , WST_ATTR_DEFN   B                                 01079030
010791              , WST_ATTR_ELEM   C                                 01079130
010792              , WST_ATTR_ELEM   D                                 01079230
010793         WHERE  A.INTGRTN_TYP_CDE   = 'CSSLLOG'                   01079330
010795           AND  A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE           01079530
010796           AND  B.ATTR_DEFN_SEQ_NBR = 1                           01079630
010797           AND  B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE           01079730
010798           AND  C.ATTR_DEFN_SEQ_NBR = 1                           01079830
010799           AND  B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE           01079930
010800           AND  D.ATTR_DEFN_SEQ_NBR = 2                           01080030
010801           AND  C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR         01080130
010802           AND  C.ATTR_ELEM_TXT     = 'WSKCS308'                  01080230
010803     END-EXEC.                                                    01080330
010804                                                                  01080430
010805     EVALUATE TRUE                                                01080530
010806         WHEN SQLCODE = ZERO                                      01080630
010807             IF PS-CICS-SWITCH-YES                                01080730
010808                 STRING   ' ' WS007-SRC-TASK-NUMBER               01080830
010809                          ' WSKCS308-1100:'                       01080931
010810                          ' CICS LOGGING TURNED ON'               01081030
010811                          DELIMITED BY SIZE                       01081130
010812                                      INTO PV-CICS-MSG-AREA       01081230
010813                 PERFORM 8000-WRITE-TO-CICS-LOG                   01081330
010814             END-IF                                               01081430
010815         WHEN SQLCODE = -904                                      01081530
010816         WHEN SQLCODE = -913                                      01081630
010817         WHEN SQLCODE = -911                                      01081730
010818         WHEN SQLCODE = -803                                      01081830
010819             CONTINUE                                             01081930
010820         WHEN SQLWARN0 NOT = SPACES                               01082030
010821         WHEN SQLCODE NOT = ZERO                                  01082130
010822             MOVE SQLCODE             TO WS007-SQLCODE            01082230
010823                                         PV-SQL-RETURN-CD         01082330
010824             INITIALIZE PV-CICS-MSG-AREA                          01082430
010825             STRING   ' ' WS007-SRC-TASK-NUMBER                   01082530
010826                      ' WSKCS308-1100 ERROR:'                     01082630
010827                      ' SQL='                                     01082730
010828                      PV-SQL-RETURN-CD                            01082830
010829                      DELIMITED BY SIZE                           01082930
010830                                   INTO PV-CICS-MSG-AREA          01083030
010831             PERFORM 8000-WRITE-TO-CICS-LOG                       01083130
010832                                                                  01083230
010833             SET WS007-INVALID-SQL    TO TRUE                     01083330
010834             MOVE '1100-CICS-LOGGING'                             01083430
010835                                      TO WS007-SQL-ERROR-PARA     01083530
010836                                         DP013-PARAGRAPH          01083630
010837             MOVE SQLCA               TO WS007-SQLCA              01083730
010838                                         DP013-SQLCA              01083830
010839             STRING 'SQL='                                        01083930
010840                  PV-SQL-RETURN-CD                                01084030
010841                  DELIMITED BY SIZE                               01084130
010842                                    INTO WS007-CRA-RET-MSG        01084230
010843             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   01084330
010844             MOVE 'WST_INTGRTN_TYP'   TO                          01084430
010845                                       DP013-DB2-TABLE-NAME (1)   01084530
010846             MOVE 'WST_ATTR_DEFN'     TO                          01084630
010847                                       DP013-DB2-TABLE-NAME (2)   01084730
010848             MOVE 'WST_ATTR_ELEM'     TO                          01084830
010849                                       DP013-DB2-TABLE-NAME (3)   01084930
010850             SET DP013-DB2-ABEND  TO TRUE                         01085030
010851             PERFORM 9999-ABEND                                   01085130
010852     END-EVALUATE.                                                01085230
010860                                                                  01086030
010900                                                                  01090030
044501/                                                                 04450101
044502******************************************************************04450213
044503* TRAILER CHECK IN PROCESS.                                       04450313
044504******************************************************************04450401
044505 2000-PROCESS-TRLR-CHECK-IN.                                      04450513
044506     IF PS-CICS-SWITCH-YES                                        04450668
044507         MOVE SPACES TO PV-CICS-MSG-AREA                          04450768
044508         STRING   ' ' WS007-SRC-TASK-NUMBER                       04450868
044509                  ' WSKCS308:'                                    04450968
044510                  ' 2000-PROCESS-TRLR-CHECK-IN'                   04451068
044511                                   DELIMITED BY SIZE              04451168
044512                              INTO PV-CICS-MSG-AREA               04451268
044513         PERFORM 8000-WRITE-TO-CICS-LOG                           04451368
044514     END-IF.                                                      04451468
044515                                                                  04451503
044516     PERFORM 3000-SELECT-WST-XREF.                                04451603
044517     PERFORM 3100-UPDATE-WST-XREF                                 04451721
044518     IF WST00001-DMY-SEQ-NBR = 0                                  04451848
044519        PERFORM 5300-SELECT-TTRIPST                               04451948
044520        IF PS-TRIP-STATUS-INSERT-YES                              04452048
044521           PERFORM 5400-INSERT-TTRIPST                            04452148
044522        END-IF                                                    04452249
044523                                                                  04452348
044524        PERFORM 5500-INSERT-TSHIPST                               04452448
044525        PERFORM 4000-GET-OWNER-SCAC-ID                            04452563
044526        MOVE 'AR'          TO VEHICL-CURR-STATUS-CDE              04452663
044527        PERFORM 4200-UPDATE-TVEHICL                               04452763
044528        PERFORM 4400-AUDIT-TVEHICL                                04452863
044529     END-IF.                                                      04452948
044530     SET WS007-SUCCESSFUL  TO TRUE.                               04453013
044683/                                                                 04468301
044684******************************************************************04468413
044685* VERIFY SHIPMENT TRANSACTIONS PROCESS.                           04468513
044686******************************************************************04468613
044687 2100-PROCESS-VERIFY-SHIPMT.                                      04468713
044688     IF PS-CICS-SWITCH-YES                                        04468868
044689         MOVE SPACES TO PV-CICS-MSG-AREA                          04468968
044690         STRING   ' ' WS007-SRC-TASK-NUMBER                       04469068
044691                  ' WSKCS308:'                                    04469168
044692                  ' 2100-PROCESS-VERIFY-SHIPMT'                   04469268
044693                                   DELIMITED BY SIZE              04469368
044694                              INTO PV-CICS-MSG-AREA               04469468
044695         PERFORM 8000-WRITE-TO-CICS-LOG                           04469568
044696     END-IF.                                                      04469668
044697                                                                  04469768
044698                                                                  04469848
044699     PERFORM 3000-SELECT-WST-XREF.                                04469913
044700                                                                  04470078
044701     PERFORM 7000-CHECK-RPAMSD.                                   04470178
044705                                                                  04470578
044706     IF WST00001-DMY-SEQ-NBR = 0                                  04470648
044707       MOVE 'UN'     TO TRIPST-TRIP-STATUS-CDE                    04470748
044708       PERFORM 5410-INSERT-TTRIPST                                04470848
044709                                                                  04470978
044710       IF  PS-RPA-MISDRCT-CK                                      04471078
044711           PERFORM 7010-RPA-MISDIRECT                             04471180
044712       END-IF                                                     04471278
044713*                                                                 04471378
044714*  DMH 11/29/17 - BEGIN                                           04471478
044715       PERFORM 5415-UPDATE-WST-HDR                                04471578
044716       PERFORM 5420-UPDATE-WST-DTL                                04471678
044717*  DMH 11/29/17 - END                                             04471778
044718*  GB 6/1/07                                                      04471878
044719*  DO NOT DEPART OF END TRIP                                      04471978
044720*    MOVE 'DP'     TO TRIPST-TRIP-STATUS-CDE.                     04472078
044721*    PERFORM 5410-INSERT-TTRIPST.                                 04472178
044722*    MOVE 'ET'     TO TRIPST-TRIP-STATUS-CDE.                     04472278
044723*    PERFORM 5410-INSERT-TTRIPST.                                 04472378
044724                                                                  04472478
044725* JAK 05/2007 - REMOVE CALLS TO INSERT STATUS CODE FROM HERE      04472578
044726*      MOVE 'UN'     TO SHIPST-SHIPT-STATUS-CDE.                  04472678
044727                                                                  04472778
044728       PERFORM 5600-INSERT-TSHIPST                                04472878
044729                                                                  04472978
044730*      MOVE 'DP'     TO SHIPST-SHIPT-STATUS-CDE.                  04473078
044731*      PERFORM 5600-INSERT-TSHIPST.                               04473178
044732*      MOVE 'ET'     TO SHIPST-SHIPT-STATUS-CDE.                  04473278
044733*      PERFORM 5600-INSERT-TSHIPST.                               04473378
044734                                                                  04473478
044735       PERFORM 4000-GET-OWNER-SCAC-ID                             04473578
044736       MOVE 'UN'          TO VEHICL-CURR-STATUS-CDE               04473678
044737       PERFORM 4200-UPDATE-TVEHICL                                04473778
044738       PERFORM 4400-AUDIT-TVEHICL                                 04473878
044739                                                                  04473978
044740     END-IF.                                                      04474078
044741                                                                  04474178
044742     PERFORM 3200-UPDATE-WST-XREF.                                04474278
044743                                                                  04474378
044744     SET WS007-SUCCESSFUL  TO TRUE.                               04474478
044745/                                                                 04474578
044746******************************************************************04474678
044750* SELECT FROM VIEW WST_SHPMT_XREF_HDR (WST00001)                  04475002
044800******************************************************************04480001
079570 3000-SELECT-WST-XREF.                                            07957001
079580     IF PS-CICS-SWITCH-YES                                        07958068
079590         MOVE SPACES TO PV-CICS-MSG-AREA                          07959068
079591         STRING   ' ' WS007-SRC-TASK-NUMBER                       07959168
079592                  ' WSKCS308:'                                    07959268
079593                  ' 3000-SELECT-WST-XREF      '                   07959368
079594                                   DELIMITED BY SIZE              07959468
079595                              INTO PV-CICS-MSG-AREA               07959568
079596         PERFORM 8000-WRITE-TO-CICS-LOG                           07959668
079597     END-IF.                                                      07959768
079598                                                                  07959868
079600                                                                  07960001
079700     MOVE WS014-ORIG-SHIPMT-NBR      TO DK-SHIPT-ID.              07970022
079800                                                                  07980001
080520     EXEC SQL                                                     08052018
080530          SELECT INTR_TRIP_ID                                     08053018
080540               , VER_NBR                                          08054018
080550               , EXT_SHP_ID                                       08055018
080551               , DMY_SEQ_NBR                                      08055148
080560          INTO   :WST00001-INTR-TRIP-ID                           08056018
080570               , :WST00001-VER-NBR                                08057018
080580               , :WST00001-EXT-SHP-ID                             08058018
080581               , :WST00001-DMY-SEQ-NBR                            08058148
080590          FROM   WST_SHPMT_XREF_HDR                               08059018
080591          WHERE  EXT_SHP_ID    = :DK-SHIPT-ID                     08059118
080592     END-EXEC                                                     08059218
080593                                                                  08059318
080594     EVALUATE TRUE                                                08059418
080595         WHEN SQLCODE = ZERO                                      08059518
080596              MOVE WST00001-INTR-TRIP-ID TO DK-TRIP-ID            08059618
080597              IF PS-CICS-SWITCH-YES                               08059731
080598                  MOVE DK-TRIP-ID        TO PV-DISPLAY-1          08059831
080599                  INITIALIZE PV-CICS-MSG-AREA                     08059931
080600                  STRING   ' ' WS007-SRC-TASK-NUMBER              08060031
080601                           ' WSKCS308-3000:'                      08060131
080610                           ' SHIPT=' DK-SHIPT-ID                  08061031
080611                           ' TRIP='  PV-DISPLAY-1                 08061131
080612                           DELIMITED BY SIZE                      08061231
080613                                         INTO PV-CICS-MSG-AREA    08061331
080614                  PERFORM 8000-WRITE-TO-CICS-LOG                  08061431
080615                  IF WST00001-DMY-SEQ-NBR > 0                     08061551
080616                    MOVE DK-TRIP-ID        TO PV-DISPLAY-1        08061652
080617                    INITIALIZE PV-CICS-MSG-AREA                   08061752
080618                    STRING   ' ' WS007-SRC-TASK-NUMBER            08061852
080619                             ' WSKCS308-3000:'                    08061952
080620                             ' SHIPT=' DK-SHIPT-ID                08062052
080621                             ' TRIP='  PV-DISPLAY-1               08062152
080622                             ' NO UPDATES FOR A DUMMY SHPMT '     08062252
080623                             DELIMITED BY SIZE                    08062352
080624                                           INTO PV-CICS-MSG-AREA  08062452
080625                    PERFORM 8000-WRITE-TO-CICS-LOG                08062552
080626                  END-IF                                          08062652
080627              END-IF                                              08062751
080628         WHEN SQLCODE = +100                                      08062851
080629* JAK 08/2007 - CHG ERROR INDICATOR                               08062965
080630*****         SET WS007-ERROR     TO TRUE                         08063065
080633              SET WS007-INVALID-SHPMT-NBR  TO TRUE                08063365
080634              SET PS-ERROR-SW-YES          TO TRUE                08063466
080635              MOVE '3000-SELECT-WST-XREF'                         08063551
080636                                  TO WS007-SQL-ERROR-PARA         08063651
080637                                     DP013-PARAGRAPH              08063751
080638              MOVE SQLCODE        TO WS007-SQLCODE                08063851
080639                                     PV-SQL-RETURN-CD             08063951
080640              MOVE SQLCA          TO WS007-SQLCA                  08064051
080641                                     DP013-SQLCA                  08064151
080642              MOVE 'INVALID SHIPMENT NBR'                         08064251
080643                                  TO WS007-CRA-RET-MSG            08064351
080644                                     DP013-MESSAGE-TEXT (1)       08064451
080645              INITIALIZE PV-CICS-MSG-AREA                         08064551
080646              STRING   ' ' WS007-SRC-TASK-NUMBER                  08064651
080647                       ' WSKCS308-3000 ERROR:'                    08064751
080648                       ' INVALID SHIPMENT NBR'                    08064851
080649                       ' SHIPT=' DK-SHIPT-ID                      08064951
080650                       DELIMITED BY SIZE                          08065051
080651                                     INTO PV-CICS-MSG-AREA        08065151
080652              PERFORM 8000-WRITE-TO-CICS-LOG                      08065251
080653              MOVE 'WST_SHPMT_XREF_HDR'                           08065351
080654                                      TO DP013-DB2-TABLE-NAME (1) 08065451
080655              SET DP013-DB2-ABEND     TO TRUE                     08065551
080656              PERFORM 9999-ABEND                                  08065651
080657                                                                  08065751
080658         WHEN SQLWARN0 NOT = SPACES                               08065851
080659         WHEN SQLCODE NOT = ZERO                                  08065951
080660*             MOVE +4             TO PV-RETRY-COUNTER             08066051
080661              MOVE SQLCODE             TO WS007-SQLCODE           08066151
080662                                          PV-SQL-RETURN-CD        08066251
080663              INITIALIZE PV-CICS-MSG-AREA                         08066351
080664              STRING   ' ' WS007-SRC-TASK-NUMBER                  08066451
080665                       ' WSKCS308-3000 ERROR:'                    08066551
080666                       ' SQL='                                    08066651
080667                       PV-SQL-RETURN-CD                           08066751
080668                       ' '  DK-SHIPT-ID                           08066867
080669                       DELIMITED BY SIZE                          08066951
080670                                     INTO PV-CICS-MSG-AREA        08067051
080671              PERFORM 8000-WRITE-TO-CICS-LOG                      08067151
080672                                                                  08067251
080673              SET WS007-INVALID-SQL    TO TRUE                    08067351
080674              MOVE '3000-SELECT-WST-XREF'                         08067451
080675                                       TO WS007-SQL-ERROR-PARA    08067551
080676                                          DP013-PARAGRAPH         08067651
080677              MOVE SQLCA               TO WS007-SQLCA             08067751
080678                                          DP013-SQLCA             08067851
080679              STRING 'SQL='                                       08067951
080680                   PV-SQL-RETURN-CD                               08068051
080681                   DELIMITED BY SIZE                              08068151
080682                                     INTO WS007-CRA-RET-MSG       08068251
080683              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08068351
080684              MOVE 'WST_SHPMT_XREF_HDR'                           08068451
080685                                       TO DP013-DB2-TABLE-NAME (1)08068551
080686              SET DP013-DB2-ABEND      TO TRUE                    08068651
080687              PERFORM 9999-ABEND                                  08068751
080688     END-EVALUATE.                                                08068851
080690/                                                                 08069002
080800******************************************************************08080002
080900* UPDATE FROM VIEW WST_SHPMT_XREF_HDR (WST00001)                  08090002
080910* SET PRC CDE = 'T'                                               08091020
081000******************************************************************08100002
081100 3100-UPDATE-WST-XREF.                                            08110005
081110     IF PS-CICS-SWITCH-YES                                        08111068
081120         MOVE SPACES TO PV-CICS-MSG-AREA                          08112068
081130         STRING   ' ' WS007-SRC-TASK-NUMBER                       08113068
081140                  ' WSKCS308:'                                    08114068
081150                  ' 3100-UPDATE-WST-XREF      '                   08115068
081160                                   DELIMITED BY SIZE              08116068
081170                              INTO PV-CICS-MSG-AREA               08117068
081180         PERFORM 8000-WRITE-TO-CICS-LOG                           08118068
081190     END-IF.                                                      08119068
081191                                                                  08119168
081200                                                                  08120002
082200     EXEC SQL                                                     08220018
082400          UPDATE WST_SHPMT_XREF_HDR                               08240018
082500             SET PRC_CDE          = 'T'                           08250018
082700             WHERE INTR_TRIP_ID   = :DK-TRIP-ID                   08270018
083100     END-EXEC                                                     08310018
083200                                                                  08320018
083300     EVALUATE TRUE                                                08330018
083400         WHEN SQLCODE = ZERO                                      08340018
083500              MOVE WST00001-INTR-TRIP-ID TO DK-TRIP-ID            08350018
083600              IF PS-CICS-SWITCH-YES                               08360031
083700                  MOVE DK-TRIP-ID        TO PV-DISPLAY-1          08370031
083800                  INITIALIZE PV-CICS-MSG-AREA                     08380031
083900                  STRING   ' ' WS007-SRC-TASK-NUMBER              08390031
084000                           ' WSKCS308-3100:'                      08400031
084020                           ' TRIP='  PV-DISPLAY-1                 08402031
084030                           DELIMITED BY SIZE                      08403031
084040                                         INTO PV-CICS-MSG-AREA    08404031
084050                  PERFORM 8000-WRITE-TO-CICS-LOG                  08405031
084060              END-IF                                              08406031
084100         WHEN SQLCODE = +100                                      08410018
084110* JAK 08/2007 - CHG ERROR INDICATOR                               08411065
084200*****         SET WS007-ERROR     TO TRUE                         08420065
084230              SET WS007-INVALID-SQL        TO TRUE                08423065
084240              SET PS-ERROR-SW-YES          TO TRUE                08424066
084300              MOVE '3100-UPDATE-WST-XREF'                         08430018
084400                                  TO WS007-SQL-ERROR-PARA         08440018
084410                                     DP013-PARAGRAPH              08441031
084600              MOVE 'UPDATE PRC CDE '                              08460018
084700                                  TO WS007-CRA-RET-MSG            08470018
084710                                     DP013-MESSAGE-TEXT (1)       08471031
084750              MOVE SQLCODE        TO WS007-SQLCODE                08475031
084760                                     PV-SQL-RETURN-CD             08476031
084770              MOVE SQLCA          TO WS007-SQLCA                  08477031
084780                                     DP013-SQLCA                  08478031
084793              INITIALIZE PV-CICS-MSG-AREA                         08479331
084794              MOVE DK-TRIP-ID        TO PV-DISPLAY-1              08479431
084795              STRING   ' ' WS007-SRC-TASK-NUMBER                  08479531
084796                       ' WSKCS308-3100 ERROR:'                    08479631
084797                       ' INVALID TRIP=' PV-DISPLAY-1              08479731
084799                       DELIMITED BY SIZE                          08479931
084800                                     INTO PV-CICS-MSG-AREA        08480031
084801              PERFORM 8000-WRITE-TO-CICS-LOG                      08480131
084802              MOVE 'WST_SHPMT_XREF_HDR'                           08480231
084803                                      TO DP013-DB2-TABLE-NAME (1) 08480331
084804              SET DP013-DB2-ABEND     TO TRUE                     08480431
084805              PERFORM 9999-ABEND                                  08480531
084810         WHEN SQLWARN0 NOT = SPACES                               08481018
084900         WHEN SQLCODE NOT = ZERO                                  08490018
085000*             MOVE +4             TO PV-RETRY-COUNTER             08500031
085010              MOVE SQLCODE             TO WS007-SQLCODE           08501031
085020                                          PV-SQL-RETURN-CD        08502031
085030              INITIALIZE PV-CICS-MSG-AREA                         08503031
085031              MOVE DK-TRIP-ID        TO PV-DISPLAY-1              08503167
085040              STRING   ' ' WS007-SRC-TASK-NUMBER                  08504031
085050                       ' WSKCS308-3100 ERROR:'                    08505031
085060                       ' SQL='                                    08506031
085070                       PV-SQL-RETURN-CD                           08507031
085071                       ' '  PV-DISPLAY-1                          08507167
085080                       DELIMITED BY SIZE                          08508031
085090                                     INTO PV-CICS-MSG-AREA        08509031
085091              PERFORM 8000-WRITE-TO-CICS-LOG                      08509131
085092                                                                  08509231
085093              SET WS007-INVALID-SQL    TO TRUE                    08509331
085094              MOVE '3100-UPDATE-WST-XREF'                         08509431
085095                                       TO WS007-SQL-ERROR-PARA    08509531
085096                                          DP013-PARAGRAPH         08509631
085097              MOVE SQLCA               TO WS007-SQLCA             08509731
085098                                          DP013-SQLCA             08509831
085099              STRING 'SQL='                                       08509931
085100                   PV-SQL-RETURN-CD                               08510031
085110                   DELIMITED BY SIZE                              08511031
085120                                     INTO WS007-CRA-RET-MSG       08512031
085130              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08513031
085140              MOVE 'WST_SHPMT_XREF_HDR'                           08514031
085150                                       TO DP013-DB2-TABLE-NAME (1)08515031
085160              SET DP013-DB2-ABEND      TO TRUE                    08516031
085170              PERFORM 9999-ABEND                                  08517031
085200     END-EVALUATE.                                                08520018
085300                                                                  08530002
086300/                                                                 08630002
086301******************************************************************08630119
086302* UPDATE FROM VIEW WST_SHPMT_XREF_HDR (WST00001)                  08630219
086303* SET PRC CDE = 'V'                                               08630319
086304******************************************************************08630419
086305 3200-UPDATE-WST-XREF.                                            08630519
086306     IF PS-CICS-SWITCH-YES                                        08630668
086307         MOVE SPACES TO PV-CICS-MSG-AREA                          08630768
086308         STRING   ' ' WS007-SRC-TASK-NUMBER                       08630868
086309                  ' WSKCS308:'                                    08630968
086310                  ' 3200-UPDATE-WST-XREF      '                   08631068
086311                                   DELIMITED BY SIZE              08631168
086312                              INTO PV-CICS-MSG-AREA               08631268
086313         PERFORM 8000-WRITE-TO-CICS-LOG                           08631368
086314     END-IF.                                                      08631468
086315                                                                  08631568
086316                                                                  08631619
086317     EXEC SQL                                                     08631719
086318          UPDATE WST_SHPMT_XREF_HDR                               08631819
086319             SET PRC_CDE          = 'V'                           08631919
086320             WHERE INTR_TRIP_ID   = :DK-TRIP-ID                   08632019
086321     END-EXEC                                                     08632119
086322                                                                  08632219
086323     EVALUATE TRUE                                                08632319
086324         WHEN SQLCODE = ZERO                                      08632419
086325              IF PS-CICS-SWITCH-YES                               08632531
086326                  MOVE DK-TRIP-ID        TO PV-DISPLAY-1          08632631
086327                  INITIALIZE PV-CICS-MSG-AREA                     08632731
086328                  STRING   ' ' WS007-SRC-TASK-NUMBER              08632831
086329                           ' WSKCS308-3200:'                      08632931
086330                           ' TRIP='  PV-DISPLAY-1                 08633031
086331                           DELIMITED BY SIZE                      08633131
086332                                         INTO PV-CICS-MSG-AREA    08633231
086333                  PERFORM 8000-WRITE-TO-CICS-LOG                  08633331
086334              END-IF                                              08633431
086335         WHEN SQLCODE = +100                                      08633519
086336* JAK 08/2007 - CHG ERROR INDICATOR                               08633665
086337*****         SET WS007-ERROR     TO TRUE                         08633765
086338              SET WS007-INVALID-SQL        TO TRUE                08633865
086339              SET PS-ERROR-SW-YES          TO TRUE                08633966
086340              MOVE '3200-UPDATE-WST-XREF'                         08634020
086341                                  TO WS007-SQL-ERROR-PARA         08634119
086342                                     DP013-PARAGRAPH              08634231
086343              MOVE SQLCODE        TO WS007-SQLCODE                08634319
086344                                     PV-SQL-RETURN-CD             08634431
086345              MOVE 'UPDATE PRC CDE '                              08634531
086346                                  TO WS007-CRA-RET-MSG            08634631
086347                                     DP013-MESSAGE-TEXT (1)       08634731
086348              MOVE SQLCA          TO WS007-SQLCA                  08634831
086349                                     DP013-SQLCA                  08634931
086350              INITIALIZE PV-CICS-MSG-AREA                         08635031
086351              MOVE DK-TRIP-ID        TO PV-DISPLAY-1              08635131
086352              STRING   ' ' WS007-SRC-TASK-NUMBER                  08635231
086353                       ' WSKCS308-3200 ERROR:'                    08635331
086354                       ' INVALID TRIP=' PV-DISPLAY-1              08635431
086355                       DELIMITED BY SIZE                          08635531
086356                                     INTO PV-CICS-MSG-AREA        08635631
086357              PERFORM 8000-WRITE-TO-CICS-LOG                      08635731
086358              MOVE 'WST_SHPMT_XREF_HDR'                           08635831
086359                                      TO DP013-DB2-TABLE-NAME (1) 08635931
086360              SET DP013-DB2-ABEND     TO TRUE                     08636031
086361              PERFORM 9999-ABEND                                  08636131
086362         WHEN SQLWARN0 NOT = SPACES                               08636219
086363         WHEN SQLCODE NOT = ZERO                                  08636319
086364*             MOVE +4             TO PV-RETRY-COUNTER             08636431
086365              MOVE SQLCODE             TO WS007-SQLCODE           08636531
086366                                          PV-SQL-RETURN-CD        08636631
086367              INITIALIZE PV-CICS-MSG-AREA                         08636731
086368              MOVE DK-TRIP-ID        TO PV-DISPLAY-1              08636867
086369              STRING   ' ' WS007-SRC-TASK-NUMBER                  08636931
086370                       ' WSKCS308-3200 ERROR:'                    08637031
086371                       ' SQL='                                    08637131
086372                       PV-SQL-RETURN-CD                           08637231
086373                       ' '  PV-DISPLAY-1                          08637367
086374                       DELIMITED BY SIZE                          08637431
086375                                     INTO PV-CICS-MSG-AREA        08637531
086376              PERFORM 8000-WRITE-TO-CICS-LOG                      08637631
086377                                                                  08637731
086378              SET WS007-INVALID-SQL    TO TRUE                    08637831
086379              MOVE '3200-UPDATE-WST-XREF'                         08637931
086380                                       TO WS007-SQL-ERROR-PARA    08638031
086381                                          DP013-PARAGRAPH         08638131
086382              MOVE SQLCA               TO WS007-SQLCA             08638231
086383                                          DP013-SQLCA             08638331
086384              STRING 'SQL='                                       08638431
086385                   PV-SQL-RETURN-CD                               08638531
086386                   DELIMITED BY SIZE                              08638631
086387                                     INTO WS007-CRA-RET-MSG       08638731
086388              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08638831
086389              MOVE 'WST_SHPMT_XREF_HDR'                           08638931
086390                                       TO DP013-DB2-TABLE-NAME (1)08639031
086391              SET DP013-DB2-ABEND      TO TRUE                    08639131
086392              PERFORM 9999-ABEND                                  08639231
086393     END-EVALUATE.                                                08639319
086394/                                                                 08639419
086395*----------------------------------------------------------------*08639553
086396* GET OWNER SCAC ID AND VEHICLE NUMBER FROM TVHTRIP TABLE.        08639653
086397*----------------------------------------------------------------*08639753
086398 4000-GET-OWNER-SCAC-ID.                                          08639853
086399                                                                  08639953
086400     IF PS-CICS-SWITCH-YES                                        08640068
086401         MOVE SPACES TO PV-CICS-MSG-AREA                          08640168
086402         STRING   ' ' WS007-SRC-TASK-NUMBER                       08640268
086403                  ' WSKCS308:'                                    08640368
086404                  ' 4000-GET-OWNER-SCAC-ID    '                   08640468
086405                                   DELIMITED BY SIZE              08640568
086406                              INTO PV-CICS-MSG-AREA               08640668
086407         PERFORM 8000-WRITE-TO-CICS-LOG                           08640768
086408     END-IF.                                                      08640868
086409                                                                  08640968
086410     EXEC SQL                                                     08641053
086411          SELECT OWNER_SCAC_ID                                    08641153
086412               , VEH_NBR                                          08641253
086413            INTO :VHTRIP-OWNER-SCAC-ID                            08641353
086414               , :VHTRIP-VEH-NBR                                  08641453
086415            FROM TVHTRIP                                          08641553
086416           WHERE TRIP_ID           = :DK-TRIP-ID                  08641653
086417     END-EXEC.                                                    08641753
086418                                                                  08641853
086419     EVALUATE TRUE                                                08641953
086420         WHEN SQLCODE = ZERO                                      08642053
086421              MOVE VHTRIP-VEH-NBR   TO  DK-VEH-NBR                08642154
086422              MOVE VHTRIP-OWNER-SCAC-ID   TO  DK-SCAC-ID          08642256
086423              IF PS-CICS-SWITCH-YES                               08642354
086424                  MOVE DK-TRIP-ID        TO PV-DISPLAY-1          08642454
086425                  INITIALIZE PV-CICS-MSG-AREA                     08642554
086429                  STRING   ' ' WS007-SRC-TASK-NUMBER              08642954
086430                           ' WSKCS308-4000:'                      08643054
086431                           ' SHIPT=' DK-SHIPT-ID                  08643154
086432                           ' TRIP='  PV-DISPLAY-1                 08643254
086433                           DELIMITED BY SIZE                      08643354
086434                                         INTO PV-CICS-MSG-AREA    08643454
086435                  PERFORM 8000-WRITE-TO-CICS-LOG                  08643554
086448              END-IF                                              08644854
086459         WHEN SQLCODE = +100                                      08645953
086460* JAK 08/2007 - CHG ERROR INDICATOR                               08646065
086461*****         SET WS007-ERROR     TO TRUE                         08646165
086464              SET WS007-INVALID-SQL        TO TRUE                08646465
086465              SET PS-ERROR-SW-YES          TO TRUE                08646566
086466              MOVE '4000-GET-OWNER-SCAC-ID '                      08646654
086467                                       TO WS007-SQL-ERROR-PARA    08646754
086468                                          DP013-PARAGRAPH         08646854
086469              MOVE SQLCODE        TO WS007-SQLCODE                08646954
086470                                     PV-SQL-RETURN-CD             08647054
086471              MOVE SQLCA          TO WS007-SQLCA                  08647154
086472                                     DP013-SQLCA                  08647254
086473              MOVE 'OWNER SCAC ID NOT FOUND'                      08647354
086474                                  TO WS007-CRA-RET-MSG            08647454
086475                                     DP013-MESSAGE-TEXT (1)       08647554
086476              MOVE DK-TRIP-ID     TO PV-DISPLAY-1                 08647657
086477              INITIALIZE PV-CICS-MSG-AREA                         08647754
086478              STRING   ' ' WS007-SRC-TASK-NUMBER                  08647854
086479                       ' WSKCS308-4000 ERROR:'                    08647954
086480                       ' OWNER SCAC ID NOT FOUND'                 08648054
086481                       ' TRIP-ID=' PV-DISPLAY-1                   08648157
086482                       DELIMITED BY SIZE                          08648254
086483                                     INTO PV-CICS-MSG-AREA        08648354
086484              PERFORM 8000-WRITE-TO-CICS-LOG                      08648454
086485              MOVE 'TVHTRIP'          TO DP013-DB2-TABLE-NAME (1) 08648554
086486              SET DP013-DB2-ABEND     TO TRUE                     08648654
086487              PERFORM 9999-ABEND                                  08648754
086504         WHEN SQLWARN0 NOT = SPACE                                08650453
086505         WHEN SQLCODE < +0                                        08650553
086506         WHEN SQLCODE > +0                                        08650653
086507              MOVE SQLCODE             TO WS007-SQLCODE           08650753
086508                                          PV-SQL-RETURN-CD        08650853
086509              MOVE '4000-GET-OWNER-SCAC-ID '                      08650954
086510                                       TO WS007-SQL-ERROR-PARA    08651054
086511                                          DP013-PARAGRAPH         08651154
086512              MOVE SQLCA               TO WS007-SQLCA             08651254
086513                                          DP013-SQLCA             08651354
086514              INITIALIZE PV-CICS-MSG-AREA                         08651453
086515              MOVE DK-TRIP-ID        TO PV-DISPLAY-1              08651567
086516              STRING   ' ' WS007-SRC-TASK-NUMBER                  08651653
086517                       ' WSKCS308-4000 ERROR:'                    08651753
086518                       ' SQL='                                    08651853
086519                       PV-SQL-RETURN-CD                           08651953
086520                       ' '  PV-DISPLAY-1                          08652067
086521                       DELIMITED BY SIZE                          08652153
086522                                     INTO PV-CICS-MSG-AREA        08652253
086523              PERFORM 8000-WRITE-TO-CICS-LOG                      08652353
086524                                                                  08652453
086529              MOVE PV-CICS-MSG-AREA    TO DP013-MESSAGE-TEXT (1)  08652956
086530                                          WS007-CRA-RET-MSG       08653056
086532              MOVE 'TVHTRIP'           TO DP013-DB2-TABLE-NAME (1)08653256
086533              SET DP013-DB2-ABEND      TO TRUE                    08653353
086534              PERFORM 9999-ABEND                                  08653453
086535     END-EVALUATE.                                                08653553
086536                                                                  08653653
086588*----------------------------------------------------------------*08658853
086589* UPDATE THE LOCATION AND STATUS OF THE VEHICLE.                  08658953
086590*----------------------------------------------------------------*08659053
086591 4200-UPDATE-TVEHICL.                                             08659153
086592                                                                  08659253
086594     IF PS-CICS-SWITCH-YES                                        08659468
086595         MOVE SPACES TO PV-CICS-MSG-AREA                          08659568
086596         STRING   ' ' WS007-SRC-TASK-NUMBER                       08659668
086597                  ' WSKCS308:'                                    08659768
086598                  ' 4200-UPDATE-TVEHICL       '                   08659868
086599                                   DELIMITED BY SIZE              08659968
086600                              INTO PV-CICS-MSG-AREA               08660068
086601         PERFORM 8000-WRITE-TO-CICS-LOG                           08660168
086602     END-IF.                                                      08660268
086603                                                                  08660353
086604     MOVE PV-RECVD-TMST-WM-DATE TO PV-DB2-HOST-DATE.              08660458
086605     MOVE PV-RECVD-TMST-WM-TIME TO PV-DB2-HOST-TIME.              08660558
086606                                                                  08660653
086607         EXEC SQL                                                 08660753
086608           UPDATE TVEHICL                                         08660853
086609              SET LAST_UPD_DTE     = :PV-DB2-HOST-DATE            08660959
086610                 ,LAST_UPD_TME     = :PV-DB2-HOST-TIME            08661059
086611                 ,LAST_UPD_UID     = :WS014-CRE-USER-ID           08661163
086612                 ,CURR_STATUS_DTE  = :PV-DB2-HOST-DATE            08661259
086613                 ,CURR_STATUS_TME  = :PV-DB2-HOST-TIME            08661359
086614                 ,CURR_STATUS_CDE  = :VEHICL-CURR-STATUS-CDE      08661453
086615           WHERE  VEH_NBR       = :DK-VEH-NBR                     08661553
086616             AND  OWNER_SCAC_ID = :DK-SCAC-ID                     08661653
086617         END-EXEC                                                 08661753
086618                                                                  08661853
086619         EVALUATE TRUE                                            08661953
086620             WHEN SQLCODE = +0                                    08662053
086621             WHEN SQLCODE = -904                                  08662153
086622             WHEN SQLCODE = -913                                  08662253
086623                 CONTINUE                                         08662353
086624                                                                  08662453
086625             WHEN SQLWARN0 NOT = SPACES                           08662553
086626             WHEN SQLCODE < +0                                    08662653
086630             WHEN SQLCODE > +0                                    08663053
086631                  MOVE SQLCODE         TO PV-SQL-RETURN-CD        08663167
086637                  INITIALIZE PV-CICS-MSG-AREA                     08663767
086639                  STRING   ' ' WS007-SRC-TASK-NUMBER              08663967
086640                           ' WSKCS308-4200 ERROR:'                08664067
086641                           ' SQL='                                08664167
086642                           PV-SQL-RETURN-CD                       08664267
086643                           ' '  DK-SCAC-ID                        08664367
086644                           '-'  DK-VEH-NBR                        08664467
086645                           '-'  VEHICL-CURR-STATUS-CDE            08664567
086646                           '-'  WS014-CRE-USER-ID                 08664667
086647                                          DELIMITED BY SIZE       08664767
086648                                     INTO PV-CICS-MSG-AREA        08664867
086649                  PERFORM 8000-WRITE-TO-CICS-LOG                  08664967
086650                                                                  08665067
086652                 MOVE '4200-UPDATE-TVEHICL'                       08665267
086653                                   TO DP013-PARAGRAPH             08665367
086654                 MOVE 'UPDATE CURR INFO ON TVEHICL'               08665467
086655                                   TO DP013-MESSAGE-TEXT(1)       08665567
086656*                MOVE DK-PO-NBR  TO PV-ERROR-PO                   08665667
086657*                MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              08665767
086658*                MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      08665867
086659*                MOVE DK-FCLTY-ID    TO PV-ERROR-FCLTY-ID         08665967
086660                 MOVE SQLCA        TO DP013-SQLCA                 08666067
086661                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    08666167
086662                 SET DP013-DB2-ABEND TO TRUE                      08666267
086663                 PERFORM 9999-ABEND                               08666367
086664         END-EVALUATE.                                            08666467
086665                                                                  08666567
086666*----------------------------------------------------------------*08666667
086667*  TAKE A SNAPSHOT OF THE BEFORE IMAGE OF TVEHICL AND WRITE       08666767
086668*  TO THE AUDIT TABLE.                                            08666867
086669*----------------------------------------------------------------*08666967
086670 4400-AUDIT-TVEHICL.                                              08667067
086671                                                                  08667168
086672     IF PS-CICS-SWITCH-YES                                        08667268
086673         MOVE SPACES TO PV-CICS-MSG-AREA                          08667368
086674         STRING   ' ' WS007-SRC-TASK-NUMBER                       08667468
086675                  ' WSKCS308:'                                    08667568
086676                  ' 4400-AUDIT-TVEHICL        '                   08667668
086677                                   DELIMITED BY SIZE              08667768
086678                              INTO PV-CICS-MSG-AREA               08667868
086679         PERFORM 8000-WRITE-TO-CICS-LOG                           08667968
086680     END-IF.                                                      08668068
086681                                                                  08668167
086682     INITIALIZE DCLTAUVHCL.                                       08668267
086683                                                                  08668367
086684         EXEC SQL                                                 08668467
086685             SELECT  OWNER_SCAC_ID                                08668567
086686                    ,VEH_NBR                                      08668667
086687                    ,CRT_SRC_CDE                                  08668767
086688                    ,LAST_UPD_DTE                                 08668867
086689                    ,LAST_UPD_TME                                 08668967
086690                    ,LAST_UPD_UID                                 08669067
086691                    ,USAGE_CDE                                    08669167
086692                    ,VEH_TYP_CDE                                  08669267
086693                    ,CURR_STATUS_CDE                              08669367
086694                    ,CURR_STATUS_DTE                              08669467
086695                    ,CURR_STATUS_TME                              08669567
086696                    ,CURR_OPER_UNT_ID                             08669667
086697                    ,CURR_FCLTY_ID                                08669767
086698                    ,CURR_FAC_AREA_ID                             08669867
086699                    ,CURR_LOC_DTE                                 08669967
086700                    ,CURR_LOC_TME                                 08670067
086701                    ,CURR_TRIP_ID                                 08670167
086702                    ,VEH_SIZE_CDE                                 08670267
086703            INTO     :VEHICL-OWNER-SCAC-ID                        08670367
086704                    ,:VEHICL-VEH-NBR                              08670467
086705                    ,:VEHICL-CRT-SRC-CDE                          08670567
086706                    ,:VEHICL-LAST-UPD-DTE                         08670667
086707                    ,:VEHICL-LAST-UPD-TME                         08670767
086708                    ,:VEHICL-LAST-UPD-UID                         08670867
086709                    ,:VEHICL-USAGE-CDE                            08670967
086710                    ,:VEHICL-VEH-TYP-CDE                          08671067
086711                    ,:VEHICL-CURR-STATUS-CDE                      08671167
086712                    ,:VEHICL-CURR-STATUS-DTE                      08671267
086713                    ,:VEHICL-CURR-STATUS-TME                      08671367
086714                    ,:VEHICL-CURR-OPER-UNT-ID                     08671467
086715                    ,:VEHICL-CURR-FCLTY-ID                        08671567
086716                    ,:VEHICL-CURR-FAC-AREA-ID                     08671667
086717                    ,:VEHICL-CURR-LOC-DTE                         08671767
086718                    ,:VEHICL-CURR-LOC-TME                         08671867
086719                    ,:VEHICL-CURR-TRIP-ID                         08671967
086720                       :DN-CURR-TRIP-ID                           08672067
086721                    ,:VEHICL-VEH-SIZE-CDE                         08672167
086722           FROM   TVEHICL                                         08672267
086723           WHERE  VEH_NBR       = :DK-VEH-NBR                     08672367
086724             AND  OWNER_SCAC_ID = :DK-SCAC-ID                     08672467
086725         END-EXEC                                                 08672567
086726                                                                  08672667
086727         EVALUATE TRUE                                            08672767
086728             WHEN SQLCODE = +0                                    08672867
086729             WHEN SQLCODE = -904                                  08672967
086730             WHEN SQLCODE = -913                                  08673067
086731                 CONTINUE                                         08673167
086732                                                                  08673267
086733             WHEN SQLWARN0 NOT = SPACES                           08673367
086734             WHEN SQLCODE < +0                                    08673467
086735             WHEN SQLCODE > +0                                    08673567
086736                  MOVE SQLCODE         TO PV-SQL-RETURN-CD        08673668
086737                  INITIALIZE PV-CICS-MSG-AREA                     08673768
086738                  STRING   ' ' WS007-SRC-TASK-NUMBER              08673868
086739                           ' WSKCS308-4400 TVEHICL ERROR:'        08673968
086740                           ' SQL='                                08674068
086741                           PV-SQL-RETURN-CD                       08674168
086742                           ' '  DK-SCAC-ID                        08674268
086743                           '-'  DK-VEH-NBR                        08674368
086744                           '-'  VEHICL-CURR-STATUS-CDE            08674468
086745                                          DELIMITED BY SIZE       08674568
086746                                     INTO PV-CICS-MSG-AREA        08674668
086747                  PERFORM 8000-WRITE-TO-CICS-LOG                  08674768
086748                                                                  08674868
086749                 MOVE '4400-AUDIT-TVEHICL'                        08674967
086750                                   TO DP013-PARAGRAPH             08675067
086751                 MOVE 'SELECT A TVEHICL ROW   '                   08675167
086752                                   TO DP013-MESSAGE-TEXT(1)       08675267
086753*                MOVE DK-PO-NBR  TO PV-ERROR-PO                   08675367
086754*                MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              08675467
086755*                MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      08675567
086756*                MOVE DK-FCLTY-ID    TO PV-ERROR-FCLTY-ID         08675667
086757                 MOVE SQLCA        TO DP013-SQLCA                 08675767
086758                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    08675867
086759                 SET DP013-DB2-ABEND TO TRUE                      08675967
086760                 PERFORM 9999-ABEND                               08676067
086761         END-EVALUATE.                                            08676167
086762                                                                  08676267
086763         EXEC SQL                                                 08676367
086764             INSERT  INTO TAUVHCL                                 08676467
086765                    (OWNER_SCAC_ID                                08676567
086766                    ,VEH_NBR                                      08676667
086767                    ,CRT_SRC_CDE                                  08676767
086768                    ,LAST_UPD_DTE                                 08676867
086769                    ,LAST_UPD_TME                                 08676967
086770                    ,LAST_UPD_UID                                 08677067
086771                    ,USAGE_CDE                                    08677167
086772                    ,VEH_TYP_CDE                                  08677267
086773                    ,CURR_STATUS_CDE                              08677367
086774                    ,CURR_STATUS_DTE                              08677467
086775                    ,CURR_STATUS_TME                              08677567
086776                    ,CURR_OPER_UNT_ID                             08677667
086777                    ,CURR_FCLTY_ID                                08677767
086778                    ,CURR_FAC_AREA_ID                             08677867
086779                    ,CURR_LOC_DTE                                 08677967
086780                    ,CURR_LOC_TME                                 08678067
086781                    ,CURR_TRIP_ID                                 08678167
086782                    ,VEH_SIZE_CDE)                                08678267
086783            VALUES  (:VEHICL-OWNER-SCAC-ID                        08678367
086784                    ,:VEHICL-VEH-NBR                              08678467
086785                    ,:VEHICL-CRT-SRC-CDE                          08678567
086786                    ,:VEHICL-LAST-UPD-DTE                         08678667
086787                    ,:VEHICL-LAST-UPD-TME                         08678767
086788                    ,:VEHICL-LAST-UPD-UID                         08678867
086789                    ,:VEHICL-USAGE-CDE                            08678967
086790                    ,:VEHICL-VEH-TYP-CDE                          08679067
086791                    ,:VEHICL-CURR-STATUS-CDE                      08679167
086792                    ,:VEHICL-CURR-STATUS-DTE                      08679267
086793                    ,:VEHICL-CURR-STATUS-TME                      08679367
086794                    ,:VEHICL-CURR-OPER-UNT-ID                     08679467
086795                    ,:VEHICL-CURR-FCLTY-ID                        08679567
086796                    ,:VEHICL-CURR-FAC-AREA-ID                     08679667
086797                    ,:VEHICL-CURR-LOC-DTE                         08679767
086798                    ,:VEHICL-CURR-LOC-TME                         08679867
086799                    ,:VEHICL-CURR-TRIP-ID                         08679967
086800                       :DN-CURR-TRIP-ID                           08680067
086801                    ,:VEHICL-VEH-SIZE-CDE)                        08680167
086802         END-EXEC                                                 08680267
086803                                                                  08680367
086804         EVALUATE TRUE                                            08680467
086805             WHEN SQLCODE = +0                                    08680567
086806             WHEN SQLCODE = -904                                  08680667
086807             WHEN SQLCODE = -913                                  08680767
086808                 CONTINUE                                         08680867
086809                                                                  08680967
086810             WHEN SQLWARN0 NOT = SPACES                           08681067
086811             WHEN SQLCODE < +0                                    08681167
086812             WHEN SQLCODE > +0                                    08681267
086813                  MOVE SQLCODE         TO PV-SQL-RETURN-CD        08681368
086814                  INITIALIZE PV-CICS-MSG-AREA                     08681468
086815                  STRING   ' ' WS007-SRC-TASK-NUMBER              08681568
086816                           ' WSKCS308-4400 TAUVHCL ERROR:'        08681668
086817                           ' SQL='                                08681768
086818                           PV-SQL-RETURN-CD                       08681868
086819                           ' '  DK-SCAC-ID                        08681968
086820                           '-'  DK-VEH-NBR                        08682068
086821                           '-'  VEHICL-CURR-STATUS-CDE            08682168
086822                                          DELIMITED BY SIZE       08682268
086823                                     INTO PV-CICS-MSG-AREA        08682368
086824                  PERFORM 8000-WRITE-TO-CICS-LOG                  08682468
086825                                                                  08682568
086826                 MOVE '4400-AUDIT-TVEHICL '                       08682667
086827                                   TO DP013-PARAGRAPH             08682767
086828                 MOVE 'INSERT A ROW ON TAUVHCL'                   08682867
086829                                   TO DP013-MESSAGE-TEXT(1)       08682967
086830*                MOVE DK-PO-NBR  TO PV-ERROR-PO                   08683067
086831*                MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              08683167
086832*                MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      08683267
086833*                MOVE DK-FCLTY-ID    TO PV-ERROR-FCLTY-ID         08683367
086834                 MOVE SQLCA        TO DP013-SQLCA                 08683467
086835                 MOVE 'TAUVHCL'    TO DP013-DB2-TABLE-NAME (1)    08683567
086836                 SET DP013-DB2-ABEND TO TRUE                      08683667
086837                 PERFORM 9999-ABEND                               08683767
086838         END-EVALUATE.                                            08683867
086839                                                                  08683967
086840*----------------------------------------------------------------*08684067
086841* SELECT AGAINST THE TRIP STATUS TABLE TO DETERMINE IF A ROW      08684167
086842* ALREADY EXISTS FOR TRIP STATUS CDE = 'AR'.                      08684267
086843*----------------------------------------------------------------*08684367
086844 5300-SELECT-TTRIPST.                                             08684467
086845                                                                  08684568
086846     IF PS-CICS-SWITCH-YES                                        08684668
086847         MOVE SPACES TO PV-CICS-MSG-AREA                          08684768
086848         STRING   ' ' WS007-SRC-TASK-NUMBER                       08684868
086849                  ' WSKCS308:'                                    08684968
086850                  ' 5300-SELECT-TTRIPST       '                   08685068
086851                                   DELIMITED BY SIZE              08685168
086852                              INTO PV-CICS-MSG-AREA               08685268
086853         PERFORM 8000-WRITE-TO-CICS-LOG                           08685368
086854     END-IF.                                                      08685468
086855                                                                  08685567
086856     EXEC SQL                                                     08685667
086857       SELECT STATUS_DTE                                          08685767
086858           ,  STATUS_TME                                          08685867
086859       INTO  :TRIPST-STATUS-DTE                                   08685967
086860           , :TRIPST-STATUS-TME                                   08686067
086861       FROM   TTRIPST                                             08686167
086862       WHERE  TRIP_ID          = :DK-TRIP-ID                      08686267
086863         AND  TRIP_STATUS_CDE  = 'AR'                             08686367
086864     END-EXEC                                                     08686467
086865                                                                  08686567
086866     EVALUATE TRUE                                                08686667
086867         WHEN SQLCODE = +0                                        08686767
086868              IF PS-CICS-SWITCH-YES                               08686867
086869                  MOVE DK-TRIP-ID        TO PV-DISPLAY-1          08686967
086870                  INITIALIZE PV-CICS-MSG-AREA                     08687067
086871                  STRING   ' ' WS007-SRC-TASK-NUMBER              08687167
086872                           ' WSKCS308-5300:'                      08687267
086873                           ' TRIP='  PV-DISPLAY-1                 08687367
086874                           DELIMITED BY SIZE                      08687467
086875                                         INTO PV-CICS-MSG-AREA    08687567
086876                  PERFORM 8000-WRITE-TO-CICS-LOG                  08687667
086877              END-IF                                              08687767
086878         WHEN SQLCODE = +100                                      08687867
086879              SET PS-TRIP-STATUS-INSERT-YES  TO TRUE              08687967
086880              MOVE 'AR'   TO    TRIPST-TRIP-STATUS-CDE            08688067
086881         WHEN SQLWARN0 NOT = SPACE                                08688167
086882         WHEN SQLCODE < +0                                        08688267
086883         WHEN SQLCODE > +0                                        08688367
086884              MOVE DK-TRIP-ID          TO PV-DISPLAY-1            08688468
086885              MOVE SQLCODE             TO WS007-SQLCODE           08688567
086886                                          PV-SQL-RETURN-CD        08688667
086887              INITIALIZE PV-CICS-MSG-AREA                         08688767
086888              STRING   ' ' WS007-SRC-TASK-NUMBER                  08688867
086889                       ' WSKCS308-5300 ERROR:'                    08688967
086890                       ' SQL='                                    08689067
086891                       PV-SQL-RETURN-CD                           08689167
086892                       ' ' PV-DISPLAY-1                           08689268
086893                       DELIMITED BY SIZE                          08689367
086894                                     INTO PV-CICS-MSG-AREA        08689467
086895              PERFORM 8000-WRITE-TO-CICS-LOG                      08689567
086896                                                                  08689667
086897              SET WS007-INVALID-SQL    TO TRUE                    08689767
086898              MOVE '5300-SELECT-TTRIPST '                         08689867
086899                                       TO WS007-SQL-ERROR-PARA    08689967
086900                                          DP013-PARAGRAPH         08690067
086901              MOVE SQLCA               TO WS007-SQLCA             08690167
086902                                          DP013-SQLCA             08690267
086903              STRING 'SQL='                                       08690367
086904                   PV-SQL-RETURN-CD                               08690467
086905                   DELIMITED BY SIZE                              08690567
086906                                     INTO WS007-CRA-RET-MSG       08690667
086907              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08690767
086908              MOVE 'TTRIPST'                                      08690867
086909                                       TO DP013-DB2-TABLE-NAME (1)08690967
086910              SET DP013-DB2-ABEND      TO TRUE                    08691067
086911              PERFORM 9999-ABEND                                  08691167
086912     END-EVALUATE.                                                08691267
086913/                                                                 08691367
086914*----------------------------------------------------------------*08691467
086915*  INSERT A ROW ON THE VEHICLE TRIP STATUS TABLE                 *08691567
086916*----------------------------------------------------------------*08691667
086917 5400-INSERT-TTRIPST.                                             08691767
086918                                                                  08691868
086919     IF PS-CICS-SWITCH-YES                                        08691968
086920         MOVE SPACES TO PV-CICS-MSG-AREA                          08692068
086921         STRING   ' ' WS007-SRC-TASK-NUMBER                       08692168
086922                  ' WSKCS308:'                                    08692268
086923                  ' 5400-INSERT-TTRIPST       '                   08692368
086924                                   DELIMITED BY SIZE              08692468
086925                              INTO PV-CICS-MSG-AREA               08692568
086926         PERFORM 8000-WRITE-TO-CICS-LOG                           08692668
086927     END-IF.                                                      08692768
086928                                                                  08692867
086929*    EXEC SQL                                                     08692967
086930*        SET :PV-DB2-HOST-DATE      = CURRENT DATE                08693067
086931*    END-EXEC.                                                    08693167
086932                                                                  08693267
086933*    EXEC SQL                                                     08693367
086934*        SET :PV-DB2-HOST-TIME      = CURRENT TIME                08693467
086935*    END-EXEC.                                                    08693567
086936*                                                                 08693667
086937*    IF THE CURRENT TIME IS LESS THAN OR EQUAL TO THE TIME OF THE 08693767
086938*    PREVIOUSLY INSERTED ROW (MEANING TWO OR MORE RECORDS HAVE BEE08693867
086939*    ADDED IN ON SECOND) ADD A SECOND TO THE PREVIOUS TIME TO KEEP08693967
086940*    TIMES UNIQUE.                                                08694067
086941*                                                                 08694167
086942*    MOVE TRIPST-STATUS-TME TO PV-CMPR-STATUS-TME.                08694267
086943*    MOVE TRIPST-STATUS-DTE TO PV-CMPR-STATUS-DTE.                08694367
086944*                                                                 08694467
086945*    MOVE WS014-DC-LOCATION TO DK-OPER-UNT-ID.                    08694567
086946*                                                                 08694667
086947*    IF PV-DB2-HOST-DATE   = PV-CMPR-STATUS-DTE                   08694767
086948*       IF  PV-DB2-HOST-TIME          <= PV-CMPR-STATUS-TME       08694867
086949*          ADD +1                     TO PV-CMPR-STATUS-TME-SS    08694967
086950*          IF PV-CMPR-STATUS-TME-SS    > 59                       08695067
086951*             ADD +1                  TO PV-CMPR-STATUS-TME-MM    08695167
086952*             MOVE ZEROS              TO PV-CMPR-STATUS-TME-SS    08695267
086953*             IF PV-CMPR-STATUS-TME-MM > 59                       08695367
086954*                ADD +1               TO PV-CMPR-STATUS-TME-HH    08695467
086955*                MOVE ZEROS           TO PV-CMPR-STATUS-TME-MM    08695567
086956*                IF PV-CMPR-STATUS-TME-HH                         08695667
086957*                                      > 23                       08695767
086958*                   MOVE ZEROS        TO PV-CMPR-STATUS-TME-HH    08695867
086959*                END-IF                                           08695967
086960*             END-IF                                              08696067
086961*          END-IF                                                 08696167
086962*          MOVE PV-CMPR-STATUS-TME    TO PV-DB2-HOST-TIME         08696267
086963*       ELSE                                                      08696367
086964*          MOVE PV-DB2-HOST-TIME      TO PV-CMPR-STATUS-TME       08696467
086965*       END-IF                                                    08696567
086966*    END-IF.                                                      08696667
086967                                                                  08696767
086968     MOVE PV-RECVD-TMST-WM-DATE TO PV-DB2-HOST-DATE.              08696867
086969     MOVE PV-RECVD-TMST-WM-TIME TO PV-DB2-HOST-TIME.              08696967
086970                                                                  08697067
086971     EXEC SQL                                                     08697167
086972         INSERT  INTO TTRIPST                                     08697267
086973                (TRIP_ID                                          08697367
086974                ,TRIP_STATUS_CDE                                  08697467
086975                ,STATUS_DTE                                       08697567
086976                ,STATUS_TME                                       08697667
086977                ,STATUS_UID                                       08697767
086978                ,OPER_UNT_ID                                      08697867
086979                ,FCLTY_ID)                                        08697967
086980        VALUES  (:DK-TRIP-ID                                      08698067
086981                ,:TRIPST-TRIP-STATUS-CDE                          08698167
086982                ,:PV-DB2-HOST-DATE                                08698267
086983                ,:PV-DB2-HOST-TIME                                08698367
086984                ,:WS014-CRE-USER-ID                               08698467
086985                ,:DK-OPER-UNT-ID                                  08698567
086986                ,1 )                                              08698667
086987     END-EXEC                                                     08698767
086988                                                                  08698867
086989     EVALUATE TRUE                                                08698967
086990         WHEN SQLCODE = +0                                        08699067
086991              IF PS-CICS-SWITCH-YES                               08699167
086992                  MOVE DK-TRIP-ID        TO PV-DISPLAY-1          08699267
086993                  INITIALIZE PV-CICS-MSG-AREA                     08699367
086994                  STRING   ' ' WS007-SRC-TASK-NUMBER              08699467
086995                           ' WSKCS308-5400:'                      08699567
086996                           ' TRIP='  PV-DISPLAY-1                 08699667
086997                           ' '  TRIPST-TRIP-STATUS-CDE            08699768
086998                           DELIMITED BY SIZE                      08699867
086999                                         INTO PV-CICS-MSG-AREA    08699967
087000                  PERFORM 8000-WRITE-TO-CICS-LOG                  08700067
087001              END-IF                                              08700167
087002         WHEN SQLCODE = -904                                      08700267
087003         WHEN SQLCODE = -913                                      08700367
087004              CONTINUE                                            08700467
087005                                                                  08700567
087006         WHEN SQLWARN0 NOT = SPACES                               08700667
087007         WHEN SQLCODE < +0                                        08700767
087008         WHEN SQLCODE > +0                                        08700867
087009              MOVE DK-TRIP-ID          TO PV-DISPLAY-1            08700968
087010              MOVE SQLCODE             TO WS007-SQLCODE           08701067
087011                                          PV-SQL-RETURN-CD        08701167
087012              INITIALIZE PV-CICS-MSG-AREA                         08701267
087013              STRING   ' ' WS007-SRC-TASK-NUMBER                  08701367
087014                       ' WSKCS308-5400 ERROR:'                    08701467
087015                       ' SQL='                                    08701567
087016                       PV-SQL-RETURN-CD                           08701667
087017                       ' TRIP:'  PV-DISPLAY-1                     08701768
087018                       ' '  TRIPST-TRIP-STATUS-CDE                08701868
087019                       DELIMITED BY SIZE                          08701967
087020                                     INTO PV-CICS-MSG-AREA        08702067
087021              PERFORM 8000-WRITE-TO-CICS-LOG                      08702167
087022                                                                  08702267
087023              SET WS007-INVALID-SQL    TO TRUE                    08702367
087024              MOVE '5400-INSERT-TTRIPST '                         08702467
087025                                       TO WS007-SQL-ERROR-PARA    08702567
087026                                          DP013-PARAGRAPH         08702667
087027              MOVE SQLCA               TO WS007-SQLCA             08702767
087028                                          DP013-SQLCA             08702867
087029              STRING 'SQL='                                       08702967
087030                   PV-SQL-RETURN-CD                               08703067
087031                   DELIMITED BY SIZE                              08703167
087032                                     INTO WS007-CRA-RET-MSG       08703267
087033              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08703367
087034              MOVE 'TTRIPST'                                      08703467
087035                                       TO DP013-DB2-TABLE-NAME (1)08703567
087036              SET DP013-DB2-ABEND      TO TRUE                    08703667
087037              PERFORM 9999-ABEND                                  08703767
087038     END-EVALUATE.                                                08703867
087039                                                                  08703903
087040                                                                  08704003
087041     IF TRIPST-TRIP-STATUS-CDE = 'AR'                             08704103
087042*        MOVE ASC-KEY-TRIP-ID   TO DK-TRIP-ID                     08704209
087043         STRING PV-DB2-HOST-DATE  DELIMITED BY SIZE,              08704303
087044                '-' DELIMITED BY SIZE,                            08704403
087045                PV-DB2-HOST-TIME  DELIMITED BY SIZE,              08704503
087046                '.000000' DELIMITED BY SIZE                       08704603
087047                INTO                PV-REC-TMST                   08704703
087048         END-STRING                                               08704803
087049         MOVE 'N'               TO PS-NO-MORE-RECEIVRS-SW         08704903
087050*        SET PS-NO-TRBL-CREATED-ONSITE                            08705005
087051*            PS-NO-TRBL-ACCESS-TRBL    TO TRUE                    08705105
087052*        MOVE ZEROS TO PV-TRBL-RSLV-CT                            08705205
087053*                      PV-TRBL-MSG-NO                             08705305
087054         PERFORM 6200-OPEN-RECEIVR-CSR                            08705403
087055         PERFORM 6210-FETCH-RECEIVR-CSR                           08705503
087060         PERFORM UNTIL PS-NO-MORE-RECEIVRS                        08706003
087070             PERFORM 6300-UPDATE-RECEIV                           08707003
087080             PERFORM 5430-CHK4-STORAGE-TRBL                       08708003
087090             PERFORM 6210-FETCH-RECEIVR-CSR                       08709003
087091         END-PERFORM                                              08709103
087092         PERFORM 6220-CLOSE-RECEIVR-CSR                           08709203
087093     END-IF.                                                      08709303
087094/                                                                 08709403
087095*----------------------------------------------------------------*08709513
087096*  INSERT A ROW ON THE VEHICLE TRIP STATUS TABLE.                *08709613
087097*  NO UPDATES NEEDED TO THE RECEIVERS ON THE TRIP.               *08709713
087098*----------------------------------------------------------------*08709813
087099 5410-INSERT-TTRIPST.                                             08709913
087100                                                                  08710068
087101     IF PS-CICS-SWITCH-YES                                        08710168
087102         MOVE SPACES TO PV-CICS-MSG-AREA                          08710268
087103         STRING   ' ' WS007-SRC-TASK-NUMBER                       08710368
087104                  ' WSKCS308:'                                    08710468
087105                  ' 5410-INSERT-TTRIPST       '                   08710568
087106                                   DELIMITED BY SIZE              08710668
087107                              INTO PV-CICS-MSG-AREA               08710768
087108         PERFORM 8000-WRITE-TO-CICS-LOG                           08710868
087109     END-IF.                                                      08710968
087110                                                                  08711013
087111     EXEC SQL                                                     08711113
087112         SET :PV-DB2-HOST-DATE      = CURRENT DATE                08711213
087113     END-EXEC.                                                    08711313
087114                                                                  08711413
087115     EXEC SQL                                                     08711513
087116         SET :PV-DB2-HOST-TIME      = CURRENT TIME                08711613
087117     END-EXEC.                                                    08711713
087118                                                                  08711813
087119*    IF THE CURRENT TIME IS LESS THAN OR EQUAL TO THE TIME OF THE 08711913
087120*    PREVIOUSLY INSERTED ROW (MEANING TWO OR MORE RECORDS HAVE BEE08712013
087121*    ADDED IN ON SECOND) ADD A SECOND TO THE PREVIOUS TIME TO KEEP08712113
087122*    TIMES UNIQUE.                                                08712213
087123                                                                  08712313
087124     MOVE TRIPST-STATUS-TME TO PV-CMPR-STATUS-TME.                08712413
087125     MOVE TRIPST-STATUS-DTE TO PV-CMPR-STATUS-DTE.                08712513
087126                                                                  08712613
087127     MOVE WS014-DC-LOCATION TO DK-OPER-UNT-ID.                    08712713
087128                                                                  08712813
087129     IF PV-DB2-HOST-DATE   = PV-CMPR-STATUS-DTE                   08712913
087130        IF  PV-DB2-HOST-TIME          <= PV-CMPR-STATUS-TME       08713040
087131           ADD +1                     TO PV-CMPR-STATUS-TME-SS    08713113
087132           IF PV-CMPR-STATUS-TME-SS    > 59                       08713213
087133              ADD +1                  TO PV-CMPR-STATUS-TME-MM    08713313
087134              MOVE ZEROS              TO PV-CMPR-STATUS-TME-SS    08713413
087135              IF PV-CMPR-STATUS-TME-MM > 59                       08713513
087136                 ADD +1               TO PV-CMPR-STATUS-TME-HH    08713613
087137                 MOVE ZEROS           TO PV-CMPR-STATUS-TME-MM    08713713
087138                 IF PV-CMPR-STATUS-TME-HH                         08713813
087139                                       > 23                       08713913
087140                    MOVE ZEROS        TO PV-CMPR-STATUS-TME-HH    08714013
087141                 END-IF                                           08714113
087142              END-IF                                              08714213
087143           END-IF                                                 08714313
087144           MOVE PV-CMPR-STATUS-TME    TO PV-DB2-HOST-TIME         08714413
087145        ELSE                                                      08714513
087146           MOVE PV-DB2-HOST-TIME      TO PV-CMPR-STATUS-TME       08714613
087147        END-IF                                                    08714713
087148     END-IF.                                                      08714813
087149                                                                  08714913
087150     MOVE PV-DB2-HOST-DATE    TO TRIPST-STATUS-DTE.               08715037
087151     MOVE PV-DB2-HOST-TIME    TO TRIPST-STATUS-TME.               08715137
087152                                                                  08715213
087153     EXEC SQL                                                     08715318
087154         INSERT  INTO TTRIPST                                     08715429
087155                (TRIP_ID                                          08715518
087156                ,TRIP_STATUS_CDE                                  08715618
087157                ,STATUS_DTE                                       08715718
087158                ,STATUS_TME                                       08715818
087159                ,STATUS_UID                                       08715918
087160                ,OPER_UNT_ID                                      08716018
087161                ,FCLTY_ID)                                        08716118
087162        VALUES  (:DK-TRIP-ID                                      08716218
087163                ,:TRIPST-TRIP-STATUS-CDE                          08716318
087164                ,:TRIPST-STATUS-DTE                               08716437
087165                ,:TRIPST-STATUS-TME                               08716537
087166                ,:WS014-CRE-USER-ID                               08716618
087167                ,:DK-OPER-UNT-ID                                  08716718
087168                ,1)                                               08716829
087169     END-EXEC                                                     08716918
087170                                                                  08717018
087171     EVALUATE TRUE                                                08717118
087172         WHEN SQLCODE = +0                                        08717218
087173              IF PS-CICS-SWITCH-YES                               08717331
087174                  MOVE DK-TRIP-ID        TO PV-DISPLAY-1          08717431
087175                  INITIALIZE PV-CICS-MSG-AREA                     08717531
087176                  STRING   ' ' WS007-SRC-TASK-NUMBER              08717631
087177                           ' WSKCS308-5410:'                      08717731
087178                           ' TRIP='  PV-DISPLAY-1                 08717831
087179                           DELIMITED BY SIZE                      08717931
087180                                         INTO PV-CICS-MSG-AREA    08718031
087181                  PERFORM 8000-WRITE-TO-CICS-LOG                  08718131
087182              END-IF                                              08718231
087183         WHEN SQLCODE = -904                                      08718318
087184         WHEN SQLCODE = -913                                      08718418
087185         WHEN SQLCODE = -803                                      08718577
087186             CONTINUE                                             08718677
087187                                                                  08718777
087188         WHEN SQLWARN0 NOT = SPACES                               08718877
087189         WHEN SQLCODE < +0                                        08718977
087190         WHEN SQLCODE > +0                                        08719077
087191              MOVE DK-TRIP-ID          TO PV-DISPLAY-1            08719177
087192              MOVE SQLCODE             TO WS007-SQLCODE           08719231
087193                                          PV-SQL-RETURN-CD        08719331
087194              INITIALIZE PV-CICS-MSG-AREA                         08719431
087195              STRING   ' ' WS007-SRC-TASK-NUMBER                  08719531
087196                       ' WSKCS308-5410 ERROR:'                    08719631
087197                       ' SQL='                                    08719731
087198                       PV-SQL-RETURN-CD                           08719831
087199                       ' TRIP:'  PV-DISPLAY-1                     08719968
087200                       ' ' TRIPST-TRIP-STATUS-CDE                 08720068
087201                       ' ' TRIPST-STATUS-DTE                      08720168
087202                       ' ' TRIPST-STATUS-TME                      08720268
087203                       DELIMITED BY SIZE                          08720331
087204                                     INTO PV-CICS-MSG-AREA        08720431
087205              PERFORM 8000-WRITE-TO-CICS-LOG                      08720531
087206                                                                  08720631
087207              SET WS007-INVALID-SQL    TO TRUE                    08720731
087208              MOVE '5410-INSERT-TTRIPST '                         08720831
087209                                       TO WS007-SQL-ERROR-PARA    08720931
087210                                          DP013-PARAGRAPH         08721031
087211              MOVE SQLCA               TO WS007-SQLCA             08721131
087212                                          DP013-SQLCA             08721231
087213              STRING 'SQL='                                       08721331
087214                   PV-SQL-RETURN-CD                               08721431
087215                   DELIMITED BY SIZE                              08721531
087216                                     INTO WS007-CRA-RET-MSG       08721631
087217              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08721731
087218              MOVE 'TTRIPST'                                      08721831
087219                                       TO DP013-DB2-TABLE-NAME (1)08721931
087220              SET DP013-DB2-ABEND      TO TRUE                    08722031
087221              PERFORM 9999-ABEND                                  08722131
087222     END-EVALUATE.                                                08722218
087223                                                                  08722313
087224                                                                  08722473
087354*----------------------------------------------------------------*08735473
087355*  UPDATE WST_SHPMT_XREF_HDR TABLE TO INDICATE DOWNLOAD IS       *08735573
087356*  COMPLETE SO THAT THE SWEEPER WILL NOT TRY TO DOWNLOAD         *08735673
087357*  THE SHIPMENT AGAIN.                                           *08735773
087358*  DMH 11/29/17                                                   08735873
087359*----------------------------------------------------------------*08735973
087360 5415-UPDATE-WST-HDR.                                             08736073
087361                                                                  08736173
087362     IF PS-CICS-SWITCH-YES                                        08736273
087363         MOVE SPACES TO PV-CICS-MSG-AREA                          08736373
087364         STRING   ' ' WS007-SRC-TASK-NUMBER                       08736473
087365                  ' WSKCS308:'                                    08736573
087366                  ' 5415-UPDATE-WST-HDR       '                   08736673
087367                                   DELIMITED BY SIZE              08736773
087368                              INTO PV-CICS-MSG-AREA               08736873
087369         PERFORM 8000-WRITE-TO-CICS-LOG                           08736973
087370     END-IF.                                                      08737073
087371                                                                  08737173
087372     MOVE  WS014-ORIG-SHIPMT-NBR  TO  DK-SHPMT-BEGIN.             08737273
087373     MOVE  '%'                    TO  DK-SHPMT-LIKE.              08737373
087374                                                                  08737473
087375     EXEC SQL                                                     08737573
087376          UPDATE WST_SHPMT_XREF_HDR                               08737673
087377             SET DWNLD_CDE        = 'C'                           08737773
087378             WHERE EXT_SHP_ID  LIKE :DK-SHPMT-ID-LIKE             08737874
087379               AND DWNLD_CDE     IN ('N','P')                     08737974
087380     END-EXEC                                                     08738073
087381                                                                  08738173
087382     EVALUATE TRUE                                                08738273
087383         WHEN SQLCODE = ZERO                                      08738373
087384         WHEN SQLCODE = +100                                      08738473
087385              CONTINUE                                            08738573
087386              IF PS-CICS-SWITCH-YES                               08738673
087387                  MOVE DK-TRIP-ID        TO PV-DISPLAY-1          08738773
087388                  INITIALIZE PV-CICS-MSG-AREA                     08738873
087389                  STRING   ' ' WS007-SRC-TASK-NUMBER              08738973
087390                           ' WSKCS308-5415:'                      08739073
087391                           ' TRIP='  DK-SHPMT-ID-LIKE             08739174
087392                           DELIMITED BY SIZE                      08739273
087393                                         INTO PV-CICS-MSG-AREA    08739373
087394                  PERFORM 8000-WRITE-TO-CICS-LOG                  08739473
087395              END-IF                                              08739573
087396         WHEN SQLWARN0 NOT = SPACES                               08739673
087397         WHEN SQLCODE NOT = ZERO                                  08739773
087398              MOVE SQLCODE             TO WS007-SQLCODE           08739873
087399                                          PV-SQL-RETURN-CD        08739973
087400              INITIALIZE PV-CICS-MSG-AREA                         08740073
087401              MOVE DK-TRIP-ID        TO PV-DISPLAY-1              08740173
087402              STRING   ' ' WS007-SRC-TASK-NUMBER                  08740273
087403                       ' WSKCS308-5415 ERROR:'                    08740373
087404                       ' SQL='                                    08740473
087405                       PV-SQL-RETURN-CD                           08740573
087406                       ' '  DK-SHPMT-ID-LIKE                      08740674
087407                       DELIMITED BY SIZE                          08740773
087408                                     INTO PV-CICS-MSG-AREA        08740873
087409              PERFORM 8000-WRITE-TO-CICS-LOG                      08740973
087410                                                                  08741073
087411              SET WS007-INVALID-SQL    TO TRUE                    08741173
087412              MOVE '5415-UPDATE-WST-HDR'                          08741273
087413                                       TO WS007-SQL-ERROR-PARA    08741373
087414                                          DP013-PARAGRAPH         08741473
087415              MOVE SQLCA               TO WS007-SQLCA             08741573
087416                                          DP013-SQLCA             08741673
087417              STRING 'SQL='                                       08741773
087418                   PV-SQL-RETURN-CD                               08741873
087419                   DELIMITED BY SIZE                              08741973
087420                                     INTO WS007-CRA-RET-MSG       08742073
087421              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08742173
087422              MOVE 'WST_SHPMT_XREF_HDR'                           08742273
087423                                       TO DP013-DB2-TABLE-NAME (1)08742373
087424              SET DP013-DB2-ABEND      TO TRUE                    08742473
087425              PERFORM 9999-ABEND                                  08742573
087426     END-EVALUATE.                                                08742673
087427                                                                  08742773
087428                                                                  08742873
087429*----------------------------------------------------------------*08742973
087430*  UPDATE WST_SHPMT_XREF_DTL TABLE TO INDICATE DOWNLOAD IS       *08743073
087431*  COMPLETE SO THAT THE SWEEPER WILL NOT TRY TO DOWNLOAD         *08743173
087432*  THE SHIPMENT AGAIN.                                           *08743273
087433*  DMH 11/29/17                                                   08743373
087434*----------------------------------------------------------------*08743473
087435 5420-UPDATE-WST-DTL.                                             08743573
087436                                                                  08743673
087437     IF PS-CICS-SWITCH-YES                                        08743773
087438         MOVE SPACES TO PV-CICS-MSG-AREA                          08743873
087439         STRING   ' ' WS007-SRC-TASK-NUMBER                       08743973
087440                  ' WSKCS308:'                                    08744073
087441                  ' 5420-UPDATE-WST-DTL       '                   08744173
087442                                   DELIMITED BY SIZE              08744273
087443                              INTO PV-CICS-MSG-AREA               08744373
087444         PERFORM 8000-WRITE-TO-CICS-LOG                           08744473
087445     END-IF.                                                      08744573
087446                                                                  08744673
087447     MOVE  WS014-ORIG-SHIPMT-NBR  TO  DK-SHPMT-BEGIN.             08744773
087448     MOVE  '%'                    TO  DK-SHPMT-LIKE.              08744873
087449                                                                  08744973
087450     EXEC SQL                                                     08745073
087451          UPDATE WST_SHPMT_XREF_DTL                               08745173
087452             SET DWNLD_CDE        = 'C'                           08745273
087453             WHERE EXT_SHP_ID  LIKE :DK-SHPMT-ID-LIKE             08745374
087454               AND DWNLD_CDE     IN ('N','P')                     08745474
087455     END-EXEC                                                     08745573
087456                                                                  08745673
087457     EVALUATE TRUE                                                08745773
087458         WHEN SQLCODE = ZERO                                      08745873
087459         WHEN SQLCODE = +100                                      08745973
087460              CONTINUE                                            08746073
087461              IF PS-CICS-SWITCH-YES                               08746173
087462                  MOVE DK-TRIP-ID        TO PV-DISPLAY-1          08746273
087463                  INITIALIZE PV-CICS-MSG-AREA                     08746373
087464                  STRING   ' ' WS007-SRC-TASK-NUMBER              08746473
087465                           ' WSKCS308-5420:'                      08746573
087466                           ' TRIP='  DK-SHPMT-ID-LIKE             08746674
087467                           DELIMITED BY SIZE                      08746773
087468                                         INTO PV-CICS-MSG-AREA    08746873
087469                  PERFORM 8000-WRITE-TO-CICS-LOG                  08746973
087470              END-IF                                              08747073
087471         WHEN SQLWARN0 NOT = SPACES                               08747173
087472         WHEN SQLCODE NOT = ZERO                                  08747273
087473              MOVE SQLCODE             TO WS007-SQLCODE           08747373
087474                                          PV-SQL-RETURN-CD        08747473
087475              INITIALIZE PV-CICS-MSG-AREA                         08747573
087476              MOVE DK-TRIP-ID        TO PV-DISPLAY-1              08747673
087477              STRING   ' ' WS007-SRC-TASK-NUMBER                  08747773
087478                       ' WSKCS308-5420 ERROR:'                    08747873
087479                       ' SQL='                                    08747973
087480                       PV-SQL-RETURN-CD                           08748073
087481                       ' '  DK-SHPMT-ID-LIKE                      08748174
087482                       DELIMITED BY SIZE                          08748273
087483                                     INTO PV-CICS-MSG-AREA        08748373
087484              PERFORM 8000-WRITE-TO-CICS-LOG                      08748473
087485                                                                  08748573
087486              SET WS007-INVALID-SQL    TO TRUE                    08748673
087487              MOVE '5420-UPDATE-WST-DTL'                          08748773
087488                                       TO WS007-SQL-ERROR-PARA    08748873
087489                                          DP013-PARAGRAPH         08748973
087490              MOVE SQLCA               TO WS007-SQLCA             08749073
087491                                          DP013-SQLCA             08749173
087492              STRING 'SQL='                                       08749273
087493                   PV-SQL-RETURN-CD                               08749373
087494                   DELIMITED BY SIZE                              08749473
087495                                     INTO WS007-CRA-RET-MSG       08749573
087496              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08749673
087497              MOVE 'WST_SHPMT_XREF_DTL'                           08749773
087498                                       TO DP013-DB2-TABLE-NAME (1)08749873
087499              SET DP013-DB2-ABEND      TO TRUE                    08749973
087500              PERFORM 9999-ABEND                                  08750073
087501     END-EVALUATE.                                                08750173
087502                                                                  08750273
087503                                                                  08750373
087504*----------------------------------------------------------------*08750473
087505*                                                                *08750573
087506*----------------------------------------------------------------*08750673
087507 5430-CHK4-STORAGE-TRBL.                                          08750773
087508                                                                  08750873
087509     IF PS-CICS-SWITCH-YES                                        08750973
087510         MOVE SPACES TO PV-CICS-MSG-AREA                          08751073
087511         STRING   ' ' WS007-SRC-TASK-NUMBER                       08751173
087512                  ' WSKCS308:'                                    08751273
087513                  ' 5430-CHK4-STORAGE-TRBL    '                   08751373
087514                                   DELIMITED BY SIZE              08751473
087515                              INTO PV-CICS-MSG-AREA               08751573
087516         PERFORM 8000-WRITE-TO-CICS-LOG                           08751673
087517     END-IF.                                                      08751773
087518                                                                  08751873
087519     EXEC SQL                                                     08751973
087520         SELECT OPER_UNT_ID                                       08752073
087521              , FCLTY_ID                                          08752173
087522              , PO_NBR                                            08752273
087523              , REC_SEQ_NBR                                       08752373
087524              , TRBL_RSN_CDE                                      08752473
087525          INTO  :TRBNTF-OPER-UNT-ID                               08752573
087526              , :TRBNTF-FCLTY-ID                                  08752673
087527              , :TRBNTF-PO-NBR                                    08752773
087528              , :TRBNTF-REC-SEQ-NBR                               08752873
087529              , :TRBNTF-TRBL-RSN-CDE                              08752973
087530          FROM  TTRBNTF                                           08753073
087531          WHERE PO_NBR        = :RECEIV-ORD-NBR                   08753173
087532            AND REC_SEQ_NBR   = :RECEIV-REC-SEQ-NBR               08753273
087533            AND TRBL_RSN_CDE  IN (:PC-997, :PC-998)               08753373
087534            AND RESOLVED_IND  IN (:PC-I, :PC-N)                   08753473
087535     END-EXEC                                                     08753573
087536                                                                  08753673
087537     EVALUATE TRUE                                                08753773
087538         WHEN SQLCODE = +0                                        08753873
087539              IF PS-CICS-SWITCH-YES                               08753973
087540                  MOVE RECEIV-ORD-NBR     TO PV-DISPLAY-1         08754073
087541                  MOVE RECEIV-REC-SEQ-NBR TO PV-DISPLAY-2         08754173
087542                  INITIALIZE PV-CICS-MSG-AREA                     08754273
087543                  STRING   ' ' WS007-SRC-TASK-NUMBER              08754373
087544                           ' WSKCS308-5430:'                      08754473
087545                           ' PO='    PV-DISPLAY-1                 08754573
087546                           ' RCVR='  PV-DISPLAY-2                 08754673
087547                           DELIMITED BY SIZE                      08754773
087548                                         INTO PV-CICS-MSG-AREA    08754873
087549                  PERFORM 8000-WRITE-TO-CICS-LOG                  08754973
087550              END-IF                                              08755073
087551              PERFORM 5440-CHK-TRBL-RSN                           08755173
087552         WHEN SQLCODE = +100                                      08755273
087553         WHEN SQLCODE = -904                                      08755373
087554         WHEN SQLCODE = -913                                      08755473
087555              CONTINUE                                            08755573
087556         WHEN SQLWARN0 NOT = SPACE                                08755673
087557         WHEN SQLCODE < ZERO                                      08755773
087558         WHEN SQLCODE > ZERO                                      08755873
087559              MOVE RECEIV-ORD-NBR     TO PV-DISPLAY-1             08755973
087560              MOVE RECEIV-REC-SEQ-NBR TO PV-DISPLAY-2             08756073
087561              MOVE SQLCODE             TO WS007-SQLCODE           08756173
087562                                          PV-SQL-RETURN-CD        08756273
087563              INITIALIZE PV-CICS-MSG-AREA                         08756373
087564              STRING   ' ' WS007-SRC-TASK-NUMBER                  08756473
087565                       ' WSKCS308-5430 ERROR:'                    08756573
087566                       ' SQL='                                    08756673
087567                       PV-SQL-RETURN-CD                           08756773
087568                       ' RCVR:'    PV-DISPLAY-1                   08756873
087569                       '-'         PV-DISPLAY-2                   08756973
087570                       DELIMITED BY SIZE                          08757073
087571                                     INTO PV-CICS-MSG-AREA        08757173
087572              PERFORM 8000-WRITE-TO-CICS-LOG                      08757273
087573                                                                  08757373
087574              SET WS007-INVALID-SQL    TO TRUE                    08757473
087575              MOVE '5430-CHK4-STORAGE-TRBL'                       08757573
087576                                       TO WS007-SQL-ERROR-PARA    08757673
087577                                          DP013-PARAGRAPH         08757773
087578              MOVE SQLCA               TO WS007-SQLCA             08757873
087579                                          DP013-SQLCA             08757973
087580              STRING 'SQL='                                       08758073
087581                   PV-SQL-RETURN-CD                               08758173
087582                   DELIMITED BY SIZE                              08758273
087583                                     INTO WS007-CRA-RET-MSG       08758373
087584              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08758473
087585              MOVE 'TTRBNTF'                                      08758573
087586                                       TO DP013-DB2-TABLE-NAME (1)08758673
087587              SET DP013-DB2-ABEND      TO TRUE                    08758773
087588              PERFORM 9999-ABEND                                  08758873
087589     END-EVALUATE.                                                08758973
087590                                                                  08759073
087591 5440-CHK-TRBL-RSN.                                               08759173
087592                                                                  08759273
087593     IF PS-CICS-SWITCH-YES                                        08759373
087594         MOVE SPACES TO PV-CICS-MSG-AREA                          08759473
087595         STRING   ' ' WS007-SRC-TASK-NUMBER                       08759573
087596                  ' WSKCS308:'                                    08759673
087597                  ' 5440-CHK-TRBL-RSN         '                   08759773
087598                                   DELIMITED BY SIZE              08759873
087599                              INTO PV-CICS-MSG-AREA               08759973
087600         PERFORM 8000-WRITE-TO-CICS-LOG                           08760073
087601     END-IF.                                                      08760173
087602                                                                  08760273
087603**** TRBL-RSN-CDES 997 OR 998 ARE TO  BE RESOLVED WHEN            08760373
087604**** A TRAILER IS PLACED IN 'ARRIVED' STATUS                      08760473
087605     IF TRBNTF-TRBL-RSN-CDE = 997 OR 998                          08760573
087606         SET TM500-RESOLVE-MANUAL                                 08760673
087607             TM500-PO-LEVEL                                       08760773
087608             TM500-ADD-DETAILS TO TRUE                            08760873
087609         MOVE TRBNTF-OPER-UNT-ID  TO TM500-OPER-UNT-ID            08760973
087610         MOVE TRBNTF-FCLTY-ID     TO TM500-FCLTY-ID               08761073
087611         MOVE TRBNTF-PO-NBR       TO TM500-PO-NBR                 08761173
087612         MOVE TRBNTF-REC-SEQ-NBR  TO TM500-REC-SEQ-NBR            08761273
087613         MOVE TRBNTF-TRBL-RSN-CDE TO TM500-TRBL-RSN-CDE           08761373
087614         MOVE ZERO                TO TM500-PO-LNE-NBR             08761473
087615         MOVE WS014-CRE-USER-ID   TO TM500-RESOLVED-UID           08761573
087616         MOVE PC-RESOLVE-AUTO-MSG TO TM500-FREEFORM-TEXT          08761673
087617*        PERFORM 5450-TRBL-UPDATE                                 08761773
087618*        IF TM500-CALL-SUCCESSFUL                                 08761873
087619*            ADD +1 TO PV-TRBL-RSLV-CT                            08761973
087620*        END-IF                                                   08762073
087621     END-IF.                                                      08762173
087622                                                                  08762273
087623**** AFTER A SUCCESSFUL RESOLUTION OF TRBL-RSN-CDE 998,           08762373
087624**** TRBL-RSN-CDE 999 IS CREATED FOR THE 'ARRIVED' TRAILER        08762473
087625**** INDICATING THAT THIS TRAILER STILL HAS STORAGE TROUBLE       08762573
087626     IF TM500-CALL-SUCCESSFUL                                     08762673
087627         IF TRBNTF-TRBL-RSN-CDE = 998                             08762773
087628             SET TM500-CREATE-MANUAL                              08762873
087629                 TM500-PO-LEVEL                                   08762973
087630                 TM500-ADD-DETAILS TO TRUE                        08763073
087631*                PS-TRBL-CREATED-ONSITE TO TRUE                   08763173
087632             MOVE PC-999            TO TM500-TRBL-RSN-CDE         08763273
087633             MOVE WS014-CRE-USER-ID TO TM500-NOTIF-UID            08763373
087634                                       TM500-CRE-UID              08763473
087635             MOVE TRBNTF-OPER-UNT-ID TO TM500-OPER-UNT-ID         08763573
087636             MOVE TRBNTF-FCLTY-ID    TO TM500-FCLTY-ID            08763673
087637             MOVE TRBNTF-PO-NBR      TO TM500-PO-NBR              08763773
087638             MOVE TRBNTF-PO-LNE-NBR  TO TM500-PO-LNE-NBR          08763873
087639             MOVE TRBNTF-REC-SEQ-NBR TO TM500-REC-SEQ-NBR         08763973
087640             MOVE PC-CREATE-AUTO-MSG TO                           08764073
087641                                     TM500-FREEFORM-TEXT          08764173
087642*            PERFORM 5450-TRBL-UPDATE                             08764273
087643         END-IF                                                   08764373
087644*    ELSE                                                         08764473
087645*        SET PS-TRBL-ACCESS-TRBL-F TO TRUE                        08764573
087646*        MOVE PC-TSYMSG-01669 TO PV-TRBL-MSG-NO                   08764673
087647     END-IF.                                                      08764773
087648                                                                  08764873
087649                                                                  08764973
087650*5450-TRBL-UPDATE.                                                08765073
087651*    PERFORM 5460-LINK-TO-UPDATE.                                 08765173
087652*    IF TM500-CALL-SUCCESSFUL                                     08765273
087653*        CONTINUE                                                 08765373
087654*    ELSE                                                         08765473
087655*        SET PS-TRBL-ACCESS-TRBL-F TO TRUE                        08765573
087656*        MOVE PC-TSYMSG-01669 TO PV-TRBL-MSG-NO                   08765673
087657*        SET DP020-MSG-FATAL    TO TRUE                           08765773
087658*    END-IF.                                                      08765873
087659******************************************************************08765973
087660*5460-LINK-TO-UPDATE.                                             08766073
087661*    EXEC CICS LINK                                               08766173
087662*        PROGRAM  (PC-TMKCS520)                                   08766273
087663*        COMMAREA (TM500-FIELDS)                                  08766373
087664*        RESP     (PV-CICS-RESPONSE)                              08766473
087665*    END-EXEC.                                                    08766573
087666                                                                  08766673
087667*    IF PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)                08766773
087668*        MOVE 'C'       TO DP013-ABEND-TYPE-IND                   08766873
087669****     DP013-CICS-ABEND                                         08766973
087670*        MOVE '4'       TO DP013-ABEND-CONTROL-IND                08767073
087671****     DP013-LINK-RETURN                                        08767173
087672*        MOVE 'N'       TO DP013-ROLLBACK-IND                     08767273
087673****     DP013-NO-ROLLBACK                                        08767373
087674*        MOVE '5460-LINK-TO-UPDATE' TO  DP013-PARAGRAPH           08767473
087675*        MOVE 'ATTEMPTING TO LINK TO CENTRAL PROCESSING'          08767573
087676*                                   TO DP013-MESSAGE-TEXT (1)     08767673
087677*        PERFORM DP013-0000-PROCESS-ABEND                         08767773
087678*    END-IF.                                                      08767873
087679/                                                                 08767973
087680*----------------------------------------------------------------*08768073
087681*  INSERT A ROW ON THE SHIPMENT STATUS TABLE                     *08768173
087682*----------------------------------------------------------------*08768273
087683 5500-INSERT-TSHIPST.                                             08768373
087684                                                                  08768473
087685     IF PS-CICS-SWITCH-YES                                        08768573
087686         MOVE SPACES TO PV-CICS-MSG-AREA                          08768673
087687         STRING   ' ' WS007-SRC-TASK-NUMBER                       08768773
087688                  ' WSKCS308:'                                    08768873
087689                  ' 5500-INSERT-TSHIPST       '                   08768973
087690                                   DELIMITED BY SIZE              08769073
087691                              INTO PV-CICS-MSG-AREA               08769173
087692         PERFORM 8000-WRITE-TO-CICS-LOG                           08769273
087693     END-IF.                                                      08769373
087694                                                                  08769473
087695     PERFORM 6100-OPEN-SHIPMENT-CSR                               08769573
087696     PERFORM 6102-FETCH-SHIPMENT-CSR                              08769673
087697* JAK 08/2007 CHG TO USE INTERNAL ERROR SWITCH                    08769773
087698**** PERFORM UNTIL PS-NO-MORE-SHIPMENTS OR WS007-ERROR            08769873
087699     PERFORM UNTIL PS-NO-MORE-SHIPMENTS OR PS-ERROR-SW-YES        08769973
087700        MOVE SHIPMT-SHIPT-ID                                      08770073
087701                            TO DK-SHIPT-ID-N                      08770173
087702        PERFORM 6110-SELECT-TSHIPST                               08770273
087703        MOVE 'AR'   TO SHIPST-SHIPT-STATUS-CDE                    08770373
087704        PERFORM 6120-INSERT-TSHIPST                               08770473
087705        PERFORM 6102-FETCH-SHIPMENT-CSR                           08770573
087706     END-PERFORM                                                  08770673
087707     PERFORM 6104-CLOSE-SHIPMENT-CSR.                             08770773
087708/                                                                 08770873
087709*----------------------------------------------------------------*08770973
087710*  INSERT A ROW ON THE SHIPMENT STATUS TABLE                     *08771073
087711*----------------------------------------------------------------*08771173
087712 5600-INSERT-TSHIPST.                                             08771273
087713                                                                  08771373
087714     IF PS-CICS-SWITCH-YES                                        08771473
087715         MOVE SPACES TO PV-CICS-MSG-AREA                          08771573
087716         STRING   ' ' WS007-SRC-TASK-NUMBER                       08771673
087717                  ' WSKCS308:'                                    08771773
087718                  ' 5600-INSERT-TSHIPST       '                   08771873
087719                                   DELIMITED BY SIZE              08771973
087720                              INTO PV-CICS-MSG-AREA               08772073
087721         PERFORM 8000-WRITE-TO-CICS-LOG                           08772173
087722     END-IF.                                                      08772273
087723                                                                  08772373
087724     PERFORM 6100-OPEN-SHIPMENT-CSR                               08772473
087725     PERFORM 6102-FETCH-SHIPMENT-CSR                              08772573
087726     PERFORM UNTIL PS-NO-MORE-SHIPMENTS                           08772673
087727        MOVE SHIPMT-SHIPT-ID                                      08772773
087728                            TO DK-SHIPT-ID-N                      08772873
087729        PERFORM 6110-SELECT-TSHIPST                               08772973
087730* JAK 05/2007 - MOVE CALLS TO INSERT STATUS CODE HERE             08773073
087731        MOVE 'UN'     TO SHIPST-SHIPT-STATUS-CDE                  08773173
087732        PERFORM 6120-INSERT-TSHIPST                               08773273
087733*       MOVE 'DP'     TO SHIPST-SHIPT-STATUS-CDE                  08773373
087734*       PERFORM 6120-INSERT-TSHIPST                               08773473
087735*       MOVE 'ET'     TO SHIPST-SHIPT-STATUS-CDE                  08773573
087736*       PERFORM 6120-INSERT-TSHIPST                               08773673
087737        PERFORM 6102-FETCH-SHIPMENT-CSR                           08773773
087738     END-PERFORM                                                  08773873
087739     PERFORM 6104-CLOSE-SHIPMENT-CSR.                             08773973
087740/                                                                 08774073
087741*----------------------------------------------------------------*08774173
087742* OPEN THE SHIPMENT CURSROR                                      *08774273
087743*----------------------------------------------------------------*08774373
087744 6100-OPEN-SHIPMENT-CSR.                                          08774473
087745                                                                  08774573
087746     IF PS-CICS-SWITCH-YES                                        08774673
087747         MOVE SPACES TO PV-CICS-MSG-AREA                          08774773
087748         STRING   ' ' WS007-SRC-TASK-NUMBER                       08774873
087749                  ' WSKCS308:'                                    08774973
087750                  ' 6100-OPEN-SHIPMENT-CSR    '                   08775073
087751                                   DELIMITED BY SIZE              08775173
087752                              INTO PV-CICS-MSG-AREA               08775273
087753         PERFORM 8000-WRITE-TO-CICS-LOG                           08775373
087754     END-IF.                                                      08775473
087755                                                                  08775573
087756                                                                  08775673
087757     EXEC SQL                                                     08775773
087758          OPEN SHIPMENT-CSR                                       08775873
087759     END-EXEC                                                     08775973
087760                                                                  08776073
087761     EVALUATE TRUE                                                08776173
087762         WHEN SQLCODE = +0                                        08776273
087763              CONTINUE                                            08776373
087764              IF PS-CICS-SWITCH-YES                               08776473
087765                  MOVE DK-TRIP-ID  TO  PV-DISPLAY-1               08776573
087766                  INITIALIZE PV-CICS-MSG-AREA                     08776673
087767                  STRING   ' ' WS007-SRC-TASK-NUMBER              08776773
087768                           ' WSKCS308-6100:'                      08776873
087769                           ' OPEN SHIPMENT CSR'                   08776973
087770                           ' TRIP:'  PV-DISPLAY-1                 08777073
087771                           DELIMITED BY SIZE                      08777173
087772                                         INTO PV-CICS-MSG-AREA    08777273
087773                  PERFORM 8000-WRITE-TO-CICS-LOG                  08777373
087774              END-IF                                              08777473
087775         WHEN SQLCODE = -904                                      08777573
087776         WHEN SQLCODE = -913                                      08777673
087777              CONTINUE                                            08777773
087778         WHEN SQLWARN0 NOT = SPACE                                08777873
087779         WHEN SQLCODE  NOT = +0                                   08777973
087780              MOVE DK-TRIP-ID          TO  PV-DISPLAY-1           08778073
087781              MOVE SQLCODE             TO WS007-SQLCODE           08778173
087782                                          PV-SQL-RETURN-CD        08778273
087783              INITIALIZE PV-CICS-MSG-AREA                         08778373
087784              STRING   ' ' WS007-SRC-TASK-NUMBER                  08778473
087785                       ' WSKCS308-6100 ERROR:'                    08778573
087786                       ' SQL='                                    08778673
087787                       PV-SQL-RETURN-CD                           08778773
087788                       ' TRIP:'  PV-DISPLAY-1                     08778873
087789                       DELIMITED BY SIZE                          08778973
087790                                     INTO PV-CICS-MSG-AREA        08779073
087791              PERFORM 8000-WRITE-TO-CICS-LOG                      08779173
087792                                                                  08779273
087793              SET WS007-INVALID-SQL    TO TRUE                    08779373
087794              MOVE '6100-OPEN-SHIPMENT-CSR'                       08779473
087795                                       TO WS007-SQL-ERROR-PARA    08779573
087796                                          DP013-PARAGRAPH         08779673
087797              MOVE SQLCA               TO WS007-SQLCA             08779773
087798                                          DP013-SQLCA             08779873
087799              STRING 'SQL='                                       08779973
087800                   PV-SQL-RETURN-CD                               08780073
087801                   DELIMITED BY SIZE                              08780173
087802                                     INTO WS007-CRA-RET-MSG       08780273
087803              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08780373
087804              MOVE 'TSHIPMT'                                      08780473
087805                                       TO DP013-DB2-TABLE-NAME (1)08780573
087806              SET DP013-DB2-ABEND      TO TRUE                    08780673
087807              PERFORM 9999-ABEND                                  08780773
087808     END-EVALUATE.                                                08780873
087809/                                                                 08780973
087810*----------------------------------------------------------------*08781073
087811*    FETCH A SHIPMENT ROW                                        *08781173
087812*----------------------------------------------------------------*08781273
087813                                                                  08781373
087814 6102-FETCH-SHIPMENT-CSR.                                         08781473
087815                                                                  08781573
087816     IF PS-CICS-SWITCH-YES                                        08781673
087817         MOVE SPACES TO PV-CICS-MSG-AREA                          08781773
087818         STRING   ' ' WS007-SRC-TASK-NUMBER                       08781873
087819                  ' WSKCS308:'                                    08781973
087820                  ' 6102-FETCH-SHIPMENT-CSR   '                   08782073
087821                                   DELIMITED BY SIZE              08782173
087822                              INTO PV-CICS-MSG-AREA               08782273
087823         PERFORM 8000-WRITE-TO-CICS-LOG                           08782373
087824     END-IF.                                                      08782473
087825                                                                  08782573
087826     EXEC SQL                                                     08782673
087827          FETCH SHIPMENT-CSR                                      08782773
087828          INTO :SHIPMT-SHIPT-ID                                   08782873
087829     END-EXEC                                                     08782973
087830                                                                  08783073
087831     EVALUATE TRUE                                                08783173
087832         WHEN SQLCODE = +0                                        08783273
087833              IF PS-CICS-SWITCH-YES                               08783373
087834                  MOVE SHIPMT-SHIPT-ID  TO PV-DISPLAY-1           08783473
087835                  INITIALIZE PV-CICS-MSG-AREA                     08783573
087836                  STRING   ' ' WS007-SRC-TASK-NUMBER              08783673
087837                           ' WSKCS308-6102:'                      08783773
087838                           ' SHPMT=' PV-DISPLAY-1                 08783873
087839                           DELIMITED BY SIZE                      08783973
087840                                         INTO PV-CICS-MSG-AREA    08784073
087841                  PERFORM 8000-WRITE-TO-CICS-LOG                  08784173
087842              END-IF                                              08784273
087843                                                                  08784373
087844         WHEN SQLCODE = +100                                      08784473
087845              SET PS-NO-MORE-SHIPMENTS TO TRUE                    08784573
087846                                                                  08784673
087847         WHEN SQLWARN0 NOT = SPACE                                08784773
087848         WHEN SQLCODE < +0                                        08784873
087849         WHEN SQLCODE > +0                                        08784973
087850              MOVE DK-TRIP-ID          TO PV-DISPLAY-1            08785073
087851              MOVE SQLCODE             TO WS007-SQLCODE           08785173
087852                                          PV-SQL-RETURN-CD        08785273
087853              INITIALIZE PV-CICS-MSG-AREA                         08785373
087854              STRING   ' ' WS007-SRC-TASK-NUMBER                  08785473
087855                       ' WSKCS308-6102 ERROR:'                    08785573
087856                       ' SQL='                                    08785673
087857                       PV-SQL-RETURN-CD                           08785773
087858                       ' TRIP:'  PV-DISPLAY-1                     08785873
087859                       DELIMITED BY SIZE                          08785973
087860                                     INTO PV-CICS-MSG-AREA        08786073
087861              PERFORM 8000-WRITE-TO-CICS-LOG                      08786173
087862                                                                  08786273
087863              SET WS007-INVALID-SQL    TO TRUE                    08786373
087864              MOVE '6102-FETCH-SHIPMENT-CSR'                      08786473
087865                                       TO WS007-SQL-ERROR-PARA    08786573
087866                                          DP013-PARAGRAPH         08786673
087867              MOVE SQLCA               TO WS007-SQLCA             08786773
087868                                          DP013-SQLCA             08786873
087869              STRING 'SQL='                                       08786973
087870                   PV-SQL-RETURN-CD                               08787073
087871                   DELIMITED BY SIZE                              08787173
087872                                     INTO WS007-CRA-RET-MSG       08787273
087873              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08787373
087874              MOVE 'TSHIPMT'                                      08787473
087875                                       TO DP013-DB2-TABLE-NAME (1)08787573
087876              SET DP013-DB2-ABEND      TO TRUE                    08787673
087877              PERFORM 9999-ABEND                                  08787773
087878     END-EVALUATE.                                                08787873
087879/                                                                 08787973
087880*----------------------------------------------------------------*08788073
087881* CLOSE THE SHIPMENT CURSOR                                      *08788173
087882*----------------------------------------------------------------*08788273
087883 6104-CLOSE-SHIPMENT-CSR.                                         08788373
087884                                                                  08788473
087885     IF PS-CICS-SWITCH-YES                                        08788573
087886         MOVE SPACES TO PV-CICS-MSG-AREA                          08788673
087887         STRING   ' ' WS007-SRC-TASK-NUMBER                       08788773
087888                  ' WSKCS308:'                                    08788873
087889                  ' 6104-CLOSE-SHIPMENT-CSR   '                   08788973
087890                                   DELIMITED BY SIZE              08789073
087891                              INTO PV-CICS-MSG-AREA               08789173
087892         PERFORM 8000-WRITE-TO-CICS-LOG                           08789273
087893     END-IF.                                                      08789373
087894                                                                  08789473
087895     EXEC SQL                                                     08789573
087896          CLOSE SHIPMENT-CSR                                      08789673
087897     END-EXEC                                                     08789773
087898                                                                  08789873
087899     EVALUATE TRUE                                                08789973
087900         WHEN SQLCODE = +0                                        08790073
087901              IF PS-CICS-SWITCH-YES                               08790173
087902                  MOVE DK-TRIP-ID  TO  PV-DISPLAY-1               08790273
087903                  INITIALIZE PV-CICS-MSG-AREA                     08790373
087904                  STRING   ' ' WS007-SRC-TASK-NUMBER              08790473
087905                           ' WSKCS308-6104:'                      08790573
087906                           ' CLOSE SHIPMENT CSR'                  08790673
087907                           ' TRIP:' PV-DISPLAY-1                  08790773
087908                           DELIMITED BY SIZE                      08790873
087909                                         INTO PV-CICS-MSG-AREA    08790973
087910                  PERFORM 8000-WRITE-TO-CICS-LOG                  08791073
087911              END-IF                                              08791173
087912         WHEN SQLWARN0 NOT = SPACE                                08791273
087913         WHEN SQLCODE  NOT = +0                                   08791373
087914              MOVE DK-TRIP-ID          TO  PV-DISPLAY-1           08791473
087915              MOVE SQLCODE             TO WS007-SQLCODE           08791573
087916                                          PV-SQL-RETURN-CD        08791673
087917              INITIALIZE PV-CICS-MSG-AREA                         08791773
087918              STRING   ' ' WS007-SRC-TASK-NUMBER                  08791873
087919                       ' WSKCS308-6104 ERROR:'                    08791973
087920                       ' SQL='                                    08792073
087921                       PV-SQL-RETURN-CD                           08792173
087922                       ' TRIP:' PV-DISPLAY-1                      08792273
087923                       DELIMITED BY SIZE                          08792373
087924                                     INTO PV-CICS-MSG-AREA        08792473
087925              PERFORM 8000-WRITE-TO-CICS-LOG                      08792573
087926                                                                  08792673
087927              SET WS007-INVALID-SQL    TO TRUE                    08792773
087928              MOVE '6104-CLOSE-SHIPMENT-CSR'                      08792873
087929                                       TO WS007-SQL-ERROR-PARA    08792973
087930                                          DP013-PARAGRAPH         08793073
087931              MOVE SQLCA               TO WS007-SQLCA             08793173
087932                                          DP013-SQLCA             08793273
087933              STRING 'SQL='                                       08793373
087934                   PV-SQL-RETURN-CD                               08793473
087935                   DELIMITED BY SIZE                              08793573
087936                                     INTO WS007-CRA-RET-MSG       08793673
087937              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08793773
087938              MOVE 'TSHIPMT'                                      08793873
087939                                       TO DP013-DB2-TABLE-NAME (1)08793973
087940              SET DP013-DB2-ABEND      TO TRUE                    08794073
087941              PERFORM 9999-ABEND                                  08794173
087942     END-EVALUATE.                                                08794273
087943/                                                                 08794373
087944*----------------------------------------------------------------*08794473
087945*  SELECT LATEST SHIPMENT STATUS ROW                             *08794573
087946*----------------------------------------------------------------*08794673
087947 6110-SELECT-TSHIPST.                                             08794773
087948                                                                  08794873
087949     IF PS-CICS-SWITCH-YES                                        08794973
087950         MOVE SPACES TO PV-CICS-MSG-AREA                          08795073
087951         STRING   ' ' WS007-SRC-TASK-NUMBER                       08795173
087952                  ' WSKCS308:'                                    08795273
087953                  ' 6110-SELECT-TSHIPST       '                   08795373
087954                                   DELIMITED BY SIZE              08795473
087955                              INTO PV-CICS-MSG-AREA               08795573
087956         PERFORM 8000-WRITE-TO-CICS-LOG                           08795673
087957     END-IF.                                                      08795773
087958                                                                  08795873
087959                                                                  08795973
087960     EXEC SQL                                                     08796073
087961         SELECT  A.SHIPT_ID                                       08796173
087962                ,A.SHIPT_STATUS_CDE                               08796273
087963                ,A.STATUS_DTE                                     08796373
087964                ,A.STATUS_TME                                     08796473
087965                ,A.STATUS_UID                                     08796573
087966                ,A.DELAY_RSN_CDE                                  08796673
087967                ,A.CARR_STATUS_CDE                                08796773
087968                ,A.TIME_ZONE_CDE                                  08796873
087969                ,A.CITY_NAME                                      08796973
087970                ,A.STATE_CDE                                      08797073
087971         INTO    :SHIPST-SHIPT-ID                                 08797173
087972                ,:SHIPST-SHIPT-STATUS-CDE                         08797273
087973                ,:SHIPST-STATUS-DTE                               08797373
087974                ,:SHIPST-STATUS-TME                               08797473
087975                ,:SHIPST-STATUS-UID                               08797573
087976                ,:SHIPST-DELAY-RSN-CDE                            08797673
087977                ,:SHIPST-CARR-STATUS-CDE                          08797773
087978                ,:SHIPST-TIME-ZONE-CDE                            08797873
087979                ,:SHIPST-CITY-NAME                                08797973
087980                ,:SHIPST-STATE-CDE                                08798073
087981       FROM   TSHIPST A                                           08798173
087982             ,TSHSTYP B                                           08798273
087983       WHERE  A.SHIPT_ID = :DK-SHIPT-ID-N                         08798373
087984         AND  B.PRTY_CDE =                                        08798473
087985              (SELECT MAX(D.PRTY_CDE)                             08798573
087986                 FROM TSHIPST C                                   08798673
087987                     ,TSHSTYP D                                   08798773
087988                WHERE C.SHIPT_ID         = A.SHIPT_ID             08798873
087989                  AND C.SHIPT_STATUS_CDE = D.SHIPT_STATUS_CDE)    08798973
087990         AND  A.SHIPT_STATUS_CDE = B.SHIPT_STATUS_CDE             08799073
087991     END-EXEC                                                     08799173
087992                                                                  08799273
087993     EVALUATE TRUE                                                08799373
087994         WHEN SQLCODE = +0                                        08799473
087995              IF PS-CICS-SWITCH-YES                               08799573
087996                  MOVE SHIPST-SHIPT-ID  TO PV-DISPLAY-1           08799673
087997                  INITIALIZE PV-CICS-MSG-AREA                     08799773
087998                  STRING   ' ' WS007-SRC-TASK-NUMBER              08799873
087999                           ' WSKCS308-6110:'                      08799973
088000                           ' SHPMT=' PV-DISPLAY-1                 08800073
088001                           DELIMITED BY SIZE                      08800173
088002                                         INTO PV-CICS-MSG-AREA    08800273
088003                  PERFORM 8000-WRITE-TO-CICS-LOG                  08800373
088004              END-IF                                              08800473
088005         WHEN SQLCODE = -904                                      08800573
088006         WHEN SQLCODE = -913                                      08800673
088007             CONTINUE                                             08800773
088008                                                                  08800873
088009         WHEN SQLWARN0 NOT = SPACES                               08800973
088010         WHEN SQLCODE < +0                                        08801073
088011         WHEN SQLCODE > +0                                        08801173
088012              MOVE DK-SHIPT-ID-N       TO PV-DISPLAY-1            08801273
088013              MOVE SQLCODE             TO WS007-SQLCODE           08801373
088014                                          PV-SQL-RETURN-CD        08801473
088015              INITIALIZE PV-CICS-MSG-AREA                         08801573
088016              STRING   ' ' WS007-SRC-TASK-NUMBER                  08801673
088017                       ' WSKCS308-6110 ERROR:'                    08801773
088018                       ' SQL='                                    08801873
088019                       PV-SQL-RETURN-CD                           08801973
088020                       ' SHPMT:' PV-DISPLAY-1                     08802073
088021                       DELIMITED BY SIZE                          08802173
088022                                     INTO PV-CICS-MSG-AREA        08802273
088023              PERFORM 8000-WRITE-TO-CICS-LOG                      08802373
088024                                                                  08802473
088025              SET WS007-INVALID-SQL    TO TRUE                    08802573
088026              MOVE '6110-SELECT-TSHIPST'                          08802673
088027                                       TO WS007-SQL-ERROR-PARA    08802773
088028                                          DP013-PARAGRAPH         08802873
088029              MOVE SQLCA               TO WS007-SQLCA             08802973
088030                                          DP013-SQLCA             08803073
088031              STRING 'SQL='                                       08803173
088032                   PV-SQL-RETURN-CD                               08803273
088033                   DELIMITED BY SIZE                              08803373
088034                                     INTO WS007-CRA-RET-MSG       08803473
088035              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08803573
088036              MOVE 'TSHIPST'                                      08803673
088037                                       TO DP013-DB2-TABLE-NAME (1)08803773
088038              MOVE 'TSHSTYP'                                      08803873
088039                                       TO DP013-DB2-TABLE-NAME (2)08803973
088040              SET DP013-DB2-ABEND      TO TRUE                    08804073
088041              PERFORM 9999-ABEND                                  08804173
088042     END-EVALUATE.                                                08804273
088043/                                                                 08804373
088044*----------------------------------------------------------------*08804473
088045*  INSERT A SHIPMENT STATUS ROW                                  *08804573
088046*----------------------------------------------------------------*08804673
088047 6120-INSERT-TSHIPST.                                             08804773
088048                                                                  08804873
088049     IF PS-CICS-SWITCH-YES                                        08804973
088050         MOVE SPACES TO PV-CICS-MSG-AREA                          08805073
088051         STRING   ' ' WS007-SRC-TASK-NUMBER                       08805173
088052                  ' WSKCS308:'                                    08805273
088053                  ' 6120-INSERT-TSHIPST       '                   08805373
088054                                   DELIMITED BY SIZE              08805473
088055                              INTO PV-CICS-MSG-AREA               08805573
088056         PERFORM 8000-WRITE-TO-CICS-LOG                           08805673
088057     END-IF.                                                      08805773
088058                                                                  08805873
088059*    IF PV-DB2-HOST-DATE = SPACES OR                              08805973
088060*       PV-DB2-HOST-TIME = SPACES                                 08806073
088061*        EXEC SQL                                                 08806173
088062*            SET :PV-DB2-HOST-DATE      = CURRENT DATE            08806273
088063*        END-EXEC                                                 08806373
088064*                                                                 08806473
088065*        EXEC SQL                                                 08806573
088066*            SET :PV-DB2-HOST-TIME      = CURRENT TIME            08806673
088067*        END-EXEC                                                 08806773
088068*    END-IF.                                                      08806873
088069                                                                  08806973
088070     EXEC SQL                                                     08807073
088071         SET :PV-DB2-HOST-DATE      = CURRENT DATE                08807173
088072     END-EXEC.                                                    08807273
088073                                                                  08807373
088074     EXEC SQL                                                     08807473
088075         SET :PV-DB2-HOST-TIME      = CURRENT TIME                08807573
088076     END-EXEC.                                                    08807673
088077                                                                  08807773
088078*    IF THE CURRENT TIME IS LESS THAN OR EQUAL TO THE TIME OF THE 08807873
088079*    PREVIOUSLY INSERTED ROW (MEANING TWO OR MORE RECORDS HAVE BEE08807973
088080*    ADDED IN ON SECOND) ADD A SECOND TO THE PREVIOUS TIME TO KEEP08808073
088081*    TIMES UNIQUE.                                                08808173
088082                                                                  08808273
088083     MOVE SHIPST-STATUS-TME TO PV-CMPR-STATUS-TME.                08808373
088084     MOVE SHIPST-STATUS-DTE TO PV-CMPR-STATUS-DTE.                08808473
088085                                                                  08808573
088086     IF PV-DB2-HOST-DATE   = PV-CMPR-STATUS-DTE                   08808673
088087        IF  PV-DB2-HOST-TIME          <= PV-CMPR-STATUS-TME       08808773
088088           ADD +1                     TO PV-CMPR-STATUS-TME-SS    08808873
088089           IF PV-CMPR-STATUS-TME-SS    > 59                       08808973
088090              ADD +1                  TO PV-CMPR-STATUS-TME-MM    08809073
088091              MOVE ZEROS              TO PV-CMPR-STATUS-TME-SS    08809173
088092              IF PV-CMPR-STATUS-TME-MM > 59                       08809273
088093                 ADD +1               TO PV-CMPR-STATUS-TME-HH    08809373
088094                 MOVE ZEROS           TO PV-CMPR-STATUS-TME-MM    08809473
088095                 IF PV-CMPR-STATUS-TME-HH                         08809573
088096                                       > 23                       08809673
088097                    MOVE ZEROS        TO PV-CMPR-STATUS-TME-HH    08809773
088098                 END-IF                                           08809873
088099              END-IF                                              08809973
088100           END-IF                                                 08810073
088101           MOVE PV-CMPR-STATUS-TME    TO PV-DB2-HOST-TIME         08810173
088102        ELSE                                                      08810273
088103           MOVE PV-DB2-HOST-TIME      TO PV-CMPR-STATUS-TME       08810373
088104        END-IF                                                    08810473
088105     END-IF.                                                      08810573
088106                                                                  08810673
088107     MOVE PV-DB2-HOST-DATE    TO SHIPST-STATUS-DTE.               08810773
088108     MOVE PV-DB2-HOST-TIME    TO SHIPST-STATUS-TME.               08810873
088109                                                                  08810973
088110     EXEC SQL                                                     08811073
088111         INSERT  INTO TSHIPST                                     08811173
088112                (SHIPT_ID                                         08811273
088113                ,SHIPT_STATUS_CDE                                 08811373
088114                ,STATUS_DTE                                       08811473
088115                ,STATUS_TME                                       08811573
088116                ,STATUS_UID                                       08811673
088117                ,DELAY_RSN_CDE                                    08811773
088118                ,CARR_STATUS_CDE                                  08811873
088119                ,TIME_ZONE_CDE                                    08811973
088120                ,CITY_NAME                                        08812073
088121                ,STATE_CDE )                                      08812173
088122        VALUES  (:SHIPST-SHIPT-ID                                 08812273
088123                ,:SHIPST-SHIPT-STATUS-CDE                         08812373
088124                ,:SHIPST-STATUS-DTE                               08812473
088125                ,:SHIPST-STATUS-TME                               08812573
088126                ,:WS014-CRE-USER-ID                               08812673
088127                ,:SHIPST-DELAY-RSN-CDE                            08812773
088128                ,:SHIPST-CARR-STATUS-CDE                          08812873
088129                ,:SHIPST-TIME-ZONE-CDE                            08812973
088130                ,:SHIPST-CITY-NAME                                08813073
088131                ,:SHIPST-STATE-CDE )                              08813173
088132     END-EXEC                                                     08813273
088133                                                                  08813373
088134     EVALUATE TRUE                                                08813473
088135         WHEN SQLCODE = +0                                        08813573
088136              IF PS-CICS-SWITCH-YES                               08813673
088137                  MOVE SHIPST-SHIPT-ID  TO PV-DISPLAY-1           08813773
088138                  INITIALIZE PV-CICS-MSG-AREA                     08813873
088139                  STRING   ' ' WS007-SRC-TASK-NUMBER              08813973
088140                           ' WSKCS308-6120:'                      08814073
088141                           ' INSERT STATUS '                      08814173
088142                           ' SHPMT=' PV-DISPLAY-1                 08814273
088143                           ' ' SHIPST-SHIPT-STATUS-CDE            08814373
088144                           ' ' SHIPST-STATUS-DTE                  08814473
088145                           ' ' SHIPST-STATUS-TME                  08814573
088146                           DELIMITED BY SIZE                      08814673
088147                                         INTO PV-CICS-MSG-AREA    08814773
088148                  PERFORM 8000-WRITE-TO-CICS-LOG                  08814873
088149              END-IF                                              08814973
088150*                                                                 08815073
088151*** DMH - 11/06/17 BEGIN                                          08815173
088152         WHEN SQLCODE = -803                                      08815273
088153              PERFORM 6130-UPDATE-SHIPST                          08815373
088154              IF PS-CICS-SWITCH-YES                               08815473
088155                  MOVE SHIPST-SHIPT-ID  TO PV-DISPLAY-1           08815573
088156                  INITIALIZE PV-CICS-MSG-AREA                     08815673
088157                  STRING   ' ' WS007-SRC-TASK-NUMBER              08815773
088158                           ' WSKCS308-6120:'                      08815873
088159                           ' UPDATE STATUS '                      08815973
088160                           ' SHPMT=' PV-DISPLAY-1                 08816073
088161                           ' ' SHIPST-SHIPT-STATUS-CDE            08816173
088162                           ' ' SHIPST-STATUS-DTE                  08816273
088163                           ' ' SHIPST-STATUS-TME                  08816373
088164                           DELIMITED BY SIZE                      08816473
088165                                         INTO PV-CICS-MSG-AREA    08816573
088166                  PERFORM 8000-WRITE-TO-CICS-LOG                  08816673
088167              END-IF                                              08816773
088168*** DMH - 11/06/17 END                                            08816873
088169*                                                                 08816973
088170         WHEN SQLCODE = -904                                      08817073
088171         WHEN SQLCODE = -913                                      08817173
088172             CONTINUE                                             08817273
088173                                                                  08817373
088174         WHEN SQLWARN0 NOT = SPACES                               08817473
088175         WHEN SQLCODE < +0                                        08817573
088176         WHEN SQLCODE > +0                                        08817673
088177              MOVE SHIPST-SHIPT-ID     TO PV-DISPLAY-1            08817773
088178              MOVE SQLCODE             TO WS007-SQLCODE           08817873
088179                                          PV-SQL-RETURN-CD        08817973
088180              INITIALIZE PV-CICS-MSG-AREA                         08818073
088181              STRING   ' ' WS007-SRC-TASK-NUMBER                  08818173
088182                       ' WSKCS308-6120 ERROR:'                    08818273
088183                       ' SQL='                                    08818373
088184                       PV-SQL-RETURN-CD                           08818473
088185                       ' SHPMT:'  PV-DISPLAY-1                    08818573
088186                       ' ' SHIPST-SHIPT-STATUS-CDE                08818673
088187                       ' ' SHIPST-STATUS-DTE                      08818773
088188                       ' ' SHIPST-STATUS-TME                      08818873
088189                       DELIMITED BY SIZE                          08818973
088190                                     INTO PV-CICS-MSG-AREA        08819073
088191              PERFORM 8000-WRITE-TO-CICS-LOG                      08819173
088192                                                                  08819273
088193              SET WS007-INVALID-SQL    TO TRUE                    08819373
088194              MOVE '6120-INSERT-TSHIPST  '                        08819473
088195                                       TO WS007-SQL-ERROR-PARA    08819573
088196                                          DP013-PARAGRAPH         08819673
088197              MOVE SQLCA               TO WS007-SQLCA             08819773
088198                                          DP013-SQLCA             08819873
088199              STRING 'SQL='                                       08819973
088200                   PV-SQL-RETURN-CD                               08820073
088201                   DELIMITED BY SIZE                              08820173
088202                                     INTO WS007-CRA-RET-MSG       08820273
088203              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08820373
088204              MOVE 'TSHIPST'                                      08820473
088205                                       TO DP013-DB2-TABLE-NAME (1)08820573
088206              SET DP013-DB2-ABEND      TO TRUE                    08820673
088207              PERFORM 9999-ABEND                                  08820773
088208     END-EVALUATE.                                                08820873
088209                                                                  08820973
088210                                                                  08821073
088211******************************************************************08821173
088212* UPDATE TSHIPST ROW                                             *08821273
088213* DMH - 11/06/17                                                 *08821373
088214******************************************************************08821473
088215 6130-UPDATE-SHIPST.                                              08821573
088216                                                                  08821673
088217     EXEC SQL                                                     08821773
088218         UPDATE TSHIPST                                           08821873
088219            SET                                                   08821973
088220                 STATUS_DTE       = :SHIPST-STATUS-DTE            08822073
088221                ,STATUS_TME       = :SHIPST-STATUS-TME            08822173
088222                ,STATUS_UID       = :WS014-CRE-USER-ID            08822273
088223                ,DELAY_RSN_CDE    = :SHIPST-DELAY-RSN-CDE         08822373
088224                ,CARR_STATUS_CDE  = :SHIPST-CARR-STATUS-CDE       08822473
088225                ,TIME_ZONE_CDE    = :SHIPST-TIME-ZONE-CDE         08822573
088226                ,CITY_NAME        = :SHIPST-CITY-NAME             08822673
088227                ,STATE_CDE        = :SHIPST-STATE-CDE             08822773
088228         WHERE                                                    08822873
088229                 SHIPT_ID         = :SHIPST-SHIPT-ID              08822973
088230           AND   SHIPT_STATUS_CDE = :SHIPST-SHIPT-STATUS-CDE      08823073
088231     END-EXEC                                                     08823173
088232                                                                  08823273
088233     EVALUATE TRUE                                                08823373
088234         WHEN SQLCODE = +0                                        08823473
088235              IF PS-CICS-SWITCH-YES                               08823573
088236                  MOVE SHIPST-SHIPT-ID  TO PV-DISPLAY-1           08823673
088237                  INITIALIZE PV-CICS-MSG-AREA                     08823773
088238                  STRING   ' ' WS007-SRC-TASK-NUMBER              08823873
088239                           ' WSKCS308-6130:'                      08823973
088240                           ' UPDATE STATUS '                      08824073
088241                           ' SHPMT=' PV-DISPLAY-1                 08824173
088242                           ' ' SHIPST-SHIPT-STATUS-CDE            08824273
088243                           ' ' SHIPST-STATUS-DTE                  08824373
088244                           ' ' SHIPST-STATUS-TME                  08824473
088245                           DELIMITED BY SIZE                      08824573
088246                                         INTO PV-CICS-MSG-AREA    08824673
088247                  PERFORM 8000-WRITE-TO-CICS-LOG                  08824773
088248              END-IF                                              08824873
088249                                                                  08824973
088250         WHEN SQLCODE = -904                                      08825073
088251         WHEN SQLCODE = -913                                      08825173
088252             CONTINUE                                             08825273
088253                                                                  08825373
088254         WHEN SQLWARN0 NOT = SPACES                               08825473
088255         WHEN SQLCODE < +0                                        08825573
088256         WHEN SQLCODE > +0                                        08825673
088257              MOVE SHIPST-SHIPT-ID     TO PV-DISPLAY-1            08825773
088258              MOVE SQLCODE             TO WS007-SQLCODE           08825873
088259                                          PV-SQL-RETURN-CD        08825973
088260              INITIALIZE PV-CICS-MSG-AREA                         08826073
088261              STRING   ' ' WS007-SRC-TASK-NUMBER                  08826173
088262                       ' WSKCS308-6130 ERROR:'                    08826273
088263                       ' SQL='                                    08826373
088264                       PV-SQL-RETURN-CD                           08826473
088265                       ' SHPMT:'  PV-DISPLAY-1                    08826573
088266                       ' ' SHIPST-SHIPT-STATUS-CDE                08826673
088267                       ' ' SHIPST-STATUS-DTE                      08826773
088268                       ' ' SHIPST-STATUS-TME                      08826873
088269                       DELIMITED BY SIZE                          08826973
088270                                     INTO PV-CICS-MSG-AREA        08827073
088271              PERFORM 8000-WRITE-TO-CICS-LOG                      08827173
088272                                                                  08827273
088273              SET WS007-INVALID-SQL    TO TRUE                    08827373
088274              MOVE '6130-UPDATE-TSHIPST  '                        08827473
088275                                       TO WS007-SQL-ERROR-PARA    08827573
088276                                          DP013-PARAGRAPH         08827673
088277              MOVE SQLCA               TO WS007-SQLCA             08827773
088278                                          DP013-SQLCA             08827873
088279              STRING 'SQL='                                       08827973
088280                   PV-SQL-RETURN-CD                               08828073
088281                   DELIMITED BY SIZE                              08828173
088282                                     INTO WS007-CRA-RET-MSG       08828273
088283              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08828373
088284              MOVE 'TSHIPST'                                      08828473
088285                                       TO DP013-DB2-TABLE-NAME (1)08828573
088286              SET DP013-DB2-ABEND      TO TRUE                    08828673
088287              PERFORM 9999-ABEND                                  08828773
088288     END-EVALUATE.                                                08828873
088289                                                                  08828973
088290                                                                  08829073
088291******************************************************************08829173
088292 6200-OPEN-RECEIVR-CSR.                                           08829273
088293                                                                  08829373
088294     IF PS-CICS-SWITCH-YES                                        08829473
088295         MOVE SPACES TO PV-CICS-MSG-AREA                          08829573
088296         STRING   ' ' WS007-SRC-TASK-NUMBER                       08829673
088297                  ' WSKCS308:'                                    08829773
088298                  ' 6200-OPEN-RECEIVR-CSR     '                   08829873
088299                                   DELIMITED BY SIZE              08829973
088300                              INTO PV-CICS-MSG-AREA               08830073
088301         PERFORM 8000-WRITE-TO-CICS-LOG                           08830173
088302     END-IF.                                                      08830273
088303                                                                  08830373
088304                                                                  08830473
088305         EXEC SQL                                                 08830573
088306              OPEN RECEIVR-CSR                                    08830673
088307         END-EXEC                                                 08830773
088308                                                                  08830873
088309         EVALUATE TRUE                                            08830973
088310            WHEN SQLCODE = +0                                     08831073
088311              IF PS-CICS-SWITCH-YES                               08831173
088312                  MOVE DK-TRIP-ID   TO  PV-DISPLAY-1              08831273
088313                  INITIALIZE PV-CICS-MSG-AREA                     08831373
088314                  STRING   ' ' WS007-SRC-TASK-NUMBER              08831473
088315                           ' WSKCS308-6200:'                      08831573
088316                           ' OPEN RECEIVR CSR'                    08831673
088317                           ' TRIP:' PV-DISPLAY-1                  08831773
088318                           DELIMITED BY SIZE                      08831873
088319                                         INTO PV-CICS-MSG-AREA    08831973
088320                  PERFORM 8000-WRITE-TO-CICS-LOG                  08832073
088321              END-IF                                              08832173
088322            WHEN SQLCODE = -904                                   08832273
088323            WHEN SQLCODE = -913                                   08832373
088324                  CONTINUE                                        08832473
088325            WHEN SQLWARN0 NOT = SPACE                             08832573
088326            WHEN SQLCODE  NOT = +0                                08832673
088327                 MOVE DK-TRIP-ID   TO  PV-DISPLAY-1               08832773
088328                 MOVE SQLCODE      TO  WS007-SQLCODE              08832873
088329                                       PV-SQL-RETURN-CD           08832973
088330                 INITIALIZE PV-CICS-MSG-AREA                      08833073
088331                 STRING   ' ' WS007-SRC-TASK-NUMBER               08833173
088332                          ' WSKCS308-6200 ERROR:'                 08833273
088333                          ' SQL='                                 08833373
088334                          PV-SQL-RETURN-CD                        08833473
088335                          ' TRIP:' PV-DISPLAY-1                   08833573
088336                          DELIMITED BY SIZE                       08833673
088337                                     INTO PV-CICS-MSG-AREA        08833773
088338                 PERFORM 8000-WRITE-TO-CICS-LOG                   08833873
088339                                                                  08833973
088340              SET WS007-INVALID-SQL    TO TRUE                    08834073
088341              MOVE '6200-OPEN-RECEIVR-CSR'                        08834173
088342                                       TO WS007-SQL-ERROR-PARA    08834273
088343                                          DP013-PARAGRAPH         08834373
088344              MOVE SQLCA               TO WS007-SQLCA             08834473
088345                                          DP013-SQLCA             08834573
088346              STRING 'SQL='                                       08834673
088347                   PV-SQL-RETURN-CD                               08834773
088348                   DELIMITED BY SIZE                              08834873
088349                                     INTO WS007-CRA-RET-MSG       08834973
088350              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08835073
088351              MOVE 'TSHIPMT'                                      08835173
088352                                       TO DP013-DB2-TABLE-NAME (1)08835273
088353              MOVE 'TSHPTPO'                                      08835373
088354                                       TO DP013-DB2-TABLE-NAME (2)08835473
088355              MOVE 'TRECEIV'                                      08835573
088356                                       TO DP013-DB2-TABLE-NAME (3)08835673
088357              SET DP013-DB2-ABEND      TO TRUE                    08835773
088358              PERFORM 9999-ABEND                                  08835873
088359         END-EVALUATE.                                            08835973
088360                                                                  08836073
088361/                                                                 08836173
088362*----------------------------------------------------------------*08836273
088363*    FETCH A RECEIVR ROW                                         *08836373
088364*----------------------------------------------------------------*08836473
088365 6210-FETCH-RECEIVR-CSR.                                          08836573
088366                                                                  08836673
088367     IF PS-CICS-SWITCH-YES                                        08836773
088368         MOVE SPACES TO PV-CICS-MSG-AREA                          08836873
088369         STRING   ' ' WS007-SRC-TASK-NUMBER                       08836973
088370                  ' WSKCS308:'                                    08837073
088371                  ' 6210-FETCH-RECEIVR-CSR    '                   08837173
088372                                   DELIMITED BY SIZE              08837273
088373                              INTO PV-CICS-MSG-AREA               08837373
088374         PERFORM 8000-WRITE-TO-CICS-LOG                           08837473
088375     END-IF.                                                      08837573
088376                                                                  08837673
088377     EXEC SQL                                                     08837773
088378          FETCH RECEIVR-CSR                                       08837873
088379          INTO :RECEIV-ORD-NBR                                    08837973
088380             , :RECEIV-REC-SEQ-NBR                                08838073
088381             , :RECEIV-STATUS-CDE                                 08838173
088382             , :RECEIV-CRE-TMST                                   08838273
088383     END-EXEC                                                     08838373
088384                                                                  08838473
088385     EVALUATE TRUE                                                08838573
088386         WHEN SQLCODE = +0                                        08838673
088387              IF PS-CICS-SWITCH-YES                               08838773
088388                  MOVE RECEIV-ORD-NBR     TO PV-DISPLAY-1         08838873
088389                  MOVE RECEIV-REC-SEQ-NBR TO PV-DISPLAY-2         08838973
088390                  INITIALIZE PV-CICS-MSG-AREA                     08839073
088391                  STRING   ' ' WS007-SRC-TASK-NUMBER              08839173
088392                           ' WSKCS308-6210:'                      08839273
088393                           ' PO='   PV-DISPLAY-1                  08839373
088394                           ' RCVR=' PV-DISPLAY-2                  08839473
088395                           DELIMITED BY SIZE                      08839573
088396                                         INTO PV-CICS-MSG-AREA    08839673
088397                  PERFORM 8000-WRITE-TO-CICS-LOG                  08839773
088398              END-IF                                              08839873
088399         WHEN SQLCODE = +100                                      08839973
088400              SET PS-NO-MORE-RECEIVRS TO TRUE                     08840073
088401                                                                  08840173
088402         WHEN SQLWARN0 NOT = SPACE                                08840273
088403         WHEN SQLCODE < +0                                        08840373
088404         WHEN SQLCODE > +0                                        08840473
088405              MOVE DK-TRIP-ID   TO  PV-DISPLAY-1                  08840573
088406              MOVE SQLCODE             TO WS007-SQLCODE           08840673
088407                                          PV-SQL-RETURN-CD        08840773
088408              INITIALIZE PV-CICS-MSG-AREA                         08840873
088409              STRING   ' ' WS007-SRC-TASK-NUMBER                  08840973
088410                       ' WSKCS308-6210 ERROR:'                    08841073
088411                       ' SQL='                                    08841173
088412                       PV-SQL-RETURN-CD                           08841273
088413                       ' TRIP:'  PV-DISPLAY-1                     08841373
088414                       DELIMITED BY SIZE                          08841473
088415                                     INTO PV-CICS-MSG-AREA        08841573
088416              PERFORM 8000-WRITE-TO-CICS-LOG                      08841673
088417                                                                  08841773
088418              SET WS007-INVALID-SQL    TO TRUE                    08841873
088419              MOVE '6210-FETCH-RECEIVR-CSR'                       08841973
088420                                       TO WS007-SQL-ERROR-PARA    08842073
088421                                          DP013-PARAGRAPH         08842173
088422              MOVE SQLCA               TO WS007-SQLCA             08842273
088423                                          DP013-SQLCA             08842373
088424              STRING 'SQL='                                       08842473
088425                   PV-SQL-RETURN-CD                               08842573
088426                   DELIMITED BY SIZE                              08842673
088427                                     INTO WS007-CRA-RET-MSG       08842773
088428              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08842873
088429              MOVE 'TSHIPMT'                                      08842973
088430                                       TO DP013-DB2-TABLE-NAME (1)08843073
088431              MOVE 'TSHPTPO'                                      08843173
088432                                       TO DP013-DB2-TABLE-NAME (2)08843273
088433              MOVE 'TRECEIV'                                      08843373
088434                                       TO DP013-DB2-TABLE-NAME (3)08843473
088435              SET DP013-DB2-ABEND      TO TRUE                    08843573
088436              PERFORM 9999-ABEND                                  08843673
088437     END-EVALUATE.                                                08843773
088438/                                                                 08843873
088439*----------------------------------------------------------------*08843973
088440* CLOSE THE RECEIVR CURSOR                                       *08844073
088441*----------------------------------------------------------------*08844173
088442                                                                  08844273
088443 6220-CLOSE-RECEIVR-CSR.                                          08844373
088444                                                                  08844473
088445     IF PS-CICS-SWITCH-YES                                        08844573
088446         MOVE SPACES TO PV-CICS-MSG-AREA                          08844673
088447         STRING   ' ' WS007-SRC-TASK-NUMBER                       08844773
088448                  ' WSKCS308:'                                    08844873
088449                  ' 6220-CLOSE-RECEIVR-CSR    '                   08844973
088450                                   DELIMITED BY SIZE              08845073
088451                              INTO PV-CICS-MSG-AREA               08845173
088452         PERFORM 8000-WRITE-TO-CICS-LOG                           08845273
088453     END-IF.                                                      08845373
088454                                                                  08845473
088455     EXEC SQL                                                     08845573
088456          CLOSE RECEIVR-CSR                                       08845673
088457     END-EXEC                                                     08845773
088458                                                                  08845873
088459     EVALUATE TRUE                                                08845973
088460         WHEN SQLCODE = +0                                        08846073
088461              IF PS-CICS-SWITCH-YES                               08846173
088462                  MOVE DK-TRIP-ID   TO  PV-DISPLAY-1              08846273
088463                  INITIALIZE PV-CICS-MSG-AREA                     08846373
088464                  STRING   ' ' WS007-SRC-TASK-NUMBER              08846473
088465                           ' WSKCS308-6220:'                      08846573
088466                           ' CLOSE RECEIVR CSR'                   08846673
088467                           ' TRIP:'  PV-DISPLAY-1                 08846773
088468                           DELIMITED BY SIZE                      08846873
088469                                         INTO PV-CICS-MSG-AREA    08846973
088470                  PERFORM 8000-WRITE-TO-CICS-LOG                  08847073
088471              END-IF                                              08847173
088472         WHEN SQLWARN0 NOT = SPACE                                08847273
088473         WHEN SQLCODE  NOT = +0                                   08847373
088474              MOVE DK-TRIP-ID          TO PV-DISPLAY-1            08847473
088475              MOVE SQLCODE             TO WS007-SQLCODE           08847573
088476                                          PV-SQL-RETURN-CD        08847673
088477              INITIALIZE PV-CICS-MSG-AREA                         08847773
088478              STRING   ' ' WS007-SRC-TASK-NUMBER                  08847873
088479                       ' WSKCS308-6220 ERROR:'                    08847973
088480                       ' SQL='                                    08848073
088481                       PV-SQL-RETURN-CD                           08848173
088482                       ' TRIP:' PV-DISPLAY-1                      08848273
088483                       DELIMITED BY SIZE                          08848373
088484                                     INTO PV-CICS-MSG-AREA        08848473
088485              PERFORM 8000-WRITE-TO-CICS-LOG                      08848573
088486                                                                  08848673
088487              SET WS007-INVALID-SQL    TO TRUE                    08848773
088488              MOVE '6220-CLOSE-RECEIVR-CSR'                       08848873
088489                                       TO WS007-SQL-ERROR-PARA    08848973
088490                                          DP013-PARAGRAPH         08849073
088491              MOVE SQLCA               TO WS007-SQLCA             08849173
088492                                          DP013-SQLCA             08849273
088493              STRING 'SQL='                                       08849373
088494                   PV-SQL-RETURN-CD                               08849473
088495                   DELIMITED BY SIZE                              08849573
088496                                     INTO WS007-CRA-RET-MSG       08849673
088497              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08849773
088498              MOVE 'TSHIPMT'                                      08849873
088499                                       TO DP013-DB2-TABLE-NAME (1)08849973
088500              MOVE 'TSHPTPO'                                      08850073
088501                                       TO DP013-DB2-TABLE-NAME (2)08850173
088502              MOVE 'TRECEIV'                                      08850273
088503                                       TO DP013-DB2-TABLE-NAME (3)08850373
088504              SET DP013-DB2-ABEND      TO TRUE                    08850473
088505              PERFORM 9999-ABEND                                  08850573
088506     END-EVALUATE.                                                08850673
088507/                                                                 08850773
088508 6300-UPDATE-RECEIV.                                              08850873
088509                                                                  08850973
088510     IF PS-CICS-SWITCH-YES                                        08851073
088511         MOVE SPACES TO PV-CICS-MSG-AREA                          08851173
088512         STRING   ' ' WS007-SRC-TASK-NUMBER                       08851273
088513                  ' WSKCS308:'                                    08851373
088514                  ' 6300-UPDATE-RECEIV        '                   08851473
088515                                   DELIMITED BY SIZE              08851573
088516                              INTO PV-CICS-MSG-AREA               08851673
088517         PERFORM 8000-WRITE-TO-CICS-LOG                           08851773
088518     END-IF.                                                      08851873
088519                                                                  08851973
088520                                                                  08852073
088521     MOVE DK-OPER-UNT-ID       TO RECEIV-OPER-UNT-ID              08852173
088522*    MOVE ASC-CURR-FCLTY-ID    TO RECEIV-FCLTY-ID                 08852273
088523                                                                  08852373
088524     EXEC SQL                                                     08852473
088525       UPDATE TRECEIV                                             08852573
088526          SET REC_TMST      = :PV-REC-TMST                        08852673
088527       WHERE  ORD_NBR       = :RECEIV-ORD-NBR                     08852773
088528         AND  REC_SEQ_NBR   = :RECEIV-REC-SEQ-NBR                 08852873
088529         AND  CRE_TMST      = :RECEIV-CRE-TMST                    08852973
088530     END-EXEC                                                     08853073
088531                                                                  08853173
088532     EVALUATE TRUE                                                08853273
088533         WHEN SQLCODE = +0                                        08853373
088534              IF PS-CICS-SWITCH-YES                               08853473
088535                  MOVE RECEIV-ORD-NBR     TO PV-DISPLAY-1         08853573
088536                  MOVE RECEIV-REC-SEQ-NBR TO PV-DISPLAY-2         08853673
088537                  INITIALIZE PV-CICS-MSG-AREA                     08853773
088538                  STRING   ' ' WS007-SRC-TASK-NUMBER              08853873
088539                           ' WSKCS308-6300:'                      08853973
088540                           ' PO='   PV-DISPLAY-1                  08854073
088541                           ' RCVR=' PV-DISPLAY-2                  08854173
088542                           ' TMST=' RECEIV-CRE-TMST               08854273
088543                           DELIMITED BY SIZE                      08854373
088544                                         INTO PV-CICS-MSG-AREA    08854473
088545                  PERFORM 8000-WRITE-TO-CICS-LOG                  08854573
088546              END-IF                                              08854673
088547         WHEN SQLCODE = -904                                      08854773
088548         WHEN SQLCODE = -913                                      08854873
088549             CONTINUE                                             08854973
088550                                                                  08855073
088551         WHEN SQLWARN0 NOT = SPACE                                08855173
088552         WHEN SQLCODE < +0                                        08855273
088553         WHEN SQLCODE > +0                                        08855373
088554              MOVE RECEIV-ORD-NBR     TO PV-DISPLAY-1             08855473
088555              MOVE RECEIV-REC-SEQ-NBR TO PV-DISPLAY-2             08855573
088556              MOVE SQLCODE             TO WS007-SQLCODE           08855673
088557                                          PV-SQL-RETURN-CD        08855773
088558              INITIALIZE PV-CICS-MSG-AREA                         08855873
088559              STRING   ' ' WS007-SRC-TASK-NUMBER                  08855973
088560                       ' WSKCS308-6300 ERROR:'                    08856073
088561                       ' SQL='                                    08856173
088562                       PV-SQL-RETURN-CD                           08856273
088563                       ' RCVR:' PV-DISPLAY-1                      08856373
088564                       '-'      PV-DISPLAY-2                      08856473
088565                       DELIMITED BY SIZE                          08856573
088566                                     INTO PV-CICS-MSG-AREA        08856673
088567              PERFORM 8000-WRITE-TO-CICS-LOG                      08856773
088568                                                                  08856873
088569              SET WS007-INVALID-SQL    TO TRUE                    08856973
088570              MOVE '6300-UPDATE-RECEIV    '                       08857073
088571                                       TO WS007-SQL-ERROR-PARA    08857173
088572                                          DP013-PARAGRAPH         08857273
088573              MOVE SQLCA               TO WS007-SQLCA             08857373
088574                                          DP013-SQLCA             08857473
088575              STRING 'SQL='                                       08857573
088576                   PV-SQL-RETURN-CD                               08857673
088577                   DELIMITED BY SIZE                              08857773
088578                                     INTO WS007-CRA-RET-MSG       08857873
088579              MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)  08857973
088580              MOVE 'TRECEIV'                                      08858073
088581                                       TO DP013-DB2-TABLE-NAME (1)08858173
088582              SET DP013-DB2-ABEND      TO TRUE                    08858273
088583              PERFORM 9999-ABEND                                  08858373
088584     END-EVALUATE.                                                08858473
088585                                                                  08858578
088586                                                                  08858678
088587*-----------------------------------------------------------------08858778
088588* CHECK PARM TABLE TO SEE IF CURRENT DC LOCATION TO SEE IF THE   *08858878
088589* DC IS USING RPA MIS-DIRECT PROCESS                             *08858978
088590*-----------------------------------------------------------------08859078
088591 7000-CHECK-RPAMSD.                                               08859178
088592                                                                  08859278
088593     SET PS-NO-RPA-MISDRCT-CK TO TRUE.                            08859378
088594     MOVE WS014-DC-LOCATION TO DK-OPER-UNT-ID.                    08859478
088596                                                                  08859678
088604     EXEC SQL                                                     08860478
088605          SELECT FUNC_TXT                                         08860578
088606            INTO :KRPRPM-FUNC-TXT                                 08860678
088607            FROM TKRPRPM                                          08860778
088608           WHERE LOC_ID            = :DK-OPER-UNT-ID              08860878
088609             AND INTFC_SYS_CDE     = 'KHL'                        08860978
088610             AND SYS_PRC_FUNC_CDE  = 'RPAMSD'                     08861078
088611             AND FUNC_PRC_STAT_CDE = 'AC'                         08861178
088612             AND FUNC_BEG_TMST    <= CURRENT TIMESTAMP            08861278
088613             AND FUNC_END_TMST    >= CURRENT TIMESTAMP            08861378
088614             AND FUNC_TXT          = 'Y'                          08861478
088615                 WITH UR                                          08861578
088616     END-EXEC.                                                    08861678
088617                                                                  08861778
088618     EVALUATE TRUE                                                08861878
088619         WHEN SQLCODE = +0                                        08861978
088620              SET  PS-RPA-MISDRCT-CK     TO  TRUE                 08862078
088621         WHEN SQLCODE = +100                                      08862178
088622              SET  PS-NO-RPA-MISDRCT-CK  TO TRUE                  08862278
088623                                                                  08862378
088624     WHEN SQLWARN0 NOT = SPACE                                    08862478
088625     WHEN SQLCODE < +0                                            08862578
088626     WHEN SQLCODE > +0                                            08862678
088627          MOVE RECEIV-ORD-NBR     TO PV-DISPLAY-1                 08862778
088628          MOVE RECEIV-REC-SEQ-NBR TO PV-DISPLAY-2                 08862878
088629          MOVE SQLCODE             TO WS007-SQLCODE               08862978
088630                                      PV-SQL-RETURN-CD            08863078
088631          INITIALIZE PV-CICS-MSG-AREA                             08863178
088632          STRING   ' ' WS007-SRC-TASK-NUMBER                      08863278
088633                   ' WSKCS308-6300 ERROR:'                        08863378
088634                   ' SQL='                                        08863478
088635                   PV-SQL-RETURN-CD                               08863578
088636                   ' RCVR:' PV-DISPLAY-1                          08863678
088637                   '-'      PV-DISPLAY-2                          08863778
088638                   DELIMITED BY SIZE                              08863878
088639                                 INTO PV-CICS-MSG-AREA            08863978
088640          PERFORM 8000-WRITE-TO-CICS-LOG                          08864078
088641                                                                  08864178
088642          SET WS007-INVALID-SQL    TO TRUE                        08864278
088643          MOVE '7000-CHECK-RPAMSD     '                           08864378
088644                                   TO WS007-SQL-ERROR-PARA        08864478
088645                                      DP013-PARAGRAPH             08864578
088646          MOVE SQLCA               TO WS007-SQLCA                 08864678
088647                                      DP013-SQLCA                 08864778
088648          STRING 'SQL='                                           08864878
088649               PV-SQL-RETURN-CD                                   08864978
088650               DELIMITED BY SIZE                                  08865078
088651                                 INTO WS007-CRA-RET-MSG           08865178
088652          MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)      08865278
088653          MOVE 'TKRPRPM'                                          08865378
088654                                   TO DP013-DB2-TABLE-NAME (1)    08865478
088655          SET DP013-DB2-ABEND      TO TRUE                        08865578
088656          PERFORM 9999-ABEND                                      08865678
088657     END-EVALUATE.                                                08865778
088673                                                                  08867378
088674*----------------------------------------------------------------*08867478
088675*  RPA MISDIRECT - START E838 (RCKCS838) TO CAPTURE MISDIRECT     08867578
088676*  RECEIVER INFORMATION                                           08867678
088677*----------------------------------------------------------------*08867778
088678 7010-RPA-MISDIRECT.                                              08867878
088679                                                                  08867978
088680     INITIALIZE RC077-UNLOADED-TRLR-COMMAREA.                     08868078
088681                                                                  08868178
088682     MOVE WS014-DC-LOCATION     TO RC077-OPER-UNT-ID              08868280
088683     MOVE WS014-SCAC            TO RC077-SCAC                     08868380
088684     MOVE WS014-VEHICLE         TO RC077-VEH-NBR                  08868480
088685     MOVE WST00001-INTR-TRIP-ID TO RC077-TRIP-ID                  08868580
088686     MOVE 'WSKCS308'            TO RC077-FROM-PROGRAM             08868678
088687                                                                  08868778
088688                                                                  08868878
088689     EXEC CICS                                                    08868978
088690         START TRANSID(PC-E838-RPAMSD)                            08869078
088691               FROM   (RC077-UNLOADED-TRLR-COMMAREA)              08869178
088692     END-EXEC.                                                    08869278
088693                                                                  08869378
088694                                                                  08869478
088695/                                                                 08869573
088696******************************************************************08869673
088697 8000-WRITE-TO-CICS-LOG.                                          08869773
088698                                                                  08869873
088699     MOVE LENGTH PV-CICS-MSG-AREA    TO PV-COMMAREA-LENGTH.       08869973
088700                                                                  08870073
088701     EXEC CICS                                                    08870173
088702          WRITEQ TD                                               08870273
088703          QUEUE  ('CSSL')                                         08870373
088704          FROM  (PV-CICS-MSG-AREA)                                08870473
088705          LENGTH  (PV-COMMAREA-LENGTH)                            08870573
088706          RESP  (PV-CICS-RESP)                                    08870673
088707     END-EXEC.                                                    08870773
088708                                                                  08870873
088709     MOVE SPACES                     TO PV-CICS-MSG-AREA.         08870973
088710                                                                  08871073
088711/                                                                 08871173
088712**************************************************************    08871273
088713*   STANDARD ABEND ROUTINE                                        08871373
088714* ==> PROCESSES:                                                  08871473
088715*   - ISSUES THE ABEND.                                           08871531
088716**************************************************************    08871631
088720 9999-ABEND.                                                      08872031
088800     MOVE WS007-RECEIPT-PIX-RECORD      TO DFHCOMMAREA.           08880031
088900     MOVE 'WSKCS308'                  TO DP013-PROGRAM.           08890031
089000     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          08900031
089100     INITIALIZE DP013-SRC-TASK-NUMBER                             08910031
089200                DP013-STACK.                                      08920031
089300     SET DP013-LINK-RETURN TO TRUE.                               08930031
089400     SET DP013-ROLLBACK    TO TRUE.                               08940031
089410                                                                  08941031
089500     EXEC CICS                                                    08950031
089600         LINK                                                     08960031
089700             PROGRAM  (DP013-NAME)                                08970031
089800             COMMAREA (DP013-PARAMETERS)                          08980031
089900             LENGTH   (DP013-LENGTH)                              08990031
090000     END-EXEC.                                                    09000031
090100                                                                  09010031
090200                                                                  09020031
090300     EXEC CICS                                                    09030031
090400         RETURN                                                   09040031
090500     END-EXEC.                                                    09050031
