       IDENTIFICATION DIVISION.                                         00010001
       PROGRAM-ID.      MAKUT202.                                       00020014
       AUTHOR.          L. GRIESBACH.                                   00030015
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040001
       DATE-WRITTEN.    01-29-2003.                                     00050015
      ***************************************************************** 00060001
      *  THE PURPOSE OF THIS PROGRAM IS TO GET MESSAGES FROM THE      * 00070029
      *  VSM ITEM HUB.  THE FILE WILL THEN BE SORTED BY BUSINESS      * 00080039
      *  EVENT ID.                                                    * 00090029
      *                                                               * 00100029
      *  THE BUSINESS EVENTS WE RETRIEVE ARE AS FOLLOWS:              * 00110029
      *  010 = STYLE RECLASS                                          * 00120024
      *                                                               * 00130001
      *  TO SELECT OTHER BUSINESS EVENT RECORDS, THE SQL THAT         * 00140029
      *  DIRECTS RECORDS TO THE MERCHANDISE ALLOCATION QUEUE MUST     * 00150029
      *  BE CHANGED.                                                  * 00160029
      *                                                               * 00170029
      *  THIS PROGRAM RETRIEVES RECORDS FROM MQ SERIES QUEUE          * 00180058
      *  MA.VSM.ITEM.TO.MERCH.ALLOC.Q.  THE WAY THIS QUEUE IS SET UP  * 00190058
      *  IS THAT ONCE A MQGET IS DONE, A RECORD WILL BE MARKED AS     * 00200058
      *  "READ".  ONCE A MQCMIT IS DONE, A RECORD WILL ACTUALLY BE    * 00210058
      *  DELETED FROM THE QUEUE.  WHEN A MQBACK IS DONE, ALL RECORDS  * 00220058
      *  MARKED AS "READ" WILL BE CHANGED BACK TO "UNREAD" SO THAT    * 00230058
      *  THE PROGRAM CAN BE RESTARTED.                                * 00240058
      *                                                               * 00250058
      *  IN THIS PROGRAM, THE MQ WAIT INTERVAL DEFAULT TIME OF 0 WILL * 00260058
      *  BE USED.  IF THE TIME WAS SET TO 1 MINUTE (60000), MQ SERIES * 00270058
      *  WOULD KEEP WAITING FOR NEW MESSAGES FOR ANOTHER MINUTE.  IN  * 00280058
      *  THE EVENT THAT MESSAGES KEPT TRICKLING IN, THE JOB STEP      * 00290058
      *  THAT CONTAINS THIS PROGRAM COULD BE KEPT ACTIVE FOR AN       * 00300058
      *  EXTENDED PERIOD OF TIME.  SO, IT'S BEST TO KEEP THE WAIT     * 00310058
      *  INTERVAL AT 0 SO THAT THE EXECUTION OF THIS PROGRAM ENDS     * 00320058
      *  WITHIN A REASONABLE PERIOD OF TIME.                          * 00330058
      *                                                               * 00340058
      ***************************************************************** 00350001
      *    WR/PITS#     DATE        DESCRIPTION                       * 00360001
      *    --------   --------   -----------------------------------  * 00370001
      *    WR#33158  07/23/2007  CHANGED TO DO MQ COMMIT AFTER EVERY    00380081
      *                          1000 MESSAGES INSTEAD OF JUST AT END   00390076
      ***************************************************************** 00400001
                                                                        00410026
       ENVIRONMENT DIVISION.                                            00420001
       CONFIGURATION SECTION.                                           00430001
                                                                        00440001
       SOURCE-COMPUTER.       IBM-3090.                                 00450001
       OBJECT-COMPUTER.       IBM-3090.                                 00460001
                                                                        00470001
       INPUT-OUTPUT SECTION.                                            00480001
                                                                        00490001
       FILE-CONTROL.                                                    00500001
           SELECT CONTROL-CARD-1   ASSIGN TO INP01.                     00510001
           SELECT CONTROL-CARD-2   ASSIGN TO INP02.                     00520001
           SELECT ITEM-FILE        ASSIGN TO OUT01.                     00530029
                                                                        00540001
       DATA DIVISION.                                                   00550001
       FILE SECTION.                                                    00560001
                                                                        00570001
       FD  CONTROL-CARD-1                                               00580001
           RECORDING MODE F                                             00590001
           BLOCK CONTAINS 0 RECORDS                                     00600001
           LABEL RECORDS ARE OMITTED.                                   00610001
       01  CONTROL-CARD-1-RECORD        PIC X(80).                      00620043
                                                                        00630001
       FD  CONTROL-CARD-2                                               00640001
           RECORDING MODE F                                             00650001
           BLOCK CONTAINS 0 RECORDS                                     00660001
           LABEL RECORDS ARE OMITTED.                                   00670001
       01  CONTROL-CARD-2-RECORD        PIC X(80).                      00680043
                                                                        00690001
       FD  ITEM-FILE                                                    00700029
           RECORDING MODE F                                             00710001
           LABEL RECORDS OMITTED                                        00720001
           BLOCK CONTAINS  0 RECORDS.                                   00730001
       01  ITEM-RECORD                  PIC X(450).                     00740029
                                                                        00750001
       WORKING-STORAGE SECTION.                                         00760001
       01  WS-CONSTANTS.                                                00770029
           05  WS-MQCONN                PIC X(8)  VALUE 'CSQBCONN'.     00780029
           05  WS-MQOPEN                PIC X(8)  VALUE 'CSQBOPEN'.     00790029
           05  WS-MQGET                 PIC X(8)  VALUE 'CSQBGET'.      00800029
           05  WS-MQBACK                PIC X(8)  VALUE 'CSQBBACK'.     00810029
           05  WS-MQCMIT                PIC X(8)  VALUE 'CSQBCOMM'.     00820029
           05  WS-MQCLOSE               PIC X(8)  VALUE 'CSQBCLOS'.     00830029
           05  WS-MQDISC                PIC X(8)  VALUE 'CSQBDISC'.     00840029
                                                                        00850029
      ********************************************************          00860043
      *    API CONTROL BLOCKS                                *          00870043
      ********************************************************          00880043
       01  MQM-OBJECT-DESCRIPTOR.                                       00890001
           COPY CMQODV.                                                 00900001
       01  MQM-MESSAGE-DESCRIPTOR.                                      00910001
           COPY CMQMDV.                                                 00920001
       01  MQM-GET-MESSAGE-OPTIONS.                                     00930001
           COPY CMQGMOV.                                                00940001
                                                                        00950001
       01  MQM-CONSTANTS.                                               00960001
           COPY CMQV.                                                   00970001
                                                                        00980001
       01  WS-SWITCHES.                                                 00990043
           05  WS-CONTROL-CARD-1-SW     PIC X(01) VALUE 'N'.            01000043
               88  CONTROL-CARD-1-EOF             VALUE 'Y'.            01010043
               88  CONTROL-CARD-1-NOT-EOF         VALUE 'N'.            01020043
           05  WS-CONTROL-CARD-2-SW     PIC X(01) VALUE 'N'.            01030043
               88  CONTROL-CARD-2-EOF             VALUE 'Y'.            01040043
               88  CONTROL-CARD-2-NOT-EOF         VALUE 'N'.            01050043
           05  WS-MQGET-MSG-SW          PIC X(01) VALUE 'Y'.            01060043
               88  MQGET-MORE-MSG                 VALUE 'Y'.            01070043
               88  MQGET-NO-MORE-MSG              VALUE 'N'.            01080043
                                                                        01090043
       01  WS-VARIABLES.                                                01100043
           05  WS-RCDS-WRITTEN          PIC S9(9) VALUE 0.              01110043
           05  WS-DISPLAY-FORMAT        PIC ZZZ,ZZZ,ZZ9.                01120076
           05  WS-NBR-COMMITS           PIC S9(9) COMP-3 VALUE ZERO.    01130078
           05  WS-MSG-COUNT             PIC S9(5) COMP-3 VALUE ZERO.    01140078
           05  WS-COMMIT-LEVEL          PIC S9(5) COMP-3 VALUE +1000.   01150078
                                                                        01160078
           05  WS-QM-NAME               PIC X(48) VALUE SPACES.         01170043
           05  WS-PARAGRAPH             PIC X(30) VALUE SPACES.         01180066
           05  WS-MSGBUFFER             PIC X(450)                      01190043
                                                  VALUE SPACES.         01200043
           05  WS-MSGLENGTH             PIC S9(9) BINARY VALUE +450.    01210043
           05  WS-DATA-LENGTH           PIC S9(9) BINARY.               01220043
           05  WS-HCONN                 PIC S9(9) BINARY VALUE 0.       01230043
           05  WS-OBJECT-HANDLE         PIC S9(9) BINARY VALUE 0.       01240043
           05  WS-OPEN-OPTIONS          PIC S9(9) BINARY.               01250043
           05  WS-COMPLETION-CODE       PIC S9(9) BINARY VALUE 0.       01260065
           05  WS-COMP-CODE1            PIC S9(9) COMP-3.               01270070
           05  WS-COMP-CODE2            PIC S9(9).                      01280070
           05  WS-COMP-CODE3            PIC ZZZZZZZZ9.                  01290072
           05  WS-REASON-CODE           PIC S9(9) BINARY VALUE 0.       01300065
           05  WS-REASON-CODE1          PIC S9(9) COMP-3.               01310069
           05  WS-REASON-CODE2          PIC S9(9).                      01320069
           05  WS-REASON-CODE3          PIC ZZZZZZZZ9.                  01330072
           05  WS-ABEND-CODE            PIC S9(4) VALUE ZEROS           01340051
                                                  COMP SYNC.            01350051
               88  CONTROL-CARD-MISSING           VALUE +4001.          01360051
               88  MQ-ERROR                       VALUE +4020.          01370051
                                                                        01380051
       01  WS-CONTROL-CARD-1.                                           01390051
           05  WS-QMGR-NAME             PIC X(48).                      01400051
           05  FILLER                   PIC X(32).                      01410051
                                                                        01420051
       01  WS-CONTROL-CARD-2.                                           01430051
           05  WS-QUEUE-NAME            PIC X(48).                      01440051
           05  FILLER                   PIC X(32).                      01450051
                                                                        01460051
      ********************************************************          01470049
      *  LEGACY ITEM MAINTENANCE INFO COPYBOOK               *          01480043
      ********************************************************          01490043
           COPY IMRD008.                                                01500042
                                                                        01510042
                                                                        01520001
       PROCEDURE DIVISION.                                              01530001
       M0000-MAINLINE.                                                  01540028
                                                                        01550001
           PERFORM A1000-INITIALIZE                                     01560028
              THRU A1000-EXIT.                                          01570028
                                                                        01580001
           PERFORM B1000-PROCESS-MESSAGES                               01590029
              THRU B1000-EXIT                                           01600029
             UNTIL MQGET-NO-MORE-MSG.                                   01610029
                                                                        01620001
           PERFORM C1000-EOJ-PROCESSING                                 01630028
              THRU C1000-EXIT.                                          01640028
                                                                        01650021
           STOP RUN.                                                    01660021
                                                                        01670021
                                                                        01680021
       A1000-INITIALIZE.                                                01690028
                                                                        01700001
           OPEN INPUT  CONTROL-CARD-1                                   01710037
                       CONTROL-CARD-2                                   01720041
                OUTPUT ITEM-FILE.                                       01730041
                                                                        01740001
           PERFORM A1100-READ-CONTROL-CARD-1                            01750029
              THRU A1100-EXIT.                                          01760028
                                                                        01770001
           PERFORM A1200-READ-CONTROL-CARD-2                            01780029
              THRU A1200-EXIT.                                          01790028
                                                                        01800001
           CLOSE CONTROL-CARD-1                                         01810017
                 CONTROL-CARD-2.                                        01820017
                                                                        01830001
           PERFORM A1300-MQCONN                                         01840029
              THRU A1300-EXIT.                                          01850028
                                                                        01860001
           PERFORM A1400-MQOPEN                                         01870029
              THRU A1400-EXIT.                                          01880029
                                                                        01890029
       A1000-EXIT.                                                      01900028
           EXIT.                                                        01910017
                                                                        01920021
                                                                        01930021
       A1100-READ-CONTROL-CARD-1.                                       01940029
                                                                        01950021
      *  OBTAIN THE QUEUE MGR NAME                                      01960030
                                                                        01970030
           READ CONTROL-CARD-1                                          01980043
               INTO WS-CONTROL-CARD-1                                   01990043
                   AT END                                               02000043
                       SET CONTROL-CARD-1-EOF TO TRUE.                  02010043
                                                                        02020037
           IF CONTROL-CARD-1-EOF                                        02030043
               DISPLAY '***********************************'            02040070
               DISPLAY '***  ABEND MAKUT202                '            02050070
               DISPLAY '***  A1100-READ-CONTROL-CARD-1     '            02060070
               DISPLAY '***********************************'            02070070
               SET CONTROL-CARD-MISSING       TO TRUE                   02080069
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      02090062
           END-IF.                                                      02100043
                                                                        02110029
       A1100-EXIT.                                                      02120028
           EXIT.                                                        02130021
                                                                        02140021
                                                                        02150021
       A1200-READ-CONTROL-CARD-2.                                       02160029
                                                                        02170021
      *  OBTAIN THE INPUT QUEUE NAME                                    02180030
                                                                        02190030
           READ CONTROL-CARD-2                                          02200043
               INTO WS-CONTROL-CARD-2                                   02210043
                   AT END                                               02220043
                       SET CONTROL-CARD-2-EOF TO TRUE.                  02230043
                                                                        02240037
           IF CONTROL-CARD-2-EOF                                        02250043
               DISPLAY '***********************************'            02260070
               DISPLAY '***  ABEND MAKUT202                '            02270070
               DISPLAY '***  A1200-READ-CONTROL-CARD-2     '            02280070
               DISPLAY '***********************************'            02290070
               SET CONTROL-CARD-MISSING       TO TRUE                   02300069
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      02310062
           END-IF.                                                      02320043
                                                                        02330021
       A1200-EXIT.                                                      02340028
           EXIT.                                                        02350021
                                                                        02360017
                                                                        02370001
       A1300-MQCONN.                                                    02380029
                                                                        02390029
           MOVE WS-QMGR-NAME TO WS-QM-NAME.                             02400032
           CALL WS-MQCONN USING WS-QM-NAME                              02410029
                                WS-HCONN                                02420029
                                WS-COMPLETION-CODE                      02430029
                                WS-REASON-CODE.                         02440033
                                                                        02450029
           IF WS-COMPLETION-CODE = MQCC-OK                              02460029
               NEXT SENTENCE                                            02470029
           ELSE                                                         02480029
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                02490070
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                02500071
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                02510072
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              02520070
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              02530070
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              02540072
               DISPLAY '***********************************'            02550070
               DISPLAY '***  ABEND MAKUT202 - A1300-MQCONN '            02560070
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        02570072
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      02580072
               DISPLAY '***********************************'            02590070
               SET MQ-ERROR             TO TRUE                         02600070
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      02610062
           END-IF.                                                      02620029
                                                                        02630029
       A1300-EXIT.                                                      02640029
           EXIT.                                                        02650029
                                                                        02660029
                                                                        02670029
       A1400-MQOPEN.                                                    02680029
                                                                        02690029
           MOVE WS-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        02700032
           MOVE WS-QUEUE-NAME            TO MQOD-OBJECTNAME.            02710032
           COMPUTE WS-OPEN-OPTIONS = MQOO-INPUT-SHARED +                02720029
                                     MQOO-FAIL-IF-QUIESCING.            02730029
                                                                        02740029
           CALL WS-MQOPEN USING WS-HCONN                                02750029
                                MQM-OBJECT-DESCRIPTOR                   02760029
                                WS-OPEN-OPTIONS                         02770029
                                WS-OBJECT-HANDLE                        02780033
                                WS-COMPLETION-CODE                      02790029
                                WS-REASON-CODE.                         02800033
                                                                        02810029
           IF WS-COMPLETION-CODE = MQCC-OK                              02820029
               NEXT SENTENCE                                            02830029
           ELSE                                                         02840029
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                02850070
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                02860071
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                02870072
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              02880072
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              02890072
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              02900072
               DISPLAY '***********************************'            02910072
               DISPLAY '***  ABEND MAKUT202 - A1400-MQOPEN '            02920072
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        02930072
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      02940072
               DISPLAY '***********************************'            02950072
               PERFORM U9000-MQDISC                                     02960070
                  THRU U9000-EXIT                                       02970070
               SET MQ-ERROR        TO TRUE                              02980062
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      02990062
           END-IF.                                                      03000029
                                                                        03010029
       A1400-EXIT.                                                      03020029
           EXIT.                                                        03030029
                                                                        03040029
                                                                        03050029
       B1000-PROCESS-MESSAGES.                                          03060029
                                                                        03070029
           PERFORM B1100-MQGET                                          03080029
              THRU B1100-EXIT.                                          03090029
                                                                        03100029
           IF MQGET-MORE-MSG                                            03110029
               PERFORM B1200-WRITE-ITEM-RECORD                          03120029
                  THRU B1200-EXIT                                       03130029
               ADD +1 TO WS-MSG-COUNT                                   03140076
                                                                        03150076
               IF WS-MSG-COUNT >= WS-COMMIT-LEVEL                       03160076
                  PERFORM B1300-MQCMIT                                  03170076
                     THRU B1300-EXIT                                    03180076
                  MOVE ZERO TO WS-MSG-COUNT                             03190076
               END-IF                                                   03200076
           ELSE                                                         03210059
      *  TO REREAD MESSAGES IN A TEST SITUATION, UNCOMMENT U9200        03220075
      *  AND COMMENT OUT B1300                                          03230075
      *        PERFORM U9200-MQBACK                                     03240075
      *           THRU U9200-EXIT                                       03250075
               PERFORM B1300-MQCMIT                                     03260075
                  THRU B1300-EXIT                                       03270075
           END-IF.                                                      03280022
                                                                        03290001
       B1000-EXIT.                                                      03300029
           EXIT.                                                        03310018
                                                                        03320018
                                                                        03330001
       B1100-MQGET.                                                     03340029
                                                                        03350021
      *  MQGET LEAVES THE RECORD IN THE QUEUE BUT MARKS IT              03360059
      *  AS HAVING BEEN "READ"                                          03370059
                                                                        03380059
           INITIALIZE WS-MSGBUFFER.                                     03390029
           MOVE WS-QUEUE-NAME            TO MQOD-OBJECTNAME.            03400032
           MOVE MQMI-NONE                TO MQMD-MSGID.                 03410021
           MOVE MQCI-NONE                TO MQMD-CORRELID.              03420021
      *    MOVE 60000                    TO MQGMO-WAITINTERVAL.         03430021
           COMPUTE MQGMO-OPTIONS  = MQGMO-SYNCPOINT +                   03440021
                                    MQGMO-CONVERT +                     03450021
                                    MQGMO-WAIT.                         03460021
                                                                        03470029
           CALL WS-MQGET USING WS-HCONN                                 03480029
                               WS-OBJECT-HANDLE                         03490033
                               MQM-MESSAGE-DESCRIPTOR                   03500021
                               MQM-GET-MESSAGE-OPTIONS                  03510021
                               WS-MSGLENGTH                             03520029
                               WS-MSGBUFFER                             03530029
                               WS-DATA-LENGTH                           03540029
                               WS-COMPLETION-CODE                       03550029
                               WS-REASON-CODE.                          03560033
                                                                        03570021
           IF WS-COMPLETION-CODE = MQCC-OK                              03580029
               MOVE WS-MSGBUFFER TO IMRD008-RECORD                      03590043
           ELSE                                                         03600029
               IF WS-REASON-CODE = MQRC-NO-MSG-AVAILABLE                03610043
                   SET MQGET-NO-MORE-MSG TO TRUE                        03620043
               ELSE                                                     03630043
                   MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1            03640070
                   MOVE WS-COMP-CODE1       TO WS-COMP-CODE2            03650071
                   MOVE WS-COMP-CODE2       TO WS-COMP-CODE3            03660072
                   MOVE WS-REASON-CODE      TO WS-REASON-CODE1          03670072
                   MOVE WS-REASON-CODE1     TO WS-REASON-CODE2          03680072
                   MOVE WS-REASON-CODE2     TO WS-REASON-CODE3          03690072
                   DISPLAY '***********************************'        03700072
                   DISPLAY '***  ABEND MAKUT202 - B1100-MQGET  '        03710072
                   DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3    03720072
                   DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3  03730072
                   DISPLAY '***********************************'        03740072
                   PERFORM U9200-MQBACK                                 03750070
                      THRU U9200-EXIT                                   03760070
                   PERFORM U9100-MQCLOSE                                03770070
                      THRU U9100-EXIT                                   03780070
                   PERFORM U9000-MQDISC                                 03790070
                      THRU U9000-EXIT                                   03800070
                   SET MQ-ERROR             TO TRUE                     03810070
                   CALL 'ILBOABN0' USING WS-ABEND-CODE                  03820062
               END-IF                                                   03830043
           END-IF.                                                      03840043
                                                                        03850021
       B1100-EXIT.                                                      03860029
           EXIT.                                                        03870021
                                                                        03880021
                                                                        03890021
       B1200-WRITE-ITEM-RECORD.                                         03900029
                                                                        03910021
           WRITE ITEM-RECORD FROM IMRD008-RECORD.                       03920029
                                                                        03930029
           ADD 1 TO WS-RCDS-WRITTEN.                                    03940029
                                                                        03950021
       B1200-EXIT.                                                      03960029
           EXIT.                                                        03970021
                                                                        03980021
                                                                        03990021
       B1300-MQCMIT.                                                    04000029
                                                                        04010021
      *  MQCMIT DELETES THE RECORD FROM THE QUEUE - IT CANNOT           04020059
      *  BE REREAD AFTER THIS                                           04030059
                                                                        04040059
           CALL WS-MQCMIT USING WS-HCONN                                04050029
                                WS-COMPLETION-CODE                      04060029
                                WS-REASON-CODE.                         04070033
                                                                        04080021
           IF WS-COMPLETION-CODE = MQCC-OK                              04090029
              ADD +1 TO WS-NBR-COMMITS                                  04100079
           ELSE                                                         04110029
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                04120070
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                04130071
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                04140072
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              04150070
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              04160070
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              04170072
               DISPLAY '***********************************'            04180070
               DISPLAY '***  ABEND MAKUT202 - B1300-MQCMIT '            04190070
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        04200072
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      04210072
               DISPLAY '***********************************'            04220070
               PERFORM U9200-MQBACK                                     04230070
                  THRU U9200-EXIT                                       04240070
               SET MQ-ERROR             TO TRUE                         04250070
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      04260062
           END-IF.                                                      04270021
                                                                        04280021
       B1300-EXIT.                                                      04290029
           EXIT.                                                        04300021
                                                                        04310021
                                                                        04320021
       C1000-EOJ-PROCESSING.                                            04330029
                                                                        04340029
           CLOSE ITEM-FILE.                                             04350029
                                                                        04360029
           PERFORM U9100-MQCLOSE                                        04370070
              THRU U9100-EXIT.                                          04380070
           PERFORM U9000-MQDISC                                         04390070
              THRU U9000-EXIT.                                          04400070
                                                                        04410057
           DISPLAY '**************************************************'.04420067
           DISPLAY 'SUCCESSFUL END OF MAKUT202'.                        04430067
           MOVE WS-RCDS-WRITTEN TO WS-DISPLAY-FORMAT.                   04440076
           DISPLAY 'RECORDS WRITTEN:' WS-DISPLAY-FORMAT.                04450076
                                                                        04460076
           MOVE WS-NBR-COMMITS TO WS-DISPLAY-FORMAT.                    04470076
           DISPLAY 'MQ COMMITS: ' WS-DISPLAY-FORMAT.                    04480076
           DISPLAY '**************************************************'.04490067
                                                                        04500032
       C1000-EXIT.                                                      04510029
           EXIT.                                                        04520018
                                                                        04530021
                                                                        04540021
       U9000-MQDISC.                                                    04550070
                                                                        04560021
           CALL WS-MQDISC USING WS-HCONN                                04570030
                                WS-COMPLETION-CODE                      04580030
                                WS-REASON-CODE.                         04590033
                                                                        04600030
           IF WS-COMPLETION-CODE = MQCC-OK                              04610030
               NEXT SENTENCE                                            04620043
           ELSE                                                         04630030
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                04640070
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                04650071
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                04660072
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              04670070
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              04680070
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              04690072
               DISPLAY '***********************************'            04700070
               DISPLAY '***  ABEND MAKUT202 - U9000-MQDISC '            04710070
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        04720072
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      04730072
               DISPLAY '***********************************'            04740070
               SET MQ-ERROR             TO TRUE                         04750070
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      04760062
           END-IF.                                                      04770031
                                                                        04780029
       U9000-EXIT.                                                      04790070
           EXIT.                                                        04800021
                                                                        04810021
                                                                        04820021
       U9100-MQCLOSE.                                                   04830070
                                                                        04840021
           CALL WS-MQCLOSE USING WS-HCONN                               04850029
                                 WS-OBJECT-HANDLE                       04860033
                                 MQCO-NONE                              04870021
                                 WS-COMPLETION-CODE                     04880029
                                 WS-REASON-CODE.                        04890033
                                                                        04900029
           IF WS-COMPLETION-CODE = MQCC-OK                              04910029
               NEXT SENTENCE                                            04920043
           ELSE                                                         04930029
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                04940070
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                04950071
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                04960072
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              04970070
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              04980070
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              04990072
               DISPLAY '***********************************'            05000070
               DISPLAY '***  ABEND MAKUT202 - U9100-MQCLOSE'            05010070
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        05020072
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      05030072
               DISPLAY '***********************************'            05040070
               SET MQ-ERROR             TO TRUE                         05050070
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      05060062
           END-IF.                                                      05070021
                                                                        05080021
       U9100-EXIT.                                                      05090070
           EXIT.                                                        05100021
                                                                        05110029
                                                                        05120029
       U9200-MQBACK.                                                    05130070
                                                                        05140059
      *  WHEN MQBACK IS DONE, ALL RECORDS MARKED AS "READ" WILL         05150059
      *  BE CHANGED BACK TO "UNREAD" SO THE PROGRAM CAN BE RESTARTED.   05160059
                                                                        05170059
           CALL WS-MQBACK USING WS-HCONN                                05180029
                                WS-COMPLETION-CODE                      05190029
                                WS-REASON-CODE.                         05200033
                                                                        05210029
           IF WS-COMPLETION-CODE = MQCC-OK                              05220029
               NEXT SENTENCE                                            05230029
           ELSE                                                         05240029
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                05250070
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                05260071
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                05270072
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              05280070
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              05290070
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              05300072
               DISPLAY '***********************************'            05310070
               DISPLAY '***  ABEND MAKUT202 - U9200-MQBACK '            05320070
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        05330072
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      05340072
               DISPLAY '***********************************'            05350070
               SET MQ-ERROR        TO TRUE                              05360062
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      05370062
           END-IF.                                                      05380029
                                                                        05390029
       U9200-EXIT.                                                      05400070
           EXIT.                                                        05410029
