000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    APKCS363.                                         00040000
000500 AUTHOR.        MARK BURNSIDE.                                    00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  02-04-99.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    A363 - ADJUSTMENT DETAIL INQUIRY                           * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF ADJUSTMENT JOURNAL        * 00130000
001400*    DISTRIBUTION ENTRIES THAT WILL DISPLAY:                    * 00140000
001500*        STORE                                                  * 00150000
001600*        CLASS                                                  * 00160000
001700*        SKU                                                    * 00170000
001800*        GROSS COST                                             * 00180000
001900*        RETAIL AMOUNT                                          * 00190000
002000*        NET AMOUNT                                             * 00200000
002100*    FOR EACH DISTRIBUTION LINE.                                * 00210000
002200*                                                               * 00220000
002300*---------------------------------------------------------------* 00230000
002400*                                                               * 00240000
002500*  APKCS363 KOHLS ADJUSTMENT JOURNAL LIST SCREEN     02/04/99   * 00250000
002600* CHANGES MADE BY:  MARK BURNSIDE                               * 00260000
002700*                                                               * 00270000
002800* DATE  08/29/00                                                * 00280000
002900*    CHANGE MADE: ADDED CODE TO ADD THE MOS AMOUNT AS PART OF   * 00290000
003000*    THE NET COST CALCULATION.                                  * 00300000
003100*    MADE BY: MIKE BESKE              WR/IR #: 20224            * 00310000
003200*                                                               * 00320000
003300* DATE  12/12/2000                                              * 00330000
003400*    CHANGE MADE: MODIFIED ASC-KEY-VND-NBR FROM TEN CHARACTERS  * 00340000
003500*    TO NINE CHARACTERS TO IMPROVE EFFICIENCY OF SQL CALL TO    * 00350000
003600*    ADJUSTMENT JOURNAL DB2 TABLES.                             * 00360000
003700*    MADE BY: MARK BURNSIDE           WR/IR #: 21699            * 00370000
003800*                                                               * 00380000
003900* DATE  01/24/2002                                              * 00390000
004000*    CHANGE MADE: ADDED TWO MORE BYTES TO THE END OF THE        * 00400000
004100*    DISCOUNT STORAGE FIELDS, TO ACCOMMODATE CHANGES MADE TO    * 00410000
004200*    APKCS364 AND APKCS365 TO STORE CORRECTLY ON TADJRNL TABLE. * 00420000
004300*    MADE BY: KEVIN CATLIN            WR/IR #: PM00444221       * 00430000
004400*                                                               * 00440000
004500* DATE  05/16/2002                                              * 00450000
004600*    CHANGE MADE:  NI-SKU CHANGES.  THE 3 BYTE SKU-SEQ FIELD IS * 00460000
004700*    REPLACED WITH A NUMERIC 8 BYTE SKU FIELD.  CHANGES MADE TO * 00470000
004800*    WORKING STORAGE FIELDS AND TO PARAGRAPHS 1105, 3200, 4025, * 00480000
004900*    4300, 4310, AND 4420.  CHANGED SOME ASC- FIELDS IN         * 00490000
005000*    COMMAREA FROM CHAR TO COMP-3 TO REDUCE THE TOTAL COMMAREA  * 00500000
005100*    LENGTH.  MADE MODIFICATIONS TO PARAGRAPHS WHERE THESE      * 00510000
005200*    FIELDS ARE REFERENCED TO PROCESS THE COMP-3 DATA TYPE.     * 00520000
005300*    MADE BY: KEVIN CATLIN                    WR/IR #: 21278    * 00530000
005400*                                                               * 00540000
005500* DATE  07/28/2006                                              * 00550066
005600*     CHANGE MADE:  RECOMPILE FROM PRODUCTION TO PICK UP CHANGES* 00560063
005700*     TO APWS363 COPYBOOK.                                      * 00570063
005800*     MADE BY: MIKE BESKE              WR/IR #: WR30824         * 00580063
005900*                                                               * 00590063
005910* DATE  09/01/2021                                                00591068
005920*            - CHANGE CALL OF  DPKUT100  TO                     * 00592068
005930*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00593068
005940*              MAKING THE CALL DYNAMIC VS STATIC                * 00594068
005950*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053        00595069
005960*                                                               * 00596070
005970* DATE  10/24/2022                                              * 00597071
005980*     CHANGE MADE: ADD COPYBOOK DPWS930                         * 00598071
005990*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API  * 00599071
005991*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864      * 00599171
006000*---------------------------------------------------------------* 00600000
006100 EJECT                                                            00610000
006200 ENVIRONMENT DIVISION.                                            00620000
006300                                                                  00630000
006400 DATA DIVISION.                                                   00640000
006500                                                                  00650000
006600 WORKING-STORAGE SECTION.                                         00660000
006700                                                                  00670000
006800 01  PC-PROGRAM-CONSTANTS.                                        00680000
006900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00690000
007000                                                    'AP363A  '.   00700000
007100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00710000
007200                                                    'APKM363 '.   00720000
007300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00730000
007400                                                    'APKCS363'.   00740000
007500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00750000
007600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00760000
007700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     00770000
007800                                                    COMP SYNC.    00780000
007900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00790000
008000                                                    COMP SYNC.    00800000
008100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00810000
008200                                                    +1000000      00820000
008300                                                    COMP-3.       00830000
008400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00840000
008500                                                    COMP SYNC.    00850000
008600*                                                                 00860000
008700     05  PC-TSYMSG-NUMBERS.                                       00870000
008800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00880000
008900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00890000
009000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00900000
009100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00910000
009200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00920000
009300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00930000
009400*                                                                 00940000
009500 01  PS-PROGRAM-SWITCHES.                                         00950000
009600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00960000
009700         88  PS-NO-ERROR                            VALUE 'Y'.    00970000
009800         88  PS-ERROR                               VALUE 'N'.    00980000
009900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00990000
010000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01000000
010100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01010000
010200*                                                                 01020000
010300 01  PV-PROGRAM-VARIABLES.                                        01030000
010400     05  PV-SUB                         PIC S9(04)  VALUE +0      01040000
010500                                                    COMP SYNC.    01050000
010600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01060000
010700                                                    COMP SYNC.    01070000
010800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01080000
010900                                                    COMP-3.       01090000
011000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01100000
011100                                                    COMP-3.       01110000
011200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01120000
011300                                                    COMP-3.       01130000
011400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01140000
011500                                                    COMP-3.       01150000
011600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01160000
011700                                                    COMP-3.       01170000
011800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01180000
011900                                                    COMP-3.       01190000
012000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01200000
012100                                                    COMP SYNC.    01210000
012200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01220000
012300                                                    COMP SYNC.    01230000
012400     05  PV-ITEM                        PIC S9(04)  VALUE +0      01240000
012500                                                    COMP SYNC.    01250000
012600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01260000
012700                                                    COMP SYNC.    01270000
012800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01280000
012900                                                    COMP SYNC.    01290000
013000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01300000
013100                                                    COMP SYNC.    01310000
013200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01320000
013300                                                    COMP SYNC.    01330000
013400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01340000
013500                                                    COMP SYNC.    01350000
013600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01360000
013700                                                    COMP SYNC.    01370000
013800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01380000
013900                                                    COMP SYNC.    01390000
014000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01400000
014100                                                    COMP SYNC.    01410000
014200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01420000
014300                                                    COMP SYNC.    01430000
014400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01440000
014500                                                    COMP SYNC.    01450000
014600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01460000
014700                                                    COMP SYNC.    01470000
014800     05  PV-NUM4                        PIC  9(04).               01480000
014900     05  PV-NUM4-X REDEFINES                                      01490000
015000         PV-NUM4                        PIC  X(04).               01500000
015100     05  PV-NUM8                        PIC  9(08).               01510000
015200     05  PV-NUM8-X REDEFINES                                      01520000
015300         PV-NUM8                        PIC  X(08).               01530000
015400     05  PV-10V99                       PIC ----------.99.        01540000
015500     05  PV-10V99-X REDEFINES                                     01550000
015600         PV-10V99                       PIC  X(13).               01560000
015700     05  PV-TEMP-DOLLAR-FIELD           PIC  X(13).               01570000
015800     05  PV-TEMP-DOLLAR-FIELD-9         PIC  S9(10)V99  COMP-3.   01580000
015900     05  PV-DISC-AMT                    PIC  S9(10)V99.           01590000
016000                                                                  01600000
016100******************************************************************01610000
016200**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01620000
016300**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01630000
016400**  APPLICATION-SPECIFIC COMMAREA.                              **01640000
016500******************************************************************01650000
016600 01  LQW-LIST-QUEUE-WORK-AREA.                                    01660000
016700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01670000
016800     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           01680000
016900                                        INDEXED BY LQW-IDX.       01690000
017000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01700000
017100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01710000
017200         10  LQW-SELECTED-SW            PIC  X(01).               01720000
017300             88  LQW-SELECT                         VALUE 'S'.    01730000
017400             88  LQW-DESELECT                       VALUE ' '.    01740000
017500         10  LQW-DISTRB-SEQ-NBR         PIC  S9(04) COMP.         01750000
017600         10  LQW-DEPT-NBR               PIC  X(03).               01760000
017700         10  LQW-STORE-ALL.                                       01770000
017800             20  LQW-STORE-X            PIC  X(04).               01780000
017900             20  LQW-STORE              PIC  9(04).               01790000
018000         10  LQW-CLS                    PIC  X(02).               01800000
018100         10  LQW-SKU                    PIC  X(08).               01810000
018200         10  LQW-SKU-9 REDEFINES                                  01820000
018300             LQW-SKU                    PIC  9(08).               01830000
018400         10  LQW-GROSS-COST             PIC  X(13).               01840000
018500         10  LQW-GROSS-COST-9 REDEFINES                           01850000
018600             LQW-GROSS-COST             PIC  -9(10)V99.           01860000
018700         10  LQW-RETAIL-AMT             PIC  X(13).               01870000
018800         10  LQW-RETAIL-AMT-9 REDEFINES                           01880000
018900             LQW-RETAIL-AMT             PIC  -9(10)V99.           01890000
019000         10  LQW-FRGT-AMT               PIC  S9(10)V99 COMP-3.    01900000
019100         10  LQW-MISC-CHRG-AMT          PIC  S9(10)V99 COMP-3.    01910000
019200         10  LQW-DISC-AMT               PIC  S9(10)V99 COMP-3.    01920000
019300         10  LQW-NET-COST               PIC  X(13).               01930000
019400         10  LQW-NET-COST-9 REDEFINES                             01940000
019500             LQW-NET-COST               PIC  -9(10)V99.           01950000
019600         10  LQW-LINE-CHANGED-SW        PIC  X.                   01960000
019700         10  LQW-LINE-PROBLEM-SW        PIC  X.                   01970000
019800                                                                  01980000
019900     EJECT                                                        01990000
020000*---------------------------------------------------------------* 02000000
020100*  RECORD LAYOUT FOR THE ADJUSTMENT SELECTION TEMP STORAGE      * 02010000
020200*  QUEUE.                                                       * 02020000
020300*---------------------------------------------------------------* 02030000
020400                                                                  02040000
020500     COPY APWS362.                                                02050000
020600     COPY APWS363.                                                02060000
020700                                                                  02070000
020800     EJECT                                                        02080000
020900*---------------------------------------------------------------* 02090000
021000*    MAP LAYOUT                                                 * 02100000
021100*---------------------------------------------------------------* 02110000
021200                                                                  02120000
021300     COPY APKM363.                                                02130000
021400*                                                                 02140000
021500 01  MR-OCCURS-LAYOUT                   REDEFINES  AP363AO.       02150000
021600     05  MR-FILLER                      PIC X(0205).              02160066
021700     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          02170000
021800         10  MR-STOREL                  PIC S9(04) COMP.          02180000
021900         10  MR-STOREA                  PIC  X(01).               02190000
022000         10  MR-STOREC                  PIC  X(01).               02200000
022100         10  MR-STOREH                  PIC  X(01).               02210000
022200         10  MR-STORE                   PIC  X(04).               02220000
022300         10  MR-STORE-9 REDEFINES                                 02230000
022400             MR-STORE                   PIC  ZZZZ.                02240000
022500                                                                  02250000
022600         10  MR-CLASSL                  PIC S9(04) COMP.          02260000
022700         10  MR-CLASSA                  PIC  X(01).               02270000
022800         10  MR-CLASSC                  PIC  X(01).               02280000
022900         10  MR-CLASSH                  PIC  X(01).               02290000
023000         10  MR-CLASS                   PIC  X(02).               02300000
023100                                                                  02310000
023200         10  MR-SKUL                    PIC S9(04) COMP.          02320000
023300         10  MR-SKUA                    PIC  X(01).               02330000
023400         10  MR-SKUC                    PIC  X(01).               02340000
023500         10  MR-SKUH                    PIC  X(01).               02350000
023600         10  MR-SKU                     PIC  X(08).               02360000
023700                                                                  02370000
023800         10  MR-GROSSL                  PIC S9(04) COMP.          02380000
023900         10  MR-GROSSA                  PIC  X(01).               02390000
024000         10  MR-GROSSC                  PIC  X(01).               02400000
024100         10  MR-GROSSH                  PIC  X(01).               02410000
024200         10  MR-GROSS                   PIC  X(13).               02420000
024300                                                                  02430000
024400         10  MR-RETAILL                 PIC S9(04) COMP.          02440000
024500         10  MR-RETAILA                 PIC  X(01).               02450000
024600         10  MR-RETAILC                 PIC  X(01).               02460000
024700         10  MR-RETAILH                 PIC  X(01).               02470000
024800         10  MR-RETAIL                  PIC  X(13).               02480000
024900                                                                  02490000
025000         10  MR-NETL                    PIC S9(04) COMP.          02500000
025100         10  MR-NETA                    PIC  X(01).               02510000
025200         10  MR-NETC                    PIC  X(01).               02520000
025300         10  MR-NETH                    PIC  X(01).               02530000
025400         10  MR-NET                     PIC  X(13).               02540000
025500                                                                  02550000
025600     EJECT                                                        02560000
025700*---------------------------------------------------------------* 02570000
025800*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02580000
025900*---------------------------------------------------------------* 02590000
026000                                                                  02600000
026100     COPY DPWS015.                                                02610000
026200                                                                  02620000
026300*---------------------------------------------------------------* 02630000
026400*    FUNCTION KEYS COPYBOOK.                                    * 02640000
026500*---------------------------------------------------------------* 02650000
026600                                                                  02660000
026700     COPY DPWS016.                                                02670000
026800                                                                  02680000
026900*---------------------------------------------------------------* 02690000
027000*    NUMERIC EDIT LAYOUT.                                       * 02700000
027100*---------------------------------------------------------------* 02710000
027200                                                                  02720000
027300     COPY DPWS010I.                                               02730000
027400 EJECT                                                            02740000
027500*---------------------------------------------------------------* 02750000
027600*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 02760000
027700*---------------------------------------------------------------* 02770000
027800                                                                  02780000
027900     COPY DPWS030.                                                02790000
027910     COPY DPWS930.                                                02791071
028000 EJECT                                                            02800000
028100*---------------------------------------------------------------* 02810000
028200*    STANDARD COMMAREA.                                         * 02820000
028300*---------------------------------------------------------------* 02830000
028400                                                                  02840000
028500     COPY DPWS020.                                                02850000
028600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02860000
028700                                                                  02870000
028800*---------------------------------------------------------------* 02880000
028900* INTER-APPLICATION COMMAREA.                                   * 02890000
029000*   APWS361 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02900000
029100*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02910000
029200*---------------------------------------------------------------* 02920000
029300                                                                  02930000
029400         10  INTER-APPL-COMM-AREA       PIC X(200).               02940000
029500     COPY APWS361.                                                02950000
029600*---------------------------------------------------------------* 02960000
029700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02970000
029800*---------------------------------------------------------------* 02980000
029900         10  ASC-SPECIFIC-COMMAREA.                               02990000
030000             15  ASC-INT-APPL-FORMAT-IND             PIC  X.      03000000
030100                 88  ASC-INTER-APPL-ADD                VALUE ' '. 03010000
030200                 88  ASC-INTER-APPL-CRIT-UPDATE        VALUE '2'. 03020000
030300                 88  ASC-INTER-APPL-LIST-UPDATE        VALUE '5'. 03030000
030400             15  ASC-LIST-KEYS.                                   03040000
030500                 20  ASC-KEY-VND-NBR                 PIC  X(09).  03050000
030600                 20  ASC-KEY-DOC-NBR                 PIC  X(16).  03060000
030700                 20  ASC-KEY-DOC-DTE                 PIC  X(10).  03070000
030800                 20  ASC-KEY-AP-TRN-CDE              PIC  X(02).  03080000
030900             15  ASC-ALPHA-FIELDS.                                03090000
031000                 20  ASC-ALP-HD-GRO-COST             PIC  X(13).  03100000
031100                 20  ASC-ALP-HD-GRO-COST-9 REDEFINES              03110000
031200                     ASC-ALP-HD-GRO-COST            PIC -9(10)V99.03120000
031300                 20  ASC-ALP-HD-RET-AMT              PIC  X(13).  03130000
031400                 20  ASC-ALP-HD-RET-AMT-9 REDEFINES               03140000
031500                     ASC-ALP-HD-RET-AMT             PIC -9(10)V99.03150000
031600                 20  ASC-ALP-HD-FRGT-AMT            PIC   X(13).  03160000
031700                 20  ASC-ALP-HD-FRGT-AMT-9 REDEFINES              03170000
031800                     ASC-ALP-HD-FRGT-AMT            PIC -9(10)V99.03180000
031900             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03190000
032000                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03200000
032100                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03210000
032200                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03220000
032300                                                                  03230000
032400                 20  ASC-ITEM-ARRAY.                              03240000
032500                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        03250000
032600                         30  ASC-LIST-ITEM-NUMBER                 03260000
032700                                                     PIC S9(09)   03270000
032800                                                     COMP-3.      03280000
032900                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03290000
033000                             88  ASC-VALID-SELECT    VALUE ' '    03300000
033100                                                           'S'    03310000
033200                                                           'D'.   03320000
033300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03330000
033400                             88  ASC-TEMP-DELETE     VALUE 'D'.   03340000
033500                             88  ASC-TEMP-SELECT     VALUE 'S'.   03350000
033600                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03360000
033700                             88  ASC-TEMP-END        VALUE 'E'.   03370000
033800                         30  ASC-SELECTED-SW         PIC  X(01).  03380000
033900                             88  ASC-NO-SELECT       VALUE ' '.   03390000
034000                             88  ASC-DELETE          VALUE 'D'.   03400000
034100                             88  ASC-SELECT          VALUE 'S'.   03410000
034200                             88  ASC-BEGIN           VALUE 'B'.   03420000
034300                             88  ASC-END             VALUE 'E'.   03430000
034400                         30  ASC-DISTRB-SEQ-NBR      PIC S9(04)   03440000
034500                                                           COMP.  03450000
034600                         30  ASC-DEPT-NBR            PIC  X(03).  03460000
034700                         30  ASC-STORE-ALL.                       03470000
034800                             35  ASC-ALP-STORE       PIC  X(04).  03480000
034900                             35  ASC-STORE           PIC  9(04).  03490000
035000                         30  ASC-CLASS               PIC  X(02).  03500000
035100                         30  ASC-SKU                 PIC S9(08)   03510000
035200                                                          COMP-3. 03520000
035300                         30  ASC-GROSS-COST        PIC S9(10)V99  03530000
035400                                                          COMP-3. 03540000
035500                         30  ASC-RETAIL-AMT        PIC S9(10)V99  03550000
035600                                                          COMP-3. 03560000
035700                         30  ASC-DT-FRGT-AMT       PIC S9(10)V99  03570000
035800                                                          COMP-3. 03580000
035900                         30  ASC-DT-MISC-CHRG-AMT  PIC S9(10)V99  03590000
036000                                                          COMP-3. 03600000
036100                         30  ASC-DISC-AMT          PIC S9(10)V99  03610000
036200                                                          COMP-3. 03620000
036300                         30  ASC-NET-COST          PIC S9(11)V99  03630000
036400                                                          COMP-3. 03640000
036500                         30  ASC-LINE-CHANGED-SW   PIC  X.        03650000
036600                             88  ASC-LINE-UPDATED  VALUE 'A'.     03660000
036700                             88  ASC-LINE-CHANGED  VALUE 'Y'.     03670000
036800                             88  ASC-LINE-NOT-CHANGED             03680000
036900                                                   VALUE ' '.     03690000
037000                         30  ASC-LINE-PROBLEM-SW   PIC  X.        03700000
037100                             88  ASC-LINE-ERROR    VALUE 'E'.     03710000
037200                             88  ASC-LINE-OK       VALUE ' '.     03720000
037300                                                                  03730000
037400             15  ASC-BLK-SUB                         PIC S9(04)   03740000
037500                                                          COMP    03750000
037600                                                          SYNC.   03760000
037700             15  ASC-ITEM-SUB                        PIC S9(04)   03770000
037800                                                          COMP    03780000
037900                                                          SYNC.   03790000
038000             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03800000
038100                                                          COMP-3. 03810000
038200             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03820000
038300                                                          COMP-3. 03830000
038400             15  ASC-NUMBER-OF-DELETED-ITEMS         PIC S9(09)   03840000
038500                                                          COMP-3. 03850000
038600             15  ASC-NO-OF-DIS-ITEMS                 PIC S9(05)   03860000
038700                                                         COMP-3.  03870000
038800             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03880000
038900                                                          COMP-3. 03890000
039000             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03900000
039100                                                          COMP-3. 03910000
039200             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03920000
039300                                                          COMP-3. 03930000
039400             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03940000
039500                                                          COMP    03950000
039600                                                          SYNC.   03960000
039700             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03970000
039800                                                          COMP-3. 03980000
039900             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03990000
040000                                                          COMP-3. 04000000
040100             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04010000
040200                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04020000
040300                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04030000
040400             15  ASC-MULT-DISTRO-IND                 PIC  X(01).  04040000
040500                 88  ASC-MULT-DIST                   VALUE 'Y'.   04050000
040600                 88  ASC-SINGLE-DIST                 VALUE 'N'.   04060000
040700             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04070000
040800                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04080000
040900                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04090000
041000             15  ASC-LIST-QUEUE-NAME.                             04100000
041100                 20  ASC-LIST-TERM-ID                PIC  X(04).  04110000
041200                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04120000
041300                                                          COMP-3. 04130000
041400                 20  ASC-LIST-SEQ                    PIC  9(01).  04140000
041500             15  ASC-SEL-QUEUE-NAME.                              04150000
041600                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04160000
041700                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04170000
041800                                                          COMP-3. 04180000
041900                 20  ASC-SEL-SEQ                     PIC  9(01).  04190000
042000                                                                  04200000
042100             15  ASC-TS-QUEUE-NAME                   PIC  X(08).  04210000
042200             15  ASC-START-ITEM-REQUEST.                          04220000
042300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04230000
042400             15  ASC-STORE-FOUND-SW                  PIC  X(01).  04240000
042500                 88  ASC-STORE-NOT-FOUND                VALUE 'Y'.04250000
042600                 88  ASC-STORE-FOUND                    VALUE 'N'.04260000
042700             15  ASC-SKU-ENTERED-SW                  PIC  X(01).  04270000
042800                 88  ASC-SKU-NOT-ENTERED                VALUE 'Y'.04280000
042900                 88  ASC-SKU-ENTERED                    VALUE 'N'.04290000
043000                 88  ASC-SKU-NOT-ALLOWED                VALUE 'O'.04300000
043100             15  ASC-ALLOCATION-SW                   PIC  X(01).  04310000
043200                 88  ASC-GROSS-COST-ALLOCATION          VALUE 'G'.04320000
043300                 88  ASC-RETAIL-AMT-ALLOCATION          VALUE 'R'.04330000
043400                 88  ASC-FREIGHT-COST-ALLOCATION        VALUE 'F'.04340000
043500             15  ASC-CLASS-FOUND-SW                  PIC  X(01).  04350000
043600                 88  ASC-CLASS-FOUND                    VALUE 'Y'.04360000
043700                 88  ASC-CLASS-NOT-FOUND                VALUE 'N'.04370000
043800             15  ASC-DELETE-PROCESS-SW               PIC  X(03).  04380000
043900                 88  ASC-NO-DELETE                    VALUE '   '.04390000
044000                 88  ASC-DELETE-REQUESTED             VALUE 'REQ'.04400000
044100                 88  ASC-DELETE-PENDING               VALUE 'PND'.04410000
044200             15  ASC-SKU-FOUND-SW                    PIC  X(01).  04420000
044300                 88  ASC-SKU-FOUND                      VALUE 'Y'.04430000
044400                 88  ASC-SKU-NOT-FOUND                  VALUE 'N'.04440000
044500             15  ASC-CURRENT-DATE                    PIC  X(10).  04450000
044600             15  ASC-CUTOFF-DATE                     PIC  X(10).  04460000
044700             15  ASC-CUTOFF-DATE-RDF REDEFINES                    04470000
044800                 ASC-CUTOFF-DATE.                                 04480000
044900                 20  ASC-CUTOFF-CC                   PIC  X(02).  04490000
045000                 20  ASC-CUTOFF-YY                   PIC  X(02).  04500000
045100                 20  FILLER                          PIC  X(01).  04510000
045200                 20  ASC-CUTOFF-MM                   PIC  X(02).  04520000
045300                 20  FILLER                          PIC  X(01).  04530000
045400                 20  ASC-CUTOFF-DD                   PIC  X(02).  04540000
045500             15  ASC-HD-STORE                        PIC  9(04).  04550000
045600             15  ASC-DOC-NBR                         PIC  X(16).  04560000
045700             15  ASC-PO-NBR                          PIC  X(09).  04570000
045800             15  ASC-DEPT                            PIC  X(03).  04580000
045900             15  ASC-ACCOUNT                         PIC  X(07).  04590000
046000             15  ASC-HD-GRO-COST                    PIC S9(10)V99 04600000
046100                                                        COMP-3.   04610000
046200             15  ASC-VND-NBR                         PIC  X(10).  04620000
046300             15  ASC-VND-NAME                        PIC  X(25).  04630000
046400             15  ASC-HD-RET-AMT                     PIC S9(10)V99 04640000
046500                                                        COMP-3.   04650000
046600             15  ASC-AP-TRN-CDE                      PIC  X(02).  04660000
046700             15  ASC-ENTR-TMST                       PIC  X(26).  04670000
046800             15  ASC-ENTR-ID                         PIC  X(08).  04680000
046900             15  ASC-ORGN-CDE                        PIC  X(01).  04690000
047000             15  ASC-HD-FRGT-AMT                    PIC S9(10)V99 04700000
047100                                                        COMP-3.   04710000
047200             15  ASC-MISC-CHRG-AMT                  PIC S9(10)V99 04720000
047300                                                        COMP-3.   04730000
047400             15  ASC-TERM-DISC-PCT               PIC 9(03)V9(4).  04740000
047500             15  ASC-TERM-DISC-AMT                  PIC S9(10)V99 04750000
047600                                                        COMP-3.   04760000
047700             15  ASC-NET-COST-AMT                   PIC S9(10)V99 04770000
047800                                                        COMP-3.   04780000
047900             15  ASC-INV-CTOFF-DTE                   PIC  X(10).  04790000
048000             15  ASC-TRN-TYP-CDE                     PIC  X(03).  04800000
048100             15  ASC-DOC-EXTR-IND                    PIC  X(01).  04810000
048200             15  ASC-DOC-EXTR-DTE                    PIC  X(10).  04820000
048300             15  ASC-BRCDE-NBR                       PIC  X(09).  04830000
048400             15  ASC-PS-BTCH-NBR                     PIC  X(15).  04840000
048500             15  ASC-PS-PSTG-IND                     PIC  X(01).  04850000
048600             15  ASC-ENT-ID                          PIC  9(09)   04860000
048700                                                          COMP-3. 04870000
048800             15  ASC-NW-STR-DISC-PCT             PIC  9(03)V9(4). 04880000
048900             15  ASC-NW-STR-DISC-AMT                PIC S9(10)V99 04890000
049000                                                        COMP-3.   04900000
049100             15  ASC-TRD-DISC-PCT                PIC  9(03)V9(4). 04910000
049200             15  ASC-TRD-DISC-AMT                   PIC S9(10)V99 04920000
049300                                                        COMP-3.   04930000
049400             15  ASC-MOS-DISC-PCT                PIC  9(03)V9(4). 04940000
049500             15  ASC-MOS-DISC-AMT                   PIC S9(10)V99 04950000
049600                                                        COMP-3.   04960000
049700             15  ASC-TOTAL-DISC-AMT                 PIC S9(10)V99 04970000
049800                                                        COMP-3.   04980000
049900             15  ASC-TOTAL-GROSS-COST               PIC S9(10)V99 04990000
050000                                                        COMP-3.   05000000
050100             15  ASC-TOTAL-RETAIL-AMT               PIC S9(10)V99 05010000
050200                                                        COMP-3.   05020000
050300             15  ASC-DOC-HLD-CDE                     PIC  X(01).  05030000
050400             15  ASC-DIS-STR-NBR                     PIC  9(04)   05040000
050500                                                          COMP-3. 05050000
050600             15  ASC-DIS-CL-NBR                      PIC  X(02).  05060000
050700             15  ASC-DIS-SKU-NBR                    PIC S9(08)    05070000
050800                                                          COMP-3. 05080000
050900             15  ASC-DIS-GRO-COST-AMT               PIC S9(10)V99 05090000
051000                                                        COMP-3.   05100000
051100             15  ASC-DIS-RTL-AMT                    PIC S9(10)V99 05110000
051200                                                        COMP-3.   05120000
051300             15  ASC-DIS-NET-COST-AMT               PIC S9(10)V99 05130000
051400                                                        COMP-3.   05140000
051500             15  ASC-DIS-DISTRB-SEQ                  PIC  S9(09)  05150000
051600                                                          COMP-3. 05160000
051700     EJECT                                                        05170000
051800*---------------------------------------------------------------* 05180000
051900*    ABEND PROCESSING COPYBOOK.                                 * 05190000
052000*---------------------------------------------------------------* 05200000
052100                                                                  05210000
052200     COPY DPWS013.                                                05220000
052300                                                                  05230000
052400 EJECT                                                            05240000
052500*---------------------------------------------------------------* 05250000
052600*    DB2 AREA FOR ADJUSTMENT JOURNAL DISTRIBUTION               * 05260000
052700*---------------------------------------------------------------* 05270000
052800     EXEC SQL                                                     05280000
052900          INCLUDE TADJDIS                                         05290000
053000     END-EXEC.                                                    05300000
053100*---------------------------------------------------------------* 05310000
053200*    DB2 AREA FOR COMMUNICATIONS                                * 05320000
053300*---------------------------------------------------------------* 05330000
053400     EXEC SQL                                                     05340000
053500          INCLUDE SQLCA                                           05350000
053600     END-EXEC.                                                    05360000
053700                                                                  05370000
053800***************************************************************** 05380000
053900*    CURSOR TO EXTRACT THE ADJUSTMENT DISTRIBUTION LINES        * 05390000
054000***************************************************************** 05400000
054100     EXEC SQL                                                     05410000
054200          DECLARE DISTRO-CSR CURSOR FOR                           05420000
054300              SELECT VND_NBR                                      05430000
054400                    ,DOC_NBR                                      05440000
054500                    ,DOC_DTE                                      05450000
054600                    ,AP_TRN_CDE                                   05460000
054700                    ,DISTRB_SEQ_NBR                               05470000
054800                    ,STR_NBR                                      05480000
054900                    ,DEPT_NBR                                     05490000
055000                    ,CL_NBR                                       05500000
055100                    ,SKU_NBR                                      05510000
055200                    ,GRO_COST_AMT                                 05520000
055300                    ,RTL_AMT                                      05530000
055400                    ,FRGT_AMT                                     05540000
055500                    ,MISC_CHRG_AMT                                05550000
055600                    ,DISC_AMT                                     05560000
055700                    ,NET_COST_AMT                                 05570000
055800              FROM TADJDIS                                        05580000
055900              WHERE VND_NBR    = :ASC-KEY-VND-NBR                 05590000
056000              AND   DOC_NBR    = :ASC-KEY-DOC-NBR                 05600000
056100              AND   DOC_DTE    = :ASC-KEY-DOC-DTE                 05610000
056200              AND   AP_TRN_CDE = :ASC-KEY-AP-TRN-CDE              05620000
056300              ORDER BY VND_NBR, DOC_NBR, DOC_DTE, AP_TRN_CDE,     05630000
056400                       DISTRB_SEQ_NBR                             05640000
056500     END-EXEC.                                                    05650000
056600                                                                  05660000
056700 EJECT                                                            05670000
056800 LINKAGE SECTION.                                                 05680000
056900                                                                  05690000
057000 01  DFHCOMMAREA.                                                 05700000
057100     05  FILLER                         OCCURS  1 TO 4072 TIMES   05710000
057200                                        DEPENDING ON EIBCALEN.    05720000
057300         10  FILLER                     PIC X.                    05730000
057400                                                                  05740000
057500 EJECT                                                            05750000
057600 PROCEDURE DIVISION.                                              05760000
057700******************************************************************05770000
057800**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05780000
057900**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05790000
058000**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05800000
058100******************************************************************05810000
058200 0000-MAIN-MODULE.                                                05820000
058300                                                                  05830000
058400     INITIALIZE DP030-CICS-API-FIELDS.                            05840000
058500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05850000
058600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05860000
058700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05870000
058800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05880000
058900     MOVE LENGTH OF AP363AI        TO DP030-MAP-LENGTH (1).       05890000
059000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05900000
059100                                                                  05910000
059200     PERFORM 0001-CALL-CICS-ARCH-API.                             05920000
059300                                                                  05930000
059400     PERFORM 1000-CONTROL-PROCESSING                              05940000
059500                                                                  05950000
059600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05960000
059700                                                                  05970000
059800     PERFORM 0001-CALL-CICS-ARCH-API.                             05980000
059900                                                                  05990000
060000******************************************************************06000000
060100**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06010000
060200**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06020000
060300******************************************************************06030000
060400 0001-CALL-CICS-ARCH-API.                                         06040000
060500                                                                  06050000
060600     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06060070
060700                                    DFHCOMMAREA                   06070070
060800                                    DP030-CICS-API-FIELDS         06080070
060900                                    DP020-STANDARD-COMMAREA       06090070
061000                                    AP363AI.                      06100070
061100                                                                  06110000
061200     IF  DP030-RC-CALL-SUCCESSFUL                                 06120000
061300         CONTINUE                                                 06130000
061400     ELSE                                                         06140000
061500         SET DP013-NO-ROLLBACK                                    06150000
061600             DP013-XCTL-DISPLAY-RESTART                           06160000
061700             DP013-CICS-ABEND      TO TRUE                        06170000
061800         MOVE '0001-CALL-CICS-ARCH-API'                           06180000
061900                                   TO DP013-PARAGRAPH             06190000
062000         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06200071
062100-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06210071
062200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06220000
062300         PERFORM DP013-0000-PROCESS-ABEND                         06230000
062400     END-IF.                                                      06240000
062500******************************************************************06250000
062600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06260000
062700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06270000
062800*                                                                *06280000
062900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06290000
063000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06300000
063100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06310000
063200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06320000
063300******************************************************************06330000
063400 1000-CONTROL-PROCESSING.                                         06340000
063500                                                                  06350000
063600     EVALUATE TRUE                                                06360000
063700         WHEN DP020-NEXT-ACT-INITIAL                              06370000
063800             INITIALIZE ASC-SPECIFIC-COMMAREA                     06380000
063900             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06390000
064000                                      ASC-SEL-TERM-ID             06400000
064100             MOVE DP020-SRC-TASK-NUMBER                           06410000
064200                                   TO ASC-LIST-TASK-NUMBER        06420000
064300                                      ASC-SEL-TASK-NUMBER         06430000
064400             MOVE PC-LIST-QUEUE-SEQ                               06440000
064500                                   TO ASC-LIST-SEQ                06450000
064600             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06460000
064700             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06470000
064800             IF  PS-ERROR                                         06480000
064900                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            06490000
065000             ELSE                                                 06500000
065100                 PERFORM 4000-BUILD-INITIAL-PANEL                 06510000
065200             END-IF                                               06520000
065300                                                                  06530000
065400         WHEN DP020-NEXT-ACT-READ-MAP                             06540000
065500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06550000
065600                                   TO PV-TOP-ITEM                 06560000
065700             PERFORM 2000-PROCESS-PANEL                           06570000
065800                                                                  06580000
065900         WHEN OTHER                                               06590000
066000             SET DP013-LOGIC-ABEND TO TRUE                        06600000
066100             SET DP013-NO-ROLLBACK TO TRUE                        06610000
066200             MOVE '1000-CONTROL-PROCESSING'                       06620000
066300                                   TO DP013-PARAGRAPH             06630000
066400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06640000
066500                                   TO DP013-MESSAGE-TEXT(1)       06650000
066600             PERFORM DP013-0000-PROCESS-ABEND                     06660000
066700     END-EVALUATE.                                                06670000
066800                                                                  06680000
066900 EJECT                                                            06690000
067000******************************************************************06700000
067100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06710000
067200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06720000
067300******************************************************************06730000
067400 1100-PROCESS-INTER-APPL-COMM.                                    06740000
067500                                                                  06750000
067600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06760000
067700                                                                  06770000
067800     EXEC SQL                                                     06780000
067900         SET :ASC-CURRENT-DATE = CURRENT DATE                     06790000
068000     END-EXEC.                                                    06800000
068100                                                                  06810000
068200     MOVE AP361-VND-NBR            TO ASC-KEY-VND-NBR.            06820000
068300     MOVE AP361-DOC-NO             TO ASC-KEY-DOC-NBR.            06830000
068400     MOVE AP361-DOC-DATE           TO ASC-KEY-DOC-DTE.            06840000
068500     MOVE AP361-TRN-CDE            TO ASC-KEY-AP-TRN-CDE.         06850000
068600     MOVE AP361-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME          06860000
068700*MAB                                                              06870000
068800     MOVE AP361-TS-QUEUE-NAME      TO ASC-TS-QUEUE-NAME           06880000
068900     MOVE DP020-INT-APPL-FORMAT-IND                               06890000
069000                                   TO ASC-INT-APPL-FORMAT-IND.    06900000
069100     MOVE +1 TO PV-SEL-QUEUE-ITEM.                                06910000
069200                                                                  06920000
069300     PERFORM 6108-READ-TEMP-QUEUE.                                06930000
069400                                                                  06940000
069500     PERFORM 6109-DELETE-TEMP-QUEUE.                              06950000
069600                                                                  06960000
069700     PERFORM 1105-MOVE-TEMP-STORE-FIELDS.                         06970000
069800                                                                  06980000
069900******************************************************************06990000
070000* THIS PARAGRAPH WILL MOVE THE TEMPORARY STORAGE QUEUE ITEMS     *07000000
070100* FROM THE HEADER SCREEN TO THE ASC FIELDS.                      *07010000
070200******************************************************************07020000
070300 1105-MOVE-TEMP-STORE-FIELDS.                                     07030000
070400                                                                  07040000
070500     MOVE AP363-VND-NBR            TO ASC-VND-NBR.                07050000
070600     MOVE AP363-DOC-NBR            TO ASC-DOC-NBR.                07060000
070700     MOVE AP363-PO-NBR             TO ASC-PO-NBR.                 07070000
070800     MOVE AP363-DEPT-NBR           TO ASC-DEPT.                   07080000
070900     MOVE AP363-STR-NBR            TO ASC-HD-STORE.               07090000
071000     MOVE AP363-GL-ACCT-NBR        TO ASC-ACCOUNT.                07100000
071100     MOVE AP363-VENDOR-NAME        TO ASC-VND-NAME.               07110000
071200     MOVE AP363-GRO-COST-AMT       TO ASC-ALP-HD-GRO-COST-9       07120000
071300                                      ASC-HD-GRO-COST.            07130000
071400     MOVE AP363-RTL-AMT            TO ASC-ALP-HD-RET-AMT-9        07140000
071500                                      ASC-HD-RET-AMT.             07150000
071600                                                                  07160000
071700     MOVE AP363-AP-TRN-CDE         TO ASC-AP-TRN-CDE.             07170000
071800     MOVE AP363-ENTR-TMST          TO ASC-ENTR-TMST.              07180000
071900     MOVE AP363-ENTR-ID            TO ASC-ENTR-ID.                07190000
072000     MOVE AP363-ORGN-CDE           TO ASC-ORGN-CDE.               07200000
072100     MOVE AP363-FRGT-AMT           TO ASC-ALP-HD-FRGT-AMT-9       07210000
072200                                      ASC-HD-FRGT-AMT.            07220000
072300     MOVE AP363-MISC-CHRG-AMT      TO ASC-MISC-CHRG-AMT.          07230000
072400     MOVE AP363-TERM-DISC-PCT      TO ASC-TERM-DISC-PCT.          07240000
072500                                                                  07250000
072600     MOVE AP363-TERM-DISC-AMT      TO ASC-TERM-DISC-AMT.          07260000
072700     MOVE AP363-NET-COST-AMT       TO ASC-NET-COST-AMT.           07270000
072900     MOVE AP363-TRN-TYP-CDE        TO ASC-TRN-TYP-CDE.            07290000
073000     MOVE AP363-DOC-EXTR-IND       TO ASC-DOC-EXTR-IND.           07300000
073100     MOVE AP363-DOC-EXTR-DTE       TO ASC-DOC-EXTR-DTE.           07310000
073200     MOVE AP363-BRCDE-NBR          TO ASC-BRCDE-NBR.              07320000
073300     MOVE AP363-PS-BTCH-NBR        TO ASC-PS-BTCH-NBR.            07330000
073400     MOVE AP363-PS-PSTG-IND        TO ASC-PS-PSTG-IND.            07340000
073500     MOVE AP363-ENT-ID             TO ASC-ENT-ID.                 07350000
073600                                                                  07360000
073700     MOVE AP363-NW-STR-DISC-PCT    TO ASC-NW-STR-DISC-PCT.        07370000
073800     MOVE AP363-NW-STR-DISC-AMT    TO ASC-NW-STR-DISC-AMT.        07380000
073900     MOVE AP363-TRD-DISC-PCT       TO ASC-TRD-DISC-PCT.           07390000
074000     MOVE AP363-TRD-DISC-AMT       TO ASC-TRD-DISC-AMT.           07400000
074100     MOVE AP363-MOS-DISC-PCT       TO ASC-MOS-DISC-PCT.           07410000
074200     MOVE AP363-MOS-DISC-AMT       TO ASC-MOS-DISC-AMT.           07420000
074300     MOVE AP363-DOC-HLD-CDE        TO ASC-DOC-HLD-CDE.            07430000
074400     MOVE AP363-DIS-STR-NBR        TO ASC-DIS-STR-NBR.            07440000
074500     MOVE AP363-DIS-CL-NBR         TO ASC-DIS-CL-NBR.             07450000
074600     MOVE AP363-DIS-SKU-NBR        TO ASC-DIS-SKU-NBR.            07460000
074700     MOVE AP363-DIS-GRO-COST-AMT   TO ASC-DIS-GRO-COST-AMT.       07470000
074800     MOVE AP363-DIS-RTL-AMT        TO ASC-DIS-RTL-AMT.            07480000
074900                                                                  07490000
075000     MOVE AP363-DIS-NET-COST-AMT   TO ASC-DIS-NET-COST-AMT.       07500000
075100     MOVE AP363-MULT-DISTRO-IND    TO ASC-MULT-DISTRO-IND.        07510000
075200     MOVE AP363-DISTRB-SEQ-NBR     TO ASC-DIS-DISTRB-SEQ.         07520000
075300     MOVE AP363-SKU-ENTERED-SW     TO ASC-SKU-ENTERED-SW.         07530000
075400     MOVE AP363-ALLOCATION-SW      TO ASC-ALLOCATION-SW.          07540000
075500                                                                  07550000
075600     COMPUTE PV-DISC-AMT =                                        07560000
075700             (ASC-TERM-DISC-AMT +                                 07570000
075800              ASC-NW-STR-DISC-AMT +                               07580000
075900              ASC-TRD-DISC-AMT +                                  07590000
076000              ASC-MOS-DISC-AMT).                                  07600000
076100                                                                  07610000
076200     IF PV-DISC-AMT GREATER THAN ZERO                             07620000
076300        COMPUTE ASC-TOTAL-DISC-AMT =                              07630000
076400               (ASC-TERM-DISC-AMT +                               07640000
076500                ASC-NW-STR-DISC-AMT +                             07650000
076600                ASC-TRD-DISC-AMT +                                07660000
076700                ASC-MOS-DISC-AMT) + .005                          07670000
076800     ELSE                                                         07680000
076900        IF PV-DISC-AMT LESS THAN ZERO                             07690000
077000           COMPUTE ASC-TOTAL-DISC-AMT =                           07700000
077100                  (ASC-TERM-DISC-AMT +                            07710000
077200                   ASC-NW-STR-DISC-AMT +                          07720000
077300                   ASC-TRD-DISC-AMT +                             07730000
077400                   ASC-MOS-DISC-AMT) - .005                       07740000
077500        ELSE                                                      07750000
077600           MOVE ZERO TO ASC-TOTAL-DISC-AMT                        07760000
077700        END-IF                                                    07770000
077800     END-IF.                                                      07780000
077900 EJECT                                                            07790000
078000******************************************************************07800000
078100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07810000
078200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07820000
078300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07830000
078400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07840000
078500* FUNCTION KEYS CAN GET THIS FAR.                                *07850000
078600******************************************************************07860000
078700 2000-PROCESS-PANEL.                                              07870000
078800                                                                  07880000
078900     EVALUATE TRUE                                                07890000
079000         WHEN DP020-SRC-AID = DP016-CLEAR                         07900000
079100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07910000
079200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07920000
079300                                                                  07930000
079400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07940000
079500             PERFORM 2050-DELETE-LIST-QUEUE                       07950000
079600             PERFORM 4000-BUILD-INITIAL-PANEL                     07960000
079700                                                                  07970000
079800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07980000
079900             PERFORM 2140-DESELECT-ALL-ITEMS                      07990000
080000             PERFORM 3200-RESET-ATTRIBUTES                        08000000
080100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08010000
080200                                                                  08020000
080300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08030000
080400             PERFORM 2150-SELECT-ALL-ITEMS                        08040000
080500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08050000
080600                                                                  08060000
080700         WHEN OTHER                                               08070000
080800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08080000
080900             IF  PS-NO-ERROR                                      08090000
081000                 SET DP030-CONTINUE-GO                            08100000
081100                                 TO TRUE                          08110000
081200                 PERFORM 2100-CHECK-FUNCTION-KEY                  08120000
081300             ELSE                                                 08130000
081400                 SET DP030-OVERRIDE-GO                            08140000
081500                                 TO TRUE                          08150000
081600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08160000
081700             END-IF                                               08170000
081800     END-EVALUATE.                                                08180000
081900 EJECT                                                            08190000
082000******************************************************************08200000
082100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08210000
082200******************************************************************08220000
082300 2050-DELETE-LIST-QUEUE.                                          08230000
082400                                                                  08240000
082500     EXEC CICS                                                    08250000
082600         DELETEQ TS                                               08260000
082700             QUEUE (ASC-LIST-QUEUE-NAME)                          08270000
082800             RESP  (PV-CICS-RESP)                                 08280000
082900     END-EXEC.                                                    08290000
083000                                                                  08300000
083100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08310000
083200        (PV-CICS-RESP = DFHRESP(QIDERR))                          08320000
083300         CONTINUE                                                 08330000
083400     ELSE                                                         08340000
083500         SET DP013-CICS-ABEND      TO TRUE                        08350000
083600         SET DP013-NO-ROLLBACK     TO TRUE                        08360000
083700                                                                  08370000
083800         MOVE '2050-DELETE-LIST-QUEUE'                            08380000
083900                                   TO DP013-PARAGRAPH             08390000
084000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08400000
084100                                   TO DP013-MESSAGE-TEXT (1)      08410000
084200         PERFORM DP013-0000-PROCESS-ABEND                         08420000
084300     END-IF.                                                      08430000
084400                                                                  08440000
084500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08450000
084600 EJECT                                                            08460000
084700******************************************************************08470000
084800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08480000
084900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08490000
085000* CICS ARCHITECTURE API.                                         *08500000
085100******************************************************************08510000
085200 2100-CHECK-FUNCTION-KEY.                                         08520000
085300                                                                  08530000
085400     EVALUATE TRUE                                                08540000
085500         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  08550000
085600             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08560000
085700                 INITIALIZE AP361-INTER-APPL-COMMAREA             08570000
085800                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08580000
085900                                TO AP361-NUMBER-OF-SELECTED-ITEMS 08590000
086000             ELSE                                                 08600000
086100                 SET DP030-OVERRIDE-GO                            08610000
086200                                   TO TRUE                        08620000
086300                 MOVE PC-TSYMSG-00057                             08630000
086400                                   TO DP020-MSG-NUMBER            08640000
086500                 SET DP020-MSG-WARNING                            08650000
086600                                   TO TRUE                        08660000
086700             END-IF                                               08670000
086800                                                                  08680000
086900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08690000
087000             MOVE +1               TO PV-TOP-ITEM                 08700000
087100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08710000
087200                                                                  08720000
087300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08730000
087400             PERFORM 2110-BROWSE-BACKWARD                         08740000
087500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08750000
087600                                                                  08760000
087700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08770000
087800             PERFORM 2120-BROWSE-FORWARD                          08780000
087900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08790000
088000                                                                  08800000
088100         WHEN DP020-SRC-AID = DP016-ENTER                         08810000
088200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08820000
088300             IF  PS-ERROR                                         08830000
088400                 CONTINUE                                         08840000
088500             ELSE                                                 08850000
088600                 PERFORM 2105-WRITE-TSQ                           08860000
088700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08870000
088800             END-IF                                               08880000
088900                                                                  08890000
089000         WHEN OTHER                                               08900000
089100             SET DP013-NO-ROLLBACK                                08910000
089200                 DP013-XCTL-DISPLAY-RESTART                       08920000
089300                 DP013-CICS-ABEND  TO TRUE                        08930000
089400             MOVE '2100-CHECK-FUNCTION-KEY'                       08940000
089500                                   TO DP013-PARAGRAPH             08950000
089600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08960000
089700                                   TO DP013-MESSAGE-TEXT (1)      08970000
089800             PERFORM DP013-0000-PROCESS-ABEND                     08980000
089900     END-EVALUATE.                                                08990000
090000                                                                  09000000
090100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09010000
090200                                                                  09020000
090300******************************************************************09030000
090400*    THIS PARAGRAPH WILL WRITE NEWLY ENTERED LINES OF            *09040000
090500*    DISTRIBUTION TO THE TEMPORARY STORAGE QUEUE.                *09050000
090600******************************************************************09060000
090700 2105-WRITE-TSQ.                                                  09070000
090800                                                                  09080000
090900     MOVE +1                    TO ASC-BLK-SUB.                   09090000
091000                                                                  09100000
091100     PERFORM 5100-WRITE-TEMP-STORAGE.                             09110000
091200                                                                  09120000
091300     ADD +1                     TO ASC-BLK-SUB.                   09130000
091400                                                                  09140000
091500     PERFORM 5100-WRITE-TEMP-STORAGE.                             09150000
091600                                                                  09160000
091700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09170000
091800                                TO PV-LIST-ITEM-NUMBER.           09180000
091900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09190000
092000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09200000
092100                                                                  09210000
092200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09220000
092300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09230000
092400         MOVE +1                   TO PV-BLOCK-NUMBER             09240000
092500                                                                  09250000
092600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09260000
092700             PV-FIRST-BLOCK-IN-ARRAY - 1                          09270000
092800                                                                  09280000
092900         PERFORM                                                  09290000
093000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09300000
093100                                                                  09310000
093200             PERFORM 4410-READ-TEMP-STORAGE                       09320000
093300             PERFORM 5100-WRITE-TEMP-STORAGE                      09330000
093400                                                                  09340000
093500             ADD +1                TO PV-BLOCK-NUMBER             09350000
093600                                                                  09360000
093700         END-PERFORM                                              09370000
093800                                                                  09380000
093900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09390000
094000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09400000
094100         PERFORM                                                  09410000
094200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09420000
094300                   ASC-HIGHEST-BLOCK-WRITTEN                      09430000
094400                                                                  09440000
094500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09450000
094600                                   TO PV-BLOCK-NUMBER             09460000
094700                                                                  09470000
094800             PERFORM 4410-READ-TEMP-STORAGE                       09480000
094900                                                                  09490000
095000             PERFORM 5100-WRITE-TEMP-STORAGE                      09500000
095100                                                                  09510000
095200             ADD +1            TO PV-NEXT-BLOCK-IN-ARRAY          09520000
095300                                                                  09530000
095400         END-PERFORM                                              09540000
095500                                                                  09550000
095600         MOVE +1                   TO ASC-BLK-SUB                 09560000
095700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09570000
095800                                   TO PV-BLOCK-NUMBER             09580000
095900                                                                  09590000
096000         PERFORM 4410-READ-TEMP-STORAGE                           09600000
096100                                                                  09610000
096200         ADD +1                    TO PV-BLOCK-NUMBER             09620000
096300                                      ASC-BLK-SUB                 09630000
096400         PERFORM 4410-READ-TEMP-STORAGE                           09640000
096500     END-IF.                                                      09650000
096600                                                                  09660000
096700******************************************************************09670000
096800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09680000
096900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09690000
097000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09700000
097100*    MESSAGE.                                                    *09710000
097200******************************************************************09720000
097300 2110-BROWSE-BACKWARD.                                            09730000
097400                                                                  09740000
097500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09750000
097600         GIVING PV-TOP-ITEM.                                      09760000
097700                                                                  09770000
097800     IF  ((PV-TOP-ITEM < +1)                                      09780000
097900       OR (PV-TOP-ITEM = +1))                                     09790000
098000         MOVE +1                   TO PV-TOP-ITEM                 09800000
098100*        -- TOP OF LIST --                                        09810000
098200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09820000
098300         SET DP020-MSG-INFORMATIONAL TO TRUE                      09830000
098400     END-IF.                                                      09840000
098500                                                                  09850000
098600 EJECT                                                            09860000
098700*****************************************************************109870000
098800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09880000
098900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09890000
099000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09900000
099100******************************************************************09910000
099200 2120-BROWSE-FORWARD.                                             09920000
099300                                                                  09930000
099400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09940000
099500         GIVING PV-TOP-ITEM.                                      09950000
099600                                                                  09960000
099700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09970000
099800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09980000
099900                                   TO PV-TOP-ITEM                 09990000
100000*        -- BOTTOM OF LIST --                                     10000000
100100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10010000
100200         SET DP020-MSG-INFORMATIONAL                              10020000
100300                                   TO TRUE                        10030000
100400     ELSE                                                         10040000
100500         COMPUTE PV-BOTTOM-ITEM =                                 10050000
100600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10060000
100700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10070000
100800*            -- BOTTOM OF LIST --                                 10080000
100900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            10090000
101000             SET DP020-MSG-INFORMATIONAL                          10100000
101100                                   TO TRUE                        10110000
101200         END-IF                                                   10120000
101300     END-IF.                                                      10130000
101400 EJECT                                                            10140000
101500******************************************************************10150000
101600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *10160000
101700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *10170000
101800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *10180000
101900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10190000
102000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10200000
102100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10210000
102200******************************************************************10220000
102300 2130-CHECK-FOR-JUMP-BROWSE.                                      10230000
102400                                                                  10240000
102500     SET PS-NO-ERROR               TO TRUE.                       10250000
102600                                                                  10260000
102700     IF (ASC-START-ITEM-REQUEST = SPACE)                          10270000
102800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10280000
102900                                   TO PV-TOP-ITEM                 10290000
103000     ELSE                                                         10300000
103100         MOVE ASC-START-ITEM-REQUEST                              10310000
103200                                   TO DP010I-UNEDITED-FIELD       10320000
103300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       10330000
103400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10340000
103500         SET DP010I-NEGATIVE-NOT-ALLOWED                          10350000
103600                                   TO TRUE                        10360000
103710         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10371068
103720                         USING DP010I-NUMERIC-EDIT-AREA           10372068
103800                                                                  10380000
103900         IF  NOT DP010I-ERROR-DETECTED                            10390000
104000             MOVE DP010I-NUMERIC-FIELD                            10400000
104100                                   TO  ASC-START-ITEM-REQUEST-N   10410000
104200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10420000
104300                 IF  ASC-START-ITEM-REQUEST-N >                   10430000
104400                                          ASC-NUMBER-OF-ITEMS-READ10440000
104500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10450000
104600                     COMPUTE PV-TOP-ITEM =                        10460000
104700                             ASC-NUMBER-OF-ITEMS-READ             10470000
104800                             - PC-ITEMS-PER-PANEL + 1             10480000
104900                     IF  PV-TOP-ITEM < +1                         10490000
105000                         MOVE +1   TO PV-TOP-ITEM                 10500000
105100                         MOVE PC-TSYMSG-00070                     10510000
105200                                   TO DP020-MSG-NUMBER            10520000
105300                         SET DP020-MSG-INFORMATIONAL              10530000
105400                                   TO TRUE                        10540000
105500                     END-IF                                       10550000
105600                 ELSE                                             10560000
105700                     MOVE ASC-START-ITEM-REQUEST-N                10570000
105800                                   TO PV-TOP-ITEM                 10580000
105900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10590000
106000                     COMPUTE PV-BOTTOM-ITEM =                     10600000
106100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10610000
106200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10620000
106300*                        -- BOTTOM OF LIST --                     10630000
106400                         MOVE PC-TSYMSG-00070                     10640000
106500                                   TO DP020-MSG-NUMBER            10650000
106600                         SET DP020-MSG-INFORMATIONAL              10660000
106700                                   TO TRUE                        10670000
106800                     END-IF                                       10680000
106900                 END-IF                                           10690000
107000             ELSE                                                 10700000
107100*                --- VALUE OUT OF RANGE ----                      10710000
107200                 MOVE PC-TSYMSG-00101                             10720000
107300                                   TO DP020-MSG-NUMBER            10730000
107400                 MOVE -1           TO ASTRTITL                    10740000
107500                 SET DP030-SET-CURSOR-APPL-1                      10750000
107600                                   TO TRUE                        10760000
107700                 MOVE DP015-REVERSE                               10770000
107800                                   TO ASTRTITH                    10780000
107900                 MOVE DP015-RED    TO ASTRTITC                    10790000
108000                 MOVE DP015-UNP-NUM-BRT-MDT                       10800000
108100                                   TO ASTRTITA                    10810000
108200                 SET DP020-MSG-FATAL                              10820000
108300                                   TO TRUE                        10830000
108400                 SET PS-ERROR      TO TRUE                        10840000
108500             END-IF                                               10850000
108600                                                                  10860000
108700         ELSE                                                     10870000
108800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10880000
108900             MOVE -1               TO ASTRTITL                    10890000
109000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10900000
109100             MOVE DP015-REVERSE    TO ASTRTITH                    10910000
109200             MOVE DP015-RED        TO ASTRTITC                    10920000
109300             MOVE DP015-UNP-NUM-BRT-MDT                           10930000
109400                                   TO ASTRTITA                    10940000
109500             SET DP020-MSG-FATAL   TO TRUE                        10950000
109600             SET PS-ERROR          TO TRUE                        10960000
109700         END-IF                                                   10970000
109800     END-IF.                                                      10980000
109900 EJECT                                                            10990000
110000******************************************************************11000000
110100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *11010000
110200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *11020000
110300******************************************************************11030000
110400 2140-DESELECT-ALL-ITEMS.                                         11040000
110500                                                                  11050000
110600     MOVE +1                       TO ASC-BLK-SUB.                11060000
110700                                                                  11070000
110800     PERFORM 2141-CLEAR-SELECTED-INDS                             11080000
110900         VARYING ASC-ITEM-SUB                                     11090000
111000         FROM 1 BY 1                                              11100000
111100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11110000
111200                                                                  11120000
111300     ADD +1                        TO ASC-BLK-SUB.                11130000
111400                                                                  11140000
111500     PERFORM 2141-CLEAR-SELECTED-INDS                             11150000
111600         VARYING ASC-ITEM-SUB                                     11160000
111700         FROM 1 BY 1                                              11170000
111800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11180000
111900                                                                  11190000
112000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11200000
112100                                   TO PV-LIST-ITEM-NUMBER.        11210000
112200                                                                  11220000
112300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11230000
112400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11240000
112500                                                                  11250000
112600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11260000
112700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      11270000
112800         MOVE +1                   TO ASC-BLK-SUB                 11280000
112900                                                                  11290000
113000         PERFORM 5100-WRITE-TEMP-STORAGE                          11300000
113100                                                                  11310000
113200         MOVE +1                   TO PV-BLOCK-NUMBER             11320000
113300                                                                  11330000
113400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11340000
113500             PV-FIRST-BLOCK-IN-ARRAY - 1                          11350000
113600                                                                  11360000
113700         PERFORM                                                  11370000
113800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11380000
113900                                                                  11390000
114000             PERFORM 4410-READ-TEMP-STORAGE                       11400000
114100                                                                  11410000
114200             PERFORM 2141-CLEAR-SELECTED-INDS                     11420000
114300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11430000
114400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11440000
114500                                                                  11450000
114600             PERFORM 5100-WRITE-TEMP-STORAGE                      11460000
114700                                                                  11470000
114800             ADD +1                TO PV-BLOCK-NUMBER             11480000
114900                                                                  11490000
115000         END-PERFORM                                              11500000
115100                                                                  11510000
115200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11520000
115300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11530000
115400                                                                  11540000
115500         PERFORM                                                  11550000
115600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11560000
115700                   ASC-HIGHEST-BLOCK-WRITTEN                      11570000
115800                                                                  11580000
115900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11590000
116000                                   TO PV-BLOCK-NUMBER             11600000
116100                                                                  11610000
116200             PERFORM 4410-READ-TEMP-STORAGE                       11620000
116300                                                                  11630000
116400             PERFORM 2141-CLEAR-SELECTED-INDS                     11640000
116500                 VARYING ASC-ITEM-SUB                             11650000
116600                 FROM 1 BY 1                                      11660000
116700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11670000
116800                                                                  11680000
116900             PERFORM 5100-WRITE-TEMP-STORAGE                      11690000
117000                                                                  11700000
117100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11710000
117200                                                                  11720000
117300         END-PERFORM                                              11730000
117400                                                                  11740000
117500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11750000
117600                                   TO PV-BLOCK-NUMBER             11760000
117700                                                                  11770000
117800         PERFORM 4410-READ-TEMP-STORAGE                           11780000
117900     END-IF.                                                      11790000
118000                                                                  11800000
118100     MOVE +0                 TO ASC-NUMBER-OF-SELECTED-ITEMS      11810000
118200                                ASC-NUMBER-OF-DELETED-ITEMS       11820000
118300                                ASC-START-OF-SELECTED-RANGE       11830000
118400                                ASC-END-OF-SELECTED-RANGE.        11840000
118500                                                                  11850000
118600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11860000
118700                                                                  11870000
118800 EJECT                                                            11880000
118900******************************************************************11890000
119000*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11900000
119100******************************************************************11910000
119200 2141-CLEAR-SELECTED-INDS.                                        11920000
119300                                                                  11930000
119400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11940000
119500             NOT EQUAL ZERO                                       11950000
119600         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11960000
119700             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11970000
119800                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11980000
119900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11990000
120000                                   TO TRUE                        12000000
120100         END-IF                                                   12010000
120200     END-IF.                                                      12020000
120300                                                                  12030000
120400 EJECT                                                            12040000
120500******************************************************************12050000
120600*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *12060000
120700*  FOR ALL ITEMS.                                                *12070000
120800******************************************************************12080000
120900 2150-SELECT-ALL-ITEMS.                                           12090000
121000                                                                  12100000
121100     MOVE +1                       TO ASC-BLK-SUB.                12110000
121200                                                                  12120000
121300     PERFORM 2151-SET-SELECTED-INDS                               12130000
121400         VARYING ASC-ITEM-SUB                                     12140000
121500         FROM 1 BY 1                                              12150000
121600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12160000
121700                                                                  12170000
121800     ADD +1                        TO ASC-BLK-SUB.                12180000
121900                                                                  12190000
122000     PERFORM 2151-SET-SELECTED-INDS                               12200000
122100         VARYING ASC-ITEM-SUB                                     12210000
122200         FROM 1 BY 1                                              12220000
122300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12230000
122400                                                                  12240000
122500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12250000
122600                                   TO PV-LIST-ITEM-NUMBER.        12260000
122700                                                                  12270000
122800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12280000
122900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12290000
123000                                                                  12300000
123100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12310000
123200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    12320000
123300         MOVE +1                   TO ASC-BLK-SUB                 12330000
123400                                                                  12340000
123500         PERFORM 5100-WRITE-TEMP-STORAGE                          12350000
123600                                                                  12360000
123700         MOVE +1                   TO PV-BLOCK-NUMBER             12370000
123800                                                                  12380000
123900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12390000
124000             PV-FIRST-BLOCK-IN-ARRAY - 1                          12400000
124100                                                                  12410000
124200         PERFORM                                                  12420000
124300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12430000
124400                                                                  12440000
124500             PERFORM 4410-READ-TEMP-STORAGE                       12450000
124600                                                                  12460000
124700             PERFORM 2151-SET-SELECTED-INDS                       12470000
124800                 VARYING ASC-ITEM-SUB                             12480000
124900                 FROM 1 BY 1                                      12490000
125000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12500000
125100                                                                  12510000
125200             PERFORM 5100-WRITE-TEMP-STORAGE                      12520000
125300                                                                  12530000
125400             ADD +1                TO PV-BLOCK-NUMBER             12540000
125500                                                                  12550000
125600         END-PERFORM                                              12560000
125700                                                                  12570000
125800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12580000
125900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12590000
126000                                                                  12600000
126100         PERFORM                                                  12610000
126200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12620000
126300                   ASC-HIGHEST-BLOCK-WRITTEN                      12630000
126400                                                                  12640000
126500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12650000
126600                                   TO PV-BLOCK-NUMBER             12660000
126700                                                                  12670000
126800             PERFORM 4410-READ-TEMP-STORAGE                       12680000
126900                                                                  12690000
127000             PERFORM 2151-SET-SELECTED-INDS                       12700000
127100                 VARYING ASC-ITEM-SUB                             12710000
127200                 FROM 1 BY 1                                      12720000
127300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12730000
127400                                                                  12740000
127500             PERFORM 5100-WRITE-TEMP-STORAGE                      12750000
127600                                                                  12760000
127700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12770000
127800                                                                  12780000
127900         END-PERFORM                                              12790000
128000                                                                  12800000
128100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12810000
128200                                   TO PV-BLOCK-NUMBER             12820000
128300                                                                  12830000
128400         PERFORM 4410-READ-TEMP-STORAGE                           12840000
128500     END-IF.                                                      12850000
128600                                                                  12860000
128700     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12870000
128800                       ASC-NUMBER-OF-SELECTED-ITEMS.              12880000
128900                                                                  12890000
129000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12900000
129100                                                                  12910000
129200 EJECT                                                            12920000
129300******************************************************************12930000
129400*    MARK EACH ITEM AS BEING SELECTED.                           *12940000
129500******************************************************************12950000
129600 2151-SET-SELECTED-INDS.                                          12960000
129700                                                                  12970000
129800     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12980000
129900             NOT EQUAL ZERO                                       12990000
130000         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13000000
130100             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13010000
130200                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        13020000
130300                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13030000
130400                               TO  TRUE                           13040000
130500         END-IF                                                   13050000
130600     END-IF.                                                      13060000
130700                                                                  13070000
130800******************************************************************13080000
130900* MOVE ALL OF THE FIELDS THAT WERE ENTERED ON THE SCREEN INTO    *13090000
131000* THE COMMAREA.                                                  *13100000
131100******************************************************************13110000
131200 2200-MOVE-SCREEN-TO-COMMAREA.                                    13120000
131300                                                                  13130000
131400     IF ASTRTITL > ZERO                                           13140000
131500        MOVE ASTRTITI           TO ASC-START-ITEM-REQUEST         13150000
131600     ELSE                                                         13160000
131700        IF ASTRTITF = DP015-ERASE-EOF                             13170000
131800           INITIALIZE ASC-START-ITEM-REQUEST                      13180000
131900        END-IF                                                    13190000
132000     END-IF.                                                      13200000
132100                                                                  13210000
132200*----------------------------------------------------------------*13220000
132300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13230000
132400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13240000
132500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13250000
132600*                                                                *13260000
132700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13270000
132800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13280000
132900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13290000
133000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13300000
133100*----------------------------------------------------------------*13310000
133200 3100-SET-SUBSCRIPTS.                                             13320000
133300                                                                  13330000
133400     COMPUTE ASC-ITEM-SUB =                                       13340000
133500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13350000
133600                                                                  13360000
133700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13370000
133800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13380000
133900                                                                  13390000
134000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13400000
134100     ELSE                                                         13410000
134200         MOVE +1                     TO ASC-BLK-SUB               13420000
134300     END-IF.                                                      13430000
134400                                                                  13440000
134500******************************************************************13450000
134600** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13460000
134700******************************************************************13470000
134800 3200-RESET-ATTRIBUTES.                                           13480000
134900                                                                  13490000
135000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13500000
135100     MOVE DP015-GREEN              TO ASTRTITC.                   13510000
135200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13520000
135300                                                                  13530000
135400     MOVE DP015-UNP-ALP-NOR-OFF    TO AHDCSTA.                    13540000
135500     MOVE DP015-GREEN              TO AHDCSTC.                    13550000
135600     MOVE DP015-UNDERLINE          TO AHDCSTH.                    13560000
135700                                                                  13570000
135800     MOVE DP015-UNP-ALP-NOR-OFF    TO AHDRETA.                    13580000
135900     MOVE DP015-GREEN              TO AHDRETC.                    13590000
136000     MOVE DP015-UNDERLINE          TO AHDRETH.                    13600000
136100                                                                  13610000
136200     PERFORM                                                      13620000
136300         VARYING PV-SUB                                           13630000
136400         FROM 1 BY 1                                              13640000
136500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13650000
136600         MOVE DP015-UNP-ALP-NOR-OFF                               13660000
136700                                   TO MR-STOREA  (PV-SUB)         13670000
136800                                      MR-CLASSA  (PV-SUB)         13680000
136900                                      MR-SKUA    (PV-SUB)         13690000
137000                                      MR-GROSSA  (PV-SUB)         13700000
137100                                      MR-RETAILA (PV-SUB)         13710000
137200         MOVE DP015-GREEN          TO MR-STOREC  (PV-SUB)         13720000
137300                                      MR-CLASSC  (PV-SUB)         13730000
137400                                      MR-SKUC    (PV-SUB)         13740000
137500                                      MR-GROSSC  (PV-SUB)         13750000
137600                                      MR-RETAILC (PV-SUB)         13760000
137700         MOVE DP015-UNDERLINE      TO MR-STOREH  (PV-SUB)         13770000
137800                                      MR-CLASSH  (PV-SUB)         13780000
137900                                      MR-SKUH    (PV-SUB)         13790000
138000                                      MR-GROSSH  (PV-SUB)         13800000
138100                                      MR-RETAILH (PV-SUB)         13810000
138200     END-PERFORM.                                                 13820000
138300                                                                  13830000
138400*----------------------------------------------------------------*13840000
138500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *13850000
138600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *13860000
138700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *13870000
138800*    DISPLAY THE PANEL TO USER.                                  *13880000
138900*----------------------------------------------------------------*13890000
139000 4000-BUILD-INITIAL-PANEL.                                        13900000
139100                                                                  13910000
139200     INITIALIZE    ASC-BLOCK-ENTRIES (1)                          13920000
139300                   ASC-BLOCK-ENTRIES (2)                          13930000
139400                   DCLTADJDIS.                                    13940000
139500                                                                  13950000
139600     MOVE +1                   TO ASC-BLK-SUB.                    13960000
139700     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           13970000
139800     MOVE +0                 TO ASC-ITEM-SUB                      13980000
139900                                ASC-NUMBER-OF-ITEMS-READ          13990000
140000                                ASC-NUMBER-OF-SELECTED-ITEMS      14000000
140100                                ASC-NUMBER-OF-DELETED-ITEMS       14010000
140200                                ASC-HIGHEST-BLOCK-WRITTEN         14020000
140300                                ASC-START-OF-SELECTED-RANGE       14030000
140400                                ASC-END-OF-SELECTED-RANGE         14040000
140500                                ASC-ITEM-AT-TOP-OF-PANEL.         14050000
140600                                                                  14060000
140700     PERFORM 4010-OPEN-CURSOR.                                    14070000
140800     PERFORM 4300-READ-ITEMS-FROM-DB.                             14080000
140900     PERFORM 4020-CLOSE-CURSOR.                                   14090000
141000     PERFORM 4025-FILL-INITIAL-DIST.                              14100000
141100                                                                  14110000
141200     MOVE +1                      TO PV-TOP-ITEM.                 14120000
141300     SET DP030-SET-CURSOR-APPL-1  TO TRUE.                        14130000
141400                                                                  14140000
141500     IF PS-NO-ERROR                                               14150000
141600        MOVE -1 TO ASTRTITL                                       14160000
141700     END-IF.                                                      14170000
141800                                                                  14180000
141900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        14190000
142000 EJECT                                                            14200000
142100*----------------------------------------------------------------*14210000
142200* OPEN THE ADJUSTMENT CURSOR.                                    *14220000
142300*   IN THIS PARTICULAR APPLICATION ONE OF 10 DIFFERENT CURSORS   *14230000
142400*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *14240000
142500*   USER.                                                        *14250000
142600*----------------------------------------------------------------*14260000
142700 4010-OPEN-CURSOR.                                                14270000
142800                                                                  14280000
142900     EXEC SQL                                                     14290000
143000         OPEN DISTRO-CSR                                          14300000
143100     END-EXEC.                                                    14310000
143200                                                                  14320000
143300     EVALUATE TRUE                                                14330000
143400         WHEN SQLCODE = +0                                        14340000
143500             CONTINUE                                             14350000
143600         WHEN OTHER                                               14360000
143700              MOVE '4010-OPEN-CURSOR'                             14370000
143800                               TO DP013-PARAGRAPH                 14380000
143900              MOVE 'OPEN INVOICE-ITEM-CSR'                        14390000
144000                               TO DP013-MESSAGE-TEXT (1)          14400000
144100              MOVE SQLCA           TO DP013-SQLCA                 14410000
144200              SET DP013-DB2-ABEND                                 14420000
144300                               TO TRUE                            14430000
144400              PERFORM DP013-0000-PROCESS-ABEND                    14440000
144500     END-EVALUATE.                                                14450000
144600                                                                  14460000
144700 EJECT                                                            14470000
144800*----------------------------------------------------------------*14480000
144900* CLOSE THE ADJUSTMENT CURSOR.                                   *14490000
145000*----------------------------------------------------------------*14500000
145100 4020-CLOSE-CURSOR.                                               14510000
145200                                                                  14520000
145300     EXEC SQL                                                     14530000
145400         CLOSE DISTRO-CSR                                         14540000
145500     END-EXEC.                                                    14550000
145600                                                                  14560000
145700     EVALUATE TRUE                                                14570000
145800         WHEN SQLCODE = ZERO                                      14580000
145900             CONTINUE                                             14590000
146000         WHEN SQLWARN0 NOT = SPACES                               14600000
146100         WHEN SQLCODE < ZERO                                      14610000
146200         WHEN SQLCODE > ZERO                                      14620000
146300             MOVE '4020-CLOSE-CURSOR'                             14630000
146400                               TO DP013-PARAGRAPH                 14640000
146500             MOVE 'CLOSE ADJUSTMENT CURSOR '                      14650000
146600                               TO DP013-MESSAGE-TEXT (1)          14660000
146700             MOVE SQLCA        TO DP013-SQLCA                     14670000
146800             MOVE 'TADJDIS '   TO DP013-DB2-TABLE-NAME (1)        14680000
146900             SET DP013-DB2-ABEND                                  14690000
147000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               14700000
147100             PERFORM DP013-0000-PROCESS-ABEND                     14710000
147200     END-EVALUATE.                                                14720000
147300                                                                  14730000
147400 EJECT                                                            14740000
147500******************************************************************14750000
147600* THIS PARAGRAPH WILL FILL THE INITIAL DISTRIBUTION LINE.        *14760000
147700******************************************************************14770000
147800 4025-FILL-INITIAL-DIST.                                          14780000
147900                                                                  14790000
148000     MOVE ASC-DIS-STR-NBR      TO ASC-STORE     (1 1).            14800000
148100     MOVE ASC-STORE (1 1)      TO ASC-ALP-STORE (1 1).            14810000
148200     MOVE ASC-DIS-CL-NBR       TO ASC-CLASS     (1 1).            14820000
148300     MOVE ASC-DIS-SKU-NBR      TO ASC-SKU       (1 1).            14830000
148400     MOVE ASC-DIS-GRO-COST-AMT TO ASC-GROSS-COST  (1 1).          14840000
148500     MOVE ASC-DIS-RTL-AMT      TO ASC-RETAIL-AMT   (1 1).         14850000
148600     MOVE ASC-DIS-NET-COST-AMT TO ASC-NET-COST   (1 1).           14860000
148700                                                                  14870000
148800*----------------------------------------------------------------*14880000
148900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *14890000
149000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *14900000
149100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *14910000
149200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *14920000
149300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *14930000
149400*                                                                *14940000
149500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *14950000
149600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *14960000
149700*    UPON INITIALIZATION.                                        *14970000
149800*----------------------------------------------------------------*14980000
149900 4300-READ-ITEMS-FROM-DB.                                         14990000
150000                                                                  15000000
150100     PERFORM                                                      15010000
150200         VARYING PV-READ-COUNT                                    15020000
150300         FROM 1 BY 1                                              15030000
150400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15040000
150500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         15050000
150600                                                                  15060000
150700         PERFORM 4310-FETCH                                       15070000
150800                                                                  15080000
150900         IF  ASC-ITEMS-LEFT-ON-DB                                 15090000
151000             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                15100000
151100                 ADD +1            TO ASC-ITEM-SUB                15110000
151200             ELSE                                                 15120000
151300                 ADD +1            TO ASC-BLK-SUB                 15130000
151400                 MOVE +1           TO ASC-ITEM-SUB                15140000
151500                                                                  15150000
151600                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         15160000
151700                     MOVE +1       TO ASC-BLK-SUB                 15170000
151800                     SET ASC-BLOCK-MODIFIED (1)                   15180000
151900                                   TO TRUE                        15190000
152000                     PERFORM 5100-WRITE-TEMP-STORAGE              15200000
152100                     MOVE ASC-BLOCK-ENTRIES                       15210000
152200                               (PC-MAX-BLOCKS-IN-ARRAY)           15220000
152300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 15230000
152400                     ADD +1        TO ASC-BLK-SUB                 15240000
152500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   15250000
152600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      15260000
152700                                   TO TRUE                        15270000
152800                 END-IF                                           15280000
152900             END-IF                                               15290000
153000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    15300000
153100             MOVE ASC-NUMBER-OF-ITEMS-READ                        15310000
153200                                   TO ASC-LIST-ITEM-NUMBER        15320000
153300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15330000
153400             MOVE ADJDIS-DISTRB-SEQ-NBR                           15340000
153500                                   TO ASC-DISTRB-SEQ-NBR          15350000
153600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15360000
153700             MOVE ADJDIS-STR-NBR   TO ASC-STORE                   15370000
153800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15380000
153900                                      ASC-ALP-STORE               15390000
154000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15400000
154100             MOVE ADJDIS-DEPT-NBR  TO ASC-DEPT-NBR                15410000
154200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15420000
154300             MOVE ADJDIS-CL-NBR    TO ASC-CLASS                   15430000
154400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15440000
154500             MOVE ADJDIS-SKU-NBR   TO ASC-SKU                     15450000
154600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15460000
154700             IF ASC-FREIGHT-COST-ALLOCATION                       15470000
154800                IF ADJDIS-FRGT-AMT NOT EQUAL ZERO                 15480000
154900                   MOVE ADJDIS-FRGT-AMT TO ASC-GROSS-COST         15490000
155000                                        (ASC-BLK-SUB ASC-ITEM-SUB)15500000
155100                ELSE                                              15510000
155200                   MOVE ZERO             TO ASC-GROSS-COST        15520000
155300                                        (ASC-BLK-SUB ASC-ITEM-SUB)15530000
155400                END-IF                                            15540000
155500             ELSE                                                 15550000
155600                IF ADJDIS-GRO-COST-AMT NOT EQUAL ZERO             15560000
155700                   MOVE ADJDIS-GRO-COST-AMT TO ASC-GROSS-COST     15570000
155800                                        (ASC-BLK-SUB ASC-ITEM-SUB)15580000
155900                ELSE                                              15590000
156000                   MOVE ZERO             TO ASC-GROSS-COST        15600000
156100                                        (ASC-BLK-SUB ASC-ITEM-SUB)15610000
156200                END-IF                                            15620000
156300             END-IF                                               15630000
156400             MOVE ADJDIS-FRGT-AMT     TO ASC-DT-FRGT-AMT          15640000
156500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15650000
156600             IF ADJDIS-RTL-AMT NOT EQUAL ZERO                     15660000
156700                MOVE ADJDIS-RTL-AMT   TO ASC-RETAIL-AMT           15670000
156800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15680000
156900             ELSE                                                 15690000
157000                MOVE ZERO             TO ASC-RETAIL-AMT           15700000
157100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15710000
157200             END-IF                                               15720000
157300             MOVE ADJDIS-MISC-CHRG-AMT                            15730000
157400                                   TO ASC-DT-MISC-CHRG-AMT        15740000
157500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15750000
157600             MOVE ADJDIS-DISC-AMT  TO ASC-DISC-AMT                15760000
157700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15770000
157800             MOVE ADJDIS-NET-COST-AMT TO PV-10V99                 15780000
157900             MOVE PV-10V99            TO ASC-NET-COST             15790000
158000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15800000
158100         END-IF                                                   15810000
158200     END-PERFORM.                                                 15820000
158300                                                                  15830000
158400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          15840000
158500         MOVE +1               TO ASC-BLK-SUB                     15850000
158600         PERFORM 5100-WRITE-TEMP-STORAGE                          15860000
158700         ADD +1                TO ASC-BLK-SUB                     15870000
158800         PERFORM 5100-WRITE-TEMP-STORAGE                          15880000
158900                                                                  15890000
159000         MOVE 1                TO ASC-BLK-SUB                     15900000
159100                                  PV-BLOCK-NUMBER                 15910000
159200         PERFORM 4410-READ-TEMP-STORAGE                           15920000
159300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             15930000
159400             MOVE 2            TO ASC-BLK-SUB                     15940000
159500                                  PV-BLOCK-NUMBER                 15950000
159600             PERFORM 4410-READ-TEMP-STORAGE                       15960000
159700         END-IF                                                   15970000
159800     END-IF.                                                      15980000
159900 EJECT                                                            15990000
160000*----------------------------------------------------------------*16000000
160100*    FETCH THE ADJUSTMENT DISTRIBUTION CURSOR.                   *16010000
160200*----------------------------------------------------------------*16020000
160300 4310-FETCH.                                                      16030000
160400                                                                  16040000
160500     EXEC SQL                                                     16050000
160600          FETCH DISTRO-CSR                                        16060000
160700          INTO  :ADJDIS-VND-NBR                                   16070000
160800              , :ADJDIS-DOC-NBR                                   16080000
160900              , :ADJDIS-DOC-DTE                                   16090000
161000              , :ADJDIS-AP-TRN-CDE                                16100000
161100              , :ADJDIS-DISTRB-SEQ-NBR                            16110000
161200              , :ADJDIS-STR-NBR                                   16120000
161300              , :ADJDIS-DEPT-NBR                                  16130000
161400              , :ADJDIS-CL-NBR                                    16140000
161500              , :ADJDIS-SKU-NBR                                   16150000
161600              , :ADJDIS-GRO-COST-AMT                              16160000
161700              , :ADJDIS-RTL-AMT                                   16170000
161800              , :ADJDIS-FRGT-AMT                                  16180000
161900              , :ADJDIS-MISC-CHRG-AMT                             16190000
162000              , :ADJDIS-DISC-AMT                                  16200000
162100              , :ADJDIS-NET-COST-AMT                              16210000
162200     END-EXEC.                                                    16220000
162300                                                                  16230000
162400     EVALUATE TRUE                                                16240000
162500         WHEN SQLCODE = ZERO                                      16250000
162600         WHEN SQLCODE = +100                                      16260000
162700              CONTINUE                                            16270000
162800         WHEN SQLWARN0 NOT = SPACE                                16280000
162900         WHEN SQLCODE NOT = ZERO                                  16290000
163000              MOVE '4310-FETCH-CURSOR'                            16300000
163100                               TO DP013-PARAGRAPH                 16310000
163200              MOVE 'FETCH ADJUSTMENT CURSOR'                      16320000
163300                               TO DP013-MESSAGE-TEXT (1)          16330000
163400              MOVE SQLCA       TO DP013-SQLCA                     16340000
163500              SET DP013-DB2-ABEND                                 16350000
163600                               TO TRUE                            16360000
163700              PERFORM DP013-0000-PROCESS-ABEND                    16370000
163800     END-EVALUATE.                                                16380000
163900                                                                  16390000
164000     IF  SQLCODE EQUAL +100                                       16400000
164100         SET ASC-NO-ITEMS-LEFT-ON-DB                              16410000
164200                                   TO TRUE                        16420000
164300     END-IF.                                                      16430000
164400                                                                  16440000
164500 EJECT                                                            16450000
164600*----------------------------------------------------------------*16460000
164700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *16470000
164800*----------------------------------------------------------------*16480000
164900 4400-MOVE-COMMAREA-TO-SCREEN.                                    16490000
165000                                                                  16500000
165100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             16510000
165200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          16520000
165300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          16530000
165400             MOVE +1    TO ASC-BLK-SUB                            16540000
165500             PERFORM 5100-WRITE-TEMP-STORAGE                      16550000
165600             ADD +1     TO ASC-BLK-SUB                            16560000
165700             PERFORM 5100-WRITE-TEMP-STORAGE                      16570000
165800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             16580000
165900                 GIVING PV-BLOCK-NUMBER                           16590000
166000                 REMAINDER PV-REMAINDER                           16600000
166100             IF  PV-REMAINDER > ZERO                              16610000
166200                 ADD +1 TO PV-BLOCK-NUMBER                        16620000
166300             END-IF                                               16630000
166400             MOVE +1    TO ASC-BLK-SUB                            16640000
166500             PERFORM 4410-READ-TEMP-STORAGE                       16650000
166600             ADD +1     TO ASC-BLK-SUB                            16660000
166700                           PV-BLOCK-NUMBER                        16670000
166800             PERFORM 4410-READ-TEMP-STORAGE                       16680000
166900     END-IF.                                                      16690000
167000                                                                  16700000
167100     MOVE +1            TO ASC-BLK-SUB.                           16710000
167200                                                                  16720000
167300     COMPUTE ASC-ITEM-SUB =                                       16730000
167400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              16740000
167500         + PC-ITEMS-PER-PANEL).                                   16750000
167600                                                                  16760000
167700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        16770000
167800         ADD +1         TO ASC-BLK-SUB                            16780000
167900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16790000
168000     END-IF.                                                      16800000
168100                                                                  16810000
168200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           16820000
168300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                16830000
168400                                                                  16840000
168500     PERFORM 4420-FORMAT-LIST-LINES                               16850000
168600         VARYING PV-SUB                                           16860000
168700         FROM PC-ITEMS-PER-PANEL BY -1                            16870000
168800         UNTIL PV-SUB < +1.                                       16880000
168900                                                                  16890000
169000     COMPUTE ASC-ITEMS-DISPLAYED =                                16900000
169100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          16910000
169200                                                                  16920000
169300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    16930000
169400                                      ASTRTITO.                   16940000
169500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    16950000
169600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    16960000
169700                                                                  16970000
170700     MOVE ASC-HD-STORE             TO AHDSTRO.                    17070000
170800     MOVE ASC-DOC-NBR              TO ADOCNUMO.                   17080000
170900     MOVE ASC-PO-NBR               TO APONUMO.                    17090000
171000     MOVE ASC-DEPT                 TO ADEPTO.                     17100000
171100     MOVE ASC-ACCOUNT              TO AACCNOO.                    17110000
171200     MOVE ASC-VND-NBR              TO AVNDNOO.                    17120000
171300     MOVE ASC-VND-NAME             TO AVNDNMO.                    17130000
171400                                                                  17140000
171500     IF ASC-ALP-HD-FRGT-AMT(2:12) NUMERIC                         17150000
171600        IF ASC-HD-FRGT-AMT = +0                                   17160000
171700           MOVE SPACES             TO AHDFRGTO                    17170000
171800                                      ASC-ALP-HD-FRGT-AMT         17180000
171900        ELSE                                                      17190000
172000           MOVE ASC-HD-FRGT-AMT    TO PV-10V99                    17200000
172100           MOVE PV-10V99           TO AHDFRGTO                    17210000
172200                                      ASC-ALP-HD-FRGT-AMT         17220000
172300        END-IF                                                    17230000
172400     ELSE                                                         17240000
172500        MOVE ASC-ALP-HD-FRGT-AMT   TO AHDFRGTO                    17250000
172600     END-IF.                                                      17260000
172700                                                                  17270000
172800     IF ASC-ALP-HD-GRO-COST(2:12) NUMERIC                         17280000
172900        IF ASC-HD-GRO-COST = +0                                   17290000
173000           MOVE SPACES             TO AHDCSTO                     17300000
173100                                      ASC-ALP-HD-GRO-COST         17310000
173200        ELSE                                                      17320000
173300           MOVE ASC-HD-GRO-COST    TO PV-10V99                    17330000
173400           MOVE PV-10V99           TO AHDCSTO                     17340000
173500                                      ASC-ALP-HD-GRO-COST         17350000
173600        END-IF                                                    17360000
173700     ELSE                                                         17370000
173800        MOVE ASC-ALP-HD-GRO-COST   TO AHDCSTO                     17380000
173900     END-IF.                                                      17390000
174000                                                                  17400000
174100     IF ASC-ALP-HD-RET-AMT(2:12) NUMERIC                          17410000
174200        IF ASC-HD-RET-AMT = +0                                    17420000
174300           MOVE SPACES             TO AHDRETO                     17430000
174400                                      ASC-ALP-HD-RET-AMT          17440000
174500        ELSE                                                      17450000
174600           MOVE ASC-HD-RET-AMT     TO PV-10V99                    17460000
174700           MOVE PV-10V99           TO AHDRETO                     17470000
174800                                      ASC-ALP-HD-RET-AMT          17480000
174900        END-IF                                                    17490000
175000     ELSE                                                         17500000
175100        MOVE ASC-ALP-HD-RET-AMT    TO AHDRETO                     17510000
175200     END-IF.                                                      17520000
175300                                                                  17530000
175400     IF  DP020-MSG-NUMBER-X = SPACE                               17540000
175500         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17550000
175600*            --- MORE ITEMS TO DISPLAY ----                       17560000
175700             MOVE PC-TSYMSG-00279 TO DP020-MSG-NUMBER             17570000
175800             SET DP020-MSG-INFORMATIONAL TO TRUE                  17580000
175900         END-IF                                                   17590000
176000     END-IF.                                                      17600000
176100                                                                  17610000
176200*----------------------------------------------------------------*17620000
176300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17630000
176400*----------------------------------------------------------------*17640000
176500 4410-READ-TEMP-STORAGE.                                          17650000
176600                                                                  17660000
176700     EXEC CICS                                                    17670000
176800         READQ TS                                                 17680000
176900             QUEUE (ASC-LIST-QUEUE-NAME)                          17690000
177000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17700000
177100             ITEM  (PV-BLOCK-NUMBER)                              17710000
177200             RESP  (PV-CICS-RESP)                                 17720000
177300     END-EXEC.                                                    17730000
177400                                                                  17740000
177500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17750000
177600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17760000
177700         CONTINUE                                                 17770000
177800     ELSE                                                         17780000
177900         SET DP013-CICS-ABEND     TO TRUE                         17790000
178000         SET DP013-NO-ROLLBACK    TO TRUE                         17800000
178100         MOVE '4410-READ-TEMP-STORAGE'                            17810000
178200                                  TO DP013-PARAGRAPH              17820000
178300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17830000
178400                                  TO DP013-MESSAGE-TEXT(1)        17840000
178500         PERFORM DP013-0000-PROCESS-ABEND                         17850000
178600     END-IF.                                                      17860000
178700                                                                  17870000
178800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17880000
178900                                                                  17890000
179000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17900000
179100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17910000
179200     END-IF.                                                      17920000
179300 EJECT                                                            17930000
179400*----------------------------------------------------------------*17940000
179500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17950000
179600*----------------------------------------------------------------*17960000
179700 4420-FORMAT-LIST-LINES.                                          17970000
179800                                                                  17980000
179900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      17990000
180000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                18000000
180100         MOVE SPACE              TO MR-STORE   (PV-SUB)           18010000
180200                                    MR-CLASS  (PV-SUB)            18020000
180300                                    MR-SKU    (PV-SUB)            18030000
180400                                    MR-GROSS  (PV-SUB)            18040000
180500                                    MR-RETAIL (PV-SUB)            18050000
180600                                    MR-NET    (PV-SUB)            18060000
180700     ELSE                                                         18070000
180800         IF ASC-ALP-STORE  (ASC-BLK-SUB ASC-ITEM-SUB) NUMERIC     18080000
180900            MOVE ASC-STORE (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-NUM4  18090000
181000            MOVE PV-NUM4-X    TO MR-STORE      (PV-SUB)           18100000
181100         ELSE                                                     18110000
181200            MOVE ASC-ALP-STORE (ASC-BLK-SUB ASC-ITEM-SUB)         18120000
181300                              TO MR-STORE      (PV-SUB)           18130000
181400         END-IF                                                   18140000
181500                                                                  18150000
181600         MOVE ASC-CLASS  (ASC-BLK-SUB ASC-ITEM-SUB)               18160000
181700                             TO MR-CLASS       (PV-SUB)           18170000
181800                                                                  18180000
181900         IF ASC-SKU  (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL ZERO        18190000
182000            MOVE SPACES       TO MR-SKU  (PV-SUB)                 18200000
182100         ELSE                                                     18210000
182200            INITIALIZE PV-NUM8                                    18220000
182300            MOVE ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-NUM8    18230000
182400            MOVE PV-NUM8-X    TO MR-SKU  (PV-SUB)                 18240000
182500         END-IF                                                   18250000
182600                                                                  18260000
182700         IF ASC-GROSS-COST (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL ZERO  18270000
182800            MOVE SPACES      TO MR-GROSS    (PV-SUB)              18280000
182900         ELSE                                                     18290000
183000            INITIALIZE PV-10V99                                   18300000
183100            MOVE ASC-GROSS-COST (ASC-BLK-SUB ASC-ITEM-SUB)        18310000
183200                                 TO PV-10V99                      18320000
183300            MOVE PV-10V99    TO  MR-GROSS   (PV-SUB)              18330000
183400         END-IF                                                   18340000
183500                                                                  18350000
183600         IF ASC-RETAIL-AMT (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL ZERO  18360000
183700            MOVE SPACES      TO MR-RETAIL     (PV-SUB)            18370000
183800         ELSE                                                     18380000
183900            INITIALIZE PV-10V99                                   18390000
184000            MOVE ASC-RETAIL-AMT (ASC-BLK-SUB ASC-ITEM-SUB)        18400000
184100                                 TO PV-10V99                      18410000
184200            MOVE PV-10V99    TO MR-RETAIL     (PV-SUB)            18420000
184300         END-IF                                                   18430000
184400                                                                  18440000
184500         IF ASC-NET-COST (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL ZERO    18450000
184600            MOVE SPACES   TO MR-NET             (PV-SUB)          18460000
184700         ELSE                                                     18470000
184800            INITIALIZE PV-10V99                                   18480000
184900            MOVE ASC-NET-COST (ASC-BLK-SUB ASC-ITEM-SUB) TO       18490000
185000                               PV-10V99                           18500000
185100            MOVE PV-10V99 TO MR-NET             (PV-SUB)          18510000
185200         END-IF                                                   18520000
185300     END-IF.                                                      18530000
185400                                                                  18540000
185500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18550000
185600                                                                  18560000
185700     IF  ASC-ITEM-SUB < + 1                                       18570000
185800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  18580000
185900         MOVE +1                 TO ASC-BLK-SUB                   18590000
186000     END-IF.                                                      18600000
186100                                                                  18610000
186200*----------------------------------------------------------------*18620000
186300* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *18630000
186400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *18640000
186500* FOR THE SELECTED ITEMS QUEUE.                                  *18650000
186600*                                                                *18660000
186700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *18670000
186800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *18680000
186900* THE ARRAY IS FULL.                                             *18690000
187000*----------------------------------------------------------------*18700000
187100 5000-PREPARE-SEL-QUEUE.                                          18710000
187200                                                                  18720000
187300     MOVE +1                   TO  ASC-BLK-SUB.                   18730000
187400     PERFORM 5100-WRITE-TEMP-STORAGE.                             18740000
187500                                                                  18750000
187600     ADD +1                    TO  ASC-BLK-SUB.                   18760000
187700     PERFORM 5100-WRITE-TEMP-STORAGE.                             18770000
187800                                                                  18780000
187900     MOVE ASC-SEL-QUEUE-NAME   TO  AP361-SEL-QUEUE-NAME.          18790000
188000     PERFORM 6010-DELETE-SEL-QUEUE.                               18800000
188100                                                                  18810000
188200     SET ASC-UPDATE-TSQ        TO  TRUE.                          18820000
188300                                                                  18830000
188400     SET AP362-IDX             TO  1.                             18840000
188500     MOVE ZERO                 TO AP361-NUMBER-OF-TS-ITEMS.       18850000
188600     INITIALIZE AP362-SELECTED-ITEM-ARRAY.                        18860000
188700                                                                  18870000
188800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           18880000
188900             VARYING PV-ITEM                                      18890000
189000             FROM 1 BY 1                                          18900000
189100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     18910000
189200                                                                  18920000
189300     IF  AP362-IDX > 1                                            18930000
189400         PERFORM 5205-WRITE-SEL-QUEUE                             18940000
189500         ADD +1                TO AP361-NUMBER-OF-TS-ITEMS        18950000
189600     END-IF.                                                      18960000
189700 EJECT                                                            18970000
189800*----------------------------------------------------------------*18980000
189900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *18990000
190000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *19000000
190100*----------------------------------------------------------------*19010000
190200 5100-WRITE-TEMP-STORAGE.                                         19020000
190300                                                                  19030000
190400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     19040000
190500                                   TO PV-LIST-ITEM-NUMBER.        19050000
190600     COMPUTE PV-BLOCK-NUMBER =                                    19060000
190700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19070000
190800                                                                  19080000
190900     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19090000
191000     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19100000
191100         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19110000
191200             PERFORM 5105-REWRITE-ASC-LISTQ                       19120000
191300         END-IF                                                   19130000
191400     ELSE                                                         19140000
191500         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19150000
191600         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19160000
191700         PERFORM 5110-WRITE-ASC-LISTQ                             19170000
191800         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19180000
191900     END-IF.                                                      19190000
192000                                                                  19200000
192100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19210000
192200                                                                  19220000
192300******************************************************************19230000
192400** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19240000
192500** SPECIFIC COMMAREA.                                           **19250000
192600******************************************************************19260000
192700 5105-REWRITE-ASC-LISTQ.                                          19270000
192800                                                                  19280000
192900     EXEC CICS                                                    19290000
193000         WRITEQ TS                                                19300000
193100             QUEUE (ASC-LIST-QUEUE-NAME)                          19310000
193200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19320000
193300             ITEM  (PV-BLOCK-NUMBER)                              19330000
193400             REWRITE                                              19340000
193500             RESP  (PV-CICS-RESP)                                 19350000
193600     END-EXEC.                                                    19360000
193700                                                                  19370000
193800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19380000
193900         CONTINUE                                                 19390000
194000     ELSE                                                         19400000
194100         SET DP013-CICS-ABEND            TO TRUE                  19410000
194200         SET DP013-NO-ROLLBACK           TO TRUE                  19420000
194300         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       19430000
194400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19440000
194500                                         TO DP013-MESSAGE-TEXT(1) 19450000
194600         PERFORM DP013-0000-PROCESS-ABEND                         19460000
194700     END-IF.                                                      19470000
194800                                                                  19480000
194900******************************************************************19490000
195000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **19500000
195100** SPECIFIC COMMAREA.                                           **19510000
195200******************************************************************19520000
195300 5110-WRITE-ASC-LISTQ.                                            19530000
195400                                                                  19540000
195500     EXEC CICS                                                    19550000
195600         WRITEQ TS                                                19560000
195700             QUEUE (ASC-LIST-QUEUE-NAME)                          19570000
195800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19580000
195900             ITEM  (PV-BLOCK-NUMBER)                              19590000
196000             RESP  (PV-CICS-RESP)                                 19600000
196100     END-EXEC.                                                    19610000
196200                                                                  19620000
196300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      19630000
196400         SET DP013-CICS-ABEND      TO TRUE                        19640000
196500         SET DP013-NO-ROLLBACK     TO TRUE                        19650000
196600         MOVE '5110-WRITE-ASC-LISTQ'                              19660000
196700                                   TO DP013-PARAGRAPH             19670000
196800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           19680000
196900                                   TO DP013-MESSAGE-TEXT(1)       19690000
197000         PERFORM DP013-0000-PROCESS-ABEND                         19700000
197100     END-IF.                                                      19710000
197200 EJECT                                                            19720000
197300*----------------------------------------------------------------*19730000
197400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *19740000
197500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *19750000
197600*----------------------------------------------------------------*19760000
197700 5200-FILL-SEL-QUEUE-RECORD.                                      19770000
197800                                                                  19780000
197900     PERFORM 6112-READ-LIST-QUEUE.                                19790000
198000                                                                  19800000
198100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       19810000
198200         PERFORM                                                  19820000
198300         VARYING LQW-IDX                                          19830000
198400         FROM 1 BY 1                                              19840000
198500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            19850000
198600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          19860000
198700                                                                  19870000
198800             IF  LQW-SELECT (LQW-IDX)                             19880000
198900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              19890000
199000                                   TO AP362-ITEM (AP362-IDX)      19900000
199100                 SET AP362-IDX UP BY 1                            19910000
199200                 IF  AP362-IDX > AP362-MAX-ITEMS                  19920000
199300                     PERFORM 5205-WRITE-SEL-QUEUE                 19930000
199400                     ADD +1        TO AP361-NUMBER-OF-TS-ITEMS    19940000
199500                     INITIALIZE AP362-SELECTED-ITEM-ARRAY         19950000
199600                     SET AP362-IDX TO  1                          19960000
199700                 END-IF                                           19970000
199800             END-IF                                               19980000
199900         END-PERFORM                                              19990000
200000     END-IF.                                                      20000000
200100                                                                  20010000
200200*----------------------------------------------------------------*20020000
200300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *20030000
200400*----------------------------------------------------------------*20040000
200500 5205-WRITE-SEL-QUEUE.                                            20050000
200600                                                                  20060000
200700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20070000
200800                                   TO AP362-SELECTED-ITEMS.       20080000
200900                                                                  20090000
201000     EXEC CICS                                                    20100000
201100          WRITEQ TS                                               20110000
201200              QUEUE (ASC-SEL-QUEUE-NAME)                          20120000
201300              FROM  (AP362-ADJUSTMENT-SEL-REC)                    20130000
201400              ITEM  (PV-SEL-QUEUE-ITEM)                           20140000
201500              RESP  (PV-CICS-RESP)                                20150000
201600     END-EXEC.                                                    20160000
201700                                                                  20170000
201800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20180000
201900         CONTINUE                                                 20190000
202000     ELSE                                                         20200000
202100         SET DP013-CICS-ABEND      TO TRUE                        20210000
202200         SET DP013-NO-ROLLBACK     TO TRUE                        20220000
202300         MOVE '5205-WRITE-SEL-QUEUE'                              20230000
202400                                   TO DP013-PARAGRAPH             20240000
202500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20250000
202600                                   TO DP013-MESSAGE-TEXT(1)       20260000
202700         PERFORM DP013-0000-PROCESS-ABEND                         20270000
202800     END-IF.                                                      20280000
202900 EJECT                                                            20290000
203000******************************************************************20300000
203100** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **20310000
203200** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **20320000
203300** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **20330000
203400** THE USER.                                                    **20340000
203500******************************************************************20350000
203600 6000-REFRESH-PANEL-FROM-TEMP.                                    20360000
203700                                                                  20370000
203800     IF  ASC-UPDATE-TSQ                                           20380000
203900         SET ASC-NO-TSQ-UPDATE TO TRUE                            20390000
204000         MOVE ZERO                 TO PV-SAVE-ITEM                20400000
204100                                      PV-SEL-QUEUE-ITEM           20410000
204200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        20420000
204300                                   TO PV-HOLD-SELECTED-ITEMS      20430000
204400         MOVE +1                   TO PV-ITEMS-PROCESSED          20440000
204500         PERFORM 6100-UPDATE-TSQ                                  20450000
204600             UNTIL PV-ITEMS-PROCESSED >                           20460000
204700                                     PV-HOLD-SELECTED-ITEMS       20470000
204800         PERFORM 6010-DELETE-SEL-QUEUE                            20480000
204900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         20490000
205000                    ASC-BLOCK-ENTRIES (2)                         20500000
205100     END-IF.                                                      20510000
205200                                                                  20520000
205300*----------------------------------------------------------------*20530000
205400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *20540000
205500*----------------------------------------------------------------*20550000
205600 6010-DELETE-SEL-QUEUE.                                           20560000
205700                                                                  20570000
205800     EXEC CICS                                                    20580000
205900         DELETEQ TS                                               20590000
206000             QUEUE (ASC-SEL-QUEUE-NAME)                           20600000
206100             RESP  (PV-CICS-RESP)                                 20610000
206200     END-EXEC.                                                    20620000
206300                                                                  20630000
206400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      20640000
206500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         20650000
206600         CONTINUE                                                 20660000
206700     ELSE                                                         20670000
206800         SET DP013-CICS-ABEND TO TRUE                             20680000
206900         SET DP013-NO-ROLLBACK TO TRUE                            20690000
207000         MOVE '6010-DELETE-SEL-QUEUE'                             20700000
207100                        TO DP013-PARAGRAPH                        20710000
207200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         20720000
207300                        TO DP013-MESSAGE-TEXT (1)                 20730000
207400         PERFORM DP013-0000-PROCESS-ABEND                         20740000
207500     END-IF.                                                      20750000
207600                                                                  20760000
207700*----------------------------------------------------------------*20770000
207800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *20780000
207900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *20790000
208000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *20800000
208100*    THE TEMP QUEUE.                                             *20810000
208200*----------------------------------------------------------------*20820000
208300 6100-UPDATE-TSQ.                                                 20830000
208400                                                                  20840000
208500     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             20850000
208600     PERFORM 6105-READ-SEL-QUEUE.                                 20860000
208700                                                                  20870000
208800     PERFORM                                                      20880000
208900         VARYING AP362-IDX                                        20890000
209000         FROM 1 BY 1                                              20900000
209100         UNTIL ((PV-ITEMS-PROCESSED >                             20910000
209200                              PV-HOLD-SELECTED-ITEMS)             20920000
209300         OR (AP362-IDX GREATER THAN AP362-MAX-ITEMS))             20930000
209400         IF  AP362-ACTION-SW (AP362-IDX) > SPACE                  20940000
209500             PERFORM 6110-PROCESS-ITEMS                           20950000
209600         END-IF                                                   20960000
209700         ADD +1                TO PV-ITEMS-PROCESSED              20970000
209800     END-PERFORM.                                                 20980000
209900                                                                  20990000
210000     PERFORM 6111-WRITE-LIST-QUEUE.                               21000000
210100                                                                  21010000
210200*----------------------------------------------------------------*21020000
210300*    READ THE LIST QUEUE RECORD.                                 *21030000
210400*----------------------------------------------------------------*21040000
210500 6105-READ-SEL-QUEUE.                                             21050000
210600                                                                  21060000
210700     EXEC CICS                                                    21070000
210800          READQ TS                                                21080000
210900              QUEUE (ASC-SEL-QUEUE-NAME)                          21090000
211000              INTO  (AP362-ADJUSTMENT-SEL-REC)                    21100000
211100              ITEM  (PV-SEL-QUEUE-ITEM)                           21110000
211200              RESP  (PV-CICS-RESP)                                21120000
211300     END-EXEC.                                                    21130000
211400                                                                  21140000
211500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21150000
211600         CONTINUE                                                 21160000
211700     ELSE                                                         21170000
211800         SET DP013-CICS-ABEND      TO  TRUE                       21180000
211900         SET DP013-NO-ROLLBACK     TO  TRUE                       21190000
212000         MOVE '6105-READ-SEL-QUEUE'                               21200000
212100                                   TO  DP013-PARAGRAPH            21210000
212200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           21220000
212300                                   TO  DP013-MESSAGE-TEXT(1)      21230000
212400         PERFORM DP013-0000-PROCESS-ABEND                         21240000
212500     END-IF.                                                      21250000
212600 EJECT                                                            21260000
212700******************************************************************21270000
212800*    READ THE TEMPORARY QUEUE FOR THE DATA PASSED FROM THE       *21280000
212900*    HEADER SCREEN.                                              *21290000
213000******************************************************************21300000
213100 6108-READ-TEMP-QUEUE.                                            21310000
213200                                                                  21320000
213300     EXEC CICS                                                    21330000
213400          READQ TS                                                21340000
213500              QUEUE (ASC-TS-QUEUE-NAME)                           21350000
213600              INTO  (AP363-ADJUST-HEADER-AREA)                    21360000
213700              ITEM  (PV-SEL-QUEUE-ITEM)                           21370000
213800              RESP  (PV-CICS-RESP)                                21380000
213900     END-EXEC.                                                    21390000
214000                                                                  21400000
214100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21410000
214200         CONTINUE                                                 21420000
214300     ELSE                                                         21430000
214400         SET DP013-CICS-ABEND      TO  TRUE                       21440000
214500         SET DP013-NO-ROLLBACK     TO  TRUE                       21450000
214600         MOVE '6108-READ-TEMP-QUEU'                               21460000
214700                                   TO  DP013-PARAGRAPH            21470000
214800         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           21480000
214900                                   TO  DP013-MESSAGE-TEXT(1)      21490000
215000         PERFORM DP013-0000-PROCESS-ABEND                         21500000
215100     END-IF.                                                      21510000
215200 EJECT                                                            21520000
215300******************************************************************21530000
215400* THIS PARAGRAPH WILL DELETE THE TEMPORARY QUEUE THAT IS USED    *21540000
215500* TO PASS DATA FROM THE ADJUSTMENT HEADER SCREEN TO THE          *21550000
215600* ADJUSTMENT DETAIL SCREEN.                                      *21560000
215700******************************************************************21570000
215800 6109-DELETE-TEMP-QUEUE.                                          21580000
215900                                                                  21590000
216000     EXEC CICS                                                    21600000
216100         DELETEQ TS                                               21610000
216200             QUEUE (ASC-TS-QUEUE-NAME)                            21620000
216300             RESP  (PV-CICS-RESP)                                 21630000
216400     END-EXEC.                                                    21640000
216500                                                                  21650000
216600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       21660000
216700       (PV-CICS-RESP = DFHRESP(QIDERR))                           21670000
216800         CONTINUE                                                 21680000
216900     ELSE                                                         21690000
217000        SET DP013-CICS-ABEND TO TRUE                              21700000
217100        SET DP013-NO-ROLLBACK TO TRUE                             21710000
217200                                                                  21720000
217300        MOVE '6109-DELETE-TEMP-QUEUE  ' TO DP013-PARAGRAPH        21730000
217400        MOVE 'ERROR TRYING TO DELETE TEMP STORAGE QUEUE       '   21740000
217500                        TO DP013-MESSAGE-TEXT (1)                 21750000
217600        PERFORM DP013-0000-PROCESS-ABEND                          21760000
217700     END-IF.                                                      21770000
217800                                                                  21780000
217900*----------------------------------------------------------------*21790000
218000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*21800000
218100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*21810000
218200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *21820000
218300*----------------------------------------------------------------*21830000
218400 6110-PROCESS-ITEMS.                                              21840000
218500                                                                  21850000
218600     COMPUTE PV-ITEM = 1 + ((AP362-ITEM (AP362-IDX) - 1)          21860000
218700                     / PC-ITEMS-PER-PANEL).                       21870000
218800                                                                  21880000
218900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           21890000
219000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          21900000
219100             PERFORM 6111-WRITE-LIST-QUEUE                        21910000
219200         END-IF                                                   21920000
219300         MOVE PV-ITEM          TO PV-SAVE-ITEM                    21930000
219400                                                                  21940000
219500         PERFORM 6112-READ-LIST-QUEUE                             21950000
219600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               21960000
219700             CONTINUE                                             21970000
219800         END-IF                                                   21980000
219900     END-IF.                                                      21990000
220000                                                                  22000000
220100     COMPUTE PV-SUB = (AP362-ITEM (AP362-IDX)                     22010000
220200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              22020000
220300     SET LQW-DESELECT (PV-SUB) TO    TRUE.                        22030000
220400     MOVE LQW-SELECTED-SW (PV-SUB)                                22040000
220500                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  22050000
220600                                                                  22060000
220700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                22070000
220800                                                                  22080000
220900*----------------------------------------------------------------*22090000
221000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *22100000
221100*----------------------------------------------------------------*22110000
221200 6111-WRITE-LIST-QUEUE.                                           22120000
221300                                                                  22130000
221400     EXEC CICS                                                    22140000
221500         WRITEQ TS                                                22150000
221600             QUEUE (ASC-LIST-QUEUE-NAME)                          22160000
221700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     22170000
221800             ITEM  (PV-SAVE-ITEM)                                 22180000
221900             REWRITE                                              22190000
222000             RESP  (PV-CICS-RESP)                                 22200000
222100     END-EXEC.                                                    22210000
222200                                                                  22220000
222300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22230000
222400         CONTINUE                                                 22240000
222500     ELSE                                                         22250000
222600         SET DP013-CICS-ABEND  TO  TRUE                           22260000
222700         SET DP013-NO-ROLLBACK TO  TRUE                           22270000
222800         MOVE '6111-WRITE-LIST-QUEUE'                             22280000
222900                               TO  DP013-PARAGRAPH                22290000
223000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  22300000
223100                               TO  DP013-MESSAGE-TEXT(1)          22310000
223200         PERFORM DP013-0000-PROCESS-ABEND                         22320000
223300     END-IF.                                                      22330000
223400                                                                  22340000
223500 EJECT                                                            22350000
223600*----------------------------------------------------------------*22360000
223700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*22370000
223800*----------------------------------------------------------------*22380000
223900 6112-READ-LIST-QUEUE.                                            22390000
224000                                                                  22400000
224100     EXEC CICS                                                    22410000
224200         READQ TS                                                 22420000
224300             QUEUE (ASC-LIST-QUEUE-NAME)                          22430000
224400             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     22440000
224500             ITEM  (PV-ITEM)                                      22450000
224600             RESP  (PV-CICS-RESP)                                 22460000
224700     END-EXEC.                                                    22470000
224800                                                                  22480000
224900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22490000
225000         CONTINUE                                                 22500000
225100     ELSE                                                         22510000
225200         SET DP013-CICS-ABEND        TO TRUE                      22520000
225300         SET DP013-NO-ROLLBACK       TO TRUE                      22530000
225400         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           22540000
225500         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    22550000
225600                                     TO DP013-MESSAGE-TEXT(1)     22560000
225700         PERFORM DP013-0000-PROCESS-ABEND                         22570000
225800     END-IF.                                                      22580000
225900                                                                  22590000
226000 EJECT                                                            22600000
226100*----------------------------------------------------------------*22610000
226200*  ABEND PROCESSOR MODULE                                        *22620000
226300*----------------------------------------------------------------*22630000
226400                                                                  22640000
226500     COPY DPPD013.                                                22650000
