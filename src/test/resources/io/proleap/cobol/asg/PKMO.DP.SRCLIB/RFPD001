      ******************************************************************00010005
      **RF CICS COPYBOOK                                                00020022
      ******************************************************************00030014
      **RETRIEVE TEXT FROM CICS - USED BY ALL DEVICE TYPES              00040020
      ******************************************************************00050014
       RFPD001-0500-RETRIEVE-TEXT.                                      00060023
                                                                        00070014
           MOVE 'RFPD001-0500-RETRIEVE-TEXT'   TO DP013-PARAGRAPH.      00080023
                                                                        00090014
           EXEC CICS                                                    00100014
                RETRIEVE                                                00110014
                INTO (RFWS007-FROM-CLIENT-RECORD)                       00120022
                RESP (PV-CICS-RESPONSE)                                 00130022
           END-EXEC.                                                    00140014
                                                                        00150014
           EVALUATE TRUE                                                00160014
              WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                  00170014
                   CONTINUE                                             00180014
              WHEN OTHER                                                00190014
                   MOVE 'UNABLE TO RECEIVE TEXT'                        00200014
                                               TO DP013-MESSAGE-TEXT (1)00210014
                   MOVE  RFWS007-FROM-CLIENT-RECORD                     00220015
                                               TO DP013-MESSAGE-TEXT (2)00230014
                   SET DP013-CICS-ABEND                                 00240014
                       DP013-NO-ROLLBACK       TO TRUE                  00250014
                   PERFORM RFPD001-9998-LOG-CICS-MSG                    00260024
                   SET  DP011-MSG-FATAL        TO TRUE                  00270014
                   MOVE PC-TSYMSG-01064        TO DP011-MSG-NUMBER      00280014
                   PERFORM DP011-0000-FORMAT-MSG-LINES                  00290014
           END-EVALUATE.                                                00300014
                                                                        00310014
           MOVE RFWS007-LISTENER-CODE          TO PV-QUEUE-PARM.        00320022
                                                                        00330014
           IF  PV-VALID-PARM                                            00340014
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      00350016
                                               TO RFWS007-TSQ-NAME      00360022
               SET RFWS007-SUCCESSFUL-RET      TO TRUE                  00370022
           ELSE                                                         00380014
               SET RFWS007-NOT-SUCCESSFUL-RET  TO TRUE                  00390022
               MOVE 'INVALID PARM VALUE'       TO DP013-MESSAGE-TEXT (1)00400022
               MOVE 'PARM VALUE = '            TO DP013-MESSAGE-TEXT (2)00410022
               MOVE RFWS007-LISTENER-CODE      TO DP013-MESSAGE-TEXT (3)00420022
               SET DP013-LOGIC-ABEND                                    00430014
                   DP013-NO-ROLLBACK           TO TRUE                  00440022
               PERFORM RFPD001-9998-LOG-CICS-MSG                        00450024
               SET  DP011-MSG-FATAL            TO TRUE                  00460022
               MOVE PC-TSYMSG-01064            TO DP011-MSG-NUMBER      00470022
               PERFORM DP011-0000-FORMAT-MSG-LINES                      00480014
           END-IF.                                                      00490014
                                                                        00500014
       EJECT.                                                           00510014
      ******************************************************************00520005
      **CALLED TO RETURN MESSAGE TO DEVICE                              00530022
      ******************************************************************00540005
       RFPD001-1000-RETURN-DATA.                                        00550025
                                                                        00560005
           IF  RFWS007-MQ-INDICATOR-YES                                 00570006
      **INDICATES TRANSACTION IS FROM A NEW RF DEVICE                   00580020
               PERFORM RFPD001-2000-MQ-SETUP                            00590023
               PERFORM RFPD001-2100-MQ-SETUP-REMOTE                     00600023
               PERFORM RFPD001-2200-PUT-QUEUE                           00610023
               PERFORM RFPD001-2300-CLOSE-PUT-Q                         00620023
               PERFORM RFPD001-2400-DISCONNECT-QMGR                     00630023
               PERFORM RFPD001-9999-EXEC-CICS-RETURN                    00640023
           ELSE                                                         00650005
      **INDICATES TRANSACTION IS FROM AN OLD RF DEVICE                  00660020
               PERFORM RFPD001-3000-ENQ                                 00670025
               PERFORM RFPD001-3100-READQ-REC1                          00680025
               PERFORM RFPD001-3200-READQ-REC2                          00690025
               PERFORM RFPD001-3300-REWRITE-NEXT                        00700025
               ADD 1      TO RFWS007-NEXT-RECORD                        00710006
               IF  RFWS007-NEXT-RECORD > RFWS007-TOTAL-RECORDS          00720006
                   MOVE 3 TO RFWS007-NEXT-RECORD                        00730006
               END-IF                                                   00740005
               PERFORM RFPD001-3400-REWRITE-REC1                        00750025
               PERFORM RFPD001-3500-DEQ                                 00760025
               PERFORM RFPD001-9999-EXEC-CICS-RETURN                    00770023
           END-IF.                                                      00780005
                                                                        00790005
       EJECT.                                                           00800005
      ******************************************************************00810013
      **POCKET PC - SETUP TO CALL MQ TO RETURN MESSAGES                 00820022
      ******************************************************************00830022
       RFPD001-2000-MQ-SETUP.                                           00840023
                                                                        00850013
           MOVE 'RFPD001-2000-MQ-SETUP'        TO DP013-PARAGRAPH.      00860023
                                                                        00870013
           PERFORM EP000-0000-INITIALIZE.                               00880013
                                                                        00890013
           IF  EP000-PV-KOHLS-PROD-SYSTEM                               00900013
               SET RFWS007-PROD-QMGR-NAME      TO TRUE                  00910013
           ELSE                                                         00920013
                IF  EP000-PV-KOHLS-QA-SYSTEM                            00930013
                    SET RFWS007-QA-QMGR-NAME   TO TRUE                  00940013
                ELSE                                                    00950013
                    SET RFWS007-TEST-QMGR-NAME TO TRUE                  00960013
                END-IF                                                  00970013
           END-IF.                                                      00980013
      ***************************************************************   00990013
      **CONNECT TO THE QUEUE MANAGER                                    01000013
      ***************************************************************   01010013
           MOVE RFWS007-QMGR-NAME              TO RFWS007-QM-NAME.      01020013
           CALL RFWS007-MQCONN USING RFWS007-QM-NAME                    01030013
                                     RFWS007-HCONN                      01040013
                                     RFWS007-COMPLETION-CODE            01050013
                                     RFWS007-REASON.                    01060013
      ***************************************************************   01070013
      **IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE AND EXIT        01080013
      ***************************************************************   01090013
           MOVE RFWS007-REASON                 TO RFWS007-CON-REASON.   01100019
           IF  RFWS007-COMPLETION-CODE NOT = MQCC-OK                    01110013
               MOVE 'MQCONN ERROR'             TO RFWS007-ERROR-MESSAGE 01120013
               MOVE  RFWS007-ERROR-MESSAGE     TO DP013-MESSAGE-TEXT (1)01130013
               MOVE  RFWS007-COMPLETION-CODE   TO DP013-MESSAGE-TEXT (2)01140013
               MOVE  RFWS007-REASON            TO DP013-MESSAGE-TEXT (3)01150013
               SET DP013-CICS-ABEND                                     01160013
                   DP013-NO-ROLLBACK           TO TRUE                  01170013
               PERFORM RFPD001-9998-LOG-CICS-MSG                        01180024
               PERFORM RFPD001-9999-EXEC-CICS-RETURN                    01190023
           END-IF.                                                      01200013
                                                                        01210013
       EJECT.                                                           01220013
      ******************************************************************01230022
      **POCKET PC - OPEN THE QUEUE FOR PROCESSING                       01240022
      ******************************************************************01250022
       RFPD001-2100-MQ-SETUP-REMOTE.                                    01260023
                                                                        01270013
           MOVE 'RFPD001-2100-MQ-SETUP-REMOTE' TO DP013-PARAGRAPH.      01280023
                                                                        01290013
           COMPUTE RFWS007-OPEN-OPTIONS = MQOO-OUTPUT +                 01300013
                                     MQOO-FAIL-IF-QUIESCING.            01310013
                                                                        01320013
           CALL RFWS007-MQOPEN USING RFWS007-HCONN                      01330013
                                     MQM-OBJECT-DESCRIPTOR              01340013
                                     RFWS007-OPEN-OPTIONS               01350013
                                     RFWS007-PQ-HANDLE                  01360013
                                     RFWS007-COMPLETION-CODE            01370013
                                     RFWS007-REASON.                    01380013
      ***************************************************************** 01390013
      **IF OPEN FAILED THEN DISPLAY ERROR MESSAGE THE EXIT              01400013
      ***************************************************************** 01410013
           IF  RFWS007-COMPLETION-CODE NOT = MQCC-OK                    01420013
               PERFORM RFPD001-2300-CLOSE-PUT-Q                         01430023
               PERFORM RFPD001-2400-DISCONNECT-QMGR                     01440023
               MOVE  RFWS007-ERROR-MESSAGE   TO DP013-MESSAGE-TEXT (1)  01450013
               MOVE  RFWS007-COMPLETION-CODE TO DP013-MESSAGE-TEXT (2)  01460013
               MOVE  RFWS007-REASON          TO DP013-MESSAGE-TEXT (3)  01470013
               SET DP013-CICS-ABEND                                     01480013
                   DP013-NO-ROLLBACK         TO TRUE                    01490013
               PERFORM RFPD001-9998-LOG-CICS-MSG                        01500024
               PERFORM RFPD001-9999-EXEC-CICS-RETURN                    01510023
           END-IF.                                                      01520013
                                                                        01530013
           MOVE RFWS007-PQ-HANDLE       TO RFWS007-FMT-OPEN-OUTPUT-HNDL.01540017
                                                                        01550013
       EJECT.                                                           01560013
      ******************************************************************01570013
      **POCKET PC - PLACE MESSAGES ON QUEUE TO BE RETURNED              01580022
      ******************************************************************01590022
       RFPD001-2200-PUT-QUEUE.                                          01600023
                                                                        01610013
           MOVE 'RFPD001-2200-PUT-QUEUE'    TO DP013-PARAGRAPH.         01620023
                                                                        01630013
           MOVE MQMI-NONE                   TO MQMD-MSGID.              01640022
           MOVE MQFMT-STRING                TO MQMD-FORMAT.             01650022
           MOVE 5000                        TO MQMD-EXPIRY.             01660022
           MOVE MQPER-PERSISTENT            TO MQMD-PERSISTENCE.        01670022
                                                                        01680013
           COMPUTE MQPMO-CONTEXT = RFWS007-PQ-HANDLE.                   01690022
                                                                        01700013
           CALL RFWS007-MQPUT USING RFWS007-HCONN                       01710013
                                    RFWS007-FMT-OPEN-OUTPUT-HNDL        01720013
                                    MQM-MESSAGE-DESCRIPTOR              01730013
                                    MQM-PUT-MESSAGE-OPTIONS             01740013
                                    RFWS007-DATA-LENGTH                 01750013
                                    RFWS007-MSGBUFFER                   01760013
                                    RFWS007-COMPLETION-CODE             01770013
                                    RFWS007-REASON.                     01780013
      ***************************************************************** 01790013
      **IF PUT FAILED THEN DISPLAY ERROR MESSAGE AND BREAK LOOP         01800013
      ***************************************************************** 01810013
           IF  RFWS007-COMPLETION-CODE NOT = MQCC-OK                    01820013
               PERFORM RFPD001-2300-CLOSE-PUT-Q                         01830023
               PERFORM RFPD001-2400-DISCONNECT-QMGR                     01840023
               MOVE 'MQPUT ERR'             TO RFWS007-ERROR-MESSAGE    01850022
               MOVE RFWS007-ERROR-MESSAGE                               01860022
                                            TO DP013-MESSAGE-TEXT (1)   01870022
               MOVE RFWS007-COMPLETION-CODE TO DP013-MESSAGE-TEXT (2)   01880022
               MOVE RFWS007-REASON          TO DP013-MESSAGE-TEXT (3)   01890022
               SET DP013-CICS-ABEND                                     01900013
                   DP013-NO-ROLLBACK        TO TRUE                     01910022
               PERFORM RFPD001-9998-LOG-CICS-MSG                        01920024
               PERFORM RFPD001-9999-EXEC-CICS-RETURN                    01930023
           ELSE                                                         01940013
               SET RFWS007-MQPUT-SUCCESSFUL TO TRUE                     01950013
           END-IF.                                                      01960013
                                                                        01970013
       EJECT.                                                           01980013
      ******************************************************************01990013
      **POCKET PC - CLOSE QUEUE AFTER PROCESSING IS COMPLETE            02000022
      ******************************************************************02010022
       RFPD001-2300-CLOSE-PUT-Q.                                        02020023
                                                                        02030013
           MOVE 'RFPD001-2300-CLOSE-PUT-Q'   TO DP013-PARAGRAPH.        02040023
                                                                        02050013
           CALL RFWS007-MQCLOSE USING RFWS007-HCONN                     02060013
                                      RFWS007-PQ-HANDLE                 02070013
                                      MQCO-NONE                         02080013
                                      RFWS007-COMPLETION-CODE           02090013
                                      RFWS007-REASON.                   02100013
                                                                        02110013
           IF  RFWS007-COMPLETION-CODE NOT = MQCC-OK                    02120013
               MOVE 'MQCLOSE PQ HANDLE'      TO RFWS007-ERROR-MESSAGE   02130013
               MOVE  RFWS007-ERROR-MESSAGE   TO DP013-MESSAGE-TEXT (1)  02140013
               MOVE  RFWS007-COMPLETION-CODE TO DP013-MESSAGE-TEXT (2)  02150013
               MOVE  RFWS007-REASON          TO DP013-MESSAGE-TEXT (3)  02160013
               SET DP013-CICS-ABEND                                     02170013
                   DP013-NO-ROLLBACK         TO TRUE                    02180013
               PERFORM RFPD001-9998-LOG-CICS-MSG                        02190024
               PERFORM RFPD001-9999-EXEC-CICS-RETURN                    02200023
           END-IF.                                                      02210013
                                                                        02220013
       EJECT.                                                           02230013
      ******************************************************************02240013
      **POCKET PC - DISCONNECT FROM QUEUE MANAGER                       02250022
      ******************************************************************02260022
       RFPD001-2400-DISCONNECT-QMGR.                                    02270023
                                                                        02280013
           MOVE 'RFPD001-2400-DISCONNECT'      TO DP013-PARAGRAPH.      02290023
                                                                        02300013
           IF  RFWS007-CON-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED02310013
               CALL RFWS007-MQDISC USING RFWS007-HCONN                  02320013
                                         RFWS007-COMPLETION-CODE        02330013
                                         RFWS007-REASON                 02340013
               IF  RFWS007-COMPLETION-CODE NOT = MQCC-OK                02350013
                   MOVE 'MQDISC'               TO RFWS007-ERROR-MESSAGE 02360013
                   MOVE RFWS007-ERROR-MESSAGE  TO DP013-MESSAGE-TEXT (1)02370013
                   MOVE RFWS007-COMPLETION-CODE                         02380013
                                               TO DP013-MESSAGE-TEXT (2)02390013
                   MOVE RFWS007-REASON         TO DP013-MESSAGE-TEXT (3)02400013
                   SET DP013-CICS-ABEND                                 02410013
                       DP013-NO-ROLLBACK       TO TRUE                  02420013
                   PERFORM RFPD001-9998-LOG-CICS-MSG                    02430024
                   PERFORM RFPD001-9999-EXEC-CICS-RETURN                02440023
              END-IF                                                    02450013
           END-IF.                                                      02460013
                                                                        02470013
       EJECT.                                                           02480013
      ******************************************************************02490005
      **OLD DEVICE - SCHEDULE USE OF THE QUEUE                          02500022
      ******************************************************************02510020
       RFPD001-3000-ENQ.                                                02520025
                                                                        02530005
           MOVE 'RFPD001-3000-ENQ' TO DP013-PARAGRAPH.                  02540025
                                                                        02550005
           EXEC CICS                                                    02560005
                ENQ                                                     02570005
                RESOURCE (RFWS007-TSQ-NAME)                             02580006
                RESP     (PV-CICS-RESPONSE)                             02590011
           END-EXEC.                                                    02600005
                                                                        02610005
           EVALUATE TRUE                                                02620005
              WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                  02630011
                   CONTINUE                                             02640005
              WHEN OTHER                                                02650005
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q02660005
      -                 'UEUE: '                                        02670005
                                           TO DP013-MESSAGE-TEXT (1)    02680005
                   MOVE RFWS007-TSQ-NAME   TO DP013-MESSAGE-TEXT (2)    02690006
                   SET DP013-CICS-ABEND                                 02700005
                       DP013-NO-ROLLBACK   TO TRUE                      02710005
                   PERFORM RFPD001-9998-LOG-CICS-MSG                    02720024
                   PERFORM RFPD001-9999-EXEC-CICS-RETURN                02730023
           END-EVALUATE.                                                02740005
                                                                        02750005
       EJECT.                                                           02760005
      ******************************************************************02770005
      **OLD DEVICE - READ A RECORD FROM THE TEMPORARY STORAGE QUEUE     02780022
      ******************************************************************02790020
       RFPD001-3100-READQ-REC1.                                         02800025
                                                                        02810005
           MOVE '3100-READQ-REC1' TO DP013-PARAGRAPH.                   02820025
                                                                        02830005
           MOVE LENGTH OF RFWS007-TCPIPPRQ-REC1                         02840023
                                              TO RFWS007-TSQ-LENGTH.    02850013
                                                                        02860005
           EXEC CICS                                                    02870005
                READQ TS                                                02880005
                QUEUE  (RFWS007-TSQ-NAME)                               02890006
                INTO   (RFWS007-TCPIPPRQ-REC1)                          02900023
                LENGTH (RFWS007-TSQ-LENGTH)                             02910006
                ITEM   (1)                                              02920005
                RESP   (PV-CICS-RESPONSE)                               02930011
           END-EXEC.                                                    02940005
                                                                        02950005
           EVALUATE TRUE                                                02960005
              WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                  02970011
                   CONTINUE                                             02980005
              WHEN OTHER                                                02990005
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 03000005
      -                 'QUEUE: '                                       03010005
                                              TO DP013-MESSAGE-TEXT (1) 03020013
                   MOVE RFWS007-TSQ-NAME      TO DP013-MESSAGE-TEXT (2) 03030013
                   SET DP013-CICS-ABEND                                 03040005
                       DP013-NO-ROLLBACK      TO TRUE                   03050013
                   PERFORM RFPD001-9998-LOG-CICS-MSG                    03060024
                   PERFORM RFPD001-9999-EXEC-CICS-RETURN                03070023
           END-EVALUATE.                                                03080005
                                                                        03090005
       EJECT.                                                           03100005
      ******************************************************************03110005
      **OLD DEVICE - READ A RECORD FROM THE TEMPORARY STORAGE QUEUE     03120022
      ******************************************************************03130020
       RFPD001-3200-READQ-REC2.                                         03140025
                                                                        03150005
           MOVE '3200-READQ-REC2' TO DP013-PARAGRAPH.                   03160025
                                                                        03170005
           MOVE LENGTH OF RFWS007-TCPIPPRQ-REC2                         03180023
                                              TO RFWS007-TSQ-LENGTH.    03190013
                                                                        03200005
           EXEC CICS                                                    03210005
                READQ TS                                                03220005
                QUEUE   (RFWS007-TSQ-NAME)                              03230006
                INTO    (RFWS007-TCPIPPRQ-REC2)                         03240023
                LENGTH  (RFWS007-TSQ-LENGTH)                            03250006
                ITEM    (2)                                             03260005
                RESP    (PV-CICS-RESPONSE)                              03270011
           END-EXEC.                                                    03280005
                                                                        03290005
           EVALUATE TRUE                                                03300005
              WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                  03310011
                   CONTINUE                                             03320005
              WHEN OTHER                                                03330005
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 03340005
      -                 'QUEUE: '                                       03350005
                                              TO DP013-MESSAGE-TEXT(1)  03360013
                   MOVE RFWS007-TSQ-NAME      TO DP013-MESSAGE-TEXT(2)  03370013
                   SET DP013-CICS-ABEND                                 03380005
                       DP013-NO-ROLLBACK      TO TRUE                   03390013
                   PERFORM RFPD001-9998-LOG-CICS-MSG                    03400024
                   PERFORM RFPD001-9999-EXEC-CICS-RETURN                03410023
           END-EVALUATE.                                                03420005
                                                                        03430005
       EJECT.                                                           03440005
      ******************************************************************03450005
      **OLD DEIWRITE RECORD TO A TEMPORARY STORAGE QUEUE                03460022
      ******************************************************************03470020
       RFPD001-3300-REWRITE-NEXT.                                       03480025
                                                                        03490005
           MOVE 'RFPD001-3300-REWRITE-NEXT'                             03500025
                                               TO DP013-PARAGRAPH.      03510023
                                                                        03520005
           MOVE RFWS007-NEXT-RECORD            TO RFWS007-ITEM-NBR.     03530023
                                                                        03540005
           EXEC CICS                                                    03550005
                WRITEQ TS                                               03560005
                QUEUE  (RFWS007-TSQ-NAME)                               03570006
                FROM   (RFWS007-TO-CLIENT-RECORD)                       03580018
                LENGTH (RFWS007-TSQ-LENGTH)                             03590006
                ITEM   (RFWS007-ITEM-NBR)                               03600006
                REWRITE                                                 03610005
                RESP   (PV-CICS-RESPONSE)                               03620011
           END-EXEC.                                                    03630005
                                                                        03640005
           EVALUATE TRUE                                                03650005
              WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                  03660011
                   CONTINUE                                             03670005
              WHEN OTHER                                                03680005
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA03690005
      -                 'STORAGE QUEUE: '                               03700005
                                               TO DP013-MESSAGE-TEXT(1) 03710023
                   MOVE RFWS007-TSQ-NAME       TO DP013-MESSAGE-TEXT(2) 03720023
                   SET DP013-CICS-ABEND                                 03730005
                       DP013-NO-ROLLBACK       TO TRUE                  03740005
                   PERFORM RFPD001-9998-LOG-CICS-MSG                    03750024
                   PERFORM RFPD001-9999-EXEC-CICS-RETURN                03760023
           END-EVALUATE.                                                03770005
                                                                        03780005
       EJECT.                                                           03790005
      ******************************************************************03800005
      **WRITE RECORD TO A TEMPORARY STORAGE QUEUE                       03810021
      ******************************************************************03820021
       RFPD001-3400-REWRITE-REC1.                                       03830025
                                                                        03840005
           MOVE '2400-REWRITE-REC1' TO DP013-PARAGRAPH.                 03850025
                                                                        03860005
           MOVE +1                              TO RFWS007-ITEM-NBR.    03870006
                                                                        03880005
           EXEC CICS                                                    03890005
                WRITEQ TS                                               03900005
                QUEUE  (RFWS007-TSQ-NAME)                               03910006
                FROM   (RFWS007-TCPIPPRQ-REC1)                          03920023
                LENGTH (RFWS007-TSQ-LENGTH)                             03930006
                ITEM   (RFWS007-ITEM-NBR)                               03940006
                REWRITE                                                 03950005
                RESP   (PV-CICS-RESPONSE)                               03960011
           END-EXEC.                                                    03970005
                                                                        03980005
           EVALUATE TRUE                                                03990005
              WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                  04000011
                   CONTINUE                                             04010005
              WHEN OTHER                                                04020005
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   04030005
                                                TO DP013-MESSAGE-TEXT(1)04040022
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     04050005
                                                TO DP013-MESSAGE-TEXT(2)04060022
                   MOVE RFWS007-TSQ-NAME        TO DP013-MESSAGE-TEXT(3)04070022
                   MOVE RFWS007-TCPIPPRQ-REC1                           04080023
                                                TO DP013-MESSAGE-TEXT(4)04090022
                   SET DP013-CICS-ABEND                                 04100005
                       DP013-NO-ROLLBACK        TO TRUE                 04110022
                   PERFORM RFPD001-9998-LOG-CICS-MSG                    04120024
                   PERFORM RFPD001-9999-EXEC-CICS-RETURN                04130023
           END-EVALUATE.                                                04140005
                                                                        04150005
       EJECT.                                                           04160005
      ******************************************************************04170005
      **RELEASES QUEUE                                                  04180020
      ******************************************************************04190020
       RFPD001-3500-DEQ.                                                04200025
                                                                        04210005
           MOVE 'RFPD001-3500-DEQ'             TO DP013-PARAGRAPH.      04220025
                                                                        04230005
           EXEC CICS                                                    04240005
                DEQ                                                     04250005
                RESOURCE (RFWS007-TSQ-NAME)                             04260006
                RESP     (PV-CICS-RESPONSE)                             04270011
           END-EXEC.                                                    04280005
                                                                        04290005
           EVALUATE TRUE                                                04300005
              WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                  04310011
                   CONTINUE                                             04320005
              WHEN OTHER                                                04330005
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q04340005
      -                 'UEUE: '                                        04350005
                                               TO DP013-MESSAGE-TEXT (1)04360005
                   MOVE RFWS007-TSQ-NAME       TO DP013-MESSAGE-TEXT (2)04370006
                   SET DP013-CICS-ABEND                                 04380005
                       DP013-NO-ROLLBACK       TO TRUE                  04390005
                 PERFORM RFPD001-9998-LOG-CICS-MSG                      04400024
                 PERFORM RFPD001-9999-EXEC-CICS-RETURN                  04410023
           END-EVALUATE.                                                04420005
                                                                        04430005
       EJECT.                                                           04440005
      ******************************************************************04450005
      **LINK TO CICS TO WRITE A MESSAGE                                 04460020
      ******************************************************************04470020
       RFPD001-9998-LOG-CICS-MSG.                                       04480024
                                                                        04490005
           MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              04500013
           MOVE DFHEIBLK                 TO DP013-DFHEIBLK.             04510013
                                                                        04520005
           INITIALIZE DP013-SRC-TASK-NUMBER                             04530005
                      DP013-STACK.                                      04540005
                                                                        04550005
           SET DP013-LINK-RETURN         TO TRUE.                       04560013
                                                                        04570005
           EXEC CICS                                                    04580005
                LINK                                                    04590005
                PROGRAM  (DP013-NAME)                                   04600005
                COMMAREA (DP013-PARAMETERS)                             04610005
                LENGTH   (DP013-LENGTH)                                 04620005
           END-EXEC.                                                    04630005
                                                                        04640005
      **NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE              04650005
           COPY DPPD011.                                                04660005
      **NON-CICS ARCHITECTURE ABEND ROUTINE CALL                        04670005
           COPY DPPD014.                                                04680005
           COPY EPPD000.                                                04690005
      ******************************************************************04700013
      **RETURN CONTROL TO PROGRAM                                       04710020
      ******************************************************************04720020
       RFPD001-9999-EXEC-CICS-RETURN.                                   04730023
                                                                        04740013
           EXEC CICS                                                    04750013
                RETURN                                                  04760013
           END-EXEC.                                                    04770013
                                                                        04780013
       EJECT.                                                           04790013
