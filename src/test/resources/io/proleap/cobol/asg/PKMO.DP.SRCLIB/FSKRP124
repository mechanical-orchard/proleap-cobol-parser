      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
      *                                                                 00040000
       PROGRAM-ID.   FSKRP124.                                          00050000
       AUTHOR.       RICH KELLEN.                                       00060000
       INSTALLATION. KOHLS DEPARTMENT STORES.                           00070000
       DATE-WRITTEN. APRIL 2006.                                        00080000
       DATE-COMPILED.                                                   00090000
      *                                                                 00100000
      ******************************************************************00110000
      * FSKRP124 - CREATE SKUS WITH NO RECEIPTS REPORT                  00110100
      ******************************************************************00111000
      * THIS PROGRAM WILL FIND SKUS WITH NO RECEIPTS AND CREATE A       00121000
      * REPORT FOR THE BUYERS, SO THAT THEY MAY PURGE THEM FROM THE     00122000
      * SYSTEM.                                                         00122100
      *                                                                 00122200
      * A CURSOR WILL DRIVE THE PROGRAM.  THE CURSOR WILL LOOK FOR      00122300
      * ACTIVE SKUS CREATED MORE THAN 6 MONTHS AGO THAT HAVE NO         00123000
      * RECEIPTS.  THESE ARE THEN CHECKED TO INSURE THEY HAVE NO        00124000
      * ON-ORDER BEFORE THEY ARE PUT ON THE REPORT.  THE REPORT IS      00125000
      * SORTED BY MANAGER, BUYER, DEPARTMENT, CLASS, SUBCLASS, AND      00126000
      * SKU SEQUENCE.  THERE IS A PAGE BREAK ON MANGER, BUYER OR        00127000
      * DEPARTMENT AND A MID-PAGE BREAK ON CLASS OR SUBCLASS.           00128000
      ***************************************************************** 00130000
      *  CHANGE LOG:                                                    00140000
      *                                                                 00150000
      *  05/25/06 - RICH KELLEN                                         00160000
      *             (WR #30676) INITIAL INSTALL.                        00161000
      *                                                                 00171000
      ******************************************************************00180000
       ENVIRONMENT DIVISION.                                            00190000
      ******************************************************************00200000
      *                                                                 00210000
       CONFIGURATION SECTION.                                           00220000
       SOURCE-COMPUTER.   IBM-3090.                                     00230000
       OBJECT-COMPUTER.   IBM-3090.                                     00240000
      *                                                                 00250000
       INPUT-OUTPUT SECTION.                                            00260000
       FILE-CONTROL.                                                    00270000
      *                                                                 00280000
            SELECT SKU-REPORT-FILE                                      00290000
              ASSIGN TO RPT01.                                          00300000
                                                                        00310000
      ******************************************************************00320000
       DATA DIVISION.                                                   00330000
      ******************************************************************00340000
      *                                                                 00350000
       FILE SECTION.                                                    00360000
      *                                                                 00370000
       FD SKU-REPORT-FILE                                               00380000
           RECORDING MODE IS F                                          00390000
           BLOCK CONTAINS 0 RECORDS                                     00400000
           DATA RECORD IS SKU-RPT-LINE.                                 00410000
                                                                        00420000
       01 SKU-RPT-LINE                    PIC X(132).                   00430000
      *                                                                 00440000
       WORKING-STORAGE SECTION.                                         00450000
      *                                                                 00460000
           COPY SQLCA2.                                                 00470000
      *                                                                 00480000
                                                                        00490000
       01 ABEND-CODE                      PIC S9(04)    VALUE ZERO      00500000
                                                        COMP SYNC.      00510000
           88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 00520000
           88  ABEND-4002-READ-ERROR                       VALUE +4002. 00530000
           88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 00540000
           88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 00550000
           88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00560000
           88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 00570000
           88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 00580000
           88  ABEND-4008-DATS-ERROR                       VALUE +4008. 00590000
           88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 00600000
           88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00610000
      *                                                                 00620000
       01 SD-SYSTEM-DATE.                                               00630000
          05  SD-SYSTEM-YEAR              PIC  9(02)  VALUE ZEROS.      00640000
          05  SD-SYSTEM-MONTH             PIC  9(02)  VALUE ZEROS.      00650000
          05  SD-SYSTEM-DAY               PIC  9(02)  VALUE ZEROS.      00660000
                                                                        00670000
       01 ST-SYSTEM-TIME.                                               00680000
          05  ST-SYSTEM-HOUR              PIC  9(02)  VALUE ZEROS.      00690000
          05  ST-SYSTEM-MINUTE            PIC  9(02)  VALUE ZEROS.      00700000
      *                                                                 00710000
       01 SA-SAVE-AREAS.                                                00720000
          05  SA-OUT-RECORD               PIC X(201)   VALUE SPACES.    00730000
          05  SA-PAGE-COUNT               PIC 9(05)    VALUE ZEROS.     00740000
          05  SA-CURRENT-DATE             PIC  X(10)  VALUE SPACES.     00750000
          05  SA-CURR-DATE REDEFINES SA-CURRENT-DATE.                   00760000
              10 SA-CURR-CENTURY          PIC  X(02).                   00770000
              10 SA-CURR-YEAR             PIC  X(02).                   00780000
              10 FILLER                   PIC  X(01).                   00790000
              10 SA-CURR-MONTH            PIC  X(02).                   00800000
              10 FILLER                   PIC  X(01).                   00810000
              10 SA-CURR-DAY              PIC  X(02).                   00820000
          05  SA-CURRENT-TIME             PIC  X(08)  VALUE SPACES.     00830000
          05  SA-CURR-TIME REDEFINES SA-CURRENT-TIME.                   00840000
              10 SA-CURR-HOUR             PIC  X(02).                   00850000
              10 FILLER                   PIC  X(01).                   00860000
              10 SA-CURR-MINUTE           PIC  X(02).                   00870000
              10 FILLER                   PIC  X(01).                   00880000
              10 SA-CURR-SECOND           PIC  X(02).                   00890000
          05  SA-PREV-DEPT-NMBR           PIC X(03)    VALUE SPACES.    00900000
      *                                                                 00910000
       01 PC-PROGRAM-CONSTANTS.                                         00920000
          05  PC-DPKUT500                 PIC X(10)      VALUE          00930000
              'DPKUT500  '.                                             00940000
          05  PC-ADV-PAGE-SYMBOL          PIC X      VALUE '1'.         00950000
          05  PC-0500000                  PIC S9(07)V   COMP-3          00960000
                                          VALUE +0500000.               00970000
          05  PC-OPERCO-NBR               PIC X(02)  VALUE '03'.        00980000
          05  PC-TYPE-CDE                 PIC X(02)  VALUE '01'.        00990000
          05  PC-PROGRAM-NAME             PIC X(08)  VALUE              01000000
              'FSKRP124'.                                               01010000
          05  PC-YES                      PIC X(1)   VALUE 'Y'.         01020000
          05  PC-NO                       PIC X(1)   VALUE 'N'.         01030000
          05  PC-MAX-PAGE-LINES           PIC S9(03) VALUE +60          01040000
                                                     COMP-3.            01050000
          05  PC-MAX-RETRY-CNT            PIC S9(04) VALUE 3            01060000
                                                     COMP SYNC.         01070000
          05  PC-MORE-THAN-MAX-RETRY      PIC S9(04) VALUE 4            01080000
                                                     COMP SYNC.         01090000
          05  PC-DEPT-CODE                PIC X(03)  VALUE 'DPT'.       01100000
          05  PC-MANAGER-CODE             PIC X(03)  VALUE 'DMA'.       01110000
          05  PC-RSPLVL-BUYER             PIC X(03)  VALUE 'BYR'.       01120000
          05  PC-RSPLVL-MANAGER           PIC X(03)  VALUE 'DMM'.       01130000
          05  PC-MAJOR-CLASS              PIC X(03)  VALUE 'MCL'.       01140000
          05  PC-SUB-CLASS                PIC X(03)  VALUE 'SCL'.       01150000
          05  PC-SPACE                    PIC X(01)  VALUE ' '.         01160000
          05  PC-FIRST-NAME-DELIM         PIC X(02)  VALUE '  '.        01170000
      *                                                                 01180000
       01 FS-FILE-STATUS-CODES                          COMP-4 SYNC.    01190000
          05  FS-MANAGER-NAME-CODE        PIC S9(9)     VALUE ZERO.     01200000
              88  FS-MANAGER-NAME-NOT-FOUND             VALUE +100.     01210000
          05  FS-BUYER-NAME-CODE          PIC S9(9)     VALUE ZERO.     01220000
              88  FS-BUYER-NAME-NOT-FOUND               VALUE +100.     01230000
      *                                                                 01240000
       01 CC-CURRENT-CLASS            PIC 9(02)  VALUE ZEROES.          01250000
       01 FILLER REDEFINES CC-CURRENT-CLASS.                            01260000
          05  CC-DIGIT-1              PIC 9(01).                        01270000
          05  FILLER                  PIC 9(01).                        01280000
      *                                                                 01290000
       01 TC-TMDSEAR-CLASS            PIC X(2)   VALUE ZEROES.          01300000
       01 FILLER REDEFINES TC-TMDSEAR-CLASS.                            01310000
          05  FILLER                  PIC X(01).                        01320000
          05  TC-DIGIT-2              PIC X(01).                        01330000
      *                                                                 01340000
       01 CS-CURRENT-SUBCLASS         PIC 9(02)  VALUE ZEROES.          01350000
       01 FILLER REDEFINES CS-CURRENT-SUBCLASS.                         01360000
          05  CS-DIGIT-1              PIC 9(01).                        01370000
          05  FILLER                  PIC 9(01).                        01380000
      *                                                                 01390000
       01 TS-TMDSEAR-SUBCLASS         PIC X(03)  VALUE ZEROES.          01400000
       01 FILLER REDEFINES TS-TMDSEAR-SUBCLASS.                         01410000
          05  TS-SUBCLASS-1           PIC X(01).                        01420000
          05  TS-SUBCLASS             PIC X(02).                        01430000
      *                                                                 01440000
       01 CB-CALL-BUYER               PIC X(03)  VALUE ZEROES.          01450000
      *                                                                 01460000
       01 PC-PREV-CLASS               PIC 9(02)  VALUE ZEROES.          01470000
      *                                                                 01480000
       01 PV-PROGRAM-VARIABLES.                                         01490000
          05  PV-SQLCODE                  PIC +9(04).                   01500000
          05  PV-OPERATION-MSG            PIC X(60)  VALUE SPACES.      01510000
          05  PV-PREV-SKU-RPT-LINE        PIC X(201) VALUE SPACES.      01520000
          05  PV-CURS-CNT                 PIC 9(7)   VALUE ZERO.        01530000
          05  PV-WRITE-CNT                PIC 9(7)   VALUE ZERO         01540000
                                                     COMP-3.            01550000
          05  PV-READ-CNT                 PIC 9(7)      VALUE ZERO      01560000
                                                        COMP-3.         01570000
          05  PV-RETRY-CNT                PIC S9(04)    VALUE +0        01580000
                                                        COMP SYNC.      01590000
          05  PV-SUMMED-ONORD-QTY         PIC S9(09)    VALUE +0        01600000
                                                        COMP-3.         01610000
          05  PV-CURRENT-DATE             PIC X(08)     VALUE SPACE.    01620000
          05  PV-6-MONTH-DATE.                                          01630000
            10  PV-6-MONTH-DATE-CC        PIC X(02)     VALUE SPACE.    01640000
            10  PV-6-MONTH-DATE-YYMMDD    PIC X(06)     VALUE SPACE.    01650000
          05  PV-6-MONTH-DATE-YYMMDD-SQL  PIC S9(07)V   COMP-3.         01660000
          05  PV-CALL-DEPT         PIC X(03)      VALUE SPACES.         01670000
          05  PV-CALL-MANAGER      PIC X(02)      VALUE SPACES.         01680000
          05  PV-DMM-NMBR          PIC 9(03)      VALUE ZEROS.          01690000
          05  PV-BUYER-NMBR        PIC 9(03)      VALUE ZEROS.          01700000
          05  PV-BUYER-NAME        PIC X(20)      VALUE SPACES.         01710000
          05  PV-ABEND-CODE        PIC S9(04)     VALUE +0              01720000
                                                  COMP SYNC.            01730000
          05  PV-PARA-NAME         PIC X(35).                           01740000
          05  PV-UNPACK-SU-DATE    PIC  9(06)     VALUE 0.              01750000
          05  PV-LN-CNT-FOR-TOT    PIC S9(03)     VALUE +99             01760000
                                                  COMP-3.               01770000
          05  PV-PAGE-CNT          PIC S9(05)     VALUE ZERO.           01780000
          05  PV-PAGE-DISSECT.                                          01790000
              10  FILLER              PIC 9(4).                         01800000
              10  PV-PAGE-LAST-DIGIT  PIC 9.                            01810000
                  88  PV-ODD              VALUE 1 3 5 7 9.              01820000
                                                                        01830000
          05  PV-CURR-RCD-KEY-1.                                        01840000
              10  PV-CURR-RCD-KEY.                                      01850000
                 15  PV-CURR-MGR-NBR      PIC 9(03)      VALUE ZEROES.  01860000
                 15  PV-CURR-BUYER        PIC 9(03)      VALUE ZEROES.  01870000
                 15  PV-CURR-DEPT         PIC 9(03)      VALUE ZEROES.  01880000
                 15  PV-CURR-CLASS        PIC 9(02)      VALUE ZEROES.  01890000
                 15  PV-CURR-SUBCLASS     PIC 9(02)      VALUE ZEROES.  01900000
                 15  PV-CURR-VNDR-NAME    PIC X(25)      VALUE SPACES.  01910000
                 15  PV-CURR-GROUP-CODE   PIC X(03)      VALUE SPACES.  01920000
                 15  PV-CURR-VNDR-STYLE   PIC X(20)      VALUE SPACES.  01930000
              10  PV-CURR-SKU             PIC X(08)      VALUE SPACES.  01940000
      *                                                                 01950000
          05  PV-PREV-RCD-KEY-1.                                        01960000
              10  PV-PREV-RCD-KEY.                                      01970000
                 15  PV-PREV-DV-KEY.                                    01980000
                     20  PV-PREV-MGR-NBR  PIC 9(03)      VALUE ZEROES.  01990000
                     20  PV-PREV-BUYER    PIC 9(03)      VALUE ZEROES.  02000000
                     20  PV-PREV-DEPT     PIC 9(03)      VALUE ZEROES.  02010000
                 15  PV-PREV-CLASS        PIC 9(02)      VALUE ZEROES.  02020000
                 15  PV-PREV-SUBCLASS     PIC 9(02)      VALUE ZEROES.  02030000
                 15  PV-PREV-VNDR-NAME    PIC X(25)      VALUE SPACES.  02040000
                 15  PV-PREV-GROUP-CODE   PIC X(03)      VALUE SPACES.  02050000
                 15  PV-PREV-VNDR-STYLE   PIC X(20)      VALUE SPACES.  02060000
              10  PV-PREV-SKU             PIC X(08)      VALUE SPACES.  02070000
          05  PV-DB2-OUT-DATE          PIC X(10)      VALUE SPACES.     02080000
          05  PV-CURRENT-WEEKDAY       PIC X(09)      VALUE SPACES.     02090000
          05  PV-DECREMENT-1ST         PIC 9(02)      VALUE ZERO.       02100000
          05  PV-NULL-INDICATORS.                                       02110000
              10  PV-SUMMED-ONORD-QTY-NULL        PIC S9(04) VALUE +0   02120000
                                                             COMP.      02130000
      *                                                                 02140000
       01 PS-PROGRAM-SWITCHES.                                          02150000
          05  PS-EOF-EXTRACT-FILE-SW   PIC X(1)     VALUE 'N'.          02160000
              88  PS-EOF-EXTRACT                   VALUE 'Y'.           02170000
          05  PS-END-OF-ONORD-CURS-SW PIC X(1)     VALUE 'N'.           02180000
              88  PS-END-OF-ONORD-CURS             VALUE 'N'.           02190000
              88  PS-NOT-END-OF-ONORD-CURS         VALUE 'Y'.           02200000
          05  PS-CURRENT-PROCESS-SW  PIC X(02)     VALUE '01'.          02210000
              88  PS-CURR-DTL-LINE1                VALUE '01'.          02220000
              88  PS-CURR-DTL-LINE2                VALUE '02'.          02230000
              88  PS-BREAK-NONE                    VALUE 'XX'.          02240000
              88  PS-BREAK-NO-HDG                  VALUE 'NH'.          02250000
              88  PS-BREAK-STYLE                   VALUE 'VS'.          02260000
              88  PS-BREAK-GC                      VALUE 'GC'.          02270000
              88  PS-BREAK-VN                      VALUE 'VN'.          02280000
              88  PS-BREAK-CLASS                   VALUE 'CL'.          02290000
              88  PS-BREAK-SUMCLASS                VALUE 'SC'.          02300000
              88  PS-BREAK-DEPT                    VALUE 'DP'.          02310000
              88  PS-BREAK-SUMDEPT                 VALUE 'SD'.          02320000
              88  PS-BREAK-DV                      VALUE 'DV'.          02330000
              88  PS-BREAK-DG                      VALUE 'DG'.          02340000
              88  PS-BREAK-BYR                     VALUE 'BY'.          02350000
              88  PS-BREAK-MGR                     VALUE 'MG'.          02360000
          05  PS-FIRST-TIME            PIC X(01)      VALUE 'Y'.        02370000
          05  PS-PAGE-BREAK-SW         PIC X(1)  VALUE 'N'.             02380000
              88  PS-PAGE-BREAK                    VALUE 'Y'.           02390000
              88  PS-NOPAGE-BREAK                   VALUE 'N'.          02400000
                                                                        02410000
       01 EP-EMPTY-PAGE.                                                02420000
          05  FILLER                  PIC X(49) VALUE SPACES.           02430000
          05  FILLER                  PIC X(83) VALUE                   02440000
              'THIS PAGE INTENTIONALLY LEFT BLANK'.                     02450000
                                                                        02460000
      *                                                                 02470000
      ******************************************************************02480000
      * DB2 ERROR MESSAGES FORMAT AREA.                                 02490000
      ******************************************************************02500000
           COPY DPWS004.                                                02510000
                                                                        02520000
      ******************************************************************02530000
      * CALENDAR ROUTINE WORK AREA.                                     02540000
      ******************************************************************02550000
           COPY DPWS500.                                                02560000
      *                                                                 02570000
      ******************************************************************02580000
      * KOHLS STANDARD 132 BYTE REPORT HEADER.                          02590000
      ******************************************************************02600000
      *                                                                 02610000
           COPY DPWS132O.                                               02620000
                                                                        02630000
      *                                                                 02640000
       01 H2-HEADING-LINE.                                              02650000
          05  FILLER               PIC X(01)      VALUE SPACE.          02660000
          05  FILLER               PIC X(57)      VALUE SPACES.         02670000
          05  FILLER               PIC X(32)      VALUE                 02680000
              'SKUS WITHOUT RECEIPTS           '.                       02690000
          05  FILLER               PIC X(40)      VALUE SPACE.          02700000
      *                                                                 02710000
       01 H3-HEADING-LINE.                                              02720000
          05  FILLER               PIC X(01)      VALUE SPACE.          02730000
          05  FILLER               PIC X(09)      VALUE 'MANAGER: '.    02740000
          05  H3-DMM-NBR           PIC 9(03)      VALUE ZEROES.         02750000
          05  H3-DMM-X REDEFINES H3-DMM-NBR                             02760000
                                   PIC X(03).                           02770000
          05  FILLER               PIC X(01)      VALUE '-'.            02780000
          05  H3-DMM-NAME          PIC X(20)      VALUE SPACES.         02790000
          05  FILLER               PIC X(167)     VALUE SPACES.         02800000
      *                                                                 02810000
       01 H4-HEADING-LINE.                                              02820000
          05  FILLER               PIC X(01)      VALUE SPACE.          02830000
          05  FILLER               PIC X(09)      VALUE 'BUYER:   '.    02840000
          05  H4-BUYER-NBR         PIC 9(03)      VALUE ZEROES.         02850000
          05  H4-BUYER-X REDEFINES H4-BUYER-NBR                         02860000
                                   PIC X(03).                           02870000
          05  FILLER               PIC X(01)      VALUE '-'.            02880000
          05  H4-BUYER-NAME        PIC X(20)      VALUE SPACES.         02890000
          05  FILLER               PIC X(167)     VALUE SPACES.         02900000
      *                                                                 02910000
       01 H5-HEADING-LINE.                                              02920000
          05  FILLER               PIC X(01)      VALUE SPACE.          02930000
          05  FILLER               PIC X(07)      VALUE 'DEPT : '.      02940000
          05  H5-DEPT-NMBR         PIC 9(03)      VALUE ZEROES.         02950000
          05  H5-DEPT-X REDEFINES H5-DEPT-NMBR                          02960000
                                   PIC X(03).                           02970000
          05  FILLER               PIC X(01)      VALUE '-'.            02980000
          05  H5-DEPT-DESC         PIC X(25)      VALUE SPACE.          02990000
      *                                                                 03000000
       01 H6-HEADING-LINE.                                              03010000
          05  FILLER               PIC X(05)      VALUE SPACE.          03020000
          05  FILLER               PIC X(08)                            03030000
              VALUE ' CL     '.                                         03040000
          05  FILLER               PIC X(08)                            03050000
              VALUE 'SBCL    '.                                         03060000
          05  FILLER               PIC X(08)                            03070000
              VALUE 'SKU NMBR'.                                         03080000
          05  FILLER               PIC X(03)      VALUE SPACE.          03090000
          05  FILLER               PIC X(25)                            03100000
              VALUE 'SKU DESCRIPTION         '.                         03110000
          05  FILLER               PIC X(02)      VALUE SPACE.          03120000
          05  FILLER               PIC X(10)                            03130000
              VALUE 'ONHAND QTY'.                                       03140000
          05  FILLER               PIC X(05)      VALUE SPACE.          03150000
          05  FILLER               PIC X(10)                            03160000
              VALUE 'SETUP DATE'.                                       03170000
          05  FILLER               PIC X(03)      VALUE SPACE.          03180000
      *                                                                 03190000
       01 H7-HEADING-LINE.                                              03200000
          05  FILLER               PIC X(05)      VALUE SPACE.          03210000
          05  FILLER               PIC X(08)                            03220000
              VALUE ' --     '.                                         03230000
          05  FILLER               PIC X(08)                            03240000
              VALUE '----    '.                                         03250000
          05  FILLER               PIC X(08)                            03260000
              VALUE '--------'.                                         03270000
          05  FILLER               PIC X(03)      VALUE SPACE.          03280000
          05  FILLER               PIC X(25)                            03290000
              VALUE '---------------         '.                         03300000
          05  FILLER               PIC X(02)      VALUE SPACE.          03310000
          05  FILLER               PIC X(10)                            03320000
              VALUE '----------'.                                       03330000
          05  FILLER               PIC X(05)      VALUE SPACE.          03340000
          05  FILLER               PIC X(13)                            03350000
              VALUE '----------'.                                       03360000
          05  FILLER               PIC X(03)      VALUE SPACE.          03370000
      *                                                                 03380000
       01 H8-HEADING-LINE.                                              03390000
          05  FILLER               PIC X(01)      VALUE SPACE.          03400000
          05  FILLER               PIC X(06)      VALUE 'CLASS:'.       03410000
          05  FILLER               PIC X(1)       VALUE '-'.            03420000
          05  H8-CLASS-DESC         PIC X(25).                          03430000
          05  FILLER               PIC X(03)      VALUE SPACE.          03440000
          05  FILLER               PIC X(10)      VALUE 'SUBCLASS: '.   03450000
          05  H8-SUBCLASS           PIC ZZ9.                            03460000
          05  FILLER               PIC X(1)       VALUE '-'.            03470000
          05  H8-SUBCLASS-DESC      PIC X(25).                          03480000
          05  FILLER               PIC X(54)      VALUE SPACES.         03490000
      *                                                                 03500000
       01 DL1-LINE.                                                     03510000
          05  FILLER               PIC X(05)      VALUE SPACE.          03520000
          05  DL1-CLASS            PIC ZZ9.                             03530000
          05  FILLER               PIC X(05)      VALUE SPACE.          03540000
          05  DL1-SUBCLASS         PIC ZZ9.                             03550000
          05  FILLER               PIC X(05)      VALUE SPACE.          03560000
          05  DL1-SKU              PIC X(08).                           03570000
          05  FILLER               PIC X(03)      VALUE SPACE.          03580000
          05  DL1-SKU-DESC         PIC X(25).                           03590000
          05  FILLER               PIC X(05)      VALUE SPACE.          03600000
          05  DL1-ONHAND-QTY       PIC Z(6)9-     VALUE ZERO.           03610000
          05  FILLER               PIC X(04)      VALUE SPACE.          03620000
          05  DL1-SETUP-CC         PIC X(2)       VALUE SPACE.          03630000
          05  DL1-SETUP-YY         PIC X(2)       VALUE SPACE.          03640000
          05  FILLER               PIC X          VALUE '-'.            03650000
          05  DL1-SETUP-MM         PIC X(2)       VALUE SPACE.          03660000
          05  FILLER               PIC X          VALUE '-'.            03670000
          05  DL1-SETUP-DD         PIC X(2)       VALUE SPACE.          03680000
          05  FILLER               PIC X(03)      VALUE SPACE.          03690000
      *                                                                 03700000
      ******************************************************************03710000
      * SQLCA AREA                                                      03720000
      ******************************************************************03730000
      *                                                                 03740000
           EXEC SQL                                                     03750000
               INCLUDE SQLCA                                            03760000
           END-EXEC.                                                    03770000
      *                                                                 03780000
      ******************************************************************03790000
      * TABLE DECLARATIONS FOR SKU XREF (TSKXREF)                       03800000
      ******************************************************************03810000
           EXEC SQL                                                     03820000
               INCLUDE TSKXREF                                          03830000
           END-EXEC.                                                    03840000
      ******************************************************************03850000
      * TABLE DECLARATIONS FOR FS SKU STORE (TSKST)                     03860000
      ******************************************************************03870000
           EXEC SQL                                                     03880000
               INCLUDE TSKST                                            03890000
           END-EXEC.                                                    03900000
      ******************************************************************03910000
      * TABLE DECLARATIONS FOR FS SKU (TSK)                             03920000
      ******************************************************************03930000
           EXEC SQL                                                     03940000
               INCLUDE TSK                                              03950000
           END-EXEC.                                                    03960000
      ******************************************************************03970000
      * TABLE DECLARATIONS FOR FS SKU STORE ON ORDER(TSKSTOO)           03980000
      ******************************************************************03990000
           EXEC SQL                                                     04000000
               INCLUDE TSKSTOO                                          04010000
           END-EXEC.                                                    04020000
      ******************************************************************04030000
      * TABLE DECLARATIONS FOR MB-RESPONSIBILITY AREA (TRSPBAR)         04040000
      ******************************************************************04050000
           EXEC SQL                                                     04060000
               INCLUDE TRSPBAR                                          04070000
           END-EXEC.                                                    04080000
      ******************************************************************04090000
      * TABLE DECLARATIONS FOR MB MERCHANDISE       (TMDSEAR)           04100000
      ******************************************************************04110000
      *                                                                 04120000
           EXEC SQL                                                     04130000
               INCLUDE TMDSEAR                                          04140000
           END-EXEC.                                                    04150000
      ******************************************************************04160000
      * TABLE DECLARATIONS FOR IT-VENDOR STYLE CHAR VALUE (TVSCHVL)     04170000
      ******************************************************************04180000
      *                                                                 04190000
           EXEC SQL                                                     04200000
               INCLUDE TVSCHVL                                          04210000
           END-EXEC.                                                    04220000
      *                                                                 04230000
      ******************************************************************04240000
      * CURSOR DECLARES                                                 04250000
      ******************************************************************04260000
      * CURSOR TO GET ALL THE SKUS WITHOUT RECEIPTS                     04270000
      ******************************************************************04280000
           EXEC SQL                                                     04290000
            DECLARE SKU_CURS  CURSOR FOR                                04300000
             SELECT DISTINCT                                            04310000
                 SKU.SKU                                                04320000
                ,SKU.ITM_NBR                                            04330000
                ,SKU.SKU_STAT_CDE                                       04340000
                ,SEAR.DMA_NBR                                           04350000
                ,SEAR.BYR_NBR                                           04360000
                ,SKU.DEPT                                               04370000
                ,SKU.CLASS                                              04380000
                ,SKU.SUBCLASS                                           04390000
                ,TSK1.SETUP_DATE                                        04400000
                ,TSK1.SKU_DESC                                          04410000
                ,ST.ONHAND_QTY                                          04420000
             FROM TSKXREF SKU                                           04430000
                 ,TSK     TSK1                                          04440000
                 ,TSKST   ST                                            04450000
                 ,TMDSEAR SEAR                                          04460000
             WHERE (TSK1.SETUP_DATE    < :PV-6-MONTH-DATE-YYMMDD-SQL    04470000
                OR TSK1.SETUP_DATE     > :PC-0500000)                   04480000
               AND TSK1.ITEM_NMBR      = SKU.ITM_NBR                    04490000
               AND SKU.ITM_NBR         = ST.ITEM_NMBR                   04500000
               AND SKU.SKU_STAT_CDE    IN ('10','20','40')              04510000
               AND ST.LOC_NBR          = 0                              04520000
               AND ST.FIRST_RCVD_DATE  = 0                              04530000
               AND SEAR.OPERCO_NBR     = '03'                           04540000
               AND SEAR.MDSELV_CDE     = 'DPT'                          04550000
               AND SKU.DEPT            = SMALLINT(RTRIM(SEAR.DEPT_NBR)) 04560000
               ORDER BY SEAR.DMA_NBR                                    04570000
                       ,SEAR.BYR_NBR                                    04580000
                       ,SKU.DEPT                                        04590000
                       ,SKU.CLASS                                       04600000
                       ,SKU.SUBCLASS                                    04610000
                       ,SKU.SKU                                         04620000
           END-EXEC.                                                    04630000
                                                                        04640000
      ******************************************************************04650000
      * CURSOR TO GET ALL THE OPEN ORDER QTY FOR AN ITEM                04660000
      ******************************************************************04670000
           EXEC SQL                                                     04680000
            DECLARE ONORD_CURS   CURSOR FOR                             04690000
               SELECT  OO.ONORD_UNT_QTY                                 04700000
                 FROM  TSKSTOO OO                                       04710000
                WHERE  OO.ITM_NBR         = :SKXREF-ITM-NBR             04720000
           END-EXEC.                                                    04730000
                                                                        04740000
      ******************************************************************04750000
       PROCEDURE DIVISION.                                              04760000
      ******************************************************************04770000
      *                                                                 04780000
          EJECT                                                         04790000
       0000-MAINLINE-PROCESSING.                                        04800000
      ******************************************************************04810000
      * MAIN PROCESSING ROUTINE                                       * 04820000
      ******************************************************************04830000
                                                                        04840000
            PERFORM 1000-INIT.                                          04850000
                                                                        04860000
            PERFORM 4300-FETCH-SKU-CURS.                                04870000
            PERFORM 2000-PROCESS-SKUS                                   04880000
              UNTIL PS-EOF-EXTRACT.                                     04890000
                                                                        04900000
            PERFORM 9000-END-OF-JOB.                                    04910000
                                                                        04920000
            GOBACK.                                                     04930000
                                                                        04940000
      ******************************************************************04950000
      * OPEN FILES AND CURSOR, GET CURRENT DATE AND TIME FROM DB2.     *04960000
      ******************************************************************04970000
      *                                                                 04980000
       1000-INIT.                                                       04990000
            MOVE '*1000-INIT.              *' TO PV-PARA-NAME.          05000000
            OPEN OUTPUT SKU-REPORT-FILE.                                05010000
                                                                        05020000
            SET PS-CURR-DTL-LINE1 TO TRUE                               05030000
                                                                        05040000
      ***   POPULATE HEADINGS                                           05050000
            PERFORM 9900-GET-DATE-TIME.                                 05060000
            PERFORM 9910-DECREMENT-CURRENT-DATE.                        05070000
            MOVE SD-SYSTEM-YEAR          TO DP132O-RUN-YEAR.            05080000
            MOVE SD-SYSTEM-MONTH         TO DP132O-RUN-MONTH.           05090000
            MOVE SD-SYSTEM-DAY           TO DP132O-RUN-DAY.             05100000
            MOVE ST-SYSTEM-HOUR          TO DP132O-RUN-HOUR.            05110000
            MOVE ST-SYSTEM-MINUTE        TO DP132O-RUN-MINUTE.          05120000
            MOVE 'FSKRP124'              TO DP132O-PROGRAM-NAME.        05130000
            MOVE  1                      TO DP132O-REPORT-NUMBER.       05140000
                                                                        05150000
            PERFORM 8400-CALENDAR-DAY-OF-WEEK.                          05160000
                                                                        05170000
            PERFORM 4200-OPEN-SKU-CURS.                                 05180000
      *                                                                 05190000
      ******************************************************************05200000
      * PROCESS SKUS WITHOUT RECEIPTS                                 * 05210000
      ******************************************************************05220000
       2000-PROCESS-SKUS.                                               05230000
            MOVE MDSEAR-DMA-NBR          TO PV-CURR-MGR-NBR.            05240000
            MOVE MDSEAR-BYR-NBR          TO PV-CURR-BUYER.              05250000
            MOVE SKXREF-DEPT             TO PV-CURR-DEPT.               05260000
            MOVE SKXREF-CLASS            TO PV-CURR-CLASS.              05270000
            MOVE SKXREF-SUBCLASS         TO PV-CURR-SUBCLASS.           05280000
            MOVE SKXREF-DEPT             TO PV-CURR-DEPT.               05290000
      * CHECK FOR PAGE BREAK                                            05300000
            IF PV-CURR-MGR-NBR NOT = PV-PREV-MGR-NBR                    05310000
              OR PV-CURR-BUYER NOT = PV-PREV-BUYER                      05320000
              OR PV-CURR-DEPT NOT  = PV-PREV-DEPT                       05330000
                PERFORM 5999-SKIP-PAGE-LOGIC                            05340000
      *  GET MANANGER NAME                                              05350000
                MOVE PV-CURR-MGR-NBR (2:2) TO PV-CALL-MANAGER           05360000
                PERFORM 7000-SELECT-MANAGER-NAME                        05370000
                MOVE PV-CURR-MGR-NBR TO H3-DMM-NBR                      05380000
                MOVE PV-BUYER-NAME TO H3-DMM-NAME                       05390000
      *  GET DEPT DESC                                                  05400000
                MOVE PV-CURR-DEPT TO PV-CALL-DEPT                       05410000
                                     H5-DEPT-NMBR                       05420000
                PERFORM 7300-SELECT-DEPT-NAME                           05430000
                MOVE MDSEAR-DESC         TO H5-DEPT-DESC                05440000
      * GET BUYER NAME                                                  05450000
                MOVE MDSEAR-BYR-NBR TO CB-CALL-BUYER                    05460000
                PERFORM 7100-SELECT-BUYER-NAME                          05470000
                MOVE MDSEAR-BYR-NBR      TO H4-BUYER-NBR                05480000
                MOVE PV-BUYER-NAME       TO H4-BUYER-NAME               05490000
                MOVE PV-CURR-CLASS       TO DL1-CLASS                   05500000
                MOVE PV-CURR-SUBCLASS    TO DL1-SUBCLASS                05510000
                SET PS-PAGE-BREAK TO TRUE                               05520000
      * SET BREAK FIELDS                                                05530000
                MOVE PV-CURR-MGR-NBR     TO PV-PREV-MGR-NBR             05540000
                MOVE PV-CURR-BUYER       TO PV-PREV-BUYER               05550000
                MOVE PV-CURR-DEPT        TO PV-PREV-DEPT                05560000
                MOVE PV-CURR-SUBCLASS    TO PV-PREV-SUBCLASS            05570000
                MOVE PV-CURR-CLASS       TO PV-PREV-CLASS.              05580000
      * MID PAGE BREAK ON SUBCLASS, NOT A FULL PAGE BREAK               05590000
            IF PV-CURR-SUBCLASS NOT = PV-PREV-SUBCLASS                  05600000
              MOVE SPACE TO SKU-RPT-LINE                                05610000
              WRITE SKU-RPT-LINE                                        05620000
              MOVE PV-CURR-CLASS         TO DL1-CLASS                   05630000
              MOVE PV-CURR-SUBCLASS      TO PV-PREV-SUBCLASS            05640000
                                          DL1-SUBCLASS                  05650000
              ADD +3                     TO PV-LN-CNT-FOR-TOT           05660000
              MOVE PV-CURR-CLASS         TO PV-PREV-CLASS               05670000
              MOVE PV-CURR-SUBCLASS      TO PV-PREV-SUBCLASS.           05680000
            MOVE SKXREF-SKU              TO DL1-SKU.                    05690000
            MOVE TSK-SKU-DESC            TO DL1-SKU-DESC.               05700000
            MOVE TSKST-ONHAND-QTY        TO DL1-ONHAND-QTY.             05710000
            MOVE TSK-SETUP-DATE          TO PV-UNPACK-SU-DATE.          05720000
            MOVE PV-UNPACK-SU-DATE (1:2) TO DL1-SETUP-YY.               05730000
            MOVE PV-UNPACK-SU-DATE (3:2) TO DL1-SETUP-MM.               05740000
            MOVE PV-UNPACK-SU-DATE (5:2) TO DL1-SETUP-DD.               05750000
            IF DL1-SETUP-YY > '50'                                      05760000
              MOVE '19'                  TO DL1-SETUP-CC                05770000
            ELSE                                                        05780000
              MOVE '20'                  TO DL1-SETUP-CC.               05790000
      * GET AND SUM THE ON ORDER QTYS FOR AN ITEM                       05800000
            MOVE 0                       TO PV-SUMMED-ONORD-QTY.        05810000
            SET PS-NOT-END-OF-ONORD-CURS TO TRUE.                       05820000
            PERFORM 4700-OPEN-ONORD-CURS.                               05830000
            PERFORM 4800-FETCH-ONORD-CURS.                              05840000
            PERFORM UNTIL PS-END-OF-ONORD-CURS                          05850000
              PERFORM 4800-FETCH-ONORD-CURS                             05860000
            END-PERFORM.                                                05870000
            PERFORM 4900-CLOSE-ONORD-CURS.                              05880000
      *     ONLY SKUS WITH NO ON ORDER QTY WILL BE PUT ON THE REPORT.   05890000
            IF PV-SUMMED-ONORD-QTY = 0                                  05900000
              PERFORM 3000-PRT-CURR-DTL-RECS                            05910000
            END-IF.                                                     05920000
            PERFORM 4300-FETCH-SKU-CURS.                                05930000
      *                                                                 05940000
      ******************************************************************05950000
      * LOAD DETAIL LINE OF REPORT                                     *05960000
      ******************************************************************05970000
       3000-PRT-CURR-DTL-RECS.                                          05980000
            COMPUTE PV-LN-CNT-FOR-TOT = PV-LN-CNT-FOR-TOT + 1           05990000
            IF  PV-LN-CNT-FOR-TOT > PC-MAX-PAGE-LINES                   06000000
              OR PS-PAGE-BREAK                                          06010000
                PERFORM 6000-PRINT-HEADINGS                             06020000
                SET PS-NOPAGE-BREAK TO TRUE                             06030000
                MOVE +11 TO PV-LN-CNT-FOR-TOT                           06040000
            END-IF.                                                     06050000
            MOVE DL1-LINE TO SKU-RPT-LINE.                              06060000
            WRITE SKU-RPT-LINE.                                         06070000
      *                                                                 06080000
      ******************************************************************06090000
      * OPEN SKU-CURS CURSOR FOR PROCESSING                             06100000
      ******************************************************************06110000
       4200-OPEN-SKU-CURS.                                              06120000
                                                                        06130000
           EXEC SQL                                                     06140000
               OPEN SKU_CURS                                            06150000
           END-EXEC.                                                    06160000
                                                                        06170000
           IF SQLCODE NOT = +0                                          06180000
             MOVE SQLCODE TO PV-SQLCODE                                 06190000
                                                                        06200000
             DISPLAY '                                 '                06210000
             DISPLAY '*********************************'                06220000
             DISPLAY 'PARAGRAPH     : 4200-OPEN-SKU-CURS'               06230000
             DISPLAY 'ERROR OPENING SKU_CURS CURSOR:   '                06240000
             DISPLAY 'SQLCODE       : ' PV-SQLCODE                      06250000
             DISPLAY '*********************************'                06260000
             DISPLAY '                                 '                06270000
                                                                        06280000
             STRING 'ERROR OPENING SKU_CURS CURSOR SQLCODE= '           06290000
                    PV-SQLCODE DELIMITED BY SIZE INTO                   06300000
                    PV-OPERATION-MSG                                    06310000
             END-STRING                                                 06320000
                                                                        06330000
             MOVE '4200-OPEN-SKU-CURS' TO PV-PARA-NAME                  06340000
                                                                        06350000
             PERFORM 9999-SQL-ERROR                                     06360000
                                                                        06370000
           END-IF.                                                      06380000
                                                                        06390000
                                                                        06400000
      ******************************************************************06410000
      * FETCH SKU_CURS FOR PROCESSING                                   06420000
      ******************************************************************06430000
       4300-FETCH-SKU-CURS.                                             06440000
                                                                        06450000
           EXEC SQL                                                     06460000
               FETCH SKU_CURS                                           06470000
               INTO :SKXREF-SKU                                         06480000
                   ,:SKXREF-ITM-NBR                                     06490000
                   ,:SKXREF-SKU-STAT-CDE                                06500000
                   ,:MDSEAR-DMA-NBR                                     06510000
                   ,:MDSEAR-BYR-NBR                                     06520000
                   ,:SKXREF-DEPT                                        06530000
                   ,:SKXREF-CLASS                                       06540000
                   ,:SKXREF-SUBCLASS                                    06550000
                   ,:TSK-SETUP-DATE                                     06560000
                   ,:TSK-SKU-DESC                                       06570000
                   ,:TSKST-ONHAND-QTY                                   06580000
           END-EXEC.                                                    06590000
                                                                        06600000
           EVALUATE TRUE                                                06610000
             WHEN SQLCODE = +0                                          06620000
               ADD 1 TO PV-CURS-CNT                                     06630000
             WHEN SQLCODE = +100                                        06640000
               SET PS-EOF-EXTRACT TO TRUE                               06650000
                                                                        06660000
             WHEN OTHER                                                 06670000
               MOVE SQLCODE TO PV-SQLCODE                               06680000
                                                                        06690000
               DISPLAY '                                 '              06700000
               DISPLAY '*********************************'              06710000
               DISPLAY 'PARAGRAPH     : 4300-FETCH-SKU-CURS'            06720000
               DISPLAY 'ERROR FETCHING SKU_CURS CURSOR:   '             06730000
               DISPLAY 'SQLCODE       : ' PV-SQLCODE                    06740000
               DISPLAY '*********************************'              06750000
               DISPLAY '                                 '              06760000
                                                                        06770000
               STRING 'ERROR FETCHING SKU_CURS CURSOR SQLCODE= '        06780000
                      PV-SQLCODE DELIMITED BY SIZE INTO                 06790000
                      PV-OPERATION-MSG                                  06800000
               END-STRING                                               06810000
                                                                        06820000
               MOVE '4300-FETCH-SKU-CURS' TO PV-PARA-NAME               06830000
                                                                        06840000
               PERFORM 9999-SQL-ERROR                                   06850000
                                                                        06860000
           END-EVALUATE.                                                06870000
                                                                        06880000
                                                                        06890000
      ******************************************************************06900000
      * CLOSE SKU-CURS CURSOR                                           06910000
      ******************************************************************06920000
       4400-CLOSE-SKU-CURS.                                             06930000
                                                                        06940000
           EXEC SQL                                                     06950000
               CLOSE SKU_CURS                                           06960000
           END-EXEC.                                                    06970000
                                                                        06980000
           EVALUATE TRUE                                                06990000
             WHEN SQLCODE = +0                                          07000000
               CONTINUE                                                 07010000
             WHEN OTHER                                                 07020000
               DISPLAY '                                 '              07030000
               DISPLAY '*********************************'              07040000
               DISPLAY 'PARAGRAPH     : 4400-CLOSE-SKU-CURS'            07050000
               DISPLAY 'ERROR CLOSING SKU-CURS CURSOR:   '              07060000
               DISPLAY 'SQLCODE       : ' PV-SQLCODE                    07070000
               DISPLAY '*********************************'              07080000
               DISPLAY '                                 '              07090000
           END-EVALUATE.                                                07100000
                                                                        07110000
                                                                        07120000
      ******************************************************************07130000
      * OPEN ONORD_CURS CURSOR FOR PROCESSING                           07140000
      ******************************************************************07150000
       4700-OPEN-ONORD-CURS.                                            07160000
                                                                        07170000
           EXEC SQL                                                     07180000
               OPEN ONORD_CURS                                          07190000
           END-EXEC.                                                    07200000
                                                                        07210000
           IF SQLCODE NOT = +0                                          07220000
             MOVE SQLCODE TO PV-SQLCODE                                 07230000
                                                                        07240000
             DISPLAY '                                 '                07250000
             DISPLAY '*********************************'                07260000
             DISPLAY 'PARAGRAPH     : 4700-OPEN-ONORD-CURS'             07270000
             DISPLAY 'ERROR OPENING SKU_CURS CURSOR:   '                07280000
             DISPLAY 'SQLCODE       : ' PV-SQLCODE                      07290000
             DISPLAY '*********************************'                07300000
             DISPLAY '                                 '                07310000
                                                                        07320000
             STRING 'ERROR OPENING ONORD_CURS CURSOR SQLCODE= '         07330000
                    PV-SQLCODE DELIMITED BY SIZE INTO                   07340000
                    PV-OPERATION-MSG                                    07350000
             END-STRING                                                 07360000
                                                                        07370000
             MOVE '4700-OPEN-ONORD-CURS' TO PV-PARA-NAME                07380000
                                                                        07390000
             PERFORM 9999-SQL-ERROR                                     07400000
                                                                        07410000
           END-IF.                                                      07420000
                                                                        07430000
                                                                        07440000
      ******************************************************************07450000
      * FETCH ONORD_CURS FOR PROCESSING                                 07460000
      ******************************************************************07470000
       4800-FETCH-ONORD-CURS.                                           07480000
                                                                        07490000
           EXEC SQL                                                     07500000
               FETCH ONORD_CURS                                         07510000
               INTO :SKSTOO-ONORD-UNT-QTY:PV-SUMMED-ONORD-QTY-NULL      07520000
           END-EXEC.                                                    07530000
                                                                        07540000
           EVALUATE TRUE                                                07550000
             WHEN SQLCODE = +0                                          07560000
               IF PV-SUMMED-ONORD-QTY-NULL = 0                          07570000
                 COMPUTE PV-SUMMED-ONORD-QTY = PV-SUMMED-ONORD-QTY +    07580000
                   SKSTOO-ONORD-UNT-QTY                                 07590000
               END-IF                                                   07600000
             WHEN SQLCODE = +100                                        07610000
               SET PS-END-OF-ONORD-CURS TO TRUE                         07620000
                                                                        07630000
             WHEN OTHER                                                 07640000
               MOVE SQLCODE TO PV-SQLCODE                               07650000
                                                                        07660000
               DISPLAY '                                 '              07670000
               DISPLAY '*********************************'              07680000
               DISPLAY 'PARAGRAPH     : 4800-FETCH-ONORD-CURS'          07690000
               DISPLAY 'ERROR FETCHING ONORD_CURS CURSOR:   '           07700000
               DISPLAY 'SQLCODE       : ' PV-SQLCODE                    07710000
               DISPLAY '*********************************'              07720000
               DISPLAY '                                 '              07730000
                                                                        07740000
               STRING 'ERROR FETCHING ONORD_CURS CURSOR SQLCODE= '      07750000
                      PV-SQLCODE DELIMITED BY SIZE INTO                 07760000
                      PV-OPERATION-MSG                                  07770000
               END-STRING                                               07780000
                                                                        07790000
               MOVE '4800-FETCH-ONORD-CURS' TO PV-PARA-NAME             07800000
                                                                        07810000
               PERFORM 9999-SQL-ERROR                                   07820000
                                                                        07830000
           END-EVALUATE.                                                07840000
                                                                        07850000
                                                                        07860000
      ******************************************************************07870000
      * CLOSE ONORD_CURS CURSOR                                         07880000
      ******************************************************************07890000
       4900-CLOSE-ONORD-CURS.                                           07900000
                                                                        07910000
           EXEC SQL                                                     07920000
               CLOSE ONORD_CURS                                         07930000
           END-EXEC.                                                    07940000
                                                                        07950000
           EVALUATE TRUE                                                07960000
             WHEN SQLCODE = +0                                          07970000
               CONTINUE                                                 07980000
             WHEN OTHER                                                 07990000
               DISPLAY '                                 '              08000000
               DISPLAY '*********************************'              08010000
               DISPLAY 'PARAGRAPH     : 4900-CLOSE-ONORD-CURS'          08020000
               DISPLAY 'ERROR CLOSING ONORD_CURS CURSOR:   '            08030000
               DISPLAY 'SQLCODE       : ' PV-SQLCODE                    08040000
               DISPLAY '*********************************'              08050000
               DISPLAY '                                 '              08060000
           END-EVALUATE.                                                08070000
                                                                        08080000
      *                                                                 08090000
      ******************************************************************08100000
      * ON A PAGE BREAK IF THE PAGE NUMBER IS ODD, SKIP A PAGE          08110000
      * SINCE THIS REPORT IS PRINTED DUPLEX.                            08120000
      ******************************************************************08130000
       5999-SKIP-PAGE-LOGIC.                                            08140000
           MOVE PV-PAGE-CNT TO PV-PAGE-DISSECT.                         08150000
           IF PV-ODD                                                    08160000
             PERFORM 6000-PRINT-HEADINGS                                08170000
             MOVE SPACE         TO SKU-RPT-LINE                         08180000
             WRITE SKU-RPT-LINE                                         08190000
             MOVE EP-EMPTY-PAGE TO SKU-RPT-LINE                         08200000
             WRITE SKU-RPT-LINE                                         08210000
           END-IF.                                                      08220000
      ******************************************************************08230000
      * FORMAT AND PRINT HEADINGS.                                    * 08240000
      ******************************************************************08250000
       6000-PRINT-HEADINGS.                                             08260000
           ADD +1 TO PV-PAGE-CNT.                                       08270000
           MOVE PV-PAGE-CNT TO DP132O-PAGE-NUMBER.                      08280000
           MOVE DP132O-STANDRD-HEADER-132-COLS TO SKU-RPT-LINE.         08290000
           MOVE PC-ADV-PAGE-SYMBOL TO SKU-RPT-LINE(1:1)                 08300000
           WRITE SKU-RPT-LINE.                                          08310000
           MOVE SPACES TO DP132O-LASER-NEW-PAGE-INDICATR.               08320000
           MOVE H2-HEADING-LINE TO SKU-RPT-LINE.                        08330000
           WRITE SKU-RPT-LINE.                                          08340000
           MOVE H3-HEADING-LINE TO SKU-RPT-LINE.                        08350000
           WRITE SKU-RPT-LINE.                                          08360000
           MOVE H4-HEADING-LINE TO SKU-RPT-LINE.                        08370000
           WRITE SKU-RPT-LINE                                           08380000
           MOVE SPACE TO SKU-RPT-LINE.                                  08390000
           WRITE SKU-RPT-LINE.                                          08400000
           MOVE H5-HEADING-LINE TO SKU-RPT-LINE.                        08410000
           WRITE SKU-RPT-LINE.                                          08420000
           MOVE SPACE           TO SKU-RPT-LINE.                        08430000
           WRITE SKU-RPT-LINE.                                          08440000
           MOVE H6-HEADING-LINE TO SKU-RPT-LINE.                        08450000
           WRITE SKU-RPT-LINE.                                          08460000
           MOVE H7-HEADING-LINE TO SKU-RPT-LINE.                        08470000
           WRITE SKU-RPT-LINE.                                          08480000
                                                                        08490000
      *                                                                 08500000
      ******************************************************************08510000
      * SELECT THE DIVISIONAL MERCHANDISE MANAGER NAME                * 08520000
      ******************************************************************08530000
       7000-SELECT-MANAGER-NAME.                                        08540000
           MOVE '*7000-SELECT-MANAGER-NAME.       *' TO PV-PARA-NAME.   08550000
           PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     08560000
             UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      08570000
             EXEC SQL                                                   08580000
              SELECT B.WORKER_FIR_NAME,                                 08590000
                     B.WORKER_LAST_NAME                                 08600000
               INTO  :RSPBAR-WORKER-FIR-NAME,                           08610000
                     :RSPBAR-WORKER-LAST-NAME                           08620000
               FROM  TMDSEAR A, TRSPBAR B                               08630000
               WHERE A.OPERCO_NBR  = :PC-OPERCO-NBR                     08640000
                 AND A.DMA_NBR     = :PV-CALL-MANAGER                   08650000
                 AND A.MDSELV_CDE  = :PC-MANAGER-CODE                   08660000
                 AND A.MDSEAR_DKEY = B.MDSEAR_DKEY                      08670000
                 AND A.OPERCO_NBR  = B.OPERCO_NBR                       08680000
                 AND CURRENT DATE BETWEEN A.STRT_DTE AND A.END_DTE      08690000
                 AND B.RSPLVL_CDE  = :PC-RSPLVL-MANAGER                 08700000
                 AND CURRENT DATE BETWEEN B.WORKER_STRT_DTE AND         08710000
                   B.WORKER_END_DTE                                     08720000
             END-EXEC                                                   08730000
      *                                                                 08740000
             MOVE SQLCODE              TO FS-MANAGER-NAME-CODE          08750000
             EVALUATE TRUE                                              08760000
                WHEN SQLCODE = +0                                       08770000
                   MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT          08780000
                   IF RSPBAR-WORKER-FIR-NAME = '---OPEN---'             08790000
                                            OR '***OPEN***'             08800000
                                            OR '*** OPEN ***'           08810000
                                            OR '--- OPEN ---'           08820000
                   MOVE SPACE TO PV-BUYER-NAME                          08830000
                   STRING RSPBAR-WORKER-FIR-NAME                        08840000
                           DELIMITED BY PC-FIRST-NAME-DELIM             08850000
                          PC-SPACE                                      08860000
                           DELIMITED BY SIZE                            08870000
                      INTO PV-BUYER-NAME                                08880000
                   END-STRING                                           08890000
                   ELSE                                                 08900000
                   STRING RSPBAR-WORKER-FIR-NAME                        08910000
                           DELIMITED BY PC-FIRST-NAME-DELIM             08920000
                          PC-SPACE                                      08930000
                           DELIMITED BY SIZE                            08940000
                          RSPBAR-WORKER-LAST-NAME                       08950000
                           DELIMITED BY SIZE                            08960000
                      INTO PV-BUYER-NAME                                08970000
                   END-STRING                                           08980000
                   END-IF                                               08990000
                WHEN FS-MANAGER-NAME-NOT-FOUND                          09000000
                   MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT          09010000
                   MOVE 'NOT ON TRSPBAR' TO PV-BUYER-NAME               09020000
                WHEN SQLCODE = -911                                     09030000
                WHEN SQLCODE = -913                                     09040000
                   CONTINUE                                             09050000
                WHEN OTHER                                              09060000
                   PERFORM 9999-SQL-ERROR                               09070000
             END-EVALUATE                                               09080000
           END-PERFORM.                                                 09090000
      *                                                                 09100000
           IF (SQLWARN0 NOT = SPACES                                    09110000
             OR (SQLCODE > 0 AND SQLCODE NOT = +100)                    09120000
             OR SQLCODE < 0)                                            09130000
               PERFORM 9999-SQL-ERROR                                   09140000
           END-IF.                                                      09150000
      *                                                                 09160000
      ******************************************************************09170000
      * SELECT THE BUYER NAME                                         * 09180000
      ******************************************************************09190000
       7100-SELECT-BUYER-NAME.                                          09200000
           MOVE '*7100-SELECT-BUYER-NAME.       *' TO PV-PARA-NAME.     09210000
           PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     09220000
             UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      09230000
             EXEC SQL                                                   09240000
              SELECT B.WORKER_FIR_NAME,                                 09250000
                     B.WORKER_LAST_NAME                                 09260000
               INTO  :RSPBAR-WORKER-FIR-NAME,                           09270000
                     :RSPBAR-WORKER-LAST-NAME                           09280000
               FROM  TMDSEAR A, TRSPBAR B                               09290000
               WHERE A.OPERCO_NBR  = :PC-OPERCO-NBR                     09300000
                 AND A.DEPT_NBR    = :PV-CALL-DEPT                      09310000
                 AND A.MDSELV_CDE  = :PC-DEPT-CODE                      09320000
                 AND A.BYR_NBR     = :CB-CALL-BUYER                     09330000
                 AND A.MDSEAR_DKEY = B.MDSEAR_DKEY                      09340000
                 AND A.OPERCO_NBR  = B.OPERCO_NBR                       09350000
                 AND CURRENT DATE BETWEEN A.STRT_DTE AND A.END_DTE      09360000
                 AND B.RSPLVL_CDE  = :PC-RSPLVL-BUYER                   09370000
                 AND CURRENT DATE BETWEEN B.WORKER_STRT_DTE AND         09380000
                   B.WORKER_END_DTE                                     09390000
             END-EXEC                                                   09400000
      *                                                                 09410000
             MOVE SQLCODE              TO FS-BUYER-NAME-CODE            09420000
             EVALUATE TRUE                                              09430000
                WHEN SQLCODE = +0                                       09440000
                   MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT          09450000
                   IF RSPBAR-WORKER-FIR-NAME = '---OPEN---'             09460000
                                            OR '***OPEN***'             09470000
                                            OR '*** OPEN ***'           09480000
                                            OR '--- OPEN ---'           09490000
                   MOVE SPACE TO PV-BUYER-NAME                          09500000
                   STRING RSPBAR-WORKER-FIR-NAME                        09510000
                           DELIMITED BY PC-FIRST-NAME-DELIM             09520000
                          PC-SPACE                                      09530000
                           DELIMITED BY SIZE                            09540000
                      INTO PV-BUYER-NAME                                09550000
                   END-STRING                                           09560000
                   ELSE                                                 09570000
                   STRING RSPBAR-WORKER-FIR-NAME                        09580000
                           DELIMITED BY PC-FIRST-NAME-DELIM             09590000
                          PC-SPACE                                      09600000
                           DELIMITED BY SIZE                            09610000
                          RSPBAR-WORKER-LAST-NAME                       09620000
                           DELIMITED BY SIZE                            09630000
                      INTO PV-BUYER-NAME                                09640000
                   END-STRING                                           09650000
                   END-IF                                               09660000
                WHEN FS-BUYER-NAME-NOT-FOUND                            09670000
                   MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT          09680000
                   MOVE 'NOT ON TRSPBAR' TO PV-BUYER-NAME               09690000
                WHEN SQLCODE = -911                                     09700000
                WHEN SQLCODE = -913                                     09710000
                   CONTINUE                                             09720000
                WHEN OTHER                                              09730000
                   PERFORM 9999-SQL-ERROR                               09740000
             END-EVALUATE                                               09750000
           END-PERFORM.                                                 09760000
      *                                                                 09770000
           IF (SQLWARN0 NOT = SPACES                                    09780000
             OR (SQLCODE > 0 AND SQLCODE NOT = +100)                    09790000
             OR SQLCODE < 0)                                            09800000
               PERFORM 9999-SQL-ERROR                                   09810000
           END-IF.                                                      09820000
      *                                                                 09830000
      ******************************************************************09840000
      * RETRIEVE DEPARTMENT DESCRIPTION FROM MBS TABLES               * 09850000
      ******************************************************************09860000
       7300-SELECT-DEPT-NAME.                                           09870000
           MOVE '*7300-SELECT-DEPT-NAME         *' TO PV-PARA-NAME.     09880000
           PERFORM                                                      09890000
              VARYING PV-RETRY-CNT                                      09900000
              FROM 1 BY 1                                               09910000
              UNTIL   PV-RETRY-CNT > PC-MAX-RETRY-CNT                   09920000
                                                                        09930000
               EXEC SQL                                                 09940000
                  SELECT MDSEAR_DESC                                    09950000
                   INTO  :MDSEAR-DESC                                   09960000
                   FROM  TMDSEAR                                        09970000
                   WHERE OPERCO_NBR = :PC-OPERCO-NBR                    09980000
                     AND DEPT_NBR   = :PV-CALL-DEPT                     09990000
                     AND MDSELV_CDE = :PC-DEPT-CODE                     10000000
                     AND CURRENT DATE BETWEEN STRT_DTE AND END_DTE      10010000
               END-EXEC                                                 10020000
              EVALUATE TRUE                                             10030000
                 WHEN SQLCODE = +0                                      10040000
                    MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT         10050000
                 WHEN SQLCODE = +100                                    10060000
                    MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT         10070000
                    MOVE 'NOT ON TMDSEAR' TO MDSEAR-DESC                10080000
                 WHEN SQLCODE = -911                                    10090000
                 WHEN SQLCODE = -913                                    10100000
                    CONTINUE                                            10110000
                 WHEN OTHER                                             10120000
                    PERFORM 9999-SQL-ERROR                              10130000
              END-EVALUATE                                              10140000
           END-PERFORM.                                                 10150000
                                                                        10160000
           IF (SQLWARN0 NOT = SPACES                                    10170000
             OR (SQLCODE > 0 AND SQLCODE NOT = +100)                    10180000
             OR SQLCODE < 0)                                            10190000
               PERFORM 9999-SQL-ERROR                                   10200000
           END-IF.                                                      10210000
      *                                                                 10220000
       8400-CALENDAR-DAY-OF-WEEK.                                       10230000
                                                                        10240000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              10250000
           MOVE 'F4'                 TO DPG51-CALENDAR-TYPE.            10260000
           SET DPG51-DO-NOT-INCR-DECR-DATE                              10270000
                                      TO TRUE                           10280000
                                                                        10290000
           SET  DPG52-LK-DTE-ISO-FMT TO TRUE.                           10300000
           MOVE SA-CURRENT-DATE      TO DPG52-LK-DATE-INPUT.            10310000
                                                                        10320000
           CALL DP500-KOHLS-CALENDAR-ROUTINE                            10330000
               USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               10340000
                                                                        10350000
           EVALUATE TRUE                                                10360000
               WHEN DPG54-SEVERE-ERROR                                  10370000
                   DISPLAY '** ABEND **'                                10380000
                   DISPLAY '** PGM = FSKRP124'                          10390000
                   DISPLAY '** 8400-CALENDAR-DAY-OF-WEEK'               10400000
                   DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE. '  10410000
                   DISPLAY '** ERROR MESSAGE = '                        10420000
                           DPG54-ERROR-MESSAGE                          10430000
                   DISPLAY '** DPG51 = ' DPG51                          10440000
                   DISPLAY '** DPG52 = ' DPG52                          10450000
                   DISPLAY '** DPG53 = ' DPG53                          10460000
                   DISPLAY '** DPG54 = ' DPG54                          10470000
                   MOVE +4003 TO ABEND-CODE                             10480000
                   CALL 'ILBOABN0' USING ABEND-CODE                     10490000
               WHEN OTHER                                               10500000
                   CONTINUE                                             10510000
           END-EVALUATE.                                                10520000
                                                                        10530000
           MOVE DPG55-DB2-ISO-DATE-FMT TO PV-DB2-OUT-DATE               10540000
           MOVE DPG55-ALPHA-WEEK-DAY   TO PV-CURRENT-WEEKDAY.           10550000
           DISPLAY 'WEEK DAY: ', PV-CURRENT-WEEKDAY.                    10560000
                                                                        10570000
           EVALUATE PV-CURRENT-WEEKDAY                                  10580000
               WHEN 'SUNDAY   '                                         10590000
                    MOVE 7 TO PV-DECREMENT-1ST                          10600000
               WHEN 'MONDAY   '                                         10610000
                    MOVE 8 TO PV-DECREMENT-1ST                          10620000
               WHEN 'TUESDAY  '                                         10630000
                    MOVE 9 TO PV-DECREMENT-1ST                          10640000
               WHEN 'WEDNESDAY'                                         10650000
                    MOVE 10 TO PV-DECREMENT-1ST                         10660000
               WHEN 'THURSDAY '                                         10670000
                    MOVE 11 TO PV-DECREMENT-1ST                         10680000
               WHEN 'FRIDAY   '                                         10690000
                    MOVE 12 TO PV-DECREMENT-1ST                         10700000
               WHEN 'SATURDAY '                                         10710000
                    MOVE 13 TO PV-DECREMENT-1ST                         10720000
           END-EVALUATE.                                                10730000
      *                                                                 10740000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              10750000
           MOVE PV-DECREMENT-1ST      TO DPG51-INCR-DECR-DAYS-9.        10760000
           SET  DPG51-DECREMENT-DATE  TO TRUE.                          10770000
           MOVE 'F4'                  TO DPG51-CALENDAR-TYPE.           10780000
           SET  DPG52-LK-DTE-ISO-FMT  TO TRUE.                          10790000
           MOVE PV-DB2-OUT-DATE        TO DPG52-LK-DATE-INPUT.          10800000
                                                                        10810000
           CALL DP500-KOHLS-CALENDAR-ROUTINE                            10820000
               USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               10830000
                                                                        10840000
           EVALUATE TRUE                                                10850000
               WHEN DPG54-SEVERE-ERROR                                  10860000
                   DISPLAY '** ABEND **'                                10870000
                   DISPLAY '** PGM = FSKRP124'                          10880000
                   DISPLAY '** 8400-CALENDAR-DAY-OF-WEEK'               10890000
                   DISPLAY '** INVALID RETURN FROM 1ST DECREMENT. '     10900000
                   DISPLAY '** ERROR MESSAGE = '                        10910000
                           DPG54-ERROR-MESSAGE                          10920000
                   DISPLAY '** DPG51 = ' DPG51                          10930000
                   DISPLAY '** DPG52 = ' DPG52                          10940000
                   DISPLAY '** DPG53 = ' DPG53                          10950000
                   DISPLAY '** DPG54 = ' DPG54                          10960000
                   MOVE +4003 TO ABEND-CODE                             10970000
                   CALL 'ILBOABN0' USING ABEND-CODE                     10980000
               WHEN OTHER                                               10990000
                   CONTINUE                                             11000000
           END-EVALUATE.                                                11010000
                                                                        11020000
           MOVE DPG55-DB2-ISO-DATE-FMT TO PV-DB2-OUT-DATE.              11030000
      *                                                                 11040000
      ******************************************************************11050000
      *  CLOSE CURSORS, CLOSE FILES, DISPLAY COUNTERS                 * 11060000
      ******************************************************************11070000
       9000-END-OF-JOB.                                                 11080000
                                                                        11090000
           PERFORM 4400-CLOSE-SKU-CURS.                                 11100000
                                                                        11110000
           CLOSE SKU-REPORT-FILE.                                       11120000
                                                                        11130000
      *                                                                 11140000
                                                                        11150000
      ******************************************************************11160000
      * 9900-GET-DATE-TIME - GET THE CURRENT DATE AND TIME FROM DB2   * 11170000
      ******************************************************************11180000
       9900-GET-DATE-TIME.                                              11190000
           MOVE '*9900-GET-DATE-TIME.             *' TO PV-PARA-NAME.   11200000
                                                                        11210000
           EXEC SQL                                                     11220000
               SET :SA-CURRENT-DATE = CURRENT DATE                      11230000
           END-EXEC.                                                    11240000
                                                                        11250000
           EXEC SQL                                                     11260000
               SET :SA-CURRENT-TIME = CURRENT TIME                      11270000
           END-EXEC.                                                    11280000
                                                                        11290000
           EVALUATE TRUE                                                11300000
               WHEN SQLCODE = ZERO                                      11310000
                   MOVE SA-CURR-YEAR       TO SD-SYSTEM-YEAR            11320000
                   MOVE SA-CURR-MONTH      TO SD-SYSTEM-MONTH           11330000
                   MOVE SA-CURR-DAY        TO SD-SYSTEM-DAY             11340000
                   MOVE SA-CURR-HOUR       TO ST-SYSTEM-HOUR            11350000
                   MOVE SA-CURR-MINUTE     TO ST-SYSTEM-MINUTE          11360000
               WHEN OTHER                                               11370000
                   PERFORM 9999-SQL-ERROR                               11380000
           END-EVALUATE.                                                11390000
                                                                        11400000
       9910-DECREMENT-CURRENT-DATE.                                     11410000
                                                                        11420000
           MOVE '9910-DECREMENT-CURRENT-DATE'                           11430000
                                       TO PV-PARA-NAME.                 11440000
                                                                        11450000
                                                                        11460000
           MOVE '20'                  TO DPG52-DB2-ISO-DATE-YR-X(1:2).  11470000
           MOVE SD-SYSTEM-YEAR        TO DPG52-DB2-ISO-DATE-YR-X(3:2).  11480000
           MOVE SD-SYSTEM-MONTH       TO DPG52-DB2-ISO-DATE-MO-X.       11490000
           MOVE SD-SYSTEM-DAY         TO DPG52-DB2-ISO-DATE-DY-X.       11500000
           MOVE DPG52-DB2-ISO-DATE    TO PV-CURRENT-DATE.               11510000
           SET DPG51-ACTUAL-CALENDAR-ONLY                               11520000
                                       TO TRUE.                         11530000
           SET DPG51-DECREMENT-DATE                                     11540000
                                       TO TRUE.                         11550000
           SET DPG52-LK-DTE-ISO        TO TRUE.                         11560000
           MOVE 182                    TO DPG51-INCR-DECR-DAYS-9.       11570000
           CALL PC-DPKUT500 USING DPG51 DPG52                           11580000
                                  DPG53 DPG54                           11590000
                                  DPG55 DPG56.                          11600000
           IF DPG54-INCR-DECR-VALID                                     11610000
             MOVE DPG55-DB2-ISO-DATE  TO PV-6-MONTH-DATE                11620000
             MOVE PV-6-MONTH-DATE-YYMMDD TO PV-6-MONTH-DATE-YYMMDD-SQL  11630000
           ELSE                                                         11640000
               DISPLAY 'BAD RECYCLE DATE CONVERSION' UPON CONSOLE       11650000
               SET ABEND-4013-DB2-ERROR   TO TRUE                       11660000
               CALL 'ILBOABN0' USING ABEND-CODE                         11670000
           END-IF.                                                      11680000
           DISPLAY 'DATE - 6 MONTHS - ' PV-6-MONTH-DATE                 11690000
            ' CURRENT DATE-' DPG52-DB2-ISO-DATE UPON CONSOLE.           11700000
                                                                        11710000
       9999-SQL-ERROR.                                                  11720000
      ******************************************************************11730000
      * ABEND ROUTINE FOR BAD SQL CALLS                               * 11740000
      ******************************************************************11750000
           DISPLAY '** ABEND **          = SQL ERROR'.                  11760000
           DISPLAY '** PROGRAM **        = FSKRP124'                    11770000
           DISPLAY '** PARAGRAPH **      = ' PV-PARA-NAME               11780000
      *                                                                 11790000
      ******************************************************************11800000
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    11810000
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         11820000
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     11830000
      * FORMAT.                                                         11840000
      ******************************************************************11850000
            COPY DPPD004.                                               11860000
      *                                                                 11870000
           MOVE +4013                      TO ABEND-CODE.               11880000
           CALL 'ILBOABN0' USING ABEND-CODE.                            11890000
                                                                        11900000
