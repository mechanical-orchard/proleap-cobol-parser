000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MPKCS023.                                00050000
000600 AUTHOR.                 WILLIAM B. BURT.                         00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            APRIL, 1991.                             00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* UPC CERTIFICATION PROGRAM                                       00120000
001300* THIS PROGRAM DISPLAYS A SCREEN ON THE LRT (LASER RADIO TERMINAL)00130000
001400******************************************************************00140000
263627*----------------------------------------------------------------*00141008
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00142008
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00143008
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00144008
263627*----------------------------------------------------------------*00145008
001500                                                                  00150000
001600******************************************************************00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800******************************************************************00180000
001900                                                                  00190000
002000******************************************************************00200000
002100 DATA DIVISION.                                                   00210000
002200******************************************************************00220000
002300                                                                  00230000
002400******************************************************************00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600******************************************************************00260000
002700*                                                                 00270000
002800 01  CA-COMMAREA.                                                 00280000
002900     05  CA-COMMON-DATA.                                          00290000
003000         10  CA-TRANSACTION-STATUS                                00300000
003100                                         PIC  X(01)  VALUE SPACE. 00310000
003200             88  CA-INITIALIZE-SCREEN                VALUE 'S'.   00320000
003300             88  CA-PROCESS-SCREEN                   VALUE 'R'.   00330000
003400         10  CA-LAST-PROGRAM             PIC  X(08)  VALUE SPACE. 00340000
003500     05  CA-PROGRAM-DATA.                                         00350000
003600         10  CA-ACTION-CODE              PIC  X(02)  VALUE SPACE. 00360000
003700             88  CA-CERTIFICATION-REQUIRED           VALUE '10'.  00370000
003800             88  CA-INSERT-SUCCESSFUL                VALUE '11'.  00380000
003900             88  CA-NO-SCAN                          VALUE '20'.  00390000
004000             88  CA-DECERTIFY-ALL-UPCS-FOR-SKU       VALUE '21'.  00400000
004100             88  CA-SKU-MISMATCH-DECERT-SCANNED      VALUE '30'.  00410000
004200             88  CA-NEW-VENDOR-UPC-LOADED            VALUE '40'.  00420000
004300             88  CA-DANGLING-UPC                     VALUE '50'.  00430000
004400             88  CA-NO-UPC-ON-MERCHANDISE            VALUE '60'.  00440000
004500         10  CA-OPER-UNT-ID              PIC S9(4)   VALUE ZEROS  00450000
004600                                                     COMP.        00460000
004700         10  CA-FCLTY-ID                 PIC S9(4)   VALUE ZEROS  00470000
004800                                                     COMP.        00480000
004900         10  CA-PO-NBR-X                 PIC  X(08)  VALUE SPACE. 00490000
005000         10  CA-PO-NBR      REDEFINES  CA-PO-NBR-X                00500000
005100                                         PIC  9(08).              00510000
005200         10  CA-REC-SEQ-NBR-X            PIC  X(03)  VALUE SPACE. 00520000
005300         10  CA-REC-SEQ-NBR    REDEFINES  CA-REC-SEQ-NBR-X        00530000
005400                                         PIC  9(03).              00540000
005500         10  CA-LINE-ITEM-NBR-X          PIC  X(04)  VALUE SPACE. 00550000
005600         10  CA-LINE-ITEM-NBR  REDEFINES  CA-LINE-ITEM-NBR-X      00560000
005700                                         PIC  9(04).              00570000
005800         10  CA-SKU-NBR.                                          00580000
005900             15  CA-MERCH-DEPT-NBR       PIC  X(03)  VALUE SPACE. 00590000
006000             15  FILLER                  PIC  X(01)  VALUE SPACE. 00600000
006100             15  CA-MERCH-CLASS-NBR      PIC  X(02)  VALUE SPACE. 00610000
006200             15  FILLER                  PIC  X(01)  VALUE SPACE. 00620000
006300******************************************************************00630000
006400*  SIZE OF CA-SEQ-NBR INCREASED FROM X(3) TO X(8).   WR # 21361  *00640000
006500******************************************************************00650000
006600             15  CA-SEQ-NBR              PIC  X(08)  VALUE SPACE. 00660000
006700******************************************************************00670000
006800*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *00680000
006900******************************************************************00690000
007000         10  CA-CURRENT-UNIT-RETAIL-AMOUNT                        00700000
007100                                         PIC  9(05)V9(02)         00710004
007200                                                     VALUE ZEROS. 00720000
007300         10  CA-SKU-DESC                 PIC  X(19)  VALUE SPACE. 00730000
007400         10  CA-SIZE-DESC                PIC  X(05)  VALUE SPACE. 00740000
007500         10  CA-COLOR-DESC               PIC  X(04)  VALUE SPACE. 00750000
007600         10  CA-FORMATTED-GROUP-PRICING  PIC  X(09)  VALUE SPACE. 00760005
007700         10  CA-VENDOR-STYLE-CODE        PIC  X(15)  VALUE SPACE. 00770000
007800         10  CA-IN-HOUSE-VENDOR-NAME     PIC  X(19)  VALUE SPACE. 00780000
007900         10  CA-ITEM-NBR                 PIC S9(15)  VALUE ZEROS  00790000
008000                                                     COMP-3.      00800000
008100         10  CA-UPC-NBR-X                PIC  X(13)  VALUE SPACE. 00810000
008200         10  CA-UPC-NBR   REDEFINES CA-UPC-NBR-X                  00820000
008300                                         PIC  9(13).              00830000
008400         10  CA-UPC-FIRST-12  REDEFINES CA-UPC-NBR-X.             00840000
008500             15  CA-FIRST-TWELVE-BYTES-OF-UPC                     00850000
008600                                         PIC  9(12).              00860000
008700             15  CA-CHECK-DIGIT          PIC  X(01).              00870000
008800         10  CA-UPC-LAST-12  REDEFINES CA-UPC-NBR-X.              00880000
008900             15  CA-FIRST-DIGIT-COUNTRY-CODE                      00890000
009000                                         PIC  X(01).              00900000
009100             15  CA-LAST-TWELVE-BYTES-OF-UPC                      00910000
009200                                         PIC  9(12).              00920000
009300         10  CA-MISMATCHED-ITEM-NBR      PIC S9(15)  VALUE ZEROS  00930000
009400                                                     COMP-3.      00940000
009500         10  CA-MDSE-PRC-AREA-CDE        PIC  X(06)  VALUE SPACE. 00950000
009600         10  CA-MISMATCHED-UPC-NBR       PIC S9(15)  VALUE ZEROS  00960000
009700                                                     COMP-3.      00970000
009800*                                                                 00980000
009900 01  DK-DB2-KEYS.                                                 00990000
010000     05  DK-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  01000000
010100                                                     COMP.        01010000
010200     05  DK-PO-NBR                       PIC S9(09)  VALUE ZEROS  01020000
010300                                                     COMP.        01030000
010400     05  DK-PO-LNE-NBR                   PIC S9(04)  VALUE ZEROS  01040000
010500                                                     COMP.        01050000
010600     05  DK-FCLTY-ID                     PIC S9(04)  VALUE ZEROS  01060000
010700                                                     COMP.        01070000
010800******************************************************************01080000
010900*   DECLARED DK-ITM-NBR                              WR # 21361  *01090000
011000******************************************************************01100000
011100     05  DK-ITM-NBR                      PIC S9(15)V VALUE ZEROS. 01110000
011200******************************************************************01120000
011300*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *01130000
011400******************************************************************01140000
011500*                                                                 01150000
011600 01  DN-NULL-INDICATORS.                                          01160000
011700     05  DN-DCFAAS-FCLTY-ID-NULL         PIC S9(04)  VALUE ZEROS  01170000
011800                                                     COMP.        01180000
011900*                                                                 01190000
012000 01  PC-PROGRAM-CONSTANTS.                                        01200000
012100     05  PC-LOGON-TRAN-ID                PIC  X(04)  VALUE 'Z028'.01210000
012200     05  PC-TRANID                       PIC  X(04)  VALUE 'M023'.01220000
012300     05  PC-SLASH                        PIC  X(01)  VALUE '/'.   01230000
012400     05  PC-ONE                          PIC  9(01)  VALUE 1.     01240000
012500     05  PC-MAX-RETRIES                  PIC S9(04)  VALUE +3     01250000
012600                                                     COMP SYNC.   01260000
012700     05  PC-ROW-NOT-FOUND                PIC S9(04)  VALUE +100   01270000
012800                                                     COMP SYNC.   01280000
012900******************************************************************01290000
013000*   PROGRAM CONSTANTS PC-000 AND PC-999 ADDED        WR # 21361  *01300000
013100******************************************************************01310000
013200     05  PC-000                          PIC X(3)    VALUE '000'. 01320000
013300     05  PC-999                          PIC X(3)    VALUE '999'. 01330000
013400******************************************************************01340000
013500*                                                    WR # 21361  *01350000
013600*  VALUE OF COMMAREA-LENGTH INCREASED FORM +150 TO +155          *01360000
013700******************************************************************01370000
013800     05  PC-COMMAREA-LENGTH              PIC S9(04)  VALUE +166   01380006
013900                                                     COMP SYNC.   01390000
014000******************************************************************01400000
014100*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *01410000
014200******************************************************************01420000
014300     05  PC-TRANSFER-UP-LENGTH           PIC S9(04)  VALUE +9     01430000
014400                                                     COMP SYNC.   01440000
014500     05  PC-TRANSFER-DOWN-LENGTH         PIC S9(04)  VALUE +166   01450007
014600                                                     COMP SYNC.   01460000
014700     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01470000
014800         'MPKCS023'.                                              01480000
014900     05  PC-LRT-MAIN-MENU-PGM            PIC  X(08)  VALUE        01490000
015000         'MPKCS027'.                                              01500000
015100     05  PC-UPC-CERT-DISPLAY-PGM         PIC  X(08)  VALUE        01510000
015200         'MPKCS028'.                                              01520000
015300     05  PC-LRT-QC-MENU-PGM              PIC  X(08)  VALUE        01530000
015400         'RCKCS270'.                                              01540000
015500     05  PC-DB2-DATABASE-ERROR-MSG       PIC  X(19)  VALUE        01550000
015600         'DB2 ACCESS ERROR   '.                                   01560000
015700     05  PC-PO-NOT-NUMERIC-MSG           PIC  X(19)  VALUE        01570000
015800         'PO NOT NUMERIC    '.                                    01580000
015900     05  PC-REC-NOT-NUMERIC-MSG          PIC  X(19)  VALUE        01590000
016000         'RC SEQ NOT NUMERIC'.                                    01600000
016100     05  PC-LINE-ITEM-NOT-NUMERIC-MSG    PIC  X(19)  VALUE        01610000
016200         'LINE NOT NUMERIC  '.                                    01620000
016300     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        01630000
016400         'UNRECOGNIZED PF KEY'.                                   01640000
016500     05  PC-NO-VENDOR-NAME-MSG           PIC  X(19)  VALUE        01650000
016600         'NO VNDR NAME FOUND '.                                   01660000
016700     05  PC-ENTER-THROUGH-MENU-MSG       PIC  X(19)  VALUE        01670000
016800         'ENTER THROUGH MENU '.                                   01680000
016900     05  PC-PO-NOT-FOUND-MSG             PIC  X(19)  VALUE        01690000
017000         'PO NOT FOUND       '.                                   01700000
017100     05  PC-LINE-ITEM-NOT-FOUND-MSG      PIC  X(19)  VALUE        01710000
017200         'LINE ITEM NOT FOUND'.                                   01720000
017300     05  PC-ZERO-LINE-ITEM-MSG           PIC  X(19)  VALUE        01730000
017400         'LINE CANNOT BE ZERO'.                                   01740000
017500     05  PC-PO-REQ-MSG                   PIC  X(19)  VALUE        01750000
017600         'PO REQUIRED        '.                                   01760000
017700     05  PC-REC-REQ-MSG                  PIC  X(19)  VALUE        01770000
017800         'RC SEQ REQUIRED    '.                                   01780000
017900     05  PC-LINE-ITEM-NBR-REQ-MSG        PIC  X(19)  VALUE        01790000
018000         'LINE ITEM REQUIRED '.                                   01800000
018100     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        01810000
018200         'TRANS NOT AVAILABLE'.                                   01820000
018300     05  PC-SKU-NOT-FOUND-MSG            PIC  X(19)  VALUE        01830000
018400         'SKU NOT FOUND      '.                                   01840000
018500     05  PC-NO-UPC-ON-MERCH-LINE1-MSG    PIC  X(19)  VALUE        01850000
018600         'RECORD LOGGED FOR  '.                                   01860000
018700     05  PC-NO-UPC-ON-MERCH-LINE2-MSG    PIC  X(19)  VALUE        01870000
018800         'NO UPC ON MDSE.    '.                                   01880000
018900     05  PC-PA                           PIC  X(02)  VALUE 'PA'.  01890000
019000     05  PC-A                            PIC  X(01)  VALUE 'A'.   01900000
019100     05  PC-1                            PIC S9(03)  VALUE 1      01910000
019200                                                     COMP-3.      01920000
019300*                                                                 01930000
019400 01  PS-PROGRAM-SWITCHES.                                         01940000
019500     05  PS-EDIT-FAILED-IND              PIC  X(01)  VALUE 'N'.   01950000
019600         88  PS-NO-EDIT-ERROR                        VALUE 'N'.   01960000
019700         88  PS-EDIT-FAILED                          VALUE 'Y'.   01970000
019800******************************************************************01980000
019900*  INCLUDED PROGRAM SWITCHES FOR XLKUT001            WR # 21361  *01990000
020000******************************************************************02000000
020100     05  PS-CALL-API-SW               PIC  X    VALUE 'N'.        02010000
020200         88  PS-CALL-API-NO                     VALUE 'N'.        02020000
020300         88  PS-CALL-API-YES                    VALUE 'Y'.        02030000
020400******************************************************************02040000
020500* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *02050000
020600******************************************************************02060000
020700*                                                                 02070000
020800 01  PV-PROGRAM-VARIABLES.                                        02080000
020900     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   02090000
021000                                                     COMP SYNC.   02100000
021100     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 02110000
021200     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   02120000
021300                                                     COMP.        02130000
021400     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   02140000
021500                                                     COMP SYNC.   02150000
021600     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 02160000
021700     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 02170000
021800     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02180000
021900                                                     COMP SYNC.   02190000
022000*                                                                 02200000
022100     05  PV-UPC-NBR                      PIC S9(15)  VALUE ZEROS  02210000
022200                                                     COMP-3.      02220000
022300******************************************************************02230000
022400*  FILLER CONTAINS SPACE INSTEAD OF DASHES           WR# 21361   *02240000
022500******************************************************************02250000
022600     05  PV-FORMATTED-SKU.                                        02260000
022700         10  PV-DEPT-NBR                 PIC  X(03)  VALUE SPACE. 02270000
022800         10  FILLER                      PIC  X(01)  VALUE SPACE. 02280000
022900         10  PV-CLASS-NBR                PIC  X(02)  VALUE SPACE. 02290000
023000         10  FILLER                      PIC  X(01)  VALUE SPACE. 02300000
023100******************************************************************02310000
023200*  SIZE OF PV-SEQ-NBR INCREASED FROM X(3) TO X(8)      WR# 21361 *02320000
023300******************************************************************02330000
023400         10  PV-SEQ-NBR                  PIC  X(08)  VALUE SPACE. 02340000
023500******************************************************************02350000
023600*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *02360000
023700******************************************************************02370000
023800     05  PV-SELECT-COUNTER               PIC S9(04)  VALUE +0     02380000
023900                                                     COMP SYNC.   02390000
024000     05  PV-FORMATTED-GROUP-PRICING.                              02400000
024100         10  PV-FORMATTED-GROUP-QUANTITY.                         02410000
024200             15  PV-GROUP-QUANTITY-X     PIC  X(01)  VALUE SPACE. 02420000
024300             15  PV-GROUP-QUANTITY  REDEFINES                     02430000
024400                     PV-GROUP-QUANTITY-X PIC  9(01).              02440000
024500             15  PV-GROUP-QUANTITY-SLASH PIC  X(01)  VALUE SPACE. 02450000
024600         10  PV-FORMATTED-GROUP-PRICE    PIC  X(07)  VALUE SPACE. 02460005
024700     05  PV-GROUP-PRICE-NUMERIC-EDIT     PIC ZZZZZ.ZZ.            02470005
024800     05  PV-GROUP-PRICE-NUMERIC-EDIT-X  REDEFINES                 02480000
024900             PV-GROUP-PRICE-NUMERIC-EDIT PIC  X(08).              02490005
025000     05  PV-UNSTRING-SPACE-DELIMITER     PIC  X(01)  VALUE SPACE. 02500000
025100     05  PV-MAX-GROUP-PRICE-DIGITS       PIC  9(05)V9(02)         02510004
025200                                                     VALUE ZEROS. 02520000
025300     05  PV-DISPLAY-PO-LINE-ITEM-NBR.                             02530000
025400         10  PV-DISPLAY-PO-NBR           PIC  X(08)  VALUE SPACE. 02540000
025500         10  FILLER                      PIC  X(02)  VALUE SPACE. 02550000
025600         10  PV-DISPLAY-LINE-ITEM-NBR    PIC  X(04)  VALUE SPACE. 02560000
025700     05  PV-DISPLAY-ENT-ID               PIC  9(09)  VALUE ZEROS. 02570000
025800     05  PV-DISPLAY-KEYS.                                         02580000
025900         10  PV-DISPLAY-ORD-NBR          PIC  9(09)  VALUE ZEROS  02590000
026000                                                BLANK WHEN ZEROS. 02600000
026100         10  FILLER                      PIC  X(02)  VALUE SPACE. 02610000
026200         10  PV-DISPLAY-RCVR-SEQ-NBR     PIC  9(09)  VALUE ZEROS  02620000
026300                                                BLANK WHEN ZEROS. 02630000
026400         10  FILLER                      PIC  X(02)  VALUE SPACE. 02640000
026500         10  PV-DISPLAY-ORD-LNE-NBR      PIC  9(04)  VALUE ZEROS  02650000
026600                                                BLANK WHEN ZEROS. 02660000
026700         10  FILLER                      PIC  X(02)  VALUE SPACE. 02670000
026800         10  PV-DISPLAY-WORK-ORD-SEQ-NBR PIC  9(04)  VALUE ZEROS  02680000
026900                                                BLANK WHEN ZEROS. 02690000
027000         10  FILLER                      PIC  X(02)  VALUE SPACE. 02700000
027100         10  PV-DISPLAY-OPER-UNT-ID      PIC  9(04)  VALUE ZEROS  02710000
027200                                                BLANK WHEN ZEROS. 02720000
027300         10  FILLER                      PIC  X(02)  VALUE SPACE. 02730000
027400         10  PV-DISPLAY-FCLTY-ID         PIC  9(04)  VALUE ZEROS  02740000
027500                                                BLANK WHEN ZEROS. 02750000
027600                                                                  02760000
027700 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  02770000
027800     05  TS-INFO-QUEUE-NAME.                                      02780000
027900         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 02790000
028000         10  FILLER                      PIC  X(04)  VALUE 'INFO'.02800000
028100*                                                                 02810000
028200/                                                                 02820000
028300******************************************************************02830000
028400* HELP SCREEN COMMAREA                                            02840000
028500******************************************************************02850000
028600     COPY PCWS192.                                                02860000
028700******************************************************************02870000
028800* HELP SCREEN WORK AREA                                           02880000
028900******************************************************************02890000
029000     COPY PCWS188.                                                02900000
029100/                                                                 02910000
029200*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 02920000
029300*                                                                 02930000
029400                                                                  02940000
029500     COPY DPWS010I.                                               02950000
029600                                                                  02960000
029700******************************************************************02970000
029800*                                                    WR # 21361  *02980000
029900*   RECORD LAYOUT FOR LOGISTICS DOMAIN ITEM ACCESS MODULE        *02990000
030000******************************************************************03000000
030100     COPY XLWS001.                                                03010000
030200******************************************************************03020000
030300*   CHANGES MADE FOR WR # 21361 ENDS HERE                        *03030000
030400******************************************************************03040000
030500*                                                                 03050000
030600*  GENEREATED DSECT FOR THE MPKM023 MAPSET                        03060000
030700*                                                                 03070000
030800     COPY MPKM023.                                                03080000
030900                                                                  03090000
031000*                                                                 03100000
031100*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                03110000
031200*                                                                 03120000
031300     COPY DPWS013.                                                03130000
031400                                                                  03140000
031500*                                                                 03150000
031600*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   03160000
031700*                                                                 03170000
031800     COPY DPWS015.                                                03180000
031900                                                                  03190000
032000*                                                                 03200000
032100*  TEMPORARY STORAGE QUEUE LAYOUT FOR LOGON/UNIT RELATED          03210000
032200*  INFORMATION CAPTURED BY THE NAVIGATOR AT LOGON TIME            03220000
032300*                                                                 03230000
032400     COPY DPWS026.                                                03240000
032500                                                                  03250000
032600*                                                                 03260000
032700*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      03270000
032800*                                                                 03280000
032900     COPY DFHAID.                                                 03290000
033000                                                                  03300000
033100******************************************************************03310000
033200*   CHANGES MADE FOR WR# 21361 ENDS HERE                         *03320000
033300******************************************************************03330000
033400                                                                  03340000
033500*                                                                 03350000
033600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PURCHASE ORDER     03360000
033700*  HEADER TABLE                                                   03370000
033800*                                                                 03380000
033900     EXEC SQL                                                     03390000
034000         INCLUDE TPURCHS                                          03400000
034100     END-EXEC.                                                    03410000
034200                                                                  03420000
034300*                                                                 03430000
034400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PURCHASE ORDER     03440000
034500*  ITEM TABLE                                                     03450000
034600*                                                                 03460000
034700     EXEC SQL                                                     03470000
034800         INCLUDE TPURITM                                          03480000
034900     END-EXEC.                                                    03490000
035000                                                                  03500000
035100*                                                                 03510000
035200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE ENTERPRIZE NAME    03520000
035300*  TABLE                                                          03530000
035400*                                                                 03540000
035500     EXEC SQL                                                     03550000
035600         INCLUDE TENTNME                                          03560000
035700     END-EXEC.                                                    03570000
035800                                                                  03580000
035900*                                                                 03590000
036000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE FACILITY AREA      03600000
036100*  TABLE                                                          03610000
036200     EXEC SQL                                                     03620000
036300          INCLUDE TFLAREA                                         03630000
036400     END-EXEC.                                                    03640000
036500                                                                  03650000
036600*                                                                 03660000
036700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE OPERATION SET      03670000
036800*  TABLE                                                          03680000
036900     EXEC SQL                                                     03690000
037000          INCLUDE TOPRSET                                         03700000
037100     END-EXEC.                                                    03710000
037200                                                                  03720000
037300*                                                                 03730000
037400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE DEPARTMENT/CLASS   03740000
037500*  FACILITY LOCATION ASSIGNMENT TABLE                             03750000
037600     EXEC SQL                                                     03760000
037700          INCLUDE TDCFAAS                                         03770000
037800     END-EXEC.                                                    03780000
037900                                                                  03790000
038000*                                                                 03800000
038100*  COMMUNICATIONS AREA FOR DB2                                    03810000
038200*                                                                 03820000
038300     EXEC SQL                                                     03830000
038400         INCLUDE SQLCA                                            03840000
038500     END-EXEC.                                                    03850000
038600                                                                  03860000
038700                                                                  03870000
038800******************************************************************03880000
038900 LINKAGE SECTION.                                                 03890000
039000******************************************************************03900000
039100******************************************************************03910000
039200*   SIZE OF DFHCOMMAREA CHANGED FROM X(150) TO X(155)   WR# 21361*03920000
039300******************************************************************03930000
039400 01  DFHCOMMAREA                   PIC  X(155).                   03940000
039500******************************************************************03950000
039600*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *03960000
039700******************************************************************03970000
039800                                                                  03980000
039900******************************************************************03990000
040000 PROCEDURE DIVISION.                                              04000000
040100******************************************************************04010000
040200 0000-PROGRAM-MAINLINE.                                           04020000
040300     IF EIBTRNID = 'Z278'                                         04030000
040400         MOVE DFHCOMMAREA            TO PC192-COMMAREA            04040000
040500         MOVE PC192-HOST-SAVE-AREA   TO CA-COMMAREA               04050000
040600     ELSE                                                         04060000
040700         MOVE DFHCOMMAREA TO CA-COMMAREA                          04070000
040800     END-IF                                                       04080000
040900                                                                  04090000
041000     EVALUATE TRUE                                                04100000
041100         WHEN EIBCALEN = ZERO                                     04110000
041200             MOVE PC-ENTER-THROUGH-MENU-MSG TO PV-MESSAGE-AREA    04120000
041300             PERFORM 8300-RETURN                                  04130000
041400         WHEN CA-INITIALIZE-SCREEN                                04140000
041500             PERFORM 1000-INITIALIZE                              04150000
041600             PERFORM 1100-FIND-SYSTEM-ID                          04160000
041700             PERFORM 1200-FIND-LOGON-INFO                         04170000
041800             PERFORM 8000-SEND-MAP                                04180000
041900             PERFORM 8200-RETURN-TRANID                           04190000
042000         WHEN EIBAID = DFHENTER                                   04200000
042100             PERFORM 2000-PROCESS-SCREEN-FIELDS                   04210000
042200         WHEN EIBAID = DFHCLEAR                                   04220000
042300             INITIALIZE CA-PROGRAM-DATA                           04230000
042400             PERFORM 8000-SEND-MAP                                04240000
042500             PERFORM 8200-RETURN-TRANID                           04250000
042600         WHEN EIBAID = DFHPF3                                     04260000
042700             PERFORM 4200-XCTL-LRT-MAIN-MENU                      04270000
042800         WHEN EIBAID = DFHPF1                                     04280000
042900              PERFORM 1400-HELP-SCREEN                            04290000
043000         WHEN OTHER                                               04300000
043100             MOVE SPACES                     TO AMSGLN1O          04310000
043200             MOVE PC-UNRECOGNIZED-PF-KEY-MSG TO AMSGLN2O          04320000
043300             MOVE -1                         TO APONBRL           04330000
043400             PERFORM 8100-SEND-DATA-ONLY                          04340000
043500             PERFORM 8200-RETURN-TRANID                           04350000
043600     END-EVALUATE.                                                04360000
043700                                                                  04370000
043800     GOBACK.                                                      04380000
043900*                                                                 04390000
044000 1000-INITIALIZE.                                                 04400000
044100     MOVE SPACES           TO MP023AI.                            04410000
044200     SET CA-PROCESS-SCREEN TO TRUE.                               04420000
044300                                                                  04430000
044400     IF CA-LAST-PROGRAM = PC-LRT-MAIN-MENU-PGM OR                 04440000
044500        CA-LAST-PROGRAM = PC-LRT-QC-MENU-PGM                      04450000
044600         INITIALIZE CA-PROGRAM-DATA                               04460000
044700     ELSE                                                         04470000
044800         MOVE CA-PO-NBR-X      TO APONBRO                         04480000
044900         MOVE CA-REC-SEQ-NBR-X TO ARECNBRO                        04490000
045000         MOVE CA-LINE-ITEM-NBR TO ALINENOO                        04500000
045100         IF CA-NO-UPC-ON-MERCHANDISE                              04510000
045200             MOVE PC-NO-UPC-ON-MERCH-LINE1-MSG TO AMSGLN1O        04520000
045300             MOVE PC-NO-UPC-ON-MERCH-LINE2-MSG TO AMSGLN2O        04530000
045400         END-IF                                                   04540000
045500         INITIALIZE CA-ACTION-CODE                                04550000
045600*                   CA-PO-NBR                                     04560000
045700*                   CA-REC-SEQ-NBR                                04570000
045800                    CA-SKU-NBR                                    04580000
045900                    CA-CURRENT-UNIT-RETAIL-AMOUNT                 04590000
046000                    CA-SKU-DESC                                   04600000
046100                    CA-SIZE-DESC                                  04610000
046200                    CA-COLOR-DESC                                 04620000
046300                    CA-FORMATTED-GROUP-PRICING                    04630000
046400                    CA-VENDOR-STYLE-CODE                          04640000
046500                    CA-IN-HOUSE-VENDOR-NAME                       04650000
046600                    CA-ITEM-NBR                                   04660000
046700                    CA-UPC-NBR-X                                  04670000
046800                    CA-MISMATCHED-ITEM-NBR                        04680000
046900                    CA-MDSE-PRC-AREA-CDE                          04690000
047000     END-IF.                                                      04700000
047100*                                                                 04710000
047200 1100-FIND-SYSTEM-ID.                                             04720000
047300     EXEC CICS                                                    04730000
047400         INQUIRE                                                  04740000
047500             TRANSACTION   (PC-LOGON-TRAN-ID)                     04750000
047600             REMOTESYSTEM  (PV-SYSID)                             04760000
047700             RESP          (PV-CICS-RESPONSE)                     04770000
047800     END-EXEC.                                                    04780000
047900                                                                  04790000
048000     EVALUATE TRUE                                                04800000
048100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04810000
048200             CONTINUE                                             04820000
048300         WHEN OTHER                                               04830000
048400             MOVE '1100-FIND-SYSTEM-ID'                           04840000
048500                 TO DP013-PARAGRAPH                               04850000
048600             MOVE 'UNABLE TO DETERMINE SYSTEM ID'                 04860000
048700                 TO DP013-MESSAGE-TEXT (1)                        04870000
048800             SET DP013-CICS-ABEND      TO  TRUE                   04880000
048900             SET DP013-NO-ROLLBACK     TO  TRUE                   04890000
049000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               04900000
049100             SET CA-PROCESS-SCREEN     TO  TRUE                   04910000
049200             PERFORM 8100-SEND-DATA-ONLY                          04920000
049300             PERFORM 8200-RETURN-TRANID                           04930000
049400     END-EVALUATE.                                                04940000
049500*                                                                 04950000
049600 1200-FIND-LOGON-INFO.                                            04960000
049700     MOVE LENGTH OF DP026-SIGN-ON-INFO                            04970000
049800                    TO  PV-SIGN-ON-INFO-LENGTH.                   04980000
049900     MOVE EIBTRMID  TO  TS-INFO-QUEUE-TERMINAL.                   04990000
050000     MOVE +1        TO  PV-TS-ITEM.                               05000000
050100                                                                  05010000
050200     IF PV-SYSID = SPACES                                         05020000
050300         EXEC CICS                                                05030000
050400             READQ TS                                             05040000
050500                 QUEUE  (TS-INFO-QUEUE-NAME)                      05050000
050600                 ITEM   (PV-TS-ITEM)                              05060000
050700                 INTO   (DP026-SIGN-ON-INFO)                      05070000
050800                 RESP   (PV-CICS-RESPONSE)                        05080000
050900         END-EXEC                                                 05090000
051000     ELSE                                                         05100000
051100         EXEC CICS                                                05110000
051200             READQ TS                                             05120000
051300                 QUEUE   (TS-INFO-QUEUE-NAME)                     05130000
051400                 SYSID   (PV-SYSID)                               05140000
051500                 ITEM    (PV-TS-ITEM)                             05150000
051600                 INTO    (DP026-SIGN-ON-INFO)                     05160000
051700                 LENGTH  (PV-SIGN-ON-INFO-LENGTH)                 05170000
051800                 RESP    (PV-CICS-RESPONSE)                       05180000
051900         END-EXEC                                                 05190000
052000     END-IF.                                                      05200000
052100                                                                  05210000
052200     EVALUATE TRUE                                                05220000
052300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05230000
052400             MOVE DP026-LOCATION-NBR TO CA-OPER-UNT-ID            05240000
052500             MOVE DP026-FCLTY-ID    TO CA-FCLTY-ID                05250000
052600         WHEN OTHER                                               05260000
052700             MOVE '1200-FIND-LOGON-INFO'                          05270000
052800                 TO DP013-PARAGRAPH                               05280000
052900             MOVE 'UNABLE TO READ LOGON TSQ'                      05290000
053000                 TO DP013-MESSAGE-TEXT (1)                        05300000
053100             SET DP013-CICS-ABEND     TO TRUE                     05310000
053200             SET DP013-NO-ROLLBACK    TO TRUE                     05320000
053300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05330000
053400             SET CA-PROCESS-SCREEN    TO TRUE                     05340000
053500             PERFORM 8100-SEND-DATA-ONLY                          05350000
053600             PERFORM 8200-RETURN-TRANID                           05360000
053700     END-EVALUATE.                                                05370000
053800*                                                                 05380000
053900 1400-HELP-SCREEN.                                                05390000
054000     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      05400000
054100     MOVE 'MPKCS023'                  TO PC192-PROGRAM-NAME       05410000
054200     COPY PCPD188.                                                05420000
054300     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      05430000
054400     PERFORM 2200-XCTL-TO-HELP.                                   05440000
054500                                                                  05450000
054600*                                                                 05460000
054700 2000-PROCESS-SCREEN-FIELDS.                                      05470000
054800     MOVE LOW-VALUES      TO MP023AI.                             05480000
054900     SET PS-NO-EDIT-ERROR TO TRUE.                                05490000
055000                                                                  05500000
055100     PERFORM 2100-RECEIVE-MAP.                                    05510000
055200     PERFORM 2300-SET-ATTRIBUTES-TO-DEFAULT.                      05520000
055300     PERFORM 3000-EDIT-SCREEN-FIELDS.                             05530000
055400     PERFORM 3100-PROCESS-CERTIFY-REQUEST.                        05540000
055500     PERFORM 4300-XCTL-UPC-CERT-DISPLAY-PGM.                      05550000
055600*                                                                 05560000
055700 2100-RECEIVE-MAP.                                                05570000
055800     EXEC CICS                                                    05580000
055900         RECEIVE MAP     ('MP023A')                               05590000
056000                 MAPSET  ('MPKM023')                              05600000
056100                 RESP    (PV-CICS-RESPONSE)                       05610000
056200     END-EXEC.                                                    05620000
056300                                                                  05630000
056400     EVALUATE TRUE                                                05640000
056500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05650000
056600             PERFORM 2110-RECEIVE-SCREEN-FIELDS                   05660000
056700         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                05670000
056800             CONTINUE                                             05680000
056900         WHEN OTHER                                               05690000
057000            MOVE '2100-RECEIVE-MAP'      TO DP013-PARAGRAPH       05700000
057100            MOVE 'UNABLE TO RECEIVE MAP' TO DP013-MESSAGE-TEXT (1)05710000
057200            SET DP013-LOGIC-ABEND        TO TRUE                  05720000
057300            SET DP013-NO-ROLLBACK        TO TRUE                  05730000
057400            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                05740000
057500     END-EVALUATE.                                                05750000
057600*                                                                 05760000
057700 2110-RECEIVE-SCREEN-FIELDS.                                      05770000
057800     IF  APONBRL > ZERO                                           05780000
057900         MOVE APONBRI TO CA-PO-NBR-X                              05790000
058000     ELSE                                                         05800000
058100         IF APONBRA = DP015-ERASE-EOF                             05810000
058200             MOVE SPACES TO CA-PO-NBR-X                           05820000
058300                            APONBRI                               05830000
058400         END-IF                                                   05840000
058500     END-IF.                                                      05850000
058600                                                                  05860000
058700     IF  ARECNBRL > ZERO                                          05870000
058800         MOVE ARECNBRI TO CA-REC-SEQ-NBR-X                        05880000
058900     ELSE                                                         05890000
059000         IF ARECNBRA = DP015-ERASE-EOF                            05900000
059100             MOVE SPACES TO CA-REC-SEQ-NBR-X                      05910000
059200                            ARECNBRI                              05920000
059300         END-IF                                                   05930000
059400     END-IF.                                                      05940000
059500                                                                  05950000
059600     IF  ALINENOL > ZERO                                          05960000
059700         MOVE ALINENOI TO CA-LINE-ITEM-NBR-X                      05970000
059800     ELSE                                                         05980000
059900         IF ALINENOA = DP015-ERASE-EOF                            05990000
060000             MOVE SPACES TO CA-LINE-ITEM-NBR-X                    06000000
060100                            ALINENOI                              06010000
060200         END-IF                                                   06020000
060300     END-IF.                                                      06030000
060400*                                                                 06040000
060500 2200-XCTL-TO-HELP.                                               06050000
060600                                                                  06060000
060700     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      06070000
060800     SET CA-INITIALIZE-SCREEN         TO TRUE.                    06080000
060900     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    06090000
061000                                                                  06100000
061100     EXEC CICS                                                    06110000
061200         XCTL                                                     06120000
061300             PROGRAM   (PV-TRANSFER-PROGRAM)                      06130000
061400             COMMAREA  (PC192-COMMAREA)                           06140000
061500             LENGTH    (PV-COMMAREA-LENGTH)                       06150000
061600             RESP      (PV-CICS-RESPONSE)                         06160000
061700     END-EXEC.                                                    06170000
061800                                                                  06180000
061900     EVALUATE TRUE                                                06190000
062000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06200000
062100              CONTINUE                                            06210000
062200         WHEN OTHER                                               06220000
062300             MOVE '2200-XCTL-TO-HELP' TO DP013-PARAGRAPH          06230000
062400             MOVE 'UNABLE TO XCTL TO HELP SCREEN: '               06240000
062500                 TO DP013-MESSAGE-TEXT (1)                        06250000
062600             MOVE PV-TRANSFER-PROGRAM                             06260000
062700                               TO DP013-MESSAGE-TEXT (2)          06270000
062800             SET DP013-CICS-ABEND                                 06280000
062900                 DP013-NO-ROLLBACK TO TRUE                        06290000
063000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06300000
063100             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLN2O            06310000
063200             MOVE -1                       TO APONBRL             06320000
063300             SET CA-PROCESS-SCREEN         TO TRUE                06330000
063400             PERFORM 8100-SEND-DATA-ONLY                          06340000
063500             PERFORM 8200-RETURN-TRANID                           06350000
063600     END-EVALUATE.                                                06360000
063700*                                                                 06370000
063800 2300-SET-ATTRIBUTES-TO-DEFAULT.                                  06380000
063900     MOVE DP015-UNP-ALP-NOR-OFF TO APONBRA                        06390000
064000                                   ALINENOA.                      06400000
064100                                                                  06410000
064200     MOVE SPACES                TO AMSGLN1O                       06420000
064300                                   AMSGLN2O.                      06430000
064400*                                                                 06440000
064500 3000-EDIT-SCREEN-FIELDS.                                         06450000
064600     IF CA-LINE-ITEM-NBR-X NOT = SPACES                           06460000
064700         MOVE CA-LINE-ITEM-NBR-X TO DP010I-UNEDITED-FIELD         06470000
064800         MOVE 4 TO DP010I-MAXIMUM-DIGITS                          06480000
064900         MOVE 0 TO DP010I-MAXIMUM-DECIMALS                        06490000
065000         SET DP010I-NEGATIVE-ALLOWED TO TRUE                      06500000
065100                                                                  06510000
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06521008
263627              USING DP010I-NUMERIC-EDIT-AREA                      06522008
065300                                                                  06530000
065400         IF DP010I-ERROR-DETECTED                                 06540000
065500             SET PS-EDIT-FAILED TO TRUE                           06550000
065600             MOVE PC-LINE-ITEM-NOT-NUMERIC-MSG TO AMSGLN2O        06560000
065700             MOVE -1                           TO ALINENOL        06570000
065800         ELSE                                                     06580000
065900             MOVE DP010I-NUMERIC-FIELD TO CA-LINE-ITEM-NBR        06590000
066000             MOVE CA-LINE-ITEM-NBR TO ALINENOO                    06600000
066100             IF  CA-LINE-ITEM-NBR = ZERO                          06610000
066200                 SET PS-EDIT-FAILED TO TRUE                       06620000
066300                 MOVE PC-ZERO-LINE-ITEM-MSG        TO AMSGLN2O    06630000
066400                 MOVE -1                           TO ALINENOL    06640000
066500             END-IF                                               06650000
066600         END-IF                                                   06660000
066700     ELSE                                                         06670000
066800         SET PS-EDIT-FAILED TO TRUE                               06680000
066900         MOVE PC-LINE-ITEM-NBR-REQ-MSG TO AMSGLN2O                06690000
067000         MOVE -1                       TO ALINENOL                06700000
067100     END-IF.                                                      06710000
067200                                                                  06720000
067300                                                                  06730000
067400     IF CA-REC-SEQ-NBR-X NOT = SPACES                             06740000
067500         MOVE CA-REC-SEQ-NBR-X TO DP010I-UNEDITED-FIELD           06750000
067600         MOVE 8 TO DP010I-MAXIMUM-DIGITS                          06760000
067700         MOVE 0 TO DP010I-MAXIMUM-DECIMALS                        06770000
067800         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06780000
067900                                                                  06790000
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06801008
263627              USING DP010I-NUMERIC-EDIT-AREA                      06802008
068100                                                                  06810000
068200         IF DP010I-ERROR-DETECTED                                 06820000
068300             SET PS-EDIT-FAILED TO TRUE                           06830000
068400             MOVE PC-REC-NOT-NUMERIC-MSG TO AMSGLN2O              06840000
068500             MOVE -1                        TO ARECNBRL           06850000
068600         ELSE                                                     06860000
068700             MOVE DP010I-NUMERIC-FIELD TO CA-REC-SEQ-NBR          06870000
068800             MOVE CA-REC-SEQ-NBR       TO ARECNBRO                06880000
068900         END-IF                                                   06890000
069000     ELSE                                                         06900000
069100         SET PS-EDIT-FAILED  TO  TRUE                             06910000
069200         MOVE PC-REC-REQ-MSG TO  AMSGLN2O                         06920000
069300         MOVE -1             TO  ARECNBRL                         06930000
069400     END-IF.                                                      06940000
069500                                                                  06950000
069600     IF CA-PO-NBR-X     NOT = SPACES                              06960000
069700         MOVE CA-PO-NBR-X TO DP010I-UNEDITED-FIELD                06970000
069800         MOVE 8 TO DP010I-MAXIMUM-DIGITS                          06980000
069900         MOVE 0 TO DP010I-MAXIMUM-DECIMALS                        06990000
070000         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07000000
070100                                                                  07010000
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07021008
263627              USING DP010I-NUMERIC-EDIT-AREA                      07022008
070300                                                                  07030000
070400         IF DP010I-ERROR-DETECTED                                 07040000
070500             SET PS-EDIT-FAILED TO TRUE                           07050000
070600             MOVE PC-PO-NOT-NUMERIC-MSG TO AMSGLN2O               07060000
070700             MOVE -1                        TO APONBRL            07070000
070800         ELSE                                                     07080000
070900             MOVE DP010I-NUMERIC-FIELD TO CA-PO-NBR               07090000
071000             MOVE CA-PO-NBR            TO APONBRO                 07100000
071100         END-IF                                                   07110000
071200     ELSE                                                         07120000
071300         SET PS-EDIT-FAILED  TO  TRUE                             07130000
071400         MOVE PC-PO-REQ-MSG  TO  AMSGLN2O                         07140000
071500         MOVE -1             TO  APONBRL                          07150000
071600     END-IF.                                                      07160000
071700     IF PS-EDIT-FAILED                                            07170000
071800         PERFORM 8100-SEND-DATA-ONLY                              07180000
071900         PERFORM 8200-RETURN-TRANID                               07190000
072000     END-IF.                                                      07200000
072100*                                                                 07210000
072200*                                                                 07220000
072300 3100-PROCESS-CERTIFY-REQUEST.                                    07230000
072400     PERFORM 7000-SELECT-PO-NBR.                                  07240000
072500     PERFORM 7100-SELECT-PO-LNE-NBR.                              07250000
072600                                                                  07260000
072700     MOVE PURCHS-DEPT-NBR     TO  CA-MERCH-DEPT-NBR.              07270000
072800     MOVE PURITM-CL-NBR       TO  CA-MERCH-CLASS-NBR.             07280000
072900******************************************************************07290000
073000*  MOVE PURITM-SKU-SEQ-NBR TO CA-SEQ-NBR REMOVED       WR# 21361 *07300000
073100******************************************************************07310000
073200******************************************************************07320000
073300*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *07330000
073400******************************************************************07340000
073500     PERFORM 7200-SELECT-SKU-INFORMATION.                         07350000
073600                                                                  07360000
073700     PERFORM 7300-GET-PRIMARY-VNDR-NME.                           07370000
073800     PERFORM 7400-GET-FCLTY-AREA-ID.                              07380000
073900                                                                  07390000
074000     PERFORM 4100-FILL-COMMAREA.                                  07400000
074100*                                                                 07410000
074200 4100-FILL-COMMAREA.                                              07420000
074300     MOVE SPACE                  TO  AMSGLN1O.                    07430000
074400     MOVE CA-MERCH-DEPT-NBR      TO  PV-DEPT-NBR.                 07440000
074500     MOVE CA-MERCH-CLASS-NBR     TO  PV-CLASS-NBR.                07450000
074600     MOVE CA-SEQ-NBR             TO  PV-SEQ-NBR.                  07460000
074700     MOVE PV-FORMATTED-SKU       TO  CA-SKU-NBR.                  07470000
074800     MOVE XL001-UNT-RTL-AMT      TO  CA-CURRENT-UNIT-RETAIL-AMOUNT07480000
074900     PERFORM 4110-FORMAT-GROUP-PRICING.                           07490000
075000     MOVE XL001-VS-NBR           TO  CA-VENDOR-STYLE-CODE.        07500000
075100     MOVE XL001-SKU-DESC         TO  CA-SKU-DESC.                 07510000
075200     MOVE XL001-SIZE-DESC        TO  CA-SIZE-DESC.                07520000
075300     MOVE XL001-SHRT-CLOR-DESC   TO  CA-COLOR-DESC.               07530000
075400     MOVE DK-ITM-NBR             TO  CA-ITEM-NBR.                 07540000
075500******************************************************************07550000
075600*   CHANGES MADE FOR WR# 21361 ENDS HERE                         *07560000
075700******************************************************************07570000
075800*                                                                 07580000
075900******************************************************************07590000
076000* THIS MODULE FORMATS GROUP PRICING ON THE SCREEN WHEN BOTH       07600000
076100* OPTIONAL UNITS AND OPTIONAL RETAIL EXIST, I.E. 3/16.00.         07610000
076200******************************************************************07620000
076300 4110-FORMAT-GROUP-PRICING.                                       07630000
076400     IF XL001-GP-QTY > PC-ONE                                     07640000
076500         MOVE XL001-GP-QTY   TO PV-GROUP-QUANTITY                 07650000
076600         MOVE PC-SLASH       TO PV-GROUP-QUANTITY-SLASH           07660000
076700                                                                  07670000
076800         MOVE XL001-GP-AMT   TO PV-MAX-GROUP-PRICE-DIGITS         07680000
076900******************************************************************07690000
077000*   CHANGES MADE FOR WR# 21361 ENDS HERE                         *07700000
077100******************************************************************07710000
077200         MOVE PV-MAX-GROUP-PRICE-DIGITS                           07720000
077300             TO PV-GROUP-PRICE-NUMERIC-EDIT                       07730000
077400                                                                  07740000
077500         UNSTRING PV-GROUP-PRICE-NUMERIC-EDIT-X                   07750000
077600             DELIMITED BY ALL SPACES                              07760000
077700                 INTO PV-UNSTRING-SPACE-DELIMITER                 07770000
077800                      PV-FORMATTED-GROUP-PRICE                    07780000
077900                                                                  07790000
078000         MOVE PV-FORMATTED-GROUP-PRICING                          07800000
078100             TO CA-FORMATTED-GROUP-PRICING                        07810000
078200                                                                  07820000
078300         INITIALIZE PV-FORMATTED-GROUP-PRICING                    07830000
078400                    PV-GROUP-PRICE-NUMERIC-EDIT-X                 07840000
078500     ELSE                                                         07850000
078600         MOVE SPACES TO PV-GROUP-QUANTITY-X                       07860000
078700                        PV-GROUP-QUANTITY-SLASH                   07870000
078800                        PV-FORMATTED-GROUP-PRICE                  07880000
078900     END-IF.                                                      07890000
079000*                                                                 07900000
079100 4200-XCTL-LRT-MAIN-MENU.                                         07910000
079200     SET CA-INITIALIZE-SCREEN     TO TRUE.                        07920000
079300                                                                  07930000
079400     EVALUATE TRUE                                                07940000
079500         WHEN CA-LAST-PROGRAM = PC-LRT-MAIN-MENU-PGM              07950000
079600             MOVE PC-LRT-MAIN-MENU-PGM TO PV-TRANSFER-PROGRAM     07960000
079700         WHEN CA-LAST-PROGRAM = PC-LRT-QC-MENU-PGM                07970000
079800             MOVE PC-LRT-QC-MENU-PGM TO PV-TRANSFER-PROGRAM       07980000
079900         WHEN OTHER                                               07990000
080000             MOVE PC-LRT-MAIN-MENU-PGM TO PV-TRANSFER-PROGRAM     08000000
080100     END-EVALUATE.                                                08010000
080200                                                                  08020000
080300     MOVE PC-CURRENT-PROGRAM-NAME TO CA-LAST-PROGRAM.             08030000
080400                                                                  08040000
080500     EXEC CICS                                                    08050000
080600         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    08060000
080700               COMMAREA  (CA-COMMON-DATA)                         08070000
080800               LENGTH    (PC-TRANSFER-UP-LENGTH)                  08080000
080900               RESP      (PV-CICS-RESPONSE)                       08090000
081000     END-EXEC.                                                    08100000
081100                                                                  08110000
081200     EVALUATE TRUE                                                08120000
081300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08130000
081400             CONTINUE                                             08140000
081500         WHEN OTHER                                               08150000
081600             MOVE '4200-XCTL-LRT-MAIN-MENU' TO DP013-PARAGRAPH    08160000
081700             MOVE 'UNABLE TO XCTL TO LRT MAIN MENU PROGRAM: '     08170000
081800                 TO DP013-MESSAGE-TEXT (1)                        08180000
081900             MOVE PC-LRT-MAIN-MENU-PGM                            08190000
082000                 TO DP013-MESSAGE-TEXT (2)                        08200000
082100             SET DP013-CICS-ABEND  TO TRUE                        08210000
082200             SET DP013-NO-ROLLBACK TO TRUE                        08220000
082300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08230000
082400             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLN2O            08240000
082500             MOVE -1                       TO APONBRL             08250000
082600             SET CA-PROCESS-SCREEN         TO TRUE                08260000
082700             PERFORM 8100-SEND-DATA-ONLY                          08270000
082800             PERFORM 8200-RETURN-TRANID                           08280000
082900     END-EVALUATE.                                                08290000
083000*                                                                 08300000
083100 4300-XCTL-UPC-CERT-DISPLAY-PGM.                                  08310000
083200     SET CA-INITIALIZE-SCREEN     TO TRUE.                        08320000
083300     MOVE PC-CURRENT-PROGRAM-NAME TO CA-LAST-PROGRAM.             08330000
083400                                                                  08340000
083500     EXEC CICS                                                    08350000
083600         XCTL  PROGRAM   (PC-UPC-CERT-DISPLAY-PGM)                08360000
083700               COMMAREA  (CA-COMMAREA)                            08370000
083800               LENGTH    (PC-TRANSFER-DOWN-LENGTH)                08380000
083900               RESP      (PV-CICS-RESPONSE)                       08390000
084000     END-EXEC.                                                    08400000
084100                                                                  08410000
084200     EVALUATE TRUE                                                08420000
084300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08430000
084400             CONTINUE                                             08440000
084500         WHEN OTHER                                               08450000
084600             MOVE '4300-XCTL-UPC-CERT-DISPLAY-PGM'                08460000
084700                 TO DP013-PARAGRAPH                               08470000
084800             MOVE 'UNABLE TO XCTL TO THE UPC CERTIFICATION'       08480000
084900                 TO DP013-MESSAGE-TEXT (1)                        08490000
085000             MOVE 'DISPLAY PROGRAM: '                             08500000
085100                 TO DP013-MESSAGE-TEXT (2)                        08510000
085200             MOVE PC-UPC-CERT-DISPLAY-PGM                         08520000
085300                 TO DP013-MESSAGE-TEXT (3)                        08530000
085400             SET DP013-CICS-ABEND  TO TRUE                        08540000
085500             SET DP013-NO-ROLLBACK TO TRUE                        08550000
085600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08560000
085700             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLN2O            08570000
085800             MOVE -1                       TO APONBRL             08580000
085900             SET CA-PROCESS-SCREEN         TO TRUE                08590000
086000             PERFORM 8100-SEND-DATA-ONLY                          08600000
086100             PERFORM 8200-RETURN-TRANID                           08610000
086200     END-EVALUATE.                                                08620000
086300*                                                                 08630000
086400 7000-SELECT-PO-NBR.                                              08640000
086500     INITIALIZE DCLTPURCHS.                                       08650000
086600     MOVE CA-PO-NBR      TO  DK-PO-NBR.                           08660000
086700                                                                  08670000
086800     PERFORM                                                      08680000
086900         WITH TEST AFTER                                          08690000
087000         VARYING PV-SELECT-COUNTER                                08700000
087100         FROM 1 BY 1                                              08710000
087200         UNTIL (PV-SELECT-COUNTER > PC-MAX-RETRIES                08720000
087300                   OR SQLCODE = ZERO                              08730000
087400                   OR SQLCODE = PC-ROW-NOT-FOUND)                 08740000
087500                                                                  08750000
087600         EXEC SQL                                                 08760000
087700             SELECT  DEPT_NBR,                                    08770000
087800                     ENT_ID                                       08780000
087900               INTO  :PURCHS-DEPT-NBR,                            08790000
088000                     :PURCHS-ENT-ID                               08800000
088100               FROM  TPURCHS                                      08810000
088200              WHERE  (PO_NBR            =  :DK-PO-NBR             08820000
088300                AND   VER_STATUS_CDE    =  'A')                   08830000
088400         END-EXEC                                                 08840000
088500                                                                  08850000
088600         EVALUATE TRUE                                            08860000
088700             WHEN SQLCODE = ZERO                                  08870002
088800                 CONTINUE                                         08880002
088900             WHEN SQLCODE = +100                                  08890000
089000                 MOVE PC-PO-NOT-FOUND-MSG  TO  AMSGLN2O           08900000
089100                 MOVE -1                   TO  APONBRL            08910000
089200                 PERFORM 8100-SEND-DATA-ONLY                      08920000
089300                 PERFORM 8200-RETURN-TRANID                       08930000
089400             WHEN SQLCODE = -904                                  08940000
089500             WHEN SQLCODE = -913                                  08950000
089600                 CONTINUE                                         08960000
089700             WHEN SQLWARN0 NOT = SPACES                           08970000
089800             WHEN SQLCODE < ZERO                                  08980000
089900             WHEN SQLCODE > ZERO                                  08990000
090000                 MOVE '7000-SELECT-PO-NBR'                        09000000
090100                     TO DP013-PARAGRAPH                           09010000
090200                 MOVE 'SELECT INFORMATION FOR PO #: '             09020000
090300                     TO DP013-MESSAGE-TEXT (1)                    09030000
090400                 MOVE CA-PO-NBR         TO  PV-DISPLAY-PO-NBR     09040000
090500                 MOVE PV-DISPLAY-PO-LINE-ITEM-NBR                 09050000
090600                     TO DP013-MESSAGE-TEXT (2)                    09060000
090700                 MOVE SQLCA            TO DP013-SQLCA             09070000
090800                 MOVE 'TPURCHS'        TO DP013-DB2-TABLE-NAME (1)09080000
090900                 SET DP013-DB2-ABEND   TO TRUE                    09090000
091000                 SET DP013-NO-ROLLBACK TO TRUE                    09100000
091100                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           09110000
091200                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O       09120000
091300                 MOVE -1                        TO APONBRL        09130000
091400                 PERFORM 8100-SEND-DATA-ONLY                      09140000
091500                 PERFORM 8200-RETURN-TRANID                       09150000
091600         END-EVALUATE                                             09160000
091700     END-PERFORM.                                                 09170000
091800                                                                  09180000
091900     IF PV-SELECT-COUNTER > PC-MAX-RETRIES                        09190000
092000         MOVE '7000-SELECT-PO-NBR'                                09200000
092100             TO DP013-PARAGRAPH                                   09210000
092200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A'   09220000
092300             TO DP013-MESSAGE-TEXT (1)                            09230000
092400         MOVE 'ROW FROM THE TPURCHS TABLE FOR THE FOLLOWING PO: ' 09240000
092500             TO DP013-MESSAGE-TEXT (2)                            09250000
092600         MOVE CA-PO-NBR         TO  PV-DISPLAY-PO-NBR             09260000
092700         MOVE PV-DISPLAY-PO-LINE-ITEM-NBR                         09270000
092800             TO DP013-MESSAGE-TEXT (3)                            09280000
092900         MOVE SQLCA            TO DP013-SQLCA                     09290000
093000         MOVE 'TPURCHS'        TO DP013-DB2-TABLE-NAME (1)        09300000
093100         SET DP013-DB2-ABEND   TO TRUE                            09310000
093200         SET DP013-NO-ROLLBACK TO TRUE                            09320000
093300         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   09330000
093400         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O               09340000
093500         MOVE -1                        TO APONBRL                09350000
093600         PERFORM 8100-SEND-DATA-ONLY                              09360000
093700         PERFORM 8200-RETURN-TRANID                               09370000
093800     END-IF.                                                      09380000
093900*                                                                 09390000
094000 7100-SELECT-PO-LNE-NBR.                                          09400000
094100     INITIALIZE DCLTPURITM.                                       09410000
094200     MOVE CA-LINE-ITEM-NBR  TO  DK-PO-LNE-NBR.                    09420000
094300                                                                  09430000
094400     PERFORM                                                      09440000
094500         WITH TEST AFTER                                          09450000
094600         VARYING PV-SELECT-COUNTER                                09460000
094700         FROM 1 BY 1                                              09470000
094800         UNTIL (PV-SELECT-COUNTER > PC-MAX-RETRIES                09480000
094900                   OR SQLCODE = ZERO                              09490000
095000                   OR SQLCODE = PC-ROW-NOT-FOUND)                 09500000
095100                                                                  09510000
095200******************************************************************09520000
095300*  ITM_NBR ALSO FETCHED FROM TPURITM TABLE AND        WR # 21361 *09530000
095400*  SWITCH PS-CALL-API-YES SET TO TRUE WHEN SQLCODE IS +0         *09540000
095500******************************************************************09550000
095600         EXEC SQL                                                 09560000
095700             SELECT  SKU_SEQ_NBR,                                 09570000
095800                     ITM_NBR,                                     09580000
095900                     CL_NBR                                       09590000
096000               INTO  :PURITM-SKU-SEQ-NBR,                         09600000
096100                     :PURITM-ITM-NBR,                             09610000
096200                     :PURITM-CL-NBR                               09620000
096300               FROM  TPURCHS A,                                   09630000
096400                     TPURITM B                                    09640000
096500              WHERE  (A.PO_NBR            = :DK-PO-NBR            09650000
096600                AND   A.PO_NBR            = B.PO_NBR              09660000
096700                AND   A.VER_STATUS_CDE    = 'A'                   09670000
096800                AND   B.VER_STATUS_CDE    = 'A'                   09680000
096900                AND   B.APP_PO_LNE_NBR    = :DK-PO-LNE-NBR)       09690000
097000         END-EXEC                                                 09700000
097100                                                                  09710000
097200         EVALUATE TRUE                                            09720000
097300             WHEN SQLCODE = ZERO                                  09730002
097400                 MOVE PURITM-ITM-NBR TO DK-ITM-NBR                09740002
097500                 SET PS-CALL-API-YES TO TRUE                      09750002
097600             WHEN SQLCODE = +100                                  09760000
097700                 MOVE PC-LINE-ITEM-NOT-FOUND-MSG  TO  AMSGLN2O    09770000
097800                 MOVE -1                          TO  APONBRL     09780000
097900                 PERFORM 8100-SEND-DATA-ONLY                      09790000
098000                 PERFORM 8200-RETURN-TRANID                       09800000
098100             WHEN SQLCODE = -904                                  09810000
098200             WHEN SQLCODE = -913                                  09820000
098300                 CONTINUE                                         09830000
098400             WHEN SQLWARN0 NOT = SPACES                           09840000
098500             WHEN SQLCODE < ZERO                                  09850000
098600             WHEN SQLCODE > ZERO                                  09860000
098700                 MOVE '7100-SELECT-PO-LNE-NBR'                    09870000
098800                     TO DP013-PARAGRAPH                           09880000
098900                 MOVE 'SELECT INFORMATION FOR PO/LNE #: '         09890000
099000                     TO DP013-MESSAGE-TEXT (1)                    09900000
099100                 MOVE CA-PO-NBR         TO  PV-DISPLAY-PO-NBR     09910000
099200                 MOVE CA-LINE-ITEM-NBR                            09920000
099300                     TO  PV-DISPLAY-LINE-ITEM-NBR                 09930000
099400                 MOVE PV-DISPLAY-PO-LINE-ITEM-NBR                 09940000
099500                     TO DP013-MESSAGE-TEXT (2)                    09950000
099600                 MOVE SQLCA            TO DP013-SQLCA             09960000
099700                 MOVE 'TPURCHS'        TO DP013-DB2-TABLE-NAME (1)09970000
099800                 SET DP013-DB2-ABEND   TO TRUE                    09980000
099900                 SET DP013-NO-ROLLBACK TO TRUE                    09990000
100000                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           10000000
100100                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O       10010000
100200                 MOVE -1                        TO APONBRL        10020000
100300                 PERFORM 8100-SEND-DATA-ONLY                      10030000
100400                 PERFORM 8200-RETURN-TRANID                       10040000
100500         END-EVALUATE                                             10050000
100600     END-PERFORM.                                                 10060000
100700******************************************************************10070000
100800*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *10080000
100900******************************************************************10090000
101000                                                                  10100000
101100*                                                                 10110000
101200 7200-SELECT-SKU-INFORMATION.                                     10120000
101300                                                                  10130000
101400******************************************************************10140000
101500*   CHENCKING FOR DUMMY SKU                           WR # 21361 *10150000
101600******************************************************************10160000
101700         IF PURITM-ITM-NBR < 0                                    10170000
101800             MOVE '7200-SELECT-SKU-INFORMATION'                   10180000
101900                                 TO DP013-PARAGRAPH               10190000
102000             MOVE 'ITEM NBR IS LESS THAN ZERO'                    10200000
102100                                 TO DP013-MESSAGE-TEXT (1)        10210000
102200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               10220000
102300             MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O           10230000
102400             MOVE -1                        TO APONBRL            10240000
102500             PERFORM 8100-SEND-DATA-ONLY                          10250000
102600             PERFORM 8200-RETURN-TRANID                           10260000
102700         ELSE                                                     10270000
102800             IF PURITM-ITM-NBR = 0                                10280000
102900               IF PURITM-SKU-SEQ-NBR = PC-000                     10290000
103000                  MOVE '00000000'           TO CA-SEQ-NBR         10300000
103100                  MOVE -1                   TO APONBRL            10310000
103200                  MOVE PC-SKU-NOT-FOUND-MSG TO AMSGLN1O           10320000
103300                  MOVE CA-MERCH-DEPT-NBR    TO PV-DEPT-NBR        10330000
103400                  MOVE CA-MERCH-CLASS-NBR   TO PV-CLASS-NBR       10340000
103500                  MOVE CA-SEQ-NBR           TO PV-SEQ-NBR         10350000
103600                  MOVE PV-FORMATTED-SKU     TO AMSGLN2O           10360000
103700                  PERFORM 8100-SEND-DATA-ONLY                     10370000
103800                  PERFORM 8200-RETURN-TRANID                      10380000
103900               ELSE                                               10390000
104000                  IF PURITM-SKU-SEQ-NBR = PC-999                  10400000
104100                    MOVE '99999999'           TO CA-SEQ-NBR       10410000
104200                    MOVE -1                   TO APONBRL          10420000
104300                    MOVE PC-SKU-NOT-FOUND-MSG TO AMSGLN1O         10430000
104400                    MOVE CA-MERCH-DEPT-NBR    TO PV-DEPT-NBR      10440000
104500                    MOVE CA-MERCH-CLASS-NBR   TO PV-CLASS-NBR     10450000
104600                    MOVE CA-SEQ-NBR           TO PV-SEQ-NBR       10460000
104700                    MOVE PV-FORMATTED-SKU     TO AMSGLN2O         10470000
104800                    PERFORM 8100-SEND-DATA-ONLY                   10480000
104900                    PERFORM 8200-RETURN-TRANID                    10490000
105000                  ELSE                                            10500000
105100                    MOVE '7200-SELECT-SKU-INFORMATION'            10510000
105200                                    TO DP013-PARAGRAPH            10520000
105300                    MOVE 'ITEM NBR IS INVALID'                    10530000
105400                                    TO DP013-MESSAGE-TEXT (1)     10540000
105500                    PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG        10550000
105600                    MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O    10560000
105700                    MOVE -1                        TO APONBRL     10570000
105800                    PERFORM 8100-SEND-DATA-ONLY                   10580000
105900                    PERFORM 8200-RETURN-TRANID                    10590000
106000                  END-IF                                          10600000
106100               END-IF                                             10610000
106200             END-IF                                               10620000
106300         END-IF.                                                  10630000
106400                                                                  10640000
106500         IF PURITM-ITM-NBR > 0 AND                                10650000
106600            PS-CALL-API-YES    AND                                10660000
106700            ((PURITM-SKU-SEQ-NBR NOT = PC-000) AND                10670000
106800            (PURITM-SKU-SEQ-NBR NOT = PC-999))                    10680000
106900               PERFORM 7250-CALL-XLKUT-DOMAIN-PGM                 10690000
107000               MOVE XL001-SKU-NBR TO CA-SEQ-NBR                   10700000
107100         END-IF.                                                  10710000
107200                                                                  10720000
107300******************************************************************10730000
107400*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *10740000
107500******************************************************************10750000
107600*                                                                 10760000
107700******************************************************************10770000
107800*  ADDED NEW PARAGRAPH TO CALL XLKUT001 DOMIAN PROGRAM WR# 21361 *10780000
107900******************************************************************10790000
108000 7250-CALL-XLKUT-DOMAIN-PGM.                                      10800000
108100     INITIALIZE XL001-ITEM-COMMAREA                               10810000
108200                XL001-COMMAREA.                                   10820000
108300*                                                                 10830000
108400     SET XL001-BY-ITEM                                            10840000
108500         XL001-SELECT-SKU                                         10850000
108600         XL001-SELECT-VND-STYL                                    10860000
108700         XL001-SELECT-SKU-STR              TO TRUE.               10870000
108800*                                                                 10880000
108900     MOVE DK-ITM-NBR TO XL001-KEY-ITM-NBR.                        10890000
109000*                                                                 10900000
109100     CALL XL001-VSM-PGM USING DFHEIBLK                            10910000
109200                              XL001-COMMAREA                      10920000
109300                              XL001-ITEM-COMMAREA.                10930000
109400*                                                                 10940000
109500     MOVE XL001-SQLCA       TO SQLCA.                             10950000
109600     MOVE XL001-SKU-SQLCODE TO SQLCODE.                           10960000
109700*                                                                 10970000
109800     EVALUATE TRUE                                                10980000
109900        WHEN SQLCODE = ZERO                                       10990002
110000            CONTINUE                                              11000002
110100        WHEN SQLCODE = +100                                       11010000
110200            MOVE -1                   TO APONBRL                  11020000
110300            MOVE PC-SKU-NOT-FOUND-MSG TO AMSGLN1O                 11030000
110400            MOVE DK-ITM-NBR           TO AMSGLN2O                 11040000
110500            PERFORM 8100-SEND-DATA-ONLY                           11050000
110600            PERFORM 8200-RETURN-TRANID                            11060000
110700        WHEN SQLCODE = -904                                       11070000
110800        WHEN SQLCODE = -913                                       11080000
110900            CONTINUE                                              11090000
111000        WHEN SQLWARN0 NOT = SPACES                                11100000
111100        WHEN SQLCODE < ZERO                                       11110000
111200        WHEN SQLCODE > ZERO                                       11120000
111300            MOVE '7250-CALL-XLKUT-DOMAIN-PGM'                     11130000
111400                       TO DP013-PARAGRAPH                         11140000
111500            MOVE 'SELECT INFORMATION FOR ITM NBR:'                11150000
111600                       TO DP013-MESSAGE-TEXT (1)                  11160000
111700            MOVE DK-ITM-NBR                                       11170000
111800                       TO DP013-MESSAGE-TEXT (2)                  11180000
111900            MOVE SQLCA            TO DP013-SQLCA                  11190000
112000            MOVE 'XLV_SKU'        TO DP013-DB2-TABLE-NAME (1)     11200000
112100            SET DP013-DB2-ABEND   TO TRUE                         11210000
112200            SET DP013-NO-ROLLBACK TO TRUE                         11220000
112300            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                11230000
112400            MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O            11240000
112500            MOVE -1                        TO APONBRL             11250000
112600            PERFORM 8100-SEND-DATA-ONLY                           11260000
112700            PERFORM 8200-RETURN-TRANID                            11270000
112800     END-EVALUATE.                                                11280000
112900*                                                                 11290000
113000     MOVE XL001-VND-STYL-SQLCODE TO SQLCODE.                      11300000
113100*                                                                 11310000
113200     EVALUATE TRUE                                                11320000
113300        WHEN SQLCODE = ZERO                                       11330002
113400            CONTINUE                                              11340002
113500        WHEN SQLCODE = +100                                       11350000
113600        WHEN SQLCODE = -904                                       11360000
113700        WHEN SQLCODE = -913                                       11370000
113800            CONTINUE                                              11380000
113900        WHEN SQLCODE < ZERO                                       11390000
114000        WHEN SQLCODE > ZERO                                       11400000
114100            MOVE '7250-CALL-XLKUT-DOMAIN-PGM'                     11410000
114200                       TO DP013-PARAGRAPH                         11420000
114300            MOVE 'SELECT INFORMATION FOR ITM NBR:'                11430000
114400                       TO DP013-MESSAGE-TEXT (1)                  11440000
114500            MOVE DK-ITM-NBR                                       11450000
114600                       TO DP013-MESSAGE-TEXT (2)                  11460000
114700            MOVE SQLCA            TO DP013-SQLCA                  11470000
114800            MOVE 'XLV_VND_STYL'   TO DP013-DB2-TABLE-NAME (1)     11480000
114900            SET DP013-DB2-ABEND   TO TRUE                         11490000
115000            SET DP013-NO-ROLLBACK TO TRUE                         11500000
115100            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                11510000
115200            MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O            11520000
115300            MOVE -1                        TO APONBRL             11530000
115400            PERFORM 8100-SEND-DATA-ONLY                           11540000
115500            PERFORM 8200-RETURN-TRANID                            11550000
115600     END-EVALUATE.                                                11560000
115700*                                                                 11570000
115800     MOVE XL001-SKU-STR-SQLCODE TO SQLCODE.                       11580000
115900*                                                                 11590000
116000     EVALUATE TRUE                                                11600000
116100        WHEN SQLCODE = ZERO                                       11610002
116200            CONTINUE                                              11620002
116300        WHEN SQLCODE = +100                                       11630000
116400        WHEN SQLCODE = -904                                       11640000
116500        WHEN SQLCODE = -913                                       11650000
116600            CONTINUE                                              11660000
116700        WHEN SQLCODE < ZERO                                       11670000
116800        WHEN SQLCODE > ZERO                                       11680000
116900            MOVE '7250-CALL-XLKUT-DOMAIN-PGM'                     11690000
117000                       TO DP013-PARAGRAPH                         11700000
117100            MOVE 'SELECT INFORMATION FOR ITM NBR:'                11710000
117200                       TO DP013-MESSAGE-TEXT (1)                  11720000
117300            MOVE DK-ITM-NBR                                       11730000
117400                       TO DP013-MESSAGE-TEXT (2)                  11740000
117500            MOVE SQLCA            TO DP013-SQLCA                  11750000
117600            MOVE 'XLV_SKU_STR'    TO DP013-DB2-TABLE-NAME (1)     11760000
117700            SET DP013-DB2-ABEND   TO TRUE                         11770000
117800            SET DP013-NO-ROLLBACK TO TRUE                         11780000
117900            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                11790000
118000            MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O            11800000
118100            MOVE -1                        TO APONBRL             11810000
118200            PERFORM 8100-SEND-DATA-ONLY                           11820000
118300            PERFORM 8200-RETURN-TRANID                            11830000
118400     END-EVALUATE.                                                11840000
118500******************************************************************11850000
118600*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *11860000
118700******************************************************************11870000
118800/                                                                 11880000
118900 7300-GET-PRIMARY-VNDR-NME.                                       11890000
119000     INITIALIZE DCLTENTNME.                                       11900000
119100                                                                  11910000
119200     PERFORM                                                      11920000
119300         WITH TEST AFTER                                          11930000
119400         VARYING PV-SELECT-COUNTER                                11940000
119500         FROM 1 BY 1                                              11950000
119600         UNTIL ((PV-SELECT-COUNTER > PC-MAX-RETRIES)              11960000
119700            OR   (SQLCODE = ZERO)                                 11970000
119800            OR   (SQLCODE = PC-ROW-NOT-FOUND))                    11980000
119900                                                                  11990000
120000         EXEC SQL                                                 12000000
120100             SELECT  ENT_NAME_DESC                                12010000
120200               INTO  :ENTNME-ENT-NAME-DESC                        12020000
120300               FROM  TENTNME                                      12030000
120400              WHERE  (ENT_ID    =  :PURCHS-ENT-ID                 12040000
120500                AND   TYPE_CDE  =  '01')                          12050000
120600         END-EXEC                                                 12060000
120700                                                                  12070000
120800         EVALUATE TRUE                                            12080000
120900             WHEN SQLCODE = ZERO                                  12090002
121000                 MOVE ENTNME-ENT-NAME-DESC                        12100002
121100                     TO CA-IN-HOUSE-VENDOR-NAME                   12110002
121200             WHEN SQLCODE = PC-ROW-NOT-FOUND                      12120000
121300                 MOVE PC-NO-VENDOR-NAME-MSG                       12130000
121400                     TO CA-IN-HOUSE-VENDOR-NAME                   12140000
121500             WHEN SQLCODE = -904                                  12150000
121600             WHEN SQLCODE = -913                                  12160000
121700                 CONTINUE                                         12170000
121800             WHEN SQLWARN0 NOT = SPACES                           12180000
121900             WHEN SQLCODE < ZERO                                  12190000
122000             WHEN SQLCODE > ZERO                                  12200000
122100                 MOVE '7300-GET-PRIMARY-VNDR-NME'                 12210000
122200                                    TO DP013-PARAGRAPH            12220000
122300                 MOVE 'SELECT PRIMARY VENDOR NAME ENT ID = '      12230000
122400                                    TO DP013-MESSAGE-TEXT (1)     12240000
122500                 MOVE PURCHS-ENT-ID TO PV-DISPLAY-ENT-ID          12250000
122600                 MOVE PV-DISPLAY-ENT-ID                           12260000
122700                                    TO DP013-MESSAGE-TEXT (2)     12270000
122800                 MOVE SQLCA            TO DP013-SQLCA             12280000
122900                 MOVE 'TENTNME'        TO DP013-DB2-TABLE-NAME (1)12290000
123000                 SET DP013-DB2-ABEND   TO TRUE                    12300000
123100                 SET DP013-NO-ROLLBACK TO TRUE                    12310000
123200                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           12320000
123300                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O       12330000
123400                 MOVE -1                        TO APONBRL        12340000
123500                 PERFORM 8100-SEND-DATA-ONLY                      12350000
123600                 PERFORM 8200-RETURN-TRANID                       12360000
123700         END-EVALUATE                                             12370000
123800     END-PERFORM.                                                 12380000
123900                                                                  12390000
124000     IF  PV-SELECT-COUNTER > PC-MAX-RETRIES                       12400000
124100         MOVE '7300-GET-PRIMARY-VNDR-NME'                         12410000
124200                                     TO DP013-PARAGRAPH           12420000
124300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     12430000
124400                                     TO DP013-MESSAGE-TEXT (1)    12440000
124500         MOVE 'THE PRIMARY VENDOR NAME.  ENT ID = '               12450000
124600                                     TO DP013-MESSAGE-TEXT (2)    12460000
124700         MOVE PURCHS-ENT-ID          TO PV-DISPLAY-ENT-ID         12470000
124800         MOVE PV-DISPLAY-ENT-ID      TO DP013-MESSAGE-TEXT (3)    12480000
124900         MOVE SQLCA                  TO DP013-SQLCA               12490000
125000         MOVE 'TENTNME'              TO DP013-DB2-TABLE-NAME (1)  12500000
125100         SET DP013-DB2-ABEND         TO TRUE                      12510000
125200         SET DP013-NO-ROLLBACK       TO TRUE                      12520000
125300         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   12530000
125400         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O               12540000
125500         MOVE -1                        TO APONBRL                12550000
125600         PERFORM 8100-SEND-DATA-ONLY                              12560000
125700         PERFORM 8200-RETURN-TRANID                               12570000
125800     END-IF.                                                      12580000
125900*                                                                 12590000
126000 7400-GET-FCLTY-AREA-ID.                                          12600000
126100*    MOVE 85  TO DK-OPER-UNT-ID.                                  12610000
126200*    MOVE  1  TO DK-FCLTY-ID.                                     12620000
126300     MOVE CA-OPER-UNT-ID TO DK-OPER-UNT-ID.                       12630000
126400     MOVE CA-FCLTY-ID    TO DK-FCLTY-ID.                          12640000
126500                                                                  12650000
126600     INITIALIZE DCLTDCFAAS                                        12660000
126700                DCLTOPRSET.                                       12670000
126800                                                                  12680000
126900     PERFORM                                                      12690000
127000         WITH TEST AFTER                                          12700000
127100         VARYING PV-SELECT-COUNTER                                12710000
127200         FROM 1 BY 1                                              12720000
127300         UNTIL ((PV-SELECT-COUNTER > PC-MAX-RETRIES)              12730000
127400            OR  (SQLCODE = ZERO)                                  12740000
127500            OR  (SQLCODE = +100))                                 12750000
127600                                                                  12760000
127700         EXEC SQL                                                 12770000
127800             SELECT  A.FCLTY_AREA_ID                              12780000
127900               INTO  :DCFAAS-FCLTY-AREA-ID                        12790000
128000                          :DN-DCFAAS-FCLTY-ID-NULL                12800000
128100               FROM TDCFAAS A,                                    12810000
128200                    TOPRSET B                                     12820000
128300              WHERE  (A.OPER_UNT_ID        = :DK-OPER-UNT-ID      12830000
128400                AND   A.FCLTY_ID           = :DK-FCLTY-ID         12840000
128500                AND   A.DEPT_NBR           = :PURCHS-DEPT-NBR     12850000
128600                AND   A.CL_NBR             = :PURITM-CL-NBR       12860000
128700                AND   A.FCLTY_LOC_TYP_CDE  =  'PA'                12870000
128800                AND   A.RANK_NBR           = 1                    12880000
128900                AND   A.OPER_SET_ID        =  B.OPER_SET_ID       12890000
129000                AND   B.VER_STATUS_CDE     = 'A'                  12900001
129100                AND   A.OPER_UNT_ID        = B.OPER_UNT_ID)       12910001
129200         END-EXEC                                                 12920000
129300                                                                  12930000
129400         EVALUATE TRUE                                            12940000
129500             WHEN SQLCODE = +0 AND                                12950002
129600                 DN-DCFAAS-FCLTY-ID-NULL = ZERO                   12960002
129700                 MOVE DCFAAS-FCLTY-AREA-ID                        12970002
129800                     TO  CA-MDSE-PRC-AREA-CDE                     12980002
129900             WHEN SQLCODE = +100                                  12990000
130000                 MOVE SPACES  TO  CA-MDSE-PRC-AREA-CDE            13000000
130100             WHEN SQLCODE = -904                                  13010000
130200             WHEN SQLCODE = -913                                  13020000
130300                 CONTINUE                                         13030000
130400             WHEN SQLWARN0 NOT = SPACES                           13040000
130500             WHEN SQLCODE < ZERO                                  13050000
130600             WHEN SQLCODE > ZERO                                  13060000
130700                  MOVE '7400-GET-FCLTY-AREA-ID'                   13070000
130800                                     TO DP013-PARAGRAPH           13080000
130900                  MOVE 'SELECT LOCATION KEYS = '                  13090000
131000                                     TO DP013-MESSAGE-TEXT (1)    13100000
131100                  MOVE DK-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID   13110000
131200                  MOVE DK-FCLTY-ID   TO PV-DISPLAY-FCLTY-ID       13120000
131300                  MOVE PV-DISPLAY-KEYS                            13130000
131400                                     TO DP013-MESSAGE-TEXT (2)    13140000
131500                 MOVE SQLCA            TO DP013-SQLCA             13150000
131600                 MOVE 'TDCFASS'        TO DP013-DB2-TABLE-NAME (1)13160000
131700                 MOVE 'TOPRSET'        TO DP013-DB2-TABLE-NAME (2)13170000
131800                 SET DP013-DB2-ABEND   TO TRUE                    13180000
131900                 SET DP013-NO-ROLLBACK TO TRUE                    13190000
132000                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           13200000
132100                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O       13210000
132200                 MOVE -1                        TO APONBRL        13220000
132300                 PERFORM 8100-SEND-DATA-ONLY                      13230000
132400                 PERFORM 8200-RETURN-TRANID                       13240000
132500             WHEN SQLCODE = ZERO                                  13250000
132600                 MOVE SPACES  TO  CA-MDSE-PRC-AREA-CDE            13260000
132700         END-EVALUATE                                             13270000
132800     END-PERFORM.                                                 13280000
132900                                                                  13290000
133000     IF  PV-SELECT-COUNTER > PC-MAX-RETRIES                       13300000
133100         MOVE '7400-GET-FCLTY-AREA-ID'                            13310000
133200                                     TO DP013-PARAGRAPH           13320000
133300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     13330000
133400                                     TO DP013-MESSAGE-TEXT (1)    13340000
133500         MOVE 'THE LOCATION.  KEYS = '                            13350000
133600                                     TO DP013-MESSAGE-TEXT (2)    13360000
133700         MOVE PV-DISPLAY-KEYS        TO DP013-MESSAGE-TEXT (3)    13370000
133800         MOVE SQLCA                  TO DP013-SQLCA               13380000
133900         MOVE 'TDCFASS'              TO DP013-DB2-TABLE-NAME (1)  13390000
134000         MOVE 'TOPRSET'              TO DP013-DB2-TABLE-NAME (2)  13400000
134100         SET DP013-DB2-ABEND         TO TRUE                      13410000
134200         SET DP013-NO-ROLLBACK       TO TRUE                      13420000
134300         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   13430000
134400         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN2O               13440000
134500         MOVE -1                     TO APONBRL                   13450000
134600         PERFORM 8100-SEND-DATA-ONLY                              13460000
134700         PERFORM 8200-RETURN-TRANID                               13470000
134800     END-IF.                                                      13480000
134900*                                                                 13490000
135000 8000-SEND-MAP.                                                   13500000
135100     EXEC CICS                                                    13510000
135200         SEND MAP     ('MP023A')                                  13520000
135300              MAPSET  ('MPKM023')                                 13530000
135400              ERASE                                               13540000
135500              RESP    (PV-CICS-RESPONSE)                          13550000
135600     END-EXEC.                                                    13560000
135700                                                                  13570000
135800     EVALUATE TRUE                                                13580000
135900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13590000
136000             CONTINUE                                             13600000
136100         WHEN OTHER                                               13610000
136200             MOVE '8000-SEND-MAP'      TO DP013-PARAGRAPH         13620000
136300             MOVE 'UNABLE TO SEND MAP' TO DP013-MESSAGE-TEXT (1)  13630000
136400             SET DP013-CICS-ABEND      TO TRUE                    13640000
136500             SET DP013-NO-ROLLBACK     TO TRUE                    13650000
136600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               13660000
136700     END-EVALUATE.                                                13670000
136800*                                                                 13680000
136900 8100-SEND-DATA-ONLY.                                             13690000
137000     EXEC CICS                                                    13700000
137100         SEND MAP       ('MP023A')                                13710000
137200              MAPSET    ('MPKM023')                               13720000
137300              CURSOR                                              13730000
137400              DATAONLY                                            13740000
137500              RESP      (PV-CICS-RESPONSE)                        13750000
137600     END-EXEC.                                                    13760000
137700                                                                  13770000
137800     EVALUATE TRUE                                                13780000
137900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13790000
138000             CONTINUE                                             13800000
138100         WHEN OTHER                                               13810000
138200             MOVE '8100-SEND-DATA-ONLY' TO DP013-PARAGRAPH        13820000
138300             MOVE 'UNABLE TO SEND DATA' TO DP013-MESSAGE-TEXT (1) 13830000
138400             SET DP013-CICS-ABEND       TO TRUE                   13840000
138500             SET DP013-NO-ROLLBACK      TO TRUE                   13850000
138600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               13860000
138700     END-EVALUATE.                                                13870000
138800*                                                                 13880000
138900 8200-RETURN-TRANID.                                              13890000
139000     EXEC CICS                                                    13900000
139100         RETURN TRANSID  (PC-TRANID)                              13910000
139200                COMMAREA (CA-COMMAREA)                            13920000
139300                LENGTH   (PC-COMMAREA-LENGTH)                     13930000
139400                RESP     (PV-CICS-RESPONSE)                       13940000
139500     END-EXEC.                                                    13950000
139600                                                                  13960000
139700     EVALUATE TRUE                                                13970000
139800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13980000
139900             CONTINUE                                             13990000
140000         WHEN OTHER                                               14000000
140100             MOVE '8200-RETURN-TRANIND' TO DP013-PARAGRAPH        14010000
140200             MOVE 'UNABLE TO RETURN TO TRANID'                    14020000
140300                 TO DP013-MESSAGE-TEXT (1)                        14030000
140400             SET DP013-CICS-ABEND       TO TRUE                   14040000
140500             SET DP013-NO-ROLLBACK      TO TRUE                   14050000
140600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               14060000
140700     END-EVALUATE.                                                14070000
140800*                                                                 14080000
140900 8300-RETURN.                                                     14090000
141000     EXEC CICS                                                    14100000
141100         SEND FROM (PV-MESSAGE-AREA)                              14110000
141200              LENGTH (19)                                         14120000
141300              ERASE                                               14130000
141400     END-EXEC.                                                    14140000
141500                                                                  14150000
141600     EXEC CICS                                                    14160000
141700         RETURN                                                   14170000
141800     END-EXEC.                                                    14180000
141900*                                                                 14190000
142000 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  14200000
142100     MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              14210000
142200     MOVE DFHEIBLK                 TO DP013-DFHEIBLK.             14220000
142300     INITIALIZE DP013-SRC-TASK-NUMBER                             14230000
142400                DP013-STACK.                                      14240000
142500     SET DP013-LINK-RETURN TO TRUE.                               14250000
142600                                                                  14260000
142700     EXEC CICS                                                    14270000
142800         LINK                                                     14280000
142900             PROGRAM   (DP013-NAME)                               14290000
143000             COMMAREA  (DP013-PARAMETERS)                         14300000
143100             LENGTH    (DP013-LENGTH)                             14310000
143200     END-EXEC.                                                    14320000
143300*                                                                 14330000
