000100*----------------------------*                                    00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*----------------------------*                                    00030000
000400 PROGRAM-ID.    RCKCS821.                                         00040000
000500 AUTHOR.        JOHN HUTCHINSON.                                  00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  FEBRUARY, 2003.                                   00070000
000800 DATE-COMPILED.                                                   00080000
000900*                                                                 00090099
001000*********************************************************         00100099
001100* *   IF ANY CHANGES ARE MADE TO THIS PROGRAM         * *         00110099
001200* *   BE SURE TO CHECK THE BATCH PROGRAM (RCKUP821)   * *         00120099
001300* *   TO SEE IF THE SAME CHANGE SHOULD BE MADE        * *         00130099
001400*********************************************************         00140099
001500*                                                                 00150099
001600* -------------------------------------------------------------- *00160000
001700*    E821 - TRANSCRIBE/TROUBLE CONTROLLER                         00170000
001800*                                                                 00180000
001900*    CALLED FROM TMKCS520 USING TMWS500 COMMAREA.                 00190000
002000*                                                                 00200000
002100*    THIS MODULE (FOR BULK / PREPACK PROCESSES) WILL GATHER ALL   00210000
002200*    OF THE DB2 DATA TO SUPPORT THE COMPLETION OF TROUBLE AND     00220000
002300*    TRANSCRIPTION. ALL THE DB2 DATA NEEDED TO SUPPORT TROUBLE    00230000
002400*    AND PRORATION WILL BE GATHERED IN THIS CONTROLLER, THEN      00240000
002500*    TABLEIZED INTO A COBOL DATA STRUCTURE AND PASSED BETWEEN     00250000
002600*    THE SUB-MODULES TO COMPLETE THE TROUBLE, PRORATION AND       00260000
002700*    ALLOCATION.  THE MAIN CONTROLLER WILL CALL A NEW OTR (OPEN   00270000
002800*    TO RECEIVE) ROUTINE TO SATISFY ALL OPEN TO RECEIVE CALCU-    00280000
002900*    LATIONS. UPON GATHERING ALL OF THE DATA ELEMENTS, THE MAIN   00290000
003000*    MODULE CALLS A NEW TROUBLE MODULE, THEN THE NEW PRORATION    00300000
003100*    MODULE, AND FINALLY THE ALLOCATION MODULE. THE ALLOCATION    00310000
003200*    MODULE DISTRIBUTES THE UNITS TO RECDIS.                      00320000
003300* -------------------------------------------------------------- *00330000
003400*----------------------------*                                    00340000
003500 ENVIRONMENT DIVISION.                                            00350000
003600*----------------------------*                                    00360000
003700 CONFIGURATION SECTION.                                           00370000
003800 SOURCE-COMPUTER.        IBM-3090.                                00380000
003900 OBJECT-COMPUTER.        IBM-3090.                                00390000
004000 DATA DIVISION.                                                   00400000
004100*----------------------------*                                    00410000
004200 WORKING-STORAGE SECTION.                                         00420000
004300*----------------------------*                                    00430000
004400 01  PS-PROGRAM-SWITCHES.                                         00440000
004500                                                                  00450000
004600     05  PS-DONE-SW              PIC  X(01)  VALUE 'N'.           00460000
004700         88  PS-DONE-YES                     VALUE 'Y'.           00470002
004800         88  PS-DONE-NO                      VALUE 'N'.           00480003
004900                                                                  00490000
005000     05  PS-END-OF-PO-BULK-SW    PIC  X(01)  VALUE 'N'.           00500000
005100         88  PS-PO-BULK-CSR-EOF              VALUE 'Y'.           00510000
005200         88  PS-PO-BULK-CSR-START            VALUE 'N'.           00520000
005300                                                                  00530000
005400     05  PS-END-OF-PO-PACK-SW    PIC  X(01)  VALUE 'N'.           00540000
005500         88  PS-PO-PACK-CSR-EOF              VALUE 'Y'.           00550000
005600         88  PS-PO-PACK-CSR-START            VALUE 'N'.           00560000
005700                                                                  00570000
005800     05  PS-END-OF-RC-BULK-SW    PIC  X(01)  VALUE 'N'.           00580000
005900         88  PS-RC-BULK-CSR-EOF              VALUE 'Y'.           00590000
006000         88  PS-RC-BULK-CSR-START            VALUE 'N'.           00600000
006100                                                                  00610000
006200     05  PS-END-OF-RC-PACK-SW    PIC  X(01)  VALUE 'N'.           00620000
006300         88  PS-RC-PACK-CSR-EOF              VALUE 'Y'.           00630000
006400         88  PS-RC-PACK-CSR-START            VALUE 'N'.           00640000
006500                                                                  00650000
006600     05  PS-UPDATE-RECITM-SW     PIC  X(01)  VALUE 'N'.           00660000
006700         88  PS-UPDATE-RECITM-YES            VALUE 'Y'.           00670000
006800         88  PS-UPDATE-RECITM-NO             VALUE 'N'.           00680000
006900                                                                  00690000
007000     05  PS-DRIVER-FOUND-SW      PIC  X(01)  VALUE 'N'.           00700000
007100         88  PS-DRIVER-FOUND-YES             VALUE 'Y'.           00710000
007200         88  PS-DRIVER-FOUND-NO              VALUE 'N'.           00720000
007300                                                                  00730000
007400     05  PS-DRIVER-LINE-SW       PIC  X(01)  VALUE 'Y'.           00740000
007500         88  PS-SAME-DRIVER-LINE-YES         VALUE 'Y'.           00750000
007600         88  PS-SAME-DRIVER-LINE-NO          VALUE 'N'.           00760000
007700                                                                  00770000
007800     05  PS-PACKAGE-CODE         PIC  X(01)  VALUE SPACE.         00780000
007900         88  PS-BULK                         VALUE 'B' 'C' 'S'.   00790000
008000         88  PS-PREPACK                      VALUE 'I' 'M'.       00800000
008100                                                                  00810000
008200 01  PC-PROGRAM-CONSTANTS.                                        00820000
008300     05  PC-CURRENT-PROGRAM-NAME PIC  X(08)  VALUE 'RCKCS821'.    00830000
008400     05  PC-RCKCS806             PIC  X(08)  VALUE 'RCKCS806'.    00840000
008500     05  PC-RCKCS811             PIC  X(08)  VALUE 'RCKCS811'.    00850000
008600     05  PC-RCKCS822             PIC  X(08)  VALUE 'RCKCS822'.    00860000
008700     05  PC-RCKCS823             PIC  X(08)  VALUE 'RCKCS823'.    00870000
008800     05  PC-RCKCS824             PIC  X(08)  VALUE 'RCKCS824'.    00880000
008900     05  PC-SPACE                PIC  X(01)  VALUE SPACE.         00890000
009000     05  PC-ZERO                 PIC  X(01)  VALUE '0'.           00900000
009100     05  PC-ONE                  PIC  X(01)  VALUE '1'.           00910000
009200     05  PC-A                    PIC  X(01)  VALUE 'A'.           00920000
009300     05  PC-B                    PIC  X(01)  VALUE 'B'.           00930000
009400     05  PC-C                    PIC  X(01)  VALUE 'C'.           00940000
009500     05  PC-I                    PIC  X(01)  VALUE 'I'.           00950000
009600     05  PC-K                    PIC  X(01)  VALUE 'K'.           00960000
009700     05  PC-M                    PIC  X(01)  VALUE 'M'.           00970000
009800     05  PC-N                    PIC  X(01)  VALUE 'N'.           00980000
009900     05  PC-O                    PIC  X(01)  VALUE 'O'.           00990000
010000     05  PC-P                    PIC  X(01)  VALUE 'P'.           01000000
010100     05  PC-R                    PIC  X(01)  VALUE 'R'.           01010000
010200     05  PC-S                    PIC  X(01)  VALUE 'S'.           01020000
010300     05  PC-X                    PIC  X(01)  VALUE 'X'.           01030000
010400     05  PC-U                    PIC  X(01)  VALUE 'U'.           01040000
010500     05  PC-Y                    PIC  X(01)  VALUE 'Y'.           01050000
010600     05  PC-AC                   PIC  X(02)  VALUE 'AC'.          01060000
010700     05  PC-AP                   PIC  X(02)  VALUE 'AP'.          01070000
010800     05  PC-CS                   PIC  X(02)  VALUE 'CS'.          01080000
010900     05  PC-DS                   PIC  X(02)  VALUE 'DS'.          01090000
011000     05  PC-DC                   PIC  X(02)  VALUE 'DC'.          01100000
011100     05  PC-IP                   PIC  X(02)  VALUE 'IP'.          01110000
011200     05  PC-IE                   PIC  X(02)  VALUE 'IE'.          01120000
011300     05  PC-IF                   PIC  X(02)  VALUE 'IF'.          01130000
011400     05  PC-IM                   PIC  X(02)  VALUE 'IM'.          01140000
011500     05  PC-RV                   PIC  X(02)  VALUE 'RV'.          01150000
011600     05  PC-03                   PIC  X(02)  VALUE '03'.          01160000
011700     05  PC-10                   PIC  X(03)  VALUE '010'.         01170000
011800     05  PC-11                   PIC  X(03)  VALUE '011'.         01180000
011900     05  PC-21                   PIC  X(03)  VALUE '021'.         01190000
012000     05  PC-26                   PIC  X(03)  VALUE '026'.         01200000
012100     05  PC-27                   PIC  X(03)  VALUE '027'.         01210000
012200     05  PC-28                   PIC  X(03)  VALUE '028'.         01220000
012300     05  PC-29                   PIC  X(03)  VALUE '029'.         01230000
012400     05  PC-30                   PIC  X(03)  VALUE '030'.         01240000
012500     05  PC-31                   PIC  X(03)  VALUE '031'.         01250000
012600     05  PC-32                   PIC  X(03)  VALUE '032'.         01260000
012700     05  PC-33                   PIC  X(03)  VALUE '033'.         01270000
012800     05  PC-34                   PIC  X(03)  VALUE '034'.         01280000
012900     05  PC-090                  PIC  X(03)  VALUE '090'.         01290000
013000     05  PC-267                  PIC S9(04)  VALUE +267 COMP.     01300000
013100     05  PC-570                  PIC S9(04)  VALUE +570 COMP.     01310000
013200     05  PC-9999                 PIC S9(04)  VALUE +9999 COMP.    01320051
013300                                                                  01330000
013400 01  DK-DATABASE-KEYS.                                            01340000
013500     05  DK-PREPK-RATO-QTY       PIC S9(04)  VALUE +0   COMP.     01350003
013600     05  DK-STR-NBR              PIC S9(04)  VALUE +0   COMP.     01360003
013700     05  DK-LOC-STR-NBR          PIC S9(04)  VALUE +0   COMP.     01370099
013800     05  DK-DC-NMBR              PIC S9(04)  VALUE +0   COMP.     01380099
013900     05  DK-LOC-NBR              PIC S9(04)  VALUE +090 COMP.     01390003
014000     05  DK-RCT-LOC-NBR          PIC S9(04)  VALUE +0   COMP.     01400003
014100     05  DK-DEPT-NBR             PIC S9(04)V VALUE +0   COMP-3.   01410003
014200     05  DK-MAJ-CL-NBR           PIC S9(04)V VALUE +0   COMP-3.   01420003
014300     05  DK-SUB-CL-NBR           PIC S9(04)V VALUE +0   COMP-3.   01430003
014400     05  DK-ITM-NBR              PIC S9(15)V VALUE +0   COMP-3.   01440003
014500     05  DK-PRORATE-IND          PIC  X(01)  VALUE SPACES.        01450000
014600     05  DK-ALLOC-IND            PIC  X(01)  VALUE SPACES.        01460000
014700     05  DK-PKGNG-CDE            PIC  X(01)  VALUE SPACES.        01470000
014800     05  DK-MERCH-TYPE-CDE       PIC  X(01)  VALUE SPACES.        01480000
014900     05  DK-TRB-LVL-CDE          PIC  X(01)  VALUE SPACES.        01490000
015000     05  DK-NEW-STORE-IND        PIC  X(01)  VALUE SPACES.        01500000
015100                                                                  01510003
015200                                                                  01520003
015300 01  PV-PROGRAM-VARIABLES.                                        01530003
015400     05  PV-ABEND-CODE           PIC S9(04)  VALUE +0 COMP.       01540003
015500     05  PV-PO-RECEIV-CNT        PIC S9(09)  VALUE +0 COMP.       01550003
015600     05  PV-BULK-CNT             PIC S9(09)  VALUE +0 COMP.       01560003
015700     05  PV-PREPACK-CNT          PIC S9(09)  VALUE +0 COMP.       01570003
015800     05  PV-STORE-CNT            PIC S9(09)  VALUE +0 COMP.       01580060
015900     05  PV-SUM-STORE-PLAN-QTY   PIC S9(09)  VALUE +0 COMP.       01590003
016000     05  PV-ITEM                 PIC S9(04)  VALUE +0 COMP.       01600003
016100     05  PV-CICS-RESP            PIC S9(04)  VALUE +0 COMP.       01610003
016200     05  PV-SUB                  PIC S9(04)  VALUE +0 COMP.       01620003
016300     05  PV-HOLD-STR-COUNT       PIC S9(04)  VALUE +0 COMP.       01630003
016400     05  PV-HOLD-ITM-COUNT       PIC S9(04)  VALUE +0 COMP.       01640003
016500     05  PV-RANK-SEQ-NBR         PIC S9(04)  VALUE +0 COMP.       01650003
016600                                                                  01660003
016700     05  PV-QUEUE-NAME.                                           01670003
016800         10  PV-TERM-ID          PIC  X(04)  VALUE SPACES.        01680003
016900         10  PV-TASK-NUMBER      PIC S9(05)  VALUE +0 COMP-3.     01690003
017000         10  PV-SEQ              PIC  9(01)  VALUE 0 .            01700003
017100                                                                  01710003
017200 01  PV-DATE-FIELDS.                                              01720003
017300     05  PV-CURRENT-DATE           PIC  X(10) VALUE SPACES.       01730003
017400     05  PV-DB2-START-DATE         PIC  X(10) VALUE SPACES.       01740003
017500     05  PV-DB2-END-DATE           PIC  X(10) VALUE SPACES.       01750003
017600     05  PV-STR-ADJUSTED-OPEN-DATE PIC  X(10) VALUE SPACES.       01760003
017700     05  PV-EIBDATE.                                              01770003
017800         10  PV-EIBDATE-N          PIC  9(05).                    01780003
017900         10  FILLER                PIC  X(05).                    01790003
018000     05  PV-CPU-DATE.                                             01800003
018100         10  PV-YEAR               PIC  9(02).                    01810003
018200         10  PV-MONTH              PIC  9(02).                    01820003
018300         10  PV-DAY                PIC  9(02).                    01830003
018400                                                                  01840003
018500* -------------------------------------------------------------- *01850018
018600*    OUTPUT FORMAT FOR CSSL LOG.                                 *01860018
018700* -------------------------------------------------------------- *01870018
018800 01  RC001-WORK-FIELDS.                                           01880018
018900     05  RC001-LOG-QUEUE              PIC X(04) VALUE 'CSSL'.     01890018
019000     05  RC001-LOG-LINE               PIC X(80) VALUE SPACES.     01900018
019100     05  RC001-CICS-RESPONSE          PIC S9(8) COMP VALUE ZERO.  01910018
019200     05  RC001-SAVE-SQLCODE           PIC S9(8) COMP VALUE ZERO.  01920018
019300                                                                  01930018
019400 01  RC001-ERROR-MESSAGE-LINES.                                   01940018
019500     05  RC001-LINE-01.                                           01950018
019600         10  FILLER                   PIC X(44) VALUE             01960018
019700             '****** RCKCS821 - ALLOCATIONS ERROR ******  '.      01970018
019800         10  FILLER                   PIC X(03) VALUE SPACES.     01980018
019900         10  FILLER                   PIC X(08) VALUE             01990018
020000                                                'USERID= '.       02000018
020100         10  RC001-USERID             PIC X(07) VALUE SPACES.     02010018
020200         10  FILLER                   PIC X(18) VALUE SPACES.     02020018
020300     05  RC001-LINE-02.                                           02030018
020400         10  RC001-DATE               PIC X(10) VALUE SPACES.     02040018
020500         10  FILLER                   PIC X(02) VALUE SPACES.     02050018
020600         10  RC001-TIME               PIC X(08) VALUE SPACES.     02060018
020700         10  FILLER                   PIC X(02) VALUE SPACES.     02070018
020800         10  FILLER                   PIC X(11) VALUE             02080018
020900                                                'PARAGRAPH= '.    02090018
021000         10  RC001-PARAGRAPH          PIC X(30) VALUE ZEROES.     02100018
021100         10  FILLER                   PIC X(02) VALUE SPACES.     02110018
021200         10  FILLER                   PIC X(10) VALUE             02120018
021300                                                ' SQLCODE= '.     02130018
021400         10  RC001-SQLCODE            PIC -999.                   02140018
021500         10  FILLER                   PIC X(01) VALUE SPACES.     02150018
021600     05  RC001-LINE-03.                                           02160018
021700         10  FILLER                   PIC X(14) VALUE             02170018
021800                                                'PO/RCVR/LINE= '. 02180018
021900         10  RC001-PO.                                            02190018
022000             15  RC001-PO-NBR         PIC 9(08) VALUE ZEROES.     02200018
022100         10  FILLER                   PIC X(01) VALUE '/'.        02210018
022200         10  RC001-RCVR.                                          02220018
022300             15  RC001-REC-SEQ-NBR    PIC 9(03) VALUE ZEROES.     02230018
022400         10  FILLER                   PIC X(01) VALUE '/'.        02240018
022500         10  RC001-LINE.                                          02250018
022600             15 RC001-PO-LNE-NBR      PIC 9(03) VALUE ZEROES.     02260018
022700         10  FILLER                   PIC X(03) VALUE SPACES.     02270018
022800         10  FILLER                   PIC X(12) VALUE             02280018
022900                                                'OPER/FCLTY= '.   02290018
023000         10  RC001-OP.                                            02300018
023100             15 RC001-OPER-UNT-ID     PIC 9(04) VALUE ZEROES.     02310097
023200         10  FILLER                   PIC X(01) VALUE '/'.        02320018
023300         10  RC001-FCLTY.                                         02330018
023400             15  RC001-FCLTY-ID       PIC 9(01) VALUE ZEROES.     02340018
023500         10  FILLER                   PIC X(03) VALUE SPACES.     02350018
023600         10  FILLER                   PIC X(06) VALUE             02360018
023700                                                'PACK= '.         02370018
023800         10  RC001-PREPK-ID           PIC 9(04) VALUE ZEROES.     02380018
023900         10  FILLER                   PIC X(03) VALUE SPACES.     02390018
024000         10  FILLER                   PIC X(07) VALUE             02400018
024100                                                'STORE= '.        02410018
024200         10  RC001-STORE-NBR.                                     02420018
024300             15  RC001-STORE-NBR-N    PIC 9(04) VALUE ZEROES.     02430018
024400         10  FILLER                   PIC X(02) VALUE SPACES.     02440097
024500     05  RC001-LINE-04.                                           02450018
024600         10  RC001-SPECIAL-1          PIC X(40) VALUE SPACES.     02460018
024700         10  RC001-SPECIAL-2          PIC X(40) VALUE SPACES.     02470018
024800     05  RC001-LINE-05.                                           02480018
024900         10  FILLER                   PIC X(44) VALUE             02490018
025000             '****** RCKCS821 - ALLOCATIONS ERROR ******  '.      02500018
025100         10  FILLER                   PIC X(36) VALUE SPACES.     02510018
025200                                                                  02520003
025300* -------------------------------------------------------------- *02530003
025400*    COPYBOOK AREAS                                              *02540003
025500* -------------------------------------------------------------- *02550003
025600                                                                  02560003
025700* -------------------------------------------------------------- *02570003
025800*    INPUT PASSED FROM TMKCS520                                  *02580003
025900* -------------------------------------------------------------- *02590003
026000                                                                  02600003
026100     COPY TMWS500.                                                02610003
026200                                                                  02620003
026300     COPY TMWS501.                                                02630003
026400                                                                  02640003
026500                                                                  02650003
026600* -------------------------------------------------------------- *02660003
026700*    OUTPUT/INTERFACE DATA                                       *02670003
026800* -------------------------------------------------------------- *02680003
026900                                                                  02690003
027000* -------------------------------------------------------------- *02700003
027100*    TMP STORAGE QUEUE DATA FOR ALLOCATION / PRORATION / TROUBLE *02710003
027200* -------------------------------------------------------------- *02720003
027300                                                                  02730003
027400     COPY RCWS821.                                                02740015
027500                                                                  02750003
027600* -------------------------------------------------------------- *02760003
027700*    OPEN TO RECEIVE (OTR) COMMAREA                              *02770003
027800* -------------------------------------------------------------- *02780003
027900                                                                  02790003
028000     COPY RCWS822.                                                02800015
028100                                                                  02810003
028200* -------------------------------------------------------------- *02820003
028300*    TROUBLE COMMAREA                                            *02830003
028400* -------------------------------------------------------------- *02840003
028500                                                                  02850003
028600     COPY RCWS823.                                                02860015
028700                                                                  02870003
028800* -------------------------------------------------------------- *02880003
028900*    PRORATION COMMAREA                                          *02890003
029000* -------------------------------------------------------------- *02900003
029100                                                                  02910003
029200     COPY RCWS824.                                                02920015
029300                                                                  02930003
029400                                                                  02940003
029500* -------------------------------------------------------------- *02950003
029600*    PREPACK VALIDATION AREA                                     *02960003
029700* -------------------------------------------------------------- *02970003
029800                                                                  02980003
029900     COPY RCWS806.                                                02990003
030000                                                                  03000003
030100                                                                  03010003
030200* -------------------------------------------------------------- *03020003
030300*    RECDIS ROUTINE AREA                                         *03030003
030400* -------------------------------------------------------------- *03040003
030500                                                                  03050003
030600     COPY RCWS811.                                                03060003
030700                                                                  03070003
030800                                                                  03080003
030900* -------------------------------------------------------------- *03090003
031000*    CALENDAR VARIABLES                                          *03100003
031100* -------------------------------------------------------------- *03110003
031200                                                                  03120003
031300     COPY DPWS500.                                                03130052
031400                                                                  03140003
031500                                                                  03150003
031600* -------------------------------------------------------------- *03160003
031700*    LAYOUT FOR LOGISTICS DOMAIN ITEM ACCESS MODULE              *03170003
031800* -------------------------------------------------------------- *03180003
031900                                                                  03190003
032000     COPY XLWS001.                                                03200003
032100                                                                  03210003
032200*----------------------------------------------------------------*03220099
032300*  COPYBOOK FOR LOCATION CALL MODULE                              03230083
032400*-----------------------------------------------------------------03240083
032500     COPY XLWS071.                                                03250083
032600                                                                  03260083
032700                                                                  03270003
032800* -------------------------------------------------------------- *03280003
032900*    GLOBAL COMMAREA                                             *03290003
033000* -------------------------------------------------------------- *03300003
033100                                                                  03310003
033200     COPY DPWS020.                                                03320003
033300                                                                  03330003
033400* -------------------------------------------------------------- *03340003
033500*    DB2 SQL COMMUNICATION AREA                                  *03350003
033600* -------------------------------------------------------------- *03360003
033700                                                                  03370003
033800     EXEC SQL                                                     03380003
033900         INCLUDE SQLCA                                            03390003
034000     END-EXEC.                                                    03400003
034100                                                                  03410003
034200*XLT_DC_LOC_ASGMT                                                 03420099
034300     EXEC SQL                                                     03430099
034400         INCLUDE XLT00014                                         03440099
034500     END-EXEC.                                                    03450099
034600                                                                  03460099
034700                                                                  03470003
034800* -------------------------------------------------------------- *03480003
034900*    DB2 DCLGEN FOR TROUBLE RULES TABLE                          *03490003
035000* -------------------------------------------------------------- *03500003
035100                                                                  03510003
035200     EXEC SQL                                                     03520003
035300         INCLUDE RCT00000                                         03530003
035400     END-EXEC.                                                    03540003
035500                                                                  03550003
035600                                                                  03560003
035700* -------------------------------------------------------------- *03570003
035800*    DB2 DCLGEN FOR DEPARTMENT RANKING TABLE                     *03580003
035900* -------------------------------------------------------------- *03590003
036000                                                                  03600003
036100     EXEC SQL                                                     03610003
036200         INCLUDE RCT00005                                         03620003
036300     END-EXEC.                                                    03630003
036400                                                                  03640003
036500                                                                  03650003
036600* -------------------------------------------------------------- *03660003
036700*    DB2 DCLGEN FOR DEPARTMENT/MAJ CLASS RANKING TABLE           *03670003
036800* -------------------------------------------------------------- *03680003
036900                                                                  03690003
037000     EXEC SQL                                                     03700003
037100         INCLUDE RCT00006                                         03710003
037200     END-EXEC.                                                    03720003
037300                                                                  03730003
037400                                                                  03740003
037500* -------------------------------------------------------------- *03750003
037600*    DB2 DCLGEN FOR DEPARTMENT/MAJ/SUB CLASS RANKING TABLE       *03760003
037700* -------------------------------------------------------------- *03770003
037800                                                                  03780003
037900     EXEC SQL                                                     03790003
038000         INCLUDE RCT00007                                         03800003
038100     END-EXEC.                                                    03810003
038200                                                                  03820003
038300                                                                  03830003
038400* -------------------------------------------------------------- *03840003
038500*    DB2 DCLGEN FOR COMPANY WIDE RANKING TABLE                  * 03850003
038600* -------------------------------------------------------------- *03860003
038700                                                                  03870003
038800     EXEC SQL                                                     03880003
038900         INCLUDE RCT00008                                         03890003
039000     END-EXEC.                                                    03900003
039100                                                                  03910003
039200                                                                  03920003
039300* -------------------------------------------------------------- *03930003
039400*    DB2 DCLGEN FOR RCT_PRCG_CNTL TABLE                          *03940003
039500* -------------------------------------------------------------- *03950003
039600                                                                  03960003
039700     EXEC SQL                                                     03970003
039800         INCLUDE RCT00011                                         03980003
039900     END-EXEC.                                                    03990003
040000                                                                  04000003
040100                                                                  04010003
040200* -------------------------------------------------------------- *04020003
040300*    DB2 DCLGEN FOR PURCHASE ORDERS                              *04030003
040400* -------------------------------------------------------------- *04040003
040500                                                                  04050003
040600     EXEC SQL                                                     04060003
040700         INCLUDE TPURCHS                                          04070003
040800     END-EXEC.                                                    04080003
040900                                                                  04090003
041000                                                                  04100003
041100* -------------------------------------------------------------- *04110003
041200*    DB2 DCLGEN FOR PO PURCHASE ITEM TABLE (PO LINE ITEMS)       *04120003
041300* -------------------------------------------------------------- *04130003
041400                                                                  04140003
041500     EXEC SQL                                                     04150003
041600         INCLUDE TPURITM                                          04160003
041700     END-EXEC.                                                    04170003
041800                                                                  04180003
041900                                                                  04190003
042000* -------------------------------------------------------------- *04200003
042100*    DB2 DCLGEN FOR RECEIVER TABLE                               *04210003
042200* -------------------------------------------------------------- *04220003
042300                                                                  04230003
042400     EXEC SQL                                                     04240003
042500         INCLUDE TRECEIV                                          04250003
042600     END-EXEC.                                                    04260003
042700                                                                  04270003
042800                                                                  04280003
042900* -------------------------------------------------------------- *04290003
043000*    DB2 DCLGEN FOR RECEIVER ITEM                                *04300003
043100* -------------------------------------------------------------- *04310003
043200                                                                  04320003
043300     EXEC SQL                                                     04330003
043400         INCLUDE TRECITM                                          04340003
043500     END-EXEC.                                                    04350003
043600                                                                  04360003
043700* -------------------------------------------------------------- *04370003
043800*    DB2 DCLGEN FOR MERCHANDISE STORE ALLOCATION PLAN TABLE      *04380003
043900* -------------------------------------------------------------- *04390003
044000                                                                  04400003
044100     EXEC SQL                                                     04410003
044200         INCLUDE TALLPLN                                          04420003
044300     END-EXEC.                                                    04430003
044400                                                                  04440003
044500                                                                  04450003
044600* -------------------------------------------------------------- *04460003
044700*    DB2 DCLGEN FOR MERCHANDISE STORE DISTRIBUTION PLAN TABLE    *04470003
044800* -------------------------------------------------------------- *04480003
044900                                                                  04490003
045000     EXEC SQL                                                     04500003
045100         INCLUDE TMESTDS                                          04510003
045200     END-EXEC.                                                    04520003
045300                                                                  04530003
045400                                                                  04540003
045500     EXEC SQL                                                     04550003
045600         INCLUDE TPOPRPK                                          04560003
045700     END-EXEC.                                                    04570003
045800                                                                  04580003
045900                                                                  04590003
046000     EXEC SQL                                                     04600003
046100         INCLUDE TTRBNTF                                          04610003
046200     END-EXEC.                                                    04620003
046300                                                                  04630003
046400                                                                  04640003
046500     EXEC SQL                                                     04650003
046600         INCLUDE TCOCNTL                                          04660003
046700     END-EXEC.                                                    04670003
046800                                                                  04680003
046900     EXEC SQL                                                     04690003
047000         INCLUDE XLT00004                                         04700003
047100     END-EXEC.                                                    04710003
047200                                                                  04720074
047300                                                                  04730003
047400     EXEC SQL                                                     04740003
047500         INCLUDE TKRPRPM                                          04750003
047600     END-EXEC.                                                    04760003
047700                                                                  04770003
047800                                                                  04780003
047900* -------------------------------------------------------------- *04790003
048000*    PO CURSORS                                                  *04800003
048100*                                                                *04810003
048200*    BULK                                                        *04820003
048300* -------------------------------------------------------------- *04830003
048400                                                                  04840003
048500     EXEC SQL                                                     04850003
048600                                                                  04860003
048700         DECLARE PO-BULK-CSR CURSOR FOR                           04870003
048800                                                                  04880003
048900           SELECT A.DEPT_NBR                                      04890003
049000                , A.NEW_STR_PO_IND                                04900003
049100                , A.PO_TYP_CDE                                    04910003
049200                , A.IMPRT_PO_IND                                  04920003
049300                , A.PKGNG_CDE                                     04930065
049400                , A.PO_IN_RMS_IND                                 04940003
049500                , B.PO_LNE_NBR                                    04950003
049600                , B.APP_PO_LNE_NBR                                04960003
049700                , B.SKU_SEQ_NBR                                   04970003
049800                , B.STATUS_CDE                                    04980003
049900                , B.UNT_QTY                                       04990003
050000                , B.UNT_RTL_PR_AMT                                05000003
050100                , B.GP_RTL_AMT                                    05010003
050200                , B.GP_QTY                                        05020003
050300                , B.PIC_ITM_IND                                   05030003
050400                , B.ITM_NBR                                       05040003
050500                                                                  05050003
050600           FROM TPURCHS A                                         05060003
050700              , TPURITM B                                         05070003
050800                                                                  05080003
050900          WHERE A.PO_NBR          =  :RC821-ORD-NBR               05090013
051000            AND A.PO_NBR          =   B.PO_NBR                    05100003
051100            AND A.VER_STATUS_CDE  =  :PC-A                        05110003
051200            AND A.VER_STATUS_CDE  =   B.VER_STATUS_CDE            05120003
051300            AND B.APP_PO_LNE_NBR  =  :RC821-REC-DRV-LNE-NBR       05130013
051400                                                                  05140003
051500          WITH UR                                                 05150003
051600                                                                  05160003
051700     END-EXEC.                                                    05170003
051800                                                                  05180003
051900                                                                  05190003
052000* -------------------------------------------------------------- *05200003
052100*    PREPACK                                                     *05210003
052200* -------------------------------------------------------------- *05220003
052300                                                                  05230003
052400     EXEC SQL                                                     05240003
052500                                                                  05250003
052600       DECLARE PO-PACK-CSR CURSOR FOR                             05260003
052700                                                                  05270003
052800         SELECT A.DEPT_NBR                                        05280003
052900              , A.NEW_STR_PO_IND                                  05290003
053000              , A.PO_TYP_CDE                                      05300003
053100              , A.IMPRT_PO_IND                                    05310003
053200              , A.PKGNG_CDE                                       05320066
053300              , A.PO_IN_RMS_IND                                   05330003
053400              , B.PO_LNE_NBR                                      05340003
053500              , B.APP_PO_LNE_NBR                                  05350003
053600              , B.SKU_SEQ_NBR                                     05360003
053700              , B.STATUS_CDE                                      05370003
053800              , B.UNT_QTY                                         05380003
053900              , B.UNT_RTL_PR_AMT                                  05390003
054000              , B.GP_RTL_AMT                                      05400003
054100              , B.GP_QTY                                          05410003
054200              , B.PIC_ITM_IND                                     05420003
054300              , B.ITM_NBR                                         05430003
054400              , B.PREPK_RATO_QTY                                  05440003
054500              , C.PREPK_TYP_CDE                                   05450003
054600              , C.PREPK_STAT_CDE                                  05460003
054700              , C.PREPK_UPC_NBR                                   05470003
054800              , C.INPK_UNT_QTY                                    05480003
054900              , C.OTPK_UNT_QTY                                    05490003
055000              , C.PK_SKU_NBR                                      05500003
055100                                                                  05510003
055200             FROM TPURCHS A                                       05520003
055300                , TPURITM B                                       05530003
055400                , TPOPRPK C                                       05540003
055500                                                                  05550003
055600         WHERE A.PO_NBR          =  :RC821-ORD-NBR                05560013
055700           AND A.PO_NBR          =   B.PO_NBR                     05570003
055800           AND A.PO_NBR          =   C.PO_NBR                     05580003
055900           AND A.VER_STATUS_CDE  =  :PC-A                         05590003
056000           AND A.VER_STATUS_CDE  =   B.VER_STATUS_CDE             05600003
056100           AND B.PO_PREPK_ID     =  :RC821-PREPK-ID               05610013
056200           AND B.PO_PREPK_ID     =   C.PO_PREPK_ID                05620003
056300                                                                  05630003
056400         ORDER BY B.APP_PO_LNE_NBR                                05640003
056500                                                                  05650003
056600          WITH UR                                                 05660003
056700                                                                  05670003
056800     END-EXEC.                                                    05680003
056900                                                                  05690003
057000                                                                  05700003
057100* -------------------------------------------------------------- *05710053
057200*    RMS PACK '99' CURSOR                                        *05720053
057300* -------------------------------------------------------------- *05730053
057400                                                                  05740053
057500     EXEC SQL                                                     05750053
057600                                                                  05760053
057700       DECLARE PO-PACK-99-CSR CURSOR FOR                          05770053
057800                                                                  05780053
057900         SELECT A.DEPT_NBR                                        05790053
058000              , A.NEW_STR_PO_IND                                  05800053
058100              , A.PO_TYP_CDE                                      05810053
058200              , A.IMPRT_PO_IND                                    05820053
058300              , A.PKGNG_CDE                                       05830067
058400              , A.PO_IN_RMS_IND                                   05840053
058500              , B.PO_LNE_NBR                                      05850053
058600              , B.APP_PO_LNE_NBR                                  05860053
058700              , B.SKU_SEQ_NBR                                     05870053
058800              , B.STATUS_CDE                                      05880053
058900              , B.UNT_QTY                                         05890053
059000              , B.UNT_RTL_PR_AMT                                  05900053
059100              , B.GP_RTL_AMT                                      05910053
059200              , B.GP_QTY                                          05920053
059300              , B.PIC_ITM_IND                                     05930053
059400              , B.ITM_NBR                                         05940053
059500              , B.PREPK_RATO_QTY                                  05950053
059600                                                                  05960053
059700           FROM TPURCHS A                                         05970053
059800              , TPURITM B                                         05980053
059900              , TRECITM C                                         05990053
060000                                                                  06000053
060100          WHERE A.PO_NBR          =  :RC821-ORD-NBR               06010053
060200            AND A.PO_NBR          =   B.PO_NBR                    06020053
060300            AND A.PO_NBR          =   B.PO_NBR                    06030053
060400            AND A.VER_STATUS_CDE  =  :PC-A                        06040053
060500            AND A.VER_STATUS_CDE  =   B.VER_STATUS_CDE            06050053
060600            AND A.PO_NBR          =   C.ORD_NBR                   06060053
060700            AND B.APP_PO_LNE_NBR  =   C.ORD_LNE_NBR               06070053
060800            AND C.REC_SEQ_NBR     =  :RC821-REC-SEQ-NBR           06080053
060900            AND C.OPER_UNT_ID     =  :RC821-OPER-UNT-ID           06090053
061000            AND C.FCLTY_ID        =  :RC821-FCLTY-ID              06100053
061100            AND C.VER_STATUS_CDE  =  :PC-A                        06110053
061200       ORDER BY B.APP_PO_LNE_NBR                                  06120053
061300                                                                  06130053
061400        WITH UR                                                   06140053
061500                                                                  06150053
061600     END-EXEC.                                                    06160053
061700                                                                  06170053
061800* -------------------------------------------------------------- *06180053
061900*    RC CURSORS                                                  *06190003
062000*                                                                *06200003
062100*    BULK                                                        *06210003
062200* -------------------------------------------------------------- *06220003
062300                                                                  06230003
062400     EXEC SQL                                                     06240003
062500                                                                  06250003
062600       DECLARE RC-BULK-CSR CURSOR FOR                             06260003
062700                                                                  06270003
062800         SELECT CRE_TMST                                          06280003
062900              , STATUS_CDE                                        06290003
063000              , ORD_LNE_NBR                                       06300003
063100              , PKSL_ITM_QTY                                      06310003
063200              , DTL_CK_ITM_QTY                                    06320003
063300              , PREPK_RATO_QTY                                    06330003
063400              , CASE_PACK_QTY                                     06340003
063500              , CASE                                              06350003
063600                    INNR_PACK_QTY                                 06360003
063700                      WHEN 0                                      06370003
063800                      THEN 1                                      06380003
063900                ELSE                                              06390003
064000                    INNR_PACK_QTY                                 06400003
064100                END                                               06410003
064200                                                                  06420003
064300              , PREPK_ODD_UNT_QTY                                 06430003
064400              , PREPK_DRV_LNE_CDE                                 06440003
064500              , ITM_NBR                                           06450003
064600                                                                  06460003
064700            FROM TRECITM                                          06470003
064800                                                                  06480003
064900         WHERE ORD_NBR         =  :RC821-ORD-NBR                  06490013
065000           AND ORD_LNE_NBR     =  :RC821-REC-DRV-LNE-NBR          06500013
065100           AND REC_SEQ_NBR     =  :RC821-REC-SEQ-NBR              06510013
065200           AND OPER_UNT_ID     =  :RC821-OPER-UNT-ID              06520013
065300           AND FCLTY_ID        =  :RC821-FCLTY-ID                 06530013
065400           AND VER_STATUS_CDE  =  :PC-A                           06540003
065500                                                                  06550003
065600          WITH UR                                                 06560003
065700                                                                  06570003
065800     END-EXEC.                                                    06580003
065900                                                                  06590003
066000                                                                  06600003
066100* -------------------------------------------------------------- *06610003
066200*    PREPACK                                                     *06620003
066300* -------------------------------------------------------------- *06630003
066400                                                                  06640003
066500     EXEC SQL                                                     06650003
066600                                                                  06660003
066700       DECLARE RC-PACK-CSR CURSOR FOR                             06670003
066800                                                                  06680003
066900         SELECT CRE_TMST                                          06690003
067000              , STATUS_CDE                                        06700003
067100              , ORD_LNE_NBR                                       06710003
067200              , PKSL_ITM_QTY                                      06720003
067300              , DTL_CK_ITM_QTY                                    06730003
067400              , PREPK_RATO_QTY                                    06740003
067500              , CASE_PACK_QTY                                     06750003
067600                                                                  06760003
067700              , CASE                                              06770003
067800                    INNR_PACK_QTY                                 06780003
067900                      WHEN 0                                      06790003
068000                      THEN 1                                      06800003
068100                ELSE                                              06810003
068200                    INNR_PACK_QTY                                 06820003
068300                END                                               06830003
068400                                                                  06840003
068500              , PREPK_ODD_UNT_QTY                                 06850003
068600              , PREPK_DRV_LNE_CDE                                 06860003
068700              , ITM_NBR                                           06870003
068800                                                                  06880003
068900           FROM TRECITM                                           06890003
069000                                                                  06900003
069100         WHERE ORD_NBR         =  :RC821-ORD-NBR                  06910013
069200           AND PREPK_ID        =  :RC821-PREPK-ID                 06920013
069300           AND REC_SEQ_NBR     =  :RC821-REC-SEQ-NBR              06930013
069400           AND OPER_UNT_ID     =  :RC821-OPER-UNT-ID              06940013
069500           AND FCLTY_ID        =  :RC821-FCLTY-ID                 06950013
069600           AND VER_STATUS_CDE  =  :PC-A                           06960003
069700           AND PREPK_RATO_QTY  >  0                               06970003
069800                                                                  06980003
069900          WITH UR                                                 06990003
070000                                                                  07000003
070100     END-EXEC.                                                    07010003
070200                                                                  07020003
070300                                                                  07030003
070400*----------------------------*                                    07040003
070500 LINKAGE SECTION.                                                 07050003
070600*----------------------------*                                    07060003
070700                                                                  07070003
070800 01  DFHCOMMAREA.                                                 07080003
070900     05  FILLER                  OCCURS 1 TO 4072 TIMES           07090003
071000                                 DEPENDING ON EIBCALEN.           07100003
071100         10  FILLER              PIC X.                           07110003
071200                                                                  07120003
071300                                                                  07130003
071400*----------------------------*                                    07140003
071500 PROCEDURE DIVISION.                                              07150003
071600*----------------------------*                                    07160003
071700                                                                  07170003
071800 0000-MAIN-MODULE.                                                07180003
071900                                                                  07190003
072000     PERFORM 1000-INITIALIZE.                                     07200003
072100                                                                  07210003
072200     PERFORM 4080-GET-REC-CONTROL-INFO.                           07220003
072300                                                                  07230003
072400     IF PS-DONE-NO                                                07240003
072500         IF PS-PREPACK  AND  RC821-PREPK-ID > 0                   07250043
072600             IF    NOT TM500-PREPACK-EDIT-ONLY                    07260042
072700               AND NOT TM500-RESOLVE-AUTO                         07270025
072800                 PERFORM 1100-CHECK-RECDIS-ALLOC                  07280003
072900             END-IF                                               07290003
073000         END-IF                                                   07300003
073100     END-IF.                                                      07310003
073200                                                                  07320003
073300     IF PS-DONE-NO                                                07330003
073400         PERFORM 2000-GET-PO-DATA                                 07340003
073500     END-IF.                                                      07350003
073600                                                                  07360003
073700     IF PS-DONE-NO                                                07370003
073800         PERFORM 3000-GET-RC-DATA                                 07380003
073900     END-IF.                                                      07390003
074000                                                                  07400003
074100     IF PS-DONE-NO                                                07410003
074200         PERFORM 4000-GET-MISC-DATA                               07420003
074300     END-IF.                                                      07430003
074400                                                                  07440003
074500     IF PS-DONE-NO                                                07450003
074600         IF PS-PREPACK  AND  RC821-PREPK-ID > 0                   07460043
074700             PERFORM 4120-VERIFY-PACK                             07470003
074800         END-IF                                                   07480003
074900     END-IF.                                                      07490003
075000                                                                  07500003
075100                                                                  07510003
075200*    --------------------------------------------------------    *07520003
075300*         CALL RCKCS822 - OPEN TO RECEIVE (OTR) ROUTINE           07530003
075400*    --------------------------------------------------------    *07540003
075500                                                                  07550003
075600     IF PS-DONE-NO                                                07560003
075700         IF RC821-NO-TALLPLN-DISTRO-IND  EQUAL PC-N AND           07570013
075800            RC821-NO-TMESTDS-DISTRO-IND  EQUAL PC-N               07580013
075900             PERFORM 5000-CALL-OTR                                07590003
076000         END-IF                                                   07600003
076100     END-IF.                                                      07610003
076200                                                                  07620003
076300                                                                  07630003
076400*    --------------------------------------------------------    *07640003
076500*    BUILD TEMP QUEUE'S BEFORE CALLING TROUBLE AND PRORATION      07650003
076600*    --------------------------------------------------------    *07660003
076700                                                                  07670003
076800     IF PS-DONE-NO                                                07680003
076900         PERFORM 4300-BUILD-821-TEMP-QUEUES                       07690017
077000     END-IF.                                                      07700003
077100                                                                  07710003
077200                                                                  07720003
077300*    --------------------------------------------------------    *07730003
077400*               CALL RCKCS823 - TROUBLE ROUTINE                   07740017
077500*    --------------------------------------------------------    *07750003
077600                                                                  07760003
077700     IF PS-DONE-NO                                                07770003
077800         PERFORM 6000-CALL-TROUBLE-ROUTINE                        07780003
077900     END-IF.                                                      07790003
078000                                                                  07800003
078100*    --------------------------------------------------------    *07810003
078200*                CALL RCKCS824 - PRORATION ROUTINE                07820017
078300*    --------------------------------------------------------    *07830003
078400                                                                  07840003
078500     IF PS-DONE-NO                                                07850058
078600         PERFORM 7000-CALL-PRORATION-ROUTINE                      07860003
078700     END-IF.                                                      07870003
078800                                                                  07880003
078900     IF PS-DONE-NO                                                07890058
079000         IF PS-PREPACK  AND  RC821-PREPK-ID > 0                   07900043
079100             PERFORM 1200-RC811-DISTRO-ROUTINE                    07910003
079200         END-IF                                                   07920003
079300     END-IF.                                                      07930003
079400                                                                  07940003
079500     PERFORM 9000-DELETE-ALL-TEMP-QUEUES.                         07950003
079600                                                                  07960003
079700*    --------------------------                                   07970003
079800*    RETURN TO CALLING PROGRAM.                                   07980003
079900*    --------------------------                                   07990003
080000                                                                  08000003
080100     GOBACK.                                                      08010003
080200                                                                  08020003
080300                                                                  08030003
080400* -------------------------------------------------------------- *08040003
080500* -------------------------------------------------------------- *08050003
080600*               I N I T I A L I Z A T I O N                      *08060003
080700* -------------------------------------------------------------- *08070003
080800* -------------------------------------------------------------- *08080003
080900                                                                  08090003
081000 1000-INITIALIZE.                                                 08100003
081100                                                                  08110003
081200     MOVE '1000-INITIALIZE    ' TO RC001-PARAGRAPH.               08120033
081300                                                                  08130003
081400     MOVE RC821-MAX-STR-COUNT   TO  PV-HOLD-STR-COUNT.            08140013
081500     MOVE RC821-MAX-ITEM-COUNT  TO  PV-HOLD-ITM-COUNT.            08150013
081600                                                                  08160003
081700     INITIALIZE RC821-DATA-FIELDS                                 08170013
081800                RC822-COMMAREA                                    08180014
081900                RC823-COMMAREA                                    08190016
082000                RC824-COMMAREA                                    08200016
082100                TM500-FIELDS.                                     08210003
082200                                                                  08220003
082300     MOVE ZEROES             TO  PV-ITEM.                         08230003
082400     MOVE PV-HOLD-STR-COUNT  TO  RC821-MAX-STR-COUNT.             08240013
082500     MOVE PV-HOLD-ITM-COUNT  TO  RC821-MAX-ITEM-COUNT.            08250013
082600                                                                  08260003
082700     SET PS-DONE-NO TO TRUE.                                      08270003
082800                                                                  08280003
082900     SET TM500-CALL-SUCCESSFUL TO TRUE.                           08290003
083000                                                                  08300003
083100     EVALUATE TRUE                                                08310003
083200                                                                  08320003
083300       WHEN EIBCALEN = ZERO                                       08330003
083400           SET PS-DONE-YES TO TRUE                                08340003
083500           MOVE SPACES     TO TM501-TM500-RETURN-MSG              08350003
083600           MOVE '821'      TO TM501-PGM                           08360003
083700           MOVE '1000'     TO TM501-PARA                          08370003
083800           MOVE 01         TO TM501-PRORATION-ERROR-NBR           08380003
083900           PERFORM TM501-SET-TM500-RETURN-MSG                     08390003
084000           PERFORM RC001-RETURN-MSG                               08400003
084100                                                                  08410003
084200       WHEN OTHER                                                 08420003
084300           MOVE DFHCOMMAREA          TO  TM500-FIELDS             08430003
084400           MOVE '821'                TO  TM500-PREPACK-PGM-NBR    08440036
084500           MOVE EIBTRMID             TO  RC823-REC-TERM-ID        08450016
084600                                         RC823-ITM-TERM-ID        08460016
084700                                         RC823-STR-TERM-ID        08470016
084800           MOVE EIBTASKN             TO  RC823-REC-TASK-NUMBER    08480016
084900                                         RC823-STR-TASK-NUMBER    08490016
085000                                         RC823-ITM-TASK-NUMBER    08500016
085100           MOVE 1                    TO  RC823-REC-SEQ            08510016
085200           MOVE 2                    TO  RC823-STR-SEQ            08520016
085300           MOVE 3                    TO  RC823-ITM-SEQ            08530016
085400           MOVE EIBTRMID             TO  RC824-REC-TERM-ID        08540016
085500                                         RC824-ITM-TERM-ID        08550016
085600                                         RC824-STR-TERM-ID        08560016
085700           MOVE EIBTASKN             TO  RC824-REC-TASK-NUMBER    08570016
085800                                         RC824-STR-TASK-NUMBER    08580016
085900                                         RC824-ITM-TASK-NUMBER    08590016
086000           MOVE 1                    TO  RC824-REC-SEQ            08600016
086100           MOVE 2                    TO  RC824-STR-SEQ            08610016
086200           MOVE 3                    TO  RC824-ITM-SEQ            08620016
086300           MOVE TM500-PKGNG-CDE      TO  PS-PACKAGE-CODE          08630003
086400           MOVE TM500-PO-NBR         TO  RC821-ORD-NBR            08640013
086500           MOVE TM500-OPER-UNT-ID    TO  RC821-OPER-UNT-ID        08650013
086600           MOVE TM500-FCLTY-ID       TO  RC821-FCLTY-ID           08660013
086700           MOVE TM500-REC-SEQ-NBR    TO  RC821-REC-SEQ-NBR        08670013
086800           MOVE TM500-NEW-STR-PO-IND TO  RC821-NEW-STR-IND        08680013
086900           MOVE TM500-PKGNG-CDE      TO  RC821-PKGNG-CDE          08690013
087000           MOVE TM500-PO-LNE-NBR     TO  RC821-REC-DRV-LNE-NBR    08700013
087100           MOVE TM500-PREPK-ID       TO  RC821-PREPK-ID           08710013
087200           MOVE PC-N                 TO  RC821-BAD-PACK-DISTRO-IND08720013
087300           MOVE PC-Y                 TO  RC821-VALID-DISTRO-IND   08730013
087400           MOVE PC-U                 TO  RC821-OVER-SHORT-CDE     08740013
087500                                                                  08750003
087600     END-EVALUATE.                                                08760003
087700                                                                  08770003
087800     IF PS-DONE-NO                                                08780003
087900         PERFORM 1010-SELECT-FUNCTION-QTY                         08790003
088000         ACCEPT PV-CPU-DATE FROM DATE                             08800003
088100         STRING '20' PV-YEAR '-' PV-MONTH '-' PV-DAY              08810003
088200           DELIMITED BY SIZE INTO PV-CURRENT-DATE                 08820003
088300     END-IF.                                                      08830003
088400                                                                  08840003
088500     IF PS-DONE-NO                                                08850042
088600         IF (NOT PS-BULK)      AND                                08860045
088700            (NOT PS-PREPACK)                                      08870045
088800             PERFORM 1020-GET-PKGNG-CDE                           08880042
088900*11/04/03 - DEFAULT PKGNG-CDE TO 'B'(BULK) IF NOT FOUND.          08890060
089000             IF RECEIV-PKGNG-CDE NOT > SPACES                     08900060
089100                 MOVE 'B' TO RC821-PKGNG-CDE                      08910060
089200                             PS-PACKAGE-CODE                      08920060
089300                             TM500-PKGNG-CDE                      08930060
089400             END-IF                                               08940060
089500         END-IF                                                   08950060
089600     END-IF.                                                      08960042
089700                                                                  08970003
089800     IF PS-DONE-NO                                                08980044
089900         IF (PS-PREPACK AND TM500-PREPK-ID > 0)     AND           08990044
090000             TM500-PO-LNE-NBR = 0                   AND           09000044
090100             TM500-RESOLVE-AUTO                                   09010044
090200            PERFORM 1030-FETCH-DRIVER-LINE                        09020044
090300         END-IF                                                   09030044
090400     END-IF.                                                      09040044
090500                                                                  09050044
090600                                                                  09060044
090700                                                                  09070044
090800                                                                  09080044
090900* -------------------------------------------------------------- *09090003
091000* -------------------------------------------------------------- *09100003
091100                                                                  09110003
091200 1010-SELECT-FUNCTION-QTY.                                        09120003
091300                                                                  09130003
091400     MOVE '1010-SELECT-FUNCTION-QTY' TO RC001-PARAGRAPH.          09140033
091500                                                                  09150003
091600     EXEC SQL                                                     09160003
091700                                                                  09170003
091800         SELECT FUNC_QTY                                          09180003
091900                                                                  09190003
092000           INTO :KRPRPM-FUNC-QTY                                  09200003
092100                                                                  09210003
092200             FROM TKRPRPM                                         09220003
092300                                                                  09230003
092400           WHERE INTFC_SYS_CDE      =  'PRO'                      09240003
092500             AND SYS_PRC_FUNC_CDE   =  'RCDAYS'                   09250003
092600             AND FUNC_PRC_STAT_CDE  =  'AC'                       09260003
092700             AND (CURRENT DATE BETWEEN DATE(FUNC_BEG_TMST)        09270003
092800             AND                       DATE(FUNC_END_TMST))       09280003
092900                                                                  09290003
093000         WITH UR                                                  09300003
093100                                                                  09310003
093200     END-EXEC.                                                    09320003
093300                                                                  09330003
093400                                                                  09340003
093500     EVALUATE SQLCODE                                             09350003
093600                                                                  09360003
093700       WHEN +0                                                    09370003
093800           CONTINUE                                               09380003
093900                                                                  09390003
094000       WHEN OTHER                                                 09400003
094100           MOVE SQLCA       TO TM500-SQLCA                        09410003
094200           MOVE SQLCODE     TO TM500-SQLCODE                      09420003
094300           MOVE SQLCODE     TO RC001-SAVE-SQLCODE                 09430003
094400           MOVE SPACES      TO TM501-TM500-RETURN-MSG             09440003
094500           MOVE '821'       TO TM501-PGM                          09450004
094600           MOVE '1010'      TO TM501-PARA                         09460003
094700           MOVE 'TKRPRPM'   TO TM501-TBL                          09470003
094800           MOVE 02          TO TM501-PRORATION-ERROR-NBR          09480003
094900           PERFORM TM501-SET-TM500-RETURN-MSG                     09490003
095000           PERFORM RC001-RETURN-MSG                               09500003
095100                                                                  09510003
095200     END-EVALUATE.                                                09520003
095300                                                                  09530003
095400                                                                  09540003
095500* -------------------------------------------------------------- *09550003
095600* -------------------------------------------------------------- *09560003
095700                                                                  09570003
095800 1020-GET-PKGNG-CDE.                                              09580003
095900                                                                  09590003
096000     MOVE '1020-GET-PKGNG-CDE' TO RC001-PARAGRAPH.                09600033
096100                                                                  09610003
096200     EXEC SQL                                                     09620003
096300                                                                  09630003
096400         SELECT PKGNG_CDE                                         09640003
096500                                                                  09650003
096600           INTO :RECEIV-PKGNG-CDE                                 09660003
096700                                                                  09670003
096800             FROM TRECEIV                                         09680003
096900                                                                  09690003
097000           WHERE ORD_NBR         =  :RC821-ORD-NBR                09700013
097100             AND REC_SEQ_NBR     =  :RC821-REC-SEQ-NBR            09710013
097200             AND VER_STATUS_CDE  =  :PC-A                         09720003
097300                                                                  09730003
097400     END-EXEC.                                                    09740003
097500                                                                  09750003
097600                                                                  09760003
097700     EVALUATE SQLCODE                                             09770003
097800                                                                  09780003
097900       WHEN +0                                                    09790003
098000           MOVE RECEIV-PKGNG-CDE   TO RC821-PKGNG-CDE             09800013
098100                                      PS-PACKAGE-CODE             09810005
098200                                      TM500-PKGNG-CDE             09820005
098300       WHEN OTHER                                                 09830005
098400           MOVE SQLCA       TO TM500-SQLCA                        09840005
098500           MOVE SQLCODE     TO TM500-SQLCODE                      09850005
098600           MOVE SQLCODE     TO RC001-SAVE-SQLCODE                 09860005
098700           MOVE SPACES      TO TM501-TM500-RETURN-MSG             09870005
098800           MOVE '821'       TO TM501-PGM                          09880005
098900           MOVE '1020'      TO TM501-PARA                         09890005
099000           MOVE 'TRECEIV'   TO TM501-TBL                          09900005
099100           MOVE 92          TO TM501-PRORATION-ERROR-NBR          09910005
099200           PERFORM TM501-SET-TM500-RETURN-MSG                     09920005
099300           PERFORM RC001-RETURN-MSG                               09930005
099400                                                                  09940005
099500     END-EVALUATE.                                                09950005
099600                                                                  09960044
099700                                                                  09970044
099800* -------------------------------------------------------------- *09980044
099900* -------------------------------------------------------------- *09990044
100000                                                                  10000044
100100 1030-FETCH-DRIVER-LINE.                                          10010044
100200                                                                  10020044
100300     MOVE '1030-FETCH-DRIVER-LINE' TO RC001-PARAGRAPH.            10030044
100400                                                                  10040044
100500     EXEC SQL                                                     10050044
100600                                                                  10060044
100700         SELECT ORD_LNE_NBR                                       10070044
100800                                                                  10080044
100900           INTO :RECITM-ORD-LNE-NBR                               10090044
101000                                                                  10100044
101100         FROM TRECITM                                             10110044
101200                                                                  10120044
101300         WHERE ORD_NBR            =  :TM500-PO-NBR                10130044
101400           AND REC_SEQ_NBR        =  :TM500-REC-SEQ-NBR           10140044
101500           AND OPER_UNT_ID        =  :TM500-OPER-UNT-ID           10150044
101600           AND PREPK_ID           =  :TM500-PREPK-ID              10160044
101700           AND PREPK_DRV_LNE_CDE  =  :PC-A                        10170044
101800                                                                  10180044
101900     END-EXEC.                                                    10190044
102000                                                                  10200044
102100                                                                  10210044
102200     EVALUATE SQLCODE                                             10220044
102300                                                                  10230044
102400       WHEN +0                                                    10240044
102500           MOVE RECITM-ORD-LNE-NBR TO TM500-PO-LNE-NBR            10250044
102600                                      RC821-REC-DRV-LNE-NBR       10260044
102700                                                                  10270044
102800       WHEN +100                                                  10280044
102900           SET PS-DONE-YES TO TRUE                                10290044
103000           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   10300044
103100           MOVE SQLCODE   TO TM500-SQLCODE                        10310044
103200           MOVE SQLCA     TO TM500-SQLCA                          10320044
103300           MOVE SPACES    TO TM501-TM500-RETURN-MSG               10330044
103400           MOVE '821'     TO TM501-PGM                            10340044
103500           MOVE '1030'    TO TM501-PARA                           10350044
103600           MOVE 'TRECITM' TO TM501-TBL                            10360044
103700           MOVE 103       TO TM501-PRORATION-ERROR-NBR            10370044
103800           PERFORM TM501-SET-TM500-RETURN-MSG                     10380044
103900           PERFORM RC001-RETURN-MSG                               10390044
104000                                                                  10400044
104100       WHEN OTHER                                                 10410044
104200           SET PS-DONE-YES TO TRUE                                10420044
104300           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   10430044
104400           MOVE SQLCODE   TO TM500-SQLCODE                        10440044
104500           MOVE SQLCA     TO TM500-SQLCA                          10450044
104600           MOVE SPACES    TO TM501-TM500-RETURN-MSG               10460044
104700           MOVE '821'     TO TM501-PGM                            10470044
104800           MOVE '1030'    TO TM501-PARA                           10480044
104900           MOVE 'TRECITM' TO TM501-TBL                            10490044
105000           MOVE 104       TO TM501-PRORATION-ERROR-NBR            10500044
105100           PERFORM TM501-SET-TM500-RETURN-MSG                     10510044
105200           PERFORM RC001-RETURN-MSG                               10520044
105300                                                                  10530044
105400     END-EVALUATE.                                                10540044
105500                                                                  10550044
105600                                                                  10560005
105700* -------------------------------------------------------------- *10570005
105800* -------------------------------------------------------------- *10580005
105900                                                                  10590005
106000 1100-CHECK-RECDIS-ALLOC.                                         10600005
106100                                                                  10610005
106200     MOVE '1100-CHECK-RECDIS-ALLOC' TO RC001-PARAGRAPH.           10620033
106300                                                                  10630005
106400     INITIALIZE RC811-RETURN-DATA.                                10640037
106500                                                                  10650032
106600     SET RC811-DELETE-A-DISTRO-PACK TO TRUE.                      10660005
106700                                                                  10670005
106800     MOVE RC821-ORD-NBR      TO  RC811-PO-NBR.                    10680013
106900     MOVE RC821-REC-SEQ-NBR  TO  RC811-REC-SEQ-NBR.               10690013
107000     MOVE RC821-OPER-UNT-ID  TO  RC811-OPER-UNIT-ID.              10700013
107100     MOVE RC821-FCLTY-ID     TO  RC811-FACILITY-ID.               10710013
107200     MOVE RC821-PREPK-ID     TO  RC811-PREPK-ID.                  10720013
107300                                                                  10730000
107400     EXEC CICS                                                    10740000
107500         LINK PROGRAM  (PC-RCKCS811)                              10750000
107600              COMMAREA (RC811-STORE-RECDIS-PROCESSING)            10760000
107700     END-EXEC                                                     10770000
107800                                                                  10780000
107900     EVALUATE TRUE                                                10790000
108000                                                                  10800000
108100       WHEN RC811-SUCCESSFUL-PACK-DELETE                          10810000
108200       WHEN RC811-PACK-IN-RECDIS-NOT-FOUND                        10820000
108300           CONTINUE                                               10830000
108400                                                                  10840000
108500       WHEN OTHER                                                 10850000
108600           STRING '==> BAD RETURN CODE FROM RCKCS811 - '          10860018
108700                                     DELIMITED BY SIZE            10870018
108800                  RC811-RETURN-CODE  DELIMITED BY SIZE            10880018
108900                                     INTO RC001-SPECIAL-1         10890018
109000           STRING '  SEVERITY = '    DELIMITED BY SIZE            10900018
109100                  RC811-SEVERITY-IND DELIMITED BY SIZE            10910018
109200                  '   MSG NBR = '    DELIMITED BY SIZE            10920018
109300                  RC811-MSG-NUMBER   DELIMITED BY SIZE            10930018
109400                                     INTO RC001-SPECIAL-2         10940018
109500           SET PS-DONE-YES TO TRUE                                10950018
109600           MOVE SPACES     TO TM501-TM500-RETURN-MSG              10960018
109700           MOVE '821'      TO TM501-PGM                           10970018
109800           MOVE '1100'     TO TM501-PARA                          10980018
109900           MOVE 03         TO TM501-PRORATION-ERROR-NBR           10990018
110000           PERFORM TM501-SET-TM500-RETURN-MSG                     11000003
110100           PERFORM RC001-RETURN-MSG                               11010003
110200                                                                  11020003
110300     END-EVALUATE.                                                11030003
110400                                                                  11040003
110500                                                                  11050003
110600* -------------------------------------------------------------- *11060003
110700* -------------------------------------------------------------- *11070003
110800                                                                  11080003
110900 1200-RC811-DISTRO-ROUTINE.                                       11090003
111000                                                                  11100003
111100     MOVE '1200-RC811-DISTRO-ROUTINE' TO RC001-PARAGRAPH.         11110033
111200                                                                  11120003
111300     PERFORM                                                      11130003
111400       VARYING RC821-ITEM-IDX FROM 1 BY 1                         11140013
111500         UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              11150013
111600           OR  RC821-REC-LNE-NBR (RC821-ITEM-IDX) EQUAL +0        11160013
111700                                                                  11170003
111800         INITIALIZE RC811-RETURN-DATA                             11180032
111900                                                                  11190032
112000         SET RC811-ADD-A-DISTRO-LINE TO TRUE                      11200003
112100                                                                  11210003
112200         MOVE RC821-ORD-NBR      TO  RC811-PO-NBR                 11220013
112300         MOVE RC821-REC-SEQ-NBR  TO  RC811-REC-SEQ-NBR            11230013
112400         MOVE RC821-OPER-UNT-ID  TO  RC811-OPER-UNIT-ID           11240013
112500         MOVE RC821-FCLTY-ID     TO  RC811-FACILITY-ID            11250013
112600         MOVE RC821-PREPK-ID     TO  RC811-PREPK-ID               11260013
112700                                                                  11270003
112800         IF RC821-REC-LNE-NBR (RC821-ITEM-IDX) NOT EQUAL          11280013
112900            RC821-REC-DRV-LNE-NBR                                 11290013
113000             PERFORM 1300-ADD-A-DISTRO-LINE                       11300003
113100         END-IF                                                   11310003
113200     END-PERFORM.                                                 11320003
113300                                                                  11330003
113400                                                                  11340003
113500* -------------------------------------------------------------- *11350003
113600* -------------------------------------------------------------- *11360003
113700                                                                  11370003
113800 1300-ADD-A-DISTRO-LINE.                                          11380003
113900                                                                  11390003
114000     MOVE '1300-ADD-A-DISTRO-LINE' TO RC001-PARAGRAPH.            11400033
114100                                                                  11410003
114200     MOVE RC821-REC-DRV-LNE-NBR                                   11420013
114300       TO RC811-CLONE-LINE-NBR.                                   11430030
114400                                                                  11440029
114500     MOVE RC821-REC-LNE-NBR (RC821-ITEM-IDX)                      11450029
114600       TO RC811-MODIFY-LINE-NBR.                                  11460030
114700                                                                  11470003
114800     EXEC CICS                                                    11480003
114900         LINK PROGRAM  (PC-RCKCS811)                              11490003
115000              COMMAREA (RC811-STORE-RECDIS-PROCESSING)            11500003
115100     END-EXEC.                                                    11510003
115200                                                                  11520003
115300                                                                  11530003
115400     EVALUATE TRUE                                                11540003
115500                                                                  11550003
115600       WHEN RC811-RETURN-CODE = +0                                11560035
115700           CONTINUE                                               11570003
115800                                                                  11580003
115900       WHEN OTHER                                                 11590003
116000           STRING '==> BAD RETURN CODE FROM RCKCS811 - '          11600018
116100                                     DELIMITED BY SIZE            11610018
116200                  RC811-RETURN-CODE  DELIMITED BY SIZE            11620018
116300                                     INTO RC001-SPECIAL-1         11630018
116400           STRING '  SEVERITY = '    DELIMITED BY SIZE            11640018
116500                  RC811-SEVERITY-IND DELIMITED BY SIZE            11650018
116600                  '   MSG NBR = '    DELIMITED BY SIZE            11660018
116700                  RC811-MSG-NUMBER   DELIMITED BY SIZE            11670018
116800                                     INTO RC001-SPECIAL-2         11680018
116900           SET PS-DONE-YES TO TRUE                                11690018
117000           MOVE SPACES     TO TM501-TM500-RETURN-MSG              11700018
117100           MOVE '821'      TO TM501-PGM                           11710018
117200           MOVE '1300'     TO TM501-PARA                          11720018
117300           MOVE 04         TO TM501-PRORATION-ERROR-NBR           11730018
117400           PERFORM TM501-SET-TM500-RETURN-MSG                     11740003
117500           PERFORM RC001-RETURN-MSG                               11750003
117600                                                                  11760003
117700     END-EVALUATE.                                                11770003
117800                                                                  11780003
117900                                                                  11790003
118000                                                                  11800003
118100* -------------------------------------------------------------- *11810003
118200* -------------------------------------------------------------- *11820000
118300*             R E T R I E V E   P O   D A T A                    *11830000
118400* -------------------------------------------------------------- *11840003
118500*                                                                *11850003
118600*    LOAD DATA BASED ON PACKAGING OF THE PO:                     *11860003
118700*                                                                *11870003
118800*    B, C, S = BULK                                              *11880003
118900*    I, M    = PREPACK                                           *11890003
119000*                                                                *11900003
119100* -------------------------------------------------------------- *11910003
119200* -------------------------------------------------------------- *11920003
119300                                                                  11930003
119400 2000-GET-PO-DATA.                                                11940003
119500                                                                  11950003
119600     MOVE '2000-GET-PO-DATA      ' TO RC001-PARAGRAPH.            11960033
119700                                                                  11970003
119800     SET RC821-ITEM-IDX TO +1.                                    11980013
119900                                                                  11990003
120000     IF PS-BULK  OR  RC821-PREPK-ID = 0                           12000043
120100         PERFORM 2010-OPEN-PO-BULK-CSR                            12010003
120200                                                                  12020003
120300         PERFORM 2020-FETCH-PO-BULK-CSR                           12030003
120400           UNTIL PS-PO-BULK-CSR-EOF                               12040003
120500                                                                  12050003
120600         PERFORM 2060-CLOSE-PO-BULK-CSR                           12060003
120700                                                                  12070003
120800         PERFORM 2050-TABLE-PO-DATA                               12080003
120900     END-IF.                                                      12090003
121000                                                                  12100003
121100     IF PS-PREPACK AND RC821-PREPK-ID > 0                         12110053
121200         IF RC821-PREPK-ID = 99                                   12120053
121300             PERFORM 2115-OPEN-PO-PACK-99-CSR                     12130053
121400                                                                  12140053
121500             PERFORM 2117-LOOP-PO-PACK-99-CSR                     12150053
121600               UNTIL PS-PO-PACK-CSR-EOF                           12160053
121700                                                                  12170053
121800             PERFORM 2119-CLOSE-PO-PACK-99-CSR                    12180053
121900         ELSE                                                     12190053
122000             PERFORM 2100-OPEN-PO-PACK-CSR                        12200053
122100                                                                  12210003
122200             PERFORM 2110-LOOP-PO-PACK-CSR                        12220053
122300               UNTIL PS-PO-PACK-CSR-EOF                           12230053
122400                                                                  12240003
122500             PERFORM 2140-CLOSE-PO-PACK-CSR                       12250053
122600         END-IF                                                   12260053
122700                                                                  12270053
122800         PERFORM 2050-TABLE-PO-DATA                               12280003
122900     END-IF.                                                      12290003
123000                                                                  12300003
123100     IF TM500-REDISTRO-YES                                        12310003
123200         MOVE PC-R  TO  RC821-OTR-SCOPE-IND                       12320013
123300     ELSE                                                         12330003
123400         MOVE PC-P  TO  RC821-OTR-SCOPE-IND                       12340013
123500     END-IF.                                                      12350003
123600                                                                  12360003
123700                                                                  12370003
123800* -------------------------------------------------------------- *12380003
123900* -------------------------------------------------------------- *12390003
124000                                                                  12400003
124100 2010-OPEN-PO-BULK-CSR.                                           12410003
124200                                                                  12420003
124300     MOVE '2010-OPEN-PO-BULK-CSR' TO RC001-PARAGRAPH.             12430033
124400                                                                  12440003
124500     EXEC SQL                                                     12450003
124600         OPEN PO-BULK-CSR                                         12460003
124700     END-EXEC.                                                    12470003
124800                                                                  12480003
124900                                                                  12490003
125000     EVALUATE SQLCODE                                             12500003
125100                                                                  12510003
125200       WHEN +0                                                    12520003
125300           SET PS-PO-BULK-CSR-START TO TRUE                       12530003
125400                                                                  12540003
125500       WHEN OTHER                                                 12550003
125600           SET PS-DONE-YES                                        12560003
125700               PS-PO-BULK-CSR-EOF   TO TRUE                       12570003
125800           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   12580003
125900           MOVE SQLCODE   TO TM500-SQLCODE                        12590003
126000           MOVE SQLCA     TO TM500-SQLCA                          12600003
126100           MOVE SPACES    TO TM501-TM500-RETURN-MSG               12610003
126200           MOVE '821'     TO TM501-PGM                            12620003
126300           MOVE '2010'    TO TM501-PARA                           12630003
126400           MOVE 'TPURCHS' TO TM501-TBL                            12640003
126500           MOVE 05        TO TM501-PRORATION-ERROR-NBR            12650003
126600           PERFORM TM501-SET-TM500-RETURN-MSG                     12660003
126700           PERFORM RC001-RETURN-MSG                               12670003
126800                                                                  12680003
126900     END-EVALUATE.                                                12690003
127000                                                                  12700003
127100                                                                  12710003
127200* -------------------------------------------------------------- *12720003
127300*    ONE ROW IS ALWAYS FETCHED FROM THIS TABLE IF PACKAGING      *12730003
127400*    IS BULK.                                                    *12740003
127500* -------------------------------------------------------------- *12750003
127600                                                                  12760003
127700 2020-FETCH-PO-BULK-CSR.                                          12770003
127800                                                                  12780003
127900     MOVE '2020-FETCH-PO-BULK-CSR' TO RC001-PARAGRAPH.            12790033
128000                                                                  12800003
128100     EXEC SQL                                                     12810003
128200                                                                  12820003
128300         FETCH PO-BULK-CSR                                        12830003
128400                                                                  12840003
128500          INTO :PURCHS-DEPT-NBR                                   12850003
128600             , :PURCHS-NEW-STR-PO-IND                             12860003
128700             , :PURCHS-PO-TYP-CDE                                 12870003
128800             , :PURCHS-IMPRT-PO-IND                               12880003
128900             , :PURCHS-PKGNG-CDE                                  12890065
129000             , :PURCHS-PO-IN-RMS-IND                              12900003
129100             , :PURITM-PO-LNE-NBR                                 12910003
129200             , :PURITM-APP-PO-LNE-NBR                             12920003
129300             , :PURITM-SKU-SEQ-NBR                                12930003
129400             , :PURITM-STATUS-CDE                                 12940003
129500             , :PURITM-UNT-QTY                                    12950003
129600             , :PURITM-UNT-RTL-PR-AMT                             12960003
129700             , :PURITM-GP-RTL-AMT                                 12970003
129800             , :PURITM-GP-QTY                                     12980003
129900             , :PURITM-PIC-ITM-IND                                12990003
130000             , :PURITM-ITM-NBR                                    13000003
130100                                                                  13010003
130200     END-EXEC.                                                    13020003
130300                                                                  13030003
130400                                                                  13040003
130500     EVALUATE SQLCODE                                             13050003
130600                                                                  13060003
130700       WHEN +0                                                    13070003
130800           PERFORM 2030-MOVE-PURITM-BULK-DATA                     13080003
130900           SET RC821-ITEM-IDX UP BY +1                            13090013
131000                                                                  13100003
131100       WHEN +100                                                  13110003
131200           SET PS-PO-BULK-CSR-EOF TO TRUE                         13120003
131300                                                                  13130003
131400       WHEN OTHER                                                 13140003
131500           SET PS-DONE-YES                                        13150003
131600               PS-PO-BULK-CSR-EOF TO TRUE                         13160003
131700           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   13170004
131800           MOVE SQLCODE   TO TM500-SQLCODE                        13180004
131900           MOVE SQLCA     TO TM500-SQLCA                          13190004
132000           MOVE SPACES    TO TM501-TM500-RETURN-MSG               13200004
132100           MOVE '821'     TO TM501-PGM                            13210004
132200           MOVE '2020'    TO TM501-PARA                           13220004
132300           MOVE 'TPURCHS' TO TM501-TBL                            13230004
132400           MOVE 06        TO TM501-PRORATION-ERROR-NBR            13240004
132500           PERFORM TM501-SET-TM500-RETURN-MSG                     13250003
132600           PERFORM RC001-RETURN-MSG                               13260003
132700                                                                  13270003
132800     END-EVALUATE.                                                13280003
132900                                                                  13290003
133000                                                                  13300003
133100* -------------------------------------------------------------- *13310003
133200* -------------------------------------------------------------- *13320003
133300                                                                  13330003
133400 2030-MOVE-PURITM-BULK-DATA.                                      13340003
133500                                                                  13350003
133600     MOVE '2030-MOVE-PURITM-BULK-DATA' TO RC001-PARAGRAPH.        13360033
133700                                                                  13370003
133800     MOVE PURITM-PO-LNE-NBR                                       13380003
133900       TO RC821-PO-LNE-NBR        (RC821-ITEM-IDX).               13390013
134000                                                                  13400003
134100     MOVE PURITM-APP-PO-LNE-NBR                                   13410003
134200       TO RC821-APP-PO-LNE-NBR    (RC821-ITEM-IDX).               13420013
134300                                                                  13430003
134400     MOVE PURITM-STATUS-CDE                                       13440003
134500       TO RC821-PO-LNE-STATUS-CDE (RC821-ITEM-IDX).               13450013
134600                                                                  13460003
134700     MOVE PURITM-UNT-QTY                                          13470003
134800       TO RC821-PO-UNIT-QTY       (RC821-ITEM-IDX).               13480013
134900                                                                  13490003
135000     MOVE PURITM-UNT-RTL-PR-AMT                                   13500003
135100       TO RC821-PO-UNT-RTL-PR-AMT (RC821-ITEM-IDX).               13510013
135200                                                                  13520003
135300     MOVE PURITM-GP-RTL-AMT                                       13530003
135400       TO RC821-PO-GP-RTL-AMT     (RC821-ITEM-IDX).               13540013
135500                                                                  13550003
135600     MOVE PURITM-GP-QTY                                           13560003
135700       TO RC821-PO-GP-QTY         (RC821-ITEM-IDX).               13570013
135800                                                                  13580003
135900     ADD 1 TO RC821-ITEM-COUNT.                                   13590013
136000                                                                  13600003
136100*    -------------------------------------------------------      13610003
136200*    THIS IS A LEGACY PO INDICATOR AND IT DOES NOT APPLY          13620003
136300*    TO RMS SOURCED PO'S.                                         13630003
136400*    -------------------------------------------------------      13640003
136500                                                                  13650003
136600     IF PURITM-SKU-SEQ-NBR EQUAL '000' OR '999'                   13660003
136700         MOVE PC-Y TO RC821-DUMMY-SKU-IND (RC821-ITEM-IDX)        13670013
136800     ELSE                                                         13680003
136900         MOVE PC-N TO RC821-DUMMY-SKU-IND (RC821-ITEM-IDX)        13690013
137000     END-IF.                                                      13700003
137100                                                                  13710003
137200     MOVE PURCHS-PO-IN-RMS-IND  TO RC821-RMS-PO-IND.              13720013
137300     MOVE PURCHS-NEW-STR-PO-IND TO TM500-NEW-STR-PO-IND           13730003
137400                                   RC821-NEW-STR-IND.             13740013
137500                                                                  13750003
137600     IF PURCHS-PO-TYP-CDE EQUAL (PC-IE  OR                        13760003
137700                                 PC-IF  OR                        13770003
137800                                 PC-IM)                           13780003
137900         MOVE PC-Y TO TM500-IMPORT-PO-IND                         13790003
138000                      RC821-IMPRT-PO-IND                          13800013
138100     ELSE                                                         13810003
138200         MOVE PC-N TO TM500-IMPORT-PO-IND                         13820003
138300                      RC821-IMPRT-PO-IND                          13830013
138400     END-IF.                                                      13840003
138500                                                                  13850003
138600     MOVE PURITM-PIC-ITM-IND TO TM500-AD-ITM-IND.                 13860003
138700                                                                  13870003
138800*    PERFORM 4090-GET-DATE-RANGE.                                 13880062
138900                                                                  13890003
139000     MOVE PURITM-ITM-NBR TO DK-ITM-NBR.                           13900003
139100                                                                  13910003
139200     PERFORM 2130-SELECT-XL-ITEM.                                 13920010
139300                                                                  13930003
139400     SET RC822-PACK-IDX TO RC821-ITEM-IDX.                        13940014
139500                                                                  13950003
139600     MOVE RC821-PO-LNE-NBR       (RC821-ITEM-IDX)                 13960013
139700       TO RC822-PO-LINE-NBR      (RC822-PACK-IDX).                13970014
139800                                                                  13980003
139900     MOVE RC821-APP-PO-LNE-NBR   (RC821-ITEM-IDX)                 13990013
140000       TO RC822-APP-PO-LINE-NBR  (RC822-PACK-IDX).                14000014
140100                                                                  14010003
140200     MOVE RC821-PO-SKU-NBR       (RC821-ITEM-IDX)                 14020013
140300       TO RC822-PO-SKU-NBR       (RC822-PACK-IDX).                14030014
140400                                                                  14040003
140500     MOVE RC821-PO-PACK-RATO-QTY (RC821-ITEM-IDX)                 14050013
140600       TO RC822-PO-PACK-RATO-QTY (RC822-PACK-IDX).                14060014
140700                                                                  14070003
140800                                                                  14080003
140900* -------------------------------------------------------------- *14090003
141000* -------------------------------------------------------------- *14100003
141100                                                                  14110003
141200 2040-SELECT-XL-ITEM.                                             14120003
141300                                                                  14130003
141400     MOVE '2040-SELECT-XL-ITEM' TO RC001-PARAGRAPH.               14140033
141500                                                                  14150003
141600     INITIALIZE XL001-ITEM-COMMAREA.                              14160003
141700                                                                  14170003
141800     MOVE DK-ITM-NBR  TO  XL001-KEY-ITM-NBR.                      14180003
141900                                                                  14190003
142000     SET XL001-BY-ITEM                                            14200003
142100         XL001-SELECT-SKU                                         14210003
142200         XL001-SELECT-UPC                                         14220003
142300         XL001-SELECT-SKU-STR                                     14230003
142400         XL001-SELECT-WEB-SKU TO TRUE.                            14240003
142500                                                                  14250003
142600     CALL XL001-VSM-PGM USING DFHEIBLK                            14260009
142700                              XL001-COMMAREA                      14270010
142800                              XL001-ITEM-COMMAREA.                14280010
142900                                                                  14290003
143000     EVALUATE XL001-SKU-SQLCODE                                   14300003
143100                                                                  14310003
143200       WHEN +0                                                    14320003
143300           PERFORM 4100-SELECT-VND-STYL                           14330003
143400           PERFORM 3150-MOVE-XL001-DATA                           14340003
143500                                                                  14350003
143600       WHEN +100                                                  14360003
143700           SET PS-DONE-YES TO TRUE                                14370003
143800           MOVE XL001-SKU-SQLCODE TO RC001-SAVE-SQLCODE           14380003
143900           MOVE SPACES            TO TM501-TM500-RETURN-MSG       14390003
144000           MOVE '821'             TO TM501-PGM                    14400003
144100           MOVE '2040'            TO TM501-PARA                   14410004
144200           MOVE 07                TO TM501-PRORATION-ERROR-NBR    14420003
144300           PERFORM TM501-SET-TM500-RETURN-MSG                     14430003
144400           PERFORM RC001-RETURN-MSG                               14440000
144500                                                                  14450000
144600       WHEN -904                                                  14460000
144700       WHEN -911                                                  14470000
144800       WHEN -913                                                  14480000
144900           SET PS-DONE-YES  TO TRUE                               14490000
145000           MOVE XL001-SKU-SQLCODE TO RC001-SAVE-SQLCODE           14500000
145100           MOVE SPACES            TO TM501-TM500-RETURN-MSG       14510000
145200           MOVE '821'             TO TM501-PGM                    14520003
145300           MOVE '2040'            TO TM501-PARA                   14530004
145400           MOVE 08                TO TM501-PRORATION-ERROR-NBR    14540003
145500           PERFORM TM501-SET-TM500-RETURN-MSG                     14550003
145600           PERFORM RC001-RETURN-MSG                               14560003
145700                                                                  14570003
145800       WHEN OTHER                                                 14580003
145900           SET PS-DONE-YES  TO TRUE                               14590003
146000           MOVE XL001-SKU-SQLCODE TO RC001-SAVE-SQLCODE           14600003
146100           MOVE SPACES            TO TM501-TM500-RETURN-MSG       14610003
146200           MOVE '821'             TO TM501-PGM                    14620003
146300           MOVE '2040'            TO TM501-PARA                   14630004
146400           MOVE 09                TO TM501-PRORATION-ERROR-NBR    14640003
146500           PERFORM TM501-SET-TM500-RETURN-MSG                     14650003
146600           PERFORM RC001-RETURN-MSG                               14660003
146700                                                                  14670003
146800     END-EVALUATE.                                                14680003
146900                                                                  14690003
147000                                                                  14700003
147100* -------------------------------------------------------------- *14710003
147200* -------------------------------------------------------------- *14720003
147300                                                                  14730003
147400 2050-TABLE-PO-DATA.                                              14740003
147500                                                                  14750003
147600     MOVE '2050-TABLE-PO-DATA  ' TO RC001-PARAGRAPH.              14760033
147700                                                                  14770003
147800     MOVE PURCHS-DEPT-NBR    TO RC821-DEPT-NBR.                   14780013
147900     MOVE PURCHS-PO-TYP-CDE  TO RC821-PO-TYP-CDE.                 14790013
148000     MOVE PURCHS-PKGNG-CDE   TO RC821-PO-PKGNG-CDE.               14800069
148100                                                                  14810003
148200     PERFORM 4050-GET-PLAN-INFO.                                  14820003
148300                                                                  14830003
148400     PERFORM 4060-GET-DISTRO-QTY.                                 14840003
148500                                                                  14850003
148600     PERFORM 4070-GET-TYPE-CODE-INFO.                             14860003
148700                                                                  14870003
148800                                                                  14880003
148900* -------------------------------------------------------------- *14890003
149000* -------------------------------------------------------------- *14900003
149100                                                                  14910003
149200 2060-CLOSE-PO-BULK-CSR.                                          14920003
149300                                                                  14930003
149400     MOVE '2060-CLOSE-PO-BULK-CSR' TO RC001-PARAGRAPH.            14940033
149500                                                                  14950003
149600     EXEC SQL                                                     14960003
149700         CLOSE PO-BULK-CSR                                        14970003
149800     END-EXEC.                                                    14980003
149900                                                                  14990003
150000                                                                  15000003
150100     EVALUATE SQLCODE                                             15010003
150200                                                                  15020003
150300       WHEN +0                                                    15030003
150400           SET PS-PO-BULK-CSR-EOF TO TRUE                         15040003
150500                                                                  15050003
150600       WHEN OTHER                                                 15060003
150700           SET PS-DONE-YES                                        15070003
150800               PS-PO-BULK-CSR-EOF TO TRUE                         15080003
150900           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   15090003
151000           MOVE SQLCODE   TO TM500-SQLCODE                        15100003
151100           MOVE SQLCA     TO TM500-SQLCA                          15110003
151200           MOVE SPACES    TO TM501-TM500-RETURN-MSG               15120003
151300           MOVE '821'     TO TM501-PGM                            15130003
151400           MOVE '2060'    TO TM501-PARA                           15140003
151500           MOVE 'TPURCHS' TO TM501-TBL                            15150003
151600           MOVE 10        TO TM501-PRORATION-ERROR-NBR            15160003
151700           PERFORM TM501-SET-TM500-RETURN-MSG                     15170003
151800           PERFORM RC001-RETURN-MSG                               15180000
151900                                                                  15190003
152000     END-EVALUATE.                                                15200003
152100                                                                  15210003
152200                                                                  15220003
152300* -------------------------------------------------------------- *15230003
152400* -------------------------------------------------------------- *15240003
152500                                                                  15250003
152600 2100-OPEN-PO-PACK-CSR.                                           15260003
152700                                                                  15270003
152800     MOVE '2100-OPEN-PO-PACK-CSR' TO RC001-PARAGRAPH.             15280033
152900                                                                  15290003
153000     EXEC SQL                                                     15300003
153100         OPEN PO-PACK-CSR                                         15310003
153200     END-EXEC.                                                    15320003
153300                                                                  15330003
153400                                                                  15340003
153500     EVALUATE SQLCODE                                             15350003
153600                                                                  15360003
153700       WHEN +0                                                    15370003
153800           SET PS-PO-PACK-CSR-START TO TRUE                       15380003
153900                                                                  15390003
154000       WHEN OTHER                                                 15400003
154100           SET PS-DONE-YES                                        15410003
154200               PS-PO-PACK-CSR-EOF TO TRUE                         15420003
154300           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   15430003
154400           MOVE SQLCODE   TO TM500-SQLCODE                        15440003
154500           MOVE SQLCA     TO TM500-SQLCA                          15450003
154600           MOVE SPACES    TO TM501-TM500-RETURN-MSG               15460003
154700           MOVE '821'     TO TM501-PGM                            15470003
154800           MOVE '2100'    TO TM501-PARA                           15480003
154900           MOVE 'TPURCHS' TO TM501-TBL                            15490003
155000           MOVE 11        TO TM501-PRORATION-ERROR-NBR            15500003
155100           PERFORM TM501-SET-TM500-RETURN-MSG                     15510003
155200           PERFORM RC001-RETURN-MSG                               15520003
155300                                                                  15530003
155400     END-EVALUATE.                                                15540003
155500                                                                  15550003
155600                                                                  15560003
155700* -------------------------------------------------------------- *15570003
155800*    MULTIPLE ROWS ARE ALWAYS FETCHED FROM THIS TABLE IF         *15580003
155900*    PACKAGING IS PREPACK.                                       *15590003
156000* -------------------------------------------------------------- *15600003
156100                                                                  15610003
156200 2110-LOOP-PO-PACK-CSR.                                           15620003
156300                                                                  15630003
156400     MOVE '2110-LOOP-PO-PACK-CSR' TO RC001-PARAGRAPH.             15640033
156500                                                                  15650003
156600     EXEC SQL                                                     15660003
156700                                                                  15670003
156800         FETCH PO-PACK-CSR                                        15680003
156900                                                                  15690003
157000          INTO :PURCHS-DEPT-NBR                                   15700003
157100             , :PURCHS-NEW-STR-PO-IND                             15710003
157200             , :PURCHS-PO-TYP-CDE                                 15720003
157300             , :PURCHS-IMPRT-PO-IND                               15730003
157400             , :PURCHS-PKGNG-CDE                                  15740066
157500             , :PURCHS-PO-IN-RMS-IND                              15750003
157600             , :PURITM-PO-LNE-NBR                                 15760003
157700             , :PURITM-APP-PO-LNE-NBR                             15770003
157800             , :PURITM-SKU-SEQ-NBR                                15780003
157900             , :PURITM-STATUS-CDE                                 15790003
158000             , :PURITM-UNT-QTY                                    15800003
158100             , :PURITM-UNT-RTL-PR-AMT                             15810003
158200             , :PURITM-GP-RTL-AMT                                 15820003
158300             , :PURITM-GP-QTY                                     15830003
158400             , :PURITM-PIC-ITM-IND                                15840003
158500             , :PURITM-ITM-NBR                                    15850003
158600             , :PURITM-PREPK-RATO-QTY                             15860003
158700             , :POPRPK-PREPK-TYP-CDE                              15870003
158800             , :POPRPK-PREPK-STAT-CDE                             15880003
158900             , :POPRPK-PREPK-UPC-NBR                              15890003
159000             , :POPRPK-INPK-UNT-QTY                               15900003
159100             , :POPRPK-OTPK-UNT-QTY                               15910003
159200             , :POPRPK-PK-SKU-NBR                                 15920003
159300                                                                  15930003
159400     END-EXEC.                                                    15940003
159500                                                                  15950003
159600                                                                  15960003
159700     EVALUATE SQLCODE                                             15970003
159800                                                                  15980003
159900       WHEN +0                                                    15990003
160000           PERFORM 2120-MOVE-PO-PACK-DATA                         16000010
160100           SET RC821-ITEM-IDX UP BY +1                            16010013
160200                                                                  16020003
160300       WHEN +100                                                  16030003
160400           SET PS-PO-PACK-CSR-EOF TO TRUE                         16040003
160500                                                                  16050003
160600       WHEN OTHER                                                 16060003
160700           SET PS-DONE-YES                                        16070003
160800               PS-PO-PACK-CSR-EOF TO TRUE                         16080003
160900           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   16090004
161000           MOVE SQLCODE   TO TM500-SQLCODE                        16100004
161100           MOVE SQLCA     TO TM500-SQLCA                          16110004
161200           MOVE SPACES    TO TM501-TM500-RETURN-MSG               16120004
161300           MOVE '821'     TO TM501-PGM                            16130004
161400           MOVE '2110'    TO TM501-PARA                           16140004
161500           MOVE 'TPURCHS' TO TM501-TBL                            16150004
161600           MOVE 12        TO TM501-PRORATION-ERROR-NBR            16160004
161700           PERFORM TM501-SET-TM500-RETURN-MSG                     16170003
161800           PERFORM RC001-RETURN-MSG                               16180003
161900                                                                  16190003
162000     END-EVALUATE.                                                16200003
162100                                                                  16210003
162200                                                                  16220003
162300* -------------------------------------------------------------- *16230053
162400* -------------------------------------------------------------- *16240053
162500 2115-OPEN-PO-PACK-99-CSR.                                        16250053
162600     MOVE '2115-OPEN-PO-PACK-99-CSR' TO RC001-PARAGRAPH.          16260053
162700                                                                  16270053
162800     EXEC SQL                                                     16280053
162900         OPEN PO-PACK-99-CSR                                      16290053
163000     END-EXEC.                                                    16300053
163100                                                                  16310053
163200     EVALUATE SQLCODE                                             16320053
163300       WHEN +0                                                    16330053
163400           SET PS-PO-PACK-CSR-START TO TRUE                       16340053
163500                                                                  16350053
163600       WHEN OTHER                                                 16360053
163700           SET PS-DONE-YES                                        16370053
163800               PS-PO-PACK-CSR-EOF TO TRUE                         16380053
163900           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   16390053
164000           MOVE SQLCODE   TO TM500-SQLCODE                        16400053
164100           MOVE SQLCA     TO TM500-SQLCA                          16410053
164200           MOVE SPACES    TO TM501-TM500-RETURN-MSG               16420053
164300           MOVE '821'     TO TM501-PGM                            16430053
164400           MOVE '2115'    TO TM501-PARA                           16440053
164500           MOVE 'TPURCHS' TO TM501-TBL                            16450053
164600           MOVE 11        TO TM501-PRORATION-ERROR-NBR            16460053
164700           PERFORM TM501-SET-TM500-RETURN-MSG                     16470053
164800           PERFORM RC001-RETURN-MSG                               16480053
164900     END-EVALUATE.                                                16490053
165000                                                                  16500053
165100* -------------------------------------------------------------- *16510053
165200*    MULTIPLE ROWS ARE ALWAYS FETCHED FROM THIS TABLE IF         *16520053
165300*    PACKAGING IS PREPACK.                                       *16530053
165400* -------------------------------------------------------------- *16540053
165500 2117-LOOP-PO-PACK-99-CSR.                                        16550053
165600     MOVE '2117-LOOP-PO-PACK-99-CSR' TO RC001-PARAGRAPH.          16560053
165700                                                                  16570053
165800     EXEC SQL                                                     16580053
165900         FETCH PO-PACK-99-CSR                                     16590053
166000          INTO :PURCHS-DEPT-NBR                                   16600053
166100             , :PURCHS-NEW-STR-PO-IND                             16610053
166200             , :PURCHS-PO-TYP-CDE                                 16620053
166300             , :PURCHS-IMPRT-PO-IND                               16630053
166400             , :PURCHS-PKGNG-CDE                                  16640067
166500             , :PURCHS-PO-IN-RMS-IND                              16650053
166600             , :PURITM-PO-LNE-NBR                                 16660053
166700             , :PURITM-APP-PO-LNE-NBR                             16670053
166800             , :PURITM-SKU-SEQ-NBR                                16680053
166900             , :PURITM-STATUS-CDE                                 16690053
167000             , :PURITM-UNT-QTY                                    16700053
167100             , :PURITM-UNT-RTL-PR-AMT                             16710053
167200             , :PURITM-GP-RTL-AMT                                 16720053
167300             , :PURITM-GP-QTY                                     16730053
167400             , :PURITM-PIC-ITM-IND                                16740053
167500             , :PURITM-ITM-NBR                                    16750053
167600             , :PURITM-PREPK-RATO-QTY                             16760053
167700     END-EXEC.                                                    16770053
167800                                                                  16780053
167900     EVALUATE SQLCODE                                             16790053
168000       WHEN +0                                                    16800053
168100           MOVE SPACES TO POPRPK-PREPK-TYP-CDE                    16810053
168200                          POPRPK-PREPK-STAT-CDE                   16820053
168300           MOVE ZEROES TO POPRPK-PREPK-UPC-NBR                    16830053
168400                          POPRPK-INPK-UNT-QTY                     16840053
168500                          POPRPK-OTPK-UNT-QTY                     16850053
168600                          POPRPK-PK-SKU-NBR                       16860053
168700           PERFORM 2120-MOVE-PO-PACK-DATA                         16870053
168800           SET RC821-ITEM-IDX UP BY +1                            16880053
168900                                                                  16890053
169000       WHEN +100                                                  16900053
169100           SET PS-PO-PACK-CSR-EOF TO TRUE                         16910053
169200                                                                  16920053
169300       WHEN OTHER                                                 16930053
169400           SET PS-DONE-YES                                        16940053
169500               PS-PO-PACK-CSR-EOF TO TRUE                         16950053
169600           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   16960053
169700           MOVE SQLCODE   TO TM500-SQLCODE                        16970053
169800           MOVE SQLCA     TO TM500-SQLCA                          16980053
169900           MOVE SPACES    TO TM501-TM500-RETURN-MSG               16990053
170000           MOVE '821'     TO TM501-PGM                            17000053
170100           MOVE '2117'    TO TM501-PARA                           17010053
170200           MOVE 'TPURCHS' TO TM501-TBL                            17020053
170300           MOVE 12        TO TM501-PRORATION-ERROR-NBR            17030053
170400           PERFORM TM501-SET-TM500-RETURN-MSG                     17040053
170500           PERFORM RC001-RETURN-MSG                               17050053
170600     END-EVALUATE.                                                17060053
170700                                                                  17070053
170800* -------------------------------------------------------------- *17080053
170900* -------------------------------------------------------------- *17090053
171000 2119-CLOSE-PO-PACK-99-CSR.                                       17100053
171100     MOVE '2119-CLOSE-PO-PACK-99-CSR' TO RC001-PARAGRAPH.         17110053
171200                                                                  17120053
171300     EXEC SQL                                                     17130053
171400         CLOSE PO-PACK-99-CSR                                     17140053
171500     END-EXEC.                                                    17150053
171600                                                                  17160053
171700     EVALUATE SQLCODE                                             17170053
171800       WHEN +0                                                    17180053
171900           SET PS-PO-PACK-CSR-EOF TO TRUE                         17190053
172000                                                                  17200053
172100       WHEN OTHER                                                 17210053
172200           SET PS-DONE-YES                                        17220053
172300               PS-PO-PACK-CSR-EOF TO TRUE                         17230053
172400           MOVE SQLCA     TO TM500-SQLCA                          17240053
172500           MOVE SQLCODE   TO TM500-SQLCODE                        17250053
172600           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   17260053
172700           MOVE SPACES    TO TM501-TM500-RETURN-MSG               17270053
172800           MOVE '821'     TO TM501-PGM                            17280053
172900           MOVE '2119'    TO TM501-PARA                           17290053
173000           MOVE 'TPURCHS' TO TM501-TBL                            17300053
173100           MOVE 16        TO TM501-PRORATION-ERROR-NBR            17310053
173200           PERFORM TM501-SET-TM500-RETURN-MSG                     17320053
173300           PERFORM RC001-RETURN-MSG                               17330053
173400     END-EVALUATE.                                                17340053
173500                                                                  17350053
173600* -------------------------------------------------------------- *17360053
173700* -------------------------------------------------------------- *17370003
173800                                                                  17380003
173900 2120-MOVE-PO-PACK-DATA.                                          17390010
174000                                                                  17400003
174100     MOVE '2120-MOVE-PO-PACK-DATA    ' TO RC001-PARAGRAPH.        17410033
174200                                                                  17420003
174300     MOVE PURITM-PO-LNE-NBR                                       17430003
174400       TO RC821-PO-LNE-NBR        (RC821-ITEM-IDX).               17440013
174500                                                                  17450003
174600     MOVE PURITM-APP-PO-LNE-NBR                                   17460003
174700       TO RC821-APP-PO-LNE-NBR    (RC821-ITEM-IDX).               17470013
174800                                                                  17480003
174900     MOVE PURITM-STATUS-CDE                                       17490003
175000       TO RC821-PO-LNE-STATUS-CDE (RC821-ITEM-IDX).               17500013
175100                                                                  17510003
175200     MOVE PURITM-UNT-QTY                                          17520003
175300       TO RC821-PO-UNIT-QTY       (RC821-ITEM-IDX).               17530013
175400                                                                  17540003
175500     MOVE PURITM-UNT-RTL-PR-AMT                                   17550003
175600       TO RC821-PO-UNT-RTL-PR-AMT (RC821-ITEM-IDX).               17560013
175700                                                                  17570003
175800     MOVE PURITM-GP-RTL-AMT                                       17580003
175900       TO RC821-PO-GP-RTL-AMT     (RC821-ITEM-IDX).               17590013
176000                                                                  17600003
176100     MOVE PURITM-GP-QTY                                           17610003
176200       TO RC821-PO-GP-QTY         (RC821-ITEM-IDX).               17620013
176300                                                                  17630003
176400     MOVE PURITM-PREPK-RATO-QTY                                   17640003
176500       TO RC821-PO-PACK-RATO-QTY  (RC821-ITEM-IDX).               17650013
176600                                                                  17660003
176700     MOVE POPRPK-PREPK-TYP-CDE  TO  RC821-PREPK-TYPE-CDE.         17670013
176800     MOVE POPRPK-PREPK-UPC-NBR  TO  RC821-PACK-UPC-NBR.           17680013
176900     MOVE POPRPK-INPK-UNT-QTY   TO  RC821-INPK-UNT-QTY.           17690013
177000     MOVE POPRPK-OTPK-UNT-QTY   TO  RC821-OTPK-UNT-QTY.           17700013
177100     MOVE POPRPK-PK-SKU-NBR     TO  RC821-PACK-SKU-NBR.           17710013
177200                                                                  17720003
177300     ADD 1 TO RC821-ITEM-COUNT.                                   17730013
177400                                                                  17740003
177500*    -------------------------------------------------------      17750003
177600*    THIS IS A LEGACY PO INDICATOR AND IT DOES NOT APPLY          17760003
177700*    TO RMS SOURCED PO'S.                                         17770003
177800*    -------------------------------------------------------      17780003
177900                                                                  17790003
178000     IF PURITM-SKU-SEQ-NBR EQUAL '000' OR '999'                   17800003
178100         MOVE PC-Y TO RC821-DUMMY-SKU-IND (RC821-ITEM-IDX)        17810013
178200     ELSE                                                         17820003
178300         MOVE PC-N TO RC821-DUMMY-SKU-IND (RC821-ITEM-IDX)        17830013
178400     END-IF.                                                      17840003
178500                                                                  17850003
178600     IF PURCHS-PO-TYP-CDE EQUAL PC-IE  OR                         17860003
178700                                PC-IF  OR                         17870003
178800                                PC-IM                             17880003
178900         MOVE PC-Y TO TM500-IMPORT-PO-IND                         17890003
179000                      RC821-IMPRT-PO-IND                          17900013
179100     ELSE                                                         17910003
179200         MOVE PC-N TO TM500-IMPORT-PO-IND                         17920003
179300                      RC821-IMPRT-PO-IND                          17930013
179400     END-IF.                                                      17940003
179500                                                                  17950003
179600     IF PURITM-PREPK-RATO-QTY > +0                                17960003
179700         MOVE PC-N TO RC821-BAD-PACK-DISTRO-IND                   17970013
179800     ELSE                                                         17980003
179900         MOVE PC-Y TO RC821-BAD-PACK-DISTRO-IND                   17990013
180000     END-IF.                                                      18000003
180100                                                                  18010003
180200     MOVE PURITM-PIC-ITM-IND    TO TM500-AD-ITM-IND.              18020003
180300     MOVE PURCHS-PO-IN-RMS-IND  TO RC821-RMS-PO-IND.              18030013
180400     MOVE PURCHS-IMPRT-PO-IND   TO RC821-IMPRT-PO-IND.            18040013
180500     MOVE PURCHS-NEW-STR-PO-IND TO TM500-NEW-STR-PO-IND           18050003
180600                                   RC821-NEW-STR-IND.             18060013
180700                                                                  18070003
180800*    PERFORM 4090-GET-DATE-RANGE.                                 18080062
180900                                                                  18090003
181000     MOVE PURITM-ITM-NBR  TO DK-ITM-NBR.                          18100003
181100                                                                  18110003
181200     PERFORM 2130-SELECT-XL-ITEM.                                 18120010
181300                                                                  18130003
181400     SET RC822-PACK-IDX TO RC821-ITEM-IDX.                        18140014
181500                                                                  18150003
181600     MOVE RC821-PO-LNE-NBR       (RC821-ITEM-IDX)                 18160013
181700       TO RC822-PO-LINE-NBR      (RC822-PACK-IDX).                18170014
181800                                                                  18180003
181900     MOVE RC821-PO-SKU-NBR       (RC821-ITEM-IDX)                 18190013
182000       TO RC822-PO-SKU-NBR       (RC822-PACK-IDX).                18200014
182100                                                                  18210003
182200     MOVE RC821-PO-PACK-RATO-QTY (RC821-ITEM-IDX)                 18220013
182300       TO RC822-PO-PACK-RATO-QTY (RC822-PACK-IDX).                18230014
182400                                                                  18240003
182500                                                                  18250003
182600* -------------------------------------------------------------- *18260003
182700* -------------------------------------------------------------- *18270003
182800                                                                  18280003
182900 2130-SELECT-XL-ITEM.                                             18290010
183000                                                                  18300003
183100     MOVE '2130-SELECT-XL-ITEM  ' TO RC001-PARAGRAPH.             18310033
183200                                                                  18320003
183300     INITIALIZE XL001-ITEM-COMMAREA.                              18330003
183400                                                                  18340003
183500     MOVE DK-ITM-NBR TO XL001-KEY-ITM-NBR.                        18350003
183600                                                                  18360003
183700     SET XL001-BY-ITEM                                            18370003
183800         XL001-SELECT-SKU                                         18380003
183900         XL001-SELECT-UPC                                         18390003
184000         XL001-SELECT-SKU-STR                                     18400003
184100         XL001-SELECT-WEB-SKU TO TRUE.                            18410003
184200                                                                  18420003
184300     CALL XL001-VSM-PGM USING DFHEIBLK                            18430007
184400                              XL001-COMMAREA                      18440010
184500                              XL001-ITEM-COMMAREA                 18450007
184600                                                                  18460003
184700     EVALUATE XL001-SKU-SQLCODE                                   18470003
184800                                                                  18480003
184900       WHEN +0                                                    18490003
185000           PERFORM 4100-SELECT-VND-STYL                           18500003
185100           PERFORM 3150-MOVE-XL001-DATA                           18510003
185200                                                                  18520003
185300       WHEN +100                                                  18530003
185400           SET PS-DONE-YES                                        18540003
185500               TM500-SKU-NOT-FOUND-FOR-LINE TO TRUE               18550003
185600           MOVE XL001-SKU-SQLCODE  TO RC001-SAVE-SQLCODE          18560003
185700           MOVE SPACES             TO TM501-TM500-RETURN-MSG      18570003
185800           MOVE '821'              TO TM501-PGM                   18580003
185900           MOVE '2130'             TO TM501-PARA                  18590010
186000           MOVE 13                 TO TM501-PRORATION-ERROR-NBR   18600003
186100           PERFORM TM501-SET-TM500-RETURN-MSG                     18610003
186200           PERFORM RC001-RETURN-MSG                               18620003
186300                                                                  18630003
186400       WHEN -904                                                  18640003
186500       WHEN -911                                                  18650003
186600       WHEN -913                                                  18660003
186700           SET PS-DONE-YES TO TRUE                                18670003
186800           MOVE XL001-SKU-SQLCODE  TO RC001-SAVE-SQLCODE          18680003
186900           MOVE SPACES             TO TM501-TM500-RETURN-MSG      18690003
187000           MOVE '821'              TO TM501-PGM                   18700003
187100           MOVE '2130'             TO TM501-PARA                  18710010
187200           MOVE 14                 TO TM501-PRORATION-ERROR-NBR   18720003
187300           PERFORM TM501-SET-TM500-RETURN-MSG                     18730003
187400           PERFORM RC001-RETURN-MSG                               18740003
187500                                                                  18750003
187600       WHEN OTHER                                                 18760000
187700           SET PS-DONE-YES TO TRUE                                18770000
187800           MOVE XL001-SKU-SQLCODE  TO RC001-SAVE-SQLCODE          18780000
187900           MOVE SPACES             TO TM501-TM500-RETURN-MSG      18790003
188000           MOVE '821'              TO TM501-PGM                   18800003
188100           MOVE '2130'             TO TM501-PARA                  18810010
188200           MOVE 15                 TO TM501-PRORATION-ERROR-NBR   18820003
188300           PERFORM TM501-SET-TM500-RETURN-MSG                     18830003
188400           PERFORM RC001-RETURN-MSG                               18840003
188500                                                                  18850003
188600     END-EVALUATE.                                                18860003
188700                                                                  18870003
188800* -------------------------------------------------------------- *18880003
188900* -------------------------------------------------------------- *18890003
189000                                                                  18900003
189100 2140-CLOSE-PO-PACK-CSR.                                          18910010
189200                                                                  18920003
189300     MOVE '2140-CLOSE-PO-PACK-CSR ' TO RC001-PARAGRAPH.           18930033
189400                                                                  18940003
189500     EXEC SQL                                                     18950003
189600         CLOSE PO-PACK-CSR                                        18960003
189700     END-EXEC.                                                    18970003
189800                                                                  18980003
189900     EVALUATE SQLCODE                                             18990003
190000                                                                  19000003
190100       WHEN +0                                                    19010003
190200           SET PS-PO-PACK-CSR-EOF TO TRUE                         19020003
190300                                                                  19030003
190400       WHEN OTHER                                                 19040003
190500           SET PS-DONE-YES                                        19050003
190600               PS-PO-PACK-CSR-EOF TO TRUE                         19060003
190700           MOVE SQLCA     TO TM500-SQLCA                          19070003
190800           MOVE SQLCODE   TO TM500-SQLCODE                        19080003
190900           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   19090003
191000           MOVE SPACES    TO TM501-TM500-RETURN-MSG               19100003
191100           MOVE '821'     TO TM501-PGM                            19110003
191200           MOVE '2140'    TO TM501-PARA                           19120010
191300           MOVE 'TPURCHS' TO TM501-TBL                            19130003
191400           MOVE 16        TO TM501-PRORATION-ERROR-NBR            19140000
191500           PERFORM TM501-SET-TM500-RETURN-MSG                     19150000
191600           PERFORM RC001-RETURN-MSG                               19160003
191700                                                                  19170003
191800     END-EVALUATE.                                                19180003
191900                                                                  19190003
192000                                                                  19200003
192100* -------------------------------------------------------------- *19210003
192200* -------------------------------------------------------------- *19220003
192300*             R E T R I E V E   R C   D A T A                    *19230003
192400*                                                                *19240003
192500* -------------------------------------------------------------- *19250003
192600*    LOAD DATA BASED ON PACKAGING OF THE PO:                     *19260003
192700*    B, C, S = BULK                                              *19270003
192800*    I, M    = PREPACK                                           *19280003
192900* -------------------------------------------------------------- *19290003
193000* -------------------------------------------------------------- *19300003
193100                                                                  19310003
193200 3000-GET-RC-DATA.                                                19320003
193300                                                                  19330003
193400     MOVE '3000-GET-RC-DATA          ' TO RC001-PARAGRAPH.        19340033
193500                                                                  19350003
193600     SET RC821-ITEM-IDX TO +1.                                    19360013
193700                                                                  19370003
193800     IF PS-BULK  OR  RC821-PREPK-ID = 0                           19380043
193900         PERFORM 3010-OPEN-RC-BULK-CSR                            19390003
194000                                                                  19400003
194100         PERFORM 3020-FETCH-RC-BULK-CSR                           19410003
194200           UNTIL PS-RC-BULK-CSR-EOF                               19420003
194300                                                                  19430003
194400         PERFORM 3040-CLOSE-RC-BULK-CSR                           19440003
194500     END-IF.                                                      19450003
194600                                                                  19460003
194700     IF PS-PREPACK  AND  RC821-PREPK-ID > 0                       19470043
194800         PERFORM 3100-OPEN-RC-PACK-CSR                            19480003
194900                                                                  19490003
195000         PERFORM 3110-LOOP-RC-PACK-CSR                            19500003
195100           UNTIL PS-RC-PACK-CSR-EOF                               19510003
195200                                                                  19520003
195300         PERFORM 3140-CLOSE-RC-PACK-CSR                           19530003
195400     END-IF.                                                      19540003
195500                                                                  19550003
195600                                                                  19560003
195700* -------------------------------------------------------------- *19570003
195800* -------------------------------------------------------------- *19580003
195900                                                                  19590003
196000 3010-OPEN-RC-BULK-CSR.                                           19600003
196100                                                                  19610003
196200     MOVE '3010-OPEN-RC-BULK-CSR ' TO RC001-PARAGRAPH.            19620033
196300                                                                  19630003
196400     EXEC SQL                                                     19640003
196500         OPEN RC-BULK-CSR                                         19650003
196600     END-EXEC.                                                    19660003
196700                                                                  19670003
196800     EVALUATE SQLCODE                                             19680003
196900                                                                  19690003
197000       WHEN +0                                                    19700003
197100           SET PS-RC-BULK-CSR-START TO TRUE                       19710003
197200                                                                  19720003
197300       WHEN OTHER                                                 19730003
197400           SET PS-DONE-YES                                        19740003
197500               PS-RC-BULK-CSR-EOF TO TRUE                         19750003
197600           MOVE SQLCA      TO TM500-SQLCA                         19760003
197700           MOVE SQLCODE    TO TM500-SQLCODE                       19770003
197800           MOVE SQLCODE    TO RC001-SAVE-SQLCODE                  19780003
197900           MOVE SPACES     TO TM501-TM500-RETURN-MSG              19790003
198000           MOVE '821'      TO TM501-PGM                           19800003
198100           MOVE '3010'     TO TM501-PARA                          19810003
198200           MOVE 'TRECITM'  TO TM501-TBL                           19820003
198300           MOVE 17         TO TM501-PRORATION-ERROR-NBR           19830003
198400           PERFORM TM501-SET-TM500-RETURN-MSG                     19840003
198500           PERFORM RC001-RETURN-MSG                               19850003
198600                                                                  19860003
198700     END-EVALUATE.                                                19870003
198800                                                                  19880003
198900                                                                  19890003
199000* -------------------------------------------------------------- *19900003
199100*    ONE ROW IS ALWAYS FETCHED FROM THIS TABLE IF PACKAGING      *19910003
199200*    IS BULK.                                                    *19920003
199300* -------------------------------------------------------------- *19930003
199400                                                                  19940003
199500 3020-FETCH-RC-BULK-CSR.                                          19950003
199600                                                                  19960003
199700     MOVE '3020-FETCH-RC-BULK-CSR ' TO RC001-PARAGRAPH.           19970033
199800                                                                  19980003
199900     EXEC SQL                                                     19990003
200000                                                                  20000003
200100         FETCH RC-BULK-CSR                                        20010003
200200                                                                  20020003
200300          INTO :RECITM-CRE-TMST                                   20030003
200400             , :RECITM-STATUS-CDE                                 20040003
200500             , :RECITM-ORD-LNE-NBR                                20050003
200600             , :RECITM-PKSL-ITM-QTY                               20060003
200700             , :RECITM-DTL-CK-ITM-QTY                             20070003
200800             , :RECITM-PREPK-RATO-QTY                             20080003
200900             , :RECITM-CASE-PACK-QTY                              20090003
201000             , :RECITM-INNR-PACK-QTY                              20100003
201100             , :RECITM-PREPK-ODD-UNT-QTY                          20110003
201200             , :RECITM-PREPK-DRV-LNE-CDE                          20120003
201300             , :RECITM-ITM-NBR                                    20130003
201400                                                                  20140003
201500     END-EXEC.                                                    20150003
201600                                                                  20160003
201700     EVALUATE SQLCODE                                             20170003
201800                                                                  20180003
201900       WHEN +0                                                    20190003
202000           MOVE RECITM-ITM-NBR TO DK-ITM-NBR                      20200003
202100           PERFORM 2040-SELECT-XL-ITEM                            20210003
202200           PERFORM 3030-MOVE-RECITM-BULK-DATA                     20220003
202300           SET RC821-ITEM-IDX UP BY +1                            20230013
202400                                                                  20240003
202500       WHEN +100                                                  20250003
202600           SET PS-RC-BULK-CSR-EOF TO TRUE                         20260003
202700                                                                  20270003
202800       WHEN OTHER                                                 20280003
202900           SET PS-DONE-YES                                        20290003
203000               PS-RC-BULK-CSR-EOF TO TRUE                         20300003
203100           MOVE SQLCA     TO TM500-SQLCA                          20310003
203200           MOVE SQLCODE   TO TM500-SQLCODE                        20320003
203300           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   20330003
203400           MOVE SPACES    TO TM501-TM500-RETURN-MSG               20340003
203500           MOVE '821'     TO TM501-PGM                            20350003
203600           MOVE '3020'    TO TM501-PARA                           20360004
203700           MOVE 'TRECITM' TO TM501-TBL                            20370004
203800           MOVE 18        TO TM501-PRORATION-ERROR-NBR            20380003
203900           PERFORM TM501-SET-TM500-RETURN-MSG                     20390003
204000           PERFORM RC001-RETURN-MSG                               20400003
204100                                                                  20410003
204200     END-EVALUATE.                                                20420003
204300                                                                  20430003
204400                                                                  20440003
204500* -------------------------------------------------------------- *20450003
204600* -------------------------------------------------------------- *20460003
204700                                                                  20470003
204800 3030-MOVE-RECITM-BULK-DATA.                                      20480003
204900                                                                  20490003
205000     MOVE '3030-MOVE-RECITM-BULK-DATA' TO RC001-PARAGRAPH.        20500033
205100                                                                  20510003
205200     MOVE RECITM-ITM-NBR TO DK-ITM-NBR.                           20520003
205300                                                                  20530003
205400     MOVE RECITM-INNR-PACK-QTY                                    20540003
205500       TO RC821-REC-INNER-PACK-QTY (RC821-ITEM-IDX).              20550013
205600                                                                  20560003
205700     MOVE RECITM-ORD-LNE-NBR                                      20570003
205800       TO RC821-REC-LNE-NBR        (RC821-ITEM-IDX).              20580013
205900                                                                  20590003
206000     MOVE RECITM-ITM-NBR                                          20600003
206100       TO RC821-REC-ITEM-NBR       (RC821-ITEM-IDX).              20610013
206200                                                                  20620003
206300     MOVE RECITM-PKSL-ITM-QTY                                     20630003
206400       TO RC821-PKSL-ITM-QTY       (RC821-ITEM-IDX).              20640013
206500                                                                  20650003
206600     MOVE RECITM-DTL-CK-ITM-QTY                                   20660003
206700       TO RC821-DTL-CK-ITM-QTY     (RC821-ITEM-IDX).              20670013
206800                                                                  20680003
206900     MOVE RECITM-CASE-PACK-QTY                                    20690003
207000       TO RC821-REC-CASE-PACK-QTY  (RC821-ITEM-IDX).              20700013
207100                                                                  20710003
207200     MOVE ZEROS TO RC821-ODD-UNIT-QTY  (RC821-ITEM-IDX)           20720047
207300                   RC821-TOTAL-ODD-UNITS.                         20730047
207400                                                                  20740003
207500     MOVE PC-N  TO  RC821-BAD-PACK-DISTRO-IND.                    20750013
207600                                                                  20760003
207700*    PERFORM 4090-GET-DATE-RANGE.                                 20770062
207800                                                                  20780003
207900* -------------------------------------------------------------- *20790003
208000* -------------------------------------------------------------- *20800003
208100                                                                  20810003
208200 3040-CLOSE-RC-BULK-CSR.                                          20820003
208300                                                                  20830003
208400     MOVE '3040-CLOSE-RC-BULK-CSR ' TO RC001-PARAGRAPH.           20840033
208500                                                                  20850003
208600     EXEC SQL                                                     20860003
208700         CLOSE RC-BULK-CSR                                        20870003
208800     END-EXEC.                                                    20880003
208900                                                                  20890003
209000     EVALUATE SQLCODE                                             20900003
209100                                                                  20910003
209200       WHEN +0                                                    20920003
209300           SET PS-RC-BULK-CSR-EOF TO TRUE                         20930003
209400                                                                  20940003
209500       WHEN OTHER                                                 20950003
209600           SET PS-DONE-YES                                        20960003
209700               PS-RC-BULK-CSR-EOF TO TRUE                         20970003
209800           MOVE SQLCA      TO TM500-SQLCA                         20980003
209900           MOVE SQLCODE    TO TM500-SQLCODE                       20990003
210000           MOVE SQLCODE    TO RC001-SAVE-SQLCODE                  21000003
210100           MOVE SPACES     TO TM501-TM500-RETURN-MSG              21010003
210200           MOVE '821'      TO TM501-PGM                           21020003
210300           MOVE '3040'     TO TM501-PARA                          21030003
210400           MOVE 'TRECITM'  TO TM501-TBL                           21040003
210500           MOVE 19         TO TM501-PRORATION-ERROR-NBR           21050003
210600           PERFORM TM501-SET-TM500-RETURN-MSG                     21060003
210700           PERFORM RC001-RETURN-MSG                               21070003
210800                                                                  21080003
210900     END-EVALUATE.                                                21090003
211000                                                                  21100003
211100                                                                  21110003
211200* -------------------------------------------------------------- *21120003
211300* -------------------------------------------------------------- *21130003
211400                                                                  21140003
211500 3100-OPEN-RC-PACK-CSR.                                           21150003
211600                                                                  21160003
211700     MOVE '3100-OPEN-RC-PACK-CSR ' TO RC001-PARAGRAPH.            21170033
211800                                                                  21180003
211900     EXEC SQL                                                     21190003
212000         OPEN RC-PACK-CSR                                         21200003
212100     END-EXEC.                                                    21210003
212200                                                                  21220003
212300     EVALUATE SQLCODE                                             21230003
212400                                                                  21240003
212500       WHEN +0                                                    21250003
212600           SET PS-RC-PACK-CSR-START TO TRUE                       21260003
212700                                                                  21270003
212800       WHEN OTHER                                                 21280003
212900           SET PS-DONE-YES                                        21290003
213000               PS-RC-PACK-CSR-EOF TO TRUE                         21300003
213100           MOVE SQLCA      TO TM500-SQLCA                         21310003
213200           MOVE SQLCODE    TO TM500-SQLCODE                       21320003
213300           MOVE SQLCODE    TO RC001-SAVE-SQLCODE                  21330003
213400           MOVE SPACES     TO TM501-TM500-RETURN-MSG              21340003
213500           MOVE '821'      TO TM501-PGM                           21350003
213600           MOVE '3100'     TO TM501-PARA                          21360003
213700           MOVE 'TRECITM'  TO TM501-TBL                           21370003
213800           MOVE 20         TO TM501-PRORATION-ERROR-NBR           21380003
213900           PERFORM TM501-SET-TM500-RETURN-MSG                     21390003
214000           PERFORM RC001-RETURN-MSG                               21400003
214100                                                                  21410003
214200     END-EVALUATE.                                                21420003
214300                                                                  21430003
214400                                                                  21440003
214500* -------------------------------------------------------------- *21450003
214600*    MULTIPLE ROWS ARE ALWAYS FETCHED FROM THIS TABLE IF         *21460003
214700*    PACKAGING IS PREPACK.                                       *21470003
214800* -------------------------------------------------------------- *21480003
214900                                                                  21490003
215000 3110-LOOP-RC-PACK-CSR.                                           21500003
215100                                                                  21510003
215200     MOVE '3110-LOOP-RC-PACK-CSR ' TO RC001-PARAGRAPH.            21520033
215300                                                                  21530003
215400     EXEC SQL                                                     21540003
215500                                                                  21550003
215600         FETCH RC-PACK-CSR                                        21560003
215700                                                                  21570003
215800          INTO :RECITM-CRE-TMST                                   21580003
215900             , :RECITM-STATUS-CDE                                 21590003
216000             , :RECITM-ORD-LNE-NBR                                21600003
216100             , :RECITM-PKSL-ITM-QTY                               21610003
216200             , :RECITM-DTL-CK-ITM-QTY                             21620003
216300             , :RECITM-PREPK-RATO-QTY                             21630003
216400             , :RECITM-CASE-PACK-QTY                              21640003
216500             , :RECITM-INNR-PACK-QTY                              21650003
216600             , :RECITM-PREPK-ODD-UNT-QTY                          21660003
216700             , :RECITM-PREPK-DRV-LNE-CDE                          21670003
216800             , :RECITM-ITM-NBR                                    21680003
216900                                                                  21690003
217000     END-EXEC.                                                    21700003
217100                                                                  21710003
217200     EVALUATE SQLCODE                                             21720003
217300                                                                  21730003
217400       WHEN +0                                                    21740003
217500           MOVE RECITM-ITM-NBR TO DK-ITM-NBR                      21750003
217600           PERFORM 2040-SELECT-XL-ITEM                            21760003
217700           PERFORM 3120-LOAD-RC-DATA-TO-RC821                     21770013
217800                                                                  21780003
217900           SET RC821-ITEM-IDX UP BY +1                            21790013
218000                                                                  21800003
218100       WHEN +100                                                  21810003
218200           SET PS-RC-PACK-CSR-EOF TO TRUE                         21820003
218300                                                                  21830003
218400       WHEN OTHER                                                 21840003
218500           SET PS-DONE-YES                                        21850003
218600               PS-RC-PACK-CSR-EOF TO TRUE                         21860003
218700           MOVE SQLCA     TO TM500-SQLCA                          21870018
218800           MOVE SQLCODE   TO TM500-SQLCODE                        21880018
218900           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   21890018
219000           MOVE SPACES    TO TM501-TM500-RETURN-MSG               21900018
219100           MOVE '821'     TO TM501-PGM                            21910018
219200           MOVE '3110'    TO TM501-PARA                           21920018
219300           MOVE 'TRECITM' TO TM501-TBL                            21930018
219400           MOVE 21        TO TM501-PRORATION-ERROR-NBR            21940018
219500           PERFORM TM501-SET-TM500-RETURN-MSG                     21950003
219600           PERFORM RC001-RETURN-MSG                               21960003
219700                                                                  21970003
219800     END-EVALUATE.                                                21980003
219900                                                                  21990003
220000                                                                  22000003
220100* -------------------------------------------------------------- *22010003
220200* -------------------------------------------------------------- *22020003
220300                                                                  22030003
220400 3120-LOAD-RC-DATA-TO-RC821.                                      22040013
220500                                                                  22050003
220600     MOVE '3120-LOAD-RC-DATA-TO-RC821' TO RC001-PARAGRAPH.        22060033
220700                                                                  22070003
220800     MOVE RECITM-ORD-LNE-NBR                                      22080003
220900       TO RC821-REC-LNE-NBR        (RC821-ITEM-IDX).              22090013
221000                                                                  22100003
221100     MOVE RECITM-ITM-NBR                                          22110003
221200       TO RC821-REC-ITEM-NBR       (RC821-ITEM-IDX).              22120013
221300                                                                  22130003
221400     MOVE RECITM-PKSL-ITM-QTY                                     22140003
221500       TO RC821-PKSL-ITM-QTY       (RC821-ITEM-IDX).              22150013
221600                                                                  22160003
221700     MOVE RECITM-DTL-CK-ITM-QTY                                   22170003
221800       TO RC821-DTL-CK-ITM-QTY     (RC821-ITEM-IDX).              22180013
221900                                                                  22190003
222000     MOVE RECITM-INNR-PACK-QTY                                    22200003
222100       TO RC821-REC-INNER-PACK-QTY (RC821-ITEM-IDX).              22210013
222200                                                                  22220003
222300     MOVE RECITM-CASE-PACK-QTY                                    22230003
222400       TO RC821-REC-CASE-PACK-QTY  (RC821-ITEM-IDX).              22240013
222500                                                                  22250003
222600     MOVE RECITM-PREPK-RATO-QTY                                   22260003
222700       TO RC821-REC-PACK-RATO-QTY  (RC821-ITEM-IDX).              22270013
222800                                                                  22280003
222900     MOVE RECITM-PREPK-DRV-LNE-CDE                                22290003
223000       TO RC821-DRV-LNE-CDE        (RC821-ITEM-IDX).              22300013
223100                                                                  22310003
223200     MOVE RECITM-PREPK-ODD-UNT-QTY                                22320003
223300       TO RC821-ODD-UNIT-QTY       (RC821-ITEM-IDX).              22330013
223400                                                                  22340003
223500     ADD  RECITM-PREPK-ODD-UNT-QTY TO RC821-TOTAL-ODD-UNITS.      22350013
223600                                                                  22360003
223700*    PERFORM 4090-GET-DATE-RANGE.                                 22370062
223800                                                                  22380003
223900 3140-CLOSE-RC-PACK-CSR.                                          22390003
224000                                                                  22400003
224100     MOVE '3140-CLOSE-RC-PACK-CSR ' TO RC001-PARAGRAPH.           22410033
224200                                                                  22420003
224300     EXEC SQL                                                     22430003
224400         CLOSE RC-PACK-CSR                                        22440003
224500     END-EXEC.                                                    22450003
224600                                                                  22460003
224700     EVALUATE SQLCODE                                             22470003
224800                                                                  22480003
224900       WHEN +0                                                    22490003
225000           SET PS-RC-PACK-CSR-EOF TO TRUE                         22500003
225100                                                                  22510003
225200       WHEN OTHER                                                 22520003
225300           SET PS-DONE-YES                                        22530003
225400               PS-RC-PACK-CSR-EOF TO TRUE                         22540003
225500           MOVE SQLCA     TO TM500-SQLCA                          22550003
225600           MOVE SQLCODE   TO TM500-SQLCODE                        22560003
225700           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   22570003
225800           MOVE SPACES    TO TM501-TM500-RETURN-MSG               22580003
225900           MOVE '821'     TO TM501-PGM                            22590003
226000           MOVE '3140'    TO TM501-PARA                           22600003
226100           MOVE 'TRECITM' TO TM501-TBL                            22610003
226200           MOVE 22        TO TM501-PRORATION-ERROR-NBR            22620003
226300           PERFORM TM501-SET-TM500-RETURN-MSG                     22630003
226400           PERFORM RC001-RETURN-MSG                               22640003
226500                                                                  22650003
226600     END-EVALUATE.                                                22660003
226700                                                                  22670003
226800                                                                  22680003
226900* -------------------------------------------------------------- *22690003
227000* -------------------------------------------------------------- *22700003
227100                                                                  22710003
227200 3150-MOVE-XL001-DATA.                                            22720003
227300                                                                  22730003
227400     MOVE '3150-MOVE-XL001-DATA      ' TO RC001-PARAGRAPH.        22740033
227500                                                                  22750003
227600     IF XL001-WEB-SKU-SQLCODE EQUAL +0                            22760003
227700         MOVE PC-Y TO RC821-WEB-ITEM-IND (RC821-ITEM-IDX)         22770013
227800     ELSE                                                         22780003
227900         MOVE PC-N TO RC821-WEB-ITEM-IND (RC821-ITEM-IDX)         22790013
228000     END-IF.                                                      22800003
228100                                                                  22810003
228200     MOVE XL001-UPC-ID                                            22820003
228300       TO RC821-REC-ITEM-UPC-ID      (RC821-ITEM-IDX).            22830013
228400                                                                  22840003
228500     MOVE XL001-SKU-NBR                                           22850003
228600       TO RC821-REC-SKU-NBR          (RC821-ITEM-IDX)             22860013
228700          RC821-PO-SKU-NBR           (RC821-ITEM-IDX).            22870013
228800                                                                  22880003
228900     MOVE XL001-GP-AMT                                            22890003
229000       TO RC821-SK-GP-RTL-AMT        (RC821-ITEM-IDX).            22900013
229100                                                                  22910003
229200     MOVE XL001-GP-QTY                                            22920003
229300       TO RC821-SK-GP-QTY            (RC821-ITEM-IDX).            22930013
229400                                                                  22940003
229500     MOVE XL001-UNT-RTL-AMT                                       22950003
229600       TO RC821-SK-UNT-RTL-PR-AMT    (RC821-ITEM-IDX).            22960013
229700                                                                  22970003
229800     MOVE XL001-UPC-NBR                                           22980003
229900       TO RC821-REC-ITEM-UPC-NBR     (RC821-ITEM-IDX).            22990013
230000                                                                  23000003
230100     MOVE XL001-INTR-UPC-ID                                       23010003
230200       TO RC821-REC-ITEM-UPC-INTR-ID (RC821-ITEM-IDX).            23020013
230300                                                                  23030003
230400     MOVE XL001-ITM-NBR                                           23040003
230500       TO RC821-PO-ITEM-NBR          (RC821-ITEM-IDX).            23050013
230600                                                                  23060003
230700     MOVE XL001-INNR-PACK-QTY                                     23070070
230800       TO RC821-SKU-INNER-PACK-QTY   (RC821-ITEM-IDX).            23080070
230900                                                                  23090003
231000* -------------------------------------------------------------- *23100003
231100* -------------------------------------------------------------- *23110003
231200*           R E T R I E V E   M I S C   D A T A                  *23120003
231300* -------------------------------------------------------------- *23130003
231400* -------------------------------------------------------------- *23140003
231500                                                                  23150003
231600 4000-GET-MISC-DATA.                                              23160003
231700                                                                  23170003
231800     MOVE '4000-GET-MISC-DATA        ' TO RC001-PARAGRAPH.        23180033
231900                                                                  23190003
232000     PERFORM 4010-GET-STORE-TROUBLE-CNT.                          23200003
232100                                                                  23210003
232200     IF PS-BULK  OR  RC821-PREPK-ID = 0                           23220043
232300         PERFORM 4020-GET-BULK-TROUBLE-CNT                        23230003
232400     END-IF.                                                      23240003
232500                                                                  23250003
232600     IF PS-PREPACK  AND  RC821-PREPK-ID > 0                       23260043
232700         PERFORM 4030-GET-PREPACK-TROUBLE-CNT                     23270003
232800     END-IF.                                                      23280003
232900                                                                  23290003
233000     PERFORM 4040-GET-MISC-TRECEIV-DATA.                          23300063
233100                                                                  23310003
233200                                                                  23320003
233300* -------------------------------------------------------------- *23330003
233400* -------------------------------------------------------------- *23340003
233500                                                                  23350003
233600 4010-GET-STORE-TROUBLE-CNT.                                      23360003
233700                                                                  23370003
233800     MOVE '4010-GET-STORE-TROUBLE-CNT ' TO RC001-PARAGRAPH.       23380033
233900                                                                  23390003
234000     EXEC SQL                                                     23400003
234100                                                                  23410003
234200         SELECT COUNT(*)                                          23420003
234300                                                                  23430003
234400           INTO :PV-PO-RECEIV-CNT                                 23440003
234500                                                                  23450003
234600           FROM TRECEIV                                           23460003
234700                                                                  23470003
234800         WHERE ORD_NBR         =  :RC821-ORD-NBR                  23480013
234900           AND VER_STATUS_CDE  =  :PC-A                           23490003
235000                                                                  23500003
235100     END-EXEC.                                                    23510003
235200                                                                  23520003
235300     EVALUATE SQLCODE                                             23530003
235400                                                                  23540003
235500       WHEN +0                                                    23550003
235600           MOVE PV-PO-RECEIV-CNT TO RC821-REC-COUNT               23560013
235700                                                                  23570003
235800       WHEN OTHER                                                 23580003
235900           MOVE SQLCA       TO TM500-SQLCA                        23590003
236000           MOVE SQLCODE     TO TM500-SQLCODE                      23600003
236100           MOVE SQLCODE     TO RC001-SAVE-SQLCODE                 23610003
236200           MOVE SPACES      TO TM501-TM500-RETURN-MSG             23620003
236300           MOVE '821'       TO TM501-PGM                          23630004
236400           MOVE '4010'      TO TM501-PARA                         23640003
236500           MOVE 'TRECEIV'   TO TM501-TBL                          23650003
236600           MOVE 23          TO TM501-PRORATION-ERROR-NBR          23660003
236700           PERFORM TM501-SET-TM500-RETURN-MSG                     23670003
236800           PERFORM RC001-RETURN-MSG                               23680003
236900                                                                  23690003
237000     END-EVALUATE.                                                23700003
237100                                                                  23710003
237200                                                                  23720003
237300* -------------------------------------------------------------- *23730003
237400* -------------------------------------------------------------- *23740003
237500                                                                  23750003
237600 4020-GET-BULK-TROUBLE-CNT.                                       23760003
237700                                                                  23770003
237800     MOVE '4020-GET-BULK-TROUBLE-CNT ' TO RC001-PARAGRAPH.        23780033
237900                                                                  23790003
238000     EXEC SQL                                                     23800003
238100                                                                  23810003
238200         SELECT COUNT(*)                                          23820003
238300                                                                  23830003
238400           INTO :PV-BULK-CNT                                      23840003
238500                                                                  23850003
238600           FROM TTRBNTF                                           23860003
238700                                                                  23870003
238800         WHERE PO_NBR        =  :RC821-ORD-NBR                    23880013
238900           AND PO_LNE_NBR    =  :RC821-REC-DRV-LNE-NBR            23890013
239000           AND TRBL_RSN_CDE  =  :PC-570                           23900003
239100           AND PRORATE_IND   =  :PC-Y                             23910003
239200           AND REC_SEQ_NBR   =  :RC821-REC-SEQ-NBR                23920013
239300                                                                  23930003
239400     END-EXEC.                                                    23940003
239500                                                                  23950003
239600     EVALUATE SQLCODE                                             23960003
239700                                                                  23970003
239800       WHEN +0                                                    23980003
239900           MOVE PV-BULK-CNT TO RC821-REC-TROUBLE-SHORT-CNT        23990013
240000                                                                  24000003
240100       WHEN OTHER                                                 24010003
240200           MOVE SQLCA        TO TM500-SQLCA                       24020003
240300           MOVE SQLCODE      TO TM500-SQLCODE                     24030003
240400           MOVE SQLCODE      TO RC001-SAVE-SQLCODE                24040003
240500           MOVE SPACES       TO TM501-TM500-RETURN-MSG            24050003
240600           MOVE '821'        TO TM501-PGM                         24060004
240700           MOVE '4020'       TO TM501-PARA                        24070003
240800           MOVE 'TTRBNTF'    TO TM501-TBL                         24080003
240900           MOVE 24           TO TM501-PRORATION-ERROR-NBR         24090003
241000           PERFORM TM501-SET-TM500-RETURN-MSG                     24100003
241100           PERFORM RC001-RETURN-MSG                               24110003
241200                                                                  24120003
241300     END-EVALUATE.                                                24130003
241400                                                                  24140003
241500                                                                  24150003
241600* -------------------------------------------------------------- *24160003
241700* -------------------------------------------------------------- *24170003
241800                                                                  24180003
241900 4030-GET-PREPACK-TROUBLE-CNT.                                    24190003
242000                                                                  24200003
242100     MOVE '4030-GET-PREPACK-TROUBLE-CNT ' TO RC001-PARAGRAPH.     24210033
242200                                                                  24220003
242300     EXEC SQL                                                     24230003
242400                                                                  24240003
242500         SELECT COUNT(*)                                          24250003
242600                                                                  24260003
242700           INTO :PV-PREPACK-CNT                                   24270003
242800                                                                  24280003
242900           FROM TTRBNTF                                           24290003
243000                                                                  24300003
243100         WHERE PO_NBR        =  :RC821-ORD-NBR                    24310013
243200           AND PREPK_ID      =  :RC821-PREPK-ID                   24320013
243300           AND TRBL_RSN_CDE  =  :PC-570                           24330003
243400           AND PRORATE_IND   =  :PC-Y                             24340003
243500           AND REC_SEQ_NBR   =  :RC821-REC-SEQ-NBR                24350013
243600                                                                  24360003
243700     END-EXEC.                                                    24370003
243800                                                                  24380003
243900     EVALUATE SQLCODE                                             24390003
244000                                                                  24400003
244100       WHEN +0                                                    24410003
244200           ADD PV-PREPACK-CNT TO RC821-REC-TROUBLE-SHORT-CNT      24420013
244300                                                                  24430003
244400       WHEN OTHER                                                 24440003
244500           MOVE SQLCA        TO TM500-SQLCA                       24450003
244600           MOVE SQLCODE      TO TM500-SQLCODE                     24460003
244700           MOVE SQLCODE      TO RC001-SAVE-SQLCODE                24470003
244800           MOVE SPACES       TO TM501-TM500-RETURN-MSG            24480003
244900           MOVE '821'        TO TM501-PGM                         24490003
245000           MOVE '4030'       TO TM501-PARA                        24500004
245100           MOVE 'TTRBNTF'    TO TM501-TBL                         24510003
245200           MOVE 25           TO TM501-PRORATION-ERROR-NBR         24520003
245300           PERFORM TM501-SET-TM500-RETURN-MSG                     24530003
245400           PERFORM RC001-RETURN-MSG                               24540003
245500                                                                  24550003
245600     END-EVALUATE.                                                24560003
245700                                                                  24570003
245800                                                                  24580003
245900     EXEC SQL                                                     24590003
246000                                                                  24600003
246100         SELECT COUNT(*)                                          24610003
246200                                                                  24620003
246300           INTO :PV-PREPACK-CNT                                   24630003
246400                                                                  24640003
246500           FROM TTRBNTF                                           24650003
246600                                                                  24660003
246700         WHERE PO_NBR        =  :RC821-ORD-NBR                    24670013
246800           AND PREPK_ID      =  :RC821-PREPK-ID                   24680013
246900           AND TRBL_RSN_CDE  =  :PC-267                           24690003
247000           AND PRORATE_IND   =  :PC-Y                             24700003
247100           AND REC_SEQ_NBR   =  :RC821-REC-SEQ-NBR                24710013
247200                                                                  24720003
247300     END-EXEC.                                                    24730003
247400                                                                  24740003
247500                                                                  24750003
247600     EVALUATE SQLCODE                                             24760003
247700                                                                  24770003
247800       WHEN +0                                                    24780003
247900           MOVE PV-PREPACK-CNT TO RC821-REC-TROUBLE-DCPACK-CNT    24790013
248000                                                                  24800003
248100       WHEN OTHER                                                 24810003
248200           MOVE SQLCA        TO TM500-SQLCA                       24820003
248300           MOVE SQLCODE      TO TM500-SQLCODE                     24830003
248400           MOVE SQLCODE      TO RC001-SAVE-SQLCODE                24840003
248500           MOVE SPACES       TO TM501-TM500-RETURN-MSG            24850003
248600           MOVE '821'        TO TM501-PGM                         24860003
248700           MOVE '4030'       TO TM501-PARA                        24870004
248800           MOVE 'TTRBNTF'    TO TM501-TBL                         24880003
248900           MOVE 25           TO TM501-PRORATION-ERROR-NBR         24890003
249000           PERFORM TM501-SET-TM500-RETURN-MSG                     24900003
249100           PERFORM RC001-RETURN-MSG                               24910003
249200                                                                  24920003
249300     END-EVALUATE.                                                24930003
249400                                                                  24940003
249500* -------------------------------------------------------------- *24950003
249600* -------------------------------------------------------------- *24960003
249700                                                                  24970003
249800 4040-GET-MISC-TRECEIV-DATA.                                      24980063
249900                                                                  24990003
250000     MOVE '4040-GET-MISC-TRECEIV-DATA ' TO RC001-PARAGRAPH.       25000063
250100                                                                  25010003
250200     EXEC SQL                                                     25020003
250300                                                                  25030003
250400         SELECT PACK_BY_ST_IND                                    25040003
250500               ,CRE_OPER_UNT_ID                                   25050064
250600               ,CURR_OPER_UNT_ID                                  25060064
250700                                                                  25070003
250800           INTO :RECEIV-PACK-BY-ST-IND                            25080003
250900               ,:RECEIV-CRE-OPER-UNT-ID                           25090064
251000               ,:RECEIV-CURR-OPER-UNT-ID                          25100064
251100                                                                  25110003
251200           FROM TRECEIV                                           25120003
251300                                                                  25130003
251400         WHERE ORD_NBR         =  :RC821-ORD-NBR                  25140013
251500           AND REC_SEQ_NBR     =  :RC821-REC-SEQ-NBR              25150013
251600           AND VER_STATUS_CDE  =  :PC-A                           25160003
251700                                                                  25170003
251800     END-EXEC.                                                    25180003
251900                                                                  25190003
252000                                                                  25200003
252100     EVALUATE SQLCODE                                             25210003
252200                                                                  25220003
252300       WHEN +0                                                    25230003
252400           MOVE RECEIV-PACK-BY-ST-IND TO RC821-PACK-BY-STORE-IND  25240013
252500           MOVE RECEIV-CRE-OPER-UNT-ID                            25250064
252600                                      TO RC821-CRE-OPER-UNT-ID    25260064
252700           MOVE RECEIV-CURR-OPER-UNT-ID                           25270064
252800                                      TO RC821-CURR-OPER-UNT-ID   25280064
252900                                                                  25290003
253000       WHEN OTHER                                                 25300003
253100           MOVE SQLCA        TO TM500-SQLCA                       25310003
253200           MOVE SQLCODE      TO TM500-SQLCODE                     25320003
253300           MOVE SQLCODE      TO RC001-SAVE-SQLCODE                25330003
253400           MOVE SPACES       TO TM501-TM500-RETURN-MSG            25340003
253500           MOVE '821'        TO TM501-PGM                         25350003
253600           MOVE '4040'       TO TM501-PARA                        25360004
253700           MOVE 'TRECEIV'    TO TM501-TBL                         25370003
253800           MOVE 26           TO TM501-PRORATION-ERROR-NBR         25380003
253900           PERFORM TM501-SET-TM500-RETURN-MSG                     25390003
254000           PERFORM RC001-RETURN-MSG                               25400003
254100                                                                  25410003
254200     END-EVALUATE.                                                25420003
254300                                                                  25430003
254400                                                                  25440003
254500* -------------------------------------------------------------- *25450003
254600* -------------------------------------------------------------- *25460003
254700                                                                  25470003
254800 4050-GET-PLAN-INFO.                                              25480003
254900                                                                  25490003
255000     MOVE '4050-GET-PLAN-INFO  ' TO RC001-PARAGRAPH.              25500033
255100                                                                  25510003
255200     EXEC SQL                                                     25520003
255300                                                                  25530003
255400         SELECT PLAN_NBR                                          25540003
255500              , CURR_SPLIT_QTY                                    25550003
255600              , ALLOC_OUTR_PK_QTY                                 25560003
255700              , PK_SIZE_RND_CDE                                   25570003
255800              , SHTG_PRRT_OPT_CDE                                 25580003
255900              , OVRG_PRRT_OPT_CDE                                 25590003
256000              , EXST_SHTG_THRS_IND                                25600003
256100                                                                  25610003
256200           INTO :ALLPLN-PLAN-NBR                                  25620003
256300              , :ALLPLN-CURR-SPLIT-QTY                            25630003
256400              , :ALLPLN-ALLOC-OUTR-PK-QTY                         25640003
256500              , :ALLPLN-PK-SIZE-RND-CDE                           25650003
256600              , :ALLPLN-SHTG-PRRT-OPT-CDE                         25660003
256700              , :ALLPLN-OVRG-PRRT-OPT-CDE                         25670003
256800              , :ALLPLN-EXST-SHTG-THRS-IND                        25680003
256900                                                                  25690003
257000           FROM TALLPLN                                           25700003
257100                                                                  25710003
257200         WHERE PO_NBR       =  :RC821-ORD-NBR                     25720013
257300           AND PO_LNE_NBR   =  :PURITM-PO-LNE-NBR                 25730003
257400           AND DEST_NBR     =  :RC821-OPER-UNT-ID                 25740013
257500           AND STATUS_CDE   =  :PC-AC                             25750003
257600                                                                  25760003
257700     END-EXEC.                                                    25770003
257800                                                                  25780003
257900                                                                  25790003
258000     EVALUATE SQLCODE                                             25800003
258100                                                                  25810003
258200       WHEN +0                                                    25820003
258300                                                                  25830010
258400           MOVE ALLPLN-PLAN-NBR                                   25840010
258500             TO RC821-PLAN-NBR                                    25850013
258600                                                                  25860010
258700           MOVE ALLPLN-CURR-SPLIT-QTY                             25870010
258800             TO RC821-CURR-SPLIT-QTY                              25880013
258900                                                                  25890010
259000           MOVE ALLPLN-ALLOC-OUTR-PK-QTY                          25900010
259100             TO RC821-ALLOC-OUTR-PK-QTY                           25910013
259200                                                                  25920010
259300           MOVE ALLPLN-PK-SIZE-RND-CDE                            25930010
259400             TO RC821-PK-SIZE-RND-CDE                             25940013
259500                                                                  25950010
259600           MOVE ALLPLN-SHTG-PRRT-OPT-CDE                          25960010
259700             TO RC821-SHORT-PRORATE-CDE                           25970013
259800                                                                  25980010
259900           MOVE ALLPLN-OVRG-PRRT-OPT-CDE                          25990010
260000             TO RC821-OVER-PRORATE-CDE                            26000013
260100                                                                  26010010
260200           MOVE ALLPLN-EXST-SHTG-THRS-IND                         26020010
260300             TO RC821-SHORT-USE-EX-RULES-IND                      26030013
260400                                                                  26040010
260500           MOVE PC-N  TO  RC821-NO-TALLPLN-DISTRO-IND             26050013
260600                                                                  26060010
260700           IF ALLPLN-CURR-SPLIT-QTY EQUAL ZERO                    26070010
260800               MOVE PC-N TO RC821-VALID-DISTRO-IND                26080013
260900               MOVE PC-Y TO RC821-NO-TALLPLN-DISTRO-IND           26090013
261000           END-IF                                                 26100010
261100                                                                  26110003
261200       WHEN +100                                                  26120003
261300           MOVE PC-Y  TO  RC821-NO-TALLPLN-DISTRO-IND             26130013
261400                                                                  26140003
261500       WHEN OTHER                                                 26150003
261600           MOVE SQLCA        TO TM500-SQLCA                       26160003
261700           MOVE SQLCODE      TO TM500-SQLCODE                     26170003
261800           MOVE SQLCODE      TO RC001-SAVE-SQLCODE                26180003
261900           MOVE SPACES       TO TM501-TM500-RETURN-MSG            26190003
262000           MOVE '821'        TO TM501-PGM                         26200003
262100           MOVE '4050'       TO TM501-PARA                        26210004
262200           MOVE 'TALLPLN'    TO TM501-TBL                         26220003
262300           MOVE 27           TO TM501-PRORATION-ERROR-NBR         26230003
262400           PERFORM TM501-SET-TM500-RETURN-MSG                     26240003
262500           PERFORM RC001-RETURN-MSG                               26250003
262600                                                                  26260003
262700     END-EVALUATE.                                                26270003
262800                                                                  26280003
262900                                                                  26290003
263000* -------------------------------------------------------------- *26300003
263100* -------------------------------------------------------------- *26310003
263200                                                                  26320003
263300 4060-GET-DISTRO-QTY.                                             26330003
263400                                                                  26340003
263500     MOVE '4060-GET-DISTRO-QTY  ' TO RC001-PARAGRAPH.             26350033
263600                                                                  26360003
263700     EXEC SQL                                                     26370003
263800                                                                  26380003
263900         SELECT COUNT(*)                                          26390003
264000                                                                  26400003
264100           INTO :PV-SUM-STORE-PLAN-QTY                            26410003
264200                                                                  26420003
264300           FROM TMESTDS                                           26430003
264400                                                                  26440003
264500         WHERE PO_NBR       =  :RC821-ORD-NBR                     26450013
264600           AND PO_LNE_NBR   =  :PURITM-PO-LNE-NBR                 26460003
264700           AND PLAN_NBR     =  :ALLPLN-PLAN-NBR                   26470003
264800                                                                  26480003
264900     END-EXEC.                                                    26490003
265000                                                                  26500003
265100                                                                  26510003
265200     EVALUATE SQLCODE                                             26520003
265300                                                                  26530003
265400       WHEN +0                                                    26540003
265500                                                                  26550003
265600           IF PV-SUM-STORE-PLAN-QTY EQUAL ZERO                    26560003
265700               MOVE PC-N TO RC821-VALID-DISTRO-IND                26570013
265800               MOVE PC-Y TO RC821-NO-TMESTDS-DISTRO-IND           26580013
265900           ELSE                                                   26590003
266000               MOVE PC-N TO RC821-NO-TMESTDS-DISTRO-IND           26600013
266100           END-IF                                                 26610003
266200                                                                  26620003
266300           MOVE PV-SUM-STORE-PLAN-QTY TO RC821-SUM-STR-PLAN-QTY   26630013
266400                                                                  26640003
266500       WHEN +100                                                  26650003
266600           MOVE PC-Y  TO  RC821-NO-TMESTDS-DISTRO-IND             26660013
266700                                                                  26670003
266800       WHEN OTHER                                                 26680003
266900           MOVE SQLCA        TO TM500-SQLCA                       26690003
267000           MOVE SQLCODE      TO TM500-SQLCODE                     26700003
267100           MOVE SQLCODE      TO RC001-SAVE-SQLCODE                26710003
267200           MOVE SPACES       TO TM501-TM500-RETURN-MSG            26720003
267300           MOVE '821'        TO TM501-PGM                         26730003
267400           MOVE '4060'       TO TM501-PARA                        26740004
267500           MOVE 'TMESTDS'    TO TM501-TBL                         26750003
267600           MOVE 28           TO TM501-PRORATION-ERROR-NBR         26760003
267700           PERFORM TM501-SET-TM500-RETURN-MSG                     26770003
267800           PERFORM RC001-RETURN-MSG                               26780000
267900                                                                  26790003
268000     END-EVALUATE.                                                26800003
268100                                                                  26810003
268200                                                                  26820003
268300* -------------------------------------------------------------- *26830003
268400* -------------------------------------------------------------- *26840003
268500                                                                  26850003
268600 4070-GET-TYPE-CODE-INFO.                                         26860003
268700                                                                  26870003
268800     MOVE '4070-GET-TYPE-CODE-INFO  ' TO RC001-PARAGRAPH.         26880033
268900                                                                  26890003
269000     INITIALIZE XL071-COMMAREA-REC.                               26900081
269100     MOVE RC821-OPER-UNT-ID           TO XL071-LOCATION-NUMBER.   26910081
269200                                                                  26920081
269300     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                  26930081
269400                                        XL071-COMMAREA            26940081
269500                                        XL071-COMMAREA-REC.       26950081
269600                                                                  26960081
269700     EVALUATE TRUE                                                26970081
269800       WHEN XL071-NO-ERRORS                                       26980083
269900          MOVE XL071-LOC-TYP-CDE       TO RC821-TYPE-CODE         26990083
270000          MOVE XL071-ASGMT-DC-NBR      TO RC821-DC-NMBR           27000098
270100          MOVE XL071-ASGMT-EFF-BEG-DTE TO RC821-DC-RCT-STA-DTE    27010098
270200          MOVE XL071-ASGMT-EFF-STP-DTE TO RC821-DC-RCT-STO-DTE    27020098
270300                                                                  27030080
270400       WHEN OTHER                                                 27040003
270500           MOVE XL071-SQLCA     TO TM500-SQLCA                    27050099
270600           MOVE XL071-SQLCODE-N TO TM500-SQLCODE                  27060099
270700           MOVE XL071-SQLCODE-N TO RC001-SAVE-SQLCODE             27070099
270800           MOVE SPACES          TO TM501-TM500-RETURN-MSG         27080099
270900           MOVE '821'           TO TM501-PGM                      27090099
271000           MOVE '4070'          TO TM501-PARA                     27100099
271100           MOVE 'XLT_LOC'       TO TM501-TBL                      27110099
271200           MOVE 29              TO TM501-PRORATION-ERROR-NBR      27120099
271300           PERFORM TM501-SET-TM500-RETURN-MSG                     27130003
271400           PERFORM RC001-RETURN-MSG                               27140000
271500                                                                  27150003
271600     END-EVALUATE.                                                27160003
271700                                                                  27170003
271800                                                                  27180003
271900* -------------------------------------------------------------- *27190003
272000* -------------------------------------------------------------- *27200003
272100 4080-GET-REC-CONTROL-INFO.                                       27210003
272200                                                                  27220003
272300     MOVE '4080-GET-REC-CONTROL-INFO' TO RC001-PARAGRAPH.         27230033
272400                                                                  27240003
272500     EXEC SQL                                                     27250003
272600                                                                  27260003
272700         SELECT  DAYS_PR_CHG_NBR                                  27270003
272800               , LNE_ODU_TOL_QTY                                  27280003
272900               , LNE_ODU_TOL_AMT                                  27290003
273000               , PREPK_ODU_TOL_QTY                                27300003
273100               , PREPK_ODU_TOL_AMT                                27310003
273200                                                                  27320003
273300           INTO  :COCNTL-DAYS-PR-CHG-NBR                          27330003
273400               , :COCNTL-LNE-ODU-TOL-QTY                          27340003
273500               , :COCNTL-LNE-ODU-TOL-AMT                          27350003
273600               , :COCNTL-PREPK-ODU-TOL-QTY                        27360003
273700               , :COCNTL-PREPK-ODU-TOL-AMT                        27370003
273800                                                                  27380003
273900           FROM TCOCNTL                                           27390003
274000                                                                  27400003
274100         WHERE OPER_UNT_ID  =  :RC821-OPER-UNT-ID                 27410013
274200           AND FCLTY_ID     =  :RC821-FCLTY-ID                    27420013
274300                                                                  27430003
274400     END-EXEC.                                                    27440003
274500                                                                  27450003
274600     EVALUATE SQLCODE                                             27460003
274700                                                                  27470003
274800       WHEN +0                                                    27480003
274900          MOVE COCNTL-DAYS-PR-CHG-NBR   TO RC821-DAYS-PR-CHG-NBR  27490013
275000          MOVE COCNTL-LNE-ODU-TOL-QTY   TO RC821-LNE-ODU-TOL-QTY  27500013
275100          MOVE COCNTL-LNE-ODU-TOL-AMT   TO RC821-LNE-ODU-TOL-AMT  27510013
275200          MOVE COCNTL-PREPK-ODU-TOL-QTY TO RC821-PREPK-ODU-TOL-QTY27520013
275300          MOVE COCNTL-PREPK-ODU-TOL-AMT TO RC821-PREPK-ODU-TOL-AMT27530013
275400                                                                  27540003
275500       WHEN OTHER                                                 27550003
275600           MOVE SQLCA      TO TM500-SQLCA                         27560004
275700           MOVE SQLCODE    TO TM500-SQLCODE                       27570004
275800           MOVE SQLCODE    TO RC001-SAVE-SQLCODE                  27580004
275900           MOVE SPACES     TO TM501-TM500-RETURN-MSG              27590004
276000           MOVE '821'      TO TM501-PGM                           27600004
276100           MOVE '4080'     TO TM501-PARA                          27610004
276200           MOVE 'TCOCNTL'  TO TM501-TBL                           27620004
276300           MOVE 30         TO TM501-PRORATION-ERROR-NBR           27630004
276400           PERFORM TM501-SET-TM500-RETURN-MSG                     27640003
276500           PERFORM RC001-RETURN-MSG                               27650000
276600                                                                  27660003
276700     END-EVALUATE.                                                27670003
276800                                                                  27680003
276900                                                                  27690003
277000* -------------------------------------------------------------- *27700003
277100*    THIS PARAGRAPH CALCULATES THE END DATE FROM TODAYS DATE      27710003
277200*    USING DAYS-PR-CHG-NBR OF COCNTL TABLE.  THIS END DATE ALONG  27720003
277300*    WITH TODAY'S DATE (BEGIN DATE) WILL BE USED TO RETRIEVE      27730003
277400*    THE PRICE CHANGE THAT FALLS BETWEEN THESE DATES.             27740003
277500* -------------------------------------------------------------- *27750003
277600                                                                  27760003
277700*4090-GET-DATE-RANGE.                                             27770062
277800*                                                                 27780062
277900*    MOVE '4090-GET-DATE-RANGE ' TO RC001-PARAGRAPH.              27790062
278000*                                                                 27800062
278100*    INITIALIZE DPG51                                             27810062
278200*               DPG52                                             27820062
278300*               DPG53                                             27830062
278400*               DPG54                                             27840062
278500*               DPG55                                             27850062
278600*               DPG56.                                            27860062
278700*                                                                 27870062
278800*    MOVE EIBDATE     TO PV-EIBDATE-N.                            27880062
278900*    MOVE PV-EIBDATE  TO DPG52-LK-DATE-INPUT.                     27890062
279000*                                                                 27900062
279100*    SET DPG51-DO-NOT-INCR-DECR-DATE                              27910062
279200*        DPG51-ACTUAL-CALENDAR-ONLY                               27920062
279300*        DPG52-LK-DTE-JULIAN       TO TRUE.                       27930062
279400*                                                                 27940062
279500*    CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                27950062
279600*                                            DPG52                27960062
279700*                                            DPG53                27970062
279800*                                            DPG54                27980062
279900*                                            DPG55                27990062
280000*                                            DPG56.               28000062
280100*                                                                 28010062
280200*    MOVE DPG55-DB2-ISO-DATE-FMT  TO  PV-DB2-START-DATE.          28020062
280300*                                                                 28030062
280400*    INITIALIZE DPG51                                             28040062
280500*               DPG52                                             28050062
280600*               DPG53                                             28060062
280700*               DPG54                                             28070062
280800*               DPG55                                             28080062
280900*               DPG56.                                            28090062
281000*                                                                 28100062
281100*    MOVE PV-EIBDATE  TO  DPG52-LK-DATE-INPUT.                    28110062
281200*                                                                 28120062
281300*    SET DPG51-INCREMENT-DATE                                     28130062
281400*        DPG51-ACTUAL-CALENDAR-ONLY                               28140062
281500*        DPG52-LK-DTE-JULIAN       TO TRUE.                       28150062
281600*                                                                 28160062
281700*    MOVE COCNTL-DAYS-PR-CHG-NBR   TO  DPG51-INCR-DECR-DAYS-9.    28170062
281800*                                                                 28180062
281900*    CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                28190062
282000*                                            DPG52                28200062
282100*                                            DPG53                28210062
282200*                                            DPG54                28220062
282300*                                            DPG55                28230062
282400*                                            DPG56.               28240062
282500*                                                                 28250062
282600*    MOVE DPG55-DB2-ISO-DATE-FMT  TO  PV-DB2-END-DATE.            28260062
282700*                                                                 28270062
282800*                                                                 28280062
282900* -------------------------------------------------------------- *28290003
283000* -------------------------------------------------------------- *28300003
283100                                                                  28310003
283200 4100-SELECT-VND-STYL.                                            28320003
283300                                                                  28330003
283400     MOVE '4100-SELECT-VND-STYL' TO RC001-PARAGRAPH.              28340033
283500                                                                  28350003
283600     EXEC SQL                                                     28360003
283700                                                                  28370003
283800         SELECT  MAJ_CL_NBR                                       28380003
283900               , SUB_CL_NBR                                       28390003
284000                                                                  28400003
284100           INTO  :XLT00004-MAJ-CL-NBR                             28410003
284200               , :XLT00004-SUB-CL-NBR                             28420003
284300                                                                  28430003
284400           FROM XLT_VND_STYL                                      28440003
284500                                                                  28450003
284600         WHERE STYL_ID  =  :XL001-STYL-ID                         28460003
284700                                                                  28470003
284800     END-EXEC.                                                    28480003
284900                                                                  28490003
285000                                                                  28500003
285100     EVALUATE SQLCODE                                             28510003
285200                                                                  28520003
285300       WHEN +0                                                    28530003
285400           MOVE XLT00004-MAJ-CL-NBR                               28540003
285500             TO RC821-REC-CLASS    (RC821-ITEM-IDX)               28550013
285600                RC821-PO-CLASS     (RC821-ITEM-IDX)               28560013
285700                                                                  28570003
285800           MOVE XLT00004-SUB-CL-NBR                               28580003
285900             TO RC821-REC-SUBCLASS (RC821-ITEM-IDX)               28590013
286000                RC821-PO-SUBCLASS  (RC821-ITEM-IDX)               28600013
286100                                                                  28610003
286200       WHEN OTHER                                                 28620003
286300           MOVE SQLCA      TO TM500-SQLCA                         28630003
286400           MOVE SQLCODE    TO TM500-SQLCODE                       28640003
286500           MOVE SQLCODE    TO RC001-SAVE-SQLCODE                  28650003
286600           MOVE SPACES     TO TM501-TM500-RETURN-MSG              28660003
286700           MOVE '821'      TO TM501-PGM                           28670003
286800           MOVE '4100'     TO TM501-PARA                          28680004
286900           MOVE 'XLT_VND'  TO TM501-TBL                           28690003
287000           MOVE 31         TO TM501-PRORATION-ERROR-NBR           28700003
287100           PERFORM TM501-SET-TM500-RETURN-MSG                     28710003
287200           PERFORM RC001-RETURN-MSG                               28720003
287300                                                                  28730003
287400     END-EVALUATE.                                                28740003
287500                                                                  28750003
287600                                                                  28760003
287700* -------------------------------------------------------------- *28770003
287800* -------------------------------------------------------------- *28780003
287900                                                                  28790003
288000 4110-UPDATE-RECITM.                                              28800003
288100                                                                  28810003
288200     MOVE '4110-UPDATE-RECITM  ' TO RC001-PARAGRAPH.              28820033
288300                                                                  28830003
288400     EXEC SQL                                                     28840003
288500                                                                  28850003
288600         UPDATE TRECITM                                           28860003
288700                                                                  28870003
288800           SET PREPK_ODD_UNT_QTY = :RECITM-PREPK-ODD-UNT-QTY      28880003
288900                                                                  28890003
289000         WHERE ORD_NBR         =  :RC821-ORD-NBR                  28900013
289100           AND ORD_LNE_NBR     =  :RECITM-ORD-LNE-NBR             28910003
289200           AND REC_SEQ_NBR     =  :RC821-REC-SEQ-NBR              28920013
289300           AND OPER_UNT_ID     =  :RC821-OPER-UNT-ID              28930013
289400           AND FCLTY_ID        =  :RC821-FCLTY-ID                 28940013
289500           AND VER_STATUS_CDE  =  :PC-A                           28950003
289600                                                                  28960003
289700     END-EXEC.                                                    28970003
289800                                                                  28980003
289900                                                                  28990003
290000     EVALUATE SQLCODE                                             29000003
290100                                                                  29010003
290200       WHEN +0                                                    29020003
290300           CONTINUE                                               29030003
290400                                                                  29040003
290500       WHEN +100                                                  29050003
290600           SET PS-DONE-YES TO TRUE                                29060003
290700           MOVE RECITM-ORD-LNE-NBR   TO RC001-PO-LNE-NBR          29070003
290800           MOVE SQLCA                TO TM500-SQLCA               29080003
290900           MOVE SQLCODE              TO TM500-SQLCODE             29090003
291000           MOVE SQLCODE              TO RC001-SAVE-SQLCODE        29100003
291100           MOVE SPACES               TO TM501-TM500-RETURN-MSG    29110003
291200           MOVE '821'                TO TM501-PGM                 29120003
291300           MOVE '4110'               TO TM501-PARA                29130004
291400           MOVE 'TRECITM'            TO TM501-TBL                 29140003
291500           MOVE 32                   TO TM501-PRORATION-ERROR-NBR 29150003
291600           PERFORM TM501-SET-TM500-RETURN-MSG                     29160003
291700           PERFORM RC001-RETURN-MSG                               29170003
291800                                                                  29180003
291900       WHEN -904                                                  29190003
292000       WHEN -911                                                  29200003
292100       WHEN -913                                                  29210003
292200           SET PS-DONE-YES                                        29220003
292300               TM500-PREPACK-DB2-TIMEOUT TO TRUE                  29230003
292400           MOVE RC821-REC-DRV-LNE-NBR TO RC001-PO-LNE-NBR         29240013
292500           MOVE SQLCA                 TO TM500-SQLCA              29250003
292600           MOVE SQLCODE               TO TM500-SQLCODE            29260003
292700           MOVE SQLCODE               TO RC001-SAVE-SQLCODE       29270003
292800           MOVE SPACES                TO TM501-TM500-RETURN-MSG   29280003
292900           MOVE '821'                 TO TM501-PGM                29290003
293000           MOVE '4110'                TO TM501-PARA               29300003
293100           MOVE 'TRECITM'             TO TM501-TBL                29310003
293200           MOVE 33                    TO TM501-PRORATION-ERROR-NBR29320003
293300           PERFORM TM501-SET-TM500-RETURN-MSG                     29330003
293400           PERFORM RC001-RETURN-MSG                               29340003
293500                                                                  29350003
293600       WHEN OTHER                                                 29360003
293700           SET PS-DONE-YES TO TRUE                                29370003
293800           MOVE RECITM-ORD-LNE-NBR   TO RC001-PO-LNE-NBR          29380003
293900           MOVE SQLCA                TO TM500-SQLCA               29390003
294000           MOVE SQLCODE              TO TM500-SQLCODE             29400003
294100           MOVE SQLCODE              TO RC001-SAVE-SQLCODE        29410003
294200           MOVE SPACES               TO TM501-TM500-RETURN-MSG    29420003
294300           MOVE '821'                TO TM501-PGM                 29430003
294400           MOVE '4110'               TO TM501-PARA                29440004
294500           MOVE 'TRECITM'            TO TM501-TBL                 29450004
294600           MOVE 34                   TO TM501-PRORATION-ERROR-NBR 29460003
294700           PERFORM TM501-SET-TM500-RETURN-MSG                     29470003
294800           PERFORM RC001-RETURN-MSG                               29480003
294900                                                                  29490003
295000     END-EVALUATE.                                                29500003
295100                                                                  29510003
295200                                                                  29520003
295300* -------------------------------------------------------------- *29530003
295400*    WE CANNOT HAVE MORE THAN ONE DRIVER LINE PER PACK.  SOMETIMES29540003
295500*    A NEW DRIVER LINE WILL BE ASSIGNED IN ADDITION TO THE        29550003
295600*    EXISTING ONE. THIS PARAGRAPH WILL DETECT THOSE DIFFERENCES   29560003
295700*    AND FIX THEM.                                                29570003
295800* -------------------------------------------------------------- *29580003
295900                                                                  29590003
296000 4120-VERIFY-PACK.                                                29600003
296100                                                                  29610003
296200     MOVE '4120-VERIFY-PACK       ' TO RC001-PARAGRAPH.           29620033
296300                                                                  29630003
296400     INITIALIZE RC806-PRODUCT-PACK-VALIDATION.                    29640003
296500                                                                  29650003
296600     SET RC806-CALC-BEST-CASE TO TRUE.                            29660003
296700                                                                  29670003
296800     PERFORM 4130-LOAD-RC806-FROM-RC821                           29680013
296900       VARYING RC821-ITEM-IDX FROM 1 BY 1                         29690013
297000         UNTIL RC821-REC-LNE-NBR (RC821-ITEM-IDX) EQUAL ZERO      29700013
297100            OR RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT.             29710013
297200                                                                  29720003
297300     PERFORM 4170-VALIDATION-MODULE.                              29730003
297400                                                                  29740003
297500     SET PS-UPDATE-RECITM-NO                                      29750003
297600         PS-SAME-DRIVER-LINE-YES  TO TRUE                         29760003
297700                                                                  29770003
297800     IF RC806-NO-ERRORS                                           29780003
297900         PERFORM 4140-COMPARE-LINES                               29790003
298000           VARYING RC821-ITEM-IDX FROM 1 BY 1                     29800013
298100             UNTIL RC821-REC-LNE-NBR (RC821-ITEM-IDX) EQUAL ZERO  29810013
298200                OR RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT          29820013
298300         IF PS-UPDATE-RECITM-YES                                  29830049
298400             MOVE ZEROS TO RC821-TOTAL-ODD-UNITS                  29840049
298500             PERFORM                                              29850049
298600               VARYING RC821-ITEM-IDX FROM 1 BY 1                 29860049
298700                 UNTIL RC821-REC-LNE-NBR (RC821-ITEM-IDX) EQUAL 0 29870049
298800                   OR  RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT      29880049
298900                 ADD RC821-ODD-UNIT-QTY (RC821-ITEM-IDX)          29890049
299000                  TO RC821-TOTAL-ODD-UNITS                        29900049
299100             END-PERFORM                                          29910049
299200         END-IF                                                   29920049
299300     END-IF.                                                      29930049
299400                                                                  29940003
299500*    ---------------------------------------------                29950003
299600*    CLEAR OUT THE DRIVER LINE CODES FOR ALL LINES                29960003
299700*    IN THE PACK                                                  29970003
299800*    ---------------------------------------------                29980003
299900                                                                  29990003
300000     IF PS-SAME-DRIVER-LINE-NO                                    30000003
300100                                                                  30010003
300200         PERFORM 4150-REMOVE-RECITM-DRIVER-LINE                   30020003
300300         MOVE RC806-PKSL-LNE-NBR (RC806-DRIVER-LNE-SUB)           30030003
300400           TO RECITM-ORD-LNE-NBR                                  30040003
300500         PERFORM 4160-NEW-RECITM-DRIVER-LINE                      30050003
300600     END-IF.                                                      30060003
300700                                                                  30070003
300800     MOVE RC806-PKSL-LNE-NBR (RC806-DRIVER-LNE-SUB)               30080003
300900       TO RECITM-ORD-LNE-NBR.                                     30090003
301000                                                                  30100003
301100     SET RC821-ITEM-IDX TO RC806-DRIVER-LNE-SUB.                  30110013
301200                                                                  30120003
301300     MOVE RC821-BEST-CASE-UNITS (RC821-ITEM-IDX)                  30130013
301400       TO TM500-UNITS-TO-ALLOC.                                   30140003
301500                                                                  30150003
301600                                                                  30160003
301700*-----------------------------------------------------------------30170003
301800*-----------------------------------------------------------------30180003
301900                                                                  30190003
302000 4130-LOAD-RC806-FROM-RC821.                                      30200013
302100                                                                  30210003
302200     MOVE '4130-LOAD-RC806-FROM-RC821' TO RC001-PARAGRAPH.        30220033
302300                                                                  30230000
302400     ADD 1  TO RC806-NBR-OF-LINES.                                30240000
302500                                                                  30250000
302600     SET RC806-LINE-IDX TO RC821-ITEM-IDX.                        30260013
302700                                                                  30270000
302800     MOVE RC821-REC-LNE-NBR        (RC821-ITEM-IDX)               30280013
302900       TO RC806-PKSL-LNE-NBR       (RC806-LINE-IDX).              30290000
303000                                                                  30300000
303100     MOVE RC821-REC-INNER-PACK-QTY (RC821-ITEM-IDX)               30310013
303200       TO RC806-INNER-PACK-QTY.                                   30320000
303300                                                                  30330000
303400     MOVE RC821-REC-PACK-RATO-QTY  (RC821-ITEM-IDX)               30340013
303500       TO RC806-PO-RATIO           (RC806-LINE-IDX)               30350000
303600          RC806-RC-RATIO           (RC806-LINE-IDX).              30360000
303700                                                                  30370000
303800     IF RC821-DTL-CK-ITM-QTY (RC821-ITEM-IDX) > ZERO              30380013
303900         MOVE RC821-DTL-CK-ITM-QTY (RC821-ITEM-IDX)               30390013
304000           TO RC806-UNIT-QTY       (RC806-LINE-IDX)               30400000
304100              RC806-RCVG-QTY       (RC806-LINE-IDX)               30410000
304200     ELSE                                                         30420000
304300         MOVE RC821-PKSL-ITM-QTY   (RC821-ITEM-IDX)               30430013
304400           TO RC806-UNIT-QTY       (RC806-LINE-IDX)               30440000
304500              RC806-RCVG-QTY       (RC806-LINE-IDX)               30450000
304600     END-IF.                                                      30460000
304700                                                                  30470000
304800                                                                  30480000
304900*-----------------------------------------------------------------30490000
305000*-----------------------------------------------------------------30500000
305100                                                                  30510000
305200 4140-COMPARE-LINES.                                              30520000
305300                                                                  30530000
305400     MOVE '4140-COMPARE-LINES        ' TO RC001-PARAGRAPH.        30540033
305500                                                                  30550003
305600     SET PS-UPDATE-RECITM-NO  TO TRUE.                            30560003
305700                                                                  30570003
305800     SET RC806-LINE-IDX       TO RC821-ITEM-IDX.                  30580013
305900                                                                  30590003
306000     IF RC821-BEST-CASE-UNITS (RC821-ITEM-IDX) NOT EQUAL          30600013
306100        RC806-BEST-CASE-UNITS (RC806-LINE-IDX)                    30610003
306200         MOVE RC806-BEST-CASE-UNITS (RC806-LINE-IDX)              30620003
306300           TO RC821-BEST-CASE-UNITS (RC821-ITEM-IDX)              30630013
306400     END-IF                                                       30640003
306500                                                                  30650003
306600     IF RC821-ODD-UNIT-QTY (RC821-ITEM-IDX) NOT EQUAL             30660013
306700        RC806-ODD-UNITS    (RC806-LINE-IDX)                       30670003
306800         MOVE RC806-ODD-UNITS    (RC806-LINE-IDX)                 30680003
306900           TO RC821-ODD-UNIT-QTY (RC821-ITEM-IDX)                 30690013
307000         SET PS-UPDATE-RECITM-YES TO TRUE                         30700003
307100     END-IF                                                       30710003
307200                                                                  30720003
307300     IF RC821-DRV-LNE-CDE (RC821-ITEM-IDX) EQUAL PC-A             30730013
307400         IF RC821-ITEM-IDX EQUAL RC806-DRIVER-LNE-SUB             30740013
307500*            ----------------------                               30750003
307600*            DRIVER LINE IS CORRECT                               30760003
307700*            ----------------------                               30770003
307800             MOVE RC821-BEST-CASE-UNITS (RC821-ITEM-IDX)          30780013
307900               TO TM500-UNITS-TO-ALLOC                            30790003
308000         ELSE                                                     30800003
308100*            ---------------------------------------------------  30810003
308200*            THERE CAN ONLY BE ONE DRIVER LINE AND THIS ISN'T IT  30820003
308300*            ---------------------------------------------------  30830003
308400             SET PS-SAME-DRIVER-LINE-NO TO TRUE                   30840061
308500         END-IF                                                   30850003
308600     ELSE                                                         30860003
308700         IF RC821-ITEM-IDX EQUAL RC806-DRIVER-LNE-SUB             30870013
308800*            -------------------------------                      30880003
308900*            THE DRIVER IS ON THE WRONG LINE                      30890003
309000*            -------------------------------                      30900003
309100             SET PS-SAME-DRIVER-LINE-NO TO TRUE                   30910061
309200         END-IF                                                   30920003
309300     END-IF                                                       30930003
309400                                                                  30940003
309500     IF PS-UPDATE-RECITM-YES                                      30950003
309600         MOVE RC821-REC-LNE-NBR  (RC821-ITEM-IDX)                 30960013
309700           TO RECITM-ORD-LNE-NBR                                  30970003
309800                                                                  30980003
309900         MOVE RC821-ODD-UNIT-QTY (RC821-ITEM-IDX)                 30990013
310000           TO RECITM-PREPK-ODD-UNT-QTY                            31000003
310100                                                                  31010003
310200         PERFORM 4110-UPDATE-RECITM                               31020003
310300     END-IF.                                                      31030003
310400                                                                  31040003
310500                                                                  31050003
310600*-----------------------------------------------------------------31060003
310700*-----------------------------------------------------------------31070003
310800                                                                  31080003
310900 4150-REMOVE-RECITM-DRIVER-LINE.                                  31090003
311000                                                                  31100003
311100     MOVE '4150-REMOVE-RECITM-DRIVER-LINE ' TO RC001-PARAGRAPH.   31110033
311200                                                                  31120003
311300     EXEC SQL                                                     31130003
311400                                                                  31140003
311500         UPDATE TRECITM                                           31150003
311600                                                                  31160003
311700           SET PREPK_DRV_LNE_CDE = :PC-SPACE                      31170003
311800                                                                  31180003
311900         WHERE ORD_NBR         =  :RC821-ORD-NBR                  31190013
312000           AND REC_SEQ_NBR     =  :RC821-REC-SEQ-NBR              31200013
312100           AND OPER_UNT_ID     =  :RC821-OPER-UNT-ID              31210013
312200           AND FCLTY_ID        =  :RC821-FCLTY-ID                 31220013
312300           AND PREPK_ID        =  :RC821-PREPK-ID                 31230013
312400           AND VER_STATUS_CDE  =  :PC-A                           31240003
312500                                                                  31250003
312600     END-EXEC.                                                    31260003
312700                                                                  31270003
312800     EVALUATE SQLCODE                                             31280003
312900                                                                  31290003
313000       WHEN +0                                                    31300003
313100           CONTINUE                                               31310003
313200                                                                  31320003
313300       WHEN +100                                                  31330003
313400           SET PS-DONE-YES TO TRUE                                31340003
313500           MOVE RECITM-ORD-LNE-NBR   TO RC001-PO-LNE-NBR          31350003
313600           MOVE SQLCA                TO TM500-SQLCA               31360003
313700           MOVE SQLCODE              TO TM500-SQLCODE             31370003
313800           MOVE SQLCODE              TO RC001-SAVE-SQLCODE        31380003
313900           MOVE SPACES               TO TM501-TM500-RETURN-MSG    31390003
314000           MOVE '821'                TO TM501-PGM                 31400003
314100           MOVE '4150'               TO TM501-PARA                31410003
314200           MOVE 'TRECITM'            TO TM501-TBL                 31420003
314300           MOVE 35                   TO TM501-PRORATION-ERROR-NBR 31430003
314400           PERFORM TM501-SET-TM500-RETURN-MSG                     31440003
314500           PERFORM RC001-RETURN-MSG                               31450003
314600                                                                  31460003
314700       WHEN -904                                                  31470003
314800       WHEN -911                                                  31480003
314900       WHEN -913                                                  31490003
315000           SET PS-DONE-YES                                        31500003
315100               TM500-PREPACK-DB2-TIMEOUT TO TRUE                  31510003
315200           MOVE RC821-REC-DRV-LNE-NBR TO RC001-PO-LNE-NBR         31520013
315300           MOVE SQLCA                TO TM500-SQLCA               31530003
315400           MOVE SQLCODE              TO TM500-SQLCODE             31540003
315500           MOVE SQLCODE               TO RC001-SAVE-SQLCODE       31550003
315600           MOVE SPACES                TO TM501-TM500-RETURN-MSG   31560003
315700           MOVE '821'                 TO TM501-PGM                31570003
315800           MOVE '4150'                TO TM501-PARA               31580003
315900           MOVE 'TRECITM'             TO TM501-TBL                31590003
316000           MOVE 36                    TO TM501-PRORATION-ERROR-NBR31600003
316100           PERFORM TM501-SET-TM500-RETURN-MSG                     31610003
316200           PERFORM RC001-RETURN-MSG                               31620003
316300                                                                  31630003
316400       WHEN OTHER                                                 31640003
316500           SET PS-DONE-YES  TO TRUE                               31650003
316600           MOVE RECITM-ORD-LNE-NBR   TO RC001-PO-LNE-NBR          31660003
316700           MOVE SQLCA                TO TM500-SQLCA               31670003
316800           MOVE SQLCODE              TO TM500-SQLCODE             31680003
316900           MOVE SQLCODE              TO RC001-SAVE-SQLCODE        31690003
317000           MOVE SPACES               TO TM501-TM500-RETURN-MSG    31700003
317100           MOVE '821'                TO TM501-PGM                 31710004
317200           MOVE '4150'               TO TM501-PARA                31720003
317300           MOVE 'TRECITM'            TO TM501-TBL                 31730003
317400           MOVE 37                   TO TM501-PRORATION-ERROR-NBR 31740003
317500           PERFORM TM501-SET-TM500-RETURN-MSG                     31750003
317600           PERFORM RC001-RETURN-MSG                               31760003
317700                                                                  31770003
317800     END-EVALUATE.                                                31780003
317900                                                                  31790003
318000                                                                  31800003
318100*-----------------------------------------------------------------31810003
318200*-----------------------------------------------------------------31820003
318300                                                                  31830003
318400 4160-NEW-RECITM-DRIVER-LINE.                                     31840003
318500                                                                  31850003
318600     MOVE '4160-NEW-RECITM-DRIVER-LINE ' TO RC001-PARAGRAPH.      31860033
318700                                                                  31870003
318800     EXEC SQL                                                     31880003
318900                                                                  31890003
319000         UPDATE TRECITM                                           31900003
319100                                                                  31910003
319200           SET PREPK_DRV_LNE_CDE = :PC-A                          31920003
319300                                                                  31930003
319400         WHERE ORD_NBR         =  :RC821-ORD-NBR                  31940013
319500           AND ORD_LNE_NBR     =  :RECITM-ORD-LNE-NBR             31950003
319600           AND REC_SEQ_NBR     =  :RC821-REC-SEQ-NBR              31960013
319700           AND OPER_UNT_ID     =  :RC821-OPER-UNT-ID              31970013
319800           AND FCLTY_ID        =  :RC821-FCLTY-ID                 31980013
319900           AND PREPK_ID        =  :RC821-PREPK-ID                 31990013
320000           AND VER_STATUS_CDE  =  :PC-A                           32000003
320100                                                                  32010003
320200     END-EXEC.                                                    32020003
320300                                                                  32030003
320400     EVALUATE SQLCODE                                             32040003
320500                                                                  32050003
320600       WHEN +0                                                    32060003
320700           IF PS-PREPACK  AND  RC821-PREPK-ID > 0                 32070043
320800               MOVE RECITM-ORD-LNE-NBR TO RC821-REC-DRV-LNE-NBR   32080013
320900                                          TM500-PO-LNE-NBR        32090044
321000           END-IF                                                 32100003
321100                                                                  32110003
321200       WHEN +100                                                  32120003
321300           SET PS-DONE-YES  TO TRUE                               32130003
321400           MOVE RECITM-ORD-LNE-NBR   TO RC001-PO-LNE-NBR          32140003
321500           MOVE SQLCODE              TO RC001-SAVE-SQLCODE        32150003
321600           MOVE SQLCA                TO TM500-SQLCA               32160003
321700           MOVE SQLCODE              TO TM500-SQLCODE             32170003
321800           MOVE SPACES               TO TM501-TM500-RETURN-MSG    32180003
321900           MOVE '821'                TO TM501-PGM                 32190004
322000           MOVE '4160'               TO TM501-PARA                32200003
322100           MOVE 'TRECITM'            TO TM501-TBL                 32210003
322200           MOVE 38                   TO TM501-PRORATION-ERROR-NBR 32220003
322300           PERFORM TM501-SET-TM500-RETURN-MSG                     32230003
322400           PERFORM RC001-RETURN-MSG                               32240003
322500                                                                  32250003
322600       WHEN -904                                                  32260003
322700       WHEN -911                                                  32270003
322800       WHEN -913                                                  32280003
322900           SET PS-DONE-YES                                        32290003
323000               TM500-PREPACK-DB2-TIMEOUT TO TRUE                  32300003
323100           MOVE RC821-REC-DRV-LNE-NBR TO RC001-PO-LNE-NBR         32310013
323200           MOVE SQLCA                 TO TM500-SQLCA              32320003
323300           MOVE SQLCODE               TO TM500-SQLCODE            32330003
323400           MOVE SQLCODE               TO RC001-SAVE-SQLCODE       32340003
323500           MOVE SPACES                TO TM501-TM500-RETURN-MSG   32350003
323600           MOVE '821'                 TO TM501-PGM                32360003
323700           MOVE '4160'                TO TM501-PARA               32370003
323800           MOVE 'TRECITM'             TO TM501-TBL                32380003
323900           MOVE 39                    TO TM501-PRORATION-ERROR-NBR32390003
324000           PERFORM TM501-SET-TM500-RETURN-MSG                     32400003
324100           PERFORM RC001-RETURN-MSG                               32410003
324200                                                                  32420003
324300       WHEN OTHER                                                 32430003
324400           SET PS-DONE-YES  TO TRUE                               32440003
324500           MOVE RECITM-ORD-LNE-NBR TO RC001-PO-LNE-NBR            32450003
324600           MOVE SQLCA              TO TM500-SQLCA                 32460003
324700           MOVE SQLCODE            TO TM500-SQLCODE               32470003
324800           MOVE SQLCODE            TO RC001-SAVE-SQLCODE          32480003
324900           MOVE SPACES             TO TM501-TM500-RETURN-MSG      32490003
325000           MOVE '821'              TO TM501-PGM                   32500003
325100           MOVE '4160'             TO TM501-PARA                  32510003
325200           MOVE 'TRECITM'          TO TM501-TBL                   32520003
325300           MOVE 40                 TO TM501-PRORATION-ERROR-NBR   32530003
325400           PERFORM TM501-SET-TM500-RETURN-MSG                     32540003
325500           PERFORM RC001-RETURN-MSG                               32550003
325600                                                                  32560003
325700     END-EVALUATE.                                                32570003
325800                                                                  32580003
325900                                                                  32590003
326000*-----------------------------------------------------------------32600003
326100*-----------------------------------------------------------------32610003
326200                                                                  32620003
326300 4170-VALIDATION-MODULE.                                          32630003
326400                                                                  32640003
326500     MOVE '4170-VALIDATION-MODULE ' TO RC001-PARAGRAPH.           32650033
326600                                                                  32660003
326700     EXEC CICS LINK                                               32670003
326800         PROGRAM  (PC-RCKCS806)                                   32680003
326900         COMMAREA (RC806-PRODUCT-PACK-VALIDATION)                 32690003
327000         RESP     (PV-CICS-RESP)                                  32700003
327100     END-EXEC.                                                    32710003
327200                                                                  32720003
327300                                                                  32730003
327400*    ----------------------                                       32740003
327500*    CHECK CICS RETURN CODE                                       32750003
327600*    ----------------------                                       32760003
327700                                                                  32770003
327800     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    32780003
327900         SET PS-DONE-YES TO TRUE                                  32790003
328000         MOVE SPACES TO TM501-TM500-RETURN-MSG                    32800003
328100         MOVE '821'  TO TM501-PGM                                 32810003
328200         MOVE '4170' TO TM501-PARA                                32820004
328300         MOVE 93     TO TM501-PRORATION-ERROR-NBR                 32830003
328400         PERFORM TM501-SET-TM500-RETURN-MSG                       32840003
328500         PERFORM RC001-RETURN-MSG                                 32850003
328600     END-IF.                                                      32860003
328700                                                                  32870003
328800                                                                  32880003
328900* -------------------------------------------------------------- *32890003
329000*    BUILD THE TEMP QUEUE COMPONENTS                              32900003
329100* -------------------------------------------------------------- *32910003
329200                                                                  32920003
329300* -------------------------------------------------------------- *32930003
329400*    BUILD THE RECEIVER QUEUE COMPONENT                           32940003
329500* -------------------------------------------------------------- *32950003
329600                                                                  32960003
329700 4300-BUILD-821-TEMP-QUEUES.                                      32970017
329800                                                                  32980003
329900     MOVE '4300-BUILD-821-TEMP-QUEUES' TO RC001-PARAGRAPH.        32990033
330000                                                                  33000003
330100     MOVE RC823-RECEIVER-QUEUE-NAME TO PV-QUEUE-NAME.             33010016
330200                                                                  33020003
330300     PERFORM 8100-WRITE-TEMP-RECEIVER-QUEUE.                      33030003
330400                                                                  33040003
330500                                                                  33050003
330600* -------------------------------------------------------------- *33060003
330700*    BUILD THE STORE QUEUE COMPONENT                              33070003
330800* -------------------------------------------------------------- *33080003
330900                                                                  33090003
331000     MOVE RC823-STORE-QUEUE-NAME TO PV-QUEUE-NAME.                33100016
331100                                                                  33110003
331200     PERFORM 8110-WRITE-TEMP-STORE-QUEUE.                         33120003
331300                                                                  33130003
331400                                                                  33140003
331500* -------------------------------------------------------------- *33150003
331600*    BUILD THE ITEM QUEUE COMPONENT                               33160003
331700* -------------------------------------------------------------- *33170003
331800                                                                  33180003
331900     INITIALIZE PV-ITEM.                                          33190003
332000                                                                  33200003
332100     MOVE RC823-ITEM-QUEUE-NAME TO PV-QUEUE-NAME.                 33210016
332200                                                                  33220003
332300     PERFORM 8120-WRITE-TEMP-ITEM-QUEUE                           33230003
332400       VARYING PV-ITEM FROM 1 BY 1                                33240003
332500         UNTIL (RC821-PO-ITEM-NBR  (PV-ITEM) EQUAL ZERO           33250013
332600           AND  RC821-REC-ITEM-NBR (PV-ITEM) EQUAL ZERO)          33260013
332700            OR PV-ITEM > RC821-MAX-ITEM-COUNT.                    33270013
332800                                                                  33280003
332900     MOVE PV-ITEM TO RC823-ITEM-QUEUE-COUNT.                      33290016
333000                                                                  33300024
333100     MOVE PV-ITEM TO RC824-ITEM-QUEUE-COUNT.                      33310020
333200                                                                  33320003
333300                                                                  33330003
333400                                                                  33340003
333500* -------------------------------------------------------------- *33350003
333600*    STORE / LINE OTR REQUEST PROCESSING.                         33360003
333700* -------------------------------------------------------------- *33370003
333800                                                                  33380003
333900 5000-CALL-OTR.                                                   33390003
334000                                                                  33400003
334100     MOVE '5000-CALL-OTR  ' TO RC001-PARAGRAPH.                   33410033
334200                                                                  33420003
334300     INITIALIZE RC822-COMMAREA.                                   33430014
334400                                                                  33440003
334500     PERFORM 5060-SETUP-RC822-COMMAREA.                           33450014
334600                                                                  33460003
334700     PERFORM                                                      33470003
334800       VARYING RC821-ITEM-IDX FROM 1 BY 1                         33480013
334900         UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              33490013
335000          OR   RC821-PO-LNE-NBR (RC821-ITEM-IDX) EQUAL ZERO       33500013
335100                                                                  33510003
335200         SET  RC822-PACK-IDX TO RC821-ITEM-IDX                    33520014
335300                                                                  33530003
335400         MOVE RC821-PO-LNE-NBR       (RC821-ITEM-IDX)             33540013
335500           TO RC822-PO-LINE-NBR      (RC822-PACK-IDX)             33550014
335600                                                                  33560003
335700         MOVE RC821-PO-SKU-NBR       (RC821-ITEM-IDX)             33570013
335800           TO RC822-PO-SKU-NBR       (RC822-PACK-IDX)             33580014
335900                                                                  33590003
336000         MOVE RC821-PO-PACK-RATO-QTY (RC821-ITEM-IDX)             33600013
336100           TO RC822-PO-PACK-RATO-QTY (RC822-PACK-IDX)             33610014
336200     END-PERFORM.                                                 33620003
336300                                                                  33630003
336400     EXEC SQL                                                     33640003
336500                                                                  33650003
336600         SELECT MAX(PRCG_NBR)                                     33660003
336700                                                                  33670003
336800           INTO :RCT00011-PRCG-NBR                                33680003
336900                                                                  33690003
337000         FROM RCT_PRCG_CNTL                                       33700003
337100                                                                  33710003
337200         WHERE CURRENT TIMESTAMP >= PRCG_BEG_TMST                 33720003
337300           AND CURRENT TIMESTAMP <= PRCG_END_TMST                 33730003
337400                                                                  33740003
337500     END-EXEC.                                                    33750003
337600                                                                  33760003
337700     EVALUATE SQLCODE                                             33770003
337800                                                                  33780003
337900       WHEN +0                                                    33790003
338000           CONTINUE                                               33800003
338100                                                                  33810003
338200       WHEN OTHER                                                 33820003
338300           MOVE +0 TO RCT00011-PRCG-NBR                           33830003
338400                                                                  33840003
338500     END-EVALUATE.                                                33850003
338600                                                                  33860003
338700                                                                  33870003
338800     SET RC822-STORE-LEVEL-OTR TO TRUE.                           33880014
338900                                                                  33890003
339000                                                                  33900003
339100     EXEC CICS                                                    33910003
339200         LINK PROGRAM  (PC-RCKCS822)                              33920003
339300              COMMAREA (RC822-COMMAREA)                           33930014
339400              RESP     (PV-CICS-RESP)                             33940003
339500     END-EXEC.                                                    33950003
339600                                                                  33960003
339700*    ----------------------                                       33970003
339800*    CHECK CICS RETURN CODE                                       33980003
339900*    ----------------------                                       33990003
340000                                                                  34000003
340100     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    34010003
340200         SET PS-DONE-YES TO TRUE                                  34020003
340300         MOVE SPACES TO TM501-TM500-RETURN-MSG                    34030003
340400         MOVE '821'  TO TM501-PGM                                 34040003
340500         MOVE '5000' TO TM501-PARA                                34050004
340600         MOVE 41     TO TM501-PRORATION-ERROR-NBR                 34060003
340700         PERFORM TM501-SET-TM500-RETURN-MSG                       34070003
340800         PERFORM RC001-RETURN-MSG                                 34080003
340900     END-IF.                                                      34090003
341000                                                                  34100003
341100                                                                  34110003
341200     EVALUATE TRUE                                                34120003
341300                                                                  34130003
341400       WHEN RC822-RETURN-CODE = ZEROS                             34140014
341500           CONTINUE                                               34150003
341600                                                                  34160003
341700       WHEN OTHER                                                 34170003
341800                                                                  34180003
341900           EVALUATE TRUE                                          34190003
342000                                                                  34200003
342100             WHEN RC822-SOFT-ABORT                                34210014
342200                 SET PS-DONE-YES TO TRUE                          34220003
342300                 MOVE RC822-APP-PO-LNE-NBR TO RC001-PO-LNE-NBR    34230014
342400                 MOVE SPACES TO TM501-TM500-RETURN-MSG            34240003
342500                 MOVE '821'  TO TM501-PGM                         34250003
342600                 MOVE '5000' TO TM501-PARA                        34260004
342700                 MOVE 42     TO TM501-PRORATION-ERROR-NBR         34270003
342800                 PERFORM TM501-SET-TM500-RETURN-MSG               34280003
342900                 PERFORM RC001-RETURN-MSG                         34290003
343000                                                                  34300003
343100             WHEN RC822-NO-DISTRO                                 34310014
343200                 CONTINUE                                         34320003
343300                                                                  34330003
343400             WHEN OTHER                                           34340003
343500                 SET PS-DONE-YES TO TRUE                          34350003
343600                 MOVE RC822-APP-PO-LNE-NBR TO RC001-PO-LNE-NBR    34360014
343700                 MOVE SPACES TO TM501-TM500-RETURN-MSG            34370003
343800                 MOVE '821'  TO TM501-PGM                         34380003
343900                 MOVE '5000' TO TM501-PARA                        34390004
344000                 MOVE 43     TO TM501-PRORATION-ERROR-NBR         34400003
344100                 PERFORM TM501-SET-TM500-RETURN-MSG               34410003
344200                 PERFORM RC001-RETURN-MSG                         34420003
344300                                                                  34430003
344400           END-EVALUATE                                           34440003
344500                                                                  34450003
344600     END-EVALUATE.                                                34460003
344700                                                                  34470003
344800     PERFORM 5010-MOVE-RC822-STORE-DATA.                          34480014
344900                                                                  34490003
345000     IF RC822-INVALID-DISTRO                                      34500014
345100         MOVE PC-N TO RC821-VALID-DISTRO-IND                      34510013
345200     END-IF.                                                      34520003
345300                                                                  34530003
345400                                                                  34540003
345500*    ---------------------------                                  34550003
345600*    LINE OTR REQUEST PROCESSING                                  34560003
345700*    ---------------------------                                  34570003
345800                                                                  34580003
345900     PERFORM 5060-SETUP-RC822-COMMAREA.                           34590014
346000                                                                  34600003
346100     SET RC822-LINE-LEVEL-OTR TO TRUE.                            34610014
346200                                                                  34620003
346300     EXEC CICS                                                    34630003
346400         LINK PROGRAM  (PC-RCKCS822)                              34640003
346500              COMMAREA (RC822-COMMAREA)                           34650014
346600              RESP     (PV-CICS-RESP)                             34660003
346700     END-EXEC.                                                    34670003
346800                                                                  34680003
346900                                                                  34690003
347000*    ----------------------                                       34700003
347100*    CHECK CICS RETURN CODE                                       34710003
347200*    ----------------------                                       34720003
347300                                                                  34730003
347400     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    34740003
347500         SET PS-DONE-YES TO TRUE                                  34750003
347600         MOVE SPACES TO TM501-TM500-RETURN-MSG                    34760003
347700         MOVE '821'  TO TM501-PGM                                 34770003
347800         MOVE '5000' TO TM501-PARA                                34780004
347900         MOVE 44     TO TM501-PRORATION-ERROR-NBR                 34790003
348000         PERFORM TM501-SET-TM500-RETURN-MSG                       34800003
348100         PERFORM RC001-RETURN-MSG                                 34810003
348200     END-IF.                                                      34820003
348300                                                                  34830003
348400                                                                  34840003
348500     EVALUATE TRUE                                                34850003
348600                                                                  34860003
348700       WHEN RC822-RETURN-CODE = ZEROS                             34870014
348800           CONTINUE                                               34880003
348900                                                                  34890003
349000       WHEN OTHER                                                 34900003
349100                                                                  34910003
349200           EVALUATE TRUE                                          34920003
349300                                                                  34930003
349400             WHEN RC822-SOFT-ABORT                                34940014
349500                 SET PS-DONE-YES TO TRUE                          34950003
349600                 MOVE RC822-APP-PO-LNE-NBR TO RC001-PO-LNE-NBR    34960014
349700                 MOVE SPACES TO TM501-TM500-RETURN-MSG            34970003
349800                 MOVE '821'  TO TM501-PGM                         34980003
349900                 MOVE '5000' TO TM501-PARA                        34990004
350000                 MOVE 45     TO TM501-PRORATION-ERROR-NBR         35000003
350100                 PERFORM TM501-SET-TM500-RETURN-MSG               35010003
350200                 PERFORM RC001-RETURN-MSG                         35020003
350300                                                                  35030003
350400             WHEN RC822-NO-DISTRO                                 35040014
350500                 CONTINUE                                         35050003
350600                                                                  35060003
350700             WHEN OTHER                                           35070003
350800                 SET PS-DONE-YES TO TRUE                          35080003
350900                 MOVE RC822-APP-PO-LNE-NBR TO RC001-PO-LNE-NBR    35090014
351000                 MOVE SPACES TO TM501-TM500-RETURN-MSG            35100003
351100                 MOVE '821'  TO TM501-PGM                         35110003
351200                 MOVE '5000' TO TM501-PARA                        35120004
351300                 MOVE 46     TO TM501-PRORATION-ERROR-NBR         35130003
351400                 PERFORM TM501-SET-TM500-RETURN-MSG               35140003
351500                 PERFORM RC001-RETURN-MSG                         35150003
351600                                                                  35160003
351700           END-EVALUATE                                           35170003
351800                                                                  35180003
351900     END-EVALUATE.                                                35190003
352000                                                                  35200003
352100     PERFORM 5020-MOVE-RC822-LINE-DATA.                           35210014
352200                                                                  35220003
352300     IF RC822-INVALID-DISTRO                                      35230014
352400         MOVE PC-N TO RC821-VALID-DISTRO-IND                      35240013
352500     END-IF.                                                      35250003
352600                                                                  35260003
352700                                                                  35270003
352800* -------------------------------------------------------------- *35280003
352900* -------------------------------------------------------------- *35290003
353000                                                                  35300003
353100 5010-MOVE-RC822-STORE-DATA.                                      35310014
353200                                                                  35320003
353300     MOVE '5010-MOVE-RC822-STORE-DATA' TO RC001-PARAGRAPH.        35330033
353400                                                                  35340003
353500     MOVE RC822-PLAN-NBR          TO RC821-PLAN-NBR.              35350014
353600     MOVE RC822-CURR-SPLIT-QTY    TO RC821-CURR-SPLIT-QTY.        35360014
353700     MOVE RC822-PK-SIZE-RND-CDE   TO RC821-PK-SIZE-RND-CDE.       35370014
353800     MOVE RC822-ALLOC-OUTR-PK-QTY TO RC821-ALLOC-OUTR-PK-QTY.     35380014
353900     MOVE RC822-OVER-PRORATE-CDE  TO RC821-OVER-PRORATE-CDE.      35390014
354000     MOVE RC822-SHORT-PRORATE-CDE TO RC821-SHORT-PRORATE-CDE.     35400014
354100     MOVE RC822-USE-EX-RULES-IND  TO RC821-SHORT-USE-EX-RULES-IND.35410014
354200     MOVE RC822-SUM-STR-OTR-QTY   TO RC821-SUM-STR-DISTRO-OTR-QTY 35420014
354300                                     RC821-SUM-STR-OTR-QTY        35430013
354400     MOVE RC822-SUM-STR-PLAN-QTY  TO RC821-SUM-STR-PLAN-QTY.      35440014
354500     MOVE RC822-SUM-STR-PLAN-PK   TO RC821-SUM-STR-PLAN-PK.       35450014
354600                                                                  35460003
354700     IF RC822-SUM-STR-OTR-QTY < 0                                 35470014
354800         MOVE ZEROS TO RC821-SUM-STR-OTR-QTY                      35480013
354900     END-IF.                                                      35490003
355000                                                                  35500003
355100     IF PS-PREPACK  AND  RC821-PREPK-ID > 0                       35510043
355200         MOVE RC822-SUM-STR-OTR-PK TO RC821-SUM-STR-DISTRO-OTR-PK 35520014
355300     END-IF.                                                      35530003
355400                                                                  35540003
355500     IF RC822-SUM-STR-OTR-PK < 0                                  35550014
355600         MOVE ZEROS TO RC821-SUM-STR-OTR-PK                       35560013
355700     ELSE                                                         35570003
355800         MOVE RC822-SUM-STR-OTR-PK TO RC821-SUM-STR-OTR-PK        35580014
355900     END-IF.                                                      35590003
356000                                                                  35600003
356100     MOVE PC-M TO RC821-OVER-SHORT-CDE.                           35610013
356200                                                                  35620003
356300     IF RC821-SUM-STR-OTR-QTY > TM500-UNITS-TO-ALLOC              35630013
356400         MOVE PC-S TO RC821-OVER-SHORT-CDE                        35640013
356500     ELSE                                                         35650003
356600         IF RC821-SUM-STR-OTR-QTY < TM500-UNITS-TO-ALLOC          35660013
356700             MOVE PC-O TO RC821-OVER-SHORT-CDE                    35670013
356800         END-IF.                                                  35680003
356900                                                                  35690003
357000     PERFORM                                                      35700003
357100       VARYING RC822-STORE-IDX FROM 1 BY 1                        35710014
357200         UNTIL RC822-STORE-NBR (RC822-STORE-IDX) EQUAL ZERO       35720014
357300           OR  RC822-STORE-IDX > RC821-MAX-STR-COUNT              35730014
357400                                                                  35740003
357500         SET  RC821-STORE-IDX TO RC822-STORE-IDX                  35750014
357600                                                                  35760003
357700         PERFORM 5030-GET-STORE-INFO                              35770003
357800                                                                  35780003
357900         MOVE RC822-STORE-NBR            (RC822-STORE-IDX)        35790014
358000           TO RC821-STR-NBR              (RC821-STORE-IDX)        35800013
358100                                                                  35810003
358200         MOVE RC821-REC-DRV-LNE-NBR                               35820013
358300           TO RC821-ALLOC-LNE-NBR        (RC821-STORE-IDX)        35830013
358400                                                                  35840003
358500         MOVE RC822-STORE-DISTRO-QTY     (RC822-STORE-IDX)        35850014
358600           TO RC821-STR-DISTRO-QTY       (RC821-STORE-IDX)        35860013
358700                                                                  35870003
358800         MOVE RC822-STORE-DISTRO-QTY-X   (RC822-STORE-IDX)        35880014
358900           TO RC821-STR-DISTRO-QTY-X     (RC821-STORE-IDX)        35890013
359000                                                                  35900003
359100         MOVE RC822-STORE-DISTRO-PK      (RC822-STORE-IDX)        35910014
359200           TO RC821-STR-DISTRO-PK        (RC821-STORE-IDX)        35920013
359300                                                                  35930003
359400         MOVE RC822-STORE-DISTRO-OTR-PK  (RC822-STORE-IDX)        35940014
359500           TO RC821-STR-DISTRO-OTR-PK    (RC821-STORE-IDX)        35950013
359600                                                                  35960003
359700         MOVE RC822-STORE-DISTRO-OTR     (RC822-STORE-IDX)        35970014
359800           TO RC821-STR-DISTRO-OTR-QTY   (RC821-STORE-IDX)        35980013
359900                                                                  35990003
360000         MOVE RC822-STORE-DISTRO-OTR-X   (RC822-STORE-IDX)        36000014
360100           TO RC821-STR-DISTRO-OTR-QTY-X (RC821-STORE-IDX)        36010013
360200                                                                  36020003
360300         MOVE RC822-STORE-OTR-QTY        (RC822-STORE-IDX)        36030014
360400           TO RC821-STR-OTR-QTY          (RC821-STORE-IDX)        36040013
360500                                                                  36050003
360600         MOVE RC822-STORE-OTR-QTY-X      (RC822-STORE-IDX)        36060014
360700           TO RC821-STR-OTR-QTY-X        (RC821-STORE-IDX)        36070013
360800                                                                  36080003
360900         MOVE RC822-STORE-OTR-PK         (RC822-STORE-IDX)        36090014
361000           TO RC821-STR-OTR-PK           (RC821-STORE-IDX)        36100013
361100                                                                  36110003
361200         IF RC822-STORE-RNK-SEQ-NBR (RC822-STORE-IDX) > 0  OR     36120014
361300            RCT00011-PRCG-NBR = 0                                 36130003
361400             MOVE RC822-STORE-RNK-SEQ-NBR (RC822-STORE-IDX)       36140014
361500               TO RC821-RNK-SEQ-NBR       (RC821-STORE-IDX)       36150013
361600         ELSE                                                     36160003
361700             PERFORM 5070-RETREIVE-RANKING-DATA                   36170003
361800             MOVE PV-RANK-SEQ-NBR                                 36180003
361900               TO RC821-RNK-SEQ-NBR (RC821-STORE-IDX)             36190013
362000         END-IF                                                   36200003
362100                                                                  36210003
362200         ADD 1 TO RC821-STR-COUNT                                 36220013
362300                                                                  36230003
362400     END-PERFORM.                                                 36240003
362500                                                                  36250003
362600                                                                  36260003
362700* -------------------------------------------------------------- *36270003
362800* -------------------------------------------------------------- *36280003
362900                                                                  36290003
363000 5020-MOVE-RC822-LINE-DATA.                                       36300014
363100                                                                  36310003
363200     MOVE '5020-MOVE-RC822-LINE-DATA' TO RC001-PARAGRAPH.         36320033
363300                                                                  36330003
363400     PERFORM                                                      36340003
363500       VARYING RC822-ITEM-IDX FROM 1 BY 1                         36350014
363600         UNTIL RC822-LINE-NBR (RC822-ITEM-IDX) EQUAL ZERO         36360014
363700           OR  RC822-ITEM-IDX > RC821-MAX-ITEM-COUNT              36370014
363800                                                                  36380003
363900         SET RC821-ITEM-IDX TO RC822-ITEM-IDX                     36390014
364000                                                                  36400003
364100         MOVE RC822-LINE-DISTRO-QTY     (RC822-ITEM-IDX)          36410014
364200           TO RC821-ITEM-DISTRO-QTY     (RC821-ITEM-IDX)          36420013
364300                                                                  36430003
364400         MOVE RC822-LINE-OTR-QTY        (RC822-ITEM-IDX)          36440014
364500           TO RC821-ITEM-OTR-QTY        (RC821-ITEM-IDX)          36450013
364600                                                                  36460003
364700         MOVE RC822-LINE-DISTRO-OTR     (RC822-ITEM-IDX)          36470014
364800           TO RC821-ITEM-DISTRO-OTR-QTY (RC821-ITEM-IDX)          36480013
364900                                                                  36490003
365000     END-PERFORM.                                                 36500003
365100                                                                  36510003
365200     PERFORM                                                      36520003
365300       VARYING RC821-STORE-IDX FROM 1 BY 1                        36530013
365400         UNTIL RC821-STR-NBR (RC821-STORE-IDX) EQUAL ZERO         36540013
365500           OR  RC821-STORE-IDX > RC821-MAX-STR-COUNT              36550013
365600                                                                  36560003
365700         IF PS-BULK  OR  RC821-PREPK-ID = 0                       36570043
365800             MOVE PC-Y TO RC821-STR-VAL-OOR-IND  (RC821-STORE-IDX)36580013
365900                          RC821-STR-GOOD-PLAN-IND(RC821-STORE-IDX)36590013
366000         ELSE                                                     36600003
366100             MOVE RC822-STORE-VAL-OOR-IND                         36610014
366200               TO RC821-STR-VAL-OOR-IND     (RC821-STORE-IDX)     36620013
366300                                                                  36630003
366400             MOVE RC822-STORE-GOOD-PLAN-IND                       36640014
366500               TO RC821-STR-GOOD-PLAN-IND   (RC821-STORE-IDX)     36650013
366600                                                                  36660003
366700             IF RC822-STORE-VAL-OOR-IND EQUAL PC-N                36670014
366800                 MOVE PC-N TO RC821-VALID-DISTRO-IND              36680013
366900             END-IF                                               36690003
367000         END-IF                                                   36700003
367100                                                                  36710003
367200     END-PERFORM.                                                 36720003
367300                                                                  36730003
367400                                                                  36740003
367500* -------------------------------------------------------------- *36750003
367600* -------------------------------------------------------------- *36760003
367700                                                                  36770003
367800 5030-GET-STORE-INFO.                                             36780003
367900                                                                  36790003
368000     MOVE '5030-GET-STORE-INFO' TO RC001-PARAGRAPH.               36800033
368100                                                                  36810003
368200     INITIALIZE XL071-COMMAREA-REC.                               36820084
368300     MOVE RC822-STORE-NBR (RC822-STORE-IDX)                       36830084
368400                                      TO XL071-LOCATION-NUMBER.   36840084
368500                                                                  36850084
368600     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                  36860084
368700                                        XL071-COMMAREA            36870084
368800                                        XL071-COMMAREA-REC.       36880084
368900                                                                  36890084
369000     EVALUATE TRUE                                                36900084
369100       WHEN XL071-DC-ASGMT-NOT-FND                                36910099
369200           PERFORM 5035-SELECT-DC-LOC                             36920099
369300       WHEN XL071-NO-ERRORS                                       36930084
369400           AND (XL071-LOC-TYP-CDE = PC-DS                         36940099
369500                                 OR PC-DC                         36950099
369600                                 OR PC-CS                         36960099
369700                                 OR PC-RV)                        36970099
369800               PERFORM 5040-MOVE-LOC-DAT-TO-RC821                 36980095
369900                                                                  36990095
370000       WHEN OTHER                                                 37000003
370100           SET PS-DONE-YES      TO TRUE                           37010099
370200           MOVE XL071-SQLCA     TO TM500-SQLCA                    37020099
370300           MOVE XL071-SQLCODE-N TO TM500-SQLCODE                  37030099
370400           MOVE XL071-SQLCODE-N TO RC001-SAVE-SQLCODE             37040099
370500           MOVE SPACES          TO TM501-TM500-RETURN-MSG         37050099
370600           MOVE '821'           TO TM501-PGM                      37060099
370700           MOVE '5030'          TO TM501-PARA                     37070099
370800           MOVE 'XLT_LOC'       TO TM501-TBL                      37080099
370900           MOVE 47              TO TM501-PRORATION-ERROR-NBR      37090099
371000           PERFORM TM501-SET-TM500-RETURN-MSG                     37100003
371100           PERFORM RC001-RETURN-MSG                               37110003
371200                                                                  37120003
371300     END-EVALUATE.                                                37130003
371400                                                                  37140003
371500 5035-SELECT-DC-LOC.                                              37150099
371600                                                                  37160099
371700     MOVE XL071-LOCATION-NUMBER     TO DK-LOC-STR-NBR             37170099
371800                                                                  37180099
371900     EXEC SQL                                                     37190099
372000         SELECT A.EFF_BEG_DTE                                     37200099
372100              , A.DC_NBR                                          37210099
372200           INTO :XL071-ASGMT-EFF-BEG-DTE                          37220099
372300              , :DK-DC-NMBR                                       37230099
372400           FROM XLT_DC_LOC_ASGMT A                                37240099
372500          WHERE A.LOC_NBR     = :DK-LOC-STR-NBR                   37250099
372600            AND A.EFF_BEG_DTE =                                   37260099
372700                (SELECT MAX(EFF_BEG_DTE)                          37270099
372800                   FROM XLT_DC_LOC_ASGMT B                        37280099
372900                  WHERE B.LOC_NBR = :DK-LOC-STR-NBR               37290099
026000                    AND EFF_BEG_DTE <= CURRENT DATE)              37292099
373100     END-EXEC.                                                    37310099
373200                                                                  37320099
373300     EVALUATE SQLCODE                                             37330099
373400                                                                  37340099
373500       WHEN +0                                                    37350099
373600          MOVE XL071-LOC-TYP-CDE       TO RC821-TYPE-CODE         37360099
373700          MOVE DK-DC-NMBR              TO RC821-DC-NMBR           37370099
373800          MOVE XL071-ASGMT-EFF-BEG-DTE TO RC821-DC-RCT-STA-DTE    37380099
373900          IF XL071-CLO-DTE < '9999-09-09'                         37390099
374000              MOVE XL071-CLO-DTE TO XL071-ASGMT-EFF-STP-DTE       37400099
374100          ELSE                                                    37410099
374200              CONTINUE                                            37420099
374300          END-IF                                                  37430099
374400          MOVE XL071-ASGMT-EFF-STP-DTE TO RC821-DC-RCT-STO-DTE    37440099
374500                                                                  37450099
374600       WHEN OTHER                                                 37460099
374700           SET PS-DONE-YES      TO TRUE                           37470099
374800           MOVE XL071-SQLCA     TO TM500-SQLCA                    37480099
374900           MOVE XL071-SQLCODE-N TO TM500-SQLCODE                  37490099
375000           MOVE XL071-SQLCODE-N TO RC001-SAVE-SQLCODE             37500099
375100           MOVE SPACES          TO TM501-TM500-RETURN-MSG         37510099
375200           MOVE '821'           TO TM501-PGM                      37520099
375300           MOVE '5035'          TO TM501-PARA                     37530099
375400           MOVE 'XLT_LOC'       TO TM501-TBL                      37540099
375500           MOVE 47              TO TM501-PRORATION-ERROR-NBR      37550099
375600           PERFORM TM501-SET-TM500-RETURN-MSG                     37560099
375700           PERFORM RC001-RETURN-MSG                               37570099
375800                                                                  37580099
375900                                                                  37590099
376000     END-EVALUATE.                                                37600099
376100                                                                  37610099
376200                                                                  37620003
376300* -------------------------------------------------------------- *37630003
376400* -------------------------------------------------------------- *37640003
376500                                                                  37650003
376600 5040-MOVE-LOC-DAT-TO-RC821.                                      37660094
376700                                                                  37670003
376800     MOVE '5040-MOVE-LOC-DAT-TO-RC821' TO RC001-PARAGRAPH.        37680094
376900                                                                  37690003
377000     MOVE XL071-LOC-TYP-CDE          TO RC821-ST-TYPE-CODE        37700086
377100                                       (RC821-STORE-IDX).         37710013
377200                                                                  37720003
377300     MOVE XL071-ASGMT-DC-NBR         TO RC821-ST-DC-NMBR          37730099
377400                                       (RC821-STORE-IDX).         37740013
377500                                                                  37750003
377600     MOVE XL071-ASGMT-EFF-BEG-DTE    TO RC821-ST-DC-RCT-STA-DTE   37760098
377700                                       (RC821-STORE-IDX).         37770013
377800                                                                  37780003
377900     MOVE XL071-ASGMT-EFF-STP-DTE    TO RC821-ST-DC-RCT-STO-DTE   37790098
378000                                       (RC821-STORE-IDX).         37800013
378100                                                                  37810003
378200     MOVE XL071-OPN-DTE              TO RC821-OPENED-DATE         37820094
378300                                       (RC821-STORE-IDX).         37830013
378400                                                                  37840003
378500     MOVE XL071-CLO-DTE              TO RC821-CLOSED-DATE         37850094
378600                                       (RC821-STORE-IDX).         37860013
378700                                                                  37870003
378800     IF RC821-NEW-STR-IND EQUAL PC-Y                              37880013
378900         PERFORM 5050-NEW-STORE-DETERMINATION                     37890003
379000     ELSE                                                         37900003
379100         MOVE PC-ONE TO RC821-EXISTING-STORE-CDE                  37910013
379200                       (RC821-STORE-IDX)                          37920013
379300     END-IF.                                                      37930003
379400                                                                  37940003
379500                                                                  37950003
379600* -------------------------------------------------------------- *37960003
379700* -------------------------------------------------------------- *37970003
379800                                                                  37980003
379900 5050-NEW-STORE-DETERMINATION.                                    37990003
380000                                                                  38000003
380100     MOVE '5050-NEW-STORE-DETERMINATION' TO RC001-PARAGRAPH.      38010033
380200                                                                  38020000
380300     INITIALIZE DPG51                                             38030000
380400                DPG52                                             38040000
380500                DPG53                                             38050000
380600                DPG54                                             38060000
380700                DPG55                                             38070000
380800                DPG56.                                            38080000
380900                                                                  38090000
381000     SET DPG51-INCREMENT-DATE                                     38100000
381100         DPG51-ACTUAL-CALENDAR-ONLY                               38110000
381200         DPG52-LK-DTE-ISO-FMT      TO TRUE.                       38120000
381300                                                                  38130000
381400     MOVE XL071-OPN-DTE            TO DPG52-LK-DATE-INPUT.        38140096
381500     MOVE KRPRPM-FUNC-QTY          TO DPG51-INCR-DECR-DAYS-9.     38150000
381600                                                                  38160000
381700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                38170000
381800                                             DPG52                38180000
381900                                             DPG53                38190000
382000                                             DPG54                38200000
382100                                             DPG55                38210000
382200                                             DPG56.               38220000
382300                                                                  38230000
382400     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-STR-ADJUSTED-OPEN-DATE.    38240000
382500                                                                  38250000
382600                                                                  38260000
382700     IF PV-CURRENT-DATE > PV-STR-ADJUSTED-OPEN-DATE               38270000
382800         MOVE PC-ONE  TO RC821-EXISTING-STORE-CDE                 38280013
382900                        (RC821-STORE-IDX)                         38290013
383000     ELSE                                                         38300000
383100         MOVE PC-ZERO TO RC821-EXISTING-STORE-CDE                 38310013
383200                        (RC821-STORE-IDX)                         38320013
383300     END-IF.                                                      38330000
383400                                                                  38340000
383500                                                                  38350000
383600* -------------------------------------------------------------- *38360000
383700* -------------------------------------------------------------- *38370000
383800                                                                  38380000
383900 5060-SETUP-RC822-COMMAREA.                                       38390014
384000                                                                  38400000
384100     MOVE '5060-SETUP-RC822-COMMAREA ' TO RC001-PARAGRAPH.        38410033
384200                                                                  38420000
384300     MOVE RC821-ORD-NBR         TO  RC822-PO-NBR.                 38430014
384400     MOVE RC821-REC-DRV-LNE-NBR TO  RC822-APP-PO-LNE-NBR.         38440014
384500     MOVE RC821-REC-SEQ-NBR     TO  RC822-REC-SEQ-NBR.            38450014
384600     MOVE RC821-PREPK-ID        TO  RC822-PO-PREPK-ID.            38460014
384700     MOVE RC821-OPER-UNT-ID     TO  RC822-OPER-UNT-ID.            38470014
384800     MOVE RC821-FCLTY-ID        TO  RC822-FCLTY-ID.               38480014
384900     MOVE RC821-PKGNG-CDE       TO  RC822-PKGNG-CDE.              38490014
385000                                                                  38500000
385100     MOVE ZEROS TO RC822-STR-NBR.                                 38510014
385200                                                                  38520000
385300     IF TM500-REDISTRO-YES                                        38530000
385400         SET RC822-RECEIVER-OTR TO TRUE                           38540014
385500     ELSE                                                         38550003
385600         SET RC822-PO-OTR       TO TRUE                           38560014
385700     END-IF.                                                      38570003
385800                                                                  38580003
385900                                                                  38590003
386000* -------------------------------------------------------------- *38600003
386100* -------------------------------------------------------------- *38610003
386200                                                                  38620003
386300 5070-RETREIVE-RANKING-DATA.                                      38630003
386400                                                                  38640003
386500     MOVE '5070-RETREIVE-RANKING-DATA  ' TO RC001-PARAGRAPH.      38650033
386600                                                                  38660003
386700     SET PS-DRIVER-FOUND-NO TO TRUE.                              38670003
386800                                                                  38680003
386900     PERFORM 5080-FIND-DRIVER-LINE                                38690010
387000       VARYING RC821-ITEM-IDX FROM 1 BY 1                         38700013
387100         UNTIL PS-DRIVER-FOUND-YES                                38710003
387200           OR  RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT.             38720013
387300                                                                  38730003
387400     MOVE RC821-DEPT-NBR                  TO  DK-DEPT-NBR.        38740013
387500     MOVE RC821-STR-NBR (RC821-STORE-IDX) TO  DK-RCT-LOC-NBR.     38750013
387600                                                                  38760003
387700     PERFORM 5090-SELECT-SUB-RNK.                                 38770010
387800                                                                  38780003
387900                                                                  38790003
388000* -------------------------------------------------------------- *38800003
388100* -------------------------------------------------------------- *38810003
388200                                                                  38820003
388300 5080-FIND-DRIVER-LINE.                                           38830010
388400                                                                  38840003
388500     MOVE '5080-FIND-DRIVER-LINE     ' TO RC001-PARAGRAPH.        38850033
388600                                                                  38860003
388700     IF RC821-DRV-LNE-CDE (RC821-ITEM-IDX) = PC-A                 38870013
388800         SET PS-DRIVER-FOUND-YES TO TRUE                          38880003
388900         MOVE RC821-REC-CLASS    (RC821-ITEM-IDX)                 38890013
389000           TO DK-MAJ-CL-NBR                                       38900003
389100         MOVE RC821-REC-SUBCLASS (RC821-ITEM-IDX)                 38910013
389200           TO DK-SUB-CL-NBR                                       38920003
389300     END-IF.                                                      38930003
389400                                                                  38940003
389500                                                                  38950003
389600* -------------------------------------------------------------- *38960003
389700* -------------------------------------------------------------- *38970003
389800                                                                  38980003
389900 5090-SELECT-SUB-RNK.                                             38990010
390000                                                                  39000003
390100     MOVE '5090-SELECT-SUB-RNK    ' TO RC001-PARAGRAPH.           39010033
390200                                                                  39020003
390300     EXEC SQL                                                     39030003
390400                                                                  39040003
390500         SELECT RNK_NBR                                           39050003
390600                                                                  39060003
390700           INTO :RCT00007-RNK-NBR                                 39070003
390800                                                                  39080003
390900         FROM RCT_LOC_SUB_RNK                                     39090003
391000                                                                  39100003
391100         WHERE PRCG_NBR    =  :RCT00011-PRCG-NBR                  39110003
391200           AND LOC_NBR     =  :DK-RCT-LOC-NBR                     39120003
391300           AND DEPT_NBR    =  :DK-DEPT-NBR                        39130003
391400           AND MAJ_CL_NBR  =  :DK-MAJ-CL-NBR                      39140003
391500           AND SUB_CL_NBR  =  :DK-SUB-CL-NBR                      39150003
391600                                                                  39160003
391700     END-EXEC.                                                    39170003
391800                                                                  39180003
391900     EVALUATE SQLCODE                                             39190003
392000                                                                  39200003
392100       WHEN +0                                                    39210003
392200           MOVE RCT00007-RNK-NBR  TO  PV-RANK-SEQ-NBR             39220003
392300                                                                  39230003
392400       WHEN +100                                                  39240003
392500           PERFORM 5100-SELECT-MAJ-RNK                            39250010
392600                                                                  39260003
392700       WHEN OTHER                                                 39270003
392800           MOVE SQLCODE    TO RC001-SAVE-SQLCODE                  39280003
392900           MOVE SQLCA      TO TM500-SQLCA                         39290003
393000           MOVE SQLCODE    TO TM500-SQLCODE                       39300003
393100           MOVE SPACES     TO TM501-TM500-RETURN-MSG              39310003
393200           MOVE '821'      TO TM501-PGM                           39320003
393300           MOVE '5090'     TO TM501-PARA                          39330010
393400           MOVE 'RCT0007'  TO TM501-TBL                           39340004
393500           MOVE 48         TO TM501-PRORATION-ERROR-NBR           39350004
393600           PERFORM TM501-SET-TM500-RETURN-MSG                     39360004
393700           PERFORM RC001-RETURN-MSG                               39370004
393800                                                                  39380004
393900     END-EVALUATE.                                                39390004
394000                                                                  39400004
394100                                                                  39410004
394200* -------------------------------------------------------------- *39420004
394300* -------------------------------------------------------------- *39430004
394400                                                                  39440004
394500 5100-SELECT-MAJ-RNK.                                             39450010
394600                                                                  39460004
394700     MOVE '5100-SELECT-MAJ-RNK    ' TO RC001-PARAGRAPH.           39470033
394800                                                                  39480004
394900     EXEC SQL                                                     39490004
395000                                                                  39500004
395100         SELECT RNK_NBR                                           39510004
395200                                                                  39520004
395300           INTO :RCT00006-RNK-NBR                                 39530004
395400                                                                  39540004
395500         FROM RCT_LOC_MAJ_RNK                                     39550004
395600                                                                  39560004
395700         WHERE PRCG_NBR    =  :RCT00011-PRCG-NBR                  39570004
395800           AND LOC_NBR     =  :DK-RCT-LOC-NBR                     39580004
395900           AND DEPT_NBR    =  :DK-DEPT-NBR                        39590004
396000           AND MAJ_CL_NBR  =  :DK-MAJ-CL-NBR                      39600004
396100                                                                  39610004
396200     END-EXEC.                                                    39620004
396300                                                                  39630004
396400     EVALUATE SQLCODE                                             39640004
396500                                                                  39650004
396600       WHEN +0                                                    39660004
396700           MOVE RCT00006-RNK-NBR  TO  PV-RANK-SEQ-NBR             39670004
396800                                                                  39680004
396900       WHEN +100                                                  39690004
397000           PERFORM 5110-SELECT-DEPT-RNK                           39700010
397100                                                                  39710004
397200       WHEN OTHER                                                 39720004
397300           MOVE SQLCA     TO TM500-SQLCA                          39730000
397400           MOVE SQLCODE   TO TM500-SQLCODE                        39740000
397500           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   39750000
397600           MOVE SPACES    TO TM501-TM500-RETURN-MSG               39760000
397700           MOVE '821'     TO TM501-PGM                            39770000
397800           MOVE '5100'    TO TM501-PARA                           39780010
397900           MOVE 'RCT0006' TO TM501-TBL                            39790004
398000           MOVE 49        TO TM501-PRORATION-ERROR-NBR            39800000
398100           PERFORM TM501-SET-TM500-RETURN-MSG                     39810000
398200           PERFORM RC001-RETURN-MSG                               39820000
398300                                                                  39830000
398400     END-EVALUATE.                                                39840000
398500                                                                  39850000
398600                                                                  39860000
398700* -------------------------------------------------------------- *39870000
398800* -------------------------------------------------------------- *39880000
398900                                                                  39890000
399000 5110-SELECT-DEPT-RNK.                                            39900010
399100                                                                  39910000
399200     MOVE '5110-SELECT-DEPT-RNK    ' TO RC001-PARAGRAPH.          39920033
399300                                                                  39930000
399400     EXEC SQL                                                     39940000
399500                                                                  39950000
399600         SELECT RNK_NBR                                           39960000
399700                                                                  39970000
399800           INTO :RCT00005-RNK-NBR                                 39980000
399900                                                                  39990000
400000         FROM RCT_LOC_DEPT_RNK                                    40000000
400100                                                                  40010000
400200         WHERE PRCG_NBR    =  :RCT00011-PRCG-NBR                  40020000
400300           AND LOC_NBR     =  :DK-RCT-LOC-NBR                     40030000
400400           AND DEPT_NBR    =  :DK-DEPT-NBR                        40040000
400500                                                                  40050000
400600     END-EXEC.                                                    40060000
400700                                                                  40070000
400800     EVALUATE SQLCODE                                             40080000
400900                                                                  40090000
401000       WHEN +0                                                    40100000
401100           MOVE RCT00005-RNK-NBR  TO  PV-RANK-SEQ-NBR             40110000
401200                                                                  40120000
401300       WHEN +100                                                  40130000
401400           PERFORM 5120-SELECT-LOC-RNK                            40140010
401500                                                                  40150000
401600       WHEN OTHER                                                 40160000
401700           MOVE SQLCA     TO TM500-SQLCA                          40170000
401800           MOVE SQLCODE   TO TM500-SQLCODE                        40180000
401900           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   40190000
402000           MOVE SPACES    TO TM501-TM500-RETURN-MSG               40200000
402100           MOVE '821'     TO TM501-PGM                            40210001
402200           MOVE '5110'    TO TM501-PARA                           40220010
402300           MOVE 'RCT0005' TO TM501-TBL                            40230004
402400           MOVE 50        TO TM501-PRORATION-ERROR-NBR            40240004
402500           PERFORM TM501-SET-TM500-RETURN-MSG                     40250004
402600           PERFORM RC001-RETURN-MSG                               40260004
402700                                                                  40270004
402800     END-EVALUATE.                                                40280004
402900                                                                  40290004
403000                                                                  40300004
403100* -------------------------------------------------------------- *40310004
403200* -------------------------------------------------------------- *40320004
403300                                                                  40330004
403400 5120-SELECT-LOC-RNK.                                             40340010
403500                                                                  40350004
403600     MOVE '5120-SELECT-LOC-RNK    ' TO RC001-PARAGRAPH.           40360033
403700                                                                  40370004
403800     EXEC SQL                                                     40380004
403900                                                                  40390004
404000         SELECT RNK_NBR                                           40400004
404100                                                                  40410004
404200           INTO :RCT00008-RNK-NBR                                 40420004
404300                                                                  40430004
404400         FROM RCT_LOC_RNK                                         40440052
404500                                                                  40450004
404600         WHERE PRCG_NBR    =  :RCT00011-PRCG-NBR                  40460004
404700           AND LOC_NBR     =  :DK-RCT-LOC-NBR                     40470004
404800                                                                  40480004
404900     END-EXEC.                                                    40490004
405000                                                                  40500004
405100     EVALUATE SQLCODE                                             40510004
405200                                                                  40520004
405300       WHEN +0                                                    40530004
405400           MOVE RCT00008-RNK-NBR  TO  PV-RANK-SEQ-NBR             40540004
405500                                                                  40550004
405600       WHEN +100                                                  40560004
405700           MOVE PC-9999 TO PV-RANK-SEQ-NBR                        40570051
405800                                                                  40580004
405900       WHEN OTHER                                                 40590004
406000           MOVE SQLCA     TO TM500-SQLCA                          40600004
406100           MOVE SQLCODE   TO TM500-SQLCODE                        40610004
406200           MOVE SQLCODE   TO RC001-SAVE-SQLCODE                   40620004
406300           MOVE SPACES    TO TM501-TM500-RETURN-MSG               40630004
406400           MOVE '821'     TO TM501-PGM                            40640004
406500           MOVE '5120'    TO TM501-PARA                           40650010
406600           MOVE 'RCT0008' TO TM501-TBL                            40660004
406700           MOVE 51        TO TM501-PRORATION-ERROR-NBR            40670004
406800           PERFORM TM501-SET-TM500-RETURN-MSG                     40680004
406900           PERFORM RC001-RETURN-MSG                               40690004
407000                                                                  40700004
407100     END-EVALUATE.                                                40710004
407200                                                                  40720004
407300                                                                  40730004
407400* -------------------------------------------------------------- *40740004
407500* -------------------------------------------------------------- *40750004
407600                                                                  40760004
407700 6000-CALL-TROUBLE-ROUTINE.                                       40770004
407800                                                                  40780004
407900     MOVE '6000-CALL-TROUBLE-ROUTINE' TO RC001-PARAGRAPH.         40790034
408000                                                                  40800004
408100     INITIALIZE RC823-TROUBLE-RULES-COMPONENTS.                   40810016
408200                                                                  40820004
408300     IF PS-PREPACK  AND  RC821-PREPK-ID > 0                       40830043
408400                                                                  40840004
408500         PERFORM 6010-PREPACK-LINE-TROUBLE                        40850004
408600         IF   RC821-PREPK-ID NOT = 99                             40860055
408700             PERFORM 6020-PREPACK-PACK-TROUBLE                    40870054
408800         END-IF                                                   40880054
408900                                                                  40890004
409000         IF NOT TM500-RESOLVE-AUTO                                40900004
409100             PERFORM 6050-PREPACK-STORE-TROUBLE                   40910010
409200             PERFORM 6030-PREPACK-OVR-SHT-TROUBLE                 40920058
409300         END-IF                                                   40930056
409400     END-IF.                                                      40940004
409500                                                                  40950004
409600     IF PS-BULK  OR  RC821-PREPK-ID = 0                           40960043
409700                                                                  40970004
409800         PERFORM 6060-BULK-LINE-TROUBLE                           40980010
409900                                                                  40990004
410000         IF NOT TM500-RESOLVE-AUTO                                41000004
410100             PERFORM 6090-BULK-STORE-TROUBLE                      41010010
410200             PERFORM 6070-BULK-OVR-SHT-TROUBLE                    41020058
410300         END-IF                                                   41030004
410400     END-IF.                                                      41040004
410500                                                                  41050004
410600     MOVE TM500-FIELDS  TO RC823-TM500-FIELDS.                    41060016
410700                                                                  41070004
410800     EXEC CICS                                                    41080004
410900         LINK PROGRAM  (PC-RCKCS823)                              41090003
411000              COMMAREA (RC823-COMMAREA)                           41100016
411100              RESP     (PV-CICS-RESP)                             41110003
411200     END-EXEC.                                                    41120003
411300                                                                  41130003
411400                                                                  41140003
411500*    ----------------------                                       41150003
411600*    CHECK CICS RETURN CODE                                       41160003
411700*    ----------------------                                       41170003
411800                                                                  41180003
411900     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    41190003
412000         SET PS-DONE-YES TO TRUE                                  41200003
412100         MOVE SPACES     TO TM501-TM500-RETURN-MSG                41210003
412200         MOVE '821'      TO TM501-PGM                             41220003
412300         MOVE '6000'     TO TM501-PARA                            41230004
412400         MOVE 52         TO TM501-PRORATION-ERROR-NBR             41240003
412500         PERFORM TM501-SET-TM500-RETURN-MSG                       41250003
412600         PERFORM RC001-RETURN-MSG                                 41260003
412700     END-IF.                                                      41270003
412800                                                                  41280003
412900     MOVE RC823-TM500-FIELDS TO TM500-FIELDS.                     41290016
413000                                                                  41300003
413100                                                                  41310003
413200     EVALUATE TRUE                                                41320003
413300                                                                  41330003
413400       WHEN TM500-CALL-SUCCESSFUL                                 41340003
413500       WHEN TM500-DUPLICATE-TROUBLE                               41350003
413600       WHEN TM500-TTRBNTF-UPDATE-NOT-FND                          41360003
413700           CONTINUE                                               41370003
413800                                                                  41380003
413900       WHEN OTHER                                                 41390003
414000           SET PS-DONE-YES TO TRUE                                41400003
414100                                                                  41410003
414200     END-EVALUATE.                                                41420003
414300                                                                  41430003
414400                                                                  41440003
414500     IF RC823-DO-ALLOCATION-YES  AND  TM500-CREATE-AUTO           41450016
414600         CONTINUE                                                 41460003
414700     ELSE                                                         41470003
414800         SET PS-DONE-YES TO TRUE                                  41480003
414900     END-IF.                                                      41490003
415000                                                                  41500003
415100                                                                  41510003
415200* -------------------------------------------------------------- *41520003
415300* -------------------------------------------------------------- *41530003
415400                                                                  41540003
415500 6010-PREPACK-LINE-TROUBLE.                                       41550003
415600                                                                  41560003
415700     MOVE '6010-PREPACK-LINE-TROUBLE ' TO RC001-PARAGRAPH.        41570034
415800                                                                  41580003
415900     SET RC823-RULE-IDX TO +1.                                    41590016
416000                                                                  41600003
416100     MOVE PC-N  TO  RC823-PRORATE-IND    (RC823-RULE-IDX)         41610016
416200                    DK-PRORATE-IND.                               41620003
416300                                                                  41630003
416400     MOVE PC-N  TO  RC823-MERCH-TYPE-CDE (RC823-RULE-IDX)         41640016
416500                    DK-MERCH-TYPE-CDE.                            41650003
416600                                                                  41660003
416700     MOVE PC-S  TO  RC823-ALLOC-IND      (RC823-RULE-IDX)         41670016
416800                    DK-ALLOC-IND.                                 41680003
416900                                                                  41690003
417000     MOVE PC-K  TO  RC823-TRB-LVL-CDE    (RC823-RULE-IDX)         41700016
417100                    DK-TRB-LVL-CDE.                               41710003
417200                                                                  41720003
417300     MOVE RC821-PKGNG-CDE                                         41730013
417400       TO RC823-PKGNG-CDE     (RC823-RULE-IDX)                    41740016
417500          DK-PKGNG-CDE.                                           41750003
417600                                                                  41760003
417700     MOVE RC821-NEW-STR-IND                                       41770013
417800       TO RC823-NEW-STORE-IND (RC823-RULE-IDX)                    41780016
417900          DK-NEW-STORE-IND.                                       41790003
418000                                                                  41800003
418100     PERFORM 6100-SELECT-RULE-KEY.                                41810010
418200                                                                  41820003
418300                                                                  41830003
418400* -------------------------------------------------------------- *41840003
418500* -------------------------------------------------------------- *41850003
418600                                                                  41860003
418700 6020-PREPACK-PACK-TROUBLE.                                       41870003
418800                                                                  41880003
418900     MOVE '6020-PREPACK-PACK-TROUBLE ' TO RC001-PARAGRAPH.        41890034
419000                                                                  41900003
419100     SET RC823-RULE-IDX UP BY +1.                                 41910016
419200                                                                  41920003
419300     MOVE PC-N  TO  RC823-PRORATE-IND    (RC823-RULE-IDX)         41930016
419400                    DK-PRORATE-IND.                               41940003
419500                                                                  41950003
419600     MOVE PC-N  TO  RC823-MERCH-TYPE-CDE (RC823-RULE-IDX)         41960016
419700                    DK-MERCH-TYPE-CDE.                            41970003
419800                                                                  41980003
419900     MOVE PC-S  TO  RC823-ALLOC-IND      (RC823-RULE-IDX)         41990016
420000                    DK-ALLOC-IND.                                 42000003
420100                                                                  42010003
420200     MOVE PC-P  TO  RC823-TRB-LVL-CDE    (RC823-RULE-IDX)         42020016
420300                    DK-TRB-LVL-CDE.                               42030003
420400                                                                  42040003
420500     MOVE RC821-PKGNG-CDE                                         42050013
420600       TO RC823-PKGNG-CDE     (RC823-RULE-IDX)                    42060016
420700          DK-PKGNG-CDE.                                           42070003
420800                                                                  42080003
420900     MOVE RC821-NEW-STR-IND                                       42090013
421000       TO RC823-NEW-STORE-IND (RC823-RULE-IDX)                    42100016
421100          DK-NEW-STORE-IND.                                       42110003
421200                                                                  42120003
421300     PERFORM 6100-SELECT-RULE-KEY.                                42130010
421400                                                                  42140003
421500                                                                  42150003
421600* -------------------------------------------------------------- *42160003
421700* -------------------------------------------------------------- *42170003
421800                                                                  42180003
421900 6030-PREPACK-OVR-SHT-TROUBLE.                                    42190003
422000                                                                  42200003
422100     MOVE '6030-PREPACK-OVR-SHT-TROUBLE' TO RC001-PARAGRAPH.      42210034
422200                                                                  42220003
422300     IF RC821-OVER-SHORT-CDE EQUAL PC-O                           42230013
422400         MOVE RC821-OVER-PRORATE-CDE TO DK-ALLOC-IND              42240024
422500         MOVE PC-O                   TO DK-PRORATE-IND            42250024
422600         PERFORM 6040-OVER-SHORT-ROUTINE                          42260024
422700         MOVE RC821-OVER-PRORATE-CDE                              42270024
422800           TO RC823-ALLOC-IND   (RC823-RULE-IDX)                  42280024
422900         MOVE PC-O                                                42290024
423000           TO RC823-PRORATE-IND (RC823-RULE-IDX)                  42300024
423100     END-IF.                                                      42310003
423200                                                                  42320003
423300     IF RC821-OVER-SHORT-CDE EQUAL PC-S                           42330013
423400         MOVE RC821-SHORT-PRORATE-CDE TO DK-ALLOC-IND             42340024
423500         MOVE PC-S                    TO DK-PRORATE-IND           42350024
423600         PERFORM 6040-OVER-SHORT-ROUTINE                          42360024
423700         MOVE RC821-SHORT-PRORATE-CDE                             42370024
423800           TO RC823-ALLOC-IND   (RC823-RULE-IDX)                  42380024
423900         MOVE PC-S                                                42390024
424000           TO RC823-PRORATE-IND (RC823-RULE-IDX)                  42400024
424100     END-IF.                                                      42410003
424200                                                                  42420003
424300* -------------------------------------------------------------- *42430003
424400* -------------------------------------------------------------- *42440003
424500                                                                  42450003
424600 6040-OVER-SHORT-ROUTINE.                                         42460010
424700                                                                  42470003
424800     MOVE '6030-OVER-SHORT-ROUTINE     ' TO RC001-PARAGRAPH.      42480034
424900                                                                  42490003
425000     SET RC823-RULE-IDX UP BY +1.                                 42500016
425100                                                                  42510003
425200     MOVE PC-N  TO  RC823-MERCH-TYPE-CDE (RC823-RULE-IDX)         42520016
425300                    DK-MERCH-TYPE-CDE.                            42530003
425400                                                                  42540003
425500     MOVE PC-P  TO  RC823-TRB-LVL-CDE    (RC823-RULE-IDX)         42550016
425600                    DK-TRB-LVL-CDE.                               42560003
425700                                                                  42570003
425800     MOVE RC821-PKGNG-CDE                                         42580013
425900       TO RC823-PKGNG-CDE     (RC823-RULE-IDX)                    42590016
426000          DK-PKGNG-CDE.                                           42600003
426100                                                                  42610003
426200     MOVE RC821-NEW-STR-IND                                       42620013
426300       TO RC823-NEW-STORE-IND (RC823-RULE-IDX)                    42630016
426400          DK-NEW-STORE-IND.                                       42640003
426500                                                                  42650003
426600     PERFORM 6100-SELECT-RULE-KEY.                                42660010
426700                                                                  42670003
426800                                                                  42680003
426900* -------------------------------------------------------------- *42690003
427000* -------------------------------------------------------------- *42700003
427100                                                                  42710003
427200 6050-PREPACK-STORE-TROUBLE.                                      42720010
427300                                                                  42730003
427400     MOVE '6050-PREPACK-STORE-TROUBLE  ' TO RC001-PARAGRAPH.      42740034
427500                                                                  42750003
427600     SET RC823-RULE-IDX UP BY +1.                                 42760016
427700                                                                  42770003
427800     MOVE PC-N  TO  RC823-PRORATE-IND    (RC823-RULE-IDX)         42780016
427900                    DK-PRORATE-IND.                               42790003
428000                                                                  42800003
428100     MOVE PC-N  TO  RC823-MERCH-TYPE-CDE (RC823-RULE-IDX)         42810016
428200                    DK-MERCH-TYPE-CDE.                            42820003
428300                                                                  42830003
428400     MOVE PC-S  TO  RC823-ALLOC-IND      (RC823-RULE-IDX)         42840016
428500                    DK-ALLOC-IND.                                 42850003
428600                                                                  42860003
428700     MOVE PC-S  TO  RC823-TRB-LVL-CDE    (RC823-RULE-IDX)         42870016
428800                    DK-TRB-LVL-CDE.                               42880003
428900                                                                  42890003
429000     MOVE RC821-PKGNG-CDE                                         42900013
429100       TO RC823-PKGNG-CDE     (RC823-RULE-IDX)                    42910016
429200          DK-PKGNG-CDE.                                           42920003
429300                                                                  42930003
429400     MOVE RC821-NEW-STR-IND                                       42940013
429500       TO RC823-NEW-STORE-IND (RC823-RULE-IDX)                    42950016
429600          DK-NEW-STORE-IND.                                       42960003
429700                                                                  42970003
429800     PERFORM 6100-SELECT-RULE-KEY.                                42980010
429900                                                                  42990003
430000                                                                  43000003
430100* -------------------------------------------------------------- *43010003
430200* -------------------------------------------------------------- *43020003
430300                                                                  43030003
430400 6060-BULK-LINE-TROUBLE.                                          43040010
430500                                                                  43050003
430600     MOVE '6060-BULK-LINE-TROUBLE      ' TO RC001-PARAGRAPH.      43060034
430700                                                                  43070003
430800     SET RC823-RULE-IDX TO +1.                                    43080016
430900                                                                  43090003
431000     MOVE PC-N  TO  RC823-PRORATE-IND    (RC823-RULE-IDX)         43100016
431100                    DK-PRORATE-IND.                               43110003
431200                                                                  43120003
431300     MOVE PC-N  TO  RC823-MERCH-TYPE-CDE (RC823-RULE-IDX)         43130016
431400                    DK-MERCH-TYPE-CDE.                            43140003
431500                                                                  43150003
431600     MOVE PC-S  TO  RC823-ALLOC-IND      (RC823-RULE-IDX)         43160016
431700                    DK-ALLOC-IND.                                 43170003
431800                                                                  43180003
431900     MOVE PC-K  TO  RC823-TRB-LVL-CDE    (RC823-RULE-IDX)         43190016
432000                    DK-TRB-LVL-CDE.                               43200003
432100                                                                  43210003
432200     MOVE RC821-PKGNG-CDE                                         43220013
432300       TO RC823-PKGNG-CDE     (RC823-RULE-IDX)                    43230016
432400          DK-PKGNG-CDE.                                           43240003
432500                                                                  43250003
432600     MOVE RC821-NEW-STR-IND                                       43260013
432700       TO RC823-NEW-STORE-IND (RC823-RULE-IDX)                    43270016
432800          DK-NEW-STORE-IND.                                       43280003
432900                                                                  43290003
433000     PERFORM 6100-SELECT-RULE-KEY.                                43300010
433100                                                                  43310003
433200                                                                  43320003
433300* -------------------------------------------------------------- *43330003
433400* -------------------------------------------------------------- *43340003
433500                                                                  43350003
433600 6070-BULK-OVR-SHT-TROUBLE.                                       43360010
433700                                                                  43370003
433800     MOVE '6070-BULK-OVR-SHT-TROUBLE   ' TO RC001-PARAGRAPH.      43380034
433900                                                                  43390003
434000     IF RC821-OVER-SHORT-CDE EQUAL PC-O                           43400013
434100         MOVE RC821-OVER-PRORATE-CDE TO DK-ALLOC-IND              43410024
434200         MOVE PC-O                   TO DK-PRORATE-IND            43420024
434300         PERFORM 6080-OVER-SHORT-ROUTINE                          43430024
434400         MOVE RC821-OVER-PRORATE-CDE                              43440024
434500           TO RC823-ALLOC-IND   (RC823-RULE-IDX)                  43450024
434600         MOVE PC-O                                                43460024
434700           TO RC823-PRORATE-IND (RC823-RULE-IDX)                  43470024
434800     END-IF.                                                      43480003
434900                                                                  43490003
435000     IF RC821-OVER-SHORT-CDE EQUAL PC-S                           43500013
435100         MOVE RC821-SHORT-PRORATE-CDE TO DK-ALLOC-IND             43510024
435200         MOVE PC-S                    TO DK-PRORATE-IND           43520024
435300         PERFORM 6080-OVER-SHORT-ROUTINE                          43530024
435400         MOVE RC821-SHORT-PRORATE-CDE                             43540024
435500           TO RC823-ALLOC-IND   (RC823-RULE-IDX)                  43550024
435600         MOVE PC-S                                                43560024
435700           TO RC823-PRORATE-IND (RC823-RULE-IDX)                  43570024
435800     END-IF.                                                      43580003
435900                                                                  43590003
436000                                                                  43600003
436100* -------------------------------------------------------------- *43610003
436200* -------------------------------------------------------------- *43620003
436300                                                                  43630003
436400 6080-OVER-SHORT-ROUTINE.                                         43640010
436500                                                                  43650000
436600     MOVE '6080-OVER-SHORT-ROUTINE     ' TO RC001-PARAGRAPH.      43660034
436700                                                                  43670000
436800     SET RC823-RULE-IDX UP BY +1.                                 43680016
436900                                                                  43690000
437000     MOVE PC-N  TO  RC823-MERCH-TYPE-CDE (RC823-RULE-IDX)         43700016
437100                    DK-MERCH-TYPE-CDE.                            43710000
437200                                                                  43720000
437300     MOVE PC-K  TO  RC823-TRB-LVL-CDE    (RC823-RULE-IDX)         43730016
437400                    DK-TRB-LVL-CDE.                               43740000
437500                                                                  43750000
437600     MOVE RC821-PKGNG-CDE                                         43760013
437700       TO RC823-PKGNG-CDE     (RC823-RULE-IDX)                    43770016
437800          DK-PKGNG-CDE.                                           43780000
437900                                                                  43790000
438000     MOVE RC821-NEW-STR-IND                                       43800013
438100       TO RC823-NEW-STORE-IND (RC823-RULE-IDX)                    43810016
438200          DK-NEW-STORE-IND.                                       43820000
438300                                                                  43830000
438400     PERFORM 6100-SELECT-RULE-KEY.                                43840010
438500                                                                  43850000
438600                                                                  43860000
438700* -------------------------------------------------------------- *43870000
438800* -------------------------------------------------------------- *43880000
438900                                                                  43890000
439000 6090-BULK-STORE-TROUBLE.                                         43900010
439100                                                                  43910000
439200     MOVE '6080-BULK-STORE-TROUBLE     ' TO RC001-PARAGRAPH.      43920034
439300                                                                  43930000
439400     SET RC823-RULE-IDX UP BY +1.                                 43940016
439500                                                                  43950000
439600     MOVE PC-N  TO  RC823-PRORATE-IND    (RC823-RULE-IDX)         43960016
439700                    DK-PRORATE-IND.                               43970000
439800                                                                  43980000
439900     MOVE PC-N  TO  RC823-MERCH-TYPE-CDE (RC823-RULE-IDX)         43990016
440000                    DK-MERCH-TYPE-CDE.                            44000000
440100                                                                  44010000
440200     MOVE PC-S  TO  RC823-ALLOC-IND      (RC823-RULE-IDX)         44020016
440300                    DK-ALLOC-IND.                                 44030000
440400                                                                  44040000
440500     MOVE PC-S  TO  RC823-TRB-LVL-CDE    (RC823-RULE-IDX)         44050016
440600                    DK-TRB-LVL-CDE.                               44060000
440700                                                                  44070000
440800     MOVE RC821-PKGNG-CDE                                         44080013
440900       TO RC823-PKGNG-CDE     (RC823-RULE-IDX)                    44090016
441000          DK-PKGNG-CDE.                                           44100000
441100                                                                  44110000
441200     MOVE RC821-NEW-STR-IND                                       44120013
441300       TO RC823-NEW-STORE-IND (RC823-RULE-IDX)                    44130016
441400          DK-NEW-STORE-IND.                                       44140000
441500                                                                  44150000
441600     PERFORM 6100-SELECT-RULE-KEY.                                44160010
441700                                                                  44170003
441800                                                                  44180003
441900* -------------------------------------------------------------- *44190003
442000* -------------------------------------------------------------- *44200003
442100                                                                  44210003
442200 6100-SELECT-RULE-KEY.                                            44220010
442300                                                                  44230003
442400     MOVE '6100-SELECT-RULE-KEY     ' TO RC001-PARAGRAPH.         44240034
442500                                                                  44250003
442600                                                                  44260003
442700     EXEC SQL                                                     44270003
442800                                                                  44280003
442900         SELECT  PRRTN_RUL_ID                                     44290003
443000                                                                  44300003
443100           INTO  :RCT00000-PRRTN-RUL-ID                           44310003
443200                                                                  44320003
443300           FROM  RCT_PRRTN_RUL                                    44330003
443400                                                                  44340003
443500         WHERE PRRTN_TYP_CDE    =  :DK-PRORATE-IND                44350003
443600           AND PRRTN_MTHD_CDE   =  :DK-ALLOC-IND                  44360003
443700           AND PRRTN_LVL_CDE    =  :DK-TRB-LVL-CDE                44370003
443800           AND PKG_TYP_CDE      =  :DK-PKGNG-CDE                  44380003
443900           AND PO_NW_STR_IND    =  :DK-NEW-STORE-IND              44390003
444000           AND MDSE_TYP_CDE     =  :DK-MERCH-TYPE-CDE             44400003
444100           AND ACTV_IND         =  :PC-Y                          44410003
444200           AND LOC_NBR          =  :DK-LOC-NBR                    44420003
444300                                                                  44430003
444400                                                                  44440003
444500     END-EXEC.                                                    44450003
444600                                                                  44460003
444700     EVALUATE SQLCODE                                             44470003
444800                                                                  44480003
444900       WHEN +0                                                    44490003
445000           MOVE RCT00000-PRRTN-RUL-ID                             44500003
445100             TO RC823-RULE-KEY (RC823-RULE-IDX)                   44510016
445200                                                                  44520003
445300       WHEN OTHER                                                 44530003
445400           SET PS-DONE-YES TO TRUE                                44540003
445500           MOVE SQLCA      TO TM500-SQLCA                         44550003
445600           MOVE SQLCODE    TO TM500-SQLCODE                       44560003
445700           MOVE SQLCODE    TO RC001-SAVE-SQLCODE                  44570003
445800           MOVE SPACES     TO TM501-TM500-RETURN-MSG              44580003
445900           MOVE '821'      TO TM501-PGM                           44590003
446000           MOVE '6100'     TO TM501-PARA                          44600010
446100           MOVE 'RCT0000'  TO TM501-TBL                           44610004
446200           MOVE 53         TO TM501-PRORATION-ERROR-NBR           44620004
446300           PERFORM TM501-SET-TM500-RETURN-MSG                     44630004
446400           PERFORM RC001-RETURN-MSG                               44640004
446500                                                                  44650004
446600     END-EVALUATE.                                                44660004
446700                                                                  44670004
446800                                                                  44680004
446900* -------------------------------------------------------------- *44690004
447000* -------------------------------------------------------------- *44700004
447100                                                                  44710004
447200 7000-CALL-PRORATION-ROUTINE.                                     44720004
447300                                                                  44730004
447400     MOVE '7000-CALL-PRORATION-ROUTINE' TO RC001-PARAGRAPH.       44740034
447500                                                                  44750004
447600     MOVE TM500-FIELDS TO RC824-TM500-FIELDS.                     44760016
447700                                                                  44770004
447800     EXEC CICS                                                    44780004
447900         LINK PROGRAM  (PC-RCKCS824)                              44790004
448000              COMMAREA (RC824-COMMAREA)                           44800016
448100              RESP     (PV-CICS-RESP)                             44810004
448200     END-EXEC.                                                    44820004
448300                                                                  44830004
448400                                                                  44840004
448500     MOVE RC824-TM500-FIELDS TO TM500-FIELDS.                     44850016
448600                                                                  44860003
448700                                                                  44870003
448800*    ----------------------                                       44880003
448900*    CHECK CICS RETURN CODE                                       44890003
449000*    ----------------------                                       44900003
449100                                                                  44910003
449200     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    44920003
449300         SET PS-DONE-YES TO TRUE                                  44930003
449400         MOVE SPACES     TO TM501-TM500-RETURN-MSG                44940003
449500         MOVE '821'      TO TM501-PGM                             44950003
449600         MOVE '7000'     TO TM501-PARA                            44960004
449700         MOVE 54         TO TM501-PRORATION-ERROR-NBR             44970003
449800         PERFORM TM501-SET-TM500-RETURN-MSG                       44980003
449900         PERFORM RC001-RETURN-MSG                                 44990003
450000     END-IF.                                                      45000003
450100                                                                  45010003
450200                                                                  45020000
450300     EVALUATE TRUE                                                45030000
450400                                                                  45040000
450500       WHEN TM500-CALL-SUCCESSFUL                                 45050000
450600       WHEN TM500-DUPLICATE-TROUBLE                               45060036
450700       WHEN TM500-TTRBNTF-UPDATE-NOT-FND                          45070036
450800           CONTINUE                                               45080000
450900                                                                  45090003
451000       WHEN OTHER                                                 45100003
451100           SET PS-DONE-YES TO TRUE                                45110003
451200                                                                  45120003
451300     END-EVALUATE.                                                45130003
451400                                                                  45140003
451500                                                                  45150003
451600* -------------------------------------------------------------- *45160003
451700*    WRITE THE RECEIVER QUEUE COMPONENT                           45170003
451800* -------------------------------------------------------------- *45180003
451900                                                                  45190003
452000 8100-WRITE-TEMP-RECEIVER-QUEUE.                                  45200003
452100                                                                  45210003
452200     MOVE '8100-WRITE-TEMP-RECEIVER-QUEUE' TO RC001-PARAGRAPH.    45220034
452300                                                                  45230003
452400     EXEC CICS WRITEQ TS                                          45240003
452500        QUEUE  (PV-QUEUE-NAME)                                    45250003
452600        FROM   (RC821-PO-RECEIVER-CONTENTS)                       45260013
452700        ITEM   (PV-ITEM)                                          45270003
452800        RESP   (PV-CICS-RESP)                                     45280003
452900     END-EXEC.                                                    45290003
453000                                                                  45300003
453100     IF PV-CICS-RESP NOT EQUAL DFHRESP (NORMAL)                   45310003
453200         SET PS-DONE-YES TO TRUE                                  45320003
453300         MOVE SPACES TO TM501-TM500-RETURN-MSG                    45330003
453400         MOVE '821'  TO TM501-PGM                                 45340003
453500         MOVE '8100' TO TM501-PARA                                45350003
453600         MOVE 55     TO TM501-PRORATION-ERROR-NBR                 45360003
453700         PERFORM TM501-SET-TM500-RETURN-MSG                       45370003
453800         PERFORM RC001-RETURN-MSG                                 45380003
453900     END-IF.                                                      45390003
454000                                                                  45400003
454100                                                                  45410003
454200* -------------------------------------------------------------- *45420003
454300*    WRITE THE STORE QUEUE COMPONENT                              45430003
454400* -------------------------------------------------------------- *45440003
454500                                                                  45450003
454600 8110-WRITE-TEMP-STORE-QUEUE.                                     45460003
454700                                                                  45470003
454800     MOVE '8110-WRITE-TEMP-STORE-QUEUE' TO RC001-PARAGRAPH.       45480034
454900                                                                  45490003
455000     EXEC CICS WRITEQ TS                                          45500003
455100        QUEUE  (PV-QUEUE-NAME)                                    45510003
455200        FROM   (RC821-STORE-COMPONENTS)                           45520013
455300        ITEM   (PV-ITEM)                                          45530003
455400        RESP   (PV-CICS-RESP)                                     45540003
455500     END-EXEC.                                                    45550003
455600                                                                  45560003
455700     IF PV-CICS-RESP NOT EQUAL DFHRESP (NORMAL)                   45570003
455800         SET PS-DONE-YES TO TRUE                                  45580003
455900         MOVE SPACES TO TM501-TM500-RETURN-MSG                    45590003
456000         MOVE '821'  TO TM501-PGM                                 45600003
456100         MOVE '8110' TO TM501-PARA                                45610003
456200         MOVE 56     TO TM501-PRORATION-ERROR-NBR                 45620003
456300         PERFORM TM501-SET-TM500-RETURN-MSG                       45630003
456400         PERFORM RC001-RETURN-MSG                                 45640003
456500     END-IF.                                                      45650003
456600                                                                  45660003
456700                                                                  45670003
456800* -------------------------------------------------------------- *45680003
456900*    WRITE THE ITEM QUEUE COMPONENT                               45690003
457000* -------------------------------------------------------------- *45700003
457100                                                                  45710003
457200 8120-WRITE-TEMP-ITEM-QUEUE.                                      45720003
457300                                                                  45730003
457400     MOVE '8120-WRITE-TEMP-ITEM-QUEUE' TO RC001-PARAGRAPH.        45740034
457500                                                                  45750000
457600     EXEC CICS WRITEQ TS                                          45760000
457700        QUEUE  (PV-QUEUE-NAME)                                    45770000
457800        FROM   (RC821-ITEM-COMPONENTS (PV-ITEM))                  45780013
457900        ITEM   (PV-ITEM)                                          45790000
458000        RESP   (PV-CICS-RESP)                                     45800000
458100     END-EXEC.                                                    45810000
458200                                                                  45820000
458300     IF PV-CICS-RESP NOT EQUAL DFHRESP (NORMAL)                   45830000
458400         SET PS-DONE-YES TO TRUE                                  45840000
458500         MOVE SPACES TO TM501-TM500-RETURN-MSG                    45850000
458600         MOVE '821'  TO TM501-PGM                                 45860000
458700         MOVE '8120' TO TM501-PARA                                45870003
458800         MOVE 57     TO TM501-PRORATION-ERROR-NBR                 45880003
458900         PERFORM TM501-SET-TM500-RETURN-MSG                       45890003
459000         PERFORM RC001-RETURN-MSG                                 45900003
459100     END-IF.                                                      45910003
459200                                                                  45920003
459300                                                                  45930003
459400* -------------------------------------------------------------- *45940003
459500*    DELETE TEMP QUEUES                                           45950003
459600* -------------------------------------------------------------- *45960003
459700                                                                  45970003
459800 9000-DELETE-ALL-TEMP-QUEUES.                                     45980003
459900                                                                  45990003
460000     MOVE '9000-DELETE-ALL-TEMP-QUEUES' TO RC001-PARAGRAPH.       46000034
460100                                                                  46010003
460200     MOVE TM500-FIELDS              TO DFHCOMMAREA.               46020003
460300                                                                  46030003
460400     MOVE RC823-RECEIVER-QUEUE-NAME TO PV-QUEUE-NAME.             46040016
460500                                                                  46050003
460600     PERFORM 9100-DELETE-TEMP-QUEUE.                              46060010
460700                                                                  46070003
460800     MOVE RC823-STORE-QUEUE-NAME    TO PV-QUEUE-NAME.             46080016
460900                                                                  46090003
461000     PERFORM 9100-DELETE-TEMP-QUEUE.                              46100010
461100                                                                  46110003
461200     MOVE RC823-ITEM-QUEUE-NAME     TO PV-QUEUE-NAME.             46120016
461300                                                                  46130003
461400     PERFORM 9100-DELETE-TEMP-QUEUE.                              46140010
461500                                                                  46150003
461600                                                                  46160003
461700* -------------------------------------------------------------- *46170003
461800* -------------------------------------------------------------- *46180003
461900                                                                  46190003
462000 9100-DELETE-TEMP-QUEUE.                                          46200010
462100                                                                  46210003
462200     MOVE '9100-DELETE-TEMP-QUEUE' TO RC001-PARAGRAPH.            46220034
462300                                                                  46230003
462400     EXEC CICS DELETEQ TS                                         46240003
462500         QUEUE  (PV-QUEUE-NAME)                                   46250003
462600         RESP   (PV-CICS-RESP)                                    46260003
462700     END-EXEC.                                                    46270003
462800                                                                  46280003
462900     IF PV-CICS-RESP NOT EQUAL DFHRESP (NORMAL) AND               46290003
463000        PV-CICS-RESP NOT EQUAL DFHRESP (QIDERR)                   46300003
463100         SET PS-DONE-YES TO TRUE                                  46310003
463200         MOVE SPACES TO TM501-TM500-RETURN-MSG                    46320003
463300         MOVE '821'  TO TM501-PGM                                 46330003
463400         MOVE '9100' TO TM501-PARA                                46340010
463500         MOVE 58     TO TM501-PRORATION-ERROR-NBR                 46350003
463600         PERFORM TM501-SET-TM500-RETURN-MSG                       46360003
463700         PERFORM RC001-RETURN-MSG                                 46370003
463800     END-IF.                                                      46380003
463900                                                                  46390003
464000                                                                  46400003
464100******************************************************************46410018
464200*                                                                *46420018
464300*        W R I T E   A B E N D S   T O   C I C S   L O G         *46430018
464400*                                                                *46440018
464500******************************************************************46450018
464600* -------------------                                             46460018
464700*    COPY RCPD001.                                                46470018
464800* -------------------                                             46480018
464900 RC001-RETURN-MSG.                                                46490018
465000                                                                  46500018
465100     EXEC CICS                                                    46510018
465200         ASSIGN                                                   46520018
465300         USERID (RC001-USERID)                                    46530018
465400     END-EXEC.                                                    46540018
465500                                                                  46550018
465600     MOVE SQLCODE TO RC001-SAVE-SQLCODE.                          46560018
465700                                                                  46570018
465800     EXEC SQL                                                     46580018
465900         SELECT CURRENT_DATE                                      46590018
466000              , CURRENT_TIME                                      46600018
466100         INTO  :RC001-DATE                                        46610018
466200             , :RC001-TIME                                        46620018
466300         FROM TCOCNTL                                             46630018
466400     END-EXEC.                                                    46640018
466500                                                                  46650018
466600*GET THE QUEUE.                                                   46660018
466700     EXEC CICS                                                    46670018
466800         ENQ                                                      46680018
466900         RESOURCE (RC001-LOG-QUEUE)                               46690018
467000     END-EXEC.                                                    46700018
467100                                                                  46710018
467200*WRITE RC001-LINE-01.                                             46720018
467300     MOVE RC001-LINE-01            TO RC001-LOG-LINE.             46730018
467400     PERFORM RC001-WRITE-CSSL.                                    46740018
467500                                                                  46750018
467600*WRITE RC001-LINE-02.                                             46760018
467700     MOVE RC001-SAVE-SQLCODE       TO RC001-SQLCODE.              46770018
467800     MOVE RC001-LINE-02            TO RC001-LOG-LINE.             46780018
467900     PERFORM RC001-WRITE-CSSL.                                    46790018
468000                                                                  46800018
468100*WRITE RC001-LINE-03.                                             46810018
468200     MOVE TM500-PO-NBR             TO RC001-PO-NBR.               46820018
468300     MOVE TM500-REC-SEQ-NBR        TO RC001-REC-SEQ-NBR.          46830018
468400     MOVE RC821-REC-DRV-LNE-NBR    TO RC001-PO-LNE-NBR.           46840018
468500     MOVE TM500-OPER-UNT-ID        TO RC001-OPER-UNT-ID.          46850018
468600     MOVE TM500-FCLTY-ID           TO RC001-FCLTY-ID.             46860018
468700     MOVE RC821-PREPK-ID           TO RC001-PREPK-ID.             46870018
468800                                                                  46880018
468900     MOVE RC001-LINE-03            TO RC001-LOG-LINE.             46890018
469000     PERFORM RC001-WRITE-CSSL.                                    46900018
469100                                                                  46910018
469200*WRITE RC001-LINE-04.                                             46920018
469300     MOVE RC001-LINE-04            TO RC001-LOG-LINE.             46930018
469400     PERFORM RC001-WRITE-CSSL.                                    46940018
469500                                                                  46950018
469600*WRITE RC001-LINE-05.                                             46960018
469700     MOVE RC001-LINE-05            TO RC001-LOG-LINE.             46970018
469800     PERFORM RC001-WRITE-CSSL.                                    46980018
469900                                                                  46990018
470000*RELEASE THE QUEUE.                                               47000018
470100     EXEC CICS                                                    47010018
470200         DEQ                                                      47020018
470300         RESOURCE (RC001-LOG-QUEUE)                               47030018
470400     END-EXEC.                                                    47040018
470500                                                                  47050018
470600*RETURN TO CALLING PROGRAM                                        47060018
470700     PERFORM RC001-GOBACK.                                        47070018
470800                                                                  47080018
470900******************************************************************47090018
471000 RC001-WRITE-CSSL.                                                47100018
471100                                                                  47110018
471200     EXEC CICS                                                    47120018
471300         WRITEQ TD                                                47130018
471400             QUEUE (RC001-LOG-QUEUE)                              47140018
471500             FROM  (RC001-LOG-LINE)                               47150018
471600             RESP  (RC001-CICS-RESPONSE)                          47160018
471700     END-EXEC.                                                    47170018
471800                                                                  47180018
471900     IF RC001-CICS-RESPONSE = DFHRESP(NORMAL)                     47190018
472000         CONTINUE                                                 47200018
472100     ELSE                                                         47210018
472200         EXEC CICS                                                47220018
472300              ABEND                                               47230018
472400              ABCODE (EIBTRMID)                                   47240018
472500         END-EXEC                                                 47250018
472600     END-IF.                                                      47260018
472700                                                                  47270018
472800******************************************************************47280018
472900 RC001-GOBACK.                                                    47290018
473000                                                                  47300018
473100     PERFORM 9000-DELETE-ALL-TEMP-QUEUES.                         47310018
473200                                                                  47320018
473300     GOBACK.                                                      47330018
473400                                                                  47340018
473500******************************************************************47350018
473600     COPY TMPD501.                                                47360018
473700******************************************************************47370018
