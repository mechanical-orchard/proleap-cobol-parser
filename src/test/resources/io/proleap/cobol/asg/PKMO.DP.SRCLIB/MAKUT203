000100 IDENTIFICATION DIVISION.                                         00010009
000200 PROGRAM-ID.      MAKUT203.                                       00020009
000300 AUTHOR.          L. GRIESBACH.                                   00030009
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040009
000500 DATE-WRITTEN.    01-30-2003.                                     00050009
000600                                                                  00060009
000700***************************************************************** 00070009
000800** THIS PROGRAM PROCESSES THE BUSINESS EVENT "STYLE RECLASS"   ** 00080009
000900** I.E. EVENT ID 10.                                           ** 00090009
001000**                                                             ** 00100009
001100** IF THE SKU RECLASSIFY PROCESS FINDS THAT THE SKU'S SCL DOES ** 00110009
001200** NOT EXIST ON TITMCLT, AN ERROR RECORD WILL BE WRITTEN.      ** 00120009
001300** THE REMAINING PROCESSING FOR THAT SKU WILL BE COMPLETED.    ** 00130009
001400**                                                             ** 00140009
001500** WS-DEBUG WAS LEFT IN THE PROGRAM FOR FUTURE TESTING         ** 00150009
001600** PURPOSES.  SINCE MULTIPLE SKUS ARE SELECTED FOR EACH        ** 00160009
001700** VS-ID AND SUBCL-MDSE-ID, IT PROVIDES SOME CONTROL OVER      ** 00170009
001800** WHAT GETS PROCESSED.                                        ** 00180009
001900***************************************************************** 00190009
002000*    WR/PITS#     DATE        DESCRIPTION                       * 00200009
002100*    --------   --------   -----------------------------------  * 00210009
002200*    WR#33158  07/23/2007  CHANGED TO DO COMMIT AFTER EVERY       00220009
002300*                          1000 RECORDS INSTEAD OF JUST AT END    00230009
070941******************************************************************00240009
070941* DATE:         07/30/2018                                       *00250009
070941* WR/IR#:       CHG0205458                                       *00260009
070941* PROGRAMMER:   COGNIZANT                                        *00270009
070941* DESCRIPTION:  ORACLE LOGON STANDARDS PROGRAM CHANGE            *00280009
070941******************************************************************00290009
070941******************************************************************00291009
070941* DATE:         08/22/2022                                       *00292009
070941* WR/IR#:       CHG0                                             *00293009
070941* PROGRAMMER:   BOB MCASEY                                       *00294009
070941* DESCRIPTION:  REMOVED MAJORITY OF DISPLAYS (ONLY RETAINING     *00295009
070941*               THOSE FOR ABEND SITUATIONS) UPDATED COMMIT LOGIC *00295109
070941*               TO ACTUALLY COMMIT AFTER EVERY 1000 INS/UPD      *00295209
070941*               INSTEAD OF RECORDS READ.                         *00295309
\70941******************************************************************00295409
002400******************************************************************00295509
002500 ENVIRONMENT DIVISION.                                            00295609
002600 CONFIGURATION SECTION.                                           00295709
002700                                                                  00295809
002800 SOURCE-COMPUTER.       IBM-3090.                                 00295909
002900 OBJECT-COMPUTER.       IBM-3090.                                 00296009
003000                                                                  00297009
003100 INPUT-OUTPUT SECTION.                                            00298009
003200                                                                  00299009
003300 FILE-CONTROL.                                                    00300009
003400     SELECT RECLASSIFY-FILE         ASSIGN TO INP01.              00310009
003500                                                                  00320009
003600     SELECT ERROR-FILE              ASSIGN TO OUT01.              00330009
003700                                                                  00340009
003701     SELECT ORACLE-LOGON-FILE       ASSIGN TO ORALOGON.           00350009
003710                                                                  00360009
003800 DATA DIVISION.                                                   00370009
003900 FILE SECTION.                                                    00380009
004000                                                                  00390009
004100 FD  RECLASSIFY-FILE                                              00400009
004200     RECORDING MODE F                                             00410009
004300     LABEL RECORDS OMITTED                                        00420009
004400     BLOCK CONTAINS  0 RECORDS.                                   00430009
004500 01  RECLASSIFY-RECORD              PIC X(450).                   00440009
004600                                                                  00450009
004700 FD  ERROR-FILE                                                   00460009
004800     RECORDING MODE F                                             00470009
004900     LABEL RECORDS OMITTED                                        00480009
005000     BLOCK CONTAINS  0 RECORDS.                                   00490009
005100 01  ERROR-RECORD                   PIC X(70).                    00500009
005200                                                                  00510009
005210 FD  ORACLE-LOGON-FILE                                            00520009
005220     RECORDING MODE IS F                                          00530009
005230     LABEL RECORDS ARE STANDARD                                   00540009
005240     BLOCK CONTAINS 0 RECORDS                                     00550009
005250     RECORD CONTAINS 80 CHARACTERS                                00560009
005260     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00570009
005270 01  OL-ORACLE-LOGON-RECORD          PIC X(80).                   00580009
005280                                                                  00590009
005300 WORKING-STORAGE SECTION.                                         00600009
005400 01  WS-SWITCHES.                                                 00610009
005410     05  PS-END-OF-LOGON-FILE-SW    PIC X(01)    VALUE 'N'.       00620009
005420         88  PS-END-OF-LOGON-FILE                VALUE 'Y'.       00630009
005430     05  PS-END-OF-PROC-INST-FILE-SW PIC X(01)   VALUE 'N'.       00640009
005440         88  PS-END-OF-PROC-INST-FILE            VALUE 'Y'.       00650009
005450         88  PS-NOT-END-OF-PROC-INST-FILE        VALUE 'N'.       00660009
005460     05  PS-ORA-SRC-CTL-DONE-SW     PIC X(01)    VALUE 'N'.       00670009
005470         88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.       00680009
005500     05  WS-SCL-SW                  PIC X(1)     VALUE 'N'.       00690009
005600         88  SCL-FOUND                           VALUE 'Y'.       00700009
005700         88  SCL-NOT-FOUND                       VALUE 'N'.       00710009
005800     05  WS-SEARCH-SW               PIC X(1)     VALUE 'N'.       00720009
005900         88  END-OF-SEARCH                       VALUE 'Y'.       00730009
006000         88  NOT-END-OF-SEARCH                   VALUE 'N'.       00740009
006100     05  WS-RESET-REL-SW            PIC X(1)     VALUE 'N'.       00750009
006200         88  RESET-ADHOC-REL                     VALUE 'Y'.       00760009
006300         88  DO-NOT-RESET-ADHOC-REL              VALUE 'N'.       00770009
006400     05  WS-SKU-FOUND-SW            PIC X(1)     VALUE 'N'.       00780009
006500         88  SKU-FOUND                           VALUE 'Y'.       00790009
006600         88  SKU-NOT-FOUND                       VALUE 'N'.       00800009
006700     05  WS-FIRST-TUPC-FETCH-SW     PIC X(1)     VALUE 'Y'.       00810009
006800         88  FIRST-TUPC-FETCH                    VALUE 'Y'.       00820009
006900         88  NOT-FIRST-TUPC-FETCH                VALUE 'N'.       00830009
007000     05  WS-BYPASS-SKU-SW           PIC X(1)     VALUE 'N'.       00840009
007100         88  BYPASS-SKU                          VALUE 'Y'.       00850009
007200         88  DO-NOT-BYPASS-SKU                   VALUE 'N'.       00860009
007300     05  WS-RECLASSIFY-FILE-SW      PIC X(1)     VALUE 'N'.       00870009
007400         88  RECLASSIFY-EOF                      VALUE 'Y'.       00880009
007500         88  RECLASSIFY-NOT-EOF                  VALUE 'N'.       00890009
007600     05  WS-SKU-SW                  PIC X(1)     VALUE 'Y'.       00900009
007700         88  MORE-SKUS                           VALUE 'Y'.       00910009
007800         88  NO-MORE-SKUS                        VALUE 'N'.       00920009
007900     05  WS-CLC-RELATIONSHIPS-SW    PIC X(1)     VALUE 'Y'.       00930009
008000         88  MORE-CLC-RELATIONSHIPS              VALUE 'Y'.       00940009
008100         88  NO-MORE-CLC-RELATIONSHIPS           VALUE 'N'.       00950009
008200     05  WS-VND-ON-CLT-SW           PIC X(1)     VALUE 'N'.       00960009
008300         88  VND-ON-CLT                          VALUE 'Y'.       00970009
008400         88  VND-NOT-ON-CLT                      VALUE 'N'.       00980009
008500     05  WS-VND-INFO-SW             PIC X(1)     VALUE 'N'.       00990009
008600         88  VND-INFO-FOUND                      VALUE 'Y'.       01000009
008700         88  VND-INFO-NOT-FOUND                  VALUE 'N'.       01010009
008800     05  WS-UPD-ROWS-SW             PIC X(1)     VALUE 'N'.       01020009
008900         88  MORE-UPD-ROWS                       VALUE 'Y'.       01030009
009000         88  NO-MORE-UPD-ROWS                    VALUE 'N'.       01040009
009100     05  WS-E-ITM-SW                PIC X(1)     VALUE 'N'.       01050009
009200         88  E-ITM                               VALUE 'Y'.       01060009
009300         88  NOT-E-ITM                           VALUE 'N'.       01070009
009400     05  WS-SKU-FOUND-SW            PIC X(1)     VALUE 'Y'.       01080009
009500         88  SKU-FOUND-BY-DPT-SCL                VALUE 'Y'.       01090009
009600         88  SKU-NOT-FOUND-BY-DPT-SCL            VALUE 'N'.       01100009
009700                                                                  01110009
009720 01  CC-ORACLE-CONNECTION.                                        01120009
009730     05  CC-ORACLE-USERID             PIC X(40).                  01130009
009740         88 CC-AUTO-LOGON                         VALUE '/'.      01140009
009750     05  CC-ORACLE-PASSWORD           PIC X(40).                  01150009
009770                                                                  01160009
009800 01  WS-CONSTANTS.                                                01170009
009810     05  PC-AUTO-LOGON              PIC X(01)    VALUE '/'.       01180009
009900     05  WS-MAX-SIZE                PIC S9(9)    COMP             01190009
010000                                                 VALUE 512.       01200009
010100     05  WS-INITIAL-END-TMST        PIC X(19)    VALUE            01210009
010200                                    '0000-00-00-23.59.59'.        01220009
010300     05  WS-NO-SKU-DESCRIPTION      PIC X(40)    VALUE            01230009
010400                       'NO SKU DESCRIPTION FOUND                '.01240009
010500     05  WS-MSGS.                                                 01250009
010600         10  WS-SCL-NOT-FOUND       PIC X(50)    VALUE            01260009
010700             'SCL NOT FOUND ON TITMCLT:                         '.01270009
010800                                                                  01280009
010900 01  WS-VARIABLES.                                                01290009
010910     05  PV-ORACLE-USERID-LEN       PIC S9(04)   VALUE ZEROS      01300009
010920                                                 COMP SYNC.       01310009
010930     05  PV-ORACLE-PASSWORD-LEN     PIC S9(04)   VALUE ZEROS      01320009
010940                                                 COMP SYNC.       01330009
011000     05  WS-DEBUG                   PIC S9(3)    COMP-3           01340009
011100                                                 VALUE 0.         01350009
011200     05  WS-SUB                     PIC S9(5)    COMP-3.          01360009
011300     05  WS-DUMMY                   PIC X(10).                    01370009
011400     05  WS-E-ASRT-BEG-DTE          PIC X(19).                    01380009
011500     05  WS-E-ASRT-END-DTE          PIC X(19).                    01390009
011600     05  WS-WORK-VS-ID              PIC S9(9)    COMP-3.          01400009
011700     05  WS-WORK-DPT                PIC 9(4).                     01410009
011800     05  WS-WORK-DPT-X REDEFINES WS-WORK-DPT.                     01420009
011900         10  WS-WORK-DPT-1          PIC 9.                        01430009
012000         10  WS-WORK-DPT-2-4        PIC 9(3).                     01440009
012100     05  WS-WORK-MAJCL              PIC 9(4).                     01450009
012200     05  WS-WORK-MAJCL-X REDEFINES WS-WORK-MAJCL.                 01460009
012300         10  WS-WORK-MAJCL-1-2      PIC 9(2).                     01470009
012400         10  WS-WORK-MAJCL-3-4      PIC 9(2).                     01480009
012500     05  WS-WORK-SUBCL              PIC 9(4).                     01490009
012600     05  WS-WORK-SUBCL-X REDEFINES WS-WORK-SUBCL.                 01500009
012700         10  WS-WORK-SUBCL-1-2      PIC 9(2).                     01510009
012800         10  WS-WORK-SUBCL-3-4      PIC 9(2).                     01520009
012900     05  WS-WORK-SUBCL-Y.                                         01530009
013000         10  WS-WORK-SUBCL-Y-1      PIC 9(1).                     01540009
013100         10  WS-WORK-SUBCL-Y-2-4    PIC 9(3).                     01550009
013200     05  WS-DISPLAY-ITM-NBR         PIC 9(15).                    01560009
013300     05  WS-DISPLAY-VS-ID           PIC 9(9).                     01570009
013400     05  WS-DISPLAY-SUB-CL-MDSEAR-ID                              01580009
013500                                    PIC 9(6).                     01590009
013600     05  WS-DISPLAY-CLUSTR-ID       PIC 9(9).                     01600009
013700     05  WS-CPU-DATE.                                             01610009
013800         10  WS-CPU-YY              PIC 9(2)     VALUE ZEROS.     01620009
013900         10  WS-CPU-MM              PIC 9(2)     VALUE ZEROS.     01630009
014000         10  WS-CPU-DD              PIC 9(2)     VALUE ZEROS.     01640009
014100     05  WS-SETUP-DATE-10           PIC X(10).                    01650009
014200     05  WS-CURRENT-DATE            PIC X(10)    VALUE SPACES.    01660009
014300     05  WS-CURRENT-TMST-NEW        PIC X(19)    VALUE SPACES.    01670009
014400     05  WS-NEW-TMST                PIC X(19)    VALUE SPACES.    01680009
014500     05  WS-STAT-CHNGD-DATE         PIC X(7).                     01690009
014600     05  WS-DB2-DATE.                                             01700009
014700         10  WS-DB2-CC              PIC X(2)     VALUE SPACES.    01710009
014800         10  WS-DB2-YY              PIC X(2)     VALUE SPACES.    01720009
014900         10  FILLER                 PIC X(1)     VALUE '-'.       01730009
015000         10  WS-DB2-MO              PIC X(2)     VALUE SPACES.    01740009
015100         10  FILLER                 PIC X(1)     VALUE '-'.       01750009
015200         10  WS-DB2-DD              PIC X(2)     VALUE SPACES.    01760009
015300         10  FILLER                 PIC X(1)     VALUE '.'.       01770009
015400         10  WS-DB2-HH              PIC X(2)     VALUE '00'.      01780009
015500         10  FILLER                 PIC X(1)     VALUE '.'.       01790009
015600         10  WS-DB2-MM              PIC X(2)     VALUE '00'.      01800009
015700         10  FILLER                 PIC X(1)     VALUE '.'.       01810009
015800         10  WS-DB2-SS              PIC X(2)     VALUE '00'.      01820009
015900     05  WS-ABEND-CODE              PIC S9(4)    COMP SYNC        01830009
016000                                                 VALUE ZERO.      01840009
0822RM     05  FILLER                     PIC X(06)    VALUE 'COUNTS'.  01850009
016100     05  WS-READ-COUNT              PIC S9(9)    COMP-3           01860009
016200                                                 VALUE ZERO.      01870009
016300     05  WS-ERROR-COUNT             PIC S9(9)    COMP-3           01880009
016400                                                 VALUE ZERO.      01890009
016500     05  WS-RECORD-COUNT            PIC S9(5)    COMP-3           01900009
016600                                                 VALUE ZERO.      01910009
016700     05  WS-COMMIT-LEVEL            PIC S9(5)    COMP-3           01920009
0822RM*                                                VALUE +500.      01930009
0822RM                                                 VALUE 1000.      01940009
0822RM     05  WS-NBR-INS-UPD             PIC S9(9)    COMP-3           01950009
0822RM                                                 VALUE ZERO.      01960009
0822RM     05  WS-TOT-NBR-INS-UPD         PIC S9(9)    COMP-3           01970009
0822RM                                                 VALUE ZERO.      01980009
016900     05  WS-TOT-NBR-COMMITS         PIC S9(9)    COMP-3           01990009
017000                                                 VALUE ZERO.      02000009
017100     05  WS-MSG-TEXT                PIC X(512).                   02010009
017200     05  WS-MSG-LENGTH              PIC S9(9)    COMP.            02020009
017300     05  WS-VND-CLUSTR-NAME.                                      02030009
017400         10  WS-VND-CLUSTR-NAME-DESC                              02040009
017500                                    PIC X(10).                    02050009
017600         10  FILLER                 PIC X(1)     VALUE '-'.       02060009
017700         10  WS-VND-CLUSTR-NAME-ENT-ID                            02070009
017800                                    PIC 9(9).                     02080009
017900     05  WS-OLD-SKU-CLUSTR-ID       PIC S9(9)    COMP-3           02090009
018000                                                 VALUE 0.         02100009
018100     05  WS-NEW-SKU-CLUSTR-ID       PIC S9(9)    COMP-3           02110009
018200                                                 VALUE 0.         02120009
018300     05  WS-DPT-CLUSTR-ID           PIC S9(9)    COMP-3           02130009
018400                                                 VALUE 0.         02140009
018500     05  WS-SCL-CLUSTR-ID           PIC S9(9)    COMP-3           02150009
018600                                                 VALUE 0.         02160009
018700     05  WS-GRP-CLUSTR-ID           PIC S9(9)    COMP-3           02170009
018800                                                 VALUE 0.         02180009
018900     05  WS-VND-CLUSTR-ID           PIC S9(9)    COMP-3           02190009
019000                                                 VALUE 0.         02200009
019100     05  WS-VST-CLUSTR-ID          PIC S9(9)  COMP-3              02210009
019200                                                   VALUE 0.       02220009
019300     05 MDSEIT-KOHLS-SIZE-CDE      PIC S9(09) COMP VALUE ZERO.    02230009
019400     05 MDSEIT-NRF-CLOR-CDE        PIC X(03)       VALUE SPACES.  02240009
019500                                                                  02250009
019600 01  WS-ERROR-RECORD.                                             02260009
019700     05  WS-ERROR-MSG               PIC X(50).                    02270009
019800     05  WS-ERROR-DATA              PIC X(20).                    02280009
019900                                                                  02290009
020000 01  WS-SUBCLASS-TABLE.                                           02300009
020100     05  WS-SUBCLASSES              OCCURS 100 TIMES.             02310009
020200         10  WS-SUBCLASS            PIC X(20).                    02320009
020300                                                                  02330009
0822RM 01  FILLER                 PIC X(13) VALUE 'BEGIN IMRD008'.      02340009
020400     COPY IMRD008.                                                02350009
020500                                                                  02360009
020600                                                                  02370009
020700     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     02380009
020800                                                                  02390009
020900 01  USERNAME                       PIC X(10)    VARYING.         02400009
021000 01  PASSWD                         PIC X(10)    VARYING.         02410009
021100 01  PC-ORACLE-ID                   PIC X(1)     VALUE '/'.       02420009
021200                                                                  02430009
021300 01  WS-CURRENT-TMST                PIC X(19)    VALUE SPACES.    02440009
021400 01  WS-CURR-END-TMST               PIC X(19)    VALUE SPACES.    02450009
021500 01  WS-ITEM-CLUSTR-NAME            PIC X(20)    VALUE SPACES.    02460009
021600 01  WS-HOLD-DPT-SCL.                                             02470009
021700     05  WS-HOLD-DPT                PIC 9(3).                     02480009
021800     05  FILLER                     PIC X(1)     VALUE '-'.       02490009
021900     05  WS-HOLD-SCL                PIC 9(2).                     02500009
022000     05  FILLER                     PIC X(1)     VALUE '%'.       02510009
022100 01  WS-HOLD-DPT-SCL-REDEF          PIC X(7).                     02520009
022200 01  WS-OLD-SKU-NBR                 PIC X(20).                    02530009
022300 01  WS-NEW-SKU-NBR                 PIC X(20).                    02540009
022400 01  WS-UPC-NBR                     PIC S9(15)V  COMP-3.          02550009
022500 01  WS-UPC-NBR-REDEF-1             PIC 9(15).                    02560009
022600 01  WS-UPC-NBR-REDEF-2 REDEFINES WS-UPC-NBR-REDEF-1.             02570009
022700     10  WS-UPC-NBR-REDEF-1-6       PIC 9(6).                     02580009
022800     10  WS-UPC-NBR-REDEF-7-14      PIC 9(8).                     02590009
022900     10  WS-UPC-NBR-REDEF-15        PIC 9.                        02600009
023000 01  WS-UPC-NBR-CONVERSION-1        PIC S9(8)    COMP-3.          02610009
023100 01  WS-UPC-NBR-CONVERSION-2        PIC X(8)     VALUE SPACES.    02620009
023200 01  WS-WORK-CONVERSION             PIC X(7)     VALUE SPACES.    02630009
023300 01  WS-WORK-SKU                    PIC 9(8).                     02640009
023400 01  WS-ROWS-UPDATED                PIC S9(9)    COMP             02650009
023500                                                 VALUE ZERO.      02660009
023600 01  WS-ITEM-CLUSTR-DESC            PIC X(40)    VALUE SPACES.    02670009
023700*  TITMCLT NULL INDICATORS                                        02680009
023800 01  WS-CLT-EFF-END-DTE-NULL        PIC S9(4)    COMP.            02690009
023900 01  WS-CLUSTR-TYP-CDE-NULL         PIC S9(4)    COMP.            02700009
024000 01  WS-HIER-TYP-CDE-NULL           PIC S9(4)    COMP.            02710009
024100 01  WS-HIER-CDE-NULL               PIC S9(4)    COMP.            02720009
024200 01  WS-ITEM-CLUSTR-CDE-NULL        PIC S9(4)    COMP.            02730009
024300 01  WS-MDSE-NM-CDE-NULL            PIC S9(4)    COMP.            02740009
024400 01  WS-PROD-SERV-CDE-NULL          PIC S9(4)    COMP.            02750009
024500 01  WS-ARCH-DTE-NULL               PIC S9(4)    COMP.            02760009
024600 01  WS-OWNER-ID-NULL               PIC S9(4)    COMP.            02770009
024700 01  WS-SKU-NULL                    PIC S9(4)    COMP.            02780009
024800                                                                  02790009
024900*  TITMCLC NULL INDICATORS                                        02800009
025000 01  WS-CLC-EFF-END-DTE-NULL        PIC S9(4)    COMP.            02810009
025100 01  WS-CHLD-ITM-CLSTR-CDE-NULL     PIC S9(4)    COMP.            02820009
025200 01  WS-CHLD-ITM-UNT-QTY-NULL       PIC S9(4)    COMP.            02830009
025300                                                                  02840009
025400*  TMDSEIT NULL INDICATORS                                        02850009
025500 01  WS-STAT-CHNG-DTE-NULL          PIC S9(4)    COMP             02860009
025600                                                 VALUE ZERO.      02870009
025700 01  WS-SIZE-DESC-NULL              PIC S9(4)    COMP             02880009
025800                                                 VALUE ZERO.      02890009
025900 01  WS-COLOR-DESC-NULL             PIC S9(4)    COMP             02900009
026000                                                 VALUE ZERO.      02910009
026100 01  WS-VNDR-INHOUSE-NBR-NULL       PIC S9(4)    COMP             02920009
026200                                                 VALUE ZERO.      02930009
026300 01  WS-VNDR-STYL-ID-NULL           PIC S9(4)    COMP             02940009
026400                                                 VALUE ZERO.      02950009
026500 01  WS-UNIT-RTL-AMT-NULL           PIC S9(4)    COMP             02960009
026600                                                 VALUE ZERO.      02970009
026700 01  WS-UNIT-RTL-UOM-CDE-NULL       PIC S9(4)    COMP             02980009
026800                                                 VALUE ZERO.      02990009
026900 01  WS-GRP-QTY-NULL                PIC S9(4)    COMP             03000009
027000                                                 VALUE ZERO.      03010009
027100 01  WS-GRP-RTL-AMT-NULL            PIC S9(4)    COMP             03020009
027200                                                 VALUE ZERO.      03030009
027300 01  WS-ENT-ID-NULL                 PIC S9(4)    COMP             03040009
027400                                                 VALUE ZERO.      03050009
027500 01  WS-E-ASRT-BEG-DTE-NULL         PIC S9(4)    COMP             03060009
027600                                                 VALUE ZERO.      03070009
027700 01  WS-E-ASRT-END-DTE-NULL         PIC S9(4)    COMP             03080009
027800                                                 VALUE ZERO.      03090009
027900                                                                  03100009
0822RM     EXEC SQL                                                     03110009
0822RM       INCLUDE TITMCLC                                            03120009
0822RM     END-EXEC.                                                    03130009
028300                                                                  03140009
028000     EXEC SQL                                                     03150009
028100       INCLUDE TITMCLT                                            03160009
028200     END-EXEC.                                                    03170009
028300                                                                  03180009
028400     EXEC SQL                                                     03190009
028500       INCLUDE ITT00001                                           03200009
028600     END-EXEC.                                                    03210009
028700                                                                  03220009
028800     EXEC SQL                                                     03230009
028900       INCLUDE ITT00002                                           03240009
029000     END-EXEC.                                                    03250009
                                                                        03260009
029100     EXEC SQL                                                     03270009
029200       INCLUDE TSK                                                03280009
029300     END-EXEC.                                                    03290009
029400                                                                  03300009
029500     EXEC SQL                                                     03310009
029600       INCLUDE TMDSEAR                                            03320009
029700     END-EXEC.                                                    03330009
029800                                                                  03340009
029900* NOTE:   THIS IS IN HERE BECAUSE THE PKMO.ORACLE.DCLGEN          03350009
030000*       FOR TUPC IS INCORRECT IN NAMING CONVENTION, IT            03360009
030100*       DOES NOT INCLUDE THE UPC- BEFORE VARIABLE NAMES           03370009
030200*       CAUSING COMPILE ERRORS.                                   03380009
030300                                                                  03390009
030400 01  DCLTUPC.                                                     03400009
030500     10 UPC-UPC-ID                    PIC  S9(9) COMP.            03410009
030600     10 UPC-UPC-NBR                   PIC  S9(15)V COMP-3.        03420009
030700     10 UPC-SUB-CL-MDSEAR-ID          PIC  S9(6)V COMP-3.         03430009
030800     10 UPC-VS-ID                     PIC  S9(9) COMP.            03440009
030900     10 UPC-INTR-UPC-ID               PIC  S9(9) COMP.            03450009
031000     10 UPC-EFF-BEG-DTE               PIC   X(10).                03460009
031100     10 UPC-EFF-END-DTE               PIC   X(10).                03470009
031200     10 UPC-UPC-TYP-CDE               PIC   X(1).                 03480009
031300     10 UPC-KOHLS-SIZE-CDE            PIC  S9(9) COMP.            03490009
031400     10 UPC-NRF-SIZE-IND              PIC   X(1).                 03500009
031500     10 UPC-NRF-CLOR-CDE              PIC   X(3).                 03510009
031600     10 UPC-NRF-CLOR-IND              PIC   X(1).                 03520009
031700     10 UPC-CSTM-CLOR-DESC            PIC   X(10).                03530009
031800     10 UPC-EDI-ORD-IND               PIC   X(1).                 03540009
031900     10 UPC-PREPK-IND                 PIC   X(1).                 03550009
032000     10 UPC-GP-CDE                    PIC   X(3).                 03560009
032100     10 UPC-CERTD-IND                 PIC   X(1).                 03570009
032200     10 UPC-CERTD-DTE                 PIC   X(10).                03580009
032300     10 UPC-RPLNMT-IND                PIC   X(1).                 03590009
032400     10 UPC-KY-ITM-IND                PIC   X(1).                 03600009
032500     10 UPC-UNT-COST-1ST-AMT          PIC  S9(7)V9(3) COMP-3.     03610009
032600     10 UPC-UPC-SRC-CDE               PIC   X(1).                 03620009
032700     10 UPC-INNR-PK-QTY               PIC  S9(4) COMP.            03630009
032800     10 UPC-OUTR-PK-QTY               PIC  S9(4) COMP.            03640009
032900     10 UPC-SEA-SEQ-NBR               PIC  S9(4) COMP.            03650009
033000     10 UPC-CRE-BY-USR-ID             PIC   X(8).                 03660009
033100     10 UPC-LAST-UPD-BY-USR-ID        PIC   X(8).                 03670009
033200     10 UPC-LAST-UPD-TMST             PIC   X(26).                03680009
033300     10 UPC-WD-UM-QTY                 PIC  S9(4)V9(3) COMP-3.     03690009
033400     10 UPC-DPTH-UM-QTY               PIC  S9(4)V9(3) COMP-3.     03700009
033500     10 UPC-HT-UM-QTY                 PIC  S9(4)V9(3) COMP-3.     03710009
033600     10 UPC-SIZE-UM-CDE               PIC   X(2).                 03720009
033700     10 UPC-WT-UM-QTY                 PIC  S9(5)V9(3) COMP-3.     03730009
033800     10 UPC-WT-UM-CDE                 PIC   X(2).                 03740009
033900     10 UPC-POG-IND                   PIC   X(1).                 03750009
034000     10 UPC-REGN-PRIC-IND             PIC   X(1).                 03760009
034100     10 UPC-TX-PRD-CDE-SEQ-NBR        PIC  S9(4) COMP.            03770009
034200     10 UPC-CUSTFACG-CLOR-DESC        PIC   X(22).                03780009
034300     10 UPC-INTR-UPC-DESC             PIC   X(30).                03790009
034400                                                                  03800009
034500*    EXEC SQL                                                     03810009
034600*      INCLUDE TUPC                                               03820009
034700*    END-EXEC.                                                    03830009
034800                                                                  03840009
034900                                                                  03850009
035000*    TENTNME                                                      03860009
035100 01  DCLTENTNME.                                                  03870009
035200     10 ENTNME-ENT-ID             PIC S9(9) USAGE COMP.           03880009
035300     10 ENTNME-SEQ-NBR            PIC S9(4) USAGE COMP.           03890009
035400     10 ENTNME-ENT-NAME-DESC      PIC X(30) VALUE SPACES.         03900009
035500     10 ENTNME-TYPE-CDE           PIC X(2)  VALUE SPACES.         03910009
035600                                                                  03920009
035700     EXEC SQL                                                     03930009
035800       INCLUDE TSKXREF                                            03940009
035900     END-EXEC.                                                    03950009
036000                                                                  03960009
036100     EXEC SQL END DECLARE SECTION END-EXEC.                       03970009
036200                                                                  03980009
036300     EXEC SQL                                                     03990009
036400         INCLUDE SQLCA                                            04000009
036500     END-EXEC.                                                    04010009
036600                                                                  04020009
036700     COPY SQLCA2.                                                 04030009
036800                                                                  04040009
036900                                                                  04050009
037000 PROCEDURE DIVISION.                                              04060009
037100 M0000-MAINLINE.                                                  04070009
037200                                                                  04080009
037300     PERFORM A1000-INITIALIZE                                     04090009
037400        THRU A1000-EXIT.                                          04100009
037500                                                                  04110009
037600     PERFORM B1000-PROCESS-MESSAGES                               04120009
037700        THRU B1000-EXIT                                           04130009
037800       UNTIL RECLASSIFY-EOF.                                      04140009
037900                                                                  04150009
038000     PERFORM F1000-EOJ-PROCESSING                                 04160009
038100        THRU F1000-EXIT.                                          04170009
038200                                                                  04180009
038300     STOP RUN.                                                    04190009
038400                                                                  04200009
038500                                                                  04210009
038600 A1000-INITIALIZE.                                                04220009
038700                                                                  04230009
038800     OPEN INPUT  RECLASSIFY-FILE                                  04240009
038900          OUTPUT ERROR-FILE.                                      04250009
039000                                                                  04260009
039100     ACCEPT WS-CPU-DATE FROM DATE.                                04270009
039200                                                                  04280009
039300     STRING '20'       DELIMITED BY SIZE                          04290009
039400            WS-CPU-YY  DELIMITED BY SIZE                          04300009
039500            '-'        DELIMITED BY SIZE                          04310009
039600            WS-CPU-MM  DELIMITED BY SIZE                          04320009
039700            '-'        DELIMITED BY SIZE                          04330009
039800            WS-CPU-DD  DELIMITED BY SIZE                          04340009
039900       INTO WS-CURRENT-DATE.                                      04350009
040000                                                                  04360009
040100     MOVE WS-INITIAL-END-TMST TO WS-CURR-END-TMST.                04370009
040200     MOVE WS-CURRENT-DATE     TO WS-CURR-END-TMST(1:10).          04380009
040300                                                                  04390009
040400*********  LOGON TO ORACLE  *************************             04400009
040500                                                                  04410009
040510     PERFORM A1010-CONNECT-TO-ORACLE.                             04420009
043200                                                                  04430009
043300     EXEC SQL                                                     04440009
043400         ALTER SESSION                                            04450009
043500            SET NLS_DATE_FORMAT = 'YYYY-MM-DD.HH24.MI.SS'         04460009
043600     END-EXEC.                                                    04470009
043700                                                                  04480009
043800     EXEC SQL                                                     04490009
043900         SELECT SYSDATE                                           04500009
044000           INTO :WS-CURRENT-TMST                                  04510009
044100           FROM DUAL                                              04520009
044200     END-EXEC.                                                    04530009
044300                                                                  04540009
044400     DISPLAY 'SYSDATE = ' WS-CURRENT-TMST.                        04550009
044500     MOVE WS-CURRENT-TMST TO WS-CURRENT-TMST-NEW.                 04560009
044600                                                                  04570009
0822RM     INITIALIZE WS-SUBCLASS-TABLE.                                04571011
0822RM*    PERFORM VARYING WS-SUB FROM 1 BY 1                           04580011
0822RM*        UNTIL WS-SUB > 100                                       04590011
0822RM*            MOVE SPACES TO WS-SUBCLASS(WS-SUB)                   04600011
0822RM*    END-PERFORM.                                                 04610011
045100                                                                  04620009
045200*  THIS CURSOR IS USED TO RETRIEVE ALL THE SKUS UNDER             04630009
045300*  A VENDOR STYLE.  THE NI SKU NUMBER IS EMBEDDED WITHIN          04640009
045400*  THE UPC NUMBER.                                                04650009
045500     EXEC SQL                                                     04660009
045600       DECLARE TUPCCSR CURSOR FOR                                 04670009
045700         SELECT UPC_NBR,                                          04680009
045800                KOHLS_SIZE_CDE,                                   04690009
045900                NRF_CLOR_CDE                                      04700009
046000           FROM TUPC                                              04710009
046100          WHERE SUB_CL_MDSEAR_ID = :UPC-SUB-CL-MDSEAR-ID          04720009
046200            AND VS_ID            = :UPC-VS-ID                     04730009
046300            AND UPC_TYP_CDE      = 'I'                            04740009
046400            AND EFF_END_DTE IS NULL                               04750009
046500     END-EXEC.                                                    04760009
046600                                                                  04770009
046700*  THIS CURSOR IS USED TO RETRIEVE ALL TITMCLC RELATIONSHIPS      04780009
046800*  FOR A SKU                                                      04790009
046900     EXEC SQL                                                     04800009
047000       DECLARE CLCCSR CURSOR FOR                                  04810009
047100         SELECT B.PRNT_ITM_CLUSTR_ID,                             04820009
047200                B.CHLD_ITM_CLUSTR_ID                              04830009
047300           FROM TITMCLT A,                                        04840009
047400                TITMCLC B                                         04850009
047500          WHERE A.ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME     04860009
047600            AND A.HIER_CDE         IS NULL                        04870009
047700            AND A.ITEM_CLUSTR_CDE  = 'I'                          04880009
047800            AND B.REL_TYP_CDE      = 'M'                          04890009
047900            AND A.ITEM_CLUSTR_ID   = B.CHLD_ITM_CLUSTR_ID         04900009
048000            AND (A.EFF_END_TMST IS NULL                           04910009
048100                 OR A.EFF_END_TMST > :WS-CURR-END-TMST)           04920009
048200            AND (B.EFF_END_TMST IS NULL                           04930009
048300                 OR B.EFF_END_TMST > :WS-CURR-END-TMST)           04940009
048400     END-EXEC.                                                    04950009
048500                                                                  04960009
048600*  THIS CURSOR IS USED TO RETRIEVE ALL TITMCLC RELATIONSHIPS      04970009
048700*  FOR A SKU                                                      04980009
048800     EXEC SQL                                                     04990009
048900       DECLARE CLCCSR2 CURSOR FOR                                 05000009
049000         SELECT B.PRNT_ITM_CLUSTR_ID,                             05010009
049100                B.CHLD_ITM_CLUSTR_ID                              05020009
049200           FROM TITMCLT A,                                        05030009
049300                TITMCLC B                                         05040009
049400          WHERE A.ITEM_CLUSTR_ID   = :ITMCLT-ITEM-CLUSTR-ID       05050009
049500            AND B.REL_TYP_CDE      = 'M'                          05060009
049600            AND A.ITEM_CLUSTR_ID   = B.CHLD_ITM_CLUSTR_ID         05070009
049700            AND (B.EFF_END_TMST IS NULL                           05080009
049800                 OR B.EFF_END_TMST > :WS-CURR-END-TMST)           05090009
049900     END-EXEC.                                                    05100009
050000                                                                  05110009
050100     EXEC SQL                                                     05120009
050200         DECLARE UPDCSR CURSOR FOR                                05130009
050300            SELECT CHLD_ITM_CLUSTR_ID                             05140009
050400              FROM TITMCLC                                        05150009
050500             WHERE PRNT_ITM_CLUSTR_ID = :PRNT-ITM-CLUSTR-ID       05160009
050600               AND REL_TYP_CDE        = 'R'                       05170009
050700     END-EXEC.                                                    05180009
050800                                                                  05190009
050900 A1000-EXIT.                                                      05200009
051000     EXIT.                                                        05210009
051100                                                                  05220009
051110****************************************************************  05230009
051120*   CONNECT TO THE APPROPRIATE ORACLE SERVER.                  *  05240009
051130****************************************************************  05250009
051140 A1010-CONNECT-TO-ORACLE.                                         05260009
051150                                                                  05270009
051160     OPEN INPUT ORACLE-LOGON-FILE.                                05280009
051170                                                                  05290009
051180     PERFORM A1020-READ-ORACLE-LOGON.                             05300009
051190                                                                  05310009
051191     CLOSE ORACLE-LOGON-FILE.                                     05320009
051192                                                                  05330009
051193     IF ((PS-END-OF-LOGON-FILE)                                   05340009
051194             OR (CC-ORACLE-CONNECTION = SPACES))                  05350009
051195         DISPLAY '** ABEND **'                                    05360009
051196         DISPLAY 'MAKUT203 - ORACLE LOGON CONTROL CARD '          05370009
051197                   'NOT PROVIDED'                                 05380009
051198         SET PS-ORA-SRC-EMPTY TO TRUE                             05390009
051199         CALL 'ILBOABN0' USING WS-ABEND-CODE                      05400009
051200     END-IF.                                                      05410009
051201                                                                  05420009
051202     IF CC-AUTO-LOGON                                             05430009
051203         DISPLAY 'MAKUT203 - AUTO LOGON TO ORACLE'                05440009
051204         EXEC SQL                                                 05450009
051205              CONNECT :USERNAME                                   05460009
051206         END-EXEC                                                 05470009
051207     ELSE                                                         05480009
051208         INITIALIZE PV-ORACLE-USERID-LEN                          05490009
051209                    PV-ORACLE-PASSWORD-LEN                        05500009
051210         INSPECT CC-ORACLE-USERID                                 05510009
051211             TALLYING PV-ORACLE-USERID-LEN                        05520009
051212          FOR CHARACTERS BEFORE INITIAL SPACE                     05530009
051213      INSPECT CC-ORACLE-PASSWORD                                  05540009
051214          TALLYING PV-ORACLE-PASSWORD-LEN                         05550009
051215          FOR CHARACTERS BEFORE INITIAL SPACE                     05560009
051216      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           05570009
051217                USERNAME-ARR                                      05580009
051218      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   05590009
051219      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       05600009
051220                PASSWD-ARR                                        05610009
051221      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   05620009
051222      DISPLAY 'MAKUT203 - LOGON TO ORACLE AS USER '               05630009
051223                USERNAME-ARR                                      05640009
051224      EXEC SQL                                                    05650009
051225        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   05660009
051226      END-EXEC                                                    05670009
051227      INITIALIZE CC-ORACLE-PASSWORD                               05680009
051228                 PASSWD                                           05690009
051229      END-IF.                                                     05700009
051230                                                                  05710009
051231     IF (SQLCODE NOT = 0)                                         05720009
051232         DISPLAY 'A1010-CONNECT-TO-ORACLE'                        05730009
051233         DISPLAY 'MAKUT203 - ERROR LOGGING ON TO ORACLE'          05740009
051234         PERFORM U9999-ABEND-ROUTINE                              05750009
051235     END-IF.                                                      05760009
051236                                                                  05770009
051237****************************************************************  05780009
051238** READ THE ORACLE LOGON CONTROL CARD.                        **  05790009
051239****************************************************************  05800009
051240 A1020-READ-ORACLE-LOGON.                                         05810009
051241                                                                  05820009
051242     READ ORACLE-LOGON-FILE                                       05830009
051243         INTO CC-ORACLE-CONNECTION                                05840009
051244         AT END                                                   05850009
051245             SET PS-END-OF-LOGON-FILE TO TRUE                     05860009
051246     END-READ.                                                    05870009
051247                                                                  05880009
051250                                                                  05890009
051300 B1000-PROCESS-MESSAGES.                                          05900009
051400                                                                  05910009
051500     PERFORM B1100-READ-RECLASSIFY-FILE                           05920009
051600        THRU B1100-EXIT.                                          05930009
051700     IF RECLASSIFY-EOF                                            05940009
051800        GO TO B1000-EXIT                                          05950009
051900     END-IF.                                                      05960009
052000                                                                  05970009
052100     MOVE IM008-STYLE-RECL-DEPT-NEW  TO WS-WORK-DPT.              05980009
052200     MOVE IM008-STYLE-RECL-CLASS-NEW TO WS-WORK-MAJCL.            05990009
052300     MOVE IM008-STYLE-RECL-SUBCL-NEW TO WS-WORK-SUBCL-Y.          06000009
052400     MOVE WS-WORK-DPT-2-4            TO MDSEAR-DEPT-NBR.          06010009
052500     MOVE WS-WORK-MAJCL-3-4          TO MDSEAR-MAJ-CL-NBR.        06020009
052600     MOVE WS-WORK-SUBCL-Y-2-4        TO MDSEAR-SUB-CL-NBR.        06030009
052700                                                                  06040009
052800     PERFORM B1200-SELECT-TMDSEAR                                 06050009
052900        THRU B1200-EXIT.                                          06060009
053000                                                                  06070009
053100*  TUPC IS READ TO RETRIEVE THE NI SKU FROM THE UPC-NBR.          06080009
053200*  THE KEY FIELDS USED TO ACCESS ALL THE SKUS UNDER A VENDOR      06090009
053300*  STYLE ARE VS-ID AND SUB-CL-MDSEAR-ID.  WHEN A SKU IS           06100009
053400*  RECLASSIFIED IN VSM, THE RECORDS CONTAINING THE OLD VS-ID      06110009
053500*  AND THE OLD SUB-CL-MDSEAR-ID ARE DELETED FROM TUPC.  SO        06120009
053600*  TO ACCESS THE SKUS ON TUPC, WE NEED TO USE THE VS-ID AND       06130009
053700*  THE NEW SUB-CL-MDSEAR-ID.                                      06140009
053800                                                                  06150009
053900     IF SQLCODE = ZEROS                                           06160009
**TEMP*    DISPLAY 'AFTER B1200- SQLCDE 0 ' IM008-ITEM-KEY-VS-ID        06170009
054000         MOVE IM008-ITEM-KEY-VS-ID   TO WS-WORK-VS-ID             06180009
054100         MOVE WS-WORK-VS-ID          TO UPC-VS-ID                 06190009
054200         MOVE MDSEAR-DKEY            TO UPC-SUB-CL-MDSEAR-ID      06200009
054300     ELSE                                                         06210009
054400         GO TO B1000-EXIT                                         06220009
054500     END-IF.                                                      06230009
054600                                                                  06240009
**TEMP*        DISPLAY 'MDSEAR-DKEY ' MDSEAR-DKEY                       06250009
**TEMP*        DISPLAY 'UPC-VS-ID   ' UPC-VS-ID                         06260009
054700     PERFORM B1300-OPEN-TUPCCSR                                   06270009
054800        THRU B1300-EXIT.                                          06280009
054900                                                                  06290009
055000*  THERE ARE MULTIPLE SKUS CONTAINED WITHIN EACH RMS-STYL-ID      06300009
055100     SET MORE-SKUS         TO TRUE.                               06310009
055200     PERFORM UNTIL NO-MORE-SKUS                                   06320009
055300*      OR WS-DEBUG > 2                                            06330009
055400         PERFORM B1400-FETCH-TUPCCSR                              06340009
055500            THRU B1400-EXIT                                       06350009
055600*        ADD 1 TO WS-DEBUG                                        06360009
055700         IF MORE-SKUS                                             06370009
055800*          AND WS-DEBUG > 2                                       06380009
**TEMP*            DISPLAY 'MOVE TUPC RECS'                             06381009
055900             SET DO-NOT-BYPASS-SKU TO TRUE                        06382009
056000             PERFORM C1000-PROCESS-SKU                            06383009
056100                THRU C1000-EXIT                                   06384009
056200             IF DO-NOT-BYPASS-SKU                                 06385009
056300*  DO WE HAVE THE ITM-NBR FROM THE NI SKU LOOKUP ON TSKXREF?      06386009
056400                 IF SKXREF-ITM-NBR > ZEROS                        06387009
**TEMP*            DISPLAY 'SKXREF-ITM-NBR > ZEROS CALL B1500'          06388009
056500                     PERFORM B1500-CREATE-TMDSEIT-RCD             06389009
056600                        THRU B1500-EXIT                           06390009
056700                 END-IF                                           06400009
056800*  DID THE OLD SKU EXIST?                                         06410009
056900*  IF THE SKU WAS FOUND USING THE TITMCLT SKU COLUMN, WE NEED     06420009
057000*  TO EXPIRE THE OLD SKU RECORDS AND THEIR TITMCLC RELATIONSHIPS  06430009
057100*  VIA THE SKU ITEM-CLUSTR-ID                                     06440009
057200                 IF WS-OLD-SKU-CLUSTR-ID > ZEROS                  06450009
**TEMP*            DISPLAY 'WS-OLD-SKU-CLUSTR-ID > ZEROS '              06460009
057300                     IF SKU-FOUND-BY-DPT-SCL                      06470009
**TEMP*            DISPLAY 'SKU-FOUND-BY-DPT-SCL'                       06480009
057400                         MOVE WS-OLD-SKU-NBR                      06490009
057500                                 TO ITMCLT-ITEM-CLUSTR-NAME       06500009
057600                         PERFORM D1000-EXPIRE-EXIST-SKU-REL       06510009
057700                            THRU D1000-EXIT                       06520009
057800                     ELSE                                         06530009
057900                         MOVE WS-OLD-SKU-CLUSTR-ID                06540009
058000                                 TO ITMCLT-ITEM-CLUSTR-ID         06550009
058100                         PERFORM E1000-EXPIRE-EXIST-SKU-REL       06560009
058200                            THRU E1000-EXIT                       06570009
058300                     END-IF                                       06580009
058400                     PERFORM B1600-PROCESS-OLD-NEW-SKU-REL        06590009
058500                        THRU B1600-EXIT                           06600009
058600                     IF SQLCODE = ZEROS                           06610009
**TEMP*- TEMP LINES ADDED FOR TESTING AND COMMENTED OUT UPDATE CODE     06620009
**TEMP*           DISPLAY 'B1000- CALL B1700-UPDATE-TSKUSL00-TBLS'      06630009
**TEMP*           ADD 1 TO WS-NBR-INS-UPD                               06640009
                               PERFORM B1700-UPDATE-TSKUSL00-TBLS       06650009
                                  THRU B1700-EXIT                       06660009
**TEMP*           DISPLAY 'B1000- CALL B1800-UPDATE-PREV-RECLASS-REL'   06670009
**TEMP*           ADD 1 TO WS-NBR-INS-UPD                               06680009
                               PERFORM B1800-UPDATE-PREV-RECLASS-REL    06690009
                                  THRU B1800-EXIT                       06700009
059100                     END-IF                                       06710009
059200                 END-IF                                           06720009
059300             END-IF                                               06730009
059400         END-IF                                                   06740009
059500     END-PERFORM.                                                 06750009
059600                                                                  06760009
059700     PERFORM B1900-CLOSE-TUPCCSR                                  06770009
059800        THRU B1900-EXIT.                                          06780009
059900                                                                  06790009
0822RM*-- CHANGED COMPARE OF RECORD COUNT AND COMMIT LEVEL TO           06800009
0822RM*-- NUMBER OF INSERT-UPDATES AND COMMIT LEVEL                     06801009
0822RM*    ADD +1 TO WS-RECORD-COUNT.                                   06802009
**TEMP*    DISPLAY 'WS-NBR-INS-UPD '  WS-NBR-INS-UPD.                   06803009
0822RM*    IF WS-RECORD-COUNT >= WS-COMMIT-LEVEL                        06804009
0822RM     IF WS-NBR-INS-UPD  >= WS-COMMIT-LEVEL                        06805009
              PERFORM E2000-ORACLE-COMMIT                               06806009
                 THRU E2000-EXIT                                        06807009
0822RM*       MOVE ZERO TO WS-RECORD-COUNT                              06808009
0822RM        ADD 1 TO WS-TOT-NBR-COMMITS                               06809009
**TEMP*       DISPLAY 'B1000 INS-UPD COUNT ' WS-NBR-INS-UPD             06810009
0822RM        ADD WS-NBR-INS-UPD TO WS-TOT-NBR-INS-UPD                  06820009
0822RM        MOVE ZERO TO WS-NBR-INS-UPD                               06830009
060600     END-IF.                                                      06840009
060700                                                                  06850009
060800*    IF WS-DEBUG > 2                                              06860009
060900*        SET RECLASSIFY-EOF TO TRUE                               06870009
061000*    END-IF.                                                      06880009
061100                                                                  06890009
061200 B1000-EXIT.                                                      06900009
061300     EXIT.                                                        06910009
061400                                                                  06920009
061500                                                                  06930009
061600 B1100-READ-RECLASSIFY-FILE.                                      06940009
061700                                                                  06950009
061800     READ RECLASSIFY-FILE INTO IMRD008-RECORD                     06960009
061900         AT END                                                   06970009
062000             SET RECLASSIFY-EOF TO TRUE                           06980009
062100             GO TO B1100-EXIT.                                    06990009
062200                                                                  07000009
062300     ADD 1                      TO WS-READ-COUNT.                 07010009
**TEMP*    DISPLAY 'B1100 ' IMRD008-RECORD.                             07020009
062400                                                                  07030009
062500 B1100-EXIT.                                                      07040009
062600     EXIT.                                                        07050009
062700                                                                  07060009
062800                                                                  07070009
062900 B1200-SELECT-TMDSEAR.                                            07080009
063000                                                                  07090009
063100     EXEC SQL                                                     07100009
063200         SELECT MDSEAR_DKEY                                       07110009
063300           INTO :MDSEAR-DKEY                                      07120009
063400           FROM TMDSEAR                                           07130009
063500          WHERE OPERCO_NBR = '03'                                 07140009
063600            AND DEPT_NBR   = :MDSEAR-DEPT-NBR                     07150009
063700            AND MAJ_CL_NBR = :MDSEAR-MAJ-CL-NBR                   07160009
063800            AND SUB_CL_NBR = :MDSEAR-SUB-CL-NBR                   07170009
063900            AND MDSELV_CDE = 'SCL'                                07180009
064000            AND END_DTE    = '9999-09-09'                         07190009
064100     END-EXEC.                                                    07200009
064200                                                                  07210009
064300     EVALUATE TRUE                                                07220009
064400         WHEN SQLCODE = ZEROS                                     07230009
064500           CONTINUE                                               07240009
064600         WHEN SQLCODE = +1403                                     07250009
064700           DISPLAY 'B1200-SELECT-TMDSEAR'                         07260009
064800           DISPLAY 'RECORD NOT FOUND'                             07270009
064900           DISPLAY 'DEPT-NBR: ' MDSEAR-DEPT-NBR                   07280009
065000           DISPLAY 'MAJ-CL-NBR: ' MDSEAR-MAJ-CL-NBR               07290009
065100           DISPLAY 'SUB-CL-NBR: ' MDSEAR-SUB-CL-NBR               07300009
065200         WHEN OTHER                                               07310009
065300           DISPLAY 'B1200-SELECT-TMDSEAR'                         07320009
065400           DISPLAY 'DEPT-NBR: ' MDSEAR-DEPT-NBR                   07330009
065500           DISPLAY 'MAJ-CL-NBR: ' MDSEAR-MAJ-CL-NBR               07340009
065600           DISPLAY 'SUB-CL-NBR: ' MDSEAR-SUB-CL-NBR               07350009
065700           PERFORM U9999-ABEND-ROUTINE                            07360009
065800     END-EVALUATE.                                                07370009
065900                                                                  07380009
066000 B1200-EXIT.                                                      07390009
066100     EXIT.                                                        07400009
066200                                                                  07410009
066300                                                                  07420009
066400 B1300-OPEN-TUPCCSR.                                              07430009
066500                                                                  07440009
066600     EXEC SQL                                                     07450009
066700         OPEN TUPCCSR                                             07460009
066800     END-EXEC.                                                    07470009
066900                                                                  07480009
067000     EVALUATE TRUE                                                07490009
067100         WHEN SQLCODE = ZEROS                                     07500009
067200             CONTINUE                                             07510009
067300         WHEN OTHER                                               07520009
067400             DISPLAY 'B1300-OPEN-TUPCCSR'                         07530009
067500             PERFORM U9999-ABEND-ROUTINE                          07540009
067600     END-EVALUATE.                                                07550009
067700                                                                  07560009
067800 B1300-EXIT.                                                      07570009
067900     EXIT.                                                        07580009
068000                                                                  07590009
068100                                                                  07600009
068200 B1400-FETCH-TUPCCSR.                                             07610009
068300                                                                  07620009
068400     EXEC SQL                                                     07630009
068500         FETCH TUPCCSR                                            07640009
068600          INTO :UPC-UPC-NBR,                                      07650009
068700               :UPC-KOHLS-SIZE-CDE,                               07660009
068800               :UPC-NRF-CLOR-CDE                                  07670009
068900     END-EXEC.                                                    07680009
069000                                                                  07690009
069100     EVALUATE TRUE                                                07700009
069200         WHEN SQLCODE = ZEROS                                     07710009
069300            CONTINUE                                              07720009
069400         WHEN SQLCODE = +1403                                     07730009
069500            SET NO-MORE-SKUS TO TRUE                              07740009
069600         WHEN OTHER                                               07750009
069700            DISPLAY 'B1400-FETCH-TUPCCSR'                         07760009
069800            DISPLAY 'SUB-CL-MDSEAR-ID: ' UPC-SUB-CL-MDSEAR-ID     07770009
069900            DISPLAY 'VS-ID:            ' UPC-VS-ID                07780009
070000            PERFORM U9999-ABEND-ROUTINE                           07790009
070100     END-EVALUATE.                                                07800009
070200                                                                  07810009
070300 B1400-EXIT.                                                      07820009
070400     EXIT.                                                        07830009
070500                                                                  07840009
070600                                                                  07850009
070700 B1500-CREATE-TMDSEIT-RCD.                                        07860009
070800                                                                  07870009
070900     MOVE SKXREF-ITM-NBR TO TSK-ITEM-NMBR.                        07880009
071000     PERFORM B1510-SELECT-TSK-FOR-TMDSEIT                         07890009
071100        THRU B1510-EXIT.                                          07900009
071200                                                                  07910009
071300** BYPASS THE TMDSEIT INSERT WHEN THE ITEM DOES NOT EXIST ON TSK  07920009
071400     IF SQLCODE = +1403                                           07930009
071500         GO TO B1500-EXIT                                         07940009
071600     END-IF.                                                      07950009
071700                                                                  07960009
071800     SET NOT-E-ITM TO TRUE.                                       07970009
071900     IF WS-OLD-SKU-CLUSTR-ID > ZEROS                              07980009
072000         MOVE WS-OLD-SKU-CLUSTR-ID TO ITEM-CLUSTR-ID              07990009
072100         PERFORM B1530-SELECT-TMDSEIT                             08000009
072200            THRU B1530-EXIT                                       08010009
072300         IF SQLCODE = ZEROS                                       08020009
072400             IF E-ITM-IND = 'Y'                                   08030009
072500                 SET E-ITM TO TRUE                                08040009
072600                 MOVE E-ASRT-BEG-DTE TO WS-E-ASRT-BEG-DTE         08050009
072700                 MOVE E-ASRT-END-DTE TO WS-E-ASRT-END-DTE         08060009
072800             END-IF                                               08070009
072900         END-IF                                                   08080009
073000     END-IF.                                                      08090009
073100                                                                  08100009
073200     INITIALIZE ITT00002.                                         08110009
073300     MOVE WS-NEW-SKU-CLUSTR-ID  TO ITEM-CLUSTR-ID.                08120009
073400                                                                  08130009
073500     MOVE TSK-STATUS-CODE       TO STAT-CDE.                      08140009
073600     MOVE TSK-LONG-SIZE-DESC    TO SIZE-DESC.                     08150009
073700     MOVE TSK-LONG-COLOR-DESC   TO COLOR-DESC.                    08160009
073800     MOVE TSK-VNDR-IN-HSE-NMBR  TO VNDR-INHOUSE-NBR.              08170009
073900     MOVE TSK-LONG-VENDOR-STYLE TO VNDR-STYL-ID.                  08180009
074000     MOVE TSK-CUR-UNIT-RTL-AMT  TO UNIT-RTL-AMT.                  08190009
074100     MOVE TSK-RTL-UNIT-MSRMNT   TO UNIT-RTL-UOM-CDE.              08200009
074200     MOVE TSK-GP-QTY            TO GRP-QTY.                       08210009
074300     MOVE TSK-GP-RTL-AMT        TO GRP-RTL-AMT.                   08220009
074400     MOVE TSK-ENT-ID            TO ENT-ID.                        08230009
074500     IF E-ITM                                                     08240009
074600         MOVE 'Y'               TO E-ITM-IND                      08250009
074700         MOVE WS-E-ASRT-BEG-DTE TO E-ASRT-BEG-DTE                 08260009
074800         MOVE WS-E-ASRT-END-DTE TO E-ASRT-END-DTE                 08270009
074900         MOVE ZERO              TO WS-E-ASRT-BEG-DTE-NULL         08280009
075000                                   WS-E-ASRT-END-DTE-NULL         08290009
075100     ELSE                                                         08300009
075200         MOVE 'N'               TO E-ITM-IND                      08310009
075300         MOVE -1                TO WS-E-ASRT-BEG-DTE-NULL         08320009
075400                                   WS-E-ASRT-END-DTE-NULL         08330009
075500     END-IF.                                                      08340009
075600                                                                  08350009
075700     IF TSK-STAT-CHNGD-DATE > ZERO                                08360009
075800         IF TSK-STAT-CHNGD-DATE  = 9999999                        08370009
075900             MOVE -1 TO WS-STAT-CHNG-DTE-NULL                     08380009
076000         ELSE                                                     08390009
076100             MOVE TSK-STAT-CHNGD-DATE TO WS-STAT-CHNGD-DATE       08400009
076200             IF WS-STAT-CHNGD-DATE(2:2) < 80                      08410009
076300                 MOVE '20'                    TO WS-DB2-CC        08420009
076400                 MOVE WS-STAT-CHNGD-DATE(2:2) TO WS-DB2-YY        08430009
076500                 MOVE WS-STAT-CHNGD-DATE(4:2) TO WS-DB2-MO        08440009
076600                 MOVE WS-STAT-CHNGD-DATE(6:2) TO WS-DB2-DD        08450009
076700                 MOVE WS-DB2-DATE TO STAT-CHNG-DTE                08460009
076800                 MOVE ZERO        TO WS-STAT-CHNG-DTE-NULL        08470009
076900             ELSE                                                 08480009
077000                 MOVE '19'                    TO WS-DB2-CC        08490009
077100                 MOVE WS-STAT-CHNGD-DATE(2:2) TO WS-DB2-YY        08500009
077200                 MOVE WS-STAT-CHNGD-DATE(4:2) TO WS-DB2-MO        08510009
077300                 MOVE WS-STAT-CHNGD-DATE(6:2) TO WS-DB2-DD        08520009
077400                 MOVE WS-DB2-DATE TO STAT-CHNG-DTE                08530009
077500                 MOVE ZERO        TO WS-STAT-CHNG-DTE-NULL        08540009
077600            END-IF                                                08550009
077700         END-IF                                                   08560009
077800     ELSE                                                         08570009
077900         MOVE -1 TO WS-STAT-CHNG-DTE-NULL                         08580009
078000     END-IF.                                                      08590009
078100     MOVE UPC-KOHLS-SIZE-CDE         TO MDSEIT-KOHLS-SIZE-CDE.    08600009
078200     MOVE UPC-NRF-CLOR-CDE           TO MDSEIT-NRF-CLOR-CDE.      08610009
078300                                                                  08620009
**TEMP*    DISPLAY 'B1500 CALL B1520-INSERT-TMDSEIT'                    08630009
**TEMP*           ADD 1 TO WS-NBR-INS-UPD.                              08640009
           PERFORM B1520-INSERT-TMDSEIT                                 08650009
              THRU B1520-EXIT.                                          08660009
078600                                                                  08670009
078700 B1500-EXIT.                                                      08680009
078800     EXIT.                                                        08690009
078900                                                                  08700009
079000                                                                  08710009
079100 B1510-SELECT-TSK-FOR-TMDSEIT.                                    08720009
079200                                                                  08730009
079300     EXEC SQL                                                     08740009
079400         SELECT RTL_UNIT_MSRMNT,                                  08750009
079500                CUR_UNIT_RTL_AMT,                                 08760009
079600                STAT_CHNGD_DATE,                                  08770009
079700                STATUS_CODE,                                      08780009
079800                LONG_SIZE_DESC,                                   08790009
079900                LONG_COLOR_DESC,                                  08800009
080000                VNDR_IN_HSE_NMBR,                                 08810009
080100                GP_RTL_AMT,                                       08820009
080200                GP_QTY,                                           08830009
080300                LONG_VENDOR_STYLE,                                08840009
080400                ENT_ID                                            08850009
080500           INTO :TSK-RTL-UNIT-MSRMNT,                             08860009
080600                :TSK-CUR-UNIT-RTL-AMT,                            08870009
080700                :TSK-STAT-CHNGD-DATE,                             08880009
080800                :TSK-STATUS-CODE,                                 08890009
080900                :TSK-LONG-SIZE-DESC,                              08900009
081000                :TSK-LONG-COLOR-DESC,                             08910009
081100                :TSK-VNDR-IN-HSE-NMBR,                            08920009
081200                :TSK-GP-RTL-AMT,                                  08930009
081300                :TSK-GP-QTY,                                      08940009
081400                :TSK-LONG-VENDOR-STYLE,                           08950009
081500                :TSK-ENT-ID                                       08960009
081600           FROM TSK                                               08970009
081700          WHERE ITEM_NMBR = :TSK-ITEM-NMBR                        08980009
081800     END-EXEC.                                                    08990009
081900                                                                  09000009
082000     EVALUATE TRUE                                                09010009
082100         WHEN SQLCODE = ZEROS                                     09020009
082200         WHEN SQLCODE = +1403                                     09030009
082300           CONTINUE                                               09040009
082400         WHEN OTHER                                               09050009
082500           DISPLAY 'B1510-SELECT-TSK-FOR-TMDSEIT'                 09060009
082600           INITIALIZE WS-DISPLAY-ITM-NBR                          09070009
082700           MOVE TSK-ITEM-NMBR TO WS-DISPLAY-ITM-NBR               09080009
082800           DISPLAY 'ITEM-NMBR: ' WS-DISPLAY-ITM-NBR               09090009
082900           PERFORM U9999-ABEND-ROUTINE                            09100009
083000     END-EVALUATE.                                                09110009
083100                                                                  09120009
083200 B1510-EXIT.                                                      09130009
083300     EXIT.                                                        09140009
083400                                                                  09150009
083500                                                                  09160009
083600 B1520-INSERT-TMDSEIT.                                            09170009
083700                                                                  09180009
083800     EXEC SQL                                                     09190009
083900         INSERT INTO TMDSEIT                                      09200009
084000               (ITEM_CLUSTR_ID                                    09210009
084100                ,STAT_CHNG_DTE                                    09220009
084200                ,STAT_CDE                                         09230009
084300                ,SIZE_DESC                                        09240009
084400                ,COLOR_DESC                                       09250009
084500                ,VNDR_INHOUSE_NBR                                 09260009
084600                ,VNDR_STYL_ID                                     09270009
084700                ,UNIT_RTL_AMT                                     09280009
084800                ,UNIT_RTL_UOM_CDE                                 09290009
084900                ,GRP_QTY                                          09300009
085000                ,GRP_RTL_AMT                                      09310009
085100                ,ENT_ID                                           09320009
085200                ,E_ITM_IND                                        09330009
085300                ,E_ASRT_BEG_DTE                                   09340009
085400                ,E_ASRT_END_DTE                                   09350009
085500                ,KOHLS_SIZE_CDE                                   09360009
085600                ,NRF_CLOR_CDE)                                    09370009
085700        VALUES (:ITEM-CLUSTR-ID,                                  09380009
085800                :STAT-CHNG-DTE:WS-STAT-CHNG-DTE-NULL,             09390009
085900                :STAT-CDE,                                        09400009
086000                :SIZE-DESC:WS-SIZE-DESC-NULL,                     09410009
086100                :COLOR-DESC:WS-COLOR-DESC-NULL,                   09420009
086200                :VNDR-INHOUSE-NBR:WS-VNDR-INHOUSE-NBR-NULL,       09430009
086300                :VNDR-STYL-ID:WS-VNDR-STYL-ID-NULL,               09440009
086400                :UNIT-RTL-AMT:WS-UNIT-RTL-AMT-NULL,               09450009
086500                :UNIT-RTL-UOM-CDE:WS-UNIT-RTL-UOM-CDE-NULL,       09460009
086600                :GRP-QTY:WS-GRP-QTY-NULL,                         09470009
086700                :GRP-RTL-AMT:WS-GRP-RTL-AMT-NULL,                 09480009
086800                :ENT-ID:WS-ENT-ID-NULL,                           09490009
086900                :E-ITM-IND,                                       09500009
087000                :E-ASRT-BEG-DTE:WS-E-ASRT-BEG-DTE-NULL,           09510009
087100                :E-ASRT-END-DTE:WS-E-ASRT-END-DTE-NULL,           09520009
087200                :UPC-KOHLS-SIZE-CDE,                              09530009
087300                :UPC-NRF-CLOR-CDE)                                09540009
087400     END-EXEC.                                                    09550009
087500                                                                  09560009
087600     EVALUATE TRUE                                                09570009
087700         WHEN SQLCODE = ZEROS                                     09580009
0822RM*** ADD TO COMMIT COUNT                                           09590009
0822RM            ADD +1 TO WS-NBR-INS-UPD                              09600009
0822RM*            CONTINUE                                             09610009
087900         WHEN OTHER                                               09620009
088000             DISPLAY 'B1520-INSERT-TMDSEIT'                       09630009
088100             DISPLAY 'ITEM-CLUSTER-ID:  ' ITEM-CLUSTR-ID          09640009
088200             DISPLAY 'STAT-CHNG-DTE:    ' STAT-CHNG-DTE           09650009
088300             DISPLAY 'STAT-CDE:         ' STAT-CDE                09660009
088400             DISPLAY 'SIZE-DESC:        ' SIZE-DESC               09670009
088500             DISPLAY 'COLOR-DESC:       ' COLOR-DESC              09680009
088600             DISPLAY 'VNDR-INHOUSE-NBR: ' VNDR-INHOUSE-NBR        09690009
088700             DISPLAY 'VNDR-STYL-ID:     ' VNDR-STYL-ID            09700009
088800             DISPLAY 'UNIT-RTL-AMT:     ' UNIT-RTL-AMT            09710009
088900             DISPLAY 'UNIT-RTL-UOM-CDE: ' UNIT-RTL-UOM-CDE        09720009
089000             DISPLAY 'GRP-QTY:          ' GRP-QTY                 09730009
089100             DISPLAY 'GRP-RTL-AMT:      ' GRP-RTL-AMT             09740009
089200             DISPLAY 'ENT-ID:           ' ENT-ID                  09750009
089300             DISPLAY 'E-ITM-IND:        ' E-ITM-IND               09760009
089400             DISPLAY 'UPC-KOHLS-SIZE-CDE ' UPC-KOHLS-SIZE-CDE     09770009
089500             DISPLAY 'UPC-NRF-CLOR-CDE  ' UPC-NRF-CLOR-CDE        09780009
089600             PERFORM U9999-ABEND-ROUTINE                          09790009
089700     END-EVALUATE.                                                09800009
089800                                                                  09810009
089900 B1520-EXIT.                                                      09820009
090000     EXIT.                                                        09830009
090100                                                                  09840009
090200                                                                  09850009
090300 B1530-SELECT-TMDSEIT.                                            09860009
090400                                                                  09870009
090500     EXEC SQL                                                     09880009
090600         SELECT E_ITM_IND,                                        09890009
090700                E_ASRT_BEG_DTE,                                   09900009
090800                E_ASRT_END_DTE                                    09910009
090900           INTO :E-ITM-IND,                                       09920009
091000                :E-ASRT-BEG-DTE:WS-E-ASRT-BEG-DTE-NULL,           09930009
091100                :E-ASRT-END-DTE:WS-E-ASRT-END-DTE-NULL            09940009
091200           FROM TMDSEIT                                           09950009
091300          WHERE ITEM_CLUSTR_ID = :ITEM-CLUSTR-ID                  09960009
091400     END-EXEC.                                                    09970009
091500                                                                  09980009
091600     EVALUATE TRUE                                                09990009
091700         WHEN SQLCODE = ZEROS                                     10000009
091800             CONTINUE                                             10010009
091900         WHEN OTHER                                               10020009
092000             DISPLAY 'B1530-SELECT-TMDSEIT'                       10030009
092100             DISPLAY 'ITEM-CLUSTER-ID:  ' ITEM-CLUSTR-ID          10040009
092200             PERFORM U9999-ABEND-ROUTINE                          10050009
092300     END-EVALUATE.                                                10060009
092400                                                                  10070009
092500 B1530-EXIT.                                                      10080009
092600     EXIT.                                                        10090009
092700                                                                  10100009
092800                                                                  10110009
092900 B1600-PROCESS-OLD-NEW-SKU-REL.                                   10120009
093000                                                                  10130009
093100*  SET UP A NEW ACTIVE NEW SKU/OLD SKU RELATIONSHIP ON TITMCLC    10140009
093200     INITIALIZE ITT00001.                                         10150009
093300     MOVE WS-NEW-SKU-CLUSTR-ID     TO PRNT-ITM-CLUSTR-ID.         10160009
093400     MOVE WS-OLD-SKU-CLUSTR-ID     TO CHLD-ITM-CLUSTR-ID.         10170009
093500     MOVE 'R'                      TO REL-TYP-CDE.                10180009
093600     MOVE WS-CURRENT-TMST          TO EFF-BEG-TMST.               10190009
093700     MOVE 'I'                      TO CHLD-ITM-CLSTR-CDE.         10200009
093800     MOVE -1                       TO WS-CLC-EFF-END-DTE-NULL     10210009
093900                                      WS-CHLD-ITM-UNT-QTY-NULL.   10220009
094000                                                                  10230009
**TEMP*    DISPLAY 'B1600 CALL U9300-INSERT-TITMCLC'.                   10240009
**TEMP*           ADD 1 TO WS-NBR-INS-UPD.                              10250009
           PERFORM U9300-INSERT-TITMCLC                                 10260009
              THRU U9300-EXIT.                                          10270009
094300                                                                  10280009
094400 B1600-EXIT.                                                      10290009
094500     EXIT.                                                        10300009
094600                                                                  10310009
094700                                                                  10320009
094800 B1700-UPDATE-TSKUSL00-TBLS.                                      10330009
094900                                                                  10340009
095000* THE CHLD-ITM-CLUSTR-ID (OLD SKU) IS USED IN THE                 10350009
095100* MAKSP200_PKG.UPD_TSKUSL00 SQL UPDATE "WHERE" CLAUSE.            10360009
095200* THE PRNT-ITM-CLUSTR-ID (NEW SKU) IS USED TO UPDATE THE          10370009
095300* VALUE OF ITEM-CLUSTR-ID ON EACH OF THE TSKUSL00 TABLES.         10380009
095400                                                                  10390009
095500* THE VALUES IN PRNT-ITM-CLUSTR-ID AND CHLD-ITM-CLUSTR-ID         10400009
095600* WERE SET IN B1600.                                              10410009
095700                                                                  10420009
0822RM***- COMMENT DISPLAYS                                             10430009
0822RM*    DISPLAY 'B1700-UPDATE-TSKUSL00-TBLS'.                        10440009
0822RM*    DISPLAY 'PRNT-ITM-CLUSTR-ID: ' PRNT-ITM-CLUSTR-ID.           10450009
0822RM*    DISPLAY 'CHLD-ITM-CLUSTR-ID: ' CHLD-ITM-CLUSTR-ID.           10460009
096100                                                                  10470009
096200     MOVE ZERO TO WS-ROWS-UPDATED.                                10480009
096300                                                                  10490009
096400     EXEC SQL EXECUTE                                             10500009
096500         BEGIN                                                    10510009
096600             MAKSP200_PKG.UPD_TSKUSL00                            10520009
096700                   (:PRNT-ITM-CLUSTR-ID                           10530009
096800                   ,:CHLD-ITM-CLUSTR-ID                           10540009
096900                   ,:WS-ROWS-UPDATED);                            10550009
097000         END;                                                     10560009
097100     END-EXEC.                                                    10570009
097200                                                                  10580009
097300     EVALUATE TRUE                                                10590009
097400         WHEN SQLCODE = ZEROS                                     10600009
0822RM*** ADD TO COMMIT COUNT                                           10610009
0822RM             ADD WS-ROWS-UPDATED TO WS-NBR-INS-UPD                10620009
097500         WHEN SQLCODE = +1403                                     10630009
0822RM***- COMMENT DISPLAYS                                             10640009
0822RM*            DISPLAY 'TOTAL TSKUSL00 ROWS UPDATED = '             10650009
0822RM*                      WS-ROWS-UPDATED                            10660009
0822RM             CONTINUE                                             10670009
097800         WHEN OTHER                                               10680009
097900             DISPLAY 'B1700-UPDATE-TSKUSL00-TBLS'                 10690009
098000             DISPLAY 'UNABLE TO UPDATE TSKUSL00 TABLES'           10700009
098100             PERFORM U9999-ABEND-ROUTINE                          10710009
098200     END-EVALUATE.                                                10720009
098300                                                                  10730009
098400 B1700-EXIT.                                                      10740009
098500     EXIT.                                                        10750009
098600                                                                  10760009
098700                                                                  10770009
098800 B1800-UPDATE-PREV-RECLASS-REL.                                   10780009
098900                                                                  10790009
099000*  IF A SKU WAS RECLASSIFIED MORE THAN ONCE, UPDATE               10800009
099100*  PREVIOUS RECLASSIFICATION RELATIONSHIPS                        10810009
099200                                                                  10820009
099300     MOVE WS-OLD-SKU-CLUSTR-ID TO PRNT-ITM-CLUSTR-ID.             10830009
099400                                                                  10840009
099500*  FIRST, EXPIRE THE EXISTING (ACTIVE) OLD SKU TO PREVIOUS        10850009
099600*  RECLASS SKU TITMCLC RELATIONSHIP                               10860009
099700                                                                  10870009
**TEMP*    DISPLAY 'B1800 CALL B1810-UPDATE-PREV-RECLASS-REL'.          10880009
**TEMP*           ADD 1 TO WS-NBR-INS-UPD                               10881009
           PERFORM B1810-UPDATE-PREV-RECLASS-REL                        10882009
              THRU B1810-EXIT.                                          10883009
100000                                                                  10884009
100100*  THEN, UPDATE ALL OF THE EXPIRED OLD SKU TO PREVIOUS SKU        10885009
100200*  RECLASS RELATIONSHIP(S) SO THAT THEY POINT TO THE NEW          10886009
100300*  SKU                                                            10887009
100400                                                                  10888009
100500     PERFORM B1820-OPEN-UPDCSR                                    10889009
100600        THRU B1820-EXIT.                                          10890009
100700                                                                  10900009
100800     SET MORE-UPD-ROWS TO TRUE.                                   10910009
100900     PERFORM UNTIL NO-MORE-UPD-ROWS                               10920009
101000         PERFORM B1830-FETCH-UPDCSR                               10930009
101100            THRU B1830-EXIT                                       10940009
101200         IF MORE-UPD-ROWS                                         10950009
**TEMP*    DISPLAY 'B1800 CALL B1840-UPDATE-TITMCLC-REL'                10960009
**TEMP*           ADD 1 TO WS-NBR-INS-UPD                               10970009
                   PERFORM B1840-UPDATE-TITMCLC-REL                     10980009
                      THRU B1840-EXIT                                   10990009
 01500         END-IF                                                   11000009
101600     END-PERFORM.                                                 11010009
101700                                                                  11020009
101800     PERFORM B1850-CLOSE-UPDCSR                                   11030009
101900        THRU B1850-EXIT.                                          11040009
102000                                                                  11050009
102100 B1800-EXIT.                                                      11060009
102200     EXIT.                                                        11070009
102300                                                                  11080009
102400                                                                  11090009
102500 B1810-UPDATE-PREV-RECLASS-REL.                                   11100009
102600                                                                  11110009
102700     EXEC SQL                                                     11120009
102800        UPDATE  TITMCLC                                           11130009
102900            SET EFF_END_TMST       = :WS-CURRENT-TMST,            11140009
103000                LAST_UPD_TMST      = SYSDATE,                     11150009
103100                LAST_UPD_BY_UID    = 'MAKUT203'                   11160009
103200          WHERE PRNT_ITM_CLUSTR_ID = :PRNT-ITM-CLUSTR-ID          11170009
103300            AND REL_TYP_CDE        = 'R'                          11180009
103400            AND EFF_END_TMST IS NULL                              11190009
103500     END-EXEC.                                                    11200009
103600                                                                  11210009
103700     EVALUATE TRUE                                                11220009
103800         WHEN SQLCODE = ZEROS                                     11230009
0822RM*** ADD TO COMMIT COUNT                                           11240009
0822RM             ADD +1 TO WS-NBR-INS-UPD                             11250009
103900         WHEN SQLCODE = +1403                                     11260009
104000           CONTINUE                                               11270009
104100         WHEN OTHER                                               11280009
104200           DISPLAY 'B1810-UPDATE-PREV-RECLASS-REL'                11290009
104300           DISPLAY 'PRNT-ITM-CLUSTR-ID = ' PRNT-ITM-CLUSTR-ID     11300009
104400           PERFORM U9999-ABEND-ROUTINE                            11310009
104500     END-EVALUATE.                                                11320009
104600                                                                  11330009
104700 B1810-EXIT.                                                      11340009
104800     EXIT.                                                        11350009
104900                                                                  11360009
105000                                                                  11370009
105100 B1820-OPEN-UPDCSR.                                               11380009
105200                                                                  11390009
105300     EXEC SQL                                                     11400009
105400         OPEN UPDCSR                                              11410009
105500     END-EXEC.                                                    11420009
105600                                                                  11430009
105700     EVALUATE TRUE                                                11440009
105800         WHEN SQLCODE = ZEROS                                     11450009
105900             CONTINUE                                             11460009
106000         WHEN OTHER                                               11470009
106100             DISPLAY 'B1820-OPEN-UPDCSR'                          11480009
106200             PERFORM U9999-ABEND-ROUTINE                          11490009
106300     END-EVALUATE.                                                11500009
106400                                                                  11510009
106500 B1820-EXIT.                                                      11520009
106600     EXIT.                                                        11530009
106700                                                                  11540009
106800                                                                  11550009
106900 B1830-FETCH-UPDCSR.                                              11560009
107000                                                                  11570009
107100     EXEC SQL                                                     11580009
107200         FETCH UPDCSR                                             11590009
107300          INTO :CHLD-ITM-CLUSTR-ID                                11600009
107400     END-EXEC.                                                    11610009
107500                                                                  11620009
107600     EVALUATE TRUE                                                11630009
107700         WHEN SQLCODE = ZEROS                                     11640009
107800             CONTINUE                                             11650009
107900         WHEN SQLCODE = +1403                                     11660009
108000             SET NO-MORE-UPD-ROWS TO TRUE                         11670009
108100         WHEN OTHER                                               11680009
108200             DISPLAY 'B1830-FETCH-UPDCSR'                         11690009
108300             DISPLAY 'PRNT-ITM-CLUSTR-ID: '                       11700009
108400             DISPLAY '   ' PRNT-ITM-CLUSTR-ID                     11710009
108500             PERFORM U9999-ABEND-ROUTINE                          11720009
108600     END-EVALUATE.                                                11730009
108700                                                                  11740009
108800 B1830-EXIT.                                                      11750009
108900     EXIT.                                                        11760009
109000                                                                  11770009
109100                                                                  11780009
109200 B1840-UPDATE-TITMCLC-REL.                                        11790009
109300                                                                  11800009
109400     EXEC SQL                                                     11810009
109500         UPDATE TITMCLC                                           11820009
109600            SET PRNT_ITM_CLUSTR_ID = :WS-NEW-SKU-CLUSTR-ID,       11830009
109700                     LAST_UPD_TMST = SYSDATE,                     11840009
109800                   LAST_UPD_BY_UID = 'MAKUT203'                   11850009
109900          WHERE PRNT_ITM_CLUSTR_ID = :PRNT-ITM-CLUSTR-ID          11860009
110000            AND CHLD_ITM_CLUSTR_ID = :CHLD-ITM-CLUSTR-ID          11870009
110100            AND REL_TYP_CDE        = 'R'                          11880009
110200     END-EXEC.                                                    11890009
110300                                                                  11900009
110400     EVALUATE TRUE                                                11910009
110500         WHEN SQLCODE = ZEROS                                     11920009
0822RM*** ADD TO COMMIT COUNT                                           11930009
0822RM             ADD +1 TO WS-NBR-INS-UPD                             11940009
0822RM*            CONTINUE                                             11950009
110700         WHEN OTHER                                               11960009
110800             DISPLAY 'B1840-UPDATE-TITMCLC-REL'                   11970009
110900             DISPLAY 'PRNT-ITM-CLUSTR-ID: ' PRNT-ITM-CLUSTR-ID    11980009
111000             DISPLAY 'CHLD-ITM-CLUSTR-ID: ' CHLD-ITM-CLUSTR-ID    11990009
111100             DISPLAY 'NEW PRNT-ITM-CLUSTR-ID: '                   12000009
111200             DISPLAY '    ' WS-NEW-SKU-CLUSTR-ID                  12010009
111300             PERFORM U9999-ABEND-ROUTINE                          12020009
111400     END-EVALUATE.                                                12030009
111500                                                                  12040009
111600 B1840-EXIT.                                                      12050009
111700     EXIT.                                                        12060009
111800                                                                  12070009
111900                                                                  12080009
112000 B1850-CLOSE-UPDCSR.                                              12090009
112100                                                                  12100009
112200     EXEC SQL                                                     12110009
112300        CLOSE UPDCSR                                              12120009
112400     END-EXEC.                                                    12130009
112500                                                                  12140009
112600     EVALUATE TRUE                                                12150009
112700         WHEN SQLCODE = ZEROS                                     12160009
112800             CONTINUE                                             12170009
112900         WHEN OTHER                                               12180009
113000             DISPLAY 'B1850-CLOSE-UPDCSR'                         12190009
113100             PERFORM U9999-ABEND-ROUTINE                          12200009
113200     END-EVALUATE.                                                12210009
113300                                                                  12220009
113400 B1850-EXIT.                                                      12230009
113500     EXIT.                                                        12240009
113600                                                                  12250009
113700                                                                  12260009
113800 B1900-CLOSE-TUPCCSR.                                             12270009
113900                                                                  12280009
114000     EXEC SQL                                                     12290009
114100         CLOSE TUPCCSR                                            12300009
114200     END-EXEC.                                                    12310009
114300                                                                  12320009
114400     EVALUATE TRUE                                                12330009
114500         WHEN SQLCODE = ZEROS                                     12340009
114600             CONTINUE                                             12350009
114700         WHEN OTHER                                               12360009
114800             DISPLAY 'B1900-CLOSE-TUPCCSR'                        12370009
114900             PERFORM U9999-ABEND-ROUTINE                          12380009
115000     END-EVALUATE.                                                12390009
115100                                                                  12400009
115200 B1900-EXIT.                                                      12410009
115300     EXIT.                                                        12420009
115400                                                                  12430009
115500                                                                  12440009
115600 C1000-PROCESS-SKU.                                               12450009
115700                                                                  12460009
**TEMP*      DISPLAY 'C1000-PROCESS-SKU'                                12470009
115800*  THE NI SKU NUMBER HAS NO REFERENCE TO THE SKU'S DPT            12480009
115900*  OR SUBCLASS.  HOWEVER, TO BE CONSISTENT WITH THE               12490009
116000*  EXISTING MA SYSTEM, THE FORMAT OF ITEM-CLUSTR-NAME IS          12500009
116100*  DDD-SS-SKU.                                                    12510009
116200                                                                  12520009
116300     MOVE UPC-UPC-NBR           TO WS-UPC-NBR-REDEF-1.            12530009
116400     MOVE WS-UPC-NBR-REDEF-7-14 TO WS-UPC-NBR-CONVERSION-1        12540009
116500                                   WS-UPC-NBR-CONVERSION-2.       12550009
116600                                                                  12560009
116700*  USE THE NI SKU TO GET THE ITEM NBR                             12570009
116800     INITIALIZE DCLTSKXREF.                                       12580009
116900     MOVE WS-UPC-NBR-CONVERSION-1 TO SKXREF-SKU.                  12590009
117000     PERFORM C1100-SELECT-TSKXREF                                 12600009
117100        THRU C1100-EXIT.                                          12610009
117200     MOVE SPACES               TO WS-OLD-SKU-NBR.                 12620009
117300     MOVE IM008-ITEM-KEY-DEPT  TO WS-WORK-DPT.                    12630009
117400     MOVE IM008-ITEM-KEY-SUBCL TO WS-WORK-SUBCL.                  12640009
117500     IF WS-UPC-NBR-CONVERSION-2(1:1) = '0'                        12650009
117600         MOVE WS-UPC-NBR-CONVERSION-2(2:7) TO WS-WORK-CONVERSION  12660009
117700         STRING WS-WORK-DPT-2-4         DELIMITED BY SIZE         12670009
117800                '-'                     DELIMITED BY SIZE         12680009
117900                WS-WORK-SUBCL-3-4       DELIMITED BY SIZE         12690009
118000                '-'                     DELIMITED BY SIZE         12700009
118100                WS-WORK-CONVERSION      DELIMITED BY SIZE         12710009
118200           INTO WS-OLD-SKU-NBR                                    12720009
118300                                                                  12730009
118400*  THE MOVE TO WS-WORK-SKU IS BEING DONE JUST IN CASE A           12740009
118500*  LOOKUP NEEDS TO BE DONE BY C1250                               12750009
118600                                                                  12760009
118700         MOVE WS-WORK-CONVERSION      TO WS-WORK-SKU              12770009
118800         MOVE WS-WORK-SKU             TO ITMCLT-SKU               12780009
118900     ELSE                                                         12790009
119000         STRING WS-WORK-DPT-2-4         DELIMITED BY SIZE         12800009
119100                '-'                     DELIMITED BY SIZE         12810009
119200                WS-WORK-SUBCL-3-4       DELIMITED BY SIZE         12820009
119300                '-'                     DELIMITED BY SIZE         12830009
119400                WS-UPC-NBR-CONVERSION-2 DELIMITED BY SIZE         12840009
119500           INTO WS-OLD-SKU-NBR                                    12850009
119600                                                                  12860009
119700*  THE MOVE TO WS-WORK-SKU IS BEING DONE JUST IN CASE A           12870009
119800*  LOOKUP NEEDS TO BE DONE BY C1250                               12880009
119900                                                                  12890009
120000         MOVE WS-UPC-NBR-CONVERSION-2 TO WS-WORK-SKU              12900009
120100         MOVE WS-WORK-SKU             TO ITMCLT-SKU               12910009
120200     END-IF.                                                      12920009
120300                                                                  12930009
120400     MOVE SPACES         TO ITMCLT-ITEM-CLUSTR-NAME.              12940009
120500     MOVE WS-OLD-SKU-NBR TO ITMCLT-ITEM-CLUSTR-NAME.              12950009
120600                                                                  12960009
120700* CHECK IF THE OLD SKU EXISTS                                     12970009
120800     SET SKU-FOUND-BY-DPT-SCL TO TRUE.                            12980009
120900     PERFORM C1200-SELECT-TITMCLT-SKU                             12990009
121000        THRU C1200-EXIT.                                          13000009
121100                                                                  13010009
121200* THE SELECT IN C1200 DOES THE SKU LOOKUP USING DEPT, SUB CL,     13020009
121300* AND SKU.  IF MORE THAN 1 RECLASS RECORD COMES THROUGH FOR       13030009
121400* A SKU IN THE SAME JOB RUN, WE WILL NOT FIND ANY RECORDS         13040009
121500* IN B1400-FETCH-TUPCCSR FOR THE FIRST VENDOR STYLE RECORD        13050009
121600* CONTAINING THAT SKU(S).  SO NO UPDATE OF THAT SKU WILL TAKE     13060009
121700* PLACE.  THIS IS BECAUSE THE VSM SYSTEM HAS ALREADY UPDATED      13070009
121800* TUPC FOR THE SUBSEQUENT VENDOR STYLE RECORDS CONTAINING THAT    13080009
121900* SKU.  IN THE INPUT FILE, THE LAST VENDOR STYLE RECORD           13090009
122000* CONTAINING THE SKU HAS THE DEPARTMENT AND SUB CLASS FOR THE     13100009
122100* END OF DAY.  WE WILL USE THAT DEPARTMENT AND SUB CLASS TO       13110009
122200* SET UP RELATIONSHIPS FOR THE SKU.                               13120009
122300*                                                                 13130009
122400* HOWEVER, THE OLD DEPARTMENT AND SUB CLASS ON THE "LAST"         13140009
122500* VENDOR STYLE RECORD WILL NOT BE ON OUR TABLES I.E.              13150009
122600* THIS SKU WILL NOT HAVE TITMCLC RELATIONSHIPS FOR THIS           13160009
122700* DEPARTMENT AND SUB CLASS.  THIS IS BECAUSE WE DID NOT PROCESS   13170009
122800* THE EARLIER RECLASSIFICATIONS OF THAT SKU IN THIS FILE.         13180009
122900* SO WE WILL LOOKUP THE RECORD USING THE NI SKU ONLY.             13190009
123000                                                                  13200009
123100     IF SQLCODE = +1403                                           13210009
0822RM*        DISPLAY 'SKU NOT FOUND BY DPT-SCL'                       13220009
0822RM*        DISPLAY 'LOOKUP DONE BY NI SKU ITSELF'                   13230009
123400         SET SKU-NOT-FOUND-BY-DPT-SCL TO TRUE                     13240009
123500         PERFORM C1250-SELECT-TITMCLT-SKU                         13250009
123600            THRU C1250-EXIT                                       13260009
123700     END-IF.                                                      13270009
123800                                                                  13280009
123900*  IF AVAILABLE, ITEM-CLUSTR-DESC FROM THE OLD SKU WILL BE        13290009
124000*  REUSED AS THE DESCRIPTION FOR THE NEW SKU                      13300009
124100                                                                  13310009
124200     IF SQLCODE = ZERO                                            13320009
124300         MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-OLD-SKU-CLUSTR-ID       13330009
124400         MOVE ITMCLT-ITEM-CLUSTR-DESC                             13340009
124500                     TO WS-ITEM-CLUSTR-DESC                       13350009
124600     ELSE                                                         13360009
124700         MOVE ZEROS  TO WS-OLD-SKU-CLUSTR-ID                      13370009
124800         MOVE SPACES TO WS-ITEM-CLUSTR-DESC                       13380009
124900     END-IF.                                                      13390009
125000                                                                  13400009
125100     MOVE SPACES                     TO WS-NEW-SKU-NBR.           13410009
125200     MOVE IM008-STYLE-RECL-DEPT-NEW  TO WS-WORK-DPT.              13420009
125300     MOVE IM008-STYLE-RECL-SUBCL-NEW TO WS-WORK-SUBCL.            13430009
125400     IF WS-UPC-NBR-CONVERSION-2(1:1) = '0'                        13440009
125500         STRING WS-WORK-DPT-2-4         DELIMITED BY SIZE         13450009
125600                '-'                     DELIMITED BY SIZE         13460009
125700                WS-WORK-SUBCL-3-4       DELIMITED BY SIZE         13470009
125800                '-'                     DELIMITED BY SIZE         13480009
125900                WS-WORK-CONVERSION      DELIMITED BY SIZE         13490009
126000           INTO WS-NEW-SKU-NBR                                    13500009
126100     ELSE                                                         13510009
126200         STRING WS-WORK-DPT-2-4         DELIMITED BY SIZE         13520009
126300                '-'                     DELIMITED BY SIZE         13530009
126400                WS-WORK-SUBCL-3-4       DELIMITED BY SIZE         13540009
126500                '-'                     DELIMITED BY SIZE         13550009
126600                WS-UPC-NBR-CONVERSION-2 DELIMITED BY SIZE         13560009
126700           INTO WS-NEW-SKU-NBR                                    13570009
126800     END-IF.                                                      13580009
126900                                                                  13590009
127000     MOVE SPACES         TO ITMCLT-ITEM-CLUSTR-NAME.              13600009
127100     MOVE WS-NEW-SKU-NBR TO ITMCLT-ITEM-CLUSTR-NAME.              13610009
127200                                                                  13620009
0822RM*** COMMENTING OUT DISPLAYS                                       13621010
0822RM*    MOVE WS-WORK-VS-ID        TO WS-DISPLAY-VS-ID.               13630009
0822RM*    MOVE UPC-SUB-CL-MDSEAR-ID TO WS-DISPLAY-SUB-CL-MDSEAR-ID.    13640009
0822RM*    DISPLAY '*********************************************'.     13660010
0822RM*    DISPLAY 'BEGIN PROCESSING NEW SKU RECLASSIFY VS-ID:'         13670009
0822RM*                      WS-DISPLAY-VS-ID.                          13680009
0822RM*    DISPLAY 'SUB-CL-MDSEAR-ID: ' WS-DISPLAY-SUB-CL-MDSEAR-ID.    13690009
0822RM*    DISPLAY 'OLD ITEM-CLUSTR-NAME: ' WS-OLD-SKU-NBR.             13700009
0822RM*    DISPLAY 'NEW ITEM-CLUSTR-NAME: ' WS-NEW-SKU-NBR.             13710009
128100                                                                  13720009
128200*  CHECK IF THE NEW SKU EXISTS                                    13730009
128300     PERFORM C1200-SELECT-TITMCLT-SKU                             13740009
128400        THRU C1200-EXIT.                                          13750009
128500                                                                  13760009
128600     IF SQLCODE = ZERO                                            13770009
0822RM*        DISPLAY 'NEW SKU ALREADY EXISTS'                         13780009
128800         SET DO-NOT-RESET-ADHOC-REL TO TRUE                       13790009
128900         MOVE IM008-CRE-TMST(1:10) TO WS-SETUP-DATE-10            13800009
0822RM*        DISPLAY 'ITMCLT-LAST-UPD-TMST ' ITMCLT-LAST-UPD-TMST     13810009
0822RM*          ' < WS-SETUP-DATE-10 ' WS-SETUP-DATE-10 ' ? '          13820009
129200         IF ITMCLT-LAST-UPD-TMST(1:10) < WS-SETUP-DATE-10         13830009
0822RM*            DISPLAY 'ITEM SHOULD HAVE BEEN EXPIRED '             13840009
0822RM*            DISPLAY '   '  ITMCLT-ITEM-CLUSTR-NAME               13850009
129500             PERFORM D1000-EXPIRE-EXIST-SKU-REL                   13860009
129600                THRU D1000-EXIT                                   13870009
129700         ELSE                                                     13880009
129800             SET BYPASS-SKU TO TRUE                               13890009
0822RM*            DISPLAY 'SKIPPING RECLASSIFICATION'                  13900009
130000             GO TO C1000-EXIT                                     13910009
130100         END-IF                                                   13920009
130200     ELSE                                                         13930009
130300         SET RESET-ADHOC-REL TO TRUE                              13940009
130400     END-IF.                                                      13950009
130500                                                                  13960009
130600     PERFORM C1300-CREATE-NEW-SKU-REL                             13970009
130700        THRU C1300-EXIT.                                          13980009
130800                                                                  13990009
130900     IF SKXREF-ITM-NBR > ZEROS                                    14000009
131000         PERFORM C1400-SETUP-INSERT-GRP-CDE                       14010009
131100            THRU C1400-EXIT                                       14020009
131200         PERFORM C1500-SETUP-INSERT-VND                           14030009
131300            THRU C1500-EXIT                                       14040009
131400         IF VND-INFO-FOUND                                        14050009
131500             PERFORM C1600-SETUP-INSERT-VST                       14060009
131600                THRU C1600-EXIT                                   14070009
131700         END-IF                                                   14080009
131800     END-IF.                                                      14090009
131900                                                                  14100009
132000 C1000-EXIT.                                                      14110009
132100     EXIT.                                                        14120009
132200                                                                  14130009
132300                                                                  14140009
132400 C1100-SELECT-TSKXREF.                                            14150009
132500                                                                  14160009
132600     EXEC SQL                                                     14170009
132700         SELECT ITM_NBR                                           14180009
132800           INTO :SKXREF-ITM-NBR                                   14190009
132900           FROM TSKXREF                                           14200009
133000          WHERE SKU = :SKXREF-SKU                                 14210009
133100            AND SKU_STAT_CDE <> '00'                              14220009
133200     END-EXEC.                                                    14230009
133300                                                                  14240009
133400     EVALUATE TRUE                                                14250009
133500         WHEN SQLCODE = ZERO                                      14260009
133600         WHEN SQLCODE = +1403                                     14270009
133700             CONTINUE                                             14280009
133800         WHEN OTHER                                               14290009
133900             DISPLAY 'C1100-SELECT-TSKXREF'                       14300009
134000             DISPLAY 'SKU: ' SKXREF-SKU                           14310009
134100             PERFORM U9999-ABEND-ROUTINE                          14320009
134200     END-EVALUATE.                                                14330009
134300                                                                  14340009
134400 C1100-EXIT.                                                      14350009
134500     EXIT.                                                        14360009
134600                                                                  14370009
134700                                                                  14380009
134800 C1200-SELECT-TITMCLT-SKU.                                        14390009
134900                                                                  14400009
135000     EXEC SQL                                                     14410009
135100       SELECT ITEM_CLUSTR_ID,                                     14420009
135200              ITEM_CLUSTR_DESC,                                   14430009
135300              EFF_BEG_TMST,                                       14440009
135400              EFF_END_TMST,                                       14450009
135500              LAST_UPD_TMST                                       14460009
135600         INTO :ITMCLT-ITEM-CLUSTR-ID,                             14470009
135700              :ITMCLT-ITEM-CLUSTR-DESC,                           14480009
135800              :ITMCLT-EFF-BEG-TMST,                               14490009
135900              :ITMCLT-EFF-END-TMST:WS-CLT-EFF-END-DTE-NULL,       14500009
136000              :ITMCLT-LAST-UPD-TMST                               14510009
136100         FROM TITMCLT                                             14520009
136200        WHERE ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME         14530009
136300          AND HIER_CDE         IS NULL                            14540009
136400          AND ((EFF_END_TMST IS NULL) OR                          14550009
136500               (EFF_END_TMST > :WS-CURR-END-TMST))                14560009
136600     END-EXEC.                                                    14570009
136700                                                                  14580009
136800     EVALUATE TRUE                                                14590009
136900         WHEN SQLCODE = ZEROS                                     14600009
137000         WHEN SQLCODE = +1403                                     14610009
137100             CONTINUE                                             14620009
137200         WHEN OTHER                                               14630009
137300             DISPLAY 'C1200-SELECT-TITMCLT-SKU'                   14640009
137400             DISPLAY 'ITEM-CLUSTR-NAME: ' ITMCLT-ITEM-CLUSTR-NAME 14650009
137500             PERFORM U9999-ABEND-ROUTINE                          14660009
137600     END-EVALUATE.                                                14670009
137700                                                                  14680009
137800 C1200-EXIT.                                                      14690009
137900     EXIT.                                                        14700009
138000                                                                  14710009
138100                                                                  14720009
138200 C1250-SELECT-TITMCLT-SKU.                                        14730009
138300                                                                  14740009
138400     EXEC SQL                                                     14750009
138500       SELECT ITEM_CLUSTR_ID,                                     14760009
138600              ITEM_CLUSTR_DESC,                                   14770009
138700              EFF_BEG_TMST,                                       14780009
138800              EFF_END_TMST,                                       14790009
138900              LAST_UPD_TMST                                       14800009
139000         INTO :ITMCLT-ITEM-CLUSTR-ID,                             14810009
139100              :ITMCLT-ITEM-CLUSTR-DESC,                           14820009
139200              :ITMCLT-EFF-BEG-TMST,                               14830009
139300              :ITMCLT-EFF-END-TMST:WS-CLT-EFF-END-DTE-NULL,       14840009
139400              :ITMCLT-LAST-UPD-TMST                               14850009
139500         FROM TITMCLT                                             14860009
139600        WHERE SKU      = :ITMCLT-SKU                              14870009
139700          AND HIER_CDE IS NULL                                    14880009
139800          AND ((EFF_END_TMST IS NULL) OR                          14890009
139900               (EFF_END_TMST > :WS-CURR-END-TMST))                14900009
140000     END-EXEC.                                                    14910009
140100                                                                  14920009
140200     EVALUATE TRUE                                                14930009
140300         WHEN SQLCODE = ZEROS                                     14940009
140400         WHEN SQLCODE = +1403                                     14950009
140500             CONTINUE                                             14960009
140600         WHEN OTHER                                               14970009
140700             DISPLAY 'C1250-SELECT-TITMCLT-SKU'                   14980009
140800             DISPLAY 'SKU: ' ITMCLT-SKU                           14990009
140900             PERFORM U9999-ABEND-ROUTINE                          15000009
141000     END-EVALUATE.                                                15010009
141100                                                                  15020009
141200 C1250-EXIT.                                                      15030009
141300     EXIT.                                                        15040009
141400                                                                  15050009
141500                                                                  15060009
141600 C1300-CREATE-NEW-SKU-REL.                                        15070009
141700                                                                  15080009
141800     MOVE ZERO TO WS-DPT-CLUSTR-ID                                15090009
141900                  WS-SCL-CLUSTR-ID                                15100009
142000                  WS-NEW-SKU-CLUSTR-ID                            15110009
142100                  WS-GRP-CLUSTR-ID                                15120009
142200                  WS-VND-CLUSTR-ID                                15130009
142300                  WS-VST-CLUSTR-ID.                               15140009
142400                                                                  15150009
142500                                                                  15160009
142600     MOVE SPACES TO ITMCLT-ITEM-CLUSTR-NAME.                      15170009
142700     MOVE WS-WORK-DPT-2-4           TO ITMCLT-ITEM-CLUSTR-NAME.   15180009
142800     MOVE 'DPT'                     TO ITMCLT-HIER-CDE.           15190009
142900                                                                  15200009
143000     PERFORM U9100-SELECT-TITMCLT                                 15210009
143100        THRU U9100-EXIT.                                          15220009
143200*  WE'RE ASSUMING THAT THE DPT EXISTS ON TITMCLT                  15230009
143300     MOVE ITMCLT-ITEM-CLUSTR-ID     TO WS-DPT-CLUSTR-ID.          15240009
143400                                                                  15250009
143500                                                                  15260009
143600     MOVE SPACES TO ITMCLT-ITEM-CLUSTR-NAME.                      15270009
143700     STRING WS-WORK-DPT-2-4         DELIMITED BY SIZE             15280009
143800            '-'                     DELIMITED BY SIZE             15290009
143900            WS-WORK-SUBCL-3-4       DELIMITED BY SIZE             15300009
144000       INTO ITMCLT-ITEM-CLUSTR-NAME.                              15310009
144100     MOVE 'SCL'                     TO ITMCLT-HIER-CDE.           15320009
144200                                                                  15330009
144300     PERFORM U9100-SELECT-TITMCLT                                 15340009
144400        THRU U9100-EXIT.                                          15350009
144500     IF SQLCODE = ZEROS                                           15360009
144600         MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-SCL-CLUSTR-ID           15370009
144700     ELSE                                                         15380009
144800         SET NOT-END-OF-SEARCH TO TRUE                            15390009
144900         SET SCL-NOT-FOUND     TO TRUE                            15400009
145000         PERFORM VARYING WS-SUB FROM 1 BY 1                       15410009
145100           UNTIL END-OF-SEARCH                                    15420009
145200             IF WS-SUBCLASS(WS-SUB) = ITMCLT-ITEM-CLUSTR-NAME     15430009
145300                 SET SCL-FOUND     TO TRUE                        15440009
145400                 SET END-OF-SEARCH TO TRUE                        15450009
145500             ELSE                                                 15460009
145600                 IF WS-SUBCLASS(WS-SUB) = SPACES                  15470009
145700                   OR WS-SUB > 99                                 15480009
145800                     SET END-OF-SEARCH TO TRUE                    15490009
145900                 END-IF                                           15500009
146000             END-IF                                               15510009
146100         END-PERFORM                                              15520009
146200         IF SCL-NOT-FOUND                                         15530009
146300             MOVE WS-SCL-NOT-FOUND        TO WS-ERROR-MSG         15540009
146400             MOVE ITMCLT-ITEM-CLUSTR-NAME TO WS-ERROR-DATA        15550009
146500             PERFORM U9400-WRITE-ERROR-RECORD                     15560009
146600                THRU U9400-EXIT                                   15570009
146700             SET NOT-END-OF-SEARCH TO TRUE                        15580009
146800             PERFORM VARYING WS-SUB FROM 1 BY 1                   15590009
146900               UNTIL END-OF-SEARCH                                15600009
147000                 IF WS-SUBCLASS(WS-SUB) = SPACES                  15610009
147100                      MOVE ITMCLT-ITEM-CLUSTR-NAME                15620009
147200                          TO WS-SUBCLASS(WS-SUB)                  15630009
147300                      SET END-OF-SEARCH TO TRUE                   15640009
147400                 ELSE                                             15650009
147500                    IF WS-SUB > 99                                15660009
147600                        SET END-OF-SEARCH TO TRUE                 15670009
147700                    END-IF                                        15680009
147800                END-IF                                            15690009
147900             END-PERFORM                                          15700009
148000         END-IF                                                   15710009
148100     END-IF.                                                      15720009
148200                                                                  15730009
148300     PERFORM C1310-SETUP-INSERT-NEW-SKU                           15740009
148400        THRU C1310-EXIT.                                          15750009
148500                                                                  15760009
148600*  INSERT THE SCL/SKU RELATIONSHIP                                15770009
148700     IF WS-SCL-CLUSTR-ID > ZERO                                   15780009
148800         INITIALIZE ITT00001                                      15790009
148900         MOVE WS-SCL-CLUSTR-ID         TO PRNT-ITM-CLUSTR-ID      15800009
149000         MOVE WS-NEW-SKU-CLUSTR-ID     TO CHLD-ITM-CLUSTR-ID      15810009
149100         MOVE 'M'                      TO REL-TYP-CDE             15820009
149200         MOVE WS-CURRENT-TMST          TO EFF-BEG-TMST            15830009
149300         MOVE 'I'                      TO CHLD-ITM-CLSTR-CDE      15840009
149400         MOVE -1                       TO WS-CLC-EFF-END-DTE-NULL 15850009
149500                                          WS-CHLD-ITM-UNT-QTY-NULL15860009
**TEMP*    DISPLAY 'C1300 CALL U9300-INSERT-TITMCLC '                   15870009
**TEMP*           ADD 1 TO WS-NBR-INS-UPD                               15880009
               PERFORM U9300-INSERT-TITMCLC                             15890009
                  THRU U9300-EXIT                                       15900009
149800     END-IF.                                                      15910009
149900                                                                  15920009
150000 C1300-EXIT.                                                      15930009
150100     EXIT.                                                        15940009
150200                                                                  15950009
150300                                                                  15960009
150400 C1310-SETUP-INSERT-NEW-SKU.                                      15970009
150500                                                                  15980009
150600*  GET A NEW CLUSTER ID FOR THE SKU INSERT                        15990009
150700*  THE SELECT IS DONE INTO ITMCLT-ITEM-CLUSTR-ID                  16000009
150800                                                                  16010009
150900     PERFORM U9000-SELECT-NEXT-SEQ-NBR                            16020009
151000        THRU U9000-EXIT.                                          16030009
151100                                                                  16040009
151200     MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-NEW-SKU-CLUSTR-ID.          16050009
151300                                                                  16060009
151400     IF WS-ITEM-CLUSTR-DESC = SPACES                              16070009
151500         IF SKXREF-ITM-NBR > ZEROS                                16080009
151600             MOVE SKXREF-ITM-NBR TO TSK-ITEM-NMBR                 16090009
151700             PERFORM C1311-SELECT-TSK-CLUSTR-DESC                 16100009
151800                THRU C1311-EXIT                                   16110009
151900             INITIALIZE WS-ITEM-CLUSTR-DESC                       16120009
152000             IF SQLCODE = ZERO                                    16130009
152100                 STRING TSK-SIZE-DESC  DELIMITED BY SIZE          16140009
152200                        ' '            DELIMITED BY SIZE          16150009
152300                        TSK-COLOR-DESC DELIMITED BY SIZE          16160009
152400                        ' '            DELIMITED BY SIZE          16170009
152500                        TSK-SKU-DESC   DELIMITED BY SIZE          16180009
152600                   INTO WS-ITEM-CLUSTR-DESC                       16190009
152700                                                                  16200009
152800                 INSPECT WS-ITEM-CLUSTR-DESC                      16210009
152900                 REPLACING ALL '''' BY SPACE                      16220009
153000                                                                  16230009
153100                 INSPECT WS-ITEM-CLUSTR-DESC                      16240009
153200                 REPLACING ALL '?' BY SPACE                       16250009
153300                                                                  16260009
153400                 INSPECT WS-ITEM-CLUSTR-DESC                      16270009
153500                 REPLACING ALL '_' BY SPACE                       16280009
153600                                                                  16290009
153700                 INSPECT WS-ITEM-CLUSTR-DESC                      16300009
153800                 REPLACING ALL '*' BY SPACE                       16310009
153900                                                                  16320009
154000                 INSPECT WS-ITEM-CLUSTR-DESC                      16330009
154100                 REPLACING ALL '"' BY SPACE                       16340009
154200             ELSE                                                 16350009
154300                 MOVE WS-NO-SKU-DESCRIPTION TO                    16360009
154400                      WS-ITEM-CLUSTR-DESC                         16370009
154500             END-IF                                               16380009
154600         ELSE                                                     16390009
154700             MOVE WS-NO-SKU-DESCRIPTION TO WS-ITEM-CLUSTR-DESC    16400009
154800         END-IF                                                   16410009
154900     END-IF.                                                      16420009
155000                                                                  16430009
155100     INITIALIZE DCLTITMCLT.                                       16440009
155200     MOVE WS-NEW-SKU-CLUSTR-ID       TO ITMCLT-ITEM-CLUSTR-ID.    16450009
155300     MOVE WS-NEW-SKU-NBR             TO ITMCLT-ITEM-CLUSTR-NAME.  16460009
155400     MOVE WS-ITEM-CLUSTR-DESC        TO ITMCLT-ITEM-CLUSTR-DESC.  16470009
155500     MOVE WS-CURRENT-TMST            TO ITMCLT-EFF-BEG-TMST.      16480009
155600     MOVE 'I'                        TO ITMCLT-ITEM-CLUSTR-CDE.   16490009
155700     MOVE 'M'                        TO ITMCLT-MDSE-NM-CDE.       16500009
155800     MOVE 'P'                        TO ITMCLT-PROD-SERV-CDE.     16510009
155900     MOVE WS-DPT-CLUSTR-ID           TO ITMCLT-OWNER-ID.          16520009
156000     MOVE WS-UPC-NBR-REDEF-7-14      TO ITMCLT-SKU.               16530009
156100     MOVE ZEROS                      TO WS-ITEM-CLUSTR-CDE-NULL   16540009
156200                                        WS-MDSE-NM-CDE-NULL       16550009
156300                                        WS-PROD-SERV-CDE-NULL     16560009
156400                                        WS-OWNER-ID-NULL          16570009
156500                                        WS-SKU-NULL.              16580009
156600     MOVE -1                         TO WS-CLT-EFF-END-DTE-NULL   16590009
156700                                        WS-CLUSTR-TYP-CDE-NULL    16600009
156800                                        WS-HIER-TYP-CDE-NULL      16610009
156900                                        WS-HIER-CDE-NULL          16620009
157000                                        WS-ARCH-DTE-NULL.         16630009
157100                                                                  16640009
**TEMP*    DISPLAY 'C1310 CALL U9200-INSERT-TITMCLT '                   16650009
**TEMP*    ADD 1 TO WS-NBR-INS-UPD.                                     16660009
           PERFORM U9200-INSERT-TITMCLT                                 16670009
              THRU U9200-EXIT.                                          16680009
157400                                                                  16690009
157500 C1310-EXIT.                                                      16700009
157600     EXIT.                                                        16710009
157700                                                                  16720009
157800                                                                  16730009
157900 C1311-SELECT-TSK-CLUSTR-DESC.                                    16740009
158000                                                                  16750009
158100     EXEC SQL                                                     16760009
158200         SELECT SIZE_DESC,                                        16770009
158300                COLOR_DESC,                                       16780009
158400                SKU_DESC                                          16790009
158500           INTO :TSK-SIZE-DESC,                                   16800009
158600                :TSK-COLOR-DESC,                                  16810009
158700                :TSK-SKU-DESC                                     16820009
158800           FROM TSK                                               16830009
158900          WHERE ITEM_NMBR = :TSK-ITEM-NMBR                        16840009
159000     END-EXEC.                                                    16850009
159100                                                                  16860009
159200     EVALUATE TRUE                                                16870009
159300         WHEN SQLCODE = ZEROS                                     16880009
159400             CONTINUE                                             16890009
159500         WHEN SQLCODE = +1403                                     16900009
159600             INITIALIZE WS-DISPLAY-ITM-NBR                        16910009
159700             MOVE TSK-ITEM-NMBR TO WS-DISPLAY-ITM-NBR             16920009
159800             DISPLAY 'UNABLE TO FIND TITMCLT DESCRIPTION ON TSK'  16930009
159900             DISPLAY 'ITEM-NMBR ' WS-DISPLAY-ITM-NBR              16940009
160000         WHEN OTHER                                               16950009
160100             DISPLAY 'C1311-SELECT-TSK-CLUSTR-DESC'               16960009
160200             INITIALIZE WS-DISPLAY-ITM-NBR                        16970009
160300             MOVE TSK-ITEM-NMBR TO WS-DISPLAY-ITM-NBR             16980009
160400             DISPLAY 'ITEM-NMBR: ' WS-DISPLAY-ITM-NBR             16990009
160500             PERFORM U9999-ABEND-ROUTINE                          17000009
160600     END-EVALUATE.                                                17010009
160700                                                                  17020009
160800 C1311-EXIT.                                                      17030009
160900     EXIT.                                                        17040009
161000                                                                  17050009
161100                                                                  17060009
161200 C1400-SETUP-INSERT-GRP-CDE.                                      17070009
161300                                                                  17080009
161400     MOVE SKXREF-ITM-NBR TO TSK-ITEM-NMBR.                        17090009
161500     PERFORM C1410-SELECT-TSK-GRP-CDE                             17100009
161600        THRU C1410-EXIT.                                          17110009
161700                                                                  17120009
161800*  THE ASSIGNMENT OF A SKU TO A GROUP CODE IS OPTIONAL            17130009
161900     IF SQLCODE = ZEROS AND TSK-GROUP-CODE NOT = SPACES           17140009
162000                                                                  17150009
162100         INITIALIZE WS-ITEM-CLUSTR-NAME                           17160009
162200         MOVE IM008-STYLE-RECL-DEPT-NEW  TO WS-WORK-DPT           17170009
162300         MOVE IM008-STYLE-RECL-SUBCL-NEW TO WS-WORK-SUBCL         17180009
162400         STRING WS-WORK-DPT-2-4            DELIMITED BY SIZE      17190009
162500                '-'                        DELIMITED BY SIZE      17200009
162600                WS-WORK-SUBCL-3-4          DELIMITED BY SIZE      17210009
162700                '-'                        DELIMITED BY SIZE      17220009
162800                TSK-GROUP-CODE             DELIMITED BY SIZE      17230009
162900           INTO WS-ITEM-CLUSTR-NAME                               17240009
163000                                                                  17250009
163100         MOVE WS-ITEM-CLUSTR-NAME                                 17260009
163200                    TO ITMCLT-ITEM-CLUSTR-NAME                    17270009
163300         MOVE 'GRP' TO ITMCLT-HIER-CDE                            17280009
163400** GROUP CODE DOES NOT CROSS DPTS                                 17290009
163500         PERFORM U9100-SELECT-TITMCLT                             17300009
163600            THRU U9100-EXIT                                       17310009
163700                                                                  17320009
163800         IF SQLCODE = ZEROS                                       17330009
163900           OR SQLCODE = -2112                                     17340009
164000               MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-GRP-CLUSTR-ID     17350009
164100         ELSE                                                     17360009
164200             PERFORM U9000-SELECT-NEXT-SEQ-NBR                    17370009
164300                THRU U9000-EXIT                                   17380009
164400             MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-GRP-CLUSTR-ID       17390009
164500                                                                  17400009
164600             INITIALIZE DCLTITMCLT                                17410009
164700             MOVE WS-GRP-CLUSTR-ID TO ITMCLT-ITEM-CLUSTR-ID       17420009
164800             MOVE WS-ITEM-CLUSTR-NAME                             17430009
164900                             TO ITMCLT-ITEM-CLUSTR-NAME           17440009
165000                                ITMCLT-ITEM-CLUSTR-DESC           17450009
165100             MOVE WS-CURRENT-TMST                                 17460009
165200                             TO ITMCLT-EFF-BEG-TMST               17470009
165300             MOVE 'S'        TO ITMCLT-CLUSTR-TYP-CDE             17480009
165400             MOVE 'M'        TO ITMCLT-HIER-TYP-CDE               17490009
165500             MOVE 'GRP'      TO ITMCLT-HIER-CDE                   17500009
165600             MOVE 'C'        TO ITMCLT-ITEM-CLUSTR-CDE            17510009
165700             MOVE WS-DPT-CLUSTR-ID                                17520009
165800                             TO ITMCLT-OWNER-ID                   17530009
165900             MOVE ZEROS      TO WS-CLUSTR-TYP-CDE-NULL            17540009
166000                                WS-HIER-TYP-CDE-NULL              17550009
166100                                WS-HIER-CDE-NULL                  17560009
166200                                WS-ITEM-CLUSTR-CDE-NULL           17570009
166300                                WS-OWNER-ID-NULL                  17580009
166400             MOVE -1         TO WS-CLT-EFF-END-DTE-NULL           17590009
166500                                WS-MDSE-NM-CDE-NULL               17600009
166600                                WS-PROD-SERV-CDE-NULL             17610009
166700                                WS-ARCH-DTE-NULL                  17620009
166800                                WS-SKU-NULL                       17630009
**TEMP*    DISPLAY 'C1400 CALL U9200-INSERT-TITMCLT '                   17640009
**TEMP*    ADD 1 TO WS-NBR-INS-UPD                                      17650009
                   PERFORM U9200-INSERT-TITMCLT                         17660009
                      THRU U9200-EXIT                                   17670009
167100         END-IF                                                   17680009
167200                                                                  17690009
167300         INITIALIZE ITT00001                                      17700009
167400         MOVE WS-GRP-CLUSTR-ID      TO PRNT-ITM-CLUSTR-ID         17710009
167500         MOVE WS-NEW-SKU-CLUSTR-ID  TO CHLD-ITM-CLUSTR-ID         17720009
167600         MOVE 'M'                   TO REL-TYP-CDE                17730009
167700         MOVE WS-CURRENT-TMST       TO EFF-BEG-TMST               17740009
167800         MOVE 'I'                   TO CHLD-ITM-CLSTR-CDE         17750009
167900         MOVE -1                    TO WS-CLC-EFF-END-DTE-NULL    17760009
168000                                       WS-CHLD-ITM-UNT-QTY-NULL   17770009
**TEMP*    DISPLAY 'C1400 CALL U9300-INSERT-TITMCLC '                   17780009
**TEMP*    ADD 1 TO WS-NBR-INS-UPD                                      17790009
               PERFORM U9300-INSERT-TITMCLC                             17800009
                  THRU U9300-EXIT                                       17810009
168300     END-IF.                                                      17820009
168400                                                                  17830009
168500 C1400-EXIT.                                                      17840009
168600     EXIT.                                                        17850009
168700                                                                  17860009
168800                                                                  17870009
168900 C1410-SELECT-TSK-GRP-CDE.                                        17880009
169000                                                                  17890009
169100     EXEC SQL                                                     17900009
169200         SELECT GROUP_CODE                                        17910009
169300           INTO :TSK-GROUP-CODE                                   17920009
169400           FROM TSK                                               17930009
169500          WHERE ITEM_NMBR = :TSK-ITEM-NMBR                        17940009
169600     END-EXEC.                                                    17950009
169700                                                                  17960009
169800     EVALUATE TRUE                                                17970009
169900         WHEN SQLCODE = ZEROS                                     17980009
170000         WHEN SQLCODE = +1403                                     17990009
170100             CONTINUE                                             18000009
170200         WHEN OTHER                                               18010009
170300             DISPLAY 'C1410-SELECT-TSK-GRP-CDE'                   18020009
170400             INITIALIZE WS-DISPLAY-ITM-NBR                        18030009
170500             MOVE TSK-ITEM-NMBR TO WS-DISPLAY-ITM-NBR             18040009
170600             DISPLAY 'ITEM-NMBR: ' WS-DISPLAY-ITM-NBR             18050009
170700             PERFORM U9999-ABEND-ROUTINE                          18060009
170800     END-EVALUATE.                                                18070009
170900                                                                  18080009
171000 C1410-EXIT.                                                      18090009
171100     EXIT.                                                        18100009
171200                                                                  18110009
171300                                                                  18120009
171400 C1500-SETUP-INSERT-VND.                                          18130009
171500                                                                  18140009
171600*    DISPLAY 'C1500-SETUP-INSERT-VND'.                            18150009
171700                                                                  18160009
171800     SET VND-INFO-NOT-FOUND TO TRUE.                              18170009
171900     MOVE SKXREF-ITM-NBR    TO TSK-ITEM-NMBR.                     18180009
172000     PERFORM C1510-SELECT-TENTNME-TSK                             18190009
172100        THRU C1510-EXIT.                                          18200009
172200                                                                  18210009
172300*  IF NO VND INFO IS FOUND, BYPASS VND AND VST RELATIONSHIPS      18220009
172400     IF SQLCODE = +1403                                           18230009
172500         GO TO C1500-EXIT                                         18240009
172600     ELSE                                                         18250009
172700         SET VND-INFO-FOUND TO TRUE                               18260009
172800     END-IF.                                                      18270009
172900                                                                  18280009
173000     MOVE ENTNME-ENT-NAME-DESC(1:10)                              18290009
173100                          TO WS-VND-CLUSTR-NAME-DESC.             18300009
173200     MOVE TSK-ENT-ID      TO WS-VND-CLUSTR-NAME-ENT-ID.           18310009
173300     MOVE WS-VND-CLUSTR-NAME                                      18320009
173400                          TO ITMCLT-ITEM-CLUSTR-NAME.             18330009
173500*  THE SAME VENDOR NAME MAY EXIST IN MULTIPLE DPTS                18340009
173600     MOVE WS-DPT-CLUSTR-ID TO ITMCLT-OWNER-ID.                    18350009
173700                                                                  18360009
173800     SET VND-NOT-ON-CLT    TO TRUE.                               18370009
173900*  DOES THIS VENDOR NAME EXIST IN THE SKU'S OWNING DPT            18380009
174000     PERFORM C1520-SELECT-TITMCLT-VND-NAME                        18390009
174100        THRU C1520-EXIT.                                          18400009
174200                                                                  18410009
174300     IF SQLCODE = ZEROS                                           18420009
174400       OR SQLCODE = -2112                                         18430009
174500         SET VND-ON-CLT             TO TRUE                       18440009
174600         MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-VND-CLUSTR-ID           18450009
174700         GO TO C1500-EXIT                                         18460009
174800     END-IF.                                                      18470009
174900                                                                  18480009
175000*  CHECK TO SEE IF THE VENDOR EXISTS WITH A DIFFERENT NAME        18490009
175100*  IN THE SAME OWNER ID I.E DPT                                   18500009
175200     IF SQLCODE = +1403                                           18510009
175300         PERFORM C1530-SELECT-TITMCLT-VND-ENTID                   18520009
175400            THRU C1530-EXIT                                       18530009
175500         IF SQLCODE = ZEROS                                       18540009
175600           OR SQLCODE = -2112                                     18550009
175700             SET VND-ON-CLT   TO TRUE                             18560009
175800             MOVE ITMCLT-ITEM-CLUSTR-ID                           18570009
175900                              TO WS-VND-CLUSTR-ID                 18580009
176000*  UPDATE ITMCLT-ITEM-CLUSTR-NAME                                 18590009
**TEMP*    DISPLAY 'C1500 CALL C1540-UPDATE-TITMCLT-VND'                18600009
**TEMP*    ADD 1 TO WS-NBR-INS-UPD                                      18610009
                   PERFORM C1540-UPDATE-TITMCLT-VND                     18620009
                      THRU C1540-EXIT                                   18630009
176300         ELSE                                                     18640009
176400*  SET THE VALUES FOR THE VND INSERT                              18650009
176500             PERFORM U9000-SELECT-NEXT-SEQ-NBR                    18660009
176600                THRU U9000-EXIT                                   18670009
176700             MOVE ITMCLT-ITEM-CLUSTR-ID                           18680009
176800                                  TO WS-VND-CLUSTR-ID             18690009
176900                                                                  18700009
177000             INITIALIZE DCLTITMCLT                                18710009
177100             MOVE WS-VND-CLUSTR-ID                                18720009
177200                                  TO ITMCLT-ITEM-CLUSTR-ID        18730009
177300             MOVE WS-VND-CLUSTR-NAME                              18740009
177400                                  TO ITMCLT-ITEM-CLUSTR-NAME      18750009
177500             MOVE ENTNME-ENT-NAME-DESC                            18760009
177600                                  TO ITMCLT-ITEM-CLUSTR-DESC      18770009
177700             MOVE WS-CURRENT-TMST TO ITMCLT-EFF-BEG-TMST          18780009
177800             MOVE 'S'             TO ITMCLT-CLUSTR-TYP-CDE        18790009
177900             MOVE 'M'             TO ITMCLT-HIER-TYP-CDE          18800009
178000             MOVE 'VND'           TO ITMCLT-HIER-CDE              18810009
178100             MOVE 'C'             TO ITMCLT-ITEM-CLUSTR-CDE       18820009
178200             MOVE WS-DPT-CLUSTR-ID                                18830009
178300                                  TO ITMCLT-OWNER-ID              18840009
178400             MOVE ZERO            TO WS-CLUSTR-TYP-CDE-NULL       18850009
178500                                     WS-HIER-TYP-CDE-NULL         18860009
178600                                     WS-HIER-CDE-NULL             18870009
178700                                     WS-ITEM-CLUSTR-CDE-NULL      18880009
178800                                     WS-OWNER-ID-NULL             18890009
178900             MOVE -1              TO WS-CLT-EFF-END-DTE-NULL      18900009
179000                                     WS-MDSE-NM-CDE-NULL          18910009
179100                                     WS-PROD-SERV-CDE-NULL        18920009
179200                                     WS-ARCH-DTE-NULL             18930009
179300                                     WS-SKU-NULL                  18940009
**TEMP*    DISPLAY 'C1500 CALL U9200-INSERT-TITMCLT '                   18950009
**TEMP*    ADD 1 TO WS-NBR-INS-UPD                                      18960009
                   PERFORM U9200-INSERT-TITMCLT                         18970009
                      THRU U9200-EXIT                                   18980009
179600         END-IF                                                   18990009
179700     END-IF.                                                      19000009
179800                                                                  19010009
179900 C1500-EXIT.                                                      19020009
180000     EXIT.                                                        19030009
180100                                                                  19040009
180200                                                                  19050009
180300 C1510-SELECT-TENTNME-TSK.                                        19060009
180400                                                                  19070009
180500     EXEC SQL                                                     19080009
180600         SELECT A.ENT_NAME_DESC,                                  19090009
180700                B.LONG_VENDOR_STYLE,                              19100009
180800                B.ENT_ID                                          19110009
180900           INTO :ENTNME-ENT-NAME-DESC,                            19120009
181000                :TSK-LONG-VENDOR-STYLE,                           19130009
181100                :TSK-ENT-ID                                       19140009
181200           FROM TENTNME A,                                        19150009
181300                TSK     B                                         19160009
181400          WHERE B.ITEM_NMBR = :TSK-ITEM-NMBR                      19170009
181500            AND A.ENT_ID    = B.ENT_ID                            19180009
181600            AND A.TYPE_CDE  = '01'                                19190009
181700     END-EXEC.                                                    19200009
181800                                                                  19210009
181900     EVALUATE TRUE                                                19220009
182000         WHEN SQLCODE = ZEROS                                     19230009
182100         WHEN SQLCODE = +1403                                     19240009
182200             CONTINUE                                             19250009
182300         WHEN OTHER                                               19260009
182400             DISPLAY 'C1510-SELECT-TENTNME-TSK'                   19270009
182500             INITIALIZE WS-DISPLAY-ITM-NBR                        19280009
182600             MOVE TSK-ITEM-NMBR TO WS-DISPLAY-ITM-NBR             19290009
182700             DISPLAY 'ITEM-NMBR: ' WS-DISPLAY-ITM-NBR             19300009
182800             PERFORM U9999-ABEND-ROUTINE                          19310009
182900     END-EVALUATE.                                                19320009
183000                                                                  19330009
183100 C1510-EXIT.                                                      19340009
183200     EXIT.                                                        19350009
183300                                                                  19360009
183400                                                                  19370009
183500 C1520-SELECT-TITMCLT-VND-NAME.                                   19380009
183600                                                                  19390009
183700*    DISPLAY 'C1520-SELECT-TITMCLT-VND-NAME'.                     19400009
183800                                                                  19410009
183900     EXEC SQL                                                     19420009
184000         SELECT ITEM_CLUSTR_ID,                                   19430009
184100                ITEM_CLUSTR_DESC,                                 19440009
184200                EFF_BEG_TMST,                                     19450009
184300                EFF_END_TMST,                                     19460009
184400                LAST_UPD_TMST                                     19470009
184500           INTO :ITMCLT-ITEM-CLUSTR-ID,                           19480009
184600                :ITMCLT-ITEM-CLUSTR-DESC,                         19490009
184700                :ITMCLT-EFF-BEG-TMST,                             19500009
184800                :ITMCLT-EFF-END-TMST:WS-CLT-EFF-END-DTE-NULL,     19510009
184900                :ITMCLT-LAST-UPD-TMST                             19520009
185000           FROM TITMCLT                                           19530009
185100          WHERE ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME       19540009
185200            AND HIER_CDE         = 'VND'                          19550009
185300            AND OWNER_ID         = :ITMCLT-OWNER-ID               19560009
185400            AND ((EFF_END_TMST IS NULL) OR                        19570009
185500                 (EFF_END_TMST > :WS-CURR-END-TMST))              19580009
185600     END-EXEC.                                                    19590009
185700                                                                  19600009
185800     EVALUATE TRUE                                                19610009
185900         WHEN SQLCODE = ZEROS                                     19620009
186000         WHEN SQLCODE = +1403                                     19630009
186100         WHEN SQLCODE = -2112                                     19640009
186200             CONTINUE                                             19650009
186300         WHEN OTHER                                               19660009
186400             DISPLAY 'C1520-SELECT-TITMCLT-VND-NAME'              19670009
186500             DISPLAY 'ITEM-CLUSTR-NAME: ' ITMCLT-ITEM-CLUSTR-NAME 19680009
186600             DISPLAY 'OWNER-ID:         ' ITMCLT-OWNER-ID         19690009
186700             PERFORM U9999-ABEND-ROUTINE                          19700009
186800     END-EVALUATE.                                                19710009
186900                                                                  19720009
187000 C1520-EXIT.                                                      19730009
187100     EXIT.                                                        19740009
187200                                                                  19750009
187300                                                                  19760009
187400 C1530-SELECT-TITMCLT-VND-ENTID.                                  19770009
187500                                                                  19780009
187600*    DISPLAY 'C1530-SELECT-TITMCLT-VND-ENTID'.                    19790009
187700                                                                  19800009
187800     EXEC SQL                                                     19810009
187900         SELECT ITEM_CLUSTR_ID,                                   19820009
188000                ITEM_CLUSTR_DESC,                                 19830009
188100                EFF_BEG_TMST,                                     19840009
188200                EFF_END_TMST                                      19850009
188300           INTO :ITMCLT-ITEM-CLUSTR-ID,                           19860009
188400                :ITMCLT-ITEM-CLUSTR-DESC,                         19870009
188500                :ITMCLT-EFF-BEG-TMST,                             19880009
188600                :ITMCLT-EFF-END-TMST:WS-CLT-EFF-END-DTE-NULL      19890009
188700           FROM TITMCLT                                           19900009
188800          WHERE HIER_CDE         = 'VND'                          19910009
188900            AND OWNER_ID         = :ITMCLT-OWNER-ID               19920009
189000            AND SUBSTR(ITEM_CLUSTR_NAME,12,9)                     19930009
189100                      = LPAD(TO_CHAR(:TSK-ENT-ID),9,0)            19940009
189200            AND ((EFF_END_TMST IS NULL) OR                        19950009
189300                 (EFF_END_TMST > :WS-CURR-END-TMST))              19960009
189400     END-EXEC.                                                    19970009
189500                                                                  19980009
189600     EVALUATE TRUE                                                19990009
189700         WHEN SQLCODE = ZEROS                                     20000009
189800         WHEN SQLCODE = +1403                                     20010009
189900         WHEN SQLCODE = -2112                                     20020009
190000             CONTINUE                                             20030009
190100         WHEN OTHER                                               20040009
190200             DISPLAY 'C1530-SELECT-TITMCLT-VND-ENTID'             20050009
190300             DISPLAY 'OWNER-ID:         ' ITMCLT-OWNER-ID         20060009
190400             DISPLAY 'ITEM-CLUSTR-NAME: ' TSK-ENT-ID              20070009
190500             PERFORM U9999-ABEND-ROUTINE                          20080009
190600     END-EVALUATE.                                                20090009
190700                                                                  20100009
190800 C1530-EXIT.                                                      20110009
190900     EXIT.                                                        20120009
191000                                                                  20130009
191100                                                                  20140009
191200 C1540-UPDATE-TITMCLT-VND.                                        20150009
191300                                                                  20160009
191400* THE NEW VALUE OF ITMCLT-ITEM-CLUSTR-NAME WAS RETRIEVED          20170009
191500* IN C1510-SELECT-TENTNME-TSK AND SET UP IN THE UPDATE            20180009
191600* FIELD IN C1500-SETUP-INSERT-VND                                 20190009
191700                                                                  20200009
191800     EXEC SQL                                                     20210009
191900         UPDATE TITMCLT                                           20220009
192000            SET ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME       20230009
192100          WHERE ITEM_CLUSTR_ID   = :ITMCLT-ITEM-CLUSTR-ID         20240009
192200            AND HIER_CDE         = 'VND'                          20250009
192300            AND OWNER_ID         = :ITMCLT-OWNER-ID               20260009
192400            AND ((EFF_END_TMST IS NULL) OR                        20270009
192500                (EFF_END_TMST > :WS-CURR-END-TMST))               20280009
192600     END-EXEC.                                                    20290009
192700                                                                  20300009
192800     EVALUATE TRUE                                                20310009
192900         WHEN SQLCODE = ZEROS                                     20320009
0822RM*** ADD TO COMMIT COUNT                                           20330009
0822RM            ADD +1 TO WS-NBR-INS-UPD                              20340009
0822RM*           DISPLAY '  ITEM-CLUSTR-ID: ' ITMCLT-ITEM-CLUSTR-ID    20350009
0822RM*           DISPLAY 'ITEM-CLUSTR-NAME: ' ITMCLT-ITEM-CLUSTR-NAME  20360009
193200         WHEN OTHER                                               20370009
193300            DISPLAY 'C1540-UPDATE-TITMCLT-VND'                    20380009
193400            DISPLAY 'ITEM-CLUSTR-ID: ' ITMCLT-ITEM-CLUSTR-ID      20390009
193500            DISPLAY 'OWNER-ID:       ' ITMCLT-OWNER-ID            20400009
193600            PERFORM U9999-ABEND-ROUTINE                           20410009
193700     END-EVALUATE.                                                20420009
193800                                                                  20430009
193900 C1540-EXIT.                                                      20440009
194000     EXIT.                                                        20450009
194100                                                                  20460009
194200                                                                  20470009
194300 C1600-SETUP-INSERT-VST.                                          20480009
194400                                                                  20490009
194500*    DISPLAY 'C1600-SETUP-INSERT-VST'.                            20500009
194600                                                                  20510009
194700*  IF VND-NOT-ON-CLT, THIS MEANS THAT THE VND RCD WAS INSERTED    20520009
194800*  DURING THIS RUN.  SO, WE CAN ASSUME THAT THE VST DOES NOT      20530009
194900*  EXIST W/O DOING ANY FURTHER CHECKING.                          20540009
195000                                                                  20550009
195100     IF VND-NOT-ON-CLT                                            20560009
195200         PERFORM C1610-INSERT-VST                                 20570009
195300            THRU C1610-EXIT                                       20580009
195400     ELSE                                                         20590009
195500         MOVE TSK-LONG-VENDOR-STYLE TO ITMCLT-ITEM-CLUSTR-NAME    20600009
195600         MOVE WS-DPT-CLUSTR-ID      TO ITMCLT-OWNER-ID            20610009
195700*        IF ((IM008-ITEM-KEY-DEPT = IM008-STYLE-RECL-DEPT-NEW)    20620009
195800*          AND (IM008-ITEM-KEY-SUBCL                              20630009
195900*                             NOT = IM008-STYLE-RECL-SUBCL-NEW))  20640009
196000             PERFORM C1620-SELECT-TITMCLT-VST                     20650009
196100                THRU C1620-EXIT                                   20660009
196200*        ELSE                                                     20670009
196300                                                                  20680009
196400*  CHECK FOR A MATCHING VST IN THIS DEPT THAT HAS A CORRESPONDING 20690009
196500*  VST/VND RELATIONSHIP ON TITMCLC AND A PARTIAL SKU MATCH        20700009
196600*  I.E. DPT/SCL ON TITMCLT                                        20710009
196700                                                                  20720009
196800*            MOVE IM008-STYLE-RECL-DEPT-NEW  TO WS-WORK-DPT       20730009
196900*            MOVE WS-WORK-DPT-2-4            TO WS-HOLD-DPT       20740009
197000*            MOVE IM008-STYLE-RECL-SUBCL-NEW TO WS-WORK-SUBCL     20750009
197100*            MOVE WS-WORK-SUBCL-3-4          TO WS-HOLD-SCL       20760009
197200*            MOVE WS-HOLD-DPT-SCL TO WS-HOLD-DPT-SCL-REDEF        20770009
197300*            PERFORM C1630-SELECT-TITMCLT-VST-SUBCL               20780009
197400*               THRU C1630-EXIT                                   20790009
197500*        END-IF                                                   20800009
197600         IF SQLCODE = ZEROS                                       20810009
197700           OR SQLCODE = -2112                                     20820009
197800             MOVE ITMCLT-ITEM-CLUSTR-ID                           20830009
197900                                  TO WS-VST-CLUSTR-ID             20840009
198000         ELSE                                                     20850009
198100             PERFORM C1610-INSERT-VST                             20860009
198200                THRU C1610-EXIT                                   20870009
198300         END-IF                                                   20880009
198400     END-IF.                                                      20890009
198500                                                                  20900009
198600     PERFORM C1640-INSERT-VST-SKU-REL                             20910009
198700        THRU C1640-EXIT.                                          20920009
198800                                                                  20930009
198900 C1600-EXIT.                                                      20940009
199000     EXIT.                                                        20950009
199100                                                                  20960009
199200                                                                  20970009
199300 C1610-INSERT-VST.                                                20980009
199400                                                                  20990009
199500*    DISPLAY 'C1610-INSERT-VST'.                                  21000009
199600                                                                  21010009
199700     PERFORM U9000-SELECT-NEXT-SEQ-NBR                            21020009
199800        THRU U9000-EXIT.                                          21030009
199900     MOVE ITMCLT-ITEM-CLUSTR-ID TO WS-VST-CLUSTR-ID.              21040009
200000                                                                  21050009
200100     INITIALIZE DCLTITMCLT.                                       21060009
200200     MOVE WS-VST-CLUSTR-ID      TO ITMCLT-ITEM-CLUSTR-ID.         21070009
200300     MOVE TSK-LONG-VENDOR-STYLE TO ITMCLT-ITEM-CLUSTR-NAME        21080009
200400                                   ITMCLT-ITEM-CLUSTR-DESC.       21090009
200500                                                                  21100009
200600     MOVE WS-CURRENT-TMST       TO ITMCLT-EFF-BEG-TMST.           21110009
200700     MOVE 'S'                   TO ITMCLT-CLUSTR-TYP-CDE.         21120009
200800     MOVE 'M'                   TO ITMCLT-HIER-TYP-CDE.           21130009
200900     MOVE 'VST'                 TO ITMCLT-HIER-CDE.               21140009
201000     MOVE 'C'                   TO ITMCLT-ITEM-CLUSTR-CDE.        21150009
201100     MOVE WS-DPT-CLUSTR-ID      TO ITMCLT-OWNER-ID.               21160009
201200                                                                  21170009
201300     MOVE ZEROS                 TO WS-CLUSTR-TYP-CDE-NULL         21180009
201400                                   WS-HIER-TYP-CDE-NULL           21190009
201500                                   WS-HIER-CDE-NULL               21200009
201600                                   WS-ITEM-CLUSTR-CDE-NULL        21210009
201700                                   WS-OWNER-ID-NULL.              21220009
201800     MOVE -1                    TO WS-CLT-EFF-END-DTE-NULL        21230009
201900                                   WS-MDSE-NM-CDE-NULL            21240009
202000                                   WS-PROD-SERV-CDE-NULL          21250009
202100                                   WS-ARCH-DTE-NULL               21260009
202200                                   WS-SKU-NULL.                   21270009
202300                                                                  21280009
**TEMP*    DISPLAY 'C1610 CALL U9200-INSERT-TITMCLT '                   21290009
**TEMP*    ADD 1 TO WS-NBR-INS-UPD                                      21291009
           PERFORM U9200-INSERT-TITMCLT                                 21292009
              THRU U9200-EXIT.                                          21293009
202700**  INSERT THE VND/VST TITMCLC RELATIONSHIP                       21294009
202800     INITIALIZE ITT00001.                                         21295009
202900     MOVE WS-VND-CLUSTR-ID TO PRNT-ITM-CLUSTR-ID.                 21296009
203000     MOVE WS-VST-CLUSTR-ID TO CHLD-ITM-CLUSTR-ID.                 21297009
203100     MOVE 'M'                  TO REL-TYP-CDE.                    21298009
203200     MOVE WS-CURRENT-TMST      TO EFF-BEG-TMST.                   21299009
203300     MOVE 'C'                  TO CHLD-ITM-CLSTR-CDE.             21300009
203400     MOVE -1                   TO WS-CLC-EFF-END-DTE-NULL         21310009
203500                                  WS-CHLD-ITM-UNT-QTY-NULL.       21320009
203600                                                                  21330009
**TEMP*    DISPLAY 'C1610 CALL U9300-INSERT-TITMCLC '                   21340009
**TEMP*    ADD 1 TO WS-NBR-INS-UPD.                                     21350009
           PERFORM U9300-INSERT-TITMCLC                                 21360009
              THRU U9300-EXIT.                                          21370009
204000 C1610-EXIT.                                                      21380009
204100     EXIT.                                                        21390009
204200                                                                  21400009
204300                                                                  21410009
204400 C1620-SELECT-TITMCLT-VST.                                        21420009
204500                                                                  21430009
204600*    DISPLAY 'C1620-SELECT-TITMCLT-VST'.                          21440009
204700                                                                  21450009
204800     EXEC SQL                                                     21460009
204900         SELECT /*+ INDEX(A IITMCLT1) */                          21470009
205000                ITEM_CLUSTR_ID,                                   21480009
205100                ITEM_CLUSTR_DESC,                                 21490009
205200                EFF_BEG_TMST,                                     21500009
205300                EFF_END_TMST                                      21510009
205400           INTO ITMCLT-ITEM-CLUSTR-ID,                            21520009
205500                ITMCLT-ITEM-CLUSTR-DESC,                          21530009
205600                ITMCLT-EFF-BEG-TMST,                              21540009
205700                ITMCLT-EFF-END-TMST:WS-CLT-EFF-END-DTE-NULL       21550009
205800           FROM TITMCLT A                                         21560009
205900          WHERE ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME       21570009
206000            AND HIER_CDE         = 'VST'                          21580009
206100            AND OWNER_ID         = :ITMCLT-OWNER-ID               21590009
206200            AND ((A.EFF_END_TMST IS NULL) OR                      21600009
206300                 (A.EFF_END_TMST > :WS-CURR-END-TMST))            21610009
206400            AND EXISTS                                            21620009
206500              (SELECT CHLD_ITM_CLUSTR_ID                          21630009
206600                 FROM TITMCLC B                                   21640009
206700                WHERE PRNT_ITM_CLUSTR_ID = :WS-VND-CLUSTR-ID      21650009
206800                  AND CHLD_ITM_CLUSTR_ID = A.ITEM_CLUSTR_ID       21660009
206900                  AND REL_TYP_CDE        = 'M'                    21670009
207000                  AND ((B.EFF_END_TMST IS NULL) OR                21680009
207100                       (B.EFF_END_TMST > :WS-CURR-END-TMST)))     21690009
207200     END-EXEC.                                                    21700009
207300                                                                  21710009
207400     EVALUATE TRUE                                                21720009
207500         WHEN SQLCODE = ZEROS                                     21730009
207600         WHEN SQLCODE = +1403                                     21740009
207700         WHEN SQLCODE = -2112                                     21750009
207800             CONTINUE                                             21760009
207900         WHEN OTHER                                               21770009
208000             DISPLAY 'C1620-SELECT-TITMCLT-VST'                   21780009
208100             DISPLAY 'PRNT-ITM-CLUSTR-ID: ' WS-VND-CLUSTR-ID      21790009
208200             PERFORM U9999-ABEND-ROUTINE                          21800009
208300     END-EVALUATE.                                                21810009
208400                                                                  21820009
208500 C1620-EXIT.                                                      21830009
208600     EXIT.                                                        21840009
208700                                                                  21850009
208800                                                                  21860009
208900*C1630-SELECT-TITMCLT-VST-SUBCL.                                  21870009
209000                                                                  21880009
209100*    DISPLAY 'C1630-SELECT-TITMCLT-VST-SUBCL'.                    21890009
209200                                                                  21900009
209300*    EXEC SQL                                                     21910009
209400*      SELECT /*+ INDEX(IITMCLT1) */                              21920009
209500*             ITEM_CLUSTR_ID,                                     21930009
209600*             ITEM_CLUSTR_DESC,                                   21940009
209700*             EFF_BEG_TMST,                                       21950009
209800*             EFF_END_TMST                                        21960009
209900*        INTO :ITMCLT-ITEM-CLUSTR-ID,                             21970009
210000*             :ITMCLT-ITEM-CLUSTR-DESC,                           21980009
210100*             :ITMCLT-EFF-BEG-TMST,                               21990009
210200*             :ITMCLT-EFF-END-TMST:WS-CLT-EFF-END-DTE-NULL        22000009
210300*        FROM TITMCLT A                                           22010009
210400*       WHERE ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME         22020009
210500*         AND HIER_CDE         = 'VST'                            22030009
210600*         AND OWNER_ID         = :ITMCLT-OWNER-ID                 22040009
210700*         AND ((EFF_END_TMST IS NULL) OR                          22050009
210800*              (EFF_END_TMST > :WS-CURR-END-TMST))                22060009
210900*         AND EXISTS                                              22070009
211000*          (SELECT CHLD_ITM_CLUSTR_ID                             22080009
211100*             FROM TITMCLC                                        22090009
211200*            WHERE PRNT_ITM_CLUSTR_ID                             22100009
211300*                          = :WS-VND-CLUSTR-ID                    22110009
211400*              AND CHLD_ITM_CLUSTR_ID = A.ITEM_CLUSTR_ID          22120009
211500*              AND REL_TYP_CDE        = 'M'                       22130009
211600*              AND  ((EFF_END_TMST IS NULL) OR                    22140009
211700*                    (EFF_END_TMST > :WS-CURR-END-TMST)))         22150009
211800*         AND EXISTS                                              22160009
211900*          (SELECT CHLD_ITM_CLUSTR_ID                             22170009
212000*             FROM TITMCLC X,                                     22180009
212100*                  TITMCLT Y                                      22190009
212200*            WHERE X.PRNT_ITM_CLUSTR_ID                           22200009
212300*                           = CHLD_ITM_CLUSTR_ID                  22210009
212400*              AND X.CHLD_ITM_CLUSTR_ID = Y.ITEM_CLUSTR_ID        22220009
212500*              AND Y.ITEM_CLUSTR_NAME LIKE :WS-HOLD-DPT-SCL-REDEF 22230009
212600*              AND X.CHLD_ITM_CLSTR_CDE = 'I'                     22240009
212700*              AND X.REL_TYP_CDE = 'M'                            22250009
212800*              AND (( X.EFF_END_TMST IS NULL)                     22260009
212900*               OR (X.EFF_END_TMST > :WS-CURR-END-TMST)))         22270009
213000*    END-EXEC.                                                    22280009
213100                                                                  22290009
213200*    EVALUATE TRUE                                                22300009
213300*        WHEN SQLCODE = ZEROS                                     22310009
213400*        WHEN SQLCODE = +1403                                     22320009
213500*        WHEN SQLCODE = -2112                                     22330009
213600*            CONTINUE                                             22340009
213700*        WHEN OTHER                                               22350009
213800*           DISPLAY 'C1630-SELECT-TITMCLT-VST-SUBCL'              22360009
213900*           DISPLAY 'ITEM-CLUSTR-NAME:   ' ITMCLT-ITEM-CLUSTR-NAME22370009
214000*           DISPLAY 'PRNT-ITM-CLUSTR:    ' WS-VND-CLUSTR-ID       22380009
214100*           DISPLAY 'Y.ITEM-CLUSTR-NAME: '                        22390009
214200*           DISPLAY '        ' WS-HOLD-DPT-SCL-REDEF              22400009
214300*           PERFORM U9999-ABEND-ROUTINE                           22410009
214400*    END-EVALUATE.                                                22420009
214500                                                                  22430009
214600*C1630-EXIT.                                                      22440009
214700*    EXIT.                                                        22450009
214800                                                                  22460009
214900                                                                  22470009
215000 C1640-INSERT-VST-SKU-REL.                                        22480009
215100                                                                  22490009
215200*    DISPLAY 'C1640-INSERT-VST-SKU-REL'.                          22500009
215300                                                                  22510009
215400     MOVE WS-CURRENT-TMST-NEW TO WS-NEW-TMST.                     22520009
215500     PERFORM  UNTIL WS-NEW-TMST > WS-CURRENT-TMST-NEW             22530009
215600         PERFORM VARYING WS-SUB FROM 1 BY 1                       22540009
215700            UNTIL WS-SUB > 999                                    22550009
215800                MOVE SPACES TO WS-DUMMY                           22560009
215900         END-PERFORM                                              22570009
216000         EXEC SQL                                                 22580009
216100             SELECT SYSDATE                                       22590009
216200               INTO :WS-NEW-TMST                                  22600009
216300               FROM DUAL                                          22610009
216400         END-EXEC                                                 22620009
216500     END-PERFORM.                                                 22630009
216600                                                                  22640009
216700     MOVE WS-NEW-TMST              TO WS-CURRENT-TMST-NEW.        22650009
216800                                                                  22660009
216900**  INSERT THE VST/SKU TITMCLC RELATIONSHIP                       22670009
217000     INITIALIZE ITT00001.                                         22680009
217100     MOVE WS-VST-CLUSTR-ID         TO PRNT-ITM-CLUSTR-ID.         22690009
217200     MOVE WS-NEW-SKU-CLUSTR-ID     TO CHLD-ITM-CLUSTR-ID.         22700009
217300     MOVE 'M'                      TO REL-TYP-CDE.                22710009
217400     MOVE WS-CURRENT-TMST-NEW      TO EFF-BEG-TMST.               22720009
217500     MOVE 'I'                      TO CHLD-ITM-CLSTR-CDE.         22730009
217600     MOVE -1                       TO WS-CLC-EFF-END-DTE-NULL     22740009
217700                                      WS-CHLD-ITM-UNT-QTY-NULL.   22750009
217800                                                                  22760009
**TEMP*    DISPLAY 'C1640 CALL U9300-INSERT-TITMCLC '                   22770009
**TEMP*        ADD 1 TO WS-NBR-INS-UPD.                                 22780009
           PERFORM U9300-INSERT-TITMCLC                                 22790009
              THRU U9300-EXIT.                                          22800009
218100                                                                  22810009
218200 C1640-EXIT.                                                      22820009
218300     EXIT.                                                        22830009
218400                                                                  22840009
218500                                                                  22850009
218600 D1000-EXPIRE-EXIST-SKU-REL.                                      22860009
218700                                                                  22870009
218800*    DISPLAY 'D1000-EXPIRE-EXIST-SKU-REL'.                        22880009
218900                                                                  22890009
219000*      IF THIS IS CALLED FROM B1000, ITMCLT-ITEM-CLUSTR-NAME      22900009
219100*      CONTAINS WS-OLD-SKU-NBR.  IF IT'S CALLED FROM C1000,       22910009
219200*      THE CLUSTR NAME CONTAINS WS-NEW-SKU-NBR.                   22920009
219300                                                                  22930009
219400*      DECLARE CLCCSR CURSOR FOR                                  22940009
219500*        SELECT B.PRNT_ITM_CLUSTR_ID,                             22950009
219600*               B.CHLD_ITM_CLUSTR_ID                              22960009
219700*          FROM TITMCLT A,                                        22970009
219800*               TITMCLC B                                         22980009
219900*         WHERE A.ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME     22990009
220000*           AND A.HIER_CDE         IS NULL                        23000009
220100*           AND A.ITEM_CLUSTR_CDE  = 'I'                          23010009
220200*           AND B.REL_TYP_CDE      = 'M'                          23020009
220300*           AND A.ITEM_CLUSTR_ID   = B.CHLD_ITM_CLUSTR_ID         23030009
220400*           AND (A.EFF_END_TMST IS NULL                           23040009
220500*                OR A.EFF_END_TMST > :WS-CURR-END-TMST)           23050009
220600*           AND (B.EFF_END_TMST IS NULL                           23060009
220700*                OR B.EFF_END_TMST > :WS-CURR-END-TMST)           23070009
220800                                                                  23080009
220900     PERFORM D1100-OPEN-CLCCSR                                    23090009
221000        THRU D1100-EXIT.                                          23100009
221100                                                                  23110009
221200     SET MORE-CLC-RELATIONSHIPS TO TRUE.                          23120009
221300     PERFORM UNTIL NO-MORE-CLC-RELATIONSHIPS                      23130009
221400         PERFORM D1200-FETCH-CLCCSR                               23140009
221500            THRU D1200-EXIT                                       23150009
221600         IF MORE-CLC-RELATIONSHIPS                                23160009
**TEMP*    DISPLAY 'D1000 CALL D1300-UPDATE-TITMCLC-EXP-REL'            23170009
**TEMP*            ADD 1 TO WS-NBR-INS-UPD                              23180009
                   PERFORM D1300-UPDATE-TITMCLC-EXP-REL                 23190009
                      THRU D1300-EXIT                                   23200009
221900             IF SQLCODE = ZEROS                                   23210009
222000               AND RESET-ADHOC-REL                                23220009
222100*  IF THE CURRENT CLCCSR RECORD IS AN ADHOC RELATIONSHIP,         23230009
222200*  IT WILL BE SELECTED IN D1400 - BUT IT WILL HAVE BEEN           23240009
222300*  EXPIRED BY D1300                                               23250009
222400                   PERFORM D1400-SELECT-TITMCLC-ADHOCS            23260009
222500                      THRU D1400-EXIT                             23270009
222600                   IF SQLCODE = ZEROS                             23280009
222700*  USE THE VALUES FROM THE OLD SKU ADHOC RELATIONSHIP -           23290009
222800*  BUT YOU DO NEED TO CHANGE THE CLUSTR ID OF THE CHILD           23300009
222900*  SO THAT THE ADHOC POINTS TO THE NEW SKU; EFF-BEG-DTE           23310009
223000*  TO CURRENT DATE; AND THE NULL INDICATOR OF THE                 23320009
223100*  EFF-END-DTE SO THE RECORD IS ACTIVE                            23330009
223200                       MOVE WS-NEW-SKU-CLUSTR-ID                  23340009
223300                                            TO CHLD-ITM-CLUSTR-ID 23350009
223400                       MOVE WS-CURRENT-TMST TO EFF-BEG-TMST       23360009
223500                       MOVE -1 TO WS-CLC-EFF-END-DTE-NULL         23370009
**TEMP*    DISPLAY 'D1000 CALL U9300-INSERT-TITMCLC '                   23380009
**TEMP*                      ADD 1 TO WS-NBR-INS-UPD                    23390009
                             PERFORM U9300-INSERT-TITMCLC               23400009
                                THRU U9300-EXIT                         23410009
223800                   END-IF                                         23420009
223900             END-IF                                               23430009
224000         END-IF                                                   23440009
224100     END-PERFORM.                                                 23450009
224200                                                                  23460009
224300     PERFORM D1500-CLOSE-CLCCSR                                   23470009
224400        THRU D1500-EXIT.                                          23480009
224500                                                                  23490009
**TEMP*    DISPLAY 'D1000 CALL D1600-UPDATE-TITMCLT-EXP-SKU'            23500009
**TEMP*    ADD 1 TO WS-NBR-INS-UPD.                                     23510009
           PERFORM D1600-UPDATE-TITMCLT-EXP-SKU                         23520009
              THRU D1600-EXIT.                                          23530009
224800                                                                  23540009
224900 D1000-EXIT.                                                      23550009
225000     EXIT.                                                        23560009
225100                                                                  23570009
225200                                                                  23580009
225300 D1100-OPEN-CLCCSR.                                               23590009
225400                                                                  23600009
225500     EXEC SQL                                                     23610009
225600         OPEN CLCCSR                                              23620009
225700     END-EXEC.                                                    23630009
225800                                                                  23640009
225900     EVALUATE TRUE                                                23650009
226000         WHEN SQLCODE = ZEROS                                     23660009
226100             CONTINUE                                             23670009
226200         WHEN OTHER                                               23680009
226300             DISPLAY 'D1100-OPEN-CLCCSR'                          23690009
226400             PERFORM U9999-ABEND-ROUTINE                          23700009
226500     END-EVALUATE.                                                23710009
226600                                                                  23720009
226700 D1100-EXIT.                                                      23730009
226800     EXIT.                                                        23740009
226900                                                                  23750009
227000                                                                  23760009
227100 D1200-FETCH-CLCCSR.                                              23770009
227200                                                                  23780009
227300     EXEC SQL                                                     23790009
227400         FETCH CLCCSR                                             23800009
227500          INTO :PRNT-ITM-CLUSTR-ID,                               23810009
227600               :CHLD-ITM-CLUSTR-ID                                23820009
227700     END-EXEC.                                                    23830009
227800                                                                  23840009
227900     EVALUATE TRUE                                                23850009
228000         WHEN SQLCODE = ZEROS                                     23860009
228100             CONTINUE                                             23870009
228200         WHEN SQLCODE = +1403                                     23880009
228300             SET NO-MORE-CLC-RELATIONSHIPS TO TRUE                23890009
228400         WHEN OTHER                                               23900009
228500             DISPLAY 'D1200-FETCH-CLCCSR'                         23910009
228600             DISPLAY 'ITEM-CLUSTR-NAME: ' ITMCLT-ITEM-CLUSTR-NAME 23920009
228700             PERFORM U9999-ABEND-ROUTINE                          23930009
228800     END-EVALUATE.                                                23940009
228900                                                                  23950009
229000 D1200-EXIT.                                                      23960009
229100     EXIT.                                                        23970009
229200                                                                  23980009
229300                                                                  23990009
229400 D1300-UPDATE-TITMCLC-EXP-REL.                                    24000009
229500                                                                  24010009
229600     EXEC SQL                                                     24020009
229700         UPDATE TITMCLC                                           24030009
229800            SET EFF_END_TMST       = :WS-CURRENT-TMST,            24040009
229900                LAST_UPD_TMST      = SYSDATE,                     24050009
230000                LAST_UPD_BY_UID    = 'MAKUT203'                   24060009
230100          WHERE PRNT_ITM_CLUSTR_ID = :PRNT-ITM-CLUSTR-ID          24070009
230200            AND CHLD_ITM_CLUSTR_ID = :CHLD-ITM-CLUSTR-ID          24080009
230300     END-EXEC.                                                    24090009
230400                                                                  24100009
230500     EVALUATE TRUE                                                24110009
230600         WHEN SQLCODE = ZEROS                                     24120009
0822RM*** ADD TO COMMIT COUNT                                           24130009
0822RM            ADD +1 TO WS-NBR-INS-UPD                              24140009
0822RM*            CONTINUE                                             24150009
230800         WHEN OTHER                                               24160009
230900             DISPLAY 'D1300-UPDATE-TITMCLC-EXP-REL'               24170009
231000             DISPLAY 'PRNT-ITM-CLUSTR-ID: ' PRNT-ITM-CLUSTR-ID    24180009
231100             DISPLAY 'CHLD-ITM-CLUSTR-ID: ' CHLD-ITM-CLUSTR-ID    24190009
231200             PERFORM U9999-ABEND-ROUTINE                          24200009
231300     END-EVALUATE.                                                24210009
231400                                                                  24220009
231500 D1300-EXIT.                                                      24230009
231600     EXIT.                                                        24240009
231700                                                                  24250009
231800                                                                  24260009
231900*  ADHOC RELATIONSHIPS ARE CREATED/UPDATED ONLINE BY THE USER     24270009
232000*  THIS PROGRAM ONLY CREATES A NEW ADHOC RELATIONSHIP WHEN        24280009
232100*  A SKU IS RECLASSIFIED                                          24290009
232200 D1400-SELECT-TITMCLC-ADHOCS.                                     24300009
232300                                                                  24310009
232400     EXEC SQL                                                     24320009
232500         SELECT                                                   24330009
232600            A.PRNT_ITM_CLUSTR_ID,                                 24340009
232700            A.CHLD_ITM_CLUSTR_ID,                                 24350009
232800            A.REL_TYP_CDE,                                        24360009
232900            A.EFF_BEG_TMST,                                       24370009
233000            A.EFF_END_TMST,                                       24380009
233100            A.CRE_BY_UID,                                         24390009
233200            A.CRE_TMST,                                           24400009
233300            A.LAST_UPD_BY_UID,                                    24410009
233400            A.LAST_UPD_TMST,                                      24420009
233500            A.CHLD_ITM_CLSTR_CDE,                                 24430009
233600            A.CHLD_ITM_UNT_QTY                                    24440009
233700         INTO                                                     24450009
233800            :PRNT-ITM-CLUSTR-ID,                                  24460009
233900            :CHLD-ITM-CLUSTR-ID,                                  24470009
234000            :REL-TYP-CDE,                                         24480009
234100            :EFF-BEG-TMST,                                        24490009
234200            :EFF-END-TMST:WS-CLC-EFF-END-DTE-NULL,                24500009
234300            :CRE-BY-UID,                                          24510009
234400            :CRE-TMST,                                            24520009
234500            :LAST-UPD-BY-UID,                                     24530009
234600            :LAST-UPD-TMST,                                       24540009
234700            :CHLD-ITM-CLSTR-CDE:WS-CHLD-ITM-CLSTR-CDE-NULL,       24550009
234800            :CHLD-ITM-UNT-QTY:WS-CHLD-ITM-UNT-QTY-NULL            24560009
234900       FROM TITMCLC A,                                            24570009
235000            TITMCLT B                                             24580009
235100      WHERE A.PRNT_ITM_CLUSTR_ID  = :PRNT-ITM-CLUSTR-ID           24590009
235200        AND A.CHLD_ITM_CLUSTR_ID  = :CHLD-ITM-CLUSTR-ID           24600009
235300        AND (A.EFF_END_TMST IS NULL                               24610009
235400             OR A.EFF_END_TMST > :WS-CURR-END-TMST)               24620009
235500        AND A.PRNT_ITM_CLUSTR_ID  = B.ITEM_CLUSTR_ID              24630009
235600        AND B.CLUSTR_TYP_CDE      ='A'                            24640009
235700     END-EXEC.                                                    24650009
235800                                                                  24660009
235900     EVALUATE TRUE                                                24670009
236000         WHEN SQLCODE = ZEROS                                     24680009
236100         WHEN SQLCODE = 1403                                      24690009
236200             CONTINUE                                             24700009
236300         WHEN OTHER                                               24710009
236400             DISPLAY 'D1400-SELECT-TITMCLC-ADHOCS'                24720009
236500             DISPLAY 'PRNT-ITM-CLUSTR-ID: ' PRNT-ITM-CLUSTR-ID    24730009
236600             DISPLAY 'CHLD-ITM-CLUSTR-ID: ' CHLD-ITM-CLUSTR-ID    24740009
236700             PERFORM U9999-ABEND-ROUTINE                          24750009
236800     END-EVALUATE.                                                24760009
236900                                                                  24770009
237000 D1400-EXIT.                                                      24780009
237100     EXIT.                                                        24790009
237200                                                                  24800009
237300                                                                  24810009
237400 D1500-CLOSE-CLCCSR.                                              24820009
237500                                                                  24830009
237600     EXEC SQL                                                     24840009
237700         CLOSE CLCCSR                                             24850009
237800     END-EXEC.                                                    24860009
237900                                                                  24870009
238000     EVALUATE TRUE                                                24880009
238100         WHEN SQLCODE = ZEROS                                     24890009
238200             CONTINUE                                             24900009
238300         WHEN OTHER                                               24910009
238400             DISPLAY 'D1500-CLOSE-CLCCSR'                         24920009
238500             PERFORM U9999-ABEND-ROUTINE                          24930009
238600     END-EVALUATE.                                                24940009
238700                                                                  24950009
238800 D1500-EXIT.                                                      24960009
238900     EXIT.                                                        24970009
239000                                                                  24980009
239100                                                                  24990009
239200 D1600-UPDATE-TITMCLT-EXP-SKU.                                    25000009
239300                                                                  25010009
239400*    DISPLAY 'D1600-UPDATE-TITMCLT-EXP-SKU'.                      25020009
239500                                                                  25030009
239600     EXEC SQL                                                     25040009
239700         UPDATE TITMCLT                                           25050009
239800            SET EFF_END_TMST     = :WS-CURRENT-TMST,              25060009
239900                LAST_UPD_TMST    = SYSDATE,                       25070009
240000                LAST_UPD_BY_UID  = 'MAKUT203'                     25080009
240100          WHERE ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME       25090009
240200            AND HIER_CDE         IS NULL                          25100009
240300            AND ITEM_CLUSTR_CDE = 'I'                             25110009
240400            AND MDSE_NM_CDE     = 'M'                             25120009
240500            AND ((EFF_END_TMST IS NULL) OR                        25130009
240600                 (EFF_END_TMST > :WS-CURR-END-TMST))              25140009
240700     END-EXEC.                                                    25150009
240800                                                                  25160009
240900     EVALUATE TRUE                                                25170009
241000         WHEN SQLCODE = ZEROS                                     25180009
0822RM*** ADD TO COMMIT COUNT                                           25190009
0822RM            ADD +1 TO WS-NBR-INS-UPD                              25200009
0822RM*            CONTINUE                                             25210009
241200         WHEN OTHER                                               25220009
241300             DISPLAY 'D1600-UPDATE-TITMCLT-EXP-SKU'               25230009
241400             DISPLAY 'ITEM-CLUSTR-NAME: ' ITMCLT-ITEM-CLUSTR-NAME 25240009
241500             PERFORM U9999-ABEND-ROUTINE                          25250009
241600     END-EVALUATE.                                                25260009
241700                                                                  25270009
241800 D1600-EXIT.                                                      25280009
241900     EXIT.                                                        25290009
242000                                                                  25300009
242100                                                                  25310009
242200* E1000 IS ONLY CALLED FROM B1000.  ITS ONLY USED WHEN SKU        25320009
242300* IS LOOKED UP ON TITMCLT USING THE "SKU" COLUMN IN               25330009
242400* C1000-PROCESS-SKU                                               25340009
242500 E1000-EXPIRE-EXIST-SKU-REL.                                      25350009
242600                                                                  25360009
0822RM*** COMMENT OUT DISPLAYS                                          25370009
242700*    DISPLAY 'E1000-EXPIRE-EXIST-SKU-REL'.                        25380009
242800                                                                  25390009
242900*      DECLARE CLCCSR2 CURSOR FOR                                 25400009
243000*        SELECT B.PRNT_ITM_CLUSTR_ID,                             25410009
243100*               B.CHLD_ITM_CLUSTR_ID                              25420009
243200*          FROM TITMCLT A,                                        25430009
243300*               TITMCLC B                                         25440009
243400*         WHERE A.ITEM_CLUSTR_ID   = :ITMCLT-ITEM-CLUSTR-ID       25450009
243500*           AND B.REL_TYP_CDE      = 'M'                          25460009
243600*           AND A.ITEM_CLUSTR_ID   = B.CHLD_ITM_CLUSTR_ID         25470009
243700*           AND (B.EFF_END_TMST IS NULL                           25480009
243800*                OR B.EFF_END_TMST > :WS-CURR-END-TMST)           25490009
243900                                                                  25500009
244000     PERFORM E1100-OPEN-CLCCSR2                                   25510009
244100        THRU E1100-EXIT.                                          25520009
244200                                                                  25530009
244300     SET MORE-CLC-RELATIONSHIPS TO TRUE.                          25540009
244400     PERFORM UNTIL NO-MORE-CLC-RELATIONSHIPS                      25550009
244500         PERFORM E1200-FETCH-CLCCSR2                              25560009
244600            THRU E1200-EXIT                                       25570009
244700         IF MORE-CLC-RELATIONSHIPS                                25580009
244800             PERFORM E1300-UPDATE-TITMCLC-EXP-REL                 25590009
244900                THRU E1300-EXIT                                   25600009
245000             IF SQLCODE = ZEROS                                   25610009
245100               AND RESET-ADHOC-REL                                25620009
245200*  IF THE CURRENT CLCCSR2 RECORD IS AN ADHOC RELATIONSHIP,        25630009
245300*  IT WILL BE SELECTED IN E1400 - BUT IT WILL HAVE BEEN           25640009
245400*  EXPIRED BY E1300                                               25650009
245500                   PERFORM E1400-SELECT-TITMCLC-ADHOCS            25660009
245600                      THRU E1400-EXIT                             25670009
245700                   IF SQLCODE = ZEROS                             25680009
245800*  USE THE VALUES FROM THE OLD SKU ADHOC RELATIONSHIP -           25690009
245900*  BUT YOU DO NEED TO CHANGE THE CLUSTR ID OF THE CHILD           25700009
246000*  SO THAT THE ADHOC POINTS TO THE NEW SKU; EFF-BEG-DTE           25710009
246100*  TO CURRENT DATE; AND THE NULL INDICATOR OF THE                 25720009
246200*  EFF-END-DTE SO THE RECORD IS ACTIVE                            25730009
246300                       MOVE WS-NEW-SKU-CLUSTR-ID                  25740009
246400                                            TO CHLD-ITM-CLUSTR-ID 25750009
246500                       MOVE WS-CURRENT-TMST TO EFF-BEG-TMST       25760009
246600                       MOVE -1 TO WS-CLC-EFF-END-DTE-NULL         25770009
**TEMP*    DISPLAY 'E1000 CALL U9300-INSERT-TITMCLC '                   25780009
**TEMP*                     ADD 1 TO WS-NBR-INS-UPD                     25790009
                             PERFORM U9300-INSERT-TITMCLC               25800009
                                THRU U9300-EXIT                         25810009
246900                   END-IF                                         25820009
247000             END-IF                                               25830009
247100         END-IF                                                   25840009
247200     END-PERFORM.                                                 25850009
247300                                                                  25860009
247400     PERFORM E1500-CLOSE-CLCCSR2                                  25870009
247500        THRU E1500-EXIT.                                          25880009
247600                                                                  25890009
247700     PERFORM E1600-UPDATE-TITMCLT-EXP-SKU                         25900009
247800        THRU E1600-EXIT.                                          25910009
247900                                                                  25920009
248000 E1000-EXIT.                                                      25930009
248100     EXIT.                                                        25940009
248200                                                                  25950009
248300                                                                  25960009
248400 E1100-OPEN-CLCCSR2.                                              25970009
248500                                                                  25980009
248600     EXEC SQL                                                     25990009
248700         OPEN CLCCSR2                                             26000009
248800     END-EXEC.                                                    26010009
248900                                                                  26020009
249000     EVALUATE TRUE                                                26030009
249100         WHEN SQLCODE = ZEROS                                     26040009
249200             CONTINUE                                             26050009
249300         WHEN OTHER                                               26060009
249400             DISPLAY 'E1100-OPEN-CLCCSR2'                         26070009
249500             PERFORM U9999-ABEND-ROUTINE                          26080009
249600     END-EVALUATE.                                                26090009
249700                                                                  26100009
249800 E1100-EXIT.                                                      26110009
249900     EXIT.                                                        26120009
250000                                                                  26130009
250100                                                                  26140009
250200 E1200-FETCH-CLCCSR2.                                             26150009
250300                                                                  26160009
250400     EXEC SQL                                                     26170009
250500         FETCH CLCCSR2                                            26180009
250600          INTO :PRNT-ITM-CLUSTR-ID,                               26190009
250700               :CHLD-ITM-CLUSTR-ID                                26200009
250800     END-EXEC.                                                    26210009
250900                                                                  26220009
251000     EVALUATE TRUE                                                26230009
251100         WHEN SQLCODE = ZEROS                                     26240009
251200             CONTINUE                                             26250009
251300         WHEN SQLCODE = +1403                                     26260009
251400             SET NO-MORE-CLC-RELATIONSHIPS TO TRUE                26270009
251500         WHEN OTHER                                               26280009
251600             DISPLAY 'E1200-FETCH-CLCCSR2'                        26290009
251700             DISPLAY 'ITEM-CLUSTR-ID: ' ITMCLT-ITEM-CLUSTR-ID     26300009
251800             PERFORM U9999-ABEND-ROUTINE                          26310009
251900     END-EVALUATE.                                                26320009
252000                                                                  26330009
252100 E1200-EXIT.                                                      26340009
252200     EXIT.                                                        26350009
252300                                                                  26360009
252400                                                                  26370009
252500 E1300-UPDATE-TITMCLC-EXP-REL.                                    26380009
252600                                                                  26390009
252700     EXEC SQL                                                     26400009
252800         UPDATE TITMCLC                                           26410009
252900            SET EFF_END_TMST       = :WS-CURRENT-TMST,            26420009
253000                LAST_UPD_TMST      = SYSDATE,                     26430009
253100                LAST_UPD_BY_UID    = 'MAKUT203'                   26440009
253200          WHERE PRNT_ITM_CLUSTR_ID = :PRNT-ITM-CLUSTR-ID          26450009
253300            AND CHLD_ITM_CLUSTR_ID = :CHLD-ITM-CLUSTR-ID          26460009
253400     END-EXEC.                                                    26470009
253500                                                                  26480009
253600     EVALUATE TRUE                                                26490009
253700         WHEN SQLCODE = ZEROS                                     26500009
0822RM*** ADD TO COMMIT COUNT                                           26510009
0822RM            ADD +1 TO WS-NBR-INS-UPD                              26520009
0822RM*          CONTINUE                                               26530009
253900         WHEN OTHER                                               26540009
254000             DISPLAY 'E1300-UPDATE-TITMCLC-EXP-REL'               26550009
254100             DISPLAY 'PRNT-ITM-CLUSTR-ID: ' PRNT-ITM-CLUSTR-ID    26560009
254200             DISPLAY 'CHLD-ITM-CLUSTR-ID: ' CHLD-ITM-CLUSTR-ID    26570009
254300             PERFORM U9999-ABEND-ROUTINE                          26580009
254400     END-EVALUATE.                                                26590009
254500                                                                  26600009
254600 E1300-EXIT.                                                      26610009
254700     EXIT.                                                        26620009
254800                                                                  26630009
254900                                                                  26640009
255000*  ADHOC RELATIONSHIPS ARE CREATED/UPDATED ONLINE BY THE USER     26650009
255100*  THIS PROGRAM ONLY CREATES A NEW ADHOC RELATIONSHIP WHEN        26660009
255200*  A SKU IS RECLASSIFIED                                          26670009
255300 E1400-SELECT-TITMCLC-ADHOCS.                                     26680009
255400                                                                  26690009
255500     EXEC SQL                                                     26700009
255600         SELECT                                                   26710009
255700            A.PRNT_ITM_CLUSTR_ID,                                 26720009
255800            A.CHLD_ITM_CLUSTR_ID,                                 26730009
255900            A.REL_TYP_CDE,                                        26740009
256000            A.EFF_BEG_TMST,                                       26750009
256100            A.EFF_END_TMST,                                       26760009
256200            A.CRE_BY_UID,                                         26770009
256300            A.CRE_TMST,                                           26780009
256400            A.LAST_UPD_BY_UID,                                    26790009
256500            A.LAST_UPD_TMST,                                      26800009
256600            A.CHLD_ITM_CLSTR_CDE,                                 26810009
256700            A.CHLD_ITM_UNT_QTY                                    26820009
256800         INTO                                                     26830009
256900            :PRNT-ITM-CLUSTR-ID,                                  26840009
257000            :CHLD-ITM-CLUSTR-ID,                                  26850009
257100            :REL-TYP-CDE,                                         26860009
257200            :EFF-BEG-TMST,                                        26870009
257300            :EFF-END-TMST:WS-CLC-EFF-END-DTE-NULL,                26880009
257400            :CRE-BY-UID,                                          26890009
257500            :CRE-TMST,                                            26900009
257600            :LAST-UPD-BY-UID,                                     26910009
257700            :LAST-UPD-TMST,                                       26920009
257800            :CHLD-ITM-CLSTR-CDE:WS-CHLD-ITM-CLSTR-CDE-NULL,       26930009
257900            :CHLD-ITM-UNT-QTY:WS-CHLD-ITM-UNT-QTY-NULL            26940009
258000       FROM TITMCLC A,                                            26950009
258100            TITMCLT B                                             26960009
258200      WHERE A.PRNT_ITM_CLUSTR_ID  = :PRNT-ITM-CLUSTR-ID           26970009
258300        AND A.CHLD_ITM_CLUSTR_ID  = :CHLD-ITM-CLUSTR-ID           26980009
258400        AND A.PRNT_ITM_CLUSTR_ID  = B.ITEM_CLUSTR_ID              26990009
258500        AND B.CLUSTR_TYP_CDE      ='A'                            27000009
258600     END-EXEC.                                                    27010009
258700                                                                  27020009
258800     EVALUATE TRUE                                                27030009
258900         WHEN SQLCODE = ZEROS                                     27040009
259000         WHEN SQLCODE = 1403                                      27050009
259100             CONTINUE                                             27060009
259200         WHEN OTHER                                               27070009
259300             DISPLAY 'E1400-SELECT-TITMCLC-ADHOCS'                27080009
259400             DISPLAY 'PRNT-ITM-CLUSTR-ID: ' PRNT-ITM-CLUSTR-ID    27090009
259500             DISPLAY 'CHLD-ITM-CLUSTR-ID: ' CHLD-ITM-CLUSTR-ID    27100009
259600             PERFORM U9999-ABEND-ROUTINE                          27110009
259700     END-EVALUATE.                                                27120009
259800                                                                  27130009
259900 E1400-EXIT.                                                      27140009
260000     EXIT.                                                        27150009
260100                                                                  27160009
260200                                                                  27170009
260300 E1500-CLOSE-CLCCSR2.                                             27180009
260400                                                                  27190009
260500     EXEC SQL                                                     27200009
260600         CLOSE CLCCSR2                                            27210009
260700     END-EXEC.                                                    27220009
260800                                                                  27230009
260900     EVALUATE TRUE                                                27240009
261000         WHEN SQLCODE = ZEROS                                     27250009
261100             CONTINUE                                             27260009
261200         WHEN OTHER                                               27270009
261300             DISPLAY 'E1500-CLOSE-CLCCSR2'                        27280009
261400             PERFORM U9999-ABEND-ROUTINE                          27290009
261500     END-EVALUATE.                                                27300009
261600                                                                  27310009
261700 E1500-EXIT.                                                      27320009
261800     EXIT.                                                        27330009
261900                                                                  27340009
262000                                                                  27350009
262100 E1600-UPDATE-TITMCLT-EXP-SKU.                                    27360009
262200                                                                  27370009
0822RM*** COMMENT OUT DISPLAYS                                          27380009
262300*    DISPLAY 'E1600-UPDATE-TITMCLT-EXP-SKU'.                      27390009
262400                                                                  27400009
262500     EXEC SQL                                                     27410009
262600         UPDATE TITMCLT                                           27420009
262700            SET EFF_END_TMST     = :WS-CURRENT-TMST,              27430009
262800                LAST_UPD_TMST    = SYSDATE,                       27440009
262900                LAST_UPD_BY_UID  = 'MAKUT203'                     27450009
263000          WHERE ITEM_CLUSTR_ID   = :ITMCLT-ITEM-CLUSTR-ID         27460009
263100     END-EXEC.                                                    27470009
263200                                                                  27480009
263300     EVALUATE TRUE                                                27490009
263400         WHEN SQLCODE = ZEROS                                     27500009
0822RM*** ADD TO COMMIT COUNT                                           27510009
0822RM            ADD +1 TO WS-NBR-INS-UPD                              27520009
0822RM*            CONTINUE                                             27530009
263600         WHEN OTHER                                               27540009
263700             DISPLAY 'E1600-UPDATE-TITMCLT-EXP-SKU'               27550009
263800             DISPLAY 'ITEM-CLUSTR-ID: ' ITMCLT-ITEM-CLUSTR-ID     27560009
263900             PERFORM U9999-ABEND-ROUTINE                          27570009
264000     END-EVALUATE.                                                27580009
264100                                                                  27590009
264200 E1600-EXIT.                                                      27600009
264300     EXIT.                                                        27610009
264400                                                                  27620009
264500                                                                  27630009
264600 E2000-ORACLE-COMMIT.                                             27640009
264700                                                                  27650009
**TEMP*    DISPLAY 'E2000-ORACLE-COMMIT'.                               27660009
264800     EXEC SQL                                                     27670009
264900         COMMIT                                                   27680009
265000     END-EXEC.                                                    27690009
265100                                                                  27700009
265200     IF SQLCODE = ZERO                                            27710009
265300         ADD +1 TO WS-NBR-INS-UPD                                 27720009
265400     ELSE                                                         27730009
265500         MOVE SQLCODE    TO SQLCODE2                              27740009
265600         MOVE SQLERRD(3) TO SQLERRD3                              27750009
265700         DISPLAY '** ABEND **       ** = SQLERROR'                27760009
265800         DISPLAY '** PROGRAM        ** = MAKUT203'                27770009
265900         DISPLAY '** SQLCODE        ** = ' SQLCODE                27780009
266000         DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3               27790009
266100         DISPLAY '** SQLERRM        ** = ' SQLERRM                27800009
266200         DISPLAY '** SQLERRMC       ** = ' SQLERRM                27810009
266300         MOVE SPACES TO WS-MSG-TEXT                               27820009
0822RM         DISPLAY 'INPUT RECORD      ** = ' IMRD008-RECORD         27830009
266400*    GET FULL TEXT OF ERROR MESSAGE                               27840009
266500                                                                  27850009
266600         CALL 'SQLGLM' USING WS-MSG-TEXT,                         27860009
266700                             WS-MAX-SIZE,                         27870009
266800                             WS-MSG-LENGTH                        27880009
266900         DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT            27890009
267000     END-IF.                                                      27900009
267100                                                                  27910009
267200 E2000-EXIT.                                                      27920009
267300     EXIT.                                                        27930009
267400                                                                  27940009
267500                                                                  27950009
267600 F1000-EOJ-PROCESSING.                                            27960009
267700                                                                  27970009
267800     CLOSE RECLASSIFY-FILE                                        27980009
267900           ERROR-FILE.                                            27990009
268000                                                                  28000009
268100     EXEC SQL                                                     28010009
268200         COMMIT RELEASE                                           28020009
268300     END-EXEC.                                                    28030009
268400                                                                  28040009
268500     IF SQLCODE = ZERO                                            28050009
0822RM*** ADD TO COMMIT COUNT                                           28060009
0822RM         ADD +1 TO WS-TOT-NBR-COMMITS                             28070009
268700     ELSE                                                         28080009
268800         MOVE SQLCODE    TO SQLCODE2                              28090009
268900         MOVE SQLERRD(3) TO SQLERRD3                              28100009
269000         DISPLAY '** ABEND **       ** = SQLERROR'                28110009
269100         DISPLAY '** PROGRAM        ** = MAKUT203'                28120009
269200         DISPLAY '** SQLCODE        ** = ' SQLCODE                28130009
269300         DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3               28140009
269400         DISPLAY '** SQLERRM        ** = ' SQLERRM                28150009
269500         DISPLAY '** SQLERRMC       ** = ' SQLERRM                28160009
269600         MOVE SPACES TO WS-MSG-TEXT                               28170009
269700*    GET FULL TEXT OF ERROR MESSAGE                               28180009
269800                                                                  28190009
269900         CALL 'SQLGLM' USING WS-MSG-TEXT,                         28200009
270000                             WS-MAX-SIZE,                         28210009
270100                             WS-MSG-LENGTH                        28220009
270200         DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT            28230009
270300     END-IF.                                                      28240009
270400                                                                  28250009
270500     DISPLAY '*****************************************'.         28260009
270600     DISPLAY 'MAKUT203'.                                          28270009
270700     DISPLAY 'RCDS READ:  ' WS-READ-COUNT.                        28280009
270800     DISPLAY 'ERROR RCDS: ' WS-ERROR-COUNT.                       28290009
0822RM     DISPLAY 'TOTAL NBR UPDATES-INSERTS:' WS-TOT-NBR-INS-UPD.     28300009
0822RM     DISPLAY 'TOTAL COMMITS: ' WS-TOT-NBR-COMMITS.                28310009
271000     DISPLAY '*****************************************'.         28320009
271100                                                                  28330009
271200     IF WS-ERROR-COUNT > 0                                        28340009
271300         MOVE 4095 TO RETURN-CODE                                 28350009
271400     ELSE                                                         28360009
271500         MOVE 0    TO RETURN-CODE                                 28370009
271600     END-IF.                                                      28380009
271700                                                                  28390009
271800 F1000-EXIT.                                                      28400009
271900     EXIT.                                                        28410009
272000                                                                  28420009
272100                                                                  28430009
272200 U9000-SELECT-NEXT-SEQ-NBR.                                       28440009
272300                                                                  28450009
272400     EXEC SQL                                                     28460009
272500         SELECT ITEM_CLUSTR_SEQ.NEXTVAL                           28470009
272600           INTO :ITMCLT-ITEM-CLUSTR-ID                            28480009
272700           FROM DUAL                                              28490009
272800     END-EXEC.                                                    28500009
272900                                                                  28510009
273000     EVALUATE TRUE                                                28520009
273100         WHEN SQLCODE = ZEROS                                     28530009
273200             CONTINUE                                             28540009
273300         WHEN OTHER                                               28550009
273400             DISPLAY 'U9000-SELECT-NEXT-SEQ-NBR'                  28560009
273500             PERFORM U9999-ABEND-ROUTINE                          28570009
273600     END-EVALUATE.                                                28580009
273700                                                                  28590009
273800 U9000-EXIT.                                                      28600009
273900     EXIT.                                                        28610009
274000                                                                  28620009
274100                                                                  28630009
274200 U9100-SELECT-TITMCLT.                                            28640009
274300                                                                  28650009
274400     EXEC SQL                                                     28660009
274500       SELECT ITEM_CLUSTR_ID,                                     28670009
274600              ITEM_CLUSTR_DESC,                                   28680009
274700              EFF_BEG_TMST,                                       28690009
274800              EFF_END_TMST,                                       28700009
274900              LAST_UPD_TMST                                       28710009
275000         INTO :ITMCLT-ITEM-CLUSTR-ID,                             28720009
275100              :ITMCLT-ITEM-CLUSTR-DESC,                           28730009
275200              :ITMCLT-EFF-BEG-TMST,                               28740009
275300              :ITMCLT-EFF-END-TMST:WS-CLT-EFF-END-DTE-NULL,       28750009
275400              :ITMCLT-LAST-UPD-TMST                               28760009
275500         FROM TITMCLT                                             28770009
275600        WHERE ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME         28780009
275700          AND HIER_CDE         = :ITMCLT-HIER-CDE                 28790009
275800          AND ((EFF_END_TMST IS NULL) OR                          28800009
275900               (EFF_END_TMST > :WS-CURR-END-TMST))                28810009
276000     END-EXEC.                                                    28820009
276100                                                                  28830009
276200     EVALUATE TRUE                                                28840009
276300         WHEN SQLCODE = ZEROS                                     28850009
276400         WHEN SQLCODE = +1403                                     28860009
276500             CONTINUE                                             28870009
276600         WHEN OTHER                                               28880009
276700             DISPLAY 'U9100-SELECT-TITMCLT'                       28890009
276800             DISPLAY 'ITEM-CLUSTR-NAME: ' ITMCLT-ITEM-CLUSTR-NAME 28900009
276900             DISPLAY 'HIER-CDE:         ' ITMCLT-HIER-CDE         28910009
277000             PERFORM U9999-ABEND-ROUTINE                          28920009
277100     END-EVALUATE.                                                28930009
277200                                                                  28940009
277300 U9100-EXIT.                                                      28950009
277400     EXIT.                                                        28960009
277500                                                                  28970009
277600                                                                  28980009
277700 U9200-INSERT-TITMCLT.                                            28990009
277800                                                                  29000009
277900     EXEC SQL                                                     29010009
278000         INSERT INTO TITMCLT                                      29020009
278100             (ITEM_CLUSTR_ID,                                     29030009
278200              ITEM_CLUSTR_NAME,                                   29040009
278300              ITEM_CLUSTR_DESC,                                   29050009
278400              EFF_BEG_TMST,                                       29060009
278500              EFF_END_TMST,                                       29070009
278600              CLUSTR_TYP_CDE,                                     29080009
278700              HIER_TYP_CDE,                                       29090009
278800              HIER_CDE,                                           29100009
278900              ITEM_CLUSTR_CDE,                                    29110009
279000              MDSE_NM_CDE,                                        29120009
279100              PROD_SERV_CDE,                                      29130009
279200              CRE_BY_UID,                                         29140009
279300              CRE_TMST,                                           29150009
279400              LAST_UPD_BY_UID,                                    29160009
279500              LAST_UPD_TMST,                                      29170009
279600              ARCH_DTE,                                           29180009
279700              OWNER_ID,                                           29190009
279800              SKU)                                                29200009
279900          VALUES                                                  29210009
280000             (:ITMCLT-ITEM-CLUSTR-ID,                             29220009
280100              :ITMCLT-ITEM-CLUSTR-NAME,                           29230009
280200              :ITMCLT-ITEM-CLUSTR-DESC,                           29240009
280300              :ITMCLT-EFF-BEG-TMST,                               29250009
280400              :ITMCLT-EFF-END-TMST:WS-CLT-EFF-END-DTE-NULL,       29260009
280500              :ITMCLT-CLUSTR-TYP-CDE:WS-CLUSTR-TYP-CDE-NULL,      29270009
280600              :ITMCLT-HIER-TYP-CDE:WS-HIER-TYP-CDE-NULL,          29280009
280700              :ITMCLT-HIER-CDE:WS-HIER-CDE-NULL,                  29290009
280800              :ITMCLT-ITEM-CLUSTR-CDE:WS-ITEM-CLUSTR-CDE-NULL,    29300009
280900              :ITMCLT-MDSE-NM-CDE:WS-MDSE-NM-CDE-NULL,            29310009
281000              :ITMCLT-PROD-SERV-CDE:WS-PROD-SERV-CDE-NULL,        29320009
281100             'MAKUT203',                                          29330009
281200              SYSDATE,                                            29340009
281300             'MAKUT203',                                          29350009
281400              SYSDATE,                                            29360009
281500              :ITMCLT-ARCH-DTE:WS-ARCH-DTE-NULL,                  29370009
281600              :ITMCLT-OWNER-ID:WS-OWNER-ID-NULL,                  29380009
281700              :ITMCLT-SKU:WS-SKU-NULL)                            29390009
281800     END-EXEC.                                                    29400009
281900                                                                  29410009
282000     EVALUATE TRUE                                                29420009
282100         WHEN SQLCODE = ZEROS                                     29430009
0822RM*** ADD TO COMMIT COUNT                                           29440009
0822RM            ADD +1 TO WS-NBR-INS-UPD                              29450009
0822RM*** COMMENT OUT DISPLAYS                                          29460009
0822RM*          DISPLAY 'INSERTING NEW TITMCLT CLUSTER ID'             29470009
0822RM*          DISPLAY 'ITEM-CLUSTR-ID:   ' ITMCLT-ITEM-CLUSTR-ID     29480009
0822RM*          DISPLAY 'ITEM-CLUSTR-NAME: ' ITMCLT-ITEM-CLUSTR-NAME   29490009
0822RM*          DISPLAY 'ITEM-CLUSTR-DESC: ' ITMCLT-ITEM-CLUSTR-DESC   29500009
0822RM*          DISPLAY 'HIER-CDE:         ' ITMCLT-HIER-CDE           29510009
0822RM*          CONTINUE                                               29520009
282700         WHEN OTHER                                               29530009
282800           DISPLAY 'U9200-INSERT-TITMCLT'                         29540009
282900           DISPLAY 'INSERTING NEW TITMCLT CLUSTER ID'             29550009
283000           DISPLAY 'ITEM-CLUSTR-ID:      ' ITMCLT-ITEM-CLUSTR-ID  29560009
283100           DISPLAY 'ITEM-CLUSTR-NAME:    ' ITMCLT-ITEM-CLUSTR-NAME29570009
283200           DISPLAY 'ITEM-CLUSTR-DESC:    ' ITMCLT-ITEM-CLUSTR-DESC29580009
283300           DISPLAY 'EFF-BEG-TMST:        ' ITMCLT-EFF-BEG-TMST    29590009
283400           DISPLAY 'EFF-END-TMST:        ' ITMCLT-EFF-END-TMST    29600009
283500           DISPLAY 'EFF-END-TMST-NULL:   ' ITMCLT-EFF-END-TMST    29610009
283600           DISPLAY 'CLUSTR-TYP-CDE:      ' ITMCLT-CLUSTR-TYP-CDE  29620009
283700           DISPLAY 'CLUSTR-TYP-CDE-NULL: ' WS-CLUSTR-TYP-CDE-NULL 29630009
283800           DISPLAY 'HIER-TYP-CDE:        ' ITMCLT-HIER-TYP-CDE    29640009
283900           DISPLAY 'HIER-TYP-CDE-NULL:   ' WS-HIER-TYP-CDE-NULL   29650009
284000           DISPLAY 'HIER-CDE:            ' ITMCLT-HIER-CDE        29660009
284100           DISPLAY 'HIER-CDE-NULL:       ' WS-HIER-CDE-NULL       29670009
284200           DISPLAY 'ITEM-CLUSTR-CDE:     ' ITMCLT-ITEM-CLUSTR-CDE 29680009
284300           DISPLAY 'MDSE-NM-CDE:         ' ITMCLT-MDSE-NM-CDE     29690009
284400           DISPLAY 'MDSE-NM-CDE-NULL:    '  WS-MDSE-NM-CDE-NULL   29700009
284500           DISPLAY 'PROD-SERV-CDE:       ' ITMCLT-PROD-SERV-CDE   29710009
284600           DISPLAY 'PROD-SERV-CDE-NULL:  ' WS-PROD-SERV-CDE-NULL  29720009
284700           DISPLAY 'OWNER-ID:            ' ITMCLT-OWNER-ID        29730009
284800           DISPLAY 'OWNER-ID-NULL:       ' WS-OWNER-ID-NULL       29740009
284900           DISPLAY 'SKU:                 ' ITMCLT-SKU             29750009
285000           DISPLAY 'SKU-NULL:            ' WS-SKU-NULL            29760009
285100           DISPLAY '******************************************'   29770009
285200           PERFORM U9999-ABEND-ROUTINE                            29780009
285300     END-EVALUATE.                                                29790009
285400                                                                  29800009
285500 U9200-EXIT.                                                      29810009
285600     EXIT.                                                        29820009
285700                                                                  29830009
285800                                                                  29840009
285900 U9300-INSERT-TITMCLC.                                            29850009
286000                                                                  29860009
286100     EXEC SQL                                                     29870009
286200       INSERT INTO TITMCLC                                        29880009
286300          (PRNT_ITM_CLUSTR_ID,                                    29890009
286400           CHLD_ITM_CLUSTR_ID,                                    29900009
286500           REL_TYP_CDE,                                           29910009
286600           EFF_BEG_TMST,                                          29920009
286700           EFF_END_TMST,                                          29930009
286800           CRE_BY_UID,                                            29940009
286900           CRE_TMST,                                              29950009
287000           LAST_UPD_BY_UID,                                       29960009
287100           LAST_UPD_TMST,                                         29970009
287200           CHLD_ITM_CLSTR_CDE,                                    29980009
287300           CHLD_ITM_UNT_QTY)                                      29990009
287400       VALUES                                                     30000009
287500          (:PRNT-ITM-CLUSTR-ID,                                   30010009
287600           :CHLD-ITM-CLUSTR-ID,                                   30020009
287700           :REL-TYP-CDE,                                          30030009
287800           :EFF-BEG-TMST,                                         30040009
287900           :EFF-END-TMST:WS-CLC-EFF-END-DTE-NULL,                 30050009
288000           'MAKUT203',                                            30060009
288100           SYSDATE,                                               30070009
288200           'MAKUT203',                                            30080009
288300           SYSDATE,                                               30090009
288400           :CHLD-ITM-CLSTR-CDE:WS-CHLD-ITM-CLSTR-CDE-NULL,        30100009
288500           :CHLD-ITM-UNT-QTY:WS-CHLD-ITM-UNT-QTY-NULL)            30110009
288600     END-EXEC.                                                    30120009
288700                                                                  30130009
288800     EVALUATE TRUE                                                30140009
288900        WHEN SQLCODE = ZEROS                                      30150009
0822RM*** ADD TO COMMIT COUNT                                           30160009
0822RM            ADD +1 TO WS-NBR-INS-UPD                              30170009
0822RM***COMMENT OUT DISPLAYS                                           30180009
0822RM*          DISPLAY 'U9300-INSERT-TITMCLC'                         30190009
0822RM*          DISPLAY 'SUCCESSFUL INSERT'                            30200009
0822RM*          DISPLAY 'PRNT-ITM-CLUSTR-ID: ' PRNT-ITM-CLUSTR-ID      30210009
0822RM*          DISPLAY 'CHLD-ITM-CLUSTR-ID: ' CHLD-ITM-CLUSTR-ID      30220009
0822RM*          CONTINUE                                               30230009
289500        WHEN SQLCODE = -1                                         30240009
289600           DISPLAY 'SQLCODE = -1 RELATIONSHIP ALREADY EXISTS'     30250009
289700           DISPLAY 'PRNT-ITM-CLUSTR-ID: ' PRNT-ITM-CLUSTR-ID      30260009
289800           DISPLAY 'CHLD-ITM-CLUSTR-ID: ' CHLD-ITM-CLUSTR-ID      30270009
289900           DISPLAY 'RESETTTING PLSLQ TABLE . . .'                 30280009
290000                                                                  30290009
290100           EXEC SQL EXECUTE                                       30300009
290200              BEGIN                                               30310009
290300                  TITMCLC_TRIG_PKG.RESET_TABLE;                   30320009
290400              END;                                                30330009
290500           END-EXEC                                               30340009
290600                                                                  30350009
290700           EVALUATE TRUE                                          30360009
290800              WHEN SQLCODE = ZEROS                                30370009
290900                 CONTINUE                                         30380009
291000              WHEN OTHER                                          30390009
291100                 DISPLAY 'U9300-INSERT-TITMCLC'                   30400009
291200                 DISPLAY 'CANNOT RESET PLSQL TABLE'               30410009
291300                 PERFORM U9999-ABEND-ROUTINE                      30420009
291400           END-EVALUATE                                           30430009
291500                                                                  30440009
291600           CONTINUE                                               30450009
291700                                                                  30460009
291800        WHEN OTHER                                                30470009
291900           DISPLAY 'U9300-INSERT-TITMCLC'                         30480009
292000           DISPLAY 'PRNT-ITM-CLUSTR-ID: ' PRNT-ITM-CLUSTR-ID      30490009
292100           DISPLAY 'CHLD-ITM-CLUSTR-ID: ' CHLD-ITM-CLUSTR-ID      30500009
292200           PERFORM U9999-ABEND-ROUTINE                            30510009
292300     END-EVALUATE.                                                30520009
292400                                                                  30530009
292500 U9300-EXIT.                                                      30540009
292600     EXIT.                                                        30550009
292700                                                                  30560009
292800                                                                  30570009
292900 U9400-WRITE-ERROR-RECORD.                                        30580009
293000                                                                  30590009
293100     WRITE ERROR-RECORD FROM WS-ERROR-RECORD.                     30600009
293200                                                                  30610009
293300     ADD 1 TO WS-ERROR-COUNT.                                     30620009
293400                                                                  30630009
293500 U9400-EXIT.                                                      30640009
293600     EXIT.                                                        30650009
293700                                                                  30660009
293800                                                                  30670009
293900 U9999-ABEND-ROUTINE.                                             30680009
294000                                                                  30690009
294100     MOVE SQLCODE    TO SQLCODE2.                                 30700009
294200     MOVE SQLERRD(3) TO SQLERRD3.                                 30710009
0922RM     DISPLAY '** RECORDS READ        ' WS-READ-COUNT.             30711012
294300     DISPLAY '** ABEND **       ** = SQLERROR'.                   30720009
294400     DISPLAY '** PROGRAM        ** = MAKUT203'.                   30730009
294500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  30740009
294600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  30750009
294700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   30760009
294800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  30770009
294900     DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5)                 30780009
0822RM     DISPLAY '** INPUT RECORD   **   ' IMRD008-RECORD.            30790009
295000                                                                  30800009
295100     MOVE SPACES TO WS-MSG-TEXT.                                  30810009
295200                                                                  30820009
295300*    GET FULL TEXT OF ERROR MESSAGE                               30830009
295400      CALL 'SQLGLM' USING WS-MSG-TEXT,                            30840009
295500                          WS-MAX-SIZE,                            30850009
295600                          WS-MSG-LENGTH.                          30860009
295700      DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.              30870009
295800                                                                  30880009
295900      EXEC SQL                                                    30890009
296000          ROLLBACK WORK RELEASE                                   30900009
296100      END-EXEC.                                                   30910009
296200                                                                  30920009
296300** A SQLCODE OF -2068 IS AN ORACLE DATABASE DISCONNECT ERR        30930009
296400      IF SQLCODE = -2068                                          30940009
296500          MOVE +4016 TO WS-ABEND-CODE                             30950009
296600      ELSE                                                        30960009
296700          MOVE +4013 TO WS-ABEND-CODE                             30970009
296800      END-IF.                                                     30980009
296900                                                                  30990009
297000      CALL 'ILBOABN0' USING WS-ABEND-CODE.                        31000009
297100                                                                  31010009
