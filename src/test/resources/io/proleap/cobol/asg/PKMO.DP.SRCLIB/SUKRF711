000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKRF711.                                00050000
000600 AUTHOR.                 JIM ARENDT.                              00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            OCTOBER, 2013.                           00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM WILL UPDATE THE ITEM INFORMATION TO BE CHECKED     00120000
001300* IN AN RFID AUDIT, STYLE, SIZE, AND COLOR.  THIS PROGRAM WILL    00130000
001400* ONLY PROCESS RFID AUDIT DATA.                                   00140000
001500******************************************************************00150000
001500* REVISED BY DAVID WELLER TO CORRECT SEQUENCE NUMBERS - 11/8/2013 00160023
001500******************************************************************00170000
001600                                                                  00180000
001700******************************************************************00190000
001800 ENVIRONMENT DIVISION.                                            00200000
001900******************************************************************00210000
002000                                                                  00220000
002100******************************************************************00230000
002200 DATA DIVISION.                                                   00240000
002300******************************************************************00250000
002400                                                                  00260000
002500******************************************************************00270000
002600 WORKING-STORAGE SECTION.                                         00280000
002700******************************************************************00290000
002800 01 CA-COMMAREA.                                                  00300000
002900     COPY SUWS006.                                                00310008
003000* * * * * * * * * * * *  PLEASE NOTE * * * * * * * * * * * *      00320000
003100* THE COMMAREA FROM HERE....                                      00330000
003200    05 CA-SUKRF513-COMMAREA.                                      00340000
003300       10 FILLER                         PIC  X(35).              00350000
003400       10 CA-SYSTEM-RETAIL-X             PIC  X(08).              00360000
003500       10 CA-SYSTEM-RETAIL     REDEFINES CA-SYSTEM-RETAIL-X       00370000
003600                                         PIC  ZZZZ9.99.           00380000
003700                                                                  00390000
003800       10 CA-SYSTEM-SKU-DESC             PIC  X(19).              00400000
003900       10 CA-SYSTEM-COLOR                PIC  X(10).              00410000
004000       10 CA-SYSTEM-SIZE                 PIC  X(10).              00420000
004100       10 CA-SYSTEM-STYLE                PIC  X(19).              00430000
004200* ... TO HERE IS COPIED FROM SUKRF513, AND IS THEN SENT ALONG TO  00440000
004300* SUKRF522 AND SUKRF524                                           00450000
004400*     -- ANY CHANGES TO THIS AREA IN ANY OF THE PROGRAMS MUST     00460000
004500*         BE COPIED TO ALL THREE                                  00470000
004600    05 CA-PROGRAM-COMMAREA.                                       00480000
004700       10 CA-SCREEN-FIELDS.                                       00490000
005400          15 CA-SCRN-COLOR               PIC  X(10).              00500000
005500          15 CA-SCRN-SIZE                PIC  X(10).              00510000
005600          15 CA-SCRN-SKU-X.                                       00520000
005700             20 CA-SCRN-DEPT-X           PIC  X(03).              00530000
005800             20 FILLER                   PIC  X(01)  VALUE '-'.   00540000
005900             20 CA-SCRN-MAJ-CLS-X        PIC  X(02).              00550001
006000             20 FILLER                   PIC  X(01)  VALUE '-'.   00560000
006100             20 CA-SCRN-SUB-CLS-X        PIC  X(02).              00570001
006200          15 CA-SCRN-SKU        REDEFINES CA-SCRN-SKU-X.          00580000
006300             20 CA-SCRN-DEPT             PIC  9(03).              00590000
006400             20 FILLER                   PIC  X(01).              00600000
006500             20 CA-SCRN-MAJ-CLASS        PIC  9(02).              00610001
006600             20 FILLER                   PIC  X(01).              00620000
006700             20 CA-SCRN-SUB-CLASS        PIC  9(02).              00630001
006800          15 CA-SCRN-STYLE               PIC  X(12).              00640000
006800          15 CA-SCRN-LOGO                PIC  X(01).              00650000
006900                                                                  00660000
007000 01  PS-PROGRAM-SWITCHES.                                         00670007
007100     05  PS-DATABASE-CONTENTION-SW       PIC  X(01)  VALUE 'N'.   00680007
007200         88 PS-DATABASE-CONTENTION-NO                VALUE 'N'.   00690007
007300         88 PS-DATABASE-CONTENTION-YES               VALUE 'Y'.   00700007
007400     05  PS-BLACKOUT-SW                  PIC  X(01)  VALUE 'N'.   00710008
007500         88 PS-BLACKOUT-YES                          VALUE 'Y'.   00720008
007600         88 PS-BLACKOUT-NO                           VALUE 'N'.   00730008
007400     05  PS-CLR-SZE-STL-ERROR-SW         PIC  X(01)  VALUE 'N'.   00740039
007500         88 PS-CLR-SZE-STL-ERROR                     VALUE 'Y'.   00750039
007600         88 PS-CLR-SZE-STL-ERROR-NO                  VALUE 'N'.   00760039
007400     05  PS-PROCESD-EXCPTN-SW            PIC  X(01)  VALUE 'N'.   00770057
007500         88 PS-PROCESD-EXCPTN-YES                    VALUE 'Y'.   00780057
007600         88 PS-PROCESD-EXCPTN-NO                     VALUE 'N'.   00790057
007700                                                                  00800008
007800                                                                  00810007
007900 01  PC-PROGRAM-CONSTANTS.                                        00820007
010600     05  PC-YES                          PIC  X(01)  VALUE 'Y'.   00830003
009900     05  PC-P                            PIC  X(01)  VALUE 'P'.   00840046
010000     05  PC-O                            PIC  X(01)  VALUE 'O'.   00850046
010100     05  PC-S                            PIC  X(01)  VALUE 'S'.   00860046
008000     05  PC-CARTON-AUDIT-GROUP-CODE      PIC  X(03)  VALUE 'VA'.  00870007
008100     05  PC-TKT-ERR-DPT-VILN-SEQ         PIC S9(04)  VALUE 13     00880000
008200                                                     COMP.        00890000
008300     05  PC-TKT-ERR-CLASS-VILN-SEQ       PIC S9(04)  VALUE 21     00900000
008400                                                     COMP.        00910000
008500     05  PC-TKT-ERR-SKU-VILN-SEQ         PIC S9(04)  VALUE 22     00920000
008600                                                     COMP.        00930000
008700     05  PC-TKT-ERR-RETAIL-VILN-SEQ      PIC S9(04)  VALUE 14     00940000
008800                                                     COMP.        00950000
008900     05  PC-TKT-ERR-COLOR-VILN-SEQ       PIC S9(04)  VALUE 39     00960000
009000                                                     COMP.        00970000
009100     05  PC-TKT-ERR-SIZE-VILNE-SEQ       PIC S9(04)  VALUE 40     00980000
009200                                                     COMP.        00990000
009300     05  PC-TKT-ERR-STYLE-VILN-SEQ       PIC S9(04)  VALUE 41     01000000
009400                                                     COMP.        01010000
009500     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01020000
009600         'SUKRF711'.                                              01030000
009700     05  PC-MDSE-NO-MATCH-SCREEN         PIC  X(08)  VALUE        01040000
009800         'SUKRF522'.                                              01050000
009900     05  PC-TKT-EXCEPTION-SCREEN         PIC  X(08)  VALUE        01060000
010000         'SUKRF524'.                                              01070000
010100     05  PC-UPC-SCAN-PROGRAM             PIC  X(08)  VALUE        01080000
010200         'SUKRF518'.                                              01090000
010300     05  PC-UPC-RF-EXCP-PROGRAM          PIC  X(08)  VALUE        01100031
010400         'SUKRF711'.                                              01110031
010500     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE        01120000
010500         'S711'.                                                  01130000
010600     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        01140003
010700         'TRANS NOT AVAILABLE'.                                   01150003
009100     05  PC-MAX-RETRIES                  PIC S9(04)  VALUE 3      01160047
009200                                                     COMP.        01170047
010800                                                                  01180000
010900 01  PV-PROGRAM-VARIABLES.                                        01190000
011000     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   01200000
011100                                                     COMP SYNC.   01210000
011200     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01220000
011300                                                     COMP SYNC.   01230000
011400     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01240000
011500     05  PV-DECIMAL-COUNT                PIC S9(04)  VALUE ZERO   01250000
011600                                                     COMP.        01260000
011700     05  PV-DISPLAY-KEYS.                                         01270000
011800         10 FILLER                       PIC  X(12)  VALUE        01280000
011900                                                   'KEY VALUES: '.01290000
012000         10 PV-DISP-AUD-CNTL-NBR         PIC  9(09).              01300000
012100         10 FILLER                       PIC  X(04)  VALUE ' -- '.01310000
012300         10 PV-DISP-SHIPT-UNT-ID         PIC  9(18).              01320000
012400         10 FILLER                       PIC  X(04)  VALUE ' -- '.01330000
012600         10 PV-DISP-UPC-NBR              PIC  9(15).              01340000
012900     05  PV-DISP-SCN-TMST                PIC  X(26).              01350049
013000     05  PV-SHORT-STYLE                  PIC  X(12).              01360000
013000     05  PV-WRONG-RFID-CTR-X             PIC  9(3).               01370033
013000     05  PV-WRONG-RFID-CTR               PIC  ZZ9.                01380033
020000     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE ZERO.  01390047
020000     05  PV-HOLD-TMST                    PIC  X(26)  VALUE SPACE. 01400057
013100                                                                  01410000
013200 01  DK-DB2-KEYS.                                                 01420000
013300     05  DK-UPC-NUMBER                   PIC S9(15) COMP-3.       01430000
013400                                                                  01440000
013500******************************************************************01450000
013600*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01460000
013700******************************************************************01470000
013800     COPY DFHAID.                                                 01480000
013900                                                                  01490000
014100******************************************************************01500000
014200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                01510000
014300******************************************************************01520000
014400     COPY DPWS013.                                                01530008
014500                                                                  01540000
014600******************************************************************01550000
014700*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01560000
000100******************************************************************01570000
014900     COPY DPWS010I.                                               01580008
015000                                                                  01590000
015100******************************************************************01600000
015200*  GENERATED DSECT FOR THE SUKM711 MAPSET                         01610000
015300******************************************************************01620000
015400     COPY SUKM711.                                                01630008
015500                                                                  01640000
015600******************************************************************01650000
015700*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01660000
015800******************************************************************01670000
015900     COPY DPWS015.                                                01680008
016000                                                                  01690000
015600******************************************************************01700000
016200* HELP SCREEN COMMAREA                                            01710003
016300     COPY PCWS192.                                                01720003
015600******************************************************************01730000
016500* HELP SCREEN WORK AREA                                           01740003
016600     COPY PCWS188.                                                01750003
016700                                                                  01760003
016800******************************************************************01770000
016900*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      01780000
017000*  TO BE DISPLAYED ON THE LRT                                     01790000
017100******************************************************************01800000
017200     COPY SUWS005.                                                01810008
017300                                                                  01820000
017400******************************************************************01830000
017500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT AUDIT01840000
017600*  TABLE (TSUATRN)                                                01850000
017700******************************************************************01860000
017800     EXEC SQL                                                     01870000
017900         INCLUDE TSUATRN                                          01880000
018000     END-EXEC.                                                    01890000
018100                                                                  01900000
018200******************************************************************01910000
018300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      01920000
018400*  CONTENT AUDIT TABLE (TSUEXCP)                                  01930000
018500******************************************************************01940000
018600     EXEC SQL                                                     01950000
018700         INCLUDE TSUEXCP                                          01960000
018800     END-EXEC.                                                    01970000
018900                                                                  01980000
019000     EXEC SQL                                                     01990000
019100         INCLUDE TSUAUPC                                          02000000
019200     END-EXEC.                                                    02010000
019300                                                                  02020000
019400*  DCLGEN FOR THE XLT_UPC TABLE                                   02030005
019500     EXEC SQL                                                     02040005
019600         INCLUDE XLT00006                                         02050005
019700     END-EXEC.                                                    02060005
019800                                                                  02070005
019900     EXEC SQL                                                     02080000
020000         INCLUDE TUPC                                             02090000
020100     END-EXEC.                                                    02100000
020200                                                                  02110000
020300     EXEC SQL                                                     02120000
020400         INCLUDE TUPCSKU                                          02130000
020500     END-EXEC.                                                    02140000
020600                                                                  02150020
020700*  WST_INTGRTN_TYP                                                02160020
020800     EXEC SQL                                                     02170020
020900         INCLUDE WST00008                                         02180020
021000     END-EXEC.                                                    02190020
021100                                                                  02200020
021200*  WST_ATTR_DEFN                                                  02210020
021300     EXEC SQL                                                     02220020
021400         INCLUDE WST00009                                         02230020
021500     END-EXEC.                                                    02240020
021600                                                                  02250020
021700*  WST_ATTR_ELEM                                                  02260020
021800     EXEC SQL                                                     02270020
021900         INCLUDE WST00010                                         02280020
022000     END-EXEC.                                                    02290020
022100                                                                  02300020
022200******************************************************************02310000
022300*  COMMUNICATIONS AREA FOR DB2                                    02320000
022400******************************************************************02330000
022500     EXEC SQL                                                     02340000
022600         INCLUDE SQLCA                                            02350000
022700     END-EXEC.                                                    02360000
022800                                                                  02370000
023100******************************************************************02380000
023200 LINKAGE SECTION.                                                 02390000
023300******************************************************************02400000
023400 01  DFHCOMMAREA.                                                 02410000
023500     05  FILLER                         OCCURS  1 TO 4072 TIMES   02420000
023600                                        DEPENDING ON EIBCALEN.    02430000
023700         10  FILLER                     PIC X.                    02440000
023800                                                                  02450000
024000******************************************************************02460000
024100 PROCEDURE DIVISION.                                              02470000
024200******************************************************************02480000
024300 0000-PROGRAM-MAINLINE.                                           02490000
023900                                                                  02500000
024400     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           02510000
024500     MOVE LOW-VALUES   TO  SU711AI.                               02520000
024600                                                                  02530000
024700     EVALUATE TRUE                                                02540000
025100         WHEN EIBTRNID = 'Z278'                                   02550004
024900*          DPKRF278 IS THE PGM FOR THE HELP SCREEN                02560004
025200             MOVE DFHCOMMAREA          TO PC192-COMMAREA          02570004
025300             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             02580004
025400             SET SU006-PROCESS-SCREEN  TO TRUE                    02590004
025500             PERFORM 1000-SETUP-SCREEN                            02600004
025600             PERFORM 8000-SEND-MAP                                02610004
025700             PERFORM 8200-RETURN-TRANID                           02620004
025800                                                                  02630004
025900         WHEN EIBCALEN = ZERO                                     02640000
026000         WHEN EIBAID = DFHCLEAR                                   02650000
026100         WHEN SU006-INITIALIZE-SCREEN                             02660000
026200             SET SU006-PROCESS-SCREEN TO TRUE                     02670000
026300             PERFORM 1000-SETUP-SCREEN                            02680000
026400                                                                  02690000
026500             PERFORM 8000-SEND-MAP                                02700000
026600             PERFORM 8200-RETURN-TRANID                           02710000
026700                                                                  02720000
026800         WHEN EIBAID = DFHENTER                                   02730000
026900             PERFORM 1200-RECEIVE-MAP                             02740000
027000             PERFORM 1300-EDIT-SELECTION                          02750000
027100                                                                  02760000
027200             MOVE SU006-SHIP-UNIT-NBR-X TO AMSGLNO                02770000
027300                                                                  02780000
027400*        THE CONTINUE KEY WAS PRESSED...GET ANY CHANGES FROM THE  02790000
027500*        SCREEN, CREATE THE APPROPRIATE EXCEPTION AND CONTINUE TO 02800000
027600*        ENTER TOTAL UPC SCREEN                                   02810000
027700         WHEN EIBAID = DFHPF2                                     02820000
026300*JIM         PERFORM 1000-SETUP-SCREEN                            02830062
027800             PERFORM 1200-RECEIVE-MAP                             02840000
027900             PERFORM 1300-EDIT-SELECTION                          02850000
028100             PERFORM 1500-CHECK-EXCEPTIONS                        02860000
                   COMPUTE SU006-WRONG-RFID-CTR =                       02870031
                           SU006-WRONG-RFID-CTR - 1                     02880031
      ** IF THERE ARE MORE ERRORS TO PROCESS, THEN, PROGRAM WILL        02890031
      ** XFER TO ITSELF TO PROCESS NEXT ERROR, ELSE TO SUKRF518         02900031
      ** TO PROCESS NEXT UPC                                            02910031
028800             IF SU006-WRONG-RFID-CTR > 0                          02920031
028900                MOVE PC-UPC-RF-EXCP-PROGRAM                       02930031
029000                                      TO PV-TRANSFER-PROGRAM      02940000
029200             ELSE                                                 02950000
029300                MOVE PC-UPC-SCAN-PROGRAM                          02960000
029400                                      TO PV-TRANSFER-PROGRAM      02970000
029200             END-IF                                               02980000
028500             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                02990000
028600                                                                  03000000
028700*        WHEN EIBAID = DFHPF3                                     03010038
029300*            MOVE PC-UPC-SCAN-PROGRAM TO PV-TRANSFER-PROGRAM      03020038
029500*            PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                03030038
030600                                                                  03040000
030700         WHEN EIBAID = DFHPF1                                     03050003
030800              PERFORM 1400-HELP-SCREEN                            03060003
030900                                                                  03070003
031000         WHEN OTHER                                               03080000
031100             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO AMSGLNO          03090000
031200                                                                  03100000
031300     END-EVALUATE.                                                03110000
031400                                                                  03120000
031500     PERFORM 8100-SEND-DATA-ONLY.                                 03130000
031400                                                                  03140000
031600     PERFORM 8200-RETURN-TRANID.                                  03150000
031700                                                                  03160000
031800     GOBACK.                                                      03170000
023900                                                                  03180000
000100******************************************************************03190000
032000* 1000-SETUP-SCREEN                                               03200000
000100******************************************************************03210000
032300 1000-SETUP-SCREEN.                                               03220000
032400                                                                  03230000
033400*      MOVE SYSTEM INFORMATION TO THE SCREEN                      03240000
              MOVE SU006-UPC             TO AUPCO.                      03250038
                                                                        03260037
              MOVE SU006-WRONG-RFID-CTR  TO PV-WRONG-RFID-CTR-X.        03270041
              MOVE PV-WRONG-RFID-CTR-X   TO PV-WRONG-RFID-CTR.          03280041
              MOVE PV-WRONG-RFID-CTR     TO ATGSLFTO.                   03290038
033500        MOVE SU006-SKU-DPT         TO CA-SCRN-DEPT.               03300038
033700        MOVE SU006-SKU-MAJ-CLASS   TO CA-SCRN-MAJ-CLASS.          03310038
033900        MOVE SU006-SKU-SUB-CLASS   TO CA-SCRN-SUB-CLASS.          03320038
              MOVE SPACE                 TO CA-SCRN-LOGO.               03330038
034300        MOVE CA-SYSTEM-SIZE        TO ASIZEO                      03340000
034400                                      CA-SCRN-SIZE.               03350038
034500        MOVE CA-SYSTEM-COLOR       TO ACOLORO                     03360000
034600                                      CA-SCRN-COLOR.              03370038
034700        MOVE CA-SYSTEM-STYLE       TO ASTYLEO                     03380000
034800                                      CA-SCRN-STYLE.              03390038
035000                                                                  03400000
035100     MOVE SU006-SHIP-UNIT-NBR-X    TO AMSGLNO.                    03410000
035200                                                                  03420000
000100******************************************************************03430000
035400 1200-RECEIVE-MAP.                                                03440000
035300                                                                  03450000
035500     EXEC CICS                                                    03460000
035600         RECEIVE                                                  03470000
035700             MAP    ('SU711A')                                    03480000
035800             MAPSET ('SUKM711')                                   03490000
035900             RESP   (PV-CICS-RESPONSE)                            03500000
036000     END-EXEC.                                                    03510000
036100                                                                  03520000
036200     EVALUATE TRUE                                                03530000
036300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03540000
036400              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  03550000
036100                                                                  03560000
036500         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                03570000
036600              CONTINUE                                            03580000
036100                                                                  03590000
036700         WHEN OTHER                                               03600000
036800              MOVE '1200-RECEIVE-MAP'                             03610000
036900                                     TO DP013-PARAGRAPH           03620000
037000              MOVE 'UNABLE TO RECEIVE MAP'                        03630000
037100                                     TO DP013-MESSAGE-TEXT (1)    03640000
037200              SET DP013-LOGIC-ABEND  TO TRUE                      03650000
037300              SET DP013-NO-ROLLBACK  TO TRUE                      03660000
037400              PERFORM 9999-WRITE-CICS-LOG-MSG                     03670000
037500     END-EVALUATE.                                                03680000
037600                                                                  03690000
000100******************************************************************03700000
037700 1210-RECEIVE-SCREEN-FIELDS.                                      03710000
037800                                                                  03720000
041100     IF ALOGOL > ZERO                                             03730000
041200         MOVE ALOGOI                 TO CA-SCRN-LOGO              03740000
041300         MOVE 0                      TO ALOGOL                    03750000
041400     ELSE                                                         03760000
041400         IF ALOGOF = DP015-ERASE-EOF                              03770000
041500            MOVE SPACES              TO CA-SCRN-LOGO              03780000
041600                                        ALOGOO                    03790000
               ELSE                                                     03800038
041500            MOVE SPACES              TO CA-SCRN-LOGO              03810038
041600                                        ALOGOO                    03820038
041700         END-IF                                                   03830000
041700     END-IF.                                                      03840000
037800                                                                  03850000
041100     IF ASIZEL > ZERO                                             03860000
041200         MOVE ASIZEI                 TO CA-SCRN-SIZE              03870000
041300         MOVE 0                      TO ASIZEL                    03880000
041400     ELSE                                                         03890000
041400         IF ASIZEF = DP015-ERASE-EOF                              03900000
041500            MOVE SPACES              TO CA-SCRN-SIZE              03910000
041600                                        ASIZEO                    03920000
041700         END-IF                                                   03930000
041700     END-IF.                                                      03940000
041800                                                                  03950000
041900     IF ACOLORL > ZERO                                            03960000
042000         MOVE ACOLORI                TO CA-SCRN-COLOR             03970000
042100         MOVE 0                      TO ACOLORL                   03980000
042200     ELSE                                                         03990000
042200         IF ACOLORF = DP015-ERASE-EOF                             04000000
042300            MOVE SPACES              TO CA-SCRN-COLOR             04010000
042400                                        ACOLORO                   04020000
041700         END-IF                                                   04030000
042500     END-IF.                                                      04040000
042600                                                                  04050000
042700     IF ASTYLEL > ZERO                                            04060000
042800         MOVE ASTYLEI                TO CA-SCRN-STYLE             04070000
042900         MOVE 0                      TO ASTYLEL                   04080000
043000     ELSE                                                         04090000
043000         IF ASTYLEF = DP015-ERASE-EOF                             04100000
043100            MOVE SPACES              TO CA-SCRN-STYLE             04110000
043200                                        ASTYLEO                   04120000
041700         END-IF                                                   04130000
043300     END-IF.                                                      04140000
043400                                                                  04150000
000100******************************************************************04160000
027000 1300-EDIT-SELECTION.                                             04170000
043400                                                                  04180000
044100*  CHECK TO MAKE SURE THE EPC LOGO FIELD CONTAINS 'Y' OR 'N'      04190023
045100     IF CA-SCRN-LOGO = 'Y'                                        04200000
041200     OR CA-SCRN-LOGO = 'N'                                        04210000
041200        CONTINUE                                                  04220023
041200     ELSE                                                         04230000
045200        MOVE PM-INVALID-YESNO-MSG    TO AMSGLNO                   04240026
045400        MOVE -1                      TO ALOGOL                    04250000
045500        PERFORM 8100-SEND-DATA-ONLY                               04260000
045600        PERFORM 8200-RETURN-TRANID                                04270000
046000     END-IF.                                                      04280000
046100                                                                  04290000
000100******************************************************************04300000
054700 1400-HELP-SCREEN.                                                04310003
054600                                                                  04320000
054800     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      04330003
054900     MOVE 'SUKRF711'                  TO PC192-PROGRAM-NAME       04340003
055000     COPY PCPD188.                                                04350003
055100     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      04360003
055200     PERFORM 4200-XCTL-TO-HELP.                                   04370003
055400                                                                  04380000
000100******************************************************************04390000
055600*   1500-CHECK-EXCEPTIONS                                         04400000
055700* COMPARE THE SCREEN VALUES WITH THE SYSTEM VALUES TO DETERMINE   04410000
055800* WHICH EXCEPTIONS TO CREATE                                      04420000
000100******************************************************************04430000
056000 1500-CHECK-EXCEPTIONS.                                           04440000
056100                                                                  04450000
057200       SET PS-PROCESD-EXCPTN-NO TO TRUE.                          04460057
056100                                                                  04470057
057200       IF CA-SYSTEM-COLOR  = CA-SCRN-COLOR                        04480057
               CONTINUE                                                 04490061
057400       ELSE                                                       04500000
028800         IF  CA-SCRN-LOGO = 'N'                                   04510061
045200            MOVE PM-EPC-ONLY-MSG1        TO AMSGLNO               04520064
045200            MOVE PM-EPC-ONLY-MSG2        TO AMSGLN2O              04530064
045400            MOVE -1                      TO ALOGOL                04540061
034300            MOVE CA-SYSTEM-SIZE          TO ASIZEO                04550061
034300                                            CA-SCRN-SIZE          04560063
034500            MOVE CA-SYSTEM-COLOR         TO ACOLORO               04570061
034300                                            CA-SCRN-COLOR         04580063
034700            MOVE CA-SYSTEM-STYLE         TO ASTYLEO               04590061
034300                                            CA-SCRN-STYLE         04600063
                  MOVE SPACE                   TO ALOGOO                04610061
045500            PERFORM 8100-SEND-DATA-ONLY                           04620061
045600            PERFORM 8200-RETURN-TRANID                            04630061
               ELSE                                                     04640061
                 SET PS-CLR-SZE-STL-ERROR TO TRUE                       04650039
057500           MOVE PC-TKT-ERR-COLOR-VILN-SEQ                         04660000
057600                             TO SUEXCP-VILN-GP-SEQ-NBR            04670000
057700           MOVE CA-SCRN-COLOR                                     04680000
057800                             TO SUEXCP-OVRRID-SYS-DAT-TXT         04690000
057900           PERFORM 1501-CREATE-EXCEPTION                          04700000
057200           SET PS-PROCESD-EXCPTN-YES TO TRUE                      04710059
               END-IF                                                   04720061
058000       END-IF.                                                    04730000
058100                                                                  04740000
058200       IF CA-SYSTEM-SIZE = CA-SCRN-SIZE                           04750000
               CONTINUE                                                 04760061
058400       ELSE                                                       04770000
028800         IF  CA-SCRN-LOGO = 'N'                                   04780061
045200            MOVE PM-EPC-ONLY-MSG1        TO AMSGLNO               04790064
045200            MOVE PM-EPC-ONLY-MSG2        TO AMSGLN2O              04800064
045400            MOVE -1                      TO ALOGOL                04810061
034300            MOVE CA-SYSTEM-SIZE          TO ASIZEO                04820061
034300                                            CA-SCRN-SIZE          04830063
034500            MOVE CA-SYSTEM-COLOR         TO ACOLORO               04840061
034300                                            CA-SCRN-COLOR         04850063
034700            MOVE CA-SYSTEM-STYLE         TO ASTYLEO               04860061
034300                                            CA-SCRN-STYLE         04870063
                  MOVE SPACE                   TO ALOGOO                04880061
045500            PERFORM 8100-SEND-DATA-ONLY                           04890061
045600            PERFORM 8200-RETURN-TRANID                            04900061
               ELSE                                                     04910061
                 SET PS-CLR-SZE-STL-ERROR TO TRUE                       04920039
058500           MOVE PC-TKT-ERR-SIZE-VILNE-SEQ                         04930000
058600                             TO SUEXCP-VILN-GP-SEQ-NBR            04940000
058700           MOVE CA-SCRN-SIZE TO SUEXCP-OVRRID-SYS-DAT-TXT         04950000
058800           PERFORM 1501-CREATE-EXCEPTION                          04960000
057200           SET PS-PROCESD-EXCPTN-YES TO TRUE                      04970059
               END-IF                                                   04980061
058900       END-IF.                                                    04990000
059000                                                                  05000000
059100       MOVE CA-SYSTEM-STYLE  TO PV-SHORT-STYLE.                   05010000
059200                                                                  05020000
059300       IF PV-SHORT-STYLE = CA-SCRN-STYLE                          05030000
               CONTINUE                                                 05040061
059500       ELSE                                                       05050000
028800         IF  CA-SCRN-LOGO = 'N'                                   05060061
045200            MOVE PM-EPC-ONLY-MSG1        TO AMSGLNO               05070065
045200            MOVE PM-EPC-ONLY-MSG2        TO AMSGLN2O              05080065
045400            MOVE -1                      TO ALOGOL                05090061
034300            MOVE CA-SYSTEM-SIZE          TO ASIZEO                05100061
034300                                            CA-SCRN-SIZE          05110063
034500            MOVE CA-SYSTEM-COLOR         TO ACOLORO               05120061
034300                                            CA-SCRN-COLOR         05130063
034700            MOVE CA-SYSTEM-STYLE         TO ASTYLEO               05140061
034300                                            CA-SCRN-STYLE         05150063
                  MOVE SPACE                   TO ALOGOO                05160061
045500            PERFORM 8100-SEND-DATA-ONLY                           05170061
045600            PERFORM 8200-RETURN-TRANID                            05180061
               ELSE                                                     05190061
                 SET PS-CLR-SZE-STL-ERROR TO TRUE                       05200039
059600           MOVE PC-TKT-ERR-STYLE-VILN-SEQ                         05210000
059700                              TO SUEXCP-VILN-GP-SEQ-NBR           05220000
059800           MOVE CA-SCRN-STYLE TO SUEXCP-OVRRID-SYS-DAT-TXT        05230000
059900           PERFORM 1501-CREATE-EXCEPTION                          05240000
               END-IF                                                   05250061
060000       END-IF.                                                    05260000
060100                                                                  05270000
063500       IF SU006-UPC-NOT-CERTIFIED                                 05280021
063700*        DO NOT EVEN ATTEMPT TO CERTIFY A TUPC                    05290021
063800*        DURING THE TIME THAT DB MAINTENANCE IS BEING DONE.       05300021
063900          PERFORM 7300-GET-BLACKOUT                               05310021
064000          IF PS-BLACKOUT-NO                                       05320021
064100             MOVE 'Y'         TO SUAUPC-UPC-CERTD-IND             05330021
064200             PERFORM 1700-CERTIFY-UPC                             05340021
064300             PERFORM 1710-UPDATE-AUDIT-ROW                        05350021
064400          END-IF                                                  05360021
064700       END-IF.                                                    05370021
064400                                                                  05380021
      **     FOR MISSING RFID TAGS WE NEED TO SUBTRACT 1 FROM TAGGED    05390031
      **     QTY. THIS QTY IS SET TO MATCH SCANNED QTY IN SUKRF537      05400031
      **     OR SUKRF710 DEPENDING ON WHETHER BULK OR NOT               05410031
028800       IF  CA-SCRN-LOGO = 'N'                                     05420031
071500           PERFORM 1720-UPDATE-TAGGED-QTY                         05430021
064700       END-IF.                                                    05440021
357100                                                                  05450000
000100******************************************************************05460000
065000*   1501-CREATE-EXCEPTION                                         05470000
065100* CREATE THE APPROPRIATE EXCEPTION..........                      05480000
000100******************************************************************05490000
065300 1501-CREATE-EXCEPTION.                                           05500000
023900                                                                  05510000
023456     IF (SU006-QC-AND-RFID-AUD                                    05520020
023456     AND SU006-MANUAL-GENERATED-AUDIT)                            05530020
023456      OR SU006-QC-AUD-ONLY                                        05540020
023456      OR SU006-RFID-AUD-ONLY                                      05550020
023456**  FOR A MANUAL GENERATED AUDIT ONLY 1 ROW EXISTS AND WE WILL USE05560020
023456**  THE AUDIT CONTROL NUMBER FROM THAT                            05570020
023456        MOVE SU006-AUDIT-CNTL-NBR    TO SUEXCP-AUD-CNTL-NBR       05580020
023456     ELSE                                                         05590020
023456         MOVE SU006-RFID-AUDIT-CNTL-NBR                           05600020
023456                                     TO SUEXCP-AUD-CNTL-NBR       05610020
023456     END-IF.                                                      05620020
023456**   MOVE SU006-AUDIT-CNTL-NBR       TO SUEXCP-AUD-CNTL-NBR.      05630020
065400     MOVE PC-CARTON-AUDIT-GROUP-CODE TO SUEXCP-VILN-GP-CDE,       05640000
065600     MOVE SU006-SHIP-UNIT-NBR        TO SUEXCP-SHIPT-UNT-ID.      05650000
065700     MOVE SU006-SCN-TMST             TO SUEXCP-SCN-TMST.          05660000
065800     MOVE SU006-UPC                  TO SUEXCP-UPC-NBR.           05670000
065900                                                                  05680000
118300*   IF SIZE, STYLE OR COLOR EXCEPTION - FIRST CHECK TO SEE IF AN  05690044
118300*   EXCEPTION ALREADY EXISTS.                                     05700044
118300*   IF YES, ADD 1 TO THE TAGGED QTY ON TSUAUPC                    05710044
118300*   OTHERWISE INSERT A ROW ON TSUAUPC AND THEN INSERT A ROW ON    05720044
118300*      TSUEXCP WITH THE SAME TIMESTAMP.                           05730044
118300*** JIM ADD START ***                                             05740044
RFAUDT     IF SUEXCP-VILN-GP-SEQ-NBR = 39                               05750048
RFAUDT     OR SUEXCP-VILN-GP-SEQ-NBR = 40                               05760048
RFAUDT     OR SUEXCP-VILN-GP-SEQ-NBR = 41                               05770048
RFAUDT        PERFORM 1505-EXCEPTION-RTN                                05780057
RFAUDT     ELSE                                                         05790056
RFAUDT        PERFORM 1502-CONTINUE                                     05800044
RFAUDT     END-IF.                                                      05810044
070800                                                                  05820000
RFAUDT******************************************************************05830044
118200*   1502-CONTINUE                                                *05840044
118300* CREATE THE APPROPRIATE EXCEPTION..........                     *05850044
RFAUDT******************************************************************05860044
RFAUDT 1502-CONTINUE.                                                   05870047
RFAUDT                                                                  05880044
119200     EXEC SQL                                                     05890044
119300         INSERT  INTO  TSUEXCP                                    05900044
119400                (AUD_CNTL_NBR                                     05910044
119500               , SHIPT_UNT_ID                                     05920044
119600               , UPC_NBR                                          05930044
119700               , SCN_TMST                                         05940044
119800               , VILN_GP_CDE                                      05950044
119900               , VILN_GP_SEQ_NBR                                  05960044
120000               , OVRRID_SYS_DAT_TXT)                              05970044
120100         VALUES                                                   05980044
120200             (  :SUEXCP-AUD-CNTL-NBR                              05990044
120400              , :SUEXCP-SHIPT-UNT-ID                              06000044
120500              , :SUEXCP-UPC-NBR                                   06010044
120600              , :SUEXCP-SCN-TMST                                  06020044
120700              , :SUEXCP-VILN-GP-CDE                               06030044
120800              , :SUEXCP-VILN-GP-SEQ-NBR                           06040044
120900              , :SUEXCP-OVRRID-SYS-DAT-TXT)                       06050044
121000     END-EXEC.                                                    06060044
121100                                                                  06070044
121200     EVALUATE TRUE                                                06080044
121300         WHEN SQLCODE = ZERO                                      06090044
121400             CONTINUE                                             06100044
121500                                                                  06110044
121600         WHEN SQLWARN0 NOT = SPACES                               06120044
121700         WHEN SQLCODE < ZERO                                      06130044
121800         WHEN SQLCODE > ZERO                                      06140044
068700             MOVE '1502-CONTINUE'        TO DP013-PARAGRAPH       06150056
068900             MOVE 'INSERT TO TSUEXCP TABLE'                       06160045
069000                                         TO DP013-MESSAGE-TEXT(1) 06170045
023456             MOVE SUEXCP-AUD-CNTL-NBR    TO PV-DISP-AUD-CNTL-NBR  06180045
119500             MOVE SUEXCP-SHIPT-UNT-ID    TO PV-DISP-SHIPT-UNT-ID  06190056
119600             MOVE SUEXCP-UPC-NBR         TO PV-DISP-UPC-NBR       06200056
122300             MOVE PV-DISPLAY-KEYS        TO DP013-MESSAGE-TEXT(2) 06210056
119800             MOVE SUEXCP-VILN-GP-CDE     TO DP013-MESSAGE-TEXT(3) 06220056
122300             MOVE SUEXCP-OVRRID-SYS-DAT-TXT                       06230056
122300                                         TO DP013-MESSAGE-TEXT(4) 06240056
069200             MOVE SQLCA                  TO DP013-SQLCA           06250045
069300             MOVE 'TSUEXCP'              TO                       06260055
122500                                         DP013-DB2-TABLE-NAME(1)  06270055
069400             SET DP013-DB2-ABEND         TO TRUE                  06280045
069500             SET DP013-NO-ROLLBACK       TO TRUE                  06290045
069600             PERFORM 9999-WRITE-CICS-LOG-MSG                      06300045
069700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               06310045
069800             PERFORM 8100-SEND-DATA-ONLY                          06320045
069900             PERFORM 8200-RETURN-TRANID                           06330045
123500     END-EVALUATE.                                                06340044
123600                                                                  06350044
195200******************************************************************06360044
195200*   CHECK TO CREAT EXCEPTION ONLY OR EXCEPTION AND UPC ROW       *06370058
195200******************************************************************06380050
RFAUDT 1505-EXCEPTION-RTN.                                              06390057
RFAUDT                                                                  06400057
057200     IF PS-PROCESD-EXCPTN-YES                                     06410057
092300        MOVE PV-HOLD-TMST   TO SUEXCP-SCN-TMST                    06420057
088300        PERFORM 1540-CREATE-EXCEP-ROW                             06430057
057200     ELSE                                                         06440057
121400        PERFORM 1520-INSERT-RTN                                   06450057
057200     END-IF.                                                      06460057
121100                                                                  06470044
195200******************************************************************06480044
121400 1520-INSERT-RTN.                                                 06490044
RFAUDT                                                                  06500050
088300     PERFORM 1525-GET-EXISTING-UPC-ROW.                           06510048
088300     PERFORM 1530-CREATE-AUDIT-ROW.                               06520048
RFAUDT                                                                  06530057
092300     MOVE SUAUPC-SCN-TMST   TO SUEXCP-SCN-TMST                    06540057
092300                               PV-HOLD-TMST.                      06550057
088300     PERFORM 1540-CREATE-EXCEP-ROW.                               06560044
088300                                                                  06570057
088300     PERFORM 1720-UPDATE-TAGGED-QTY.                              06580057
RFAUDT                                                                  06590044
195200******************************************************************06600048
195200* THIS WILL GET EXISTING TSUAUPC ROW THAT WILL BE COPIED EXCEPT  *06610050
195200* FOR TAGGED AND SCANNED QTY AND SCN_TMST.                       *06620050
195200******************************************************************06630048
       1525-GET-EXISTING-UPC-ROW.                                       06640048
121300                                                                  06650050
           MOVE SUEXCP-AUD-CNTL-NBR TO SUAUPC-AUD-CNTL-NBR.             06660048
           MOVE SU006-SHIP-UNIT-NBR TO SUAUPC-SHIPT-UNT-ID.             06670050
           MOVE SU006-UPC           TO SUAUPC-UPC-NBR.                  06680050
           MOVE SU006-SCN-TMST      TO SUAUPC-SCN-TMST.                 06690050
121300                                                                  06700050
092200     EXEC SQL                                                     06710050
092700          SELECT                                                  06720050
092800               AUD_CNTL_NBR                                       06730050
092900              ,SHIPT_UNT_ID                                       06740050
093000              ,UPC_NBR                                            06750050
093100              ,SCN_TMST                                           06760050
093200              ,AUD_USR_ID                                         06770050
093300              ,DEPT_NBR                                           06780050
093400              ,MAJ_CL_NBR                                         06790050
093500              ,SUB_CL_NBR                                         06800050
093600              ,ITM_DESC                                           06810050
093700              ,VND_STYL_DESC                                      06820050
093800              ,UPC_CLOR_DESC                                      06830050
093900              ,UPC_SIZE_DESC                                      06840050
094000              ,UPC_RTL_AMT                                        06850050
094100              ,UPC_CERTD_IND                                      06860050
094200              ,SCN_TYP_CDE                                        06870050
094300              ,SKU_NBR                                            06880050
094300              ,RFID_TGD_QTY                                       06890050
RFAUDT              ,SCND_UNT_QTY                                       06900050
094500         INTO                                                     06910050
094700              :SUAUPC-AUD-CNTL-NBR                                06920050
094800            , :SUAUPC-SHIPT-UNT-ID                                06930050
094900            , :SUAUPC-UPC-NBR                                     06940050
095000            , :SUAUPC-SCN-TMST                                    06950050
095100            , :SUAUPC-AUD-USR-ID                                  06960050
095200            , :SUAUPC-DEPT-NBR                                    06970050
095300            , :SUAUPC-MAJ-CL-NBR                                  06980050
095400            , :SUAUPC-SUB-CL-NBR                                  06990050
095500            , :SUAUPC-ITM-DESC                                    07000050
095600            , :SUAUPC-VND-STYL-DESC                               07010050
095700            , :SUAUPC-UPC-CLOR-DESC                               07020050
095800            , :SUAUPC-UPC-SIZE-DESC                               07030050
095900            , :SUAUPC-UPC-RTL-AMT                                 07040050
096000            , :SUAUPC-UPC-CERTD-IND                               07050050
096100            , :SUAUPC-SCN-TYP-CDE                                 07060050
096200            , :SUAUPC-SKU-NBR                                     07070050
094300            , :SUAUPC-RFID-TGD-QTY                                07080050
RFAUDT            , :SUAUPC-SCND-UNT-QTY                                07090050
100900         FROM TSUAUPC                                             07100050
101100        WHERE AUD_CNTL_NBR = :SUAUPC-AUD-CNTL-NBR                 07110050
101200          AND SHIPT_UNT_ID = :SUAUPC-SHIPT-UNT-ID                 07120050
101300          AND UPC_NBR      = :SUAUPC-UPC-NBR                      07130050
101300          AND SCN_TMST     = :SUAUPC-SCN-TMST                     07140050
092400     END-EXEC.                                                    07150050
101600                                                                  07160050
101600     EVALUATE TRUE                                                07170050
101700         WHEN SQLCODE = ZERO                                      07180048
101800              CONTINUE                                            07190048
096800                                                                  07200048
101900         WHEN SQLWARN0 NOT = SPACES                               07210048
102000         WHEN SQLCODE < ZERO                                      07220048
102100         WHEN SQLCODE > ZERO                                      07230048
102200             MOVE '1525-GET-EXISTING-UPC-ROW'                     07240048
102300                                        TO DP013-PARAGRAPH        07250048
102400             MOVE 'SELECT TSUAUPC'      TO DP013-MESSAGE-TEXT(1)  07260048
102450             MOVE SUAUPC-AUD-CNTL-NBR   TO PV-DISP-AUD-CNTL-NBR   07270048
102700             MOVE SUAUPC-SHIPT-UNT-ID   TO PV-DISP-SHIPT-UNT-ID   07280048
102900             MOVE SUAUPC-UPC-NBR        TO PV-DISP-UPC-NBR        07290048
103100             MOVE PV-DISPLAY-KEYS       TO DP013-MESSAGE-TEXT(2)  07300049
019200             MOVE SUAUPC-SCN-TMST       TO PV-DISP-SCN-TMST       07310048
103100             MOVE PV-DISP-SCN-TMST      TO DP013-MESSAGE-TEXT(3)  07320049
103200             MOVE SQLCA                 TO DP013-SQLCA            07330048
103300             MOVE 'TSUAUPC'             TO DP013-DB2-TABLE-NAME(1)07340048
122600             SET DP013-DB2-ABEND         TO TRUE                  07350048
069500             SET DP013-NO-ROLLBACK       TO TRUE                  07360048
069600             PERFORM 9999-WRITE-CICS-LOG-MSG                      07370048
069700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               07380048
069800             PERFORM 8100-SEND-DATA-ONLY                          07390048
069900             PERFORM 8200-RETURN-TRANID                           07400048
104000     END-EVALUATE.                                                07410048
088400                                                                  07420050
195200******************************************************************07430044
088300 1530-CREATE-AUDIT-ROW.                                           07440044
088400                                                                  07450044
RFAUDT     MOVE 0                             TO SUAUPC-SCND-UNT-QTY.   07460048
094300     MOVE 1                             TO SUAUPC-RFID-TGD-QTY.   07470044
091200                                                                  07480044
091300*  CONTINUE TO TRY INSERTING UNTIL SUCCESSFUL...IF -803 SQLCODE,  07490044
091400*  RETRY WITH THE NEW TIMESTAMP (PART OF THE KEY)                 07500044
091500     PERFORM                                                      07510044
091600         WITH TEST AFTER                                          07520044
091700         VARYING PV-RETRY-COUNTER                                 07530044
091800         FROM 1 BY 1                                              07540044
091900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07550044
092000                   OR (SQLCODE = ZERO))                           07560044
092100                                                                  07570044
092200         EXEC SQL                                                 07580044
092300             SET :SUAUPC-SCN-TMST = CURRENT TIMESTAMP             07590044
092400         END-EXEC                                                 07600044
092500                                                                  07610044
092600         EXEC SQL                                                 07620044
092700             INSERT INTO TSUAUPC                                  07630044
092800                 ( AUD_CNTL_NBR                                   07640044
092900                  ,SHIPT_UNT_ID                                   07650044
093000                  ,UPC_NBR                                        07660044
093100                  ,SCN_TMST                                       07670044
093200                  ,AUD_USR_ID                                     07680044
093300                  ,DEPT_NBR                                       07690044
093400                  ,MAJ_CL_NBR                                     07700044
093500                  ,SUB_CL_NBR                                     07710044
093600                  ,ITM_DESC                                       07720044
093700                  ,VND_STYL_DESC                                  07730044
093800                  ,UPC_CLOR_DESC                                  07740044
093900                  ,UPC_SIZE_DESC                                  07750044
094000                  ,UPC_RTL_AMT                                    07760044
094100                  ,UPC_CERTD_IND                                  07770044
094200                  ,SCN_TYP_CDE                                    07780044
094300                  ,SKU_NBR                                        07790044
094300                  ,RFID_TGD_QTY                                   07800044
RFAUDT                  ,SCND_UNT_QTY                                   07810044
094400                 )                                                07820044
094500             VALUES                                               07830044
094600                 (                                                07840044
094700                    :SUAUPC-AUD-CNTL-NBR                          07850044
094800                  , :SUAUPC-SHIPT-UNT-ID                          07860044
094900                  , :SUAUPC-UPC-NBR                               07870044
095000                  , :SUAUPC-SCN-TMST                              07880044
095100                  , :SUAUPC-AUD-USR-ID                            07890044
095200                  , :SUAUPC-DEPT-NBR                              07900044
095300                  , :SUAUPC-MAJ-CL-NBR                            07910044
095400                  , :SUAUPC-SUB-CL-NBR                            07920044
095500                  , :SUAUPC-ITM-DESC                              07930044
095600                  , :SUAUPC-VND-STYL-DESC                         07940044
095700                  , :SUAUPC-UPC-CLOR-DESC                         07950044
095800                  , :SUAUPC-UPC-SIZE-DESC                         07960044
095900                  , :SUAUPC-UPC-RTL-AMT                           07970044
096000                  , :SUAUPC-UPC-CERTD-IND                         07980044
096100                  , :SUAUPC-SCN-TYP-CDE                           07990044
096200                  , :SUAUPC-SKU-NBR                               08000044
094300                  , :SUAUPC-RFID-TGD-QTY                          08010044
RFAUDT                  , :SUAUPC-SCND-UNT-QTY                          08020044
096300                 )                                                08030044
096400         END-EXEC                                                 08040044
096500                                                                  08050044
096600         EVALUATE TRUE                                            08060044
096700             WHEN SQLCODE = ZERO                                  08070044
                       CONTINUE                                         08080048
096800                                                                  08090044
097100             WHEN SQLWARN0 NOT = SPACES                           08100044
097200             WHEN SQLCODE < ZERO                                  08110044
097300             WHEN SQLCODE > ZERO                                  08120044
097400                 MOVE '1530-CREATE-AUDIT-ROW'                     08130044
097500                                        TO DP013-PARAGRAPH        08140044
097600                 MOVE 'INSERT TSUAUPC'  TO DP013-MESSAGE-TEXT(1)  08150044
097700                 MOVE SUAUPC-AUD-CNTL-NBR                         08160044
097800                                        TO PV-DISP-AUD-CNTL-NBR   08170044
097900                 MOVE SUAUPC-SHIPT-UNT-ID                         08180044
098000                                        TO PV-DISP-SHIPT-UNT-ID   08190044
098100                 MOVE SUAUPC-UPC-NBR    TO PV-DISP-UPC-NBR        08200044
098300                 MOVE PV-DISPLAY-KEYS   TO DP013-MESSAGE-TEXT(2)  08210049
098200                 MOVE SUAUPC-SCN-TMST   TO PV-DISP-SCN-TMST       08220044
098300                 MOVE PV-DISP-SCN-TMST  TO DP013-MESSAGE-TEXT(3)  08230049
098400                 MOVE SQLCA             TO DP013-SQLCA            08240044
098500                 MOVE 'TSUAUPC'         TO DP013-DB2-TABLE-NAME(1)08250044
103400                 SET DP013-DB2-ABEND    TO TRUE                   08260045
103500                 SET DP013-NO-ROLLBACK  TO TRUE                   08270045
069600                 PERFORM 9999-WRITE-CICS-LOG-MSG                  08280045
069700                 MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO           08290045
069800                 PERFORM 8100-SEND-DATA-ONLY                      08300045
069900                 PERFORM 8200-RETURN-TRANID                       08310045
099300         END-EVALUATE                                             08320044
099400     END-PERFORM.                                                 08330044
099500                                                                  08340044
195200******************************************************************08350044
088300 1540-CREATE-EXCEP-ROW.                                           08360044
120600                                                                  08370044
119200     EXEC SQL                                                     08380044
119300         INSERT  INTO  TSUEXCP                                    08390044
119400                (AUD_CNTL_NBR                                     08400044
119500               , SHIPT_UNT_ID                                     08410044
119600               , UPC_NBR                                          08420044
119700               , SCN_TMST                                         08430044
119800               , VILN_GP_CDE                                      08440044
119900               , VILN_GP_SEQ_NBR                                  08450044
120000               , OVRRID_SYS_DAT_TXT)                              08460044
120100         VALUES                                                   08470044
120200             (  :SUEXCP-AUD-CNTL-NBR                              08480044
120400              , :SUEXCP-SHIPT-UNT-ID                              08490044
120500              , :SUEXCP-UPC-NBR                                   08500044
120600              , :SUEXCP-SCN-TMST                                  08510044
120700              , :SUEXCP-VILN-GP-CDE                               08520044
120800              , :SUEXCP-VILN-GP-SEQ-NBR                           08530044
120900              , :SUEXCP-OVRRID-SYS-DAT-TXT)                       08540044
121000     END-EXEC.                                                    08550044
121100                                                                  08560044
121200     EVALUATE TRUE                                                08570044
121300         WHEN SQLCODE = ZERO                                      08580044
121400             CONTINUE                                             08590044
121500                                                                  08600044
121600         WHEN SQLWARN0 NOT = SPACES                               08610044
121700         WHEN SQLCODE < ZERO                                      08620044
121800         WHEN SQLCODE > ZERO                                      08630044
088300             MOVE '1540-CREATE-EXCEP-ROW'                         08640050
121900                                         TO DP013-PARAGRAPH       08650044
122100             MOVE 'INSERT TO TSUEXCP TABLE'                       08660044
122200                                         TO DP013-MESSAGE-TEXT(1) 08670044
122250             MOVE SUEXCP-AUD-CNTL-NBR    TO PV-DISP-AUD-CNTL-NBR  08680044
122300             MOVE SUEXCP-SHIPT-UNT-ID    TO PV-DISP-SHIPT-UNT-ID  08690050
122300             MOVE SUEXCP-UPC-NBR         TO PV-DISP-UPC-NBR       08700050
122300             MOVE PV-DISPLAY-KEYS        TO DP013-MESSAGE-TEXT(2) 08710050
122300             MOVE SUEXCP-SCN-TMST        TO PV-DISP-SCN-TMST      08720050
122300             MOVE PV-DISP-SCN-TMST       TO DP013-MESSAGE-TEXT(3) 08730050
122400             MOVE SQLCA                  TO DP013-SQLCA           08740044
122500             MOVE 'TSUEXCP'              TO                       08750044
122500                                         DP013-DB2-TABLE-NAME(1)  08760044
103400             SET DP013-DB2-ABEND         TO TRUE                  08770045
103500             SET DP013-NO-ROLLBACK       TO TRUE                  08780045
069600             PERFORM 9999-WRITE-CICS-LOG-MSG                      08790045
069700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               08800045
069800             PERFORM 8100-SEND-DATA-ONLY                          08810045
069900             PERFORM 8200-RETURN-TRANID                           08820045
123500     END-EVALUATE.                                                08830044
123600                                                                  08840044
123700*  IF THE CURRENT SHIPPING UNIT AUDIT RECORD DOES NOT HAVE ANY    08850044
123800*  EXCEPTIONS CREATED YET, SET THE INDICATOR TO SAY THAT IT       08860044
123900*  DOES NOW                                                       08870044
124000     IF SU006-NO-AUD-ERR                                          08880060
124100         PERFORM 1600-UPDATE-SHIP-UNIT                            08890060
124200     END-IF.                                                      08900060
124300                                                                  08910044
000100******************************************************************08920000
071100*   1600-UPDATE-SHIP-UNIT                                         08930000
071200* UPDATE THE AUDIT ERROR INDICATOR TO SAY THERE ARE EXCEPTIONS    08940000
071300* FOR THIS SHIPPING UNIT AUDIT                                    08950000
000100******************************************************************08960000
071500 1600-UPDATE-SHIP-UNIT.                                           08970000
071600                                                                  08980000
023456     IF (SU006-QC-AND-RFID-AUD                                    08990020
023456     AND SU006-MANUAL-GENERATED-AUDIT)                            09000020
023456      OR SU006-QC-AUD-ONLY                                        09010020
023456      OR SU006-RFID-AUD-ONLY                                      09020020
023456**  FOR A MANUAL GENERATED AUDIT ONLY 1 ROW EXISTS AND WE WILL USE09030020
023456**  THE AUDIT CONTROL NUMBER FROM THAT                            09040020
023456        MOVE SU006-AUDIT-CNTL-NBR                                 09050020
023456                               TO SUATRN-AUD-CNTL-NBR             09060020
023456     ELSE                                                         09070020
023456         MOVE SU006-RFID-AUDIT-CNTL-NBR                           09080020
023456                               TO SUATRN-AUD-CNTL-NBR             09090020
023456     END-IF.                                                      09100020
023456**   MOVE SU006-AUDIT-CNTL-NBR TO SUATRN-AUD-CNTL-NBR.            09110020
071800     MOVE SU006-SHIP-UNIT-NBR  TO SUATRN-SHIPT-UNT-ID.            09120000
071900                                                                  09130000
072000     EXEC SQL                                                     09140000
072100         UPDATE TSUATRN                                           09150000
072200            SET UNT_AUD_ERR_IND = 'Y'                             09160000
072300          WHERE AUD_CNTL_NBR = :SUATRN-AUD-CNTL-NBR               09170000
072400            AND SHIPT_UNT_ID = :SUATRN-SHIPT-UNT-ID               09180000
072500     END-EXEC                                                     09190000
072600                                                                  09200000
072700     EVALUATE TRUE                                                09210000
072800         WHEN SQLCODE = ZERO                                      09220000
072900             SET SU006-AUD-ERR           TO TRUE                  09230000
073000                                                                  09240000
073100         WHEN SQLWARN0 NOT = SPACES                               09250000
073200         WHEN SQLCODE < ZERO                                      09260000
073300         WHEN SQLCODE > ZERO                                      09270000
073400             MOVE '1600-UPDATE-SHIP-UNIT'                         09280000
073500                                         TO DP013-PARAGRAPH       09290000
073600             MOVE 'UPDATE THE AUDIT ERROR CODE'                   09300000
073700                                         TO DP013-MESSAGE-TEXT(1) 09310000
023456             MOVE SUATRN-AUD-CNTL-NBR    TO PV-DISP-AUD-CNTL-NBR  09320023
023456             MOVE PV-DISP-AUD-CNTL-NBR   TO DP013-MESSAGE-TEXT(2) 09330024
073900             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(3) 09340000
074000             MOVE SQLCA                  TO DP013-SQLCA           09350000
074100             MOVE 'TSUATRN'              TO                       09360000
074100                                         DP013-DB2-TABLE-NAME(1)  09370000
074200             SET DP013-DB2-ABEND         TO TRUE                  09380000
074300             SET DP013-NO-ROLLBACK       TO TRUE                  09390000
074400             PERFORM 9999-WRITE-CICS-LOG-MSG                      09400000
074500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               09410000
074600             PERFORM 8100-SEND-DATA-ONLY                          09420000
074700             PERFORM 8200-RETURN-TRANID                           09430000
074800     END-EVALUATE.                                                09440000
074900                                                                  09450000
000100******************************************************************09460000
075100*   1700-CERTIFY-UPC                                              09470000
075200* UPDATE THE UPC CERTIFICATION FLAG TO 'Y' ON BOTH TUPC AND       09480000
075300* TUPCSKU TABLES                                                  09490000
000100******************************************************************09500000
075500 1700-CERTIFY-UPC.                                                09510000
075600                                                                  09520000
075700     MOVE SU006-UPC                  TO DK-UPC-NUMBER.            09530000
075800     SET  PS-DATABASE-CONTENTION-NO  TO TRUE.                     09540007
075900                                                                  09550000
076000     EXEC SQL                                                     09560000
076100         UPDATE TUPC                                              09570000
076200            SET CERTD_IND          = 'Y'                          09580000
076300              , CERTD_DTE          =  CURRENT DATE                09590000
076400              , LAST_UPD_BY_USR_ID = :SU006-USERID                09600000
076500              , LAST_UPD_TMST      =  CURRENT TIMESTAMP           09610000
076600         WHERE  UPC_NBR            = :DK-UPC-NUMBER               09620000
076700     END-EXEC.                                                    09630000
076800                                                                  09640000
076900     EVALUATE TRUE                                                09650000
077000         WHEN SQLCODE = ZERO                                      09660000
077100             PERFORM 1701-UPDATE-XLT-UPC                          09670005
077200                                                                  09680000
077300         WHEN SQLCODE = -904                                      09690007
077400         WHEN SQLCODE = -913                                      09700007
077500              SET PS-DATABASE-CONTENTION-YES                      09710007
077500                                         TO TRUE                  09720007
077600                                                                  09730007
077700         WHEN SQLWARN0 NOT = SPACES                               09740000
077800         WHEN SQLCODE < ZERO                                      09750000
077900         WHEN SQLCODE > ZERO                                      09760000
078000             MOVE '1700-CERTIFY-UPC'     TO DP013-PARAGRAPH       09770000
078200             MOVE SU006-UPC-X            TO DP013-MESSAGE-TEXT(1) 09780000
078300             MOVE SQLCA                  TO DP013-SQLCA           09790000
078400             MOVE 'TUPC'                 TO                       09800000
078400                                         DP013-DB2-TABLE-NAME(1)  09810000
078500             SET DP013-DB2-ABEND         TO TRUE                  09820000
078600             SET DP013-NO-ROLLBACK       TO TRUE                  09830000
078700             PERFORM 9999-WRITE-CICS-LOG-MSG                      09840000
078800*          MOVE PM-DB2-FATAL-ERROR-MSG TO CA-RETURN-MSG           09850000
078900*          SET CA-RETURN-ERROR         TO TRUE                    09860000
079000                                                                  09870000
079100*            RETURN TO THE PROGRAM THAT CALLED IT                 09880000
079200             MOVE SU006-LAST-PROGRAM     TO PV-TRANSFER-PROGRAM   09890000
079300             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                09900000
079400     END-EVALUATE.                                                09910000
079500                                                                  09920000
079600     IF PS-DATABASE-CONTENTION-NO                                 09930007
079700         EXEC SQL                                                 09940007
079800             UPDATE TUPCSKU                                       09950007
079900                SET CERT_IND = 'Y'                                09960007
080000                   ,CERT_DTE = CURRENT DATE                       09970007
080100              WHERE UPC_NBR = :DK-UPC-NUMBER                      09980007
080200         END-EXEC                                                 09990007
080300                                                                  10000000
080400         EVALUATE TRUE                                            10010007
080500             WHEN SQLCODE = ZERO                                  10020007
080600                 CONTINUE                                         10030007
080700                                                                  10040000
080800             WHEN SQLWARN0 NOT = SPACES                           10050007
080900             WHEN SQLCODE < ZERO                                  10060007
081000             WHEN SQLCODE > ZERO                                  10070007
081100                 MOVE '1700-CERTIFY-UPC' TO DP013-PARAGRAPH       10080007
081300                 MOVE SU006-UPC-X        TO DP013-MESSAGE-TEXT(1) 10090007
081400                 MOVE SQLCA              TO DP013-SQLCA           10100007
081500                 MOVE 'TUPCSKU'          TO                       10110007
081500                                         DP013-DB2-TABLE-NAME(1)  10120007
081600                 SET DP013-DB2-ABEND     TO TRUE                  10130007
081700                 SET DP013-NO-ROLLBACK   TO TRUE                  10140007
081800                 PERFORM 9999-WRITE-CICS-LOG-MSG                  10150007
081900*              MOVE PM-DB2-FATAL-ERROR-MSG TO SU006-RETURN-MSG    10160007
082000*              SET SU006-RETURN-ERROR      TO TRUE                10170007
082100                                                                  10180000
082200*                RETURN TO THE PROGRAM THAT CALLED IT             10190007
082300                 MOVE SU006-LAST-PROGRAM TO PV-TRANSFER-PROGRAM   10200007
082400                 PERFORM 2100-XCTL-TO-SELECTED-PROGRAM            10210007
082500         END-EVALUATE                                             10220007
082600     END-IF.                                                      10230007
082800                                                                  10240007
000100******************************************************************10250000
082900 1701-UPDATE-XLT-UPC.                                             10260007
083000                                                                  10270007
083100     EXEC SQL                                                     10280007
083200         UPDATE XLT_UPC                                           10290007
083300            SET CERTD_IND = 'Y'                                   10300007
083400              , CERTD_DTE = CURRENT DATE                          10310007
083500          WHERE UPC_NBR = :DK-UPC-NUMBER                          10320007
083600     END-EXEC.                                                    10330007
083700                                                                  10340007
083800     EVALUATE TRUE                                                10350007
083900         WHEN SQLCODE = ZERO                                      10360007
084000             CONTINUE                                             10370007
084100                                                                  10380007
084200         WHEN SQLWARN0 NOT = SPACES                               10390007
084300         WHEN SQLCODE < ZERO                                      10400007
084400         WHEN SQLCODE > ZERO                                      10410007
084500             MOVE '1701-UPDATE-XLT-UPC ' TO DP013-PARAGRAPH       10420007
084700             MOVE SU006-UPC-X            TO DP013-MESSAGE-TEXT(1) 10430007
084800             MOVE SQLCA                  TO DP013-SQLCA           10440007
084900             MOVE 'XLT_UPC'              TO                       10450007
084900                                         DP013-DB2-TABLE-NAME(1)  10460007
085000             SET DP013-DB2-ABEND         TO TRUE                  10470007
085100             SET DP013-NO-ROLLBACK       TO TRUE                  10480007
085200             PERFORM 9999-WRITE-CICS-LOG-MSG                      10490007
085300*          MOVE PM-DB2-FATAL-ERROR-MSG   TO SU006-RETURN-MSG      10500007
085400*          SET SU006-RETURN-ERROR        TO TRUE                  10510007
085500                                                                  10520007
085600*          RETURN TO THE PROGRAM THAT CALLED IT                   10530007
085700             MOVE SU006-LAST-PROGRAM     TO  PV-TRANSFER-PROGRAM  10540007
085800             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                10550007
085900     END-EVALUATE.                                                10560005
086100                                                                  10570005
000100******************************************************************10580000
086300*   1710-UPDATE-AUDIT-ROW                                         10590000
086400* THE UPC WAS CERTIFIED, UPDATE THE CERTIFICATION INIDICATOR ON   10600000
086500* TSUAUPC.                                                        10610000
000100******************************************************************10620000
086700 1710-UPDATE-AUDIT-ROW.                                           10630000
086800                                                                  10640000
023456     IF (SU006-QC-AND-RFID-AUD                                    10650020
023456     AND SU006-MANUAL-GENERATED-AUDIT)                            10660020
023456      OR SU006-QC-AUD-ONLY                                        10670020
023456      OR SU006-RFID-AUD-ONLY                                      10680020
023456**  FOR A MANUAL GENERATED AUDIT ONLY 1 ROW EXISTS AND WE WILL USE10690020
023456**  THE AUDIT CONTROL NUMBER FROM THAT                            10700020
023456        MOVE SU006-AUDIT-CNTL-NBR                                 10710020
023456                                TO SUAUPC-AUD-CNTL-NBR            10720020
023456     ELSE                                                         10730020
023456         MOVE SU006-RFID-AUDIT-CNTL-NBR                           10740020
023456                                TO SUAUPC-AUD-CNTL-NBR            10750020
023456     END-IF.                                                      10760020
023456**    MOVE SU006-AUDIT-CNTL-NBR TO SUAUPC-AUD-CNTL-NBR.           10770020
087000      MOVE SU006-SHIP-UNIT-NBR  TO SUAUPC-SHIPT-UNT-ID.           10780000
087100      MOVE SU006-UPC            TO SUAUPC-UPC-NBR.                10790000
087200                                                                  10800000
087300      EXEC SQL                                                    10810000
087400          UPDATE TSUAUPC                                          10820000
087500             SET UPC_CERTD_IND  = :SUAUPC-UPC-CERTD-IND           10830000
087600           WHERE AUD_CNTL_NBR = :SUAUPC-AUD-CNTL-NBR              10840000
087700             AND SHIPT_UNT_ID = :SUAUPC-SHIPT-UNT-ID              10850000
087800             AND UPC_NBR      = :SUAUPC-UPC-NBR                   10860000
087900             AND SCN_TMST     = :SU006-SCN-TMST                   10870000
088000      END-EXEC.                                                   10880000
088100                                                                  10890000
088200      EVALUATE TRUE                                               10900000
088300         WHEN SQLCODE = ZERO                                      10910000
088400              CONTINUE                                            10920000
088400                                                                  10930000
088500         WHEN SQLWARN0 NOT = SPACES                               10940000
088600         WHEN SQLCODE < ZERO                                      10950000
088700         WHEN SQLCODE > ZERO                                      10960000
088800             MOVE '1710-UPDATE-AUDIT-ROW'                         10970000
088900                                         TO DP013-PARAGRAPH       10980000
089000             MOVE 'UPDATE TSUAUPC'       TO DP013-MESSAGE-TEXT(1) 10990000
023456             MOVE SUAUPC-AUD-CNTL-NBR    TO PV-DISP-AUD-CNTL-NBR  11000023
089300             MOVE SU006-SHIP-UNIT-NBR    TO PV-DISP-SHIPT-UNT-ID  11010000
089500             MOVE SU006-UPC              TO PV-DISP-UPC-NBR       11020000
089700             MOVE PV-DISPLAY-KEYS        TO DP013-MESSAGE-TEXT(2) 11030049
089600             MOVE SU006-SCN-TMST         TO PV-DISP-SCN-TMST      11040000
089700             MOVE PV-DISP-SCN-TMST       TO DP013-MESSAGE-TEXT(3) 11050049
089800             MOVE SQLCA                  TO DP013-SQLCA           11060000
089900             MOVE 'TSUAUPC'              TO                       11070000
089900                                         DP013-DB2-TABLE-NAME(1)  11080000
090000             SET DP013-DB2-ABEND         TO TRUE                  11090000
090100             SET DP013-NO-ROLLBACK       TO TRUE                  11100000
090200             PERFORM 9999-WRITE-CICS-LOG-MSG                      11110000
090300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               11120000
090400             PERFORM 8100-SEND-DATA-ONLY                          11130000
090500             PERFORM 8200-RETURN-TRANID                           11140000
090600      END-EVALUATE.                                               11150000
090700                                                                  11160000
000100******************************************************************11170000
071100*   1720-UPDATE-TAGGED-QTY                                        11180000
071200* FOR A SYSTEM GENERATED AUDIT                                    11190031
071300* WHEN THE EPC LOGO INDICATOR IS 'N', SUBTRACT 1 FROM             11200031
071300* RFID TAGGED QTY.                                                11210031
000100******************************************************************11220000
071500 1720-UPDATE-TAGGED-QTY.                                          11230000
071500                                                                  11240022
023456     IF (SU006-QC-AND-RFID-AUD                                    11250022
023456     AND SU006-MANUAL-GENERATED-AUDIT)                            11260022
023456      OR SU006-QC-AUD-ONLY                                        11270022
023456      OR SU006-RFID-AUD-ONLY                                      11280022
023456**  FOR A MANUAL GENERATED AUDIT ONLY 1 ROW EXISTS AND WE WILL USE11290022
023456**  THE AUDIT CONTROL NUMBER FROM THAT                            11300022
023456        MOVE SU006-AUDIT-CNTL-NBR                                 11310022
023456                                TO SUAUPC-AUD-CNTL-NBR            11320022
023456     ELSE                                                         11330022
023456         MOVE SU006-RFID-AUDIT-CNTL-NBR                           11340022
023456                                TO SUAUPC-AUD-CNTL-NBR            11350022
023456     END-IF.                                                      11360022
087000     MOVE SU006-SHIP-UNIT-NBR   TO SUAUPC-SHIPT-UNT-ID.           11370022
087100     MOVE SU006-UPC             TO SUAUPC-UPC-NBR.                11380022
071600                                                                  11390000
072000     EXEC SQL                                                     11400000
072100         UPDATE TSUAUPC                                           11410000
072200            SET RFID_TGD_QTY = RFID_TGD_QTY - 1                   11420031
087600           WHERE AUD_CNTL_NBR  = :SUAUPC-AUD-CNTL-NBR             11430022
087700             AND SHIPT_UNT_ID  = :SUAUPC-SHIPT-UNT-ID             11440022
087800             AND UPC_NBR       = :SUAUPC-UPC-NBR                  11450022
087900             AND SCN_TMST      = :SU006-SCN-TMST                  11460022
087900             AND RFID_TGD_QTY > 0                                 11470031
072500     END-EXEC.                                                    11480000
072600                                                                  11490000
088200     EVALUATE TRUE                                                11500000
088300         WHEN SQLCODE = ZERO                                      11510000
088400              CONTINUE                                            11520000
088400                                                                  11530000
088500         WHEN SQLWARN0 NOT = SPACES                               11540000
088600         WHEN SQLCODE < ZERO                                      11550000
088700         WHEN SQLCODE > ZERO                                      11560000
088800             MOVE '1720-UPDATE-TAGGED-QTY'                        11570000
088900                                         TO DP013-PARAGRAPH       11580000
089000             MOVE 'UPDATE TSUAUPC'       TO DP013-MESSAGE-TEXT(1) 11590000
023456             MOVE SUAUPC-AUD-CNTL-NBR    TO PV-DISP-AUD-CNTL-NBR  11600023
089300             MOVE SU006-SHIP-UNIT-NBR    TO PV-DISP-SHIPT-UNT-ID  11610000
089500             MOVE SU006-UPC              TO PV-DISP-UPC-NBR       11620000
089700             MOVE PV-DISPLAY-KEYS        TO DP013-MESSAGE-TEXT(2) 11630049
089600             MOVE SU006-SCN-TMST         TO PV-DISP-SCN-TMST      11640000
089700             MOVE PV-DISP-SCN-TMST       TO DP013-MESSAGE-TEXT(3) 11650049
089800             MOVE SQLCA                  TO DP013-SQLCA           11660000
089900             MOVE 'TSUAUPC'              TO                       11670000
089900                                         DP013-DB2-TABLE-NAME(1)  11680000
090000             SET DP013-DB2-ABEND         TO TRUE                  11690000
090100             SET DP013-NO-ROLLBACK       TO TRUE                  11700000
090200             PERFORM 9999-WRITE-CICS-LOG-MSG                      11710000
090300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               11720000
090400             PERFORM 8100-SEND-DATA-ONLY                          11730000
090500             PERFORM 8200-RETURN-TRANID                           11740000
090600     END-EVALUATE.                                                11750000
074900                                                                  11760000
000100******************************************************************11770000
091100 2100-XCTL-TO-SELECTED-PROGRAM.                                   11780000
023900                                                                  11790000
091200     SET SU006-INITIALIZE-SCREEN   TO TRUE.                       11800000
091300     MOVE LENGTH OF CA-COMMAREA    TO PV-COMMAREA-LENGTH.         11810000
091400                                                                  11820000
091500     EXEC CICS                                                    11830000
091600         XCTL                                                     11840000
091700             PROGRAM  (PV-TRANSFER-PROGRAM)                       11850000
091800             COMMAREA (CA-COMMAREA)                               11860000
091900             LENGTH   (PV-COMMAREA-LENGTH)                        11870000
092000             RESP     (PV-CICS-RESPONSE)                          11880000
092100     END-EXEC.                                                    11890000
092200                                                                  11900000
092300     EVALUATE TRUE                                                11910000
092400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11920000
092500              CONTINUE                                            11930000
092200                                                                  11940000
092600         WHEN OTHER                                               11950000
092700              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                11960000
092800                                     TO DP013-PARAGRAPH           11970000
092900              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       11980000
093000                                     TO DP013-MESSAGE-TEXT (1)    11990000
093100              MOVE PV-TRANSFER-PROGRAM                            12000000
093200                                     TO DP013-MESSAGE-TEXT (2)    12010000
093300              SET DP013-CICS-ABEND   TO TRUE                      12020000
093400              SET DP013-NO-ROLLBACK  TO TRUE                      12030000
093500              PERFORM 9999-WRITE-CICS-LOG-MSG                     12040000
093600              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     12050000
093700                                     TO AMSGLNO                   12060000
093800              SET SU006-PROCESS-SCREEN TO TRUE                    12070000
093900              PERFORM 8100-SEND-DATA-ONLY                         12080000
094000              PERFORM 8200-RETURN-TRANID                          12090000
094100     END-EVALUATE.                                                12100000
094200                                                                  12110000
000100******************************************************************12120000
094500 4200-XCTL-TO-HELP.                                               12130003
094600                                                                  12140003
094700     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      12150003
094800     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                    12160003
094900     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    12170003
095000                                                                  12180003
095100     EXEC CICS                                                    12190003
095200         XCTL                                                     12200003
095300             PROGRAM  (PV-TRANSFER-PROGRAM)                       12210003
095400             COMMAREA (PC192-COMMAREA)                            12220003
095500             LENGTH   (PV-COMMAREA-LENGTH)                        12230003
095600             RESP     (PV-CICS-RESPONSE)                          12240003
095700     END-EXEC.                                                    12250003
095800                                                                  12260003
095900     EVALUATE TRUE                                                12270003
096000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 12280003
096100              CONTINUE                                            12290003
095800                                                                  12300003
096200         WHEN OTHER                                               12310003
096300             MOVE '4200-XCTL-TO-HELP '   TO DP013-PARAGRAPH       12320003
096500             MOVE 'SUKRF711 - UNABLE TO XCTL TO PROGRAM: '        12330003
096600                                         TO DP013-MESSAGE-TEXT(1) 12340003
096700             MOVE PV-TRANSFER-PROGRAM    TO DP013-MESSAGE-TEXT(2) 12350003
096900             SET DP013-CICS-ABEND        TO TRUE                  12360003
097000             SET DP013-ROLLBACK          TO TRUE                  12370003
097100             PERFORM 9999-WRITE-CICS-LOG-MSG                      12380003
097200             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             12390003
097300             SET SU006-PROCESS-SCREEN    TO TRUE                  12400003
097400             PERFORM 8000-SEND-MAP                                12410003
097500             PERFORM 8200-RETURN-TRANID                           12420003
097600     END-EVALUATE.                                                12430003
097700                                                                  12440000
000100******************************************************************12450000
097800 7300-GET-BLACKOUT.                                               12460008
097900                                                                  12470008
098000     SET PS-BLACKOUT-NO               TO TRUE.                    12480008
098100                                                                  12490008
098200     EXEC SQL                                                     12500008
098300         SELECT 'Y'                                               12510008
098400           INTO :PS-BLACKOUT-SW                                   12520008
098600           FROM WST_INTGRTN_TYP A                                 12530008
098700              , WST_ATTR_DEFN   B                                 12540008
098800              , WST_ATTR_ELEM   C                                 12550008
098900              , WST_ATTR_ELEM   D                                 12560008
099000          WHERE A.INTGRTN_TYP_CDE    = 'TUPCNOUPD'                12570008
099100            AND A.INTGRTN_TYP_CDE    = B.INTGRTN_TYP_CDE          12580008
099200            AND B.ATTR_DEFN_SEQ_NBR  = 1                          12590008
099300            AND B.INTGRTN_TYP_CDE    = C.INTGRTN_TYP_CDE          12600008
099400            AND C.ATTR_DEFN_SEQ_NBR  = 1                          12610008
099500            AND B.INTGRTN_TYP_CDE    = D.INTGRTN_TYP_CDE          12620008
099600            AND D.ATTR_DEFN_SEQ_NBR  = 2                          12630008
099700            AND D.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR        12640008
099800            AND CURRENT TIME        >= TIME(C.ATTR_ELEM_TXT)      12650008
099900            AND CURRENT TIME        <= TIME(D.ATTR_ELEM_TXT)      12660008
100000         WITH UR                                                  12670008
100200     END-EXEC.                                                    12680008
100300                                                                  12690008
100400     EVALUATE TRUE                                                12700008
100500         WHEN SQLCODE = ZERO                                      12710008
100600         WHEN SQLCODE = +100                                      12720008
100700             CONTINUE                                             12730008
100800                                                                  12740008
100900         WHEN SQLWARN0 NOT = SPACES                               12750008
101000         WHEN SQLCODE < ZERO                                      12760008
101100         WHEN SQLCODE > ZERO                                      12770008
101200             MOVE '7300-GET-BLACKOUT'   TO DP013-PARAGRAPH        12780008
101400             MOVE 'SELECT FROM INTEGRATION TBLS'                  12790008
101500                                        TO DP013-MESSAGE-TEXT(1)  12800008
101600             MOVE SQLCA                 TO DP013-SQLCA            12810008
101700             MOVE 'WST_INTGRTN_TYP'     TO DP013-DB2-TABLE-NAME(1)12820008
101800             MOVE 'WST_ATTR_DEFN'       TO DP013-DB2-TABLE-NAME(2)12830008
101900             MOVE 'WST_ATTR_ELEM'       TO DP013-DB2-TABLE-NAME(3)12840008
102000             SET DP013-DB2-ABEND        TO TRUE                   12850008
102100             SET DP013-NO-ROLLBACK      TO TRUE                   12860008
102200             PERFORM 9999-WRITE-CICS-LOG-MSG                      12870008
102300     END-EVALUATE.                                                12880008
102400                                                                  12890008
102500******************************************************************12900000
102600*  8000-SEND-MAP                                                  12910000
102700*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                     12920000
102800******************************************************************12930000
102900 8000-SEND-MAP.                                                   12940000
023900                                                                  12950000
103000     EXEC CICS                                                    12960000
103100         SEND                                                     12970000
103200             MAP    ('SU711A')                                    12980000
103300             MAPSET ('SUKM711')                                   12990000
103400             ERASE                                                13000000
103500             RESP   (PV-CICS-RESPONSE)                            13010000
103600     END-EXEC.                                                    13020000
103700                                                                  13030000
103800     EVALUATE TRUE                                                13040000
103900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13050000
104000             CONTINUE                                             13060000
103700                                                                  13070000
104100         WHEN OTHER                                               13080000
104200             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            13090000
104300             MOVE 'UNABLE TO SEND MAP'                            13100000
104400                                    TO DP013-MESSAGE-TEXT (1)     13110000
104500             SET DP013-CICS-ABEND   TO TRUE                       13120000
104600             SET DP013-NO-ROLLBACK  TO TRUE                       13130000
104700             PERFORM 9999-WRITE-CICS-LOG-MSG                      13140000
104800     END-EVALUATE.                                                13150000
104900                                                                  13160000
000100******************************************************************13170000
105000 8100-SEND-DATA-ONLY.                                             13180000
105100                                                                  13190000
105200     EXEC CICS                                                    13200000
105300         SEND                                                     13210000
105400             MAP      ('SU711A')                                  13220000
105500             MAPSET   ('SUKM711')                                 13230000
105600             CURSOR                                               13240000
105700             DATAONLY                                             13250000
105800             RESP     (PV-CICS-RESPONSE)                          13260000
105900     END-EXEC.                                                    13270000
106000                                                                  13280000
106100     EVALUATE TRUE                                                13290000
106200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13300000
106300             CONTINUE                                             13310000
106000                                                                  13320000
106400         WHEN OTHER                                               13330000
106500             MOVE '8100-SEND-DATA-ONLY'                           13340000
106600                                    TO DP013-PARAGRAPH            13350000
106700             MOVE 'UNABLE TO SEND DATA'                           13360000
106800                                    TO DP013-MESSAGE-TEXT (1)     13370000
106900             SET DP013-CICS-ABEND   TO TRUE                       13380000
107000             SET DP013-NO-ROLLBACK  TO TRUE                       13390000
107100             PERFORM 9999-WRITE-CICS-LOG-MSG                      13400000
107200     END-EVALUATE.                                                13410000
107300                                                                  13420000
000100******************************************************************13430000
107400 8200-RETURN-TRANID.                                              13440000
023900                                                                  13450000
107500     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          13460000
107600                                                                  13470000
107700     EXEC CICS                                                    13480000
107800         RETURN                                                   13490000
107900             TRANSID  (PC-CURRENT-TRANID)                         13500000
108000             COMMAREA (CA-COMMAREA)                               13510000
108100             LENGTH   (PV-COMMAREA-LENGTH)                        13520000
108200             RESP     (PV-CICS-RESPONSE)                          13530000
108300     END-EXEC.                                                    13540000
108400                                                                  13550000
108500     EVALUATE TRUE                                                13560000
108600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13570000
108700             CONTINUE                                             13580000
108400                                                                  13590000
108800         WHEN OTHER                                               13600000
108900             MOVE '8200-RETURN-TRANID'                            13610000
109000                                    TO DP013-PARAGRAPH            13620000
109100             MOVE 'UNABLE TO RETURN TO TRANID'                    13630000
109200                                    TO DP013-MESSAGE-TEXT (1)     13640000
109300             SET DP013-CICS-ABEND   TO TRUE                       13650000
109400             SET DP013-NO-ROLLBACK  TO TRUE                       13660000
109500             PERFORM 9999-WRITE-CICS-LOG-MSG                      13670000
109600     END-EVALUATE.                                                13680000
109700                                                                  13690000
000100******************************************************************13700000
109900 9999-WRITE-CICS-LOG-MSG.                                         13710000
023900                                                                  13720000
110000     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            13730000
110100     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           13740000
110200     INITIALIZE DP013-SRC-TASK-NUMBER                             13750000
110300                DP013-STACK.                                      13760000
110400     SET DP013-LINK-RETURN           TO TRUE.                     13770000
110500                                                                  13780000
110600     EXEC CICS                                                    13790000
110700         LINK                                                     13800000
110800             PROGRAM  (DP013-NAME)                                13810000
110900             COMMAREA (DP013-PARAMETERS)                          13820000
111000             LENGTH   (DP013-LENGTH)                              13830000
111100     END-EXEC.                                                    13840000
111200                                                                  13850000
000100******************************************************************13860000
111400*    ABEND PROCESSOR MODULE                                       13870023
000100******************************************************************13880000
111700     COPY DPPD014.                                                13890008
111800                                                                  13900000
