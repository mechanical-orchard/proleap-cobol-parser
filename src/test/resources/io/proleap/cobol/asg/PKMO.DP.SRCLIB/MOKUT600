      ******************************************************************        
       IDENTIFICATION DIVISION.                                                 
      ******************************************************************        
                                                                                
       PROGRAM-ID.      MOKUT600.                                               
       AUTHOR.          JOHN BOLDT, STRATAGEM.                                  
       INSTALLATION.    KOHLS DEPARTMENT STORES.                                
       DATE-WRITTEN.    MARCH 2006.                                             
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      * THIS PROGRAM WAS CREATED TO RESET THE STATUS CODE FOR EACH              
      * DEPARTMENT TO "PROCESS CONTROL VALUE".  A CONTROL CARD IS USED          
      * TO INDICATE WHETHER ALL SHOULD BE RESET OR ONLY THOSE FOR A             
      * GIVEN PROCESS INSTANCE.                                                 
      * (MOTW_PRC_CNTL)                                                         
      ******************************************************************        
      **  HISTORY LOG:                                                 *        
      ******************************************************************        
      * DATE:         03/24/2006                                       *        
      * WR/IR#:       WR29858                                          *        
      * PROGRAMMER:   JOHN BOLDT, STRATAGEM.                           *        
      * DESCRIPTION:  INITIAL CREATION.                                *        
      *                                                                         
      * DATE:         10/25/2007                                       *        
      * WR/IR#:       WR32984                                          *        
      * PROGRAMMER:   LINDA FRIESS                                              
      * DESCRIPTION:  CHANGE VALID PROCESS INSTANCE TO BE 1 THRU 8.    *        
      *                                                                         
      * DATE:         08/27/2008                                       *        
      * WR/IR#:       INC000000497852                                  *        
      * PROGRAMMER:   DAVE METZGER                                              
      * DESCRIPTION:  CHANGE VALID PROCESS INSTANCE TO BE 1 THRU 12.   *        
      *                                                                *        
      * DATE:         07/30/2018                                       *        
      * WR/IR#:       CHG0204126                                       *        
      * PROGRAMMER:   COGNIZANT                                        *        
      * DESCRIPTION:  ORACLE LOGON STANDARDS PROGRAM CHANGE            *        
      ******************************************************************        
                                                                                
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
      ******************************************************************        
                                                                                
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
                                                                                
           SELECT PROCESS-INSTANCE-FILE                                         
                  ASSIGN                    TO INP01.                           
                                                                                
           SELECT ORACLE-LOGON-FILE                                             
                  ASSIGN                    TO ORALOGON.                        
                                                                                
      ******************************************************************        
       DATA DIVISION.                                                           
      ******************************************************************        
                                                                                
       FILE SECTION.                                                            
      *    PROCESS INSTANCE WILL CONTAIN WHICH PARALLEL JOBFLOW IS              
      *    RUNNING THAT DETERMINES THE DEPARTMENTS TO PROCESS                   
       FD  PROCESS-INSTANCE-FILE                                                
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE OMITTED                                            
           DATA RECORD IS PROCESS-INSTANCE-RECORD.                              
       01  PROCESS-INSTANCE-RECORD         PIC  X(80).                          
                                                                                
       FD  ORACLE-LOGON-FILE                                                    
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 80 CHARACTERS                                        
           DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                              
       01  OL-ORACLE-LOGON-RECORD      PIC X(80).                               
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
      ******************************************************************        
      * PC PROGRAM CONSTANTS                                                    
      ******************************************************************        
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-AUTO-LOGON               PIC X(1)    VALUE '/'.               
           05  PC-PROGRAM-NAME             PIC  X(08)  VALUE                    
                                                       'MOKUT600'.              
                                                                                
      ******************************************************************        
      * PV PROGRAM VARIABLES                                                    
      ******************************************************************        
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-ORACLE-USERID-LEN        PIC S9(4)   VALUE ZEROS              
                                                       COMP SYNC.               
           05  PV-ORACLE-PASSWORD-LEN      PIC S9(4)   VALUE ZEROS              
                                                       COMP SYNC.               
           05  PV-TABLE-NAME               PIC  X(30)  VALUE SPACES.            
           05  PV-SQL-CODE                 PIC  9(09)  VALUE 0.                 
           05  PV-PARAGRAPH-NAME           PIC  X(40)  VALUE SPACES.            
           05  PV-OPERATION-MSG            PIC  X(60)  VALUE SPACES.            
           05  PV-OPERATION-MSG-1          PIC  X(40)  VALUE SPACES.            
           05  PV-OPERATION-MSG-2          PIC  X(40)  VALUE SPACES.            
                                                                                
      ******************************************************************        
      * CC- CONTROL CARDS INPUT                                                 
      ******************************************************************        
       01  CC-PROCESS-INSTANCE-REC.                                             
           05  CC-PROCESS-INSTANCE         PIC  9(02)  VALUE 0.                 
           05  FILLER                      PIC  X(78)  VALUE SPACES.            
                                                                                
      ******************************************************************        
      * PS PROGRAM SWITCHES                                            *        
      ******************************************************************        
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-END-OF-LOGON-FILE-SW     PIC X(01)   VALUE 'N'.               
               88  PS-END-OF-LOGON-FILE                VALUE 'Y'.               
           05  PS-END-OF-PROC-INST-FILE-SW PIC X(01)   VALUE 'N'.               
               88  PS-END-OF-PROC-INST-FILE            VALUE 'Y'.               
               88  PS-NOT-END-OF-PROC-INST-FILE        VALUE 'N'.               
           05  PS-PROCESS-INSTANCE-SW      PIC 9(02)   VALUE 0.                 
               88  PS-PROCESS-INSTANCE-VALID           VALUE 1 THRU 12.         
           05  PS-RESET-ALL-SW             PIC X(01)   VALUE 'N'.               
               88  PS-RESET-ALL                        VALUE 'Y'.               
               88  PS-NOT-RESET-ALL                    VALUE 'N'.               
           05  PS-ORA-SRC-CTL-DONE-SW  PIC  X(01)      VALUE 'N'.               
               88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.               
                                                                                
       01  CC-ORACLE-CONNECTION.                                                
           05  CC-ORACLE-USERID             PIC X(40).                          
               88 CC-AUTO-LOGON                         VALUE '/'.              
           05  CC-ORACLE-PASSWORD           PIC X(40).                          
                                                                                
      ******************************************************************        
      * AC ABEND CODES                                                 *        
      ******************************************************************        
                                                                                
       01  ABEND-CODE                      PIC S9(04)  VALUE +0  COMP.          
           88  ABEND-4001-WRITE-ERROR                  VALUE +4001.             
           88  ABEND-4002-READ-ERROR                   VALUE +4002.             
           88  ABEND-4003-CTRL-CARD-ERROR              VALUE +4003.             
           88  ABEND-4004-TABLE-ERROR                  VALUE +4004.             
           88  ABEND-4005-OPEN-ERROR                   VALUE +4005.             
           88  ABEND-4006-CLOSE-ERROR                  VALUE +4006.             
           88  ABEND-4007-SEQUENCE-ERROR               VALUE +4007.             
           88  ABEND-4008-DATA-ERROR                   VALUE +4008.             
           88  ABEND-4009-KEY-DATA-ERROR               VALUE +4009.             
           88  ABEND-4013-DB2-ERROR                    VALUE +4013.             
           88  ABEND-4014-ORACLE-LOGON-ERROR           VALUE +4014.             
           88  ABEND-4019-DATE-ROUTINE-ERROR           VALUE +4019.             
           88  ABEND-4444-FORCED-ABEND                 VALUE +4444.             
                                                                                
      *----------------------------------------------------------               
      *                      O  R  A  C  L  E                                   
      *==========================================================               
      *                                                                         
      * ORACLE DECLARE SECTION                                                  
      * ORACLE USED AND RETURNED VARIABLES                                      
      *                                                                         
      *----------------------------------------------------------               
      *    COPY MOWS700.                                                        
                                                                                
           EXEC SQL BEGIN DECLARE SECTION END-EXEC.                             
                                                                                
      *----------------------------------------------------------               
      * ORACLE LOGON WORKING STORAGE COPYBOOK                                   
      *----------------------------------------------------------               
                                                                                
       01  PC-ENT01-TYPE-CDE               PIC  X(02)  VALUE '01'.              
       01  PV-ORACLE-ID                    PIC  X(01)  VALUE '/'.               
                                                                                
       01  USERNAME                        PIC  X(10)  VARYING.                 
       01  PASSWD                          PIC  X(10)  VARYING.                 
                                                                                
       01  ORACLE-RETURN                   PIC  X(200) VALUE SPACES.            
                                                                                
           EXEC SQL END DECLARE SECTION END-EXEC.                               
           EXEC SQL INCLUDE SQLCACOB    END-EXEC.                               
                                                                                
       EJECT                                                                    
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
      ******************************************************************        
      * MAIN PROCESSING                                                         
      ******************************************************************        
       A100-PROGRAM-MAINLINE.                                                   
                                                                                
           PERFORM B100-INITIALIZE.                                             
                                                                                
           PERFORM C100-CONTROL.                                                
                                                                                
           PERFORM B900-EOJ-ROUTINE.                                            
                                                                                
           GOBACK.                                                              
                                                                                
      ******************************************************************        
      * OPEN FILES                                                              
      ******************************************************************        
       B100-INITIALIZE.                                                         
                                                                                
           OPEN INPUT ORACLE-LOGON-FILE.                                        
                                                                                
           PERFORM 7000-READ-ORACLE-LOGON.                                      
                                                                                
           CLOSE ORACLE-LOGON-FILE.                                             
                                                                                
           IF ((PS-END-OF-LOGON-FILE)                                           
                   OR (CC-ORACLE-CONNECTION = SPACES))                          
               DISPLAY '** ABEND **'                                            
               DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '          
                         'NOT PROVIDED'                                         
               SET PS-ORA-SRC-EMPTY TO TRUE                                     
               CALL 'ILBOABN0' USING ABEND-CODE                                 
           END-IF.                                                              
                                                                                
           IF CC-AUTO-LOGON                                                     
               DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'                
               EXEC SQL                                                         
                    CONNECT :USERNAME                                           
               END-EXEC                                                         
           ELSE                                                                 
               INITIALIZE PV-ORACLE-USERID-LEN                                  
                          PV-ORACLE-PASSWORD-LEN                                
               INSPECT CC-ORACLE-USERID                                         
                   TALLYING PV-ORACLE-USERID-LEN                                
                FOR CHARACTERS BEFORE INITIAL SPACE                             
            INSPECT CC-ORACLE-PASSWORD                                          
                TALLYING PV-ORACLE-PASSWORD-LEN                                 
                FOR CHARACTERS BEFORE INITIAL SPACE                             
            MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO                   
                      USERNAME-ARR                                              
            MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                           
            MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO               
                      PASSWD-ARR                                                
            MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                           
            DISPLAY PC-PROGRAM-NAME ' - LOGON TO ORACLE AS USER '               
                      USERNAME-ARR                                              
            EXEC SQL                                                            
              CONNECT :USERNAME IDENTIFIED BY :PASSWD                           
            END-EXEC                                                            
            INITIALIZE CC-ORACLE-PASSWORD                                       
                       PASSWD                                                   
            END-IF.                                                             
                                                                                
020500     IF (SQLCODE NOT = 0)                                                 
020900         DISPLAY PV-PARAGRAPH-NAME                                        
020910         DISPLAY PC-PROGRAM-NAME ' - ERROR LOGGING ON TO ORACLE'          
021000         PERFORM 9900-ORACLE-ABEND                                        
021200     END-IF.                                                              
                                                                                
           OPEN INPUT PROCESS-INSTANCE-FILE                                     
                                                                                
           PERFORM B300-READ-PROC-INST-FILE.                                    
                                                                                
      ******************************************************************        
      * READS THE PROCESS INSTANCE THAT ACQUIRES THE DEPTS NEEDED.              
      ******************************************************************        
       B300-READ-PROC-INST-FILE.                                                
                                                                                
           READ PROCESS-INSTANCE-FILE INTO CC-PROCESS-INSTANCE-REC              
                AT END SET PS-END-OF-PROC-INST-FILE TO TRUE.                    
                                                                                
           IF PS-NOT-END-OF-PROC-INST-FILE                                      
              DISPLAY 'PROC INST ' CC-PROCESS-INSTANCE                          
              MOVE CC-PROCESS-INSTANCE TO PS-PROCESS-INSTANCE-SW                
              IF PS-PROCESS-INSTANCE-VALID                                      
                  NEXT SENTENCE                                                 
              ELSE                                                              
                 MOVE 4003                       TO ABEND-CODE                  
                 MOVE 'B300-READ-PROC-INST-FILE' TO PV-PARAGRAPH-NAME           
                 MOVE 'INVALID PROCESS INSTANCE' TO PV-OPERATION-MSG            
                 PERFORM 9999-APPLICATION-ABEND                                 
               END-IF                                                           
           ELSE                                                                 
               SET PS-RESET-ALL TO TRUE                                         
           END-IF.                                                              
                                                                                
                                                                                
      *--------------------------------------------------------------           
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION THAT              
      * LOGS ON TO ORACLE.                                                      
      *---------------------------------------------------------------          
      *    COPY MOPD700.                                                        
                                                                                
      ******************************************************************        
      * NEEDS TO BE IN FOR NOW TIL KURT FIXES CURSOR SHARING BUG                
      * OTHERWISE I GET A ORA-3113 ERROR                                        
      ******************************************************************        
           EXEC SQL                                                             
            ALTER SESSION                                                       
                  SET CURSOR_SHARING = 'EXACT'                                  
            ALTER SESSION                                                       
                  SET OPTIMIZER_INDEX_COST_ADJ =  5                             
           END-EXEC.                                                            
                                                                                
                                                                                
      ******************************************************************        
      * CLEAN UP                                                                
      ******************************************************************        
       B900-EOJ-ROUTINE.                                                        
                                                                                
           CLOSE PROCESS-INSTANCE-FILE.                                         
                                                                                
                                                                                
      ******************************************************************        
      * CONTROL PROCESSING - RESET THE STATUS CODE FOR EACH DEPARTMENT          
      ******************************************************************        
       C100-CONTROL.                                                            
                                                                                
           EXEC SQL EXECUTE                                                     
            BEGIN                                                               
             K_MO01.K_MOPG_SAS_UTILITIES.K_MOSP_CNTL_DEPT_RESET_STATUS(         
             :PS-PROCESS-INSTANCE-SW,                                           
             :PS-RESET-ALL-SW                                                   
             );                                                                 
            END;                                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROES                                              
                 CONTINUE                                                       
             WHEN OTHER                                                         
                 MOVE SQLCODE          TO PV-SQL-CODE                           
                 MOVE 'MOTW_PRC_CNTL ' TO PV-TABLE-NAME                         
                 MOVE 'C100-CONTROL '  TO PV-PARAGRAPH-NAME                     
                 PERFORM 9900-ORACLE-ABEND                                      
           END-EVALUATE.                                                        
                                                                                
034503****************************************************************          
034504** READ THE ORACLE LOGON CONTROL CARD.                        **          
034505****************************************************************          
034506 7000-READ-ORACLE-LOGON.                                                  
                                                                                
034510     READ ORACLE-LOGON-FILE                                               
034520         INTO CC-ORACLE-CONNECTION                                        
034530         AT END                                                           
034540             SET PS-END-OF-LOGON-FILE TO TRUE                             
034550     END-READ.                                                            
034600*                                                                         
                                                                                
      *----------------------------------------------------------               
      * 9900-ORACLE-ABEND.                                                      
      *     PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE.                    
      *----------------------------------------------------------               
       9900-ORACLE-ABEND.                                                       
                                                                                
           DISPLAY '                       '.                                   
           DISPLAY '** ABEND **       ** = SQLERROR'.                           
           DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.                   
           DISPLAY '** SQLCODE        ** = ' PV-SQL-CODE.                       
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                        
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                           
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                          
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                        
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.                 
           DISPLAY '** TABLE          ** = ' PV-TABLE-NAME.                     
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG.                  
           DISPLAY '                       '.                                   
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
                                                                                
      *----------------------------------------------------------               
      * 9999-APPLICATION-ABEND.                                                 
      *     PERFORM AN ABEND IF AN ERROR IS DETECTED.                           
      *----------------------------------------------------------               
       9999-APPLICATION-ABEND.                                                  
                                                                                
           DISPLAY '                       '.                                   
           DISPLAY '** ABEND **       ** = '.                                   
           DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.                   
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                        
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.                 
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG.                  
           DISPLAY '                       '.                                   
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
                                                                                
