000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT374.                                        00020000
000300 AUTHOR.         BARB SCHULTZ.                                    00030000
000400 DATE-WRITTEN.   OCTOBER 2020.                                    00040000
000500 DATE-COMPILED.                                                   00050000
000600***************************************************************** 00060000
000700*  HALLMARK ADJUSTMENT PROGRAM                                  * 00070000
000800*                                                               * 00080000
000900*  THIS PROGRAM WILL READ THE EDITED HALLMARK FILE COMING FROM  * 00090016
001000*  APKUT373.  THESE INVOICES WILL BE SUMMED BY SUBCLASS IN SORT * 00100017
001010*  APSR350 AND THEN READ INTO THIS PROGRAM TO GATHER MORE DATA. * 00110017
001020*  THESE RECORDS WILL THEN BE WRITTEN OUT.                      * 00120017
001030*                                                               * 00130017
001040* INPUT:                                                        * 00140017
001050*  1. HALLMARK-IN-FILE                            (APRD045)     * 00150017
001060*                                                               * 00160017
001070* OUTPUT:                                                       * 00170017
001080*  1. ADJ-JOURNAL-FILE                            (APRD045)     * 00180017
001090*                                                               * 00190017
001100***************************************************************** 00200017
001200* CHANGE LOG:                                                   * 00210017
001300*                                                               * 00220017
001400* 09/15/2021                                                    * 00230028
001500*    CHANGE MADE: CHANGED TO ALWAYS MOVE THE CURRENT DATE TO    * 00240028
001500*       THE DUE DATE.  IT WAS MOVING THE PAYMENT DUE DATE THAT  * 00241028
001500*       HALLMARK SENT US.                                       * 00242028
001600*                                                               * 00250017
001700* MADE BY: BARB SCHULTZ                        CHG0261266       * 00260029
001300*                                                               * 00260138
001400* 10/18/2021                                                    * 00261038
001500*    CHANGE MADE: CHANGED THE PROGRAM TO POST TO THE FISCAL     * 00262038
001500*    MONTH WHERE THE SALES OCCURRED. ADDED PREV_PSTG FIELDS AND * 00263038
001500*    THE MULT_PSTG_PER_IND TO THE SELECT. ALSO ADDED A FEW MORE * 00264038
001600*    DISPLAYS TO THE PROGRAM.                                   * 00265038
001600*                                                               * 00265338
001700* MADE BY: BARB SCHULTZ                        CHG0262863       * 00266039
001600*                                                               * 00266147
001400* 08/29/2023                                                    * 00267047
001500*    CHANGE MADE: DURING CLOSE WEEK, POST THE FILE TO THE       * 00268047
001500*    PREVIOUS MONTH IF SUN-TUE AND THE CURRENT MONTH IF         * 00269048
001500*    WED-SAT.                                                   * 00269147
001700* MADE BY: JEAN KURK                           CHG0292311       * 00269447
001800***************************************************************** 00270017
001900                                                                  00280017
002000 ENVIRONMENT DIVISION.                                            00290017
002100 CONFIGURATION SECTION.                                           00300017
002200 SOURCE-COMPUTER.    IBM-3090.                                    00310017
002300 OBJECT-COMPUTER.    IBM-3090.                                    00320017
002400                                                                  00330017
002500 INPUT-OUTPUT SECTION.                                            00340017
002600 FILE-CONTROL.                                                    00350017
002700     SELECT HALLMARK-IN-FILE  ASSIGN TO UT-S-INP01.               00360017
002800     SELECT ADJ-JOURNAL-FILE  ASSIGN TO UT-S-OUT01.               00370017
003000                                                                  00380017
003100 DATA DIVISION.                                                   00390017
003200 FILE SECTION.                                                    00400017
003300                                                                  00410017
003400 FD  HALLMARK-IN-FILE                                             00420017
003500     RECORDING MODE IS F                                          00430017
003600     LABEL RECORDS ARE STANDARD                                   00440017
003700     BLOCK CONTAINS 0 RECORDS                                     00450017
003800     DATA RECORD IS HALLMARK-IN-REC.                              00460017
003900 01  HALLMARK-IN-REC.                                             00470017
004000     05  FILLER                       PIC  X(500).                00480017
004100                                                                  00490017
004200 FD  ADJ-JOURNAL-FILE                                             00500017
004300     RECORDING MODE IS F                                          00510017
004400     LABEL RECORDS ARE STANDARD                                   00520017
004500     BLOCK CONTAINS 0 RECORDS                                     00530017
004600     DATA RECORD IS ADJ-JOURNAL-REC.                              00540017
004700 01  ADJ-JOURNAL-REC.                                             00550017
004800     05  FILLER                       PIC  X(500).                00560017
004900                                                                  00570017
005800 WORKING-STORAGE SECTION.                                         00580017
005900                                                                  00590017
006000 01  PV-SWITCHES.                                                 00600017
006100     05  END-OF-INPUT-FILE       PIC X(1)  VALUE 'N'.             00610017
006200         88  END-OF-INPUT                  VALUE 'Y'.             00620017
006300         88  NOT-END-OF-INPUT              VALUE 'N'.             00630017
009517                                                                  00640000
009540 01  PV-INVOICE-COUNTERS.                                         00650004
009560     05  PV-REJECT-REC-CNT           PIC 9(4)      VALUE ZEROS.   00660004
009910                                                                  00670000
009920 01  PV-ABEND-FIELDS.                                             00680004
009921     05  PV-ABEND-PROGRAM            PIC X(8)  VALUE 'APKUT374'.  00690004
009922     05  PV-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      00700004
009923     05  PV-ABEND-OPERATION          PIC X(50) VALUE SPACES.      00710004
009924     05  PV-ABEND-STRUCTURE-1        PIC X(8)  VALUE SPACES.      00720004
009925     05  PV-ABEND-STRUCTURE-2        PIC X(8)  VALUE SPACES.      00730004
009926     05  PV-ABEND-STATUS             PIC XX    VALUE SPACES.      00740004
009927                                                                  00750000
009928 01  ABEND-CODE                      PIC S9(4) COMP SYNC          00760000
009929                                               VALUE ZEROS.       00770000
009930     88 AP-TABLE-FULL                          VALUE +4004.       00780000
009940     88 AP-EMPTY-FILE                          VALUE +4005.       00790000
009950     88 AP-DB2-ERROR                           VALUE +4013.       00800000
067800     88 AP-DATE-ERROR                          VALUE +4019.       00801041
009960                                                                  00810000
009961 01  PV-WORKING-STORAGE.                                          00820004
009962     05  PV-TOT-INPUT-REC-CNT        PIC 9(9)  VALUE ZEROS.       00830024
009962     05  PV-TOT-OUTPUT-REC-CNT       PIC 9(9)  VALUE ZEROS.       00840024
009962     05  PV-CURRENT-DATE             PIC X(10) VALUE SPACES.      00850024
009963     05  PV-CURRENT-TIMESTAMP        PIC X(26) VALUE SPACES.      00860024
012600     05  TRCD-0S-PSTG-TYP-CDE        PIC X(2).                    00870019
012700     05  TRCD-0S-TRN-TYP-CDE         PIC X(3).                    00880019
012800     05  TRCD-0T-PSTG-TYP-CDE        PIC X(2).                    00890019
012900     05  TRCD-0T-TRN-TYP-CDE         PIC X(3).                    00900019
014200                                                                  00910000
014300 01  PV-PROGRAM-COUNTERS.                                         00920004
014400     05  PV-INPUT-REC-CNT          PIC 9(9)  VALUE ZEROES.        00930004
014500     05  PV-TOT-INVC-LINES         PIC 9(8)  VALUE ZEROS.         00940004
014700                                                                  00950000
016300                                                                  00960000
020000*--------------------------------------------------------------** 00970000
020100* AP WORK INPUT AREA                                           ** 00980002
020200*--------------------------------------------------------------** 00990000
020300 01  FILLER                      PIC X(35)  VALUE                 01000000
020400     'BEGINNING OF AP INPUT FILE **'.                             01010002
020500     COPY APRD045 REPLACING 'AP045-' BY 'PV045-'.                 01020017
020730                                                                  01030000
022400*--------------------------------------------------------------*  01040000
022500* ADJUSTMENT JOURNAL TRANSACTION FILE - OUTPUT FILE               01050002
022600*--------------------------------------------------------------*  01060000
022700     COPY APRD045.                                                01070000
022800                                                                  01080000
022900*--------------------------------------------------------------*  01090000
023000* SQLCA FORMATTED MESSAGE AREA                                 *  01100000
023100*--------------------------------------------------------------*  01110000
023200     COPY DPWS004.                                                01120000
023300                                                                  01130000
023400*----------------------------------------------------------------*01140000
023500*    ABEND PROCESSING COPYBOOK.                                  *01150000
023600*----------------------------------------------------------------*01160000
023700     COPY DPWS013.                                                01170000
023800                                                                  01180000
057000*--------------------------------------------------------------*  01181041
057100* WORKING STORAGE FOR CALENDAR ROUTINE                         *  01182041
057200*--------------------------------------------------------------*  01183041
057300     COPY DPWS500.                                                01184041
057500                                                                  01186041
023900*--------------------------------------------------------------*  01190000
024000* COMMUNICATIONS AREA2 FOR DB2                                 *  01200000
024100*--------------------------------------------------------------*  01210000
024200     COPY SQLCA2.                                                 01220000
024300                                                                  01230000
024400     EXEC SQL                                                     01240000
024500          INCLUDE SQLCA                                           01250000
024600     END-EXEC.                                                    01260000
024700                                                                  01270000
026110*--------------------------------------------------------------*  01280003
026120* TRANSACTION CODE TABLE                                       *  01290003
026130*--------------------------------------------------------------*  01300003
026140     EXEC SQL                                                     01310003
026150          INCLUDE TTRNCDE                                         01320003
026160     END-EXEC.                                                    01330003
026161*--------------------------------------------------------------*  01340003
026162* TAPCNTL TABLE                                                *  01350003
026163*--------------------------------------------------------------*  01360003
026164     EXEC SQL                                                     01370003
026165          INCLUDE TAPCNTL                                         01380003
026166     END-EXEC.                                                    01390003
026170                                                                  01400003
033400 PROCEDURE DIVISION.                                              01410000
033500 A100-MAIN.                                                       01420000
033600                                                                  01430000
033700     PERFORM B100-INITIALIZE.                                     01440000
033800                                                                  01450000
033900     PERFORM B200-PROCESS                                         01460000
034000         UNTIL END-OF-INPUT.                                      01470007
034100                                                                  01480000
034100     DISPLAY '**** RECORDS PROCESSED **** '.                      01490037
034100     DISPLAY 'TOTAL INPUT COUNT  ' PV-TOT-INPUT-REC-CNT.          01491037
034100     DISPLAY 'TOTAL OUTPUT COUNT ' PV-TOT-OUTPUT-REC-CNT.         01500024
034100                                                                  01510024
034200     CLOSE HALLMARK-IN-FILE                                       01520000
034300           ADJ-JOURNAL-FILE.                                      01530002
034500                                                                  01540000
034600     GOBACK.                                                      01550000
034700                                                                  01560000
034800*----------------------------------------------------------------*01570000
034900*    INITIALIZATION PROCESSING                                   *01580000
035000*----------------------------------------------------------------*01590000
035100 B100-INITIALIZE.                                                 01600000
035200                                                                  01610000
035300     OPEN INPUT  HALLMARK-IN-FILE                                 01620000
035400          OUTPUT ADJ-JOURNAL-FILE.                                01630002
035600                                                                  01640000
035700     INITIALIZE AP045-TRANSACTION-FILE.                           01650015
035800     PERFORM R300-SELECT-TAPCNTL.                                 01660019
           DISPLAY '******** POSTING PERIOD INDICATOR ********'.        01661034
           DISPLAY 'APCNTL-MULT-PSTG-PER-IND '                          01662033
                    APCNTL-MULT-PSTG-PER-IND.                           01663033
036100                                                                  01664034
035800     PERFORM R350-GET-DOW.                                        01665049
035800     IF APCNTL-MULT-PSTG-PER-IND = 'Y'                            01666051
035800     AND (DPG55-ALPHA-WEEK-DAY-ABBR3-WED                          01666151
035800       OR DPG55-ALPHA-WEEK-DAY-ABBR3-THU                          01667051
035800       OR DPG55-ALPHA-WEEK-DAY-ABBR3-FRI                          01668051
035800       OR DPG55-ALPHA-WEEK-DAY-ABBR3-SAT)                         01669051
035800         MOVE 'N' TO APCNTL-MULT-PSTG-PER-IND                     01670049
               DISPLAY                                                  01670149
                '** POSTING PERIOD IND OF N USED FOR THIS RUN, '        01670249
               DISPLAY                                                  01670350
                '** DUE TO LATE IN THE WEEK '                           01670449
035800     END-IF.                                                      01670549
036100                                                                  01670649
036100     DISPLAY '************** POSTING DATES ***************'       01671035
036100     DISPLAY 'CURR-PSTG-FYR-NBR = ' APCNTL-CURR-PSTG-FYR-NBR.     01673034
036100     DISPLAY 'CURR-PSTG-FMN-NBR = ' APCNTL-CURR-PSTG-FMN-NBR.     01674034
036100     DISPLAY 'CURR-PSTG-FWK-NBR = ' APCNTL-CURR-PSTG-FWK-NBR.     01675034
036100                                                                  01676034
036100     DISPLAY 'PREV-PSTG-FYR-NBR = ' APCNTL-PREV-PSTG-FYR-NBR.     01677034
036100     DISPLAY 'PREV-PSTG-FMN-NBR = ' APCNTL-PREV-PSTG-FMN-NBR.     01678034
036100     DISPLAY 'PREV-PSTG-FWK-NBR = ' APCNTL-PREV-PSTG-FWK-NBR.     01679034
           IF APCNTL-MULT-PSTG-PER-IND = 'Y'                            01679237
              DISPLAY 'PREVIOUS POSTING PERIOD WILL BE USED'            01679337
           ELSE                                                         01679440
              DISPLAY 'CURRENT POSTING PERIOD WILL BE USED'             01679540
           END-IF.                                                      01679637
036100                                                                  01679734
036110     MOVE '0S' TO TRNCDE-AP-TRN-CDE.                              01680019
036200     PERFORM R200-SELECT-TTRNCDE.                                 01690019
036300     MOVE TRNCDE-PSTG-TYP-CDE      TO TRCD-0S-PSTG-TYP-CDE.       01700019
036400     MOVE TRNCDE-TRN-TYP-CDE       TO TRCD-0S-TRN-TYP-CDE.        01710019
036410                                                                  01740019
036420     MOVE '0T' TO TRNCDE-AP-TRN-CDE.                              01750019
036430     PERFORM R200-SELECT-TTRNCDE.                                 01760019
036440     MOVE TRNCDE-PSTG-TYP-CDE      TO TRCD-0T-PSTG-TYP-CDE.       01770019
036450     MOVE TRNCDE-TRN-TYP-CDE       TO TRCD-0T-TRN-TYP-CDE.        01780019
036500                                                                  01810019
038000     PERFORM R100-READ-INPUT.                                     01820000
038100                                                                  01830000
038200*----------------------------------------------------------------*01840000
038300*    REFORMAT EACH INPUT RECORD TO THE OUTPUT TEXT FORMAT.       *01850000
038310*    AP-TRN-CDE - '0T' WHEN COST < 0 ELSE USE '0S'         *      01860019
038400*----------------------------------------------------------------*01870000
038500 B200-PROCESS.                                                    01880000
038600                                                                  01890000
039340     MOVE PV045-VND-NBR            TO AP045-VND-NBR.              01900017
039360     MOVE PV045-DOC-DTE            TO AP045-DOC-DTE.              01910017
039370                                                                  01920019
039380     IF PV045-GRO-COST-AMT < 0                                    01930019
039390        MOVE '0T' TO AP045-AP-TRN-CDE                             01940019
039350        STRING PV045-DOC-NBR DELIMITED BY SPACE                   01950025
039350               'R'           DELIMITED BY SPACE                   01960025
039350          INTO AP045-DOC-NBR                                      01970025
039350        END-STRING                                                01980025
039391        MOVE TRCD-0T-PSTG-TYP-CDE  TO AP045-PSTG-TYP-CDE          01990019
039392        MOVE TRCD-0T-TRN-TYP-CDE   TO AP045-TRN-TYP-CDE           02000019
039393     ELSE                                                         02010012
039394        MOVE '0S' TO AP045-AP-TRN-CDE                             02020019
039350        MOVE PV045-DOC-NBR         TO AP045-DOC-NBR               02030025
039395        MOVE TRCD-0S-PSTG-TYP-CDE  TO AP045-PSTG-TYP-CDE          02040019
039396        MOVE TRCD-0S-TRN-TYP-CDE   TO AP045-TRN-TYP-CDE           02050019
039397     END-IF.                                                      02060012
039398                                                                  02070019
039399     MOVE PV045-RECD-TYP-CDE       TO AP045-RECD-TYP-CDE.         02080017
039401     MOVE PV045-PO-NBR             TO AP045-PO-NBR.               02090017
039402     MOVE PV045-DEPT-NBR           TO AP045-DEPT-NBR.             02100017
039403     MOVE PV045-GL-ACCT-NBR        TO AP045-GL-ACCT-NBR.          02110017
039404                                                                  02120019
039418     MOVE PV-CURRENT-TIMESTAMP     TO AP045-ENTR-TMST.            02130004
039419     MOVE 'APKUT374'               TO AP045-ENTR-ID.              02140003
039420     MOVE 'A'                      TO AP045-ORGN-CDE.             02150009
039426     MOVE PV-CURRENT-DATE          TO AP045-INV-CUTOFF-DTE.       02160004
039434     MOVE SPACES                   TO AP045-BAR-CDE.              02170003
039436     MOVE PV045-ENTR-DTE           TO AP045-PS-BTCH-DTE.          02180017
039437     MOVE TRNCDE-BTCH-SRC-CDE      TO AP045-PS-BTCH-SRC-CDE.      02190012
039439     MOVE '00'                     TO AP045-PS-BTCH-SEQ-NBR.      02200004
039443     MOVE PV045-ENT-ID             TO AP045-ENT-ID.               02210017
039444                                                                  02220004
039445     MOVE PV045-ENT-NME-DESC       TO AP045-ENT-NME-DESC.         02230017
039446     MOVE PV045-RSN-TXT            TO AP045-RSN-TXT.              02240017
039451                                                                  02250005
           IF APCNTL-MULT-PSTG-PER-IND = 'Y'                            02251030
039453        MOVE APCNTL-PREV-PSTG-FYR-NBR TO AP045-PSTG-FYR-NBR       02252030
039455        MOVE APCNTL-PREV-PSTG-FMN-NBR TO AP045-PSTG-FMN-NBR       02253030
039457        MOVE APCNTL-PREV-PSTG-FWK-NBR TO AP045-PSTG-FWK-NBR       02254030
           ELSE                                                         02255030
039453        MOVE APCNTL-CURR-PSTG-FYR-NBR TO AP045-PSTG-FYR-NBR       02260030
039455        MOVE APCNTL-CURR-PSTG-FMN-NBR TO AP045-PSTG-FMN-NBR       02270030
039457        MOVE APCNTL-CURR-PSTG-FWK-NBR TO AP045-PSTG-FWK-NBR       02280030
           END-IF.                                                      02281030
039459                                                                  02290005
039481     MOVE PV045-STR-NBR            TO AP045-STR-NBR.              02300017
039482     MOVE PV045-CL-NBR             TO AP045-CL-NBR.               02310017
039484     MOVE PV045-GRO-COST-AMT       TO AP045-GRO-COST-AMT.         02320017
039485     MOVE PV045-NET-COST-AMT       TO AP045-NET-COST-AMT.         02330019
039487                                                                  02340019
039511     MOVE PV-CURRENT-DATE         TO AP045-PYMT-DUE-DTE.          02380028
039515                                                                  02420019
039518     MOVE PV045-AUTH-NBR          TO AP045-AUTH-NBR.              02430017
039519     MOVE PV045-AUTO-OTP-PSTG-IND TO AP045-AUTO-OTP-PSTG-IND.     02440017
039520     MOVE TRNCDE-AP-PSTG-IND      TO AP045-AP-PSTG-IND.           02450007
039525     MOVE PV045-DOC-HLD-CDE       TO AP045-DOC-HLD-CDE.           02460017
039530                                                                  02470003
039540     IF AP045-PSTG-TYP-CDE = 'CR'                                 02480022
039541     AND PV045-RETL-AMT > 0                                       02490022
039550        MULTIPLY PV045-RETL-AMT BY -1 GIVING AP045-RETL-AMT       02500022
039551     ELSE                                                         02510022
039552        MOVE PV045-RETL-AMT       TO AP045-RETL-AMT               02520022
039560     END-IF.                                                      02530019
039570                                                                  02540019
039580     MOVE ZERO                     TO AP045-MOS-DISC-PCT          02550019
039590                                      AP045-ADV-DISC-PCT          02560019
039591                                      AP045-TERM-DISC-PCT         02570019
039592                                      AP045-NW-STR-DISC-PCT       02580019
039593                                      AP045-TRD-DISC-PCT          02590019
039600                                      AP045-FRGT-AMT              02600019
039700                                      AP045-MISC-CHRG-AMT         02610019
039800                                      AP045-DTL-TERM-DISC-AMT     02620019
039900                                      AP045-DTL-NW-STR-DISC-AMT   02630019
040000                                      AP045-DTL-TRD-DISC-AMT      02640019
040100                                      AP045-DTL-MOS-DISC-AMT      02650019
040200                                      AP045-SKU-NBR               02660019
040300                                      AP045-SALES-TAX-AMT.        02670019
040400                                                                  02680019
043400     PERFORM W100-WRITE-OUTPUT.                                   02690000
043500                                                                  02700000
043600     PERFORM R100-READ-INPUT.                                     02710000
043700                                                                  02720000
114970*----------------------------------------------------------------*02730000
114980*    READ THE HALLMARK FILE FROM PGM APKUT373                    *02740007
114990*----------------------------------------------------------------*02750000
115000 R100-READ-INPUT.                                                 02760000
115100                                                                  02770000
115200     READ HALLMARK-IN-FILE INTO PV045-TRANSACTION-FILE            02780017
115300         AT END SET END-OF-INPUT TO TRUE.                         02790002
115400                                                                  02800000
115500     IF NOT END-OF-INPUT                                          02810002
115600         ADD 1 TO PV-TOT-INPUT-REC-CNT                            02820024
115700         ADD 1 TO PV-TOT-INVC-LINES                               02830004
115800     END-IF.                                                      02840000
115900                                                                  02850000
116100*--------------------------------------------------------------*  02860004
116200* SELECT PSTG-TYP-CDE AND TRN-TYP-CDE                          *  02870004
116300*--------------------------------------------------------------*  02880004
116400 R200-SELECT-TTRNCDE.                                             02890004
116700                                                                  02900015
116730     EXEC SQL                                                     02910004
116740         SELECT PSTG_TYP_CDE                                      02920004
116750              , TRN_TYP_CDE                                       02930004
116751              , BTCH_SRC_CDE                                      02940007
116752              , AP_PSTG_IND                                       02950007
116753              , CURRENT_DATE                                      02960007
116754              , CURRENT_TIMESTAMP                                 02970007
116760         INTO  :TRNCDE-PSTG-TYP-CDE                               02980004
116770             , :TRNCDE-TRN-TYP-CDE                                02990004
116771             , :TRNCDE-BTCH-SRC-CDE                               03000004
116774             , :TRNCDE-AP-PSTG-IND                                03010007
116775             , :PV-CURRENT-DATE                                   03020004
116776             , :PV-CURRENT-TIMESTAMP                              03030004
116780         FROM  TTRNCDE                                            03040004
116790         WHERE AP_TRN_CDE    =  :TRNCDE-AP-TRN-CDE                03050019
116791           AND EFF_STRT_DTE  <= CURRENT_DATE                      03060004
116792           AND EFF_END_DTE   >  CURRENT_DATE                      03070004
116794     END-EXEC.                                                    03080004
116795                                                                  03090004
116796     EVALUATE TRUE                                                03100004
116797         WHEN SQLCODE = ZERO                                      03110004
116801             CONTINUE                                             03120015
116803         WHEN SQLWARN0 NOT = SPACES                               03130004
116804         WHEN SQLCODE  NOT = ZERO                                 03140004
116805             MOVE 'R200-SELECT-TTRNCDE           '                03150004
116806                                    TO PV-ABEND-PARAGRAPH         03160004
116807             MOVE 'UNSUCCESSFUL SELECT TTRNCDE'                   03170004
116808                                    TO PV-ABEND-OPERATION         03180004
116809             MOVE 'TTRNCDE ' TO PV-ABEND-STRUCTURE-1              03190004
116810             MOVE SPACES     TO PV-ABEND-STRUCTURE-2              03200004
116811             PERFORM Z999-SQL-ERROR                               03210004
116812     END-EVALUATE.                                                03220004
116813                                                                  03230004
116814*--------------------------------------------------------------*  03240005
116815* SELECT TAPCNTL TABLE                                         *  03250005
116817*--------------------------------------------------------------*  03260005
116818 R300-SELECT-TAPCNTL.                                             03270005
116819                                                                  03280015
116822     EXEC SQL                                                     03290005
116823         SELECT CURR_PSTG_FYR_NBR                                 03300005
116824              , CURR_PSTG_FMN_NBR                                 03310005
116825              , CURR_PSTG_FWK_NBR                                 03320005
116823              , PREV_PSTG_FYR_NBR                                 03321030
116824              , PREV_PSTG_FMN_NBR                                 03322030
116825              , PREV_PSTG_FWK_NBR                                 03323030
116825              , MULT_PSTG_PER_IND                                 03324030
116825              , BTCH_PRC_DTE                                      03325044
116828         INTO  :APCNTL-CURR-PSTG-FYR-NBR                          03330005
116829             , :APCNTL-CURR-PSTG-FMN-NBR                          03340005
116830             , :APCNTL-CURR-PSTG-FWK-NBR                          03350005
116823             , :APCNTL-PREV-PSTG-FYR-NBR                          03351030
116824             , :APCNTL-PREV-PSTG-FMN-NBR                          03352030
116825             , :APCNTL-PREV-PSTG-FWK-NBR                          03353030
116825             , :APCNTL-MULT-PSTG-PER-IND                          03354030
116825             , :APCNTL-BTCH-PRC-DTE                               03355044
116833         FROM  TAPCNTL                                            03360005
116838     END-EXEC.                                                    03370005
116839                                                                  03380005
116840     EVALUATE TRUE                                                03390005
116841         WHEN SQLCODE = ZERO                                      03400005
116845             CONTINUE                                             03410015
116847         WHEN SQLWARN0 NOT = SPACES                               03420005
116848         WHEN SQLCODE  NOT = ZERO                                 03430005
116849             DISPLAY 'TAPCNTL SQLCODE ' SQLCODE                   03440012
116850             MOVE 'R300-SELECT-TAPCNTL           '                03450005
116851                                    TO PV-ABEND-PARAGRAPH         03460005
116852             MOVE 'UNSUCCESSFUL SELECT TAPCNTL'                   03470005
116853                                    TO PV-ABEND-OPERATION         03480005
116854             MOVE 'TAPCNTL ' TO PV-ABEND-STRUCTURE-1              03490005
116855             MOVE SPACES     TO PV-ABEND-STRUCTURE-2              03500005
116856             PERFORM Z999-SQL-ERROR                               03510005
116857     END-EVALUATE.                                                03520005
126900                                                                  03530000
126900                                                                  03534033
116814*--------------------------------------------------------------*  03535041
116815* GET DAY OF THE WEEK                                          *  03536041
116817*--------------------------------------------------------------*  03537041
116818 R350-GET-DOW.                                                    03538041
116819                                                                  03539041
074700** CALENDAR ROUTINE CALL FINDS THE DAY OF THE WEEK USING          03539141
074800** BATCH CONTROL DATE                                             03539241
074900     INITIALIZE DPG51                                             03539341
075000                DPG52                                             03539441
075100                DPG53                                             03539541
075200                DPG54                                             03539641
075300                DPG55                                             03539741
075400                DPG56.                                            03539841
075500                                                                  03539941
075600     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     03540041
075700     SET  DPG52-LK-DTE-ISO-FMT       TO TRUE.                     03540141
075800     MOVE APCNTL-BTCH-PRC-DTE        TO DPG52-LK-DATE-INPUT.      03540241
075900     DISPLAY 'PROCESS DATE  ' DPG52-LK-DATE-INPUT                 03540341
076000                                                                  03540441
076100     PERFORM Z900-CALENDAR-ROUTINE.                               03540541
076200     DISPLAY 'WEEK DAY  ' DPG55-ALPHA-WEEK-DAY.                   03540641
076300                                                                  03540741
116819                                                                  03541041
145100*----------------------------------------------------------------*03542000
145200*    WRITE TEXT FILE OUT.                                        *03550000
145300*----------------------------------------------------------------*03560000
145400 W100-WRITE-OUTPUT.                                               03570000
145500                                                                  03580000
145600     WRITE ADJ-JOURNAL-REC FROM AP045-TRANSACTION-FILE.           03590000
009962     ADD +1 TO  PV-TOT-OUTPUT-REC-CNT.                            03600024
145700                                                                  03610000
145700                                                                  03610141
209000*------------------------------------------------------------*    03611041
209100*  CALLS THE CALENDAR ROUTINE                                *    03612041
209200*------------------------------------------------------------*    03613041
209300 Z900-CALENDAR-ROUTINE.                                           03614041
209400                                                                  03615041
209500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03616041
209600                                             DPG54 DPG55 DPG56.   03617041
209700                                                                  03618041
209800     IF DPG54-SEVERE-ERROR OR DPG54-WARNING-ERROR                 03619041
209900         MOVE 'Z900-CALENDAR-ROUTINE'  TO PV-ABEND-PARAGRAPH      03619141
210000         MOVE DPG54-ERROR-MESSAGE      TO PV-ABEND-OPERATION      03619243
210100         MOVE DPG52-DB2-ISO-DATE-FMT   TO PV-ABEND-STRUCTURE-1    03619342
210200         SET AP-DATE-ERROR             TO TRUE                    03619441
210300         PERFORM Z999-SQL-ERROR                                   03619541
210400     END-IF.                                                      03619641
210500                                                                  03619741
146378*--------------------------------------------------------------*  03620000
146379* PROCESS DB2 ABENDS                                           *  03630000
146380*--------------------------------------------------------------*  03640000
146390 Z999-SQL-ERROR.                                                  03650000
146400                                                                  03660000
146500     DISPLAY '*** DB2 ERROR '.                                    03670000
146600     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 03680004
146700     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               03690004
146800     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               03700004
146900     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             03710004
147000     IF PV-ABEND-STRUCTURE-2 > SPACES                             03720004
147100         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.         03730004
147200                                                                  03740000
147300                                                                  03750000
147400     MOVE +4013                    TO ABEND-CODE.                 03760000
147500                                                                  03770000
147600     COPY DPPD004.                                                03780000
147700     CALL 'ILBOABN0' USING ABEND-CODE.                            03790000
147800                                                                  03800000
147900                                                                  03810000
