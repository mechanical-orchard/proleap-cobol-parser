000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.      EPKUP055.                                       00030000
000400 AUTHOR.          STEVEN NOWAK.                                   00040000
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
000600 DATE-WRITTEN.    01/15/10.                                       00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*  MODULE TYPE:   COBOL2 DB2 BATCH.                               00100000
001100*                                                                 00110000
001200* THIS PROGRAM WILL PROCESS THE NIGHTLY LOWEST RETAIL PRICE LOAD  00120000
001300* FILE. THE PROGRAM WILL ATTEMPT TO EITHER INSERT OR UPDATE A ROW 00130000
001400* ON THE TABLE, DEPENDING IF AN ENTRY ALREADY EXISTS FOR THE ITEM 00140000
001500* (INTERNAL UPC ID) / AD VERSION COMBINATION FOR THE CURRENT WEEK.00150000
001600*                                                                 00160000
001700*=================================================================00170000
001800* NOTE: PROGRAMS EPKUP055 (EPK330) AND EPKUP056 (EPK397) ARE      00180000
001900*       THE SAME EXCEPT FOR THE CHECKPOINT/RESTART PARMS:         00190000
002000*         PC-CKPT-JOB-NAME AND  PC-CKPT-PLAN-NAME                 00200000
002100*                                                                 00210000
002200*       ANY CHANGES DONE TO ONE, SHOULD BE DONE TO THE OTHER      00220000
002300*                                                                 00230000
002400*========================== CHANGE LOG ===========================00240000
002500*  AUTH        BY            DATE                 DESCRIPTION     00250000
002600*=================================================================00260000
002700* WR37120    S. NOWAK      01-15-10   CREATE PROGRAM              00270000
002800*                                                                 00280000
000999*-----------------------------------------------------------      00281002
001000* HISTORY LOG:                                                    00282002
001100*-----------------------------------------------------------      00283002
001200* DATE:        12/05/11                                           00284002
001300* WR/IR#:      WR#26615                                           00285006
001400* PROGRAMMER:  ROB SWAGER                                         00286002
001500* DESCRIPTION: EXTEND LOWEST 6 WEEK RETURN PRICE PROCESSING       00287002
001510*              TO 13 WEEKS.                                       00288003
001600*                                                                 00289102
260107* CHG0260107  JIM HUNTER  08-19-21  ADD COPYBOOK DPWS991 TO MAKE  00289207
260107*                                   THE CALL TO DPKUT901 DYNAMIC. 00289307
001700*----------------------------------------------------------       00289402
002900******************************************************************00290000
003000                                                                  00300000
003100 ENVIRONMENT DIVISION.                                            00310000
003200 CONFIGURATION SECTION.                                           00320000
003300                                                                  00330000
003400 SOURCE-COMPUTER.    IBM-3090.                                    00340000
003500 OBJECT-COMPUTER.    IBM-3090.                                    00350000
003600                                                                  00360000
003700 INPUT-OUTPUT SECTION.                                            00370000
003800 FILE-CONTROL.                                                    00380000
003900                                                                  00390000
004000 DATA DIVISION.                                                   00400000
004100 FILE SECTION.                                                    00410000
004200                                                                  00420000
004300                                                                  00430000
004400***************************************************************** 00440000
004500*                       WORKING STORAGE                           00450000
004600***************************************************************** 00460000
004700 WORKING-STORAGE SECTION.                                         00470000
004800                                                                  00480000
004900 01  W-START                          PIC  X(40)                  00490000
005000     VALUE 'EPKUP055 - WORKING STORAGE BEGINS HERE'.              00500000
005100                                                                  00510000
005200                                                                  00520000
005300***************************************************************** 00530000
005400*                         SWITCHES                                00540000
005500***************************************************************** 00550000
005600 01  PROGRAM-SWITCHES.                                            00560000
005700     05  PS-RESTART-REQUIRED-SW       PIC  X(01) VALUE 'N'.       00570000
005800         88  PS-RESTART-REQUIRED                 VALUE 'Y'.       00580000
005900         88  PS-RESTART-NOT-REQUIRED             VALUE 'N'.       00590000
006000                                                                  00600000
006100     05  PS-UPDATE-SW                 PIC  X(01) VALUE 'N'.       00610000
006200         88  PS-UPDATE                           VALUE 'Y'.       00620000
006300         88  PS-NO-UPDATE                        VALUE 'N'.       00630000
006400                                                                  00640000
006500******************************************************************00650000
006600*                       ACCUMULATORS                              00660000
006700******************************************************************00670000
006800 01  PROGRAM-ACCUM.                                               00680000
006900     05  PA-READ                      PIC  9(11) VALUE ZEROS.     00690000
007000     05  PA-CKPT                      PIC  9(11) VALUE ZEROS.     00700000
007100                                                                  00710000
007200******************************************************************00720000
007300*                           CONSTANTS                             00730000
007400******************************************************************00740000
007500 01  PROGRAM-CONSTANTS.                                           00750000
007600     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00760000
007700                                                 COMP SYNC.       00770000
007800     05  PC-MAX-DEADLOCKS             PIC S9(04) VALUE +3         00780000
007900                                                 COMP SYNC.       00790000
008000                                                                  00800000
008100     05  PC-CKPT-JOB-NAME             PIC  X(08) VALUE 'EPK330  '.00810000
008200     05  PC-CKPT-PLAN-NAME            PIC  X(08) VALUE 'EPKUP055'.00820000
008300     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'EPKUP055'.00830000
008400                                                                  00840000
008500     05  PC-TRAN-PRES-FUNC-CODES.                                 00850000
008600         10  PC-TRAN-PRES-FUNC-OPEN   PIC  X(05) VALUE 'OPEN '.   00860000
008700         10  PC-TRAN-PRES-FUNC-TRANS  PIC  X(05) VALUE 'TRANS'.   00870000
008800         10  PC-TRAN-PRES-FUNC-RSTRT  PIC  X(05) VALUE 'RSTRT'.   00880000
008900         10  PC-TRAN-PRES-FUNC-CLOSE  PIC  X(05) VALUE 'CLOSE'.   00890000
009000                                                                  00900000
009100     05  PC-MINUS-ONE                 PIC S9(01) VALUE -1.        00910000
009200     05  PC-SYSTEM                    PIC  X(08) VALUE 'SYSTEM  '.00920000
009300                                                                  00930000
009400******************************************************************00940000
009500*                          VARIABLES                              00950000
009600******************************************************************00960000
009700 01  PROGRAM-VARIABLES.                                           00970000
009800     05  PV-SQL-SUB                   PIC  9(03) VALUE ZERO.      00980000
009900     05  PV-DEADLOCK-COUNTER          PIC  9(03) VALUE ZERO.      00990000
010000     05  PV-RETRY-CNT                 PIC  9(03) VALUE ZERO.      01000000
010100     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     01010000
010200     05  PV-DB2-OPER-ATTEMPTED        PIC  X(30) VALUE SPACE.     01020000
010300     05  PV-OPERATION-MSG             PIC  X(35) VALUE SPACE.     01030000
010400     05  PV-RET-CODE                  PIC  9(04) VALUE ZEROS.     01040000
010500                                                                  01050000
010600******************************************************************01060000
010700*               SYSTEM TIME AND DATE VARIABLES                    01070000
010800******************************************************************01080000
010900 01  SYS-DATE-TIME.                                               01090000
011000     05  SYS-DATE                     PIC  X(08) VALUE SPACES.    01100000
011100     05  SYS-TIME                     PIC  X(08) VALUE SPACES.    01110000
011200                                                                  01120000
011300 01  ST-BEG-TIME.                                                 01130000
011400     05  ST-BEG-HR                    PIC  9(02) VALUE ZEROS.     01140000
011500     05  FILLER                       PIC  X(01) VALUE ':'.       01150000
011600     05  ST-BEG-MN                    PIC  9(02) VALUE ZEROS.     01160000
011700                                                                  01170000
011800 01  ST-END-TIME.                                                 01180000
011900     05  ST-END-HR                    PIC  9(02) VALUE ZEROS.     01190000
012000     05  FILLER                       PIC  X(01) VALUE ':'.       01200000
012100     05  ST-END-MN                    PIC  9(02) VALUE ZEROS.     01210000
012200                                                                  01220000
012300 01  SD-EDIT-DATE.                                                01230000
012400     05  SD-MONTH                     PIC  9(02) VALUE ZEROS.     01240000
012500     05  FILLER                       PIC  X(01) VALUE '-'.       01250000
012600     05  SD-DAY                       PIC  9(02) VALUE ZEROS.     01260000
012700     05  FILLER                       PIC  X(01) VALUE '-'.       01270000
012800     05  SD-CENT                      PIC  9(02) VALUE ZEROS.     01280000
012900     05  SD-YEAR                      PIC  9(02) VALUE ZEROS.     01290000
013000                                                                  01300000
013100******************************************************************01310000
013200*                        ERROR HANDLING                           01320000
013300******************************************************************01330000
013400 01  ABEND-CODE                       PIC S9(04) VALUE ZEROS      01340000
013500                                                 COMP SYNC.       01350000
013600     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     01360000
013700     88  ABEND-4444-FORCED-ABEND                 VALUE +4444.     01370000
013800                                                                  01380000
013900                                                                  01390000
014000******************************************************************01400000
014100*  UPDATE RECORD                                                  01410000
014200******************************************************************01420000
014300     COPY EPRD119.                                                01430000
014400                                                                  01440000
014500******************************************************************01450000
014600*  DB2 FORMATTED ERROR MESSAGE                                    01460000
014700******************************************************************01470000
014800     COPY DPWS004.                                                01480000
014900                                                                  01490000
015000******************************************************************01500000
015100*  SQL COMMUNICATIONS WORK AREA                                   01510000
015200******************************************************************01520000
015300     COPY SQLCA2.                                                 01530000
015400                                                                  01540000
015500******************************************************************01550000
015600*  COMMUNICATIONS AREA FOR DB2                                    01560000
015700******************************************************************01570000
015800     EXEC SQL                                                     01580000
015900         INCLUDE SQLCA                                            01590000
016000     END-EXEC.                                                    01600000
016100                                                                  01610000
016200******************************************************************01620000
016300* DB2 TABLE DB2PDBA.EPT_LO_RTL LOWEST 13  WEEK RETAIL TABLE       01630001
016400******************************************************************01640000
016500     EXEC SQL                                                     01650000
016600         INCLUDE EPT00011                                         01660000
016700     END-EXEC.                                                    01670000
016800                                                                  01680000
016900                                                                  01690000
017000******************************************************************01700000
017100*  TRANSACTION PREPARATION MODULE COMMUNICATIONS AREA             01710000
017200******************************************************************01720000
260107     COPY DPWS991.                                                01730007
017300                                                                  01731007
017300     COPY DPLS001.                                                01732007
017400     05  WORK-STORAGE-PASSED.                                     01740000
017500******************************************************************01750000
017600*PA - PROGRAM ACCUMULATORS                                        01760000
017700******************************************************************01770000
017800         10  PROGRAM-ACCUMULATORS.                                01780000
017900             15  PA-ROWS-UPDATED  PIC S9(11)           VALUE ZERO 01790000
018000                                                       COMP-3.    01800000
018100             15  PA-ROWS-INSERTED PIC S9(11)           VALUE ZERO 01810000
018200                                                       COMP-3.    01820000
018300                                                                  01830000
018400 01  FILLER                          PIC X(4096)  VALUE SPACE.    01840000
018500                                                                  01850000
018600                                                                  01860000
018700                                                                  01870000
018800 PROCEDURE DIVISION.                                              01880000
018900******************************************************************01890000
019000* MAINLINE-PROCESSING                                             01900000
019100******************************************************************01910000
019200                                                                  01920000
019300     PERFORM A100-INITIALIZE.                                     01930000
019400                                                                  01940000
019500     PERFORM B100-PROCESS-RECORDS                                 01950000
019600       UNTIL DP001-PREP-TRANS-EOF.                                01960000
019700                                                                  01970000
019800     PERFORM Z990-EOJ-ROUTINE.                                    01980000
019900                                                                  01990000
020000     GOBACK.                                                      02000000
020100                                                                  02010000
020200                                                                  02020000
020300******************************************************************02030000
020400* PREFORMS TASK INITIATION                                        02040000
020500******************************************************************02050000
020600 A100-INITIALIZE.                                                 02060000
020700                                                                  02070000
020800     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 02080000
020900                                                                  02090000
021000     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            02100000
021100     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            02110000
021200                                                                  02120000
021300     MOVE SYS-DATE (1:2) TO SD-CENT.                              02130000
021400     MOVE SYS-DATE (3:2) TO SD-YEAR.                              02140000
021500     MOVE SYS-DATE (5:2) TO SD-MONTH.                             02150000
021600     MOVE SYS-DATE (7:2) TO SD-DAY.                               02160000
021700                                                                  02170000
021800     MOVE PC-TRAN-PRES-FUNC-OPEN TO DP001-FUNC-CODE.              02180000
021900                                                                  02190000
022000     PERFORM X100-BUILD-COMM-AREA-TRAN-PRES.                      02200000
022100                                                                  02210000
022200                                                                  02220000
022300******************************************************************02230000
022400* PROCESS RECORDS                                                 02240000
022500******************************************************************02250000
022600 B100-PROCESS-RECORDS.                                            02260000
022700                                                                  02270000
022800     SET PS-RESTART-NOT-REQUIRED TO TRUE.                         02280000
022900                                                                  02290000
023000     PERFORM C100-UPDATE-RECS.                                    02300000
023100                                                                  02310000
023200*----------------------------------------------------------------*02320000
023300*  IF A RESTART IS REQUIRED, ISSUE A RESTART CALL RATHER THAN A  *02330000
023400*  TRANS CALL.  THIS WILL ALLOW PROCESSING TO RESUME WITH THE    *02340000
023500*  FIRST TRANSACTION AFTER THE LAST COMMIT.                      *02350000
023600*----------------------------------------------------------------*02360000
023700     IF  PS-RESTART-REQUIRED                                      02370000
023800         MOVE PC-TRAN-PRES-FUNC-RSTRT TO DP001-FUNC-CODE          02380000
023900     ELSE                                                         02390000
024000         MOVE PC-TRAN-PRES-FUNC-TRANS TO DP001-FUNC-CODE          02400000
024100     END-IF.                                                      02410000
024200                                                                  02420000
024300     PERFORM X100-BUILD-COMM-AREA-TRAN-PRES.                      02430000
024400                                                                  02440000
024500     ADD 1 TO PA-READ.                                            02450000
024600                                                                  02460000
024700                                                                  02470000
024800******************************************************************02480000
024900* UPDATE RECORDS                                                  02490000
025000******************************************************************02500000
025100 C100-UPDATE-RECS.                                                02510000
025200                                                                  02520000
025300     MOVE 'N' TO PS-UPDATE-SW.                                    02530000
025400                                                                  02540000
025500     MOVE EP119-INTR-UPC-ID    TO EPT00011-INTR-UPC-ID.           02550000
025600     MOVE EP119-STR-GP-TYP-CDE TO EPT00011-STR-GP-TYP-CDE.        02560000
025700     MOVE EP119-STR-GP-ID      TO EPT00011-STR-GP-ID.             02570000
025800     MOVE EP119-SLS-WK-BEG-DTE TO EPT00011-SLS-WK-BEG-DTE.        02580000
025900     MOVE EP119-UNT-RTL-AMT    TO EPT00011-UNT-RTL-AMT.           02590000
026000                                                                  02600000
026100     PERFORM C200-INSERT.                                         02610000
026200                                                                  02620000
026300     IF  PS-UPDATE                                                02630000
026400         PERFORM C300-UPDATE                                      02640000
026500     END-IF.                                                      02650000
026600                                                                  02660000
026700                                                                  02670000
026800******************************************************************02680000
026900* THIS SECTION WILL ATTEMPT TO INSERT THE CURRENT WEEK ROW,       02690000
027000* AND IF IT FAILS AN UPDATE WILL BE ATTEMPTED.                    02700000
027100******************************************************************02710000
027200 C200-INSERT.                                                     02720000
027300                                                                  02730000
027400     EXEC SQL                                                     02740000
027500         INSERT INTO EPT_LO_RTL                                   02750000
027600         VALUES                                                   02760000
027700           (                                                      02770000
027800            :EPT00011-INTR-UPC-ID,                                02780000
027900            :EPT00011-STR-GP-TYP-CDE,                             02790000
028000            :EPT00011-STR-GP-ID,                                  02800000
028100            :EPT00011-SLS-WK-BEG-DTE,                             02810000
028200            :EPT00011-UNT-RTL-AMT                                 02820000
028300           )                                                      02830000
028400     END-EXEC.                                                    02840000
028500                                                                  02850000
028600     EVALUATE TRUE                                                02860000
028700        WHEN SQLCODE = ZERO                                       02870000
028800            ADD +1 TO PA-ROWS-INSERTED                            02880000
028900                                                                  02890000
029000        WHEN SQLCODE = +100                                       02900000
029100        WHEN SQLCODE = -803                                       02910000
029200            SET PS-UPDATE TO TRUE                                 02920000
029300                                                                  02930000
029400        WHEN OTHER                                                02940000
029500            DISPLAY '           '                                 02950000
029600            DISPLAY 'C200-INSERT'                                 02960000
029700                    ' UPC ID = ' EPT00011-INTR-UPC-ID             02970000
029800                    ' GP TYP = ' EPT00011-STR-GP-TYP-CDE          02980000
029900                    ' GP ID  = ' EPT00011-STR-GP-ID               02990000
030000                    ' BEG DTE= ' EPT00011-SLS-WK-BEG-DTE          03000000
030100                    ' RTL AMT= ' EPT00011-UNT-RTL-AMT             03010000
030200                                                                  03020000
030300            MOVE 'C200-INSERT'        TO PV-PARAGRAPH-NAME        03030000
030400            MOVE 'EPT_LO_RTL INSERT'  TO PV-DB2-OPER-ATTEMPTED    03040000
030500                                                                  03050000
030600            PERFORM Z200-SQL-ABEND                                03060000
030700     END-EVALUATE.                                                03070000
030800                                                                  03080000
030900                                                                  03090000
031000******************************************************************03100000
031100* THIS SECTION WILL ATTEMPT TO UPDATE A ROW TO THE LOWEST PRICE   03110000
031200* TABLE IF AN INSERT COULD NOT BE PERFORMED.                      03120000
031300******************************************************************03130000
031400 C300-UPDATE.                                                     03140000
031500                                                                  03150000
031600     EXEC SQL                                                     03160000
031700        UPDATE EPT_LO_RTL                                         03170000
031800           SET UNT_RTL_AMT      = :EPT00011-UNT-RTL-AMT           03180000
031900                                                                  03190000
032000         WHERE INTR_UPC_ID      = :EPT00011-INTR-UPC-ID           03200000
032100           AND STR_GP_TYP_CDE   = :EPT00011-STR-GP-TYP-CDE        03210000
032200           AND STR_GP_ID        = :EPT00011-STR-GP-ID             03220000
032300           AND SLS_WK_BEG_DTE   = :EPT00011-SLS-WK-BEG-DTE        03230000
032400     END-EXEC.                                                    03240000
032500                                                                  03250000
032600     EVALUATE TRUE                                                03260000
032700        WHEN SQLCODE = ZERO                                       03270000
032800            ADD +1 TO PA-ROWS-UPDATED                             03280000
032900                                                                  03290000
033000        WHEN OTHER                                                03300000
033100            DISPLAY '           '                                 03310000
033200            DISPLAY 'C300-UPDATE'                                 03320000
033300                    ' UPC ID = ' EPT00011-INTR-UPC-ID             03330000
033400                    ' GP TYP = ' EPT00011-STR-GP-TYP-CDE          03340000
033500                    ' GP ID  = ' EPT00011-STR-GP-ID               03350000
033600                    ' BEG DTE= ' EPT00011-SLS-WK-BEG-DTE          03360000
033700                    ' RTL AMT= ' EPT00011-UNT-RTL-AMT             03370000
033800                                                                  03380000
033900            MOVE 'C300-UPDATE'        TO PV-PARAGRAPH-NAME        03390000
034000            MOVE 'EPT_LO_RTL UPDATE'  TO PV-DB2-OPER-ATTEMPTED    03400000
034100                                                                  03410000
034200            PERFORM Z200-SQL-ABEND                                03420000
034300     END-EVALUATE.                                                03430000
034400                                                                  03440000
034500                                                                  03450000
034600******************************************************************03460000
034700* BUILD THE COMMUNICATION AREA FOR A CALL TO THE TRANSACTION      03470000
034800* PRESENTATION MODULE                                             03480000
034900******************************************************************03490000
035000 X100-BUILD-COMM-AREA-TRAN-PRES.                                  03500000
035100                                                                  03510000
035200     MOVE LENGTH OF                                               03520000
035300          WORK-STORAGE-PASSED TO DP001-WORK-STRG-LENGTH.          03530000
035400     MOVE PC-CKPT-JOB-NAME    TO DP001-JOB-NAME.                  03540000
035500     MOVE PC-CKPT-PLAN-NAME   TO DP001-PLAN-NAME.                 03550000
035600                                                                  03560000
035700     PERFORM X200-CALL-TRANS-PRES-MODULE.                         03570000
035800                                                                  03580000
035900     MOVE DP001-TRANS-RECORD  TO EP119-LWST-W13-WK-CHG-RCD.       03590001
036000                                                                  03600000
036100     IF  DP001-CKPT-TAKEN                                         03610000
036200         ADD 1 TO PA-CKPT                                         03620000
036300                                                                  03630000
036400         INITIALIZE PV-DEADLOCK-COUNTER                           03640000
036500     END-IF.                                                      03650000
036600                                                                  03660000
036700                                                                  03670000
036800******************************************************************03680000
036900* VERIFY THE RETURN CODE ON THE CALLED MODULE                     03690000
037000******************************************************************03700000
037100 X200-CALL-TRANS-PRES-MODULE.                                     03710000
037200                                                                  03720000
037300     PERFORM Z900-CALL-TRANS-PRES-MODULE.                         03730000
037400                                                                  03740000
037500     IF  DP001-GOOD-RET-CODE                                      03750000
037600     OR  DP001-CKPT-TAKEN                                         03760000
037700     OR  DP001-RESTART                                            03770000
037800         CONTINUE                                                 03780000
037900                                                                  03790000
038000     ELSE                                                         03800000
038100         MOVE 'X200-CALL-TRANS-PRES-MODULE' TO PV-PARAGRAPH-NAME  03810000
038200         MOVE '** BAD CALL TO TRANS PREP MODULE **'               03820000
038300                                            TO PV-OPERATION-MSG   03830000
038400         MOVE DP001-RET-CODE                TO PV-RET-CODE        03840000
038500                                                                  03850000
038600         SET ABEND-4444-FORCED-ABEND TO TRUE                      03860000
038700                                                                  03870000
038800         PERFORM Z100-ABEND                                       03880000
038900     END-IF.                                                      03890000
039000                                                                  03900000
039100                                                                  03910000
039200******************************************************************03920000
039300* NON-DB2 ABEND                                                   03930000
039400******************************************************************03940000
039500 Z100-ABEND.                                                      03950000
039600                                                                  03960000
039700     PERFORM Z999-CONTROLS.                                       03970000
039800                                                                  03980000
039900     DISPLAY '                     '.                             03990000
040000     DISPLAY '** ABEND           **'.                             04000000
040100     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          04010000
040200     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        04020000
040300     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         04030000
040400     DISPLAY '** RETURN CODE     ** = ' PV-RET-CODE.              04040000
040500                                                                  04050000
040600     CALL 'ILBOABN0' USING ABEND-CODE.                            04060000
040700                                                                  04070000
040800                                                                  04080000
040900******************************************************************04090000
041000* ABEND THE PROGRAM IN THE EVENT THAT A SQL ERROR OR WARNING      04100000
041100* CODE OCCURS.                                                    04110000
041200******************************************************************04120000
041300 Z200-SQL-ABEND.                                                  04130000
041400                                                                  04140000
041500     PERFORM Z999-CONTROLS.                                       04150000
041600                                                                  04160000
041700     DISPLAY '** ABEND     **'.                                   04170000
041800     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                04180000
041900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04190000
042000     DISPLAY '** OPERATION ** = ' PV-DB2-OPER-ATTEMPTED.          04200000
042100                                                                  04210000
042200******************************************************************04220000
042300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04230000
042400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04240000
042500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04250000
042600* FORMAT.                                                         04260000
042700******************************************************************04270000
042800     COPY DPPD004.                                                04280000
042900                                                                  04290000
043000     SET ABEND-4013-DB2-ERROR TO TRUE.                            04300000
043100                                                                  04310000
043200     CALL 'ILBOABN0' USING ABEND-CODE.                            04320000
043300                                                                  04330000
043400                                                                  04340000
043500******************************************************************04350000
043600* PREFORMS TASK TERMINATION PROCESSING                            04360000
043700******************************************************************04370000
043800 Z990-EOJ-ROUTINE.                                                04380000
043900                                                                  04390000
044000     MOVE PC-TRAN-PRES-FUNC-CLOSE TO DP001-FUNC-CODE.             04400000
044100                                                                  04410000
044200     PERFORM X100-BUILD-COMM-AREA-TRAN-PRES.                      04420000
044300                                                                  04430000
044400     PERFORM Z999-CONTROLS.                                       04440000
044500                                                                  04450000
044600                                                                  04460000
044700******************************************************************04470000
044800* DISPLAY CONTROLS FROM THE PROGRAM                               04480000
044900******************************************************************04490000
045000 Z999-CONTROLS.                                                   04500000
045100                                                                  04510000
045200     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 04520000
045300                                                                  04530000
045400     MOVE SYS-TIME (1:2) TO ST-END-HR.                            04540000
045500     MOVE SYS-TIME (3:2) TO ST-END-MN.                            04550000
045600                                                                  04560000
045700     DISPLAY '                    '.                              04570000
045800     DISPLAY '**********************'.                            04580000
045900     DISPLAY '   EPKUP055 CONTROLS  '.                            04590000
046000     DISPLAY '**********************'.                            04600000
046100     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         04610000
046200     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          04620000
046300     DISPLAY 'END TIME  = ' ST-END-TIME.                          04630000
046400     DISPLAY '======================'.                            04640000
046500     DISPLAY 'RECORDS READ   = ' PA-READ.                         04650000
046600     DISPLAY 'CHECKPOINTS    = ' PA-CKPT.                         04660000
046700     DISPLAY '                '.                                  04670000
046800     DISPLAY 'ROWS UPDATED  = ' PA-ROWS-UPDATED.                  04680000
046900     DISPLAY 'ROWS INSERTED = ' PA-ROWS-INSERTED.                 04690000
047000     DISPLAY '                '.                                  04700000
047100                                                                  04710000
047200******************************************************************04720000
047300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04730000
047400* MENTS THAT ARE REQUIRED TO INVOKE THE TRANSACTION PRESENTATION  04740000
047500* MODULE (DPKUT901) OF THE DB2 CHECKPOINT RESTART SYSTEM.         04750000
047600******************************************************************04760000
047700     COPY DPPD001.                                                04770000
047800                                                                  04780000
047900                                                                  04790000
