000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      RCKUT908.                                       00020000
000300 AUTHOR.          STEPHANIE HERON.                                00030000
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040000
000500 DATE-WRITTEN.    AUGUST 1, 1996.                                 00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800*                                                                *00080000
000900*  DB2 TABLES BEING ACCESSED:                                    *00090000
001000*                                                                *00100000
001100*    .  TDCFAAS                                                  *00110000
001200*    .  TDCTFAS                                                  *00120000
001300*                                                                *00130000
001400*  PROGRAM NARRATIVE:                                            *00140000
001500*  THIS PROGRAM IS SET UP TO COPY FINDLAYS DATA FOR A NEW DC.    *00150000
001600*  THE DATA IS SET UP IN TEST THEN COPPIED TO PRODUCTION USING   *00160000
001700*  FILE AID.                                                     *00170000
001800*                                                                *00180000
001900******************************************************************00190000
002000 ENVIRONMENT DIVISION.                                            00200000
002100 CONFIGURATION SECTION.                                           00210000
002200 SOURCE-COMPUTER. IBM-3090.                                       00220000
002300 OBJECT-COMPUTER. IBM-3090.                                       00230000
002400                                                                  00240000
002500 INPUT-OUTPUT SECTION.                                            00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800 DATA DIVISION.                                                   00280000
002900 FILE SECTION.                                                    00290000
003000                                                                  00300000
003100 WORKING-STORAGE SECTION.                                         00310000
003200                                                                  00320000
003300 01  ABEND-CODE                       PIC S9(04)     VALUE +0     00330000
003400                                                     COMP SYNC.   00340000
003500     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00350000
003600                                                                  00360000
003700 01  PS-PROGRAM-SWITCHES.                                         00370000
003800     05  PS-END-OF-INPUT-SW           PIC X          VALUE 'N'.   00380000
003900         88  PS-NOT-END-OF-INPUT                     VALUE 'N'.   00390000
004000         88  PS-END-OF-INPUT                         VALUE 'Y'.   00400000
004100     05  PS-END-OF-CURSOR-SW          PIC X          VALUE 'N'.   00410000
004200         88  PS-NOT-END-OF-CURSOR                    VALUE 'N'.   00420000
004300         88  PS-END-OF-CURSOR                        VALUE 'Y'.   00430000
004400                                                                  00440000
004500 01  PV-PROGRAM-VARIABLES.                                        00450000
004510*                                                                 00451000
004511     05  PV-DISPLAY-OPER              PIC 9(04)      VALUE ZEROES.00451100
004512     05  PV-DISPLAY-FCLTY             PIC 9(04)      VALUE ZEROES.00451200
004513     05  PV-DISPLAY-DEPT              PIC X(03)      VALUE SPACES.00451300
004514     05  PV-DISPLAY-CL                PIC X(02)      VALUE SPACES.00451400
004515     05  PV-DISPLAY-RANK              PIC 9(04)      VALUE ZEROES.00451500
004516     05  PV-ERROR-INFO                PIC X(100)     VALUE SPACES.00451600
004517*                                                                 00451700
004518     05  PV-DB2-FUNCTION              PIC  X(30)     VALUE SPACES.00451800
004519     05  PV-PARAGRAPH                 PIC  X(30)     VALUE SPACES.00451900
004520     05  PV-ROW-COUNT                 PIC S9(09)     COMP-3       00452000
004530                                                     VALUE ZERO.  00453000
004540     05  PV-FCLTY-AREA-ID-NULL        PIC S9(04) VALUE +0         00454000
004550                                                 COMP.            00455000
004560     05  PV-TKT-FMT-ID-NULL           PIC S9(04) VALUE +0         00456000
004570                                                 COMP.            00457000
004580     05  INSERT-COUNT                 PIC S9(09)     COMP-3       00458000
004590                                                     VALUE ZERO.  00459000
004600     05  COMMIT-COUNT                 PIC S9(09)     COMP-3       00460000
004700                                                     VALUE ZERO.  00470000
004800     05  FETCH-COUNT                  PIC S9(09)     COMP-3       00480000
004900                                                     VALUE ZERO.  00490000
005000     05  PV-ROW-COUNT-DISPLAY         PIC ZZZ,ZZZ,ZZ9             00500000
005100                                                     VALUE ZERO.  00510000
005200     05  INSERT-COUNT-DISPLAY         PIC ZZZ,ZZZ,ZZ9             00520000
005300                                                     VALUE ZERO.  00530000
005400     05  COMMIT-COUNT-DISPLAY         PIC ZZZ,ZZZ,ZZ9             00540000
005500                                                     VALUE ZERO.  00550000
005600     05  FETCH-COUNT-DISPLAY          PIC ZZZ,ZZZ,ZZ9             00560000
005700                                                     VALUE ZERO.  00570000
005800                                                                  00580000
005900 01  PC-PROGRAM-CONSTANTS.                                        00590000
006000     05  PC-CURRENT-PROGRAM-NAME      PIC X(8)       VALUE        00600000
006010                                                     'RCKUT908'.  00601000
006020                                                                  00602000
006030 01  INPUT-RECORD.                                                00603000
006040     05  INP-ORD-NBR                  PIC S9(09)     COMP.        00604000
006050     05  INP-ORD-LNE-NBR              PIC S9(09)     COMP.        00605000
006060     05  INP-REC-SEQ-NBR              PIC S9(09)     COMP.        00606000
006070     05  INP-OPER-UNT-ID              PIC S9(04)     COMP.        00607000
006080     05  INP-FCLTY-ID                 PIC S9(04)     COMP.        00608000
006090     05  FILLER                       PIC  X(74).                 00609000
006100                                                                  00610000
006200******************************************************************00620000
006300*  DB2 MESSAGE AREAS                                              00630000
006400******************************************************************00640000
006500     COPY DPWS004.                                                00650000
006600                                                                  00660000
006700******************************************************************00670000
006800*  DB2 MESSAGE AREA                                               00680000
006900******************************************************************00690000
007000     COPY SQLCA2.                                                 00700000
007100                                                                  00710000
007200******************************************************************00720000
007300*    TDCFAAS TABLE                                                00730000
007400******************************************************************00740000
007500                                                                  00750000
007600     EXEC SQL                                                     00760000
007700         INCLUDE TDCFAAS                                          00770000
007800     END-EXEC.                                                    00780000
007900                                                                  00790000
008000******************************************************************00800000
008100*    TDCTFAS TABLE                                                00810000
008200******************************************************************00820000
008300                                                                  00830000
008400     EXEC SQL                                                     00840000
008500         INCLUDE TDCTFAS                                          00850000
008600     END-EXEC.                                                    00860000
008700                                                                  00870000
008800******************************************************************00880000
008900*    DB2 COMMUNICATIONS AREA                                      00890000
009000******************************************************************00900000
009100                                                                  00910000
009200     EXEC SQL                                                     00920000
009300         INCLUDE SQLCA                                            00930000
009400     END-EXEC.                                                    00940000
009500                                                                  00950000
009600******************************************************************00960000
009700*    CURSOR TO GET ROWS FROM TDCFAAS - DC COPYING FROM            00970000
009800******************************************************************00980000
009900     EXEC SQL                                                     00990000
010000          DECLARE DCFAAS_CSR CURSOR FOR                           01000000
010100                SELECT                                            01010000
010200                      OPER_UNT_ID                                 01020000
010300                     ,FCLTY_ID                                    01030000
010400                     ,DEPT_NBR                                    01040000
010500                     ,CL_NBR                                      01050000
010600                     ,FCLTY_LOC_TYP_CDE                           01060000
010700                     ,RANK_NBR                                    01070000
010800                     ,FCLTY_AREA_ID                               01080000
010900                     ,OPER_SET_ID                                 01090000
011000                  FROM TDCFAAS                                    01100000
011100                  WHERE OPER_UNT_ID = 806                         01110000
011200     END-EXEC.                                                    01120000
011300                                                                  01130000
011301******************************************************************01130100
011302*    CURSOR TO GET ROWS FROM TDCTFAS - DC COPYING FROM            01130200
011303******************************************************************01130300
011304     EXEC SQL                                                     01130400
011305          DECLARE DCTFAS_CSR CURSOR FOR                           01130500
011306                SELECT                                            01130600
011307                       OPER_UNT_ID                                01130700
011308                      ,FCLTY_ID                                   01130800
011309                      ,DEPT_NBR                                   01130900
011310                      ,CL_NBR                                     01131000
011320                      ,RANK_NBR                                   01132000
011330                      ,TKT_FMT_ID                                 01133000
011340                  FROM TDCTFAS                                    01134000
011350                  WHERE OPER_UNT_ID = 806                         01135000
011360     END-EXEC.                                                    01136000
011370                                                                  01137000
011380 LINKAGE SECTION.                                                 01138000
011390                                                                  01139000
011400******************************************************************01140000
011500 PROCEDURE DIVISION.                                              01150000
011600******************************************************************01160000
011700                                                                  01170000
011800 A000-MAINLINE.                                                   01180000
011900                                                                  01190000
012000     INITIALIZE INSERT-COUNT                                      01200000
012100                FETCH-COUNT.                                      01210000
012200                                                                  01220000
012300     PERFORM 2100-OPEN-TDCFAAS-CURSOR.                            01230000
012400                                                                  01240000
012500     PERFORM 2200-FETCH-TDCFAAS-CURSOR.                           01250000
012600                                                                  01260000
012700     SET PS-NOT-END-OF-CURSOR TO TRUE.                            01270000
012800     PERFORM 2000-PROCESS-TDCFAAS                                 01280000
012900         UNTIL PS-END-OF-CURSOR.                                  01290000
013000                                                                  01300000
013100     MOVE INSERT-COUNT TO INSERT-COUNT-DISPLAY.                   01310000
013200     MOVE FETCH-COUNT TO FETCH-COUNT-DISPLAY.                     01320000
013300     DISPLAY 'NUMBER OF TDCFAAS EXTRACTED ' FETCH-COUNT.          01330000
013400     DISPLAY 'NUMBER OF TDCFAAS INSERTED ' INSERT-COUNT.          01340000
013500                                                                  01350000
013600     PERFORM 2300-CLOSE-TDCFAAS-CURSOR.                           01360000
013700                                                                  01370000
013800     INITIALIZE INSERT-COUNT                                      01380000
013900                FETCH-COUNT.                                      01390000
014000                                                                  01400000
014100     PERFORM 2400-OPEN-TDCTFAS-CURSOR.                            01410000
014200                                                                  01420000
014300     PERFORM 2500-FETCH-TDCTFAS-CURSOR.                           01430000
014400                                                                  01440000
014500     SET PS-NOT-END-OF-CURSOR TO TRUE.                            01450000
014600     PERFORM 2050-PROCESS-TDCTFAS                                 01460000
014700         UNTIL PS-END-OF-CURSOR.                                  01470000
014800                                                                  01480000
014900     MOVE INSERT-COUNT TO INSERT-COUNT-DISPLAY.                   01490000
015000     MOVE FETCH-COUNT TO FETCH-COUNT-DISPLAY.                     01500000
015100     DISPLAY 'NUMBER OF TDCTFAS EXTRACTED ' FETCH-COUNT.          01510000
015200     DISPLAY 'NUMBER OF TDCTFAS INSERTED ' INSERT-COUNT.          01520000
015300                                                                  01530000
015400     PERFORM 2600-CLOSE-TDCTFAS-CURSOR.                           01540000
015500                                                                  01550000
015600     GOBACK.                                                      01560000
015700                                                                  01570000
015800***************************************************************** 01580000
015810*    PROCESSES THE INPUT RECORDS                                  01581000
015820***************************************************************** 01582000
015830 2000-PROCESS-TDCFAAS.                                            01583000
015840*                                                                 01584000
015850*  CHANGE                                                         01585000
015860*                                                                 01586000
015870* ADD +# IS THE NUMBER TO BE ADDED TO THE OPERSET                 01587000
015880* EX 860 OPERSET IS 500 CREATING  875 OPERSET 800 === +300        01588000
015890*                                                                 01589000
015891     MOVE 816 TO DCFAAS-OPER-UNT-ID.                              01589100
015892     ADD -000 TO DCFAAS-OPER-SET-ID.                              01589200
015893                                                                  01589300
015894     PERFORM 2250-INSERT-NEW-TDCFAAS.                             01589400
015895                                                                  01589500
015896     PERFORM 2200-FETCH-TDCFAAS-CURSOR.                           01589600
015897                                                                  01589700
015898***************************************************************** 01589800
015899*    PROCESSES THE INPUT RECORDS                                  01589900
015900***************************************************************** 01590000
016000 2050-PROCESS-TDCTFAS.                                            01600000
016100                                                                  01610000
016200*                                                                 01620000
016300*  CHANGE                                                         01630000
016400*                                                                 01640000
016500     MOVE 816 TO DCTFAS-OPER-UNT-ID.                              01650001
016600                                                                  01660000
016700     PERFORM 2550-INSERT-NEW-TDCTFAS.                             01670000
016800                                                                  01680000
016900     PERFORM 2500-FETCH-TDCTFAS-CURSOR.                           01690000
016910                                                                  01691000
016920***************************************************************** 01692000
016930*    OPENS THE CURSOR TO GET ONE OR MORE ROWS FROM TRECDIS WHICH  01693000
016940*    CORRESPOND TO THE INPUT RECORD.                              01694000
016950***************************************************************** 01695000
016960 2100-OPEN-TDCFAAS-CURSOR.                                        01696000
016970                                                                  01697000
016980     EXEC SQL                                                     01698000
016990         OPEN DCFAAS_CSR                                          01699000
017000     END-EXEC.                                                    01700000
017100                                                                  01710000
017200     EVALUATE TRUE                                                01720000
017300         WHEN SQLCODE = +0                                        01730000
017400             CONTINUE                                             01740000
017500         WHEN OTHER                                               01750000
017600             MOVE '2100-OPEN-CURSOR'                              01760000
017700                                    TO PV-PARAGRAPH               01770000
017800             PERFORM 9900-DB2-ABEND                               01780000
017900     END-EVALUATE.                                                01790000
018000                                                                  01800000
018100***************************************************************** 01810000
018200*    PROCESSES THE ROWS FROM TRECDIS WHICH CORRESPOND TO THE      01820000
018300*    INPUT RECORD.                                                01830000
018400***************************************************************** 01840000
018500 2200-FETCH-TDCFAAS-CURSOR.                                       01850000
018600                                                                  01860000
018700     EXEC SQL                                                     01870000
018800         FETCH DCFAAS_CSR                                         01880000
018900         INTO   :DCFAAS-OPER-UNT-ID                               01890000
019000               ,:DCFAAS-FCLTY-ID                                  01900000
019100               ,:DCFAAS-DEPT-NBR                                  01910000
019200               ,:DCFAAS-CL-NBR                                    01920000
019300               ,:DCFAAS-FCLTY-LOC-TYP-CDE                         01930000
019400               ,:DCFAAS-RANK-NBR                                  01940000
019500               ,:DCFAAS-FCLTY-AREA-ID                             01950000
019600                         :PV-FCLTY-AREA-ID-NULL                   01960000
019700               ,:DCFAAS-OPER-SET-ID                               01970000
019800     END-EXEC.                                                    01980000
019900                                                                  01990000
020000     EVALUATE TRUE                                                02000000
020100         WHEN SQLCODE = +0                                        02010000
020200             ADD +1 TO FETCH-COUNT                                02020000
020300         WHEN SQLCODE = +100                                      02030000
020400             SET PS-END-OF-CURSOR TO TRUE                         02040000
020500         WHEN OTHER                                               02050000
020600             MOVE '2200-FETCH-TDCFAAS-CURSOR'                     02060000
020700                                    TO PV-PARAGRAPH               02070000
020800             PERFORM 9900-DB2-ABEND                               02080000
020900     END-EVALUATE.                                                02090000
021000                                                                  02100000
021100                                                                  02110000
021200***************************************************************** 02120000
021300*    PROCESSES THE ROWS FROM TRECDIS WHICH CORRESPOND TO THE      02130000
021400*    INPUT RECORD.                                                02140000
021500***************************************************************** 02150000
021600 2250-INSERT-NEW-TDCFAAS.                                         02160000
021700                                                                  02170000
021800     EXEC SQL                                                     02180000
021900        INSERT INTO TDCFAAS                                       02190000
022000                    ( OPER_UNT_ID                                 02200000
022100                     ,FCLTY_ID                                    02210000
022200                     ,DEPT_NBR                                    02220000
022300                     ,CL_NBR                                      02230000
022400                     ,FCLTY_LOC_TYP_CDE                           02240000
022500                     ,RANK_NBR                                    02250000
022600                     ,FCLTY_AREA_ID                               02260000
022700                     ,OPER_SET_ID  )                              02270000
022710             VALUES (:DCFAAS-OPER-UNT-ID                          02271000
022720                    ,:DCFAAS-FCLTY-ID                             02272000
022730                    ,:DCFAAS-DEPT-NBR                             02273000
022740                    ,:DCFAAS-CL-NBR                               02274000
022750                    ,:DCFAAS-FCLTY-LOC-TYP-CDE                    02275000
022760                    ,:DCFAAS-RANK-NBR                             02276000
022770                    ,:DCFAAS-FCLTY-AREA-ID                        02277000
022780                         :PV-FCLTY-AREA-ID-NULL                   02278000
022790                    ,:DCFAAS-OPER-SET-ID  )                       02279000
022800     END-EXEC.                                                    02280000
022900                                                                  02290000
023000     EVALUATE TRUE                                                02300000
023100         WHEN SQLCODE = +0                                        02310000
023200             ADD +1 TO INSERT-COUNT                               02320000
023300         WHEN OTHER                                               02330000
023400             MOVE '2200-INSERT-NEW-TDCFAAS  '                     02340000
023401                                    TO PV-PARAGRAPH               02340100
023402             PERFORM 9900-DB2-ABEND                               02340200
023403     END-EVALUATE.                                                02340300
023404                                                                  02340400
023405***************************************************************** 02340500
023406*    CLOSES THE CURSOR.                                           02340600
023407***************************************************************** 02340700
023408 2300-CLOSE-TDCFAAS-CURSOR.                                       02340800
023409                                                                  02340900
023410     EXEC SQL                                                     02341000
023420         CLOSE DCFAAS_CSR                                         02342000
023430     END-EXEC.                                                    02343000
023440                                                                  02344000
023450     EVALUATE TRUE                                                02345000
023460         WHEN SQLCODE = +0                                        02346000
023470             CONTINUE                                             02347000
023480         WHEN OTHER                                               02348000
023490             MOVE '2300-CLOSE-TDCFAAS-CURSOR '                    02349000
023500                                    TO PV-PARAGRAPH               02350000
023600             PERFORM 9900-DB2-ABEND                               02360000
023700     END-EVALUATE.                                                02370000
023800                                                                  02380000
023900***************************************************************** 02390000
024000*    OPENS THE CURSOR TO GET ONE OR MORE ROWS FROM TRECDIS WHICH  02400000
024100*    CORRESPOND TO THE INPUT RECORD.                              02410000
024200***************************************************************** 02420000
024300 2400-OPEN-TDCTFAS-CURSOR.                                        02430000
024400                                                                  02440000
024500     EXEC SQL                                                     02450000
024600         OPEN DCTFAS_CSR                                          02460000
024700     END-EXEC.                                                    02470000
024800                                                                  02480000
024900     EVALUATE TRUE                                                02490000
025000         WHEN SQLCODE = +0                                        02500000
025100             CONTINUE                                             02510000
025200         WHEN OTHER                                               02520000
025300             MOVE '2400-OPEN-TDCTFAS-CURSOR '                     02530000
025400                                    TO PV-PARAGRAPH               02540000
025500             PERFORM 9900-DB2-ABEND                               02550000
025600     END-EVALUATE.                                                02560000
025700                                                                  02570000
025800***************************************************************** 02580000
025900*    PROCESSES THE ROWS FROM TRECDIS WHICH CORRESPOND TO THE      02590000
026000*    INPUT RECORD.                                                02600000
026100***************************************************************** 02610000
026200 2500-FETCH-TDCTFAS-CURSOR.                                       02620000
026300                                                                  02630000
026400     EXEC SQL                                                     02640000
026500         FETCH DCTFAS_CSR                                         02650000
026600         INTO  :DCTFAS-OPER-UNT-ID                                02660000
026700              ,:DCTFAS-FCLTY-ID                                   02670000
026800              ,:DCTFAS-DEPT-NBR                                   02680000
026900              ,:DCTFAS-CL-NBR                                     02690000
027000              ,:DCTFAS-RANK-NBR                                   02700000
027100              ,:DCTFAS-TKT-FMT-ID :PV-TKT-FMT-ID-NULL             02710000
027200     END-EXEC.                                                    02720000
027300                                                                  02730000
027400     EVALUATE TRUE                                                02740000
027500         WHEN SQLCODE = +0                                        02750000
027600             ADD +1 TO FETCH-COUNT                                02760000
027700         WHEN SQLCODE = +100                                      02770000
027800             SET PS-END-OF-CURSOR TO TRUE                         02780000
027900         WHEN OTHER                                               02790000
028000             MOVE '2500-FETCH-TDCTFAS-CURSOR'                     02800000
028100                                    TO PV-PARAGRAPH               02810000
028200             PERFORM 9900-DB2-ABEND                               02820000
028300     END-EVALUATE.                                                02830000
028400                                                                  02840000
028500                                                                  02850000
028600***************************************************************** 02860000
028700*    PROCESSES THE ROWS FROM TRECDIS WHICH CORRESPOND TO THE      02870000
028800*    INPUT RECORD.                                                02880000
028900***************************************************************** 02890000
029000 2550-INSERT-NEW-TDCTFAS.                                         02900000
029100                                                                  02910000
029200     EXEC SQL                                                     02920000
029300              INSERT INTO TDCTFAS                                 02930000
029400                          ( OPER_UNT_ID                           02940000
029500                           ,FCLTY_ID                              02950000
029600                           ,DEPT_NBR                              02960000
029700                           ,CL_NBR                                02970000
029800                           ,RANK_NBR                              02980000
029900                           ,TKT_FMT_ID )                          02990000
030000                   VALUES (:DCTFAS-OPER-UNT-ID                    03000000
030100                          ,:DCTFAS-FCLTY-ID                       03010000
030200                          ,:DCTFAS-DEPT-NBR                       03020000
030300                          ,:DCTFAS-CL-NBR                         03030000
030400                          ,:DCTFAS-RANK-NBR                       03040000
030500                          ,:DCTFAS-TKT-FMT-ID                     03050000
030600                               :PV-TKT-FMT-ID-NULL )              03060000
030700     END-EXEC.                                                    03070000
030800                                                                  03080000
030900     EVALUATE TRUE                                                03090000
031000         WHEN SQLCODE = +0                                        03100000
031100             ADD +1 TO INSERT-COUNT                               03110000
031200         WHEN OTHER                                               03120000
031300              MOVE DCTFAS-OPER-UNT-ID   TO  PV-DISPLAY-OPER       03130000
031310              MOVE DCTFAS-FCLTY-ID      TO  PV-DISPLAY-FCLTY      03131000
031320              MOVE DCTFAS-DEPT-NBR      TO  PV-DISPLAY-DEPT       03132000
031330              MOVE DCTFAS-CL-NBR        TO  PV-DISPLAY-CL         03133000
031340              MOVE DCTFAS-RANK-NBR      TO  PV-DISPLAY-RANK       03134000
031350              STRING PV-DISPLAY-OPER  '-'                         03135000
031360                     PV-DISPLAY-FCLTY '-'                         03136000
031370                     PV-DISPLAY-DEPT  '-'                         03137000
031380                     PV-DISPLAY-CL    '-'                         03138000
031390                     PV-DISPLAY-RANK  DELIMITED BY SIZE           03139000
031391                INTO PV-ERROR-INFO                                03139100
031392              MOVE '2550-INSERT-NEW-TDCTFAS  '                    03139200
031393                                        TO PV-PARAGRAPH           03139300
031394             PERFORM 9900-DB2-ABEND                               03139400
031395     END-EVALUATE.                                                03139500
031396                                                                  03139600
031397***************************************************************** 03139700
031398*    CLOSES THE CURSOR.                                           03139800
031399***************************************************************** 03139900
031400 2600-CLOSE-TDCTFAS-CURSOR.                                       03140000
031500                                                                  03150000
031600     EXEC SQL                                                     03160000
031700         CLOSE DCTFAS_CSR                                         03170000
031800     END-EXEC.                                                    03180000
031900                                                                  03190000
032000     EVALUATE TRUE                                                03200000
032100         WHEN SQLCODE = +0                                        03210000
032200             CONTINUE                                             03220000
032300         WHEN OTHER                                               03230000
032400             MOVE '2600-CLOSE-TDCTFAS-CURSOR '                    03240000
032500                                    TO PV-PARAGRAPH               03250000
032600             PERFORM 9900-DB2-ABEND                               03260000
032700     END-EVALUATE.                                                03270000
032800                                                                  03280000
032900******************************************************************03290000
033000*    PERFORMS ABEND AFTER UNEXPECTED SQLCODE.                     03300000
033100******************************************************************03310000
033200 9900-DB2-ABEND.                                                  03320000
033300                                                                  03330000
033400     DISPLAY '** ABEND **'.                                       03340000
033500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        03350000
033600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   03360000
033700     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                03370000
033800     DISPLAY '** DATA      ** = ' PV-ERROR-INFO.                  03380000
033900                                                                  03390000
034000* ROUTINE TO DISPLAY ABEND IN READABLE FORMAT                     03400000
034100     COPY DPPD004.                                                03410000
034200                                                                  03420000
034300     EXEC SQL                                                     03430000
034400         ROLLBACK                                                 03440000
034500     END-EXEC.                                                    03450000
034600                                                                  03460000
034700     SET ABEND-4013-DB2-ERROR TO TRUE.                            03470000
034800     CALL 'ILBOABN0' USING ABEND-CODE.                            03480000
034900                                                                  03490000
