000100******************************************************************00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300******************************************************************00030002
000400                                                                  00040002
000500 PROGRAM-ID.                VLKCS587.                             00050014
000600 AUTHOR.                    MICHAEL WALTERS.                      00060002
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070002
000800 DATE-WRITTEN.              06-03-96.                             00080002
000900 DATE-COMPILED.                                                   00090002
001000                                                                  00100002
001100******************************************************************00110002
001200*  CICS PROGRAM - VLKCS587 - W087                                *00120014
001300*                                                                *00130002
001400*       PO SYSTEM PRETICKET DETAIL INQUIRE SCREEN                *00140002
001500*                                                                *00150002
001600*  THIS SCREEN WILL SHOW THE DETAIL OF ONE PRETICKET REQUEST     *00160002
001700******************************************************************00170002
263627*---------------------------------------------------------------* 00171022
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627         00172022
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00173022
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00174022
263627*---------------------------------------------------------------* 00175022
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236         00176023
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00177023
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00178023
CICS  ***************************************************************** 00179023
001800                                                                  00180002
002000 ENVIRONMENT DIVISION.                                            00200002
002100                                                                  00210002
002200 DATA DIVISION.                                                   00220002
002300                                                                  00230002
002400 WORKING-STORAGE SECTION.                                         00240002
002500                                                                  00250002
002600 01  DK-DB2-KEYS.                                                 00260002
002700     05  DK-PO-NUMBER                   PIC S9(09) COMP.          00270002
002800     05  DK-PO-REQ-NBR                  PIC S9(09) COMP.          00280002
002900     05  DK-ENT-ID                      PIC S9(09) COMP.          00290002
003000     05  DK-ADDR-SEQ-NBR                PIC S9(04) COMP.          00300002
003600                                                                  00360002
003700 01  PC-PROGRAM-CONSTANTS.                                        00370002
004300     05  PC-PRETICKET-FUNCTION-ID       PIC S9(04)  COMP          00430002
004400                                                    VALUE +5.     00440002
004800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00480002
004900                                                    'VL587A  '.   00490014
005000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00500002
005100                                                    'VLKM587 '.   00510014
005200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00520002
005300                                                    'VLKCS587'.   00530014
005600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00560002
005700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00570002
005900     05  PC-FORMAT-INDICATOR            PIC  X(01) .              00590002
006000         88 PC-CRIT-SPEC-FORMAT-IND     VALUE '1'.                00600014
006100         88 PC-LIST-FORMAT-IND          VALUE '2', '3'.           00610014
006200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +04     00620002
006300                                                    COMP SYNC.    00630002
006400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00640002
006500                                                    COMP SYNC.    00650002
006600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00660002
006700                                                    +10000        00670002
006800                                                    COMP-3.       00680002
006900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00690002
007000                                                    COMP-3.       00700002
007600     05  PC-DPKUT410                    PIC  X(08) VALUE          00760014
007601                                                   'DPKUT410'.    00760114
007602*                                                                 00760202
007700     05  PC-TSYMSG-NUMBERS.                                       00770002
007800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00830020
008300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00840020
009100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00910002
009200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00920002
009300         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00930002
009400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00940002
009600         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00960002
009700*                                                                 00970002
009800 01  PS-PROGRAM-SWITCHES.                                         00980002
010200     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01020002
010300         88  PS-NO-ERROR                            VALUE 'Y'.    01030002
010400         88  PS-ERROR                               VALUE 'N'.    01040002
011100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01110002
011200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01120002
011300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01130002
012000*                                                                 01200002
012100 01  PV-PROGRAM-VARIABLES.                                        01210002
012110     05  PV-TICKET-QUANTITY             PIC S9(09) COMP.          01211005
013300     05  PV-DISPLAY-ABEND-MESSAGE       PIC  X(79) VALUE SPACES.  01330014
013310     05  PV-DISPLAY-QTY                 PIC  Z,ZZZ,ZZ9.           01331014
013400     05  PV-DISPLAY-COMP1               PIC  9(09).               01340014
013410     05  PV-DISPLAY-COMP2               PIC  9(09).               01341014
014000     05  PV-DATE-ISO.                                             01400002
014100         10  PV-ISO-CC                  PIC  X(02).               01410002
014200         10  PV-ISO-YY                  PIC  X(02).               01420002
014300         10  FILLER                     PIC  X.                   01430002
014400         10  PV-ISO-MM                  PIC  X(02).               01440002
014500         10  FILLER                     PIC  X.                   01450002
014600         10  PV-ISO-DD                  PIC  X(02).               01460002
015100     05  PV-DISPLAY-DATE.                                         01510002
015200         10  PV-DISP-MM                 PIC  X(02).               01520002
015300         10  FILLER                     PIC  X VALUE '/'.         01530002
015400         10  PV-DISP-DD                 PIC  X(02).               01540002
015500         10  FILLER                     PIC  X VALUE '/'.         01550002
015600         10  PV-DISP-CC                 PIC  X(02).               01560002
015700         10  PV-DISP-YY                 PIC  X(02).               01570002
015800                                                                  01580002
016900     05  PV-RANDOM-KEY          PIC 9(09).                        01690002
017000     05  FILLER REDEFINES PV-RANDOM-KEY.                          01700002
017100         10  PV-RND-NANOSEC-4-6 PIC X(03).                        01710002
017200         10  PV-RND-NANOSEC-1-3 PIC X(03).                        01720002
017300         10  PV-RND-MINUTE      PIC X(02).                        01730002
017400         10  PV-RND-SECOND      PIC X(01).                        01740002
017500                                                                  01750002
018400     05  PV-SUB                         PIC S9(04)  VALUE +0      01840002
018500                                                    COMP SYNC.    01850002
018600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01860002
018700                                                    COMP SYNC.    01870002
018800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01880002
018900                                                    COMP-3.       01890002
019000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01900002
019100                                                    COMP-3.       01910002
019200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01920002
019300                                                    COMP-3.       01930002
019600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01960002
019700                                                    COMP-3.       01970002
019800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01980002
019900                                                    COMP-3.       01990002
020200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02020002
020300                                                    COMP SYNC.    02030002
020400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02040002
020500                                                    COMP SYNC.    02050002
020600     05  PV-ITEM                        PIC S9(04)  VALUE +0      02060002
020700                                                    COMP SYNC.    02070002
020800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02080002
020900                                                    COMP SYNC.    02090002
021000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02100002
021100                                                    COMP SYNC.    02110002
021200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02120002
021300                                                    COMP SYNC.    02130002
021400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02140002
021500                                                    COMP SYNC.    02150002
023200     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02320002
023300                                                    COMP SYNC.    02330002
023400     05  PV-STATE-PROV                  PIC  X(20).               02340014
023500     05  PV-COUNTRY                     PIC  X(20).               02350014
023600     05  PV-DPKUT410-COMMAREA         PIC  X(01)   VALUE SPACES.  02360014
023601                                                                  02360114
023602******************************************************************02360202
023603**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02360302
023604**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02360402
023700**  APPLICATION-SPECIFIC COMMAREA.                              **02370002
023800******************************************************************02380002
023900 01  LQW-LIST-QUEUE-WORK-AREA.                                    02390002
024000     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02400002
024100     05  LQW-ITEM-ENTRIES               OCCURS 04 TIMES           02410014
024200                                        INDEXED BY LQW-IDX.       02420002
024300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02430002
024400         10  LQW-CARRIER-NAME           PIC  X(20).               02440002
024500         10  LQW-SHIP-DATE              PIC  X(10).               02450002
024600         10  LQW-SHIP-METHOD            PIC  X(10).               02460002
024700         10  LQW-SHIP-NBR               PIC  X(19).               02470004
024800                                                                  02480002
024900     EJECT                                                        02490002
025000*---------------------------------------------------------------* 02500002
025100*  RECORD LAYOUT FOR THE LINE SELECTION TEMP STORAGE QUEUE.     * 02510002
025200*---------------------------------------------------------------* 02520002
025300                                                                  02530002
025400     COPY VLWS006.                                                02540014
025500                                                                  02550002
025600     EJECT                                                        02560002
025700*---------------------------------------------------------------* 02570002
025800*  RECORD LAYOUT FOR THE ADDRESS TEMP STORAGE QUEUE.            * 02580002
025900*---------------------------------------------------------------* 02590002
026000                                                                  02600002
026100     COPY VLWS007.                                                02610019
026200                                                                  02620002
026400*---------------------------------------------------------------* 02640002
026500*    MAP LAYOUT                                                 * 02650002
026600*---------------------------------------------------------------* 02660002
026700                                                                  02670002
026800     COPY VLKM587.                                                02680014
026900*                                                                 02690002
027000 01  MR-OCCURS-LAYOUT                   REDEFINES  VL587AO.       02700014
027100     05  FILLER                         PIC X(541).               02710014
027200     05  MR-SCROLL-AREA                 OCCURS 04 TIMES.          02720014
027300         10  FILLER                     PIC  X(05).               02730002
027400         10  MR-CARRIER-NAME            PIC  X(20).               02740002
027500                                                                  02750002
027600         10  FILLER                     PIC  X(05).               02760002
027700         10  MR-SHIP-DATE               PIC  X(10).               02770002
027800                                                                  02780002
027900         10  FILLER                     PIC  X(05).               02790002
028000         10  MR-SHIP-METHOD             PIC  X(10).               02800002
028100                                                                  02810002
028200         10  FILLER                     PIC  X(05).               02820002
028300         10  MR-SHIP-NUMBER             PIC  X(19).               02830004
028400                                                                  02840002
028500                                                                  02850002
028700******************************************************************02870016
028800*  WORKING STORAGE AREA FOR COUNTRY AND STATE RETRIEVAL           02880014
028900******************************************************************02890014
029000     COPY DPWS410.                                                02900019
029001                                                                  02900114
029002*---------------------------------------------------------------* 02900202
029003*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02900302
029004*---------------------------------------------------------------* 02900402
029005                                                                  02900502
029100     COPY DPWS015.                                                02910019
029200                                                                  02920002
029300*---------------------------------------------------------------* 02930002
029400*    FUNCTION KEYS COPYBOOK.                                    * 02940002
029500*---------------------------------------------------------------* 02950002
029600                                                                  02960002
029700     COPY DPWS016.                                                02970019
029800                                                                  02980002
029802*---------------------------------------------------------------* 02980214
029803*    NUMERIC EDIT LAYOUT.                                       * 02980314
029804*---------------------------------------------------------------* 02980414
029805                                                                  02980514
029806     COPY DPWS010I.                                               02980619
029810                                                                  02981019
029900*---------------------------------------------------------------* 02990002
030000*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03000023
030100*---------------------------------------------------------------* 03010002
030200                                                                  03020002
030300     COPY DPWS030.                                                03030019
CICS       COPY DPWS930.                                                03031023
030400                                                                  03040002
030600*---------------------------------------------------------------* 03060002
030700*    STANDARD COMMAREA.                                         * 03070002
030800*---------------------------------------------------------------* 03080002
030900                                                                  03090002
031000     COPY DPWS020.                                                03100019
031100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03110002
031200                                                                  03120002
031300*---------------------------------------------------------------* 03130002
031400* INTER-APPLICATION COMMAREA.                                   * 03140002
031500*   POWS071 - IS THE INPUT LAYOUT WHEN COMING FROM THE PURCHASE * 03150002
031600*             ORDER ADD/UPDATE PROGRAM (POKCS003)               * 03160002
031700*   POWS071 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03170002
031800*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03180002
031900*---------------------------------------------------------------* 03190002
032000                                                                  03200002
032100         10  INTER-APPL-COMM-AREA       PIC X(200).               03210002
032200     COPY VLWS005.                                                03220019
032300*---------------------------------------------------------------* 03230002
032400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03240002
032500*---------------------------------------------------------------* 03250002
032600         10  ASC-SPECIFIC-COMMAREA.                               03260002
032700             15  ASC-PO-REQ-NBR                      PIC S9(09)   03270002
032800                                                     COMP.        03280002
032900             15  ASC-ENT-ID                          PIC S9(09)   03290002
033000                                                     COMP.        03300002
033100             15  ASC-SCREEN-FIELDS.                               03310002
033200                 20  ASC-PO-NUMBER                   PIC S9(09)   03320002
033300                                                     COMP.        03330002
033400                 20  ASC-REQ-STAT-CDE                PIC  X(01).  03340002
033410                     88 ASC-ACTIVE-STATUS             VALUE 'A'.  03341010
033420                     88 ASC-CANCELLED-STATUS          VALUE 'C'.  03342010
033430                     88 ASC-HOLD-STATUS               VALUE 'H'.  03343010
033441                     88 ASC-INPROCESS-STATUS          VALUE 'I'.  03344110
033442                     88 ASC-PRINT-STATUS              VALUE 'P'.  03344210
033443                     88 ASC-RUSH-STATUS               VALUE 'R'.  03344310
033444                     88 ASC-SHIPPED-STATUS            VALUE 'S'.  03344410
033500                 20  ASC-REQ-STAT-CDE-DESC           PIC  X(10).  03350002
033501                     88 ASC-ACTIVE-STATUS-DESC                    03350109
033502                     VALUE 'ACTIVE    '.                          03350210
033503                     88 ASC-CANCELLED-STATUS-DESC                 03350309
033504                     VALUE 'CANCELLED '.                          03350410
033505                     88 ASC-HOLD-STATUS-DESC                      03350509
033506                     VALUE 'HOLD      '.                          03350610
033507                     88 ASC-INPROCESS-STATUS-DESC                 03350709
033509                     VALUE 'INPROCESS '.                          03350910
033510                     88 ASC-PRINT-STATUS-DESC                     03351009
033512                     VALUE 'PRINTED   '.                          03351210
033513                     88 ASC-RUSH-STATUS-DESC                      03351309
033514                     VALUE 'RUSH      '.                          03351410
033515                     88 ASC-SHIPPED-STATUS-DESC                   03351509
033516                     VALUE 'SHIPPED   '.                          03351610
033600                 20  ASC-REQUEST-DATE                PIC  X(10).  03360002
033700                 20  ASC-PRINT-DATE                  PIC  X(10).  03370002
033800                 20  ASC-VENDOR-DUE-DATE             PIC  X(10).  03380002
033900                 20  ASC-REQUEST-QUANTITY.                        03390004
034000                     25 ASC-REQUEST-QUANTITY-N       PIC  9(09).  03400004
034010                 20  ASC-VENDOR-NAME                 PIC  X(40).  03401014
034100                 20  ASC-ADDR-SEQ-NBR                PIC S9(04)   03410002
034200                                                         COMP.    03420002
034300                 20  ASC-ADDR-LINE-TABLE.                         03430002
034400                     25  FILLER OCCURS 08 TIMES                   03440012
034500                         INDEXED BY ASC-ADDR-IDX.                 03450002
034600                         30  ASC-ADDR-LINE           PIC  X(40).  03460002
034700             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03470002
034800                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03480002
034900                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03490002
035000                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03500002
035100                                                                  03510002
035200                 20  ASC-ITEM-ARRAY.                              03520002
035300                     25  ASC-ITEM-ENTRIES OCCURS 04 TIMES.        03530002
035400                         30  ASC-LIST-ITEM-NUMBER                 03540002
035500                                                     PIC S9(09)   03550002
035600                                                     COMP-3.      03560002
035700                         30  ASC-CARRIER-NAME        PIC  X(20).  03570002
035800                         30  ASC-SHIP-DATE           PIC  X(10).  03580002
035900                         30  ASC-SHIP-METHOD         PIC  X(10).  03590002
036000                         30  ASC-SHIP-NBR            PIC  X(20).  03600002
036100                                                                  03610002
036200             15  ASC-BLK-SUB                         PIC S9(04)   03620002
036300                                                          COMP    03630002
036400                                                          SYNC.   03640002
036500             15  ASC-ITEM-SUB                        PIC S9(04)   03650002
036600                                                          COMP    03660002
036700                                                          SYNC.   03670002
036800             15  ASC-SEL-SUB                         PIC S9(04)   03680002
036900                                                         COMP.    03690002
037000             15  ASC-SEL-ITEM                        PIC S9(04)   03700002
037100                                                         COMP.    03710002
037200             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  03720002
037300                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03730002
037400             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03740002
037500                                                          COMP-3. 03750002
037600             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03760002
037700                                                          COMP-3. 03770002
037800             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   03780002
037900                                                          COMP-3. 03790002
038000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03800002
038100                                                          COMP-3. 03810002
038200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03820002
038300                                                          COMP-3. 03830002
038400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03840002
038500                                                          COMP-3. 03850002
038600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03860002
038700                                                          COMP    03870002
038800                                                          SYNC.   03880002
038900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03890002
039000                                                          COMP-3. 03900002
039100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03910002
039200                                                          COMP-3. 03920002
039300             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03930002
039400                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03940002
039500                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03950002
039600             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03960002
039700                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03970002
039800                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03980002
039900             15  ASC-LIST-QUEUE-NAME.                             03990002
040000                 20  ASC-LIST-TERM-ID                PIC  X(04).  04000002
040100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04010002
040200                                                          COMP-3. 04020002
040300                 20  ASC-LIST-SEQ                    PIC  9(01).  04030002
040400             15  ASC-SEL-QUEUE-NAME.                              04040002
040500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04050002
040600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04060002
040700                                                          COMP-3. 04070002
040800                 20  ASC-SEL-SEQ                     PIC  9(01).  04080002
040900                                                                  04090002
041000             15  ASC-START-ITEM-REQUEST.                          04100002
041100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04110002
041200                                                                  04120019
041300*---------------------------------------------------------------* 04130002
041400*    ABEND PROCESSING COPYBOOK.                                 * 04140002
041500*---------------------------------------------------------------* 04150002
041600                                                                  04160002
041700     COPY DPWS013.                                                04170019
041800                                                                  04180002
042000*---------------------------------------------------------------* 04200002
042100*    DB2 AREA FOR THE BUISNESS LOCATION TABLE                   * 04210002
042200*---------------------------------------------------------------* 04220002
042300     EXEC SQL                                                     04230002
042400          INCLUDE TBUSLOC                                         04240002
042500     END-EXEC.                                                    04250002
042600                                                                  04260019
042700*---------------------------------------------------------------* 04270002
042800*    DB2 AREA FOR THE PRETICKET REQUEST/SHIPMENT ASSOCIATION TBL* 04280005
042900*---------------------------------------------------------------* 04290002
043000     EXEC SQL                                                     04300002
043100          INCLUDE TREQSHP                                         04310005
043200     END-EXEC.                                                    04320002
043201                                                                  04320119
043202*---------------------------------------------------------------* 04320205
043203*    DB2 AREA FOR THE PRETICKET REQUEST SHIPMENT TABLE          * 04320305
043204*---------------------------------------------------------------* 04320405
043205     EXEC SQL                                                     04320505
043206          INCLUDE TPTKSHP                                         04320605
043207     END-EXEC.                                                    04320705
043210                                                                  04321019
043220*---------------------------------------------------------------* 04322005
043230*    DB2 AREA FOR THE PRETICKET REQUEST HEADER TABLE            * 04323005
043240*---------------------------------------------------------------* 04324005
043250     EXEC SQL                                                     04325005
043260          INCLUDE TPTKREQ                                         04326005
043270     END-EXEC.                                                    04327005
043300                                                                  04330019
043400*---------------------------------------------------------------* 04340002
043500*    DB2 AREA FOR THE EXTERNAL ENTERPRISE TABLE                 * 04350005
043600*---------------------------------------------------------------* 04360002
043700     EXEC SQL                                                     04370002
043800          INCLUDE TEXTENT                                         04380005
043900     END-EXEC.                                                    04390002
043910                                                                  04391019
043911*---------------------------------------------------------------* 04391113
043912*    DB2 AREA FOR THE ENTERPRISE REP TABLE                      * 04391213
043913*---------------------------------------------------------------* 04391313
043914     EXEC SQL                                                     04391413
043915          INCLUDE TENTREP                                         04391513
043916     END-EXEC.                                                    04391613
043917                                                                  04391719
043918*---------------------------------------------------------------* 04391805
043919*    DB2 AREA FOR THE EXTERNAL ENTERPRISE NAME TABLE            * 04391905
043920*---------------------------------------------------------------* 04392005
043921     EXEC SQL                                                     04392105
043922          INCLUDE TENTNME                                         04392205
043923     END-EXEC.                                                    04392305
043924                                                                  04392419
043925*---------------------------------------------------------------* 04392505
043930*    DB2 AREA FOR THE PRETICKET REQUEST LINE ITEM TABLE         * 04393005
043940*---------------------------------------------------------------* 04394005
043950     EXEC SQL                                                     04395005
043960          INCLUDE TPTKLNE                                         04396005
043970     END-EXEC.                                                    04397005
044000                                                                  04400019
044100*---------------------------------------------------------------* 04410002
044200*    DB2 AREA FOR COMMUNICATIONS                                * 04420002
044300*---------------------------------------------------------------* 04430002
044400     EXEC SQL                                                     04440002
044500          INCLUDE SQLCA                                           04450002
044600     END-EXEC.                                                    04460002
044700                                                                  04470002
044900*---------------------------------------------------------------* 04490002
045000* SHIPMENT_CURSOR - GETS THE DETAIL OF ALL THE SHIPMENTS FOR THIS*04500002
045100* PURCHASE ORDER.                                               * 04510002
045200*---------------------------------------------------------------* 04520002
045300                                                                  04530002
045400     EXEC SQL                                                     04540002
045500          DECLARE SHIPMENT_CURSOR CURSOR                          04550002
045600          FOR SELECT                                              04560002
045700                B.CARR_SHIPT_ID                                   04570002
045800              , B.SHIPT_DTE                                       04580002
045900              , B.SHIPT_TYP_DESC                                  04590002
046000              , C.ENT_NAME_DESC                                   04600003
046100          FROM                                                    04610002
046200                TREQSHP A                                         04620002
046300              , TPTKSHP B                                         04630002
046310              , TENTNME C                                         04631003
046320              , TEXTENT D                                         04632005
046400          WHERE                                                   04640002
046500                A.PO_REQ_NBR     = :DK-PO-REQ-NBR                 04650002
046600            AND A.SHIPT_NBR      = B.SHIPT_NBR                    04660002
046611            AND B.SCAC_CDE       = D.SCAC_CDE                     04661114
046612            AND C.ENT_ID         = D.ENT_ID                       04661205
046620            AND D.STATUS_CDE     = 'A'                            04662005
046630            AND C.TYPE_CDE       = '01'                           04663005
046700          ORDER BY                                                04670002
046800                2,4                                               04680002
046900     END-EXEC.                                                    04690002
047200                                                                  04720002
047400 LINKAGE SECTION.                                                 04740002
047500                                                                  04750002
047600 01  DFHCOMMAREA.                                                 04760002
047700     05  FILLER                         OCCURS  1 TO 4072 TIMES   04770002
047800                                        DEPENDING ON EIBCALEN.    04780002
047900         10  FILLER                     PIC X.                    04790002
048000                                                                  04800002
048200 PROCEDURE DIVISION.                                              04820002
048300******************************************************************04830002
048400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04840002
048500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04850002
048600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04860002
048700******************************************************************04870002
048800 0000-MAIN-MODULE.                                                04880002
048900     INITIALIZE DP030-CICS-API-FIELDS.                            04890002
049000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04900002
049100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04910002
049200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04920002
049300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04930002
049400     MOVE LENGTH OF VL587AI        TO DP030-MAP-LENGTH (1).       04940014
049500     MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              04950002
049510     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04951014
049600     PERFORM 0001-CALL-CICS-ARCH-API.                             04960002
049700*                                                                 04970002
049800     PERFORM 1000-CONTROL-PROCESSING                              04980002
049900*                                                                 04990002
050000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05000002
050100     PERFORM 0001-CALL-CICS-ARCH-API.                             05010002
050200                                                                  05020002
050300******************************************************************05030002
050400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05040002
050500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05050002
050600******************************************************************05060002
050700 0001-CALL-CICS-ARCH-API.                                         05070002
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05080023
050900                                    DFHCOMMAREA                   05090023
051000                                    DP030-CICS-API-FIELDS         05100023
051100                                    DP020-STANDARD-COMMAREA       05110023
051200                                    VL587AI.                      05120023
051300*                                                                 05130002
051400     IF  DP030-RC-CALL-SUCCESSFUL                                 05140002
051500         CONTINUE                                                 05150002
051600     ELSE                                                         05160002
051700         SET DP013-NO-ROLLBACK                                    05170002
051800             DP013-XCTL-DISPLAY-RESTART                           05180002
051900             DP013-CICS-ABEND      TO TRUE                        05190002
052000         MOVE '0001-CALL-CICS-ARCH-API'                           05200002
052100                                   TO DP013-PARAGRAPH             05210002
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05211023
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05212023
052400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05240002
052500         PERFORM DP013-0000-PROCESS-ABEND                         05250002
052600     END-IF.                                                      05260002
052700*----------------------------------------------------------------*05270002
052800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05280002
052900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05290002
053000*                                                                *05300002
053100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05310002
053200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05320002
053300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05330002
053400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05340002
053500*----------------------------------------------------------------*05350002
053700 1000-CONTROL-PROCESSING.                                         05370002
053900     EVALUATE TRUE                                                05390002
054000         WHEN DP020-NEXT-ACT-INITIAL                              05400002
054100             INITIALIZE ASC-SPECIFIC-COMMAREA                     05410002
054200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05420002
054300                                      ASC-SEL-TERM-ID             05430002
054400             MOVE DP020-SRC-TASK-NUMBER                           05440002
054500                                   TO ASC-LIST-TASK-NUMBER        05450002
054600                                      ASC-SEL-TASK-NUMBER         05460002
054700             MOVE DP020-INT-APPL-FORMAT-IND                       05470002
054800                                   TO  PC-FORMAT-INDICATOR        05480002
054900             MOVE PC-LIST-QUEUE-SEQ                               05490002
055000                                   TO ASC-LIST-SEQ                05500002
055100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05510002
055200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05520002
055300***-----$TEMPLATE NOTE$-------------------------------------------05530002
055400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05540002
055500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05550002
055600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05560002
055700***---------------------------------------------------------------05570002
055800             IF  PS-COMMAREA-NOT-VALID                            05580002
055900                 MOVE PC-TSYMSG-99901                             05590002
056000                                   TO DP020-MSG-NUMBER            05600002
056100                 SET DP020-MSG-FATAL                              05610002
056200                                   TO TRUE                        05620002
056300                 SET DP020-NEXT-ACT-APPL-ERROR                    05630002
056400                                   TO TRUE                        05640002
056500             ELSE                                                 05650002
056600                 PERFORM 4000-BUILD-INITIAL-PANEL                 05660002
056700             END-IF                                               05670002
057200                                                                  05720002
057300         WHEN DP020-NEXT-ACT-READ-MAP                             05730002
057400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05740002
057500                                   TO PV-TOP-ITEM                 05750002
057600             PERFORM 2000-PROCESS-PANEL                           05760002
057700                                                                  05770002
057800         WHEN DP020-NEXT-ACT-RETURN                               05780002
057900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05790002
058000                                   TO PV-TOP-ITEM                 05800002
058100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05810002
058200             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05820002
058300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05830002
058400                                                                  05840002
058500         WHEN OTHER                                               05850002
058600             SET DP013-LOGIC-ABEND TO TRUE                        05860002
058700             SET DP013-NO-ROLLBACK TO TRUE                        05870002
058800             MOVE '1000-CONTROL-PROCESSING'                       05880002
058900                                   TO DP013-PARAGRAPH             05890002
059000             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05900002
059100                                   TO DP013-MESSAGE-TEXT(1)       05910002
059200             PERFORM DP013-0000-PROCESS-ABEND                     05920002
059300     END-EVALUATE.                                                05930002
059400                                                                  05940002
059600*----------------------------------------------------------------*05960002
059700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05970002
059800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05980002
059900*----------------------------------------------------------------*05990002
060100 1100-PROCESS-INTER-APPL-COMM.                                    06010002
060300     SET PS-COMMAREA-VALID         TO TRUE.                       06030002
060400     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06040002
060500     EVALUATE TRUE                                                06050002
060600         WHEN PC-CRIT-SPEC-FORMAT-IND                             06060002
060700                                                                  06070002
060800             MOVE VL005-PO-REQ-NBR     TO ASC-PO-REQ-NBR          06080014
060900                                          DK-PO-REQ-NBR           06090002
061000                                                                  06100002
061100             MOVE VL005-ENT-ID         TO ASC-ENT-ID              06110014
061200                                          DK-ENT-ID               06120002
061300                                                                  06130002
061400         WHEN PC-LIST-FORMAT-IND                                  06140002
061500             SET ASC-USE-SELECTION-QUEUE TO TRUE                  06150002
061600             MOVE VL005-NUMBER-OF-TS-ITEMS                        06160014
061700                               TO ASC-NUMBER-OF-TS-ITEMS          06170002
061800             MOVE VL005-SEL-QUEUE-NAME                            06180014
061900                               TO ASC-SEL-QUEUE-NAME              06190002
062000             PERFORM 1120-PREPARE-LIST-ENTRY                      06200002
062100         WHEN OTHER                                               06210002
062200             SET PS-COMMAREA-NOT-VALID TO TRUE                    06220002
062300     END-EVALUATE.                                                06230002
062400                                                                  06240002
062500*----------------------------------------------------------------*06250002
062600*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *06260002
062700*----------------------------------------------------------------*06270002
062900 1120-PREPARE-LIST-ENTRY.                                         06290002
063000                                                                  06300002
063100     MOVE VL006-MAX-ITEMS TO ASC-SEL-SUB.                         06310014
063200     MOVE ZERO            TO ASC-SEL-ITEM.                        06320002
063300     PERFORM 1130-GET-NEXT-REQUEST.                               06330008
063400                                                                  06340002
063500*----------------------------------------------------------------*06350002
063600*    GET THE NEXT REQUEST IF A LIST OF REQUESTS IS BEING         *06360008
063700*    PROCESSED.                                                  *06370002
063800*----------------------------------------------------------------*06380002
064000 1130-GET-NEXT-REQUEST.                                           06400008
064200     ADD +1                       TO ASC-SEL-SUB.                 06420002
064300     IF  ASC-SEL-SUB > VL006-MAX-ITEMS                            06430014
064400         ADD +1                   TO ASC-SEL-ITEM                 06440002
064500         MOVE +1                  TO ASC-SEL-SUB                  06450002
064600     END-IF.                                                      06460002
064700     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                06470002
064800         PERFORM 9100-READ-SEL-QUEUE                              06480002
064900         IF  VL006-ITEM (ASC-SEL-SUB) > ZERO                      06490014
065000                                                                  06500002
065100             MOVE VL006-PO-REQ-NBR (ASC-SEL-SUB)                  06510014
065200                                       TO ASC-PO-REQ-NBR          06520002
065300                                          DK-PO-REQ-NBR           06530002
065400             MOVE VL006-ENT-ID (ASC-SEL-SUB)                      06540014
065500                                       TO ASC-ENT-ID              06550002
065600                                          DK-ENT-ID               06560002
065700             SET VL006-INQ (ASC-SEL-SUB) TO TRUE                  06570014
065800             PERFORM 9200-REWRITE-SEL-QUEUE                       06580002
065900         ELSE                                                     06590002
066000             SUBTRACT +1 FROM ASC-SEL-SUB                         06600002
066100             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             06610002
066200             SET DP020-MSG-INFORMATIONAL TO TRUE                  06620002
066300         END-IF                                                   06630002
066400     ELSE                                                         06640002
066500         SUBTRACT +1 FROM ASC-SEL-ITEM                            06650002
066600         MOVE VL006-MAX-ITEMS     TO ASC-SEL-SUB                  06660014
066700         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             06670002
066800         SET DP020-MSG-INFORMATIONAL TO TRUE                      06680002
066900     END-IF.                                                      06690002
067000                                                                  06700002
067300*----------------------------------------------------------------*06730002
067400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06740002
067500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06750002
067600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06760002
067700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06770002
067800* FUNCTION KEYS CAN GET THIS FAR.                                *06780002
067900*----------------------------------------------------------------*06790002
068100 2000-PROCESS-PANEL.                                              06810002
068200     EVALUATE TRUE                                                06820002
068300         WHEN DP020-SRC-AID = DP016-CLEAR                         06830002
068400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06840002
068500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06850002
068600                                                                  06860002
068700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06870002
068800             MOVE ASC-PO-NUMBER    TO DK-PO-NUMBER                06880002
068900             MOVE ASC-PO-REQ-NBR   TO DK-PO-REQ-NBR               06890002
069000             MOVE ASC-ENT-ID       TO DK-ENT-ID                   06900002
069200             MOVE DP020-INT-APPL-FORMAT-IND                       06920002
069300                                   TO  PC-FORMAT-INDICATOR        06930002
069400             PERFORM 2050-DELETE-LIST-QUEUE                       06940002
069600             PERFORM 4000-BUILD-INITIAL-PANEL                     06960002
069700                                                                  06970002
069900         WHEN OTHER                                               06990002
070000                 PERFORM 2100-CHECK-FUNCTION-KEY                  07000002
070100     END-EVALUATE.                                                07010002
070200 EJECT                                                            07020002
070201*----------------------------------------------------------------*07020104
070202*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07020204
070203*----------------------------------------------------------------*07020304
070204 2050-DELETE-LIST-QUEUE.                                          07020404
070205                                                                  07020504
070206     EXEC CICS                                                    07020604
070207         DELETEQ TS                                               07020704
070208             QUEUE (ASC-LIST-QUEUE-NAME)                          07020804
070209             RESP  (PV-CICS-RESP)                                 07020904
070210     END-EXEC.                                                    07021004
070211                                                                  07021104
070212     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07021204
070213        (PV-CICS-RESP = DFHRESP(QIDERR))                          07021304
070214         CONTINUE                                                 07021404
070215     ELSE                                                         07021504
070216         SET DP013-CICS-ABEND      TO TRUE                        07021604
070217         SET DP013-NO-ROLLBACK     TO TRUE                        07021704
070218                                                                  07021804
070219         MOVE '2050-DELETE-LIST-QUEUE'                            07021904
070220                                   TO DP013-PARAGRAPH             07022004
070221         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07022104
070222                                   TO DP013-MESSAGE-TEXT (1)      07022204
070223         PERFORM DP013-0000-PROCESS-ABEND                         07022304
070224     END-IF.                                                      07022404
070225                                                                  07022504
070226     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07022604
070230 EJECT                                                            07023004
070300*----------------------------------------------------------------*07030002
070400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07040002
070500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07050002
070600* CICS ARCHITECTURE API.                                         *07060002
070700*----------------------------------------------------------------*07070002
070800 2100-CHECK-FUNCTION-KEY.                                         07080002
070900     EVALUATE TRUE                                                07090002
071000         WHEN DP020-FK-DISPN-GO(DP020-SRC-AID)                    07100002
071010             MOVE ASC-PO-REQ-NBR  TO                              07101014
071020                                     VL005-PO-REQ-NBR             07102014
071030             MOVE ASC-PO-NUMBER   TO                              07103014
071040                                     VL005-PO-NUMBER              07104014
073500* ENTER KEY WAS PRESSED                                           07350002
073600         WHEN DP020-SRC-AID = DP016-ENTER                         07360002
073601             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07360114
073602             IF  PS-ERROR                                         07360214
073603                 CONTINUE                                         07360314
073604             ELSE                                                 07360414
073605                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07360514
073610             END-IF                                               07361014
074302         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07430214
074303             PERFORM 2110-BROWSE-BACKWARD                         07430314
074304             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07430414
074306         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07430614
074307             PERFORM 2120-BROWSE-FORWARD                          07430714
074310             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07431014
074400         WHEN OTHER                                               07440002
074500             SET DP013-NO-ROLLBACK                                07450002
074600                 DP013-XCTL-DISPLAY-RESTART                       07460002
074700                 DP013-CICS-ABEND  TO TRUE                        07470002
074800             MOVE '2100-CHECK-FUNCTION-KEY'                       07480002
074900                                   TO DP013-PARAGRAPH             07490002
075000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07500002
075100                                   TO DP013-MESSAGE-TEXT (1)      07510002
075200             PERFORM DP013-0000-PROCESS-ABEND                     07520002
075300     END-EVALUATE.                                                07530002
075301                                                                  07530119
075302*----------------------------------------------------------------*07530214
075303*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07530314
075304*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07530414
075305*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07530514
075306*    MESSAGE.                                                    *07530614
075307*----------------------------------------------------------------*07530714
075309 2110-BROWSE-BACKWARD.                                            07530914
075310     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07531014
075311         GIVING PV-TOP-ITEM.                                      07531114
075312*                                                                 07531214
075313     IF  ((PV-TOP-ITEM < +1)                                      07531314
075314       OR (PV-TOP-ITEM = +1))                                     07531414
075315         MOVE +1                   TO PV-TOP-ITEM                 07531514
075316*        -- TOP OF LIST --                                        07531614
075317         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07531714
075318         SET DP020-MSG-INFORMATIONAL TO TRUE                      07531814
075319     END-IF.                                                      07531914
075320                                                                  07532014
075322*----------------------------------------------------------------*07532214
075323*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07532314
075324*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07532414
075325*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07532514
075326*----------------------------------------------------------------*07532614
075328 2120-BROWSE-FORWARD.                                             07532814
075330     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07533014
075331         GIVING PV-TOP-ITEM.                                      07533114
075332     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07533214
075333         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07533314
075334                                   TO PV-TOP-ITEM                 07533414
075335*        -- BOTTOM OF LIST --                                     07533514
075336         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07533614
075337         SET DP020-MSG-INFORMATIONAL                              07533714
075338                                   TO TRUE                        07533814
075339     ELSE                                                         07533914
075340         COMPUTE PV-BOTTOM-ITEM =                                 07534014
075341             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07534114
075342         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07534214
075343*            -- BOTTOM OF LIST --                                 07534314
075344             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07534414
075345             SET DP020-MSG-INFORMATIONAL                          07534514
075346                                   TO TRUE                        07534614
075347         END-IF                                                   07534714
075348     END-IF.                                                      07534814
075349                                                                  07534919
075350*----------------------------------------------------------------*07535014
075351*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07535114
075352*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07535214
075353*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07535314
075354*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07535414
075355*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07535514
075356*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07535614
075357*----------------------------------------------------------------*07535714
075359 2130-CHECK-FOR-JUMP-BROWSE.                                      07535914
075360     SET PS-NO-ERROR               TO TRUE.                       07536014
075361     IF (ASC-START-ITEM-REQUEST = SPACE)                          07536114
075362         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07536214
075363                                   TO PV-TOP-ITEM                 07536314
075364     ELSE                                                         07536414
075365         MOVE ASC-START-ITEM-REQUEST                              07536514
075366                                   TO DP010I-UNEDITED-FIELD       07536614
075367         MOVE +5                   TO DP010I-MAXIMUM-DIGITS       07536714
075368         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07536814
075369         SET DP010I-NEGATIVE-NOT-ALLOWED                          07536914
075370                                   TO TRUE                        07537014
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07537222
263627              USING DP010I-NUMERIC-EDIT-AREA                      07537322
075372                                                                  07537414
075373         IF  NOT DP010I-ERROR-DETECTED                            07537514
075374             MOVE DP010I-NUMERIC-FIELD                            07537614
075375                                   TO  ASC-START-ITEM-REQUEST-N   07537714
075376             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07537814
075377                 IF  ASC-START-ITEM-REQUEST-N >                   07537914
075378                                          ASC-NUMBER-OF-ITEMS-READ07538014
075379                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07538114
075380                     COMPUTE PV-TOP-ITEM =                        07538214
075381                             ASC-NUMBER-OF-ITEMS-READ             07538314
075382                             - PC-ITEMS-PER-PANEL + 1             07538414
075383                     IF  PV-TOP-ITEM < +1                         07538514
075384                         MOVE +1   TO PV-TOP-ITEM                 07538614
075385                         MOVE PC-TSYMSG-00070                     07538714
075386                                   TO DP020-MSG-NUMBER            07538814
075387                         SET DP020-MSG-INFORMATIONAL              07538914
075388                                   TO TRUE                        07539014
075389                     END-IF                                       07539114
075390                 ELSE                                             07539214
075391                     MOVE ASC-START-ITEM-REQUEST-N                07539314
075392                                   TO PV-TOP-ITEM                 07539414
075393                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07539514
075394                     COMPUTE PV-BOTTOM-ITEM =                     07539614
075395                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07539714
075396                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07539814
075397*                        -- BOTTOM OF LIST --                     07539914
075398                         MOVE PC-TSYMSG-00070                     07540014
075399                                   TO DP020-MSG-NUMBER            07540114
075400                         SET DP020-MSG-INFORMATIONAL              07540214
075401                                   TO TRUE                        07540314
075402                     END-IF                                       07540414
075403                 END-IF                                           07540514
075404             ELSE                                                 07540614
075405*                --- VALUE OUT OF RANGE ----                      07540714
075406                 MOVE PC-TSYMSG-00101                             07540814
075407                                   TO DP020-MSG-NUMBER            07540914
075408                 MOVE -1           TO ASTRTITL                    07541014
075409                 SET DP030-SET-CURSOR-APPL-1                      07541114
075410                                   TO TRUE                        07541214
075411                 MOVE DP015-REVERSE                               07541314
075412                                   TO ASTRTITH                    07541414
075413                 MOVE DP015-RED    TO ASTRTITC                    07541514
075414                 MOVE DP015-UNP-NUM-BRT-MDT                       07541614
075415                                   TO ASTRTITA                    07541714
075416                 SET DP020-MSG-FATAL                              07541814
075417                                   TO TRUE                        07541914
075418                 SET PS-ERROR      TO TRUE                        07542014
075419             END-IF                                               07542114
075421         ELSE                                                     07542214
075422             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07542314
075423             MOVE -1               TO ASTRTITL                    07542414
075424             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07542514
075425             MOVE DP015-REVERSE    TO ASTRTITH                    07542614
075426             MOVE DP015-RED        TO ASTRTITC                    07542714
075427             MOVE DP015-UNP-NUM-BRT-MDT                           07542814
075428                                   TO ASTRTITA                    07542914
075429             SET DP020-MSG-FATAL   TO TRUE                        07543014
075430             SET PS-ERROR          TO TRUE                        07543114
075431         END-IF                                                   07543214
075432     END-IF.                                                      07543314
075440                                                                  07544019
075500*----------------------------------------------------------------*07550002
075600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *07560002
075700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *07570002
075800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *07580002
075900*    DISPLAY THE PANEL TO USER.                                  *07590002
076000*----------------------------------------------------------------*07600002
076200 4000-BUILD-INITIAL-PANEL.                                        07620002
076400     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             07640002
076500                                ASC-BLOCK-ENTRIES (2).            07650002
076600     MOVE +1                 TO ASC-BLK-SUB.                      07660002
076700     SET ASC-ITEMS-LEFT-ON-DB                                     07670002
076800                             TO TRUE.                             07680002
076900                                                                  07690002
077000     MOVE +0                 TO ASC-ITEM-SUB                      07700002
077100                                ASC-NUMBER-OF-ITEMS-READ          07710002
077200                                ASC-NUMBER-OF-SELECTED-ITEMS      07720002
077300                                ASC-HIGHEST-BLOCK-WRITTEN         07730002
077400                                ASC-START-OF-SELECTED-RANGE       07740002
077500                                ASC-END-OF-SELECTED-RANGE         07750002
077600                                ASC-ITEM-AT-TOP-OF-PANEL.         07760002
077700                                                                  07770002
077800* GET REQUEST INFORMATION                                         07780002
077900     PERFORM 4100-GET-REQUEST-INFO.                               07790002
078000                                                                  07800002
078100     PERFORM 4110-GET-TICKET-QUANTITY.                            07810002
078200                                                                  07820002
078300     PERFORM 4120-GET-REQUEST-ADDRESS.                            07830002
078400                                                                  07840002
078500* LOAD ALL REQUEST SHIPMENTS INTO A QUEUE TO ALLOW DISPLAY        07850004
078700                                                                  07870002
078720     IF ASC-SHIPPED-STATUS                                        07872009
078730     OR ASC-CANCELLED-STATUS                                      07873014
078800         PERFORM 4010-OPEN-CURSOR                                 07880009
078900                                                                  07890009
079000         PERFORM 4300-READ-ITEMS-FROM-DB                          07900009
079100                                                                  07910009
079200         PERFORM 4020-CLOSE-CURSOR                                07920009
079300                                                                  07930009
079400         MOVE +1                   TO  PV-TOP-ITEM                07940011
079500         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      07950009
079700             SET DP020-MSG-INFORMATIONAL                          07970009
079710                                   TO TRUE                        07971009
079800             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           07980009
079900         ELSE                                                     07990009
080100             SET DP030-SET-CURSOR-APPL-1                          08010009
080200                                   TO TRUE                        08020009
080210         END-IF                                                   08021009
080220     END-IF.                                                      08022011
080300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08030003
080500                                                                  08050019
080600*----------------------------------------------------------------*08060002
080700* OPEN THE CURSOR                                                *08070002
080800*----------------------------------------------------------------*08080002
080900 4010-OPEN-CURSOR.                                                08090002
081100     PERFORM                                                      08110002
081200         WITH TEST AFTER                                          08120002
081300         VARYING PV-RETRY-COUNTER                                 08130002
081400         FROM 1 BY 1                                              08140002
081500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08150002
081600                   OR (SQLCODE = ZERO))                           08160002
081800                                                                  08180002
081900         EXEC SQL                                                 08190002
082000             OPEN SHIPMENT_CURSOR                                 08200002
082100         END-EXEC                                                 08210002
082200                                                                  08220002
082300         EVALUATE TRUE                                            08230002
082400             WHEN SQLCODE = ZERO                                  08240002
082500             WHEN SQLCODE = -904                                  08250002
082600             WHEN SQLCODE = -913                                  08260002
082700                 CONTINUE                                         08270002
082800             WHEN SQLWARN0 NOT = SPACES                           08280002
082900             WHEN SQLCODE < ZERO                                  08290002
083000             WHEN SQLCODE > ZERO                                  08300002
083100                 MOVE '4010-OPEN-CURSOR'                          08310002
083200                                   TO DP013-PARAGRAPH             08320002
083300                 MOVE 'OPEN SHIPMENT CURSOR'                      08330002
083400                                   TO DP013-MESSAGE-TEXT (1)      08340002
083500                 MOVE SQLCA        TO DP013-SQLCA                 08350002
083600                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    08360002
083700                 MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)    08370002
083800                 SET DP013-DB2-ABEND                              08380002
083900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08390002
084000                 PERFORM DP013-0000-PROCESS-ABEND                 08400002
084100         END-EVALUATE                                             08410002
084200     END-PERFORM.                                                 08420002
084300*                                                                 08430002
084400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08440002
084500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             08450002
084600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   08460002
084700                                   TO DP013-MESSAGE-TEXT (1)      08470002
084800         MOVE SQLCA                TO DP013-SQLCA                 08480002
084900         MOVE 'TREQSHP '           TO DP013-DB2-TABLE-NAME (1)    08490002
085000         MOVE 'TPTKSHP '           TO DP013-DB2-TABLE-NAME (2)    08500002
085100         SET DP013-DB2-ABEND                                      08510002
085200             DP013-XCTL-DISPLAY-RESTART                           08520002
085300                                   TO TRUE                        08530002
085400         PERFORM DP013-0000-PROCESS-ABEND                         08540002
085500     END-IF.                                                      08550002
090800                                                                  09080019
090900*----------------------------------------------------------------*09090002
091000* CLOSE THE PO_ITEM_CURSOR.                                      *09100002
091100*----------------------------------------------------------------*09110002
091300 4020-CLOSE-CURSOR.                                               09130002
091500     EXEC SQL                                                     09150002
091600         CLOSE SHIPMENT_CURSOR                                    09160002
091700     END-EXEC                                                     09170002
091800*                                                                 09180002
091900     EVALUATE TRUE                                                09190002
092000         WHEN SQLCODE = ZERO                                      09200002
092100             CONTINUE                                             09210002
092200         WHEN SQLWARN0 NOT = SPACES                               09220002
092300         WHEN SQLCODE < ZERO                                      09230002
092400         WHEN SQLCODE > ZERO                                      09240002
092500             MOVE '4020-CLOSE-CURSOR'                             09250002
092600                               TO DP013-PARAGRAPH                 09260002
092700             MOVE 'CLOSE SHIPMENT_CURSOR'                         09270002
092800                               TO DP013-MESSAGE-TEXT (1)          09280002
092900             MOVE SQLCA        TO DP013-SQLCA                     09290002
093000             MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)        09300002
093100             MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)        09310002
093200             SET DP013-DB2-ABEND                                  09320002
093300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09330002
093400             PERFORM DP013-0000-PROCESS-ABEND                     09340002
093500     END-EVALUATE.                                                09350002
093600                                                                  09360002
096400*----------------------------------------------------------------*09640002
096500*    SELECT THE PRETICKET REQUEST INFORMATION FROM THE PRETICKET *09650002
096600*    HEADER TABLE                                                *09660002
096700*----------------------------------------------------------------*09670002
096900 4100-GET-REQUEST-INFO.                                           09690002
097100     PERFORM                                                      09710002
097200         WITH TEST AFTER                                          09720002
097300         VARYING PV-RETRY-COUNTER                                 09730002
097400         FROM 1 BY 1                                              09740002
097500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09750002
097600                   OR (SQLCODE = ZERO))                           09760002
097700                                                                  09770002
097800         EXEC SQL                                                 09780002
097900             SELECT                                               09790002
098000                   A.PO_NBR                                       09800002
098100                 , A.ADDR_SEQ_NBR                                 09810002
098200                 , A.REQ_STAT_CDE                                 09820002
098300                 , A.REQ_CREN_DTE                                 09830002
098400                 , A.ACTL_PRT_DTE                                 09840002
098500                 , A.VND_DUE_DTE                                  09850002
098510                 , B.ENT_NAME_DESC                                09851014
098600             INTO                                                 09860002
098700                   :PTKREQ-PO-NBR                                 09870005
098800                 , :PTKREQ-ADDR-SEQ-NBR                           09880005
098900                 , :PTKREQ-REQ-STAT-CDE                           09890005
099000                 , :PTKREQ-REQ-CREN-DTE                           09900005
099100                 , :PTKREQ-ACTL-PRT-DTE                           09910005
099200                 , :PTKREQ-VND-DUE-DTE                            09920005
099210                 , :ENTNME-ENT-NAME-DESC                          09921014
099300             FROM                                                 09930002
099400                  TPTKREQ A                                       09940002
099500                , TENTNME B                                       09950014
099600             WHERE                                                09960002
099700                   A.PO_REQ_NBR = :DK-PO-REQ-NBR                  09970014
099710               AND A.ENT_ID     = B.ENT_ID                        09971014
099720               AND B.TYPE_CDE   = '01'                            09972014
099800         END-EXEC                                                 09980002
099900                                                                  09990002
100000         EVALUATE TRUE                                            10000002
100100             WHEN SQLCODE = ZERO                                  10010002
100200                 MOVE PTKREQ-PO-NBR         TO ASC-PO-NUMBER      10020002
100300                                               DK-PO-NUMBER       10030002
100400                 MOVE PTKREQ-ADDR-SEQ-NBR   TO ASC-ADDR-SEQ-NBR   10040002
100500                                               DK-ADDR-SEQ-NBR    10050002
100600                 MOVE PTKREQ-REQ-CREN-DTE   TO PV-DATE-ISO        10060002
100700                 MOVE PV-ISO-CC             TO PV-DISP-CC         10070002
100800                 MOVE PV-ISO-YY             TO PV-DISP-YY         10080002
100900                 MOVE PV-ISO-MM             TO PV-DISP-MM         10090002
101000                 MOVE PV-ISO-DD             TO PV-DISP-DD         10100002
101100                 MOVE PV-DISPLAY-DATE       TO ASC-REQUEST-DATE   10110002
101200                                                                  10120002
101300                 MOVE PTKREQ-ACTL-PRT-DTE   TO PV-DATE-ISO        10130002
101400                 MOVE PV-ISO-CC             TO PV-DISP-CC         10140002
101500                 MOVE PV-ISO-YY             TO PV-DISP-YY         10150002
101600                 MOVE PV-ISO-MM             TO PV-DISP-MM         10160002
101700                 MOVE PV-ISO-DD             TO PV-DISP-DD         10170002
101800                 MOVE PV-DISPLAY-DATE       TO ASC-PRINT-DATE     10180002
101900                                                                  10190002
102000                 MOVE PTKREQ-VND-DUE-DTE    TO PV-DATE-ISO        10200002
102100                 MOVE PV-ISO-CC             TO PV-DISP-CC         10210002
102200                 MOVE PV-ISO-YY             TO PV-DISP-YY         10220002
102300                 MOVE PV-ISO-MM             TO PV-DISP-MM         10230002
102400                 MOVE PV-ISO-DD             TO PV-DISP-DD         10240002
102500                 MOVE PV-DISPLAY-DATE                             10250004
102510                      TO ASC-VENDOR-DUE-DATE                      10251004
102511                 MOVE ENTNME-ENT-NAME-DESC  TO ASC-VENDOR-NAME    10251114
102600                                                                  10260002
102700                 MOVE PTKREQ-REQ-STAT-CDE   TO ASC-REQ-STAT-CDE   10270002
102800                 EVALUATE TRUE                                    10280009
103600                     WHEN ASC-ACTIVE-STATUS                       10360009
103700                         SET ASC-ACTIVE-STATUS-DESC               10370009
103800                             TO TRUE                              10380009
103810                     WHEN ASC-CANCELLED-STATUS                    10381009
103900                         SET ASC-CANCELLED-STATUS-DESC            10390009
104000                             TO TRUE                              10400009
104010                     WHEN ASC-HOLD-STATUS                         10401009
104100                         SET ASC-HOLD-STATUS-DESC                 10410009
104200                             TO TRUE                              10420009
104210                     WHEN ASC-INPROCESS-STATUS                    10421009
104300                         SET ASC-INPROCESS-STATUS-DESC            10430009
104400                             TO TRUE                              10440009
104402                     WHEN ASC-PRINT-STATUS                        10440209
104410                         SET ASC-PRINT-STATUS-DESC                10441009
104420                             TO TRUE                              10442009
104422                     WHEN ASC-RUSH-STATUS                         10442209
104430                         SET ASC-RUSH-STATUS-DESC                 10443009
104440                             TO TRUE                              10444009
104442                     WHEN ASC-SHIPPED-STATUS                      10444209
104450                         SET ASC-SHIPPED-STATUS-DESC              10445009
104460                             TO TRUE                              10446009
104500                 END-EVALUATE                                     10450002
104610                                                                  10461002
104700             WHEN SQLCODE = -904                                  10470002
104800             WHEN SQLCODE = -913                                  10480002
104900                 CONTINUE                                         10490002
105000                                                                  10500002
105100             WHEN SQLWARN0 NOT = SPACES                           10510002
105200             WHEN SQLCODE < ZERO                                  10520002
105300             WHEN SQLCODE > ZERO                                  10530002
105400                 MOVE '4100-GET-REQUEST-INFO'                     10540002
105500                                   TO DP013-PARAGRAPH             10550002
105600                 MOVE 'SELECT THE PRETICKET REQUEST INFORMATION'  10560002
105700                                   TO DP013-MESSAGE-TEXT (1)      10570002
105701                 MOVE DK-PO-REQ-NBR TO DP013-MESSAGE-TEXT (2)     10570114
105800                 MOVE SQLCA        TO DP013-SQLCA                 10580002
105900                 MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)    10590002
106000                 SET DP013-DB2-ABEND                              10600002
106100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10610002
106200                 PERFORM DP013-0000-PROCESS-ABEND                 10620002
106300         END-EVALUATE                                             10630002
106400     END-PERFORM.                                                 10640002
106500*                                                                 10650002
106600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10660002
106700         MOVE '4100-GET-REQUEST-INFO'                             10670002
106800                                   TO DP013-PARAGRAPH             10680002
106900         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING REQUEST INFO'   10690002
107000                                   TO DP013-MESSAGE-TEXT (1)      10700002
107010         MOVE DK-PO-REQ-NBR        TO DP013-MESSAGE-TEXT (2)      10701014
107100         MOVE SQLCA                TO DP013-SQLCA                 10710002
107200         MOVE 'TPTKREQ '           TO DP013-DB2-TABLE-NAME (1)    10720002
107300         SET DP013-DB2-ABEND                                      10730002
107400             DP013-XCTL-DISPLAY-RESTART                           10740002
107500                                   TO TRUE                        10750002
107600         PERFORM DP013-0000-PROCESS-ABEND                         10760002
107700     END-IF.                                                      10770002
107800                                                                  10780002
107900*----------------------------------------------------------------*10790002
108000*    SELECT THE TOTAL NUMBER OF TICKETS ON THE REQUEST FROM THE  *10800002
108100*    PRETICKET DETAIL TABLE.                                     *10810002
108200*----------------------------------------------------------------*10820002
108400 4110-GET-TICKET-QUANTITY.                                        10840002
108600     PERFORM                                                      10860002
108700         WITH TEST AFTER                                          10870002
108800         VARYING PV-RETRY-COUNTER                                 10880002
108900         FROM 1 BY 1                                              10890002
109000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10900002
109100                   OR (SQLCODE = -305)                            10910002
109110                   OR (SQLCODE = ZERO))                           10911014
109200                                                                  10920002
109300         EXEC SQL                                                 10930002
109400             SELECT                                               10940002
109500                   SUM(A.TKT_QTY)                                 10950002
109600             INTO                                                 10960002
109700                  :PV-TICKET-QUANTITY                             10970005
109800             FROM                                                 10980002
109900                  TPTKLNE A                                       10990005
110000             WHERE                                                11000002
110100                A.PO_REQ_NBR = :DK-PO-REQ-NBR                     11010005
110200         END-EXEC                                                 11020002
110300                                                                  11030002
110400         EVALUATE TRUE                                            11040002
110500             WHEN SQLCODE = ZERO                                  11050002
110501                 IF PV-TICKET-QUANTITY > 9999999                  11050114
110502                     MOVE '4110-GET-TICKET-QUANTITY'              11050214
110503                                   TO DP013-PARAGRAPH             11050314
110504                     MOVE 'TICKET QUANTITY TOO LARGE FOR FIELDS'  11050414
110505                                   TO DP013-MESSAGE-TEXT (1)      11050514
110506                     MOVE ASC-PO-NUMBER                           11050614
110507                                   TO PV-DISPLAY-COMP1            11050714
110508                     MOVE PV-TICKET-QUANTITY                      11050814
110509                                   TO PV-DISPLAY-COMP2            11050914
110510                     STRING 'PO NUMBER: ' DELIMITED BY SIZE       11051014
110511                            PV-DISPLAY-COMP1                      11051114
110512                                          DELIMITED BY SIZE       11051214
110513                            ' -- TICKET QUANTITY: '               11051314
110514                                          DELIMITED BY SIZE       11051414
110515                            PV-DISPLAY-COMP2                      11051514
110516                                          DELIMITED BY SIZE       11051614
110519                                 INTO PV-DISPLAY-ABEND-MESSAGE    11051914
110520                     MOVE PV-DISPLAY-ABEND-MESSAGE                11052014
110521                                   TO DP013-MESSAGE-TEXT (2)      11052114
110522                     SET DP013-LOGIC-ABEND                        11052214
110523                         DP013-XCTL-DISPLAY-RESTART TO TRUE       11052314
110524                     PERFORM DP013-0000-PROCESS-ABEND             11052414
110525                 ELSE                                             11052514
110526                     MOVE PV-TICKET-QUANTITY                      11052614
110527                          TO ASC-REQUEST-QUANTITY-N               11052714
110530                 END-IF                                           11053014
110700                                                                  11070002
110800             WHEN SQLCODE = -305                                  11080002
110801                 MOVE +0  TO ASC-REQUEST-QUANTITY-N               11080114
110802                                                                  11080202
110803             WHEN SQLCODE = -904                                  11080302
110900             WHEN SQLCODE = -913                                  11090002
111000                 CONTINUE                                         11100002
111100                                                                  11110002
111200             WHEN SQLWARN0 NOT = SPACES                           11120002
111300             WHEN SQLCODE < ZERO                                  11130002
111400             WHEN SQLCODE > ZERO                                  11140002
111500                 MOVE '4110-GET-TICKET-QUANTITY'                  11150002
111600                                   TO DP013-PARAGRAPH             11160002
111700                 MOVE 'SELECT THE PRETICKET REQUEST QUANTITY'     11170002
111800                                   TO DP013-MESSAGE-TEXT (1)      11180002
111810                 MOVE DK-PO-REQ-NBR                               11181014
111820                                   TO DP013-MESSAGE-TEXT (2)      11182014
111900                 MOVE SQLCA        TO DP013-SQLCA                 11190002
112000                 MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (1)    11200002
112100                 SET DP013-DB2-ABEND                              11210002
112200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11220002
112300                 PERFORM DP013-0000-PROCESS-ABEND                 11230002
112400         END-EVALUATE                                             11240002
112500     END-PERFORM.                                                 11250002
112600*                                                                 11260002
112700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11270002
112800         MOVE '4110-GET-TICKET-QUANTITY'                          11280002
112900                                   TO DP013-PARAGRAPH             11290002
113000         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING TICKET QTY'     11300002
113100                                   TO DP013-MESSAGE-TEXT (1)      11310002
113120         MOVE DK-PO-REQ-NBR        TO DP013-MESSAGE-TEXT (2)      11312014
113200         MOVE SQLCA                TO DP013-SQLCA                 11320002
113300         MOVE 'TPTKLNE '           TO DP013-DB2-TABLE-NAME (1)    11330002
113400         SET DP013-DB2-ABEND                                      11340002
113500             DP013-XCTL-DISPLAY-RESTART                           11350002
113600                                   TO TRUE                        11360002
113700         PERFORM DP013-0000-PROCESS-ABEND                         11370002
113800     END-IF.                                                      11380002
113900                                                                  11390002
114000*----------------------------------------------------------------*11400002
114100*    SELECT THE PRETICKET ADDRESS FROM THE BUSINESS LOCATION     *11410002
114200*    TABLE THAT IS ATTATCHED TO THIS REQUEST                     *11420002
114300*----------------------------------------------------------------*11430002
114500 4120-GET-REQUEST-ADDRESS.                                        11450002
114700     PERFORM                                                      11470002
114800         WITH TEST AFTER                                          11480002
114900         VARYING PV-RETRY-COUNTER                                 11490002
115000         FROM 1 BY 1                                              11500002
115100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11510002
115200                   OR (SQLCODE = +100)                            11520002
115210                   OR (SQLCODE = ZERO))                           11521014
115300                                                                  11530002
115400         EXEC SQL                                                 11540002
115500             SELECT                                               11550005
115600                   A.ADDRESS_LINE1_DESC                           11560012
115700                  ,A.ADDRESS_LINE2_DESC                           11570012
115800                  ,A.ADDRESS_LINE3_DESC                           11580012
115900                  ,A.ADDRESS_LINE4_DESC                           11590012
116000                  ,A.ATTENTION_TO_TXT                             11600012
116100                  ,A.CITY_NAME                                    11610012
116210                  ,A.ST_PROV_CDE                                  11621014
116300                  ,A.ZIP_CDE                                      11630012
116310                  ,A.CNTRY_CDE                                    11631014
116501                  ,B.FIRST_NAME                                   11650112
116502                  ,B.LAST_NAME                                    11650212
116510             INTO                                                 11651005
116520                   :BUSLOC-ADDRESS-LINE1-DESC                     11652005
116530                  ,:BUSLOC-ADDRESS-LINE2-DESC                     11653005
116540                  ,:BUSLOC-ADDRESS-LINE3-DESC                     11654005
116550                  ,:BUSLOC-ADDRESS-LINE4-DESC                     11655005
116560                  ,:BUSLOC-ATTENTION-TO-TXT                       11656005
116570                  ,:BUSLOC-CITY-NAME                              11657005
116581                  ,:BUSLOC-ST-PROV-CDE                            11658114
116590                  ,:BUSLOC-ZIP-CDE                                11659005
116591                  ,:BUSLOC-CNTRY-CDE                              11659114
116594                  ,:ENTREP-FIRST-NAME                             11659412
116595                  ,:ENTREP-LAST-NAME                              11659512
116600          FROM                                                    11660002
116700                  TBUSLOC A                                       11670012
116710                , TENTREP B                                       11671012
116800          WHERE                                                   11680002
116900                A.ENT_ID         = :DK-ENT-ID                     11690012
116910            AND A.ENT_ID         = B.ENT_ID                       11691012
117000            AND A.SEQ_NBR        = :DK-ADDR-SEQ-NBR               11700012
117010            AND A.SEQ_NBR        = B.ENT_BUS_LOC_ID               11701012
117100            AND A.FUNCTION_ID    = :PC-PRETICKET-FUNCTION-ID      11710012
117110            AND A.FUNCTION_ID    = B.FUNCTION_ID                  11711012
117200         END-EXEC                                                 11720002
117300                                                                  11730002
117400         EVALUATE TRUE                                            11740002
117500             WHEN SQLCODE = ZERO                                  11750002
111710                 IF BUSLOC-CNTRY-CDE = 'US ' OR SPACES            11750117
111711                   MOVE SPACES             TO PV-COUNTRY          11750217
111720                                              PV-STATE-PROV       11750317
111721                   MOVE BUSLOC-ST-PROV-CDE TO PV-STATE-PROV       11751017
111730                 ELSE                                             11760017
117700                   PERFORM 4125-RETRIEVE-ST-PRV-CNTY-NAME         11770017
                       END-IF                                           11770117
117702                 PERFORM 4121-MOVE-ADDR-TO-COMMAREA               11770204
117703                                                                  11770314
117704             WHEN SQLCODE = +100                                  11770402
117705                 MOVE 'PRETICKET ADDRESS HAS BEEN DELETED'        11770504
117706                       TO ASC-ADDR-LINE (1)                       11770614
117707                 MOVE 'FROM THE VENDOR FILE'                      11770704
117708                       TO ASC-ADDR-LINE (2)                       11770814
117709                                                                  11770902
117800             WHEN SQLCODE = -904                                  11780002
117900             WHEN SQLCODE = -913                                  11790002
118000                 CONTINUE                                         11800002
118100                                                                  11810002
118200             WHEN SQLWARN0 NOT = SPACES                           11820002
118300             WHEN SQLCODE < ZERO                                  11830002
118400             WHEN SQLCODE > ZERO                                  11840002
118500                 MOVE '4120-GET-REQUEST-ADDRESS'                  11850002
118600                                   TO DP013-PARAGRAPH             11860002
118700                 MOVE 'SELECT THE PRETICKET REQUEST ADDRESS'      11870002
118800                                   TO DP013-MESSAGE-TEXT (1)      11880002
118801                 MOVE DK-ENT-ID    TO DP013-MESSAGE-TEXT (2)      11880114
118802                 MOVE DK-ADDR-SEQ-NBR                             11880214
118803                                   TO DP013-MESSAGE-TEXT (3)      11880314
118900                 MOVE SQLCA        TO DP013-SQLCA                 11890002
119000                 MOVE 'TBUSLOC '   TO DP013-DB2-TABLE-NAME (1)    11900002
119100                 SET DP013-DB2-ABEND                              11910002
119200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11920002
119300                 PERFORM DP013-0000-PROCESS-ABEND                 11930002
119400         END-EVALUATE                                             11940002
119500     END-PERFORM.                                                 11950002
119600*                                                                 11960002
119700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11970002
119800         MOVE '4120-GET-REQUEST-ADDRESS'                          11980002
119900                                   TO DP013-PARAGRAPH             11990002
120000         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING ADDRESS'        12000002
120100                                   TO DP013-MESSAGE-TEXT (1)      12010002
120110         MOVE DK-ENT-ID            TO DP013-MESSAGE-TEXT (2)      12011014
120130         MOVE DK-ADDR-SEQ-NBR      TO DP013-MESSAGE-TEXT (3)      12013014
120200         MOVE SQLCA                TO DP013-SQLCA                 12020002
120300         MOVE 'TBUSLOC '           TO DP013-DB2-TABLE-NAME (1)    12030002
120400         SET DP013-DB2-ABEND                                      12040002
120500             DP013-XCTL-DISPLAY-RESTART                           12050002
120600                                   TO TRUE                        12060002
120700         PERFORM DP013-0000-PROCESS-ABEND                         12070002
120800     END-IF.                                                      12080002
120805                                                                  12080119
120801*----------------------------------------------------------------*12080204
120802* THIS PARAGRAPH WILL MOVE AN ADDRESS INTO THE COMMAREA ADDRESS  *12080304
120803* FIELDS                                                         *12080404
120804*----------------------------------------------------------------*12080504
120806 4121-MOVE-ADDR-TO-COMMAREA.                                      12080704
120808     INITIALIZE ASC-ADDR-LINE-TABLE.                              12080904
120810     SET ASC-ADDR-IDX TO +1.                                      12081004
120811                                                                  12081104
120826**  ATTENTION-TO-TXT  ********************************************12082612
120827     IF BUSLOC-ATTENTION-TO-TXT = SPACES                          12082712
120828         CONTINUE                                                 12082812
120829     ELSE                                                         12082912
120830         MOVE BUSLOC-ATTENTION-TO-TXT                             12083012
120831              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     12083112
120832         SET ASC-ADDR-IDX UP BY +1                                12083212
120833     END-IF.                                                      12083312
120834                                                                  12083412
120835**  ENTERPRISE REP FIRST/LAST NAME *******************************12083514
120836     IF  ENTREP-FIRST-NAME = SPACES                               12083614
120837     AND ENTREP-LAST-NAME = SPACES                                12083714
120838         CONTINUE                                                 12083814
120839     ELSE                                                         12083914
120840         STRING ENTREP-FIRST-NAME   DELIMITED BY '  '             12084014
120841                ' '                 DELIMITED BY SIZE             12084114
120842                ENTREP-LAST-NAME    DELIMITED BY '  '             12084214
120843         INTO ASC-ADDR-LINE (ASC-ADDR-IDX)                        12084314
120844         SET ASC-ADDR-IDX UP BY +1                                12084414
120845     END-IF.                                                      12084514
120846                                                                  12084614
120847** ADDRESS LINE 1 ************************************************12084704
120848     IF BUSLOC-ADDRESS-LINE1-DESC = SPACES                        12084804
120849         CONTINUE                                                 12084904
120850     ELSE                                                         12085004
120851         MOVE BUSLOC-ADDRESS-LINE1-DESC                           12085104
120852              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     12085204
120853         SET ASC-ADDR-IDX UP BY +1                                12085304
120854     END-IF.                                                      12085404
120855                                                                  12085504
120856** ADDRESS LINE 2 ************************************************12085604
120857     IF BUSLOC-ADDRESS-LINE2-DESC = SPACES                        12085704
120858         CONTINUE                                                 12085804
120859     ELSE                                                         12085904
120860         MOVE BUSLOC-ADDRESS-LINE2-DESC                           12086004
120861              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     12086104
120862         SET ASC-ADDR-IDX UP BY +1                                12086204
120863     END-IF.                                                      12086304
120864                                                                  12086404
120865** ADDRESS LINE 3 ************************************************12086504
120866     IF BUSLOC-ADDRESS-LINE3-DESC = SPACES                        12086604
120867         CONTINUE                                                 12086704
120868     ELSE                                                         12086804
120869         MOVE BUSLOC-ADDRESS-LINE3-DESC                           12086904
120870              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     12087004
120871         SET ASC-ADDR-IDX UP BY +1                                12087104
120872     END-IF.                                                      12087204
120873                                                                  12087304
120874** ADDRESS LINE 4 ************************************************12087404
120875     IF BUSLOC-ADDRESS-LINE4-DESC = SPACES                        12087504
120876         CONTINUE                                                 12087604
120877     ELSE                                                         12087704
120878         MOVE BUSLOC-ADDRESS-LINE4-DESC                           12087804
120879              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     12087904
120880         SET ASC-ADDR-IDX UP BY +1                                12088004
120881     END-IF.                                                      12088104
120882                                                                  12088204
120883** CITY STATE PROVINCE ZIP COUNTRY (COULD BE ON TWO LINES) *******12088312
120884     STRING                                                       12088404
120885         BUSLOC-CITY-NAME DELIMITED BY '  '                       12088504
120886         ' ' DELIMITED BY SIZE                                    12088604
120888         PV-STATE-PROV DELIMITED BY ' '                           12088918
120889         ' ' DELIMITED BY SIZE                                    12089004
120891         BUSLOC-ZIP-CDE  DELIMITED BY '  '                        12089104
120892         ' ' DELIMITED BY SIZE                                    12089204
120894         PV-COUNTRY DELIMITED BY '  '                             12089414
120895     INTO ASC-ADDR-LINE(ASC-ADDR-IDX)                             12089504
120896     ON OVERFLOW                                                  12089604
120897         MOVE SPACES TO ASC-ADDR-LINE(ASC-ADDR-IDX)               12089712
120898         STRING                                                   12089804
120899             BUSLOC-CITY-NAME DELIMITED BY '  '                   12089904
120900             ' ' DELIMITED BY SIZE                                12090004
120904             BUSLOC-ZIP-CDE  DELIMITED BY '  '                    12090404
120905         INTO ASC-ADDR-LINE(ASC-ADDR-IDX)                         12090504
120906         SET ASC-ADDR-IDX UP BY +1                                12090604
120907                                                                  12090704
120908         STRING                                                   12090804
120910             PV-COUNTRY DELIMITED BY '  '                         12091004
120911             ' ' DELIMITED BY SIZE                                12091104
120913             PV-STATE-PROV DELIMITED BY '  '                      12091304
120914         INTO ASC-ADDR-LINE(ASC-ADDR-IDX)                         12091404
121000     END-STRING.                                                  12100004
121300                                                                  12130002
147400*----------------------------------------------------------------*14740016
147500*    RETRIEVE COUNTRY AND STATE NAME                             *14750014
147600*----------------------------------------------------------------*14760014
147700 4125-RETRIEVE-ST-PRV-CNTY-NAME.                                  14770014
147900     MOVE SPACES                 TO PV-STATE-PROV                 14790014
148000                                    PV-COUNTRY.                   14800014
148100     MOVE BUSLOC-ST-PROV-CDE     TO DP410-STATE-CODE.             14810014
148200     MOVE BUSLOC-CNTRY-CDE       TO DP410-COUNTRY-CODE.           14820014
148300                                                                  14830014
148400     CALL PC-DPKUT410 USING DFHEIBLK                              14840014
148500                            PV-DPKUT410-COMMAREA                  14850014
148600                            DP410-ST-PROV-CNTRY-ROUTINE.          14860014
148700                                                                  14870014
148800     EVALUATE TRUE                                                14880014
149000         WHEN  DP410-DB2-ERROR                                    14900014
149100             MOVE '4125-RETRIEVE-ST-PRV-CNTY-NAME'                14910014
149200                                      TO DP013-PARAGRAPH          14920014
149300             DISPLAY 'STATE/PROV = ' DP410-STATE-CODE             14930014
149400             DISPLAY 'COUNTRY = ' DP410-COUNTRY-CODE              14940014
149500             MOVE 'PS_COUNTRY'        TO DP013-DB2-TABLE-NAME (1) 14950014
149600             MOVE 'PS_STATE'          TO DP013-DB2-TABLE-NAME (2) 14960014
149700             SET DP013-DB2-ABEND   TO TRUE                        14970014
149800             SET DP013-NO-ROLLBACK TO TRUE                        14980014
149900             MOVE SQLCA            TO DP013-SQLCA                 14990014
150000             PERFORM DP013-0000-PROCESS-ABEND                     15000014
150101         WHEN  DP410-DEADLOCK-BYPASS-ROUTINE                      15010115
150102             MOVE DP410-STATE-CODE TO PV-STATE-PROV               15010215
150103             MOVE DP410-COUNTRY-CODE TO PV-COUNTRY                15010315
150200         WHEN  OTHER                                              15020014
150300             MOVE DP410-STATE-NAME TO PV-STATE-PROV               15030014
150400             MOVE DP410-COUNTRY-NAME TO PV-COUNTRY                15040014
150500     END-EVALUATE.                                                15050014
150601                                                                  15060114
150602*----------------------------------------------------------------*15060202
150603*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15060302
150604*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15060402
150605*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15060502
150606*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15060602
150607*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15060702
150608*                                                                *15060802
150609*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *15060902
150610*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *15061002
150611*    UPON INITIALIZATION.                                        *15061102
150612*----------------------------------------------------------------*15061202
150614 4300-READ-ITEMS-FROM-DB.                                         15061402
150616     PERFORM                                                      15061602
150617         VARYING PV-READ-COUNT                                    15061702
150618         FROM 1 BY 1                                              15061802
150619         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15061902
150620            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         15062002
150621                                                                  15062102
150622         PERFORM 4310-FETCH                                       15062202
150623                                                                  15062302
150624         IF  ASC-ITEMS-LEFT-ON-DB                                 15062402
150625             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                15062502
150626                 ADD +1            TO ASC-ITEM-SUB                15062602
150627             ELSE                                                 15062702
150628                 ADD +1            TO ASC-BLK-SUB                 15062802
150629                 MOVE +1           TO ASC-ITEM-SUB                15062902
150630                                                                  15063002
150631                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         15063102
150632                     MOVE +1       TO ASC-BLK-SUB                 15063202
150633                     SET ASC-BLOCK-MODIFIED (1)                   15063302
150634                                   TO TRUE                        15063402
150700                     PERFORM 5100-WRITE-TEMP-STORAGE              15070002
150800                     MOVE ASC-BLOCK-ENTRIES                       15080002
150900                               (PC-MAX-BLOCKS-IN-ARRAY)           15090002
151000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 15100002
151100                     ADD +1        TO ASC-BLK-SUB                 15110002
151200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   15120002
151300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      15130002
151400                                   TO TRUE                        15140002
151500                 END-IF                                           15150002
151600             END-IF                                               15160002
151700             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    15170002
151710             MOVE ASC-NUMBER-OF-ITEMS-READ                        15171014
151720                         TO  ASC-LIST-ITEM-NUMBER                 15172014
151730                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15173014
151740             MOVE ENTNME-ENT-NAME-DESC                            15174014
152100                         TO  ASC-CARRIER-NAME                     15210002
152110                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15211002
152120                                                                  15212019
152130             MOVE PTKSHP-SHIPT-DTE  TO PV-DATE-ISO                15213019
152140             MOVE PV-ISO-CC       TO PV-DISP-CC                   15214019
152150             MOVE PV-ISO-YY       TO PV-DISP-YY                   15215019
152160             MOVE PV-ISO-MM       TO PV-DISP-MM                   15216019
152170             MOVE PV-ISO-DD       TO PV-DISP-DD                   15217019
152180             MOVE PV-DISPLAY-DATE TO  ASC-SHIP-DATE               15218019
152210                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15221002
152220             MOVE PTKSHP-SHIPT-TYP-DESC                           15222014
152300                         TO  ASC-SHIP-METHOD                      15230002
152310                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15231002
152320             MOVE PTKSHP-CARR-SHIPT-ID                            15232014
152400                         TO  ASC-SHIP-NBR                         15240002
152500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15250002
156200         END-IF                                                   15620002
156300     END-PERFORM.                                                 15630002
156400                                                                  15640002
156500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          15650002
156600         MOVE +1               TO ASC-BLK-SUB                     15660002
156700         PERFORM 5100-WRITE-TEMP-STORAGE                          15670002
156800         ADD +1                TO ASC-BLK-SUB                     15680002
156900         PERFORM 5100-WRITE-TEMP-STORAGE                          15690002
157000                                                                  15700002
157100         MOVE 1                TO ASC-BLK-SUB                     15710002
157200                                  PV-BLOCK-NUMBER                 15720002
157300         PERFORM 4410-READ-TEMP-STORAGE                           15730002
157400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             15740002
157500             MOVE 2            TO ASC-BLK-SUB                     15750002
157600                                  PV-BLOCK-NUMBER                 15760002
157700             PERFORM 4410-READ-TEMP-STORAGE                       15770002
157800         END-IF                                                   15780002
157900     END-IF.                                                      15790002
158000                                                                  15800002
158200*----------------------------------------------------------------*15820002
158300*    FETCH THE MESSAGE CURSOR.                                   *15830002
158400*----------------------------------------------------------------*15840002
158600 4310-FETCH.                                                      15860002
158800     EXEC SQL                                                     15880002
158900          FETCH SHIPMENT_CURSOR                                   15890002
158901          INTO  :PTKSHP-CARR-SHIPT-ID                             15890102
158902              , :PTKSHP-SHIPT-DTE                                 15890202
158903              , :PTKSHP-SHIPT-TYP-DESC                            15890302
158910              , :ENTNME-ENT-NAME-DESC                             15891003
160300     END-EXEC                                                     16030002
160400                                                                  16040002
160500     EVALUATE TRUE                                                16050002
160600         WHEN SQLCODE = ZERO                                      16060002
160800              CONTINUE                                            16061019
160700         WHEN SQLCODE = +100                                      16070002
162200              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 16080019
160900         WHEN SQLWARN0 NOT = SPACE                                16090002
161000         WHEN SQLCODE NOT = ZERO                                  16100002
161100              MOVE '4310-FETCH-CURSOR'                            16110002
161200                               TO DP013-PARAGRAPH                 16120002
161300              MOVE 'FETCH SHIPMENT_CURSOR'                        16130002
161400                               TO DP013-MESSAGE-TEXT (1)          16140002
161401              MOVE DK-PO-REQ-NBR                                  16140114
161402                               TO DP013-MESSAGE-TEXT (2)          16140214
161500              MOVE SQLCA       TO DP013-SQLCA                     16150002
161600              SET DP013-DB2-ABEND                                 16160002
161700                               TO TRUE                            16170002
161800              PERFORM DP013-0000-PROCESS-ABEND                    16180002
161900     END-EVALUATE.                                                16190002
162000                                                                  16200002
182200*----------------------------------------------------------------*18220002
182300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18230002
182400*----------------------------------------------------------------*18240002
182600 4400-MOVE-COMMAREA-TO-SCREEN.                                    18260002
182700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18270002
182800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18280002
182900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18290002
183000             MOVE +1    TO ASC-BLK-SUB                            18300002
183100             PERFORM 5100-WRITE-TEMP-STORAGE                      18310002
183200             ADD +1     TO ASC-BLK-SUB                            18320002
183300             PERFORM 5100-WRITE-TEMP-STORAGE                      18330002
183400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18340002
183500                 GIVING PV-BLOCK-NUMBER                           18350002
183600                 REMAINDER PV-REMAINDER                           18360002
183700             IF  PV-REMAINDER > ZERO                              18370002
183800                 ADD +1 TO PV-BLOCK-NUMBER                        18380002
183900             END-IF                                               18390002
184000             MOVE +1    TO ASC-BLK-SUB                            18400002
184100             PERFORM 4410-READ-TEMP-STORAGE                       18410002
184200             ADD +1     TO ASC-BLK-SUB                            18420002
184300                           PV-BLOCK-NUMBER                        18430002
184400             PERFORM 4410-READ-TEMP-STORAGE                       18440002
184500     END-IF.                                                      18450002
184600     MOVE +1            TO ASC-BLK-SUB.                           18460002
184700     COMPUTE ASC-ITEM-SUB =                                       18470002
184800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18480002
184900         + PC-ITEMS-PER-PANEL).                                   18490002
185000*                                                                 18500002
185100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18510002
185200         ADD +1         TO ASC-BLK-SUB                            18520002
185300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18530002
185400     END-IF.                                                      18540002
185500*                                                                 18550002
185600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18560002
185700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18570002
185900     PERFORM 4420-FORMAT-LIST-LINES                               18590002
186000         VARYING PV-SUB                                           18600002
186100         FROM PC-ITEMS-PER-PANEL BY -1                            18610002
186200         UNTIL PV-SUB < +1.                                       18620002
186300*                                                                 18630002
186400     COMPUTE ASC-ITEMS-DISPLAYED =                                18640002
186500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18650002
186600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18660002
186700                                      ASTRTITO.                   18670004
186800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    18680004
186900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    18690004
187200     MOVE ASC-PO-NUMBER            TO APONBRO.                    18720014
187300     MOVE ASC-REQ-STAT-CDE         TO ARSTATO.                    18730003
187400     MOVE ASC-REQ-STAT-CDE-DESC    TO ARSDESCO.                   18740004
187500     MOVE ASC-REQUEST-DATE         TO ARDATEO.                    18750003
187600                                                                  18760014
187700     IF ASC-PRINT-DATE = '01/01/0001'                             18770014
187800         MOVE SPACES               TO APDATEO                     18780014
187801     ELSE                                                         18780114
187802         MOVE ASC-PRINT-DATE       TO APDATEO                     18780204
187803     END-IF                                                       18780314
187804                                                                  18780414
187805     MOVE ASC-VENDOR-DUE-DATE      TO AVDDATEO.                   18780504
187806     MOVE ASC-VENDOR-NAME          TO AVNDNMEO.                   18780614
187807     MOVE ASC-REQUEST-QUANTITY-N   TO PV-DISPLAY-QTY              18780714
187808     MOVE PV-DISPLAY-QTY           TO ARQTIXO.                    18780814
187809     IF ASC-REQUEST-QUANTITY-N = +0                               18780914
187810         MOVE DP015-RED            TO ARQTIXC                     18781014
187811     ELSE                                                         18781114
187812         MOVE DP015-BLUE           TO ARQTIXC                     18781214
187813     END-IF.                                                      18781314
188000     MOVE ASC-ADDR-LINE (1)        TO AADDR1O.                    18800002
188100     MOVE ASC-ADDR-LINE (2)        TO AADDR2O.                    18810002
188200     MOVE ASC-ADDR-LINE (3)        TO AADDR3O.                    18820002
188300     MOVE ASC-ADDR-LINE (4)        TO AADDR4O.                    18830002
188400     MOVE ASC-ADDR-LINE (5)        TO AADDR5O.                    18840002
188500     MOVE ASC-ADDR-LINE (6)        TO AADDR6O.                    18850002
188600     MOVE ASC-ADDR-LINE (7)        TO AADDR7O.                    18860002
188610     MOVE ASC-ADDR-LINE (8)        TO AADDR8O.                    18861012
188700*                                                                 18870002
188800     IF  DP020-MSG-NUMBER-X = SPACE                               18880002
188900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18890002
189000*            --- MORE ITEMS TO DISPLAY ----                       18900002
189100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18910002
189200             SET DP020-MSG-INFORMATIONAL TO TRUE                  18920002
189300         END-IF                                                   18930002
189400     END-IF.                                                      18940002
189800                                                                  18941019
189500*----------------------------------------------------------------*18950002
189600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *18960002
189700*----------------------------------------------------------------*18970002
189900 4410-READ-TEMP-STORAGE.                                          18990002
190100     EXEC CICS                                                    19010002
190200         READQ TS                                                 19020002
190300             QUEUE (ASC-LIST-QUEUE-NAME)                          19030002
190400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19040002
190500             ITEM  (PV-BLOCK-NUMBER)                              19050002
190600             RESP  (PV-CICS-RESP)                                 19060002
190700     END-EXEC.                                                    19070002
190800                                                                  19080002
190900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       19090002
191000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     19100002
191100         CONTINUE                                                 19110002
191200     ELSE                                                         19120002
191300         SET DP013-CICS-ABEND     TO TRUE                         19130002
191400         SET DP013-NO-ROLLBACK    TO TRUE                         19140002
191500         MOVE '4410-READ-TEMP-STORAGE'                            19150002
191600                                  TO DP013-PARAGRAPH              19160002
191700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      19170002
191800                                  TO DP013-MESSAGE-TEXT(1)        19180002
191900         PERFORM DP013-0000-PROCESS-ABEND                         19190002
192000     END-IF.                                                      19200002
192100                                                                  19210002
192200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19220002
192300*                                                                 19230002
192400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         19240002
192500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               19250002
192600     END-IF.                                                      19260002
192700                                                                  19270019
192800*----------------------------------------------------------------*19280002
192900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19290002
193000*----------------------------------------------------------------*19300002
193200 4420-FORMAT-LIST-LINES.                                          19320002
193300                                                                  19330002
193400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19340002
193500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19350002
195510         MOVE SPACE      TO MR-CARRIER-NAME (PV-SUB)              19551019
195540                            MR-SHIP-DATE (PV-SUB)                 19554019
195570                            MR-SHIP-METHOD (PV-SUB)               19557019
195591                            MR-SHIP-NUMBER (PV-SUB)               19559119
195600     ELSE                                                         19560002
197500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           19750002
197700             MOVE ASC-CARRIER-NAME (ASC-BLK-SUB ASC-ITEM-SUB)     19770004
197800                            TO MR-CARRIER-NAME (PV-SUB)           19780004
198100             MOVE ASC-SHIP-DATE (ASC-BLK-SUB ASC-ITEM-SUB)        19810004
198200                            TO MR-SHIP-DATE (PV-SUB)              19820004
198300             MOVE ASC-SHIP-METHOD (ASC-BLK-SUB ASC-ITEM-SUB)      19830004
198500                            TO MR-SHIP-METHOD (PV-SUB)            19850004
198600             MOVE ASC-SHIP-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         19860006
199100                            TO MR-SHIP-NUMBER (PV-SUB)            19910004
200600         END-IF                                                   20060002
200700     END-IF.                                                      20070002
200800     SUBTRACT +1 FROM ASC-ITEM-SUB                                20080002
200900     IF  ASC-ITEM-SUB < + 1                                       20090002
201000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  20100002
201100         MOVE +1                 TO ASC-BLK-SUB                   20110002
201200     END-IF.                                                      20120002
210000                                                                  21000019
210100*----------------------------------------------------------------*21010002
210200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *21020002
210300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *21030002
210400*----------------------------------------------------------------*21040002
210600 5100-WRITE-TEMP-STORAGE.                                         21060002
210700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     21070002
210800                                   TO PV-LIST-ITEM-NUMBER.        21080002
210900     COMPUTE PV-BLOCK-NUMBER =                                    21090002
211000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    21100002
211100                                                                  21110002
211200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             21120002
211300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             21130002
211400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      21140002
211500             PERFORM 5105-REWRITE-ASC-LISTQ                       21150002
211600         END-IF                                                   21160002
211700     ELSE                                                         21170002
211800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       21180002
211900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            21190002
212000         PERFORM 5110-WRITE-ASC-LISTQ                             21200002
212100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   21210002
212200     END-IF.                                                      21220002
212300                                                                  21230002
212400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21240002
212300                                                                  21241019
212500******************************************************************21250002
212600** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **21260002
212700** SPECIFIC COMMAREA.                                           **21270002
212800******************************************************************21280002
212900 5105-REWRITE-ASC-LISTQ.                                          21290002
213000     EXEC CICS                                                    21300002
213100         WRITEQ TS                                                21310002
213200             QUEUE (ASC-LIST-QUEUE-NAME)                          21320002
213300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21330002
213400             ITEM  (PV-BLOCK-NUMBER)                              21340002
213500             REWRITE                                              21350002
213600             RESP  (PV-CICS-RESP)                                 21360002
213700     END-EXEC.                                                    21370002
213800                                                                  21380002
213900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           21390002
214000         CONTINUE                                                 21400002
214100     ELSE                                                         21410002
214200         SET DP013-CICS-ABEND            TO TRUE                  21420002
214300         SET DP013-NO-ROLLBACK           TO TRUE                  21430002
214400         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       21440002
214500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     21450002
214600                                         TO DP013-MESSAGE-TEXT(1) 21460002
214700         PERFORM DP013-0000-PROCESS-ABEND                         21470002
214800     END-IF.                                                      21480002
214900                                                                  21490002
215000******************************************************************21500002
215100** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **21510002
215200** SPECIFIC COMMAREA.                                           **21520002
215300******************************************************************21530002
215400 5110-WRITE-ASC-LISTQ.                                            21540002
215500     EXEC CICS                                                    21550002
215600         WRITEQ TS                                                21560002
215700             QUEUE (ASC-LIST-QUEUE-NAME)                          21570002
215800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21580002
215900             ITEM  (PV-BLOCK-NUMBER)                              21590002
216000             RESP  (PV-CICS-RESP)                                 21600002
216100     END-EXEC.                                                    21610002
216200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      21620002
216300         SET DP013-CICS-ABEND      TO TRUE                        21630002
216400         SET DP013-NO-ROLLBACK     TO TRUE                        21640002
216500         MOVE '5110-WRITE-ASC-LISTQ'                              21650002
216600                                   TO DP013-PARAGRAPH             21660002
216700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           21670002
216800                                   TO DP013-MESSAGE-TEXT(1)       21680002
216900         PERFORM DP013-0000-PROCESS-ABEND                         21690002
217000     END-IF.                                                      21700002
217100                                                                  21710019
223500******************************************************************22350002
223600** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **22360002
223700** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **22370002
223800** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **22380002
223900** THE USER.                                                    **22390002
224000******************************************************************22400002
224100 6000-REFRESH-PANEL-FROM-TEMP.                                    22410002
224200     IF  ASC-UPDATE-TSQ                                           22420002
224300         SET ASC-NO-TSQ-UPDATE TO TRUE                            22430002
224400         MOVE ZERO                 TO PV-SAVE-ITEM                22440002
224500                                      PV-SEL-QUEUE-ITEM           22450002
224600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        22460002
224700                                   TO PV-HOLD-SELECTED-ITEMS      22470002
224800         MOVE +1                   TO PV-ITEMS-PROCESSED          22480002
225300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         22530002
225400                    ASC-BLOCK-ENTRIES (2)                         22540002
225500     END-IF.                                                      22550002
225600                                                                  22560002
243000*----------------------------------------------------------------*24300002
243100* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *24310002
243200*----------------------------------------------------------------*24320002
243400 9100-READ-SEL-QUEUE.                                             24340002
243500     EXEC CICS                                                    24350002
243600         READQ TS                                                 24360002
243700             QUEUE (ASC-SEL-QUEUE-NAME)                           24370002
243800             INTO  (VL006-LINE-SEL-REC)                           24380014
243900             ITEM  (ASC-SEL-ITEM)                                 24390002
244000             RESP  (PV-CICS-RESP)                                 24400002
244100     END-EXEC.                                                    24410002
244200                                                                  24420002
244300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       24430002
244400         CONTINUE                                                 24440002
244500     ELSE                                                         24450002
244600         SET DP013-LOGIC-ABEND                                    24460002
244700             DP013-NO-ROLLBACK     TO TRUE                        24470002
244800         MOVE '9100-READ-SEL-QUEUE'                               24480002
244900                                   TO DP013-PARAGRAPH             24490002
245000         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   24500002
245100                                   TO DP013-MESSAGE-TEXT (1)      24510002
245200         PERFORM DP013-0000-PROCESS-ABEND                         24520002
245300     END-IF.                                                      24530002
245300                                                                  24531019
245400*----------------------------------------------------------------*24540002
245500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *24550002
245600*----------------------------------------------------------------*24560002
245700 9200-REWRITE-SEL-QUEUE.                                          24570002
245800     EXEC CICS                                                    24580002
245900          WRITEQ TS                                               24590002
246000              QUEUE  (ASC-SEL-QUEUE-NAME)                         24600002
246100              FROM   (VL006-LINE-SEL-REC)                         24610014
246200              ITEM   (ASC-SEL-ITEM)                               24620002
246300              RESP   (PV-CICS-RESP)                               24630002
246400              REWRITE                                             24640002
246500     END-EXEC.                                                    24650002
246600                                                                  24660002
246700     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   24670002
246800         SET DP013-CICS-ABEND                                     24680002
246900             DP013-NO-ROLLBACK     TO TRUE                        24690002
247000         MOVE '9200-REWRITE-SEL-QUEUE'                            24700002
247100                                   TO DP013-PARAGRAPH             24710002
247200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   24720002
247300                                   TO DP013-MESSAGE-TEXT (1)      24730002
247400         PERFORM DP013-0000-PROCESS-ABEND                         24740002
247500     END-IF.                                                      24750002
247600                                                                  24760002
247800*----------------------------------------------------------------*24780002
247900*    ABEND PROCESSOR MODULE                                      *24790002
248000*----------------------------------------------------------------*24800002
248200     COPY DPPD013.                                                24820019
