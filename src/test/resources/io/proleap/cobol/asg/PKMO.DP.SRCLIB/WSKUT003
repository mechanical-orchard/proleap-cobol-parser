       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.         WSKUT003.                                            
       AUTHOR.             Siva Nagisetty.                                      
       INSTALLATION.       KOHLS DEPARTMENT STORES.                             
       DATE-WRITTEN.       FEBRUARY 2007.                                       
      ******************************************************************        
      * I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES         
      * SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.                
      * THIS PROGRAM USES MQSERIES.                                             
      ****************************************************************          
       ENVIRONMENT DIVISION.                                                    
      ******************************************************************        
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER.        IBM-3090.                                        
       OBJECT-COMPUTER.        IBM-3090.                                        
                                                                                
       INPUT-OUTPUT SECTION.                                                    
                                                                                
      ******************************************************************        
       FILE-CONTROL.                                                            
      ******************************************************************        
       DATA DIVISION.                                                           
      ******************************************************************        
       FILE SECTION.                                                            
      ******************************************************************        
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-END-OF-VNDR-CSR          PIC X(01) VALUE 'N'.                 
               88  PS-END-OF-VNDR-CSR-Y              VALUE 'Y'.                 
               88  PS-END-OF-VNDR-CSR-N              VALUE 'N'.                 
           05  PS-END-OF-MQ-CSR            PIC X(01) VALUE 'N'.                 
               88  PS-END-OF-MQ-CSR-Y                VALUE 'Y'.                 
               88  PS-END-OF-MQ-CSR-N                VALUE 'N'.                 
           05  PS-END-OF-DFLT-CSR          PIC X(01) VALUE 'N'.                 
               88  PS-END-OF-DFLT-CSR-Y              VALUE 'Y'.                 
               88  PS-END-OF-DFLT-CSR-N              VALUE 'N'.                 
           05  PS-MQPUT-SUCCESSFUL-IND     PIC X(01) VALUE SPACES.              
               88  PS-MQPUT-SUCCESSFUL               VALUE 'Y'.                 
                                                                                
                                                                                
       01  PA-PROGRAM-ACCUMULATORS.                                             
           05  PA-VNDR-READ                PIC S9(9) VALUE +0 COMP-3.           
           05  PA-TOTAL-MQ-MSGS-SENT       PIC S9(9) VALUE +0 COMP-3.           
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
           05  N                           PIC 9(05) VALUE ZEROES.              
171410     05  S                           PIC 9(05) VALUE ZEROES.              
171410     05  T                           PIC 9(05) VALUE ZEROES.              
           05  PV-COUNTER                  PIC 9(05) VALUE ZEROES.              
           05  PV-VNDR-CNT                 PIC 9(05) VALUE ZEROES.              
           05  PV-MQ-CNT                   PIC 9(05) VALUE ZEROES.              
           05  PV-MQ-TBL-CNT               PIC 9(05) VALUE ZEROES.              
           05  PV-MQ-HANDLE-CNT            PIC 9(05) VALUE ZEROES.              
           05  PV-CNT                      PIC 9(05) VALUE ZEROES.              
           05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP SYNC.        
           05  PV-HOLD-COMPLETION-CODE     PIC S9(9) BINARY.                    
           05  PV-HOLD-REASON              PIC S9(9) BINARY.                    
           05  PV-HOLD-PROCESS-TYPE        PIC X(16) VALUE SPACES.              
171410     05  PV-DB2-VENDOR-NBR           PIC S9(9) COMP.                      
           05  PV-XML-BANNER               PIC X(39) VALUE                      
               '<?xml version="1.0" encoding="UTF-8" ?>'.                       
           05  PV-HOLD-VNDR.                                                    
              10  hold-VendorNumber        PIC S9(9) COMP.                      
              10  hold-VendorName          PIC X(30).                           
              10  hold-Company             PIC X(10).                           
              10  hold-Divisiox            PIC X(10).                           
              10  hold-Address1            PIC X(40).                           
              10  hold-Address2            PIC X(40).                           
              10  hold-City                PIC X(30).                           
              10  hold-StateCode           PIC X(06).                           
              10  hold-Zip                 PIC X(16).                           
              10  hold-Country             PIC X(02).                           
171410        10  hold-VendorRating        PIC X(06).                           
           05  PV-VENDOR-DEFAULT-VALUES.                                        
              10  DEFAULT-COMPANY          PIC X(10).                           
              10  DEFAULT-DIVISION         PIC X(10).                           
              10  DEFAULT-BATCH-STAT       PIC X(02).                           
              10  DEFAULT-AUTO-CREAT-BATCH PIC X(01).                           
              10  DEFAULT-STATUS-CODE      PIC X(01).                           
           05  PV-VNDR-HOLD-DFLT-VALUES.                                        
              10  PV-HOLD-TAG-NM           PIC X(50) VALUE SPACES.              
              10  PV-HOLD-DFLT-VALUE       PIC X(02) VALUE SPACES.              
                                                                                
       01  ABEND-CODE                      PIC S9(4) VALUE +0 COMP SYNC.        
       01  PV-HOLD-MSGBUFFER.                                                   
           05  PV-MSGBUFFER-CHAR OCCURS 636993 TIMES                            
                                           PIC X(01).                           
171410*****************************************************************         
171410* HOLD AREA FOR WSRD101 COPYBOOK WHICH IS 198 BYTES PER OCCURANCE         
171410*****************************************************************         
171410 01  PV-HOLD-MASTER.                                                      
171410     05  PV-MASTER-NBR               PIC S9(9) COMP.                      
171410     05  PV-MASTER-CHAR    OCCURS 194 TIMES                               
171410                                     PIC X(01).                           
                                                                                
       01  PV-ABEND-VARIABLES.                                                  
           05  PV-SQLCODE                  PIC S9(9).                           
           05  PV-DISPLAY-SQLCODE          PIC -------999.                      
           05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'WSKUT003'.          
           05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.              
           05  PV-ABEND-OPERATION          PIC X(20) VALUE SPACES.              
           05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.              
           05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.              
           05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP SYNC.        
                                                                                
      *****************************************************************         
      *    RECORD PURPOSE: Vendor Extract (for XML conversion)        *         
      *****************************************************************         
                                                                                
           COPY WSRD101.                                                        
                                                                                
      *01  PV-XML                      PIC X(16777215) VALUE SPACES.            
      *01  PV-XML                      PIC X(999999)   VALUE SPACES.            
       01  PV-XML                      PIC X(1000000)  VALUE SPACES.            
                                                                                
       01  PV-DESC                     PIC X(132)      VALUE SPACES.            
       01  PV-DISPLAY                  PIC X(132)      VALUE SPACES.            
                                                                                
       01  IN-XML                      PIC X(80)       VALUE SPACES.            
       01  IN-EOF-SW                   PIC X           VALUE 'N'.               
           88  IN-EOF                                  VALUE 'Y'.               
                                                                                
       01  XML-LENGTH                  PIC 9(9)    COMP.                        
                                                                                
           COPY ISWS007.                                                        
           COPY ISWS008.                                                        
           COPY ISWS009.                                                        
                                                                                
      *****************************************************************         
      * FILE OPEN STATUS'S ON THE CONTROL CARDS USED FOR GETTING                
      * MQ-SERIES QUEUE MANAGER AND QUEUE NAME.                                 
      *****************************************************************         
       01  CONTROL-CARD-1-STATUS           PIC X(02) VALUE '00'.                
           88  CONTROL-CARD-1-SUCCESS                VALUE '00'.                
           88  CONTROL-CARD-1-ERROR                  VALUE '42'.                
       01  CONTROL-CARD-2-STATUS           PIC X(02) VALUE '00'.                
           88  CONTROL-CARD-2-SUCCESS                VALUE '00'.                
           88  CONTROL-CARD-2-ERROR                  VALUE '42'.                
       01  CONTROL-CARD-3-STATUS           PIC X(02) VALUE '00'.                
           88  CONTROL-CARD-3-SUCCESS                VALUE '00'.                
           88  CONTROL-CARD-3-ERROR                  VALUE '42'.                
                                                                                
       01  PE-MQ-ABEND-VARIABLES.                                               
           05  PE-MQ-QMANAGER              PIC X(05) VALUE SPACES.              
           05  PE-MQ-QMANAGER-REMOTE       PIC X(30) VALUE SPACES.              
           05  PE-MQ-QNAME                 PIC X(48) VALUE SPACES.              
           05  PE-MQ-COMPLETION-CODE       PIC 9(04) VALUE ZEROES.              
           05  PE-MQ-REASON-CODE           PIC 9(04) VALUE ZEROES.              
                                                                                
      ******************************************************************        
      *  DB2 FORMATTED MESSAGE AREA                                             
      ******************************************************************        
           COPY DPWS004.                                                        
                                                                                
      ******************************************************************        
      *  COMMUNICATIONS AREA FOR DB2                                            
      ******************************************************************        
           EXEC SQL                                                             
                INCLUDE SQLCA                                                   
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  DB2 DECLARATION - WMOS SYSTEM INTEGRATION TYPE                         
      *      TABLE (WST_INTGRTN_TYP)                                            
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE WST00008                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  DB2 DECLARATION - WMOS SYSTEM INTEGRATION ATTRIBUTE DEFINITION         
      *      TABLE (WST_ATTR_DEFN)                                              
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE WST00009                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  DB2 DECLARATION - WMOS SYSTEM INTEGRATION ATTRIBUTE ELEMENT            
      *      TABLE (WST_ATTR_ELEM)                                              
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE WST00010                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  DB2 DECLARATION - WMOS - Provider Queue information (Put/Write)        
      *      TABLE (WSV_PRVDR_QUE)                                              
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE WSV00005                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  DB2 DECLARATION FOR VENDOR DEFAULT VALUES.                             
      *      TABLE (WSV_DFLT)                                                   
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE WSV00004                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  DB2 DECLARATION FOR TABLE - WSV_LOC_XREF.                              
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE WSV00000                                                 
           END-EXEC.                                                            
                                                                                
171410******************************************************************        
171410*  DB2 DECLARATION FOR TABLE - SUT_PO_AUD_PARM                            
171410******************************************************************        
171410     EXEC SQL                                                             
171410         INCLUDE SUT00017                                                 
171410     END-EXEC.                                                            
171410                                                                          
171410******************************************************************        
171410*  DB2 DECLARATION FOR TABLE (SUT_VND_RNKG)                               
171410******************************************************************        
171410     EXEC SQL                                                             
171410         INCLUDE SUT00019                                                 
171410     END-EXEC.                                                            
171410                                                                          
      ******************************************************************        
      * COBOL CURSOR DELCARATION TO READ DEFAULT VALUES FOR VENDOR     *        
      ******************************************************************        
           EXEC SQL                                                             
              DECLARE VEND-DFLT-CSR CURSOR WITH HOLD FOR                        
              SELECT  A.TAG_NM                                                  
                   ,  A.ATTR_ELEM                                               
                FROM WSV_DFLT A                                                 
                   , WST_ATTR_DEFN B                                            
              WHERE  A.TYP  =  'VENDOR'                                         
                 AND A.TYP  =  B.INTGRTN_TYP_CDE                                
                 AND A.ATTR_DEFN_SEQ_NBR  =  B.ATTR_DEFN_SEQ_NBR                
           END-EXEC.                                                            
      ******************************************************************        
      * COBOL CURSOR DELCARATION TO READ MQ INFORMATION                *        
      ******************************************************************        
           EXEC SQL                                                             
              DECLARE MQ-CSR CURSOR WITH HOLD FOR                               
              SELECT A.INTGRTN_TYP_DESC                                         
                   , A.LCL_QUE_MGR                                              
                   , A.RMT_QUE_MGR                                              
                   , A.QUE_NM                                                   
                   , INTEGER(SUBSTR(B.WMOS_LOC_NBR,1,4))                        
                FROM   WSV_PRVDR_QUE A                                          
                     , WSV_LOC_XREF  B                                          
              WHERE  A.APPL_FUNC_DESC     =  'EISINBDQ'                         
                 AND A.INTGRTN_TYP_CDE    =  'EISVNDRQ'                         
                 AND A.DC_NBR             =  B.KOHLS_LOC_NBR                    
           END-EXEC.                                                            
      ******************************************************************        
      * COBOL CURSOR DELCARATION TO READ VENDOR ADS                    *        
      ******************************************************************        
           EXEC SQL                                                             
              DECLARE VNDR-CSR  CURSOR WITH HOLD FOR                            
                 SELECT VT1.EXENT_ID                                            
                      , VT1.PRIM_EXENT_NM                                       
                      , coalesce(VT2.addr_LNE_1,'')  AS ADDR_LNE_1              
                      , coalesce(VT2.ADDR_LNE_2,'')  AS ADDR_LNE_2              
                      , coalesce(VT2.CTY_NM,'')      AS CTY_NM                  
                      , coalesce(VT2.ST_PROV_CDE,'') AS ST_PROV_CDE             
                      , coalesce(VT2.PSTL_CDE,'')    AS PSTL_CDE                
                      , coalesce(VT2.CNTRY_CDE,'')   AS CNTRY_CDE               
                 FROM   (SELECT  A.EXENT_ID                                     
                                ,A.PRIM_EXENT_NM                                
                           FROM QQT_EXENT A                                     
                              , QQT_MDSE_VND B                                  
      * jak - add check of actv_ind                                             
      *                   WHERE A.EXENT_ID = B.EXENT_ID) AS VT1                 
                          WHERE A.EXENT_ID = B.EXENT_ID                         
                          AND   A.ACTV_IND = 'Y')      AS VT1                   
                                                                                
                LEFT OUTER JOIN                                                 
                                                                                
                        (SELECT C.EXENT_ID                                      
                              , C.ADDR_LNE_1                                    
                              , C.ADDR_LNE_2                                    
                              , C.CTY_NM                                        
                              , C.ST_PROV_CDE                                   
                              , C.PSTL_CDE                                      
                              , C.CNTRY_CDE                                     
                           FROM QQT_EXENT_ADDR C                                
                          WHERE C.ADDR_FUNC_ID = 4                              
                            AND C.PRIM_ADDR_IND = 'Y') AS VT2                   
                                                                                
                  ON VT1.EXENT_ID = VT2.EXENT_ID                                
                                                                                
           END-EXEC.                                                            
                                                                                
      ****************************************************************          
      **                                                            **          
      **     M Q   S E R I E S    W O R K I N G   S T O R A G E     **          
      **                                                            **          
      **                  M  Q    C O P Y B O O K S                 **          
      **                                                            **          
      ****************************************************************          
       01  MQM-OBJECT-DESCRIPTOR.                                               
           COPY CMQODV.                                                         
                                                                                
       01  MQM-MESSAGE-DESCRIPTOR.                                              
           COPY CMQMDV.                                                         
                                                                                
       01  MQM-PUT-MESSAGE-OPTIONS.                                             
           COPY CMQPMOV.                                                        
                                                                                
       01  MQM-GET-MESSAGE-OPTIONS.                                             
           COPY CMQGMOV.                                                        
                                                                                
       01  MQM-CONSTANTS.                                                       
           COPY CMQV.                                                           
                                                                                
      ****************************************************************          
      ** CONTROL CARDS FOR QUEUE MANAGER AND QUEUE NAME                         
      ****************************************************************          
       01  CC-CONTROL-CARD-1.                                                   
           05  CC-QMGR-NAME-REMOTE         PIC X(50).                           
                                                                                
       01  CC-CONTROL-CARD-2.                                                   
           05  CC-TRANS-QUEUE-NAME         PIC X(50).                           
                                                                                
       01  CC-CONTROL-CARD-3.                                                   
           05  CC-WMOS-DC-NBR              PIC S9(09) COMP.                     
                                                                                
       01  CC-CONTROL-CARD-4.                                                   
           05  CC-QMGR-NAME                PIC X(50).                           
                                                                                
      ****************************************************************          
      ** MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS GET AND    **          
      *  OPEN, CONNECT, DISCONNECT.                                             
      ****************************************************************          
       01  MQ-WORKING-STORAGE.                                                  
           05  PC-MQCONN                   PIC X(08) VALUE 'CSQBCONN'.          
           05  PC-MQOPEN                   PIC X(08) VALUE 'CSQBOPEN'.          
           05  PC-MQINQ                    PIC X(08) VALUE 'CSQBINQ'.           
           05  PC-MQPUT                    PIC X(08) VALUE 'CSQBPUT'.           
           05  PC-MQGET                    PIC X(08) VALUE 'CSQBGET'.           
           05  PC-MQCMIT                   PIC X(08) VALUE 'CSQBCOMM'.          
           05  PC-MQBACK                   PIC X(08) VALUE 'CSQBBACK'.          
           05  PC-MQCLOSE                  PIC X(08) VALUE 'CSQBCLOS'.          
           05  PC-MQDISC                   PIC X(08) VALUE 'CSQBDISC'.          
           05  PC-TRANS-QNAME              PIC X(48) VALUE SPACES.              
           05  PC-QMGR-NAME                PIC X(04) VALUE SPACES.              
               88  PC-PROD-QMGR-NAME                 VALUE 'QKSP'.              
               88  PC-ACCEPT-QMGR-NAME               VALUE 'QKSQ'.              
               88  PC-TEST-QMGR-NAME                 VALUE 'QKST'.              
                                                                                
      ****************************************************************          
      ** QUEUE MANAGER HANDLE                                                   
      *  QUEUE HANDLE                                                           
      ****************************************************************          
       01 PV-MQ-PROGRAM-HANDLES.                                                
           05  PV-QM-NAME                  PIC X(48).                           
           05  PV-QM-NAME-REMOTE           PIC X(48).                           
           05  PV-HCONN                    PIC S9(9) BINARY VALUE 0.            
           05  PV-PQ-HANDLE                PIC S9(9) BINARY VALUE 0.            
                                                                                
      ****************************************************************          
      * ERROR PROCESSING VARIABLES                                              
      * CODES FROM CALLS ARE STORED HERE                                        
      ****************************************************************          
       01 PV-MQ-PROGRAM-VARIABLES.                                              
           05  PV-COMPLETION-CODE          PIC S9(9) BINARY.                    
           05  PV-REASON                   PIC S9(9) BINARY.                    
           05  PV-CON-REASON               PIC S9(9) BINARY.                    
           05  PV-MQCHECK                  PIC X(08) VALUE 'MQR2C'.             
           05  PV-ERROR-MESSAGE            PIC X(48) VALUE SPACES.              
           05  PV-OPEN-OPTIONS             PIC S9(9) BINARY.                    
           05  PV-MQ-REASON-TEXT           PIC X(30) VALUE SPACES.              
      *    05  PV-MSGBUFFER                PIC X(150000) VALUE SPACES.          
           05  PV-CURRENT-TMST             PIC X(26) VALUE SPACES.              
           05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP SYNC.        
           05  PV-PARAGRAPH                PIC X(48) VALUE SPACES.              
           05  PV-MSG-LENGTH               PIC S9(9) BINARY.                    
           05  PV-DC-NBR                   PIC 9(04).                           
           05  PV-MSG-LENGTH-DISPLAY       PIC S9(9).                           
           05  PV-MSGBUFFER.                                                    
               10  PV-MSGBUFFER-banner     PIC X(39) VALUE SPACES.              
               10  PV-MSGBUFFER-data       PIC X(999999) VALUE SPACES.          
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'WSKUT003'.          
           05  PC-MAX-RETRIES              PIC S9(3) VALUE +5 COMP-3.           
           05  PC-READY                    PIC X(06) VALUE 'READY '.            
           05  PC-ERROR                    PIC X(06) VALUE 'ERROR '.            
           05  PC-WAIT-15-SECS             PIC S9(9) VALUE 1500.                
           05  PC-MQPUT-RETRY-COUNTER      PIC 9(3)  VALUE ZERO.                
           05  PC-DELAY-INTERVAL.                                               
               10  FILLER                  PIC X(2)  VALUE SPACES.              
               10  PC-DELAY-TIME           PIC 9(8)  VALUE 3000.                
171410     05  PC-XML-LENGTH               PIC 9(4)  VALUE 194.                 
      ****************************************************************          
      * RETURN CODES ARE EVALUATED AND THIS SWITCH IS USED TO                   
      * INDICATE ANY ERRORS (FROM WHAT I'VE SEEN THIS SWITCH IS                 
      * USELESS SINCE THE PROGRAM ABENDS BEFORE IT IS USED ANYWHERE) *          
      ****************************************************************          
       01 PV-MQ-PROGRAM-SWITCHES.                                               
           05  PS-MQ-ERROR-SW              PIC X(01) VALUE 'N'.                 
               88  PS-NO-MQ-ERROR                    VALUE 'N'.                 
               88  PS-MQ-ERROR                       VALUE 'Y'.                 
       01  PV-MQ-INFO-FOR-DIFF-DCS.                                             
           05  MQ-INFO OCCURS 1 TO 20 TIMES                                     
                            DEPENDING ON PV-MQ-CNT.                             
              10 MQ-INTGRTN-TYP-DESC        PIC X(50).                          
              10 MQ-QMGR-NAME               PIC X(50).                          
              10 MQ-QMGR-NAME-REMOTE        PIC X(50).                          
              10 MQ-TRANS-QUEUE-NAME        PIC X(50).                          
              10 MQ-DC-NBR                  PIC S9(9) COMP.                     
       01  PV-MQ-HANDLE-FOR-DIFF-DCS.                                           
           05  PV-MQ-HANDLE-INFO OCCURS 1 TO 20 TIMES                           
                            DEPENDING ON PV-MQ-HANDLE-CNT.                      
              10 PV-MQ-HANDLE-HOLD  PIC S9(9) BINARY VALUE 0.                   
      ****************************************************************          
      **                     E N D   O F   M Q                      **          
      ****************************************************************          
                                                                                
      ***************************************************************           
       PROCEDURE DIVISION.                                                      
      ***************************************************************           
       0000-MAINLINE.                                                           
           DISPLAY '************ START OF WSKUT003 ***************'             
                                                                                
                                                                                
           PERFORM 1000-INITIALIZE.                                             
                                                                                
           MOVE ZEROES TO PV-COUNTER                                            
                          PV-VNDR-CNT                                           
                          PV-MQ-CNT.                                            
                                                                                
           SET PS-END-OF-VNDR-CSR-N                                             
               PS-END-OF-MQ-CSR-N TO TRUE.                                      
                                                                                
           PERFORM 2000-PROCESS-VENDOR-RECORDS                                  
             UNTIL PS-END-OF-VNDR-CSR-Y.                                        
                                                                                
                                                                                
      *CLOSE THE 'VNDR' CURSOR.                                                 
           PERFORM 2050-CLOSE-VNDR-CURSOR.                                      
                                                                                
      *CLOSE THE MULTIPLE OPEN QUEUES.                                          
           PERFORM 1500-MQ-QUEUE-CLOSE.                                         
                                                                                
      *DISCONNECT FROM THE QMGR.                                                
           PERFORM 1600-DISCONNECT-QMGR.                                        
                                                                                
      * END OF JOB ROUTINE.                                                     
           PERFORM 9000-EOJ-ROUTINE.                                            
                                                                                
           DISPLAY '************  END OF WSKUT003  ***************'             
           STOP RUN.                                                            
                                                                                
      ******************************************************************        
      *                                                                *        
      *           1 0 0 0 - I N I T I A L I Z A T I O N                *        
      *                                                                *        
      ******************************************************************        
       1000-INITIALIZE.                                                         
                                                                                
                                                                                
      *GET CURRENT TIMESTAMP.                                                   
           PERFORM 1100-SET-CURRENT-TMST.                                       
                                                                                
      *GET DEFAULT VALUES FOR VENDOR.                                           
           PERFORM 1150-GET-DEFAULT-VALUES.                                     
                                                                                
      *READ MQ CONTROL CARDS.                                                   
           PERFORM 1200-GET-MQ-QUEUE-INFO.                                      
                                                                                
      *CONNECT TO QUEUE MANAGER ONLY ONCE.                                      
                                                                                
           PERFORM 1300-MQ-CONNECT-TO-QMGR.                                     
                                                                                
      *OPEN THE MULTIPLE QUEUES FOR PUTS                                        
                                                                                
           PERFORM 1400-MQ-QUEUE-OPEN.                                          
                                                                                
      *OPEN THE VNDR CURSOR                                                     
           PERFORM 1900-OPEN-VNDR-CURSOR.                                       
                                                                                
      ******************************************************************        
      * SET THE CURRENT TIMESTAMP.                                              
      ******************************************************************        
       1100-SET-CURRENT-TMST.                                                   
                                                                                
           EXEC SQL                                                             
               SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                         
           END-EXEC                                                             
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                 CONTINUE                                                       
                                                                                
             WHEN SQLWARN0 NOT EQUAL SPACE                                      
             WHEN SQLCODE NOT EQUAL ZERO                                        
                 MOVE '1100-CURRENT-TMST' TO PV-ABEND-PARAGRAPH                 
                 MOVE 'SET CURR TMST'     TO PV-ABEND-OPERATION                 
                 PERFORM 9900-DB2-ABEND                                         
           END-EVALUATE.                                                        
                                                                                
      ****************************************************************          
      * GET VENDOR DEFAULT VALUES.                                              
      ****************************************************************          
       1150-GET-DEFAULT-VALUES.                                                 
                                                                                
           PERFORM 1160-OPEN-DFLT-VALUES-CSR.                                   
                                                                                
           PERFORM 1170-FETCH-DFLT-VALUES-CSR UNTIL                             
                 PS-END-OF-DFLT-CSR-Y.                                          
                                                                                
           PERFORM 1180-CLOSE-DFLT-VALUE-CSR.                                   
                                                                                
      ****************************************************************          
      * OPEN DEFAULT VALUES CURSOR.                                             
      ****************************************************************          
       1160-OPEN-DFLT-VALUES-CSR.                                               
                                                                                
           EXEC SQL                                                             
               OPEN VEND-DFLT-CSR                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                 SET PS-END-OF-DFLT-CSR-N      TO TRUE                          
                                                                                
             WHEN OTHER                                                         
                 MOVE '1160-OPEN-DFLT-VALUES-CSR' TO PV-ABEND-PARAGRAPH         
                 MOVE 'OPEN VEND-DFLT-CSR'        TO PV-ABEND-OPERATION         
                 PERFORM 9900-DB2-ABEND                                         
           END-EVALUATE.                                                        
                                                                                
      ****************************************************************          
      * FETCH VENDOR DEFAULT INFORMATION.                                       
      ****************************************************************          
       1170-FETCH-DFLT-VALUES-CSR.                                              
                                                                                
           INITIALIZE PV-VNDR-HOLD-DFLT-VALUES.                                 
                                                                                
           EXEC SQL                                                             
               FETCH VEND-DFLT-CSR                                              
                INTO                                                            
                    :PV-HOLD-TAG-NM                                             
                   ,:PV-HOLD-DFLT-VALUE                                         
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                                                                                
               EVALUATE PV-HOLD-TAG-NM                                          
                  WHEN 'COMPANY'                                                
                    MOVE PV-HOLD-DFLT-VALUE                                     
                            TO DEFAULT-COMPANY                                  
                  WHEN 'DIVISION'                                               
                    MOVE PV-HOLD-DFLT-VALUE                                     
                            TO DEFAULT-DIVISION                                 
                  WHEN 'DEFAULTBATCHSTAT'                                       
                    MOVE PV-HOLD-DFLT-VALUE                                     
                            TO DEFAULT-BATCH-STAT                               
                  WHEN 'AUTOCREATEBATCH'                                        
                    MOVE PV-HOLD-DFLT-VALUE                                     
                            TO DEFAULT-AUTO-CREAT-BATCH                         
                  WHEN 'STATUSCODE'                                             
                    MOVE PV-HOLD-DFLT-VALUE                                     
                            TO DEFAULT-STATUS-CODE                              
               END-EVALUATE                                                     
                                                                                
             WHEN SQLCODE = +100                                                
                 SET PS-END-OF-DFLT-CSR-Y    TO TRUE                            
                                                                                
             WHEN OTHER                                                         
                 MOVE '1170-FETCH-DFLT-VALUES-CSR' TO PV-ABEND-PARAGRAPH        
                 MOVE 'FETCH DFLT-CSR'             TO PV-ABEND-OPERATION        
                 PERFORM 9900-DB2-ABEND                                         
           END-EVALUATE.                                                        
                                                                                
                                                                                
      ******************************************************************        
       1180-CLOSE-DFLT-VALUE-CSR.                                               
                                                                                
           EXEC SQL                                                             
               CLOSE VEND-DFLT-CSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                 DISPLAY 'DEFAULT-COMPANY:    ' DEFAULT-COMPANY                 
                 DISPLAY 'DEFAULT-DIVISION:   ' DEFAULT-DIVISION                
                 DISPLAY 'DEFAULT-BATCH-STAT: ' DEFAULT-BATCH-STAT              
                 DISPLAY 'DEFAULT-AUTO-CREAT-BATCH: '                           
                           DEFAULT-AUTO-CREAT-BATCH                             
                 DISPLAY 'DEFAULT-STATUS-CODE: ' DEFAULT-STATUS-CODE            
                 DISPLAY '************************'                             
                 CONTINUE                                                       
                                                                                
             WHEN OTHER                                                         
                 MOVE '1180-CLOSE-DFLT-VALUE-CSR' TO PV-ABEND-PARAGRAPH         
                 MOVE 'CLOSE VEND-DFLT-CSR'       TO PV-ABEND-OPERATION         
                 PERFORM 9900-DB2-ABEND                                         
           END-EVALUATE.                                                        
                                                                                
      ****************************************************************          
      * GET MQ INFORMATION FROM DB2 TABLES.                                     
      ****************************************************************          
       1200-GET-MQ-QUEUE-INFO.                                                  
                                                                                
           PERFORM 1210-OPEN-MQ-CSR.                                            
                                                                                
           PERFORM 1220-FETCH-MQ-CURSOR UNTIL                                   
                 PS-END-OF-MQ-CSR-Y.                                            
                                                                                
           PERFORM 1225-CLOSE-MQ-CURSOR.                                        
                                                                                
      ****************************************************************          
      * OPEN MQ CURSOR.                                                         
      ****************************************************************          
       1210-OPEN-MQ-CSR.                                                        
                                                                                
           EXEC SQL                                                             
               OPEN MQ-CSR                                                      
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                 SET PS-END-OF-MQ-CSR-N TO TRUE                                 
                                                                                
             WHEN OTHER                                                         
                 MOVE '1210-OPEN-MQ-CURSOR' TO PV-ABEND-PARAGRAPH               
                 MOVE 'OPEN MQ-CSR'         TO PV-ABEND-OPERATION               
                 PERFORM 9900-DB2-ABEND                                         
           END-EVALUATE.                                                        
                                                                                
      ****************************************************************          
      * FETCH MQ INFORMATION FOR PUTS.                                          
      ****************************************************************          
       1220-FETCH-MQ-CURSOR.                                                    
                                                                                
                                                                                
           EXEC SQL                                                             
               FETCH MQ-CSR                                                     
                INTO                                                            
                    :WSV00005-INTGRTN-TYP-DESC                                  
                   ,:CC-QMGR-NAME                                               
                   ,:CC-QMGR-NAME-REMOTE                                        
                   ,:CC-TRANS-QUEUE-NAME                                        
                   ,:CC-WMOS-DC-NBR                                             
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                                                                                
                 DISPLAY 'QMGR-NAME-REMOTE:' CC-QMGR-NAME-REMOTE                
                 DISPLAY 'TRANS-QUEUE-NAME:' CC-TRANS-QUEUE-NAME                
                                                                                
                 ADD 1 TO PV-MQ-CNT                                             
                                                                                
                                                                                
                 MOVE WSV00005-INTGRTN-TYP-DESC                                 
                        TO MQ-INTGRTN-TYP-DESC(PV-MQ-CNT)                       
                 MOVE CC-QMGR-NAME                                              
                        TO MQ-QMGR-NAME(PV-MQ-CNT)                              
                 MOVE CC-QMGR-NAME-REMOTE                                       
                        TO MQ-QMGR-NAME-REMOTE(PV-MQ-CNT)                       
                 MOVE CC-TRANS-QUEUE-NAME                                       
                        TO MQ-TRANS-QUEUE-NAME(PV-MQ-CNT)                       
                 MOVE CC-WMOS-DC-NBR                                            
                        TO MQ-DC-NBR(PV-MQ-CNT)                                 
                                                                                
             WHEN SQLCODE = +100                                                
                 SET PS-END-OF-MQ-CSR-Y TO TRUE                                 
                                                                                
             WHEN OTHER                                                         
                 MOVE '1020-FETCH-MQ-CURSOR' TO PV-ABEND-PARAGRAPH              
                 MOVE 'FETCH MQ-CSR'         TO PV-ABEND-OPERATION              
                 PERFORM 9900-DB2-ABEND                                         
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
       1225-CLOSE-MQ-CURSOR.                                                    
                                                                                
           EXEC SQL                                                             
               CLOSE MQ-CSR                                                     
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
             DISPLAY ' TOTAL MQ PUTS:' PV-MQ-CNT                                
                 CONTINUE                                                       
                                                                                
             WHEN OTHER                                                         
                 MOVE '1225-CLOSE-MQ-CURSOR' TO PV-ABEND-PARAGRAPH              
                 MOVE 'CLOSE MQ-CSR'         TO PV-ABEND-OPERATION              
                 PERFORM 9900-DB2-ABEND                                         
           END-EVALUATE.                                                        
                                                                                
      ****************************************************************          
      ** OPEN VENDOR CURSOR                                                     
      ****************************************************************          
       1900-OPEN-VNDR-CURSOR.                                                   
                                                                                
           EXEC SQL                                                             
               OPEN VNDR-CSR                                                    
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                 SET PS-END-OF-VNDR-CSR-N TO TRUE                               
                                                                                
             WHEN OTHER                                                         
                 MOVE '1900-OPEN-VNDR-CURSOR' TO PV-ABEND-PARAGRAPH             
                 MOVE 'OPEN VNDR-CSR'         TO PV-ABEND-OPERATION             
                 PERFORM 9900-DB2-ABEND                                         
           END-EVALUATE.                                                        
                                                                                
      ****************************************************************          
      ** CONNECT TO THE MULTIPLE QUEUE MANAGERS.                                
      ** GET THE HANDLE TO THE QUEUE MANAGER - PV-HCONN                         
      ****************************************************************          
       1300-MQ-CONNECT-TO-QMGR.                                                 
                                                                                
                                                                                
           MOVE '1300-MQ-CONNECT-TO-QMGR' TO PV-PARAGRAPH.                      
           MOVE 1 TO PV-MQ-TBL-CNT.                                             
      * CONNECT TO THE QUEUE                                                    
                                                                                
           MOVE MQ-QMGR-NAME(PV-MQ-TBL-CNT) TO PV-QM-NAME.                      
                                                                                
           CALL PC-MQCONN USING PV-QM-NAME                                      
                                PV-HCONN                                        
                                PV-COMPLETION-CODE                              
                                PV-REASON.                                      
                                                                                
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE                      
      *    AND EXIT                                                             
                                                                                
           MOVE PV-REASON TO PV-CON-REASON.                                     
           IF PV-COMPLETION-CODE = MQCC-OK                                      
              ADD 1 TO PV-MQ-TBL-CNT                                            
              DISPLAY 'CONNECTED TO QM -' MQ-QMGR-NAME(PV-MQ-TBL-CNT)           
               CONTINUE                                                         
           ELSE                                                                 
               CALL PV-MQCHECK USING PV-REASON                                  
                                     PV-MQ-REASON-TEXT                          
               MOVE PV-QM-NAME           TO PE-MQ-QMANAGER                      
               MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE               
               MOVE PV-REASON            TO PE-MQ-REASON-CODE                   
               MOVE '1300-MQ-CONNECT-TO-QMGR'                                   
                                         TO PV-ERROR-MESSAGE                    
               PERFORM 9200-MQ-ABEND                                            
           END-IF.                                                              
                                                                                
      ****************************************************************          
      ** OPEN MULTIPLE QUEUES FOR 'PUT'                                         
      ****************************************************************          
       1400-MQ-QUEUE-OPEN.                                                      
                                                                                
           MOVE 1 TO PV-MQ-TBL-CNT.                                             
           PERFORM 1410-MULTI-MQ-OPEN PV-MQ-CNT TIMES.                          
                                                                                
      ****************************************************************          
      ** OPEN MULTIPLE QUEUES FOR 'PUT'                                         
      ****************************************************************          
       1410-MULTI-MQ-OPEN.                                                      
                                                                                
           MOVE '1410-MUTI-MQ-OPEN' TO PV-PARAGRAPH.                            
                                                                                
      * CONTROL CARD 2 - QUEUE NAME                                             
           MOVE MQ-TRANS-QUEUE-NAME(PV-MQ-TBL-CNT)  TO PC-TRANS-QNAME.          
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT                                
                                   + MQOO-SET-IDENTITY-CONTEXT                  
                                   + MQOO-FAIL-IF-QUIESCING.                    
           MOVE PC-TRANS-QNAME       TO MQOD-OBJECTNAME.                        
                                                                                
           DISPLAY 'PC-TRANS-QNAME:' PC-TRANS-QNAME                             
           DISPLAY 'MQOD-OBJECTNAME:' MQOD-OBJECTNAME                           
                                                                                
      * CONTROL CARD 3 - REMOTE QMGR NAME                                       
           MOVE MQ-QMGR-NAME-REMOTE(PV-MQ-TBL-CNT)                              
                                TO MQOD-OBJECTQMGRNAME.                         
                                                                                
      ******************************************************************        
      *REPLACE REMOTE QMGR NAME WITH LOCAL QMGR NAME TO WRITE TO LOCAL Q        
      ******************************************************************        
      *TO WRITE TO A LOCAL QUEUE, UNCOMMENT THE LINE BELOW,                     
      *AND COMMENT OUT THE ABOVE TWO LINES.                                     
      *    MOVE PV-QM-NAME           TO MQOD-OBJECTQMGRNAME.                    
                                                                                
           DISPLAY 'MQOD-OBJECTQMGRNAME:' MQOD-OBJECTQMGRNAME                   
           DISPLAY 'MQOD-OBJECTNAME    :' MQOD-OBJECTNAME                       
           DISPLAY 'PV-HCONN:' PV-HCONN                                         
           DISPLAY 'MQM-OBJECT-DESCRIPTOR:' MQM-OBJECT-DESCRIPTOR               
           DISPLAY 'PV-OPEN-OPTIONS:' PV-OPEN-OPTIONS                           
           DISPLAY 'PV-PQ-HANDLE:' PV-PQ-HANDLE                                 
                                                                                
           CALL PC-MQOPEN USING PV-HCONN                                        
                                MQM-OBJECT-DESCRIPTOR                           
                                PV-OPEN-OPTIONS                                 
                                PV-PQ-HANDLE                                    
                                PV-COMPLETION-CODE                              
                                PV-REASON.                                      
                                                                                
           IF PV-COMPLETION-CODE = MQCC-OK THEN                                 
               ADD 1 TO PV-MQ-TBL-CNT                                           
                        PV-MQ-HANDLE-CNT                                        
               MOVE  PV-PQ-HANDLE TO PV-MQ-HANDLE-HOLD(PV-MQ-HANDLE-CNT)        
REMOVE         DISPLAY 'OPEN COMPLETE'                                          
               CONTINUE                                                         
           ELSE                                                                 
               CALL PV-MQCHECK USING PV-REASON                                  
                                     PV-MQ-REASON-TEXT                          
               MOVE PV-QM-NAME-REMOTE    TO PE-MQ-QMANAGER-REMOTE               
               MOVE PC-TRANS-QNAME       TO PE-MQ-QNAME                         
               MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE               
               MOVE PV-REASON            TO PE-MQ-REASON-CODE                   
               MOVE '1410-MULTI-MQ-OPEN' TO PV-ERROR-MESSAGE                    
               PERFORM 9200-MQ-ABEND                                            
           END-IF.                                                              
                                                                                
      ****************************************************************          
      ** CLOSES THE MQ QUEUE.                                                   
      ****************************************************************          
       1500-MQ-QUEUE-CLOSE.                                                     
                                                                                
           MOVE 1 TO PV-MQ-HANDLE-CNT.                                          
           PERFORM 1510-MQ-MULTI-QUEUE-CLOSE PV-MQ-CNT TIMES.                   
                                                                                
       1510-MQ-MULTI-QUEUE-CLOSE.                                               
                                                                                
           MOVE '1510-MQ-MULTI-QUEUE-CLOSE' TO PV-PARAGRAPH.                    
                                                                                
           CALL PC-MQCLOSE USING PV-HCONN                                       
                                 PV-MQ-HANDLE-HOLD(PV-MQ-HANDLE-CNT)            
                                 MQCO-NONE                                      
                                 PV-COMPLETION-CODE                             
                                 PV-REASON.                                     
                                                                                
           IF PV-COMPLETION-CODE = MQCC-OK                                      
               CONTINUE                                                         
           ELSE                                                                 
               CALL PV-MQCHECK USING PV-REASON                                  
                                     PV-MQ-REASON-TEXT                          
               MOVE PV-QM-NAME           TO PE-MQ-QMANAGER                      
               MOVE PC-TRANS-QNAME       TO PE-MQ-QNAME                         
               MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE               
               MOVE PV-REASON            TO PE-MQ-REASON-CODE                   
               MOVE 'PE-MQ-CLOSE'        TO PV-ERROR-MESSAGE                    
               PERFORM 9200-MQ-ABEND                                            
           END-IF.                                                              
                                                                                
      ****************************************************************          
      ** DISCONNECT FROM THE QUEUE MANAGER                                      
      ****************************************************************          
       1600-DISCONNECT-QMGR.                                                    
           MOVE '1600-DISCONNECT-QMGR' TO PV-PARAGRAPH.                         
                                                                                
           CALL PC-MQDISC USING PV-HCONN                                        
                                PV-COMPLETION-CODE                              
                                PV-REASON                                       
                                                                                
           IF PV-COMPLETION-CODE = MQCC-OK                                      
              CONTINUE                                                          
           ELSE                                                                 
              CALL PV-MQCHECK USING PV-REASON                                   
                                    PV-MQ-REASON-TEXT                           
              MOVE PV-QM-NAME             TO PE-MQ-QMANAGER                     
              MOVE PC-TRANS-QNAME         TO PE-MQ-QNAME                        
              MOVE PV-COMPLETION-CODE     TO PE-MQ-COMPLETION-CODE              
              MOVE PV-REASON              TO PE-MQ-REASON-CODE                  
              MOVE '1600-DISCONNECT-QMGR' TO PV-ERROR-MESSAGE                   
              PERFORM 9200-MQ-ABEND                                             
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *                                                                *        
      *         2 0 0 0 - PROCESS VENDOR RECORDS                       *        
      *                                                                *        
      ******************************************************************        
                                                                                
       2000-PROCESS-VENDOR-RECORDS.                                             
                                                                                
           PERFORM 2020-FETCH-VNDR-CURSOR.                                      
                                                                                
                                                                                
      ******************************************************************        
      * FETCH MERCHANDISE VENDOR RECORDS.                                       
      ******************************************************************        
       2020-FETCH-VNDR-CURSOR.                                                  
                                                                                
                                                                                
           EXEC SQL                                                             
               FETCH VNDR-CSR                                                   
                INTO :hold-VendorNumber                                         
                   , :hold-VendorName                                           
                   , :hold-Address1                                             
                   , :hold-Address2                                             
                   , :hold-City                                                 
                   , :hold-StateCode                                            
                   , :hold-zip                                                  
                   , :hold-Country                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                 ADD 1 TO PV-COUNTER                                            
                          PV-VNDR-CNT                                           
                 MOVE hold-VendorNumber                                         
171410                  TO PV-DB2-VENDOR-NBR                                    
                           VendorNumber(PV-VNDR-CNT)                            
                 MOVE hold-VendorName                                           
                        TO VendorName(PV-VNDR-CNT)                              
                 MOVE hold-Address1                                             
                        TO Address1(PV-VNDR-CNT)                                
                 MOVE hold-Address2                                             
                        TO Address2(PV-VNDR-CNT)                                
                 MOVE hold-City                                                 
                        TO City(PV-VNDR-CNT)                                    
                 MOVE hold-StateCode                                            
                        TO StateCode(PV-VNDR-CNT)                               
                 MOVE hold-zip                                                  
                        TO zip(PV-VNDR-CNT)                                     
                 MOVE hold-Country                                              
                        TO Country(PV-VNDR-CNT)                                 
                 MOVE DEFAULT-COMPANY                                           
                        TO Company(PV-VNDR-CNT)                                 
                 MOVE DEFAULT-DIVISION                                          
                        TO Divisiox(PV-VNDR-CNT)                                
                 MOVE DEFAULT-BATCH-STAT                                        
                        TO DefaultBatchStat(PV-VNDR-CNT)                        
                 MOVE   DEFAULT-AUTO-CREAT-BATCH                                
                        TO AutoCreateBatch(PV-VNDR-CNT)                         
                 MOVE   DEFAULT-STATUS-CODE                                     
                        TO StatusCode(PV-VNDR-CNT)                              
171410           PERFORM 2030-SELECT-VENDOR-RATING                              
171410           MOVE hold-VendorRating                                         
171410                  TO VendorRating(PV-VNDR-CNT)                            
                                                                                
                 IF PV-VNDR-CNT > 99                                            
                   PERFORM 4000-CREATE-MSGS                                     
                   INITIALIZE PV-VNDR-CNT                                       
                   MOVE SPACES TO VendorMasterBridge                            
                 END-IF                                                         
                                                                                
             WHEN SQLCODE = +100                                                
                 SET PS-END-OF-VNDR-CSR-Y TO TRUE                               
                 IF PV-VNDR-CNT > 0                                             
                   PERFORM 4000-CREATE-MSGS                                     
                 END-IF                                                         
                                                                                
             WHEN OTHER                                                         
                 MOVE '2020-FETCH-VNDR-CURSOR' TO PV-ABEND-PARAGRAPH            
                 MOVE 'FETCH VNDR-CSR'         TO PV-ABEND-OPERATION            
                 PERFORM 9900-DB2-ABEND                                         
           END-EVALUATE.                                                        
                                                                                
171410******************************************************************        
171410 2030-SELECT-VENDOR-RATING.                                               
171410                                                                          
171410     EXEC SQL                                                             
171410         SELECT A.VND_RNKG_CDE                                            
171410           INTO :hold-VendorRating                                        
171410           FROM SUT_VND_RNKG     A                                        
171410               ,SUT_PO_AUD_PARM  B                                        
171410          WHERE A.ENT_ID         = :PV-DB2-VENDOR-NBR                     
171410            AND A.PKGNG_TYP_CDE  = 'BC'                                   
171410            AND A.VND_RNKG_CDE   = B.VND_RNKG_CDE                         
171410            AND A.PKGNG_TYP_CDE  = B.PKGNG_TYP_CDE                        
171410            AND B.EFF_BEG_TMST   =                                        
171410             (SELECT MAX(C.EFF_BEG_TMST)                                  
171410                FROM SUT_PO_AUD_PARM   C                                  
171410               WHERE B.VND_RNKG_CDE  = C.VND_RNKG_CDE                     
171410                 AND B.PKGNG_TYP_CDE = C.PKGNG_TYP_CDE)                   
171410         WITH UR                                                          
171410     END-EXEC.                                                            
171410                                                                          
171410     EVALUATE TRUE                                                        
171410       WHEN SQLCODE = ZERO                                                
171410           CONTINUE                                                       
171410                                                                          
171410       WHEN SQLCODE = +100                                                
171410           MOVE 'DEFALT'                 TO hold-VendorRating             
171410                                                                          
171410       WHEN OTHER                                                         
171410           MOVE '2030-SELECT-VENDOR-RATING'                               
171410                                         TO PV-ABEND-PARAGRAPH            
171410           MOVE 'FETCH VENDOR RATING'    TO PV-ABEND-OPERATION            
171410           PERFORM 9900-DB2-ABEND                                         
171410     END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
       2050-CLOSE-VNDR-CURSOR.                                                  
                                                                                
           EXEC SQL                                                             
               CLOSE VNDR-CSR                                                   
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                 CONTINUE                                                       
                                                                                
             WHEN OTHER                                                         
                 MOVE '2050-CLOSE-VNDR-CURSOR' TO PV-ABEND-PARAGRAPH            
                 MOVE 'CLOSE VNDR-CSR'         TO PV-ABEND-OPERATION            
                 PERFORM 9900-DB2-ABEND                                         
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      ******************************************************************        
      ******************************************************************        
       4000-CREATE-MSGS.                                                        
           PERFORM 4100-GENERATE-XML.                                           
                                                                                
           MOVE PV-XML-BANNER              TO PV-MSGBUFFER-banner.              
           MOVE PV-XML(1:XML-LENGTH)       TO PV-MSGBUFFER-data.                
           COMPUTE PV-MSG-LENGTH = XML-LENGTH                                   
                                 + LENGTH OF PV-XML-BANNER.                     
           MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                         
      *    DISPLAY 'MQ MSG-LENGTH = ' PV-MSG-LENGTH-DISPLAY.                    
           INITIALIZE PS-MQPUT-SUCCESSFUL-IND                                   
                      PC-MQPUT-RETRY-COUNTER.                                   
           PERFORM 5000-MQ-PUT-TO-QUEUE                                         
             UNTIL PS-MQPUT-SUCCESSFUL.                                         
                                                                                
           PERFORM 5100-MQ-COMMIT.                                              
                                                                                
      ***************************************************************           
       4100-GENERATE-XML.                                                       
                                                                                
171410     PERFORM 4115-LOW-VALUES-CHECK                                        
171410        VARYING T FROM 1 BY 1                                             
171410           UNTIL T > PV-VNDR-CNT.                                         
171410                                                                          
           MOVE SPACES TO PV-XML.                                               
                                                                                
           XML GENERATE PV-XML                                                  
               FROM VendorMasterBridge                                          
               COUNT IN XML-LENGTH                                              
               ON EXCEPTION                                                     
                   PERFORM 4110-XML-ERROR                                       
               NOT ON EXCEPTION                                                 
                   PERFORM 4200-REPLACE-XML                                     
      *            PERFORM 4120-XML-SUCCESS                                     
           END-XML.                                                             
                                                                                
      ***************************************************************           
       4110-XML-ERROR.                                                          
                                                                                
           PERFORM 9000-EXPLAIN-XML-RESPONSE                                    
           PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                            
                      UNTIL XML-LINE-IDX > XML-RESPONSE-LINES                   
               DISPLAY XML-MSG(XML-LINE-IDX)                                    
           END-PERFORM.                                                         
           MOVE +4018         TO ABEND-CODE.                                    
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
171410***************************************************************           
171410* NEWEST VERSION OF ENTERPRISE COBOL COMPILER CAN NOT HANDLE  *           
171410* LOW-VALUES WHEN DOING AN 'XML GENERATE'. A RETURN CODE OF   *           
171410* 417 WILL BE SET.                                            *           
171410* THIS PARAGRAPH GOES THRU CHARACTER BY CHARACTER TO CHECK FOR*           
171410* LOW-VALUES.  IF ANY ARE FOUND, REPLACE IT WITH SPACES.      *           
171410***************************************************************           
171410 4115-LOW-VALUES-CHECK.                                                   
171410                                                                          
171410     INITIALIZE PV-HOLD-MASTER.                                           
171410     MOVE VendorMaster(T)  TO PV-HOLD-MASTER.                             
171410                                                                          
171410     PERFORM                                                              
171410       VARYING S FROM 1 BY 1                                              
171410         UNTIL S > PC-XML-LENGTH                                          
171410                                                                          
171410         IF PV-MASTER-CHAR (S) = LOW-VALUES                               
171410            MOVE SPACES TO PV-MASTER-CHAR (S)                             
171410         END-IF                                                           
171410                                                                          
171410     END-PERFORM.                                                         
171410                                                                          
171410     MOVE PV-HOLD-MASTER   TO VendorMaster(T).                            
171410                                                                          
      ***************************************************************           
      *4120-XML-SUCCESS.                                                        
                                                                                
      **   DISPLAY 'XML document was successfully generated'.                   
      **   DISPLAY ' '.                                                         
      **   DISPLAY 'The generated XML is ' XML-LENGTH                           
      **           ' characters long.'.                                         
      **   DISPLAY ' '.                                                         
      **   DISPLAY PV-XML-BANNER                                                
      **           PV-XML(1:XML-LENGTH).                                        
                                                                                
      **   DISPLAY ' '.                                                         
      **   DISPLAY 'FORMATTED:'.                                                
      **   MOVE PV-XML(1:XML-LENGTH) TO XML-UNFORMATTED-MSG                     
      **   PERFORM 9554-DISPLAY-FORMATTED-XML.                                  
                                                                                
           COPY ISPD007.                                                        
           COPY ISPD008.                                                        
           COPY ISPD009.                                                        
                                                                                
      ******************************************************************        
       4200-REPLACE-XML.                                                        
                                                                                
      *  INSPECT ... REPLACING command to change the tag.                       
                                                                                
           INSPECT PV-XML REPLACING ALL 'Divisiox' BY 'Division'.               
                                                                                
      ******************************************************************        
      ******************************************************************        
      *                                                                *        
      *             5 0 0 0 - P U T   M Q   M E S S A G E              *        
      *                                                                *        
      ******************************************************************        
       5000-MQ-PUT-TO-QUEUE.                                                    
                                                                                
           MOVE ZEROES TO PV-CNT.                                               
           PERFORM 5100-MQ-MULTI-PUTS PV-MQ-HANDLE-CNT TIMES.                   
                                                                                
       5100-MQ-MULTI-PUTS.                                                      
                                                                                
           ADD 1 TO PV-CNT.                                                     
           MOVE MQMI-NONE    TO MQMD-MSGID.                                     
           MOVE MQCI-NONE    TO MQMD-CORRELID.                                  
           MOVE MQFMT-STRING TO MQMD-FORMAT.                                    
                                                                                
           MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                           
           COMPUTE MQPMO-OPTIONS  = MQPMO-SYNCPOINT                             
                                  + MQPMO-SET-IDENTITY-CONTEXT.                 
           PERFORM 5010-LOW-VALUES.                                             
                                                                                
REMOVE*        DISPLAY '5000 - PV-MQ-HANDLE-HOLD(PV-CNT):'                      
REMOVE*                          PV-MQ-HANDLE-HOLD(PV-CNT)                      
           CALL PC-MQPUT USING PV-HCONN                                         
                               PV-MQ-HANDLE-HOLD(PV-CNT)                        
                               MQM-MESSAGE-DESCRIPTOR                           
                               MQM-PUT-MESSAGE-OPTIONS                          
                               PV-MSG-LENGTH                                    
                               PV-MSGBUFFER                                     
                               PV-COMPLETION-CODE                               
                               PV-REASON.                                       
                                                                                
      *IF PUT FAILED THEN DISPLAY ERROR MESSAGE                                 
           IF (PV-COMPLETION-CODE NOT = MQCC-OK)                                
               IF (PV-REASON NOT = MQRC-PAGESET-FULL                            
                 AND PV-REASON NOT = MQRC-Q-FULL                                
                 AND PV-REASON NOT = MQRC-Q-SPACE-NOT-AVAILABLE )               
                   CALL PV-MQCHECK USING PV-REASON                              
                                         PV-MQ-REASON-TEXT                      
                   DISPLAY 'MQ MESSAGE = ' PV-MSGBUFFER                         
                   MOVE '5000-MQ-PUT-TO-QUEUE'  TO PV-PARAGRAPH                 
                   MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE             
                   MOVE PV-COMPLETION-CODE  TO PV-HOLD-COMPLETION-CODE          
                                               PE-MQ-COMPLETION-CODE            
                   MOVE PV-REASON               TO PV-HOLD-REASON               
                                                   PE-MQ-REASON-CODE            
                   PERFORM 5200-BACK-OUT-MQ                                     
                   MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE           
                   MOVE PV-HOLD-REASON          TO PV-REASON                    
                   PERFORM 9200-MQ-ABEND                                        
               ELSE                                                             
                   ADD 1 TO PC-MQPUT-RETRY-COUNTER                              
                   IF PC-MQPUT-RETRY-COUNTER >= 60                              
                       DISPLAY 'MQ MESSAGE = ' PV-MSGBUFFER                     
                       MOVE '5000-MQ-PUT-TO-QUEUE' TO PV-PARAGRAPH              
                       MOVE 'MQPUT ERROR- RETRY > 60 '                          
                            TO PV-ERROR-MESSAGE                                 
                       MOVE PV-COMPLETION-CODE                                  
                            TO PV-HOLD-COMPLETION-CODE                          
                       MOVE PV-REASON TO PV-HOLD-REASON                         
                       PERFORM 5200-BACK-OUT-MQ                                 
                       MOVE PV-HOLD-COMPLETION-CODE                             
                            TO PV-COMPLETION-CODE                               
                       MOVE PV-HOLD-REASON TO PV-REASON                         
                       PERFORM 9200-MQ-ABEND                                    
                   ELSE                                                         
      *WAIT FOR 30 SECONDS AND TRY AGAIN                                        
                       CALL 'SYSWAIT' USING PC-DELAY-INTERVAL                   
                   END-IF                                                       
               END-IF                                                           
           ELSE                                                                 
               ADD 1 TO PA-TOTAL-MQ-MSGS-SENT                                   
               SET PS-MQPUT-SUCCESSFUL TO TRUE                                  
           END-IF.                                                              
                                                                                
      ******************************************************************        
       5010-LOW-VALUES.                                                         
                                                                                
           MOVE PV-MSGBUFFER TO PV-HOLD-MSGBUFFER.                              
                                                                                
           PERFORM                                                              
             VARYING N FROM 1 BY 1                                              
               UNTIL N > PV-MSG-LENGTH                                          
                                                                                
               IF PV-MSGBUFFER-CHAR (N) = LOW-VALUES                            
                   MOVE SPACES TO PV-MSGBUFFER-CHAR (N)                         
               END-IF                                                           
                                                                                
           END-PERFORM.                                                         
                                                                                
           MOVE PV-HOLD-MSGBUFFER TO PV-MSGBUFFER.                              
                                                                                
      ******************************************************************        
      *  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT                
      ******************************************************************        
       5100-MQ-COMMIT.                                                          
                                                                                
                                                                                
           CALL PC-MQCMIT USING PV-HCONN                                        
                                PV-COMPLETION-CODE                              
                                PV-REASON.                                      
                                                                                
           IF (PV-COMPLETION-CODE NOT = MQCC-OK)                                
              CALL PV-MQCHECK USING PV-REASON                                   
                                    PV-MQ-REASON-TEXT                           
              MOVE '5100-COMMIT-MQ'   TO PV-PARAGRAPH                           
              MOVE 'MQCMIT ERROR'     TO PV-ERROR-MESSAGE                       
              MOVE PV-COMPLETION-CODE TO PV-HOLD-COMPLETION-CODE                
                                         PE-MQ-COMPLETION-CODE                  
              MOVE PV-REASON          TO PV-HOLD-REASON                         
                                         PE-MQ-REASON-CODE                      
              PERFORM 5200-BACK-OUT-MQ                                          
              MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE                
              MOVE PV-HOLD-REASON          TO PV-REASON                         
              PERFORM 9200-MQ-ABEND                                             
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT               
      ******************************************************************        
       5200-BACK-OUT-MQ.                                                        
                                                                                
           CALL PC-MQBACK USING PV-HCONN                                        
                                PV-COMPLETION-CODE                              
                                PV-REASON.                                      
                                                                                
           IF (PV-COMPLETION-CODE NOT = MQCC-OK)                                
              CALL PV-MQCHECK USING PV-REASON                                   
                                    PV-MQ-REASON-TEXT                           
              MOVE '5200-BACK-OUT-MQ'  TO PV-PARAGRAPH                          
              MOVE 'MQBACK ERROR'    TO PV-ERROR-MESSAGE                        
              PERFORM 9200-MQ-ABEND                                             
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * DISPLAY STATISTICS FOR THE PROGRAM                                      
      ******************************************************************        
       9000-EOJ-ROUTINE.                                                        
                                                                                
           DISPLAY ' '                                                          
           DISPLAY ' ********************************************'              
           DISPLAY '     * WSKUT003 SUMMARY STATISTICS *         '              
           DISPLAY ' '                                                          
           DISPLAY '       ---------------------------           '              
           DISPLAY '          VENDOR EXTRACT VIA MQ              '              
           DISPLAY '       ---------------------------           '              
           DISPLAY ' '                                                          
           DISPLAY '   TOTAL VENDOR RECORDS READ:   '                           
                                          PV-COUNTER                            
           DISPLAY ' '                                                          
           DISPLAY '   TOTAL MQ MESSAGES SENT:   '                              
                                          PA-TOTAL-MQ-MSGS-SENT                 
           DISPLAY ' '                                                          
           DISPLAY ' '                                                          
           DISPLAY ' ********************************************'.             
                                                                                
      ****************************************************************          
      ** PERFORM MQ-SERIES ABEND PROCESSING                                     
      ****************************************************************          
       9200-MQ-ABEND.                                                           
                                                                                
           DISPLAY '****************** A B E N D ******************'.           
           DISPLAY '** MQSERIES ERROR **'.                                      
           DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.                  
           DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                            
           DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH.                             
           DISPLAY '** MESSAGE:    ', PV-ERROR-MESSAGE.                         
           DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.                    
           DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                        
           DISPLAY '** RSN TEXT:   ', PV-MQ-REASON-TEXT.                        
           DISPLAY '***********************************************'.           
           MOVE +4013 TO ABEND-CODE.                                            
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
                                                                                
      ******************************************************************        
      * 9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE              
      * EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                         
      ******************************************************************        
       9900-DB2-ABEND.                                                          
                                                                                
           MOVE SQLCODE    TO PV-SQLCODE.                                       
           MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                               
           DISPLAY '*** DB2 ERROR ***'.                                         
           DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.                       
           DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                         
           DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.                       
           DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.                       
           DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.               
           DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.                     
                                                                                
      ******************************************************************        
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-            
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE                 
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE             
      * FORMAT.                                                                 
      ******************************************************************        
           COPY DPPD004.                                                        
                                                                                
           IF SQLCODE NOT = -911                                                
               EXEC SQL                                                         
                   ROLLBACK                                                     
               END-EXEC                                                         
           END-IF.                                                              
                                                                                
           MOVE +4013         TO PV-ABEND-CODE.                                 
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
      ******************************************************************        
      ******************************************************************        
