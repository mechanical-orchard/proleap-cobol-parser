       IDENTIFICATION DIVISION.                                         00010042
       PROGRAM-ID.    SDKUP024.                                         00020042
       AUTHOR.        CHERI PARMLEY                                     00030042
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040042
       DATE-WRITTEN.  09-13-12.                                         00050042
       DATE-COMPILED.                                                   00060042
                                                                        00070042
      ******************************************************************00080042
      *   COBOL/DB2 PROGRAM                                             00090042
      *                                                                 00100042
      *   STORE REQUESTS ADJUSTMENTS                                    00110042
      *                                                                 00120042
      *   THIS PROGRAM READS IN A FILE FTP'D FROM EXCEL WHICH CONTAINS  00130042
      *   LOCATION/WEEK ENDING DATE AND THE STORES ADJUSTMENT FOR       00140042
      *   PAYROLL.                                                      00150042
      *   THE DATA IS LOADED TO TABLE SDT_WKLY_STR_ADJ WHICH THEN WILL  00160042
      *   BE REFLECTED IN THE STORE PROJECTION SYSTEM.                  00170042
      *                                                                 00180042
      *   IF DATE ON FILE IS LESS THAN CURRENT DATE, FILE WILL NOT BE   00190042
      *   PROCESSED. IT IS ASSUMED THAT THE DATA WAS ALREADY LOADED.    00200042
      ******************************************************************00210042
      *   CHANGE HISTORY                                                00220042
      ******************************************************************00230042
      *  09/13/12  C.PARMLEY        PR3316C   INITIAL WRITE             00240042
      ******************************************************************00250042
C5025 *  02/11/15  ADDED STEPS TO INSERT/UPDATE PYRL_ADJ_HR_QTY         00260042
C5025 *  COLUMN INTO THE TABLE.                                         00270042
C5025 *  MADE BY: COGNIZANT                        CHG0105025           00280042
      ******************************************************************00290042
       ENVIRONMENT DIVISION.                                            00300042
       CONFIGURATION SECTION.                                           00310042
       SOURCE-COMPUTER.  IBM-3090.                                      00320042
       OBJECT-COMPUTER.  IBM-3090.                                      00330042
                                                                        00340042
       INPUT-OUTPUT SECTION.                                            00350042
       FILE-CONTROL.                                                    00360042
                                                                        00370042
           SELECT INPUT-FILE                                            00380042
               ASSIGN TO INP01.                                         00390042
                                                                        00400042
       DATA DIVISION.                                                   00410042
       FILE SECTION.                                                    00420042
                                                                        00430042
       FD  INPUT-FILE                                                   00440042
           RECORDING MODE IS F                                          00450042
           LABEL RECORDS ARE STANDARD                                   00460042
           RECORD CONTAINS 80  CHARACTERS                               00470042
           BLOCK CONTAINS 0 RECORDS                                     00480042
           DATA RECORD IS INPUT-RECORD.                                 00490042
                                                                        00500042
       01  INPUT-RECORD                    PIC X(80).                   00510042
                                                                        00520042
       WORKING-STORAGE SECTION.                                         00530042
       01  PC-PROGRAM-CONSTANTS.                                        00540042
           05  PC-PROGRAM                  PIC X(08) VALUE 'SDKUP024'.  00550042
                                                                        00560042
       01  WORK-FIELDS.                                                 00570042
           05  WS-DATE.                                                 00580042
               10 WS-YEAR                  PIC 9(02) VALUE ZEROES.      00590042
               10 WS-MONTH                 PIC 9(02) VALUE ZEROES.      00600042
               10 WS-DAY                   PIC 9(02) VALUE ZEROES.      00610042
               10 PV-PYRL-ADJ-AMT          PIC S9(7)V9(2) COMP-3.       00620042
C5025          10 PV-PYRL-ADJ-HR-QTY       PIC S9(7)V9(2) COMP-3.       00630042
                                                                        00640042
       01  PV-PROGRAM-VARIABLES.                                        00650042
           05  PV-PARA-NAME                PIC X(25) VALUE SPACES.      00660042
           05  PV-ABEND-NOTE               PIC X(40) VALUE SPACES.      00670042
           05  PV-ABEND-NOTE2              PIC X(40) VALUE SPACES.      00680042
           05  PV-RECS-INSERT              PIC 9(09) VALUE ZEROES.      00690042
           05  PV-RECS-UPDATED             PIC 9(09) VALUE ZEROES.      00700042
           05  PV-CNT                      PIC 9(01) VALUE ZEROES.      00710042
C5025      05  PV-CNT-1                    PIC 9(01) VALUE ZEROES.      00720042
                                                                        00730042
                                                                        00740042
      ******************************************************************00750042
      * FILE HEADER CHECK LAYOUT                                        00760042
      ******************************************************************00770042
       01  PV-HEADER-CHECK-LAYOUT.                                      00780042
           05  PV-DATA-CHECK               PIC X(01) VALUE SPACES.      00790042
           05  FILLER                      PIC X(79) VALUE SPACES.      00800042
                                                                        00810042
       01  PV-DATE-HEADER.                                              00820042
           05  PV-MONTH                    PIC 9(02) VALUE ZEROES.      00830042
           05  FILLER                      PIC X(01) VALUE SPACES.      00840042
           05  PV-DAY                      PIC 9(02) VALUE ZEROES.      00850042
           05  FILLER                      PIC X(01) VALUE SPACES.      00860042
           05  PV-YEAR                     PIC 9(04) VALUE ZEROES.      00870042
           05  FILLER                      PIC X(70) VALUE SPACES.      00880042
                                                                        00890042
       01  PV-WK-END-DTE.                                               00900042
           05  PV-MONTHX                   PIC 9(02) VALUE ZEROES.      00910042
           05  FILLER                      PIC X(01) VALUE SPACES.      00920042
           05  PV-DAYX                     PIC 9(02) VALUE ZEROES.      00930042
           05  FILLER                      PIC X(01) VALUE SPACES.      00940042
           05  PV-YEARX                    PIC 9(04) VALUE ZEROES.      00950042
                                                                        00960042
      ******************************************************************00970042
      **TIME FIELDS                                                     00980042
      ******************************************************************00990042
       01  SD-TIME-STAMP                   PIC  X(26)  VALUE SPACES.    01000042
       01  FILLER REDEFINES SD-TIME-STAMP.                              01010042
           05  SD-CURR-DTE                 PIC  X(10).                  01020042
           05  FILLER                      PIC  X(01).                  01030042
           05  SD-HOUR                     PIC  X(02).                  01040042
           05  FILLER                      PIC  X(01).                  01050042
           05  SD-MINUTE                   PIC  X(02).                  01060042
           05  FILLER                      PIC  X(01).                  01070042
           05  SD-SECOND                   PIC  X(02).                  01080042
           05  FILLER                      PIC  X(01).                  01090042
           05  SD-MICROSEC                 PIC  X(06).                  01100042
                                                                        01110042
       01  PROGRAM-UNSTRING.                                            01120042
           05  STR-NBR                  PIC 9(04) VALUE ZEROES.         01130042
C5025      05  STR-HRS                  PIC X(08) VALUE SPACES.         01140042
           05  STR-RATE                 PIC X(05) VALUE SPACES.         01150042
           05  ADJUST-AMT               PIC X(08) VALUE SPACES.         01160042
           05  WEEK-END-DTE             PIC X(10) VALUE ZEROES.         01170042
                                                                        01180042
      ***BELOW ARE NOT PART OF INPUT LAYOUT                             01190042
           05  UV-DOLLARS               PIC  9(06) VALUE ZEROS.         01200042
           05  UV-CENTS                 PIC  9(02) VALUE ZEROS.         01210042
C5025      05  UV-HOURS                 PIC  9(06) VALUE ZEROS.         01220042
C5025      05  UV-MINS                  PIC  X(02) VALUE ZEROS.         01230042
                                                                        01240042
           05  UV-ADJUST-AMT            PIC S9(06)V99.                  01250042
           05  UV-ADJUST-AMT1 REDEFINES UV-ADJUST-AMT.                  01260042
               10  UV-ADJUST-DOL        PIC 9(06).                      01270042
               10  UV-ADJUST-CENTS      PIC 9(02).                      01280042
                                                                        01290042
C5025      05  UV-ADJUST-HR-QTY         PIC S9(06)V99.                  01300042
C5025      05  UV-ADJUST-HR-QTY1      REDEFINES UV-ADJUST-HR-QTY.       01310042
C5025          10  UV-ADJUST-HRS        PIC 9(06).                      01320042
C5025          10  UV-ADJUST-MINS       PIC 9(02).                      01330042
                                                                        01340042
       01  SW-SWITCHES.                                                 01350042
           05  SW-EOF                      PIC X(01) VALUE 'N'.         01360042
               88  SW-NOT-END-OF-FILE                VALUE 'N'.         01370042
               88  SW-END-OF-FILE                    VALUE 'Y'.         01380042
           05  SW-VALID-DATE               PIC X(01) VALUE 'N'.         01390042
               88  SW-VALID-PROCESS-DATE             VALUE 'Y'.         01400042
               88  SW-NOT-VALID-PROCESS-DATE         VALUE 'N'.         01410042
                                                                        01420042
                                                                        01430042
       01  ABEND-CODE                  PIC S9(04)  VALUE +0 COMP SYNC.  01440042
           88  AC-OPEN-FILE-ERROR                  VALUE +4005.         01450042
           88  AC-CLOSE-FILE-ERROR                 VALUE +4006.         01460042
           88  AC-DB2-ERROR                        VALUE +4013.         01470042
           88  AC-DATE-ROUTINE-ERROR               VALUE +4019.         01480042
           88  AC-LOGIC-ERROR                      VALUE +4020.         01490042
      *----------------------------------------------------------------*01500042
      * PARAMETER LIST FOR THE CALENDAR ROUTINE                         01510042
      *----------------------------------------------------------------*01520042
           COPY DPWS500.                                                01530042
                                                                        01540042
      *----------------------------------------------------------------*01550042
      *    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *01560042
      *----------------------------------------------------------------*01570042
           COPY DPWS004.                                                01580042
                                                                        01590042
      *----------------------------------------------------------------*01600042
      * DB2 MESSAGE AREA                                                01610042
      *----------------------------------------------------------------*01620042
           COPY SQLCA2.                                                 01630042
                                                                        01640042
      *----------------------------------------------------------------*01650042
      * STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                 01660042
      *----------------------------------------------------------------*01670042
           EXEC SQL                                                     01680042
               INCLUDE SQLCA                                            01690042
           END-EXEC.                                                    01700042
                                                                        01710042
      *----------------------------------------------------------------*01720042
      * SDT_WKLY_STR_ADJ TABLE                                          01730042
      *----------------------------------------------------------------*01740042
           EXEC SQL                                                     01750042
               INCLUDE SDT00034                                         01760042
           END-EXEC.                                                    01770042
                                                                        01780042
                                                                        01790042
                                                                        01800042
       PROCEDURE DIVISION.                                              01810042
      ******************************************************************01820042
       0000-MAIN.                                                       01830042
      ******************************************************************01840042
                                                                        01850042
           PERFORM 1000-INITIALIZE.                                     01860042
                                                                        01870042
           IF SW-END-OF-FILE                                            01880042
               CONTINUE                                                 01890042
           ELSE                                                         01900042
               IF SW-VALID-PROCESS-DATE                                 01910042
                   PERFORM UNTIL SW-END-OF-FILE                         01920042
                     PERFORM 4000-UNSTRING-RECORD                       01930042
                     PERFORM 5000-MOVE-FIELDS                           01940042
                     PERFORM 3000-READ-FILE                             01950042
                   END-PERFORM                                          01960042
               ELSE                                                     01970042
                   DISPLAY '--------------------------------'           01980042
                   DISPLAY 'LOADING DATA DATE < CURRENT DATE'           01990042
                   DISPLAY 'FILE WILL NOT BE PROCESSED '                02000042
                   DISPLAY '--------------------------------'           02010042
               END-IF                                                   02020042
           END-IF.                                                      02030042
                                                                        02040042
           PERFORM 9500-COMMIT.                                         02050042
           PERFORM 9999-FINAL-HSKP.                                     02060042
                                                                        02070042
           STOP RUN.                                                    02080042
                                                                        02090042
      ******************************************************************02100042
       1000-INITIALIZE.                                                 02110042
      ******************************************************************02120042
                                                                        02130042
           OPEN INPUT INPUT-FILE.                                       02140042
                                                                        02150042
      *    READ DATE HEADER IN FILE                                     02160042
           PERFORM 3000-READ-FILE.                                      02170042
                                                                        02180042
           IF SW-END-OF-FILE                                            02190042
               DISPLAY '--------------------------------'               02200042
               DISPLAY 'EMPTY FILE                      '               02210042
               DISPLAY 'SDKUP024 ENDS                   '               02220042
               DISPLAY '--------------------------------'               02230042
           ELSE                                                         02240042
               MOVE INPUT-RECORD TO PV-DATE-HEADER                      02250042
               DISPLAY 'LOADING DATA FOR ' PV-DATE-HEADER               02260042
               PERFORM 1200-VALIDATE-DATE                               02270042
               PERFORM 1100-GET-TIMESTAMP                               02280042
      *        READ HEADER RECORDS                                      02290042
               PERFORM 3000-READ-FILE                                   02300042
               MOVE INPUT-RECORD TO PV-HEADER-CHECK-LAYOUT              02310042
               PERFORM UNTIL PV-DATA-CHECK NUMERIC                      02320042
                 PERFORM 3000-READ-FILE                                 02330042
                 MOVE INPUT-RECORD TO PV-HEADER-CHECK-LAYOUT            02340042
               END-PERFORM                                              02350042
           END-IF.                                                      02360042
                                                                        02370042
      **********************************************************        02380042
      **RETRIEVE DB2 TIMESTAMP                                          02390042
      **********************************************************        02400042
       1100-GET-TIMESTAMP.                                              02410042
                                                                        02420042
           MOVE '1100-GET-TIMESTAMP' TO PV-PARA-NAME.                   02430042
                                                                        02440042
           EXEC SQL                                                     02450042
                SET :SD-TIME-STAMP = CURRENT TIMESTAMP                  02460042
           END-EXEC.                                                    02470042
                                                                        02480042
           DISPLAY 'CURRENT TIMESTAMP = ' SD-TIME-STAMP.                02490042
                                                                        02500042
           IF SQLCODE NOT EQUAL ZERO                                    02510042
               DISPLAY 'UNSUCCESSFUL TIME RETRIEVAL'                    02520042
               PERFORM 9000-DB2-ABEND                                   02530042
           END-IF.                                                      02540042
                                                                        02550042
           IF DPG55-DB2-ISO-DATE-FMT < SD-TIME-STAMP(1:10)              02560042
               SET SW-NOT-VALID-PROCESS-DATE TO TRUE                    02570042
           ELSE                                                         02580042
               SET SW-VALID-PROCESS-DATE TO TRUE                        02590042
           END-IF.                                                      02600042
                                                                        02610042
      ******************************************************************02620042
      * VALIDATES HEADER DATE AND REFORMATS TO CCYY-MM-DD               02630042
      ******************************************************************02640042
       1200-VALIDATE-DATE.                                              02650042
      ******************************************************************02660042
                                                                        02670042
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02680042
           SET DPG51-VALID-FISCAL-CALENDAR TO TRUE.                     02690042
           SET DPG52-LK-DTE-ISO TO TRUE.                                02700042
           MOVE PV-YEAR  TO DPG52-DB2-ISO-DATE-YR.                      02710042
           MOVE PV-MONTH TO DPG52-DB2-ISO-DATE-MO.                      02720042
           MOVE PV-DAY   TO DPG52-DB2-ISO-DATE-DY.                      02730042
                                                                        02740042
           PERFORM 1400-CALL-DATE-ROUTINE.                              02750042
                                                                        02760042
           EVALUATE TRUE                                                02770042
             WHEN DPG54-NO-ERROR                                        02780042
               CONTINUE                                                 02790042
             WHEN OTHER                                                 02800042
                SET AC-DATE-ROUTINE-ERROR TO TRUE                       02810042
                MOVE '1200-VALIDATE-DATE' TO PV-PARA-NAME               02820042
                MOVE 'DATE ROUTINE ERROR' TO PV-ABEND-NOTE              02830042
                MOVE PV-DATE-HEADER       TO PV-ABEND-NOTE2             02840042
                PERFORM 8000-NON-DB2-ABEND                              02850042
           END-EVALUATE.                                                02860042
                                                                        02870042
                                                                        02880042
                                                                        02890042
      ******************************************************************02900042
      * VALIDATES DATE AND REFORMATS TO CCYY-MM-DD                     *02910042
      ******************************************************************02920042
       1300-WK-END-DATE.                                                02930042
      ******************************************************************02940042
                                                                        02950042
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02960042
           SET DPG51-VALID-FISCAL-CALENDAR TO TRUE.                     02970042
           SET DPG52-LK-DTE-ISO TO TRUE.                                02980042
           MOVE PV-YEARX  TO DPG52-DB2-ISO-DATE-YR.                     02990042
           MOVE PV-MONTHX TO DPG52-DB2-ISO-DATE-MO.                     03000042
           MOVE PV-DAYX   TO DPG52-DB2-ISO-DATE-DY.                     03010042
                                                                        03020042
           PERFORM 1400-CALL-DATE-ROUTINE.                              03030042
                                                                        03040042
           EVALUATE TRUE                                                03050042
             WHEN DPG54-NO-ERROR                                        03060042
               CONTINUE                                                 03070042
             WHEN OTHER                                                 03080042
                SET AC-DATE-ROUTINE-ERROR TO TRUE                       03090042
                MOVE '1300-WK-END-DATE  ' TO PV-PARA-NAME               03100042
                MOVE 'DATE ROUTINE ERROR' TO PV-ABEND-NOTE              03110042
                MOVE PV-WK-END-DTE        TO PV-ABEND-NOTE2             03120042
                PERFORM 8000-NON-DB2-ABEND                              03130042
           END-EVALUATE.                                                03140042
                                                                        03150042
      ******************************************************************03160042
       1400-CALL-DATE-ROUTINE.                                          03170042
      ******************************************************************03180042
                                                                        03190042
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                03200042
                                                   DPG52                03210042
                                                   DPG53                03220042
                                                   DPG54                03230042
                                                   DPG55                03240042
                                                   DPG56.               03250042
                                                                        03260042
                                                                        03270042
      ******************************************************************03280042
       3000-READ-FILE.                                                  03290042
      ******************************************************************03300042
                                                                        03310042
           READ INPUT-FILE                                              03320042
              AT END                                                    03330042
                 SET SW-END-OF-FILE TO TRUE                             03340042
           END-READ.                                                    03350042
                                                                        03360042
      ******************************************************************03370042
       4000-UNSTRING-RECORD.                                            03380042
      ******************************************************************03390042
                                                                        03400042
           UNSTRING INPUT-RECORD                                        03410042
           DELIMITED BY ',' OR ' '                                      03420042
           INTO  STR-NBR                                                03430042
                 STR-HRS                                                03440042
                 STR-RATE                                               03450042
                 ADJUST-AMT                                             03460042
                 WEEK-END-DTE                                           03470042
           END-UNSTRING.                                                03480042
                                                                        03490042
           MOVE ZERO TO PV-CNT.                                         03500042
           INSPECT ADJUST-AMT TALLYING PV-CNT FOR LEADING '-'.          03510042
           INSPECT ADJUST-AMT REPLACING LEADING '-' BY '0'.             03520042
                                                                        03530042
           UNSTRING ADJUST-AMT                                          03540042
             DELIMITED BY '.' OR ' ' INTO   UV-DOLLARS                  03550042
                                          , UV-CENTS.                   03560042
                                                                        03570042
           MOVE UV-DOLLARS TO UV-ADJUST-DOL.                            03580042
           MOVE UV-CENTS   TO UV-ADJUST-CENTS                           03590042
C5025                                                                   03600042
C5025      MOVE ZERO TO PV-CNT-1.                                       03610042
C5025      INSPECT STR-HRS    TALLYING PV-CNT-1 FOR LEADING '-'.        03620042
C5025      INSPECT STR-HRS    REPLACING LEADING '-' BY '0'.             03630042
C5025      UNSTRING STR-HRS                                             03640042
C5025        DELIMITED BY '.' OR ' ' INTO   UV-HOURS                    03650042
C5025                                     , UV-MINS.                    03660042
C5025      MOVE UV-HOURS               TO UV-ADJUST-HRS                 03670042
C5025      MOVE UV-MINS                TO UV-ADJUST-MINS.               03680042
                                                                        03690042
           MOVE WEEK-END-DTE TO PV-WK-END-DTE.                          03700042
           PERFORM 1300-WK-END-DATE.                                    03710042
                                                                        03720042
      ******************************************************************03730042
       5000-MOVE-FIELDS.                                                03740042
      ******************************************************************03750042
                                                                        03760042
           MOVE STR-NBR        TO SDT00034-STR-NBR.                     03770042
           MOVE WEEK-END-DTE   TO SDT00034-WK-END-DTE.                  03780042
           IF PV-CNT = 1                                                03790042
               MULTIPLY -1 BY UV-ADJUST-AMT                             03800042
           END-IF.                                                      03810042
C5025                                                                   03820042
C5025      IF PV-CNT-1 = 1                                              03830042
C5025          MULTIPLY -1 BY UV-ADJUST-HR-QTY                          03840042
C5025      END-IF.                                                      03850042
C5025                                                                   03860042
           MOVE UV-ADJUST-AMT  TO PV-PYRL-ADJ-AMT.                      03870042
C5025      MOVE UV-ADJUST-HR-QTY  TO PV-PYRL-ADJ-HR-QTY.                03880042
                                                                        03890042
           PERFORM 6000-DB-INSERT.                                      03900042
                                                                        03910042
                                                                        03920042
      ******************************************************************03930042
       6000-DB-INSERT.                                                  03940042
      ******************************************************************03950042
                                                                        03960042
           EXEC SQL                                                     03970042
           INSERT INTO SDT_WKLY_STR_ADJ                                 03980042
             (STR_NBR                                                   03990042
             ,WK_END_DTE                                                04000042
C5025        ,PYRL_ADJ_AMT                                              04010042
C5025        ,PYRL_ADJ_HR_QTY)                                          04020042
           VALUES ( :SDT00034-STR-NBR                                   04030042
                   ,:SDT00034-WK-END-DTE                                04040042
C5025              ,:PV-PYRL-ADJ-AMT                                    04050042
C5025              ,:PV-PYRL-ADJ-HR-QTY)                                04060042
           END-EXEC.                                                    04070042
                                                                        04080042
           EVALUATE TRUE                                                04090042
               WHEN SQLCODE = +0                                        04100042
                   ADD 1 TO PV-RECS-INSERT                              04110042
                                                                        04120042
               WHEN SQLCODE = -803                                      04130042
                   PERFORM 7000-DB-UPDATE                               04140042
                                                                        04150042
               WHEN SQLCODE = -913                                      04160042
                   MOVE '6000-DB-INSERT' TO PV-PARA-NAME                04170042
                   MOVE 'RESOURCE UNAVAILABLE' TO PV-ABEND-NOTE         04180042
                   PERFORM 9000-DB2-ABEND                               04190042
                                                                        04200042
               WHEN SQLCODE = -904                                      04210042
                   MOVE '6000-DB-INSERT' TO PV-PARA-NAME                04220042
                   MOVE 'RESOURCE UNAVAILABLE' TO PV-ABEND-NOTE         04230042
                   PERFORM 9000-DB2-ABEND                               04240042
                                                                        04250042
               WHEN OTHER                                               04260042
                   MOVE '6000-DB-INSERT' TO PV-PARA-NAME                04270042
                   DISPLAY '                                          ' 04280042
                   DISPLAY '******************************************' 04290042
                   DISPLAY '          STR = ' SDT00034-STR-NBR          04300042
                   DISPLAY '   WK-END-DTE = ' SDT00034-WK-END-DTE       04310042
                   DISPLAY '   ADJUST-AMT = ' UV-ADJUST-AMT             04320042
                   DISPLAY '******************************************' 04330042
                   PERFORM 9000-DB2-ABEND                               04340042
           END-EVALUATE.                                                04350042
                                                                        04360042
      ******************************************************************04370042
       7000-DB-UPDATE.                                                  04380042
      ******************************************************************04390042
                                                                        04400042
           EXEC SQL                                                     04410042
           UPDATE SDT_WKLY_STR_ADJ                                      04420042
              SET PYRL_ADJ_AMT  = (PYRL_ADJ_AMT + :PV-PYRL-ADJ-AMT)     04430042
C5025            ,PYRL_ADJ_HR_QTY =                                     04440042
C5025                        (PYRL_ADJ_HR_QTY + :PV-PYRL-ADJ-HR-QTY)    04450042
              WHERE STR_NBR       = :SDT00034-STR-NBR                   04460042
              AND   WK_END_DTE    = :SDT00034-WK-END-DTE                04470042
           END-EXEC.                                                    04480042
                                                                        04490042
           EVALUATE TRUE                                                04500042
               WHEN SQLCODE = +0                                        04510042
                   ADD 1 TO PV-RECS-UPDATED                             04520042
               WHEN SQLCODE = +100                                      04530042
                   CONTINUE                                             04540042
                                                                        04550042
               WHEN SQLCODE = -913                                      04560042
                   MOVE '7000-DB-UPDATE' TO PV-PARA-NAME                04570042
                   MOVE 'RESOURCE UNAVAILABLE' TO PV-ABEND-NOTE         04580042
                   PERFORM 9000-DB2-ABEND                               04590042
                                                                        04600042
               WHEN SQLCODE = -904                                      04610042
                   MOVE '7000-DB-UPDATE' TO PV-PARA-NAME                04620042
                   MOVE 'RESOURCE UNAVAILABLE' TO PV-ABEND-NOTE         04630042
                   PERFORM 9000-DB2-ABEND                               04640042
                                                                        04650042
               WHEN OTHER                                               04660042
                   MOVE '7000-DB-UPDATE' TO PV-PARA-NAME                04670042
                   DISPLAY '                                          ' 04680042
                   DISPLAY '******************************************' 04690042
                   DISPLAY '          STR = ' SDT00034-STR-NBR          04700042
                   DISPLAY '   WK-END-DTE = ' SDT00034-WK-END-DTE       04710042
                   DISPLAY '   ADJUST-AMT = ' UV-ADJUST-AMT             04720042
                   DISPLAY '******************************************' 04730042
                   PERFORM 9000-DB2-ABEND                               04740042
           END-EVALUATE.                                                04750042
                                                                        04760042
                                                                        04770042
      ******************************************************************04780042
       8000-NON-DB2-ABEND.                                              04790042
      ******************************************************************04800042
                                                                        04810042
           PERFORM 9999-FINAL-HSKP.                                     04820042
                                                                        04830042
           DISPLAY '***************************************************'04840042
           DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM                    04850042
           DISPLAY '** PARAGRAPH        ' PV-PARA-NAME                  04860042
           DISPLAY '** ' PV-ABEND-NOTE                                  04870042
           DISPLAY '** ' PV-ABEND-NOTE2                                 04880042
           DISPLAY '***************************************************'04890042
                                                                        04900042
           CALL 'ILBOABN0' USING ABEND-CODE.                            04910042
                                                                        04920042
                                                                        04930042
      ******************************************************************04940042
       9000-DB2-ABEND.                                                  04950042
      ******************************************************************04960042
                                                                        04970042
           MOVE SQLCODE TO SQLCODE2.                                    04980042
           MOVE SQLERRD(3) TO SQLERRD3.                                 04990042
                                                                        05000042
           PERFORM 9999-FINAL-HSKP.                                     05010042
                                                                        05020042
           DISPLAY '**************************************************' 05030042
           DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM                    05040042
           DISPLAY '** PARAGRAPH        ' PV-PARA-NAME                  05050042
           DISPLAY '** SQL ERROR      = ' SQLCODE2.                     05060042
           DISPLAY '** SQLERRM        = ' SQLERRM.                      05070042
           DISPLAY '**************************************************'.05080042
                                                                        05090042
      *----------------------------------------------------------------*05100042
      *  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   05110042
      *  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        05120042
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05130042
      *  FORMAT.                                                        05140042
      *----------------------------------------------------------------*05150042
           COPY DPPD004.                                                05160042
                                                                        05170042
           CALL 'DSNTIAR' USING SQLCA                                   05180042
                                DP004-FORMATTED-MESSAGE                 05190042
                                DP004-ERROR-LINE-LENGTH.                05200042
                                                                        05210042
           DISPLAY DP004-ASTERISK-LINE.                                 05220042
                                                                        05230042
           PERFORM                                                      05240042
              VARYING DP004-MSG-IDX                                     05250042
              FROM 1 BY 1                                               05260042
              UNTIL DP004-MSG-IDX > DP004-MAX-MESSAGE-LINES             05270042
                  DISPLAY '**'                                          05280042
                          DP004-MESSAGE-LINE (DP004-MSG-IDX)            05290042
                          ' **'                                         05300042
           END-PERFORM.                                                 05310042
                                                                        05320042
           DISPLAY DP004-ASTERISK-LINE.                                 05330042
                                                                        05340042
           IF SQLCODE NOT = -911                                        05350042
               EXEC SQL                                                 05360042
                   COMMIT                                               05370042
               END-EXEC                                                 05380042
           END-IF.                                                      05390042
                                                                        05400042
           SET AC-DB2-ERROR TO TRUE.                                    05410042
                                                                        05420042
           CALL 'ILBOABN0' USING ABEND-CODE.                            05430042
                                                                        05440042
                                                                        05450042
      ******************************************************************05460042
       9500-COMMIT.                                                     05470042
      ******************************************************************05480042
                                                                        05490042
           EXEC SQL                                                     05500042
              COMMIT                                                    05510042
           END-EXEC.                                                    05520042
                                                                        05530042
           EVALUATE TRUE                                                05540042
               WHEN SQLCODE = +0                                        05550042
                 CONTINUE                                               05560042
               WHEN OTHER                                               05570042
                   MOVE '9500-COMMIT' TO PV-PARA-NAME                   05580042
                   PERFORM 9000-DB2-ABEND                               05590042
           END-EVALUATE.                                                05600042
                                                                        05610042
                                                                        05620042
      ******************************************************************05630042
       9999-FINAL-HSKP.                                                 05640042
      ******************************************************************05650042
                                                                        05660042
           CLOSE INPUT-FILE.                                            05670042
                                                                        05680042
           DISPLAY '                    '.                              05690042
           DISPLAY '********************'.                              05700042
           DISPLAY '  SDKUP024 CONTROLS '.                              05710042
           DISPLAY '===================='.                              05720042
           DISPLAY '# INSERTS = ' PV-RECS-INSERT.                       05730042
           DISPLAY '# UPDATES = ' PV-RECS-UPDATED.                      05740042
                                                                        05750042
                                                                        05760042
