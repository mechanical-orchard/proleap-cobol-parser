000100******************************************************************00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300******************************************************************00030099
000400                                                                  00040099
000500 PROGRAM-ID.   TMKUP630.                                          00050099
000600 AUTHOR.       MICHAEL FRIESS.                                    00060099
000700 INSTALLATION. KOHLS DEPARTMENT STORES.                           00070099
000800 DATE-WRITTEN. MAY, 1999.                                         00080099
000900 DATE-COMPILED.                                                   00090099
001000                                                                  00100099
001100******************************************************************00110099
001200*  THIS PROGRAM IS PART OF THE IMPORTS EXCEPTION REPORTING       *00120099
001300*  SYSTEM.  IT IS CALLED BY PROGRAM TMKUP625 TO INSERT, UPDATE   *00130099
001400*  OR RESOLVE TROUBLES.  AFTER THESE FUNCTIONS ARE PERFORMED,    *00140099
001500*  A CODE SPECIFYING SUCCESS OR ERROR IS RETURNED TO TMKUP625.   *00150099
001600*  THE PROGRAM ALSO WRITES DETAIL AND ERROR ROWS TO A WORK TABLE *00160099
001700*  FOR REPORTING.                                                *00170099
001800******************************************************************00180099
001900*  SPECIAL NOTE - IF THE SYSTEM IS ENHANCED TO ALLOW MORE THAN 1  00190099
002000*    INSERT PER CALL, CODE IN PARAGRAPH  '4000-INSERT-TROUBLE'    00200099
002100*    MUST BE UMCOMMENTED AND '9300-SET-CURRENT-TIMESTAMP' MUST BE 00210099
002200*    PERFORMED BEFORE THE LAST UPDATE TIMESTAMP IS MOVED INTO     00220099
002300*    TRBDTL.  EACH TIME THAT HAPPENS, THE LAST DETAIL TRBL TIME   00230099
002400*    STAMP WILL HAVE TO BE UPDATED ON TRBNTF.                     00240099
002500******************************************************************00250099
002600******************************************************************00260099
002700 ENVIRONMENT DIVISION.                                            00270099
002800******************************************************************00280099
002900                                                                  00290099
003000 CONFIGURATION SECTION.                                           00300099
003100                                                                  00310099
003200 SOURCE-COMPUTER.        IBM-3090.                                00320099
003300 OBJECT-COMPUTER.        IBM-3090.                                00330099
003400                                                                  00340099
003500 INPUT-OUTPUT SECTION.                                            00350099
003600                                                                  00360099
003700 FILE-CONTROL.                                                    00370099
003800                                                                  00380099
003900******************************************************************00390099
004000 DATA DIVISION.                                                   00400099
004100******************************************************************00410099
004200                                                                  00420099
004300 FILE SECTION.                                                    00430099
004400                                                                  00440099
004500                                                                  00450099
004600******************************************************************00460099
004700 WORKING-STORAGE SECTION.                                         00470099
004800******************************************************************00480099
004900                                                                  00490099
005000******************************************************************00500099
005100*  DB2 FORMATTED MESSAGE AREA                                     00510099
005200******************************************************************00520099
005300     COPY DPWS004.                                                00530099
005400                                                                  00540099
005500******************************************************************00550099
005600*  COMMUNICATIONS AREA FOR DB2                                    00560099
005700******************************************************************00570099
005800     EXEC SQL                                                     00580099
005900          INCLUDE SQLCA                                           00590099
006000     END-EXEC.                                                    00600099
006100                                                                  00610099
006200******************************************************************00620099
006300*  DB2 TABLE DECLARATION - RC-TROUBLE NOTIFICATION.               00630099
006400*      (TTRBNTF)                                                  00640099
006500******************************************************************00650099
006600     EXEC SQL                                                     00660099
006700          INCLUDE TTRBNTF                                         00670099
006800     END-EXEC.                                                    00680099
006900                                                                  00690099
007000******************************************************************00700099
007100*  DB2 TABLE DECLARATION -  TR-PO TRACKING TROUBLE KEY TABLE      00710099
007200*      (TIMTBKY)                                                  00720099
007300******************************************************************00730099
007400     EXEC SQL                                                     00740099
007500          INCLUDE TIMTBKY                                         00750099
007600     END-EXEC.                                                    00760099
007700                                                                  00770099
007800******************************************************************00780099
007900*  DB2 TABLE DECLARATION - RC-TROUBLE DETAIL.                     00790099
008000*      (TTRBDTL)                                                  00800099
008100******************************************************************00810099
008200     EXEC SQL                                                     00820099
008300          INCLUDE TTRBDTL                                         00830099
008400     END-EXEC.                                                    00840099
008500                                                                  00850099
008600******************************************************************00860099
008700*  DB2 TABLE DECLARATION - PO TRACKING BOOKINGS.                  00870099
008800*      (TIMBKPO)                                                  00880099
008900******************************************************************00890099
009000     EXEC SQL                                                     00900099
009100          INCLUDE TIMBKPO                                         00910099
009200     END-EXEC.                                                    00920099
009300                                                                  00930099
009400******************************************************************00940099
009500*  DB2 TABLE DECLARATION - PO TRACKING RECEIVING.                 00950099
009600*      (TIMRCPO)                                                  00960099
009700******************************************************************00970099
009800     EXEC SQL                                                     00980099
009900          INCLUDE TIMRCPO                                         00990099
010000     END-EXEC.                                                    01000099
010100                                                                  01010099
010200******************************************************************01020099
010300*  DB2 TABLE DECLARATION - PO TRACKING CONTAINER.                 01030099
010400*      (TIMCNPO)                                                  01040099
010500******************************************************************01050099
010600     EXEC SQL                                                     01060099
010700          INCLUDE TIMCNPO                                         01070099
010800     END-EXEC.                                                    01080099
010900                                                                  01090099
011000******************************************************************01100099
011100*  DB2 TABLE DECLARATION - PO TRACKING CUSTOMS ENTRY.             01110099
011200*      (TIMCSEN)                                                  01120099
011300******************************************************************01130099
011400     EXEC SQL                                                     01140099
011500          INCLUDE TIMCSEN                                         01150099
011600     END-EXEC.                                                    01160099
011700                                                                  01170099
011800******************************************************************01180099
011900*  DB2 TABLE DECLARATION - IC-VIOLATION CODE MASTER.              01190099
012000*      (TICDMST)                                                  01200099
012100******************************************************************01210099
012200     EXEC SQL                                                     01220099
012300          INCLUDE TICDMST                                         01230099
012400     END-EXEC.                                                    01240099
012500                                                                  01250099
012600******************************************************************01260099
012700*  DB2 TABLE DECLARATION - TROUBLE REASON TABLE.                  01270099
012800*      (TTRBRSN)                                                  01280099
012900******************************************************************01290099
013000     EXEC SQL                                                     01300099
013100          INCLUDE TTRBRSN                                         01310099
013200     END-EXEC.                                                    01320099
013300                                                                  01330099
013400******************************************************************01340099
013500*  DB2 TABLE DECLARATION - IC-VIOLATION CODE VALUE.               01350099
013600*      (TICDVAL)                                                  01360099
013700******************************************************************01370099
013800     EXEC SQL                                                     01380099
013900          INCLUDE TICDVAL                                         01390099
014000     END-EXEC.                                                    01400099
014100                                                                  01410099
014200******************************************************************01420099
014300*  DB2 TABLE DECLARATION - PO-PURCHASE TABLE                      01430099
014400*      (TPURCHS)                                                  01440099
014500******************************************************************01450099
014600     EXEC SQL                                                     01460099
014700          INCLUDE TPURCHS                                         01470099
014800     END-EXEC.                                                    01480099
014900                                                                  01490099
015000 EJECT                                                            01500099
015100******************************************************************01510099
015200*  DB2 TABLE DECLARATION - PO-PLAN SHIP TABLE                     01520099
015300*      (TPLNSHP)                                                  01530099
015400******************************************************************01540099
015500     EXEC SQL                                                     01550099
015600          INCLUDE TPLNSHP                                         01560099
015700     END-EXEC.                                                    01570099
015800                                                                  01580099
015900 EJECT                                                            01590099
016000******************************************************************01600099
016100*  DB2 TABLE DECLARATION - PROCESSING RESULTS WORK TABLE         *01610099
016200*      (TOUTTM2)                                                 *01620099
016300******************************************************************01630099
016400     EXEC SQL                                                     01640099
016500          INCLUDE TOUTTM2                                         01650099
016600     END-EXEC.                                                    01660099
016700                                                                  01670099
016800 EJECT                                                            01680099
016900******************************************************************01690099
017000*   TROUBLE PROCESSING - ERROR REPORT RECORD LAYOUT (TOUTTM2)     01700099
017100******************************************************************01710099
017200     COPY TMRD600.                                                01720099
017300                                                                  01730099
017400 EJECT                                                            01740099
017500******************************************************************01750099
017600*   TROUBLE PROCESSING - DETAIL REPORT RECORD LAYOUT (TOUTTM2)    01760099
017700******************************************************************01770099
017800     COPY TMRD604.                                                01780099
017900                                                                  01790099
018000 EJECT                                                            01800099
018100******************************************************************01810099
018200*   TROUBLE DATA RECORD                                           01820099
018300******************************************************************01830099
018400     COPY TMRD601.                                                01840099
018500                                                                  01850099
018600 EJECT                                                            01860099
018700******************************************************************01870099
018800*  RANDOM IMPORT TROUBLE DATA RECORD                              01880099
018900******************************************************************01890099
019000     COPY DPWS902.                                                01900099
019100                                                                  01910099
019200 EJECT                                                            01920099
019300                                                                  01930099
019400                                                                  01940099
019500 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01950099
019600                                                   COMP SYNC.     01960099
019700                                                                  01970099
019800 01  PS-PROGRAM-SWITCHES.                                         01980099
019900     05  PS-EDIT-ERRORS-SW             PIC  X(01).                01990099
020000         88  PS-EDIT-ERRORS                          VALUE 'Y'.   02000099
020100         88  PS-NO-EDIT-ERRORS                       VALUE 'N'.   02010099
020200     05  PS-RANDOM-STATUS-SW           PIC  X(02).                02020099
020300         88  PS-RANDOM-STATUS-OK                     VALUE 'OK'.  02030099
020400         88  PS-RANDOM-STATUS-FAILED                 VALUE 'FL'.  02040099
020500         88  PS-RANDOM-STATUS-OFF                    VALUE '  '.  02050099
020600                                                                  02060099
020700 01  PC-PROGRAM-CONSTANTS.                                        02070099
020800*********** CURRENT PROGRAM NAME                                  02080099
020900     05  PC-TMKUP630                 PIC X(08)     VALUE          02090099
021000         'TMKUP630'.                                              02100099
021100*********** MAIN CALLING PROGRAM                                  02110099
021200     05  PC-TMKUP625                 PIC X(08)     VALUE          02120099
021300         'TMKUP625'.                                              02130099
021400     05  PC-RAND-PGM                 PIC X(08)     VALUE          02140099
021500         'DPKUT902'.                                              02150099
021600     05  PC-RANDOM-CALL-ERROR        PIC X(50)     VALUE          02160099
021700         '@@2 TMKUP630 - CALL IN PGF 4010- FAILED FOR PO -  '.    02170099
021800     05  PC-1                        PIC S9(04)    VALUE +1       02180099
021900                                                     COMP.        02190099
022000     05  PC-3                        PIC S9(04)    VALUE +3       02200099
022100                                                     COMP.        02210099
022200     05  PC-42                       PIC S9(04)    VALUE +42      02220099
022300                                                     COMP.        02230099
022400     05  PC-500                      PIC S9(04)    VALUE +500     02240099
022500                                                     COMP.        02250099
022600     05  PC-600                      PIC S9(04)    VALUE +600     02260099
022700                                                     COMP.        02270099
022800     05  PC-A                        PIC X(01)     VALUE 'A'.     02280099
022900     05  PC-Y                        PIC X(01)     VALUE 'Y'.     02290099
023000                                                                  02300099
023100     05  PC-WARNING                  PIC X(03)     VALUE 'WRN'.   02310099
023200     05  PC-ERROR                    PIC X(03)     VALUE 'ERR'.   02320099
023300     05  PC-DASH                     PIC X(01)     VALUE '-'.     02330099
023400     05  PC-DEFAULT-NINES-TMST       PIC X(26)     VALUE          02340099
023500                                     '9999-09-09-00.00.00.000000'.02350099
023600     05  PC-DEFAULT-TMST             PIC X(26)     VALUE          02360099
023700                                     '0001-01-01-00.00.00.000000'.02370099
023800     05  PC-DEFAULT-DTE              PIC X(10)     VALUE          02380099
023900                                     '0001-01-01'.                02390099
024000     05  PC-DEFAULT-DATE             PIC X(08)     VALUE          02400099
024100                                     '00010101'.                  02410099
024200     05  PC-DEFAULT-TIME             PIC X(04)     VALUE          02420099
024300                                     '0000'.                      02430099
024400     05  PC-MAX-RETRIES              PIC S9(03)    VALUE +5       02440099
024500                                                     COMP.        02450099
024600                                                                  02460099
024700 01  PV-PROGRAM-VARIABLES.                                        02470099
024800                                                                  02480099
024900     05  PV-DATA-SOURCE              PIC X(02).                   02490099
025000         88  PV-BOOKING                             VALUE 'BK'.   02500099
025100         88  PV-CONTAINER                           VALUE 'CN'.   02510099
025200         88  PV-CONTAINER-VOYAGE                    VALUE 'CV'.   02520099
025300         88  PV-CUSTOMS                             VALUE 'CS'.   02530099
025400         88  PV-PO                                  VALUE 'PO'.   02540099
025500         88  PV-RECEIVING                           VALUE 'RC'.   02550099
025600     05  PV-PO-NBR                   PIC S9(09) COMP.             02560099
025700     05  PV-PURCHS-VER-NBR           PIC S9(09) COMP.             02570099
025800     05  PV-TRBL-RSN-CDE             PIC S9(09) COMP.             02580099
025900     05  PV-DISPLAY-PO-NBR           PIC ZZZZZZZZ9.               02590099
026000     05  PV-DISPLAY-COMP             PIC ZZZZZZZZZZ9.             02600099
026100     05  PV-HOLD-TR201-PO-NBR        PIC 9(09).                   02610099
026200     05  PV-HOLD-TR201-PO-NBR-X REDEFINES                         02620099
026300         PV-HOLD-TR201-PO-NBR        PIC X(09).                   02630099
026400     05  PV-HOLD-NOTIF-NBR           PIC S9(09).                  02640099
026500     05  PV-HOLD-TR201-ERROR-MSG     PIC X(50) VALUE SPACES.      02650099
026600     05  PV-CUR-TMST                 PIC X(26) VALUE SPACES.      02660099
026700     05  PV-RESV-BY.                                              02670099
026800         10  PV-RESV-BY-MSG      PIC X(12) VALUE 'RESOLVED BY '.  02680099
026900         10  PV-RESV-BY-DESC     PIC X(30) VALUE SPACES.          02690099
027000     05  PV-PROCESS-ON-CNTR          PIC S9(4) VALUE ZERO         02700099
027100                                                     COMP.        02710099
027200     05  PV-RANDOM-CNTR              PIC S9(4) VALUE ZERO         02720099
027300                                                     COMP.        02730099
027400     05  PV-DATA-SOURCE-CNTR         PIC S9(8) VALUE ZERO         02740099
027500                                                     COMP.        02750099
027600                                                                  02760099
027700                                                                  02770099
027800     05  PV-REFORMAT-TMST.                                        02780099
027900         10  PV-REFORMAT-TMST-DTE.                                02790099
028000             15  PV-REFORMAT-TMST-DTE-CY  PIC X(04)  VALUE SPACES.02800099
028100             15  PV-REFORMAT-TMST-DTE-MM  PIC X(02)  VALUE SPACES.02810099
028200             15  PV-REFORMAT-TMST-DTE-DD  PIC X(02)  VALUE SPACES.02820099
028300         10  PV-REFORMAT-TMST-TM.                                 02830099
028400             15  PV-REFORMAT-TMST-TM-HH   PIC X(02)  VALUE SPACES.02840099
028500             15  PV-REFORMAT-TMST-TM-MM   PIC X(02)  VALUE SPACES.02850099
028600     05  PV-SUB-SCRIPTS            COMP.                          02860099
028700         10  PV-KY-SUB               PIC S9(04).                  02870099
028800         10  PV-DT-SUB               PIC S9(04).                  02880099
028900                                                                  02890099
029000******************************************************************02900099
029100 LINKAGE SECTION.                                                 02910099
029200******************************************************************02920099
029300                                                                  02930099
029400 01  LINKAGE-SECTION-TM601-RECORD                                 02940099
029500                                 PIC X(12346).                    02950099
029600                                                                  02960099
029700******************************************************************02970099
029800                                                                  02980099
029900 PROCEDURE DIVISION USING LINKAGE-SECTION-TM601-RECORD.           02990099
030000                                                                  03000099
030100******************************************************************03010099
030200* PARAGRAPH NUMBERING.                                           *03020099
030300*   0000 - MAINLINE PROCESS.                                     *03030099
030400*   1000 - INITILIZATION.                                        *03040099
030500*   2000 - EDIT PARAMETERS PASSED FROM CALLING PROGRAM.          *03050099
030600*   3000 - VALIDATE DATES FROM CALLING PROGRAM.                  *03060099
030700*   4000 - TROUBLE NOTIFICATION INSERT.                          *03070099
030800*   5000 - TROUBLE NOTIFICATION UPDATE.                          *03080099
030900*   6000 - TROUBLE NOTIFICATION RESOLUTION.                      *03090099
031000*   7000 - TROUBLE NOTIFICATION ACKNOWLEDGEMENT.                 *03100099
031100*   8000 - DETAIL AND ERROR REPORTING.                           *03110099
031200*   9000 - ERROR PROCESSING/COMMON SUBROUTINES.                  *03120099
031300*                                                                *03130099
031400*   NOTE: AS SOON AS AN EDIT ERROR OCCURS NO FURTHER PROCESSING  *03140099
031500*         OCCURS, A NON ZERO RETURN CODE IS ISSUED & THE PROGRAM *03150099
031600*         IS EXITED. THAT'S WHY YOU SEE "IF PS-NO-EDIT-ERRORS"   *03160099
031700*         IN FRONT OF MANY MAINLINE AND OTHER PROCESSES.         *03170099
031800******************************************************************03180099
031900                                                                  03190099
032000 0000-PROGRAM-MAINLINE.                                           03200099
032100                                                                  03210099
032200     PERFORM 1000-INITIALIZE.                                     03220099
032300                                                                  03230099
032400     PERFORM 2000-EDIT-CALLING-PGM-DATA.                          03240099
032500                                                                  03250099
032600* TEMPORARLY REMOVED EDIT FOR NOW RPM 07/02                       03260099
032700* IT IS NOT NEEDED UNTIL ONLINE DATA ENTRY IS IN PLACE.           03270099
032800*    IF PS-NO-EDIT-ERRORS                                         03280099
032900*      PERFORM 3000-VALIDATE-DATES.                               03290099
033000* ----------------------------------------------------------------03300099
033100*   NOTE: THE PARAGRAPHS PERFORMED IN 3000-VALIDATE-DATES HAS NOT 03310099
033200*         BEEN TESTED.     MJF 07/20/99                           03320099
033300* ----------------------------------------------------------------03330099
033400                                                                  03340099
033500     IF PS-NO-EDIT-ERRORS                                         03350099
033600                                                                  03360099
033700       MOVE TM601-PO-NBR        TO PV-PO-NBR                      03370099
033800       MOVE TM601-DATA-SOURCE   TO PV-DATA-SOURCE                 03380099
033900                                                                  03390099
034000       IF TM601-TRBL-PROCESS-SW        = 'I'                      03400099
034100         PERFORM 4000-INSERT-TROUBLE                              03410099
034200       END-IF                                                     03420099
034300                                                                  03430099
034400       IF TM601-UPD-PROCESS-SW         = 'U'                      03440099
034500         PERFORM 5000-UPDATE-TROUBLE                              03450099
034600       END-IF                                                     03460099
034700                                                                  03470099
034800       IF TM601-RSLV-PROCESS-SW        = 'R'                      03480099
034900         PERFORM 6000-RESOLVE-TROUBLE                             03490099
035000       END-IF                                                     03500099
035100                                                                  03510099
035200       IF TM601-ACKNOWL-PROCESS-SW     = 'A'                      03520099
035300         PERFORM 7000-ACKNOWLEDGE-TROUBLE                         03530099
035400       END-IF                                                     03540099
035500                                                                  03550099
035600     END-IF.                                                      03560099
035700                                                                  03570099
035800     IF PS-NO-EDIT-ERRORS                                         03580099
035900       PERFORM 8000-DETAIL-REPORT-ROW                             03590099
036000     ELSE                                                         03600099
036100       PERFORM 8100-ERROR-REPORT-ROW.                             03610099
036200                                                                  03620099
036300     MOVE TM601-RECORD TO LINKAGE-SECTION-TM601-RECORD.           03630099
036400                                                                  03640099
036500     EXIT PROGRAM.                                                03650099
036600                                                                  03660099
036700******************************************************************03670099
036800*  MOVE LINKAGE SECTION TO WORKING STORAGE.                      *03680099
036900*  INITIALIZES PROGRAM SWITCHES, TM601-RETURN-CODE.              *03690099
037000******************************************************************03700099
037100                                                                  03710099
037200 1000-INITIALIZE.                                                 03720099
037300                                                                  03730099
037400     MOVE LINKAGE-SECTION-TM601-RECORD TO TM601-RECORD.           03740099
037500     SET TM601-CALL-SUCCESSFUL  TO TRUE.                          03750099
037600     SET PS-NO-EDIT-ERRORS      TO TRUE.                          03760099
037700     SET PS-RANDOM-STATUS-OFF   TO TRUE.                          03770099
037800     MOVE ZERO                  TO PV-DATA-SOURCE-CNTR            03780099
037900                                   PV-PROCESS-ON-CNTR             03790099
038000                                   PV-RANDOM-CNTR.                03800099
038100     INITIALIZE DCLTTRBNTF                                        03810099
038200                DCLTIMTBKY                                        03820099
038300                DCLTTRBDTL                                        03830099
038400                TM600-RECORD                                      03840099
038500                TM604-RECORD.                                     03850099
038600                                                                  03860099
038700     PERFORM 9300-SET-CURRENT-TIMESTAMP.                          03870099
038800                                                                  03880099
038900******************************************************************03890099
039000                                                                  03900099
039100 2000-EDIT-CALLING-PGM-DATA.                                      03910099
039200                                                                  03920099
039300     MOVE '2000-EDIT-CALLING-PGM-DATA    '                        03930099
039400                                    TO TM600-CURR-PARAGRAPH.      03940099
039500                                                                  03950099
039600     IF TM601-CALLING-PGM-NME  = SPACES                           03960099
039700       SET TM601-INVALID-CALLING-PGM TO TRUE                      03970099
039800     END-IF.                                                      03980099
039900                                                                  03990099
040000     IF PS-NO-EDIT-ERRORS                                         04000099
040100       PERFORM 2100-VALIDATE-DATA-SOURCE.                         04010099
040200                                                                  04020099
040300*    ***********************************************************  04030099
040400*    * ENSURE THAT 1 & ONLY 1 VALID PROCESS SWITCH IS TURNED ON.  04040099
040500*    ***********************************************************  04050099
040600                                                                  04060099
040700     IF PS-NO-EDIT-ERRORS                                         04070099
040800       IF TM601-TRBL-PROCESS-SW       =  'I'                      04080099
040900         ADD PC-1 TO PV-PROCESS-ON-CNTR                           04090099
041000       END-IF                                                     04100099
041100       IF TM601-RSLV-PROCESS-SW       =  'R'                      04110099
041200         ADD PC-1 TO PV-PROCESS-ON-CNTR                           04120099
041300       END-IF                                                     04130099
041400       IF TM601-UPD-PROCESS-SW        =  'U'                      04140099
041500         ADD PC-1 TO PV-PROCESS-ON-CNTR                           04150099
041600       END-IF                                                     04160099
041700       IF TM601-ACKNOWL-PROCESS-SW    =  'A'                      04170099
041800         ADD PC-1 TO PV-PROCESS-ON-CNTR                           04180099
041900       END-IF                                                     04190099
042000       IF PV-PROCESS-ON-CNTR = PC-1                               04200099
042100         CONTINUE                                                 04210099
042200       ELSE                                                       04220099
042300         SET TM601-INVALID-PRCS-SWITCH TO TRUE                    04230099
042400         SET PS-EDIT-ERRORS            TO TRUE                    04240099
042500         MOVE 'INVALID PROCESS SWITCH        '                    04250099
042600                                     TO TM600-TRBL-ERROR-TEXT     04260099
042700         PERFORM 9200-DISPLAY-ERROR                               04270099
042800       END-IF                                                     04280099
042900     END-IF.                                                      04290099
043000                                                                  04300099
043100 EJECT                                                            04310099
043200                                                                  04320099
043300******************************************************************04330099
043400                                                                  04340099
043500  2100-VALIDATE-DATA-SOURCE.                                      04350099
043600                                                                  04360099
043700     MOVE '2100-VALIDATE-DATA-SOURCE     '                        04370099
043800                                    TO TM600-CURR-PARAGRAPH.      04380099
043900                                                                  04390099
044000     EXEC SQL                                                     04400099
044100        SELECT COUNT(*)                                           04410099
044200          INTO :PV-DATA-SOURCE-CNTR                               04420099
044300          FROM TICDMST  A                                         04430099
044400              ,TICDVAL  B                                         04440099
044500         WHERE B.CDE_ID              =  :PC-500                   04450099
044600           AND B.CDVL_CDE            =  :TM601-DATA-SOURCE        04460099
044700           AND A.CDE_ID              =  B.CDE_ID                  04470099
044800           AND B.CDVL_EFF_STRT_DTE   <  CURRENT DATE              04480099
044900           AND (B.CDVL_EFF_END_DTE   >  CURRENT DATE OR           04490099
045000                B.CDVL_EFF_END_DTE   =  :PC-DEFAULT-DTE)          04500099
045100           AND A.CDE_EFF_STRT_DTE    <  CURRENT DATE              04510099
045200           AND (A.CDE_EFF_END_DTE    >  CURRENT DATE OR           04520099
045300                A.CDE_EFF_END_DTE    =  :PC-DEFAULT-DTE)          04530099
045400     END-EXEC.                                                    04540099
045500                                                                  04550099
045600                                                                  04560099
045700     EVALUATE TRUE                                                04570099
045800         WHEN SQLCODE EQUAL ZERO                                  04580099
045900          IF PV-DATA-SOURCE-CNTR > ZERO                           04590099
046000            CONTINUE                                              04600099
046100          ELSE                                                    04610099
046200           SET TM601-DATA-SOURCE-MISMATCH TO TRUE                 04620099
046300           SET PS-EDIT-ERRORS             TO TRUE                 04630099
046400           MOVE 'DATA SOURCE MISMATCH          '                  04640099
046500                                     TO TM600-TRBL-ERROR-TEXT     04650099
046600           DISPLAY 'DATA SOURCE ERROR WITH:' TM601-DATA-SOURCE    04660099
046700           PERFORM 9200-DISPLAY-ERROR                             04670099
046800          END-IF                                                  04680099
046900         WHEN SQLCODE EQUAL +100                                  04690099
047000           SET TM601-DATA-SOURCE-NOTFOUND TO TRUE                 04700099
047100           SET PS-EDIT-ERRORS             TO TRUE                 04710099
047200           MOVE 'DATA SOURCE NOT FOUND         '                  04720099
047300                                     TO TM600-TRBL-ERROR-TEXT     04730099
047400           PERFORM 9200-DISPLAY-ERROR                             04740099
047500         WHEN SQLCODE NOT EQUAL ZERO                              04750099
047600         WHEN SQLWARN0 NOT EQUAL SPACE                            04760099
047700           MOVE 'SEVERE SQL ERROR              '                  04770099
047800                                     TO TM600-TRBL-ERROR-TEXT     04780099
047900           PERFORM 9100-SQL-ABEND                                 04790099
048000     END-EVALUATE.                                                04800099
048100                                                                  04810099
048200                                                                  04820099
048300 EJECT                                                            04830099
048400******************************************************************04840099
048500* DEPENDING ON THE DATA SOURCE, SELECT THE LAST UPDATE TIMESTAMP *04850099
048600* FROM THE APPROPRIATE TABLE TO ENSURE THE ATTEMPTED ACTION IS   *04860099
048700* STILL WARRANTED                                                *04870099
048800******************************************************************04880099
048900                                                                  04890099
049000  3000-VALIDATE-DATES.                                            04900099
049100                                                                  04910099
049200     MOVE '3000-VALIDATE-DATES           '                        04920099
049300                                     TO TM600-CURR-PARAGRAPH.     04930099
049400                                                                  04940099
049500     MOVE TM601-PO-NBR               TO PV-PO-NBR.                04950099
049600     MOVE TM601-DATA-SOURCE          TO PV-DATA-SOURCE.           04960099
049700                                                                  04970099
049800     EVALUATE TRUE                                                04980099
049900                                                                  04990099
050000       WHEN PV-BOOKING                                            05000099
050100         MOVE TM601-BKG-SEQ-NBR      TO IMBKPO-PO-BKG-SEQ-NBR     05010099
050200         PERFORM 3100-SELECT-TIMBKPO                              05020099
050300                                                                  05030099
050400       WHEN PV-RECEIVING                                          05040099
050500         MOVE TM601-RCVD-SEQ-NBR     TO IMRCPO-PO-RCVD-SEQ-NBR    05050099
050600         PERFORM 3200-SELECT-TIMRCPO                              05060099
050700                                                                  05070099
050800       WHEN PV-CONTAINER                                          05080099
050900       WHEN PV-CONTAINER-VOYAGE                                   05090099
051000         MOVE TM601-CONTNR-ID        TO IMCNPO-CONTNR-ID          05100099
051100         MOVE TM601-CONTNR-SEQ-NBR   TO IMCNPO-CONTNR-SEQ-NBR     05110099
051200         PERFORM 3300-SELECT-TIMCNPO                              05120099
051300                                                                  05130099
051400       WHEN PV-CUSTOMS                                            05140099
051500         MOVE TM601-CSTM-ENTR-ID     TO IMCSEN-CSTM-ENTR-ID       05150099
051600         PERFORM 3400-SELECT-TIMCSEN                              05160099
051700                                                                  05170099
051800       WHEN PV-PO                                                 05180099
051900         MOVE TM601-PLNSHP-VER-NBR   TO PLNSHP-VER-NBR            05190099
052000         PERFORM 3500-SELECT-TPLNSHP                              05200099
052100         CONTINUE                                                 05210099
052200                                                                  05220099
052300       WHEN OTHER                                                 05230099
052400         SET TM601-INVALID-DATA-SOURCE TO TRUE                    05240099
052500         SET PS-EDIT-ERRORS            TO TRUE                    05250099
052600         MOVE 'INVALID DATA SOURCE           '                    05260099
052700                                    TO TM600-TRBL-ERROR-TEXT      05270099
052800         PERFORM 9200-DISPLAY-ERROR                               05280099
052900                                                                  05290099
053000     END-EVALUATE.                                                05300099
053100                                                                  05310099
053200******************************************************************05320099
053300* SELECT THE LAST UPDATED ROW FOR THE PO SENT BY THE CALLER      *05330099
053400******************************************************************05340099
053500                                                                  05350099
053600 3100-SELECT-TIMBKPO.                                             05360099
053700                                                                  05370099
053800     MOVE '3100-SELECT-TIMBKPO           '                        05380099
053900                                    TO TM600-CURR-PARAGRAPH.      05390099
054000                                                                  05400099
054100     EXEC SQL                                                     05410099
054200        SELECT MAX(LAST_UPD_TMST)                                 05420099
054300          INTO :IMBKPO-LAST-UPD-TMST                              05430099
054400          FROM TIMBKPO                                            05440099
054500         WHERE PO_NBR              =  :PV-PO-NBR                  05450099
054600           AND PO_BKG_SEQ_NBR      =  :IMBKPO-PO-BKG-SEQ-NBR      05460099
054700     END-EXEC.                                                    05470099
054800                                                                  05480099
054900     EVALUATE TRUE                                                05490099
055000       WHEN  SQLCODE = ZERO                                       05500099
055100        IF IMBKPO-LAST-UPD-TMST = TM601-IMBKPO-LAST-UPD-TMST      05510099
055200         CONTINUE                                                 05520099
055300        ELSE                                                      05530099
055400         SET TM601-BK-TIMESTAMP-MISMATCH TO TRUE                  05540099
055500         SET PS-EDIT-ERRORS              TO TRUE                  05550099
055600         MOVE 'MISMATCH TIMESTAMP - BOOKING'                      05560099
055700                                    TO TM600-TRBL-ERROR-TEXT      05570099
055800         PERFORM 9200-DISPLAY-ERROR                               05580099
055900        END-IF                                                    05590099
056000       WHEN  SQLCODE = +100                                       05600099
056100         SET TM601-BK-TIMESTAMP-NOTFOUND TO TRUE                  05610099
056200         SET PS-EDIT-ERRORS              TO TRUE                  05620099
056300         MOVE 'NOTFOUND TIMESTAMP - BOOKING     '                 05630099
056400                                    TO TM600-TRBL-ERROR-TEXT      05640099
056500         PERFORM 9200-DISPLAY-ERROR                               05650099
056600       WHEN SQLCODE NOT EQUAL ZERO                                05660099
056700       WHEN SQLWARN0 NOT EQUAL SPACE                              05670099
056800         MOVE 'SEVERE SQL ERROR BOOKING'                          05680099
056900                                    TO TM600-TRBL-ERROR-TEXT      05690099
057000         PERFORM 9100-SQL-ABEND                                   05700099
057100     END-EVALUATE.                                                05710099
057200                                                                  05720099
057300******************************************************************05730099
057400* SELECT THE LAST UPDATED ROW FOR THE PO SENT BY THE CALLER      *05740099
057500******************************************************************05750099
057600                                                                  05760099
057700 3200-SELECT-TIMRCPO.                                             05770099
057800                                                                  05780099
057900     MOVE '3200-SELECT-TIMRCPO           '                        05790099
058000                                    TO TM600-CURR-PARAGRAPH       05800099
058100                                                                  05810099
058200     EXEC SQL                                                     05820099
058300        SELECT MAX(LAST_UPD_TMST)                                 05830099
058400          INTO :IMRCPO-LAST-UPD-TMST                              05840099
058500          FROM TIMRCPO                                            05850099
058600         WHERE PO_NBR              =  :PV-PO-NBR                  05860099
058700           AND PO_RCVD_SEQ_NBR     =  :IMRCPO-PO-RCVD-SEQ-NBR     05870099
058800     END-EXEC.                                                    05880099
058900                                                                  05890099
059000     EVALUATE TRUE                                                05900099
059100       WHEN  SQLCODE = ZERO                                       05910099
059200        IF IMRCPO-LAST-UPD-TMST = TM601-IMRCPO-LAST-UPD-TMST      05920099
059300         CONTINUE                                                 05930099
059400        ELSE                                                      05940099
059500         SET TM601-RC-TIMESTAMP-MISMATCH TO TRUE                  05950099
059600         SET PS-EDIT-ERRORS              TO TRUE                  05960099
059700         MOVE 'MISMATCH TIMESTAMP - RECEIVING'                    05970099
059800                                    TO TM600-TRBL-ERROR-TEXT      05980099
059900         PERFORM 9200-DISPLAY-ERROR                               05990099
060000        END-IF                                                    06000099
060100       WHEN  SQLCODE = +100                                       06010099
060200         SET TM601-RC-TIMESTAMP-NOTFOUND TO TRUE                  06020099
060300         SET PS-EDIT-ERRORS              TO TRUE                  06030099
060400         MOVE 'NOTFOUND TIMESTAMP - RECEIVING'                    06040099
060500                                    TO TM600-TRBL-ERROR-TEXT      06050099
060600         PERFORM 9200-DISPLAY-ERROR                               06060099
060700       WHEN SQLCODE NOT EQUAL ZERO                                06070099
060800       WHEN SQLWARN0 NOT EQUAL SPACE                              06080099
060900         MOVE 'SEVERE SQL ERROR RECEIVING    '                    06090099
061000                                    TO TM600-TRBL-ERROR-TEXT      06100099
061100         PERFORM 9100-SQL-ABEND                                   06110099
061200     END-EVALUATE.                                                06120099
061300******************************************************************06130099
061400* SELECT THE LAST UPDATED ROW FOR THE PO SENT BY THE CALLER      *06140099
061500******************************************************************06150099
061600                                                                  06160099
061700 3300-SELECT-TIMCNPO.                                             06170099
061800                                                                  06180099
061900     MOVE '3300-SELECT-TIMCNPO           '                        06190099
062000                                    TO TM600-CURR-PARAGRAPH.      06200099
062100                                                                  06210099
062200     EXEC SQL                                                     06220099
062300        SELECT MAX(LAST_UPD_TMST)                                 06230099
062400          INTO :IMCNPO-LAST-UPD-TMST                              06240099
062500          FROM TIMCNPO                                            06250099
062600         WHERE PO_NBR              =  :PV-PO-NBR                  06260099
062700           AND CONTNR_ID           =  :IMCNPO-CONTNR-ID           06270099
062800           AND CONTNR_SEQ_NBR      =  :IMCNPO-CONTNR-SEQ-NBR      06280099
062900     END-EXEC.                                                    06290099
063000                                                                  06300099
063100     EVALUATE TRUE                                                06310099
063200       WHEN  SQLCODE = ZERO                                       06320099
063300        IF IMCNPO-LAST-UPD-TMST = TM601-IMCNPO-LAST-UPD-TMST      06330099
063400         CONTINUE                                                 06340099
063500        ELSE                                                      06350099
063600         SET TM601-CN-TIMESTAMP-MISMATCH TO TRUE                  06360099
063700         SET PS-EDIT-ERRORS              TO TRUE                  06370099
063800         MOVE 'MISMATCH TIMESTAMP - CONTAINER'                    06380099
063900                                    TO TM600-TRBL-ERROR-TEXT      06390099
064000         PERFORM 9200-DISPLAY-ERROR                               06400099
064100        END-IF                                                    06410099
064200       WHEN  SQLCODE = +100                                       06420099
064300         SET TM601-CN-TIMESTAMP-NOTFOUND TO TRUE                  06430099
064400         SET PS-EDIT-ERRORS              TO TRUE                  06440099
064500         MOVE 'NOTFOUND TIMESTAMP - CONTAINER'                    06450099
064600                                    TO TM600-TRBL-ERROR-TEXT      06460099
064700         PERFORM 9200-DISPLAY-ERROR                               06470099
064800       WHEN SQLCODE NOT EQUAL ZERO                                06480099
064900       WHEN SQLWARN0 NOT EQUAL SPACE                              06490099
065000         MOVE 'SEVERE SQL ERROR - CONTAINER  '                    06500099
065100                                    TO TM600-TRBL-ERROR-TEXT      06510099
065200         PERFORM 9100-SQL-ABEND                                   06520099
065300     END-EVALUATE.                                                06530099
065400                                                                  06540099
065500******************************************************************06550099
065600* SELECT THE LAST UPDATED ROW FOR THE PO SENT BY THE CALLER      *06560099
065700******************************************************************06570099
065800                                                                  06580099
065900 3400-SELECT-TIMCSEN.                                             06590099
066000                                                                  06600099
066100     MOVE '3400-SELECT-TIMCSEN           '                        06610099
066200                                    TO TM600-CURR-PARAGRAPH.      06620099
066300                                                                  06630099
066400     EXEC SQL                                                     06640099
066500        SELECT MAX(LAST_UPD_TMST)                                 06650099
066600          INTO :IMCSEN-LAST-UPD-TMST                              06660099
066700          FROM TIMCSEN                                            06670099
066800         WHERE CSTM_ENTR_ID        =  :IMCSEN-CSTM-ENTR-ID        06680099
066900     END-EXEC.                                                    06690099
067000                                                                  06700099
067100     EVALUATE TRUE                                                06710099
067200       WHEN  SQLCODE = ZERO                                       06720099
067300        IF IMCSEN-LAST-UPD-TMST = TM601-IMCSEN-LAST-UPD-TMST      06730099
067400         CONTINUE                                                 06740099
067500        ELSE                                                      06750099
067600         SET TM601-CS-TIMESTAMP-MISMATCH TO TRUE                  06760099
067700         SET PS-EDIT-ERRORS              TO TRUE                  06770099
067800         MOVE 'MISMATCH TIMESTAMP - CUSTOMS'                      06780099
067900                                    TO TM600-TRBL-ERROR-TEXT      06790099
068000         PERFORM 9200-DISPLAY-ERROR                               06800099
068100        END-IF                                                    06810099
068200       WHEN  SQLCODE = +100                                       06820099
068300         SET TM601-CS-TIMESTAMP-NOTFOUND TO TRUE                  06830099
068400         SET PS-EDIT-ERRORS              TO TRUE                  06840099
068500         MOVE 'NOTFOUND TIMESTAMP - CUSTOMS'                      06850099
068600                                    TO TM600-TRBL-ERROR-TEXT      06860099
068700         PERFORM 9200-DISPLAY-ERROR                               06870099
068800       WHEN SQLCODE NOT EQUAL ZERO                                06880099
068900       WHEN SQLWARN0 NOT EQUAL SPACE                              06890099
069000         MOVE 'SEVERE SQL ERROR - CUSTOMS  '                      06900099
069100                                    TO TM600-TRBL-ERROR-TEXT      06910099
069200         PERFORM 9100-SQL-ABEND                                   06920099
069300     END-EVALUATE.                                                06930099
069400                                                                  06940099
069500 EJECT                                                            06950099
069600******************************************************************06960099
069700* SELECT THE LAST UPDATED ROW FOR THE PO SENT BY THE CALLER      *06970099
069800******************************************************************06980099
069900                                                                  06990099
070000 3500-SELECT-TPLNSHP.                                             07000099
070100                                                                  07010099
070200     MOVE '3500-SELECT-TPLNSHP           '                        07020099
070300                                    TO TM600-CURR-PARAGRAPH.      07030099
070400                                                                  07040099
070500     EXEC SQL                                                     07050099
070600        SELECT MAX(LAST_UPD_TMST)                                 07060099
070700          INTO :PLNSHP-LAST-UPD-TMST                              07070099
070800          FROM TPLNSHP                                            07080099
070900         WHERE PO_NBR              =  :PV-PO-NBR                  07090099
071000           AND VER_NBR             =  :PLNSHP-VER-NBR             07100099
071100           AND VER_STATUS_CDE      =  'A'                         07110099
071200     END-EXEC.                                                    07120099
071300                                                                  07130099
071400     EVALUATE TRUE                                                07140099
071500       WHEN  SQLCODE = ZERO                                       07150099
071600        IF PLNSHP-LAST-UPD-TMST = TM601-PLNSHP-LAST-UPD-TMST      07160099
071700         CONTINUE                                                 07170099
071800        ELSE                                                      07180099
071900         SET TM601-PO-TIMESTAMP-MISMATCH TO TRUE                  07190099
072000         SET PS-EDIT-ERRORS              TO TRUE                  07200099
072100         MOVE 'MISMATCH TIMESTAMP - TPLNSHP  '                    07210099
072200                                    TO TM600-TRBL-ERROR-TEXT      07220099
072300         PERFORM 9200-DISPLAY-ERROR                               07230099
072400        END-IF                                                    07240099
072500       WHEN  SQLCODE = +100                                       07250099
072600         SET TM601-PO-TIMESTAMP-NOTFOUND TO TRUE                  07260099
072700         SET PS-EDIT-ERRORS              TO TRUE                  07270099
072800         MOVE 'NOTFOUND TIMESTAMP - TPLNSHP  '                    07280099
072900                                    TO TM600-TRBL-ERROR-TEXT      07290099
073000         PERFORM 9200-DISPLAY-ERROR                               07300099
073100       WHEN SQLCODE NOT EQUAL ZERO                                07310099
073200       WHEN SQLWARN0 NOT EQUAL SPACE                              07320099
073300         MOVE 'SEVERE SQL ERROR TPLNSHP      '                    07330099
073400                                    TO TM600-TRBL-ERROR-TEXT      07340099
073500         PERFORM 9100-SQL-ABEND                                   07350099
073600     END-EVALUATE.                                                07360099
073700                                                                  07370099
073800 EJECT                                                            07380099
073900******************************************************************07390099
074000* 4000 PARAGRAPHS DEAL WITH TROUBLE NOTIFICATION INSERTS.        *07400099
074100******************************************************************07410099
074200                                                                  07420099
074300 4000-INSERT-TROUBLE.                                             07430099
074400                                                                  07440099
074500     MOVE '4000-INSERT-TROUBLE           '                        07450099
074600                                    TO TM600-CURR-PARAGRAPH.      07460099
074700                                                                  07470099
074800     PERFORM 4010-GENERATE-RANDOM-NUMBER                          07480099
074900        VARYING PV-RANDOM-CNTR FROM PC-1 BY PC-1                  07490099
075000         UNTIL PS-RANDOM-STATUS-OK                                07500099
075100            OR PV-RANDOM-CNTR > PC-3.                             07510099
075200                                                                  07520099
075300     IF PS-RANDOM-STATUS-OK                                       07530099
075400       MOVE DP902-RANDOM-NUMBER        TO PV-HOLD-NOTIF-NBR       07540099
075500     ELSE                                                         07550099
075600       SET TM601-RANDOM-GEN-ERROR      TO TRUE                    07560099
075700       SET PS-EDIT-ERRORS              TO TRUE                    07570099
075800       MOVE 'RANDOM NUMBER GEN ERROR       '                      07580099
075900                                    TO TM600-TRBL-ERROR-TEXT      07590099
076000       PERFORM 9200-DISPLAY-ERROR.                                07600099
076100                                                                  07610099
076200     IF PS-NO-EDIT-ERRORS                                         07620099
076300       PERFORM 4020-SELECT-TPURCHS.                               07630099
076400                                                                  07640099
076500     IF PS-NO-EDIT-ERRORS                                         07650099
076600       PERFORM 4030-SELECT-TTRBRSN.                               07660099
076700                                                                  07670099
076800     IF PS-NO-EDIT-ERRORS                                         07680099
076900       PERFORM 4040-INS-TRBNTF-DCLGEN-MOVES.                      07690099
077000                                                                  07700099
077100     IF PS-NO-EDIT-ERRORS                                         07710099
077200       PERFORM 4100-INSERT-ROW-TTRBNTF-TBL.                       07720099
077300                                                                  07730099
077400*    ************************************************************ 07740099
077500*    * FOR ALL OCCURANCES IN THE IMPORT ARRAY, INSERT ROWS INTO   07750099
077600*    * THE TROUBLE INDEX TABLE.                                   07760099
077700*    ************************************************************ 07770099
077800     IF PS-NO-EDIT-ERRORS   AND (TM601-IMPRT-ARRAY-CNT > ZERO)    07780099
077900*      ******************************************************     07790099
078000*      * THIS LOGIC FOR FUTURE ENHANCEMENT - FOR NOW JUST         07800099
078100*      * 1 ELEMENT SHOULD BE IN ARRAY                             07810099
078200*      ******************************************************     07820099
078300*      PERFORM  VARYING PV-KY-SUB     FROM PC-1 BY PC-1           07830099
078400*         UNTIL (PV-KY-SUB > TM601-IMPRT-ARRAY-CNT)               07840099
078500*      ******************************************************     07850099
078600           MOVE PC-1 TO PV-KY-SUB                                 07860099
078700           PERFORM 4110-INS-TIMTBKY-DCLGEN-MOVES                  07870099
078800           PERFORM 4200-INSERT-ROW-TIMTBKY-TBL                    07880099
078900***    END-PERFORM                                                07890099
079000     END-IF.                                                      07900099
079100                                                                  07910099
079200*    ************************************************************ 07920099
079300*    * FOR ALL OCCURANCES IN THE DETAIL ARRAY, INSERT ROWS INTO   07930099
079400*    * THE TROUBLE DETAIL TABLE.                                  07940099
079500*    ************************************************************ 07950099
079600     IF PS-NO-EDIT-ERRORS AND (TM601-TRBL-DETAIL-COUNT  > ZERO)   07960099
079700*      ******************************************************     07970099
079800*      * THIS LOGIC FOR FUTURE ENHANCEMENT - FOR NOW JUST         07980099
079900*      * 1 ELEMENT SHOULD BE IN ARRAY                             07990099
080000*      ******************************************************     08000099
080100*      PERFORM  VARYING PV-DT-SUB     FROM PC-1 BY PC-1           08010099
080200*         UNTIL (PV-DT-SUB > TM601-TRBL-DETAIL-COUNT)             08020099
080300           MOVE PC-1 TO PV-DT-SUB                                 08030099
080400           PERFORM 4210-INS-TTRBDTL-DCLGEN-MOVES                  08040099
080500           PERFORM 4300-INSERT-ROW-TTRBDTL-TBL                    08050099
080600***    END-PERFORM                                                08060099
080700     END-IF.                                                      08070099
080800                                                                  08080099
080900 EJECT                                                            08090099
081000******************************************************************08100099
081100* YOU GET 3 TRIES FOR A SUCCESSFUL CALL TO RANDOM GENRATOR PGM,   08110099
081200* AND TO CHECK IF THAT NUMBER IS A UNIQUE NOTIFY NBR ON THE TABLE.08120099
081300******************************************************************08130099
081400                                                                  08140099
081500 4010-GENERATE-RANDOM-NUMBER.                                     08150099
081600                                                                  08160099
081700     MOVE '4010-GENERATE-RANDOM-NUMBER   '                        08170099
081800                                    TO TM600-CURR-PARAGRAPH.      08180099
081900                                                                  08190099
082000     CALL PC-RAND-PGM  USING  DP902-RANDNBR-ROUTINE-FIELDS.       08200099
082100     IF DP902-SUCCESSFUL                                          08210099
082200       CONTINUE                                                   08220099
082300     ELSE                                                         08230099
082400      SET PS-RANDOM-STATUS-FAILED      TO TRUE                    08240099
082500      MOVE TM601-PO-NBR                TO PV-DISPLAY-PO-NBR       08250099
082600      DISPLAY PC-RANDOM-CALL-ERROR                                08260099
082700              PV-DISPLAY-PO-NBR                                   08270099
082800     END-IF.                                                      08280099
082900                                                                  08290099
083000*    **************************************************           08300099
083100*    * IF RANDOM NUMBER RETURNED, MAKE SURE IT IS     *           08310099
083200*    * UNIQUE ON TABLE.                               *           08320099
083300*    **************************************************           08330099
083400                                                                  08340099
083500     IF PS-RANDOM-STATUS-FAILED                                   08350099
083600       CONTINUE                                                   08360099
083700     ELSE                                                         08370099
083800       EXEC SQL                                                   08380099
083900          SELECT NOTIF_NBR                                        08390099
084000            INTO :TRBNTF-NOTIF-NBR                                08400099
084100            FROM TTRBNTF                                          08410099
084200           WHERE NOTIF_NBR         =  :DP902-RANDOM-NUMBER        08420099
084300       END-EXEC                                                   08430099
084400       EVALUATE TRUE                                              08440099
084500         WHEN SQLCODE = +100                                      08450099
084600           SET PS-RANDOM-STATUS-OK TO TRUE                        08460099
084700         WHEN SQLCODE NOT EQUAL ZERO                              08470099
084800         WHEN SQLWARN0 NOT EQUAL SPACE                            08480099
084900           MOVE 'SEVERE SQL ERROR - TTRBNTF    '                  08490099
085000                                    TO TM600-TRBL-ERROR-TEXT      08500099
085100           PERFORM 9100-SQL-ABEND                                 08510099
085200       END-EVALUATE                                               08520099
085300     END-IF.                                                      08530099
085400                                                                  08540099
085500 EJECT                                                            08550099
085600******************************************************************08560099
085700                                                                  08570099
085800 4020-SELECT-TPURCHS.                                             08580099
085900                                                                  08590099
086000     MOVE '4020-SELECT-TPURCHS           '                        08600099
086100                                    TO TM600-CURR-PARAGRAPH.      08610099
086200                                                                  08620099
086300     MOVE  TM601-PURCHS-VER-NBR       TO PV-PURCHS-VER-NBR.       08630099
086400     EXEC SQL                                                     08640099
086500        SELECT DEPT_NBR                                           08650099
086600              ,ENT_ID                                             08660099
086700          INTO :PURCHS-DEPT-NBR                                   08670099
086800              ,:PURCHS-ENT-ID                                     08680099
086900          FROM TPURCHS                                            08690099
087000         WHERE PO_NBR              =  :PV-PO-NBR                  08700099
087100           AND VER_STATUS_CDE      =  'A'                         08710099
087200     END-EXEC.                                                    08720099
087300                                                                  08730099
087400     EVALUATE TRUE                                                08740099
087500         WHEN SQLCODE = ZERO                                      08750099
087600           CONTINUE                                               08760099
087700         WHEN SQLCODE = +100                                      08770099
087800           SET TM601-TPURCHS-SELECT-ERROR  TO TRUE                08780099
087900           SET PS-EDIT-ERRORS              TO TRUE                08790099
088000           MOVE 'TPURCHS NOT FOUND             '                  08800099
088100                                    TO TM600-TRBL-ERROR-TEXT      08810099
088200           PERFORM 9200-DISPLAY-ERROR                             08820099
088300           DISPLAY ' VERS NMBR FOR ABOVE ERROR - '                08830099
088400                   PV-PURCHS-VER-NBR                              08840099
088500         WHEN SQLCODE NOT EQUAL ZERO                              08850099
088600         WHEN SQLWARN0 NOT EQUAL SPACE                            08860099
088700           MOVE 'SEVERE SQL ERROR              '                  08870099
088800                                    TO TM600-TRBL-ERROR-TEXT      08880099
088900           PERFORM 9100-SQL-ABEND                                 08890099
089000     END-EVALUATE.                                                08900099
089100                                                                  08910099
089200 EJECT                                                            08920099
089300******************************************************************08930099
089400                                                                  08940099
089500 4030-SELECT-TTRBRSN.                                             08950099
089600                                                                  08960099
089700     MOVE '4030-SELECT-TTRBRSN           '                        08970099
089800                                    TO TM600-CURR-PARAGRAPH.      08980099
089900                                                                  08990099
090000     MOVE  TM601-TRBL-RSN-CDE         TO PV-TRBL-RSN-CDE          09000099
090100     EXEC SQL                                                     09010099
090200        SELECT NOTIF_IND                                          09020099
090300          INTO :TRBRSN-NOTIF-IND                                  09030099
090400          FROM TTRBRSN                                            09040099
090500         WHERE TRBL_RSN_CDE        =  :PV-TRBL-RSN-CDE            09050099
090600     END-EXEC.                                                    09060099
090700                                                                  09070099
090800     EVALUATE TRUE                                                09080099
090900         WHEN SQLCODE = ZERO                                      09090099
091000           IF TRBRSN-NOTIF-IND = 'T' OR 'N'                       09100099
091100             CONTINUE                                             09110099
091200           ELSE                                                   09120099
091300             SET TM601-TTRRSN-NOTIF-IND-ERROR   TO TRUE           09130099
091400             SET PS-EDIT-ERRORS                 TO TRUE           09140099
091500             MOVE 'TROUBLE NOTIFICATION INDICATOR'                09150099
091600                                    TO TM600-TRBL-ERROR-TEXT      09160099
091700             PERFORM 9200-DISPLAY-ERROR                           09170099
091800           END-IF                                                 09180099
091900         WHEN SQLCODE = +100                                      09190099
092000           SET TM601-TTRRSN-SELECT-ERROR   TO TRUE                09200099
092100           SET PS-EDIT-ERRORS              TO TRUE                09210099
092200           MOVE 'TROUBLE REASON NOT FOUND      '                  09220099
092300                                    TO TM600-TRBL-ERROR-TEXT      09230099
092400           PERFORM 9200-DISPLAY-ERROR                             09240099
092500         WHEN SQLCODE NOT EQUAL ZERO                              09250099
092600         WHEN SQLWARN0 NOT EQUAL SPACE                            09260099
092700           MOVE 'SEVERE SQL ERROR              '                  09270099
092800                                    TO TM600-TRBL-ERROR-TEXT      09280099
092900           PERFORM 9100-SQL-ABEND                                 09290099
093000     END-EVALUATE.                                                09300099
093100                                                                  09310099
093200 EJECT                                                            09320099
093300******************************************************************09330099
093400* BEFORE AN INSERT TO TROUBLE NOTIFICATION TABLE,                *09340099
093500* MOVE DATA FROM CALLING PROGRAM AND OTHER SOURCES TO DCLGEN.    *09350099
093600******************************************************************09360099
093700                                                                  09370099
093800 4040-INS-TRBNTF-DCLGEN-MOVES.                                    09380099
093900                                                                  09390099
094000      MOVE PV-HOLD-NOTIF-NBR      TO TRBNTF-NOTIF-NBR.            09400099
094100      MOVE +90                    TO TRBNTF-OPER-UNT-ID.          09410099
094200      MOVE PC-1                   TO TRBNTF-FCLTY-ID.             09420099
094300      MOVE PURCHS-DEPT-NBR        TO TRBNTF-DEPT-NBR.             09430099
094400      MOVE PURCHS-ENT-ID          TO TRBNTF-ENT-ID.               09440099
094500      MOVE TM601-INITR-ENT-ID     TO TRBNTF-INITR-ENT-ID.         09450099
094600      MOVE TM601-PO-NBR           TO TRBNTF-PO-NBR.               09460099
094700      MOVE TM601-PO-LNE-NBR       TO TRBNTF-PO-LNE-NBR.           09470099
094710      MOVE TM601-FOB-CDE          TO TRBNTF-FOB-CDE.              09471099
094720      MOVE TM601-POE-CDE          TO TRBNTF-POE-CDE.              09472099
094800      MOVE ZERO                   TO TRBNTF-REC-SEQ-NBR.          09480099
094900      MOVE TM601-TRBL-RSN-CDE     TO TRBNTF-TRBL-RSN-CDE.         09490099
095000      MOVE PV-CUR-TMST            TO TRBNTF-NOTIF-TMST.           09500099
095100      MOVE TM601-NOTIF-UID        TO TRBNTF-NOTIF-UID.            09510099
095200      IF TRBRSN-NOTIF-IND = 'T'                                   09520099
095300       MOVE 'N'                   TO TRBNTF-RESOLVED-IND          09530099
095400       MOVE PC-DEFAULT-TMST       TO TRBNTF-RESOLVED-TMST         09540099
095500      ELSE                                                        09550099
095600        IF TRBRSN-NOTIF-IND = 'N'                                 09560099
095700          MOVE 'R'                TO TRBNTF-RESOLVED-IND          09570099
095800          MOVE PV-CUR-TMST        TO TRBNTF-RESOLVED-TMST         09580099
095900        END-IF                                                    09590099
096000      END-IF.                                                     09600099
096100      MOVE TM601-RSLVD-UID        TO TRBNTF-RESOLVED-UID.         09610099
096200      MOVE PC-DEFAULT-TMST        TO TRBNTF-ACKNOWLG-TMST.        09620099
096300      MOVE TM601-ACKNOWL-UID      TO TRBNTF-ACKNOWLG-UID.         09630099
096400      MOVE ZERO                   TO TRBNTF-CNTCT-EXT.            09640099
096500      MOVE SPACES                 TO TRBNTF-FCLTY-AREA-ID.        09650099
096600      MOVE TM601-OVER-SHRT-PCT    TO TRBNTF-OVER-SHT-PCT.         09660099
096700      MOVE PV-CUR-TMST            TO TRBNTF-LAST-DTL-CRE-TMST.    09670099
096800      MOVE SPACES                 TO TRBNTF-CRE-IND.              09680099
096900      MOVE SPACES                 TO TRBNTF-PRORATE-IND.          09690099
097000      MOVE SPACES                 TO TRBNTF-RTV-IND.              09700099
097100      MOVE PC-DEFAULT-TMST        TO TRBNTF-RTV-RESPONSE-TMST.    09710099
097200      MOVE TM601-PURCHS-VER-NBR   TO TRBNTF-PO-VER-NBR.           09720099
097300      MOVE TM601-PO-LNE-NBR       TO TRBNTF-PO-LNE-VER-NBR.       09730099
097400      MOVE TM601-PLNSHP-VER-NBR   TO TRBNTF-PLN-SHIP-VER-NBR.     09740099
097500      MOVE TM601-ERLY-LTE-DAY-QTY TO TRBNTF-ERLY-LTE-DAY-QTY.     09750099
097600      MOVE TM601-INITR-ID         TO TRBNTF-INITR-ID.             09760099
097700      MOVE TM601-RSPNB-RSLU-ID    TO TRBNTF-RSPNB-RSLU-ID.        09770099
097800      MOVE TM601-PFMC-TRKG-ID     TO TRBNTF-PFMC-TRKG-ID.         09780099
097900      MOVE TM601-ACTVY-RSLU-CDE   TO TRBNTF-ACTVY-RSLU-CDE.       09790099
098000      MOVE 0                      TO TRBNTF-SHIPT-ID.             09800099
098100      MOVE 0                      TO TRBNTF-PKSL-SEQ-NBR.         09810099
098200      MOVE 0                      TO TRBNTF-PKSL-LNE-NBR.         09820099
098300      MOVE 0                      TO TRBNTF-WORK-ORD-SEQ-NBR.     09830099
098400      MOVE 0                      TO TRBNTF-WO-INSTR-SEQ-NBR.     09840099
098500                                                                  09850099
098600 EJECT                                                            09860099
098700******************************************************************09870099
098800* INSERT A ROW TO TTRBNTF - TROUBLE NOTIFICATION TABLE.          *09880099
098900******************************************************************09890099
099000                                                                  09900099
099100 4100-INSERT-ROW-TTRBNTF-TBL.                                     09910099
099200                                                                  09920099
099300     MOVE '4100-INSERT-ROW-TTRBNTF-TBL   '                        09930099
099400                                    TO TM600-CURR-PARAGRAPH.      09940099
099500                                                                  09950099
099600     EXEC SQL                                                     09960099
099700        INSERT INTO TTRBNTF                                       09970099
099800           (NOTIF_NBR                                             09980099
099900           ,OPER_UNT_ID                                           09990099
100000           ,FCLTY_ID                                              10000099
100100           ,DEPT_NBR                                              10010099
100200           ,ENT_ID                                                10020099
100300           ,INITR_ENT_ID                                          10030099
100400           ,PO_NBR                                                10040099
100500           ,PO_LNE_NBR                                            10050099
100600           ,REC_SEQ_NBR                                           10060099
100700           ,TRBL_RSN_CDE                                          10070099
100800           ,NOTIF_TMST                                            10080099
100900           ,NOTIF_UID                                             10090099
101000           ,RESOLVED_IND                                          10100099
101100           ,RESOLVED_TMST                                         10110099
101200           ,RESOLVED_UID                                          10120099
101300           ,ACKNOWLG_TMST                                         10130099
101400           ,ACKNOWLG_UID                                          10140099
101500           ,CNTCT_EXT                                             10150099
101600           ,FCLTY_AREA_ID                                         10160099
101700           ,SHIPT_ID                                              10170099
101800           ,PKSL_SEQ_NBR                                          10180099
101900           ,PKSL_LNE_NBR                                          10190099
102000           ,WORK_ORD_SEQ_NBR                                      10200099
102100           ,WO_INSTR_SEQ_NBR                                      10210099
102200           ,OVER_SHT_PCT                                          10220099
102300           ,LAST_DTL_CRE_TMST                                     10230099
102400           ,CRE_IND                                               10240099
102500           ,PRORATE_IND                                           10250099
102600           ,RTV_IND                                               10260099
102700           ,RTV_RESPONSE_TMST                                     10270099
102800           ,PO_VER_NBR                                            10280099
102900           ,PO_LNE_VER_NBR                                        10290099
103000           ,PLN_SHIP_VER_NBR                                      10300099
103100           ,ERLY_LTE_DAY_QTY                                      10310099
103200           ,INITR_ID                                              10320099
103300           ,RSPNB_RSLU_ID                                         10330099
103400           ,PFMC_TRKG_ID                                          10340099
103500           ,ACTVY_RSLU_CDE                                        10350099
103510           ,FOB_CDE                                               10351099
103520           ,POE_CDE)                                              10352099
103600          VALUES  (:TRBNTF-NOTIF-NBR                              10360099
103700                 , :TRBNTF-OPER-UNT-ID                            10370099
103800                 , :TRBNTF-FCLTY-ID                               10380099
103900                 , :TRBNTF-DEPT-NBR                               10390099
104000                 , :TRBNTF-ENT-ID                                 10400099
104100                 , :TRBNTF-INITR-ENT-ID                           10410099
104200                 , :TRBNTF-PO-NBR                                 10420099
104300                 , :TRBNTF-PO-LNE-NBR                             10430099
104400                 , :TRBNTF-REC-SEQ-NBR                            10440099
104500                 , :TRBNTF-TRBL-RSN-CDE                           10450099
104600                 , :TRBNTF-NOTIF-TMST                             10460099
104700                 , :TRBNTF-NOTIF-UID                              10470099
104800                 , :TRBNTF-RESOLVED-IND                           10480099
104900                 , :TRBNTF-RESOLVED-TMST                          10490099
105000                 , :TRBNTF-RESOLVED-UID                           10500099
105100                 , :TRBNTF-ACKNOWLG-TMST                          10510099
105200                 , :TRBNTF-ACKNOWLG-UID                           10520099
105300                 , :TRBNTF-CNTCT-EXT                              10530099
105400                 , :TRBNTF-FCLTY-AREA-ID                          10540099
105500                 , :TRBNTF-SHIPT-ID                               10550099
105600                 , :TRBNTF-PKSL-SEQ-NBR                           10560099
105700                 , :TRBNTF-PKSL-LNE-NBR                           10570099
105800                 , :TRBNTF-WORK-ORD-SEQ-NBR                       10580099
105900                 , :TRBNTF-WO-INSTR-SEQ-NBR                       10590099
106000                 , :TRBNTF-OVER-SHT-PCT                           10600099
106100                 , :TRBNTF-LAST-DTL-CRE-TMST                      10610099
106200                 , :TRBNTF-CRE-IND                                10620099
106300                 , :TRBNTF-PRORATE-IND                            10630099
106400                 , :TRBNTF-RTV-IND                                10640099
106500                 , :TRBNTF-RTV-RESPONSE-TMST                      10650099
106600                 , :TRBNTF-PO-VER-NBR                             10660099
106700                 , :TRBNTF-PO-LNE-VER-NBR                         10670099
106800                 , :TRBNTF-PLN-SHIP-VER-NBR                       10680099
106900                 , :TRBNTF-ERLY-LTE-DAY-QTY                       10690099
107000                 , :TRBNTF-INITR-ID                               10700099
107100                 , :TRBNTF-RSPNB-RSLU-ID                          10710099
107200                 , :TRBNTF-PFMC-TRKG-ID                           10720099
107300                 , :TRBNTF-ACTVY-RSLU-CDE                         10730099
107310                 , :TRBNTF-FOB-CDE                                10731099
107320                 , :TRBNTF-POE-CDE)                               10732099
107400     END-EXEC.                                                    10740099
107500                                                                  10750099
107600     EVALUATE TRUE                                                10760099
107700       WHEN SQLCODE NOT EQUAL ZERO                                10770099
107800       WHEN SQLWARN0 NOT EQUAL SPACE                              10780099
107900         MOVE 'SEVERE SQL - TRBL NOTIFY INSRT'                    10790099
108000                                    TO TM600-TRBL-ERROR-TEXT      10800099
108100         PERFORM 9100-SQL-ABEND                                   10810099
108200     END-EVALUATE.                                                10820099
108300                                                                  10830099
108400 EJECT                                                            10840099
108500******************************************************************10850099
108600* BEFORE AN INSERT TO TROUBLE KEY TABLE                          *10860099
108700* MOVE DATA FROM CALLING PROGRAM AND OTHER SOURCES TO DCLGEN     *10870099
108800******************************************************************10880099
108900                                                                  10890099
109000 4110-INS-TIMTBKY-DCLGEN-MOVES.                                   10900099
109100                                                                  10910099
109200      MOVE TRBNTF-NOTIF-NBR            TO IMTBKY-NOTIF-NBR.       10920099
109300                                                                  10930099
109400      EVALUATE TRUE                                               10940099
109500        WHEN TM601-AR-CONTNR-ID (PV-KY-SUB) NOT =  SPACES         10950099
109600          MOVE 'CN'                    TO IMTBKY-PRCS-TYP-CDE     10960099
109700          MOVE TM601-AR-CONTNR-ID (PV-KY-SUB)                     10970099
109800                                       TO IMTBKY-IMPRT-ID         10980099
109900          MOVE TM601-AR-CONTNR-SEQ-NBR (PV-KY-SUB)                10990099
110000                                       TO IMTBKY-IMPRT-SEQ-NBR    11000099
110100        WHEN TM601-AR-IMPRT-TRIP-ID (PV-KY-SUB) NOT = SPACES      11001099
110200          MOVE 'CV'                    TO IMTBKY-PRCS-TYP-CDE     11002099
110300          MOVE TM601-AR-IMPRT-TRIP-ID (PV-KY-SUB)                 11003099
110400                                       TO IMTBKY-IMPRT-ID         11004099
110500        WHEN TM601-AR-CSTM-ENTR-ID (PV-KY-SUB) NOT = SPACES       11010099
110600          MOVE 'CS'                    TO IMTBKY-PRCS-TYP-CDE     11020099
110700          MOVE TM601-AR-CSTM-ENTR-ID  (PV-KY-SUB)                 11030099
110800                                       TO IMTBKY-IMPRT-ID         11040099
110900        WHEN TM601-AR-BKG-SEQ-NBR (PV-KY-SUB)   NOT =   ZERO      11050099
111000          MOVE 'BK'                    TO IMTBKY-PRCS-TYP-CDE     11060099
111100          MOVE TM601-AR-BKG-SEQ-NBR (PV-KY-SUB)                   11070099
111200                                       TO IMTBKY-IMPRT-SEQ-NBR    11080099
111300        WHEN TM601-AR-RCVD-SEQ-NBR (PV-KY-SUB) NOT =  ZERO        11090099
111400          MOVE 'RC'                    TO IMTBKY-PRCS-TYP-CDE     11100099
111500          MOVE TM601-AR-RCVD-SEQ-NBR (PV-KY-SUB)                  11110099
111600                                       TO IMTBKY-IMPRT-SEQ-NBR    11120099
111700      END-EVALUATE.                                               11130099
111800                                                                  11140099
111900      MOVE PV-CUR-TMST                 TO IMTBKY-CRE-TMST.        11150099
112000                                                                  11160099
112100 EJECT                                                            11170099
112200******************************************************************11180099
112300* INSERT A ROW TO TIMTBKY - TROUBLE KEY TABLE.                   *11190099
112400******************************************************************11200099
112500                                                                  11210099
112600 4200-INSERT-ROW-TIMTBKY-TBL.                                     11220099
112700                                                                  11230099
112800     MOVE '4200-INSERT-ROW-TIMTBKY-TBL      '                     11240099
112900                                    TO TM600-CURR-PARAGRAPH.      11250099
113000                                                                  11260099
113100     EXEC SQL                                                     11270099
113200        INSERT INTO TIMTBKY                                       11280099
113300           (NOTIF_NBR                                             11290099
113400           ,IMPRT_ID                                              11300099
113500           ,IMPRT_SEQ_NBR                                         11310099
113600           ,PRCS_TYP_CDE                                          11320099
113700           ,CRE_TMST)                                             11330099
113800          VALUES  (:IMTBKY-NOTIF-NBR                              11340099
113900                 , :IMTBKY-IMPRT-ID                               11350099
114000                 , :IMTBKY-IMPRT-SEQ-NBR                          11360099
114100                 , :IMTBKY-PRCS-TYP-CDE                           11370099
114200                 , :IMTBKY-CRE-TMST)                              11380099
114300     END-EXEC.                                                    11390099
114400                                                                  11400099
114500     EVALUATE TRUE                                                11410099
114600       WHEN SQLCODE NOT EQUAL ZERO                                11420099
114700       WHEN SQLWARN0 NOT EQUAL SPACE                              11430099
114800         MOVE 'SEVERE SQL - TRBL KEY INSERT  '                    11440099
114900                                    TO TM600-TRBL-ERROR-TEXT      11450099
115000         DISPLAY '@@@@@@@@@@@@@@  ARRAY SUBSCRIPT - ' PV-KY-SUB   11460099
               DISPLAY 'NOTIF-NBR: ' IMTBKY-NOTIF-NBR                   11461099
               DISPLAY 'IMPRT-ID: ' IMTBKY-IMPRT-ID                     11462099
               DISPLAY 'IMPRT-SEQ-NBR: ' IMTBKY-IMPRT-SEQ-NBR           11463099
               DISPLAY 'PRCS-TYP-CDE: ' IMTBKY-PRCS-TYP-CDE             11464099
               DISPLAY 'CRE-TMST: ' IMTBKY-CRE-TMST                     11465099
115100         PERFORM 9100-SQL-ABEND                                   11470099
115200     END-EVALUATE.                                                11480099
115300                                                                  11490099
115400 EJECT                                                            11500099
115500******************************************************************11510099
115600* BEFORE AN INSERT TO TROUBLE DETAIL TABLE                       *11520099
115700* MOVE DATA FROM CALLING PROGRAM AND OTHER SOURCES TO DCLGEN     *11530099
115800******************************************************************11540099
115900                                                                  11550099
116000 4210-INS-TTRBDTL-DCLGEN-MOVES.                                   11560099
116100                                                                  11570099
116200      MOVE TRBNTF-NOTIF-NBR            TO TRBDTL-NOTIF-NBR.       11580099
116300      MOVE PV-CUR-TMST                 TO TRBDTL-CRE-TMST.        11590099
116400      MOVE TM601-NOTIF-UID             TO TRBDTL-CRE-UID.         11600099
116500      MOVE TM601-TRBL-DTL-TXT-TXT (PV-DT-SUB)                     11610099
116600                                 TO TRBDTL-FREEFORM-TEXT-TEXT.    11620099
116700      MOVE TM601-TRBL-DTL-TXT-LEN (PV-DT-SUB)                     11630099
116800                                 TO TRBDTL-FREEFORM-TEXT-LEN.     11640099
116900                                                                  11650099
117000 EJECT                                                            11660099
117100******************************************************************11670099
117200* INSERT A ROW TO TTRBDTL - TROUBLE DETAIL TABLE.                *11680099
117300******************************************************************11690099
117400                                                                  11700099
117500 4300-INSERT-ROW-TTRBDTL-TBL.                                     11710099
117600                                                                  11720099
117700     MOVE '4300-INSERT-ROW-TTRBDTL-TBL      '                     11730099
117800                                    TO TM600-CURR-PARAGRAPH.      11740099
117900                                                                  11750099
118000     EXEC SQL                                                     11760099
118100        INSERT INTO TTRBDTL                                       11770099
118200           (NOTIF_NBR                                             11780099
118300           ,CRE_TMST                                              11790099
118400           ,CRE_UID                                               11800099
118500           ,FREEFORM_TEXT)                                        11810099
118600          VALUES  (:TRBDTL-NOTIF-NBR                              11820099
118700                 , :TRBDTL-CRE-TMST                               11830099
118800                 , :TRBDTL-CRE-UID                                11840099
118900                 , :TRBDTL-FREEFORM-TEXT)                         11850099
119000     END-EXEC.                                                    11860099
119100                                                                  11870099
119200     EVALUATE TRUE                                                11880099
119300       WHEN SQLCODE NOT EQUAL ZERO                                11890099
119400       WHEN SQLWARN0 NOT EQUAL SPACE                              11900099
119500         MOVE 'SEVERE SQL - TRBL DETAIL INS  '                    11910099
119600                                    TO TM600-TRBL-ERROR-TEXT      11920099
119700         DISPLAY '@@@@@@@@@@@@@@ DETAIL SUBSCRIPT - ' PV-DT-SUB   11930099
119800         PERFORM 9100-SQL-ABEND                                   11940099
119900     END-EVALUATE.                                                11950099
120000                                                                  11960099
120100 EJECT                                                            11970099
120200******************************************************************11980099
120300* 5000 PARAGRAPHS DEAL WITH TROUBLE NOTIFICATION UPDATES.        *11990099
120400******************************************************************12000099
120500                                                                  12010099
120600 5000-UPDATE-TROUBLE.                                             12020099
120700                                                                  12030099
120800     MOVE '5000-UPDATE-TROUBLE           '                        12040099
120900                                    TO TM600-CURR-PARAGRAPH.      12050099
121000                                                                  12060099
121100     PERFORM  5100-UPDATE-TROUBLE-NOTIFY.                         12070099
121200                                                                  12080099
121300     IF PS-NO-EDIT-ERRORS                                         12090099
121400       PERFORM 5100-SELECT-MOST-CUR-DETAIL                        12100099
121500     END-IF.                                                      12110099
121600                                                                  12120099
121700     IF PS-NO-EDIT-ERRORS AND (TM601-TRBL-DETAIL-COUNT  > ZERO)   12130099
121800       MOVE PC-1 TO PV-DT-SUB                                     12140099
121900       PERFORM 5200-UPDATE-TROUBLE-DETAIL                         12150099
122000     END-IF.                                                      12160099
122100                                                                  12170099
122200******************************************************************12180099
122300                                                                  12190099
122400 5100-UPDATE-TROUBLE-NOTIFY.                                      12200099
122500                                                                  12210099
122600     MOVE '5100-UPDATE-TROUBLE-NOTIFY    '                        12220099
122700                                    TO TM600-CURR-PARAGRAPH.      12230099
122800                                                                  12240099
122900     MOVE TM601-TRBL-NOTIF-NBR     TO TRBNTF-NOTIF-NBR.           12250099
123000     MOVE TM601-ERLY-LTE-DAY-QTY   TO TRBNTF-ERLY-LTE-DAY-QTY.    12260099
123100     MOVE TM601-OVER-SHRT-PCT      TO TRBNTF-OVER-SHT-PCT.        12270099
123200                                                                  12280099
123300     EXEC SQL                                                     12290099
123400       UPDATE  TTRBNTF                                            12300099
123500          SET  ERLY_LTE_DAY_QTY      = :TRBNTF-ERLY-LTE-DAY-QTY   12310099
123600              ,OVER_SHT_PCT          = :TRBNTF-OVER-SHT-PCT       12320099
123700        WHERE  NOTIF_NBR             = :TRBNTF-NOTIF-NBR          12330099
123800     END-EXEC.                                                    12340099
123900                                                                  12350099
124000     EVALUATE TRUE                                                12360099
124100         WHEN SQLCODE = +100                                      12370099
124200           SET TM601-TTRBNTF-UPDATE-ERROR        TO TRUE          12380099
124300           SET PS-EDIT-ERRORS                    TO TRUE          12390099
124400           MOVE 'UPDATE - TROUBLE NOT FOUND  '                    12400099
124500                                    TO TM600-TRBL-ERROR-TEXT      12410099
124600           DISPLAY '&&&&&&&&&&&&&& NOTIFICATION NUMB - '          12420099
124700                                          TRBNTF-NOTIF-NBR        12430099
124800           PERFORM 9200-DISPLAY-ERROR                             12440099
124900         WHEN SQLCODE NOT EQUAL ZERO                              12450099
125000         WHEN SQLWARN0 NOT EQUAL SPACE                            12460099
125100           MOVE 'SEVERE SQL ERROR              '                  12470099
125200                                    TO TM600-TRBL-ERROR-TEXT      12480099
125300           PERFORM 9100-SQL-ABEND                                 12490099
125400     END-EVALUATE.                                                12500099
125500                                                                  12510099
125600******************************************************************12520099
125700* SELECT THE MOST CURRENT TROUBLE DETAIL ROW.                    *12530099
125800******************************************************************12540099
125900                                                                  12550099
126000 5100-SELECT-MOST-CUR-DETAIL.                                     12560099
126100                                                                  12570099
126200     MOVE '5100-SELECT-MOST-CUR-DETAIL'                           12580099
126300                                    TO TM600-CURR-PARAGRAPH.      12590099
126400     MOVE TM601-TRBL-NOTIF-NBR      TO TRBDTL-NOTIF-NBR.          12600099
126500                                                                  12610099
126600     EXEC SQL                                                     12620099
126700      SELECT MAX(CRE_TMST)                                        12630099
126800        INTO :TRBDTL-CRE-TMST                                     12640099
126900        FROM TTRBDTL                                              12650099
127000       WHERE NOTIF_NBR = :TRBDTL-NOTIF-NBR                        12660099
127100         AND CRE_UID   = :PC-TMKUP625                             12670099
127200     END-EXEC.                                                    12680099
127300                                                                  12690099
127400     EVALUATE TRUE                                                12700099
127500         WHEN SQLCODE = +100                                      12710099
127600           SET TM601-TTRDTL-UPDATE-ERROR         TO TRUE          12720099
127700           SET PS-EDIT-ERRORS                    TO TRUE          12730099
127800           MOVE 'SELECT - TROUBLE DTL NOT FOUND'                  12740099
127900                                    TO TM600-TRBL-ERROR-TEXT      12750099
128000           DISPLAY '@@@@@@@@@@@@@@ NOTIFICATION NUMB - '          12760099
128100                                          TM601-TRBL-NOTIF-NBR    12770099
128200           PERFORM 9200-DISPLAY-ERROR                             12780099
128300         WHEN SQLCODE NOT EQUAL ZERO                              12790099
128400         WHEN SQLWARN0 NOT EQUAL SPACE                            12800099
128500           MOVE 'SEVERE SQL ERROR              '                  12810099
128600                                    TO TM600-TRBL-ERROR-TEXT      12820099
128700           PERFORM 9100-SQL-ABEND                                 12830099
128800     END-EVALUATE.                                                12840099
128900                                                                  12850099
129000******************************************************************12860099
129100* UPDATE THE MOST CURRENT TROUBLE DETAIL ROW.  THE TIMESTAMP     *12870099
129200* WAS OBTAINED IN THE '5100-SELECT-MOST-CUR-DETAIL PARAGRAPGH'.  *12880099
129300******************************************************************12890099
129400                                                                  12900099
129500 5200-UPDATE-TROUBLE-DETAIL.                                      12910099
129600                                                                  12920099
129700     MOVE '5200-UPDATE-TROUBLE-DETAIL    '                        12930099
129800                                 TO TM600-CURR-PARAGRAPH.         12940099
129900                                                                  12950099
130000     MOVE TM601-TRBL-NOTIF-NBR   TO TRBDTL-NOTIF-NBR.             12960099
130100     MOVE TM601-TRBL-DTL-TXT-TXT (PV-DT-SUB)                      12970099
130200                                 TO TRBDTL-FREEFORM-TEXT-TEXT.    12980099
130300     MOVE TM601-TRBL-DTL-TXT-LEN (PV-DT-SUB)                      12990099
130400                                 TO TRBDTL-FREEFORM-TEXT-LEN.     13000099
130500                                                                  13010099
130600     EXEC SQL                                                     13020099
130700       UPDATE  TTRBDTL                                            13030099
130800         SET FREEFORM_TEXT = :TRBDTL-FREEFORM-TEXT                13040099
130900         WHERE NOTIF_NBR = :TRBDTL-NOTIF-NBR                      13050099
131000           AND CRE_TMST  = :TRBDTL-CRE-TMST                       13060099
131100           AND CRE_UID   = :PC-TMKUP625                           13070099
131200     END-EXEC.                                                    13080099
131300                                                                  13090099
131400     EVALUATE TRUE                                                13100099
131500         WHEN SQLCODE = +100                                      13110099
131600           SET TM601-TTRDTL-UPDATE-ERROR         TO TRUE          13120099
131700           SET PS-EDIT-ERRORS                    TO TRUE          13130099
131800           MOVE 'UPDATE - TROUBLE DTL NOT FOUND'                  13140099
131900                                    TO TM600-TRBL-ERROR-TEXT      13150099
132000           DISPLAY '!!!!!!!!!!!!!! NOTIFICATION NUMB - '          13160099
132100                                          TM601-TRBL-NOTIF-NBR    13170099
132200           PERFORM 9200-DISPLAY-ERROR                             13180099
132300         WHEN SQLCODE NOT EQUAL ZERO                              13190099
132400         WHEN SQLWARN0 NOT EQUAL SPACE                            13200099
132500           MOVE 'SEVERE SQL ERROR              '                  13210099
132600                                    TO TM600-TRBL-ERROR-TEXT      13220099
132700           PERFORM 9100-SQL-ABEND                                 13230099
132800     END-EVALUATE.                                                13240099
132900                                                                  13250099
133000 EJECT                                                            13260099
133100******************************************************************13270099
133200* 6000 PARAGRAPHS RESOLVE TROUBLE NOTIFICATIONS.                 *13280099
133300******************************************************************13290099
133400                                                                  13300099
133500 6000-RESOLVE-TROUBLE.                                            13310099
133600                                                                  13320099
133700     MOVE '6000-RESOLVE-TROUBLE          '                        13330099
133800                                    TO TM600-CURR-PARAGRAPH.      13340099
133900                                                                  13350099
134000     MOVE TM601-TRBL-NOTIF-NBR     TO TRBNTF-NOTIF-NBR.           13360099
134100     MOVE 'R'                      TO TRBNTF-RESOLVED-IND.        13370099
134200     MOVE PV-CUR-TMST              TO TRBNTF-RESOLVED-TMST.       13380099
134300     MOVE TM601-NOTIF-UID          TO TRBNTF-RESOLVED-UID.        13390099
134400     MOVE TM601-RSPNB-RSLU-ID      TO TRBNTF-RSPNB-RSLU-ID.       13400099
134500     MOVE TM601-ACTVY-RSLU-CDE     TO TRBNTF-ACTVY-RSLU-CDE.      13410099
134600     MOVE TM601-ERLY-LTE-DAY-QTY   TO TRBNTF-ERLY-LTE-DAY-QTY.    13420099
134700     MOVE TM601-OVER-SHRT-PCT      TO TRBNTF-OVER-SHT-PCT.        13430099
134800                                                                  13440099
134900* 1ST RESOLVE THE TROUBLE                                        *13441099
135000     PERFORM 6100-UPDATE-TTRBNTF.                                 13450099
135100                                                                  13451099
135200* DETERMINE THE FIRST TROUBLE DETAIL CREATED TO                  *13451199
135300* UPDATE SEVERITY OF EXCEPTION.                                  *13451299
135400     IF PS-NO-EDIT-ERRORS AND (TM601-TRBL-DETAIL-COUNT  > ZERO)   13452099
135500       PERFORM 5100-SELECT-MOST-CUR-DETAIL                        13453099
135600     END-IF.                                                      13454099
135700                                                                  13455099
135800* UPDATE THE TROUBLE DETAIL'S SEVERITY                           *13455199
135900     IF PS-NO-EDIT-ERRORS AND (TM601-TRBL-DETAIL-COUNT  > ZERO)   13456099
136000       MOVE PC-1 TO PV-DT-SUB                                     13457099
136100       PERFORM 5200-UPDATE-TROUBLE-DETAIL                         13458099
136200     END-IF.                                                      13459099
136300                                                                  13459199
136400* LASTLY INSERT A NEW ROW INDICATING THE TROUBLE                 *13459299
136500* WAS RESOLVED AND FROM WHAT EVENT ON THE SYSTEM                 *13459399
136600     IF PS-NO-EDIT-ERRORS                                         13460099
136700        MOVE PC-1 TO PV-DT-SUB                                    13470099
136800        MOVE SPACES TO PV-RESV-BY-DESC                            13471099
136900        PERFORM 6200-GET-RESOLVE-DESC                             13480099
137000        IF SQLCODE = ZERO                                         13490099
137100          MOVE ICDVAL-CDVL-DESC TO PV-RESV-BY-DESC                13500099
137200        ELSE                                                      13510099
137300          MOVE 'BY SYSYEM'      TO PV-RESV-BY-DESC                13520099
137400        END-IF                                                    13530099
137500        MOVE PV-RESV-BY                                           13540099
137600                      TO TM601-TRBL-DTL-TXT-TXT (PV-DT-SUB)       13550099
137700        MOVE PC-42    TO TM601-TRBL-DTL-TXT-LEN (PV-DT-SUB)       13560099
137800        MOVE TRBNTF-NOTIF-NBR       TO TRBDTL-NOTIF-NBR           13570099
137900        MOVE TRBNTF-RESOLVED-TMST   TO TRBDTL-CRE-TMST            13580099
138000        MOVE TRBNTF-RESOLVED-UID    TO TRBDTL-CRE-UID             13590099
138100        MOVE TM601-TRBL-DTL-TXT-TXT (PV-DT-SUB)                   13600099
138200                              TO TRBDTL-FREEFORM-TEXT-TEXT        13610099
138300        MOVE TM601-TRBL-DTL-TXT-LEN (PV-DT-SUB)                   13620099
138400                              TO TRBDTL-FREEFORM-TEXT-LEN         13630099
138500        PERFORM 4300-INSERT-ROW-TTRBDTL-TBL                       13640099
138600     END-IF.                                                      13650099
138700                                                                  13660099
138800******************************************************************13670099
138900                                                                  13680099
139000 6100-UPDATE-TTRBNTF.                                             13690099
139100                                                                  13700099
139200     EXEC SQL                                                     13710099
139300       UPDATE  TTRBNTF                                            13720099
139400          SET  RESOLVED_IND          = :TRBNTF-RESOLVED-IND       13730099
139500              ,RESOLVED_TMST         = :TRBNTF-RESOLVED-TMST      13740099
139600              ,RESOLVED_UID          = :TRBNTF-RESOLVED-UID       13750099
139700              ,RSPNB_RSLU_ID         = :TRBNTF-RSPNB-RSLU-ID      13760099
139800              ,ACTVY_RSLU_CDE        = :TRBNTF-ACTVY-RSLU-CDE     13770099
139900              ,ERLY_LTE_DAY_QTY      = :TRBNTF-ERLY-LTE-DAY-QTY   13780099
140000              ,OVER_SHT_PCT          = :TRBNTF-OVER-SHT-PCT       13790099
140100              ,LAST_DTL_CRE_TMST     = :TRBNTF-RESOLVED-TMST      13800099
140200        WHERE  NOTIF_NBR             = :TRBNTF-NOTIF-NBR          13810099
140300     END-EXEC.                                                    13820099
140400                                                                  13830099
140500     EVALUATE TRUE                                                13840099
140600         WHEN SQLCODE = +100                                      13850099
140700           SET TM601-TTRBNTF-RESOLVE-ERROR       TO TRUE          13860099
140800           SET PS-EDIT-ERRORS                    TO TRUE          13870099
140900           MOVE 'RESOLVE - TROUBLE NOT FOUND   '                  13880099
141000                                    TO TM600-TRBL-ERROR-TEXT      13890099
141100           DISPLAY '%%%%%%%%%%%%%% NOTIFICATION NUMB - '          13900099
141200                                          TRBNTF-NOTIF-NBR        13910099
141300           PERFORM 9200-DISPLAY-ERROR                             13920099
141400         WHEN SQLCODE NOT EQUAL ZERO                              13930099
141500         WHEN SQLWARN0 NOT EQUAL SPACE                            13940099
141600           MOVE 'SEVERE SQL ERROR              '                  13950099
141700                                    TO TM600-TRBL-ERROR-TEXT      13960099
141800           PERFORM 9100-SQL-ABEND                                 13970099
141900     END-EVALUATE.                                                13980099
142000                                                                  13990099
142100 EJECT                                                            14000099
142200******************************************************************14010099
142300                                                                  14020099
142400  6200-GET-RESOLVE-DESC.                                          14030099
142500                                                                  14040099
142600     MOVE '6200-GET-RESOLVE-DESC         '                        14050099
142700                                    TO TM600-CURR-PARAGRAPH.      14060099
142800                                                                  14070099
142900     EXEC SQL                                                     14080099
143000        SELECT B.CDVL_DESC                                        14090099
143100          INTO :ICDVAL-CDVL-DESC                                  14100099
143200          FROM TICDMST  A                                         14110099
143300              ,TICDVAL  B                                         14120099
143400         WHERE B.CDE_ID              =  :PC-600                   14130099
143500           AND B.CDVL_CDE            =  :TM601-ACTVY-RSLU-CDE     14140099
143600           AND A.CDE_ID              =  B.CDE_ID                  14150099
143700     END-EXEC.                                                    14160099
143800                                                                  14170099
143900                                                                  14180099
144000     EVALUATE TRUE                                                14190099
144100         WHEN SQLCODE EQUAL ZERO                                  14200099
144200           CONTINUE                                               14210099
144300         WHEN SQLCODE EQUAL +100                                  14220099
144400           MOVE 'RESOLVE DESCRIPTION NOT FOUND '                  14230099
144500                                     TO TM600-TRBL-ERROR-TEXT     14240099
144600           PERFORM 9200-DISPLAY-ERROR                             14250099
144700         WHEN SQLCODE NOT EQUAL ZERO                              14260099
144800         WHEN SQLWARN0 NOT EQUAL SPACE                            14270099
144900           MOVE 'SEVERE SQL ERROR              '                  14280099
145000                                     TO TM600-TRBL-ERROR-TEXT     14290099
145100           PERFORM 9100-SQL-ABEND                                 14300099
145200     END-EVALUATE.                                                14310099
145300                                                                  14320099
145400                                                                  14330099
145500 EJECT                                                            14340099
145600******************************************************************14350099
145700* 7000 PARAGRAPHS ACKNOWLEDGE TROUBLE NOTIFICATIONS.              14360099
145800******************************************************************14370099
145900                                                                  14380099
146000 7000-ACKNOWLEDGE-TROUBLE.                                        14390099
146100                                                                  14400099
146200     MOVE '7000-ACKNOWLEDGE-TROUBLE      '                        14410099
146300                                    TO TM600-CURR-PARAGRAPH.      14420099
146400                                                                  14430099
146500     MOVE TM601-TRBL-NOTIF-NBR     TO TRBNTF-NOTIF-NBR.           14440099
146600     MOVE 'A'                      TO TRBNTF-RESOLVED-IND.        14450099
146700     MOVE PV-CUR-TMST              TO TRBNTF-ACKNOWLG-TMST.       14460099
146800     MOVE TM601-NOTIF-UID          TO TRBNTF-ACKNOWLG-UID.        14470099
146900                                                                  14480099
147000     EXEC SQL                                                     14490099
147100       UPDATE  TTRBNTF                                            14500099
147200          SET  RESOLVED_IND          = :TRBNTF-RESOLVED-IND       14510099
147300              ,ACKNOWLG_TMST         = :TRBNTF-ACKNOWLG-TMST      14520099
147400              ,ACKNOWLG_UID          = :TRBNTF-ACKNOWLG-UID       14530099
147500        WHERE  NOTIF_NBR             = :TRBNTF-NOTIF-NBR          14540099
147600     END-EXEC.                                                    14550099
147700                                                                  14560099
147800     EVALUATE TRUE                                                14570099
147900         WHEN SQLCODE = +100                                      14580099
148000           SET TM601-TTRBNTF-ACKNOWLG-ERROR      TO TRUE          14590099
148100           SET PS-EDIT-ERRORS                    TO TRUE          14600099
148200           MOVE 'ACKNOWLG - TROUBLE NOT FOUND  '                  14610099
148300                                    TO TM600-TRBL-ERROR-TEXT      14620099
148400           DISPLAY '%%%%%%%%%%%%%% NOTIFICATION NUMB - '          14630099
148500                                          TRBNTF-NOTIF-NBR        14640099
148600           PERFORM 9200-DISPLAY-ERROR                             14650099
148700         WHEN SQLCODE NOT EQUAL ZERO                              14660099
148800         WHEN SQLWARN0 NOT EQUAL SPACE                            14670099
148900           MOVE 'SEVERE SQL ERROR              '                  14680099
149000                                    TO TM600-TRBL-ERROR-TEXT      14690099
149100           PERFORM 9100-SQL-ABEND                                 14700099
149200     END-EVALUATE.                                                14710099
149300                                                                  14720099
149400 EJECT                                                            14730099
149500******************************************************************14740099
149600* WRITE DETAIL REPORT ROW TO WORK TABLE                           14750099
149700******************************************************************14760099
149800                                                                  14770099
149900 8000-DETAIL-REPORT-ROW.                                          14780099
150000                                                                  14790099
150100     MOVE 'D'                       TO TM604-ODR-RECORD-TYP.      14800099
150200     MOVE TM601-PO-NBR              TO TM604-PO-NBR.              14810099
150300     MOVE TM601-CNTRL-NBR           TO TM604-CNTRL-NBR.           14820099
150400     MOVE TM601-TRBL-RSN-CDE        TO TM604-TRBL-RSN-CDE.        14830099
150500     MOVE '03'                      TO TM604-GROUP-TYP-CDE.       14840099
150600     MOVE ZERO                      TO TM604-GROUP-SEQ-NBR.       14850099
150700     IF TM601-TRBL-PROCESS-SW = 'I'                               14860099
150800       MOVE TRBNTF-NOTIF-NBR        TO TM604-NOTIF-NBR            14870099
150900     ELSE                                                         14880099
151000       MOVE TM601-TRBL-NOTIF-NBR    TO TM604-NOTIF-NBR            14890099
151100     END-IF.                                                      14900099
151200     MOVE TM601-RSPNB-RSLU-ID       TO TM604-CURR-RSPNB-RSLU-ID.  14910099
151300     MOVE TM601-PFMC-TRKG-ID        TO TM604-CURR-PFMC-TRKG-ID.   14920099
151400     MOVE TM601-INITR-ID            TO TM604-CURR-INITR-ID.       14930099
151500     EVALUATE TRUE                                                14940099
151600       WHEN TM601-TRBL-PROCESS-SW    = 'I'                        14950099
151700         MOVE 'T'                   TO TM604-TRBL-ACTION-CDE      14960099
151800       WHEN TM601-RSLV-PROCESS-SW    = 'R'                        14970099
151900         MOVE 'R'                   TO TM604-TRBL-ACTION-CDE      14980099
152000       WHEN TM601-UPD-PROCESS-SW     = 'U'                        14990099
152100         MOVE 'U'                   TO TM604-TRBL-ACTION-CDE      15000099
152200       WHEN TM601-ACKNOWL-PROCESS-SW = 'A'                        15010099
152300         MOVE 'A'                   TO TM604-TRBL-ACTION-CDE      15020099
152400     END-EVALUATE.                                                15030099
152500                                                                  15040099
152600     MOVE TM601-ACTVY-RSLU-CDE      TO TM604-CURR-ACTVY-RSLU-CDE. 15050099
152700     MOVE TM601-OVER-SHRT-PCT       TO TM604-OVER-SHRT-PCT.       15060099
152800     MOVE TM601-ERLY-LTE-DAY-QTY    TO TM604-ERLY-LTE-DAY-QTY.    15070099
152900     MOVE PV-CUR-TMST               TO TM604-UPDATE-TMST.         15080099
153000                                                                  15090099
153100     MOVE TM604-RPT-PAR-1-ODR       TO OUTTM2-TRBL-RPT-PAR-1-ODR. 15100099
153200     MOVE TM604-RPT-PAR-2-ODR       TO OUTTM2-TRBL-RPT-PAR-2-ODR. 15110099
153300                                                                  15120099
153400     PERFORM 8300-INSERT-TOUTTM2-RPT.                             15130099
153500                                                                  15140099
153600 EJECT                                                            15150099
153700******************************************************************15160099
153800* WRITE ERROR REPORT ROW TO WORK TABLE                            15170099
153900******************************************************************15180099
154000                                                                  15190099
154100 8100-ERROR-REPORT-ROW.                                           15200099
154200                                                                  15210099
154300     MOVE 'E'                       TO TM600-ODR-RECORD-TYP.      15220099
154400     MOVE TM601-PO-NBR              TO TM600-PO-NBR.              15230099
154500     MOVE TM601-CNTRL-NBR           TO TM600-CNTRL-NBR.           15240099
154600     MOVE TM601-TRBL-RSN-CDE        TO TM600-TRBL-RSN-CDE.        15250099
154700     MOVE '05'                      TO TM600-GROUP-TYP-CDE.       15260099
154800     MOVE ZERO                      TO TM600-GROUP-SEQ-NBR.       15270099
154900                                                                  15280099
155000     MOVE TM600-RPT-PAR-1-ODR       TO OUTTM2-TRBL-RPT-PAR-1-ODR. 15290099
155100     MOVE TM600-RPT-PAR-2-ODR       TO OUTTM2-TRBL-RPT-PAR-2-ODR. 15300099
155200                                                                  15310099
155300     PERFORM 8300-INSERT-TOUTTM2-RPT.                             15320099
155400                                                                  15330099
155500 EJECT                                                            15340099
155600******************************************************************15350099
155700                                                                  15360099
155800 8300-INSERT-TOUTTM2-RPT.                                         15370099
155900                                                                  15380099
156000     MOVE '8300-INSERT-TOUTTM2-RPT       '                        15390099
156100                                    TO TM600-CURR-PARAGRAPH.      15400099
156200                                                                  15410099
156300     EXEC SQL                                                     15420099
156400        INSERT INTO TOUTTM2                                       15430099
156500           (TRBL_RPT_PAR_1_ODR,                                   15440099
156600            TRBL_RPT_PAR_2_ODR)                                   15450099
156700          VALUES  (:OUTTM2-TRBL-RPT-PAR-1-ODR,                    15460099
156800                   :OUTTM2-TRBL-RPT-PAR-2-ODR)                    15470099
156900     END-EXEC.                                                    15480099
157000                                                                  15490099
157100     EVALUATE TRUE                                                15500099
157200         WHEN SQLCODE NOT EQUAL ZERO                              15510099
157300         WHEN SQLWARN0 NOT EQUAL SPACE                            15520099
157400           MOVE 'SEVERE SQL ERROR - INSERT WORK'                  15530099
157500                                    TO TM600-TRBL-ERROR-TEXT      15540099
157600           PERFORM 9100-SQL-ABEND                                 15550099
157700     END-EVALUATE.                                                15560099
157800                                                                  15570099
157900 EJECT                                                            15580099
158000******************************************************************15590099
158100* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *15600099
158200* ERROR OR WARNING CODE OCCURS.                                  *15610099
158300******************************************************************15620099
158400                                                                  15630099
158500 9100-SQL-ABEND.                                                  15640099
158600                                                                  15650099
158700     MOVE TM601-PO-NBR          TO PV-DISPLAY-PO-NBR.             15660099
158800     DISPLAY '********* ABEND DUE TO SQL *****************'       15670099
158900     DISPLAY '** PROGRAM         = ' PC-TMKUP630                  15680099
159000     DISPLAY '** PARAGRAPH       = ' TM600-CURR-PARAGRAPH         15690099
159100     DISPLAY '** PO NUMBER       = ' PV-DISPLAY-PO-NBR            15700099
159200     DISPLAY '** ERROR MSG       = ' TM600-TRBL-ERROR-TEXT        15710099
159300     DISPLAY '********************************************'.      15720099
159400                                                                  15730099
159500******************************************************************15740099
159600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *15750099
159700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *15760099
159800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *15770099
159900* FORMAT.                                                        *15780099
160000******************************************************************15790099
160100                                                                  15800099
160200     COPY DPPD004.                                                15810099
160300                                                                  15820099
160400     CALL 'ILBOABN0' USING ABEND-CODE.                            15830099
160500                                                                  15840099
160600 EJECT                                                            15850099
160700******************************************************************15860099
160800* DISPLAY NON ABEND/NON SQL ERROR INFORMATION                    *15870099
160900******************************************************************15880099
161000                                                                  15890099
161100 9200-DISPLAY-ERROR.                                              15900099
161200                                                                  15910099
161300     MOVE TM601-PO-NBR          TO PV-DISPLAY-PO-NBR.             15920099
161400     DISPLAY '--------------- BAD RETURN CODE ------------------' 15930099
161500     DISPLAY '-- PROGRAM         = ' PC-TMKUP630                  15940099
161600     DISPLAY '-- PARAGRAPH       = ' TM600-CURR-PARAGRAPH         15950099
161700     DISPLAY '-- PO NUMBER       = ' PV-DISPLAY-PO-NBR            15960099
161800     DISPLAY '-- TM601 RETURN CD = ' TM601-RETURN-CODE            15970099
161900     DISPLAY '-- ERROR MSG       = ' TM600-TRBL-ERROR-TEXT        15980099
162000     DISPLAY '--------------------------------------------------'.15990099
162100                                                                  16000099
162200******************************************************************16010099
162300                                                                  16020099
162400 9300-SET-CURRENT-TIMESTAMP.                                      16030099
162500                                                                  16040099
162600     MOVE '9300-SET-CURRENT-TIMESTAMP    '                        16050099
162700                                    TO TM600-CURR-PARAGRAPH.      16060099
162800                                                                  16070099
162900     EXEC SQL                                                     16080099
163000       SET :PV-CUR-TMST = CURRENT TIMESTAMP                       16090099
163100     END-EXEC.                                                    16100099
163200                                                                  16110099
163300     EVALUATE TRUE                                                16120099
163400                                                                  16130099
163500         WHEN SQLCODE NOT EQUAL ZERO                              16140099
163600         WHEN SQLWARN0 NOT EQUAL SPACE                            16150099
163700           SET TM601-SET-TIMESTAMP-FAILED   TO TRUE               16160099
163800           SET PS-EDIT-ERRORS               TO TRUE               16170099
163900           MOVE 'FAILED TO SET CURRENT TMST    '                  16180099
164000                                     TO TM600-TRBL-ERROR-TEXT     16190099
164100           PERFORM 9100-SQL-ABEND                                 16200099
164200                                                                  16210099
164300     END-EVALUATE.                                                16220099
164400                                                                  16230099
164500                                                                  16240099
164600 EJECT                                                            16250099
164700                                                                  16260099
