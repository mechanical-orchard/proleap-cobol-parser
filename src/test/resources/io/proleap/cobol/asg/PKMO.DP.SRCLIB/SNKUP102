000100******************************************************************00010064
000200 IDENTIFICATION DIVISION.                                         00020064
000300******************************************************************00030064
000400 PROGRAM-ID.   SNKUP102.                                          00040064
000500 AUTHOR.       JOE LAROSA.                                        00050064
000600 INSTALLATION. KOHLS DEPARTMENT STORES.                           00060064
000700 DATE-WRITTEN. OCTOBER 2005.                                      00070064
000800 DATE-COMPILED.                                                   00080064
000900******************************************************************00090064
001000*            ASN TRANSACTION REPOSITORY PURGE PROGRAM             00100064
001100*                                                                 00110064
001200* THIS PROGRAM READS THE "COMPLETED" RECORDS FROM THE ASN DOWNLOAD00120064
001300* REPOSITORY TABLES (SNT_DAT_CNTL & SNT_DAT_XFER) AND DELETES     00130064
001400* TRANSACTIONS RECORDS OLDER THAN 3 DAYS AFTER COMPLETION.        00140064
001500*                                                                 00150064
001600* THIS PROGRAM THEN MAKES A SECOND PASS OF THE REPOSITORY TABLE   00160064
001700* DELETING ALL TRANSACTIONS OVER 7 DAYS OLD, REGARDLESS OF THEIR  00170064
001800* STATUS.                                                         00180064
001900******************************************************************00190064
002000 ENVIRONMENT DIVISION.                                            00200064
002100******************************************************************00210064
002200 CONFIGURATION SECTION.                                           00220064
002300 SOURCE-COMPUTER.        IBM-3090.                                00230064
002400 OBJECT-COMPUTER.        IBM-3090.                                00240064
002500                                                                  00250064
002600 INPUT-OUTPUT SECTION.                                            00260064
002700 FILE-CONTROL.                                                    00270064
002800                                                                  00280064
P40396     SELECT TR063-ERROR-ASN-DETAIL-FILE                           00290064
P40396         ASSIGN TO OUT01.                                         00300064
P40396                                                                  00310064
002900******************************************************************00320064
003000 DATA DIVISION.                                                   00330064
003100******************************************************************00340064
003200 FILE SECTION.                                                    00350064
003300                                                                  00360064
P40396 FD  TR063-ERROR-ASN-DETAIL-FILE                                  00370064
P40396     RECORDING MODE IS F                                          00380064
P40396     LABEL RECORDS ARE STANDARD                                   00390064
P40396     BLOCK CONTAINS 0 RECORDS.                                    00400064
P40396                                                                  00410064
P40396 01  TR063-ERROR-ASN-DETAIL-RECORD   PIC X(400).                  00420064
P40396                                                                  00430064
003400 WORKING-STORAGE SECTION.                                         00440064
003500 01  PS-PROGRAM-SWITCHES.                                         00450064
003600     05  PS-END-OF-CNTL-CSR-SW       PIC X(01) VALUE 'N'.         00460064
003700         88  PS-END-OF-CNTL-CSR-YES            VALUE 'Y'.         00470064
003800         88  PS-END-OF-CNTL-CSR-NO             VALUE 'N'.         00480064
003900     05  PS-END-OF-CNTL7-CSR-SW      PIC X(01) VALUE 'N'.         00490064
004000         88  PS-END-OF-CNTL7-CSR-YES           VALUE 'Y'.         00500064
004100         88  PS-END-OF-CNTL7-CSR-NO            VALUE 'N'.         00510064
P40396     05  PS-END-OF-ERR-CNTL-CSR-SW   PIC X(01) VALUE 'N'.         00520064
P40396         88  PS-END-OF-ERR-CNTL-CSR-YES        VALUE 'Y'.         00530064
P40396         88  PS-END-OF-ERR-CNTL-CSR-NO         VALUE 'N'.         00540064
004200     05  PS-END-OF-XFER-CSR-SW       PIC X(01) VALUE 'N'.         00550064
004300         88  PS-END-OF-XFER-CSR-YES            VALUE 'Y'.         00560064
004400         88  PS-END-OF-XFER-CSR-NO             VALUE 'N'.         00570064
004500     05  PS-END-OF-XFER7-CSR-SW      PIC X(01) VALUE 'N'.         00580064
004600         88  PS-END-OF-XFER7-CSR-YES           VALUE 'Y'.         00590064
004700         88  PS-END-OF-XFER7-CSR-NO            VALUE 'N'.         00600064
P40396     05  PS-END-OF-PRF-PO-NBR-CSR-SW PIC X(01) VALUE 'N'.         00610064
P40396         88  PS-END-OF-PRF-PO-NBR-CSR-YES      VALUE 'Y'.         00620064
P40396         88  PS-END-OF-PRF-PO-NBR-CSR-NO       VALUE 'N'.         00630064
P40396     05  PS-PRF-SEGMENT-FOUND-SW     PIC X(01) VALUE 'N'.         00640064
P40396         88  PS-PRF-SEGMENT-FOUND-YES          VALUE 'Y'.         00650064
P40396         88  PS-PRF-SEGMENT-FOUND-NO           VALUE 'N'.         00660064
004800                                                                  00670064
004900 01  PC-PROGRAM-CONSTANTS.                                        00680064
005000     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'SNKUP102'.  00690064
005100     05  PC-MAX-RETRIES              PIC S9(3) VALUE +5 COMP-3.   00700064
005200                                                                  00710064
005300 01  PA-PROGRAM-ACCUMULATORS.                                     00720064
005400     05  PA-TOTALS.                                               00730064
005500         10  PA-TOTAL-CNTL-READ      PIC S9(7) VALUE +0 COMP-3.   00740064
005600         10  PA-TOTAL-CNTL7-READ     PIC S9(7) VALUE +0 COMP-3.   00750064
005700         10  PA-TOTAL-CNTL-DELETED   PIC S9(7) VALUE +0 COMP-3.   00760064
005800         10  PA-TOTAL-CNTL7-DELETED  PIC S9(7) VALUE +0 COMP-3.   00770064
005900         10  PA-TOTAL-XFER-DELETED   PIC S9(7) VALUE +0 COMP-3.   00780064
006000         10  PA-TOTAL-XFER7-DELETED  PIC S9(7) VALUE +0 COMP-3.   00790064
P40396         10  PA-TOTAL-ERRDTL-READ    PIC S9(7) VALUE +0 COMP-3.   00800064
P40396         10  PA-TOTAL-ERRDTL-WRITE   PIC S9(7) VALUE +0 COMP-3.   00810064
006100                                                                  00820064
006200 01  PV-PROGRAM-VARIABLES.                                        00830064
006300     05  PV-DISPLAY-RECORD           PIC ZZZ,ZZZ,ZZ9-.            00840064
006400     05  PV-DB2-COUNT                PIC S9(9) VALUE +0 COMP-3.   00850064
006500     05  PV-COMMIT-COUNT-XFER        PIC 9(07) VALUE ZEROES.      00860064
006600                                                                  00870064
006700     05  PV-PRC-CNTL-TMST            PIC X(26) VALUE SPACE.       00880064
006800     05  FILLER REDEFINES PV-PRC-CNTL-TMST.                       00890064
006900         10  PV-TMST-DATE.                                        00900064
007000             15  PV-TMST-CCYY        PIC 9(04).                   00910064
007100             15  FILLER              PIC X(01).                   00920064
007200             15  PV-TMST-MONTH       PIC 9(02).                   00930064
007300             15  FILLER              PIC X(01).                   00940064
007400             15  PV-TMST-DAY         PIC 9(02).                   00950064
007500         10  FILLER                  PIC X(01).                   00960064
007600         10  PV-TMST-HOUR            PIC 9(02).                   00970064
007700         10  FILLER                  PIC X(01).                   00980064
007800         10  PV-TMST-MINUTE          PIC 9(02).                   00990064
007900         10  FILLER                  PIC X(01).                   01000064
008000         10  PV-TMST-SECOND          PIC 9(02).                   01010064
008100         10  FILLER                  PIC X(01).                   01020064
008200         10  PV-TMST-LAST6           PIC 9(06).                   01030064
008300                                                                  01040064
008400     05  PV-TMST-MINUS-3-DAYS        PIC X(26) VALUE SPACE.       01050064
008500     05  FILLER REDEFINES PV-TMST-MINUS-3-DAYS.                   01060064
008600         10  PV-3D-DATE.                                          01070064
008700             15  PV-3D-CCYY          PIC 9(04).                   01080064
008800             15  FILLER              PIC X(01).                   01090064
008900             15  PV-3D-MONTH         PIC 9(02).                   01100064
009000             15  FILLER              PIC X(01).                   01110064
009100             15  PV-3D-DAY           PIC 9(02).                   01120064
009200         10  FILLER                  PIC X(16).                   01130064
009300                                                                  01140064
009400     05  PV-TMST-MINUS-7-DAYS        PIC X(26) VALUE SPACE.       01150064
009500     05  FILLER REDEFINES PV-TMST-MINUS-7-DAYS.                   01160064
009600         10  PV-7D-DATE.                                          01170064
009700             15  PV-7D-CCYY          PIC 9(04).                   01180064
009800             15  FILLER              PIC X(01).                   01190064
009900             15  PV-7D-MONTH         PIC 9(02).                   01200064
010000             15  FILLER              PIC X(01).                   01210064
010100             15  PV-7D-DAY           PIC 9(02).                   01220064
010200         10  FILLER                  PIC X(16).                   01230064
010300                                                                  01240064
P40396 01  PV-RECORD-VARIABLES.                                         01250064
P40396     05  PV-RECORD-MESSAGE           PIC X(41).                   01260064
P40396     05  PV-DAT-XFER-CNTL-ID         PIC 9(09).                   01270064
P40396     05  FILLER                      PIC X(350).                  01280064
P40396                                                                  01290064
010400 01  PV-ABEND-VARIABLES.                                          01300064
010500     05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP SYNC.01310064
010600     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP.     01320064
010700     05  PV-SQLCODE                  PIC S9(9).                   01330064
010800     05  PV-DISPLAY-SQLCODE          PIC -------999.              01340064
010900     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SNKUP102'.  01350064
011000     05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.      01360064
011100     05  PV-ABEND-OPERATION          PIC X(20) VALUE SPACES.      01370064
011200     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      01380064
011300     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      01390064
011400                                                                  01400064
011500******************************************************************01410064
011600*  WORK AREA PASSED IN CALL TO DPKUT500                           01420064
011700******************************************************************01430064
011800     COPY DPWS500.                                                01440064
011900                                                                  01450064
P40396******************************************************************01460064
P40396*  ASN DETAIL OUTPUT RECORD LAYOUT                                01470064
P40396******************************************************************01480064
P40396     COPY TRRD063.                                                01490064
P40396                                                                  01500064
012000******************************************************************01510064
012100*  DB2 FORMATTED MESSAGE AREA                                     01520064
012200******************************************************************01530064
012300     COPY DPWS004.                                                01540064
012400                                                                  01550064
012500******************************************************************01560064
012600*  COMMUNICATIONS AREA FOR DB2                                    01570064
012700******************************************************************01580064
012800     EXEC SQL                                                     01590064
012900         INCLUDE SQLCA                                            01600064
013000     END-EXEC.                                                    01610064
013100                                                                  01620064
013200******************************************************************01630064
013300*  DB2 TABLE DECLARATION                                          01640064
013400*  (SNT_DAT_CNTL - ASN DATA TRANSFER CONTROL TABLE)               01650064
013500******************************************************************01660064
013600     EXEC SQL                                                     01670064
013700         INCLUDE SNT00000                                         01680064
013800     END-EXEC.                                                    01690064
013900                                                                  01700064
014000******************************************************************01710064
014100*  DB2 TABLE DECLARATION                                          01720064
014200*  (SNT_DAT_XFER - ASN DATA TRANSFER DETAIL TABLE)                01730064
014300******************************************************************01740064
014400     EXEC SQL                                                     01750064
014500         INCLUDE SNT00001                                         01760064
014600     END-EXEC.                                                    01770064
014700                                                                  01780064
014800******************************************************************01790064
014900* COBOL CURSOR DELCARATION TO READ THE ASN CONTROL TABLE         *01800064
015000******************************************************************01810064
015100     EXEC SQL                                                     01820064
015200       DECLARE CNTL-CSR CURSOR WITH HOLD FOR                      01830064
015300        SELECT DAT_XFER_CNTL_ID                                   01840064
015400             , CRE_TMST                                           01850064
015500             , STAT_CDE                                           01860064
015600             , END_PRC_TMST                                       01870064
015610             , ASN_TYP_CDE                                        01880064
015700          FROM SNT_DAT_CNTL                                       01890064
015800         WHERE STAT_CDE      = 'C'                                01900064
015900           AND END_PRC_TMST < :PV-TMST-MINUS-3-DAYS               01910064
016000     END-EXEC.                                                    01920064
016100                                                                  01930064
016200     EXEC SQL                                                     01940064
016300       DECLARE CNTL7-CSR CURSOR WITH HOLD FOR                     01950064
016400        SELECT DAT_XFER_CNTL_ID                                   01960064
016500             , CRE_TMST                                           01970064
016600             , STAT_CDE                                           01980064
016700             , END_PRC_TMST                                       01990064
016710             , ASN_TYP_CDE                                        02000064
016800          FROM SNT_DAT_CNTL                                       02010064
016900         WHERE CRE_TMST < :PV-TMST-MINUS-7-DAYS                   02020064
017000     END-EXEC.                                                    02030064
017100                                                                  02040064
P40396     EXEC SQL                                                     02050064
P40396       DECLARE ERR-CNTL-CSR CURSOR WITH HOLD FOR                  02060064
P40396        SELECT DAT_XFER_CNTL_ID                                   02070064
P40396          FROM SNT_DAT_CNTL                                       02080064
P40396         WHERE CRE_TMST < :PV-TMST-MINUS-7-DAYS                   02090064
P40396           AND STAT_CDE      = 'E'                                02100064
P40396     END-EXEC.                                                    02110064
P40396                                                                  02120064
017200******************************************************************02130064
017300* COBOL CURSOR DELCARATION TO READ THE ASN DETAIL TABLE          *02140064
017400******************************************************************02150064
017500     EXEC SQL                                                     02160064
017600       DECLARE XFER-CSR CURSOR FOR                                02170064
017700        SELECT DAT_XFER_CNTL_ID                                   02180064
017800             , PRC_LOD_SEQ_NBR                                    02190064
017900             , DAT_CTG_CDE                                        02200064
018000             , LOD_DAT_TXT                                        02210064
018100          FROM SNT_DAT_XFER                                       02220064
018200         WHERE DAT_XFER_CNTL_ID = :SNT00000-DAT-XFER-CNTL-ID      02230064
018300     END-EXEC.                                                    02240064
018400                                                                  02250064
018500     EXEC SQL                                                     02260064
018600       DECLARE XFER7-CSR CURSOR FOR                               02270064
018700        SELECT DAT_XFER_CNTL_ID                                   02280064
018800             , PRC_LOD_SEQ_NBR                                    02290064
018900             , DAT_CTG_CDE                                        02300064
019000             , LOD_DAT_TXT                                        02310064
019100          FROM SNT_DAT_XFER                                       02320064
019200         WHERE DAT_XFER_CNTL_ID = :SNT00000-DAT-XFER-CNTL-ID      02330064
019300     END-EXEC.                                                    02340064
019400                                                                  02350064
P40396******************************************************************02360064
P40396* COBOL CURSOR DELCARATION TO READ PO NUMBER FROM XFER TABLE     *02370064
P40396******************************************************************02380064
P40396     EXEC SQL                                                     02390064
P40396       DECLARE PRF-PO-NBR-CSR CURSOR FOR                          02400064
P40396        SELECT DAT_XFER_CNTL_ID                                   02410064
P40396             , LOD_DAT_TXT                                        02420064
P40396          FROM SNT_DAT_XFER                                       02430064
P40396         WHERE DAT_XFER_CNTL_ID = :SNT00000-DAT-XFER-CNTL-ID      02440064
P40396           AND DAT_CTG_CDE      = 'PRF'                           02450064
P40396     END-EXEC.                                                    02460064
P40396                                                                  02470064
019500******************************************************************02480064
019600 LINKAGE SECTION.                                                 02490064
019700******************************************************************02500064
019800                                                                  02510064
019900/*****************************************************************02520064
020000 PROCEDURE DIVISION.                                              02530064
020100******************************************************************02540064
020200 0000-PROGRAM-MAINLINE.                                           02550064
020300     DISPLAY '************ START OF SNKUP102 ***************'     02560064
020400                                                                  02570064
020500     PERFORM 1000-INITIALIZE.                                     02580064
020600                                                                  02590064
P40396*REPORT ERROR STATUS ASN TRANSACTIONS.                            02600064
P40396     PERFORM 1100-REPORT-ERROR-RECORDS.                           02610064
P40396                                                                  02620064
020700*PROCESS COMPLETED TRANSACTIONS.                                  02630064
020800     PERFORM 2000-PROCESS-CMPLTD-RECORDS.                         02640064
020900                                                                  02650064
021000*PROCESS ONE-WEEK OLD TRANSACTIONS.                               02660064
P40396     PERFORM 4000-PROCESS-7DAY-RECORDS.                           02670064
021200                                                                  02680064
021300*EOJ ROUTINE.                                                     02690064
021400     PERFORM 9000-EOJ-ROUTINE.                                    02700064
021500                                                                  02710064
021600*STOP                                                             02720064
021700     DISPLAY ' '.                                                 02730064
021800     DISPLAY '************  END OF SNKUP102  ***************'     02740064
021900     STOP RUN.                                                    02750064
022000                                                                  02760064
022100******************************************************************02770064
022200*                                                                *02780064
022300*                I N I T I A L I Z A T I O N                     *02790064
022400*                                                                *02800064
022500******************************************************************02810064
022600 1000-INITIALIZE.                                                 02820064
022700                                                                  02830064
P40396     OPEN OUTPUT TR063-ERROR-ASN-DETAIL-FILE.                     02840064
022800*INIT COUNTERS.                                                   02850064
022900     INITIALIZE PA-TOTAL-CNTL-READ                                02860064
023000                PA-TOTAL-CNTL7-READ                               02870064
023100                PA-TOTAL-CNTL-DELETED                             02880064
023200                PA-TOTAL-CNTL7-DELETED                            02890064
023300                PA-TOTAL-XFER-DELETED                             02900064
023400                PA-TOTAL-XFER7-DELETED                            02910064
P40396                PA-TOTAL-ERRDTL-READ                              02920064
P40396                PA-TOTAL-ERRDTL-WRITE                             02930064
P40396                PV-RECORD-VARIABLES                               02940064
P40396                TR063-SHIP-NOTICE-DTL-RECORD                      02950064
023500                PV-COMMIT-COUNT-XFER.                             02960064
023600                                                                  02970064
023700*GET CURRENT TIMESTAMP.                                           02980064
023800     EXEC SQL                                                     02990064
023900         SET :PV-PRC-CNTL-TMST = CURRENT TIMESTAMP                03000064
024000     END-EXEC.                                                    03010064
024100                                                                  03020064
024200     EVALUATE TRUE                                                03030064
024300       WHEN SQLCODE = ZERO                                        03040064
024400           MOVE PV-PRC-CNTL-TMST TO PV-TMST-MINUS-3-DAYS          03050064
024500                                    PV-TMST-MINUS-7-DAYS          03060064
024600           DISPLAY ' CURRENT TIMESTAMP      = ' PV-PRC-CNTL-TMST  03070064
024700                                                                  03080064
024800       WHEN OTHER                                                 03090064
024900           MOVE '1000-INITIALIZATION' TO PV-ABEND-PARAGRAPH       03100064
025000           MOVE 'GET DB2 TMST'        TO PV-ABEND-OPERATION       03110064
025100           PERFORM 9900-DB2-ABEND                                 03120064
025200         END-EVALUATE.                                            03130064
025300                                                                  03140064
025400*CALCULATE 3 DAYS AGO.                                            03150064
025500     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03160064
025600     SET  DPG51-ACTUAL-CALENDAR-ONLY                              03170064
025700          DPG51-DECREMENT-DATE TO TRUE.                           03180064
025800     MOVE 3                    TO DPG51-INCR-DECR-DAYS-9.         03190064
025900     SET  DPG52-LK-DTE-ISO-FMT TO TRUE.                           03200064
026000*            'CCYY-MM-DD'                                         03210064
026100     MOVE PV-TMST-DATE TO DPG52-LK-DATE-INPUT.                    03220064
026200                                                                  03230064
026300     CALL DP500-KOHLS-CALENDAR-ROUTINE                            03240064
026400          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03250064
026500                                                                  03260064
026600     IF DPG54-DATE-INVALID                                        03270064
026700       OR DPG54-SEVERE-ERROR                                      03280064
026800         DISPLAY 'BAD RETURN FROM CALENDAR ROUTINE - '            03290064
026900                 DPG54-RETURN-FLAGS                               03300064
027000         MOVE '1000-INITIALIZATION' TO PV-ABEND-PARAGRAPH         03310064
027100         MOVE 'GET 3D TMST'         TO PV-ABEND-OPERATION         03320064
027200         PERFORM 9900-DB2-ABEND                                   03330064
027300     ELSE                                                         03340064
027400         MOVE DPG55-DB2-ISO-DATE-FMT TO PV-3D-DATE                03350064
027500     END-IF.                                                      03360064
027600                                                                  03370064
027700     DISPLAY ' COMPLETED DATE CUT-OFF = ' PV-3D-DATE.             03380064
027800                                                                  03390064
027900*CALCULATE 7 DAYS AGO.                                            03400064
028000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03410064
028100     SET  DPG51-ACTUAL-CALENDAR-ONLY                              03420064
028200          DPG51-DECREMENT-DATE TO TRUE.                           03430064
028300     MOVE 7                    TO DPG51-INCR-DECR-DAYS-9.         03440064
028400     SET  DPG52-LK-DTE-ISO-FMT TO TRUE.                           03450064
028500*         'CCYY-MM-DD'                                            03460064
028600     MOVE PV-TMST-DATE TO DPG52-LK-DATE-INPUT.                    03470064
028700                                                                  03480064
028800     CALL DP500-KOHLS-CALENDAR-ROUTINE                            03490064
028900          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03500064
029000                                                                  03510064
029100     IF DPG54-DATE-INVALID                                        03520064
029200       OR DPG54-SEVERE-ERROR                                      03530064
029300         DISPLAY 'BAD RETURN FROM CALENDAR ROUTINE - '            03540064
029400                 DPG54-RETURN-FLAGS                               03550064
029500         MOVE '1000-INITIALIZATION' TO PV-ABEND-PARAGRAPH         03560064
029600         MOVE 'GET 7D TMST'         TO PV-ABEND-OPERATION         03570064
029700         PERFORM 9900-DB2-ABEND                                   03580064
029800     ELSE                                                         03590064
029900         MOVE DPG55-DB2-ISO-DATE-FMT TO PV-7D-DATE                03600064
030000     END-IF.                                                      03610064
030100                                                                  03620064
030200     DISPLAY ' 7 DAYS DATE CUT-OFF    = ' PV-7D-DATE.             03630064
030300     DISPLAY ' '.                                                 03640064
030400                                                                  03650064
P40396******************************************************************03660064
P40396*                                                                *03670064
P40396*      R E P O R T  E R R O R  S T A T U S  R E C O R D S        *03680064
P40396*                                                                *03690064
P40396******************************************************************03700064
P40396 1100-REPORT-ERROR-RECORDS.                                       03710064
P40396     DISPLAY '1100-REPORT-ERROR-RECORDS'.                         03720064
P40396                                                                  03730064
P40396     PERFORM 1200-OPEN-ERR-CNTL-CURSOR.                           03740064
P40396                                                                  03750064
P40396     PERFORM 1300-FETCH-ERR-CNTL-CURSOR.                          03760064
P40396                                                                  03770064
P40396                                                                  03780064
P40396*REPORT ERROR STATUS TRANSACTIONS.                                03790064
P40396     PERFORM                                                      03800064
P40396       UNTIL PS-END-OF-ERR-CNTL-CSR-YES                           03810064
P40396                                                                  03820064
P40396*INCREMENT COUNTER OF ERROR RECORDS READ.                         03830064
P40396         ADD +1                      TO PA-TOTAL-ERRDTL-READ      03840064
P40396                                                                  03850064
P40396*GET THE VALUE OF 'ID ' SEGMENT.                                  03860064
P40396         PERFORM 1500-SELECT-XFER-ID-RECORD                       03870064
P40396                                                                  03880064
P40396*GET THE VALUE OF 'TD5' SEGMENT.                                  03890064
P40396         PERFORM 1600-SELECT-XFER-TD5-RECORD                      03900064
P40396                                                                  03910064
P40396*GET THE VALUE OF 'PRF' SEGMENT.                                  03920064
P40396         PERFORM 1700-SELECT-XFER-PRF-RECORD                      03930064
P40396                                                                  03940064
P40396*GET NEXT 'CNTL' RECORD.                                          03950064
P40396         PERFORM 1300-FETCH-ERR-CNTL-CURSOR                       03960064
P40396                                                                  03970064
P40396     END-PERFORM.                                                 03980064
P40396                                                                  03990064
P40396*CLOSE THE 'CNTL' CURSOR.                                         04000064
P40396     PERFORM 1400-CLOSE-ERR-CNTL-CURSOR.                          04010064
P40396                                                                  04020064
P40396******************************************************************04030064
P40396 1200-OPEN-ERR-CNTL-CURSOR.                                       04040064
P40396                                                                  04050064
P40396     EXEC SQL                                                     04060064
P40396         OPEN ERR-CNTL-CSR                                        04070064
P40396     END-EXEC.                                                    04080064
P40396                                                                  04090064
P40396     EVALUATE TRUE                                                04100064
P40396       WHEN SQLCODE = ZERO                                        04110064
P40396           SET PS-END-OF-ERR-CNTL-CSR-NO                          04120064
P40396                                     TO TRUE                      04130064
P40396                                                                  04140064
P40396       WHEN OTHER                                                 04150064
P40396           MOVE '1200-OPEN-ERR-CNTL-CURSOR'                       04160064
P40396                                     TO PV-ABEND-PARAGRAPH        04170064
P40396           MOVE 'OPEN ERR-CNTL-CSR ' TO PV-ABEND-OPERATION        04180064
P40396           PERFORM 9900-DB2-ABEND                                 04190064
P40396     END-EVALUATE.                                                04200064
P40396                                                                  04210064
P40396******************************************************************04220064
P40396 1300-FETCH-ERR-CNTL-CURSOR.                                      04230064
P40396                                                                  04240064
P40396     INITIALIZE PV-RETRY-COUNTER.                                 04250064
P40396                                                                  04260064
P40396     PERFORM WITH TEST AFTER                                      04270064
P40396       UNTIL SQLCODE = ZERO OR SQLCODE = +100                     04280064
P40396         OR PV-RETRY-COUNTER > PC-MAX-RETRIES                     04290064
P40396                                                                  04300064
P40396         EXEC SQL                                                 04310064
P40396             FETCH ERR-CNTL-CSR                                   04320064
P40396             INTO :SNT00000-DAT-XFER-CNTL-ID                      04330064
P40396         END-EXEC                                                 04340064
P40396                                                                  04350064
P40396         EVALUATE TRUE                                            04360064
P40396           WHEN SQLCODE = +100                                    04370064
P40396               SET PS-END-OF-ERR-CNTL-CSR-YES                     04380064
P40396                                     TO TRUE                      04390064
P40396                                                                  04400064
P40396           WHEN SQLCODE = ZERO                                    04410064
P40396               CONTINUE                                           04420064
P40396                                                                  04430064
P40396           WHEN SQLCODE = -904                                    04440064
P40396           WHEN SQLCODE = -911                                    04450064
P40396           WHEN SQLCODE = -913                                    04460064
P40396               ADD +1                TO PV-RETRY-COUNTER          04470064
P40396                                                                  04480064
P40396           WHEN OTHER                                             04490064
P40396               MOVE '1300-FETCH-ERR-CNTL-CURSOR'                  04500064
P40396                                     TO PV-ABEND-PARAGRAPH        04510064
P40396               MOVE 'FETCH ERR-CNTL-CSR '                         04520064
P40396                                     TO PV-ABEND-OPERATION        04530064
P40396               PERFORM 9900-DB2-ABEND                             04540064
P40396         END-EVALUATE                                             04550064
P40396     END-PERFORM.                                                 04560064
P40396                                                                  04570064
P40396     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         04580064
P40396         MOVE '1300-FETCH-ERR-CNTL-CURSOR'                        04590064
P40396                                     TO PV-ABEND-PARAGRAPH        04600064
P40396         MOVE 'RETRY SNT_DAT_CNTL'   TO PV-ABEND-OPERATION        04610064
P40396         MOVE DCLSNT00000            TO PV-DB2-OPERATION-MESSAGE-104620064
P40396         PERFORM 9900-DB2-ABEND                                   04630064
P40396     END-IF.                                                      04640064
P40396                                                                  04650064
P40396******************************************************************04660064
P40396 1400-CLOSE-ERR-CNTL-CURSOR.                                      04670064
P40396                                                                  04680064
P40396     EXEC SQL                                                     04690064
P40396         CLOSE ERR-CNTL-CSR                                       04700064
P40396     END-EXEC.                                                    04710064
P40396                                                                  04720064
P40396     EVALUATE TRUE                                                04730064
P40396       WHEN SQLCODE = ZERO                                        04740064
P40396           CONTINUE                                               04750064
P40396                                                                  04760064
P40396       WHEN OTHER                                                 04770064
P40396           MOVE '1400-CLOSE-ERR-CNTL-CURSOR'                      04780064
P40396                                     TO PV-ABEND-PARAGRAPH        04790064
P40396           MOVE 'CLOSE ERR-CNTL-CSR' TO PV-ABEND-OPERATION        04800064
P40396           PERFORM 9900-DB2-ABEND                                 04810064
P40396     END-EVALUATE.                                                04820064
P40396                                                                  04830064
P40396******************************************************************04840064
P40396 1500-SELECT-XFER-ID-RECORD.                                      04850064
P40396                                                                  04860064
P40396     INITIALIZE PV-RETRY-COUNTER.                                 04870064
P40396                                                                  04880064
P40396     PERFORM WITH TEST AFTER                                      04890064
P40396       UNTIL SQLCODE = ZERO OR SQLCODE = +100                     04900064
P40396         OR PV-RETRY-COUNTER > PC-MAX-RETRIES                     04910064
P40396                                                                  04920064
P40396         EXEC SQL                                                 04930064
P40396            SELECT LOD_DAT_TXT                                    04940064
P40396               INTO :SNT00001-LOD-DAT-TXT                         04950064
P40396            FROM SNT_DAT_XFER                                     04960064
P40396            WHERE  DAT_XFER_CNTL_ID   = :SNT00000-DAT-XFER-CNTL-ID04970064
P40396            AND    DAT_CTG_CDE        = 'ID '                     04980064
P40396         END-EXEC                                                 04990064
P40396                                                                  05000064
P40396         EVALUATE TRUE                                            05010064
P40396             WHEN SQLCODE = ZERO                                  05020064
P40396                 MOVE SNT00001-LOD-DAT-TXT-TEXT                   05030064
P40396                                     TO                           05040064
P40396                                      TR063-SHIP-NOTICE-DTL-RECORD05050064
P40396                 MOVE TR063-ISA-CNTL-NBR                          05060064
P40396                                     TO TR063-ISA-CNTL-NBR-SEQ-ID 05070064
P40396                 MOVE TR063-BSN02-SHIPT-ID                        05080064
P40396                                     TO TR063-SHIPT-ID-SEQ-ID     05090064
P40396                 MOVE SNT00000-DAT-XFER-CNTL-ID                   05100064
P40396                                     TO TR063-DAT-XFER-CNTL-ID    05110064
P40396                 ADD +1              TO PA-TOTAL-ERRDTL-WRITE     05120064
P40396                 PERFORM 7000-WRITE-OUTPUT-RECORD                 05130064
P40396                                                                  05140064
P40396             WHEN SQLCODE = 100                                   05150064
P40396                 MOVE 'NO ID SEGMENT FOUND FOR CONTROL ID :  '    05160064
P40396                                     TO PV-RECORD-MESSAGE         05170064
P40396                 MOVE SNT00000-DAT-XFER-CNTL-ID                   05180064
P40396                                     TO PV-DAT-XFER-CNTL-ID       05190064
P40396                 MOVE PV-RECORD-VARIABLES                         05200064
P40396                                     TO                           05210064
P40396                                      TR063-SHIP-NOTICE-DTL-RECORD05220064
P40396                 ADD +1              TO PA-TOTAL-ERRDTL-WRITE     05230064
P40396                 PERFORM 7000-WRITE-OUTPUT-RECORD                 05240064
P40396                                                                  05250064
P40396             WHEN SQLCODE = -904                                  05260064
P40396             WHEN SQLCODE = -911                                  05270064
P40396             WHEN SQLCODE = -913                                  05280064
P40396                 ADD +1              TO PV-RETRY-COUNTER          05290064
P40396                                                                  05300064
P40396             WHEN OTHER                                           05310064
P40396                 MOVE '1500-SELECT-XFER-ID-RECORD'                05320064
P40396                                     TO PV-ABEND-PARAGRAPH        05330064
P40396                 MOVE 'SELECT XFER ID RECORD'                     05340064
P40396                                     TO PV-ABEND-OPERATION        05350064
P40396             PERFORM 9900-DB2-ABEND                               05360064
P40396         END-EVALUATE                                             05370064
P40396     END-PERFORM.                                                 05380064
P40396                                                                  05390064
P40396     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         05400064
P40396         MOVE '1500-SELECT-XFER-ID-RECORD'                        05410064
P40396                                     TO PV-ABEND-PARAGRAPH        05420064
P40396         MOVE 'RETRY SNT_DAT_XFER'   TO PV-ABEND-OPERATION        05430064
P40396         MOVE DCLSNT00001            TO PV-DB2-OPERATION-MESSAGE-105440064
P40396         PERFORM 9900-DB2-ABEND                                   05450064
P40396     END-IF.                                                      05460064
P40396                                                                  05470064
P40396******************************************************************05480064
P40396 1600-SELECT-XFER-TD5-RECORD.                                     05490064
P40396                                                                  05500064
P40396     INITIALIZE PV-RETRY-COUNTER.                                 05510064
P40396                                                                  05520064
P40396     PERFORM WITH TEST AFTER                                      05530064
P40396       UNTIL SQLCODE = ZERO OR SQLCODE = +100                     05540064
P40396         OR PV-RETRY-COUNTER > PC-MAX-RETRIES                     05550064
P40396                                                                  05560064
P40396         EXEC SQL                                                 05570064
P40396             SELECT   LOD_DAT_TXT                                 05580064
P40396             INTO  :SNT00001-LOD-DAT-TXT                          05590064
P40396             FROM   SNT_DAT_XFER                                  05600064
P40396         WHERE  DAT_XFER_CNTL_ID      = :SNT00000-DAT-XFER-CNTL-ID05610064
P40396           AND  DAT_CTG_CDE           = 'TD5'                     05620064
P40396         END-EXEC                                                 05630064
P40396                                                                  05640064
P40396         EVALUATE TRUE                                            05650064
P40396           WHEN SQLCODE = ZERO                                    05660064
P40396               MOVE SNT00001-LOD-DAT-TXT-TEXT                     05670064
P40396                                     TO                           05680064
P40396                                      TR063-SHIP-NOTICE-DTL-RECORD05690064
P40396               MOVE TR063-ISA-CNTL-NBR                            05700064
P40396                                     TO TR063-ISA-CNTL-NBR-SEQ-TD505710064
P40396               MOVE TR063-BSN02-SHIPT-ID                          05720064
P40396                                     TO TR063-SHIPT-ID-SEQ-TD5    05730064
P40396               MOVE SNT00000-DAT-XFER-CNTL-ID                     05740064
P40396                                     TO TR063-DAT-XFER-CNTL-TD5   05750064
P40396               PERFORM 7000-WRITE-OUTPUT-RECORD                   05760064
P40396                                                                  05770064
P40396           WHEN SQLCODE = 100                                     05780064
P40396               MOVE 'NO TD5 SEGMENT FOUND FOR CONTROL ID:  '      05790064
P40396                                     TO PV-RECORD-MESSAGE         05800064
P40396               MOVE SNT00000-DAT-XFER-CNTL-ID                     05810064
P40396                                     TO PV-DAT-XFER-CNTL-ID       05820064
P40396               MOVE PV-RECORD-VARIABLES                           05830064
P40396                                     TO                           05840064
P40396                                      TR063-SHIP-NOTICE-DTL-RECORD05850064
P40396               PERFORM 7000-WRITE-OUTPUT-RECORD                   05860064
P40396                                                                  05870064
P40396           WHEN SQLCODE = -904                                    05880064
P40396           WHEN SQLCODE = -911                                    05890064
P40396           WHEN SQLCODE = -913                                    05900064
P40396               ADD +1 TO PV-RETRY-COUNTER                         05910064
P40396                                                                  05920064
P40396           WHEN OTHER                                             05930064
P40396               MOVE '1600-SELECT-XFER-TD5-RECORD'                 05940064
P40396                                     TO PV-ABEND-PARAGRAPH        05950064
P40396               MOVE 'SELECT XFER RECORDS'                         05960064
P40396                                     TO PV-ABEND-OPERATION        05970064
P40396               PERFORM 9900-DB2-ABEND                             05980064
P40396         END-EVALUATE                                             05990064
P40396     END-PERFORM.                                                 06000064
P40396                                                                  06010064
P40396     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         06020064
P40396         MOVE '1600-SELECT-XFER-TD5-RECORD'                       06030064
P40396                                     TO PV-ABEND-PARAGRAPH        06040064
P40396         MOVE 'RETRY SNT_DAT_XFER'   TO PV-ABEND-OPERATION        06050064
P40396         MOVE DCLSNT00001            TO PV-DB2-OPERATION-MESSAGE-106060064
P40396         PERFORM 9900-DB2-ABEND                                   06070064
P40396     END-IF.                                                      06080064
P40396                                                                  06090064
P40396******************************************************************06100064
P40396 1700-SELECT-XFER-PRF-RECORD.                                     06110064
P40396                                                                  06120064
P40396     PERFORM 1710-OPEN-PRF-PO-NBR-CURSOR.                         06130064
P40396                                                                  06140064
P40396     PERFORM                                                      06150064
P40396       UNTIL PS-END-OF-PRF-PO-NBR-CSR-YES                         06160064
P40396                                                                  06170064
P40396          PERFORM 1720-FETCH-PRF-PO-NBR-CURSOR                    06180064
P40396                                                                  06190064
P40396     END-PERFORM                                                  06200064
P40396                                                                  06210064
P40396     PERFORM 1730-CLOSE-PRF-PO-NBR-CURSOR.                        06220064
P40396                                                                  06230064
P40396******************************************************************06240064
P40396 1710-OPEN-PRF-PO-NBR-CURSOR.                                     06250064
P40396                                                                  06260064
P40396     EXEC SQL                                                     06270064
P40396         OPEN PRF-PO-NBR-CSR                                      06280064
P40396     END-EXEC.                                                    06290064
P40396                                                                  06300064
P40396     EVALUATE TRUE                                                06310064
P40396       WHEN SQLCODE = ZERO                                        06320064
P40396           SET PS-END-OF-PRF-PO-NBR-CSR-NO                        06330064
P40396                                     TO TRUE                      06340064
P40396                                                                  06350064
P40396       WHEN OTHER                                                 06360064
P40396           MOVE '1710-OPEN-PRF-PO-NBR-CURSOR'                     06370064
P40396                                     TO PV-ABEND-PARAGRAPH        06380064
P40396           MOVE 'OPEN PRF-PO-NBR-CSR'                             06390064
P40396                                     TO PV-ABEND-OPERATION        06400064
P40396           PERFORM 9900-DB2-ABEND                                 06410064
P40396     END-EVALUATE.                                                06420064
P40396                                                                  06430064
P40396******************************************************************06440064
P40396 1720-FETCH-PRF-PO-NBR-CURSOR.                                    06450064
P40396                                                                  06460064
P40396     INITIALIZE PV-RETRY-COUNTER.                                 06470064
P40396                                                                  06480064
P40396     PERFORM WITH TEST AFTER                                      06490064
P40396       UNTIL SQLCODE = ZERO OR SQLCODE = +100                     06500064
P40396         OR PV-RETRY-COUNTER > PC-MAX-RETRIES                     06510064
P40396                                                                  06520064
P40396         EXEC SQL                                                 06530064
P40396             FETCH PRF-PO-NBR-CSR                                 06540064
P40396              INTO :SNT00001-DAT-XFER-CNTL-ID                     06550064
P40396                ,  :SNT00001-LOD-DAT-TXT                          06560064
P40396         END-EXEC                                                 06570064
P40396                                                                  06580064
P40396         EVALUATE TRUE                                            06590064
P40396           WHEN SQLCODE = +100                                    06600064
P40396               SET PS-END-OF-PRF-PO-NBR-CSR-YES                   06610064
P40396                                     TO TRUE                      06620064
P40396               IF PS-PRF-SEGMENT-FOUND-NO                         06630064
P40396                   MOVE 'NO PRF SEGMENT FOUND FOR CONTROL ID:  '  06640064
P40396                                     TO PV-RECORD-MESSAGE         06650064
P40396                   MOVE SNT00000-DAT-XFER-CNTL-ID                 06660064
P40396                                     TO PV-DAT-XFER-CNTL-ID       06670064
P40396                   MOVE PV-RECORD-VARIABLES                       06680064
P40396                                     TO                           06690064
P40396                                      TR063-SHIP-NOTICE-DTL-RECORD06700064
P40396                   PERFORM 7000-WRITE-OUTPUT-RECORD               06710064
P40396               END-IF                                             06720064
P40396                                                                  06730064
P40396           WHEN SQLCODE = ZERO                                    06740064
P40396               SET PS-PRF-SEGMENT-FOUND-YES                       06750064
P40396                                     TO TRUE                      06760064
P40396               MOVE SNT00001-LOD-DAT-TXT-TEXT                     06770064
P40396                                     TO                           06780064
P40396                                      TR063-SHIP-NOTICE-DTL-RECORD06790064
P40396               MOVE TR063-ISA-CNTL-NBR                            06800064
P40396                                     TO TR063-ISA-CNTL-NBR-SEQ-PRF06810064
P40396               MOVE TR063-BSN02-SHIPT-ID                          06820064
P40396                                     TO TR063-SHIPT-ID-SEQ-PRF    06830064
P40396               MOVE SNT00000-DAT-XFER-CNTL-ID                     06840064
P40396                                     TO TR063-DAT-XFER-CNTL-PRF   06850064
P40396               PERFORM 7000-WRITE-OUTPUT-RECORD                   06860064
P40396                                                                  06870064
P40396           WHEN SQLCODE = -904                                    06880065
P40396           WHEN SQLCODE = -911                                    06881065
P40396           WHEN SQLCODE = -913                                    06890064
P40396               ADD +1                TO PV-RETRY-COUNTER          06900064
P40396                                                                  06910064
P40396           WHEN OTHER                                             06920064
P40396               MOVE '1720-FETCH-PRF-PO-NBR-CURSOR'                06930064
P40396                                     TO PV-ABEND-PARAGRAPH        06940064
P40396               MOVE 'FETCH PRF-PO-NBR-CSR'                        06950064
P40396                                     TO PV-ABEND-OPERATION        06960064
P40396               PERFORM 9900-DB2-ABEND                             06970064
P40396         END-EVALUATE                                             06980064
P40396     END-PERFORM.                                                 06990064
P40396                                                                  07000064
P40396     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         07010064
P40396         MOVE '1720-FETCH-PRF-PO-NBR-CURSOR'                      07020064
P40396                                     TO PV-ABEND-PARAGRAPH        07030064
P40396         MOVE 'RETRY SNT_DAT_XFER'   TO PV-ABEND-OPERATION        07040064
P40396         MOVE DCLSNT00001            TO PV-DB2-OPERATION-MESSAGE-107050064
P40396         PERFORM 9900-DB2-ABEND                                   07060064
P40396     END-IF.                                                      07070064
P40396                                                                  07080064
P40396******************************************************************07090064
P40396 1730-CLOSE-PRF-PO-NBR-CURSOR.                                    07100064
P40396                                                                  07110064
P40396     EXEC SQL                                                     07120064
P40396         CLOSE PRF-PO-NBR-CSR                                     07130064
P40396     END-EXEC.                                                    07140064
P40396                                                                  07150064
P40396     EVALUATE TRUE                                                07160064
P40396       WHEN SQLCODE = ZERO                                        07170064
P40396           CONTINUE                                               07180064
P40396                                                                  07190064
P40396       WHEN OTHER                                                 07200064
P40396           MOVE '1730-CLOSE-PRF-PO-NBR-CURSOR'                    07210064
P40396                                     TO PV-ABEND-PARAGRAPH        07220064
P40396           MOVE 'CLOSE PRF-PO-NBR-CSR'                            07230064
P40396                                     TO PV-ABEND-OPERATION        07240064
P40396           PERFORM 9900-DB2-ABEND                                 07250064
P40396     END-EVALUATE.                                                07260064
P40396                                                                  07270064
030500******************************************************************07280064
030600*                                                                *07290064
030700*      P R O C E S S   C O M P L E T E D   R E C O R D S         *07300064
030800*                                                                *07310064
030900******************************************************************07320064
031000 2000-PROCESS-CMPLTD-RECORDS.                                     07330064
031100     DISPLAY '2000-PROCESS-CMPLTD-RECORDS'.                       07340064
031200                                                                  07350064
031300     PERFORM 2100-OPEN-CNTL-CURSOR.                               07360064
031400                                                                  07370064
031500     PERFORM 2200-FETCH-CNTL-CURSOR.                              07380064
031600                                                                  07390064
031700     IF PS-END-OF-CNTL-CSR-YES                                    07400064
031800         DISPLAY ' '                                              07410064
031900         DISPLAY '*************************************'          07420064
032000         DISPLAY '**    NO COMPLETED TRANSACTIONS    **'          07430064
032100         DISPLAY '**      FOUND ON SNT_DAT_CNTL      **'          07440064
032200         DISPLAY '*************************************'          07450064
032300         DISPLAY ' '                                              07460064
032400     END-IF.                                                      07470064
032500                                                                  07480064
032600*PROCESS COMPLETED TRANSACTIONS.                                  07490064
032700     PERFORM                                                      07500064
032800       UNTIL PS-END-OF-CNTL-CSR-YES                               07510064
032900                                                                  07520064
033000*INCREMENT COUNTER OF CNTL RECORDS READ.                          07530064
033100         ADD +1 TO PA-TOTAL-CNTL-READ                             07540064
033200                                                                  07550064
033300*DELETE 'XFER' RECORDS ASSOCIATED WITH THE 'CNTL' RECORD.         07560064
033400         PERFORM 3000-DELETE-XFER-RECORDS                         07570064
033500                                                                  07580064
033600*DELETE 'CNTL' RECORD.                                            07590064
033700         PERFORM 2400-DELETE-CNTL                                 07600064
033800         DISPLAY ' ROW DELETED FOR ' SNT00000-DAT-XFER-CNTL-ID    07610064
033900                               ' / ' SNT00000-CRE-TMST            07620064
034000                                                                  07630064
034100*COMMIT THE DATA.                                                 07640064
034200         PERFORM 2800-COMMIT                                      07650064
034300                                                                  07660064
034400*GET NEXT 'CNTL' RECORD.                                          07670064
034500         PERFORM 2200-FETCH-CNTL-CURSOR                           07680064
034600                                                                  07690064
034700     END-PERFORM.                                                 07700064
034800                                                                  07710064
034900*CLOSE THE 'CNTL' CURSOR.                                         07720064
035000     PERFORM 2500-CLOSE-CNTL-CURSOR.                              07730064
035100                                                                  07740064
035200******************************************************************07750064
035300 2100-OPEN-CNTL-CURSOR.                                           07760064
035400                                                                  07770064
035500     EXEC SQL                                                     07780064
035600         OPEN CNTL-CSR                                            07790064
035700     END-EXEC.                                                    07800064
035800                                                                  07810064
035900     EVALUATE TRUE                                                07820064
036000       WHEN SQLCODE = ZERO                                        07830064
036100           SET PS-END-OF-CNTL-CSR-NO TO TRUE                      07840064
036200                                                                  07850064
036300       WHEN OTHER                                                 07860064
036400           MOVE '2100-OPEN-CNTL-CURSOR'                           07870064
036500                                 TO PV-ABEND-PARAGRAPH            07880064
036600           MOVE 'OPEN CNTL-CSR ' TO PV-ABEND-OPERATION            07890064
036700           PERFORM 9900-DB2-ABEND                                 07900064
036800     END-EVALUATE.                                                07910064
036900                                                                  07920064
037000******************************************************************07930064
037100 2200-FETCH-CNTL-CURSOR.                                          07940064
037200                                                                  07950064
037300     EXEC SQL                                                     07960064
037400         FETCH CNTL-CSR                                           07970064
037500          INTO :SNT00000-DAT-XFER-CNTL-ID                         07980064
037600             , :SNT00000-CRE-TMST                                 07990064
037700             , :SNT00000-STAT-CDE                                 08000064
037800             , :SNT00000-END-PRC-TMST                             08010064
037810             , :SNT00000-ASN-TYP-CDE                              08020064
037900     END-EXEC.                                                    08030064
038000                                                                  08040064
038100     EVALUATE TRUE                                                08050064
038200       WHEN SQLCODE = +100                                        08060064
038300           SET PS-END-OF-CNTL-CSR-YES TO TRUE                     08070064
038400                                                                  08080064
038500       WHEN SQLCODE = ZERO                                        08090064
038600           CONTINUE                                               08100064
038700                                                                  08110064
038800       WHEN OTHER                                                 08120064
038900           MOVE '2200-FETCH-CNTL-CURSOR'                          08130064
039000                                  TO PV-ABEND-PARAGRAPH           08140064
039100           MOVE 'FETCH CNTL-CSR ' TO PV-ABEND-OPERATION           08150064
039200           PERFORM 9900-DB2-ABEND                                 08160064
039300     END-EVALUATE.                                                08170064
039400                                                                  08180064
039500******************************************************************08190064
039600 2400-DELETE-CNTL.                                                08200064
039700                                                                  08210064
039800     EXEC SQL                                                     08220064
039900         DELETE FROM SNT_DAT_CNTL                                 08230064
040000          WHERE DAT_XFER_CNTL_ID = :SNT00000-DAT-XFER-CNTL-ID     08240064
040100            AND CRE_TMST         = :SNT00000-CRE-TMST             08250064
040200            AND STAT_CDE         = :SNT00000-STAT-CDE             08260064
040300            AND END_PRC_TMST     = :SNT00000-END-PRC-TMST         08270064
040310            AND ASN_TYP_CDE      = :SNT00000-ASN-TYP-CDE          08280064
040400     END-EXEC.                                                    08290064
040500                                                                  08300064
040600     EVALUATE TRUE                                                08310064
040700       WHEN SQLCODE = ZERO                                        08320064
040800           ADD +1 TO PA-TOTAL-CNTL-DELETED                        08330064
040900                                                                  08340064
041000       WHEN OTHER                                                 08350064
041100           MOVE '2400-DELETE-CNTL'    TO PV-ABEND-PARAGRAPH       08360064
041200           MOVE 'DELETE SNT_DAT_CNTL' TO PV-ABEND-OPERATION       08370064
041300           MOVE DCLSNT00000 TO PV-DB2-OPERATION-MESSAGE-1         08380064
041400           PERFORM 9900-DB2-ABEND                                 08390064
041500     END-EVALUATE.                                                08400064
041600                                                                  08410064
041700******************************************************************08420064
041800 2500-CLOSE-CNTL-CURSOR.                                          08430064
041900                                                                  08440064
042000     EXEC SQL                                                     08450064
042100         CLOSE CNTL-CSR                                           08460064
042200     END-EXEC.                                                    08470064
042300                                                                  08480064
042400     EVALUATE TRUE                                                08490064
042500       WHEN SQLCODE = ZERO                                        08500064
042600           CONTINUE                                               08510064
042700                                                                  08520064
042800       WHEN OTHER                                                 08530064
042900           MOVE '2500-CLOSE-CNTL-CURSOR'                          08540064
043000                                  TO PV-ABEND-PARAGRAPH           08550064
043100           MOVE 'CLOSE CNTL-CSR ' TO PV-ABEND-OPERATION           08560064
043200           PERFORM 9900-DB2-ABEND                                 08570064
043300     END-EVALUATE.                                                08580064
043400                                                                  08590064
043500******************************************************************08600064
043600 2800-COMMIT.                                                     08610064
043700                                                                  08620064
043800     EXEC SQL                                                     08630064
043900         COMMIT                                                   08640064
044000     END-EXEC.                                                    08650064
044100                                                                  08660064
044200     EVALUATE TRUE                                                08670064
044300       WHEN SQLCODE = ZERO                                        08680064
044400           CONTINUE                                               08690064
044500                                                                  08700064
044600       WHEN OTHER                                                 08710064
044700           MOVE '2800-COMMIT'        TO PV-ABEND-PARAGRAPH        08720064
044800           MOVE 'COMMIT LOAD TABLES' TO PV-ABEND-OPERATION        08730064
044900           PERFORM 9900-DB2-ABEND                                 08740064
045000     END-EVALUATE.                                                08750064
045100                                                                  08760064
045200******************************************************************08770064
045300******************************************************************08780064
045400 3000-DELETE-XFER-RECORDS.                                        08790064
045500                                                                  08800064
045600     PERFORM 3100-OPEN-XFER-CURSOR.                               08810064
045700                                                                  08820064
045800     PERFORM                                                      08830064
045900       UNTIL PS-END-OF-XFER-CSR-YES                               08840064
046000                                                                  08850064
046100          PERFORM 3200-PROCESS-XFER-ROWS                          08860064
046200                                                                  08870064
046300     END-PERFORM.                                                 08880064
046400                                                                  08890064
046500     PERFORM 3300-CLOSE-XFER-CURSOR.                              08900064
046600                                                                  08910064
046700******************************************************************08920064
046800 3100-OPEN-XFER-CURSOR.                                           08930064
046900                                                                  08940064
047000     EXEC SQL                                                     08950064
047100         OPEN XFER-CSR                                            08960064
047200     END-EXEC.                                                    08970064
047300                                                                  08980064
047400     EVALUATE TRUE                                                08990064
047500       WHEN SQLCODE = ZERO                                        09000064
047600           SET PS-END-OF-XFER-CSR-NO TO TRUE                      09010064
047700                                                                  09020064
047800       WHEN OTHER                                                 09030064
047900           MOVE '3100-OPEN-XFER-CURSOR'                           09040064
048000                                 TO PV-ABEND-PARAGRAPH            09050064
048100           MOVE 'OPEN XFER-CSR ' TO PV-ABEND-OPERATION            09060064
048200           PERFORM 9900-DB2-ABEND                                 09070064
048300     END-EVALUATE.                                                09080064
048400                                                                  09090064
048500******************************************************************09100064
048600 3200-PROCESS-XFER-ROWS.                                          09110064
048700                                                                  09120064
048800     EXEC SQL                                                     09130064
048900         FETCH XFER-CSR                                           09140064
049000          INTO :SNT00001-DAT-XFER-CNTL-ID                         09150064
049100             , :SNT00001-PRC-LOD-SEQ-NBR                          09160064
049200             , :SNT00001-DAT-CTG-CDE                              09170064
049300             , :SNT00001-LOD-DAT-TXT                              09180064
049400     END-EXEC.                                                    09190064
049500                                                                  09200064
049600     EVALUATE TRUE                                                09210064
049700       WHEN SQLCODE = +100                                        09220064
049800           SET PS-END-OF-XFER-CSR-YES TO TRUE                     09230064
049900                                                                  09240064
050000       WHEN SQLCODE = ZERO                                        09250064
050100           PERFORM 3210-DELETE-XFER-ROW                           09260064
050200                                                                  09270064
050300       WHEN OTHER                                                 09280064
050400           MOVE '3200-PROCESS-XFER-ROWS' TO PV-ABEND-PARAGRAPH    09290064
050500           MOVE 'FETCH XFER ROW'         TO PV-ABEND-OPERATION    09300064
050600           PERFORM 9900-DB2-ABEND                                 09310064
050700     END-EVALUATE.                                                09320064
050800                                                                  09330064
050900******************************************************************09340064
051000 3210-DELETE-XFER-ROW.                                            09350064
051100                                                                  09360064
051200     INITIALIZE PV-RETRY-COUNTER.                                 09370064
051300                                                                  09380064
051400     PERFORM WITH TEST AFTER                                      09390064
051500       UNTIL SQLCODE = ZERO OR SQLCODE = +100                     09400064
051600         OR PV-RETRY-COUNTER > PC-MAX-RETRIES                     09410064
051700                                                                  09420064
051800         EXEC SQL                                                 09430064
051900             DELETE FROM SNT_DAT_XFER                             09440064
052000             WHERE CURRENT OF XFER-CSR                            09450064
052100         END-EXEC                                                 09460064
052200                                                                  09470064
052300         EVALUATE TRUE                                            09480064
052400           WHEN SQLCODE = ZERO                                    09490064
052500               ADD +1 TO PA-TOTAL-XFER-DELETED                    09500064
052600                         PV-COMMIT-COUNT-XFER                     09510064
052700               IF PV-COMMIT-COUNT-XFER > 999                      09520064
052800                   DISPLAY '  3210-COMMIT-XFER = '                09530064
052900                            PV-COMMIT-COUNT-XFER                  09540064
053000                   PERFORM 2800-COMMIT                            09550064
053100                   PERFORM 3100-OPEN-XFER-CURSOR                  09560064
053200                   MOVE ZEROES TO PV-COMMIT-COUNT-XFER            09570064
053300               END-IF                                             09580064
053400                                                                  09590064
053500           WHEN SQLCODE = -911                                    09600064
053600           WHEN SQLCODE = -913                                    09610064
053700               ADD +1 TO PV-RETRY-COUNTER                         09620064
053800                                                                  09630064
053900           WHEN OTHER                                             09640064
054000               MOVE '3210-DELETE-XFER-ROW' TO PV-ABEND-PARAGRAPH  09650064
054100               MOVE 'DELETE SNT_DAT_XFER'  TO PV-ABEND-OPERATION  09660064
054200               MOVE DCLSNT00001    TO PV-DB2-OPERATION-MESSAGE-1  09670064
054300               PERFORM 9900-DB2-ABEND                             09680064
054400         END-EVALUATE                                             09690064
054500     END-PERFORM.                                                 09700064
054600                                                                  09710064
054700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         09720064
054800         MOVE '3210-DELETE-XFER-ROW' TO PV-ABEND-PARAGRAPH        09730064
054900         MOVE 'RETRY SNT_DAT_XFER'   TO PV-ABEND-OPERATION        09740064
055000         MOVE DCLSNT00001            TO PV-DB2-OPERATION-MESSAGE-109750064
055100         PERFORM 9900-DB2-ABEND                                   09760064
055200     END-IF.                                                      09770064
055300                                                                  09780064
055400******************************************************************09790064
055500 3300-CLOSE-XFER-CURSOR.                                          09800064
055600                                                                  09810064
055700     EXEC SQL                                                     09820064
055800         CLOSE XFER-CSR                                           09830064
055900     END-EXEC.                                                    09840064
056000                                                                  09850064
056100     EVALUATE TRUE                                                09860064
056200       WHEN SQLCODE = ZERO                                        09870064
056300           CONTINUE                                               09880064
056400                                                                  09890064
056500       WHEN OTHER                                                 09900064
056600           MOVE '3300-CLOSE-XFER-CURSOR'                          09910064
056700                                  TO PV-ABEND-PARAGRAPH           09920064
056800           MOVE 'CLOSE XFER-CSR ' TO PV-ABEND-OPERATION           09930064
056900           PERFORM 9900-DB2-ABEND                                 09940064
057000     END-EVALUATE.                                                09950064
057100                                                                  09960064
057200******************************************************************09970064
057300*                                                                *09980064
057400*        P R O C E S S   W E E K   O L D   R E C O R D S         *09990064
057500*                                                                *10000064
057600******************************************************************10010064
057700 4000-PROCESS-7DAY-RECORDS.                                       10020064
057800     DISPLAY '4000-PROCESS-7DAY-RECORDS'.                         10030064
057900                                                                  10040064
058000     PERFORM 4100-OPEN-CNTL7-CURSOR.                              10050064
058100                                                                  10060064
058200     PERFORM 4200-FETCH-CNTL7-CURSOR.                             10070064
058300                                                                  10080064
058400     IF PS-END-OF-CNTL7-CSR-YES                                   10090064
058500         DISPLAY ' '                                              10100064
058600         DISPLAY '*************************************'          10110064
058700         DISPLAY '**     NO WEEK OLD TRANSACTIONS    **'          10120064
058800         DISPLAY '**      FOUND ON SNT_DAT_CNTL      **'          10130064
058900         DISPLAY '*************************************'          10140064
059000         DISPLAY ' '                                              10150064
059100     END-IF.                                                      10160064
059200                                                                  10170064
059300*PROCESS WEEK OLD TRANSACTIONS.                                   10180064
059400     PERFORM                                                      10190064
059500       UNTIL PS-END-OF-CNTL7-CSR-YES                              10200064
059600                                                                  10210064
059700*DELETE 'XFER' RECORDS ASSOCIATED WITH THE 'CNTL' RECORD.         10220064
059800         PERFORM 5000-DELETE-XFER7-RECORDS                        10230064
059900                                                                  10240064
060000*DELETE 'CNTL' RECORD.                                            10250064
060100         PERFORM 4400-DELETE-CNTL7                                10260064
060200         DISPLAY ' ROW DELETED FOR ' SNT00000-DAT-XFER-CNTL-ID    10270064
060300                               ' / ' SNT00000-CRE-TMST            10280064
060400                                                                  10290064
060500*COMMIT THE DATA.                                                 10300064
060600         PERFORM 2800-COMMIT                                      10310064
060700                                                                  10320064
060800*GET NEXT 'CNTL' RECORD.                                          10330064
060900         PERFORM 4200-FETCH-CNTL7-CURSOR                          10340064
061000                                                                  10350064
061100     END-PERFORM.                                                 10360064
061200                                                                  10370064
061300*CLOSE THE 'CNTL' CURSOR.                                         10380064
061400     PERFORM 4300-CLOSE-CNTL7-CURSOR.                             10390064
061500                                                                  10400064
061600******************************************************************10410064
061700 4100-OPEN-CNTL7-CURSOR.                                          10420064
061800                                                                  10430064
061900     EXEC SQL                                                     10440064
062000         OPEN CNTL7-CSR                                           10450064
062100     END-EXEC.                                                    10460064
062200                                                                  10470064
062300     EVALUATE TRUE                                                10480064
062400       WHEN SQLCODE = ZERO                                        10490064
062500           SET PS-END-OF-CNTL7-CSR-NO    TO TRUE                  10500064
062600                                                                  10510064
062700       WHEN OTHER                                                 10520064
062800           MOVE '4100-OPEN-CNTL7-CURSOR' TO PV-ABEND-PARAGRAPH    10530064
062900           MOVE 'OPEN CNTL7-CSR '        TO PV-ABEND-OPERATION    10540064
063000           PERFORM 9900-DB2-ABEND                                 10550064
063100     END-EVALUATE.                                                10560064
063200                                                                  10570064
063300******************************************************************10580064
063400 4200-FETCH-CNTL7-CURSOR.                                         10590064
063500                                                                  10600064
063600     EXEC SQL                                                     10610064
063700         FETCH CNTL7-CSR                                          10620064
063800          INTO :SNT00000-DAT-XFER-CNTL-ID                         10630064
063900             , :SNT00000-CRE-TMST                                 10640064
064000             , :SNT00000-STAT-CDE                                 10650064
064100             , :SNT00000-END-PRC-TMST                             10660064
064110             , :SNT00000-ASN-TYP-CDE                              10670064
064200     END-EXEC.                                                    10680064
064300                                                                  10690064
064400     EVALUATE TRUE                                                10700064
064500       WHEN SQLCODE = +100                                        10710064
064600           SET PS-END-OF-CNTL7-CSR-YES TO TRUE                    10720064
064700                                                                  10730064
064800       WHEN SQLCODE = ZERO                                        10740064
064900           CONTINUE                                               10750064
065000                                                                  10760064
065100       WHEN OTHER                                                 10770064
065200           MOVE '4200-FETCH-CNTL7-CURSOR'                         10780064
065300                                    TO PV-ABEND-PARAGRAPH         10790064
065400           MOVE 'FETCH CNTL7-CSR ' TO PV-ABEND-OPERATION          10800064
065500           PERFORM 9900-DB2-ABEND                                 10810064
065600     END-EVALUATE.                                                10820064
065700                                                                  10830064
065800******************************************************************10840064
065900 4300-CLOSE-CNTL7-CURSOR.                                         10850064
066000                                                                  10860064
066100     EXEC SQL                                                     10870064
066200         CLOSE CNTL7-CSR                                          10880064
066300     END-EXEC.                                                    10890064
066400                                                                  10900064
066500     EVALUATE TRUE                                                10910064
066600       WHEN SQLCODE = ZERO                                        10920064
066700           CONTINUE                                               10930064
066800                                                                  10940064
066900       WHEN OTHER                                                 10950064
067000           MOVE '4300-CLOSE-CNTL7-CURSOR' TO PV-ABEND-PARAGRAPH   10960064
067100           MOVE 'CLOSE CNTL7-CSR '        TO PV-ABEND-OPERATION   10970064
067200           PERFORM 9900-DB2-ABEND                                 10980064
067300     END-EVALUATE.                                                10990064
067400                                                                  11000064
067500******************************************************************11010064
067600 4400-DELETE-CNTL7.                                               11020064
067700                                                                  11030064
067800     EXEC SQL                                                     11040064
067900         DELETE FROM SNT_DAT_CNTL                                 11050064
068000          WHERE DAT_XFER_CNTL_ID = :SNT00000-DAT-XFER-CNTL-ID     11060064
068100            AND CRE_TMST         = :SNT00000-CRE-TMST             11070064
068200            AND STAT_CDE         = :SNT00000-STAT-CDE             11080064
068300            AND END_PRC_TMST     = :SNT00000-END-PRC-TMST         11090064
068310            AND ASN_TYP_CDE      = :SNT00000-ASN-TYP-CDE          11100064
068400     END-EXEC.                                                    11110064
068500                                                                  11120064
068600     EVALUATE TRUE                                                11130064
068700       WHEN SQLCODE = ZERO                                        11140064
068800           ADD +1 TO PA-TOTAL-CNTL7-DELETED                       11150064
068900                                                                  11160064
069000       WHEN OTHER                                                 11170064
069100           MOVE '4400-DELETE-CNTL7'   TO PV-ABEND-PARAGRAPH       11180064
069200           MOVE 'DELETE SNT_DAT_CNTL' TO PV-ABEND-OPERATION       11190064
069300           MOVE DCLSNT00000 TO PV-DB2-OPERATION-MESSAGE-1         11200064
069400           PERFORM 9900-DB2-ABEND                                 11210064
069500     END-EVALUATE.                                                11220064
069600                                                                  11230064
069700******************************************************************11240064
069800******************************************************************11250064
069900 5000-DELETE-XFER7-RECORDS.                                       11260064
070000                                                                  11270064
070100     PERFORM 5100-OPEN-XFER7-CURSOR.                              11280064
070200                                                                  11290064
070300     PERFORM                                                      11300064
070400       UNTIL PS-END-OF-XFER7-CSR-YES                              11310064
070500                                                                  11320064
070600          PERFORM 5200-PROCESS-XFER7-ROWS                         11330064
070700                                                                  11340064
070800     END-PERFORM.                                                 11350064
070900                                                                  11360064
071000     PERFORM 5300-CLOSE-XFER7-CURSOR.                             11370064
071100                                                                  11380064
071200******************************************************************11390064
071300 5100-OPEN-XFER7-CURSOR.                                          11400064
071400                                                                  11410064
071500     EXEC SQL                                                     11420064
071600         OPEN XFER7-CSR                                           11430064
071700     END-EXEC.                                                    11440064
071800                                                                  11450064
071900     EVALUATE TRUE                                                11460064
072000       WHEN SQLCODE = ZERO                                        11470064
072100           SET PS-END-OF-XFER7-CSR-NO TO TRUE                     11480064
072200                                                                  11490064
072300       WHEN OTHER                                                 11500064
072400           MOVE '5100-OPEN-XFER7-CURSOR' TO PV-ABEND-PARAGRAPH    11510064
072500           MOVE 'OPEN XFER7-CSR '        TO PV-ABEND-OPERATION    11520064
072600           PERFORM 9900-DB2-ABEND                                 11530064
072700     END-EVALUATE.                                                11540064
072800                                                                  11550064
072900******************************************************************11560064
073000 5200-PROCESS-XFER7-ROWS.                                         11570064
073100                                                                  11580064
073200     EXEC SQL                                                     11590064
073300         FETCH XFER7-CSR                                          11600064
073400          INTO :SNT00001-DAT-XFER-CNTL-ID                         11610064
073500             , :SNT00001-PRC-LOD-SEQ-NBR                          11620064
073600             , :SNT00001-DAT-CTG-CDE                              11630064
073700             , :SNT00001-LOD-DAT-TXT                              11640064
073800     END-EXEC.                                                    11650064
073900                                                                  11660064
074000     EVALUATE TRUE                                                11670064
074100       WHEN SQLCODE = +100                                        11680064
074200           SET PS-END-OF-XFER7-CSR-YES TO TRUE                    11690064
074300                                                                  11700064
074400       WHEN SQLCODE = ZERO                                        11710064
074500           PERFORM 5210-DELETE-XFER7-ROW                          11720064
074600                                                                  11730064
074700       WHEN OTHER                                                 11740064
074800           MOVE '5200-PROCESS-XFER7-ROWS' TO PV-ABEND-PARAGRAPH   11750064
074900           MOVE 'FETCH XFER7 ROW'         TO PV-ABEND-OPERATION   11760064
075000           PERFORM 9900-DB2-ABEND                                 11770064
075100     END-EVALUATE.                                                11780064
075200                                                                  11790064
075300******************************************************************11800064
075400 5210-DELETE-XFER7-ROW.                                           11810064
075500                                                                  11820064
075600     INITIALIZE PV-RETRY-COUNTER.                                 11830064
075700                                                                  11840064
075800     PERFORM WITH TEST AFTER                                      11850064
075900       UNTIL SQLCODE = ZERO OR SQLCODE = +100                     11860064
076000          OR PV-RETRY-COUNTER > PC-MAX-RETRIES                    11870064
076100                                                                  11880064
076200         EXEC SQL                                                 11890064
076300             DELETE FROM SNT_DAT_XFER                             11900064
076400             WHERE CURRENT OF XFER7-CSR                           11910064
076500         END-EXEC                                                 11920064
076600                                                                  11930064
076700         EVALUATE TRUE                                            11940064
076800           WHEN SQLCODE = ZERO                                    11950064
076900               ADD +1 TO PA-TOTAL-XFER7-DELETED                   11960064
077000                         PV-COMMIT-COUNT-XFER                     11970064
077100               IF PV-COMMIT-COUNT-XFER > 999                      11980064
077200                   DISPLAY '  5210-COMMIT-XFER = '                11990064
077300                           PV-COMMIT-COUNT-XFER                   12000064
077400                   PERFORM 2800-COMMIT                            12010064
077500                   PERFORM 5100-OPEN-XFER7-CURSOR                 12020064
077600                   MOVE ZEROES TO PV-COMMIT-COUNT-XFER            12030064
077700               END-IF                                             12040064
077800                                                                  12050064
077900           WHEN SQLCODE = -911                                    12060064
078000           WHEN SQLCODE = -913                                    12070064
078100               ADD +1 TO PV-RETRY-COUNTER                         12080064
078200                                                                  12090064
078300           WHEN OTHER                                             12100064
078400               MOVE '5210-DELETE-XFER7-ROW' TO PV-ABEND-PARAGRAPH 12110064
078500               MOVE 'DELETE SNT_DAT_XFER'   TO PV-ABEND-OPERATION 12120064
078600               MOVE DCLSNT00001     TO PV-DB2-OPERATION-MESSAGE-1 12130064
078700               PERFORM 9900-DB2-ABEND                             12140064
078800         END-EVALUATE                                             12150064
078900     END-PERFORM.                                                 12160064
079000                                                                  12170064
079100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         12180064
079200         MOVE '5210-DELETE-XFER7-ROW' TO PV-ABEND-PARAGRAPH       12190064
079300         MOVE 'RETRY SNT_DAT_XFER'    TO PV-ABEND-OPERATION       12200064
079400         MOVE DCLSNT00001     TO PV-DB2-OPERATION-MESSAGE-1       12210064
079500         PERFORM 9900-DB2-ABEND                                   12220064
079600     END-IF.                                                      12230064
079700                                                                  12240064
079800******************************************************************12250064
079900 5300-CLOSE-XFER7-CURSOR.                                         12260064
080000                                                                  12270064
080100     EXEC SQL                                                     12280064
080200         CLOSE XFER7-CSR                                          12290064
080300     END-EXEC.                                                    12300064
080400                                                                  12310064
080500     EVALUATE TRUE                                                12320064
080600       WHEN SQLCODE = ZERO                                        12330064
080700           CONTINUE                                               12340064
080800                                                                  12350064
080900       WHEN OTHER                                                 12360064
081000           MOVE '5300-CLOSE-XFER-CURSOR' TO PV-ABEND-PARAGRAPH    12370064
081100           MOVE 'CLOSE XFER7-CSR '       TO PV-ABEND-OPERATION    12380064
081200           PERFORM 9900-DB2-ABEND                                 12390064
081300     END-EVALUATE.                                                12400064
081400                                                                  12410064
P40396******************************************************************12420064
P40396*  WRITE THE OUTPUT FILE WITH ASN DETAILS                         12430064
P40396******************************************************************12440064
P40396 7000-WRITE-OUTPUT-RECORD.                                        12450064
P40396                                                                  12460064
P40396     WRITE TR063-ERROR-ASN-DETAIL-RECORD                          12470064
P40396         FROM TR063-SHIP-NOTICE-DTL-RECORD.                       12480064
P40396                                                                  12490064
P40396     INITIALIZE TR063-SHIP-NOTICE-DTL-RECORD.                     12500064
P40396                                                                  12510064
081500******************************************************************12520064
081600*                                                                *12530064
081700*                   E O J   P R O C E S S I N G                  *12540064
081800*                                                                *12550064
081900******************************************************************12560064
082000 9000-EOJ-ROUTINE.                                                12570064
082100                                                                  12580064
P40396     CLOSE TR063-ERROR-ASN-DETAIL-FILE.                           12590064
082200     DISPLAY ' '.                                                 12600064
082300     DISPLAY '*******************************************'.       12610064
082400     DISPLAY '      * SNKUP102 SUMMARY STATISTICS *      '.       12620064
082500     DISPLAY ' '.                                                 12630064
082600     DISPLAY '      -------------------------------      '.       12640064
082700     DISPLAY '       LOAD REPOSITORY PURGE RESULTS       '.       12650064
082800     DISPLAY '      -------------------------------      '.       12660064
082900     MOVE PA-TOTAL-CNTL-READ              TO PV-DISPLAY-RECORD.   12670064
083000     DISPLAY ' CMPLTD SNT_DAT_CNTL > 3 DAYS = '                   12680064
083100                                             PV-DISPLAY-RECORD.   12690064
083200     MOVE PA-TOTAL-XFER-DELETED           TO PV-DISPLAY-RECORD.   12700064
083300     DISPLAY ' ASSOC SNT_DAT_XFER DELETED   = '                   12710064
083400                                             PV-DISPLAY-RECORD.   12720064
083500     DISPLAY ' '.                                                 12730064
083600     MOVE PA-TOTAL-CNTL7-DELETED          TO PV-DISPLAY-RECORD.   12740064
083700     DISPLAY ' DELETED SNT_DAT_CNTL(7 DAYS) = '                   12750064
083800                                             PV-DISPLAY-RECORD.   12760064
083900     MOVE PA-TOTAL-XFER7-DELETED          TO PV-DISPLAY-RECORD.   12770064
084000     DISPLAY ' DELETED SNT_DAT_XFER(7 DAYS) = '                   12780064
084100                                             PV-DISPLAY-RECORD.   12790064
P40396     MOVE PA-TOTAL-ERRDTL-READ            TO PV-DISPLAY-RECORD.   12800064
P40396     DISPLAY ' ERROR STATUS RECORDS READ(7 DAYS) = '              12810064
P40396                                             PV-DISPLAY-RECORD.   12820064
P40396     MOVE PA-TOTAL-ERRDTL-WRITE           TO PV-DISPLAY-RECORD.   12830064
P40396     DISPLAY ' ERROR STATUS RECORDS WRITTEN(7 DAYS) = '           12840064
P40396                                             PV-DISPLAY-RECORD.   12850064
084200     DISPLAY '*******************************************'.       12860064
084300                                                                  12870064
P40396     IF PA-TOTAL-ERRDTL-WRITE > 0                                 12880066
P40396         MOVE 4008 TO RETURN-CODE                                 12890066
P40396     END-IF.                                                      12900064
084400******************************************************************12910064
084500* 9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      12920064
084600* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 12930064
084700******************************************************************12940064
084800 9900-DB2-ABEND.                                                  12950064
084900                                                                  12960064
085000     MOVE SQLCODE    TO PV-SQLCODE.                               12970064
085100     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       12980064
085200     DISPLAY '*** DB2 ERROR ***'.                                 12990064
085300     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               13000064
085400     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 13010064
085500     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               13020064
085600     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               13030064
085700     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       13040064
085800     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             13050064
085900                                                                  13060064
086000******************************************************************13070064
086100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    13080064
086200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         13090064
086300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     13100064
086400* FORMAT.                                                         13110064
086500******************************************************************13120064
086600     COPY DPPD004.                                                13130064
086700                                                                  13140064
086800     IF SQLCODE NOT = -911                                        13150064
086900         EXEC SQL                                                 13160064
087000             ROLLBACK                                             13170064
087100         END-EXEC                                                 13180064
087200     END-IF.                                                      13190064
087300                                                                  13200064
087400     MOVE +4013         TO PV-ABEND-CODE.                         13210064
087500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         13220064
087600******************************************************************13230064
087700******************************************************************13240064
