000100 PROCESS CICS                                                     00010029
000200 IDENTIFICATION DIVISION.                                         00020029
000300 PROGRAM-ID. SUKCS800.                                            00030029
000400 AUTHOR. TKMADOZ.                                                 00040029
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050029
000600 DATE-WRITTEN.  05-17-2016.                                       00060029
000700 DATE-COMPILED.                                                   00070029
000800***************************************************************** 00080029
000900* *                                                               00090029
001000* COUPLE OF POINTS ABOUT THIS PROGRAM:                            00100029
001100* 1) THIS PROGRAM IS A HEADER PROCESSING PROGRAM.                 00110029
001200* 2) THIS PROGRAM WOULD BE CONFIGURED IN A PIPELINE (BOTH REQUEST 00120029
001300*    AND PROVIDER PIPELINES)                                      00130029
001400* 3) THIS ACTS AS A COMMUNICATION ADAPTER FOR KOHL'S              00140029
001500*                                                                 00150029
001600* SPECIAL NOTE:                                                   00160029
001700*--------------                                                   00170029
001800* 1) CURRENT PROGRAM ACCESSES A VSAM FILE BY NAME 'SUCACNFG'.     00180029
001900*    THIS NAME IS STORED IN VARIABLE PV-VSAM-FILE-NM.             00190029
002000*    UPDATE THIS VARIABLE PV-VSAM-FILE-NM WHEN A DIFFERENT        00200029
002100*    CONFIG FILE NEEDS TO BE USED FOR A DIFFERENT VERSION OF CA   00210029
002200* 2) IF THE CA VERSION NUMBER NEEDS TO BE CHANGED, THEN CHANGE    00220029
002300*    VALUE OF THE VARIABLE PV-LITERAL-KMH-VER. AS OF NOW, THIS IS 00230029
002400*    SET TO BE '1.0'. ALL INCOMING KMH NEED TO HAVE VERSION NUMBER00240029
002500*    IN KMH MATCHING WITH THIS VALUE.                             00250029
002600* 3) AMEND VALUE IN PV-HDR-APP-ID AS PER THE APPLICATION UNDER IT 00260029
002700*    IS RUNNING.                                                  00270029
002800* 4) CURRENT PROGRAM ACCESSES A DB2 TABLE DBT_WEB_SRVC_HDR_LOG FOR00280029
002900*    LOGGING THE KMH IN JSON FORMAT. CHANGE THIS NAME IF A        00290029
003000*    DIFFERENT TABLE NAME NEEDS TO BE USED FOR A DIFFERENT        00300029
003100*    APPLICATION.                                                 00310029
003200* 5) SOME LINES ARE ADDED FOR TESTING PURPOSE. THEY HAVE BEEN     00320029
003300*    TAGGED WTIH DELDSP* DO NOT DELETE THEM. WHEN NOT NEEDED,     00330029
003400*    JUST REPLACE 'DELDSP ' WITH 'DELDSP*'. THIS WILL COMMENT OUT 00340029
003500*    THESE LINES. IF NEEDED THEY CAN EASILY BE RESTORED FOR TESTIN00350029
003600*    COMMAND: C ALL 'DELDSP*' 'DELDSP'                            00360029
003700*             --------------------                                00370029
003800******************************************************************00380029
003900 ENVIRONMENT DIVISION.                                            00390029
004000 CONFIGURATION SECTION.                                           00400029
004100 SPECIAL-NAMES.                                                   00410029
004200 DATA DIVISION.                                                   00420029
004300                                                                  00430029
004400 WORKING-STORAGE SECTION.                                         00440029
004500 01  PV-PROGRAM-CONSTANTS.                                        00450029
004600     05 PV-MSGID-MF-LITERAL        PIC X(2) VALUE 'MF'.           00460029
004700                                                                  00470029
004800 01  PS-PROGRAM-SWITCHES.                                         00480029
004810                                                                  00481031
004900     05 PS-DISPLAY-MSG-SW          PIC X(1) VALUE 'N'.            00490033
004901        88 PS-DISPLAY-MSG-YES               VALUE 'Y'.            00490131
004902        88 PS-DISPLAY-MSG-NO                VALUE 'N'.            00490231
004903                                                                  00490331
004910     05 PS-FUNC-VALID-SW           PIC X(2).                      00491031
005000        88 PS-FUNC-REC-REQ         VALUE 'RR'.                    00500029
005100        88 PS-FUNC-REC-RESP        VALUE 'RS'.                    00510029
005200        88 PS-FUNC-SEND-REQ        VALUE 'SR'.                    00520029
005300        88 PS-FUNC-SEND-RESP       VALUE 'SS'.                    00530029
005400        88 PS-SKIP-FUNCTION        VALUE 'NN'.                    00540029
005500        88 PS-VALID-FUNCTION       VALUE 'RR',                    00550029
005600                                         'RS',                    00560029
005700                                         'SR',                    00570029
005800                                         'SS'.                    00580029
005900     05 PS-PROC-KMHPREM-SW         PIC X(1).                      00590029
006000        88 PS-PROC-KMHPREM         VALUE 'Y'.                     00600029
006100        88 PS-PROC-KMHPREM-FALSE   VALUE 'N'.                     00610029
006200     05 PS-RETRIEVE-KMH-SW         PIC X(1).                      00620029
006300        88 PS-RETR-NO-ERROR        VALUE 'N'.                     00630029
006400        88 PS-RETR-ERROR           VALUE 'Y'.                     00640029
006500     05 PS-LOOP-SW                 PIC X(1).                      00650029
006600        88 PS-BREAK-THE-LOOP       VALUE 'N'.                     00660029
006700        88 PS-CONT-THE-LOOP        VALUE 'Y'.                     00670029
006800     05 PS-LOOP-SW1                PIC X(1).                      00680029
006900        88 PS-BREAK-THE-LOOP1      VALUE 'N'.                     00690029
007000        88 PS-CONT-THE-LOOP1       VALUE 'Y'.                     00700029
007100     05 PS-LOOP-SW2                PIC X(1).                      00710029
007200        88 PS-BREAK-THE-LOOP2      VALUE 'N'.                     00720029
007300        88 PS-CONT-THE-LOOP2       VALUE 'Y'.                     00730029
007400     05 PS-IN-MSG-FLDS             PIC X(1).                      00740029
007500        88 PS-IN-MSG-FLDS-MSGID    VALUE 'M'.                     00750029
007600        88 PS-IN-MSG-FLDS-CORRID   VALUE 'C'.                     00760029
007700        88 PS-IN-MSG-FLDS-FROM     VALUE 'F'.                     00770029
007800        88 PS-IN-MSG-FLDS-CRDT     VALUE 'T'.                     00780029
007900        88 PS-IN-MSG-FLDS-EXDT     VALUE 'E'.                     00790029
008000        88 PS-IN-MSG-FLDS-NO       VALUE 'N'.                     00800029
008100     05 PS-IN-MSG-EXDT-SW          PIC X(1).                      00810029
008200        88 PS-IN-MSG-EXDT-Y        VALUE 'Y'.                     00820029
008300        88 PS-IN-MSG-EXDT-N        VALUE 'N'.                     00830029
008400     05 PS-IN-MSG-FRM              PIC X(1).                      00840029
008500        88 PS-IN-MSG-FRM-YES       VALUE 'Y'.                     00850029
008600        88 PS-IN-MSG-FRM-NO        VALUE 'N'.                     00860029
008700     05 PS-IN-MSG-INRPT-SW         PIC X(1).                      00870029
008800        88 PS-IN-MSG-INRPT-Y       VALUE 'Y'.                     00880029
008900        88 PS-IN-MSG-INRPT-N       VALUE 'N'.                     00890029
009000        88 PS-IN-MSG-INRPT-D       VALUE 'D'.                     00900029
009100     05 PS-IN-MSG-FAULT-SW         PIC X(1).                      00910029
009200        88 PS-IN-MSG-FAULT-Y       VALUE 'Y'.                     00920029
009300        88 PS-IN-MSG-FAULT-C       VALUE 'C'.                     00930029
009400        88 PS-IN-MSG-FAULT-D       VALUE 'D'.                     00940029
009500        88 PS-IN-MSG-FAULT-F       VALUE 'F'.                     00950029
009600        88 PS-IN-MSG-FAULT-N       VALUE 'N'.                     00960029
009700     05 PS-IN-SYS-CD               PIC X(1).                      00970029
009800        88 PS-IN-SYS-CD-YES        VALUE 'Y'.                     00980029
009900        88 PS-IN-SYS-CD-NO         VALUE 'N'.                     00990029
010000     05 PS-IN-APP-CD               PIC X(1).                      01000029
010100        88 PS-IN-APP-CD-YES        VALUE 'Y'.                     01010029
010200        88 PS-IN-APP-CD-NO         VALUE 'N'.                     01020029
010300     05 PS-IN-MOD-CD               PIC X(1).                      01030029
010400        88 PS-IN-MOD-CD-YES        VALUE 'Y'.                     01040029
010500        88 PS-IN-MOD-CD-NO         VALUE 'N'.                     01050029
010600     05 PS-IN-NOD-ID               PIC X(1).                      01060029
010700        88 PS-IN-NOD-ID-YES        VALUE 'Y'.                     01070029
010800        88 PS-IN-NOD-ID-NO         VALUE 'N'.                     01080029
010900     05 PS-MANDATE-SW              PIC X(1).                      01090029
011000        88 PS-VALIDATE-PASS        VALUE 'Y'.                     01100029
011100        88 PS-VALIDATE-FAIL        VALUE 'N'.                     01110029
011200     05 PS-SOAP-LEVEL              PIC S9(8) COMP-4.              01120029
011300        88 PS-SOAP-11              VALUE 1.                       01130029
011400        88 PS-SOAP-12              VALUE 2.                       01140029
011500        88 PS-NOT-SOAP             VALUE 10.                      01150029
011600     05 PS-FROM-SW                 PIC X(1).                      01160029
011700        88 PS-FROM-NOT-MANDATE     VALUE 'N'.                     01170029
011800        88 PS-FROM-MANDATE         VALUE 'Y'.                     01180029
011900     05 PS-EXDT-SW                 PIC X(1).                      01190029
012000        88 PS-EXDT-NT-NEED         VALUE 'N'.                     01200029
012100        88 PS-EXDT-NEED            VALUE 'Y'.                     01210029
012200     05 PS-ACT-SW                  PIC X(1).                      01220029
012300        88 PS-ACT-NT-NEED          VALUE 'N'.                     01230029
012400        88 PS-ACT-NEED             VALUE 'Y'.                     01240029
012500     05 PS-TO-SW                   PIC X(1).                      01250029
012600        88 PS-TO-NT-NEED           VALUE 'N'.                     01260029
012700        88 PS-TO-NEED              VALUE 'Y'.                     01270029
012800     05 PS-RKEYS-SW                PIC X(1).                      01280029
012900        88 PS-RKEYS-NT-NEED        VALUE 'N'.                     01290029
013000        88 PS-RKEYS-NEED           VALUE 'Y'.                     01300029
013100     05 PS-CORID-SW                PIC X(1).                      01310029
013200        88 PS-CORID-NT-NEED        VALUE 'N'.                     01320029
013300        88 PS-CORID-NEED           VALUE 'Y'.                     01330029
013400     05 PS-FAULT-SW                PIC X(1).                      01340029
013500        88 PS-FAULT-NT-NEED        VALUE 'N'.                     01350029
013600        88 PS-FAULT-NEED           VALUE 'Y'.                     01360029
013700     05 PS-FROM-SW                 PIC X(1).                      01370029
013800        88 PS-FROM-NT-NEED         VALUE 'N'.                     01380029
013900        88 PS-FROM-NEED            VALUE 'Y'.                     01390029
014000     05 PS-MSGID-SW                PIC X(1).                      01400029
014100        88 PS-MSGID-NT-NEED        VALUE 'N'.                     01410029
014200        88 PS-MSGID-NEED           VALUE 'Y'.                     01420029
014300     05 PS-CRDATM-SW               PIC X(1).                      01430029
014400        88 PS-CRDATM-NT-NEED       VALUE 'N'.                     01440029
014500        88 SV-CRDATM-NEED          VALUE 'Y'.                     01450029
014600     05 PS-INRPTO-SW               PIC X(1).                      01460029
014700        88 PS-INRPTO-NT-NEED       VALUE 'N'.                     01470029
014800        88 PS-INRPTO-NEED          VALUE 'Y'.                     01480029
014900     05 PS-IN-KMH-VER-SW           PIC X(1).                      01490029
015000        88 PS-INKMH-VER-N          VALUE 'N'.                     01500029
015100        88 PS-INKMH-VER-Y          VALUE 'Y'.                     01510029
015200                                                                  01520029
015300 01  PV-PROGRAM-VARIABLES.                                        01530029
015400* THE FOLLOWING VARIABLES ARE FOR BUILDING KOHL'S MESSAGE HEADER  01540029
015500     05 PV-NEW-KMH-MSG-HDR-1.                                     01550029
015600        10 FILLER                  PIC X(74) VALUE                01560029
015700     '<MessageHeader xmlns="urn:kohls:xml:schemas:message-header:v01570029
015800-    '1_0" version="'.                                            01580029
015900        10 PV-NEW-KMH-VER          PIC X(3)  VALUE SPACES.        01590029
016000        10 FILLER                  PIC X(2)  VALUE '">'.          01600029
016100     05 PV-NEW-KMH-MSG-ID.                                        01610029
016200        10 FILLER                  PIC X(11) VALUE '<MessageID>'. 01620029
016300        10 PV-KMH-MSG-ID           PIC X(36) VALUE SPACES.        01630029
016400        10 FILLER                  PIC X(12) VALUE '</MessageID>'.01640029
016500     05 PV-NEW-KMH-CDT.                                           01650029
016600        10 FILLER                  PIC X(16) VALUE                01660029
016700                                             '<CreateDateTime>'.  01670029
016800        10 PV-KMH-CDATIME          PIC X(24) VALUE SPACES.        01680029
016900        10 FILLER                  PIC X(17) VALUE                01690029
017000                                             '</CreateDateTime>'. 01700029
017100     05 PV-NEW-KMH-FROM.                                          01710029
017200        10 FILLER                  PIC X(18) VALUE                01720029
017300                                             '<From systemCode="'.01730029
017400        10 PV-KMH-SYS-CD.                                         01740029
017500           15 FILLER               PIC X OCCURS 15 DEPENDING ON   01750029
017600                                   PV-SYS-CD-LEN.                 01760029
017700        10 PV-FILLER-APP           PIC X(7).                      01770029
017800        10 PV-KMH-APP-CD.                                         01780029
017900           15 FILLER               PIC X OCCURS 15 DEPENDING ON   01790029
018000                                   PV-APP-CD-LEN.                 01800029
018100        10 PV-FILLER-MOD           PIC X(10).                     01810029
018200        10 PV-KMH-MODULE.                                         01820029
018300           15 FILLER               PIC X OCCURS 15 DEPENDING ON   01830029
018400                                   PV-MOD-CD-LEN.                 01840029
018500        10 PV-FILLER-NOD           PIC X(10).                     01850029
018600        10 PV-KMH-NODEID.                                         01860029
018700           15 FILLER               PIC X OCCURS 10 DEPENDING ON   01870029
018800                                   PV-NOD-ID-LEN.                 01880029
018900        10 PV-FILLER-EOF           PIC X(4).                      01890029
019000                                                                  01900029
019100 01  PV-MORE-PROGRAM-VARIABLES.                                   01910029
019200     05 PV-NEW-KMH-INRP-TO.                                       01920029
019300        10 FILLER                  PIC X(11) VALUE '<InReplyTo>'. 01930029
019400        10 PV-KMH-IRP-TO           PIC X(36) VALUE SPACES.        01940029
019500        10 FILLER                  PIC X(12) VALUE '</InReplyTo>'.01950029
019600     05 PV-NEW-KMH-CORID.                                         01960029
019700        10 FILLER                  PIC X(15) VALUE                01970029
019800                                             '<CorrelationID>'.   01980029
019900        10 PV-KMH-CORRL-ID         PIC X(36) VALUE SPACES.        01990029
020000        10 FILLER                  PIC X(21) VALUE                02000029
020100                                             '</CorrelationID>'.  02010029
020200     05 PV-NEW-KMH-EDT.                                           02020029
020300        10 FILLER                  PIC X(16) VALUE                02030029
020400                                             '<ExpiryDateTime>'.  02040029
020500        10 PV-KMH-EDATIME          PIC X(24) VALUE SPACES.        02050029
020600        10 FILLER                  PIC X(17) VALUE                02060029
020700                                             '</ExpiryDateTime>'. 02070029
020800     05 PV-NEW-KMH-ACTION.                                        02080029
020900        10 FILLER                  PIC X(8)  VALUE '<Action>'.    02090029
021000        10 PV-KMH-ACTION           PIC X(25) VALUE SPACES.        02100029
021100        10 FILLER                  PIC X(9)  VALUE '</Action>'.   02110029
021200     05 PV-NEW-KMH-TO-1.                                          02120029
021300        10 FILLER                  PIC X(4)  VALUE '<To>'.        02130029
021400     05 PV-NEW-KMH-TO-ADR.                                        02140029
021500        10 FILLER                  PIC X(9)  VALUE '<Address>'.   02150029
021600        10 PV-KMH-TO-ADR           PIC X(80) VALUE SPACES.        02160029
021700        10 FILLER                  PIC X(10) VALUE '</Address>'.  02170029
021800     05 PV-NEW-KMH-TO-ACT.                                        02180029
021900        10 FILLER                  PIC X(8)  VALUE '<Action>'.    02190029
022000        10 PV-KMH-TO-ACT           PIC X(25) VALUE SPACES.        02200029
022100        10 FILLER                  PIC X(9)  VALUE '</Action>'.   02210029
022200     05 PV-NEW-KMH-PARM-1.                                        02220029
022300        10 FILLER                  PIC X(12) VALUE '<Parameters>'.02230029
022400     05 PV-NEW-KMH-TO-PARM1.                                      02240029
022500        10 FILLER                  PIC X(17) VALUE                02250029
022600                                             '<Parameter name="'. 02260029
022700        10 PV-KMH-TO-PARMNM1       PIC X(10) VALUE 'PARM1'.       02270029
022800        10 FILLER                  PIC X(2)  VALUE '">'.          02280029
022900        10 PV-KMH-TO-PARMVAL1      PIC X(25) VALUE SPACES.        02290029
023000        10 FILLER                  PIC X(12) VALUE '</Parameter>'.02300029
023100     05 PV-NEW-KMH-TO-PARM2.                                      02310029
023200        10 FILLER                  PIC X(17) VALUE                02320029
023300                                             '<Parameter name="'. 02330029
023400        10 PV-KMH-TO-PARMNM2       PIC X(10) VALUE 'PARM2'.       02340029
023500        10 FILLER                  PIC X(2)  VALUE '">'.          02350029
023600        10 PV-KMH-TO-PARMVAL2      PIC X(25) VALUE SPACES.        02360029
023700        10 FILLER                  PIC X(12) VALUE '</Parameter>'.02370029
023800     05 PV-NEW-KMH-PARM-2.                                        02380029
023900        10 FILLER                  PIC X(13) VALUE                02390029
024000                                             '</Parameters>'.     02400029
024100     05 PV-NEW-KMH-TO-2.                                          02410029
024200        10 FILLER                  PIC X(5)  VALUE '</To>'.       02420029
024300     05 PV-NEW-KMH-RKEYS.                                         02430029
024400        10 FILLER                  PIC X(38) VALUE                02440029
024500                        '<RoutingKeys><RoutingKey name="store">'. 02450029
024600        10 PV-KMH-RKEYS-VAL        PIC X(25) VALUE SPACES.        02460029
024700        10 FILLER                  PIC X(14) VALUE                02470029
024800                                             '</RoutingKey>'.     02480029
024900        10 FILLER                  PIC X(14) VALUE                02490029
025000                                             '</RoutingKeys>'.    02500029
025100     05 PV-NEW-KMH-FAULT.                                         02510029
025200        10 FILLER                  PIC X(7)  VALUE '<Fault>'.     02520029
025300        10 FILLER                  PIC X(6)  VALUE '<Code>'.      02530029
025400        10 PV-KMH-FAULT-CD         PIC X(26) VALUE                02540029
025500           'BAD MESSAGE HEADER ELEMENT'.                          02550029
025600        10 FILLER                  PIC X(7)  VALUE '</Code>'.     02560029
025700        10 FILLER                  PIC X(13) VALUE                02570029
025800                                             '<Description>'.     02580029
025900        10 PV-KMH-FAULT-MSG        PIC X(255) VALUE SPACES.       02590029
026000        10 FILLER                  PIC X(14) VALUE                02600029
026100                                             '</Description>'.    02610029
026200        10 FILLER                  PIC X(14) VALUE '</Fault>'.    02620029
026300     05 PV-NEW-KMH-MSG-HDR-2.                                     02630029
026400        10 FILLER                  PIC X(16) VALUE                02640029
026500                                             '</MessageHeader>'.  02650029
026600     05 PV-HEAD-PTR                USAGE IS POINTER.              02660029
026700     05 PV-URI-PTR                 USAGE IS POINTER.              02670029
026800     05 PV-URI-LEN                 PIC S9(8) COMP-4.              02680029
026900     05 PV-TRANID-LEN              PIC S9(8) BINARY.              02690029
027000     05 PV-CONT-LEN                PIC S9(8) COMP-4 VALUE 16.     02700029
027100     05 PV-CONT-LEN-DISP           PIC 9(8).                      02710029
027200     05 PV-PIPE-LEN                PIC S9(8) COMP-4 VALUE 16.     02720029
027300     05 PV-GETMAIN-LEN             PIC S9(8) COMP-4.              02730029
027400     05 PV-RETR-KMH-LEN            PIC S9(8) COMP-4.              02740029
027500     05 PV-GETMAIN-PTR             USAGE IS POINTER.              02750029
027600     05 PV-RESP                    PIC S9(8) COMP-5 SYNC.         02760029
027700     05 PV-RESP2                   PIC S9(8) COMP-5 SYNC.         02770029
027800     05 PV-SYS-CD-LEN              PIC S9(8) COMP-4.              02780029
027900     05 PV-APP-CD-LEN              PIC S9(8) COMP-4.              02790029
028000     05 PV-MOD-CD-LEN              PIC S9(8) COMP-4.              02800029
028100     05 PV-NOD-ID-LEN              PIC S9(8) COMP-4.              02810029
028200     05 PV-FLT-DS-LEN              PIC S9(8) COMP-4.              02820029
028300     05 PV-FLT-CD-LEN              PIC S9(8) COMP-4.              02830029
028400     05 PV-RESP-DISP               PIC 9(8).                      02840029
028500     05 PV-XML-CODE-DISP           PIC 9(8).                      02850029
028600     05 PV-RESP2-DISP              PIC 9(8).                      02860029
028700     05 PV-SQLCODE-DISP            PIC 9(9).                      02870029
028800     05 PV-WEBS-LEN                PIC S9(8) COMP-4 VALUE 30.     02880029
028900     05 PV-FUNC-LEN                PIC S9(8) COMP-4 VALUE 16.     02890029
029000     05 PV-RECORD-LENGTH-300       PIC S9(4) COMP VALUE 300.      02900029
029100     05 PV-WEBS-AREA               PIC X(30).                     02910029
029200     05 PV-DEFAULT-WEBS            PIC X(30) VALUE 'DEFAULT'.     02920029
029300     05 PV-LITERAL-KMH-VER         PIC X(3) VALUE '1.0'.          02930029
029400     05 PV-FUNC-AREA               PIC X(30).                     02940029
029500     05 PV-VALIDATE-DTM            PIC X(24).                     02950029
029600     05 PV-TRAN-ID                 PIC X(4).                      02960029
029700* UPDATE THIS VARIABLE PV-VSAM-FILE-NM WHEN A DIFFERENT           02970029
029800* CONFIG FILE NEEDS TO BE USED                                    02980029
029900     05 PV-VSAM-FILE-NM            PIC X(8)  VALUE 'SUCACNFG'.    02990029
030000* UPDATE THIS VARIABLE PV-HDR-APP-ID WHEN A DIFFERENT APP         03000029
030100* IS USING THIS PROGRAM                                           03010029
030200     05 PV-HDR-APP-ID              PIC X(2) VALUE 'SU'.           03020029
030300     05 PV-HEADER-LOG-MSG          PIC X(2000) VALUE SPACES.      03030029
030400     05 PV-SPOOL-LOG-MSG           PIC X(400).                    03040029
030500     05 PV-TEMP-LOG-MSG            PIC X(400).                    03050029
030600     05 PV-RUNNING-KMH             PIC X(2000).                   03060029
030700     05 PV-KMH-HEADER-FINAL        PIC X(2000).                   03070029
030800     05 PV-KMH-TO-ELE-STRNG        PIC X(500).                    03080029
030900*    05 PV-TCP-IP-INFO             PIC X(15).                     03090029
031000     05 PV-HOST-NAME               PIC X(30).                     03100029
031100     05 PV-EZACICAL                PIC X(08) VALUE 'EZACICAL'.    03110029
031200     05 PV-EZ-TOKEN                PIC X(16).                     03120029
031300     05 PV-EZ-COMMAND              PIC 9(04) BINARY.              03130029
031400     05 PV-EZ-HZERO                PIC 9(04) BINARY.              03140029
031500     05 PV-EZ-DZERO                PIC X(08).                     03150029
031600     05 PV-EZ-NAMELEN              PIC 9(08) BINARY.              03160029
031700     05 PV-EZ-NAME                 PIC X(30).                     03170029
031800     05 PV-EZ-ERRNO                PIC 9(08) BINARY.              03180029
031900     05 PV-EZ-RETCODE              PIC 9(08) BINARY.              03190029
032000     05 PV-EZ-RETCODE2             PIC 9(08).                     03200029
032100     05 PV-STOR-IRP-TO             PIC X(36).                     03210029
032200     05 PV-STOR-CORR-ID            PIC X(36).                     03220029
032300     05 PV-STOR-KMH-VER            PIC X(3).                      03230029
032400     05 PV-IN-MSG-MSGID            PIC X(36).                     03240029
032500     05 PV-IN-MSG-CORRID           PIC X(36).                     03250029
032600     05 PV-IN-MSG-INRPTO           PIC X(36).                     03260029
032700     05 PV-IN-MSG-CRDT             PIC X(24).                     03270029
032800     05 PV-IN-MSG-EXDT             PIC X(24).                     03280029
032900     05 PV-IN-MSG-SYSCD            PIC X(36).                     03290029
033000     05 PV-IN-MSG-APPCD            PIC X(36).                     03300029
033100     05 PV-IN-MSG-MODCD            PIC X(36).                     03310029
033200     05 PV-IN-MSG-NODID            PIC X(36).                     03320029
033300     05 PV-IN-MSG-FAULT-CD         PIC X(40).                     03330029
033400     05 PV-IN-MSG-FAULT-DES        PIC X(200).                    03340029
033500     05 PV-NEW-SYSTEM-CD           PIC X(30).                     03350029
033600     05 PV-NEW-APP                 PIC X(30).                     03360029
033700     05 PV-NEW-MODULE              PIC X(30).                     03370029
033800     05 PV-NEW-NODEID              PIC X(30).                     03380029
033900     05 PV-NEW-ACTION-ELE          PIC X(30).                     03390029
034000     05 PV-NEW-RKEYS-ELE           PIC X(30).                     03400029
034100     05 PV-OFFSET-CHAR             PIC X(10).                     03410029
034200     05 PV-OFFSET-CHAR2            PIC X(10).                     03420029
034300     05 PV-OFFSET-NBR              PIC 9(10).                     03430029
034400     05 PV-CICS-MSG-AREA           PIC X(80) VALUE SPACE.         03440029
034500     05 PV-NBR-M-ELEMENTS          PIC 9(2).                      03450029
034600     05 PV-NBR-O-ELEMENTS          PIC 9(2).                      03460029
034700     05 PV-NBR-TO-ELEMENTS         PIC 9(2).                      03470029
034800     05 PV-STRING-PTR-1            PIC 9(3).                      03480029
034900     05 PV-STRING-PTR-2            PIC 9(3).                      03490029
035000     05 PV-STRING-PTR-3            PIC 9(3).                      03500029
035100     05 PV-STRING-PTR-4            PIC 9(3).                      03510029
035200     05 PV-CSS-DSP-LEN             PIC 9(4).                      03520029
035300     05 PV-CSS-DSP-TO-LEN          PIC 9(4).                      03530029
035400     05 PV-HEADER-LOG-LEN          PIC 9(4).                      03540029
035500     05 PV-SPOOL-LOG-LEN           PIC 9(4).                      03550029
035600     05 PV-UTC-DATE                PIC X(24).                     03560029
035700     05 PV-CURR-DATE               PIC X(24).                     03570029
035800     05 PV-NEW-EXP-DATE-TIME       PIC X(24).                     03580029
035900     05 PV-RUNNING-SPACE-CNT       PIC 9(5).                      03590029
036000     05 PV-HDR-LOG-SPACE-CNT       PIC 9(5).                      03600029
036100     05 PV-HDR-SPACE-CNT           PIC 9(5).                      03610029
036200     05 PV-HDR-CUR-CNT             PIC 9(5).                      03620029
036300     05 PV-FROM-SPACE-CNT          PIC 9(5).                      03630029
036400     05 PV-FAULT-SPACE-CNT         PIC 9(5).                      03640029
036500     05 PV-OFFSET-LEN              PIC 9(5).                      03650029
036600     05 PV-OFFSET-LEN2             PIC 9(5).                      03660029
036700     05 PV-RUNNING-CUR-CNT         PIC 9(5).                      03670029
036800     05 PV-STR-INDEX               PIC 9(3).                      03680029
036900     05 PV-STR-INDEX1              PIC 9(3).                      03690029
037000     05 PV-STR-INDEX2              PIC 9(3).                      03700029
037100     05 PV-STR-INDEX3              PIC 9(3).                      03710029
037200     05 PV-STR-INDEX4              PIC 9(3).                      03720029
037300     05 PV-STR-INDEX5              PIC 9(3).                      03730029
037400     05 PV-STR-INDEX6              PIC 9(3).                      03740029
037500     05 PV-STR-INDEX7              PIC 9(3).                      03750029
037600     05 PV-STR-INDEX8              PIC 9(3).                      03760029
037700     05 PV-STR-INDEX9              PIC 9(3).                      03770029
037800     05 PV-STR-INDEX10             PIC 9(3).                      03780029
037900     05 PV-STR-INDEX11             PIC 9(3).                      03790029
038000     05 PV-STR-INDEX12             PIC 9(3).                      03800029
038100     05 PV-STR-INDEX13             PIC 9(3).                      03810029
038200     05 PV-STR-INDEX14             PIC 9(3).                      03820029
038300     05 PV-CONFIG-RECORD           PIC X(300).                    03830029
038400     05 PV-FAULT-MSG               PIC X(255).                    03840029
038500     05 PV-FAULT-MSG-1             PIC X(400).                    03850029
038600     05 PV-NEW-MESSAGE-ID          PIC X(36) VALUE SPACES.        03860029
038700     05 PV-SOAP-LVL-LEN            PIC S9(8) COMP-4.              03870029
038800     05 PV-FAULT-CODE              PIC S9(8) COMP-4.              03880029
038900     05 PV-PIPE-AREA               PIC X(8)  VALUE SPACES.        03890029
039000     05 PV-PIPE-AREA-SPLIT         PIC X(5) VALUE SPACES.         03900029
039100     05 PV-TASK-NBR                PIC X(7).                      03910029
039200     05 PV-TASKN                   REDEFINES PV-TASK-NBR          03920029
039300                                   PIC 9(7).                      03930029
039400     05 PV-TASKN-SPLIT.                                           03940029
039500        10 PV-TASK1                PIC X(1) VALUE SPACES.         03950029
039600        10 FILLER                  PIC X(1) VALUE '-'.            03960029
039700        10 PV-TASK2                PIC X(4) VALUE SPACES.         03970029
039800        10 FILLER                  PIC X(1) VALUE '-'.            03980029
039900        10 PV-TASK3                PIC X(2) VALUE SPACES.         03990029
040000     05 PV-SECS2-SPLIT.                                           04000029
040100        10 PV-SEC-1                PIC X(2) VALUE SPACES.         04010029
040200        10 FILLER                  PIC X(1) VALUE '-'.            04020029
040300        10 PV-SEC-2                PIC X(4) VALUE SPACES.         04030029
040400        10 FILLER                  PIC X(1) VALUE '-'.            04040029
040500        10 PV-SEC-3                PIC X(12) VALUE SPACES.        04050029
040600     05 PV-SECTION-NAME            PIC X(30) OCCURS 100 TIMES.    04060029
040700     05 PV-SECTION-NAME2           PIC X(30) OCCURS 100 TIMES.    04070029
040800     05 PV-SECTION-NAME3           PIC X(30) OCCURS 100 TIMES.    04080029
040900     05 PV-SECTION-NAME4           PIC X(30) OCCURS 100 TIMES.    04090029
041000     05 PV-NEW-TO-ARRAY            OCCURS 100 TIMES.              04100029
041100        10 PV-NEW-TO-ADR           PIC X(100) VALUE SPACES.       04110029
041200        10 PV-NEW-TO-ACT           PIC X(50) VALUE SPACES.        04120029
041300        10 PV-NEW-TO-PARM1         PIC X(20) VALUE SPACES.        04130029
041400        10 PV-NEW-TO-PARM2         PIC X(20) VALUE SPACES.        04140029
041500     05 PV-KMH-ELEMENT-ARRAY       OCCURS 100 TIMES.              04150029
041600        10 PV-KMH-ELEMENT          PIC X(20).                     04160029
041700        10 PV-KMH-MANDATE          PIC X(1).                      04170029
041800        10 PV-KMH-ELE-PRESENCE     PIC X(1).                      04180029
041900        10 PV-KMH-VAL              OCCURS 10 TIMES.               04190029
042000           15 PV-KMH-ELEMENT-VAL   PIC X(50).                     04200029
042100     05 PV-CHRDATE                 PIC X(80).                     04210029
042200     05 PV-IN-DATE.                                               04220029
042300        10 PV-STRING-LENGTH        PIC S9(4) BINARY.              04230029
042400        10 PV-STRING-TEXT.                                        04240029
042500           15 PV-STRING-CHAR       PIC X                          04250029
042600                                   OCCURS 0 TO 256 TIMES          04260029
042700                                   DEPENDING ON PV-STRING-LENGTH  04270029
042800                                   of PV-IN-DATE.                 04280029
042900 01  PV-MORE2-PROGRAM-VARIALES.                                   04290029
043000     05 PV-PICSTR.                                                04300029
043100        10 PV-STRING-LENGTH        PIC S9(4) BINARY.              04310029
043200        10 PV-STRING-TEXT.                                        04320029
043300           15 PV-STRING-CHAR         PIC X                        04330029
043400                                   OCCURS 0 TO 256 TIMES          04340029
043500                                   DEPENDING ON PV-STRING-LENGTH  04350029
043600                                   of PV-PICSTR.                  04360029
043700 01  PV-FC.                                                       04370029
043800     05 PV-COND-TOKEN-VALUE.                                      04380029
043900        10 PV-CASE-1-CONDITION-ID.                                04390029
044000           15 PV-SEVERITY          PIC S9(4) COMP.                04400029
044100           15 PV-MSG-NO            PIC S9(4) COMP.                04410029
044200        10 PV-CASE-SEV-CTL         PIC X.                         04420029
044300        10 PV-FACILITY-ID          PIC X(3).                      04430029
044400     05 PV-I-S-INFO                PIC S9(9) COMP.                04440029
044500 01  PV-LILIAN                     PIC S9(9) BINARY.              04450029
044600 01  PV-CEE-SECS                   COMP-2.                        04460029
044700 01  PV-SAVED-SECS                 COMP-2.                        04470029
044800 01  PV-EXPIRY-SECS                COMP-2.                        04480029
044900 01  PV-NEW-SECS                   COMP-2.                        04490029
045000 01  PV-SEC-VAR.                                                  04500029
045100     05 PV-SECS2                   PIC X(18).                     04510029
045200     05 PV-SECS                    REDEFINES PV-SECS2             04520029
045300                                   PIC  9(12)V9(6).               04530029
045400 01  PV-RETR-KMH-AREA.                                            04540029
045500     05 FILLER                     PIC X OCCURS 65536             04550029
045600                                   DEPENDING ON PV-RETR-KMH-LEN.  04560029
045700                                                                  04570029
045800*VSAM RECORD LAYOUT                                               04580029
045900      COPY SURD131.                                               04590029
046000                                                                  04600029
046100*----------------------------------------------------------------*04610029
046200* DCLGEN TABLE(DBT_WEB_SRVC_HDR_LOG)                              04620029
046300*----------------------------------------------------------------*04630029
046400                                                                  04640029
046500     EXEC SQL                                                     04650029
046600         INCLUDE DBT00024                                         04660029
046700     END-EXEC.                                                    04670029
046701                                                                  04670130
046710*----------------------------------------------------------------*04671030
046720* parm table used to control displays                             04672030
046730*----------------------------------------------------------------*04673030
046740                                                                  04674030
046750     EXEC SQL                                                     04675030
046760         INCLUDE TKRPRPM                                          04676030
046770     END-EXEC.                                                    04677030
046780                                                                  04678030
046800                                                                  04680029
046900*----------------------------------------------------------------*04690029
047000*    DB2 AREA FOR COMMUNICATIONS                                  04700029
047100*----------------------------------------------------------------*04710029
047200                                                                  04720029
047300     EXEC SQL                                                     04730029
047400          INCLUDE SQLCA                                           04740029
047500     END-EXEC.                                                    04750029
047600                                                                  04760029
047700*EJECT                                                            04770029
047800 LINKAGE SECTION.                                                 04780029
047900 01  PV-GETMAIN-AREA.                                             04790029
048000     05 FILLER                     PIC X OCCURS 65536             04800029
048100                                   DEPENDING ON PV-GETMAIN-LEN.   04810029
048200 01  PV-URI-AREA.                                                 04820029
048300     05 FILLER                     PIC X OCCURS 256               04830029
048400                                   DEPENDING ON PV-URI-LEN.       04840029
048500 01  PV-TRANID-DATA.                                              04850029
048600     05 FILLER                     PIC X OCCURS 32768             04860029
048700                                   DEPENDING ON PV-TRANID-LEN.    04870029
048800                                                                  04880029
048900******************************************************************04890029
049000******************************************************************04900029
049100 PROCEDURE DIVISION.                                              04910029
049200******************************************************************04920029
049300* READ DFHWS-WEBSERVICE TO GET THE CURRENT WEB SERVICE NAME      *04930029
049400******************************************************************04940029
049500*                                                                 04950029
049600 0000-MAIN-MODULE.                                                04960029
049700                                                                  04970029
049800                                                                  04980029
049801*    DMH 2/15/18 BEGIN                                            04980131
049810*    ADDED NEW PARM - SU800D TO CONTROL WHEN MESSAGES WILL        04981031
049811*    BE DISPLAYED                                                 04981131
049812     PERFORM 0500-CHECK-DISPLAY                                   04981231
049813     IF  PS-DISPLAY-MSG-YES                                       04981331
049900         DISPLAY 'SUKCS800-ENTRY TIME: ' FUNCTION CURRENT-DATE    04990031
049901     END-IF                                                       04990131
049910*    DMH 2/15/18 END                                              04991031
049920                                                                  04992029
050000*    STRING  'INSIDE SUKCS800'                                    05000029
050100*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              05010029
050200*    PERFORM 9990-WRITE-CICS                                      05020029
050300*                                                                 05030029
050400     PERFORM 1000-INITIALIZE.                                     05040029
050500*                                                                 05050029
050600     IF PS-VALID-FUNCTION                                         05060029
050700                                                                  05070029
050800        PERFORM 2000-SUB-PROCESS-1                                05080029
050900                                                                  05090029
051000     END-IF                                                       05100029
051100                                                                  05110029
051200*    STRING 'EXIT SUKCS800'                                       05120029
051300*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               05130029
051400*    PERFORM 9990-WRITE-CICS                                      05140029
051401                                                                  05140129
051402*    DMH 2/15/18 BEGIN                                            05140231
051403*    ADDED NEW PARM - SU800D TO CONTROL WHEN MESSAGES WILL        05140331
051404*    BE DISPLAYED                                                 05140431
051406     IF  PS-DISPLAY-MSG-YES                                       05140631
051500         DISPLAY 'SUKCS800-EXIT TIME: '  FUNCTION CURRENT-DATE    05150031
051501     END-IF                                                       05150131
051510*    DMH 2/15/18 END                                              05151031
051600                                                                  05160029
051700     EXEC CICS RETURN END-EXEC                                    05170029
051800     .                                                            05180029
051900                                                                  05190029
051901                                                                  05190131
051902*----------------------------------------------------------------*05190231
051903* check to see if displays will be written or not                *05190331
051904* dmh added - 2/15/18                                            *05190431
051905*----------------------------------------------------------------*05190531
051910 0500-CHECK-DISPLAY.                                              05191031
051911                                                                  05191131
051912     EXEC SQL                                                     05191231
051913          SELECT  FUNC_TXT                                        05191331
051914            INTO :PS-DISPLAY-MSG-SW                               05191431
051915            FROM  TKRPRPM                                         05191531
051917           WHERE LOC_ID             =  90                         05191731
051918             AND INTFC_SYS_CDE      = 'KHL'                       05191832
051919             AND SYS_PRC_FUNC_CDE   = 'SU800D'                    05191932
051920             AND FUNC_PRC_STAT_CDE  = 'AC'                        05192032
051921             AND FUNC_BEG_TMST     <=  CURRENT TIMESTAMP          05192132
051922             AND FUNC_END_TMST     >=  CURRENT TIMESTAMP          05192232
051931     END-EXEC.                                                    05193131
051932                                                                  05193231
051933     EVALUATE TRUE                                                05193331
051934        WHEN SQLCODE = 0                                          05193431
051935             CONTINUE                                             05193531
051936        WHEN OTHER                                                05193631
051937             SET PS-DISPLAY-MSG-NO TO TRUE                        05193731
051938             MOVE SQLCODE TO PV-SQLCODE-DISP                      05193831
051939             STRING  ' SUKCS800 - '                               05193931
051940                     'SELECT SU800D TKRPRPM '                     05194031
051941                     'SQL:' PV-SQLCODE-DISP  DELIMITED BY SIZE    05194131
051943                                        INTO PV-CICS-MSG-AREA     05194331
051944             DISPLAY PV-CICS-MSG-AREA                             05194431
051945     END-EVALUATE.                                                05194531
051948                                                                  05194831
051950                                                                  05195031
052000 1000-INITIALIZE.                                                 05200029
052100                                                                  05210029
052200     PERFORM 1100-GET-WEBSERVICE                                  05220029
052300     PERFORM 1200-GET-WEBSRVC-FUNCTION                            05230029
052400                                                                  05240029
052500     SET PS-EXDT-NT-NEED             TO TRUE                      05250029
052600     SET PS-ACT-NT-NEED              TO TRUE                      05260029
052700     SET PS-TO-NT-NEED               TO TRUE                      05270029
052800     SET PS-RKEYS-NT-NEED            TO TRUE                      05280029
052900     SET PS-CORID-NT-NEED            TO TRUE                      05290029
053000     SET PS-FAULT-NT-NEED            TO TRUE                      05300029
053100     SET PS-FROM-NT-NEED             TO TRUE                      05310029
053200     SET PS-MSGID-NT-NEED            TO TRUE                      05320029
053300     SET PS-CRDATM-NT-NEED           TO TRUE                      05330029
053400     SET PS-INRPTO-NT-NEED           TO TRUE                      05340029
053500                                                                  05350029
053600     INITIALIZE PV-RESP                                           05360029
053700                PV-HOST-NAME                                      05370029
053800                                                                  05380029
053900     MOVE 'TCPIPIUCVSTREAMS' TO PV-EZ-TOKEN                       05390029
054000     MOVE  8                 TO PV-EZ-COMMAND                     05400029
054100     MOVE  0                 TO PV-EZ-HZERO                       05410029
054200     MOVE  LOW-VALUES        TO PV-EZ-DZERO                       05420029
054300     MOVE  30                TO PV-EZ-NAMELEN                     05430029
054400     INITIALIZE              PV-EZ-NAME                           05440029
054500                             PV-EZ-ERRNO                          05450029
054600                             PV-EZ-RETCODE                        05460029
054700                                                                  05470029
054800     CALL 'EZACICAL'  USING PV-EZ-TOKEN                           05480029
054900                            PV-EZ-COMMAND                         05490029
055000                            PV-EZ-HZERO                           05500029
055100                            PV-EZ-DZERO                           05510029
055200                            PV-EZ-NAMELEN                         05520029
055300                            PV-EZ-NAME                            05530029
055400                            PV-EZ-ERRNO                           05540029
055500                            PV-EZ-RETCODE.                        05550029
055600                                                                  05560029
055700     MOVE PV-EZ-RETCODE TO PV-EZ-RETCODE2.                        05570029
055800     IF PV-EZ-RETCODE = 0                                         05580029
055900        STRING PV-EZ-NAME                                         05590029
056000               DELIMITED BY LOW-VALUE                             05600029
056100              '.KOHLS.COM'                                        05610029
056200               DELIMITED BY SIZE INTO PV-HOST-NAME                05620029
056300     END-IF                                                       05630029
056400                                                                  05640029
056500*    STRING 'SUKCS800: PV-HOST-NAME: '                            05650029
056600*           DELIMITED BY SIZE                                     05660029
056700*           PV-HOST-NAME                                          05670029
056800*           DELIMITED BY SIZE                                     05680029
056900*           'PV-EZ-RETCODE: '                                     05690029
057000*           DELIMITED BY SIZE                                     05700029
057100*           PV-EZ-RETCODE2                                        05710029
057200*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               05720029
057300*    PERFORM 9990-WRITE-CICS                                      05730029
057400     .                                                            05740029
057500                                                                  05750029
057600 1100-GET-WEBSERVICE.                                             05760029
057700                                                                  05770029
057800     INITIALIZE PV-RESP                                           05780029
057900                PV-WEBS-AREA                                      05790029
058000                                                                  05800029
058100     EXEC CICS                                                    05810029
058200          GET CONTAINER('DFHWS-WEBSERVICE')                       05820029
058300          INTO(PV-WEBS-AREA)                                      05830029
058400          FLENGTH(PV-WEBS-LEN)                                    05840029
058500          RESP(PV-RESP)                                           05850029
058600     END-EXEC                                                     05860029
058700                                                                  05870029
058800*    MOVE PV-RESP              TO PV-RESP-DISP                    05880029
058900*    STRING 'PV-RESP AFTER WEBSERVCE CONTAINER READ: '            05890029
059000*           DELIMITED BY SIZE                                     05900029
059100*           PV-RESP-DISP                                          05910029
059200*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               05920029
059300*    PERFORM 9990-WRITE-CICS                                      05930029
059400*    STRING 'PV-WEBS-AREA CONTAINER READ: '                       05940029
059500*           DELIMITED BY SIZE                                     05950029
059600*           PV-WEBS-AREA                                          05960029
059700*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               05970029
059800*    PERFORM 9990-WRITE-CICS                                      05980029
059900                                                                  05990029
060000     EVALUATE PV-RESP                                             06000029
060100        WHEN DFHRESP(CCSIDERR)                                    06010029
060200             EXEC CICS ABEND ABCODE('C001') END-EXEC              06020029
060300             CONTINUE                                             06030029
060400        WHEN DFHRESP(CONTAINERERR)                                06040029
060500             EXEC CICS ABEND ABCODE('C002') END-EXEC              06050029
060600             CONTINUE                                             06060029
060700        WHEN DFHRESP(INVREQ)                                      06070029
060800             EXEC CICS ABEND ABCODE('C003') END-EXEC              06080029
060900             CONTINUE                                             06090029
061000        WHEN DFHRESP(LENGERR)                                     06100029
061100             CONTINUE                                             06110029
061200        WHEN OTHER                                                06120029
061300             CONTINUE                                             06130029
061400     END-EVALUATE.                                                06140029
061500******************************************************************06150029
061600* READ DFHFUNCTION TO GET THE FUNCTION UNDER WHICH THIS PROGRAM   06160029
061700* IS INVOKED. IF THE FUNCTION IS NOT IN EITHER OF THE BELOW, THEN 06170029
061800* SKIP FURTHER PROCESSING AND EXIT THIS PROGRAM.                  06180029
061900* ALLOWED VALUES ARE:                                             06190029
062000*   1) SEND-REQUEST                                               06200029
062100*   2) RECEIVE-RESPONSE                                           06210029
062200*   3) RECEIVE-REQUEST                                            06220029
062300*   4) SEND-RESPONSE                                              06230029
062400******************************************************************06240029
062500*                                                                 06250029
062600 1200-GET-WEBSRVC-FUNCTION.                                       06260029
062700     INITIALIZE PV-RESP                                           06270029
062800                PV-FUNC-AREA                                      06280029
062900*    STRING  'GET CONTAINER DFHFUNCTION'                          06290029
063000*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              06300029
063100*    PERFORM 9990-WRITE-CICS                                      06310029
063200                                                                  06320029
063300     EXEC CICS                                                    06330029
063400          GET CONTAINER('DFHFUNCTION')                            06340029
063500          INTO(PV-FUNC-AREA)                                      06350029
063600          FLENGTH(PV-FUNC-LEN)                                    06360029
063700          RESP(PV-RESP)                                           06370029
063800     END-EXEC                                                     06380029
063900                                                                  06390029
064000                                                                  06400029
064100*    MOVE PV-RESP              TO PV-RESP-DISP                    06410029
064200*    STRING 'PV-RESP AFTER DFHFUNCTION READ: '                    06420029
064300*           DELIMITED BY SIZE                                     06430029
064400*           PV-RESP-DISP                                          06440029
064500*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               06450029
064600*    PERFORM 9990-WRITE-CICS                                      06460029
064700*    STRING 'PV-FUNC-AREA CONTAINER READ: '                       06470029
064800*           DELIMITED BY SIZE                                     06480029
064900*           PV-FUNC-AREA                                          06490029
065000*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               06500029
065100*    PERFORM 9990-WRITE-CICS                                      06510029
065200     EVALUATE PV-RESP                                             06520029
065300        WHEN DFHRESP(CCSIDERR)                                    06530029
065400             EXEC CICS ABEND ABCODE('C005') END-EXEC              06540029
065500             CONTINUE                                             06550029
065600        WHEN DFHRESP(CONTAINERERR)                                06560029
065700             EXEC CICS ABEND ABCODE('C006') END-EXEC              06570029
065800             CONTINUE                                             06580029
065900        WHEN DFHRESP(INVREQ)                                      06590029
066000             EXEC CICS ABEND ABCODE('C007') END-EXEC              06600029
066100             CONTINUE                                             06610029
066200        WHEN DFHRESP(LENGERR)                                     06620029
066300             EXEC CICS ABEND ABCODE('C008') END-EXEC              06630029
066400             CONTINUE                                             06640029
066500     END-EVALUATE                                                 06650029
066600                                                                  06660029
066700     SET PS-SKIP-FUNCTION            TO TRUE                      06670029
066800     EVALUATE PV-FUNC-AREA                                        06680029
066900        WHEN 'SEND-REQUEST'                                       06690029
067000             SET PS-FUNC-SEND-REQ      TO TRUE                    06700029
067100        WHEN 'SEND-RESPONSE'                                      06710029
067200             SET PS-FUNC-SEND-RESP     TO TRUE                    06720029
067300        WHEN 'RECEIVE-REQUEST'                                    06730029
067400             SET PS-FUNC-REC-REQ       TO TRUE                    06740029
067500        WHEN 'RECEIVE-RESPONSE'                                   06750029
067600             SET PS-FUNC-REC-RESP      TO TRUE                    06760029
067700        WHEN OTHER                                                06770029
067800             SET PS-SKIP-FUNCTION      TO TRUE                    06780029
067900     END-EVALUATE.                                                06790029
068000                                                                  06800029
068100******************************************************************06810029
068200* READ CONFIG FILE FOR THE WEBSERVICE AND FUNCTION TO READ CONTROL06820029
068300* PARAMETERS. IF NO ROW FOUND, THEN REPLACE WEBSERVICE NAME WITH  06830029
068400* A DEFAULT WEBSERVICE NAME 'DEFAULT' AND TRY READING AGAIN       06840029
068500******************************************************************06850029
068600 2000-SUB-PROCESS-1.                                              06860029
068700                                                                  06870029
068800     INITIALIZE PV-CURR-DATE                                      06880029
068900                PV-IN-MSG-CORRID                                  06890029
069000                PV-IN-MSG-INRPTO.                                 06900029
069100                                                                  06910029
069200     PERFORM 1008-GENERATE-UTC.                                   06920029
069300                                                                  06930029
069400     MOVE PV-UTC-DATE        TO PV-CURR-DATE                      06940029
069500                                                                  06950029
069600     INITIALIZE SU131-CA-CONFIG-RECORD                            06960029
069700                PV-CONFIG-RECORD                                  06970029
069800                                                                  06980029
069900     PERFORM VARYING PV-STR-INDEX FROM 1 BY 1                     06990029
070000        UNTIL PV-STR-INDEX > 99                                   07000029
070100                                                                  07010029
070200        MOVE SPACES           TO PV-SECTION-NAME(PV-STR-INDEX)    07020029
070300                                                                  07030029
070400     END-PERFORM.                                                 07040029
070500                                                                  07050029
070600     MOVE PV-FUNC-AREA        TO SU131-FUNC-AREA                  07060029
070700     MOVE PV-WEBS-AREA        TO SU131-WEBS-AREA                  07070029
070800     MOVE 1                   TO SU131-SEQ-NO                     07080029
070900                                                                  07090029
071000     PERFORM 7000-VSAM-FILE-READ                                  07100029
071100                                                                  07110029
071200*    MOVE   PV-RESP            TO PV-RESP-DISP                    07120029
071300*    STRING 'VSAM FILE READ. PV-RESP: '                           07130029
071400*           DELIMITED BY SIZE                                     07140029
071500*           PV-RESP-DISP                                          07150029
071600*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               07160029
071700*    PERFORM 9990-WRITE-CICS                                      07170029
071800                                                                  07180029
071900     EVALUATE PV-RESP                                             07190029
072000                                                                  07200029
072100        WHEN 0                                                    07210029
072200                                                                  07220029
072300            CONTINUE                                              07230029
072400                                                                  07240029
072500        WHEN 13                                                   07250029
072600                                                                  07260029
072700            MOVE PV-DEFAULT-WEBS     TO SU131-WEBS-AREA           07270029
072800                                                                  07280029
072900            PERFORM 7000-VSAM-FILE-READ                           07290029
073000                                                                  07300029
073100*           MOVE   PV-RESP           TO PV-RESP-DISP              07310029
073200*           STRING  'VSAM FILE READ2 PV-RESP: '                   07320029
073300*                   DELIMITED BY SIZE                             07330029
073400*                   PV-RESP-DISP                                  07340029
073500*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       07350029
073600*           PERFORM 9990-WRITE-CICS                               07360029
073700                                                                  07370029
073800            IF PV-RESP = 13                                       07380029
073900               EXEC CICS ABEND ABCODE('C010') END-EXEC            07390029
074000               CONTINUE                                           07400029
074100            END-IF                                                07410029
074200                                                                  07420029
074300        WHEN OTHER                                                07430029
074400            EXEC CICS ABEND ABCODE('C011') END-EXEC               07440029
074500     END-EVALUATE.                                                07450029
074600                                                                  07460029
074700* UNSTRING PV-CONFIG-RECORD                                       07470029
074800     MOVE PV-CONFIG-RECORD           TO SU131-CA-CONFIG-RECORD    07480029
074900     MOVE 1                          TO PV-STRING-PTR-1           07490029
075000     SET PS-CONT-THE-LOOP            TO TRUE                      07500029
075100                                                                  07510029
075200     PERFORM VARYING PV-STR-INDEX FROM 1 BY 1                     07520029
075300        UNTIL PV-STR-INDEX > 99 OR                                07530029
075400        PS-BREAK-THE-LOOP                                         07540029
075500                                                                  07550029
075600        UNSTRING SU131-FREE-TEXT DELIMITED BY ';'                 07560029
075700                 INTO PV-SECTION-NAME(PV-STR-INDEX)               07570029
075800                 WITH POINTER PV-STRING-PTR-1                     07580029
075900        END-UNSTRING                                              07590029
076000                                                                  07600029
076100        IF PV-SECTION-NAME(PV-STR-INDEX) = SPACES                 07610029
076200           SET PS-BREAK-THE-LOOP   TO TRUE                        07620029
076300        END-IF                                                    07630029
076400                                                                  07640029
076500     END-PERFORM                                                  07650029
076600                                                                  07660029
076700     SET PS-VALIDATE-PASS        TO TRUE                          07670029
076800     SET PS-CONT-THE-LOOP1       TO TRUE                          07680029
076900     MOVE 1                      TO PV-STR-INDEX1                 07690029
077000                                                                  07700029
077100     PERFORM UNTIL PV-STR-INDEX1 > PV-STR-INDEX                   07710029
077200     OR PS-BREAK-THE-LOOP1                                        07720029
077300                                                                  07730029
077400*       STRING 'READING SECTIONS: '                               07740029
077500*               PV-SECTION-NAME(PV-STR-INDEX1)                    07750029
077600*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           07760029
077700*       PERFORM 9990-WRITE-CICS                                   07770029
077800                                                                  07780029
077900        EVALUATE PV-SECTION-NAME(PV-STR-INDEX1)                   07790029
078000           WHEN 'KMHLOG'                                          07800029
078100                                                                  07810029
078200                PERFORM 2100-KMHLOG                               07820029
078300                                                                  07830029
078400           WHEN 'KMHVAL'                                          07840029
078500                                                                  07850029
078600                PERFORM 2200-KMHVAL                               07860029
078700                                                                  07870029
078800           WHEN 'KMHPREP'                                         07880029
078900                                                                  07890029
079000                PERFORM 2300-KMHPREP                              07900029
079100                                                                  07910029
079200           WHEN OTHER                                             07920029
079300                                                                  07930029
079400                SET PS-BREAK-THE-LOOP1  TO TRUE                   07940029
079500                CONTINUE                                          07950029
079600                                                                  07960029
079700        END-EVALUATE                                              07970029
079800                                                                  07980029
079900        ADD 1                       TO PV-STR-INDEX1              07990029
080000     END-PERFORM                                                  08000029
080100     .                                                            08010029
080200******************************************************************08020029
080300* THIS SECTION RETRIEVES KMH AND LOGS IT                          08030029
080400* 1) IN CASE OF SEND-REQUEST, KMH SHOULD HAVE BEEN PREPARED FIRST,08040029
080500*    TO BE LOGGED. SO, USE THE VALUES FROM KMHPREP                08050029
080600* 2) IN CASE OF SEND-RESPONSE TOO, SAME APPLIES                   08060029
080700* 3) IN ALL OTHER CASES, RETRIEVE THE JUST RECEIVED KMH AND LOG   08070029
080800******************************************************************08080029
080900 2100-KMHLOG.                                                     08090029
081000                                                                  08100029
081100*    STRING 'INSIDE 2100-KMHLOG'                                  08110029
081200*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              08120029
081300*    PERFORM 9990-WRITE-CICS                                      08130029
081400                                                                  08140029
081500     INITIALIZE PV-IN-MSG-MSGID                                   08150029
081600                PV-IN-MSG-CRDT                                    08160029
081700                PV-IN-MSG-SYSCD                                   08170029
081800                PV-IN-MSG-APPCD                                   08180029
081900                PV-IN-MSG-MODCD                                   08190029
082000                PV-IN-MSG-NODID                                   08200029
082100                PV-HEADER-LOG-MSG                                 08210029
082200                                                                  08220029
082300     IF PS-FUNC-SEND-REQ OR                                       08230029
082400        PS-FUNC-SEND-RESP                                         08240029
082500                                                                  08250029
082600        MOVE PV-NEW-MESSAGE-ID    TO  PV-IN-MSG-MSGID             08260029
082700        MOVE PV-UTC-DATE          TO  PV-IN-MSG-CRDT              08270029
082800        MOVE PV-NEW-SYSTEM-CD     TO  PV-IN-MSG-SYSCD             08280029
082900        MOVE PV-NEW-APP           TO  PV-IN-MSG-APPCD             08290029
083000        MOVE PV-NEW-MODULE        TO  PV-IN-MSG-MODCD             08300029
083100        MOVE PV-NEW-NODEID        TO  PV-IN-MSG-NODID             08310029
083200                                                                  08320029
083300     ELSE                                                         08330029
083400                                                                  08340029
083500        PERFORM 2110-RETRIEVE-KMH                                 08350029
083600                                                                  08360029
083700        IF PS-RETR-NO-ERROR                                       08370029
083800                                                                  08380029
083900           PERFORM 2120-READ-CONFIG-MANDATE                       08390029
084000           PERFORM 2130-PARSE-KMH                                 08400029
084100                                                                  08410029
084200        END-IF                                                    08420029
084300                                                                  08430029
084400*       STRING '2100-KMHLOG; INCOMING KM HEADER IS: '             08440029
084500*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08450029
084600*       PERFORM 9990-WRITE-CICS                                   08460029
084700*       STRING 'PV-IN-MSG-MSGID: ' PV-IN-MSG-MSGID                08470029
084800*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08480029
084900*       PERFORM 9990-WRITE-CICS                                   08490029
085000*       STRING 'PV-IN-MSG-CRDT : ' PV-IN-MSG-CRDT                 08500029
085100*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08510029
085200*       PERFORM 9990-WRITE-CICS                                   08520029
085300*       STRING 'PV-IN-MSG-SYSCD: ' PV-IN-MSG-SYSCD                08530029
085400*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08540029
085500*       PERFORM 9990-WRITE-CICS                                   08550029
085600*       STRING 'PV-IN-MSG-APPCD: ' PV-IN-MSG-APPCD                08560029
085700*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08570029
085800*       PERFORM 9990-WRITE-CICS                                   08580029
085900*       STRING 'PV-IN-MSG-MODCD: ' PV-IN-MSG-MODCD                08590029
086000*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08600029
086100*       PERFORM 9990-WRITE-CICS                                   08610029
086200*       STRING 'PV-IN-MSG-NODID: ' PV-IN-MSG-NODID                08620029
086300*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08630029
086400*       PERFORM 9990-WRITE-CICS                                   08640029
086500*       STRING 'TOTAL KMH IS: '                                   08650029
086600*               PV-RETR-KMH-AREA(1:80)                            08660029
086700*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08670029
086800*       PERFORM 9990-WRITE-CICS                                   08680029
086900*       STRING  PV-RETR-KMH-AREA(81:160)                          08690029
087000*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08700029
087100*       PERFORM 9990-WRITE-CICS                                   08710029
087200*       STRING  PV-RETR-KMH-AREA(161:240)                         08720029
087300*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08730029
087400*       PERFORM 9990-WRITE-CICS                                   08740029
087500*       STRING  PV-RETR-KMH-AREA(241:320)                         08750029
087600*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08760029
087700*       PERFORM 9990-WRITE-CICS                                   08770029
087800*       STRING  PV-RETR-KMH-AREA(321:400)                         08780029
087900*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08790029
088000*       PERFORM 9990-WRITE-CICS                                   08800029
088100     END-IF                                                       08810029
088200                                                                  08820029
088300     INITIALIZE PV-FROM-SPACE-CNT                                 08830029
088400                PV-SYS-CD-LEN                                     08840029
088500                PV-APP-CD-LEN                                     08850029
088600                PV-MOD-CD-LEN                                     08860029
088700                PV-NOD-ID-LEN                                     08870029
088800                PV-HDR-SPACE-CNT                                  08880029
088900                PV-HDR-CUR-CNT                                    08890029
089000                PV-TEMP-LOG-MSG                                   08900029
089100                PV-FAULT-SPACE-CNT                                08910029
089200                PV-FLT-CD-LEN                                     08920029
089300                PV-FLT-DS-LEN                                     08930029
089400                                                                  08940029
089500     INSPECT FUNCTION REVERSE(PV-IN-MSG-SYSCD)                    08950029
089600             TALLYING PV-FROM-SPACE-CNT                           08960029
089700             FOR LEADING SPACES                                   08970029
089800                                                                  08980029
089900     COMPUTE PV-SYS-CD-LEN = LENGTH OF PV-IN-MSG-SYSCD -          08990029
090000                             PV-FROM-SPACE-CNT                    09000029
090100**                                                                09010029
090200     INITIALIZE PV-FROM-SPACE-CNT                                 09020029
090300                                                                  09030029
090400     INSPECT FUNCTION REVERSE(PV-IN-MSG-APPCD)                    09040029
090500             TALLYING PV-FROM-SPACE-CNT                           09050029
090600             FOR LEADING SPACES                                   09060029
090700                                                                  09070029
090800     COMPUTE PV-APP-CD-LEN = LENGTH OF PV-IN-MSG-APPCD -          09080029
090900                             PV-FROM-SPACE-CNT                    09090029
091000**                                                                09100029
091100     INITIALIZE PV-FROM-SPACE-CNT                                 09110029
091200                                                                  09120029
091300     INSPECT FUNCTION REVERSE(PV-IN-MSG-MODCD)                    09130029
091400             TALLYING PV-FROM-SPACE-CNT                           09140029
091500             FOR LEADING SPACES                                   09150029
091600                                                                  09160029
091700     COMPUTE PV-MOD-CD-LEN = LENGTH OF PV-IN-MSG-MODCD -          09170029
091800                             PV-FROM-SPACE-CNT                    09180029
091900**                                                                09190029
092000     INITIALIZE PV-FROM-SPACE-CNT                                 09200029
092100     INSPECT FUNCTION REVERSE(PV-IN-MSG-NODID)                    09210029
092200             TALLYING PV-FROM-SPACE-CNT                           09220029
092300             FOR LEADING SPACES                                   09230029
092400                                                                  09240029
092500     COMPUTE PV-NOD-ID-LEN = LENGTH OF PV-IN-MSG-NODID -          09250029
092600                             PV-FROM-SPACE-CNT                    09260029
092700                                                                  09270029
092800     IF PS-FUNC-SEND-RESP OR PS-FUNC-SEND-REQ                     09280029
092900        OR ( PS-FUNC-REC-REQ AND PS-VALIDATE-FAIL)                09290029
093000                                                                  09300029
093100        MOVE PV-LITERAL-KMH-VER TO PV-STOR-KMH-VER                09310029
093200                                                                  09320029
093300     END-IF                                                       09330029
093400                                                                  09340029
093500     IF PS-FUNC-SEND-RESP OR PS-FUNC-REC-RESP                     09350029
093600                                                                  09360029
093700        STRING PV-CURR-DATE DELIMITED BY SIZE                     09370029
093800               '||INFO||{' DELIMITED BY SIZE                      09380029
093900               '"MessageHeader":{"version":"' DELIMITED BY SIZE   09390029
094000               PV-STOR-KMH-VER                                    09400029
094100               '","MessageID":"'                                  09410029
094200               DELIMITED BY SIZE                                  09420029
094300               PV-IN-MSG-MSGID DELIMITED BY SPACE                 09430029
094400               '","CreateDateTime":"' DELIMITED BY SIZE           09440029
094500               PV-IN-MSG-CRDT DELIMITED BY SIZE                   09450029
094600               '","From":{"systemCode":"' DELIMITED BY SIZE       09460029
094700               PV-IN-MSG-SYSCD(1: PV-SYS-CD-LEN)                  09470029
094800               '","app":"' DELIMITED BY SIZE                      09480029
094900               PV-IN-MSG-APPCD(1: PV-APP-CD-LEN)                  09490029
095000               '","module":"' DELIMITED BY SIZE                   09500029
095100               PV-IN-MSG-MODCD(1: PV-MOD-CD-LEN)                  09510029
095200               '","nodeID":"' DELIMITED BY SIZE                   09520029
095300               PV-IN-MSG-NODID(1:PV-NOD-ID-LEN)                   09530029
095400               '"}'                                               09540029
095500               DELIMITED BY SIZE                                  09550029
095600               INTO PV-HEADER-LOG-MSG                             09560029
095700                                                                  09570029
095800      IF PV-IN-MSG-INRPTO NOT = SPACES                            09580029
095900                                                                  09590029
096000         INITIALIZE PV-HDR-SPACE-CNT                              09600029
096100                    PV-HDR-CUR-CNT                                09610029
096200                    PV-TEMP-LOG-MSG                               09620029
096300                                                                  09630029
096400         INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)              09640029
096500                 TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES     09650029
096600                                                                  09660029
096700         COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -   09670029
096800                                  PV-HDR-SPACE-CNT + 1            09680029
096900                                                                  09690029
097000         STRING ',"InReplyTo":"' DELIMITED BY SIZE                09700029
097100                PV-IN-MSG-INRPTO                                  09710029
097200                '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG        09720029
097300                                                                  09730029
097400         MOVE PV-TEMP-LOG-MSG    TO                               09740029
097500              PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)                  09750029
097600                                                                  09760029
097700      ELSE                                                        09770029
097800                                                                  09780029
097900         IF PS-FUNC-SEND-RESP                                     09790029
098000                                                                  09800029
098100         INITIALIZE PV-HDR-SPACE-CNT                              09810029
098200                    PV-HDR-CUR-CNT                                09820029
098300                    PV-TEMP-LOG-MSG                               09830029
098400                                                                  09840029
098500         INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)              09850029
098600         TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES             09860029
098700                                                                  09870029
098800         COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -   09880029
098900                                  PV-HDR-SPACE-CNT + 1            09890029
099000                                                                  09900029
099100         STRING ',"InReplyTo":"' DELIMITED BY SIZE                09910029
099200                PV-STOR-IRP-TO                                    09920029
099300                '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG        09930029
099400                                                                  09940029
099500         MOVE PV-TEMP-LOG-MSG    TO                               09950029
099600              PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)                  09960029
099700                                                                  09970029
099800       END-IF                                                     09980029
099900      END-IF                                                      09990029
100000                                                                  10000029
100100      IF PV-IN-MSG-CORRID NOT = SPACES                            10010029
100200                                                                  10020029
100300        INITIALIZE PV-HDR-SPACE-CNT                               10030029
100400                   PV-HDR-CUR-CNT                                 10040029
100500                   PV-TEMP-LOG-MSG                                10050029
100600                                                                  10060029
100700        INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)               10070029
100800        TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES              10080029
100900                                                                  10090029
101000        COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -    10100029
101100                                 PV-HDR-SPACE-CNT + 1             10110029
101200                                                                  10120029
101300        STRING ',"CorrelationID":"' DELIMITED BY SIZE             10130029
101400        PV-IN-MSG-CORRID                                          10140029
101500        '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG                10150029
101600                                                                  10160029
101700        MOVE PV-TEMP-LOG-MSG    TO                                10170029
101800                           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)     10180029
101900                                                                  10190029
102000      ELSE                                                        10200029
102100                                                                  10210029
102200       IF PS-FUNC-SEND-RESP                                       10220029
102300                                                                  10230029
102400        INITIALIZE PV-HDR-SPACE-CNT                               10240029
102500                   PV-HDR-CUR-CNT                                 10250029
102600                   PV-TEMP-LOG-MSG                                10260029
102700                                                                  10270029
102800        INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)               10280029
102900        TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES              10290029
103000                                                                  10300029
103100        COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -    10310029
103200                                 PV-HDR-SPACE-CNT + 1             10320029
103300                                                                  10330029
103400        STRING ',"CorrelationID":"' DELIMITED BY SIZE             10340029
103500        PV-STOR-IRP-TO                                            10350029
103600        '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG                10360029
103700                                                                  10370029
103800        MOVE PV-TEMP-LOG-MSG    TO                                10380029
103900                           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)     10390029
104000                                                                  10400029
104100       END-IF                                                     10410029
104200      END-IF                                                      10420029
104300                                                                  10430029
104400*     DISPLAY 'PV-HEADER-LOG-MSG: ' PV-HEADER-LOG-MSG             10440029
104500      IF PS-IN-MSG-FAULT-F                                        10450029
104600**                                                                10460029
104700                                                                  10470029
104800        INITIALIZE PV-FAULT-SPACE-CNT                             10480029
104900                                                                  10490029
105000        INSPECT FUNCTION REVERSE(PV-IN-MSG-FAULT-CD)              10500029
105100                TALLYING PV-FAULT-SPACE-CNT                       10510029
105200                FOR LEADING SPACES                                10520029
105300                                                                  10530029
105400        COMPUTE PV-FLT-CD-LEN = LENGTH OF PV-IN-MSG-FAULT-CD -    10540029
105500                                PV-FAULT-SPACE-CNT                10550029
105600**                                                                10560029
105700        INITIALIZE PV-FAULT-SPACE-CNT                             10570029
105800                                                                  10580029
105900        INSPECT FUNCTION REVERSE(PV-IN-MSG-FAULT-DES)             10590029
106000                TALLYING PV-FAULT-SPACE-CNT                       10600029
106100                FOR LEADING SPACES                                10610029
106200        COMPUTE PV-FLT-DS-LEN = LENGTH OF PV-IN-MSG-FAULT-DES -   10620029
106300                                PV-FAULT-SPACE-CNT                10630029
106400**                                                                10640029
106500        INITIALIZE PV-HDR-SPACE-CNT                               10650029
106600                   PV-HDR-CUR-CNT                                 10660029
106700                   PV-TEMP-LOG-MSG                                10670029
106800                                                                  10680029
106900        INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)               10690029
107000                TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES      10700029
107100                                                                  10710029
107200        COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -    10720029
107300                                 PV-HDR-SPACE-CNT + 1             10730029
107400                                                                  10740029
107500        STRING ',"Fault":{"Code":"' DELIMITED BY SIZE             10750029
107600               PV-IN-MSG-FAULT-CD(1: PV-FLT-CD-LEN)               10760029
107700               '","Description":"' DELIMITED BY SIZE              10770029
107800               PV-IN-MSG-FAULT-DES(1: PV-FLT-DS-LEN)              10780029
107900               '"}'                                               10790029
108000               DELIMITED BY SIZE                                  10800029
108100               INTO PV-TEMP-LOG-MSG                               10810029
108200                                                                  10820029
108300        MOVE PV-TEMP-LOG-MSG    TO                                10830029
108400             PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)                   10840029
108500      END-IF                                                      10850029
108600      INITIALIZE PV-HDR-SPACE-CNT                                 10860029
108700                 PV-HDR-CUR-CNT                                   10870029
108800                 PV-TEMP-LOG-MSG                                  10880029
108900      INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)                 10890029
109000              TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES        10900029
109100      COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -      10910029
109200                               PV-HDR-SPACE-CNT + 1               10920029
109300      MOVE '}}'                TO                                 10930029
109400           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)                     10940029
109500                                                                  10950029
109600*     DISPLAY 'PV-HEADER-LOG-MSG 2: ' PV-HEADER-LOG-MSG           10960029
109700                                                                  10970029
109800     ELSE                                                         10980029
109900                                                                  10990029
110000        STRING PV-CURR-DATE DELIMITED BY SIZE                     11000029
110100               '||INFO||{' DELIMITED BY SIZE                      11010029
110200               '"MessageHeader":{"version":"' DELIMITED BY SIZE   11020029
110300               PV-STOR-KMH-VER                                    11030029
110400               '","MessageID":"'                                  11040029
110500               DELIMITED BY SIZE                                  11050029
110600               PV-IN-MSG-MSGID DELIMITED BY SPACE                 11060029
110700               '","CreateDateTime":"' DELIMITED BY SIZE           11070029
110800               PV-IN-MSG-CRDT DELIMITED BY SIZE                   11080029
110900               '","From":{"systemCode":"' DELIMITED BY SIZE       11090029
111000               PV-IN-MSG-SYSCD(1: PV-SYS-CD-LEN)                  11100029
111100               '","app":"' DELIMITED BY SIZE                      11110029
111200               PV-IN-MSG-APPCD(1: PV-APP-CD-LEN)                  11120029
111300               '","module":"' DELIMITED BY SIZE                   11130029
111400               PV-IN-MSG-MODCD(1: PV-MOD-CD-LEN)                  11140029
111500               '","nodeID":"' DELIMITED BY SIZE                   11150029
111600               PV-IN-MSG-NODID(1:PV-NOD-ID-LEN)                   11160029
111700               '"}' DELIMITED BY SIZE                             11170029
111800               INTO PV-HEADER-LOG-MSG                             11180029
111900                                                                  11190029
112000        IF PV-IN-MSG-INRPTO NOT = SPACES                          11200029
112100                                                                  11210029
112200           INITIALIZE PV-HDR-SPACE-CNT                            11220029
112300                      PV-HDR-CUR-CNT                              11230029
112400                      PV-TEMP-LOG-MSG                             11240029
112500                                                                  11250029
112600          INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)             11260029
112700          TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES            11270029
112800                                                                  11280029
112900          COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -  11290029
113000                                   PV-HDR-SPACE-CNT + 1           11300029
113100                                                                  11310029
113200          STRING ',"InReplyTo":"' DELIMITED BY SIZE               11320029
113300          PV-IN-MSG-INRPTO                                        11330029
113400          '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG              11340029
113500                                                                  11350029
113600          MOVE PV-TEMP-LOG-MSG    TO                              11360029
113700                             PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)   11370029
113800                                                                  11380029
113900        END-IF                                                    11390029
114000                                                                  11400029
114100        IF PV-IN-MSG-CORRID NOT = SPACES                          11410029
114200                                                                  11420029
114300          INITIALIZE PV-HDR-SPACE-CNT                             11430029
114400                     PV-HDR-CUR-CNT                               11440029
114500                     PV-TEMP-LOG-MSG                              11450029
114600                                                                  11460029
114700          INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)             11470029
114800          TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES            11480029
114900                                                                  11490029
115000          COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -  11500029
115100                                   PV-HDR-SPACE-CNT + 1           11510029
115200                                                                  11520029
115300          STRING ',"CorrelationID":"' DELIMITED BY SIZE           11530029
115400          PV-IN-MSG-CORRID                                        11540029
115500          '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG              11550029
115600                                                                  11560029
115700          MOVE PV-TEMP-LOG-MSG    TO                              11570029
115800                             PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)   11580029
115900                                                                  11590029
116000        END-IF                                                    11600029
116100                                                                  11610029
116200        IF  PS-VALIDATE-FAIL AND PS-FUNC-REC-REQ                  11620029
116300                                                                  11630029
116400           INITIALIZE PV-HDR-SPACE-CNT                            11640029
116500                      PV-HDR-CUR-CNT                              11650029
116600                      PV-TEMP-LOG-MSG                             11660029
116700           INITIALIZE PV-FAULT-SPACE-CNT                          11670029
116800                                                                  11680029
116900           INSPECT FUNCTION REVERSE(PV-FAULT-MSG)                 11690029
117000            TALLYING PV-FAULT-SPACE-CNT                           11700029
117100            FOR LEADING SPACES                                    11710029
117200                                                                  11720029
117300           COMPUTE PV-FLT-DS-LEN = LENGTH OF PV-FAULT-MSG -       11730029
117400           PV-FAULT-SPACE-CNT                                     11740029
117500                                                                  11750029
117600           STRING ',"Fault":{"Code":"' DELIMITED BY SIZE          11760029
117700           'BAD MESSAGE HEADER ELEMENT' DELIMITED BY SIZE         11770029
117800           '","Description":"' DELIMITED BY SIZE                  11780029
117900           PV-FAULT-MSG(1: PV-FLT-DS-LEN)                         11790029
118000           '"}'                                                   11800029
118100           DELIMITED BY SIZE                                      11810029
118200           INTO PV-TEMP-LOG-MSG                                   11820029
118300                                                                  11830029
118400           INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)            11840029
118500           TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES           11850029
118600                                                                  11860029
118700           COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG - 11870029
118800                                    PV-HDR-SPACE-CNT + 1          11880029
118900                                                                  11890029
119000           MOVE PV-TEMP-LOG-MSG    TO                             11900029
119100                           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)     11910029
119200                                                                  11920029
119300        END-IF                                                    11930029
119400                                                                  11940029
119500        INITIALIZE PV-HDR-SPACE-CNT                               11950029
119600                   PV-HDR-CUR-CNT                                 11960029
119700                   PV-TEMP-LOG-MSG                                11970029
119800                                                                  11980029
119900        INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)               11990029
120000        TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES              12000029
120100                                                                  12010029
120200        COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -    12020029
120300                                 PV-HDR-SPACE-CNT + 1             12030029
120400                                                                  12040029
120500        MOVE '}}'                TO                               12050029
120600                           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT: 2)   12060029
120700        COMPUTE PV-HDR-CUR-CNT = PV-HDR-CUR-CNT + 2               12070029
120800                                                                  12080029
120900        MOVE SPACES              TO                               12090029
121000                           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT :)    12100029
121100                                                                  12110029
121200     END-IF                                                       12120029
121300                                                                  12130029
121400     INITIALIZE PV-HDR-LOG-SPACE-CNT                              12140029
121500                                                                  12150029
121600     MOVE 1                 TO PV-CSS-DSP-LEN                     12160029
121700     MOVE 80                TO PV-CSS-DSP-TO-LEN                  12170029
121800     MOVE LENGTH OF PV-HEADER-LOG-MSG TO PV-HEADER-LOG-LEN        12180029
121900*    DISPLAY ' PV-HEADER-LOG-LEN 1 : ' PV-HEADER-LOG-LEN          12190029
122000**                                                                12200029
122100                                                                  12210029
122200     INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)                  12220029
122300      TALLYING PV-HDR-LOG-SPACE-CNT                               12230029
122400      FOR LEADING SPACES                                          12240029
122500                                                                  12250029
122600     COMPUTE PV-HEADER-LOG-LEN = PV-HEADER-LOG-LEN -              12260029
122700     PV-HDR-LOG-SPACE-CNT                                         12270029
122800                                                                  12280029
122900     INITIALIZE DCLDBT00024                                       12290029
123000     MOVE PV-HDR-APP-ID      TO DBT00024-APPL-ID                  12300029
123100     MOVE PV-WEBS-AREA       TO DBT00024-WEB-SRVC-NM              12310029
123200     MOVE PV-IN-MSG-MSGID    TO DBT00024-MSG-ID                   12320029
123300     MOVE PV-HEADER-LOG-LEN  TO DBT00024-MSG-TXT-LEN              12330029
123400     MOVE PV-HEADER-LOG-MSG(1 : PV-HEADER-LOG-LEN)                12340029
123500                             TO DBT00024-MSG-TXT-TEXT             12350029
123600                                                                  12360029
123700     EXEC SQL                                                     12370029
123800          INSERT                                                  12380029
123900          INTO DBT_WEB_SRVC_HDR_LOG                               12390029
124000                         ( APPL_ID                                12400029
124100                          ,WEB_SRVC_NM                            12410029
124200                          ,MSG_ID                                 12420029
124300                          ,MSG_TXT                                12430029
124400                          ,CRE_TMST                               12440029
124500                         )                                        12450029
124600          VALUES                                                  12460029
124700                         (                                        12470029
124800                           :DBT00024-APPL-ID                      12480029
124900                          ,:DBT00024-WEB-SRVC-NM                  12490029
125000                          ,:DBT00024-MSG-ID                       12500029
125100                          ,:DBT00024-MSG-TXT                      12510029
125200                          ,CURRENT_TIMESTAMP                      12520029
125300                         )                                        12530029
125400     END-EXEC                                                     12540029
125500                                                                  12550029
125600     EVALUATE TRUE                                                12560029
125700        WHEN SQLCODE = 0                                          12570029
125800             CONTINUE                                             12580029
125900        WHEN OTHER                                                12590029
126000             MOVE SQLCODE TO PV-SQLCODE-DISP                      12600029
126100             STRING  'INSERT ERROR SQL CODE: '                    12610029
126200                      DELIMITED BY SIZE                           12620029
126300                      PV-SQLCODE-DISP                             12630029
126400                     'INSERT ERROR SQLSTATE: '                    12640029
126500                      SQLSTATE                                    12650029
126600                      DELIMITED BY SIZE INTO PV-CICS-MSG-AREA     12660029
126700              PERFORM 9990-WRITE-CICS                             12670029
126800     END-EVALUATE                                                 12680029
126900                                                                  12690029
127000*    PERFORM UNTIL PV-CSS-DSP-LEN > PV-HEADER-LOG-LEN             12700029
127100                                                                  12710029
127200*       STRING PV-HEADER-LOG-MSG(PV-CSS-DSP-LEN:PV-CSS-DSP-TO-LEN)12720029
127300*              DELIMITED BY SIZE INTO PV-CICS-MSG-AREA            12730029
127400*       PERFORM 9990-WRITE-CICS                                   12740029
127500*       COMPUTE PV-CSS-DSP-LEN = 1 + PV-CSS-DSP-TO-LEN            12750029
127600*       COMPUTE PV-CSS-DSP-TO-LEN = 80 + PV-CSS-DSP-TO-LEN        12760029
127700                                                                  12770029
127800*    END-PERFORM                                                  12780029
127900           .                                                      12790029
128000******************************************************************12800029
128100* THIS SECTION PERFORMS THE BELOW STEPS:                          12810029
128200* 1) RETRIEVE KMH HEADER                                          12820029
128300* 2) PARSE KMH HEADER                                             12830029
128400* 3) RETRIEVE MANDATORY FIELD INFORMATION FROM CONFIG FILE LOOKUP 12840029
128500* 4) CHECK IF MANDATORY FIELDS ARE PRESENT                        12850029
128600* 5) IF ERROR OCCURED:                                            12860029
128700*    IF DFHFUNCTION 'RECEIVE RESPONSE', LOG IT IN SPOOL AND QUIT  12870029
128800*    IF DFHFUNCTION 'RECEIVE REQUEST', THEN                       12880029
128900*    A) READ CONFIG FILE WITH 'SEND-RESPONSE' FOR OUTBOUND LOGIC  12890029
129000*    B) SET A VALIDATION ERROR FLAG TO TRUE AND LOG MSG IN SPOOL  12900029
129100*    C) IF APPLICABLE, PERFORM KMHPREPARE                         12910029
129200*    D) IF APPLICABLE, PERFORM NEW KMHLOG                         12920029
129300*    E) CREATE SOAP FAULT                                         12930029
129400******************************************************************12940029
129500 2200-KMHVAL.                                                     12950029
129600                                                                  12960029
129700*    STRING 'INSIDE 2200-KMHVAL'                                  12970029
129800*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              12980029
129900*    PERFORM 9990-WRITE-CICS                                      12990029
130000                                                                  13000029
130100     SET PS-RETR-ERROR       TO TRUE                              13010029
130200     INITIALIZE PV-IN-MSG-MSGID                                   13020029
130300                PV-IN-MSG-CRDT                                    13030029
130400                PV-IN-MSG-SYSCD                                   13040029
130500                PV-IN-MSG-APPCD                                   13050029
130600                PV-IN-MSG-MODCD                                   13060029
130700                PV-IN-MSG-NODID                                   13070029
130800                                                                  13080029
130900*    STRING '2110-RETRIEVE-KMH'                                   13090029
131000*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              13100029
131100*    PERFORM 9990-WRITE-CICS                                      13110029
131200                                                                  13120029
131300     PERFORM 2110-RETRIEVE-KMH                                    13130029
131400                                                                  13140029
131500     IF PS-RETR-NO-ERROR                                          13150029
131600                                                                  13160029
131700*       STRING 'NO ERROR IN RETRIEVE 2120-READ-CONFIG-MANDATE'    13170029
131800*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           13180029
131900*       PERFORM 9990-WRITE-CICS                                   13190029
132000                                                                  13200029
132100        PERFORM 2120-READ-CONFIG-MANDATE                          13210029
132200                                                                  13220029
132300*       STRING '2130-PARSE-KMH          '                         13230029
132400*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           13240029
132500*       PERFORM 9990-WRITE-CICS                                   13250029
132600                                                                  13260029
132700        PERFORM 2130-PARSE-KMH                                    13270029
132800                                                                  13280029
132900*       STRING '2140-VALIDATE-MANDATE   '                         13290029
133000*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           13300029
133100*       PERFORM 9990-WRITE-CICS                                   13310029
133200                                                                  13320029
133300        PERFORM 2140-VALIDATE-MANDATE                             13330029
133400                                                                  13340029
133500        IF PS-VALIDATE-FAIL                                       13350029
133600*          STRING 'VALIDATE FAILED, SPOOL LOG'                    13360029
133700*                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA        13370029
133800*          PERFORM 9990-WRITE-CICS                                13380029
133900                                                                  13390029
134000           PERFORM 2150-PERFORM-SPOOL-LOG                         13400029
134100                                                                  13410029
134200        END-IF                                                    13420029
134300                                                                  13430029
134400        IF PS-VALIDATE-FAIL   AND ( PS-FUNC-REC-REQ               13440029
134500           )                                                      13450029
134600                                                                  13460029
134700        PERFORM 2500-FAILED-PROCS                                 13470029
134800                                                                  13480029
134900        END-IF                                                    13490029
135000     ELSE                                                         13500029
135100      IF PS-FUNC-REC-RESP                                         13510029
135200                                                                  13520029
135300         STRING PV-CURR-DATE DELIMITED BY SIZE                    13530029
135400               '||WARNING||Message header is NULL'                13540029
135500                DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           13550029
135600        PERFORM 9990-WRITE-CICS                                   13560029
135700                                                                  13570029
135800        MOVE 'Message header is NULL'       TO PV-FAULT-MSG       13580029
135900        SET PS-VALIDATE-FAIL      TO TRUE                         13590029
136000        PERFORM 2150-PERFORM-SPOOL-LOG                            13600029
136100                                                                  13610029
136200      ELSE                                                        13620029
136300                                                                  13630029
136400        STRING PV-CURR-DATE DELIMITED BY SIZE                     13640029
136500              '||ERROR||Message header is NULL'                   13650029
136600               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA            13660029
136700        PERFORM 9990-WRITE-CICS                                   13670029
136800                                                                  13680029
136900        MOVE 'Message header is NULL'       TO PV-FAULT-MSG       13690029
137000        SET PS-VALIDATE-FAIL      TO TRUE                         13700029
137100                                                                  13710029
137200        PERFORM 2150-PERFORM-SPOOL-LOG                            13720029
137300                                                                  13730029
137400        IF PS-FUNC-REC-REQ                                        13740029
137500                                                                  13750029
137600           PERFORM 2500-FAILED-PROCS                              13760029
137700                                                                  13770029
137800        END-IF                                                    13780029
137900      END-IF                                                      13790029
138000     END-IF                                                       13800029
138100           .                                                      13810029
138200******************************************************************13820029
138300* THIS SECTION PERFORMS BELOW LOGIC:                              13830029
138400* PROCEED TO KMHPREP-2 ONLY                                       13840029
138500*       IF EITHER DFHFUNCTION='SEND-REQUEST'                      13850029
138600*       OR        DFHFUNCTION='SEND-RESPONSE'                     13860029
138700*       OR DFHFUNCTION='RECEIVE-REQUEST'& PS-VALIDATE-FAILED TRUE 13870029
138800*                                                                 13880029
138900******************************************************************13890029
139000 2300-KMHPREP.                                                    13900029
139100*    STRING 'INSIDE 2300-KMHPREP'                                 13910029
139200*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              13920029
139300*    PERFORM 9990-WRITE-CICS                                      13930029
139400                                                                  13940029
139500     SET PS-PROC-KMHPREM-FALSE     TO TRUE                        13950029
139600                                                                  13960029
139700*    STRING 'PS-FUNC-VALID-SW: ' PS-FUNC-VALID-SW                 13970029
139800*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              13980029
139900*    PERFORM 9990-WRITE-CICS                                      13990029
140000*    STRING 'PS-MANDATE-SW: ' PS-MANDATE-SW                       14000029
140100*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              14010029
140200*    PERFORM 9990-WRITE-CICS                                      14020029
140300                                                                  14030029
140400     IF (PS-FUNC-SEND-REQ)  OR                                    14040029
140500        (PS-FUNC-SEND-RESP) OR                                    14050029
140600        (PS-FUNC-REC-REQ AND PS-VALIDATE-FAIL)                    14060029
140700                                                                  14070029
140800        SET PS-PROC-KMHPREM   TO TRUE                             14080029
140900                                                                  14090029
141000     END-IF                                                       14100029
141100                                                                  14110029
141200     IF PS-PROC-KMHPREM                                           14120029
141300                                                                  14130029
141400        PERFORM 2400-KMHPREP-2                                    14140029
141500                                                                  14150029
141600     END-IF                                                       14160029
141700           .                                                      14170029
141800******************************************************************14180029
141900* 1) IN CASE OF 'SEND-RESPONSE' AND 'RECEIVE-REQUEST'(ERROR),     14190029
142000*    RETRIEVE THE KMH HEADER OF INCOMING MESSAGE AND READ BELOW   14200029
142100*       A) INCOMING MESSAGE ID                                    14210029
142200*       B) INCOMING CORRELATION ID                                14220029
142300* 2) GENERATE MESSAGE ID                                          14230029
142400* 3) PREPARE CREATEDATETIME                                       14240029
142500* 4) READ CONFIG FILE TO POPULATE:                                14250029
142600*       A) SYSTEMCODE                                             14260029
142700*       B) APP                                                    14270029
142800*       C) MODULE                                                 14280029
142900*       D) NODEID                                                 14290029
143000* 5) IN CASE OF 'SEND-RESPONSE' AND 'RECEIVE-REQUEST'(ERROR),     14300029
143100*    POPULATE, INREPLYTO, CORRELATIONID AND FAULT (IF ERROR)      14310029
143200* 6) IF APPLICABLE, POPULATE OPTIONAL FIELDS                      14320029
143300* 7) WRITE DFHHEADER CONTAINER WITH NEW KMH                       14330029
143400******************************************************************14340029
143500 2400-KMHPREP-2.                                                  14350029
143600*    STRING  'INSIDE 2400-KMHPREP2'                               14360029
143700*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  14370029
143800*    PERFORM 9990-WRITE-CICS                                      14380029
143900                                                                  14390029
144000     IF (PS-FUNC-SEND-RESP) OR                                    14400029
144100        (PS-FUNC-REC-REQ AND PS-VALIDATE-FAIL) OR                 14410029
144200        (PS-FUNC-SEND-REQ)                                        14420029
144300                                                                  14430029
144400*         STRING  '2120-READ-CONFIG-MANDATE'                      14440029
144500*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                14450029
144600*         PERFORM 9990-WRITE-CICS                                 14460029
144700                                                                  14470029
144800          PERFORM 2120-READ-CONFIG-MANDATE                        14480029
144900                                                                  14490029
145000     END-IF                                                       14500029
145100                                                                  14510029
145200     IF (PS-FUNC-SEND-RESP) OR                                    14520029
145300        (PS-FUNC-REC-REQ AND PS-VALIDATE-FAIL)                    14530029
145400                                                                  14540029
145500        SET PS-RETR-ERROR       TO TRUE                           14550029
145600                                                                  14560029
145700        INITIALIZE PV-IN-MSG-MSGID                                14570029
145800                PV-IN-MSG-CRDT                                    14580029
145900                PV-IN-MSG-SYSCD                                   14590029
146000                PV-IN-MSG-APPCD                                   14600029
146100                PV-IN-MSG-MODCD                                   14610029
146200                PV-IN-MSG-NODID                                   14620029
146300                                                                  14630029
146400*       STRING  '2110-RETRIEVE-KMH'                               14640029
146500*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  14650029
146600*       PERFORM 9990-WRITE-CICS                                   14660029
146700        IF PS-FUNC-SEND-RESP                                      14670029
146800                                                                  14680029
146900          PERFORM 2540-RET-OLD-KMH                                14690029
147000                                                                  14700029
147100        ELSE                                                      14710029
147200                                                                  14720029
147300          PERFORM 2110-RETRIEVE-KMH                               14730029
147400                                                                  14740029
147500        END-IF                                                    14750029
147600                                                                  14760029
147700        IF PS-RETR-NO-ERROR                                       14770029
147800                                                                  14780029
147900* RETRIEVE IN-MSGID AND IN-CORRELATION ID FROM INCOMING MSG       14790029
148000*         STRING  '2130-PARSE-KMH'                                14800029
148100*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                14810029
148200*         PERFORM 9990-WRITE-CICS                                 14820029
148300                                                                  14830029
148400          PERFORM 2130-PARSE-KMH                                  14840029
148500                                                                  14850029
148600        END-IF                                                    14860029
148700     END-IF                                                       14870029
148800                                                                  14880029
148900*    STRING  '2410-OPT-HDR-FLDS'                                  14890029
149000*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  14900029
149100*    PERFORM 9990-WRITE-CICS                                      14910029
149200     PERFORM 2410-OPT-HDR-FLDS                                    14920029
149300                                                                  14930029
149400     IF PS-MSGID-NEED OR SV-CRDATM-NEED OR PS-EXDT-NEED           14940029
149500                                                                  14950029
149600*       STRING  '1008-GENERATE-UTC'                               14960029
149700*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  14970029
149800*       PERFORM 9990-WRITE-CICS                                   14980029
149900                                                                  14990029
150000        PERFORM 1008-GENERATE-UTC                                 15000029
150100                                                                  15010029
150200     END-IF                                                       15020029
150300     IF PS-MSGID-NEED                                             15030029
150400                                                                  15040029
150500*       STRING  '2420-GENERATE-MSGID'                             15050029
150600*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  15060029
150700*       PERFORM 9990-WRITE-CICS                                   15070029
150800        PERFORM 2420-GENERATE-MSGID                               15080029
150900                                                                  15090029
151000     END-IF                                                       15100029
151100                                                                  15110029
151200     IF PS-FROM-NEED                                              15120029
151300                                                                  15130029
151400*       STRING  '2430-GENERATE-FROM'                              15140029
151500*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  15150029
151600*       PERFORM 9990-WRITE-CICS                                   15160029
151700        PERFORM 2430-GENERATE-FROM                                15170029
151800                                                                  15180029
151900     END-IF                                                       15190029
152000                                                                  15200029
152100     IF PS-EXDT-NEED                                              15210029
152200                                                                  15220029
152300        PERFORM 2440-BLD-EXPIRY-DATE                              15230029
152400                                                                  15240029
152500     END-IF                                                       15250029
152600                                                                  15260029
152700     IF PS-ACT-NEED                                               15270029
152800                                                                  15280029
152900        PERFORM 2450-BLD-ACTION                                   15290029
153000                                                                  15300029
153100     END-IF                                                       15310029
153200                                                                  15320029
153300     IF PS-TO-NEED                                                15330029
153400                                                                  15340029
153500        PERFORM 2460-BLD-TO                                       15350029
153600                                                                  15360029
153700     END-IF                                                       15370029
153800                                                                  15380029
153900     IF PS-RKEYS-NEED                                             15390029
154000                                                                  15400029
154100        PERFORM 2470-BLD-RKEYS                                    15410029
154200                                                                  15420029
154300     END-IF                                                       15430029
154400                                                                  15440029
154500     PERFORM 2480-WRITE-DFHHDR                                    15450029
154600              .                                                   15460029
154700******************************************************************15470029
154800* A VALIDATION FAILURE OF INCOMING MESSAGE HAS BEEN DETECTED.     15480029
154900* INITIATE A KMH BUILD FOR 'SEND-RESPONSE' SCENARIO               15490029
155000* ISSUE SOAP FAULT                                                15500029
155100******************************************************************15510029
155200 2500-FAILED-PROCS.                                               15520029
155300                                                                  15530029
155400     INITIALIZE SU131-CA-CONFIG-RECORD                            15540029
155500                      PV-CONFIG-RECORD                            15550029
155600                                                                  15560029
155700     PERFORM VARYING PV-STR-INDEX7 FROM 1 BY 1                    15570029
155800          UNTIL PV-STR-INDEX7 > 99                                15580029
155900                                                                  15590029
156000          MOVE SPACES           TO                                15600029
156100              PV-SECTION-NAME2(PV-STR-INDEX7)                     15610029
156200                                                                  15620029
156300           END-PERFORM                                            15630029
156400                                                                  15640029
156500           MOVE PV-WEBS-AREA        TO SU131-WEBS-AREA            15650029
156600           MOVE 'SEND-RESPONSE'     TO SU131-FUNC-AREA            15660029
156700           MOVE 1                   TO SU131-SEQ-NO               15670029
156800                                                                  15680029
156900           PERFORM 7000-VSAM-FILE-READ                            15690029
157000                                                                  15700029
157100           EVALUATE PV-RESP                                       15710029
157200                                                                  15720029
157300              WHEN 0                                              15730029
157400                                                                  15740029
157500                  CONTINUE                                        15750029
157600                                                                  15760029
157700              WHEN 13                                             15770029
157800                                                                  15780029
157900                  MOVE PV-DEFAULT-WEBS     TO SU131-WEBS-AREA     15790029
158000                                                                  15800029
158100                  PERFORM 7000-VSAM-FILE-READ                     15810029
158200                                                                  15820029
158300                  IF PV-RESP = 13                                 15830029
158400                     EXEC CICS ABEND ABCODE('C012') END-EXEC      15840029
158500                     CONTINUE                                     15850029
158600                                                                  15860029
158700                  END-IF                                          15870029
158800           END-EVALUATE                                           15880029
158900                                                                  15890029
159000           MOVE PV-CONFIG-RECORD       TO SU131-CA-CONFIG-RECORD  15900029
159100           MOVE 1                      TO PV-STRING-PTR-2         15910029
159200           SET PS-CONT-THE-LOOP        TO TRUE                    15920029
159300                                                                  15930029
159400           PERFORM VARYING PV-STR-INDEX7 FROM 1 BY 1              15940029
159500              UNTIL PV-STR-INDEX7 > 99 OR                         15950029
159600              PS-BREAK-THE-LOOP                                   15960029
159700                                                                  15970029
159800              UNSTRING SU131-FREE-TEXT DELIMITED BY ';'           15980029
159900                INTO PV-SECTION-NAME2(PV-STR-INDEX7)              15990029
160000                WITH POINTER PV-STRING-PTR-2                      16000029
160100                                                                  16010029
160200              END-UNSTRING                                        16020029
160300                                                                  16030029
160400              IF PV-SECTION-NAME2(PV-STR-INDEX7) = SPACES         16040029
160500                 SET PS-BREAK-THE-LOOP   TO TRUE                  16050029
160600              END-IF                                              16060029
160700                                                                  16070029
160800           END-PERFORM                                            16080029
160900                                                                  16090029
161000           MOVE 1                      TO PV-STR-INDEX1           16100029
161100           SET PS-CONT-THE-LOOP2       TO TRUE                    16110029
161200                                                                  16120029
161300           PERFORM UNTIL PV-STR-INDEX1 > PV-STR-INDEX7            16130029
161400           OR PS-BREAK-THE-LOOP2                                  16140029
161500                                                                  16150029
161600              EVALUATE PV-SECTION-NAME2(PV-STR-INDEX1)            16160029
161700                                                                  16170029
161800                 WHEN 'KMHLOG'                                    16180029
161900*                    STRING  'KMHLOG FOR VALIDATE FAIL'           16190029
162000*                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA     16200029
162100*                    PERFORM 9990-WRITE-CICS                      16210029
162200                                                                  16220029
162300                     PERFORM 2100-KMHLOG                          16230029
162400                                                                  16240029
162500                 WHEN 'KMHPREP'                                   16250029
162600*                    STRING  'KMHPREP FOR VALIDATE FAIL'          16260029
162700*                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA     16270029
162800*                    PERFORM 9990-WRITE-CICS                      16280029
162900                                                                  16290029
163000                     PERFORM 2300-KMHPREP                         16300029
163100                                                                  16310029
163200                 WHEN OTHER                                       16320029
163300                                                                  16330029
163400                     SET PS-BREAK-THE-LOOP2  TO TRUE              16340029
163500                                                                  16350029
163600                     CONTINUE                                     16360029
163700              END-EVALUATE                                        16370029
163800                                                                  16380029
163900              ADD 1                     TO PV-STR-INDEX1          16390029
164000                                                                  16400029
164100           END-PERFORM                                            16410029
164200                                                                  16420029
164300*          STRING  '2510-CREATE-SOAP-FAULT'                       16430029
164400*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               16440029
164500*          PERFORM 9990-WRITE-CICS                                16450029
164600           PERFORM 2510-CREATE-SOAP-FAULT                         16460029
164700              .                                                   16470029
164800******************************************************************16480029
164900* THIS SECTION READ CONTAINER DHFHEADER TO RETRIEVE KMH.          16490029
165000* IN CASE, THIS RETRIEVAL IS FOR 'RECEIVE-REQUEST', THEN          16500029
165100* IMMEDIATELY, STORE THE RETRIEVED KMH IN A USER CONTAINTER BY    16510029
165200* NAME - 'OLD-HEADER1'. THIS CONTAINER WOULD BE USED TO RETRIEVE  16520029
165300* THE INCOMING KMH WHEN SEND-RESPONSE IS BEING PROCESSED          16530029
165400******************************************************************16540029
165500 2110-RETRIEVE-KMH.                                               16550029
165600                                                                  16560029
165700        INITIALIZE PV-RESP                                        16570029
165800                                                                  16580029
165900        EXEC CICS                                                 16590029
166000             GET CONTAINER('DFHHEADER')                           16600029
166100             SET(PV-HEAD-PTR)                                     16610029
166200             FLENGTH(PV-CONT-LEN)                                 16620029
166300             RESP(PV-RESP)                                        16630029
166400        END-EXEC                                                  16640029
166500                                                                  16650029
166600*       MOVE   PV-RESP            TO PV-RESP-DISP                 16660029
166700*       STRING 'PV-RESP AFTER DFHHEADER CONTAINER READ: '         16670029
166800*               PV-RESP-DISP                                      16680029
166900*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           16690029
167000*       PERFORM 9990-WRITE-CICS                                   16700029
167100        EVALUATE PV-RESP                                          16710029
167200                                                                  16720029
167300           WHEN DFHRESP(CONTAINERERR)                             16730029
167400                                                                  16740029
167500*                STRING  'Container NOT FOUND'                    16750029
167600*                 DELIMITED BY SIZE INTO PV-CICS-MSG-AREA         16760029
167700*                PERFORM 9990-WRITE-CICS                          16770029
167800                 SET PS-RETR-ERROR    TO TRUE                     16780029
167900                                                                  16790029
168000           WHEN DFHRESP(NORMAL)                                   16800029
168100                                                                  16810029
168200                 SET PS-RETR-NO-ERROR TO TRUE                     16820029
168300*                MOVE PV-CONT-LEN     TO PV-CONT-LEN-DISP         16830029
168400                                                                  16840029
168500*                STRING  '>========<'                             16850029
168600*                        'Container Name : ' 'DFHHEADER'          16860029
168700*                        'Content length : ' PV-CONT-LEN-DISP     16870029
168800*                 DELIMITED BY SIZE INTO PV-CICS-MSG-AREA         16880029
168900*                PERFORM 9990-WRITE-CICS                          16890029
169000                 MOVE PV-CONT-LEN    TO PV-GETMAIN-LEN            16900029
169100                                                                  16910029
169200                 IF PV-GETMAIN-LEN > 0                            16920029
169300                                                                  16930029
169400                  EXEC CICS GETMAIN                               16940029
169500                       SET(PV-GETMAIN-PTR)                        16950029
169600                       FLENGTH(PV-GETMAIN-LEN)                    16960029
169700                  END-EXEC                                        16970029
169800                                                                  16980029
169900                  SET ADDRESS OF PV-GETMAIN-AREA TO               16990029
170000                  PV-GETMAIN-PTR                                  17000029
170100                                                                  17010029
170200                  EXEC CICS GET CONTAINER('DFHHEADER')            17020029
170300                       INTO(PV-GETMAIN-AREA)                      17030029
170400                       FLENGTH(PV-CONT-LEN)                       17040029
170500                  END-EXEC                                        17050029
170600                                                                  17060029
170700*                 STRING 'DFHHEADER Container content: '          17070029
170800*                         PV-GETMAIN-AREA(80:)                    17080029
170900*                         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA 17090029
171000*                 PERFORM 9990-WRITE-CICS                         17100029
171100                  MOVE PV-GETMAIN-LEN  TO PV-RETR-KMH-LEN         17110029
171200                  MOVE PV-GETMAIN-AREA TO PV-RETR-KMH-AREA        17120029
171300                                                                  17130029
171400                 ELSE                                             17140029
171500                                                                  17150029
171600                  SET PS-RETR-ERROR    TO TRUE                    17160029
171700                                                                  17170029
171800                 END-IF                                           17180029
171900                                                                  17190029
172000           WHEN DFHRESP(CCSIDERR)                                 17200029
172100                                                                  17210029
172200               SET PS-RETR-ERROR  TO TRUE                         17220029
172300                                                                  17230029
172400               EXEC CICS ABEND ABCODE('C015') END-EXEC            17240029
172500               CONTINUE                                           17250029
172600                                                                  17260029
172700           WHEN DFHRESP(CONTAINERERR)                             17270029
172800                                                                  17280029
172900               SET PS-RETR-ERROR  TO TRUE                         17290029
173000               EXEC CICS ABEND ABCODE('C016') END-EXEC            17300029
173100               CONTINUE                                           17310029
173200                                                                  17320029
173300           WHEN DFHRESP(INVREQ)                                   17330029
173400                                                                  17340029
173500               SET PS-RETR-ERROR  TO TRUE                         17350029
173600               EXEC CICS ABEND ABCODE('C017') END-EXEC            17360029
173700               CONTINUE                                           17370029
173800                                                                  17380029
173900           WHEN DFHRESP(LENGERR)                                  17390029
174000                                                                  17400029
174100               SET PS-RETR-ERROR  TO TRUE                         17410029
174200               EXEC CICS ABEND ABCODE('C018') END-EXEC            17420029
174300               CONTINUE                                           17430029
174400                                                                  17440029
174500        END-EVALUATE                                              17450029
174600                                                                  17460029
174700* SAVE INCOMING KMH HEADER IN A USER CONTAINER OLD-HEADER1 SO THAT17470029
174800* THIS CAN BE RETREIVED AGAIN WHILE SENDING RESPONSE              17480029
174900        IF PS-FUNC-REC-REQ                                        17490029
175000           INITIALIZE PV-RESP                                     17500029
175100           EXEC CICS                                              17510029
175200                PUT  CONTAINER('OLD-HEADER1')                     17520029
175300                FROM(PV-RETR-KMH-AREA)                            17530029
175400                FLENGTH(LENGTH OF PV-RETR-KMH-AREA)               17540029
175500                RESP(PV-RESP)                                     17550029
175600          END-EXEC                                                17560029
175700                                                                  17570029
175800        END-IF                                                    17580029
175900           .                                                      17590029
176000******************************************************************17600029
176100 2130-PARSE-KMH.                                                  17610029
176200                                                                  17620029
176300     PERFORM VARYING PV-STR-INDEX5 FROM 1 BY 1 UNTIL              17630029
176400             PV-STR-INDEX5 > 99                                   17640029
176500                                                                  17650029
176600        INITIALIZE PV-KMH-ELEMENT(PV-STR-INDEX5)                  17660029
176700                   PV-KMH-MANDATE(PV-STR-INDEX5)                  17670029
176800                   PV-KMH-ELE-PRESENCE(PV-STR-INDEX5)             17680029
176900                                                                  17690029
177000        PERFORM VARYING PV-STR-INDEX6 FROM 1 BY 1 UNTIL           17700029
177100                PV-STR-INDEX6 > 10                                17710029
177200                                                                  17720029
177300           INITIALIZE                                             17730029
177400                PV-KMH-ELEMENT-VAL(PV-STR-INDEX5, PV-STR-INDEX6)  17740029
177500                                                                  17750029
177600        END-PERFORM                                               17760029
177700     END-PERFORM                                                  17770029
177800                                                                  17780029
177900     MOVE 1                       TO PV-STR-INDEX2                17790029
178000                                                                  17800029
178100*    STRING 'PV-NBR-M-ELEMENTS: ' PV-NBR-M-ELEMENTS               17810029
178200*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              17820029
178300*    PERFORM 9990-WRITE-CICS                                      17830029
178400     PERFORM UNTIL PV-STR-INDEX2 > PV-NBR-M-ELEMENTS              17840029
178500             OR PV-SECTION-NAME3(PV-STR-INDEX2) = SPACES          17850029
178600                                                                  17860029
178700*       STRING 'PV-SECTION-NAME3(PV-STR-INDEX2): '                17870029
178800*               PV-SECTION-NAME3(PV-STR-INDEX2)                   17880029
178900*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           17890029
179000*       PERFORM 9990-WRITE-CICS                                   17900029
179100        MOVE PV-SECTION-NAME3(PV-STR-INDEX2)                      17910029
179200                            TO PV-KMH-ELEMENT(PV-STR-INDEX2)      17920029
179300        MOVE 'M'            TO PV-KMH-MANDATE(PV-STR-INDEX2)      17930029
179400        ADD 1               TO PV-STR-INDEX2                      17940029
179500                                                                  17950029
179600     END-PERFORM                                                  17960029
179700                                                                  17970029
179800     INITIALIZE PV-IN-MSG-MSGID                                   17980029
179900                PV-IN-MSG-CORRID                                  17990029
180000                PV-STOR-KMH-VER                                   18000029
180100                PV-IN-MSG-INRPTO                                  18010029
180200                PV-IN-MSG-FAULT-CD                                18020029
180300                PV-IN-MSG-FAULT-DES                               18030029
180400                                                                  18040029
180500     SET PS-IN-MSG-FRM-NO  TO TRUE                                18050029
180600     SET PS-IN-MSG-EXDT-N  TO TRUE                                18060029
180700     SET PS-INKMH-VER-N    TO TRUE                                18070029
180800     SET PS-IN-MSG-INRPT-N TO TRUE                                18080029
180900     SET PS-IN-MSG-FAULT-N TO TRUE                                18090029
181000                                                                  18100029
181100     XML PARSE PV-RETR-KMH-AREA                                   18110029
181200         PROCESSING PROCEDURE 2190-XML-HANDLER                    18120029
181300     END-XML                                                      18130029
181400           .                                                      18140029
181500******************************************************************18150029
181600* THIS SECTION READS THE CONFIG FILE TO UNDERSTAND THE MANDATORY  18160029
181700* FIELDS                                                          18170029
181800******************************************************************18180029
181900 2120-READ-CONFIG-MANDATE.                                        18190029
182000                                                                  18200029
182100     INITIALIZE SU131-CA-CONFIG-RECORD                            18210029
182200                PV-CONFIG-RECORD                                  18220029
182300                                                                  18230029
182400     PERFORM VARYING PV-STR-INDEX8 FROM 1 BY 1                    18240029
182500        UNTIL PV-STR-INDEX8 > 99                                  18250029
182600                                                                  18260029
182700        MOVE SPACES           TO                                  18270029
182800             PV-SECTION-NAME3(PV-STR-INDEX8)                      18280029
182900                                                                  18290029
183000     END-PERFORM                                                  18300029
183100                                                                  18310029
183200     MOVE 'MANDATORY'         TO SU131-FUNC-AREA                  18320029
183300* FIRST TRY WITH CURRENT WEBSERVICE NAME                          18330029
183400     MOVE PV-WEBS-AREA        TO SU131-WEBS-AREA                  18340029
183500     MOVE 1                   TO SU131-SEQ-NO                     18350029
183600                                                                  18360029
183700     PERFORM 7000-VSAM-FILE-READ                                  18370029
183800                                                                  18380029
183900     EVALUATE PV-RESP                                             18390029
184000                                                                  18400029
184100        WHEN 0                                                    18410029
184200                                                                  18420029
184300            CONTINUE                                              18430029
184400                                                                  18440029
184500        WHEN 13                                                   18450029
184600                                                                  18460029
184700* ROW NOT FOUND. USE DEFAULT WEBSERVICE NAME                      18470029
184800            MOVE PV-DEFAULT-WEBS     TO SU131-WEBS-AREA           18480029
184900                                                                  18490029
185000            PERFORM 7000-VSAM-FILE-READ                           18500029
185100                                                                  18510029
185200            IF PV-RESP NOT = 0                                    18520029
185300                                                                  18530029
185400               EXEC CICS ABEND ABCODE('C019') END-EXEC            18540029
185500               CONTINUE                                           18550029
185600            END-IF                                                18560029
185700                                                                  18570029
185800        WHEN OTHER                                                18580029
185900            EXEC CICS ABEND ABCODE('C020') END-EXEC               18590029
186000     END-EVALUATE                                                 18600029
186100                                                                  18610029
186200* UNSTRING PV-CONFIG-RECORD                                       18620029
186300     MOVE PV-CONFIG-RECORD           TO SU131-CA-CONFIG-RECORD    18630029
186400     MOVE 1                          TO PV-STRING-PTR-3           18640029
186500     MOVE 0                          TO PV-NBR-M-ELEMENTS         18650029
186600     SET PS-CONT-THE-LOOP            TO TRUE                      18660029
186700                                                                  18670029
186800     PERFORM VARYING PV-STR-INDEX8 FROM 1 BY 1                    18680029
186900             UNTIL PV-STR-INDEX8 > 99 OR                          18690029
187000             PS-BREAK-THE-LOOP                                    18700029
187100                                                                  18710029
187200        UNSTRING SU131-FREE-TEXT DELIMITED BY ';'                 18720029
187300                 INTO PV-SECTION-NAME3(PV-STR-INDEX8)             18730029
187400                 WITH POINTER PV-STRING-PTR-3                     18740029
187500                                                                  18750029
187600        END-UNSTRING                                              18760029
187700                                                                  18770029
187800        EVALUATE PV-SECTION-NAME3(PV-STR-INDEX8)                  18780029
187900                                                                  18790029
188000           WHEN 'From'                                            18800029
188100                                                                  18810029
188200               SET PS-FROM-NEED       TO TRUE                     18820029
188300                                                                  18830029
188400           WHEN 'MessageID'                                       18840029
188500                                                                  18850029
188600               SET PS-MSGID-NEED      TO TRUE                     18860029
188700                                                                  18870029
188800           WHEN 'CreateDateTime'                                  18880029
188900                                                                  18890029
189000               SET SV-CRDATM-NEED     TO TRUE                     18900029
189100                                                                  18910029
189200           WHEN 'ExpiryDateTime'                                  18920029
189300                                                                  18930029
189400                SET PS-EXDT-NEED      TO TRUE                     18940029
189500                                                                  18950029
189600           WHEN 'Action'                                          18960029
189700                                                                  18970029
189800                SET PS-ACT-NEED       TO TRUE                     18980029
189900                                                                  18990029
190000           WHEN 'To'                                              19000029
190100                                                                  19010029
190200                SET PS-TO-NEED        TO TRUE                     19020029
190300                                                                  19030029
190400           WHEN 'RoutingKeys'                                     19040029
190500                                                                  19050029
190600                SET PS-RKEYS-NEED     TO TRUE                     19060029
190700                                                                  19070029
190800           WHEN 'CorrelationID'                                   19080029
190900                                                                  19090029
191000                SET PS-CORID-NEED     TO TRUE                     19100029
191100                                                                  19110029
191200           WHEN 'Fault'                                           19120029
191300                                                                  19130029
191400                SET PS-FAULT-NEED     TO TRUE                     19140029
191500                                                                  19150029
191600           WHEN 'InReplyTo'                                       19160029
191700                                                                  19170029
191800                SET PS-INRPTO-NEED    TO TRUE                     19180029
191900                                                                  19190029
192000        END-EVALUATE                                              19200029
192100                                                                  19210029
192200        IF PV-SECTION-NAME3(PV-STR-INDEX8) = SPACES               19220029
192300                                                                  19230029
192400           SET PS-BREAK-THE-LOOP  TO TRUE                         19240029
192500                                                                  19250029
192600        END-IF                                                    19260029
192700                                                                  19270029
192800     END-PERFORM                                                  19280029
192900                                                                  19290029
193000     MOVE PV-STR-INDEX8               TO PV-NBR-M-ELEMENTS        19300029
193100                                                                  19310029
193200     INITIALIZE SU131-CA-CONFIG-RECORD                            19320029
193300                PV-CONFIG-RECORD                                  19330029
193400                                                                  19340029
193500     PERFORM VARYING PV-STR-INDEX11 FROM 1 BY 1                   19350029
193600             UNTIL PV-STR-INDEX11 > 99                            19360029
193700                                                                  19370029
193800        MOVE SPACES          TO PV-SECTION-NAME4(PV-STR-INDEX11)  19380029
193900                                                                  19390029
194000     END-PERFORM                                                  19400029
194100                                                                  19410029
194200     MOVE 'OPTIONAL'         TO SU131-FUNC-AREA                   19420029
194300                                                                  19430029
194400* FIRST TRY WITH CURRENT WEBSERVICE NAME                          19440029
194500     MOVE PV-WEBS-AREA       TO SU131-WEBS-AREA                   19450029
194600                                                                  19460029
194700     MOVE 1                  TO SU131-SEQ-NO                      19470029
194800                                                                  19480029
194900     PERFORM 7000-VSAM-FILE-READ                                  19490029
195000                                                                  19500029
195100     EVALUATE PV-RESP                                             19510029
195200                                                                  19520029
195300        WHEN 0                                                    19530029
195400                                                                  19540029
195500            CONTINUE                                              19550029
195600                                                                  19560029
195700        WHEN 13                                                   19570029
195800                                                                  19580029
195900* ROW NOT FOUND. USE DEFAULT WEBSERVICE NAME                      19590029
196000            MOVE PV-DEFAULT-WEBS     TO SU131-WEBS-AREA           19600029
196100                                                                  19610029
196200            PERFORM 7000-VSAM-FILE-READ                           19620029
196300                                                                  19630029
196400            IF PV-RESP NOT = 0                                    19640029
196500                                                                  19650029
196600               EXEC CICS ABEND ABCODE('C028') END-EXEC            19660029
196700               CONTINUE                                           19670029
196800                                                                  19680029
196900            END-IF                                                19690029
197000                                                                  19700029
197100        WHEN OTHER                                                19710029
197200                                                                  19720029
197300            EXEC CICS ABEND ABCODE('C029') END-EXEC               19730029
197400                                                                  19740029
197500     END-EVALUATE                                                 19750029
197600                                                                  19760029
197700* UNSTRING PV-CONFIG-RECORD                                       19770029
197800     MOVE PV-CONFIG-RECORD           TO SU131-CA-CONFIG-RECORD    19780029
197900     MOVE 1                          TO PV-STRING-PTR-4           19790029
198000     MOVE 0                          TO PV-NBR-O-ELEMENTS         19800029
198100     SET PS-CONT-THE-LOOP            TO TRUE                      19810029
198200                                                                  19820029
198300     PERFORM VARYING PV-STR-INDEX11 FROM 1 BY 1                   19830029
198400        UNTIL PV-STR-INDEX11 > 99 OR                              19840029
198500        PS-BREAK-THE-LOOP                                         19850029
198600                                                                  19860029
198700        UNSTRING SU131-FREE-TEXT DELIMITED BY ';'                 19870029
198800          INTO PV-SECTION-NAME4(PV-STR-INDEX11)                   19880029
198900          WITH POINTER PV-STRING-PTR-4                            19890029
199000                                                                  19900029
199100        END-UNSTRING                                              19910029
199200                                                                  19920029
199300        EVALUATE PV-SECTION-NAME4(PV-STR-INDEX11)                 19930029
199400                                                                  19940029
199500           WHEN 'From'                                            19950029
199600                                                                  19960029
199700               SET PS-FROM-NEED       TO TRUE                     19970029
199800                                                                  19980029
199900           WHEN 'MessageID'                                       19990029
200000                                                                  20000029
200100               SET PS-MSGID-NEED      TO TRUE                     20010029
200200                                                                  20020029
200300           WHEN 'CreateDateTime'                                  20030029
200400                                                                  20040029
200500               SET SV-CRDATM-NEED     TO TRUE                     20050029
200600                                                                  20060029
200700           WHEN 'ExpiryDateTime'                                  20070029
200800                                                                  20080029
200900                SET PS-EXDT-NEED      TO TRUE                     20090029
201000                                                                  20100029
201100           WHEN 'Action'                                          20110029
201200                                                                  20120029
201300                SET PS-ACT-NEED       TO TRUE                     20130029
201400                                                                  20140029
201500           WHEN 'To'                                              20150029
201600                                                                  20160029
201700                SET PS-TO-NEED        TO TRUE                     20170029
201800                                                                  20180029
201900           WHEN 'RoutingKeys'                                     20190029
202000                                                                  20200029
202100                SET PS-RKEYS-NEED     TO TRUE                     20210029
202200                                                                  20220029
202300           WHEN 'CorrelationID'                                   20230029
202400                                                                  20240029
202500                SET PS-CORID-NEED     TO TRUE                     20250029
202600                                                                  20260029
202700           WHEN 'Fault'                                           20270029
202800                                                                  20280029
202900                SET PS-FAULT-NEED     TO TRUE                     20290029
203000                                                                  20300029
203100           WHEN 'InReplyTo'                                       20310029
203200                                                                  20320029
203300                SET PS-INRPTO-NEED    TO TRUE                     20330029
203400                                                                  20340029
203500        END-EVALUATE                                              20350029
203600                                                                  20360029
203700        IF PV-SECTION-NAME4(PV-STR-INDEX11) = SPACES              20370029
203800                                                                  20380029
203900           SET PS-BREAK-THE-LOOP   TO TRUE                        20390029
204000                                                                  20400029
204100        END-IF                                                    20410029
204200                                                                  20420029
204300     END-PERFORM                                                  20430029
204400                                                                  20440029
204500     MOVE PV-STR-INDEX11             TO PV-NBR-O-ELEMENTS         20450029
204600           .                                                      20460029
204700******************************************************************20470029
204800* THIS SECTION CHECK IF ANY OF THE MANDATORY FIELDS (AS SPECIFIED 20480029
204900* IN CONFIG FILE) ARE NOT PRESENT. IF ANY MANDATORY FIELDS NOT    20490029
205000* PRESENT, A VALIDATION FAIL FLAG WOULD BE SET TO TRUE            20500029
205100*                                                                 20510029
205200* ONCE THE ABOVE CHECK IS DONE, THEN THIS SECTION LOOKS AT        20520029
205300* SPECIFIC FIELD VALIDATIONS.                                     20530029
205400*  1) THE MANDATORY FIELD 'FROM', NEEDS TO HAVE SYSTEMCODE, APP,  20540029
205500*     MODULE, NODEID IN REQUEST KMH. IF NOT PRESENT, ITS A        20550029
205600*     VALIDATION FAILURE                                          20560029
205700*  2) CREATEDATETIME FIELD, IN ADDITION TO BEING PRESENT, ALSO    20570029
205800*     NEEDS TO ADHERE TO UTC FORMAT                               20580029
205900*  3) EXPIRYDATETIME IS A OPTIONAL FIELD. BUT WHEN IT IS PRESENT  20590029
206000*     AND IS EXEPECTED TO BE PRESENT (CONFIG FILE), THEN, THE     20600029
206100*     CONTENT OF THIS FIELD NEEDS TO BE ADHERING TO UTC FORMAT    20610029
206200******************************************************************20620029
206300 2140-VALIDATE-MANDATE.                                           20630029
206400                                                                  20640029
206500     INITIALIZE PV-FAULT-MSG                                      20650029
206600                                                                  20660029
206700     IF PV-STOR-KMH-VER = SPACES                                  20670029
206800                                                                  20680029
206900        SET PS-VALIDATE-FAIL       TO TRUE                        20690029
207000                                                                  20700029
207100        STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED MESSA20710029
207200-          'GE HEADER ATTRIBUTE [version]'                        20720029
207300        DELIMITED BY SIZE                                         20730029
207400        INTO PV-FAULT-MSG                                         20740029
207500                                                                  20750029
207600     END-IF                                                       20760029
207700                                                                  20770029
207800     IF PV-STOR-KMH-VER NOT = PV-LITERAL-KMH-VER AND NOT          20780029
207900        PS-VALIDATE-FAIL                                          20790029
208000                                                                  20800029
208100        SET PS-VALIDATE-FAIL       TO TRUE                        20810029
208200                                                                  20820029
208300        STRING 'BAD MESSAGE HEADER ELEMENT. THE VERSION NUMBER SPE20830029
208400-          'CIFIED IN THE HEADER, '                               20840029
208500        DELIMITED BY SIZE                                         20850029
208600        PV-STOR-KMH-VER                                           20860029
208700        ', DOES NOT MATCH WITH THE EXPECTED VERSION '             20870029
208800        DELIMITED BY SIZE                                         20880029
208900        PV-LITERAL-KMH-VER                                        20890029
209000        DELIMITED BY SIZE                                         20900029
209100        INTO PV-FAULT-MSG                                         20910029
209200                                                                  20920029
209300     END-IF                                                       20930029
209400                                                                  20940029
209500     PERFORM VARYING PV-STR-INDEX9    FROM 1 BY 1                 20950029
209600     UNTIL PV-STR-INDEX9 > PV-NBR-M-ELEMENTS                      20960029
209700     OR PV-KMH-MANDATE(PV-STR-INDEX9) = ' '                       20970029
209800     OR PS-VALIDATE-FAIL                                          20980029
209900*       STRING 'PV-KMH-MANDATE(PV-STR-INDEX9): '                  20990029
210000*               PV-KMH-MANDATE(PV-STR-INDEX9)                     21000029
210100*              'PV-KMH-ELEMENT(PV-STR-INDEX9): '                  21010029
210200*               PV-KMH-ELEMENT(PV-STR-INDEX9)                     21020029
210300*              'PV-KMH-ELE-PRESENCE(PV-STR-INDEX9): '             21030029
210400*               PV-KMH-ELE-PRESENCE(PV-STR-INDEX9)                21040029
210500*              'PS-MANDATE-SW: ' PS-MANDATE-SW                    21050029
210600*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           21060029
210700*       PERFORM 9990-WRITE-CICS                                   21070029
210800                                                                  21080029
210900        IF PV-KMH-ELE-PRESENCE(PV-STR-INDEX9) NOT = 'Y'           21090029
211000                                                                  21100029
211100           SET PS-VALIDATE-FAIL       TO TRUE                     21110029
211200                                                                  21120029
211300           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME21130029
211400-          'SSAGE HEADER ELEMENT ['                               21140029
211500                  DELIMITED BY SIZE                               21150029
211600                  PV-KMH-ELEMENT(PV-STR-INDEX9) DELIMITED BY SPACE21160029
211700                  ']' DELIMITED BY SIZE                           21170029
211800                  INTO PV-FAULT-MSG                               21180029
211900                                                                  21190029
212000        END-IF                                                    21200029
212100                                                                  21210029
212200        IF PS-MSGID-NEED AND PS-VALIDATE-PASS                     21220029
212300           AND PV-KMH-ELEMENT(PV-STR-INDEX9) = 'MessageID'        21230029
212400                                                                  21240029
212500           IF PV-KMH-ELEMENT-VAL(PV-STR-INDEX9, 1) = SPACES       21250029
212600                                                                  21260029
212700              SET PS-VALIDATE-FAIL  TO TRUE                       21270029
212800                                                                  21280029
212900              STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED21290029
213000-             ' MESSAGE HEADER ELEMENT ['                         21300029
213100              DELIMITED BY SIZE                                   21310029
213200              PV-KMH-ELEMENT(PV-STR-INDEX9) DELIMITED BY SPACE    21320029
213300              ']' DELIMITED BY SIZE                               21330029
213400              INTO PV-FAULT-MSG                                   21340029
213500                                                                  21350029
213600           END-IF                                                 21360029
213700                                                                  21370029
213800        END-IF                                                    21380029
213900                                                                  21390029
214000        IF ( SV-CRDATM-NEED AND PS-VALIDATE-PASS                  21400029
214100           AND PV-KMH-ELEMENT(PV-STR-INDEX9) = 'CreateDateTime')  21410029
214200                                                                  21420029
214300           MOVE PV-KMH-ELEMENT-VAL(PV-STR-INDEX9, 1)              21430029
214400                                TO PV-VALIDATE-DTM                21440029
214500                                                                  21450029
214600           PERFORM VARYING PV-STR-INDEX14 FROM 1 BY 1             21460029
214700           UNTIL PS-VALIDATE-FAIL OR PV-STR-INDEX14 > 24          21470029
214800                                                                  21480029
214900              EVALUATE PV-STR-INDEX14                             21490029
215000                                                                  21500029
215100                 WHEN 1                                           21510029
215200                 WHEN 2                                           21520029
215300                 WHEN 3                                           21530029
215400                 WHEN 4                                           21540029
215500                 WHEN 6                                           21550029
215600                 WHEN 7                                           21560029
215700                 WHEN 9                                           21570029
215800                 WHEN 10                                          21580029
215900                 WHEN 12                                          21590029
216000                 WHEN 13                                          21600029
216100                 WHEN 15                                          21610029
216200                 WHEN 16                                          21620029
216300                 WHEN 18                                          21630029
216400                 WHEN 19                                          21640029
216500                 WHEN 21                                          21650029
216600                 WHEN 22                                          21660029
216700                 WHEN 23                                          21670029
216800                                                                  21680029
216900                    IF PV-VALIDATE-DTM(PV-STR-INDEX14:1)          21690029
217000                       NOT NUMERIC                                21700029
217100                                                                  21710029
217200                       SET PS-VALIDATE-FAIL  TO TRUE              21720029
217300                                                                  21730029
217400                    END-IF                                        21740029
217500                                                                  21750029
217600                 WHEN 5                                           21760029
217700                 WHEN 8                                           21770029
217800                                                                  21780029
217900                   IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = '-' 21790029
218000                                                                  21800029
218100                      SET PS-VALIDATE-FAIL  TO TRUE               21810029
218200                                                                  21820029
218300                   END-IF                                         21830029
218400                                                                  21840029
218500                 WHEN 11                                          21850029
218600                                                                  21860029
218700                   IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = 'T' 21870029
218800                                                                  21880029
218900*                     STRING 'PV-VALIDATE-DTM NOT = T'            21890029
219000*                            'PV-STR-INDEX14: ' PV-STR-INDEX14    21900029
219100*                             DELIMITED BY SIZE INTO              21910029
219200*                             PV-CICS-MSG-AREA                    21920029
219300*                     PERFORM 9990-WRITE-CICS                     21930029
219400                      SET PS-VALIDATE-FAIL  TO TRUE               21940029
219500                                                                  21950029
219600                   END-IF                                         21960029
219700                                                                  21970029
219800                 WHEN 14                                          21980029
219900                 WHEN 17                                          21990029
220000                                                                  22000029
220100                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = ':'    22010029
220200                                                                  22020029
220300*                     STRING 'PV-VALIDATE-DTM NOT = :'            22030029
220400*                            'PV-STR-INDEX14: ' PV-STR-INDEX14    22040029
220500*                             DELIMITED BY SIZE                   22050029
220600*                             INTO PV-CICS-MSG-AREA               22060029
220700*                     PERFORM 9990-WRITE-CICS                     22070029
220800                      SET PS-VALIDATE-FAIL  TO TRUE               22080029
220900                                                                  22090029
221000                END-IF                                            22100029
221100                                                                  22110029
221200              WHEN 20                                             22120029
221300                                                                  22130029
221400                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = '.'    22140029
221500                                                                  22150029
221600*                  STRING  'PV-VALIDATE-DTM NOT = .'              22160029
221700*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             22170029
221800*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       22180029
221900*                  PERFORM 9990-WRITE-CICS                        22190029
222000                                                                  22200029
222100                   SET PS-VALIDATE-FAIL  TO TRUE                  22210029
222200                                                                  22220029
222300                END-IF                                            22230029
222400                                                                  22240029
222500              WHEN 24                                             22250029
222600                                                                  22260029
222700                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = 'Z'    22270029
222800*                  STRING  'PV-VALIDATE-DTM NOT = Z'              22280029
222900*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             22290029
223000*                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA        22300029
223100*                  PERFORM 9990-WRITE-CICS                        22310029
223200                                                                  22320029
223300                   SET PS-VALIDATE-FAIL  TO TRUE                  22330029
223400                                                                  22340029
223500                END-IF                                            22350029
223600                                                                  22360029
223700            END-EVALUATE                                          22370029
223800                                                                  22380029
223900          END-PERFORM                                             22390029
224000                                                                  22400029
224100          IF PS-VALIDATE-FAIL                                     22410029
224200                                                                  22420029
224300             STRING 'BAD MESSAGE HEADER ELEMENT. '                22430029
224400                     DELIMITED BY SIZE                            22440029
224500                     PV-KMH-ELEMENT(PV-STR-INDEX9)                22450029
224600                     DELIMITED BY SPACE                           22460029
224700                   ' ELEMENT CONTAINS IMPROPER DATE-TIME FORMAT: '22470029
224800                     DELIMITED BY SIZE                            22480029
224900                     PV-VALIDATE-DTM DELIMITED BY SIZE            22490029
225000                     INTO PV-FAULT-MSG                            22500029
225100                                                                  22510029
225200          END-IF                                                  22520029
225300        END-IF                                                    22530029
225400                                                                  22540029
225500     END-PERFORM                                                  22550029
225600                                                                  22560029
225700     IF PS-IN-MSG-FRM-YES   AND PS-VALIDATE-PASS                  22570029
225800                                                                  22580029
225900        IF PS-IN-SYS-CD-NO OR ( PV-IN-MSG-SYSCD = SPACES )        22590029
226000                                                                  22600029
226100           SET PS-VALIDATE-FAIL  TO TRUE                          22610029
226200           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME22620029
226300-          'SSAGE HEADER ATTRIBUTE [systemCode] of element [From]'22630029
226400           DELIMITED BY SIZE                                      22640029
226500           INTO PV-FAULT-MSG                                      22650029
226600                                                                  22660029
226700        END-IF                                                    22670029
226800                                                                  22680029
226900        IF NOT PS-VALIDATE-FAIL AND                               22690029
227000             ( PS-IN-APP-CD-NO OR ( PV-IN-MSG-APPCD = SPACES ))   22700029
227100                                                                  22710029
227200           SET PS-VALIDATE-FAIL  TO TRUE                          22720029
227300                                                                  22730029
227400           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME22740029
227500-          'SSAGE HEADER ATTRIBUTE [app] of element [From]'       22750029
227600           DELIMITED BY SIZE                                      22760029
227700                                                                  22770029
227800           INTO PV-FAULT-MSG                                      22780029
227900                                                                  22790029
228000        END-IF                                                    22800029
228100                                                                  22810029
228200        IF NOT PS-VALIDATE-FAIL AND                               22820029
228300             ( PS-IN-MOD-CD-NO OR ( PV-IN-MSG-MODCD = SPACES ))   22830029
228400           SET PS-VALIDATE-FAIL  TO TRUE                          22840029
228500                                                                  22850029
228600           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME22860029
228700-          'SSAGE HEADER ATTRIBUTE [module] of element [From]'    22870029
228800           DELIMITED BY SIZE                                      22880029
228900                                                                  22890029
229000           INTO PV-FAULT-MSG                                      22900029
229100        END-IF                                                    22910029
229200                                                                  22920029
229300        IF NOT PS-VALIDATE-FAIL AND                               22930029
229400             ( PS-IN-NOD-ID-NO OR ( PV-IN-MSG-NODID = SPACES ))   22940029
229500                                                                  22950029
229600           SET PS-VALIDATE-FAIL  TO TRUE                          22960029
229700                                                                  22970029
229800           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME22980029
229900-          'SSAGE HEADER ATTRIBUTE [nodeID] of element [From]'    22990029
230000           DELIMITED BY SIZE                                      23000029
230100           INTO PV-FAULT-MSG                                      23010029
230200                                                                  23020029
230300        END-IF                                                    23030029
230400     END-IF                                                       23040029
230500                                                                  23050029
230600     IF PS-VALIDATE-PASS AND PS-FUNC-REC-RESP                     23060029
230700        IF NOT PS-IN-MSG-INRPT-D                                  23070029
230800                                                                  23080029
230900           SET PS-VALIDATE-FAIL  TO TRUE                          23090029
231000                                                                  23100029
231100           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME23110029
231200-          'SSAGE HEADER ELEMENT [InReplyTo]'                     23120029
231300           DELIMITED BY SIZE                                      23130029
231400           INTO PV-FAULT-MSG                                      23140029
231500                                                                  23150029
231600        END-IF                                                    23160029
231700                                                                  23170029
231800        IF PS-IN-MSG-INRPT-D AND PV-IN-MSG-INRPTO = SPACES        23180029
231900                                                                  23190029
232000           SET PS-VALIDATE-FAIL  TO TRUE                          23200029
232100                                                                  23210029
232200           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME23220029
232300-          'SSAGE HEADER ELEMENT [InReplyTo]'                     23230029
232400           DELIMITED BY SIZE INTO PV-FAULT-MSG                    23240029
232500                                                                  23250029
232600        END-IF                                                    23260029
232700     END-IF                                                       23270029
232800* VALIDATE OPTIONAL FIELDS                                        23280029
232900*    DISPLAY 'PS-EXDT-SW: ' PS-EXDT-SW                            23290029
233000*    DISPLAY 'PS-MANDATE-SW: ' PS-MANDATE-SW                      23300029
233100*    DISPLAY 'PS-IN-MSG-EXDT-Y: ' PS-IN-MSG-EXDT-SW               23310029
233200        IF PS-EXDT-NEED AND PS-VALIDATE-PASS                      23320029
233300                                                                  23330029
233400        AND PS-IN-MSG-EXDT-Y                                      23340029
233500                                                                  23350029
233600          MOVE PV-IN-MSG-EXDT TO PV-VALIDATE-DTM                  23360029
233700                                                                  23370029
233800          PERFORM VARYING PV-STR-INDEX14 FROM 1 BY 1              23380029
233900          UNTIL PS-VALIDATE-FAIL OR PV-STR-INDEX14 > 24           23390029
234000                                                                  23400029
234100            EVALUATE PV-STR-INDEX14                               23410029
234200                                                                  23420029
234300              WHEN 1                                              23430029
234400              WHEN 2                                              23440029
234500              WHEN 3                                              23450029
234600              WHEN 4                                              23460029
234700              WHEN 6                                              23470029
234800              WHEN 7                                              23480029
234900              WHEN 9                                              23490029
235000              WHEN 10                                             23500029
235100              WHEN 12                                             23510029
235200              WHEN 13                                             23520029
235300              WHEN 15                                             23530029
235400              WHEN 16                                             23540029
235500              WHEN 18                                             23550029
235600              WHEN 19                                             23560029
235700              WHEN 21                                             23570029
235800              WHEN 22                                             23580029
235900              WHEN 23                                             23590029
236000                                                                  23600029
236100                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT NUMERIC  23610029
236200                                                                  23620029
236300*                  STRING  'PV-VALIDATE-DTM NOT NUMERIC'          23630029
236400*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             23640029
236500*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       23650029
236600*                  PERFORM 9990-WRITE-CICS                        23660029
236700                   SET PS-VALIDATE-FAIL  TO TRUE                  23670029
236800                                                                  23680029
236900                END-IF                                            23690029
237000                                                                  23700029
237100              WHEN 5                                              23710029
237200              WHEN 8                                              23720029
237300                                                                  23730029
237400                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = '-'    23740029
237500                                                                  23750029
237600*                  STRING  'PV-VALIDATE-DTM NOT = -'              23760029
237700*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             23770029
237800*                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA        23780029
237900*                  PERFORM 9990-WRITE-CICS                        23790029
238000                                                                  23800029
238100                   SET PS-VALIDATE-FAIL  TO TRUE                  23810029
238200                                                                  23820029
238300                END-IF                                            23830029
238400                                                                  23840029
238500              WHEN 11                                             23850029
238600                                                                  23860029
238700                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = 'T'    23870029
238800*                  STRING  'PV-VALIDATE-DTM NOT = T'              23880029
238900*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             23890029
239000*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       23900029
239100*                  PERFORM 9990-WRITE-CICS                        23910029
239200                                                                  23920029
239300                   SET PS-VALIDATE-FAIL  TO TRUE                  23930029
239400                                                                  23940029
239500                END-IF                                            23950029
239600                                                                  23960029
239700              WHEN 14                                             23970029
239800              WHEN 17                                             23980029
239900                                                                  23990029
240000                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = ':'    24000029
240100*                  STRING  'PV-VALIDATE-DTM NOT = :'              24010029
240200*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             24020029
240300*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       24030029
240400*                  PERFORM 9990-WRITE-CICS                        24040029
240500                                                                  24050029
240600                   SET PS-VALIDATE-FAIL  TO TRUE                  24060029
240700                                                                  24070029
240800                END-IF                                            24080029
240900                                                                  24090029
241000              WHEN 20                                             24100029
241100                                                                  24110029
241200                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = '.'    24120029
241300*                  STRING  'PV-VALIDATE-DTM NOT = .'              24130029
241400*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             24140029
241500*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       24150029
241600*                  PERFORM 9990-WRITE-CICS                        24160029
241700                                                                  24170029
241800                   SET PS-VALIDATE-FAIL  TO TRUE                  24180029
241900                                                                  24190029
242000                END-IF                                            24200029
242100                                                                  24210029
242200              WHEN 24                                             24220029
242300                                                                  24230029
242400                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = 'Z'    24240029
242500*                  STRING  'PV-VALIDATE-DTM NOT = Z'              24250029
242600*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             24260029
242700*                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA        24270029
242800*                  PERFORM 9990-WRITE-CICS                        24280029
242900                                                                  24290029
243000                   SET PS-VALIDATE-FAIL  TO TRUE                  24300029
243100                                                                  24310029
243200                END-IF                                            24320029
243300                                                                  24330029
243400            END-EVALUATE                                          24340029
243500          END-PERFORM                                             24350029
243600                                                                  24360029
243700          IF PS-VALIDATE-FAIL                                     24370029
243800                                                                  24380029
243900           STRING 'BAD MESSAGE HEADER ELEMENT. '                  24390029
244000           DELIMITED BY SIZE                                      24400029
244100           'ExpiryDateTime' DELIMITED BY SIZE                     24410029
244200           ' ELEMENT CONTAINS IMPROPER DATE-TIME FORMAT: '        24420029
244300           DELIMITED BY SIZE                                      24430029
244400           PV-VALIDATE-DTM DELIMITED BY SIZE                      24440029
244500           INTO PV-FAULT-MSG                                      24450029
244600                                                                  24460029
244700          END-IF                                                  24470029
244800        END-IF                                                    24480029
244900           .                                                      24490029
245000******************************************************************24500029
245100* THIS SECTION LOGS THE ERROR MESSAGE IN SPOOL                    24510029
245200******************************************************************24520029
245300                                                                  24530029
245400 2150-PERFORM-SPOOL-LOG.                                          24540029
245500                                                                  24550029
245600     INITIALIZE PV-SPOOL-LOG-MSG                                  24560029
245700                                                                  24570029
245800      IF PS-FUNC-REC-RESP                                         24580029
245900                                                                  24590029
246000       STRING  PV-CURR-DATE DELIMITED BY SIZE                     24600029
246100               '||WARNING||' DELIMITED BY SIZE                    24610029
246200               'FAULT-MESSAGE:   ' DELIMITED BY SIZE              24620029
246300               PV-FAULT-MSG DELIMITED BY SIZE                     24630029
246400       INTO PV-SPOOL-LOG-MSG                                      24640029
246500                                                                  24650029
246600      ELSE                                                        24660029
246700                                                                  24670029
246800       STRING  PV-CURR-DATE DELIMITED BY SIZE                     24680029
246900               '||ERROR||' DELIMITED BY SIZE                      24690029
247000               'FAULT-MESSAGE:   ' DELIMITED BY SIZE              24700029
247100               PV-FAULT-MSG DELIMITED BY SIZE                     24710029
247200       INTO PV-SPOOL-LOG-MSG                                      24720029
247300                                                                  24730029
247400      END-IF                                                      24740029
247500                                                                  24750029
247600     MOVE 1                 TO PV-CSS-DSP-LEN                     24760029
247700     MOVE 80                TO PV-CSS-DSP-TO-LEN                  24770029
247800     MOVE LENGTH OF PV-SPOOL-LOG-MSG TO PV-SPOOL-LOG-LEN          24780029
247900                                                                  24790029
248000     PERFORM UNTIL PV-CSS-DSP-LEN > PV-SPOOL-LOG-LEN              24800029
248100                                                                  24810029
248200      STRING  PV-SPOOL-LOG-MSG(PV-CSS-DSP-LEN:PV-CSS-DSP-TO-LEN)  24820029
248300         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  24830029
248400      PERFORM 9990-WRITE-CICS                                     24840029
248500                                                                  24850029
248600      COMPUTE PV-CSS-DSP-LEN = 1 + PV-CSS-DSP-TO-LEN              24860029
248700      COMPUTE PV-CSS-DSP-TO-LEN = 80 + PV-CSS-DSP-TO-LEN          24870029
248800                                                                  24880029
248900     END-PERFORM                                                  24890029
249000           .                                                      24900029
249100******************************************************************24910029
249200* THIS SECTION CREATES SOAP FAULT AND IS INVOKED IF ANY VALIDATION24920029
249300* FAILURE OF A INCOMING REQUEST MESSAGE OCCURS                    24930029
249400******************************************************************24940029
249500                                                                  24950029
249600 2510-CREATE-SOAP-FAULT.                                          24960029
249700                                                                  24970029
249800     INITIALIZE PV-RESP                                           24980029
249900                PV-FAULT-CODE                                     24990029
250000                PS-SOAP-LEVEL                                     25000029
250100                PV-SOAP-LVL-LEN                                   25010029
250200                                                                  25020029
250300*    STRING  'GET CONTAINER DFHWS-SOAPLEVEL'                      25030029
250400*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  25040029
250500*    PERFORM 9990-WRITE-CICS                                      25050029
250600     EXEC CICS                                                    25060029
250700         GET CONTAINER('DFHWS-SOAPLEVEL')                         25070029
250800         INTO(PS-SOAP-LEVEL)                                      25080029
250900         FLENGTH(PV-SOAP-LVL-LEN)                                 25090029
251000         RESP(PV-RESP)                                            25100029
251100     END-EXEC                                                     25110029
251200                                                                  25120029
251300     IF PS-SOAP-11                                                25130029
251400                                                                  25140029
251500        MOVE DFHVALUE(CLIENT) TO PV-FAULT-CODE                    25150029
251600                                                                  25160029
251700     ELSE                                                         25170029
251800                                                                  25180029
251900        MOVE DFHVALUE(SENDER) TO PV-FAULT-CODE                    25190029
252000                                                                  25200029
252100     END-IF                                                       25210029
252200                                                                  25220029
252300*    STRING  'ISSUING SOAPFAULT'                                  25230029
252400*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  25240029
252500*    PERFORM 9990-WRITE-CICS                                      25250029
252600     STRING  PV-CURR-DATE DELIMITED BY SIZE                       25260029
252700             '||ERROR||' DELIMITED BY SIZE                        25270029
252800             'FAULT-MESSAGE:   ' DELIMITED BY SIZE                25280029
252900             PV-FAULT-MSG DELIMITED BY SIZE                       25290029
253000      INTO PV-FAULT-MSG-1                                         25300029
253100                                                                  25310029
253200     EXEC CICS SOAPFAULT CREATE                                   25320029
253300         FAULTSTRING(PV-FAULT-MSG-1)                              25330029
253400         FAULTSTRLEN(LENGTH OF PV-FAULT-MSG-1)                    25340029
253500         FAULTCODE(PV-FAULT-CODE)                                 25350029
253600         RESP(PV-RESP)                                            25360029
253700     END-EXEC                                                     25370029
253800                                                                  25380029
253900*    MOVE   PV-RESP            TO PV-RESP-DISP                    25390029
254000*    STRING  'PV-RESP AFTER SOAP FAULT: ' PV-RESP-DISP            25400029
254100*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  25410029
254200*    PERFORM 9990-WRITE-CICS                                      25420029
254300     .                                                            25430029
254400******************************************************************25440029
254500* THIS SECTION GENERATES UTC                                      25450029
254600* 1) CALL CEEGMT TO OBTAIN CURRENT GMT IN SECS FORMAT             25460029
254700* 2) CALL CEEDATM TO CONVERT THE SECONDS INTO                     25470029
254800*    'YYYY-MM-DDTHH:MI:SS.999Z' FORMAT                            25480029
254900******************************************************************25490029
255000* UTC TIME HANDLING                                               25500029
255100 1008-GENERATE-UTC.                                               25510029
255200                                                                  25520029
255300     INITIALIZE PV-UTC-DATE                                       25530029
255400                                                                  25540029
255500     CALL 'CEEGMT' USING PV-LILIAN , PV-CEE-SECS , PV-FC.         25550029
255600                                                                  25560029
255700     IF PV-COND-TOKEN-VALUE = LOW-VALUES THEN                     25570029
255800                                                                  25580029
255900        MOVE PV-CEE-SECS TO PV-SECS                               25590029
256000        MOVE PV-CEE-SECS TO PV-SAVED-SECS                         25600029
256100                                                                  25610029
256200     ELSE                                                         25620029
256300                                                                  25630029
256400*       STRING  'CEEGMT failed with msg '                         25640029
256500*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  25650029
256600*       PERFORM 9990-WRITE-CICS                                   25660029
256700        EXEC CICS ABEND ABCODE('C021') END-EXEC                   25670029
256800                                                                  25680029
256900     END-IF                                                       25690029
257000                                                                  25700029
257100     MOVE 24 TO PV-STRING-LENGTH OF PV-PICSTR                     25710029
257200     MOVE 'YYYY-MM-DDTHH:MI:SS.999Z' TO                           25720029
257300           PV-STRING-TEXT OF PV-PICSTR(1:24)                      25730029
257400                                                                  25740029
257500     CALL 'CEEDATM' USING PV-CEE-SECS,                            25750029
257600                          PV-PICSTR,                              25760029
257700                          PV-CHRDATE,                             25770029
257800                          PV-FC.                                  25780029
257900                                                                  25790029
258000     IF PV-COND-TOKEN-VALUE = LOW-VALUES THEN                     25800029
258100                                                                  25810029
258200*       STRING  'Input Lilian date '                              25820029
258300*               'corresponds to:  ' PV-CHRDATE                    25830029
258400*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           25840029
258500*       PERFORM 9990-WRITE-CICS                                   25850029
258600        MOVE PV-CHRDATE TO PV-UTC-DATE                            25860029
258700                                                                  25870029
258800     ELSE                                                         25880029
258900                                                                  25890029
259000*       STRING  'CEEDATE failed with msg '                        25900029
259100*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  25910029
259200*       PERFORM 9990-WRITE-CICS                                   25920029
259300                                                                  25930029
259400        EXEC CICS ABEND ABCODE('C022') END-EXEC                   25940029
259500                                                                  25950029
259600     END-IF                                                       25960029
259700           .                                                      25970029
259800******************************************************************25980029
259900* MESSAGEID IS EXPECTED TO BE A UUID. SINCE UUID GENERATION IS NOT25990029
260000* POSSIBLE FROM WITHIN MAINFRAME, A SIMILAR UNIQUE ID IS TO BE    26000029
260100* GENERATED USING:                                                26010029
260200* 1) LAST 5 CHARACTERS OF PIPELINE NAME                           26020029
260300* 2) 7 CHARACTERS OF EIBTASKN                                     26030029
260400* 3) 18 CHARACTERS OF CURRENT GMT IN SECONDS FORMAT OBTAINED IN   26040029
260500*    1008-GENERATE-UTC                                            26050029
260600******************************************************************26060029
260700* OBTAIN PIPELINE NAME AND THE TASKN ID ASSOCIATED                26070029
260800 2420-GENERATE-MSGID.                                             26080029
260900                                                                  26090029
261000     INITIALIZE PV-RESP                                           26100029
261100*    STRING  'READ DFHWS-PIPELINE'                                26110029
261200*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  26120029
261300*    PERFORM 9990-WRITE-CICS                                      26130029
261400                                                                  26140029
261500     EXEC CICS                                                    26150029
261600       GET CONTAINER('DFHWS-PIPELINE')                            26160029
261700       INTO(PV-PIPE-AREA)                                         26170029
261800       FLENGTH(PV-PIPE-LEN)                                       26180029
261900       RESP(PV-RESP)                                              26190029
262000     END-EXEC                                                     26200029
262100                                                                  26210029
262200     EVALUATE PV-RESP                                             26220029
262300                                                                  26230029
262400       WHEN DFHRESP(CCSIDERR)                                     26240029
262500                                                                  26250029
262600           EXEC CICS ABEND ABCODE('C023') END-EXEC                26260029
262700                                                                  26270029
262800           CONTINUE                                               26280029
262900                                                                  26290029
263000       WHEN DFHRESP(CONTAINERERR)                                 26300029
263100           EXEC CICS ABEND ABCODE('C024') END-EXEC                26310029
263200                                                                  26320029
263300           CONTINUE                                               26330029
263400                                                                  26340029
263500       WHEN DFHRESP(INVREQ)                                       26350029
263600                                                                  26360029
263700           EXEC CICS ABEND ABCODE('C025') END-EXEC                26370029
263800                                                                  26380029
263900           CONTINUE                                               26390029
264000                                                                  26400029
264100       WHEN DFHRESP(LENGERR)                                      26410029
264200                                                                  26420029
264300           EXEC CICS ABEND ABCODE('C026') END-EXEC                26430029
264400                                                                  26440029
264500           CONTINUE                                               26450029
264600                                                                  26460029
264700     END-EVALUATE                                                 26470029
264800                                                                  26480029
264900*    STRING  'PV-PIPE-AREA :' PV-PIPE-AREA                        26490029
265000*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  26500029
265100*    PERFORM 9990-WRITE-CICS                                      26510029
265200                                                                  26520029
265300     MOVE PV-PIPE-AREA              TO PV-PIPE-AREA-SPLIT         26530029
265400     MOVE EIBTASKN                  TO PV-TASKN                   26540029
265500*    DISPLAY 'PV-TASK-NBR : ' PV-TASK-NBR                         26550029
265600     MOVE PV-TASK-NBR(1:1)          TO PV-TASK1                   26560029
265700     MOVE PV-TASK-NBR(2:4)          TO PV-TASK2                   26570029
265800     MOVE PV-TASK-NBR(6:2)          TO PV-TASK3                   26580029
265900     MOVE PV-SECS2(1:2)             TO PV-SEC-1                   26590029
266000     MOVE PV-SECS2(3:4)             TO PV-SEC-2                   26600029
266100     MOVE PV-SECS2(7:12)            TO PV-SEC-3                   26610029
266200                                                                  26620029
266300     STRING PV-MSGID-MF-LITERAL DELIMITED BY SIZE                 26630029
266400            PV-PIPE-AREA-SPLIT  DELIMITED BY SIZE                 26640029
266500            PV-TASKN-SPLIT      DELIMITED BY SIZE                 26650029
266600            PV-SECS2-SPLIT      DELIMITED BY SIZE                 26660029
266700     INTO   PV-NEW-MESSAGE-ID                                     26670029
266800                                                                  26680029
266900           .                                                      26690029
267000******************************************************************26700029
267100* WHILE PREPARING KMH, IF 'FROM' ELEMENT IS LISTED AS MANDATORY,  26710029
267200* THEN THIS SECTION PERFORMS BELOW:                               26720029
267300* RETRIEVE SYSTEMCD, APP, MODULE & NODEID DETAILS FROM CONFIG FILE26730029
267400* AND COMPOSE 'FROM' ELEMENT                                      26740029
267500******************************************************************26750029
267600 2430-GENERATE-FROM.                                              26760029
267700                                                                  26770029
267800     INITIALIZE SU131-CA-CONFIG-RECORD                            26780029
267900                PV-CONFIG-RECORD                                  26790029
268000                PV-STR-INDEX10                                    26800029
268100                                                                  26810029
268200     MOVE PV-WEBS-AREA        TO SU131-WEBS-AREA                  26820029
268300     MOVE 1                   TO SU131-SEQ-NO                     26830029
268400                                                                  26840029
268500     PERFORM VARYING PV-STR-INDEX10 FROM 1 BY 1 UNTIL             26850029
268600     PV-STR-INDEX10 > 4                                           26860029
268700                                                                  26870029
268800       EVALUATE PV-STR-INDEX10                                    26880029
268900                                                                  26890029
269000         WHEN 1                                                   26900029
269100                                                                  26910029
269200            MOVE 'systemCode'         TO SU131-FUNC-AREA          26920029
269300                                                                  26930029
269400         WHEN 2                                                   26940029
269500                                                                  26950029
269600            MOVE 'app'                TO SU131-FUNC-AREA          26960029
269700                                                                  26970029
269800         WHEN 3                                                   26980029
269900                                                                  26990029
270000            MOVE 'module'             TO SU131-FUNC-AREA          27000029
270100                                                                  27010029
270200         WHEN 4                                                   27020029
270300                                                                  27030029
270400            MOVE 'nodeID'             TO SU131-FUNC-AREA          27040029
270500                                                                  27050029
270600       END-EVALUATE                                               27060029
270700                                                                  27070029
270800       PERFORM 7000-VSAM-FILE-READ                                27080029
270900                                                                  27090029
271000       EVALUATE PV-RESP                                           27100029
271100                                                                  27110029
271200          WHEN 0                                                  27120029
271300                                                                  27130029
271400              CONTINUE                                            27140029
271500                                                                  27150029
271600          WHEN 13                                                 27160029
271700                                                                  27170029
271800              MOVE PV-DEFAULT-WEBS     TO SU131-WEBS-AREA         27180029
271900                                                                  27190029
272000              PERFORM 7000-VSAM-FILE-READ                         27200029
272100                                                                  27210029
272200              IF PV-RESP = 13                                     27220029
272300                                                                  27230029
272400                 EXEC CICS ABEND ABCODE('C027') END-EXEC          27240029
272500                                                                  27250029
272600                 CONTINUE                                         27260029
272700                                                                  27270029
272800              END-IF                                              27280029
272900                                                                  27290029
273000       END-EVALUATE                                               27300029
273100                                                                  27310029
273200* UNSTRING PV-CONFIG-RECORD                                       27320029
273300       MOVE PV-CONFIG-RECORD          TO SU131-CA-CONFIG-RECORD   27330029
273400                                                                  27340029
273500       EVALUATE PV-STR-INDEX10                                    27350029
273600                                                                  27360029
273700         WHEN 1                                                   27370029
273800                                                                  27380029
273900            MOVE SU131-FREE-TEXT      TO PV-NEW-SYSTEM-CD         27390029
274000                                                                  27400029
274100         WHEN 2                                                   27410029
274200                                                                  27420029
274300            MOVE SU131-FREE-TEXT      TO PV-NEW-APP               27430029
274400                                                                  27440029
274500         WHEN 3                                                   27450029
274600                                                                  27460029
274700            MOVE SU131-FREE-TEXT      TO PV-NEW-MODULE            27470029
274800                                                                  27480029
274900         WHEN 4                                                   27490029
275000                                                                  27500029
275100            MOVE SU131-FREE-TEXT      TO PV-NEW-NODEID            27510029
275200                                                                  27520029
275300       END-EVALUATE                                               27530029
275400                                                                  27540029
275500     END-PERFORM                                                  27550029
275600                                                                  27560029
275700     MOVE PV-HOST-NAME                TO PV-NEW-NODEID            27570029
275800           .                                                      27580029
275900******************************************************************27590029
276000* THIS SECTION RETRIEVES THE ADDITIONAL OPTIONAL FIELDS NEEDED TO 27600029
276100* BUILD KMH FROM CONFIG FILE AND GENERATES THEM                   27610029
276200* IF NEW FIELDS NEED TO BE ADDED TO THE CURRENT LIST OF OPTIONAL  27620029
276300* FIELDS, THEN THIS SECTION WOULD NEED CHANGE TO SET THE          27630029
276400* 'FIELD-REQUIRED' FLAG TO TRUE. FURTHER, A NEW SECTION WOULD     27640029
276500* NEED TO BE CODED, TO BUILD THE NEW FIELD. ALSO, THIS FIELD NEEDS27650029
276600* TO BE ADDED TO THE CONFIG FILE                                  27660029
276700******************************************************************27670029
276800 2410-OPT-HDR-FLDS.                                               27680029
276900                                                                  27690029
277000     INITIALIZE SU131-CA-CONFIG-RECORD                            27700029
277100                PV-CONFIG-RECORD                                  27710029
277200                                                                  27720029
277300     PERFORM VARYING PV-STR-INDEX11 FROM 1 BY 1                   27730029
277400        UNTIL PV-STR-INDEX11 > 99                                 27740029
277500                                                                  27750029
277600        MOVE SPACES           TO                                  27760029
277700        PV-SECTION-NAME4(PV-STR-INDEX11)                          27770029
277800                                                                  27780029
277900     END-PERFORM                                                  27790029
278000                                                                  27800029
278100     MOVE 'OPTIONAL'         TO SU131-FUNC-AREA                   27810029
278200* FIRST TRY WITH CURRENT WEBSERVICE NAME                          27820029
278300     MOVE PV-WEBS-AREA        TO SU131-WEBS-AREA                  27830029
278400     MOVE 1                   TO SU131-SEQ-NO                     27840029
278500                                                                  27850029
278600     PERFORM 7000-VSAM-FILE-READ                                  27860029
278700                                                                  27870029
278800     EVALUATE PV-RESP                                             27880029
278900                                                                  27890029
279000        WHEN 0                                                    27900029
279100                                                                  27910029
279200            CONTINUE                                              27920029
279300                                                                  27930029
279400        WHEN 13                                                   27940029
279500                                                                  27950029
279600* ROW NOT FOUND. USE DEFAULT WEBSERVICE NAME                      27960029
279700            MOVE PV-DEFAULT-WEBS     TO SU131-WEBS-AREA           27970029
279800                                                                  27980029
279900            PERFORM 7000-VSAM-FILE-READ                           27990029
280000                                                                  28000029
280100            IF PV-RESP NOT = 0                                    28010029
280200                                                                  28020029
280300               EXEC CICS ABEND ABCODE('C028') END-EXEC            28030029
280400               CONTINUE                                           28040029
280500                                                                  28050029
280600            END-IF                                                28060029
280700                                                                  28070029
280800        WHEN OTHER                                                28080029
280900                                                                  28090029
281000            EXEC CICS ABEND ABCODE('C029') END-EXEC               28100029
281100                                                                  28110029
281200     END-EVALUATE                                                 28120029
281300* UNSTRING PV-CONFIG-RECORD                                       28130029
281400                                                                  28140029
281500     MOVE PV-CONFIG-RECORD           TO SU131-CA-CONFIG-RECORD    28150029
281600     MOVE 1                          TO PV-STRING-PTR-4           28160029
281700     MOVE 0                          TO PV-NBR-O-ELEMENTS         28170029
281800     SET PS-CONT-THE-LOOP            TO TRUE                      28180029
281900                                                                  28190029
282000     PERFORM VARYING PV-STR-INDEX11 FROM 1 BY 1                   28200029
282100        UNTIL PV-STR-INDEX11 > 99 OR                              28210029
282200        PS-BREAK-THE-LOOP                                         28220029
282300                                                                  28230029
282400        UNSTRING SU131-FREE-TEXT DELIMITED BY ';'                 28240029
282500          INTO PV-SECTION-NAME4(PV-STR-INDEX11)                   28250029
282600          WITH POINTER PV-STRING-PTR-4                            28260029
282700        END-UNSTRING                                              28270029
282800                                                                  28280029
282900        EVALUATE PV-SECTION-NAME4(PV-STR-INDEX11)                 28290029
283000                                                                  28300029
283100           WHEN 'From'                                            28310029
283200                                                                  28320029
283300               SET PS-FROM-NEED       TO TRUE                     28330029
283400                                                                  28340029
283500           WHEN 'MessageID'                                       28350029
283600                                                                  28360029
283700               SET PS-MSGID-NEED      TO TRUE                     28370029
283800                                                                  28380029
283900           WHEN 'CreateDateTime'                                  28390029
284000                                                                  28400029
284100               SET SV-CRDATM-NEED     TO TRUE                     28410029
284200                                                                  28420029
284300           WHEN 'ExpiryDateTime'                                  28430029
284400                                                                  28440029
284500                SET PS-EXDT-NEED      TO TRUE                     28450029
284600                                                                  28460029
284700           WHEN 'Action'                                          28470029
284800                                                                  28480029
284900                SET PS-ACT-NEED       TO TRUE                     28490029
285000                                                                  28500029
285100           WHEN 'To'                                              28510029
285200                                                                  28520029
285300                SET PS-TO-NEED        TO TRUE                     28530029
285400                                                                  28540029
285500           WHEN 'RoutingKeys'                                     28550029
285600                                                                  28560029
285700                SET PS-RKEYS-NEED     TO TRUE                     28570029
285800                                                                  28580029
285900           WHEN 'CorrelationID'                                   28590029
286000                                                                  28600029
286100                SET PS-CORID-NEED     TO TRUE                     28610029
286200                                                                  28620029
286300           WHEN 'Fault'                                           28630029
286400                                                                  28640029
286500                SET PS-FAULT-NEED     TO TRUE                     28650029
286600                                                                  28660029
286700           WHEN 'InReplyTo'                                       28670029
286800                                                                  28680029
286900                SET PS-INRPTO-NEED    TO TRUE                     28690029
287000                                                                  28700029
287100        END-EVALUATE                                              28710029
287200                                                                  28720029
287300        IF PV-SECTION-NAME4(PV-STR-INDEX11) = SPACES              28730029
287400                                                                  28740029
287500           SET PS-BREAK-THE-LOOP   TO TRUE                        28750029
287600                                                                  28760029
287700        END-IF                                                    28770029
287800                                                                  28780029
287900     END-PERFORM                                                  28790029
288000                                                                  28800029
288100     MOVE PV-STR-INDEX11             TO PV-NBR-O-ELEMENTS         28810029
288200           .                                                      28820029
288300******************************************************************28830029
288400* THIS SECTION PERFORMS BELOW LOGIC:                              28840029
288500* 1) PREPARE KMH XML FOR SEND-REQUEST, SEND-RESPONSE, RECIEVE     28850029
288600*    REQUEST (ERROR CONDITION)                                    28860029
288700* 2) WRITE INTO DFHHEADER CONTAINER                               28870029
288800******************************************************************28880029
288900 2480-WRITE-DFHHDR.                                               28890029
289000                                                                  28900029
289100*    STRING  '2480-WRITE-DFHHDR'                                  28910029
289200*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  28920029
289300*    PERFORM 9990-WRITE-CICS                                      28930029
289400                                                                  28940029
289500     IF (PS-FUNC-SEND-REQ) OR (PS-FUNC-SEND-RESP) OR              28950029
289600     (PS-FUNC-REC-REQ AND PS-VALIDATE-FAIL)                       28960029
289700                                                                  28970029
289800       PERFORM 2520-NEW-KMH-XML                                   28980029
289900       PERFORM 2530-UPD-DFHHEADER                                 28990029
290000                                                                  29000029
290100     ELSE                                                         29010029
290200                                                                  29020029
290300       CONTINUE                                                   29030029
290400                                                                  29040029
290500     END-IF                                                       29050029
290600           .                                                      29060029
290700******************************************************************29070029
290800* THIS PARA HANDLES XML PARSING BY EVALUATING 'XML-EVENT'         29080029
290900* 1) ELEMENT PRESENCE WOULD BE KNOWN FROM XML-TEXT OF             29090029
291000*    'START-OF-ELEMENT'                                           29100029
291100* 2) VALUE OF THAT ELEMENT WOULD BE KNOWN FROM XML-TEXT OF        29110029
291200*    'CONTENT-CHARACTERS'                                         29120029
291300* 3) ELEMENT 'FROM' HAS ATTRIBUTES NAMELY, SYSTEMCODE, APP, MODULE29130029
291400*    NODEID. PRESENCE OF THESE ATTRIBUTES WOULD BE KNOWN FROM     29140029
291500*    XML-TEXT OF 'ATTRIBUTE-NAME'. CORRESPONDING VALUES WOULD BE  29150029
291600*    KNOWN FROM THE XML-TEXT OF 'ATTRIBUTE-CHARACTERS'            29160029
291700******************************************************************29170029
291800 2190-XML-HANDLER.                                                29180029
291900                                                                  29190029
292000     EVALUATE XML-EVENT                                           29200029
292100                                                                  29210029
292200        WHEN 'START-OF-ELEMENT'                                   29220029
292300*         STRING  'START OF ELEMENT'                              29230029
292400*                 'XML-TEXT: ' XML-TEXT                           29240029
292500*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                29250029
292600*         PERFORM 9990-WRITE-CICS                                 29260029
292700                                                                  29270029
292800          MOVE 0                            TO PV-STR-INDEX3      29280029
292900          MOVE 0                            TO PV-STR-INDEX4      29290029
293000          SET PS-CONT-THE-LOOP              TO TRUE               29300029
293100          SET PS-IN-MSG-FLDS-NO             TO TRUE               29310029
293200                                                                  29320029
293300          PERFORM UNTIL PV-STR-INDEX3 > PV-NBR-M-ELEMENTS OR      29330029
293400            PS-BREAK-THE-LOOP                                     29340029
293500                                                                  29350029
293600            ADD 1                           TO PV-STR-INDEX3      29360029
293700                                                                  29370029
293800*              STRING  'XML-TEXT: ' XML-TEXT                      29380029
293900*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           29390029
294000*              PERFORM 9990-WRITE-CICS                            29400029
294100*              STRING  'PV-STR-INDEX3: ' PV-STR-INDEX3            29410029
294200*                      'PV-KMH-ELEMENT(PV-STR-INDEX3): '          29420029
294300*                       PV-KMH-ELEMENT(PV-STR-INDEX3)             29430029
294400*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           29440029
294500*              PERFORM 9990-WRITE-CICS                            29450029
294600            IF XML-TEXT = PV-KMH-ELEMENT(PV-STR-INDEX3)           29460029
294700                                                                  29470029
294800               MOVE 'Y'                     TO                    29480029
294900               PV-KMH-ELE-PRESENCE(PV-STR-INDEX3)                 29490029
295000               SET PS-BREAK-THE-LOOP        TO TRUE               29500029
295100                                                                  29510029
295200               IF XML-TEXT = 'MessageID'                          29520029
295300                                                                  29530029
295400                  SET PS-IN-MSG-FLDS-MSGID  TO TRUE               29540029
295500                                                                  29550029
295600               END-IF                                             29560029
295700                                                                  29570029
295800               IF XML-TEXT = 'CorrelationID'                      29580029
295900                                                                  29590029
296000                  SET PS-IN-MSG-FLDS-CORRID TO TRUE               29600029
296100                                                                  29610029
296200               END-IF                                             29620029
296300                                                                  29630029
296400               IF XML-TEXT = 'From'                               29640029
296500                                                                  29650029
296600                  SET PS-IN-MSG-FLDS-FROM   TO TRUE               29660029
296700                  SET PS-IN-MSG-FRM-YES     TO TRUE               29670029
296800                  SET PS-IN-SYS-CD-NO       TO TRUE               29680029
296900                  SET PS-IN-APP-CD-NO       TO TRUE               29690029
297000                  SET PS-IN-MOD-CD-NO       TO TRUE               29700029
297100                  SET PS-IN-NOD-ID-NO       TO TRUE               29710029
297200                                                                  29720029
297300               END-IF                                             29730029
297400                                                                  29740029
297500               IF XML-TEXT = 'CreateDateTime'                     29750029
297600                                                                  29760029
297700                  SET PS-IN-MSG-FLDS-CRDT   TO TRUE               29770029
297800                                                                  29780029
297900               END-IF                                             29790029
298000            END-IF                                                29800029
298100                                                                  29810029
298200            IF PS-CORID-NEED                                      29820029
298300                                                                  29830029
298400               IF XML-TEXT = 'CorrelationID'                      29840029
298500                                                                  29850029
298600                  SET PS-IN-MSG-FLDS-CORRID TO TRUE               29860029
298700                                                                  29870029
298800               END-IF                                             29880029
298900                                                                  29890029
299000            END-IF                                                29900029
299100                                                                  29910029
299200            IF XML-TEXT = 'InReplyTo'                             29920029
299300                                                                  29930029
299400               SET PS-IN-MSG-INRPT-Y     TO TRUE                  29940029
299500                                                                  29950029
299600            END-IF                                                29960029
299700                                                                  29970029
299800            IF XML-TEXT = 'Fault'                                 29980029
299900                                                                  29990029
300000               SET PS-IN-MSG-FAULT-Y     TO TRUE                  30000029
300100                                                                  30010029
300200            END-IF                                                30020029
300300                                                                  30030029
300400            IF XML-TEXT = 'Code' AND PS-IN-MSG-FAULT-Y            30040029
300500                                                                  30050029
300600               SET PS-IN-MSG-FAULT-C     TO TRUE                  30060029
300700                                                                  30070029
300800            END-IF                                                30080029
300900                                                                  30090029
301000            IF XML-TEXT = 'Description'                           30100029
301100                                                                  30110029
301200               SET PS-IN-MSG-FAULT-D     TO TRUE                  30120029
301300                                                                  30130029
301400            END-IF                                                30140029
301500                                                                  30150029
301600            IF PS-EXDT-NEED                                       30160029
301700                                                                  30170029
301800               IF XML-TEXT = 'ExpiryDateTime'                     30180029
301900                                                                  30190029
302000                  SET PS-IN-MSG-FLDS-EXDT   TO TRUE               30200029
302100                                                                  30210029
302200               END-IF                                             30220029
302300            END-IF                                                30230029
302400                                                                  30240029
302500          END-PERFORM                                             30250029
302600        WHEN 'CONTENT-CHARACTERS'                                 30260029
302700                                                                  30270029
302800*         STRING  'CONTENT-CHARACTERS'                            30280029
302900*                 'XML-TEXT: ' XML-TEXT                           30290029
303000*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                30300029
303100*         PERFORM 9990-WRITE-CICS                                 30310029
303200          IF PV-KMH-ELE-PRESENCE(PV-STR-INDEX3) = 'Y'             30320029
303300                                                                  30330029
303400            ADD 1                           TO PV-STR-INDEX4      30340029
303500            MOVE XML-TEXT                   TO                    30350029
303600            PV-KMH-ELEMENT-VAL(PV-STR-INDEX3, PV-STR-INDEX4)      30360029
303700                                                                  30370029
303800            IF PS-IN-MSG-FLDS-MSGID                               30380029
303900                                                                  30390029
304000               MOVE XML-TEXT                TO PV-IN-MSG-MSGID    30400029
304100                                                                  30410029
304200            END-IF                                                30420029
304300                                                                  30430029
304400            IF PS-IN-MSG-FLDS-CRDT                                30440029
304500                                                                  30450029
304600               MOVE XML-TEXT                TO PV-IN-MSG-CRDT     30460029
304700                                                                  30470029
304800            END-IF                                                30480029
304900                                                                  30490029
305000            IF PS-IN-MSG-FLDS-CORRID                              30500029
305100                                                                  30510029
305200*           DISPLAY 'MOVING PV-IN-MSG-CORRID: '                   30520029
305300*           DISPLAY XML-TEXT                                      30530029
305400               MOVE XML-TEXT                TO PV-IN-MSG-CORRID   30540029
305500                                                                  30550029
305600            END-IF                                                30560029
305700          END-IF                                                  30570029
305800                                                                  30580029
305900          IF PS-IN-MSG-INRPT-Y                                    30590029
306000                                                                  30600029
306100             MOVE XML-TEXT                  TO PV-IN-MSG-INRPTO   30610029
306200             SET PS-IN-MSG-INRPT-D          TO TRUE               30620029
306300                                                                  30630029
306400          END-IF                                                  30640029
306500                                                                  30650029
306600          IF PS-IN-MSG-FAULT-C                                    30660029
306700                                                                  30670029
306800             MOVE XML-TEXT                  TO PV-IN-MSG-FAULT-CD 30680029
306900             SET PS-IN-MSG-FAULT-F          TO TRUE               30690029
307000                                                                  30700029
307100          END-IF                                                  30710029
307200                                                                  30720029
307300          IF PS-IN-MSG-FAULT-D                                    30730029
307400                                                                  30740029
307500             MOVE XML-TEXT                  TO PV-IN-MSG-FAULT-DES30750029
307600             SET PS-IN-MSG-FAULT-F          TO TRUE               30760029
307700                                                                  30770029
307800          END-IF                                                  30780029
307900                                                                  30790029
308000          IF PS-IN-MSG-FLDS-CORRID                                30800029
308100*            DISPLAY 'MOVING PV-IN-MSG-CORRID: '                  30810029
308200*            DISPLAY XML-TEXT                                     30820029
308300                                                                  30830029
308400             MOVE XML-TEXT                TO PV-IN-MSG-CORRID     30840029
308500          END-IF                                                  30850029
308600                                                                  30860029
308700          IF PS-IN-MSG-FLDS-EXDT                                  30870029
308800                                                                  30880029
308900*            DISPLAY 'MOVING PV-IN-MSG-EXDT: '                    30890029
309000*            DISPLAY XML-TEXT                                     30900029
309100             MOVE XML-TEXT                TO PV-IN-MSG-EXDT       30910029
309200             SET PS-IN-MSG-EXDT-Y         TO TRUE                 30920029
309300                                                                  30930029
309400          END-IF                                                  30940029
309500                                                                  30950029
309600        WHEN 'END-OF-ELEMENT'                                     30960029
309700                                                                  30970029
309800          IF PS-IN-MSG-INRPT-Y                                    30980029
309900                                                                  30990029
310000             SET PS-IN-MSG-INRPT-N        TO TRUE                 31000029
310100                                                                  31010029
310200          END-IF                                                  31020029
310300         CONTINUE                                                 31030029
310400*         STRING  'END-OF-ELEMENT'                                31040029
310500*                 'XML-TEXT: ' XML-TEXT                           31050029
310600*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31060029
310700*         PERFORM 9990-WRITE-CICS                                 31070029
310800                                                                  31080029
310900        WHEN 'START-OF-DOCUMENT'                                  31090029
311000                                                                  31100029
311100         CONTINUE                                                 31110029
311200*         STRING  'START-OF-DOCUMENT'                             31120029
311300*                 'XML-TEXT: ' XML-TEXT                           31130029
311400*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31140029
311500*         PERFORM 9990-WRITE-CICS                                 31150029
311600                                                                  31160029
311700        WHEN 'END-OF-DOCUMENT'                                    31170029
311800                                                                  31180029
311900         CONTINUE                                                 31190029
312000                                                                  31200029
312100*         STRING  'END-OF-DOCUMENT'                               31210029
312200*                 'XML-TEXT: ' XML-TEXT                           31220029
312300*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31230029
312400*         PERFORM 9990-WRITE-CICS                                 31240029
312500        WHEN 'VERSION-INFORMATION'                                31250029
312600                                                                  31260029
312700         CONTINUE                                                 31270029
312800*         STRING  'VERSION-INFORMATION'                           31280029
312900*                 'XML-TEXT: ' XML-TEXT                           31290029
313000*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31300029
313100*         PERFORM 9990-WRITE-CICS                                 31310029
313200                                                                  31320029
313300        WHEN 'ENCODING-DECLARATION'                               31330029
313400                                                                  31340029
313500         CONTINUE                                                 31350029
313600*         STRING  'ENCODING-DECLARATION'                          31360029
313700*                 'XML-TEXT: ' XML-TEXT                           31370029
313800*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31380029
313900*         PERFORM 9990-WRITE-CICS                                 31390029
314000                                                                  31400029
314100        WHEN 'STANDALONE-DECLARATION'                             31410029
314200                                                                  31420029
314300         CONTINUE                                                 31430029
314400*         STRING  'STANDALONE-DECLARATION'                        31440029
314500*                 'XML-TEXT: ' XML-TEXT                           31450029
314600*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31460029
314700*         PERFORM 9990-WRITE-CICS                                 31470029
314800                                                                  31480029
314900        WHEN 'ATTRIBUTE-NAME'                                     31490029
315000                                                                  31500029
315100         IF XML-TEXT = 'systemCode'                               31510029
315200                                                                  31520029
315300            SET PS-IN-SYS-CD-YES TO TRUE                          31530029
315400*           DISPLAY 'SYS-CD SET TO YES'                           31540029
315500                                                                  31550029
315600         END-IF                                                   31560029
315700                                                                  31570029
315800         IF XML-TEXT = 'app'                                      31580029
315900                                                                  31590029
316000            SET PS-IN-APP-CD-YES TO TRUE                          31600029
316100*           DISPLAY 'APP-CD SET TO YES'                           31610029
316200                                                                  31620029
316300         END-IF                                                   31630029
316400                                                                  31640029
316500         IF XML-TEXT = 'module'                                   31650029
316600                                                                  31660029
316700            SET PS-IN-MOD-CD-YES TO TRUE                          31670029
316800*           DISPLAY 'MOD-CD SET TO YES'                           31680029
316900                                                                  31690029
317000         END-IF                                                   31700029
317100                                                                  31710029
317200         IF XML-TEXT = 'nodeID'                                   31720029
317300                                                                  31730029
317400            SET PS-IN-NOD-ID-YES TO TRUE                          31740029
317500*           DISPLAY 'NOD-ID SET TO YES'                           31750029
317600                                                                  31760029
317700         END-IF                                                   31770029
317800                                                                  31780029
317900         IF XML-TEXT = 'version'                                  31790029
318000                                                                  31800029
318100            SET PS-INKMH-VER-Y   TO TRUE                          31810029
318200*           DISPLAY 'NOD-ID SET TO YES'                           31820029
318300         END-IF                                                   31830029
318400                                                                  31840029
318500         CONTINUE                                                 31850029
318600*         STRING  'ATTRIBUTE-NAME'                                31860029
318700*                 'XML-TEXT: ' XML-TEXT                           31870029
318800*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31880029
318900*         PERFORM 9990-WRITE-CICS                                 31890029
319000                                                                  31900029
319100        WHEN 'START-OF-CDATA-SECTION'                             31910029
319200                                                                  31920029
319300*         STRING  'START-OF-CDATA-SECTION'                        31930029
319400*                 'XML-TEXT: ' XML-TEXT                           31940029
319500*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31950029
319600*         PERFORM 9990-WRITE-CICS                                 31960029
319700         CONTINUE                                                 31970029
319800                                                                  31980029
319900        WHEN 'END-OF-CDATA-SECTION'                               31990029
320000                                                                  32000029
320100*         STRING  'END-OF-CDATA-SECTION'                          32010029
320200*                 'XML-TEXT: ' XML-TEXT                           32020029
320300*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32030029
320400*         PERFORM 9990-WRITE-CICS                                 32040029
320500                                                                  32050029
320600         CONTINUE                                                 32060029
320700                                                                  32070029
320800        WHEN 'PROCESSING-INSTRUCTION-TARGET'                      32080029
320900                                                                  32090029
321000*         STRING  'PROCESSING-INSTRUCTION-TARGET'                 32100029
321100*                 'XML-TEXT: ' XML-TEXT                           32110029
321200*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32120029
321300*         PERFORM 9990-WRITE-CICS                                 32130029
321400         CONTINUE                                                 32140029
321500                                                                  32150029
321600        WHEN 'PROCESSING-INSTRUCTION-DATA'                        32160029
321700                                                                  32170029
321800*         STRING  'PROCESSING-INSTRUCTION-DATA'                   32180029
321900*                 'XML-TEXT: ' XML-TEXT                           32190029
322000*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32200029
322100*         PERFORM 9990-WRITE-CICS                                 32210029
322200                                                                  32220029
322300         CONTINUE                                                 32230029
322400                                                                  32240029
322500        WHEN 'COMMENT'                                            32250029
322600                                                                  32260029
322700         CONTINUE                                                 32270029
322800                                                                  32280029
322900*         STRING  'COMMENT'                                       32290029
323000*                 'XML-TEXT: ' XML-TEXT                           32300029
323100*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32310029
323200*         PERFORM 9990-WRITE-CICS                                 32320029
323300                                                                  32330029
323400        WHEN 'EXCEPTION'                                          32340029
323500                                                                  32350029
323600         CONTINUE                                                 32360029
323700                                                                  32370029
323800*        MOVE XML-CODE     TO PV-XML-CODE-DISP                    32380029
323900*         STRING  'EXCEPTION'                                     32390029
324000*                 'XML-TEXT: ' XML-TEXT                           32400029
324100*                 'XML-CODE: ' PV-XML-CODE-DISP                   32410029
324200*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32420029
324300*         PERFORM 9990-WRITE-CICS                                 32430029
324400        WHEN 'ATTRIBUTE-CHARACTERS'                               32440029
324500                                                                  32450029
324600*         STRING  'ATTRIBUTE-CHARACTERS'                          32460029
324700*                 'XML-TEXT: ' XML-TEXT                           32470029
324800*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32480029
324900*         PERFORM 9990-WRITE-CICS                                 32490029
325000                                                                  32500029
325100          IF PV-KMH-ELE-PRESENCE(PV-STR-INDEX3) = 'Y'             32510029
325200            ADD 1              TO PV-STR-INDEX4                   32520029
325300            MOVE XML-TEXT      TO                                 32530029
325400            PV-KMH-ELEMENT-VAL(PV-STR-INDEX3, PV-STR-INDEX4)      32540029
325500                                                                  32550029
325600            IF PS-IN-MSG-FLDS-FROM AND PS-IN-SYS-CD-YES           32560029
325700            AND  PV-STR-INDEX4 = 1                                32570029
325800*           DISPLAY 'STORED SYS CODE'                             32580029
325900                                                                  32590029
326000               MOVE XML-TEXT                TO PV-IN-MSG-SYSCD    32600029
326100                                                                  32610029
326200            END-IF                                                32620029
326300                                                                  32630029
326400            IF PS-IN-MSG-FLDS-FROM AND PS-IN-APP-CD-YES           32640029
326500            AND  PV-STR-INDEX4 = 2                                32650029
326600*           DISPLAY 'STORED APP CODE'                             32660029
326700                                                                  32670029
326800               MOVE XML-TEXT                TO PV-IN-MSG-APPCD    32680029
326900                                                                  32690029
327000            END-IF                                                32700029
327100                                                                  32710029
327200            IF PS-IN-MSG-FLDS-FROM AND PS-IN-MOD-CD-YES           32720029
327300                                                                  32730029
327400            AND  PV-STR-INDEX4 = 3                                32740029
327500*           DISPLAY 'STORED MOD CODE'                             32750029
327600                                                                  32760029
327700               MOVE XML-TEXT                TO PV-IN-MSG-MODCD    32770029
327800                                                                  32780029
327900            END-IF                                                32790029
328000                                                                  32800029
328100            IF PS-IN-MSG-FLDS-FROM AND PS-IN-NOD-ID-YES           32810029
328200            AND  PV-STR-INDEX4 = 4                                32820029
328300*           DISPLAY 'STORED NODE ID'                              32830029
328400                                                                  32840029
328500               MOVE XML-TEXT                TO PV-IN-MSG-NODID    32850029
328600                                                                  32860029
328700            END-IF                                                32870029
328800          END-IF                                                  32880029
328900                                                                  32890029
329000          IF PS-INKMH-VER-Y                                       32900029
329100                                                                  32910029
329200             MOVE XML-TEXT                  TO PV-STOR-KMH-VER    32920029
329300             SET PS-INKMH-VER-N             TO TRUE               32930029
329400                                                                  32940029
329500          END-IF                                                  32950029
329600                                                                  32960029
329700        WHEN OTHER                                                32970029
329800                                                                  32980029
329900            CONTINUE                                              32990029
330000*        MOVE XML-CODE       TO PV-XML-CODE-DISP                  33000029
330100*           MOVE 'Y' TO PV-PARSE-ERROR                            33010029
330200*           STRING  'PARSE ERROR: WHEN OTHER'                     33020029
330300*                   'XML-TEXT: ' XML-TEXT                         33030029
330400*                   'XML-CODE: ' PV-XML-CODE-DISP                 33040029
330500*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              33050029
330600*           PERFORM 9990-WRITE-CICS                               33060029
330700                                                                  33070029
330800     END-EVALUATE                                                 33080029
330900           .                                                      33090029
331000******************************************************************33100029
331100* THIS SECTION PREPARES EXPIRY DATE, IF APPLICABLE BY RETREIVING  33110029
331200* OFFSET-TIME (IN SEC) FROM CONFIG FILE AND ADDING IT TO CURRENT  33120029
331300* TIME                                                            33130029
331400******************************************************************33140029
331500 2440-BLD-EXPIRY-DATE.                                            33150029
331600                                                                  33160029
331700     INITIALIZE SU131-CA-CONFIG-RECORD                            33170029
331800                PV-CONFIG-RECORD                                  33180029
331900                PV-OFFSET-CHAR                                    33190029
332000     MOVE 'OFFSET-TIME'       TO SU131-FUNC-AREA                  33200029
332100     MOVE PV-WEBS-AREA        TO SU131-WEBS-AREA                  33210029
332200     MOVE 1                   TO SU131-SEQ-NO                     33220029
332300                                                                  33230029
332400     PERFORM 7000-VSAM-FILE-READ                                  33240029
332500                                                                  33250029
332600     EVALUATE PV-RESP                                             33260029
332700                                                                  33270029
332800        WHEN 0                                                    33280029
332900                                                                  33290029
333000            CONTINUE                                              33300029
333100                                                                  33310029
333200        WHEN 13                                                   33320029
333300                                                                  33330029
333400            MOVE PV-DEFAULT-WEBS     TO SU131-WEBS-AREA           33340029
333500                                                                  33350029
333600            PERFORM 7000-VSAM-FILE-READ                           33360029
333700                                                                  33370029
333800            IF PV-RESP = 13                                       33380029
333900                                                                  33390029
334000               EXEC CICS ABEND ABCODE('C030') END-EXEC            33400029
334100               CONTINUE                                           33410029
334200                                                                  33420029
334300            END-IF                                                33430029
334400                                                                  33440029
334500     END-EVALUATE                                                 33450029
334600* UNSTRING PV-CONFIG-RECORD                                       33460029
334700                                                                  33470029
334800     MOVE PV-CONFIG-RECORD           TO SU131-CA-CONFIG-RECORD    33480029
334900     MOVE SU131-FREE-TEXT            TO PV-OFFSET-CHAR            33490029
335000     MOVE 0                          TO PV-OFFSET-NBR             33500029
335100                                                                  33510029
335200     INSPECT FUNCTION REVERSE(PV-OFFSET-CHAR)                     33520029
335300      TALLYING PV-OFFSET-LEN FOR LEADING SPACES                   33530029
335400                                                                  33540029
335500     COMPUTE PV-OFFSET-LEN2 =                                     33550029
335600                    LENGTH OF PV-OFFSET-CHAR - PV-OFFSET-LEN      33560029
335700                                                                  33570029
335800     MOVE ZEROES  TO PV-OFFSET-CHAR2(1:PV-OFFSET-LEN)             33580029
335900     MOVE PV-OFFSET-CHAR(1: PV-OFFSET-LEN2)                       33590029
336000                  TO PV-OFFSET-CHAR2(PV-OFFSET-LEN + 1 : )        33600029
336100*    DISPLAY 'PV-OFFSET-CHAR: ' PV-OFFSET-CHAR2                   33610029
336200                                                                  33620029
336300     IF PV-OFFSET-CHAR2 IS NUMERIC                                33630029
336400                                                                  33640029
336500*       DISPLAY 'OFFSET-CHAR IS NUMERIC'                          33650029
336600        MOVE PV-OFFSET-CHAR2         TO PV-OFFSET-NBR             33660029
336700                                                                  33670029
336800     END-IF                                                       33680029
336900                                                                  33690029
337000*    DISPLAY 'PV-SAVED-SEC BEFORE ADD: ' PV-SAVED-SECS            33700029
337100*    DISPLAY 'PV-OFFSET-NBR: ' PV-OFFSET-NBR                      33710029
337200                                                                  33720029
337300     COMPUTE PV-EXPIRY-SECS = PV-OFFSET-NBR + PV-SAVED-SECS       33730029
337400                                                                  33740029
337500     MOVE PV-EXPIRY-SECS             TO PV-NEW-SECS               33750029
337600     MOVE 24 TO PV-STRING-LENGTH OF PV-PICSTR                     33760029
337700     MOVE 'YYYY-MM-DDTHH:MI:SS.999Z' TO                           33770029
337800           PV-STRING-TEXT OF PV-PICSTR(1:24)                      33780029
337900                                                                  33790029
338000     CALL 'CEEDATM' USING PV-NEW-SECS,                            33800029
338100                          PV-PICSTR,                              33810029
338200                          PV-CHRDATE,                             33820029
338300                          PV-FC.                                  33830029
338400                                                                  33840029
338500     IF PV-COND-TOKEN-VALUE = LOW-VALUES THEN                     33850029
338600                                                                  33860029
338700*       STRING  'Input Lilian date'                               33870029
338800*               ' corresponds to:  ' PV-CHRDATE                   33880029
338900*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           33890029
339000*       PERFORM 9990-WRITE-CICS                                   33900029
339100        MOVE PV-CHRDATE TO PV-NEW-EXP-DATE-TIME                   33910029
339200                                                                  33920029
339300     ELSE                                                         33930029
339400*       STRING  'CEEDATE failed with msg '                        33940029
339500*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           33950029
339600*       PERFORM 9990-WRITE-CICS                                   33960029
339700        EXEC CICS ABEND ABCODE('C031') END-EXEC                   33970029
339800                                                                  33980029
339900     END-IF                                                       33990029
340000           .                                                      34000029
340100******************************************************************34010029
340200* THIS SECTION BUILDS ELEMENT 'ACTION' BY READING CONFIG FILE     34020029
340300******************************************************************34030029
340400 2450-BLD-ACTION.                                                 34040029
340500                                                                  34050029
340600     INITIALIZE SU131-CA-CONFIG-RECORD                            34060029
340700                PV-CONFIG-RECORD                                  34070029
340800                                                                  34080029
340900     MOVE 'ACTION'            TO SU131-FUNC-AREA                  34090029
341000     MOVE PV-WEBS-AREA        TO SU131-WEBS-AREA                  34100029
341100     MOVE 1                   TO SU131-SEQ-NO                     34110029
341200                                                                  34120029
341300     PERFORM 7000-VSAM-FILE-READ                                  34130029
341400                                                                  34140029
341500     EVALUATE PV-RESP                                             34150029
341600                                                                  34160029
341700        WHEN 0                                                    34170029
341800                                                                  34180029
341900            CONTINUE                                              34190029
342000                                                                  34200029
342100        WHEN 13                                                   34210029
342200                                                                  34220029
342300            MOVE PV-DEFAULT-WEBS     TO SU131-WEBS-AREA           34230029
342400                                                                  34240029
342500            PERFORM 7000-VSAM-FILE-READ                           34250029
342600                                                                  34260029
342700            IF PV-RESP = 13                                       34270029
342800                                                                  34280029
342900               EXEC CICS ABEND ABCODE('C032') END-EXEC            34290029
343000               CONTINUE                                           34300029
343100            END-IF                                                34310029
343200                                                                  34320029
343300     END-EVALUATE                                                 34330029
343400* UNSTRING PV-CONFIG-RECORD                                       34340029
343500     MOVE PV-CONFIG-RECORD           TO SU131-CA-CONFIG-RECORD    34350029
343600     MOVE SU131-FREE-TEXT            TO PV-NEW-ACTION-ELE         34360029
343700           .                                                      34370029
343800******************************************************************34380029
343900* THIS SECTION BUILDS 'TO' ELEMENT. THERE CAN BE MULTIPLE 'TO'    34390029
344000* ELEMENTS. NEED TO HANDLE                                        34400029
344100******************************************************************34410029
344200 2460-BLD-TO.                                                     34420029
344300                                                                  34430029
344400     SET PS-CONT-THE-LOOP       TO TRUE                           34440029
344500     MOVE 0                     TO PV-NBR-TO-ELEMENTS             34450029
344600                                                                  34460029
344700     PERFORM VARYING PV-STR-INDEX12 FROM 1 BY 1                   34470029
344800     UNTIL PV-STR-INDEX12 > 99                                    34480029
344900                                                                  34490029
345000        MOVE SPACES             TO PV-NEW-TO-ADR(PV-STR-INDEX12)  34500029
345100        MOVE SPACES             TO PV-NEW-TO-ACT(PV-STR-INDEX12)  34510029
345200        MOVE SPACES             TO PV-NEW-TO-PARM1(PV-STR-INDEX12)34520029
345300        MOVE SPACES             TO PV-NEW-TO-PARM2(PV-STR-INDEX12)34530029
345400                                                                  34540029
345500     END-PERFORM                                                  34550029
345600                                                                  34560029
345700     PERFORM VARYING PV-STR-INDEX12 FROM 1 BY 1                   34570029
345800     UNTIL PV-STR-INDEX12 > 99 OR                                 34580029
345900     PS-BREAK-THE-LOOP                                            34590029
346000                                                                  34600029
346100       INITIALIZE SU131-CA-CONFIG-RECORD                          34610029
346200                  PV-CONFIG-RECORD                                34620029
346300                                                                  34630029
346400       MOVE 'TO'                TO SU131-FUNC-AREA                34640029
346500       MOVE PV-WEBS-AREA        TO SU131-WEBS-AREA                34650029
346600*      DISPLAY 'PV-WEBS-AREA :' SU131-WEBS-AREA                   34660029
346700       MOVE PV-STR-INDEX12      TO SU131-SEQ-NO                   34670029
346800                                                                  34680029
346900       PERFORM 7000-VSAM-FILE-READ                                34690029
347000                                                                  34700029
347100       EVALUATE PV-RESP                                           34710029
347200                                                                  34720029
347300          WHEN 0                                                  34730029
347400                                                                  34740029
347500              CONTINUE                                            34750029
347600                                                                  34760029
347700          WHEN 13                                                 34770029
347800                                                                  34780029
347900              MOVE PV-DEFAULT-WEBS     TO SU131-WEBS-AREA         34790029
348000                                                                  34800029
348100              PERFORM 7000-VSAM-FILE-READ                         34810029
348200                                                                  34820029
348300              IF PV-RESP = 13                                     34830029
348400                                                                  34840029
348500              SET PS-BREAK-THE-LOOP    TO TRUE                    34850029
348600                 CONTINUE                                         34860029
348700                                                                  34870029
348800              END-IF                                              34880029
348900                                                                  34890029
349000       END-EVALUATE                                               34900029
349100                                                                  34910029
349200* UNSTRING PV-CONFIG-RECORD                                       34920029
349300       MOVE PV-CONFIG-RECORD           TO SU131-CA-CONFIG-RECORD  34930029
349400                                                                  34940029
349500       UNSTRING SU131-FREE-TEXT DELIMITED BY ';'                  34950029
349600          INTO PV-NEW-TO-ADR(PV-STR-INDEX12)                      34960029
349700               PV-NEW-TO-ACT(PV-STR-INDEX12)                      34970029
349800               PV-NEW-TO-PARM1(PV-STR-INDEX12)                    34980029
349900               PV-NEW-TO-PARM2(PV-STR-INDEX12)                    34990029
350000       END-UNSTRING                                               35000029
350100                                                                  35010029
350200     END-PERFORM                                                  35020029
350300                                                                  35030029
350400     COMPUTE PV-NBR-TO-ELEMENTS = PV-STR-INDEX12 - 2              35040029
350500*    DISPLAY 'PV-NBR-TO-ELEMENTS: ' PV-NBR-TO-ELEMENTS            35050029
350600           .                                                      35060029
350700******************************************************************35070029
350800* THIS SECTION BUILDS ROUTING KEY ELEMENT                         35080029
350900******************************************************************35090029
351000 2470-BLD-RKEYS.                                                  35100029
351100                                                                  35110029
351200     INITIALIZE SU131-CA-CONFIG-RECORD                            35120029
351300                PV-CONFIG-RECORD                                  35130029
351400                                                                  35140029
351500     MOVE 'ROUTINGKEYS'       TO SU131-FUNC-AREA                  35150029
351600     MOVE PV-WEBS-AREA        TO SU131-WEBS-AREA                  35160029
351700     MOVE 1                   TO SU131-SEQ-NO                     35170029
351800                                                                  35180029
351900     PERFORM 7000-VSAM-FILE-READ                                  35190029
352000                                                                  35200029
352100     EVALUATE PV-RESP                                             35210029
352200                                                                  35220029
352300        WHEN 0                                                    35230029
352400                                                                  35240029
352500            CONTINUE                                              35250029
352600                                                                  35260029
352700        WHEN 13                                                   35270029
352800                                                                  35280029
352900            MOVE PV-DEFAULT-WEBS     TO SU131-WEBS-AREA           35290029
353000                                                                  35300029
353100            PERFORM 7000-VSAM-FILE-READ                           35310029
353200                                                                  35320029
353300            IF PV-RESP = 13                                       35330029
353400                                                                  35340029
353500               EXEC CICS ABEND ABCODE('C032') END-EXEC            35350029
353600                                                                  35360029
353700               CONTINUE                                           35370029
353800                                                                  35380029
353900            END-IF                                                35390029
354000     END-EVALUATE                                                 35400029
354100* UNSTRING PV-CONFIG-RECORD                                       35410029
354200     MOVE PV-CONFIG-RECORD           TO SU131-CA-CONFIG-RECORD    35420029
354300     MOVE SU131-FREE-TEXT            TO PV-NEW-RKEYS-ELE          35430029
354400           .                                                      35440029
354500******************************************************************35450029
354600* PREPARE NEW KMH BASED ON APPLICABLE ELEMENTS.                   35460029
354700* 1) SCAN THRU MANDATORY ELEMENTS AND PAD THEM                    35470029
354800* 2) SCAN THRU OPTIONAL ELEMENTS AND PAD THEM                     35480029
354900******************************************************************35490029
355000 2520-NEW-KMH-XML.                                                35500029
355100                                                                  35510029
355200     INITIALIZE PV-KMH-HEADER-FINAL                               35520029
355300                PV-RUNNING-KMH                                    35530029
355400                PV-RUNNING-SPACE-CNT                              35540029
355500                PV-RUNNING-CUR-CNT                                35550029
355600                                                                  35560029
355700     MOVE PV-LITERAL-KMH-VER     TO PV-NEW-KMH-VER                35570029
355800                                                                  35580029
355900*    STRING  'PV-NEW-KMH-MSG-HDR-1: ' PV-NEW-KMH-MSG-HDR-1        35590029
356000*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                35600029
356100*    PERFORM 9990-WRITE-CICS                                      35610029
356200     STRING PV-NEW-KMH-MSG-HDR-1 DELIMITED BY SIZE                35620029
356300            PV-RUNNING-KMH       DELIMITED BY SPACE               35630029
356400            INTO PV-KMH-HEADER-FINAL                              35640029
356500     END-STRING                                                   35650029
356600                                                                  35660029
356700     MOVE PV-KMH-HEADER-FINAL    TO PV-RUNNING-KMH                35670029
356800     INITIALIZE PV-KMH-HEADER-FINAL                               35680029
356900     MOVE 0    TO PV-RUNNING-SPACE-CNT                            35690029
357000                                                                  35700029
357100     INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                     35710029
357200     TALLYING PV-RUNNING-SPACE-CNT                                35720029
357300     FOR LEADING SPACES                                           35730029
357400*    STRING  'PV-RUNNING-SPACE-CNT: ' PV-RUNNING-SPACE-CNT        35740029
357500*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                35750029
357600*    PERFORM 9990-WRITE-CICS                                      35760029
357700                                                                  35770029
357800     COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH        35780029
357900                                - PV-RUNNING-SPACE-CNT            35790029
358000                                + 1                               35800029
358100*    STRING  'PV-RUNNING-CUR-CNT: ' PV-RUNNING-CUR-CNT            35810029
358200*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                35820029
358300*    PERFORM 9990-WRITE-CICS                                      35830029
358400                                                                  35840029
358500     IF PS-MSGID-NEED                                             35850029
358600                                                                  35860029
358700       MOVE PV-NEW-MESSAGE-ID    TO PV-KMH-MSG-ID                 35870029
358800       MOVE PV-NEW-KMH-MSG-ID    TO                               35880029
358900       PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)                        35890029
359000                                                                  35900029
359100     END-IF                                                       35910029
359200     IF SV-CRDATM-NEED                                            35920029
359300                                                                  35930029
359400       MOVE PV-UTC-DATE          TO PV-KMH-CDATIME                35940029
359500       MOVE 0    TO PV-RUNNING-SPACE-CNT                          35950029
359600                                                                  35960029
359700       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   35970029
359800       TALLYING PV-RUNNING-SPACE-CNT                              35980029
359900       FOR LEADING SPACES                                         35990029
360000                                                                  36000029
360100       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      36010029
360200                                  - PV-RUNNING-SPACE-CNT          36020029
360300                                  + 1                             36030029
360400                                                                  36040029
360500       MOVE   PV-NEW-KMH-CDT     TO                               36050029
360600                             PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  36060029
360700                                                                  36070029
360800     END-IF                                                       36080029
360900                                                                  36090029
361000     IF PS-FROM-NEED                                              36100029
361100                                                                  36110029
361200       INITIALIZE PV-FROM-SPACE-CNT                               36120029
361300                  PV-SYS-CD-LEN                                   36130029
361400                  PV-APP-CD-LEN                                   36140029
361500                  PV-MOD-CD-LEN                                   36150029
361600                  PV-NOD-ID-LEN                                   36160029
361700                                                                  36170029
361800       INSPECT FUNCTION REVERSE(PV-NEW-SYSTEM-CD)                 36180029
361900         TALLYING PV-FROM-SPACE-CNT                               36190029
362000         FOR LEADING SPACES                                       36200029
362100**                                                                36210029
362200       COMPUTE PV-SYS-CD-LEN = LENGTH OF PV-NEW-SYSTEM-CD -       36220029
362300       PV-FROM-SPACE-CNT                                          36230029
362400                                                                  36240029
362500       MOVE PV-NEW-SYSTEM-CD(1 : PV-SYS-CD-LEN)                   36250029
362600                                 TO PV-KMH-SYS-CD                 36260029
362700                                                                  36270029
362800       INITIALIZE PV-FROM-SPACE-CNT                               36280029
362900                                                                  36290029
363000       INSPECT FUNCTION REVERSE(PV-NEW-APP)                       36300029
363100         TALLYING PV-FROM-SPACE-CNT                               36310029
363200         FOR LEADING SPACES                                       36320029
363300**                                                                36330029
363400       COMPUTE PV-APP-CD-LEN = LENGTH OF PV-NEW-APP -             36340029
363500       PV-FROM-SPACE-CNT                                          36350029
363600                                                                  36360029
363700       MOVE PV-NEW-APP(1 : PV-APP-CD-LEN)                         36370029
363800                                 TO PV-KMH-APP-CD                 36380029
363900       INITIALIZE PV-FROM-SPACE-CNT                               36390029
364000                                                                  36400029
364100       INSPECT FUNCTION REVERSE(PV-NEW-MODULE)                    36410029
364200         TALLYING PV-FROM-SPACE-CNT                               36420029
364300         FOR LEADING SPACES                                       36430029
364400**                                                                36440029
364500       COMPUTE PV-MOD-CD-LEN = LENGTH OF PV-NEW-MODULE -          36450029
364600       PV-FROM-SPACE-CNT                                          36460029
364700                                                                  36470029
364800       MOVE PV-NEW-MODULE(1 : PV-MOD-CD-LEN)                      36480029
364900                                 TO PV-KMH-MODULE                 36490029
365000                                                                  36500029
365100       INITIALIZE PV-FROM-SPACE-CNT                               36510029
365200                                                                  36520029
365300       INSPECT FUNCTION REVERSE(PV-NEW-NODEID)                    36530029
365400         TALLYING PV-FROM-SPACE-CNT                               36540029
365500         FOR LEADING SPACES                                       36550029
365600**                                                                36560029
365700       COMPUTE PV-NOD-ID-LEN = LENGTH OF PV-NEW-NODEID -          36570029
365800       PV-FROM-SPACE-CNT                                          36580029
365900                                                                  36590029
366000       MOVE PV-NEW-NODEID(1 : PV-NOD-ID-LEN)                      36600029
366100                                 TO PV-KMH-NODEID                 36610029
366200       MOVE '" app="'            TO PV-FILLER-APP                 36620029
366300       MOVE '" module="'         TO PV-FILLER-MOD                 36630029
366400       MOVE '" nodeID="'         TO PV-FILLER-NOD                 36640029
366500       MOVE '" />'               TO PV-FILLER-EOF                 36650029
366600       MOVE 0    TO PV-RUNNING-SPACE-CNT                          36660029
366700                                                                  36670029
366800       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   36680029
366900       TALLYING PV-RUNNING-SPACE-CNT                              36690029
367000       FOR LEADING SPACES                                         36700029
367100                                                                  36710029
367200       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      36720029
367300                                  - PV-RUNNING-SPACE-CNT          36730029
367400                                  + 1                             36740029
367500                                                                  36750029
367600       MOVE PV-NEW-KMH-FROM      TO                               36760029
367700                             PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  36770029
367800                                                                  36780029
367900     END-IF                                                       36790029
368000                                                                  36800029
368100     INITIALIZE PV-STOR-IRP-TO                                    36810029
368200                PV-STOR-CORR-ID                                   36820029
368300                                                                  36830029
368400     IF PS-INRPTO-NEED AND (PV-IN-MSG-MSGID NOT = SPACES)         36840029
368500     AND NOT PS-FUNC-SEND-REQ                                     36850029
368600                                                                  36860029
368700       MOVE PV-IN-MSG-MSGID      TO PV-KMH-IRP-TO                 36870029
368800       MOVE PV-IN-MSG-MSGID      TO PV-STOR-IRP-TO                36880029
368900       MOVE 0                    TO PV-RUNNING-SPACE-CNT          36890029
369000                                                                  36900029
369100       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   36910029
369200       TALLYING PV-RUNNING-SPACE-CNT                              36920029
369300       FOR LEADING SPACES                                         36930029
369400                                                                  36940029
369500       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      36950029
369600                                  - PV-RUNNING-SPACE-CNT          36960029
369700                                  + 1                             36970029
369800                                                                  36980029
369900       MOVE PV-NEW-KMH-INRP-TO   TO                               36990029
370000                             PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  37000029
370100                                                                  37010029
370200     END-IF                                                       37020029
370300                                                                  37030029
370400*    STRING  'PV-IN-MSG-CORRID : ' PV-IN-MSG-CORRID               37040029
370500*            'PV-IN-MSG-MSGID  : ' PV-IN-MSG-MSGID                37050029
370600*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                37060029
370700*    PERFORM 9990-WRITE-CICS                                      37070029
370800                                                                  37080029
370900     IF PS-CORID-NEED AND NOT PS-FUNC-SEND-REQ                    37090029
371000     AND (                                                        37100029
371100     (PV-IN-MSG-CORRID  NOT = SPACES) OR                          37110029
371200     (PV-IN-MSG-MSGID   NOT = SPACES)   )                         37120029
371300                                                                  37130029
371400       IF PV-IN-MSG-CORRID NOT = SPACES                           37140029
371500                                                                  37150029
371600          MOVE PV-IN-MSG-CORRID  TO PV-KMH-CORRL-ID               37160029
371700                                                                  37170029
371800       ELSE                                                       37180029
371900                                                                  37190029
372000          MOVE PV-IN-MSG-MSGID   TO PV-KMH-CORRL-ID               37200029
372100                                                                  37210029
372200       END-IF                                                     37220029
372300                                                                  37230029
372400       MOVE PV-KMH-CORRL-ID      TO PV-STOR-CORR-ID               37240029
372500       MOVE 0    TO PV-RUNNING-SPACE-CNT                          37250029
372600                                                                  37260029
372700       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   37270029
372800       TALLYING PV-RUNNING-SPACE-CNT                              37280029
372900       FOR LEADING SPACES                                         37290029
373000                                                                  37300029
373100       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      37310029
373200                                  - PV-RUNNING-SPACE-CNT          37320029
373300                                  + 1                             37330029
373400                                                                  37340029
373500       MOVE PV-NEW-KMH-CORID                                      37350029
373600                        TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  37360029
373700                                                                  37370029
373800     END-IF                                                       37380029
373900                                                                  37390029
374000     IF PS-EXDT-NEED AND PS-FUNC-SEND-REQ                         37400029
374100                                                                  37410029
374200       MOVE PV-NEW-EXP-DATE-TIME TO PV-KMH-EDATIME                37420029
374300       MOVE 0                    TO PV-RUNNING-SPACE-CNT          37430029
374400                                                                  37440029
374500       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   37450029
374600       TALLYING PV-RUNNING-SPACE-CNT                              37460029
374700       FOR LEADING SPACES                                         37470029
374800                                                                  37480029
374900       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      37490029
375000                                  - PV-RUNNING-SPACE-CNT          37500029
375100                                  + 1                             37510029
375200                                                                  37520029
375300       MOVE PV-NEW-KMH-EDT                                        37530029
375400                        TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  37540029
375500                                                                  37550029
375600     END-IF                                                       37560029
375700                                                                  37570029
375800     IF PS-ACT-NEED AND PS-FUNC-SEND-REQ                          37580029
375900                                                                  37590029
376000       MOVE PV-NEW-ACTION-ELE    TO PV-KMH-ACTION                 37600029
376100       MOVE 0    TO PV-RUNNING-SPACE-CNT                          37610029
376200                                                                  37620029
376300       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   37630029
376400       TALLYING PV-RUNNING-SPACE-CNT                              37640029
376500       FOR LEADING SPACES                                         37650029
376600                                                                  37660029
376700       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      37670029
376800                                  - PV-RUNNING-SPACE-CNT          37680029
376900                                  + 1                             37690029
377000                                                                  37700029
377100       MOVE PV-NEW-KMH-ACTION                                     37710029
377200                        TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  37720029
377300                                                                  37730029
377400     END-IF                                                       37740029
377500                                                                  37750029
377600     IF PS-TO-NEED AND PS-FUNC-SEND-REQ                           37760029
377700                                                                  37770029
377800       PERFORM VARYING PV-STR-INDEX12 FROM 1 BY 1                 37780029
377900       UNTIL PV-STR-INDEX12 > PV-NBR-TO-ELEMENTS                  37790029
378000                                                                  37800029
378100         INITIALIZE PV-KMH-TO-ELE-STRNG                           37810029
378200                                                                  37820029
378300         MOVE PV-NEW-TO-ADR(PV-STR-INDEX12)                       37830029
378400         TO PV-KMH-TO-ADR                                         37840029
378500         MOVE PV-NEW-TO-ACT(PV-STR-INDEX12)                       37850029
378600         TO PV-KMH-TO-ACT                                         37860029
378700         MOVE PV-NEW-TO-PARM1(PV-STR-INDEX12)                     37870029
378800         TO PV-KMH-TO-PARMVAL1                                    37880029
378900         MOVE PV-NEW-TO-PARM2(PV-STR-INDEX12)                     37890029
379000         TO PV-KMH-TO-PARMVAL2                                    37900029
379100                                                                  37910029
379200         STRING                                                   37920029
379300           PV-NEW-KMH-TO-1 DELIMITED BY SIZE                      37930029
379400           PV-NEW-KMH-TO-ADR DELIMITED BY SIZE                    37940029
379500           PV-NEW-KMH-TO-ACT DELIMITED BY SIZE                    37950029
379600           PV-NEW-KMH-PARM-1 DELIMITED BY SIZE                    37960029
379700           PV-NEW-KMH-TO-PARM1 DELIMITED BY SIZE                  37970029
379800           PV-NEW-KMH-TO-PARM2 DELIMITED BY SIZE                  37980029
379900           PV-NEW-KMH-PARM-2 DELIMITED BY SIZE                    37990029
380000           PV-NEW-KMH-TO-2 DELIMITED BY SIZE                      38000029
380100         INTO PV-KMH-TO-ELE-STRNG                                 38010029
380200                                                                  38020029
380300         END-STRING                                               38030029
380400                                                                  38040029
380500         MOVE 0    TO PV-RUNNING-SPACE-CNT                        38050029
380600                                                                  38060029
380700         INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                 38070029
380800         TALLYING PV-RUNNING-SPACE-CNT                            38080029
380900         FOR LEADING SPACES                                       38090029
381000                                                                  38100029
381100         COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH    38110029
381200                                    - PV-RUNNING-SPACE-CNT        38120029
381300                                    + 1                           38130029
381400                                                                  38140029
381500         MOVE PV-KMH-TO-ELE-STRNG                                 38150029
381600                          TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)38160029
381700                                                                  38170029
381800       END-PERFORM                                                38180029
381900     END-IF                                                       38190029
382000                                                                  38200029
382100     IF PS-RKEYS-NEED AND PS-FUNC-SEND-REQ                        38210029
382200                                                                  38220029
382300       MOVE PV-NEW-RKEYS-ELE     TO PV-KMH-RKEYS-VAL              38230029
382400       MOVE 0    TO PV-RUNNING-SPACE-CNT                          38240029
382500                                                                  38250029
382600       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   38260029
382700       TALLYING PV-RUNNING-SPACE-CNT                              38270029
382800       FOR LEADING SPACES                                         38280029
382900                                                                  38290029
383000       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      38300029
383100                                  - PV-RUNNING-SPACE-CNT          38310029
383200                                  + 1                             38320029
383300                                                                  38330029
383400       MOVE PV-NEW-KMH-RKEYS                                      38340029
383500                        TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  38350029
383600                                                                  38360029
383700     END-IF                                                       38370029
383800                                                                  38380029
383900     IF PS-FAULT-NEED AND PS-VALIDATE-FAIL                        38390029
384000                                                                  38400029
384100       MOVE PV-FAULT-MSG         TO PV-KMH-FAULT-MSG              38410029
384200       MOVE 0    TO PV-RUNNING-SPACE-CNT                          38420029
384300                                                                  38430029
384400       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   38440029
384500       TALLYING PV-RUNNING-SPACE-CNT                              38450029
384600       FOR LEADING SPACES                                         38460029
384700                                                                  38470029
384800       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      38480029
384900                                  - PV-RUNNING-SPACE-CNT          38490029
385000                                  + 1                             38500029
385100                                                                  38510029
385200       MOVE PV-NEW-KMH-FAULT                                      38520029
385300                        TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  38530029
385400                                                                  38540029
385500     END-IF                                                       38550029
385600                                                                  38560029
385700     MOVE 0    TO PV-RUNNING-SPACE-CNT                            38570029
385800                                                                  38580029
385900     INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                     38590029
386000     TALLYING PV-RUNNING-SPACE-CNT                                38600029
386100     FOR LEADING SPACES                                           38610029
386200                                                                  38620029
386300     COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH        38630029
386400                                - PV-RUNNING-SPACE-CNT            38640029
386500                                + 1                               38650029
386600                                                                  38660029
386700     MOVE PV-NEW-KMH-MSG-HDR-2                                    38670029
386800                      TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)    38680029
386900                                                                  38690029
387000     MOVE PV-RUNNING-KMH        TO PV-KMH-HEADER-FINAL            38700029
387100                                                                  38710029
387200*    DISPLAY 'NEW KMH PREPARED: ' PV-KMH-HEADER-FINAL(1:800)      38720029
387300*    STRING  'PV-KMH-HEADER-FINAL: ' PV-KMH-HEADER-FINAL          38730029
387400*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                38740029
387500*    PERFORM 9990-WRITE-CICS                                      38750029
387600           .                                                      38760029
387700******************************************************************38770029
387800* THIS PARA WRITES THE NEW KMH HEADER BY PUTTING THE KMH INTO     38780029
387900* DFHHEADER CONTAINTER                                            38790029
388000******************************************************************38800029
388100 2530-UPD-DFHHEADER.                                              38810029
388200                                                                  38820029
388300*    STRING  '1020 PUT CONTAINER DFHHEADER'                       38830029
388400*            '1020 PV-KMH-HEADER-FINAL :  ' PV-KMH-HEADER-FINAL   38840029
388500*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                38850029
388600*    PERFORM 9990-WRITE-CICS                                      38860029
388700     INITIALIZE PV-RESP                                           38870029
388800                                                                  38880029
388900     EXEC CICS                                                    38890029
389000       PUT CONTAINER('DFHHEADER')                                 38900029
389100       FROM(PV-KMH-HEADER-FINAL)                                  38910029
389200       FLENGTH(LENGTH OF PV-KMH-HEADER-FINAL)                     38920029
389300       RESP(PV-RESP)                                              38930029
389400     END-EXEC                                                     38940029
389500                                                                  38950029
389600*    MOVE   PV-RESP            TO PV-RESP-DISP                    38960029
389700*    STRING  'PV-RESP AFTER WRITING DFHHEADER: ' PV-RESP-DISP     38970029
389800*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                38980029
389900*    PERFORM 9990-WRITE-CICS                                      38990029
390000     EVALUATE PV-RESP                                             39000029
390100                                                                  39010029
390200           WHEN DFHRESP(NORMAL)                                   39020029
390300                                                                  39030029
390400               CONTINUE                                           39040029
390500                                                                  39050029
390600           WHEN OTHER                                             39060029
390700                                                                  39070029
390800               EXEC CICS ABEND ABCODE('C033') END-EXEC            39080029
390900     END-EVALUATE                                                 39090029
391000           .                                                      39100029
391100******************************************************************39110029
391200* THIS SECTION READ CONTAINER OLD-HEADER1 TO RETRIEVE KMH THAT WAS39120029
391300* ORIGINALLY RECEIVED FROM THE REQUESTER                          39130029
391400******************************************************************39140029
391500 2540-RET-OLD-KMH.                                                39150029
391600                                                                  39160029
391700        INITIALIZE PV-RESP                                        39170029
391800                                                                  39180029
391900        EXEC CICS                                                 39190029
392000          GET CONTAINER('OLD-HEADER1')                            39200029
392100          SET(PV-HEAD-PTR)                                        39210029
392200          FLENGTH(PV-CONT-LEN)                                    39220029
392300          RESP(PV-RESP)                                           39230029
392400        END-EXEC                                                  39240029
392500                                                                  39250029
392600*       DISPLAY 'PV-RESP AFTER OLD-HEADER1 READ: ' PV-RESP        39260029
392700*       MOVE   PV-RESP            TO PV-RESP-DISP                 39270029
392800*       STRING  'PV-RESP AFTER DFHHEADER CONTAINER READ: '        39280029
392900*       PV-RESP-DISP                                              39290029
393000*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  39300029
393100*       PERFORM 9990-WRITE-CICS                                   39310029
393200                                                                  39320029
393300        EVALUATE PV-RESP                                          39330029
393400                                                                  39340029
393500           WHEN DFHRESP(CONTAINERERR)                             39350029
393600                                                                  39360029
393700*                STRING  'Container NOT FOUND'                    39370029
393800*                 DELIMITED BY SIZE INTO PV-CICS-MSG-AREA         39380029
393900*                PERFORM 9990-WRITE-CICS                          39390029
394000                 SET PS-RETR-ERROR    TO TRUE                     39400029
394100                                                                  39410029
394200           WHEN DFHRESP(NORMAL)                                   39420029
394300                                                                  39430029
394400                 SET PS-RETR-NO-ERROR TO TRUE                     39440029
394500*                MOVE PV-CONT-LEN     TO PV-CONT-LEN-DISP         39450029
394600*                STRING  '>========<'                             39460029
394700*                        'Container Name : ' 'DFHHEADER'          39470029
394800*                        'Content length : ' PV-CONT-LEN-DISP     39480029
394900*                 DELIMITED BY SIZE INTO PV-CICS-MSG-AREA         39490029
395000*                PERFORM 9990-WRITE-CICS                          39500029
395100                                                                  39510029
395200                 MOVE PV-CONT-LEN    TO PV-GETMAIN-LEN            39520029
395300                                                                  39530029
395400                 IF PV-GETMAIN-LEN > 0                            39540029
395500                                                                  39550029
395600                  EXEC CICS GETMAIN                               39560029
395700                    SET(PV-GETMAIN-PTR)                           39570029
395800                    FLENGTH(PV-GETMAIN-LEN)                       39580029
395900                  END-EXEC                                        39590029
396000                                                                  39600029
396100                  SET ADDRESS OF PV-GETMAIN-AREA TO               39610029
396200                  PV-GETMAIN-PTR                                  39620029
396300                                                                  39630029
396400                  EXEC CICS GET CONTAINER('OLD-HEADER1')          39640029
396500                   INTO(PV-GETMAIN-AREA)                          39650029
396600                   FLENGTH(PV-CONT-LEN)                           39660029
396700                  END-EXEC                                        39670029
396800                                                                  39680029
396900*                 STRING  'DFHHEADER Container content: '         39690029
397000*                 PV-GETMAIN-AREA(80:)                            39700029
397100*                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA        39710029
397200*                 PERFORM 9990-WRITE-CICS                         39720029
397300*                 DISPLAY 'PV-GETMAIN-AREA: ' PV-GETMAIN-AREA     39730029
397400                  MOVE PV-GETMAIN-LEN  TO PV-RETR-KMH-LEN         39740029
397500                  MOVE PV-GETMAIN-AREA TO PV-RETR-KMH-AREA        39750029
397600                                                                  39760029
397700                 ELSE                                             39770029
397800                                                                  39780029
397900                  SET PS-RETR-ERROR    TO TRUE                    39790029
398000                                                                  39800029
398100                 END-IF                                           39810029
398200                                                                  39820029
398300           WHEN DFHRESP(CCSIDERR)                                 39830029
398400                                                                  39840029
398500               SET PS-RETR-ERROR  TO TRUE                         39850029
398600               EXEC CICS ABEND ABCODE('C015') END-EXEC            39860029
398700               CONTINUE                                           39870029
398800                                                                  39880029
398900           WHEN DFHRESP(CONTAINERERR)                             39890029
399000                                                                  39900029
399100               SET PS-RETR-ERROR  TO TRUE                         39910029
399200               EXEC CICS ABEND ABCODE('C016') END-EXEC            39920029
399300               CONTINUE                                           39930029
399400                                                                  39940029
399500           WHEN DFHRESP(INVREQ)                                   39950029
399600                                                                  39960029
399700               SET PS-RETR-ERROR  TO TRUE                         39970029
399800               EXEC CICS ABEND ABCODE('C017') END-EXEC            39980029
399900               CONTINUE                                           39990029
400000                                                                  40000029
400100           WHEN DFHRESP(LENGERR)                                  40010029
400200                                                                  40020029
400300               SET PS-RETR-ERROR  TO TRUE                         40030029
400400               EXEC CICS ABEND ABCODE('C018') END-EXEC            40040029
400500               CONTINUE                                           40050029
400600                                                                  40060029
400700        END-EVALUATE                                              40070029
400800           .                                                      40080029
400900******************************************************************40090029
401000* THIS PARA READS CONFIG FILE (VSAM)                              40100029
401100* PV-RESP IS HANDLED ALWAYS FROM WHEREVER THIS PARA IS INVOKED.   40110029
401200* SO, DO NOT HANDLE PV-RESP HERE                                  40120029
401300******************************************************************40130029
401400 7000-VSAM-FILE-READ.                                             40140029
401500*    STRING  'SU131-CA-KEY :' SU131-CA-KEY                        40150029
401600*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  40160029
401700*    PERFORM 9990-WRITE-CICS                                      40170029
401800                                                                  40180029
401900     EXEC CICS READ                                               40190029
402000          DATASET   (PV-VSAM-FILE-NM)                             40200029
402100          INTO      (PV-CONFIG-RECORD)                            40210029
402200          LENGTH    (PV-RECORD-LENGTH-300)                        40220029
402300          RIDFLD    (SU131-CA-KEY)                                40230029
402400          KEYLENGTH (48)                                          40240029
402500          RESP      (PV-RESP)                                     40250029
402600          RESP2 (PV-RESP2)                                        40260029
402700     END-EXEC                                                     40270029
402800                                                                  40280029
402900*    DISPLAY 'RESP : ' PV-RESP                                    40290029
403000*    DISPLAY 'RESP2: ' PV-RESP2                                   40300029
403100           .                                                      40310029
403200 9990-WRITE-CICS.                                                 40320029
403300                                                                  40330029
403400     EXEC CICS WRITEQ TD                                          40340029
403500         QUEUE('CSSL')                                            40350029
403600         FROM(PV-CICS-MSG-AREA)                                   40360029
403700         NOHANDLE                                                 40370029
403800     END-EXEC.                                                    40380029
403900                                                                  40390029
404000     MOVE SPACES TO PV-CICS-MSG-AREA                              40400029
404100           .                                                      40410029
404200*                                                                 40420029
