000400******************************************************************00040001
000500 IDENTIFICATION DIVISION.                                         00050001
000600******************************************************************00060001
000700                                                                  00070001
000800 PROGRAM-ID.    PCKUT121.                                         00080001
000900 AUTHOR.        DENISE HAHN.                                      00090001
001000 DATE-WRITTEN.  FEBRUARY 2024.                                    00100001
001100******************************************************************00110001
001200* EXTRACT OF PACK-TO-LIGHT PICKMADE LABOR EVENTS TO BE USED TO    00120001
001210* CALCULATE UNITS WORKED                                          00121001
001600******************************************************************00160001
001700 ENVIRONMENT DIVISION.                                            00170001
001800 INPUT-OUTPUT SECTION.                                            00180001
001900                                                                  00190001
002000 FILE-CONTROL.                                                    00200001
002200     SELECT PICKMADE-EXPORT-FILE     ASSIGN TO OUT01.             00220001
002500                                                                  00250001
002600 DATA DIVISION.                                                   00260001
002700 FILE SECTION.                                                    00270001
002800                                                                  00280001
003600 FD  PICKMADE-EXPORT-FILE                                         00360001
003700     RECORDING MODE IS F                                          00370001
003800     LABEL RECORDS ARE STANDARD                                   00380001
003900     BLOCK CONTAINS 0 RECORDS.                                    00390001
004000                                                                  00400001
004100 01  PICKMADE-RECORD                  PIC X(300).                 00410026
004200                                                                  00420001
005600                                                                  00560001
005700 WORKING-STORAGE SECTION.                                         00570001
005800                                                                  00580001
005900 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO.    00590001
006000                                                                  00600001
006100 01  PS-PROGRAM-SWITCHES.                                         00610001
006200     05  PS-END-CSR-SW                PIC X(1)   VALUE 'N'.       00620001
006300         88  PS-END-CSR                          VALUE 'Y'.       00630001
007300                                                                  00730001
007610 01  CC-CONTROL-CARD-TIMESTAMPS.                                  00761001
007620     05  CC-FROM-TIMESTAMP            PIC X(26)   VALUE SPACES.   00762001
007630     05  FILLER                       PIC X(1)    VALUE SPACES.   00763001
007640     05  CC-TO-TIMESTAMP              PIC X(26)   VALUE SPACES.   00764001
007650     05  FILLER                       PIC X(27)   VALUE SPACES.   00765001
007700                                                                  00770005
007800 01  PV-PROGRAM-VARIABLES.                                        00780005
007900     05  PV-RETRY-COUNT               PIC S9(04)  VALUE ZERO      00790005
008000                                                  COMP SYNC.      00800005
008010     05  PV-NULL-IND-01               PIC S9(4)   VALUE ZERO      00801016
008020                                                  COMP SYNC.      00802005
008030     05  PV-NULL-IND-02               PIC S9(4)   VALUE ZERO      00803016
008040                                                  COMP SYNC.      00804005
008050     05  PV-NULL-IND-03               PIC S9(4)   VALUE ZERO      00805016
008060                                                  COMP SYNC.      00806005
008070     05  PV-NULL-IND-04               PIC S9(4)   VALUE ZERO      00807016
008080                                                  COMP SYNC.      00808005
008090     05  PV-NULL-IND-05               PIC S9(4)   VALUE ZERO      00809016
008091                                                  COMP SYNC.      00809105
008092     05  PV-NULL-IND-06               PIC S9(4)   VALUE ZERO      00809216
008093                                                  COMP SYNC.      00809305
008094     05  PV-NULL-IND-07               PIC S9(4)   VALUE ZERO      00809416
008095                                                  COMP SYNC.      00809505
008096     05  PV-NULL-IND-08               PIC S9(4)   VALUE ZERO      00809616
008097                                                  COMP SYNC.      00809705
008098     05  PV-EVENT-FETCH-COUNT         PIC S9(9)   COMP-3          00809813
008099                                                  VALUE ZEROS.    00809913
008100     05  PV-EXTRACT-WRITE-COUNT       PIC S9(9)   COMP-3          00810013
008101                                                  VALUE ZEROS.    00810113
008102     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00810214
008103     05  PV-SQLCODE                   PIC 9(9)    VALUE ZERO.     00810314
008104     05  PV-PARAGRAPH-NAME            PIC X(30)   VALUE SPACES.   00810414
008105     05  PV-ERROR-MESSAGE-1           PIC X(60)   VALUE SPACES.   00810514
008106     05  PV-ERROR-MESSAGE-2           PIC X(60)   VALUE SPACES.   00810614
008108                                                                  00810827
018000 01  PC-PROGRAM-CONSTANTS.                                        01800013
018100     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'PCKUT121'.01810013
018200     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         01820013
018300                                                 COMP SYNC.       01830013
018410                                                                  01841001
018500 01  PV-ABEND-FIELDS.                                             01850001
018600     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'PCKUT121'.01860001
018700     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    01870001
018800     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    01880001
018900     05  PV-ABEND-STRUCTURE-1         PIC X(15)  VALUE SPACES.    01890001
019000     05  PV-ABEND-STRUCTURE-2         PIC X(15)  VALUE SPACES.    01900001
019100     05  PV-ABEND-STRUCTURE-3         PIC X(15)  VALUE SPACES.    01910001
019200     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    01920001
019300     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01930001
019400     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01940001
019500     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01950001
019600     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01960001
019700                                                                  01970016
019800 01  DK-DB-KEYS.                                                  01980003
019900     05 DK-FROM-TIMESTAMP             PIC X(26).                  01990003
019910     05 DK-TO-TIMESTAMP               PIC X(26).                  01991003
019911                                                                  01991103
021210*    LABOR DETAIL RECORD LAYOUT                                   02121007
021220     COPY PCWS242.                                                02122018
021230                                                                  02123007
021300*    EXTRACT FILE LAYOUT                                          02130007
021400     COPY PCRD086.                                                02140007
021500                                                                  02150007
023600*---------------------------------------------------------------- 02360001
023700*    PC-BUSINESS EVENT CONTROL TABLE - PCT_BUS_EVNT_CNTL          02370001
023710*---------------------------------------------------------------- 02371001
023800     EXEC SQL                                                     02380001
023900         INCLUDE PCT00009                                         02390001
024000     END-EXEC                                                     02400001
024100                                                                  02410001
024110*---------------------------------------------------------------- 02411001
024200*    PC-BUSINESS EVENT EXPORT TABLE - PCT_BUS_EVNT_EXPRT          02420001
024210*---------------------------------------------------------------- 02421001
024300     EXEC SQL                                                     02430001
024400         INCLUDE PCT00011                                         02440001
024500     END-EXEC                                                     02450001
024600                                                                  02460001
024610*---------------------------------------------------------------- 02461001
024700*   PC-BUSINESS EVENT EXPORT DETAIL - PCT_BUS_EVNT_DTL            02470001
024710*---------------------------------------------------------------- 02471001
024900     EXEC SQL                                                     02490001
025000         INCLUDE PCT00012                                         02500001
025100     END-EXEC                                                     02510001
025200                                                                  02520001
025210*---------------------------------------------------------------- 02521005
025220*   DISTRIUTION HEADER                                            02522005
025230*---------------------------------------------------------------- 02523005
025240     EXEC SQL                                                     02524005
025250         INCLUDE TDISTHD                                          02525005
025260     END-EXEC                                                     02526005
025270                                                                  02527005
026100*----------------------------------------------------------------*02610001
026200*    TKRPRPM TABLE                                                02620001
026300*----------------------------------------------------------------*02630001
026400     EXEC SQL                                                     02640001
026500          INCLUDE TKRPRPM                                         02650001
026600     END-EXEC.                                                    02660001
026800                                                                  02680001
026810*----------------------------------------------------------------*02681006
026820*   P2L PICKMADE EVENT EXTRACT CURSOR                             02682006
026830*----------------------------------------------------------------*02683006
026900     EXEC SQL                                                     02690001
027000         DECLARE P2L-EXTRACT-CSR CURSOR FOR                       02700001
030700          SELECT                                                  03070001
030900                  B.EVNT_EXPRT_ID                                 03090001
031000                , B.EVNT_OBJ_TXT                                  03100001
031100                , B.EVNT_OBJ_ACTN_TXT                             03110001
031200                , B.CRE_TMST                                      03120001
031210                , E.CRE_TMST                                      03121002
031220                , E.PREPK_LNE_PRC_CDE                             03122035
031230                , E.UCC128_DAT_USG_CDE                            03123035
031300                , B.CRE_BY_USR_ID                                 03130001
031400                , B.CRE_BY_PGM_NM                                 03140001
031600                , B.EVNT_KY_1_NBR                                 03160001
031700                , B.EVNT_KY_2_NBR                                 03170001
031800                , B.EVNT_KY_3_NBR                                 03180001
031900                , B.EVNT_KY_4_NBR                                 03190001
032000                , B.EVNT_KY_5_NBR                                 03200001
032100                , B.EVNT_KY_1_TXT                                 03210001
032200                , B.EVNT_KY_2_TXT                                 03220001
032600                , B.EVNT_KY_1_TMST                                03260001
033100                , B.EXPRT_STAT_CDE                                03310001
033300                , F.DTL_TXT                                       03330027
033400               FROM                                               03340001
033500                     PCT_BUS_EVNT_EXPRT B                         03350001
033600                ,    PCT_BUS_EVNT_CNTL  C                         03360001
033610                ,    TKRPRPM            D                         03361001
033620                ,    TDISTHD            E                         03362001
033630                ,    PCT_BUS_EVNT_DTL   F                         03363005
033700               WHERE B.EVNT_OBJ_TXT      = 'PACKTOLIGHT'          03370001
033800                 AND B.EVNT_OBJ_ACTN_TXT = 'PICKMADE'             03380001
033810                 AND B.EVNT_OBJ_TXT      = C.EVNT_OBJ_TXT         03381001
033820                 AND B.EVNT_OBJ_ACTN_TXT = C.EVNT_OBJ_ACTN_TXT    03382001
034000                 AND B.CRE_TMST         >  :DK-FROM-TIMESTAMP     03400045
034010                 AND B.CRE_TMST         <= :DK-TO-TIMESTAMP       03401003
034100                 AND C.PGM_CDE_NM        = 'DLKUT003'             03410001
034110                 AND B.EVNT_KY_1_NBR     =  D.LOC_ID              03411001
034130                 AND D.INTFC_SYS_CDE     = 'KHL'                  03413001
034140                 AND D.SYS_PRC_FUNC_CDE  = 'P2LWRK'               03414001
034150                 AND D.FUNC_PRC_STAT_CDE = 'AC'                   03415001
034180                 AND D.FUNC_TXT          = 'Y'                    03418001
034181                 AND B.EVNT_KY_3_NBR     =  E.ORD_NBR             03418101
034182                 AND B.EVNT_KY_4_NBR     =  E.RCVR_SEQ_NBR        03418201
034183                 AND B.EVNT_KY_5_NBR     =  E.ORD_LNE_NBR         03418323
034190                 AND D.FUNC_BEG_TMST    <=  E.CRE_TMST            03419001
034191                 AND D.FUNC_END_TMST    >=  E.CRE_TMST            03419101
034192                 AND B.EVNT_EXPRT_ID     =  F.EVNT_EXPRT_ID       03419211
034200            ORDER BY B.EVNT_KY_1_NBR                              03420001
034210                   , B.EVNT_KY_3_NBR                              03421001
034220                   , B.EVNT_KY_4_NBR                              03422001
034221                   , B.EVNT_KY_5_NBR                              03422132
034222                   , B.EVNT_KY_2_NBR                              03422232
034300            WITH UR                                               03430001
034400     END-EXEC.                                                    03440001
034500                                                                  03450001
034600*-----------------------------------------------------------------03460001
036900*  USED FOR DB2 ERROR MESSAGE BUILDING                            03690001
036910*-----------------------------------------------------------------03691001
037000     COPY DPWS004.                                                03700001
037100                                                                  03710001
038020*-----------------------------------------------------------------03802001
038200*   DB2 SQL COMMUNICATION AREA                                    03820001
038210*-----------------------------------------------------------------03821001
038300     EXEC SQL                                                     03830001
038400          INCLUDE SQLCA                                           03840001
038500     END-EXEC.                                                    03850001
038600                                                                  03860001
038700 PROCEDURE DIVISION.                                              03870005
038800                                                                  03880001
038810     DISPLAY '************************'.                          03881022
038820     DISPLAY '******* PCKUT121 *******'.                          03882022
038830     DISPLAY '************************'.                          03883022
038840                                                                  03884022
038900     PERFORM 1000-INIT.                                           03890001
039000                                                                  03900001
039100     PERFORM 2000-PROCESS                                         03910006
039110       UNTIL PS-END-CSR.                                          03911006
039200                                                                  03920001
039300     PERFORM 9000-TERMINATE.                                      03930001
039400                                                                  03940001
039500     GOBACK.                                                      03950001
039600                                                                  03960001
039610*-----------------------------------------------------------------03961006
039620*                                                                 03962006
039630*-----------------------------------------------------------------03963006
039700 1000-INIT.                                                       03970001
039800                                                                  03980001
039900     ACCEPT CC-CONTROL-CARD-TIMESTAMPS FROM SYSIN.                03990001
040000     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS: '              04000001
040100             CC-CONTROL-CARD-TIMESTAMPS.                          04010001
040500                                                                  04050001
040600     MOVE  CC-FROM-TIMESTAMP     TO  DK-FROM-TIMESTAMP.           04060003
040610     MOVE  CC-TO-TIMESTAMP       TO  DK-TO-TIMESTAMP.             04061003
040620                                                                  04062003
040700     OPEN OUTPUT PICKMADE-EXPORT-FILE.                            04070001
041000                                                                  04100001
043000     PERFORM 7000-OPEN-P2L-EXTRACT-CSR.                           04300002
043100     PERFORM 7010-FETCH-P2L-EXTRACT-CSR.                          04310002
043200                                                                  04320005
043201                                                                  04320106
043210*-----------------------------------------------------------------04321006
043220*                                                                 04322006
043230*-----------------------------------------------------------------04323006
043300 2000-PROCESS.                                                    04330005
043400                                                                  04340006
043500     PERFORM 3000-BUILD-EXTRACT.                                  04350006
043600                                                                  04360006
044900     PERFORM 8100-WRITE-EXTRACT-REC                               04490006
045000                                                                  04500006
045800     INITIALIZE PV-NULL-IND-01                                    04580016
045900                PV-NULL-IND-02                                    04590016
045910                PV-NULL-IND-03                                    04591016
045920                PV-NULL-IND-04                                    04592016
045930                PV-NULL-IND-05                                    04593016
046000                PV-NULL-IND-06                                    04600016
046100                PV-NULL-IND-07                                    04610016
046500                PV-NULL-IND-08.                                   04650016
047000                                                                  04700006
047100     PERFORM 7010-FETCH-P2L-EXTRACT-CSR.                          04710002
047200                                                                  04720002
047210                                                                  04721006
047220*-----------------------------------------------------------------04722006
047230*                                                                 04723006
047240*-----------------------------------------------------------------04724006
047300 3000-BUILD-EXTRACT.                                              04730001
047400                                                                  04740001
049300     MOVE SPACES TO PC086-EXPORT-RECORD-LAYOUT.                   04930034
049301                                                                  04930134
049310     MOVE ZEROES TO PC086-OPER-UNT-ID                             04931034
049320                    PC086-ORD-NBR                                 04932034
049330                    PC086-RCVR-SEQ-NBR                            04933034
049340                    PC086-ORD-LNE-NBR                             04934034
049350                    PC086-PREPK-ID                                04935034
049360                    PC086-STORE-NBR                               04936034
049363                    PC086-PICKED-QTY                              04936334
049364                    PC086-SHFT-NBR                                04936434
049367                    PC086-UNT-RETAIL-PRC                          04936734
049368                    PC086-EXTD-RTL-AMT.                           04936834
049369                                                                  04936934
049370     MOVE SPACES TO PC086-CRE-BY-USR-ID                           04937034
049380                    PC086-CRE-PGM-NM                              04938034
049390                    PC086-P2L-CRE-TMST                            04939042
049391                    PC086-BUS-EVENT-TMST                          04939142
049398                    PC086-PICKED-QTY-SIGN                         04939834
049401                    PC086-PREPK-LNE-PRC-CDE                       04940134
049402                    PC086-UCC128-DAT-USG-CDE                      04940234
049404                    PC086-ACTN-CDE                                04940434
049405                    PC086-WRKD-UNT-TMST                           04940534
049406                    PC086-BUS-DTE                                 04940634
049413                    PC086-FSCL-DTE                                04941334
049420                    PC086-FSCL-YR-NBR                             04942034
049421                    PC086-FSCL-MN-NBR                             04942134
049422                    PC086-FSCL-WK-NBR                             04942234
049423                    PC086-WK-IN-MN-NBR                            04942334
049424                    PC086-DAY-OF-WK-NBR                           04942434
049425                    PC086-LY-THIS-DAY-KY-DTE                      04942534
049426                    PC086-FSCL-MN-BEG-DTE                         04942634
049427                    PC086-FSCL-MN-END-DTE                         04942734
049428                    PC086-FSCL-WK-BEG-DTE                         04942834
049429                    PC086-FSCL-WK-END-DTE                         04942934
049430                    PC086-PRCG-AREA-CDE.                          04943034
049431*                                                                 04943134
049440                                                                  04944006
049500     IF  PV-NULL-IND-01 = -1                                      04950016
049600         MOVE ZEROS                   TO PC086-OPER-UNT-ID        04960007
049700     ELSE                                                         04970007
049800         MOVE PCT00011-EVNT-KY-1-NBR  TO PC086-OPER-UNT-ID        04980007
049900     END-IF.                                                      04990007
050000                                                                  05000007
050100     IF  PV-NULL-IND-02 = -1                                      05010016
050200         MOVE ZEROS                   TO PC086-STORE-NBR          05020007
050300     ELSE                                                         05030007
050310         MOVE PCT00011-EVNT-KY-2-NBR  TO PC086-STORE-NBR          05031007
050320     END-IF.                                                      05032007
050330                                                                  05033007
050340     IF  PV-NULL-IND-03 = -1                                      05034016
050350         MOVE ZEROS                   TO PC086-ORD-NBR            05035007
050360     ELSE                                                         05036007
050370         MOVE PCT00011-EVNT-KY-3-NBR  TO PC086-ORD-NBR            05037007
050380     END-IF.                                                      05038007
050390                                                                  05039007
050391     IF  PV-NULL-IND-04 = -1                                      05039116
050392         MOVE ZEROS                   TO PC086-RCVR-SEQ-NBR       05039207
050393     ELSE                                                         05039307
050394         MOVE PCT00011-EVNT-KY-4-NBR  TO PC086-RCVR-SEQ-NBR       05039407
050395     END-IF.                                                      05039507
050396                                                                  05039607
050397     IF  PV-NULL-IND-05 = -1                                      05039716
050398         MOVE ZEROS                   TO PC086-ORD-LNE-NBR        05039807
050399     ELSE                                                         05039907
050400         MOVE PCT00011-EVNT-KY-5-NBR  TO PC086-ORD-LNE-NBR        05040013
050401     END-IF.                                                      05040107
050402                                                                  05040207
050410     MOVE PCT00011-CRE-BY-USR-ID      TO PC086-CRE-BY-USR-ID.     05041007
050500     MOVE PCT00011-CRE-BY-PGM-NM      TO PC086-CRE-PGM-NM.        05050007
050600                                                                  05060001
050700     MOVE PCT00011-EVNT-KY-1-TMST     TO PC086-P2L-CRE-TMST.      05070043
050800                                                                  05080007
057400     IF  PV-NULL-IND-08 = -1                                      05740016
057500         MOVE SPACES                  TO PC086-BUS-EVENT-TMST     05750042
057600     ELSE                                                         05760001
057700         MOVE PCT00011-CRE-TMST       TO PC086-BUS-EVENT-TMST     05770042
057800     END-IF.                                                      05780008
057900                                                                  05790001
061200     MOVE PCT00012-DTL-TXT-TEXT       TO PC242-AJ-DATA.           06120024
061201                                                                  06120107
061260     MOVE PC242-AJ-PICKED-QTY         TO PC086-PICKED-QTY.        06126007
061270     MOVE PC242-AJ-PICKED-QTY-SIGN    TO PC086-PICKED-QTY-SIGN.   06127010
061280                                                                  06128039
061290     IF  PC242-AJ-PICKED-QTY-SIGN     = 'N'                       06129039
061291         MULTIPLY PC086-PICKED-QTY BY -1                          06129139
061292           GIVING PC086-PICKED-QTY                                06129240
061293     END-IF.                                                      06129340
061294                                                                  06129440
061295     MOVE PC242-AJ-STR-ZN-ID      TO  PC086-PRCG-AREA-CDE.        06129540
061296                                                                  06129640
061297     MOVE DISTHD-PREPK-LNE-PRC-CDE TO PC086-PREPK-LNE-PRC-CDE.    06129740
061298     MOVE DISTHD-UCC128-DAT-USG-CDE                               06129840
061299                                  TO PC086-UCC128-DAT-USG-CDE.    06129940
061300                                                                  06130006
061400                                                                  06140006
061500*-----------------------------------------------------------------06150006
061600*                                                                 06160006
061700*-----------------------------------------------------------------06170006
088200 7000-OPEN-P2L-EXTRACT-CSR.                                       08820002
088300     PERFORM                                                      08830002
088400         WITH TEST AFTER                                          08840002
088500         VARYING PV-RETRY-COUNT                                   08850002
088600         FROM 1 BY 1                                              08860002
088700         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 08870002
088800            OR  (SQLCODE = +100)                                  08880002
088900            OR  (SQLCODE = +0))                                   08890002
089000     EXEC SQL                                                     08900002
089100         OPEN P2L-EXTRACT-CSR                                     08910002
089200     END-EXEC                                                     08920002
089300                                                                  08930002
089400     EVALUATE TRUE                                                08940002
089500         WHEN SQLCODE = ZERO                                      08950002
089600         WHEN SQLCODE = -904                                      08960002
089700         WHEN SQLCODE = -913                                      08970002
089800         WHEN SQLCODE = -911                                      08980002
089900             CONTINUE                                             08990002
090000         WHEN SQLWARN0 NOT = SPACE                                09000002
090100         WHEN SQLCODE  NOT = ZERO                                 09010002
090200             MOVE '7000-OPEN-P2L-EXTRACT-CSR'                     09020002
090300                                       TO PV-ABEND-PARAGRAPH      09030002
090400             MOVE 'OPEN CURSOR'        TO PV-ABEND-OPERATION      09040002
090600             MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1    09060002
090700             PERFORM 9900-DB2-ABEND                               09070002
090800     END-EVALUATE                                                 09080002
090900     END-PERFORM.                                                 09090002
091000     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      09100002
091100          SQLCODE NOT = ZERO                                      09110002
091200          DISPLAY '**************************************'        09120002
091300          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        09130002
091400          DISPLAY 'OPEN EXTRACT CURSOR    '                       09140002
091500          DISPLAY '**************************************'        09150002
091600          MOVE '7000-OPEN-P2L-EXTRACT-CSR'                        09160002
091700                                    TO PV-ABEND-PARAGRAPH         09170002
091800          MOVE 'OPEN CURSOR'        TO PV-ABEND-OPERATION         09180002
092000          MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1       09200002
092100          MOVE 'OPEN CURSOR ERROR'  TO PV-DB2-OPERATION-MESSAGE-1 09210002
092200          PERFORM 9900-DB2-ABEND                                  09220002
092300      END-IF.                                                     09230002
092400                                                                  09240002
092410*-----------------------------------------------------------------09241006
092420*                                                                 09242006
092430*-----------------------------------------------------------------09243006
092500 7010-FETCH-P2L-EXTRACT-CSR.                                      09250002
092600      PERFORM                                                     09260002
092700          WITH TEST AFTER                                         09270002
092800          VARYING PV-RETRY-COUNT                                  09280002
092900          FROM 1 BY 1                                             09290002
093000          UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                09300002
093100             OR  (SQLCODE = +100)                                 09310002
093200             OR  (SQLCODE = +0))                                  09320002
093300       EXEC SQL                                                   09330002
093400           FETCH P2L-EXTRACT-CSR                                  09340002
093500           INTO                                                   09350002
093700               :PCT00011-EVNT-EXPRT-ID                            09370004
093800           ,   :PCT00011-EVNT-OBJ-TXT                             09380004
093900           ,   :PCT00011-EVNT-OBJ-ACTN-TXT                        09390004
094000           ,   :PCT00011-CRE-TMST                                 09400004
094010           ,   :DISTHD-CRE-TMST                                   09401002
094020           ,   :DISTHD-PREPK-LNE-PRC-CDE                          09402035
094030           ,   :DISTHD-UCC128-DAT-USG-CDE                         09403035
094100           ,   :PCT00011-CRE-BY-USR-ID                            09410004
094200           ,   :PCT00011-CRE-BY-PGM-NM                            09420004
094400           ,   :PCT00011-EVNT-KY-1-NBR  :PV-NULL-IND-01           09440016
094500           ,   :PCT00011-EVNT-KY-2-NBR  :PV-NULL-IND-02           09450016
094600           ,   :PCT00011-EVNT-KY-3-NBR  :PV-NULL-IND-03           09460016
094700           ,   :PCT00011-EVNT-KY-4-NBR  :PV-NULL-IND-04           09470016
094800           ,   :PCT00011-EVNT-KY-5-NBR  :PV-NULL-IND-05           09480016
094900           ,   :PCT00011-EVNT-KY-1-TXT  :PV-NULL-IND-06           09490016
095000           ,   :PCT00011-EVNT-KY-2-TXT  :PV-NULL-IND-07           09500016
095400           ,   :PCT00011-EVNT-KY-1-TMST :PV-NULL-IND-08           09540016
095900           ,   :PCT00011-EXPRT-STAT-CDE                           09590004
096100           ,   :PCT00012-DTL-TXT                                  09610027
096200       END-EXEC                                                   09620002
096300                                                                  09630002
096400       EVALUATE TRUE                                              09640002
096500           WHEN SQLCODE = ZERO                                    09650002
096600               ADD 1                    TO PV-EVENT-FETCH-COUNT   09660002
096700           WHEN SQLCODE = +100                                    09670002
096800               SET PS-END-CSR           TO TRUE                   09680002
096900           WHEN SQLCODE = -904                                    09690002
097000           WHEN SQLCODE = -913                                    09700002
097100           WHEN SQLCODE = -911                                    09710002
097200                CONTINUE                                          09720002
097300           WHEN SQLWARN0 NOT = SPACE                              09730002
097400           WHEN SQLCODE  NOT = ZERO                               09740002
097500               MOVE '7010-FETCH-P2L-EXTRACT-CSR'                  09750002
097600                                         TO PV-ABEND-PARAGRAPH    09760002
097700               MOVE 'FETCH CURSOR'       TO PV-ABEND-OPERATION    09770002
097900               MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1  09790002
098000               PERFORM 9900-DB2-ABEND                             09800002
098100       END-EVALUATE                                               09810002
098200       END-PERFORM.                                               09820002
098300     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      09830002
098400          SQLCODE NOT = ZERO                                      09840002
098500          DISPLAY '**************************************'        09850002
098600          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        09860002
098700          DISPLAY 'OPEN EXTRACT CURSOR    '                       09870002
098800          DISPLAY '**************************************'        09880002
098900          MOVE '7000-OPEN-P2L-EXTRACT-CSR'                        09890002
099000                                    TO PV-ABEND-PARAGRAPH         09900002
099100          MOVE 'OPEN CURSOR'        TO PV-ABEND-OPERATION         09910002
099300          MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1       09930002
099400          MOVE 'FETCH CURSOR ERROR' TO PV-DB2-OPERATION-MESSAGE-1 09940002
099500          PERFORM 9900-DB2-ABEND                                  09950002
099600      END-IF.                                                     09960002
099700                                                                  09970002
099710*-----------------------------------------------------------------09971006
099720*                                                                 09972006
099730*-----------------------------------------------------------------09973006
099800 7020-CLOSE-P2L-EXTRACT-CSR.                                      09980002
099900     PERFORM                                                      09990002
100000         WITH TEST AFTER                                          10000002
100100         VARYING PV-RETRY-COUNT                                   10010002
100200         FROM 1 BY 1                                              10020002
100300         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 10030002
100400            OR  (SQLCODE = +100)                                  10040002
100500            OR  (SQLCODE = +0))                                   10050002
100600     EXEC SQL                                                     10060002
100700         CLOSE P2L-EXTRACT-CSR                                    10070002
100800     END-EXEC                                                     10080002
100900                                                                  10090002
101000     EVALUATE TRUE                                                10100002
101100         WHEN SQLCODE = ZERO                                      10110002
101200         WHEN SQLCODE = -904                                      10120002
101300         WHEN SQLCODE = -913                                      10130002
101400         WHEN SQLCODE = -911                                      10140002
101500             CONTINUE                                             10150002
101600         WHEN SQLWARN0 NOT = SPACE                                10160002
101700         WHEN SQLCODE  NOT = ZERO                                 10170002
101800             MOVE '7020-CLOSE-P2L-EXTRACT-CSR'                    10180002
101900                                       TO PV-ABEND-PARAGRAPH      10190002
102000             MOVE 'CLOSE CURSOR'       TO PV-ABEND-OPERATION      10200002
102200             MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1    10220002
102300             PERFORM 9900-DB2-ABEND                               10230002
102400     END-EVALUATE                                                 10240002
102500     END-PERFORM.                                                 10250002
102600     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      10260002
102700          SQLCODE NOT = ZERO                                      10270002
102800          DISPLAY '**************************************'        10280002
102900          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        10290002
103000          DISPLAY 'OPEN EXTRACT CURSOR    '                       10300002
103100          DISPLAY '**************************************'        10310002
103200          MOVE '7020-CLOSE-P2L-EXTRACT-CSR'                       10320002
103300                                    TO PV-ABEND-PARAGRAPH         10330002
103400          MOVE 'CLOSE CURSOR'       TO PV-ABEND-OPERATION         10340002
103600          MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1       10360002
103700          MOVE 'CLOSE CURSOR ERROR' TO PV-DB2-OPERATION-MESSAGE-1 10370002
103800          PERFORM 9900-DB2-ABEND                                  10380002
103900      END-IF.                                                     10390002
104000                                                                  10400002
104100*-----------------------------------------------------------------10410006
104200*                                                                 10420006
104300*-----------------------------------------------------------------10430006
116100 8100-WRITE-EXTRACT-REC.                                          11610006
116200                                                                  11620006
116300     ADD 1 TO PV-EXTRACT-WRITE-COUNT.                             11630006
116400     WRITE PICKMADE-RECORD  FROM                                  11640013
116500           PC086-EXPORT-RECORD-LAYOUT.                            11650013
116600                                                                  11660006
116700*-----------------------------------------------------------------11670038
116800*                                                                 11680038
116900*-----------------------------------------------------------------11690038
117800 9000-TERMINATE.                                                  11780002
117900                                                                  11790002
118000     PERFORM 7020-CLOSE-P2L-EXTRACT-CSR.                          11800002
118100                                                                  11810002
118300     CLOSE PICKMADE-EXPORT-FILE.                                  11830002
118700                                                                  11870002
119500     DISPLAY SPACES                                               11950002
119600                                                                  11960002
119700     MOVE PV-EVENT-FETCH-COUNT        TO PV-DISPLAY-COUNT.        11970006
119800     DISPLAY 'TOTAL BUS EVENTS FETCHED      = ' PV-DISPLAY-COUNT. 11980006
119900                                                                  11990006
121500     MOVE PV-EXTRACT-WRITE-COUNT       TO PV-DISPLAY-COUNT.       12150006
121600     DISPLAY 'TOTAL EXTRACT RECORDS WRITTEN = ' PV-DISPLAY-COUNT. 12160006
121700                                                                  12170006
122100     DISPLAY SPACES                                               12210002
122200     DISPLAY '************************'.                          12220002
122300                                                                  12230001
122400                                                                  12240001
122500 9900-DB2-ABEND.                                                  12250001
122600                                                                  12260001
122700     MOVE SQLCODE TO PV-SQLCODE.                                  12270001
122800     DISPLAY '*** DB2 ERROR '.                                    12280001
122900     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       12290001
123000     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 12300001
123100     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               12310001
123200     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               12320001
123300     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       12330001
123400     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       12340001
123500     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       12350001
123600     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             12360001
123700                                                                  12370001
124200                                                                  12420001
124300     COPY DPPD004.                                                12430001
124400                                                                  12440001
124500     MOVE +4013                  TO PV-ABEND-CODE.                12450001
124600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         12460001
124700                                                                  12470001
