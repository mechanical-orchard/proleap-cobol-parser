000100******************************************************************00010021
000200 IDENTIFICATION DIVISION.                                         00020021
000300******************************************************************00030021
000400                                                                  00040021
000500 PROGRAM-ID.             RCKUT103.                                00050023
000600 AUTHOR.                 AL PETERS.                               00060023
000700 INSTALLATION.           KOHLS.                                   00070021
000800 DATE-WRITTEN            JUNE 1999.                               00080023
000900 DATE-COMPILED.                                                   00090021
001000                                                                  00100021
001100******************************************************************00110021
001200*   THIS PROGRAM PROCESSES A STORE EXTRACT INPUT FILE            *00120099
001300*   FROM THE WEEKLY STORE EXTRACT PROCESS AND CREATES A NEW      *00130099
001400*   NON-ASN VENDOR FILE.                                         *00140099
001500******************************************************************00150099
001700* CHANGE HISTORY                                                 *00160099
001300*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)               *00170099
001300*     DATE:    10/27/2014                                        *00180099
001300*                                                                *00190099
001300*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO#  *00200099
001300*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/27/2014     *00210099
002200******************************************************************00220099
001600 ENVIRONMENT DIVISION.                                            00230099
001700                                                                  00240099
001800 CONFIGURATION SECTION.                                           00250099
001900                                                                  00260099
002000 SOURCE-COMPUTER.        IBM-3090.                                00270099
002100 OBJECT-COMPUTER.        IBM-3090.                                00280099
002200                                                                  00290099
002300 INPUT-OUTPUT SECTION.                                            00300099
002400                                                                  00310099
002500 FILE-CONTROL.                                                    00320099
002600                                                                  00330099
002700     SELECT STORE-EXTRACT                                         00340099
002800         ASSIGN TO IN01.                                          00350099
002900                                                                  00360099
003000     SELECT NON-ASN-VENDOR-FILE                                   00370099
003100         ASSIGN TO OUT01.                                         00380099
003200                                                                  00390099
003300******************************************************************00400099
003400 DATA DIVISION.                                                   00410099
003500******************************************************************00420099
003600                                                                  00430099
003700 FILE SECTION.                                                    00440099
003800                                                                  00450099
003900 FD  STORE-EXTRACT                                                00460099
004000     LABEL RECORDS ARE STANDARD                                   00470099
004100     BLOCK CONTAINS 0 RECORDS                                     00480099
004200     RECORDING MODE IS F                                          00490099
004300     RECORD CONTAINS 300 CHARACTERS                               00500099
004400     DATA RECORD IS STORE-EXTRACT-RECORD.                         00510099
004500                                                                  00520099
004600 01  STORE-EXTRACT-RECORD     PIC X(300).                         00530099
004700                                                                  00540099
004800 FD  NON-ASN-VENDOR-FILE                                          00550099
004900     LABEL RECORDS ARE STANDARD                                   00560099
005000     BLOCK CONTAINS 0 RECORDS                                     00570099
005100     RECORDING MODE IS F                                          00580099
005200     RECORD CONTAINS 120 CHARACTERS                               00590099
005300     DATA RECORD IS NON-ASN-VENDOR-RECORD.                        00600099
005400                                                                  00610099
005500 01  NON-ASN-VENDOR-RECORD    PIC X(120).                         00620099
005600                                                                  00630099
005700******************************************************************00640099
005800 WORKING-STORAGE SECTION.                                         00650099
005900******************************************************************00660099
006000                                                                  00670099
006100 01  ABEND-CODE                          PIC S9(04)  VALUE +0.    00680099
006200 EJECT                                                            00690099
006300                                                                  00700099
006400 01  PV-PROGRAM-VARIABLES.                                        00710099
006500     05  PV-SE-PO                        PIC S9(09) COMP VALUE +0.00720099
006600     05  PV-REC-SEQ-NBR                  PIC S9(09) COMP VALUE +0.00730099
006700     05  PV-PARA                         PIC X(30)   VALUE SPACES.00740099
006800                                                                  00750099
006900     05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACE. 00760099
007000     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 00770099
007100     05  PV-ABEND-PARAGRAPH              PIC  X(30)  VALUE SPACE. 00780099
007200*PS 10/27/2014 CHANGE STARTS                                      00790099
007200     05  SAVE-PO-NBR                     PIC  9(08)  VALUE ZERO.  00800099
007200*PS 10/27/2014 CHANGE ENDS                                        00810099
007300     05  SAVE-DUNNS-NBR                  PIC  9(09)  VALUE ZERO.  00820099
007400                                                                  00830099
007500 01  PROGRAM-SWITCHES.                                            00840099
007600     05  END-OF-INPUT-SW                 PIC X(01)   VALUE 'N'.   00850099
007700         88  END-OF-INPUT                            VALUE 'Y'.   00860099
007800                                                                  00870099
007900     05  ENT-ID-NOTFND-SW                PIC X(01)   VALUE 'N'.   00880099
008000         88  ENT-ID-NOTFND                           VALUE 'Y'.   00890099
008100                                                                  00900099
008200     05  ENT-ID-FND-SW                   PIC X(01)   VALUE 'N'.   00910099
008300         88  ENT-ID-FND                              VALUE 'Y'.   00920099
008400                                                                  00930099
008500     05  PROD-TSTID-NOTFND-SW            PIC X(01)   VALUE 'N'.   00940099
008600         88  PROD-TSTID-NOTFND                       VALUE 'Y'.   00950099
008700                                                                  00960099
008800     05  PROD-TSTID-FND-SW               PIC X(01)   VALUE 'N'.   00970099
008900         88  PROD-TSTID-FND                          VALUE 'Y'.   00980099
009000                                                                  00990099
009100     05  EXTRACT-REC-SW                  PIC X(01)   VALUE 'N'.   01000099
009200         88  EXTRACT-REC                             VALUE 'Y'.   01010099
009300                                                                  01020099
009400 01  DN-DB2-NULL-INDICATORS.                                      01030099
009500     05  DN-VEH-NBR                 PIC S9(04) COMP VALUE +0.     01040099
009600                                                                  01050099
009700 01  PC-CONSTANTS.                                                01060099
009800     05  RC-A                            PIC X(01)  VALUE 'A'.    01070099
009900                                                                  01080099
010000     COPY STOREEXT.                                               01090099
010100                                                                  01100099
010200     COPY RCRD047.                                                01110099
010300                                                                  01120099
010400******************************************************************01130099
010500*  DB2 COMMUNICATION AREA.                                        01140099
010600******************************************************************01150099
010700     EXEC SQL                                                     01160099
010800          INCLUDE SQLCA                                           01170099
010900     END-EXEC.                                                    01180099
011000*                                                                 01190099
011100******************************************************************01200099
011200*  DB2 FORMATTED MESSAGE AREA.                                    01210099
011300******************************************************************01220099
011400     COPY DPWS024.                                                01230099
011500     COPY SQLCA2.                                                 01240099
011600*                                                                 01250099
011700******************************************************************01260099
011800*  DB2 TABLE DB2PDBA.TPURCHS                                      01270099
011900******************************************************************01280099
012000     EXEC SQL                                                     01290099
012100          INCLUDE TPURCHS                                         01300099
012200     END-EXEC.                                                    01310099
012300*                                                                 01320099
012400******************************************************************01330099
012500*  DB2 TABLE DB2PDBA.TEXTENT                                      01340099
012600******************************************************************01350099
012700     EXEC SQL                                                     01360099
012800          INCLUDE TEXTENT                                         01370099
012900     END-EXEC.                                                    01380099
013000*                                                                 01390099
013100******************************************************************01400099
013200*  DB2 TABLE DB2PDBA.TTRDPRT                                      01410099
013300******************************************************************01420099
013400     EXEC SQL                                                     01430099
013500          INCLUDE TTRDPRT                                         01440099
013600     END-EXEC.                                                    01450099
013700*                                                                 01460099
013800*                                                                 01470099
013900******************************************************************01480099
014000*  DB2 TABLE DB2PDBA.TTRDTRN                                      01490099
014100******************************************************************01500099
014200     EXEC SQL                                                     01510099
014300          INCLUDE TTRDTRN                                         01520099
014400     END-EXEC.                                                    01530099
014500*                                                                 01540099
014600*                                                                 01550099
014700******************************************************************01560099
014800*  DB2 TABLE DB2PDBA.TRECEIV                                      01570099
014900******************************************************************01580099
015000     EXEC SQL                                                     01590099
015100          INCLUDE TRECEIV                                         01600099
015200     END-EXEC.                                                    01610099
015300*                                                                 01620099
015400*                                                                 01630099
015500******************************************************************01640099
015600*  DB2 TABLE DB2PDBA.TSHPTPO                                      01650099
015700******************************************************************01660099
015800     EXEC SQL                                                     01670099
015900          INCLUDE TSHPTPO                                         01680099
016000     END-EXEC.                                                    01690099
016100*                                                                 01700099
016200*                                                                 01710099
016300******************************************************************01720099
016400*  DB2 TABLE DB2PDBA.TSHIPMT                                      01730099
016500******************************************************************01740099
016600     EXEC SQL                                                     01750099
016700          INCLUDE TSHIPMT                                         01760099
016800     END-EXEC.                                                    01770099
016900*                                                                 01780099
017000*                                                                 01790099
017100******************************************************************01800099
017200*  DB2 TABLE DB2PDBA.TVHTRIP                                      01810099
017300******************************************************************01820099
017400     EXEC SQL                                                     01830099
017500          INCLUDE TVHTRIP                                         01840099
017600     END-EXEC.                                                    01850099
017700******************************************************************01860099
017800     EXEC SQL                                                     01870099
017900     DECLARE TRDTRN_CSR CURSOR FOR                                01880099
018000         SELECT                                                   01890099
018100             PROD_TEST_IND                                        01900099
018200         FROM                                                     01910099
018300             TTRDPRT A                                            01920099
018400            ,TTRDTRN B                                            01930099
018500         WHERE                                                    01940099
018600                 A.ENT_ID        = :PURCHS-ENT-ID                 01950099
018700             AND A.TP_DKEY       = B.TP_DKEY                      01960099
018800             AND B.TRAN_SET_CDE  = '856'                          01970099
018900             AND CURRENT DATE   >= B.ACTV_DTE                     01980099
019000             AND CURRENT DATE   <= B.INACTV_DTE                   01990099
019100         ORDER BY                                                 02000099
019200             B.PROD_TEST_IND                                      02010099
019300     END-EXEC.                                                    02020099
019400******************************************************************02030099
019500*                                                                 02040099
019600 PROCEDURE DIVISION.                                              02050099
019700                                                                  02060021
019800******************************************************************02070021
019900*  0000-MAINLINE-ROUTINE  -  MAIN LINE OF THE PROGRAM PERFORMS THE02080051
020000*  HOUSEKEEPING ROUTINE AND CONTROLS THE PROCESSING OF THE PGM.   02090051
020100******************************************************************02100021
020200                                                                  02110021
020300 0000-MAINLINE.                                                   02120021
020400                                                                  02130021
020500     PERFORM 0100-HOUSEKEEPING.                                   02140021
020600                                                                  02150021
020700     PERFORM 1000-PROCESS-INPUT-RECORDS                           02160021
020800         UNTIL END-OF-INPUT.                                      02170021
020900                                                                  02180021
021000     PERFORM 8000-EOJ.                                            02190026
021100                                                                  02200021
021200/                                                                 02210099
021300 0100-HOUSEKEEPING.                                               02220099
021400                                                                  02230099
021500     OPEN INPUT  STORE-EXTRACT                                    02240099
021600          OUTPUT NON-ASN-VENDOR-FILE.                             02250099
021700                                                                  02260099
021800     PERFORM 7000-READ-STORE-FILE.                                02270099
021900                                                                  02280099
022000/                                                                 02290099
022100 1000-PROCESS-INPUT-RECORDS.                                      02300099
022200                                                                  02310099
022300     IF SE-PO = SAVE-PO-NBR                                       02320099
022400         IF PROD-TSTID-FND                                        02330099
022500             CONTINUE                                             02340099
022600         ELSE                                                     02350099
022700             MOVE 'N' TO PROD-TSTID-FND-SW                        02360099
022800             PERFORM 1300-SELECT-RECVR-SHPMT-INFO                 02370099
022900             IF EXTRACT-REC AND ENT-ID-FND                        02380099
023000                 PERFORM 8000-WRITE-NON-ASN-RECORD                02390099
023100             END-IF                                               02400099
023200         END-IF                                                   02410099
023300     ELSE                                                         02420099
023400         MOVE 'N' TO ENT-ID-FND-SW                                02430099
023500         MOVE 'N' TO ENT-ID-NOTFND-SW                             02440099
023600         MOVE 'N' TO EXTRACT-REC-SW                               02450099
023700         MOVE 'N' TO PROD-TSTID-FND-SW                            02460099
023800         PERFORM 1100-GET-ENT-ID                                  02470099
023900         IF ENT-ID-NOTFND                                         02480099
024000            MOVE 'Y' TO PROD-TSTID-FND-SW                         02490099
024100         ELSE                                                     02500099
024200            PERFORM 6000-OPEN-TRDTRN-CSR                          02510099
024300            PERFORM 6010-FETCH-TRDTRN-CSR                         02520099
024400            PERFORM 6020-CLOSE-TRDTRN-CSR                         02530099
024500         END-IF                                                   02540099
024600         IF PROD-TSTID-FND                                        02550099
024700             CONTINUE                                             02560099
024800         ELSE                                                     02570099
024900             MOVE 'N' TO PROD-TSTID-FND-SW                        02580099
025000             PERFORM 1300-SELECT-RECVR-SHPMT-INFO                 02590099
025100             IF EXTRACT-REC AND ENT-ID-FND                        02600099
025200                 PERFORM 8000-WRITE-NON-ASN-RECORD                02610099
025300             END-IF                                               02620099
025400         END-IF                                                   02630099
025500     END-IF.                                                      02640099
025600     MOVE SE-PO TO SAVE-PO-NBR.                                   02650099
025700     PERFORM 7000-READ-STORE-FILE.                                02660099
025800                                                                  02670099
025900 1100-GET-ENT-ID.                                                 02680099
026000     EXEC SQL                                                     02690099
026100        SELECT                                                    02700099
026200            A.ENT_ID                                              02710099
026300           ,B.STATUS_CDE                                          02720099
026400        INTO                                                      02730099
026500            :PURCHS-ENT-ID                                        02740099
026600           ,:EXTENT-STATUS-CDE                                    02750099
026700        FROM                                                      02760099
026800            TPURCHS A                                             02770099
026900           ,TEXTENT B                                             02780099
027000        WHERE                                                     02790099
027100                   A.PO_NBR =  :PV-SE-PO                          02800099
027200        AND A.VER_STATUS_CDE =  :RC-A                             02810099
027300*LMM                                                              02820099
027400*       AND A.PO_TYP_CDE NOT IN  ('IM', 'IE', 'IF')               02830099
181356*       AND A.PO_TYP_CDE NOT IN  ('IM', 'IE', 'IF', 'LD')         02840099
181356        AND A.PO_TYP_CDE NOT IN  ('IM', 'IE', 'IF', 'LD', 'LE')   02850099
027600        AND A.ENT_ID = B.ENT_ID                                   02860099
027700        AND B.STATUS_CDE = :RC-A                                  02870099
027800     END-EXEC.                                                    02880099
027900                                                                  02890099
028000     EVALUATE TRUE                                                02900099
028100        WHEN SQLCODE = ZERO                                       02910099
028200        WHEN SQLCODE = -811                                       02920099
028300                                                                  02930099
028400            SET ENT-ID-FND     TO TRUE                            02940099
028500                                                                  02950099
028600        WHEN SQLCODE = +100                                       02960099
028700            SET ENT-ID-NOTFND  TO TRUE                            02970099
028800                                                                  02980099
028900        WHEN OTHER                                                02990099
029000            MOVE '1100-GET-ENT-ID'                                03000099
029100                             TO PV-PARAGRAPH-NAME                 03010099
029200            MOVE 'ERROR ON SELECT TO ENT-ID'                      03020099
029300                             TO PV-DB2-OPERATION-ATTEMPTED        03030099
029400            PERFORM 9100-SQL-ABEND                                03040099
029500     END-EVALUATE.                                                03050099
029600                                                                  03060099
029700                                                                  03070099
029800 1300-SELECT-RECVR-SHPMT-INFO.                                    03080099
029900     EXEC SQL                                                     03090099
030000          SELECT                                                  03100099
030100               A.ORD_NBR                                          03110099
030200              ,A.REC_SEQ_NBR                                      03120099
030300              ,A.EXPTED_CART_CNT                                  03130099
030400              ,A.ACTL_CART_CNT                                    03140099
030500              ,B.PO_NBR                                           03150099
030600              ,B.REC_SEQ_NBR                                      03160099
030700              ,C.SHIPT_ID                                         03170099
030800              ,C.TRIP_ID                                          03180099
030900              ,C.BOL_NBR                                          03190099
031000              ,D.OWNER_SCAC_ID                                    03200099
031100              ,D.VEH_NBR                                          03210099
031200          INTO                                                    03220099
031300               :RECEIV-ORD-NBR                                    03230099
031400              ,:RECEIV-REC-SEQ-NBR                                03240099
031500              ,:RECEIV-EXPTED-CART-CNT                            03250099
031600              ,:RECEIV-ACTL-CART-CNT                              03260099
031700              ,:SHPTPO-PO-NBR                                     03270099
031800              ,:SHPTPO-REC-SEQ-NBR                                03280099
031900              ,:SHIPMT-SHIPT-ID                                   03290099
032000              ,:VHTRIP-TRIP-ID                                    03300099
032100              ,:SHIPMT-BOL-NBR                                    03310099
032200              ,:VHTRIP-OWNER-SCAC-ID                              03320099
032300              ,:VHTRIP-VEH-NBR                                    03330099
032400          FROM                                                    03340099
032500               TRECEIV A                                          03350099
032600              ,TSHPTPO B                                          03360099
032700              ,TSHIPMT C                                          03370099
032800              ,TVHTRIP D                                          03380099
032900          WHERE                                                   03390099
033000                A.ORD_NBR       = :PV-SE-PO                       03400099
033100            AND A.REC_SEQ_NBR   = :PV-REC-SEQ-NBR                 03410099
033200            AND B.PO_NBR        = :PV-SE-PO                       03420099
033300            AND B.REC_SEQ_NBR   = :PV-REC-SEQ-NBR                 03430099
033400            AND C.SHIPT_ID      = B.SHIPT_ID                      03440099
033500            AND D.TRIP_ID       = C.TRIP_ID                       03450099
033600                                                                  03460099
033700     END-EXEC.                                                    03470099
033800                                                                  03480099
033900     EVALUATE TRUE                                                03490099
034000         WHEN SQLCODE = ZERO                                      03500099
034100         WHEN SQLCODE = -305                                      03510099
034200         WHEN SQLCODE = -811                                      03520099
034300              SET EXTRACT-REC TO TRUE                             03530099
034400              IF DN-VEH-NBR = -1                                  03540099
034500                 MOVE SPACES  TO VHTRIP-VEH-NBR                   03550099
034600              END-IF                                              03560099
034700                                                                  03570099
034800         WHEN SQLCODE = +100                                      03580099
034900              CONTINUE                                            03590099
035000                                                                  03600099
035100         WHEN OTHER                                               03610099
035200              MOVE '1300-SELECT-RECVR-SHPMT-INFO'                 03620099
035300                               TO  PV-PARAGRAPH-NAME              03630099
035400              MOVE 'SELECT TO MULTIPLE TABLES'                    03640099
035500                               TO  PV-DB2-OPERATION-ATTEMPTED     03650099
035600              DISPLAY 'PO NUMBER IS ' SE-PO                       03660099
035700              'RCVR SEQ NBR IS ' SE-REC-SEQ-NBR                   03670099
035800              PERFORM 9100-SQL-ABEND                              03680099
035900     END-EVALUATE.                                                03690099
036000                                                                  03700099
036100 8000-WRITE-NON-ASN-RECORD.                                       03710099
036200     MOVE SPACES                                                  03720099
036300                    TO RC047-NON-ASN-VENDOR-RECORD.               03730099
036400     MOVE SE-VENDOR-NO-DUNNS                                      03740099
036500                    TO RC047-VENDOR-NO-DUNNS.                     03750099
036600     MOVE SE-VENDOR-NAME-DUNNS                                    03760099
036700                    TO RC047-VENDOR-NAME-DUNNS.                   03770099
036800     MOVE SE-PO     TO RC047-PO-NBR.                              03780099
036900     MOVE SE-CURR-OPER-UNT-ID                                     03790099
037000                    TO RC047-CURR-OPER-UNT-ID.                    03800099
037100     MOVE SE-DATE-RECEIVED                                        03810099
037200                    TO RC047-DATE-RECEIVED.                       03820099
037300     MOVE SE-DATE-VERIFIED-COUNT                                  03830099
037400                    TO RC047-DATE-VERIFIED-COUNT.                 03840099
037500     MOVE SE-REC-SEQ-NBR                                          03850099
037600                    TO RC047-REC-SEQ-NBR.                         03860099
037700     MOVE SE-DEPT                                                 03870099
037800                    TO RC047-DEPT-NBR.                            03880099
037900     MOVE TRDTRN-PROD-TEST-IND                                    03890099
038000                    TO RC047-PROD-TEST-IND.                       03900099
038100     MOVE RECEIV-EXPTED-CART-CNT                                  03910099
038200                    TO RC047-EXPTED-CART-CNT.                     03920099
038300     MOVE RECEIV-ACTL-CART-CNT                                    03930099
038400                    TO RC047-ACTL-CART-CNT.                       03940099
038500     MOVE SHIPMT-BOL-NBR                                          03950099
038600                    TO RC047-BOL-NBR.                             03960099
038700     MOVE VHTRIP-OWNER-SCAC-ID                                    03970099
038800                    TO RC047-OWNER-SCAC-ID.                       03980099
038900     MOVE VHTRIP-VEH-NBR                                          03990099
039000                    TO RC047-VEH-NBR.                             04000099
039100     MOVE 'N'       TO RC047-PROD-TEST-IND.                       04010099
039200     WRITE NON-ASN-VENDOR-RECORD FROM                             04020099
039300               RC047-NON-ASN-VENDOR-RECORD.                       04030099
039400                                                                  04040099
039500 7000-READ-STORE-FILE.                                            04050099
039600     READ STORE-EXTRACT INTO STORE-EXTRACT-LINE                   04060099
039700        AT END                                                    04070099
039800           SET END-OF-INPUT    TO TRUE                            04080099
039900        NOT AT END                                                04090099
040000           MOVE SE-PO          TO PV-SE-PO                        04100099
040100           MOVE SE-REC-SEQ-NBR TO PV-REC-SEQ-NBR                  04110099
040200        END-READ.                                                 04120099
040300                                                                  04130099
040400     IF END-OF-INPUT                                              04140099
040500        CONTINUE                                                  04150099
040600     END-IF.                                                      04160099
040700                                                                  04170099
040800 6000-OPEN-TRDTRN-CSR.                                            04180099
040900     MOVE '6000-OPEN-TRDTRN-CSR'                                  04190099
041000         TO PV-ABEND-PARAGRAPH.                                   04200099
041100     MOVE 'OPEN THE TRDTRN_CSR'                                   04210099
041200         TO PV-DB2-OPERATION-ATTEMPTED.                           04220099
041300                                                                  04230099
041400     EXEC SQL                                                     04240099
041500         OPEN TRDTRN_CSR                                          04250099
041600     END-EXEC.                                                    04260099
041700                                                                  04270099
041800     EVALUATE TRUE                                                04280099
041900         WHEN SQLWARN0 NOT = SPACE                                04290099
042000         WHEN SQLCODE < ZERO                                      04300099
042100         WHEN SQLCODE > ZERO                                      04310099
042200             PERFORM 9100-SQL-ABEND                               04320099
042300         WHEN SQLCODE = ZERO                                      04330099
042400             CONTINUE                                             04340099
042500     END-EVALUATE.                                                04350099
042600                                                                  04360099
042700 6010-FETCH-TRDTRN-CSR.                                           04370099
042800     INITIALIZE DCLTTRDTRN.                                       04380099
042900                                                                  04390099
043000     EXEC SQL                                                     04400099
043100         FETCH  TRDTRN_CSR                                        04410099
043200          INTO  :TRDTRN-PROD-TEST-IND                             04420099
043300     END-EXEC.                                                    04430099
043400                                                                  04440099
043500     EVALUATE TRUE                                                04450099
043600         WHEN SQLCODE = ZERO                                      04460099
043700         WHEN SQLCODE = -811                                      04470099
043800              SET PROD-TSTID-FND  TO TRUE                         04480099
043900                                                                  04490099
044000         WHEN SQLCODE = +100                                      04500099
044100              SET PROD-TSTID-NOTFND TO TRUE                       04510099
044200                                                                  04520099
044300         WHEN OTHER                                               04530099
044400              MOVE '6010-FETCH-PROD-TEST-IND'                     04540099
044500                               TO PV-PARAGRAPH-NAME               04550099
044600              MOVE 'ERROR ON FETCH TO PROD-TEST-IND'              04560099
044700                               TO  PV-DB2-OPERATION-ATTEMPTED     04570099
044800              DISPLAY 'PO NUMBER IS ' SE-PO                       04580099
044900              'RCVR SEQ NBR IS ' SE-REC-SEQ-NBR                   04590099
045000              PERFORM 9100-SQL-ABEND                              04600099
045100     END-EVALUATE.                                                04610099
045200                                                                  04620099
045300 6020-CLOSE-TRDTRN-CSR.                                           04630099
045400     MOVE '6020-CLOSE-TRDTRN-CSR'                                 04640099
045500         TO PV-ABEND-PARAGRAPH.                                   04650099
045600     MOVE 'CLOSE THE TRDTRN_CSR'                                  04660099
045700         TO PV-DB2-OPERATION-ATTEMPTED.                           04670099
045800                                                                  04680099
045900     EXEC SQL                                                     04690099
046000         CLOSE TRDTRN_CSR                                         04700099
046100     END-EXEC.                                                    04710099
046200                                                                  04720099
046300     EVALUATE TRUE                                                04730099
046400         WHEN SQLWARN0 NOT = SPACE                                04740099
046500         WHEN SQLCODE < ZERO                                      04750099
046600         WHEN SQLCODE > ZERO                                      04760099
046700             PERFORM 9100-SQL-ABEND                               04770099
046800         WHEN SQLCODE = ZERO                                      04780099
046900             CONTINUE                                             04790099
047000     END-EVALUATE.                                                04800099
047100                                                                  04810099
047200 8000-EOJ.                                                        04820099
047300     CLOSE STORE-EXTRACT                                          04830099
047400           NON-ASN-VENDOR-FILE.                                   04840099
047500                                                                  04850099
047600     STOP RUN.                                                    04860099
047700                                                                  04870099
047800******************************************************************04880099
047900* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      04890099
048000* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 04900099
048100******************************************************************04910099
048200 9100-SQL-ABEND.                                                  04920099
048300     DISPLAY '** ABEND     **'.                                   04930099
048400     DISPLAY '** PROGRAM   ** = RCKUT103'.                        04940099
048500     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04950099
048600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     04960099
048700                                                                  04970099
048800******************************************************************04980099
048900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04990099
049000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05000099
049100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05010099
049200* FORMAT.                                                         05020099
049300******************************************************************05030099
049400                                                                  05040099
049500     COPY DPPD024.                                                05050099
049600                                                                  05060099
049700     MOVE +4013 TO ABEND-CODE.                                    05070099
049800     CALL 'ILBOABN0' USING ABEND-CODE.                            05080099
049900                                                                  05090099
