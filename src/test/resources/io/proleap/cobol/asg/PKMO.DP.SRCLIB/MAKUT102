000100*************************                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*************************                                         00030000
000400 PROGRAM-ID.      MAKUT102.                                       00040000
000500 AUTHOR.          NATALIYA PALATNIK                               00050000
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060000
000700 DATE-WRITTEN.    07/19/94.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900****************************************************************  00090000
001000* THIS IS A NIGHTLY ITEM BRIDGE PROGRAM. IT WILL BRIDGE ALL    *  00100000
001100* CHANGES ON TMDSEAR AND TSK DB2 TABLES TO NEW ITEM/CLUSTER    *  00110000
001200* STRUCTURES ON ORACLE.                                        *  00120000
001300*                                                              *  00130000
001400*   N O T E  F O R  S K U  R E N U M B E R S                   *  00140000
001500* THE LOGIC IS CODED FOR HANDLING SKU RENUMBERS USING THE      *  00150000
001600* DDD-SS-8DIGITNISKU.  HOWEVER, IT HAS NOT BEEN TESTED.  A     *  00160000
001700* COUPLE OF THINGS NEED TO BE DONE BEFORE THIS LOGIC CAN       *  00170000
001800* BE RUN.  FIRST, UNCOMMENT CODE W/ "LLG UNCOMMENT LINE BELOW".*  00180000
001900* SECOND, THE SKU-REN-EXTRACT-REC LENGTH ALSO NEEDS TO BE      *  00190000
002000* CHANGED FROM 37 TO 45.  THIRD, COPYBOOK MARD025 NEEDS TO     *  00200000
002100* HAVE ITEM NBR ADDED TO IT.                                   *  00210000
002200****************************************************************  00220000
002300* CHANGED TO INCLUDE MAINTENANCE OF VENDOR AND VENDOR STYLE       00230000
002400* CLUSTERS.  ALSO ADDED A SYSIN CONTROL CARD CONTAINING A DATE    00240000
002500* USED TO CONTROL THE INPUT DATA DATE DURING SPECIAL RUNS.        00250000
002600*    PAUL KEBER - STRATAGEM    06/08/95                           00260000
002700*                                                                 00270000
002800* CHANGED TO RETRIEVE A SINGLE CLUSTER ID FOR A SKU.              00280000
002900*    PAT LEE - 03/12/96                                           00290000
003000* CHANGED TO UPDATE THE SKU SALES TABLES FOR EACH RENUMBERED SKU  00300000
003100*    SCOTT A CIESIELCZYK (SAC) - 09/05/96                         00310000
003200* CHANGED TO ADD A SECOND SELECT FOR VENDOR ITEM CLUSTR IDS IF    00320000
003300*    THE FIRST ONE IS NOT FOUND.  THE SECOND SELECT WILL JUST     00330000
003400*    LOOK AT THE ENT_ID PORTION OF THE ITEM NAME WITHIN A OWNING  00340000
003500*    DEPT.                                                        00350000
003600*    CHRISTINE A FOLEY (CAF) - 10/01/96                           00360000
003700* CHANGED TO MOVE DPT NBR TO OWNER ID INSTEAD OF DMA FOR DEPT     00370000
003800*    LEVEL TMDSEAR.                                               00380000
003900*    CHRISTINE A FOLEY (CAF) - 10/18/96                           00390000
004000* CORRECTED THE SQL STATEMENT IN D106                             00400000
004100*    NATALIYA PALATNIK       - 10/24/96                           00410000
004200* CHANGED TO ACCEPT A SKU RENUMBER EXTRACT FILE.                  00420000
004300*    SCOTT A CIESIELCZYK (SAC001) - 12/10/96                      00430000
004400* CHANGED THE SKULOG INPUT FILE LAYOUT TO AN INCLUDE MEMBER.      00440000
004500* ADDED CODE TO ACCEPT THE MEITGP-NBR, BUT NOT BRIDGE AT THIS TME.00450000
004600*    SCOTT A CIESIELCZYK (SAC002) - 06/20/97                      00460000
004700* CHANGED THE SKU RENUMBER INPUT FILE LAYOUT TO AN INCLUDE MEMBER 00470000
004800* AND ADDED THIS MEMBER TO MAKUT102 AND MAKUT101.                 00480000
004900*    SCOTT A CIESIELCZYK (SAC003) - 08/05/97                      00490000
005000* CHANGED THE PROCESS TMDSEAR CHANGE CODE TO HANDLE REPEPARTMENT  00500000
005100* CORRECTLY.                                    .                 00510000
005200*    ANN SUN (AS001) - 08/26/97                                   00520000
005300* CHANGED THE CODE TO HANDLE THE INSERT SKU RENUMBER AS SEVERAL   00530000
005400* SOURCE DATA SETS.                             .                 00540000
005500*    ANN SUN (AS002) - 05/08/98                                   00550000
005600* FOR RENUMBERS, HANDLE THE CASE WHERE THE "HISTORICAL" SKU       00560000
005700* IS SO OLD IT HASN'T BEEN BRIDGED.                               00570000
005800*    MARY ELLEN PAUL (MEP001) - JULY 7, 1998                      00580000
005900* CHANGED COMMIT LOGIC FOR RENUMBERED SKU'S TO CORRECT            00590000
006000* LOST SKU'S.                                                     00600000
006100* CHANGED LOGIC TO MOVE THE CORRECT TMDSEAR DESCRIPTION TO        00610000
006200* THE ORACLE SIDE.                                                00620000
006300*    FRANK SANTANDREA (FPS798) - JULY 28, 1998.                   00630000
006400* WHEN BRIDGING A NEW SKU -- IF IT ALREADY EXISTS IN              00640000
006500*    TITMCLT, CHECK THE TITMCLT.LAST_UPD_TMST AGAINST             00650000
006600*    THE TRANSACTION DATE OF THE "ADD" RECORD.                    00660000
006700*    IF THE TRANSACTION DATE IS GREATER THAN THE                  00670000
006800*    LAST UPDATE TIMESTAMP, WE KNOW THIS SKU WAS PREVIOUSLY       00680000
006900*    DELETED ON THE MAINFRAME SIDE AND THE "DELETE" DID NOT       00690000
007000*    BRIDGE.  FIRST EXPIRE THE EXISTING TITMCLT.  THEN            00700000
007100*    INSERT A NEW ONE.                                            00710000
007200*    MARY ELLEN PAUL (MEP002) - OCTOBER 1998                      00720000
007300* WHEN BRIDGING A RENUMBER -- IF IT ALREADY EXISTS IN             00730000
007400*    TITMCLT, CHECK THE TITMCLT.LAST_UPD_TMST AGAINST             00740000
007500*    THE RENUMBER DATE (MA025-RNMBR-DATE).                        00750000
007600*    IF THE RENUMBER DATE IS GREATER THAN THE                     00760000
007700*    LAST UPDATE TIMESTAMP, WE KNOW THIS SKU WAS PREVIOUSLY       00770000
007800*    DELETED ON THE MAINFRAME SIDE AND THE "DELETE" DID NOT       00780000
007900*    BRIDGE.  FIRST EXPIRE THE EXISTING TITMCLT.  THEN            00790000
008000*    INSERT A NEW ONE.                                            00800000
008100*    MARY ELLEN PAUL (MEP003) - NOVEMBER 1998                     00810000
008200* FIX BUG IN VST UPDATE                                           00820000
008300*    FRANK SANTANDREA & MARY ELLEN PAUL - 01/25/99                00830000
008400* CORRECTED MDSEAR REALIGNMENT PROBLEM - CODE CHANGES IN B200     00840000
008500*    , B450 AND C360 (TO USE CORRECT END DATE).                   00850000
008600*    FRANK SANTANDREA - 01/26/99                                  00860000
008700* CORRECTED INSERTION OF NEW VST RECORDS FOR BOTH NEW AND         00870000
008800*    RENUMBERD SKU'S D108 WAS ADDED TO HANDLE THIS CONDITION, AND 00880000
008900*    MODIFICATIONS TO C952 WERE MADE TO DETERMINE WHICH WAY TO    00890000
009000*    HANDLE WHICH VST PROCESSING TO PERFORM BASED ON THE          00900000
009100*    SKU-PROCESSING-CODE.                                         00910000
009200*    FRANK SANTANDREA - 03/08/99                                  00920000
009300* ADDED DATE-WINDOWING LOGIC IN ALL PLACES WHERE CENTURY DATE     00930000
009400*    VALUE WAS PREVIOUSLY HARD-CODED.  WINDOW WILL FUNCTION WITH  00940000
009500*    YEAR SPAN OF 1980 - 2079.                                    00950000
009600*    MARK RENTMEESTER - COMPUWARE - 05/07/99                      00960000
009700* CORRECTED GMA UPDATE ERROR - ADDED VALUE CLAUSE TO WORKING      00970000
009800* STORAGE.                                                        00980000
009900* CORRECTED MR599 BUG - ADDED ASSIGN VALUE BEFORE COMPARSION.     00990000
010000* 06/19/2000                                                      01000000
010100* 12/07/2000 E-COMMERCE CHANGES.                                  01010000
010200* DEFAULTED THE E-ITM-IND TO 'N' FOR INSERTS TO TMDSEIT.          01020000
010300* 03/22/2001 WR#99999                                             01030000
010400*            ADDED COLUMN CHLD_ITM_UNT_QTY.                       01040000
010500* 05/21/2001 WR#22186                                             01050000
010600*            ADDED D105-GET-VST-CLUSTR-ID-NO-SKU LOGIC            01060000
010700*            TO FIX THE DUP VST PROBLEM ON TITMCLT/TITMCLC.       01070000
010800* 09/04/2001 WR#22186                                             01080000
010900*            CHANGED THE SKU RENUMBER LOGIC IN C952-PROCESS-VST.  01090000
011000*            DUP VST'S WERE ALSO BEING CREATED FOR SKU            01100000
011100*            RENUMBERS INVOLVING THE SAME DEPT WITH DIFFERENT     01110000
011200*            MAJOR AND/OR SUB CLASSES.                            01120000
011300* 10/05/2001 WR######                                             01130000
011400*            POPULATE TITMCLT SKU COLUMN WITH THE NEW SKU FORMAT  01140000
011500*            FOR NEW   OR UPDATED SKUS.                           01150000
011600* 04/21/2003 WR21120                                              01160000
011700*            TEMPORARY NI SKU CHANGES.  USE INTR-UPC-ID TO        01170000
011800*            RETRIEVE THE INTELLIGENT SKU FROM TSKXREF.           01180000
011900* 05/17/2003 PM00549097                                           01190000
012000*            FIX A LOGIC PROBLEM IN E255 -- CHANGED IT TO         01200000
012100*            TO USE A PREDEFINED END TIMESTAMP VARIABLE.          01210000
012200* 06/09/2003 WR21120                                              01220000
012300*            CHANGE MDSCRE AND MDSCHG CURSOR DEFINITIONS SO       01230000
012400*            THEY DON'T USE ANY DATE REFERENCES IN THE "WHERE"    01240000
012500*            STATEMENT.  THIS WAS DONE TO ACCOMODATE AN           01250000
012600*            ORACLE 28500- ERROR WHICH COULD NOT BE EXPLAINED     01260000
012700*            AFTER THE ORACLE UPGRADE.                            01270000
012800* 06/24/2003 WR21120                                              01280000
012900*            REMOVED LOGIC REFERRING TO THE INTELLIGENT SKU.      01290000
013000*            REPLACED DB2 LOOKUPS USING INTELLIGENT SKU WITH      01300000
013100*            ITEM NBR.  REFORMATTED THE TITMCLT ITEM CLUSTER      01310000
013200*            NAME TO USE DPT, SUBCLASS, AND NI SKU.               01320000
013300* 05/20/2004 WR27065                                              01330000
013400*            ADDED TO PARA. C360- TO REINSTATE EFFECTIVITY        01340000
013500*            FOR SCL TO SKU RELATIONSHIPS WHEN A DEPARTMENT       01350000
013600*            GETS MOVED TO A DIFFERENT DIVISION. CODE WAS         01360000
013700*            EXPIRING SCL TO SKU RELATIONSHIPS AND NOT RE-        01370000
013800*            INSTATING THEM - LOOKS TO USER LIKE SKUS ARE         01380000
013900*            DELETED.                                             01390000
014000* 06/06/2005 WR28644                                              01400000
014100*            TWO NEW COLUMNS ARE BEING CREATED/MAINTAINED         01410000
014200*            ON TMDSEIT.  THESE COLUMNS ARE TO SUPPORT THE        01420000
014300*            SIZE PROFILE PROJECT AND ARE KOHLS_SIZE_CDE AND      01430000
014400*            NRF_CLOR_CDE.                                        01440000
014500* 03/2008    INC000000224319                                      01450000
014600*            FIXED BUG IN UPDATING ENT-ID. CONVERSION BETWEEN     01460000
014700*            FIELD TYPES CAUSED ENT-ID TO BE RIGHT-PADDED         01470000
014800*            WITH ZEROS.                                          01480000
014500* 07/30/2018 CHG0205458                                           01490005
014600*            ORACLE LOGON STANDARDS PROGRAM CHANGE                01500004
014500* 08/04/2022 CHG0000000                                           01510014
014600*            ADD COMMIT LOGIC AND REMOVE DISPLAYS                 01520014
014900****************************************************************  01530000
015000*                                                                 01540000
015100 ENVIRONMENT DIVISION.                                            01550000
015200*                                                                 01560000
015300*                                                                 01570000
015400 CONFIGURATION SECTION.                                           01580000
015500 SOURCE-COMPUTER. IBM-3090.                                       01590000
015600 OBJECT-COMPUTER. IBM-3090.                                       01600000
015700*                                                                 01610000
015800*                                                                 01620000
015900 INPUT-OUTPUT SECTION.                                            01630000
016000 FILE-CONTROL.                                                    01640000
016100                                                                  01650000
016200                                                                  01660000
016300     SELECT DAILY-CHANGES-FILE                                    01670000
016400         ASSIGN                       TO INP01.                   01680000
016500                                                                  01690000
016600     SELECT WEEKLY-SKU-DELETES-FILE                               01700000
016700         ASSIGN                       TO INP02.                   01710000
016800                                                                  01720000
016900     SELECT SKU-REN-EXTRACT-FILE                                  01730000
017000         ASSIGN                       TO INP03.                   01740000
017100                                                                  01750000
017110     SELECT ORACLE-LOGON-FILE                                     01760001
017120         ASSIGN                       TO ORALOGON.                01770001
017130                                                                  01780001
017200*    EJECT                                                        01790000
017300***************                                                   01800000
017400 DATA DIVISION.                                                   01810000
017500***************                                                   01820000
017600*                                                                 01830000
017700*                                                                 01840000
017800 FILE SECTION.                                                    01850000
017900                                                                  01860000
018000 FD  DAILY-CHANGES-FILE                                           01870000
018100     RECORDING MODE F                                             01880000
018200     BLOCK CONTAINS 0 RECORDS                                     01890000
018300     RECORD CONTAINS 182 CHARACTERS                               01900000
018400     LABEL RECORDS ARE OMITTED                                    01910000
018500     DATA RECORD IS DAILY-CHANGES-RECORD.                         01920000
018600                                                                  01930000
018700 01  DAILY-CHANGES-RECORD                            PIC X(182).  01940000
018800                                                                  01950000
018900 FD  WEEKLY-SKU-DELETES-FILE                                      01960000
019000     RECORDING MODE F                                             01970000
019100     BLOCK CONTAINS 0 RECORDS                                     01980000
019200     RECORD CONTAINS 200 CHARACTERS                               01990000
019300     LABEL RECORDS ARE OMITTED                                    02000000
019400     DATA RECORD IS WEEKLY-SKU-DELETES-RECORD.                    02010000
019500                                                                  02020000
019600 01  WEEKLY-SKU-DELETES-RECORD                       PIC X(200).  02030000
019700                                                                  02040000
019800 FD  SKU-REN-EXTRACT-FILE                                         02050000
019900     RECORDING MODE F                                             02060000
020000     BLOCK CONTAINS 0 RECORDS                                     02070000
020100     RECORD CONTAINS 37 CHARACTERS                                02080000
020200     LABEL RECORDS ARE OMITTED                                    02090000
020300     DATA RECORD IS SKU-REN-EXTRACT-REC.                          02100000
020400                                                                  02110000
020500 01  SKU-REN-EXTRACT-REC                    PIC X(37).            02120000
020600                                                                  02130000
020610 FD  ORACLE-LOGON-FILE                                            02140001
020620     RECORDING MODE IS F                                          02150001
020630     LABEL RECORDS ARE STANDARD                                   02160001
020640     BLOCK CONTAINS 0 RECORDS                                     02170001
020650     RECORD CONTAINS 80 CHARACTERS                                02180001
020660     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      02190001
020670                                                                  02200001
020680 01  OL-ORACLE-LOGON-RECORD          PIC X(80).                   02210001
020690                                                                  02220001
020700     EJECT                                                        02230000
020800*                                                                 02240000
020900 WORKING-STORAGE SECTION.                                         02250000
021000*                                                                 02260000
021100***************************************************************   02270000
021200 01 FILLER                          PIC X(08)  VALUE 'BEGIN WS'.  02280000
021300***************************************************************   02290000
021400 01  PV-ABEND-CODE                    PIC S9(04)     VALUE +0     02300000
021500                                                     COMP SYNC.   02310000
021600*                                                                 02320000
021700*                                                                 02330000
021800 01  PV-PROGRAM-VARIABLES.                                        02340000
021900                                                                  02350000
021910     05  PV-ORACLE-USERID-LEN       PIC S9(04) VALUE ZEROS        02360001
021920                                               COMP SYNC.         02370001
021930     05  PV-ORACLE-PASSWORD-LEN     PIC S9(04) VALUE ZEROS        02380001
021940                                               COMP SYNC.         02390001
022000     05  WS-ROW-COUNT               PIC 9(9) VALUE 0.             02400000
022100     05  PV-WORK-CLUSTR-ID-1        PIC 9(10).                    02410000
022200     05  PV-WORK-CLUSTR-ID-2        PIC 9(10).                    02420000
022300     05  PV-WORK-DPT                PIC 9(4).                     02430000
022400     05  PV-WORK-DPT-X REDEFINES PV-WORK-DPT.                     02440000
022500         10  PV-WORK-DPT-1          PIC 9.                        02450000
022600         10  PV-WORK-DPT-2-4        PIC 9(3).                     02460000
022700     05  PV-WORK-SUBCL              PIC 9(4).                     02470000
022800     05  PV-WORK-SUBCL-X REDEFINES PV-WORK-SUBCL.                 02480000
022900         10  PV-WORK-SUBCL-1-2      PIC 9(2).                     02490000
023000         10  PV-WORK-SUBCL-3-4      PIC 9(2).                     02500000
023100     05  PV-WORK-NI-SKU             PIC X(8).                     02510000
023200     05  PV-WORK-NI-SKU-X REDEFINES PV-WORK-NI-SKU.               02520000
023300         10  PV-WORK-NI-SKU-X-1     PIC X(1).                     02530000
023400         10  PV-WORK-NI-SKU-X-2-8   PIC X(7).                     02540000
023500     05  PV-RENUM-DEPT.                                           02550000
023600         10  PV-RENUM-DEPT-1        PIC X.                        02560000
023700         10  PV-RENUM-DEPT-2-3      PIC X(2).                     02570000
023800     05  PV-MERCH-SKU-ITM-NBR       PIC S9(15)     COMP-3.        02580000
023900     05  PV-ITMCLT-SKU              PIC S9(8)      COMP-3.        02590000
024000     05  PV-ABEND-PARAGRAPH         PIC X(30)      VALUE SPACES.  02600000
024100     05  PV-DUMMY                   PIC X(10)      VALUE SPACES.  02610000
024200     05  PV-RANDOM-NUMBER           PIC S9(09)     COMP           02620000
024300                                                   VALUE ZERO.    02630000
024400     05  PV-FETCH-COUNT             PIC S9(04)     COMP           02640000
024500                                                   VALUE ZERO.    02650000
024600     05  PV-COMMIT-COUNT            PIC S9(04)     COMP           02660000
024700                                                   VALUE ZERO.    02661023
0822RM     05  PV-INS-UPD-COUNT           PIC S9(04)     COMP           02670022
0822RM                                                   VALUE ZERO.    02680035
**TEMP     05  WS-ROW-COUNT-CTR           PIC S9(04)     COMP           02681035
**TEMP                                                   VALUE ZERO.    02682035
0822RM     05  PV-TOTAL-INS-UPD           PIC S9(08)     COMP           02690022
0822RM                                                   VALUE ZERO.    02700009
                                                                        02710009
024800     05  PV-WAIT-COUNT              PIC S9(04)     COMP           02720000
024900                                                   VALUE ZERO.    02730000
025000     05  PV-CONTINUE-FLG            PIC 9(1)       VALUE ZERO.    02740000
025100     05  PV-FOUND-RECORD            PIC 9(1)       VALUE ZERO.    02750000
025200     05  PV-NO-MORE-MATCH-DATA-LEFT PIC 9(1)       VALUE ZERO.    02760000
025300     05  PV-GMA-DESC                PIC X(10)      VALUE SPACES.  02770000
025400     05  PV-DMA-DESC                PIC X(10)      VALUE SPACES.  02780000
025500     05  PV-DEPT-DESC               PIC X(10)      VALUE SPACES.  02790000
025600     05  PV-MAJ-CL-DESC             PIC X(10)      VALUE SPACES.  02800000
025700     05  PV-SUB-CL-DESC             PIC X(10)      VALUE SPACES.  02810000
025800     05  PV-CORP-PRNT-CLUSTR-ID     PIC S9(09)     COMP-3         02820000
025900                                                   VALUE ZERO.    02830000
026000     05  PV-GMA-PRNT-CLUSTR-ID      PIC S9(09)     COMP-3         02840000
026100                                                   VALUE ZERO.    02850000
026200     05  PV-DMA-PRNT-CLUSTR-ID      PIC S9(09)     COMP-3         02860000
026300                                                   VALUE ZERO.    02870000
026400     05  PV-DEPT-PRNT-CLUSTR-ID     PIC S9(09)     COMP-3         02880000
026500                                                   VALUE ZERO.    02890000
026600     05  PV-MAJ-PRNT-CLUSTR-ID      PIC S9(09)     COMP-3         02900000
026700                                                   VALUE ZERO.    02910000
026800     05  PV-SCL-PRNT-CLUSTR-ID      PIC S9(09)     COMP-3         02920000
026900                                                   VALUE ZERO.    02930000
027000*    05  PV-SKU-CHLD-CLUSTR-ID       PIC S9(09)     COMP-3        02940000
027100*                                                  VALUE ZERO.    02950000
027200     05  PV-VST-CHLD-CLUSTR-ID       PIC S9(09)     COMP-3        02960000
027300                                                   VALUE ZERO.    02970000
027400     05  PV-GRP-CHLD-CLUSTR-ID       PIC S9(09)     COMP-3        02980000
027500                                                   VALUE ZERO.    02990000
027600     05  PV-OLD-SKU-CLUSTR-ID        PIC S9(09)     COMP-3        03000000
027700                                                   VALUE ZERO.    03010000
027800*    05  PV-SKU-ID                   PIC S9(09)     COMP-3        03020000
027900*                                                  VALUE ZERO.    03030000
028000     05  PV-ITEM-UPDATE-NAME        PIC X(20)      VALUE SPACES.  03040000
028100     05  PV-STAT-CHNGD-DATE         PIC X(07)      VALUE SPACES.  03050000
028200     05  PV-JULIAN-DATE.                                          03060000
028300         10 PV-JULIAN-YEAR          PIC  9(02)     VALUE ZERO.    03070000
028400         10 PV-JULIAN-DAY           PIC  9(03)     VALUE ZERO.    03080000
028500     05  PV-WORK-JULIAN-DATE        PIC  9(05)     VALUE ZERO.    03090000
028600*    05  PV-CURRENT-JULIAN-DATE     PIC S9(05)V    VALUE ZERO     03100000
028700*                                                  COMP-3.        03110000
028800     05  PV-SUB1                    PIC S9(3)      VALUE ZERO     03120000
028900                                                   COMP-3.        03130000
029000     05  PC-MAX-RETRIES             PIC S9(04)     COMP           03140000
029100                                                   VALUE +3.      03150000
029200     05  PC-NEG-1                   PIC S9(04)     COMP SYNC      03160000
029300                                                   VALUE -1.      03170000
029400                                                                  03180000
029500     05  PC-Q                         PIC X(01)    VALUE ''''.    03190000
029600     05  PC-DQ                        PIC X(01)    VALUE '"'.     03200000
029700     05  PC-QUESTION                  PIC X(01)    VALUE '?'.     03210000
029800     05  PC-UNDERSCORE                PIC X(01)    VALUE '_'.     03220000
029900     05  PC-ASTERISK                  PIC X(01)    VALUE '*'.     03230000
030000     05  PC-PGMNAME                   PIC X(08)    VALUE          03240000
030100                                                   'ORAMA102'.    03250000
030200     05  PC-APPL-ID                  PIC  X(02)     VALUE         03260000
030300                                                    'MA'.         03270000
030400     05  PC-EXTR-PRC-ID              PIC  X(08)     VALUE         03280000
030500                                                    'MAKUT102'.   03290000
0822RM     05  PC-COMMIT-THRESHOLD         PIC 9(06)      VALUE 1000.   03300015
                                                                        03310009
030600     05  PV-SAVE-CLUSTR-DESC         PIC X(40).                   03320000
030700     05  PV-SETUP-DATE-10            PIC X(10).                   03330000
030800     05  PV-SETUP-DATE-7             PIC 9(07) DISPLAY.           03340000
0822RM     05  WS-DAILY-RECS-READ          PIC 9(10) VALUE ZEROS.       03341023
0822RM     05  WS-DELETE-RECS-READ         PIC 9(10) VALUE ZEROS.       03342023
030900     05  PV-RENUMBER-READ            PIC 9(05) VALUE ZEROS.       03350000
031000     05  PV-RENUMBER-INSERTED        PIC 9(05) VALUE ZEROS.       03360000
031100     05  PV-CLUSTER-UPDATED          PIC 9(05) VALUE ZEROS.       03370000
031200     05  PV-TMDSEAR-COUNT            PIC 9(09) VALUE ZEROS.       03380000
031300     05  PV-MDSEAR-INSERT            PIC 9(09) VALUE ZEROS.       03390000
031400     05  PV-MDSEAR-UPDATE            PIC 9(09) VALUE ZEROS.       03400000
031500     05  PV-ITMCLT-CLUSTR-DESC       PIC X(40) VALUE SPACES.      03410000
031600     05  PV-CALLING-PARA             PIC X(10) VALUE SPACES.      03420000
031700     05  PC-MULT-VALUES              PIC S9(04) VALUE -2112 COMP. 03430000
031800     05  PC-ORACLE-DISCONNECT        PIC S9(04) VALUE -2068 COMP. 03440000
031900     05  PV-SKU-PROCESS-CODE         PIC X(01) VALUE SPACES.      03450000
032000     05  PV-RENUMBER-EXPIRED         PIC 9(09) VALUE ZEROS.       03460000
032100     05  PV-RMS-SKU                  PIC S9(09)     COMP-3        03470000
032200                                                   VALUE ZERO.    03480000
032210     05  PC-AUTO-LOGON               PIC  X(01) VALUE '/'.        03490001
032220                                                                  03500001
032300 01  PV-XREF-CRITERIA.                                            03510000
032400     05  PV-XREF-DEPT           PIC X(03) VALUE SPACES.           03520000
032500     05  FILLER                 PIC X(01) VALUE SPACES.           03530000
032600     05  PV-XREF-CLASS          PIC X(02) VALUE SPACES.           03540000
032700     05  FILLER                 PIC X(01) VALUE SPACES.           03550000
032800     05  PV-XREF-SEQ            PIC X(03) VALUE SPACES.           03560000
032900     05  FILLER                 PIC X(01) VALUE SPACES.           03570000
033000                                                                  03580000
033100 01  WS-HOLD-DPT-SCL.                                             03590000
033200     05  WS-DPT                 PIC X(03) VALUE SPACES.           03600000
033300     05  WS-DASH                PIC X(01) VALUE '-'.              03610000
033400     05  WS-SCL                 PIC X(02) VALUE SPACES.           03620000
033500     05  WS-PERCENT             PIC X(01) VALUE '%'.              03630000
033600                                                                  03640000
033700 01  CC-CONTROL-CARD.                                             03650000
033800     05  CC-PGMNAME                   PIC X(08)    VALUE SPACES.  03660000
033900     05  FILLER                       PIC X(1)     VALUE SPACE.   03670000
034000     05  CC-RUN-TYPE                  PIC X(07).                  03680000
034100         88  CC-NORMAL-RUN                        VALUE 'NORMAL'. 03690000
034200         88  CC-MDSEAR-RUN                        VALUE 'MDSEAR'. 03700015
034300         88  CC-SKULOG-RUN                        VALUE 'SKULOG'. 03710000
034400         88  CC-SKURNBR-RUN                       VALUE 'SKURNBR'.03720000
034500         88  CC-WKSKDEL-RUN                       VALUE 'WKSKDEL'.03730000
034600     05  FILLER                       PIC X(1)     VALUE SPACE.   03740000
034700     05  CC-INPUT-DATA-DATE                        VALUE SPACES.  03750000
034800         10  CC-INPDD-YYYY            PIC X(4).                   03760000
034900         10  CC-INPDD-HYP1            PIC X(1).                   03770000
035000         10  CC-INPDD-MM              PIC X(2).                   03780000
035100         10  CC-INPDD-HYP2            PIC X(1).                   03790000
035200         10  CC-INPDD-DD              PIC X(2).                   03800000
035300     05  FILLER                       PIC X(53)    VALUE SPACES.  03810000
035400*                                                                 03820000
035500 01  CD-CPU-DATE.                                                 03830000
035600     05  CD-CPU-YR                    PIC 9(2)       VALUE ZEROS. 03840000
035700     05  CD-CPU-MO                    PIC 9(2)       VALUE ZEROS. 03850000
035800     05  CD-CPU-DD                    PIC 9(2)       VALUE ZEROS. 03860000
035900*                                                                 03870000
036000 01  PV-CPU-DATE.                                                 03880000
036100     05  PV-CPU-MO                    PIC 9(2)       VALUE ZEROS. 03890000
036200     05  FILLER                       PIC X(1)       VALUE '/'.   03900000
036300     05  PV-CPU-DY                    PIC 9(2)       VALUE ZEROS. 03910000
036400     05  FILLER                       PIC X(1)       VALUE '/'.   03920000
036500     05  PV-CPU-YR                    PIC 9(2)       VALUE ZEROS. 03930000
036600*                                                                 03940000
036700 01  CT-CPU-TIME.                                                 03950000
036800     05  CT-CPU-HH                    PIC 9(2)       VALUE ZEROS. 03960000
036900     05  CT-CPU-MM                    PIC 9(2)       VALUE ZEROS. 03970000
037000     05  CT-CPU-SS                    PIC 9(2)       VALUE ZEROS. 03980000
037100     05  CT-CPU-HS                    PIC 9(2)       VALUE ZEROS. 03990000
037200 01  WS-DB2-TIMESTAMP.                                            04000000
037300     05  WS-TS-CC                     PIC XX    VALUE SPACES.     04010000
037400     05  WS-TS-YY                     PIC XX    VALUE SPACES.     04020000
037500     05  FILLER                       PIC X     VALUE '-'.        04030000
037600     05  WS-TS-MO                     PIC XX    VALUE SPACES.     04040000
037700     05  FILLER                       PIC X     VALUE '-'.        04050000
037800     05  WS-TS-DD                     PIC XX    VALUE SPACES.     04060000
037900     05  FILLER                       PIC X     VALUE '-'.        04070000
038000     05  WS-TS-HH                     PIC XX    VALUE SPACES.     04080000
038100     05  FILLER                       PIC X     VALUE '.'.        04090000
038200     05  WS-TS-MM                     PIC XX    VALUE SPACES.     04100000
038300     05  FILLER                       PIC X     VALUE '.'.        04110000
038400     05  WS-TS-SS                     PIC XX    VALUE SPACES.     04120000
038500     05  FILLER                       PIC X     VALUE '.'.        04130000
038600     05  WS-TS-MS                     PIC X(6)  VALUE SPACES.     04140000
038700*                                                                 04150000
038800 01  WS-DB2-DATE.                                                 04160000
038900     05  WS-DB-CC                     PIC XX    VALUE SPACES.     04170000
039000     05  WS-DB-YY                     PIC XX    VALUE SPACES.     04180000
039100     05  FILLER                       PIC X     VALUE '-'.        04190000
039200     05  WS-DB-MO                     PIC XX    VALUE SPACES.     04200000
039300     05  FILLER                       PIC X     VALUE '-'.        04210000
039400     05  WS-DB-DD                     PIC XX    VALUE SPACES.     04220000
039500     05  FILLER                       PIC X     VALUE '.'.        04230000
039600     05  WS-DB-HH                     PIC XX    VALUE '00'.       04240000
039700     05  FILLER                       PIC X     VALUE '.'.        04250000
039800     05  WS-DB-MM                     PIC XX    VALUE '00'.       04260000
039900     05  FILLER                       PIC X     VALUE '.'.        04270000
040000     05  WS-DB-SS                     PIC XX    VALUE '00'.       04280000
040100*                                                                 04290000
040200 01  WS-TIMESTAMP                   PIC X(26).                    04300000
040300 01  FILLER REDEFINES WS-TIMESTAMP.                               04310000
040400     05  FILLER                     PIC X(14).                    04320000
040500     05  WS-MINUTE                  PIC X(02).                    04330000
040600     05  FILLER                     PIC X(02).                    04340000
040700     05  WS-SECOND                  PIC X(01).                    04350000
040800     05  FILLER                     PIC X(01).                    04360000
040900     05  WS-NANOSEC                 PIC X(06).                    04370000
041000 01  WS-RANDOM-KEY                  PIC 9(09).                    04380000
041100 01  FILLER REDEFINES WS-RANDOM-KEY.                              04390000
041200     05  WS-RND-NANOSEC             PIC X(06).                    04400000
041300     05  WS-RND-MINUTE              PIC X(02).                    04410000
041400     05  WS-RND-SECOND              PIC X(01).                    04420000
041500                                                                  04430000
041600 01  WS-RANDOM-KEY-COMP             PIC S9(09)  COMP.             04440000
041700                                                                  04450000
041800 01  WS-VND-CLUSTR-NAME.                                          04460000
041900     05  WS-VND-CLUSTR-NAME-DESC    PIC X(10)   VALUE SPACES.     04470000
042000     05  FILLER                     PIC X(01)   VALUE '-'.        04480000
042100     05  WS-VND-CLUSTR-NAME-ENTID   PIC 9(09)   VALUE ZERO.       04490000
042200                                                                  04500000
042300 01  WS-VND-ENTID                   PIC X(09)   VALUE SPACES.     04510000
042400                                                                  04520000
042500 01  PV-MDSEAR-DATE-FIELDS.                                       04530000
042600     10 PV-MDSEAR-CHG-DTE           PIC X(10)  VALUE SPACES.      04540000
042700     10 PV-MDSEAR-CRE-DTE           PIC X(10)  VALUE SPACES.      04550000
042800     10 PV-MDSEAR-STRT-DTE          PIC X(10)  VALUE SPACES.      04560000
042900     10 PV-MDSEAR-END-DTE           PIC X(10)  VALUE SPACES.      04570000
043000     10 PV-MDSEAR-GMA-NBR           PIC X(2)   VALUE SPACES.      04580000
043100     10 PV-MDSEAR-DMA-NBR           PIC X(2)   VALUE SPACES.      04590000
043200     10 PV-MDSEAR-DEPT-NBR          PIC X(3)   VALUE SPACES.      04600000
043300     10 PV-MDSEAR-MAJ-CL-NBR        PIC X(3)   VALUE SPACES.      04610000
043400     10 PV-MDSEAR-SUB-CL-NBR        PIC X(3)   VALUE SPACES.      04620000
043500     10 PV-MDSEAR-MDSELV-CDE        PIC X(3)   VALUE SPACES.      04630000
043600                                                                  04640000
043700     10 PV1-MDSEAR-GMA-NBR          PIC X(2)   VALUE SPACES.      04650000
043800     10 PV1-MDSEAR-DMA-NBR          PIC X(2)   VALUE SPACES.      04660000
043900     10 PV1-MDSEAR-DEPT-NBR         PIC X(3)   VALUE SPACES.      04670000
044000     10 PV1-MDSEAR-MAJ-CL-NBR       PIC X(3)   VALUE SPACES.      04680000
044100     10 PV1-MDSEAR-SUB-CL-NBR       PIC X(3)   VALUE SPACES.      04690000
044200     10 PV1-MDSEAR-MDSELV-CDE       PIC X(3)   VALUE SPACES.      04700000
044300     10 PV1-MDSEAR-CHG-DTE          PIC X(10)  VALUE SPACES.      04710000
044400     10 PV1-MDSEAR-CRE-DTE          PIC X(10)  VALUE SPACES.      04720000
044500*                                                                 04730000
044600 01  PS-SWITCHES.                                                 04740000
044610     05  PS-END-OF-LOGON-FILE-SW      PIC X(01)  VALUE 'N'.       04750001
044620         88  PS-END-OF-LOGON-FILE                VALUE 'Y'.       04760001
044630     05  PS-END-OF-PROC-INST-FILE-SW  PIC X(01)  VALUE 'N'.       04770001
044640         88  PS-END-OF-PROC-INST-FILE            VALUE 'Y'.       04780001
044650         88  PS-NOT-END-OF-PROC-INST-FILE        VALUE 'N'.       04790001
044660     05  PS-ORA-SRC-CTL-DONE-SW       PIC X(01)  VALUE 'N'.       04800001
044670         88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.       04810001
044700     05 PS-ITEMS-LEFT-SWITCH        PIC X      VALUE 'Y'.         04820000
044800        88 PS-MORE-ITEMS-LEFT                  VALUE 'Y'.         04830000
044900        88 PS-NO-MORE-ITEMS-LEFT               VALUE 'N'.         04840000
045000     05 PS-CLUSTERS-LEFT-SWITCH     PIC X      VALUE 'Y'.         04850000
045100        88 PS-MORE-CLUSTERS-LEFT               VALUE 'Y'.         04860000
045200        88 PS-NO-MORE-CLUSTERS-LEFT            VALUE 'N'.         04870000
045300     05 PS-PARENTS-LEFT-SWITCH      PIC X      VALUE 'Y'.         04880000
045400        88 PS-MORE-PARENTS                     VALUE 'Y'.         04890000
045500        88 PS-NO-MORE-PARENTS                  VALUE 'N'.         04900000
045600     05 PS-CHILDREN-LEFT-SWITCH     PIC X      VALUE 'Y'.         04910000
045700        88 PS-MORE-CHILDREN                    VALUE 'Y'.         04920000
045800        88 PS-NO-MORE-CHILDREN                 VALUE 'N'.         04930000
045900     05 PS-RENUMBERS-LEFT-SWITCH    PIC X      VALUE 'Y'.         04940000
046000        88 PS-MORE-RENUMBERS                   VALUE 'Y'.         04950000
046100        88 PS-NO-MORE-RENUMBERS                VALUE 'N'.         04960000
046200     05 PS-OLD-RENUMBERS-LEFT-SWITCH PIC X     VALUE 'Y'.         04970000
046300        88 PS-MORE-OLD-RENUMBERS               VALUE 'Y'.         04980000
046400        88 PS-NO-MORE-OLD-RENUMBERS            VALUE 'N'.         04990000
046500     05 PS-TYPE28-PROCESSED-SWITCH   PIC X     VALUE 'N'.         05000000
046600        88 PS-TYPE28-PROCESSED                 VALUE 'Y'.         05010000
046700        88 PS-TYPE28-NOT-PROCESSED             VALUE 'N'.         05020000
046800     05 PS-UPD-ROWS-LEFT-SWITCH      PIC X     VALUE 'Y'.         05030000
046900        88 PS-MORE-UPD-ROWS                    VALUE 'Y'.         05040000
047000        88 PS-NO-MORE-UPD-ROWS                 VALUE 'N'.         05050000
047100     05 PS-WEEKLY-DELETES-IND       PIC X      VALUE 'N'.         05060000
047200        88 PS-WEEKLY-DELETES-EOF               VALUE 'Y'.         05070000
047300        88 PS-WEEKLY-DELETES-NOT-EOF           VALUE 'N'.         05080000
047400     05 PS-DAILY-CHANGES-IND        PIC X      VALUE 'N'.         05090000
047500        88 PS-DAILY-CHANGES-EOF                VALUE 'Y'.         05100000
047600        88 PS-DAILY-CHANGES-NOT-EOF            VALUE 'N'.         05110000
047700     05 PS-SAVE-RELS-IND            PIC X      VALUE 'N'.         05120000
047800        88 PS-SAVE-RELS                        VALUE 'Y'.         05130000
047900        88 PS-DONT-SAVE-RELS                   VALUE 'N'.         05140000
048000     05 PS-RNMBR-SKU-EXIST-IND      PIC X      VALUE 'N'.         05150000
048100        88 PS-RNMBR-SKU-NOT-EXIST              VALUE 'N'.         05160000
048200        88 PS-RNMBR-SKU-EXISTS                 VALUE 'Y'.         05170000
048300     05 PS-MDSEAR-OK-TO-PROCESS     PIC X      VALUE 'N'.         05180000
048400        88 PS-MDSEAR-NOT-OK                    VALUE 'N'.         05190000
048500        88 PS-MDSEAR-OK                        VALUE 'Y'.         05200000
048600     05 PS-DUPGRP-TO-PROCESS        PIC X      VALUE 'Y'.         05210000
048700        88 PS-NO-MORE-DUPGRP-TO-PROCESS        VALUE 'N'.         05220000
048800        88 PS-MORE-DUPGRP-TO-PROCESS           VALUE 'Y'.         05230000
048900                                                                  05240000
048920 01  CC-ORACLE-CONNECTION.                                        05250001
048930     05  CC-ORACLE-USERID             PIC X(40).                  05260001
048940         88 CC-AUTO-LOGON                         VALUE '/'.      05270001
048950     05  CC-ORACLE-PASSWORD           PIC X(40).                  05280001
048960                                                                  05290001
049000 01  SD-SKU-DELETE-BKUP-RECORD.                                   05300000
049100     05  SD-TYPE-CODE                PIC 9         VALUE ZERO.    05310000
049200     05  SD-DEPT-NMBR                PIC X(3)      VALUE SPACES.  05320000
049300     05  SD-CLASS-NMBR               PIC X(2)      VALUE SPACES.  05330000
049400     05  SD-SEQ-NMBR                 PIC X(3)      VALUE SPACES.  05340000
049500     05  SD-ITEM-NMBR                PIC S9(15)    COMP-3.        05350000
049600     05  SD-REST                     PIC X(135)    VALUE SPACES.  05360000
049700     05  SD1-DETAIL REDEFINES SD-REST.                            05370000
049800         10  SD1-CUM-SLS-UNIT-QTY    PIC S9(7)     COMP-3.        05380000
049900         10  SD1-RTL-UNIT-RCVD-QTY   PIC S9(7)     COMP-3.        05390000
050000         10  SD1-COST-UNIT-MEASURE   PIC X(4).                    05400000
050100         10  SD1-RTL-UNIT-MEASURE    PIC X(4).                    05410000
050200         10  SD1-UNIT-COST-AMT       PIC S9(4)V999 COMP-3.        05420000
050300         10  SD1-CUR-UNIT-RTL-AMT    PIC S9(5)V99  COMP-3.        05430000
050400         10  SD1-ORIG-UNIT-RTL-AMT   PIC S9(5)V99  COMP-3.        05440000
050500         10  SD1-VNDR-IPACK-QTY      PIC S9(5)     COMP-3.        05450000
050600         10  SD1-SHIP-CNT-QTY        PIC S9(3)     COMP-3.        05460000
050700         10  SD1-VENDOR-STYLE-CD     PIC X(15).                   05470000
050800         10  SD1-STAT-CHNGD-DATE     PIC S9(7)     COMP-3.        05480000
050900         10  SD1-STATUS-CODE         PIC S9(3)     COMP-3.        05490000
051000         10  SD1-AUTO-REORD-MTHD     PIC X.                       05500000
051100         10  SD1-RTL-CST-CVRSN       PIC S9(3)     COMP-3.        05510000
051200         10  SD1-SETUP-DATE          PIC S9(7)     COMP-3.        05520000
051300         10  SD1-PRICE-CHNG-DATE     PIC S9(7)     COMP-3.        05530000
051400         10  SD1-GROUP-CODE          PIC X(3).                    05540000
051500         10  SD1-SKU-DESC            PIC X(25).                   05550000
051600         10  SD1-SIZE-DESC           PIC X(5).                    05560000
051700         10  SD1-COLOR-DESC          PIC X(4).                    05570000
051800         10  SD1-REORD-FRMT-CODE     PIC X.                       05580000
051900         10  SD1-MERCH-DIV-CODE      PIC S9        COMP-3.        05590000
052000         10  SD1-DMM-NMBR            PIC S9(3)     COMP-3.        05600000
052100         10  SD1-BUYER-NMBR          PIC S9(3)     COMP-3.        05610000
052200         10  SD1-VENDOR-NMBR         PIC S9(3)     COMP-3.        05620000
052300         10  SD1-MKDN-PGM-CODE       PIC X(01).                   05630000
052400         10  SD1-LOWST-UNIT-RTL-AMT  PIC S9(5)V99  COMP-3.        05640000
052500         10  SD1-LOW-RTL-PRICE-DATE  PIC S9(7)     COMP-3.        05650000
052600         10  SD1-GP-QTY              PIC 9(3)      COMP-3.        05660000
052700         10  SD1-GP-RTL-AMT          PIC S9(5)V99  COMP-3.        05670000
052800         10  SD1-ORIG-GP-QTY         PIC 9(3)      COMP-3.        05680000
052900         10  SD1-ORIG-GP-RTL-AMT     PIC S9(5)V99  COMP-3.        05690000
053000         10  SD1-FS-RPT-IND          PIC X.                       05700000
053100         10  FILLER                  PIC X(3).                    05710000
053200*                                                                 05720000
053300*  RECORD LAYOUT FOR THE MERCHANDISING   MAINTENANCE LOG          05730000
053400*                                                                 05740000
053500*----------------------------------------------------------------*05750000
053600*  RECORD LAYOUT FOR THE SKU LOG EXTRACT INPUT FILE. (FS500)      05760000
053700*----------------------------------------------------------------*05770000
053800     COPY FSRD500I.                                               05780000
053900*                                                                 05790000
054000* SAC002                                                          05800000
054100     COPY MARD024.                                                05810000
054200*                                                                 05820000
054300*-SAC003---------------------------------------------------------*05830000
054400*  RECORD LAYOUT FOR THE SKU REN EXTRACT INPUT FILE. (MA025)      05840000
054500*  THIS FILE COMES FROM MAKUT101 AND REPLACES DCLTSKURNMBR.       05850000
054600*----------------------------------------------------------------*05860000
054700     COPY MARD025.                                                05870000
054800*                                                                 05880000
054900* DECLARE VARIABLES FOR SUBROUTINE CALL  (SQLCODE TEXT)           05890000
055000                                                                  05900000
055100 01  WS-MSG-TEXT                   PIC X(512).                    05910000
055200 01  WS-MAX-SIZE                   PIC S9(09) COMP                05920000
055300                                              VALUE 512.          05930000
055400 01  WS-MSG-LENGTH                 PIC S9(09) COMP.               05940000
055500                                                                  05950000
055600                                                                  05960000
055700     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     05970000
055800                                                                  05980000
055900 01      USERNAME                   PIC X(10)      VARYING.       05990000
056000 01      PASSWD                     PIC X(10)      VARYING.       06000000
056100 01      PC-ENT01-TYPE-CDE          PIC X(02)      VALUE '01'.    06010000
056200 01      PV-ORACLE-ID               PIC X(1)       VALUE '/'.     06020000
056300 01      PV-ITMCLT-CLUSTR           PIC X(40)      VALUE SPACES.  06030000
056400                                                                  06040000
056500                                                                  06050000
056600* SAC * NEW FIELD FOR TSKUSL00 UPDATES                            06060000
056700 01      PV-ROWS-UPDATED            PIC S9(09)     COMP           06070000
056800                                                   VALUE ZERO.    06080000
056900 01      PV-RENUMBER-CLUSTR-ID      PIC S9(09)     COMP           06090000
057000                                                   VALUE ZERO.    06100000
057100 01      PV-CURRENT-DATE            PIC X(10)      VALUE SPACES.  06110000
057200 01      PV-CURRENT-TMST            PIC X(19)      VALUE SPACES.  06120000
057300 01      PV-CURRENT-TMST-NEW        PIC X(19)      VALUE SPACES.  06130000
057400 01      PV-NEW-END-DTE             PIC X(19)      VALUE SPACES.  06140000
057500 01      PV-CURR-END-TMST           PIC X(19)      VALUE SPACES.  06150000
057600 01      PV-CURR-STRT-TMST          PIC X(19)      VALUE SPACES.  06160000
057700 01      PV-INITIAL-STRT-TMST       PIC X(19)      VALUE          06170000
057800                                    '0000-00-00-00.00.00'.        06180000
057900 01      PV-INITIAL-END-TMST        PIC X(19)      VALUE          06190000
058000                                    '0000-00-00-23.59.59'.        06200000
058100 01      PV-INPUT-BEG-TMST          PIC X(19)      VALUE SPACES.  06210000
058200 01      PV-INPUT-END-TMST          PIC X(19)      VALUE SPACES.  06220000
058300 01      PV-INPUT-DTE               PIC X(10)      VALUE SPACES.  06230000
058400 01      PV-NEW-TMST                PIC X(19)      VALUE SPACES.  06240000
058500                                                                  06250000
058600 01      PV-SKU-ID                  PIC S9(09)     COMP-3         06260000
058700                                                   VALUE ZERO.    06270000
058800 01      PV-SKU-CHLD-CLUSTR-ID       PIC S9(09)    COMP-3         06280000
058900                                                   VALUE ZERO.    06290000
059000 01      PV-VND-PRNT-CLUSTR-ID       PIC S9(09)    COMP-3         06300000
059100                                                   VALUE ZERO.    06310000
059200 01      PV-CURRENT-JULIAN-DATE     PIC S9(05)V    COMP-3         06320000
059300                                                   VALUE ZERO.    06330000
059400 01      PV-EFF-END-DTE-NULL         PIC S9(04)     COMP          06340000
059500                                                   VALUE ZERO.    06350000
059600 01      PV-NEW-END-DTE-NULL         PIC S9(04)     COMP          06360000
059700                                                   VALUE ZERO.    06370000
059800 01      PV-CLUSTR-TYP-CDE-NULL      PIC S9(04)     COMP          06380000
059900                                                   VALUE ZERO.    06390000
060000 01      PV-HIER-TYP-CDE-NULL        PIC S9(04)     COMP          06400000
060100                                                   VALUE ZERO.    06410000
060200 01      PV-HIER-CDE-NULL            PIC S9(04)     COMP          06420000
060300                                                   VALUE ZERO.    06430000
060400 01      PV-MDSE-NM-CDE-NULL         PIC S9(04)     COMP          06440000
060500                                                   VALUE ZERO.    06450000
060600 01      PV-PROD-SERV-CDE-NULL       PIC S9(04)     COMP          06460000
060700                                                   VALUE ZERO.    06470000
060800 01      PV-OWNER-ID-NULL            PIC S9(04)     COMP          06480000
060900                                                   VALUE ZERO.    06490000
061000 01      PV-STAT-CHNG-DTE-NULL       PIC S9(04)     COMP          06500000
061100                                                   VALUE ZERO.    06510000
061200 01      PV-KOHLS-SIZE-CDE-NULL      PIC S9(04)     COMP          06520000
061300                                                   VALUE ZERO.    06530000
061400 01      PV-NRF-CLOR-CDE-NULL        PIC S9(04)     COMP          06540000
061500                                                   VALUE ZERO.    06550000
061600 01      PV-SIZE-DESC-NULL           PIC S9(04)     COMP          06560000
061700                                                   VALUE ZERO.    06570000
061800 01      PV-COLOR-DESC-NULL          PIC S9(04)     COMP          06580000
061900                                                   VALUE ZERO.    06590000
062000 01      PV-VNDR-INHOUSE-NBR-NULL    PIC S9(04)     COMP          06600000
062100                                                   VALUE ZERO.    06610000
062200 01      PV-VNDR-STYL-ID-NULL        PIC S9(04)     COMP          06620000
062300                                                   VALUE ZERO.    06630000
062400 01      PV-UNIT-RTL-AMT-NULL        PIC S9(04)     COMP          06640000
062500                                                   VALUE ZERO.    06650000
062600 01      PV-UNIT-RTL-UOM-CDE-NULL    PIC S9(04)     COMP          06660000
062700                                                   VALUE ZERO.    06670000
062800 01      PV-GRP-QTY-NULL             PIC S9(04)     COMP          06680000
062900                                                   VALUE ZERO.    06690000
063000 01      PV-GRP-RTL-AMT-NULL         PIC S9(04)     COMP          06700000
063100                                                   VALUE ZERO.    06710000
063200 01      PV-MDSEIT-ENT-ID            PIC  9(09).                  06720000
063300 01      PV-ENT-ID-NULL              PIC S9(04)     COMP          06730000
063400                                                   VALUE ZERO.    06740000
063500 01      PV-CHLD-CDE-NULL            PIC S9(04)     COMP          06750000
063600                                                   VALUE ZERO.    06760000
063700 01      PV-CHLD-ITM-UNT-QTY-NULL    PIC S9(04)     COMP          06770000
063800                                                   VALUE -1.      06780000
063900 01      PV-RMS-SKU-NULL             PIC S9(04)     COMP          06790000
064000                                                   VALUE ZERO.    06800000
064100*                                                                 06810000
064200******************************************************************06820000
064300*    VARIABLES FOR ORACLE DATA                                    06830000
064400*                                                                 06840000
064500 01  PV-TSK-STATUS-CDE          PIC S9(4)     COMP.               06850000
064600 01  PV-TSK-STATUS-CHNGD-DATE   PIC S9(8)     COMP.               06860000
064700 01  PV-TSK-VNDR-INHOUSE-NBR    PIC S9(4)     COMP.               06870000
064800 01  PV-TSK-GRP-QTY             PIC S9(4)     COMP.               06880000
064900 01  PV-HOLD-ITEM-ID            PIC S9(10)    COMP-3.             06890000
065000 01  PV-HOLD-DPT-SCL            PIC X(07)     VALUE SPACES.       06900000
065100 01  PC-N                       PIC X(01)     VALUE 'N'.          06910000
065200 01  PV-ZERO                    PIC S9(04)    COMP SYNC           06920000
065300                                                   VALUE 0.       06930000
065400 01  MDSEAR-CHG-DTE             PIC X(10)  VALUE SPACES.          06940000
065500 01  MDSEAR-CRE-DTE             PIC X(10)  VALUE SPACES.          06950000
065600                                                                  06960000
0822RM 01  PV-NEW-TMST-TEST           PIC X(19)      VALUE SPACES.      06961039
065700 01  PV-DUPGRP-TABLE.                                             06970000
065800     05  PV-DUPGRP-CLUSTER-ID   OCCURS 50 TIMES.                  06980000
065900         10  PV-GRP-CDE-CLUSTER-ID                                06990000
066000                                PIC S9(09)    COMP-3              07000000
066100                                              VALUE ZERO.         07010000
066200******************************************************************07020000
066300*     * COBOL DECLARATION FOR TABLE TITMCLC                       07030000
066400******************************************************************07040000
066500 01  DCLTITMCLC.                                                  07050000
066600     10 ITMCLC-PRNT-ITM-CLUSTR-ID  PIC S9(10) COMP-3              07060000
066700                                       VALUE ZEROES.              07070000
066800     10 ITMCLC-CHLD-ITM-CLUSTR-ID  PIC S9(10) COMP-3              07080000
066900                                       VALUE ZEROES.              07090000
067000     10 ITMCLC-REL-TYP-CDE         PIC X(01) VALUE SPACES.        07100000
067100     10 ITMCLC-EFF-BEG-TMST        PIC X(19) VALUE SPACES.        07110000
067200     10 ITMCLC-EFF-END-TMST        PIC X(19) VALUE SPACES.        07120000
067300     10 ITMCLC-CRE-BY-UID          PIC X(08) VALUE SPACES.        07130000
067400     10 ITMCLC-CRE-TMST            PIC X(19) VALUE SPACES.        07140000
067500     10 ITMCLC-LAST-UPD-BY-UID     PIC X(08) VALUE SPACES.        07150000
067600     10 ITMCLC-LAST-UPD-TMST       PIC X(19) VALUE SPACES.        07160000
067700     10 ITMCLC-CHLD-ITM-CLSTR-CDE  PIC X(01) VALUE SPACES.        07170000
067800     10 ITMCLC-CHLD-ITM-UNT-QTY    PIC S9(05) COMP-3              07180000
067900                                              VALUE ZEROES.       07190000
068000 01  DCLTITMCLC1.                                                 07200000
068100     10 ITMCLC1-PRNT-ITM-CLUSTR-ID  PIC S9(10) COMP-3             07210000
068200                                        VALUE ZEROES.             07220000
068300     10 ITMCLC1-CHLD-ITM-CLUSTR-ID  PIC S9(10) COMP-3             07230000
068400                                        VALUE ZEROES.             07240000
068500     10 ITMCLC1-REL-TYP-CDE         PIC X(01) VALUE SPACES.       07250000
068600     10 ITMCLC1-EFF-BEG-TMST        PIC X(19) VALUE SPACES.       07260000
068700     10 ITMCLC1-EFF-END-TMST        PIC X(19) VALUE SPACES.       07270000
068800     10 ITMCLC1-CRE-BY-UID          PIC X(08) VALUE SPACES.       07280000
068900     10 ITMCLC1-CRE-TMST            PIC X(19) VALUE SPACES.       07290000
069000     10 ITMCLC1-LAST-UPD-BY-UID     PIC X(08) VALUE SPACES.       07300000
069100     10 ITMCLC1-LAST-UPD-TMST       PIC X(19) VALUE SPACES.       07310000
069200     10 ITMCLC1-CHLD-ITM-CLSTR-CDE  PIC X(01) VALUE SPACES.       07320000
069300******************************************************************07330000
069400*     * THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 9  07340000
069500******************************************************************07350000
069600                                                                  07360000
069700******************************************************************07370000
069800*     * COBOL DECLARATION FOR TABLE TITMCLT                       07380000
069900******************************************************************07390000
070000 01  DCLTITMCLT.                                                  07400000
070100     10 ITMCLT-ITEM-CLUSTR-ID      PIC S9(10) COMP-3              07410000
070200                                       VALUE ZEROES.              07420000
070300     10 ITMCLT-ITEM-CLUSTR-NAME    PIC X(20) VALUE SPACES.        07430000
070400     10 ITMCLT-ITEM-CLUSTR-DESC    PIC X(40) VALUE SPACES.        07440000
070500     10 ITMCLT-EFF-BEG-TMST        PIC X(19) VALUE SPACES.        07450000
070600     10 ITMCLT-EFF-END-TMST        PIC X(19) VALUE SPACES.        07460000
070700     10 ITMCLT-CLUSTR-TYP-CDE      PIC X(01) VALUE SPACES.        07470000
070800     10 ITMCLT-HIER-TYP-CDE        PIC X(01) VALUE SPACES.        07480000
070900     10 ITMCLT-HIER-CDE            PIC X(03) VALUE SPACES.        07490000
071000     10 ITMCLT-ITEM-CLUSTR-CDE     PIC X(01) VALUE SPACES.        07500000
071100     10 ITMCLT-MDSE-NM-CDE         PIC X(01) VALUE SPACES.        07510000
071200     10 ITMCLT-PROD-SERV-CDE       PIC X(01) VALUE SPACES.        07520000
071300     10 ITMCLT-CRE-BY-UID          PIC X(08) VALUE SPACES.        07530000
071400     10 ITMCLT-CRE-TMST            PIC X(19) VALUE SPACES.        07540000
071500     10 ITMCLT-LAST-UPD-BY-UID     PIC X(08) VALUE SPACES.        07550000
071600     10 ITMCLT-LAST-UPD-TMST       PIC X(19) VALUE SPACES.        07560000
071700     10 ITMCLT-ARCH-DTE            PIC X(19) VALUE SPACES.        07570000
071800     10 ITMCLT-OWNER-ID            PIC S9(10) COMP-3              07580000
071900                                       VALUE ZEROES.              07590000
072000     10 ITMCLT-SKU                 PIC S9(08) COMP-3              07600000
072100                                       VALUE ZEROS.               07610000
072200                                                                  07620000
072300******************************************************************07630000
072400*     * THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 17 07640000
072500******************************************************************07650000
072600******************************************************************07660000
072700* COBOL DECLARATION FOR TABLE TMDSEIT                             07670000
072800******************************************************************07680000
072900 01  DCLTMDSEIT.                                                  07690000
073000     10 MDSEIT-ITEM-CLUSTR-ID      PIC S9(9) COMP                 07700000
073100                                       VALUE ZEROES.              07710000
073200     10 MDSEIT-STAT-CHNG-DTE       PIC X(19) VALUE SPACES.        07720000
073300     10 MDSEIT-STAT-CDE            PIC S9(3)V COMP-3              07730000
073400                                       VALUE ZEROES.              07740000
073500     10 MDSEIT-SIZE-DESC           PIC X(20) VALUE SPACES.        07750000
073600     10 MDSEIT-COLOR-DESC          PIC X(20) VALUE SPACES.        07760000
073700     10 MDSEIT-VNDR-INHOUSE-NBR    PIC S9(3)V COMP-3              07770000
073800                                       VALUE ZEROES.              07780000
073900     10 MDSEIT-VNDR-STYL-ID        PIC X(20) VALUE SPACES.        07790000
074000*    10 MDSEIT-UNIT-RTL-AMT        PIC S9(5)V9(2) COMP-3          07800000
074100     10 MDSEIT-UNIT-RTL-AMT        PIC X(10) VALUE SPACES.        07810000
074200     10 MDSEIT-UNIT-RTL-UOM-CDE    PIC X(04) VALUE SPACES.        07820000
074300     10 MDSEIT-GRP-QTY             PIC S9(3)V COMP-3              07830000
074400                                       VALUE ZEROES.              07840000
074500*    10 MDSEIT-GRP-RTL-AMT         PIC S9(5)V9(2) COMP-3          07850000
074600     10 MDSEIT-GRP-RTL-AMT         PIC X(10) VALUE SPACES.        07860000
074700     10 MDSEIT-ENT-ID              PIC S9(9) COMP                 07870000
074800                                       VALUE ZEROES.              07880000
074900     10 MDSEIT-KOHLS-SIZE-CDE      PIC S9(09) COMP VALUE ZERO.    07890000
075000     10 MDSEIT-NRF-CLOR-CDE        PIC X(03)       VALUE SPACES.  07900000
075100******************************************************************07910000
075200* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS  12     *07920000
075300******************************************************************07930000
075400                                                                  07940000
075500******************************************************************07950000
075600*     * COBOL DECLARATION FOR TABLE TSK                           07960000
075700******************************************************************07970000
075800 01  CLTSK.                                                       07980000
075900     10 TSK-SKU-NMBR.                                             07990000
076000        15 TSK-MERCH-DEPT-NMBR     PIC X(03) VALUE SPACES.        08000000
076100        15 TSK-MERCH-CLASS-NMBR    PIC X(02) VALUE SPACES.        08010000
076200        15 TSK-SEQ-NMBR            PIC X(03) VALUE SPACES.        08020000
076300     10 TSK-CUM-SALES-UNIT-QTY     PIC S9(7)V COMP-3              08030000
076400                                       VALUE ZEROES.              08040000
076500     10 TSK-RTL-UNIT-RCVD-QTY      PIC S9(7)V COMP-3              08050000
076600                                       VALUE ZEROES.              08060000
076700     10 TSK-COST-UNIT-MSRMNT       PIC X(04) VALUE SPACES.        08070000
076800     10 TSK-RTL-UNIT-MSRMNT        PIC X(04) VALUE SPACES.        08080000
076900     10 TSK-UNIT-COST-AMT          PIC S9(4)V9(3) COMP-3          08090000
077000                                       VALUE ZEROES.              08100000
077100     10 TSK-CUR-UNIT-RTL-AMT       PIC S9(5)V9(2) COMP-3          08110000
077200                                       VALUE ZEROES.              08120000
077300     10 TSK-ORIG-UNIT-RTL-AMT      PIC S9(5)V9(2) COMP-3          08130000
077400                                       VALUE ZEROES.              08140000
077500     10 TSK-VNDR-INNR-PACK-QTY     PIC S9(5)V COMP-3              08150000
077600                                       VALUE ZEROES.              08160000
077700     10 TSK-SHPMT-COUNT-QTY        PIC S9(3)V COMP-3              08170000
077800                                       VALUE ZEROES.              08180000
077900     10 TSK-VENDOR-STYLE-CODE      PIC X(15) VALUE SPACES.        08190000
078000     10 TSK-STAT-CHNGD-DATE        PIC S9(7)V COMP-3              08200000
078100                                       VALUE ZEROES.              08210000
078200     10 TSK-STATUS-CODE            PIC S9(3)V COMP-3              08220000
078300                                       VALUE ZEROES.              08230000
078400     10 TSK-AUTO-RORD-MTH-CODE     PIC X(01) VALUE SPACES.        08240000
078500     10 TSK-RTL-CST-CVRSN-FCTR     PIC S9(3)V COMP-3              08250000
078600                                       VALUE ZEROES.              08260000
078700     10 TSK-SETUP-DATE             PIC S9(7)V COMP-3              08270000
078800                                       VALUE ZEROES.              08280000
078900     10 TSK-PRICE-CHNG-DATE        PIC S9(7)V COMP-3              08290000
079000                                       VALUE ZEROES.              08300000
079100     10 TSK-GROUP-CODE             PIC X(03) VALUE SPACES.        08310000
079200     10 TSK-SKU-DESC               PIC X(25) VALUE SPACES.        08320000
079300     10 TSK-SIZE-DESC              PIC X(05) VALUE SPACES.        08330000
079400     10 TSK-COLOR-DESC             PIC X(04) VALUE SPACES.        08340000
079500     10 TSK-REORDER-FRMT-CODE      PIC X(01) VALUE SPACES.        08350000
079600     10 TSK-MERCH-DIV-CODE         PIC S9(1)V COMP-3              08360000
079700                                       VALUE ZEROES.              08370000
079800     10 TSK-DMM-NMBR               PIC S9(3)V COMP-3              08380000
079900                                       VALUE ZEROES.              08390000
080000     10 TSK-BUYER-NMBR             PIC S9(3)V COMP-3              08400000
080100                                       VALUE ZEROES.              08410000
080200     10 TSK-VENDOR-NMBR            PIC S9(5)V COMP-3              08420000
080300                                       VALUE ZEROES.              08430000
080400     10 TSK-VNDR-IN-HSE-NMBR       PIC S9(3)V COMP-3              08440000
080500                                       VALUE ZEROES.              08450000
080600     10 TSK-MKDN-PGM-CODE          PIC X(01) VALUE SPACES.        08460000
080700     10 TSK-LOWST-UNIT-RTL-AMT     PIC S9(5)V9(2) COMP-3          08470000
080800                                       VALUE ZEROES.              08480000
080900     10 TSK-LOW-RTL-PRICE-DATE     PIC S9(7)V COMP-3              08490000
081000                                       VALUE ZEROES.              08500000
081100     10 TSK-ITEM-NMBR              PIC S9(15)V COMP-3             08510000
081200                                       VALUE ZEROES.              08520000
081300     10 TSK-GP-RTL-AMT             PIC S9(5)V9(2) COMP-3          08530000
081400                                       VALUE ZEROES.              08540000
081500     10 TSK-ORIG-GP-QTY            PIC S9(3)V COMP-3              08550000
081600                                       VALUE ZEROES.              08560000
081700     10 TSK-ORIG-GP-RTL-AMT        PIC S9(5)V9(2) COMP-3          08570000
081800                                       VALUE ZEROES.              08580000
081900     10 TSK-FS-RPT-IND             PIC X(01) VALUE SPACES.        08590000
082000     10 TSK-GP-QTY                 PIC S9(3)V COMP-3              08600000
082100                                       VALUE ZEROES.              08610000
082200     10 TSK-MULT-PR-PT-IND         PIC X(01) VALUE SPACES.        08620000
082300     10 TSK-PLU-DWNLD-EXCL-IND     PIC X(01) VALUE SPACES.        08630000
082400     10 TSK-LAST-PO-REV-DTE        PIC X(10) VALUE SPACES.        08640000
082500     10 TSK-PO-REV-DAY-NBR         PIC S9(3)V COMP-3              08650000
082600                                       VALUE ZEROES.              08660000
082700     10 TSK-PO-REV-SUN-WK-NBR      PIC S9(1)V COMP-3              08670000
082800                                       VALUE ZEROES.              08680000
082900     10 TSK-PO-REV-MON-WK-NBR      PIC S9(1)V COMP-3              08690000
083000                                       VALUE ZEROES.              08700000
083100     10 TSK-PO-REV-TUE-WK-NBR      PIC S9(1)V COMP-3              08710000
083200                                       VALUE ZEROES.              08720000
083300     10 TSK-PO-REV-WED-WK-NBR      PIC S9(1)V COMP-3              08730000
083400                                       VALUE ZEROES.              08740000
083500     10 TSK-PO-REV-THU-WK-NBR      PIC S9(1)V COMP-3              08750000
083600                                       VALUE ZEROES.              08760000
083700     10 TSK-PO-REV-FRI-WK-NBR      PIC S9(1)V COMP-3              08770000
083800                                       VALUE ZEROES.              08780000
083900     10 TSK-PO-REV-SAT-WK-NBR      PIC S9(1)V COMP-3              08790000
084000                                       VALUE ZEROES.              08800000
084100     10 TSK-CENT-STK-CDE           PIC X(02) VALUE SPACES.        08810000
084200     10 TSK-MEITGP-NBR             PIC S9(9) COMP                 08820000
084300                                       VALUE ZEROES.              08830000
084400     10 TSK-SKU-TYP-CDE            PIC X(01) VALUE SPACES.        08840000
084500     10 TSK-VEND-OUTR-PACK-QTY     PIC S9(5)V COMP-3              08850000
084600                                       VALUE ZEROES.              08860000
084700     10 TSK-LONG-VENDOR-STYLE      PIC X(20) VALUE SPACES.        08870000
084800     10 TSK-SIZE-CDE               PIC X(05) VALUE SPACES.        08880000
084900     10 TSK-LONG-SIZE-DESC         PIC X(20) VALUE SPACES.        08890000
085000     10 TSK-COLOR-CDE              PIC X(03) VALUE SPACES.        08900000
085100     10 TSK-LONG-COLOR-DESC        PIC X(20) VALUE SPACES.        08910000
085200     10 TSK-STICKER-NBR            PIC X(03) VALUE SPACES.        08920000
085300     10 TSK-FLOOR-UNT-RTL-AMT      PIC S9(5)V9(2) COMP-3          08930000
085400                                       VALUE ZEROES.              08940000
085500     10 TSK-COMPR-UNT-RTL-AMT      PIC S9(5)V9(2) COMP-3          08950000
085600                                       VALUE ZEROES.              08960000
085700     10 TSK-FIR-UNT-COST-AMT       PIC S9(4)V9(3) COMP-3          08970000
085800                                       VALUE ZEROES.              08980000
085900     10 TSK-ORIG-UNT-COST-AMT      PIC S9(4)V9(3) COMP-3          08990000
086000                                       VALUE ZEROES.              09000000
086100     10 TSK-ENT-ID                 PIC S9(9) COMP                 09010000
086200                                       VALUE ZEROES.              09020000
086300     10 TSK-TKT-FMT-ID             PIC X(06) VALUE SPACES.        09030000
086400******************************************************************09040000
086500*     * THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS  6509050000
086600******************************************************************09060000
086700                                                                  09070000
086800                                                                  09080000
086900******************************************************************09090000
087000*     * COBOL DECLARATION FOR TABLE TMDSEAR                       09100000
087100******************************************************************09110000
087200 01  DCLTMDSEAR.                                                  09120000
087300     10 MDSEAR-OPERCO-NBR          PIC X(02) VALUE SPACES.        09130000
087400     10 MDSEAR-GMA-NBR             PIC X(02) VALUE SPACES.        09140000
087500     10 MDSEAR-DMA-NBR             PIC X(02) VALUE SPACES.        09150000
087600     10 MDSEAR-DEPT-NBR            PIC X(03) VALUE SPACES.        09160000
087700     10 MDSEAR-MAJ-CL-NBR          PIC X(02) VALUE SPACES.        09170000
087800     10 MDSEAR-SUB-CL-NBR          PIC X(03) VALUE SPACES.        09180000
087900     10 MDSEAR-MDSELV-CDE          PIC X(03) VALUE SPACES.        09190000
088000     10 MDSEAR-DKEY                PIC S999999V USAGE COMP-3.     09200000
088100     10 MDSEAR-CHG-DTE-TMST        PIC X(19) VALUE SPACES.        09210000
088200     10 MDSEAR-CRE-DTE-TMST        PIC X(19) VALUE SPACES.        09220000
088300     10 MDSEAR-STRT-DTE-TMST       PIC X(19) VALUE SPACES.        09230000
088400     10 MDSEAR-END-DTE-TMST        PIC X(19) VALUE SPACES.        09240000
088500     10 MDSEAR-GEN-MDSE-TYP-CDE    PIC X(01) VALUE SPACES.        09250000
088600     10 MDSEAR-DESC                PIC X(25) VALUE SPACES.        09260000
088700     10 MDSEAR-BYR-NBR             PIC X(03) VALUE SPACES.        09270000
088800     10 MDSEAR-LIST-SEQ-NBR        PIC S9(15)V USAGE COMP-3.      09280000
088900******************************************************************09290000
089000*     * THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 16 09300000
089100******************************************************************09310000
089200                                                                  09320000
089300******************************************************************09330000
089400* COBOL DECLARATION FOR TABLE TENTNME                            *09340000
089500******************************************************************09350000
089600 01  DCLTENTNME.                                                  09360000
089700     10 ENTNME-ENT-ID              PIC S9(9) USAGE COMP.          09370000
089800     10 ENTNME-SEQ-NBR             PIC S9(4) USAGE COMP.          09380000
089900     10 ENTNME-ENT-NAME-DESC       PIC X(30) VALUE SPACES.        09390000
090000     10 ENTNME-TYPE-CDE            PIC X(02) VALUE SPACES.        09400000
090100******************************************************************09410000
090200* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 4       *09420000
090300******************************************************************09430000
090400                                                                  09440000
090500******************************************************************09450000
090600* COBOL DECLARATION FOR TABLE TRPLCTL                             09460000
090700******************************************************************09470000
090800 01  DCLTRPLCTL.                                                  09480000
090900     10 RPLCTL-APPL-ID             PIC X(02) VALUE SPACES.        09490000
091000     10 RPLCTL-EXTR-PRC-ID         PIC X(08) VALUE SPACES.        09500000
091100     10 RPLCTL-LOG-TBL-NME         PIC X(10) VALUE SPACES.        09510000
091200     10 RPLCTL-EXTR-BEG-TMST       PIC X(26) VALUE SPACES.        09520000
091300     10 RPLCTL-EXTR-END-TMST       PIC X(26) VALUE SPACES.        09530000
091400******************************************************************09540000
091500* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS   5     *09550000
091600******************************************************************09560000
091700                                                                  09570000
091800******************************************************************09580000
091900* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS  13     *09590000
092000******************************************************************09600000
092100                                                                  09610000
092200                                                                  09620000
092300*_________________*                                               09630000
092400* SKU XREF TABLE  *                                               09640000
092500*_________________*                                               09650000
092600     EXEC SQL                                                     09660000
092700       INCLUDE TSKXREF                                            09670000
092800     END-EXEC.                                                    09680000
092900*                                                                 09690000
093000     EXEC SQL                                                     09700000
093100       INCLUDE TUPC                                               09710000
093200     END-EXEC.                                                    09720000
093300                                                                  09730000
093400     EXEC SQL END DECLARE SECTION END-EXEC.                       09740000
093500                                                                  09750000
093600     EXEC SQL                                                     09760000
093700         INCLUDE SQLCA                                            09770000
093800     END-EXEC.                                                    09780000
093900                                                                  09790000
094000* ORA COMMUNICATION AREA                                          09800000
094100                                                                  09810000
094200* 01       SQLCA.                                                 09820000
094300*          05  SQLCAID               PIC X(8).                    09830000
094400*          05  SQLCABC               PIC S9(9) COMPUTATIONAL.     09840000
094500*          05  SQLCODE               PIC S9(9) COMPUTATIONAL.     09850000
094600*          05  SQLERRM.                                           09860000
094700*              49 SQLERRML           PIC S9(4) COMPUTATIONAL.     09870000
094800*              49 SQLERRMC           PIC X(70).                   09880000
094900*          05  SQLERRP               PIC X(8).                    09890000
095000*          05  SQLERRD OCCURS 6 TIMES                             09900000
095100*                                    PIC S9(9) COMPUTATIONAL.     09910000
095200*          05  SQLWARN.                                           09920000
095300*              10 SQLWARN0           PIC X(1).                    09930000
095400*              10 SQLWARN1           PIC X(1).                    09940000
095500*              10 SQLWARN2           PIC X(1).                    09950000
095600*              10 SQLWARN3           PIC X(1).                    09960000
095700*              10 SQLWARN4           PIC X(1).                    09970000
095800*              10 SQLWARN5           PIC X(1).                    09980000
095900*              10 SQLWARN6           PIC X(1).                    09990000
096000*              10 SQLWARN7           PIC X(1).                    10000000
096100*          05  SQLEXT                PIC X(8).                    10010000
096200 EJECT                                                            10020000
096300     COPY SQLCA2.                                                 10030000
096400*                                                                 10040000
096500 EJECT                                                            10050000
096600                                                                  10060000
096700****************************************************************  10070000
096800 PROCEDURE DIVISION.                                              10080000
096900****************************************************************  10090000
097000****************************************************************  10100000
097100* A000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE  *  10110000
097200* PROGRAM.                                                     *  10120000
097300****************************************************************  10130000
097400*                                                                 10140000
097500 A000-PROGRAM-MAINLINE.                                           10150000
097600                                                                  10160000
097700     PERFORM A100-INITIAL.                                        10170000
097800                                                                  10180000
097900*    IF THIS IS A NORMAL RUN, DETERMINE IF MDSEAR SHOULD PROCESS. 10190000
098000*    NOTE: IF CC-MDSEAR-RUN IS USED, THEN THE TRPLCTL TABLE       10200000
098100*          PROCESSING IS BY-PASSED.                               10210000
098200     IF (CC-NORMAL-RUN)                                           10220000
098300         PERFORM H100-CHECK-TRPLCTL                               10230000
098400     END-IF.                                                      10240000
098500                                                                  10250000
0822RM     IF ((CC-NORMAL-RUN AND PS-MDSEAR-OK)                         10260015
0822RM     OR   CC-MDSEAR-RUN)                                          10270015
0822RM         DISPLAY '*****************************'                  10280015
0822RM         DISPLAY ' NORMAL RUN AND MDSEAR-OK    '                  10290015
0822RM         DISPLAY ' OR MDSEAR-RUN               '                  10300015
0822RM         DISPLAY ' CC-RUN-TYPE  ' CC-RUN-TYPE                     10310015
0822RM         DISPLAY ' PS-MDSEAR-OK-TO-PROCESS  '                     10320015
0822RM                   PS-MDSEAR-OK-TO-PROCESS                        10330015
0822RM         DISPLAY ' PROCESS MDSEAR CHANGES A300-PROCESS-MDSEAR'    10340015
0822RM         DISPLAY '*****************************'                  10350015
0822RM     END-IF.                                                      10360015
0822RM     IF (CC-NORMAL-RUN OR CC-SKURNBR-RUN)                         10370015
0822RM     AND PS-MDSEAR-NOT-OK                                         10380015
0822RM         DISPLAY '*****************************'                  10390015
0822RM         DISPLAY ' NORMAL RUN AND SKURNBR RUN  '                  10400015
0822RM         DISPLAY ' AND MDSEAR-NOT-OK           '                  10410015
0822RM         DISPLAY ' CC-RUN-TYPE  ' CC-RUN-TYPE                     10420015
0822RM         DISPLAY ' PS-MDSEAR-OK-TO-PROCESS  '                     10430015
0822RM                   PS-MDSEAR-OK-TO-PROCESS                        10440015
0822RM         DISPLAY '   PROCESS SKURNBR CHANGES '                    10450015
0822RM                    'E100-PROCESS-RENUMBERED-SKUS'                10460015
0822RM         DISPLAY '*****************************'                  10470015
0822RM     END-IF.                                                      10480015
0822RM     IF (CC-NORMAL-RUN OR CC-SKULOG-RUN)                          10490015
0822RM     AND PS-MDSEAR-NOT-OK                                         10500015
0822RM         DISPLAY '****************************'                   10510015
0822RM         DISPLAY ' NORMAL RUN OR SKULOG RUN    '                  10520015
0822RM         DISPLAY ' AND MDSEAR-NOT-OK           '                  10530015
0822RM         DISPLAY ' CC-RUN-TYPE  ' CC-RUN-TYPE                     10540015
0822RM         DISPLAY ' PS-MDSEAR-OK-TO-PROCESS  '                     10550015
0822RM                   PS-MDSEAR-OK-TO-PROCESS                        10560015
0822RM         DISPLAY '   PROCESS SKULOG CHANGES '                     10570015
0822RM                   ' E200-PROCESS-DAILY-SKU-CHANGES'              10580015
0822RM         DISPLAY '****************************'                   10590015
0822RM     END-IF.                                                      10600015
0822RM     IF (CC-NORMAL-RUN OR CC-WKSKDEL-RUN)                         10610015
0822RM     AND PS-MDSEAR-NOT-OK                                         10620015
0822RM         DISPLAY '********************************'               10630015
0822RM         DISPLAY ' NORMAL RUN OR SKUDELETE RUN   '                10640015
0822RM         DISPLAY ' AND MDSEAR-NOT-OK           '                  10650015
0822RM         DISPLAY ' CC-RUN-TYPE  ' CC-RUN-TYPE                     10660015
0822RM         DISPLAY ' PS-MDSEAR-OK-TO-PROCESS  '                     10670015
0822RM                   PS-MDSEAR-OK-TO-PROCESS                        10680015
0822RM         DISPLAY '   PROCESS WEEKLY SKU DELETES '                 10690015
0822RM                   ' E300-PROCESS-WKLY-SKU-DELETES '              10700015
0822RM         DISPLAY '********************************'               10710015
0822RM     END-IF.                                                      10720015
                                                                        10730015
098600     IF ((CC-NORMAL-RUN AND PS-MDSEAR-OK)                         10740000
098700     OR   CC-MDSEAR-RUN)                                          10750000
098800*        DISPLAY '*****************************'                  10760006
098900*        DISPLAY '   PROCESS TMDSEAR CHANGES'                     10770006
099000*        DISPLAY '*****************************'                  10780006
099100         PERFORM A300-PROCESS-MDSEAR                              10790000
099200     END-IF.                                                      10800000
099300                                                                  10810000
099400     IF (CC-NORMAL-RUN OR CC-SKURNBR-RUN)                         10820000
099500     AND PS-MDSEAR-NOT-OK                                         10830000
099600*        DISPLAY '*****************************'                  10840006
099700*        DISPLAY '   PROCESS SKURNBR CHANGES'                     10850006
099800*        DISPLAY '*****************************'                  10860006
099900         PERFORM E100-PROCESS-RENUMBERED-SKUS                     10870000
100000     END-IF.                                                      10880000
100100                                                                  10890000
100200     IF (CC-NORMAL-RUN OR CC-SKULOG-RUN)                          10900000
100300     AND PS-MDSEAR-NOT-OK                                         10910000
100400*        DISPLAY '****************************'                   10920006
100500*        DISPLAY '   PROCESS SKULOG CHANGES'                      10930006
100600*        DISPLAY '****************************'                   10940006
100700         PERFORM E200-PROCESS-DAILY-SKU-CHANGES                   10950000
100800     END-IF.                                                      10960000
100900                                                                  10970000
101000     IF (CC-NORMAL-RUN OR CC-WKSKDEL-RUN)                         10980000
101100     AND PS-MDSEAR-NOT-OK                                         10990000
101200*        DISPLAY '********************************'               11000006
101300*        DISPLAY '   PROCESS WEEKLY SKU DELETES'                  11010006
101400*        DISPLAY '********************************'               11020006
101500         PERFORM E300-PROCESS-WKLY-SKU-DELETES                    11030000
101600     END-IF.                                                      11040000
101700                                                                  11050000
101800     PERFORM A200-COMPLETE.                                       11060000
**TEMP*    DISPLAY 'TOT INS UPDATE B4 ADD ' PV-TOTAL-INS-UPD            11060127
0822RM     ADD PV-INS-UPD-COUNT TO PV-TOTAL-INS-UPD.                    11061025
**TEMP*    DISPLAY 'END INS-UPD-COUNT '  PV-INS-UPD-COUNT.              11062027
101900                                                                  11070000
**TEMP     DISPLAY ' WS-ROW-COUNT-CTR ' WS-ROW-COUNT-CTR.               11071035
102000     DISPLAY '**************************************************'.11080000
0822RM     DISPLAY ' DAILY RECORDS READ      : ' WS-DAILY-RECS-READ.    11090023
0822RM     DISPLAY ' DELETE RECORDS READ     : ' WS-DELETE-RECS-READ.   11090123
0822RM     DISPLAY ' RENUMBERED SKU READ     : ' PV-RENUMBER-READ.      11091023
0822RM     DISPLAY '**************************************************'.11092023
102200     DISPLAY ' CLUSTERS UPDATED        : ' PV-CLUSTER-UPDATED.    11100000
102300     DISPLAY ' RENUMBERED SKU INSERTED : ' PV-RENUMBER-INSERTED.  11110000
102400     DISPLAY ' RENUMBERED SKU EXPIRED  : ' PV-RENUMBER-EXPIRED.   11120000
102500     DISPLAY '**************************************************'.11130000
102600     DISPLAY '**************************************************'.11140000
102700     DISPLAY ' TMDSEAR RECORDS READ      : ' PV-TMDSEAR-COUNT.    11150000
102800     DISPLAY ' TMDSEAR RECORDS INSERTED  : ' PV-MDSEAR-INSERT.    11160000
102900     DISPLAY ' TMDSEAR RECORDS UPDATED   : ' PV-MDSEAR-UPDATE.    11170000
103000     DISPLAY '**************************************************'.11180000
0822RM     DISPLAY '**************************************************'.11190017
0822RM     DISPLAY ' TOTAL RECORDS INSERTED/UPDATED: '                  11200048
0822RM               PV-TOTAL-INS-UPD.                                  11210022
0822RM     DISPLAY '**************************************************'.11220017
103100                                                                  11230000
103200     STOP RUN.                                                    11240000
103300                                                                  11250000
103400     EJECT                                                        11260000
103500                                                                  11270000
103600                                                                  11280000
103700***************************************************************** 11290000
103800* A100-INITIAL.                                                 * 11300000
103900*                                                               * 11310000
104000*                                                               * 11320000
104100***************************************************************** 11330000
104200*                                                                 11340000
104300 A100-INITIAL.                                                    11350000
104400     MOVE 'A100-INITIAL' TO PV-ABEND-PARAGRAPH.                   11360000
104500     MOVE SPACES         TO PV-CALLING-PARA.                      11370000
104600     MOVE SPACES         TO PV-SKU-PROCESS-CODE.                  11380000
104700                                                                  11390000
104800****************************************************************  11400000
104900* LOGON                                                        *  11410000
105000****************************************************************  11420000
107900                                                                  11430000
107910     PERFORM A110-CONNECT-TO-ORACLE.                              11440001
107930                                                                  11450001
108000     EXEC SQL                                                     11460000
108100      ALTER SESSION                                               11470000
108200            SET NLS_DATE_FORMAT = 'YYYY-MM-DD.HH24.MI.SS'         11480000
108300     END-EXEC.                                                    11490000
108400                                                                  11500000
108500                                                                  11510000
108600     EXEC SQL                                                     11520000
108700      SELECT SYSDATE                                              11530000
108800      INTO :PV-CURRENT-TMST                                       11540000
108900      FROM DUAL                                                   11550000
109000     END-EXEC.                                                    11560000
109100                                                                  11570000
109200     DISPLAY 'SYSDATE = ' PV-CURRENT-TMST.                        11580000
109300     MOVE PV-CURRENT-TMST TO PV-CURRENT-TMST-NEW.                 11590000
109400                                                                  11600000
109500*                                                                 11610000
109600* CURSOR FOR TMDSEAR TABLE                                        11620000
109700*                                                                 11630000
109800*                                                                 11640000
109900     EXEC SQL                                                     11650000
110000       DECLARE MDSEARCSR CURSOR FOR                               11660000
110100         SELECT                                                   11670000
110200                 GMA_NBR,                                         11680000
110300                 DMA_NBR,                                         11690000
110400                 DEPT_NBR,                                        11700000
110500                 MAJ_CL_NBR,                                      11710000
110600                 SUB_CL_NBR,                                      11720000
110700                 MDSELV_CDE,                                      11730000
110800                 MDSEAR_DESC,                                     11740000
110900                 CRE_DTE,                                         11750000
111000                 CHG_DTE,                                         11760000
111100                 STRT_DTE,                                        11770000
111200                 END_DTE                                          11780000
111300         FROM TMDSEAR                                             11790000
111400         WHERE   OPERCO_NBR   =  '03'                             11800000
111500         AND     MDSELV_CDE <> 'CO'                               11810000
111600         AND   ( CRE_DTE      = :PV-INPUT-DTE OR                  11820000
111700                 CHG_DTE      = :PV-INPUT-DTE)                    11830000
111800         ORDER BY STRT_DTE,                                       11840000
111900                  GMA_NBR,                                        11850000
112000                  DMA_NBR,                                        11860000
112100                  DEPT_NBR,                                       11870000
112200                  MAJ_CL_NBR,                                     11880000
112300                  SUB_CL_NBR                                      11890000
112400     END-EXEC.                                                    11900000
112500/                                                                 11910000
112600*                                                                 11920000
112700*                                                                 11930000
112800* CURSOR FOR TITMCLT TABLE                                        11940000
112900*                                                                 11950000
113000*                                                                 11960000
113100     EXEC SQL                                                     11970000
113200       DECLARE PRNTCSR  CURSOR FOR                                11980000
113300         SELECT B.CHLD_ITM_CLUSTR_ID,                             11990000
113400                B.PRNT_ITM_CLUSTR_ID                              12000000
113500         FROM   TITMCLT A,                                        12010000
113600                TITMCLC B                                         12020000
113700         WHERE  A.ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME     12030000
113800         AND    A.HIER_CDE        IS NULL                         12040000
113900         AND    B.REL_TYP_CDE     =  'M'                          12050000
114000         AND    A.CRE_TMST         < :PV-CURRENT-TMST             12060000
114100         AND    A.ITEM_CLUSTR_ID   = B.CHLD_ITM_CLUSTR_ID         12070000
114200     END-EXEC.                                                    12080000
114300/                                                                 12090000
114400*                                                                 12100000
114500*                                                                 12110000
114600* CURSOR FOR TITMCLT TABLE                                        12120000
114700*                                                                 12130000
114800*                                                                 12140000
114900     EXEC SQL                                                     12150000
115000       DECLARE PRNTCSR1 CURSOR FOR                                12160000
115100         SELECT B.CHLD_ITM_CLUSTR_ID,                             12170000
115200                B.PRNT_ITM_CLUSTR_ID                              12180000
115300         FROM   TITMCLT A,                                        12190000
115400                TITMCLC B                                         12200000
115500         WHERE  A.ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME     12210000
115600         AND    A.HIER_CDE         = :ITMCLT-HIER-CDE             12220000
115700         AND    B.REL_TYP_CDE      = 'M'                          12230000
115800         AND    A.CRE_TMST         < :PV-CURRENT-TMST             12240000
115900         AND    A.ITEM_CLUSTR_ID   = B.CHLD_ITM_CLUSTR_ID         12250000
116000     END-EXEC.                                                    12260000
116100/                                                                 12270000
116200*                                                                 12280000
116300*                                                                 12290000
116400* CURSOR FOR TITMCLT TABLE                                        12300000
116500*                                                                 12310000
116600*   THIS CURSOR IS USED ONLY TO EXPIRE PARENT RELATIONSHIPS       12320000
116700*        SO MAKE SURE YOU'RE ONLY SELECTING OPEN RELATIONSHIPS    12330000
116800*        OF OPEN ITEMS.                                           12340000
116900     EXEC SQL                                                     12350000
117000       DECLARE PRNTSKU      CURSOR FOR                            12360000
117100         SELECT B.CHLD_ITM_CLUSTR_ID,                             12370000
117200                B.PRNT_ITM_CLUSTR_ID                              12380000
117300         FROM   TITMCLT A,                                        12390000
117400                TITMCLC B                                         12400000
117500         WHERE  A.ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME     12410000
117600         AND    A.HIER_CDE        IS NULL                         12420000
117700         AND    A.ITEM_CLUSTR_CDE = 'I'                           12430000
117800         AND    B.REL_TYP_CDE     =  'M'                          12440000
117900         AND    A.ITEM_CLUSTR_ID   = B.CHLD_ITM_CLUSTR_ID         12450000
118000         AND  ( A.EFF_END_TMST IS NULL                            12460000
118100                  OR A.EFF_END_TMST > :PV-CURR-END-TMST )         12470000
118200         AND  ( B.EFF_END_TMST IS NULL                            12480000
118300                  OR B.EFF_END_TMST > :PV-CURR-END-TMST )         12490000
118400     END-EXEC.                                                    12500000
118500/                                                                 12510000
118600*                                                                 12520000
118700*                                                                 12530000
118800* CURSOR FOR TITMCLT TABLE                                        12540000
118900*                                                                 12550000
119000*                                                                 12560000
119100     EXEC SQL                                                     12570000
119200       DECLARE CHILDCSR CURSOR FOR                                12580000
119300*     SELECT /*+ FULL (A) */                                      12590000
119400*     SELECT /*+ INDEX(A IITMCLT0) */                             12600000
119500      SELECT                                                      12610000
119600             B.CHLD_ITM_CLUSTR_ID                                 12620000
119700      FROM   TITMCLT A,                                           12630000
119800             TITMCLC B                                            12640000
119900      WHERE (A.EFF_END_TMST     BETWEEN :PV-INPUT-BEG-TMST        12650000
120000                                AND     :PV-INPUT-END-TMST)       12660000
120100      AND    B.PRNT_ITM_CLUSTR_ID    = A.ITEM_CLUSTR_ID           12670000
120200      AND    B.REL_TYP_CDE           =  'M'                       12680000
120300      AND    B.CHLD_ITM_CLUSTR_ID  IN                             12690000
120400                     ( SELECT C.ITEM_CLUSTR_ID                    12700000
120500                       FROM   TITMCLT C                           12710000
120600                       WHERE C.EFF_END_TMST > :PV-INPUT-END-TMST) 12720000
120700     END-EXEC.                                                    12730000
120800                                                                  12740000
120900/                                                                 12750000
121000* CURSOR FOR TSK RENUMBER TABLE                                   12760000
121100*                                                                 12770000
121200*                                                                 12780000
121300*                                                                 12790000
121400     EXEC SQL                                                     12800000
121500       DECLARE   UPDCSR CURSOR FOR                                12810000
121600       SELECT                                                     12820000
121700          PRNT_ITM_CLUSTR_ID,                                     12830000
121800          CHLD_ITM_CLUSTR_ID                                      12840000
121900       FROM   TITMCLC                                             12850000
122000       WHERE                                                      12860000
122100             PRNT_ITM_CLUSTR_ID  = :PV-SKU-ID                     12870000
122200        AND  REL_TYP_CDE         = 'R'                            12880000
122300     END-EXEC.                                                    12890000
122400/                                                                 12900000
122500*                                                                 12910000
122600* CURSOR FOR TMDSEAR TABLE                                        12920000
122700* AS001-CURSOR FOR CHANGE DATE                                    12930000
122800*                                                                 12940000
122900     EXEC SQL                                                     12950000
123000       DECLARE MDSCHG CURSOR FOR                                  12960000
123100         SELECT                                                   12970000
123200                 GMA_NBR,                                         12980000
123300                 DMA_NBR,                                         12990000
123400                 DEPT_NBR,                                        13000000
123500                 MAJ_CL_NBR,                                      13010000
123600                 SUB_CL_NBR,                                      13020000
123700                 MDSELV_CDE,                                      13030000
123800                 CHG_DTE                                          13040000
123900         FROM TMDSEAR                                             13050000
124000         WHERE   OPERCO_NBR   =  '03'                             13060000
124100         AND     MDSELV_CDE <> 'CO'                               13070000
124200         AND     DEPT_NBR= :MDSEAR-DEPT-NBR                       13080000
124300         AND     MAJ_CL_NBR=:MDSEAR-MAJ-CL-NBR                    13090000
124400         AND     SUB_CL_NBR=:MDSEAR-SUB-CL-NBR                    13100000
124500         AND     MDSELV_CDE=:MDSEAR-MDSELV-CDE                    13110000
124600         ORDER BY                                                 13120000
124700                  GMA_NBR,                                        13130000
124800                  DMA_NBR,                                        13140000
124900                  DEPT_NBR,                                       13150000
125000                  MAJ_CL_NBR,                                     13160000
125100                  SUB_CL_NBR                                      13170000
125200     END-EXEC.                                                    13180000
125300/                                                                 13190000
125400*                                                                 13200000
125500* THE CURSOR FOR TMSDEAR                                          13210000
125600* AS001- MDSCRE CUSOR                                             13220000
125700*                                                                 13230000
125800     EXEC SQL                                                     13240000
125900       DECLARE MDSCRE CURSOR FOR                                  13250000
126000         SELECT                                                   13260000
126100                 GMA_NBR,                                         13270000
126200                 DMA_NBR,                                         13280000
126300                 DEPT_NBR,                                        13290000
126400                 MAJ_CL_NBR,                                      13300000
126500                 SUB_CL_NBR,                                      13310000
126600                 MDSELV_CDE,                                      13320000
126700                 CRE_DTE                                          13330000
126800         FROM TMDSEAR                                             13340000
126900         WHERE   OPERCO_NBR   =  '03'                             13350000
127000         AND     MDSELV_CDE <> 'CO'                               13360000
127100         AND     DEPT_NBR= :MDSEAR-DEPT-NBR                       13370000
127200         AND     MAJ_CL_NBR=:MDSEAR-MAJ-CL-NBR                    13380000
127300         AND     SUB_CL_NBR=:MDSEAR-SUB-CL-NBR                    13390000
127400         AND     MDSELV_CDE=:MDSEAR-MDSELV-CDE                    13400000
127500         ORDER BY                                                 13410000
127600                  GMA_NBR,                                        13420000
127700                  DMA_NBR,                                        13430000
127800                  DEPT_NBR,                                       13440000
127900                  MAJ_CL_NBR,                                     13450000
128000                  SUB_CL_NBR                                      13460000
128100     END-EXEC.                                                    13470000
128200/                                                                 13480000
128300                                                                  13490000
128400     EXEC SQL                                                     13500000
128500       DECLARE VSTCSR CURSOR FOR                                  13510000
128600         SELECT /*+ INDEX(A IITMCLT1) */                          13520000
128700                ITEM_CLUSTR_ID,                                   13530000
128800                ITEM_CLUSTR_DESC,                                 13540000
128900                EFF_BEG_TMST,                                     13550000
129000                EFF_END_TMST                                      13560000
129100         FROM   TITMCLT A                                         13570000
129200         WHERE                                                    13580000
129300                ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME       13590000
129400         AND    HIER_CDE         = :ITMCLT-HIER-CDE               13600000
129500         AND    OWNER_ID         = :ITMCLT-OWNER-ID               13610000
129600         AND  ((EFF_END_TMST IS NULL) OR                          13620000
129700               (EFF_END_TMST > :PV-CURR-END-TMST))                13630000
129800         AND EXISTS                                               13640000
129900             (SELECT CHLD_ITM_CLUSTR_ID                           13650000
130000              FROM   TITMCLC                                      13660000
130100              WHERE                                               13670000
130200                  PRNT_ITM_CLUSTR_ID = :PV-VND-PRNT-CLUSTR-ID     13680000
130300              AND CHLD_ITM_CLUSTR_ID = A.ITEM_CLUSTR_ID           13690000
130400              AND REL_TYP_CDE        = 'M'                        13700000
130500              AND  ((EFF_END_TMST IS NULL) OR                     13710000
130600                    (EFF_END_TMST > :PV-CURR-END-TMST)))          13720000
130700     END-EXEC.                                                    13730000
130800/                                                                 13740000
130900                                                                  13750000
131000     EXEC SQL                                                     13760000
131100       DECLARE DUPGRPCSR CURSOR FOR                               13770000
131200         SELECT                                                   13780000
131300                A.ITEM_CLUSTR_ID                                  13790000
131400         FROM   TITMCLT A,                                        13800000
131500                TITMCLC B                                         13810000
131600         WHERE  A.HIER_CDE = 'GRP'                                13820000
131700         AND    B.PRNT_ITM_CLUSTR_ID = A.ITEM_CLUSTR_ID           13830000
131800         AND    B.CHLD_ITM_CLUSTR_ID = :PV-SKU-CHLD-CLUSTR-ID     13840000
131900         AND    B.REL_TYP_CDE = 'M'                               13850000
132000         AND   (B.EFF_END_TMST IS NULL OR                         13860000
132100                B.EFF_END_TMST > :PV-CURR-END-TMST)               13870000
132200     END-EXEC.                                                    13880000
132300/                                                                 13890000
132400     EXEC SQL                                                     13900000
132500       DECLARE NISKUPRNT CURSOR FOR                               13910000
132600         SELECT                                                   13920000
132700                B.CHLD_ITM_CLUSTR_ID,                             13930000
132800                B.PRNT_ITM_CLUSTR_ID                              13940000
132900         FROM   TITMCLT A,                                        13950000
133000                TITMCLC B                                         13960000
133100         WHERE  A.SKU         = :PV-ITMCLT-SKU                    13970000
133200         AND    B.REL_TYP_CDE = 'M'                               13980000
133300         AND    A.ITEM_CLUSTR_ID   = B.CHLD_ITM_CLUSTR_ID         13990000
133400         AND  ( A.EFF_END_TMST IS NULL                            14000000
133500                  OR A.EFF_END_TMST > :PV-CURR-END-TMST )         14010000
133600         AND  ( B.EFF_END_TMST IS NULL                            14020000
133700                  OR B.EFF_END_TMST > :PV-CURR-END-TMST )         14030000
133800     END-EXEC.                                                    14040000
133900/                                                                 14050000
134000                                                                  14060000
134100     OPEN INPUT  DAILY-CHANGES-FILE                               14070000
134200                 WEEKLY-SKU-DELETES-FILE                          14080000
134300                 SKU-REN-EXTRACT-FILE.                            14090000
134400                                                                  14100000
134500     ACCEPT PV-JULIAN-DATE   FROM DAY.                            14110000
134600     ACCEPT CD-CPU-DATE      FROM DATE.                           14120000
134700     ACCEPT CT-CPU-TIME      FROM TIME.                           14130000
134800                                                                  14140000
134900     IF CD-CPU-YR < 80                                            14150000
135000        MOVE '20' TO WS-TS-CC                                     14160000
135100     ELSE                                                         14170000
135200        MOVE '19'         TO WS-TS-CC                             14180000
135300     END-IF.                                                      14190000
135400                                                                  14200000
135500     MOVE CD-CPU-YR    TO WS-TS-YY.                               14210000
135600     MOVE CD-CPU-MO    TO WS-TS-MO.                               14220000
135700     MOVE CD-CPU-DD    TO WS-TS-DD.                               14230000
135800     MOVE CT-CPU-HH    TO WS-TS-HH.                               14240000
135900     MOVE CT-CPU-MM    TO WS-TS-MM.                               14250000
136000     MOVE CT-CPU-SS    TO WS-TS-SS.                               14260000
136100     MOVE ZERO         TO WS-TS-MS.                               14270000
136200     MOVE   PV-JULIAN-DATE  TO PV-WORK-JULIAN-DATE.               14280000
136300     MOVE   PV-WORK-JULIAN-DATE  TO                               14290000
136400                               PV-CURRENT-JULIAN-DATE.            14300000
136500                                                                  14310000
136600     IF CD-CPU-YR < 80                                            14320000
136700         STRING  '20'                DELIMITED BY SIZE            14330000
136800                 CD-CPU-YR           DELIMITED BY SIZE            14340000
136900                 '-'                 DELIMITED BY SIZE            14350000
137000                 CD-CPU-MO           DELIMITED BY SIZE            14360000
137100                 '-'                 DELIMITED BY SIZE            14370000
137200                 CD-CPU-DD           DELIMITED BY SIZE            14380000
137300                                   INTO  PV-CURRENT-DATE          14390000
137400     ELSE                                                         14400000
137500         STRING  '19'                DELIMITED BY SIZE            14410000
137600                 CD-CPU-YR           DELIMITED BY SIZE            14420000
137700                 '-'                 DELIMITED BY SIZE            14430000
137800                 CD-CPU-MO           DELIMITED BY SIZE            14440000
137900                 '-'                 DELIMITED BY SIZE            14450000
138000                 CD-CPU-DD           DELIMITED BY SIZE            14460000
138100                                   INTO  PV-CURRENT-DATE          14470000
138200     END-IF.                                                      14480000
138300     MOVE PV-INITIAL-END-TMST  TO PV-CURR-END-TMST.               14490000
138400     MOVE PV-CURRENT-DATE      TO PV-CURR-END-TMST(1:10).         14500000
138500                                                                  14510000
138600     ACCEPT CC-CONTROL-CARD.                                      14520000
138700     DISPLAY 'CC-CONTROL-CARD:' CC-CONTROL-CARD.                  14530000
138800                                                                  14540000
138900     IF CC-PGMNAME NOT = PC-PGMNAME                               14550000
139000         DISPLAY PC-PGMNAME '- CONTROL CARD PROGRAM NAME ERROR : '14560000
139100                  CC-CONTROL-CARD                                 14570000
139200         MOVE +4001 TO PV-ABEND-CODE                              14580000
139300         CALL 'ILBOABN0' USING PV-ABEND-CODE                      14590000
139400     END-IF.                                                      14600000
139500     IF NOT (CC-NORMAL-RUN OR                                     14610000
139600             CC-MDSEAR-RUN OR                                     14620000
139700             CC-SKULOG-RUN OR                                     14630000
139800             CC-SKURNBR-RUN OR                                    14640000
139900             CC-WKSKDEL-RUN)                                      14650000
140000                                                                  14660000
140100         DISPLAY PC-PGMNAME '- CONTROL CARD RUN TYPE ERROR : '    14670000
140200                  CC-CONTROL-CARD                                 14680000
140300         MOVE +4002 TO PV-ABEND-CODE                              14690000
140400         CALL 'ILBOABN0' USING PV-ABEND-CODE                      14700000
140500     END-IF.                                                      14710000
140600     IF NOT (CC-INPDD-YYYY IS NUMERIC                             14720000
140700             AND CC-INPDD-MM IS NUMERIC                           14730000
140800             AND CC-INPDD-DD IS NUMERIC                           14740000
140900             AND CC-INPDD-HYP1 = '-'                              14750000
141000             AND CC-INPDD-HYP2 = '-')                             14760000
141100         DISPLAY PC-PGMNAME                                       14770000
141200                 '- CONTROL CARD INPUT DATA DATE ERROR : '        14780000
141300                  CC-CONTROL-CARD                                 14790000
141400         MOVE +4003 TO PV-ABEND-CODE                              14800000
141500         CALL 'ILBOABN0' USING PV-ABEND-CODE                      14810000
141600     ELSE                                                         14820000
141700         MOVE CC-INPUT-DATA-DATE TO PV-INPUT-DTE                  14830000
141800     END-IF.                                                      14840000
141900                                                                  14850000
142000     DISPLAY 'ORAMA102 - INPUT DATA DATE: ' PV-INPUT-DTE.         14860000
142100**                                                                14870000
142200     MOVE PV-INITIAL-STRT-TMST TO PV-CURR-STRT-TMST.              14880000
142300     MOVE PV-INPUT-DTE         TO PV-CURR-STRT-TMST(1:10).        14890000
142400     DISPLAY 'PV-CURR-STRT-TMST' PV-CURR-STRT-TMST.               14900000
142500**                                                                14910000
142600     MOVE PV-INITIAL-STRT-TMST TO PV-INPUT-BEG-TMST.              14920000
142700     MOVE PV-INPUT-DTE         TO PV-INPUT-BEG-TMST(1:10).        14930000
142800                                                                  14940000
142900     MOVE PV-INITIAL-END-TMST  TO PV-INPUT-END-TMST.              14950000
143000     MOVE PV-INPUT-DTE         TO PV-INPUT-END-TMST(1:10).        14960000
143100                                                                  14970000
143110****************************************************************  14980001
143120*   CONNECT TO THE APPROPRIATE ORACLE SERVER.                  *  14990001
143130****************************************************************  15000001
143140 A110-CONNECT-TO-ORACLE.                                          15010001
143150                                                                  15020001
143160                                                                  15030001
143170     OPEN INPUT ORACLE-LOGON-FILE.                                15040001
143180                                                                  15050001
143190     PERFORM A120-READ-ORACLE-LOGON.                              15060001
143191                                                                  15070001
143192     CLOSE ORACLE-LOGON-FILE.                                     15080001
143193                                                                  15090001
143194     IF ((PS-END-OF-LOGON-FILE)                                   15100001
143195             OR (CC-ORACLE-CONNECTION = SPACES))                  15110001
143196         DISPLAY '** ABEND **'                                    15120001
143197         DISPLAY 'MAKUT102 - ORACLE LOGON CONTROL CARD '          15130002
143198                   'NOT PROVIDED'                                 15140001
143199         SET PS-ORA-SRC-EMPTY TO TRUE                             15150001
143200         CALL 'ILBOABN0' USING PV-ABEND-CODE                      15160001
143201     END-IF.                                                      15170001
143202                                                                  15180001
143203     IF CC-AUTO-LOGON                                             15190001
143204         DISPLAY 'MAKUT102 - AUTO LOGON TO ORACLE'                15200002
143205         EXEC SQL                                                 15210001
143206              CONNECT :USERNAME                                   15220001
143207         END-EXEC                                                 15230001
143208     ELSE                                                         15240001
143209         INITIALIZE PV-ORACLE-USERID-LEN                          15250001
143210                    PV-ORACLE-PASSWORD-LEN                        15260001
143211         INSPECT CC-ORACLE-USERID                                 15270001
143212             TALLYING PV-ORACLE-USERID-LEN                        15280001
143213          FOR CHARACTERS BEFORE INITIAL SPACE                     15290001
143214      INSPECT CC-ORACLE-PASSWORD                                  15300001
143215          TALLYING PV-ORACLE-PASSWORD-LEN                         15310001
143216          FOR CHARACTERS BEFORE INITIAL SPACE                     15320001
143217      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           15330001
143218                USERNAME-ARR                                      15340001
143219      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   15350001
143220      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       15360001
143221                PASSWD-ARR                                        15370001
143222      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   15380001
143223      DISPLAY 'MAKUT102 - LOGON TO ORACLE AS USER '               15390003
143224                USERNAME-ARR                                      15400001
143225      EXEC SQL                                                    15410001
143226        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   15420001
143227      END-EXEC                                                    15430001
143228      INITIALIZE CC-ORACLE-PASSWORD                               15440001
143229                 PASSWD                                           15450001
143230      END-IF.                                                     15460001
143231                                                                  15470001
143232     IF (SQLCODE NOT = 0)                                         15480001
143233         DISPLAY PV-ABEND-PARAGRAPH                               15490001
143234         DISPLAY 'MAKUT102 - ERROR LOGGING ON TO ORACLE'          15500003
143235         PERFORM Z999-SQL-ERROR                                   15510001
143236     END-IF.                                                      15520001
143237                                                                  15530001
143240****************************************************************  15540001
143241** READ THE ORACLE LOGON CONTROL CARD.                        **  15550001
143242****************************************************************  15560001
143243 A120-READ-ORACLE-LOGON.                                          15570001
143244                                                                  15580001
143245     READ ORACLE-LOGON-FILE                                       15590001
143246         INTO CC-ORACLE-CONNECTION                                15600001
143247         AT END                                                   15610001
143248             SET PS-END-OF-LOGON-FILE TO TRUE                     15620001
143249     END-READ.                                                    15630001
143250                                                                  15640001
143260***************************************************************** 15650000
143300* A200-COMPLETE                                                 * 15660000
143400*                                                               * 15670000
143500*                                                               * 15680000
143600***************************************************************** 15690000
143700*                                                                 15700000
143800 A200-COMPLETE.                                                   15710000
143900     MOVE 'A200-COMPLETE' TO PV-ABEND-PARAGRAPH.                  15720000
144000                                                                  15730000
144100     CLOSE       DAILY-CHANGES-FILE                               15740000
144200                 WEEKLY-SKU-DELETES-FILE                          15750000
144300                 SKU-REN-EXTRACT-FILE.                            15760000
144400*                                                                 15770000
144500     EXEC SQL                                                     15780000
144600       COMMIT RELEASE                                             15790000
144700     END-EXEC.                                                    15800000
144800*                                                                 15810000
144900*    EXEC SQL                                                     15820000
145000*      ROLLBACK RELEASE                                           15830000
145100*    END-EXEC.                                                    15840000
145200                                                                  15850000
145300     IF SQLCODE NOT = ZERO                                        15861029
145400         MOVE SQLCODE TO SQLCODE2                                 15900009
145500         MOVE SQLERRD(3) TO SQLERRD3                              15910009
145600         DISPLAY '** ABEND **       ** = SQLERROR'                15920009
145700         DISPLAY '** PROGRAM        ** = MAKUT102'                15930009
145800         DISPLAY '** SQLCODE        ** = ' SQLCODE2               15940009
145900         DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3               15950009
146000         DISPLAY '** SQLERRM        ** = ' SQLERRM                15960009
146100         DISPLAY '** SQLERRMC       ** = ' SQLERRMC               15970009
146200                                                                  15980000
146300         MOVE SPACES TO WS-MSG-TEXT                               15990009
146400*        GET FULL TEXT OF ERROR MESSAGE                           16000009
146500                                                                  16010000
146600         CALL 'SQLGLM' USING WS-MSG-TEXT,                         16020009
146700                             WS-MAX-SIZE,                         16030009
146800                             WS-MSG-LENGTH                        16040009
146900         DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT            16050009
147000     END-IF.                                                      16060000
147100                                                                  16070000
147200***************************************************************** 16080000
147300* PROCESS CHANGES TO TSK. USES 3 SOURCES:                       * 16090000
147400*              MARD025   TSKURNMBR EXTRACT FILE     (FOR E100), * 16100000
147500*                        DAILY SKU CHANGES LOG FILE (FOR E200), * 16110000
147600*                        WEEKLY SKU DELETES FILE    (FOR E300)  * 16120000
147700*                                                               * 16130000
147800***************************************************************** 16140000
147900  A300-PROCESS-MDSEAR.                                            16150000
148000                                                                  16160000
148100     PERFORM B100-OPEN-TMDSEAR-CURSOR.                            16170000
148200                                                                  16180000
148300     PERFORM C000-FETCH-TMDSEAR-CURSOR.                           16190000
148400                                                                  16200000
148500                                                                  16210000
148600     PERFORM B200-PROCESS-CLUSTERS                                16220000
148700       UNTIL PS-NO-MORE-CLUSTERS-LEFT.                            16230000
148800                                                                  16240016
148900                                                                  16250000
149000     PERFORM B300-CLOSE-TMDSEAR-CURSOR.                           16260000
149100                                                                  16270000
149200                                                                  16280000
149300     PERFORM C800-EXPIRE-CHILDREN.                                16290000
149400                                                                  16300000
149500                                                                  16310000
149600                                                                  16320000
149700***************************************************************** 16330000
149800* B100-OPEN-TMDSEAR-CURSOR.                                     * 16340000
149900*                                                               * 16350000
150000*                                                               * 16360000
150100***************************************************************** 16370000
150200*                                                                 16380000
150300 B100-OPEN-TMDSEAR-CURSOR.                                        16390000
150400     MOVE 'B100-OPEN-TMDSEAR-CURSOR' TO PV-ABEND-PARAGRAPH.       16400000
150500                                                                  16410000
150600                                                                  16420000
150700     EXEC SQL                                                     16430000
150800         OPEN  MDSEARCSR                                          16440000
150900     END-EXEC.                                                    16450000
151000                                                                  16460000
151100     EVALUATE TRUE                                                16470000
151200       WHEN SQLCODE = ZEROS                                       16480000
151300         CONTINUE                                                 16490000
151400       WHEN SQLCODE = 1403                                        16500000
151500         SET PS-NO-MORE-CLUSTERS-LEFT TO TRUE                     16510000
151600         CONTINUE                                                 16520000
151700       WHEN OTHER                                                 16530000
151800         DISPLAY PV-ABEND-PARAGRAPH                               16540000
151900         PERFORM Z999-SQL-ERROR                                   16550000
152000     END-EVALUATE.                                                16560000
152100                                                                  16570000
152200                                                                  16580000
152300                                                                  16590000
152400     EJECT                                                        16600000
152500                                                                  16610000
152600***************************************************************** 16620000
152700*                                                               * 16630000
152800***************************************************************** 16640000
152900  B105-GET-PARENT-CORP.                                           16650000
153000                                                                  16660000
153100       MOVE  SPACES          TO    ITMCLT-ITEM-CLUSTR-NAME.       16670000
153200       MOVE 'CORP'           TO    ITMCLT-ITEM-CLUSTR-NAME.       16680000
153300       MOVE 'CO'             TO    ITMCLT-HIER-CDE.               16690000
153400       MOVE ZEROES           TO    PV-HIER-CDE-NULL.              16700000
153500                                                                  16710000
153600       PERFORM  D100-GET-CLUSTR-ID.                               16720000
153700                                                                  16730000
153800       MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-CORP-PRNT-CLUSTR-ID.      16740000
153900                                                                  16750000
154000                                                                  16760000
154100***************************************************************** 16770000
154200*                                                               * 16780000
154300***************************************************************** 16790000
154400  B110-GET-PARENT-GMA.                                            16800000
154500*      DISPLAY 'B110-GET-PARENT-GMA'.                             16810006
154600       MOVE  SPACES            TO ITMCLT-ITEM-CLUSTR-NAME.        16820000
154700       MOVE MDSEAR-GMA-NBR   TO    ITMCLT-ITEM-CLUSTR-NAME.       16830000
154800       MOVE 'GMA'            TO    ITMCLT-HIER-CDE.               16840000
154900       MOVE ZEROES           TO    PV-HIER-CDE-NULL.              16850000
155000                                                                  16860000
155100       PERFORM  D100-GET-CLUSTR-ID.                               16870000
155200                                                                  16880000
155300       MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-GMA-PRNT-CLUSTR-ID.       16890000
155400                                                                  16900000
155500                                                                  16910000
155600***************************************************************** 16920000
155700*                                                               * 16930000
155800***************************************************************** 16940000
155900  B120-GET-PARENT-DMA.                                            16950000
156000*      DISPLAY 'B120-GET-PARENT-DMA'.                             16960006
156100                                                                  16970000
156200       MOVE  SPACES            TO ITMCLT-ITEM-CLUSTR-NAME.        16980000
156300       MOVE   MDSEAR-DMA-NBR   TO                                 16990000
156400                                  ITMCLT-ITEM-CLUSTR-NAME.        17000000
156500                                                                  17010000
156600       MOVE 'DMA'            TO    ITMCLT-HIER-CDE.               17020000
156700       MOVE ZEROES           TO    PV-HIER-CDE-NULL.              17030000
156800                                                                  17040000
156900       PERFORM  D100-GET-CLUSTR-ID.                               17050000
157000                                                                  17060000
157100       IF SQLCODE = 1403                                          17070000
157200          DISPLAY 'PARENT DMA NOT FOUND FOR: ' MDSEAR-DMA-NBR     17080000
157300       ELSE                                                       17090000
157400          MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-DMA-PRNT-CLUSTR-ID     17100000
157500       END-IF.                                                    17110000
157600                                                                  17120000
157700                                                                  17130000
157800***************************************************************** 17140000
157900*                                                               * 17150000
158000***************************************************************** 17160000
158100  B130-GET-PARENT-DPT.                                            17170000
158200*      DISPLAY 'B130-GET-PARENT-DPT'.                             17180006
158300                                                                  17190000
158400       MOVE  SPACES            TO ITMCLT-ITEM-CLUSTR-NAME.        17200000
158500       MOVE MDSEAR-DEPT-NBR TO ITMCLT-ITEM-CLUSTR-NAME.           17210000
158600                                                                  17220000
158700       MOVE 'DPT'            TO    ITMCLT-HIER-CDE.               17230000
158800       MOVE ZEROES           TO    PV-HIER-CDE-NULL.              17240000
158900                                                                  17250000
159000       PERFORM  D100-GET-CLUSTR-ID.                               17260000
159100                                                                  17270000
159200       MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-DEPT-PRNT-CLUSTR-ID.      17280000
159300       MOVE ITMCLT-ITEM-CLUSTR-DESC TO PV-DEPT-DESC.              17290000
159400                                                                  17300000
159500***************************************************************** 17310000
159600*                                                               * 17320000
159700***************************************************************** 17330000
159800  B140-GET-PARENT-MCL.                                            17340000
159900                                                                  17350000
160000                                                                  17360000
160100*      DISPLAY 'B140-GET-PARENT-MCL'.                             17370006
160200      MOVE  SPACES             TO ITMCLT-ITEM-CLUSTR-NAME.        17380000
160300      STRING  MDSEAR-DEPT-NBR          DELIMITED BY SIZE          17390000
160400              '-'                      DELIMITED BY SIZE          17400000
160500              MDSEAR-MAJ-CL-NBR(1:1)   DELIMITED BY SIZE          17410000
160600                                INTO  ITMCLT-ITEM-CLUSTR-NAME.    17420000
160700                                                                  17430000
160800       MOVE 'MCL'            TO    ITMCLT-HIER-CDE.               17440000
160900       MOVE ZEROES           TO    PV-HIER-CDE-NULL.              17450000
161000                                                                  17460000
161100       PERFORM  D100-GET-CLUSTR-ID.                               17470000
161200                                                                  17480000
161300       MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-MAJ-PRNT-CLUSTR-ID.       17490000
161400       MOVE ITMCLT-ITEM-CLUSTR-DESC (1:10) TO                     17500000
161500                                              PV-DEPT-DESC.       17510000
161600                                                                  17520000
161700                                                                  17530000
161800***************************************************************** 17540000
161900* PROCESS CHANGES TO TMDSEAR.                                   * 17550000
162000*                                                               * 17560000
162100***************************************************************** 17570000
162200 B200-PROCESS-CLUSTERS.                                           17580023
162300                                                                  17590000
162400                                                                  17600000
162500*    DISPLAY ' B200-PROCESS-CLUSTERS'.                            17610006
162600     ADD +1          TO PV-TMDSEAR-COUNT.                         17620000
162700     MOVE 'B200'     TO PV-CALLING-PARA                           17630000
162800     MOVE 'S'        TO ITMCLT-CLUSTR-TYP-CDE.                    17640000
162900     MOVE ZEROS      TO ITMCLT-OWNER-ID.                          17650000
163000     MOVE LOW-VALUES TO ITMCLT-MDSE-NM-CDE.                       17660000
163100     MOVE LOW-VALUES TO ITMCLT-PROD-SERV-CDE.                     17670000
163200     MOVE PC-NEG-1   TO PV-MDSE-NM-CDE-NULL                       17680000
163300                        PV-PROD-SERV-CDE-NULL                     17690000
163400                        PV-OWNER-ID-NULL.                         17700000
163500                                                                  17710000
163600                                                                  17720000
163700     MOVE PV-INITIAL-STRT-TMST TO ITMCLT-EFF-BEG-TMST             17730000
163800                                  ITMCLC-EFF-BEG-TMST.            17740000
163900     MOVE PV-INITIAL-END-TMST  TO ITMCLT-EFF-END-TMST             17750000
164000                                  ITMCLC-EFF-END-TMST.            17760000
164100                                                                  17770000
164200     MOVE PV-MDSEAR-STRT-DTE   TO ITMCLT-EFF-BEG-TMST(1:10)       17780000
164300                                  ITMCLC-EFF-BEG-TMST(1:10).      17790000
164400                                                                  17800000
164500     IF PV-MDSEAR-END-DTE = '9999-09-09'                          17810000
164600                                                                  17820000
164700        MOVE PC-NEG-1 TO PV-EFF-END-DTE-NULL                      17830000
164800        MOVE LOW-VALUES  TO ITMCLT-EFF-END-TMST                   17840000
164900                            ITMCLC-EFF-END-TMST                   17850000
165000     ELSE                                                         17860000
165100        MOVE ZERO     TO PV-EFF-END-DTE-NULL                      17870000
165200        MOVE PV-MDSEAR-END-DTE  TO ITMCLT-EFF-END-TMST(1:10)      17880000
165300                                   ITMCLC-EFF-END-TMST(1:10)      17890000
165400     END-IF.                                                      17900000
165500                                                                  17910000
165600                                                                  17920000
165700     EVALUATE TRUE                                                17930000
165800                                                                  17940000
165900     WHEN MDSEAR-MDSELV-CDE = 'GMA'                               17950000
166000                                                                  17960000
166100           PERFORM B105-GET-PARENT-CORP                           17970000
166200                                                                  17980000
166300           MOVE SPACES                TO ITMCLT-ITEM-CLUSTR-DESC  17990000
166400           MOVE MDSEAR-DESC           TO ITMCLT-ITEM-CLUSTR-DESC  18000000
166500                                         PV-GMA-DESC              18010000
166600                                         PV-ITMCLT-CLUSTR-DESC    18020000
166700           MOVE 'M'                   TO ITMCLT-HIER-TYP-CDE      18030000
166800           MOVE 'GMA'                 TO ITMCLT-HIER-CDE          18040000
166900           MOVE 'C'                   TO ITMCLT-ITEM-CLUSTR-CDE   18050000
167000           MOVE MDSEAR-GMA-NBR        TO ITMCLT-ITEM-CLUSTR-NAME  18060000
167100*          MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-GMA-PRNT-CLUSTR-ID    18070000
167200           MOVE PV-CORP-PRNT-CLUSTR-ID                            18080000
167300                                    TO ITMCLC-PRNT-ITM-CLUSTR-ID  18090000
167400                                                                  18100000
167500           MOVE ZEROES                TO PV-HIER-CDE-NULL         18110000
167600                                         PV-HIER-TYP-CDE-NULL     18120000
167700                                         PV-CLUSTR-TYP-CDE-NULL   18130000
167800                                                                  18140000
167900                                                                  18150000
168000     WHEN MDSEAR-MDSELV-CDE = 'DMA'                               18160000
168100                                                                  18170000
168200           PERFORM B110-GET-PARENT-GMA                            18180000
168300                                                                  18190000
168400           MOVE SPACES              TO   ITMCLT-ITEM-CLUSTR-DESC  18200000
168500           MOVE        MDSEAR-DESC  TO   ITMCLT-ITEM-CLUSTR-DESC  18210000
168600                                         PV-DMA-DESC              18220000
168700                                         PV-ITMCLT-CLUSTR-DESC    18230000
168800           MOVE 'M'   TO  ITMCLT-HIER-TYP-CDE                     18240000
168900           MOVE 'DMA' TO  ITMCLT-HIER-CDE                         18250000
169000           MOVE 'C' TO    ITMCLT-ITEM-CLUSTR-CDE                  18260000
169100                                                                  18270000
169200           MOVE ZEROES    TO    PV-HIER-CDE-NULL                  18280000
169300                                PV-HIER-TYP-CDE-NULL              18290000
169400                                PV-CLUSTR-TYP-CDE-NULL            18300000
169500                                                                  18310000
169600           MOVE   MDSEAR-DMA-NBR  TO                              18320000
169700                                  ITMCLT-ITEM-CLUSTR-NAME         18330000
169800                                                                  18340000
169900       MOVE PV-GMA-PRNT-CLUSTR-ID  TO ITMCLC-PRNT-ITM-CLUSTR-ID   18350000
170000       MOVE ITMCLT-ITEM-CLUSTR-ID  TO ITMCLC-CHLD-ITM-CLUSTR-ID   18360000
170100       MOVE 'M'                    TO ITMCLC-REL-TYP-CDE          18370000
170200                                                                  18380000
170300                                                                  18390000
170400     WHEN MDSEAR-MDSELV-CDE = 'DPT'                               18400000
170500                                                                  18410000
170600       PERFORM B120-GET-PARENT-DMA                                18420000
170700                                                                  18430000
170800       IF SQLCODE NOT = 1403                                      18440000
170900           MOVE SPACES              TO   ITMCLT-ITEM-CLUSTR-DESC  18450000
171000           MOVE MDSEAR-DESC         TO   ITMCLT-ITEM-CLUSTR-DESC  18460000
171100                                         PV-DEPT-DESC             18470000
171200                                         PV-ITMCLT-CLUSTR-DESC    18480000
171300           MOVE 'M'    TO    ITMCLT-HIER-TYP-CDE                  18490000
171400           MOVE 'DPT'  TO    ITMCLT-HIER-CDE                      18500000
171500           MOVE 'C'    TO    ITMCLT-ITEM-CLUSTR-CDE               18510000
171600           MOVE SPACES TO    ITMCLT-ITEM-CLUSTR-NAME              18520000
171700                                                                  18530000
171800           MOVE MDSEAR-DEPT-NBR TO ITMCLT-ITEM-CLUSTR-NAME        18540000
171900*                                  ITMCLT-OWNER-ID                18550000
172000                                                                  18560000
172100                                                                  18570000
172200           MOVE ZEROES    TO    PV-HIER-CDE-NULL                  18580000
172300                                PV-HIER-TYP-CDE-NULL              18590000
172400                                PV-CLUSTR-TYP-CDE-NULL            18600000
172500                                PV-OWNER-ID-NULL                  18610000
172600                                                                  18620000
172700           MOVE PV-DMA-PRNT-CLUSTR-ID                             18630000
172800                          TO ITMCLC-PRNT-ITM-CLUSTR-ID            18640000
172900           MOVE ITMCLT-ITEM-CLUSTR-ID                             18650000
173000                          TO ITMCLC-CHLD-ITM-CLUSTR-ID            18660000
173100*                                    ITMCLT-OWNER-ID              18670000
173200         MOVE 'M'                 TO ITMCLC-REL-TYP-CDE           18680000
173300       END-IF                                                     18690000
173400                                                                  18700000
173500                                                                  18710000
173600     WHEN MDSEAR-MDSELV-CDE = 'MCL'                               18720000
173700                                                                  18730000
173800       PERFORM B130-GET-PARENT-DPT                                18740000
173900                                                                  18750000
174000          MOVE SPACES  TO ITMCLT-ITEM-CLUSTR-DESC                 18760000
174100          STRING  PV-DEPT-DESC DELIMITED BY SIZE                  18770000
174200                  ' '          DELIMITED BY SIZE                  18780000
174300                  MDSEAR-DESC  DELIMITED BY SIZE                  18790000
174400                               INTO ITMCLT-ITEM-CLUSTR-DESC       18800000
174500          MOVE ITMCLT-ITEM-CLUSTR-DESC TO PV-MAJ-CL-DESC          18810000
174600                                         PV-ITMCLT-CLUSTR-DESC    18820000
174700          MOVE 'M'   TO    ITMCLT-HIER-TYP-CDE                    18830000
174800          MOVE 'MCL' TO    ITMCLT-HIER-CDE                        18840000
174900          MOVE 'C' TO    ITMCLT-ITEM-CLUSTR-CDE                   18850000
175000                                                                  18860000
175100          MOVE ZEROES    TO    PV-HIER-CDE-NULL                   18870000
175200                               PV-HIER-TYP-CDE-NULL               18880000
175300                               PV-CLUSTR-TYP-CDE-NULL             18890000
175400                               PV-OWNER-ID-NULL                   18900000
175500                                                                  18910000
175600          MOVE SPACES TO   ITMCLT-ITEM-CLUSTR-NAME                18920000
175700          STRING  MDSEAR-DEPT-NBR          DELIMITED BY SIZE      18930000
175800                  '-'                      DELIMITED BY SIZE      18940000
175900                  MDSEAR-MAJ-CL-NBR(1:1)   DELIMITED BY SIZE      18950000
176000                                INTO  ITMCLT-ITEM-CLUSTR-NAME     18960000
176100                                                                  18970000
176200       MOVE PV-DEPT-PRNT-CLUSTR-ID TO ITMCLC-PRNT-ITM-CLUSTR-ID   18980000
176300                                      ITMCLT-OWNER-ID             18990000
176400       MOVE ITMCLT-ITEM-CLUSTR-ID  TO ITMCLC-CHLD-ITM-CLUSTR-ID   19000000
176500       MOVE 'M'                    TO ITMCLC-REL-TYP-CDE          19010000
176600*      MOVE MDSEAR-DEPT-NBR        TO ITMCLT-OWNER-ID             19020000
176700                                                                  19030000
176800                                                                  19040000
176900     WHEN MDSEAR-MDSELV-CDE = 'SCL'                               19050000
177000                                                                  19060000
177100       PERFORM B130-GET-PARENT-DPT                                19070000
177200       MOVE PV-DEPT-PRNT-CLUSTR-ID TO ITMCLT-OWNER-ID             19080000
177300                                                                  19090000
177400                                                                  19100000
177500       PERFORM B140-GET-PARENT-MCL                                19110000
177600          MOVE SPACES  TO ITMCLT-ITEM-CLUSTR-DESC                 19120000
177700          STRING  PV-DEPT-DESC DELIMITED BY SIZE                  19130000
177800                  ' '          DELIMITED BY SIZE                  19140000
177900               MDSEAR-DESC  DELIMITED BY SIZE                     19150000
178000                                   INTO ITMCLT-ITEM-CLUSTR-DESC   19160000
178100          MOVE ITMCLT-ITEM-CLUSTR-DESC TO PV-SUB-CL-DESC          19170000
178200                                         PV-ITMCLT-CLUSTR-DESC    19180000
178300          MOVE 'M'   TO    ITMCLT-HIER-TYP-CDE                    19190000
178400          MOVE 'SCL' TO    ITMCLT-HIER-CDE                        19200000
178500          MOVE 'C'    TO   ITMCLT-ITEM-CLUSTR-CDE                 19210000
178600                                                                  19220000
178700          MOVE ZEROES    TO    PV-HIER-CDE-NULL                   19230000
178800                               PV-HIER-TYP-CDE-NULL               19240000
178900                               PV-CLUSTR-TYP-CDE-NULL             19250000
179000                               PV-OWNER-ID-NULL                   19260000
179100                                                                  19270000
179200                                                                  19280000
179300          MOVE SPACES TO   ITMCLT-ITEM-CLUSTR-NAME                19290000
179400          STRING  MDSEAR-DEPT-NBR         DELIMITED BY SIZE       19300000
179500                  '-'                     DELIMITED BY SIZE       19310000
179600                  MDSEAR-SUB-CL-NBR(2:2)  DELIMITED BY SIZE       19320000
179700                                INTO  ITMCLT-ITEM-CLUSTR-NAME     19330000
179800*     MOVE MDSEAR-DEPT-NBR         TO ITMCLT-OWNER-ID             19340000
179900                                                                  19350000
180000      MOVE PV-MAJ-PRNT-CLUSTR-ID   TO ITMCLC-PRNT-ITM-CLUSTR-ID   19360000
180100      MOVE ITMCLT-ITEM-CLUSTR-ID   TO ITMCLC-CHLD-ITM-CLUSTR-ID   19370000
180200      MOVE MDSEAR-SUB-CL-NBR (2:2) TO TSK-MERCH-CLASS-NMBR        19380000
180300      MOVE 'M'                     TO ITMCLC-REL-TYP-CDE          19390000
180400                                                                  19400000
180500                                                                  19410000
180600     END-EVALUATE.                                                19420000
180700                                                                  19430000
180800*********************************************************         19440000
180900* AS001- NEW CODE TO CHECK THE DATA RECORD FROM TITMCLT IS        19450000
181000*        UPDATED AND FETCH THE DATA FROM THE CURSOR MDSCHG        19460000
181100*        TO DETERMINE INSERT OR UPDATE THE DATA IN THE TITMCLT    19470000
181200*        AND TITMCLC TABLES.                                      19480000
181300***********************************************************       19490000
181400     IF    PV-MDSEAR-CRE-DTE = PV-INPUT-DTE                       19500000
181500                                                                  19510000
181600*       DISPLAY ' '                                               19520006
181700*       DISPLAY 'PROCESSING NEW TMDSEAR RECORD'                   19530006
181800*       DISPLAY DCLTMDSEAR                                        19540006
181900*       DISPLAY ' '                                               19550006
182000                                                                  19560000
182100        IF    PV-MDSEAR-END-DTE <= PV-INPUT-DTE                   19570000
182200*          CONTINUE                                               19580000
**TEMP*         DISPLAY ' B200 CALL TO C360-UPDATE-REL'                 19590027
**TEMP*         ADD +1 TO PV-INS-UPD-COUNT                              19600027
                 PERFORM C360-UPDATE-REL                                19610027
182400        ELSE                                                      19620000
182500          PERFORM D100-GET-CLUSTR-ID                              19630000
182600          MOVE ITMCLT-ITEM-CLUSTR-ID TO ITMCLC-CHLD-ITM-CLUSTR-ID 19640000
182700          IF SQLCODE = 1403                                       19650000
                     PERFORM  C100-PROCESS-INSERT                       19660022
182900               MOVE 1 TO PV-CONTINUE-FLG                          19670000
183000               ADD +1 TO PV-MDSEAR-INSERT                         19680000
183100          END-IF                                                  19690000
183200                                                                  19700000
183300          IF PV-CONTINUE-FLG = 1                                  19710000
183400               CONTINUE                                           19720000
183500          ELSE                                                    19730000
183600               PERFORM B400-OPEN-MDSCHG-CURSOR                    19740000
183700               PERFORM B440-FIND-MATCH-CRE-DATA                   19750000
183800                  UNTIL  PV-NO-MORE-MATCH-DATA-LEFT = 1           19760000
183900                                                                  19770000
184000               PERFORM B420-CLOSE-MDSCHG-CURSOR                   19780000
184100               PERFORM B470-ASSIGN-VAR-TO-ITMCL                   19790000
184200               MOVE PV-ITMCLT-CLUSTR-DESC TO                      19800000
184300                            ITMCLT-ITEM-CLUSTR-DESC               19810000
184400               PERFORM C300-PROCESS-UPDATE                        19820000
184500               IF ( PV-FOUND-RECORD = 1)                          19830000
184600                  PERFORM B450-PROCESS-TITMCLC                    19840000
184700               END-IF                                             19850000
184800           END-IF                                                 19860000
184900        END-IF                                                    19870000
185000     ELSE                                                         19880000
185100     IF   PV-MDSEAR-CHG-DTE = PV-INPUT-DTE                        19890000
185200                                                                  19900000
185300*       DISPLAY ' '                                               19910006
185400*       DISPLAY 'PROCESSING MODIFIED TMDSEAR RECORD'              19920006
185500*       DISPLAY DCLTMDSEAR                                        19930006
185600*       DISPLAY ' '                                               19940006
185700                                                                  19950000
185800          PERFORM D100-GET-CLUSTR-ID                              19960000
185900                                                                  19970000
186000          IF SQLCODE = ZERO                                       19980000
186100          MOVE ITMCLT-ITEM-CLUSTR-ID TO ITMCLC-CHLD-ITM-CLUSTR-ID 19990000
186200          PERFORM B401-OPEN-MDSCRE-CURSOR                         20000000
186300          PERFORM B441-FIND-MATCH-CHG-DATA                        20010000
186400                  UNTIL  PV-NO-MORE-MATCH-DATA-LEFT = 1           20020000
186500                                                                  20030000
186600          PERFORM B421-CLOSE-MDSCRE-CURSOR                        20040000
186700          IF(PV-FOUND-RECORD NOT = 1)                             20050000
186800               IF PV-MDSEAR-END-DTE <= PV-INPUT-DTE               20060000
186900                  PERFORM C400-EXPIRE-PARNT-REL                   20070000
187000               ELSE                                               20080000
187100                  PERFORM B470-ASSIGN-VAR-TO-ITMCL                20090000
187200                  MOVE PV-ITMCLT-CLUSTR-DESC TO                   20100000
187300                            ITMCLT-ITEM-CLUSTR-DESC               20110000
187400                  PERFORM C300-PROCESS-UPDATE                     20120000
187500               END-IF                                             20130000
187600          ELSE                                                    20140000
187700             PERFORM C360-UPDATE-REL                              20150000
187800          END-IF                                                  20160000
187900        END-IF                                                    20170000
188000        IF SQLCODE = 1403                                         20180000
188100         DISPLAY 'CLUSTER NOT FOUND FOR: '                        20190000
188200                                      ITMCLT-ITEM-CLUSTR-NAME     20200000
188300        END-IF                                                    20210000
188400     END-IF.                                                      20220000
188500                                                                  20230000
0822RM**** COMMIT CHECK LOGIC                                           20240016
0822RM     IF PV-INS-UPD-COUNT > PC-COMMIT-THRESHOLD                    20250022
0822RM          ADD PV-INS-UPD-COUNT TO PV-TOTAL-INS-UPD                20262025
0822RM          MOVE 0               TO PV-INS-UPD-COUNT                20263025
0822RM          PERFORM E130-COMMIT-RENUMBERS                           20270016
0822RM     END-IF.                                                      20280016
                                                                        20290016
188600     PERFORM C000-FETCH-TMDSEAR-CURSOR.                           20300000
188700                                                                  20310000
188800                                                                  20320000
188900***************************************************************** 20330000
189000* B220-OPEN-CHILD-CURSOR.                                       * 20340000
189100*                                                               * 20350000
189200*                                                               * 20360000
189300***************************************************************** 20370000
189400*                                                                 20380000
189500 B220-OPEN-CHILD-CURSOR.                                          20390000
189600                                                                  20400000
189700*    DISPLAY 'B220-OPEN-CHILD-CURSOR'.                            20410006
189800     MOVE 'B220-OPEN-CHILD-CURSOR' TO PV-ABEND-PARAGRAPH.         20420000
189900                                                                  20430000
190000     EXEC SQL                                                     20440000
190100         OPEN  CHILDCSR                                           20450000
190200     END-EXEC.                                                    20460000
190300                                                                  20470000
190400     EVALUATE TRUE                                                20480000
190500       WHEN SQLCODE = ZEROS                                       20490000
190600       WHEN SQLCODE = 1403                                        20500000
190700         CONTINUE                                                 20510000
190800       WHEN OTHER                                                 20520000
190900         DISPLAY PV-ABEND-PARAGRAPH                               20530000
191000         PERFORM Z999-SQL-ERROR                                   20540000
191100     END-EVALUATE.                                                20550000
191200                                                                  20560000
191300                                                                  20570000
191400                                                                  20580000
191500     EJECT                                                        20590000
191600******************************************************************20600000
191700*                                                                *20610000
191800*                                                                *20620000
191900******************************************************************20630000
192000 B230-FETCH-CHILD-CURSOR.                                         20640000
192100                                                                  20650000
192200*    DISPLAY 'B230-FETCH-CHILD-CURSOR'.                           20660006
192300                                                                  20670000
192400     MOVE 'B230-FETCH-CHILD-CURSOR' TO PV-ABEND-PARAGRAPH.        20680000
192500                                                                  20690000
192600     EXEC SQL                                                     20700000
192700       FETCH  CHILDCSR                                            20710000
192800       INTO  :ITMCLC-CHLD-ITM-CLUSTR-ID                           20720000
192900     END-EXEC.                                                    20730000
193000                                                                  20740000
193100     EVALUATE TRUE                                                20750000
193200       WHEN SQLCODE = ZEROS                                       20760000
193300         CONTINUE                                                 20770000
193400       WHEN SQLCODE = 1403                                        20780000
193500         SET PS-NO-MORE-CHILDREN TO TRUE                          20790000
193600       WHEN OTHER                                                 20800000
193700         DISPLAY PV-ABEND-PARAGRAPH                               20810000
193800         PERFORM Z999-SQL-ERROR                                   20820000
193900     END-EVALUATE.                                                20830000
194000                                                                  20840000
194100     IF SQLCODE = ZEROS                                           20850000
194200         ADD +1 TO PV-FETCH-COUNT                                 20860000
194300                                                                  20870000
194400*        DISPLAY 'B230 - SQLCODE = 0'                             20880006
194500*        DISPLAY 'B230 - ITMCLC-CHLD-ITM-CLUSTR-ID:  '            20890006
194600         MOVE ITMCLC-CHLD-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-1    20900000
194700*        DISPLAY PV-WORK-CLUSTR-ID-1                              20910006
194800         PERFORM  D110-GET-NICK-NAME                              20920000
194900         PERFORM  C400-EXPIRE-PARNT-REL                           20930000
195000                                                                  20940000
195100     END-IF.                                                      20950000
195200                                                                  20960000
195300                                                                  20970000
195400***************************************************************** 20980000
195500* B240-CLOSE-CHILD-CURSOR.                                      * 20990000
195600*                                                               * 21000000
195700*                                                               * 21010000
195800***************************************************************** 21020000
195900*                                                                 21030000
196000 B240-CLOSE-CHILD-CURSOR.                                         21040000
196100                                                                  21050000
196200*    DISPLAY 'B240-CLOSE-CHILD-CURSOR'.                           21060006
196300                                                                  21070000
196400     MOVE 'B240-CLOSE-CHILD-CURSOR' TO PV-ABEND-PARAGRAPH.        21080000
196500                                                                  21090000
196600     EXEC SQL                                                     21100000
196700       CLOSE  CHILDCSR                                            21110000
196800     END-EXEC.                                                    21120000
196900                                                                  21130000
197000     EVALUATE TRUE                                                21140000
197100       WHEN SQLCODE = ZEROS                                       21150000
197200       WHEN SQLCODE = 1403                                        21160000
197300         CONTINUE                                                 21170000
197400       WHEN OTHER                                                 21180000
197500         DISPLAY PV-ABEND-PARAGRAPH                               21190000
197600         PERFORM Z999-SQL-ERROR                                   21200000
197700     END-EVALUATE.                                                21210000
197800                                                                  21220000
197900                                                                  21230000
198000                                                                  21240000
198100     EJECT                                                        21250000
198200                                                                  21260000
198300***************************************************************** 21270000
198400* B300-CLOSE-TMDSEAR-CURSOR.                                    * 21280000
198500*                                                               * 21290000
198600*                                                               * 21300000
198700***************************************************************** 21310000
198800*                                                                 21320000
198900 B300-CLOSE-TMDSEAR-CURSOR.                                       21330000
199000                                                                  21340000
199100     MOVE 'B300-CLOSE-TMDSEAR-CURSOR' TO PV-ABEND-PARAGRAPH.      21350000
199200                                                                  21360000
199300     EXEC SQL                                                     21370000
199400       CLOSE  MDSEARCSR                                           21380000
199500     END-EXEC.                                                    21390000
199600                                                                  21400000
199700     EVALUATE TRUE                                                21410000
199800       WHEN SQLCODE = ZEROS                                       21420000
199900       WHEN SQLCODE = 1403                                        21430000
200000         CONTINUE                                                 21440000
200100       WHEN OTHER                                                 21450000
200200         DISPLAY PV-ABEND-PARAGRAPH                               21460000
200300         PERFORM Z999-SQL-ERROR                                   21470000
200400     END-EVALUATE.                                                21480000
200500                                                                  21490000
200600                                                                  21500000
200700                                                                  21510000
200800     EJECT                                                        21520000
200900*                                                                 21530000
201000***************************************************************** 21540000
201100* B400-OPEN-MDSCHG-CURSOR.                                     *  21550000
201200* AS001                                                         * 21560000
201300*                                                               * 21570000
201400***************************************************************** 21580000
201500*                                                                 21590000
201600 B400-OPEN-MDSCHG-CURSOR.                                         21600000
201700     MOVE 'B400-OPEN-MDSCHG-CURSOR' TO PV-ABEND-PARAGRAPH.        21610000
201800*    DISPLAY 'B400-OPEN-MDSEAR-CURSOR'.                           21620006
201900     MOVE 0 TO PV-NO-MORE-MATCH-DATA-LEFT.                        21630000
202000     MOVE 0 TO PV-FOUND-RECORD.                                   21640000
202100     EXEC SQL                                                     21650000
202200         OPEN  MDSCHG                                             21660000
202300     END-EXEC.                                                    21670000
202400                                                                  21680000
202500     EVALUATE TRUE                                                21690000
202600       WHEN SQLCODE = ZEROS                                       21700000
202700         CONTINUE                                                 21710000
202800       WHEN SQLCODE = 1403                                        21720000
202900          SET PS-NO-MORE-CLUSTERS-LEFT TO TRUE                    21730000
203000         CONTINUE                                                 21740000
203100       WHEN OTHER                                                 21750000
203200         DISPLAY PV-ABEND-PARAGRAPH                               21760000
203300         PERFORM Z999-SQL-ERROR                                   21770000
203400     END-EVALUATE.                                                21780000
203500                                                                  21790000
203600                                                                  21800000
203700                                                                  21810000
203800     EJECT                                                        21820000
203900                                                                  21830000
204000*                                                                 21840000
204100***************************************************************** 21850000
204200* B401-OPEN-MDSCRE-CURSOR.                                     *  21860000
204300* AS001                                                         * 21870000
204400*                                                               * 21880000
204500***************************************************************** 21890000
204600*                                                                 21900000
204700 B401-OPEN-MDSCRE-CURSOR.                                         21910000
204800     MOVE 'B401-OPEN-MDSCRE-CURSOR' TO PV-ABEND-PARAGRAPH.        21920000
204900*    DISPLAY 'B401-OPEN-MDSCRE-CURSOR'.                           21930006
205000     MOVE 0 TO PV-NO-MORE-MATCH-DATA-LEFT.                        21940000
205100     MOVE 0 TO PV-FOUND-RECORD.                                   21950000
205200     EXEC SQL                                                     21960000
205300         OPEN  MDSCRE                                             21970000
205400     END-EXEC.                                                    21980000
205500                                                                  21990000
205600     EVALUATE TRUE                                                22000000
205700       WHEN SQLCODE = ZEROS                                       22010000
205800         CONTINUE                                                 22020000
205900       WHEN SQLCODE = 1403                                        22030000
206000         SET PS-NO-MORE-CLUSTERS-LEFT TO TRUE                     22040000
206100         CONTINUE                                                 22050000
206200       WHEN OTHER                                                 22060000
206300         DISPLAY 'PV-INPUT-DTE: ' PV-INPUT-DTE                    22070000
206400         DISPLAY PV-ABEND-PARAGRAPH                               22080000
206500         PERFORM Z999-SQL-ERROR                                   22090000
206600     END-EVALUATE.                                                22100000
206700                                                                  22110000
206800                                                                  22120000
206900                                                                  22130000
207000     EJECT                                                        22140000
207100                                                                  22150000
207200******************************************************************22160000
207300* B410-FETCH-MDSCHG-CURSOR                                       *22170000
207400* AS001                                                          *22180000
207500******************************************************************22190000
207600 B410-FETCH-MDSCHG-CURSOR.                                        22200000
207700                                                                  22210000
207800     MOVE 'B410-FETCH-MDSCHG-CURSOR' TO PV-ABEND-PARAGRAPH.       22220000
207900*    DISPLAY 'B410-FETCH-MDSCHG-CURSOR'.                          22230006
208000     EXEC SQL                                                     22240000
208100       FETCH  MDSCHG                                              22250000
208200       INTO                                                       22260000
208300             :MDSEAR-GMA-NBR,                                     22270000
208400             :MDSEAR-DMA-NBR,                                     22280000
208500             :MDSEAR-DEPT-NBR,                                    22290000
208600             :MDSEAR-MAJ-CL-NBR,                                  22300000
208700             :MDSEAR-SUB-CL-NBR,                                  22310000
208800             :MDSEAR-MDSELV-CDE,                                  22320000
208900             :MDSEAR-CHG-DTE                                      22330000
209000     END-EXEC.                                                    22340000
209100                                                                  22350000
209200     EVALUATE TRUE                                                22360000
209300       WHEN SQLCODE = ZEROS                                       22370000
209400         MOVE MDSEAR-GMA-NBR TO PV1-MDSEAR-GMA-NBR                22380000
209500         MOVE MDSEAR-DMA-NBR TO PV1-MDSEAR-DMA-NBR                22390000
209600         MOVE MDSEAR-DEPT-NBR TO PV1-MDSEAR-DEPT-NBR              22400000
209700         MOVE MDSEAR-MAJ-CL-NBR TO PV1-MDSEAR-MAJ-CL-NBR          22410000
209800         MOVE MDSEAR-SUB-CL-NBR TO PV1-MDSEAR-SUB-CL-NBR          22420000
209900         MOVE MDSEAR-MDSELV-CDE TO PV1-MDSEAR-MDSELV-CDE          22430000
210000         MOVE MDSEAR-CHG-DTE    TO PV1-MDSEAR-CHG-DTE             22440000
210100       WHEN SQLCODE = 1403                                        22450000
210200         MOVE 1 TO PV-NO-MORE-MATCH-DATA-LEFT                     22460000
210300       WHEN OTHER                                                 22470000
210400         DISPLAY PV-ABEND-PARAGRAPH                               22480000
210500         PERFORM Z999-SQL-ERROR                                   22490000
210600     END-EVALUATE.                                                22500000
210700                                                                  22510000
210800                                                                  22520000
210900******************************************************************22530000
211000* B411-FETCH-MDSCRE-CURSOR                                       *22540000
211100* AS001                                                          *22550000
211200******************************************************************22560000
211300 B411-FETCH-MDSCRE-CURSOR.                                        22570000
211400                                                                  22580000
211500     MOVE 'B411-FETCH-MDSCRE-CURSOR' TO PV-ABEND-PARAGRAPH.       22590000
211600*    DISPLAY 'B411-FETCH-MDSCRE-CURSOR'.                          22600006
211700     EXEC SQL                                                     22610000
211800       FETCH  MDSCRE                                              22620000
211900       INTO                                                       22630000
212000             :MDSEAR-GMA-NBR,                                     22640000
212100             :MDSEAR-DMA-NBR,                                     22650000
212200             :MDSEAR-DEPT-NBR,                                    22660000
212300             :MDSEAR-MAJ-CL-NBR,                                  22670000
212400             :MDSEAR-SUB-CL-NBR,                                  22680000
212500             :MDSEAR-MDSELV-CDE,                                  22690000
212600             :MDSEAR-CRE-DTE                                      22700000
212700     END-EXEC.                                                    22710000
212800                                                                  22720000
212900     EVALUATE TRUE                                                22730000
213000       WHEN SQLCODE = ZEROS                                       22740000
213100         MOVE MDSEAR-GMA-NBR TO PV1-MDSEAR-GMA-NBR                22750000
213200         MOVE MDSEAR-DMA-NBR TO PV1-MDSEAR-DMA-NBR                22760000
213300         MOVE MDSEAR-DEPT-NBR TO PV1-MDSEAR-DEPT-NBR              22770000
213400         MOVE MDSEAR-MAJ-CL-NBR TO PV1-MDSEAR-MAJ-CL-NBR          22780000
213500         MOVE MDSEAR-SUB-CL-NBR TO PV1-MDSEAR-SUB-CL-NBR          22790000
213600         MOVE MDSEAR-MDSELV-CDE TO PV1-MDSEAR-MDSELV-CDE          22800000
213700         MOVE MDSEAR-CRE-DTE    TO PV1-MDSEAR-CRE-DTE             22810000
213800       WHEN SQLCODE = 1403                                        22820000
213900         MOVE 1 TO PV-NO-MORE-MATCH-DATA-LEFT                     22830000
214000       WHEN OTHER                                                 22840000
214100         DISPLAY PV-ABEND-PARAGRAPH                               22850000
214200         PERFORM Z999-SQL-ERROR                                   22860000
214300     END-EVALUATE.                                                22870000
214400                                                                  22880000
214500***************************************************************** 22890000
214600* B420-CLOSE-MDSCHG-CURSOR.                                    *  22900000
214700* AS001                                                         * 22910000
214800*                                                               * 22920000
214900***************************************************************** 22930000
215000*                                                                 22940000
215100 B420-CLOSE-MDSCHG-CURSOR.                                        22950000
215200                                                                  22960000
215300     MOVE 'B420-CLOSE-MDSCHG-CURSOR' TO PV-ABEND-PARAGRAPH.       22970000
215400*    DISPLAY 'B420-CLOSE-MDSCHG-CURSOR'.                          22980006
215500     EXEC SQL                                                     22990000
215600       CLOSE  MDSCHG                                              23000000
215700     END-EXEC.                                                    23010000
215800                                                                  23020000
215900     EVALUATE TRUE                                                23030000
216000       WHEN SQLCODE = ZEROS                                       23040000
216100       WHEN SQLCODE = 1403                                        23050000
216200         CONTINUE                                                 23060000
216300       WHEN OTHER                                                 23070000
216400         DISPLAY PV-ABEND-PARAGRAPH                               23080000
216500         PERFORM Z999-SQL-ERROR                                   23090000
216600     END-EVALUATE.                                                23100000
216700                                                                  23110000
216800                                                                  23120000
216900                                                                  23130000
217000     EJECT                                                        23140000
217100*                                                                 23150000
217200                                                                  23160000
217300***************************************************************** 23170000
217400* B421-CLOSE-MDSCRE-CURSOR.                                    *  23180000
217500* AS001                                                         * 23190000
217600*                                                               * 23200000
217700***************************************************************** 23210000
217800*                                                                 23220000
217900 B421-CLOSE-MDSCRE-CURSOR.                                        23230000
218000                                                                  23240000
218100     MOVE 'B421-CLOSE-MDSCRE-CURSOR' TO PV-ABEND-PARAGRAPH.       23250000
218200*    DISPLAY 'B421-CLOSE-MDSCRE-CURSOR'.                          23260006
218300     EXEC SQL                                                     23270000
218400       CLOSE  MDSCRE                                              23280000
218500     END-EXEC.                                                    23290000
218600                                                                  23300000
218700     EVALUATE TRUE                                                23310000
218800       WHEN SQLCODE = ZEROS                                       23320000
218900       WHEN SQLCODE = 1403                                        23330000
219000         CONTINUE                                                 23340000
219100       WHEN OTHER                                                 23350000
219200         DISPLAY PV-ABEND-PARAGRAPH                               23360000
219300         PERFORM Z999-SQL-ERROR                                   23370000
219400     END-EVALUATE.                                                23380000
219500                                                                  23390000
219600                                                                  23400000
219700                                                                  23410000
219800     EJECT                                                        23420000
219900*                                                                 23430000
220000***************************************************************** 23440000
220100* B440-FIND-MATCH-CRE-DATA                                     *  23450000
220200* AS001                                                         * 23460000
220300*                                                               * 23470000
220400***************************************************************** 23480000
220500 B440-FIND-MATCH-CRE-DATA.                                        23490000
220600                                                                  23500000
220700     MOVE 'B440-FIND-MATCH-CRE-DATA' TO PV-ABEND-PARAGRAPH.       23510000
220800*    DISPLAY 'B440-FIND-MATCH-CRE-DATA'.                          23520006
220900     PERFORM B410-FETCH-MDSCHG-CURSOR.                            23530000
221000     IF PV-NO-MORE-MATCH-DATA-LEFT = 1                            23540000
221100        CONTINUE                                                  23550000
221200     ELSE                                                         23560000
221300       IF PV1-MDSEAR-CHG-DTE = PV-INPUT-DTE                       23570000
221400        IF      PV-MDSEAR-DMA-NBR NOT = PV1-MDSEAR-DMA-NBR        23580000
221500           AND  PV-MDSEAR-DEPT-NBR = PV1-MDSEAR-DEPT-NBR          23590000
221600           AND  PV-MDSEAR-MAJ-CL-NBR = PV1-MDSEAR-MAJ-CL-NBR      23600000
221700           AND  PV-MDSEAR-SUB-CL-NBR = PV1-MDSEAR-SUB-CL-NBR      23610000
221800           AND  PV-MDSEAR-MDSELV-CDE = PV1-MDSEAR-MDSELV-CDE      23620000
221900           MOVE 1 TO PV-FOUND-RECORD                              23630000
222000* FOUND THE DATA STOP FETCH                                       23640000
222100           MOVE 1 TO  PV-NO-MORE-MATCH-DATA-LEFT                  23650000
222200        END-IF                                                    23660000
222300      END-IF                                                      23670000
222400     END-IF.                                                      23680000
222500                                                                  23690000
222600                                                                  23700000
222700*                                                                 23710000
222800***************************************************************** 23720000
222900* B441-FIND-MATCH-CHG-DATA                                     *  23730000
223000* AS001                                                         * 23740000
223100*                                                               * 23750000
223200***************************************************************** 23760000
223300*                                                                 23770000
223400 B441-FIND-MATCH-CHG-DATA.                                        23780000
223500                                                                  23790000
223600     MOVE 'B441-FIND-MATCH-CHG-DATA' TO PV-ABEND-PARAGRAPH.       23800000
223700*    DISPLAY 'B441-FIND-MATCH-CHG-DATA'.                          23810006
223800     PERFORM B411-FETCH-MDSCRE-CURSOR.                            23820000
223900     IF PV-NO-MORE-MATCH-DATA-LEFT = 1                            23830000
224000        CONTINUE                                                  23840000
224100     ELSE                                                         23850000
224200      IF PV1-MDSEAR-CRE-DTE = PV-INPUT-DTE                        23860000
224300       IF       PV-MDSEAR-DMA-NBR NOT = PV1-MDSEAR-DMA-NBR        23870000
224400           AND  PV-MDSEAR-DEPT-NBR = PV1-MDSEAR-DEPT-NBR          23880000
224500           AND  PV-MDSEAR-MAJ-CL-NBR = PV1-MDSEAR-MAJ-CL-NBR      23890000
224600           AND  PV-MDSEAR-SUB-CL-NBR = PV1-MDSEAR-SUB-CL-NBR      23900000
224700           AND  PV-MDSEAR-MDSELV-CDE = PV1-MDSEAR-MDSELV-CDE      23910000
224800           MOVE 1 TO PV-FOUND-RECORD                              23920000
224900* FOUND THE MATCH DATA.STOP FETCH                                 23930000
225000           MOVE 1 TO PV-NO-MORE-MATCH-DATA-LEFT                   23940000
225100       END-IF                                                     23950000
225200      END-IF                                                      23960000
225300     END-IF.                                                      23970000
225400                                                                  23980000
225500                                                                  23990000
225600                                                                  24000000
225700*                                                                 24010000
225800***************************************************************** 24020000
225900* B450-PROCESS-TITMCLC                                         *  24030000
226000* AS001- GET THE CLHD_CLUSTR_ID FROM SQL AND COMPARE WITH       * 24040000
226100*        PARENT ID. IF THERE IS NOT SAME PARENT DO EXPIRE AND   * 24050000
226200*        INSERT IN THE TITMCLC TABLE.                          *  24060000
226300***************************************************************** 24070000
226400*                                                                 24080000
226500 B450-PROCESS-TITMCLC.                                            24090000
226600                                                                  24100000
226700     MOVE 'B450-PROCESS-TITMCLC' TO PV-ABEND-PARAGRAPH.           24110000
226800*    DISPLAY 'B450-PROCESS-TITMCLC'.                              24120006
226900*    DISPLAY 'ITMCLC-PRNT-ITM-CLUSTR-ID:  '.                      24130006
227000     MOVE ITMCLC-PRNT-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-1 .      24140000
227100*    DISPLAY PV-WORK-CLUSTR-ID-1.                                 24150006
227200*    DISPLAY 'ITMCLC-CHLD-ITM-CLUSTR-ID:  '.                      24160006
227300     MOVE ITMCLC-CHLD-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-2.       24170000
227400*    DISPLAY PV-WORK-CLUSTR-ID-2.                                 24180006
227500     MOVE 'C'                    TO ITMCLC-CHLD-ITM-CLSTR-CDE.    24190000
227600     MOVE ZEROS                  TO PV-CHLD-CDE-NULL.             24200000
227700* GET THE CURRENT THE PARENT AND CHILD CLUSTER ID                 24210000
227800     EXEC SQL                                                     24220000
227900           SELECT                                                 24230000
228000                   PRNT_ITM_CLUSTR_ID                             24240000
228100                  ,CHLD_ITM_CLUSTR_ID                             24250000
228200           INTO                                                   24260000
228300                  :ITMCLC1-PRNT-ITM-CLUSTR-ID ,                   24270000
228400                  :ITMCLC1-CHLD-ITM-CLUSTR-ID                     24280000
228500           FROM   TITMCLC                                         24290000
228600           WHERE PRNT_ITM_CLUSTR_ID =:ITMCLC-PRNT-ITM-CLUSTR-ID   24300000
228700             AND CHLD_ITM_CLUSTR_ID =:ITMCLC-CHLD-ITM-CLUSTR-ID   24310000
228800           AND  ( EFF_END_TMST > :PV-CURRENT-TMST                 24320000
228900                  OR EFF_END_TMST IS NULL)                        24330000
229000     END-EXEC.                                                    24340000
229100                                                                  24350000
229200     EVALUATE TRUE                                                24360000
229300       WHEN SQLCODE = ZEROS                                       24370000
229400         IF ITMCLC1-PRNT-ITM-CLUSTR-ID                            24380000
229500            NOT = ITMCLC-PRNT-ITM-CLUSTR-ID                       24390000
229600*           DISPLAY 'B450 SQLCODE = 0'                            24400006
229700            PERFORM C700-INSERT-ITMCLC                            24410000
229800            MOVE ITMCLC1-PRNT-ITM-CLUSTR-ID                       24420000
229900                 TO ITMCLC-PRNT-ITM-CLUSTR-ID                     24430000
230000            MOVE ITMCLC1-CHLD-ITM-CLUSTR-ID                       24440000
230100                 TO ITMCLC-CHLD-ITM-CLUSTR-ID                     24450000
**TEMP*        DISPLAY ' B450 CALL TO C500-EXPIRE-RELATIONSHIPS'        24451027
**TEMP*        ADD +1 TO PV-INS-UPD-COUNT                               24452027
                  PERFORM C500-EXPIRE-RELATIONSHIPS                     24460027
230300         END-IF                                                   24470000
230400       WHEN SQLCODE = 1403                                        24480000
230500*        DISPLAY 'B450 SQLCODE = 1403'                            24490006
230600*        DISPLAY 'THERE IS NO MATCH THE RECORD IN THE TITMCLC'    24500006
230700*        DISPLAY 'FOR CHLD_CLUSTR_ID=' ITMCLC-CHLD-ITM-CLUSTR-ID  24510006
**TEMP*        DISPLAY ' B450 CALL TO C700-INSERT-ITMCLC '              24511027
**TEMP*        ADD +1 TO PV-INS-UPD-COUNT                               24512027
               PERFORM C700-INSERT-ITMCLC                               24520027
230900       WHEN OTHER                                                 24530000
231000         DISPLAY PV-ABEND-PARAGRAPH                               24540000
231100         PERFORM Z999-SQL-ERROR                                   24550000
231200     END-EVALUATE.                                                24560000
231300*                                                                 24570000
231400*                                                                 24580000
231500*                                                                 24590000
231600***********************************************************       24600000
231700* B470-ASSIGN-VAR-TO-ITMCL                                        24610000
231800* AS001  - ASSIGN THE ITMCLC AND ITMCLT VAR FROM THE MDSEAR       24620000
231900************************************************************      24630000
232000 B470-ASSIGN-VAR-TO-ITMCL.                                        24640000
232100     MOVE 'B470-ASSIGN-VAR-TO-ITMCL' TO PV-ABEND-PARAGRAPH.       24650000
232200*    DISPLAY 'B470-ASSIGN-VAR-TO-ITMCL'.                          24660006
232300     MOVE PV-INITIAL-STRT-TMST TO ITMCLT-EFF-BEG-TMST             24670000
232400                                  ITMCLC-EFF-BEG-TMST.            24680000
232500     MOVE PV-INITIAL-END-TMST  TO ITMCLT-EFF-END-TMST             24690000
232600                                  ITMCLC-EFF-END-TMST.            24700000
232700                                                                  24710000
232800     MOVE PV-MDSEAR-STRT-DTE   TO ITMCLT-EFF-BEG-TMST(1:10)       24720000
232900                                  ITMCLC-EFF-BEG-TMST(1:10).      24730000
233000                                                                  24740000
233100     IF PV-MDSEAR-END-DTE = '9999-09-09'                          24750000
233200                                                                  24760000
233300          MOVE PC-NEG-1    TO PV-EFF-END-DTE-NULL                 24770000
233400          MOVE LOW-VALUES  TO ITMCLT-EFF-END-TMST                 24780000
233500                              ITMCLC-EFF-END-TMST                 24790000
233600     ELSE                                                         24800000
233700          MOVE ZERO        TO PV-EFF-END-DTE-NULL                 24810000
233800          MOVE PV-MDSEAR-END-DTE  TO ITMCLT-EFF-END-TMST(1:10)    24820000
233900                                   ITMCLC-EFF-END-TMST(1:10)      24830000
234000     END-IF.                                                      24840000
234100                                                                  24850000
234200******************************************************************24860000
234300*                                                                *24870000
234400*                                                                *24880000
234500******************************************************************24890000
234600 C000-FETCH-TMDSEAR-CURSOR.                                       24900000
234700                                                                  24910000
234800*    DISPLAY 'C000-FETCH-TMDSEAR-CURSOR'.                         24920006
234900     MOVE 'C000-FETCH-TMDSEAR-CURSOR' TO PV-ABEND-PARAGRAPH.      24930000
235000                                                                  24940000
235100     EXEC SQL                                                     24950000
235200       FETCH  MDSEARCSR                                           24960000
235300       INTO  :MDSEAR-GMA-NBR,                                     24970000
235400             :MDSEAR-DMA-NBR,                                     24980000
235500             :MDSEAR-DEPT-NBR,                                    24990000
235600             :MDSEAR-MAJ-CL-NBR,                                  25000000
235700             :MDSEAR-SUB-CL-NBR,                                  25010000
235800             :MDSEAR-MDSELV-CDE,                                  25020000
235900             :MDSEAR-DESC,                                        25030000
236000             :MDSEAR-CRE-DTE-TMST,                                25040000
236100             :MDSEAR-CHG-DTE-TMST,                                25050000
236200             :MDSEAR-STRT-DTE-TMST,                               25060000
236300             :MDSEAR-END-DTE-TMST                                 25070000
236400     END-EXEC.                                                    25080000
236500                                                                  25090000
236600     EVALUATE TRUE                                                25100000
236700       WHEN SQLCODE = ZEROS                                       25110000
236800         MOVE MDSEAR-CRE-DTE-TMST TO PV-MDSEAR-CRE-DTE            25120000
236900         MOVE MDSEAR-CHG-DTE-TMST TO PV-MDSEAR-CHG-DTE            25130000
237000         MOVE MDSEAR-STRT-DTE-TMST TO PV-MDSEAR-STRT-DTE          25140000
237100         MOVE MDSEAR-END-DTE-TMST TO PV-MDSEAR-END-DTE            25150000
237200         MOVE MDSEAR-GMA-NBR      TO PV-MDSEAR-GMA-NBR            25160000
237300         MOVE MDSEAR-DMA-NBR      TO PV-MDSEAR-DMA-NBR            25170000
237400         MOVE MDSEAR-DEPT-NBR     TO PV-MDSEAR-DEPT-NBR           25180000
237500         MOVE MDSEAR-MAJ-CL-NBR   TO PV-MDSEAR-MAJ-CL-NBR         25190000
237600         MOVE MDSEAR-SUB-CL-NBR   TO PV-MDSEAR-SUB-CL-NBR         25200000
237700         MOVE MDSEAR-MDSELV-CDE   TO PV-MDSEAR-MDSELV-CDE         25210000
237800       WHEN SQLCODE = 1403                                        25220000
237900         SET PS-NO-MORE-CLUSTERS-LEFT TO TRUE                     25230000
238000       WHEN OTHER                                                 25240000
238100         DISPLAY PV-ABEND-PARAGRAPH                               25250000
238200         PERFORM Z999-SQL-ERROR                                   25260000
238300     END-EVALUATE.                                                25270000
238400                                                                  25280000
238500***************************************************************** 25290000
238600*                                                               * 25300000
238700***************************************************************** 25310000
238800 C100-PROCESS-INSERT.                                             25320000
238900*    DISPLAY 'C100-PROCESS-INSERT'.                               25330006
239000     MOVE PV-INITIAL-STRT-TMST  TO ITMCLT-EFF-BEG-TMST.           25340000
239100     MOVE PV-MDSEAR-STRT-DTE    TO ITMCLT-EFF-BEG-TMST(1:10).     25350000
239200     MOVE 'C'                   TO ITMCLC-CHLD-ITM-CLSTR-CDE.     25360000
239300     MOVE ZEROES                TO PV-CHLD-CDE-NULL.              25370000
239400                                                                  25380000
**TEMP*    DISPLAY ' C100 CALL TO C200-INSERT-TITMCLT'                  25390027
**TEMP*    ADD +1 TO PV-INS-UPD-COUNT                                   25400027
           PERFORM  C200-INSERT-TITMCLT.                                25410027
239600                                                                  25420000
239700     IF SQLCODE = ZERO  AND                                       25430000
239800        MDSEAR-MDSELV-CDE NOT = 'GMA'                             25440000
**TEMP*    DISPLAY ' C100 CALL TO C700-INSERT-ITMCLC'                   25450027
**TEMP*    ADD +1 TO PV-INS-UPD-COUNT                                   25460027
              PERFORM C700-INSERT-ITMCLC                                25470027
240000     END-IF.                                                      25480000
240100                                                                  25490000
240200***************************************************************** 25500000
240300*                                                               * 25510000
240400***************************************************************** 25520000
240500 C200-INSERT-TITMCLT.                                             25530000
240600                                                                  25540000
240700     MOVE 'C200-INSERT-TITMCLT'                                   25550000
240800               TO  PV-ABEND-PARAGRAPH.                            25560000
240900                                                                  25570000
241000       PERFORM X100-REPLACE-SPEC-CHARS.                           25580000
241100                                                                  25590000
241200                                                                  25600000
241300       PERFORM C250-CREATE-CLUSTR-ID.                             25610000
241400* CAF CHANGES *                                                   25620000
241500       IF ITMCLT-HIER-CDE = 'DPT'                                 25630000
241600           MOVE ITMCLT-ITEM-CLUSTR-ID TO ITMCLT-OWNER-ID          25640000
241700       END-IF.                                                    25650000
241800* CAF CHANGES END*                                                25660000
241900                                                                  25670000
242000       IF ITMCLT-HIER-CDE = LOW-VALUES                            25680000
242100           MOVE FS500I-NI-SKU TO ITMCLT-SKU                       25690000
242200           MOVE ZERO TO PV-RMS-SKU-NULL                           25700000
242300       ELSE                                                       25710000
242400           MOVE ZEROS TO PV-RMS-SKU                               25720000
242500           MOVE -1 TO PV-RMS-SKU-NULL                             25730000
242600       END-IF.                                                    25740000
242700                                                                  25750000
242800       MOVE ITMCLT-ITEM-CLUSTR-ID  TO ITMCLC-CHLD-ITM-CLUSTR-ID.  25760000
242900       MOVE PC-NEG-1               TO PV-EFF-END-DTE-NULL.        25770000
243000                                                                  25780000
243100     EXEC SQL                                                     25790000
243200       INSERT INTO   TITMCLT                                      25800000
243300            (ITEM_CLUSTR_ID,                                      25810000
243400             ITEM_CLUSTR_NAME,                                    25820000
243500             ITEM_CLUSTR_DESC,                                    25830000
243600             ITEM_CLUSTR_CDE,                                     25840000
243700             EFF_BEG_TMST,                                        25850000
243800             EFF_END_TMST,                                        25860000
243900             CLUSTR_TYP_CDE,                                      25870000
244000             HIER_TYP_CDE,                                        25880000
244100             HIER_CDE,                                            25890000
244200             MDSE_NM_CDE,                                         25900000
244300             PROD_SERV_CDE,                                       25910000
244400             CRE_BY_UID,                                          25920000
244500             CRE_TMST,                                            25930000
244600             LAST_UPD_BY_UID,                                     25940000
244700             LAST_UPD_TMST,                                       25950000
244800             OWNER_ID,                                            25960000
244900             SKU)                                                 25970000
245000         VALUES                                                   25980000
245100            (:ITMCLT-ITEM-CLUSTR-ID,                              25990000
245200             :ITMCLT-ITEM-CLUSTR-NAME,                            26000000
245300             :ITMCLT-ITEM-CLUSTR-DESC,                            26010000
245400             :ITMCLT-ITEM-CLUSTR-CDE,                             26020000
245500             :ITMCLT-EFF-BEG-TMST,                                26030000
245600             :ITMCLT-EFF-END-TMST:PV-EFF-END-DTE-NULL,            26040000
245700             :ITMCLT-CLUSTR-TYP-CDE:PV-CLUSTR-TYP-CDE-NULL,       26050000
245800             :ITMCLT-HIER-TYP-CDE:PV-HIER-TYP-CDE-NULL,           26060000
245900             :ITMCLT-HIER-CDE:PV-HIER-CDE-NULL,                   26070000
246000             :ITMCLT-MDSE-NM-CDE:PV-MDSE-NM-CDE-NULL,             26080000
246100             :ITMCLT-PROD-SERV-CDE:PV-PROD-SERV-CDE-NULL,         26090000
246200             'MAKUT102',                                          26100000
246300             SYSDATE,                                             26110000
246400             'MAKUT102',                                          26120000
246500             SYSDATE,                                             26130000
246600             :ITMCLT-OWNER-ID:PV-OWNER-ID-NULL,                   26140000
246700             :ITMCLT-SKU:PV-RMS-SKU-NULL)                         26150000
246800     END-EXEC.                                                    26160000
246900                                                                  26170000
247000     EVALUATE TRUE                                                26180000
247100       WHEN SQLCODE = ZEROS                                       26190000
0822RM          ADD +1 TO PV-INS-UPD-COUNT                              26200022
0822RM*        DISPLAY 'INSERT CLUSTER :'                               26210011
0822RM*        DISPLAY 'ITEM-CLUSTR-ID   = ' ITMCLT-ITEM-CLUSTR-ID      26220011
0822RM*        DISPLAY 'ITEM-CLUSTR-NAME = ' ITMCLT-ITEM-CLUSTR-NAME    26230011
0822RM*        DISPLAY 'ITEM-CLUSTR-DESC = ' ITMCLT-ITEM-CLUSTR-DESC    26240011
0822RM*        DISPLAY 'HIER-CDE         = ' ITMCLT-HIER-CDE            26250011
0822RM*        DISPLAY '*******************************************'    26260011
247800                                                                  26270000
247900       WHEN OTHER                                                 26280000
248000         DISPLAY 'INSERT CLUSTER :'                               26290000
248100         DISPLAY 'ITEM-CLUSTR-ID   = ' ITMCLT-ITEM-CLUSTR-ID      26300000
248200         DISPLAY 'ITEM-CLUSTR-NAME = ' ITMCLT-ITEM-CLUSTR-NAME    26310000
248300         DISPLAY 'ITEM-CLUSTR-DESC = ' ITMCLT-ITEM-CLUSTR-DESC    26320000
248400         DISPLAY 'HIER-CDE         = ' ITMCLT-HIER-CDE            26330000
248500         DISPLAY 'HIER-CDE-NULL    = ' PV-HIER-CDE-NULL           26340000
248600       DISPLAY 'ITMCLT-ITEM-CLUSTR-CDE= '                         26350000
248700                               ITMCLT-ITEM-CLUSTR-CDE             26360000
248800       DISPLAY 'ITMCLT-EFF-BEG-TMST   = ' ITMCLT-EFF-BEG-TMST     26370000
248900       DISPLAY 'ITMCLT-EFF-END-TMST   = ' ITMCLT-EFF-END-TMST     26380000
249000       DISPLAY 'ITMCLT-EFF-END-TMST-NULL= ' PV-EFF-END-DTE-NULL   26390000
249100       DISPLAY 'ITMCLT-CLUSTR-TYP-CDE = ' ITMCLT-CLUSTR-TYP-CDE   26400000
249200      DISPLAY 'ITMCLT-CLUSTR-TYP-CDE-NULL=' PV-CLUSTR-TYP-CDE-NULL26410000
249300       DISPLAY 'ITMCLT-HIER-TYP-CDE   = ' ITMCLT-HIER-TYP-CDE     26420000
249400       DISPLAY 'ITMCLT-HIER-TYP-CDE-NULL='   PV-HIER-TYP-CDE-NULL 26430000
249500       DISPLAY 'ITMCLT-MDSE-NM-CDE    = ' ITMCLT-MDSE-NM-CDE      26440000
249600       DISPLAY 'ITMCLT-MDSE-NM-CDE-NULL= '    PV-MDSE-NM-CDE-NULL 26450000
249700       DISPLAY 'ITMCLT-PROD-SERV-CDE  = ' ITMCLT-PROD-SERV-CDE    26460000
249800       DISPLAY 'ITMCLT-PROD-SERV-CDE-NULL='  PV-PROD-SERV-CDE-NULL26470000
249900       DISPLAY 'ITMCLT-OWNER-ID       = ' ITMCLT-OWNER-ID         26480000
250000       DISPLAY 'ITMCLT-OWNER-ID-NULL= '   PV-OWNER-ID-NULL        26490000
250100         DISPLAY '*******************************************'    26500000
250200         DISPLAY PV-ABEND-PARAGRAPH                               26510000
250300         PERFORM Z999-SQL-ERROR                                   26520000
250400     END-EVALUATE.                                                26530000
250500                                                                  26540000
250600                                                                  26550000
250700***************************************************************** 26560000
250800*     CREATE CLUSTER ID                                         * 26570000
250900*                                                               * 26580000
251000***************************************************************** 26590000
251100 C250-CREATE-CLUSTR-ID.                                           26600020
251200                                                                  26610000
251300                                                                  26620000
251400     MOVE 'C250-CREATE-CLUSTR-ID'  TO   PV-ABEND-PARAGRAPH.       26630000
251500                                                                  26640000
251600                                                                  26650000
251700     EXEC SQL                                                     26660000
251800         SELECT ITEM_CLUSTR_SEQ.NEXTVAL                           26670000
251900         INTO   :ITMCLT-ITEM-CLUSTR-ID                            26680000
252000         FROM DUAL                                                26690000
252100     END-EXEC.                                                    26700000
252200                                                                  26710000
252300     EVALUATE TRUE                                                26720000
252400       WHEN SQLCODE = ZEROS                                       26730000
252500         CONTINUE                                                 26740000
252600       WHEN OTHER                                                 26750000
252700         DISPLAY PV-ABEND-PARAGRAPH                               26760000
252800         PERFORM Z999-SQL-ERROR                                   26770000
252900     END-EVALUATE.                                                26780000
253000                                                                  26790000
253100                                                                  26800000
253200***************************************************************** 26810000
253300* PERFORMS UPDATE OR EXPIRE DEPENDING ON END DATE               * 26820000
253400***************************************************************** 26830000
253500 C300-PROCESS-UPDATE.                                             26840000
253600                                                                  26850000
253700*    DISPLAY 'C300-PROCESS-UPDATE'.                               26860006
253800     IF PV-MDSEAR-END-DTE = PV-INPUT-DTE                          26870000
253900                                                                  26880000
254000         PERFORM  C400-EXPIRE-PARNT-REL                           26890000
254100                                                                  26900000
254200     ELSE                                                         26910000
254300                                                                  26920000
254400         PERFORM  C350-UPDATE-CLUSTER                             26930000
254500                                                                  26940000
254600     END-IF.                                                      26950000
254700                                                                  26960000
254800                                                                  26970000
254900***************************************************************** 26980000
255000*                                                               * 26990000
255100***************************************************************** 27000000
255200 C350-UPDATE-CLUSTER.                                             27010000
255300*    DISPLAY 'C350-UPDATE-CLUSTER'.                               27020006
255400     MOVE 'C350-UPDATE-CLUSTER'                                   27030000
255500               TO  PV-ABEND-PARAGRAPH.                            27040000
255600                                                                  27050000
255700     PERFORM X100-REPLACE-SPEC-CHARS.                             27060000
255800                                                                  27070000
255900     IF ITMCLT-HIER-CDE = LOW-VALUES                              27080000
256000         MOVE FS500I-NI-SKU TO ITMCLT-SKU                         27090000
256100         MOVE ZERO TO PV-RMS-SKU-NULL                             27100000
256200     ELSE                                                         27110000
256300         MOVE ZEROS TO PV-RMS-SKU                                 27120000
256400         MOVE -1 TO PV-RMS-SKU-NULL                               27130000
256500     END-IF.                                                      27140000
256600                                                                  27150000
256700                                                                  27160000
256800     IF ITMCLT-HIER-CDE = LOW-VALUES                              27170000
256900*    DISPLAY 'C350 ITMCLT-HIER-CDE = LOW-VALUES'                  27180006
257000     EXEC SQL                                                     27190000
257100       UPDATE   TITMCLT                                           27200000
257200        SET  ITEM_CLUSTR_DESC    = :ITMCLT-ITEM-CLUSTR-DESC,      27210000
257300             ITEM_CLUSTR_NAME    = :ITMCLT-ITEM-CLUSTR-NAME,      27220000
257400             EFF_BEG_TMST        = :ITMCLT-EFF-BEG-TMST,          27230000
257500             EFF_END_TMST        =                                27240000
257600                    :ITMCLT-EFF-END-TMST:PV-EFF-END-DTE-NULL,     27250000
257700             LAST_UPD_TMST       =  SYSDATE,                      27260000
257800             LAST_UPD_BY_UID     = 'MAKUT102',                    27270000
257900             SKU                 = :ITMCLT-SKU:PV-RMS-SKU-NULL    27280000
258000         WHERE                                                    27290000
258100                ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME       27300000
258200           AND  HIER_CDE         IS NULL                          27310000
258300           AND  ITEM_CLUSTR_CDE  = :ITMCLT-ITEM-CLUSTR-CDE        27320000
258400           AND  ((EFF_END_TMST IS NULL) OR                        27330000
258500                (EFF_END_TMST > :PV-CURR-END-TMST))               27340000
258600     END-EXEC                                                     27350000
258700                                                                  27360000
258800     EVALUATE TRUE                                                27370000
258900       WHEN SQLCODE = ZEROS                                       27380000
259000         ADD +1 TO PV-MDSEAR-UPDATE                               27390000
0822RM         ADD +1 TO PV-INS-UPD-COUNT                               27400022
0822RM*        DISPLAY 'UPDATED CLUSTER :'                              27410015
0822RM*        DISPLAY '   ITEM-CLUSTR-NAME =' ITMCLT-ITEM-CLUSTR-NAME  27420015
0822RM*        DISPLAY '   ITEM-CLUSTR-DESC =' ITMCLT-ITEM-CLUSTR-DESC  27430015
0822RM*        DISPLAY '   EFF-BEG-TMST     =' ITMCLT-EFF-BEG-TMST      27440015
0822RM*        DISPLAY '   EFF-END-TMST     =' ITMCLT-EFF-END-TMST      27450015
0822RM*        DISPLAY '   ITEM-CLUSTR-CDE =' ITMCLT-ITEM-CLUSTR-CDE    27460015
259700                                                                  27470000
259800       WHEN SQLCODE = +1403                                       27480000
259900         DISPLAY 'CAN NOT UPDATE - CLUSTER DOES NOT EXIST:'       27490000
260000         DISPLAY '   ITEM-CLUSTR-NAME =' ITMCLT-ITEM-CLUSTR-NAME  27500000
260100         DISPLAY '   ITEM-CLUSTR-DESC =' ITMCLT-ITEM-CLUSTR-DESC  27510000
260200         DISPLAY '   EFF-BEG-TMST     =' ITMCLT-EFF-BEG-TMST      27520000
260300         DISPLAY '   EFF-END-TMST     =' ITMCLT-EFF-END-TMST      27530000
260400         DISPLAY '   ITEM-CLUSTR-CDE =' ITMCLT-ITEM-CLUSTR-CDE    27540000
260500       WHEN OTHER                                                 27550000
260600         DISPLAY 'CAN NOT UPDATE CLUSTER:'                        27560000
260700         DISPLAY '   ITEM-CLUSTR-NAME =' ITMCLT-ITEM-CLUSTR-NAME  27570000
260800         DISPLAY '   ITEM-CLUSTR-DESC =' ITMCLT-ITEM-CLUSTR-DESC  27580000
260900         DISPLAY '   EFF-BEG-TMST     =' ITMCLT-EFF-BEG-TMST      27590000
261000         DISPLAY '   EFF-END-TMST     =' ITMCLT-EFF-END-TMST      27600000
261100         DISPLAY '   EFF-END-TMST-NULL=' PV-EFF-END-DTE-NULL      27610000
261200         DISPLAY '   ITEM-CLUSTR-CDE =' ITMCLT-ITEM-CLUSTR-CDE    27620000
261300         DISPLAY PV-ABEND-PARAGRAPH                               27630000
261400         PERFORM Z999-SQL-ERROR                                   27640000
261500     END-EVALUATE                                                 27650000
261600                                                                  27660000
261700                                                                  27670000
261800     ELSE                                                         27680000
261900                                                                  27690000
262000*    DISPLAY 'C350 ITMCLT-HIER-CDE NOT = LOW-VALUES'              27700006
262100     EXEC SQL                                                     27710000
262200       UPDATE   TITMCLT                                           27720000
262300        SET  ITEM_CLUSTR_DESC    = :ITMCLT-ITEM-CLUSTR-DESC,      27730000
262400             ITEM_CLUSTR_NAME    = :ITMCLT-ITEM-CLUSTR-NAME,      27740000
262500             EFF_BEG_TMST        = :ITMCLT-EFF-BEG-TMST,          27750000
262600             EFF_END_TMST        =                                27760000
262700                    :ITMCLT-EFF-END-TMST:PV-EFF-END-DTE-NULL,     27770000
262800             LAST_UPD_TMST       =  SYSDATE,                      27780000
262900             LAST_UPD_BY_UID     = 'MAKUT102'                     27790000
263000         WHERE                                                    27800000
263100                ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME       27810000
263200           AND ITEM_CLUSTR_CDE   = :ITMCLT-ITEM-CLUSTR-CDE        27820000
263300           AND  HIER_CDE         = :ITMCLT-HIER-CDE               27830000
263400           AND  ((EFF_END_TMST IS NULL) OR                        27840000
263500                (EFF_END_TMST > :PV-CURR-END-TMST))               27850000
263600     END-EXEC                                                     27860000
263700                                                                  27870000
263800     EVALUATE TRUE                                                27880000
263900       WHEN SQLCODE = ZEROS                                       27890000
0822RM*        DISPLAY 'UPDATED CLUSTER :'                              27900009
264100         ADD +1 TO PV-MDSEAR-UPDATE                               27910000
0822RM         ADD +1 TO PV-INS-UPD-COUNT                               27920022
0822RM*        DISPLAY '   ITEM-CLUSTR-NAME =' ITMCLT-ITEM-CLUSTR-NAME  27930009
0822RM*        DISPLAY '   ITEM-CLUSTR-DESC =' ITMCLT-ITEM-CLUSTR-DESC  27940009
0822RM*        DISPLAY '   EFF-BEG-TMST     =' ITMCLT-EFF-BEG-TMST      27950009
0822RM*        DISPLAY '   EFF-END-TMST     =' ITMCLT-EFF-END-TMST      27960009
0822RM*        DISPLAY '   ITEM-CLUSTR-CDE =' ITMCLT-ITEM-CLUSTR-CDE    27970009
264700                                                                  27980000
264800       WHEN SQLCODE = +1403                                       27990000
264900         DISPLAY 'CAN NOT UPDATE - CLUSTER DOES NOT EXIST:'       28000000
265000         DISPLAY '   ITEM-CLUSTR-NAME =' ITMCLT-ITEM-CLUSTR-NAME  28010000
265100         DISPLAY '   ITEM-CLUSTR-DESC =' ITMCLT-ITEM-CLUSTR-DESC  28020000
265200         DISPLAY '   EFF-BEG-TMST     =' ITMCLT-EFF-BEG-TMST      28030000
265300         DISPLAY '   EFF-END-TMST     =' ITMCLT-EFF-END-TMST      28040000
265400         DISPLAY '   ITEM-CLUSTR-CDE =' ITMCLT-ITEM-CLUSTR-CDE    28050000
265500       WHEN OTHER                                                 28060000
265600         DISPLAY 'CAN NOT UPDATE CLUSTER :'                       28070000
265700         DISPLAY '   ITEM-CLUSTR-NAME =' ITMCLT-ITEM-CLUSTR-NAME  28080000
265800         DISPLAY '   ITEM-CLUSTR-DESC =' ITMCLT-ITEM-CLUSTR-DESC  28090000
265900         DISPLAY '   EFF-BEG-TMST     =' ITMCLT-EFF-BEG-TMST      28100000
266000         DISPLAY '   EFF-END-TMST     =' ITMCLT-EFF-END-TMST      28110000
266100         DISPLAY '   EFF-END-TMST-NULL=' PV-EFF-END-DTE-NULL      28120000
266200         DISPLAY '   ITEM-CLUSTR-CDE =' ITMCLT-ITEM-CLUSTR-CDE    28130000
266300         DISPLAY PV-ABEND-PARAGRAPH                               28140000
266400         PERFORM Z999-SQL-ERROR                                   28150000
266500     END-EVALUATE                                                 28160000
266600                                                                  28170000
266700     END-IF.                                                      28180000
266800                                                                  28190000
266900     IF SQLCODE = ZERO                                            28200000
0822RM*         DISPLAY 'IN C350 SQLCODE = ZERO'                        28210009
267100          PERFORM C360-UPDATE-REL                                 28220000
267200     END-IF.                                                      28230000
267300                                                                  28240000
267400***************************************************************** 28250000
267500*                                                               * 28260000
267600***************************************************************** 28270000
267700 C360-UPDATE-REL.                                                 28280000
267800                                                                  28290000
267900*    DISPLAY 'C360-UPDATE-REL'.                                   28300006
268000*    DISPLAY  'CALLING PARAGRAPH : ' PV-CALLING-PARA              28310006
268100     MOVE 'C360-UPDATE-REL    '                                   28320000
268200               TO  PV-ABEND-PARAGRAPH.                            28330000
268300*                                                                 28340000
268400* CHOOSE THE CORRECT END DATE BASED ON THE CALLING PARAGRAPH.     28350035
268500*                                                                 28360000
268600     EVALUATE TRUE                                                28370000
268700       WHEN PV-CALLING-PARA = 'B200'                              28380000
268800          IF MDSEAR-END-DTE-TMST(1:4) = '9999'                    28390000
268900*            DISPLAY 'CALLING-PARA = B200'                        28400006
269000*            DISPLAY 'C360 MDSEAR-END-DTE-TMST = 9999'            28410006
269100             MOVE LOW-VALUES TO PV-NEW-END-DTE                    28420000
269200             MOVE PC-NEG-1 TO PV-NEW-END-DTE-NULL                 28430000
269300          ELSE                                                    28440000
269400*            DISPLAY 'CALLING-PARA = B200'                        28450006
269500*            DISPLAY 'C360 MDSEAR-END-DTE-TMST NOT = 9999'        28460006
269600*            DISPLAY 'MDSEAR-END-DTE-TMST:  '                     28470006
269700*            DISPLAY MDSEAR-END-DTE-TMST                          28480006
269800             MOVE 0 TO PV-NEW-END-DTE-NULL                        28490000
269900             MOVE MDSEAR-END-DTE-TMST TO PV-NEW-END-DTE           28500000
270000          END-IF                                                  28510000
270100       WHEN OTHER                                                 28520000
270200*         DISPLAY 'CALLING-PARA NOT = B200'                       28530006
270300*         DISPLAY 'ITMCLT-EFF-END-TMST:  '                        28540006
270400*         DISPLAY ITMCLT-EFF-END-TMST                             28550006
270500          MOVE ITMCLT-EFF-END-TMST TO PV-NEW-END-DTE              28560000
270600          MOVE PV-EFF-END-DTE-NULL TO PV-NEW-END-DTE-NULL         28570000
270700     END-EVALUATE.                                                28580000
270800                                                                  28590000
270900*     DISPLAY 'C360 - ITMCLT-ITEM-CLUSTR-ID:  '.                  28600006
271000      MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-1.          28610000
271100*     DISPLAY PV-WORK-CLUSTR-ID-1.                                28620006
0822RM*** COMMENT OUT SQL  - WS-ROW-COUNT NOT USED                      28621030
**TEMP      ADD 1 TO WS-ROW-COUNT-CTR                                   28622035
0822RM*     EXEC SQL                                                    28630032
0822RM*       SELECT COUNT(*)                                           28640032
0822RM*       INTO WS-ROW-COUNT                                         28650032
0822RM*       FROM TITMCLC                                              28660032
0822RM*         WHERE                                                   28670032
0822RM*               ((EFF_END_TMST IS NULL) OR                        28680032
0822RM*               (EFF_END_TMST > :PV-CURR-END-TMST))               28690032
0822RM*           AND (PRNT_ITM_CLUSTR_ID = :ITMCLT-ITEM-CLUSTR-ID      28700032
0822RM*            OR  CHLD_ITM_CLUSTR_ID = :ITMCLT-ITEM-CLUSTR-ID)     28710032
0822RM*     END-EXEC.                                                   28720032
272200                                                                  28730000
272300*     DISPLAY 'C360 - ROW COUNT BEFORE UPDATE: '.                 28740006
272400*     DISPLAY WS-ROW-COUNT.                                       28750006
272500**                                                                28760000
272600*     IF PV-MDSEAR-CRE-DTE = PV-INPUT-DTE                         28770000
272700*     AND PV-MDSEAR-MDSELV-CDE = 'SCL'                            28780000
272800*     DISPLAY 'HAVE SUBCLASS TO SKU UPDATE'                       28790000
272900*       EXEC SQL                                                  28800000
273000*       UPDATE TITMCLC                                            28810000
273100*         SET                                                     28820000
273200*           EFF_END_TMST        =                                 28830000
273300*                 :PV-NEW-END-DTE:PV-NEW-END-DTE-NULL,            28840000
273400*           LAST_UPD_TMST = SYSDATE,                              28850000
273500*           LAST_UPD_BY_UID = 'MAKUT102'                          28860000
273600*       WHERE                                                     28870000
273700*           (EFF_END_TMST >= (TO_DATE (:PV-CURR-STRT-TMST,        28880000
273800*           'YYYY-MM-DD-HH24.MI.SS') - 1))                        28890000
273900*         AND PRNT_ITM_CLUSTR_ID = :ITMCLT-ITEM-CLUSTR-ID         28900000
274000*       END-EXEC                                                  28910000
274100*     ELSE                                                        28920000
274200**                                                                28930000
274300      EXEC SQL                                                    28940000
274400        UPDATE TITMCLC                                            28950000
274500            SET                                                   28960000
274600              EFF_END_TMST        =                               28970000
274700                    :PV-NEW-END-DTE:PV-NEW-END-DTE-NULL,          28980000
274800              LAST_UPD_TMST = SYSDATE,                            28990000
274900              LAST_UPD_BY_UID = 'MAKUT102'                        29000000
275000          WHERE                                                   29010000
275100                ((EFF_END_TMST IS NULL) OR                        29020000
275200                (EFF_END_TMST > :PV-CURR-END-TMST))               29030000
275300            AND (PRNT_ITM_CLUSTR_ID = :ITMCLT-ITEM-CLUSTR-ID      29040000
275400             OR  CHLD_ITM_CLUSTR_ID = :ITMCLT-ITEM-CLUSTR-ID)     29050000
275500      END-EXEC.                                                   29060000
275600                                                                  29070000
275700     EVALUATE TRUE                                                29080000
275800       WHEN SQLCODE = ZEROS                                       29090000
275900*         DISPLAY 'C360 SQLCODE = 0'                              29100006
0822RM*         CONTINUE                                                29110015
0822RM          ADD +1 TO PV-INS-UPD-COUNT                              29120022
276000       WHEN SQLCODE = 1403                                        29130000
276100*         DISPLAY 'C360 SQLCODE = 1403'                           29140006
276200                                                                  29150000
276300          CONTINUE                                                29160000
276400                                                                  29170000
276500       WHEN OTHER                                                 29180000
276600         DISPLAY PV-ABEND-PARAGRAPH                               29190000
276700         PERFORM Z999-SQL-ERROR                                   29200000
276800     END-EVALUATE.                                                29210000
276900                                                                  29220000
277000     MOVE SPACES                    TO PV-CALLING-PARA.           29230000
277100                                                                  29240000
277200******************************************************************29250000
277300*                                                                *29260000
277400* EXPIRE ALL RELATIONSHIPS WITH PARENTS FOR SELECTED CLUSTER     *29270000
277500* AND THAN EXPIRE CLUSTER ITSELF.                                *29280000
277600*                                                                *29290000
277700******************************************************************29300000
277800 C400-EXPIRE-PARNT-REL.                                           29310000
277900*     DISPLAY 'C400-EXPIRE-PARNT-REL'.                            29320006
278000                                                                  29330000
278100      PERFORM X100-REPLACE-SPEC-CHARS.                            29340000
278200                                                                  29350000
278300      SET PS-MORE-PARENTS TO TRUE.                                29360000
278400                                                                  29370000
278500      IF ITMCLT-HIER-CDE = LOW-VALUES                             29380000
278600                                                                  29390000
278700          PERFORM  D200-OPEN-PARNT-CSR                            29400000
278800                                                                  29410000
278900          PERFORM  D220-FETCH-PARNT-CSR                           29420000
279000            UNTIL  PS-NO-MORE-PARENTS                             29430000
279100                                                                  29440000
279200          PERFORM  D230-CLOSE-PARNT-CSR                           29450000
279300                                                                  29460000
279400      ELSE                                                        29470000
279500          PERFORM  D201-OPEN-PARNT-CSR1                           29480000
279600                                                                  29490000
279700          PERFORM  D221-FETCH-PARNT-CSR1                          29500000
279800            UNTIL  PS-NO-MORE-PARENTS                             29510000
279900                                                                  29520000
280000          PERFORM  D231-CLOSE-PARNT-CSR1                          29530000
280100                                                                  29540000
280200      END-IF                                                      29550000
280300                                                                  29560000
280400      PERFORM  C450-EXPIRE-CLUSTER.                               29570000
280500                                                                  29580000
280600                                                                  29590000
280700******************************************************************29600000
280800*                                                                *29610000
280900* EXPIRE ALL RELATIONSHIPS WITH PARENTS FOR SELECTED SKU (ITEM)  *29620000
281000* AND THAN EXPIRE THE SKU ITSELF.                                *29630000
281100*                                                                *29640000
281200******************************************************************29650000
281300 C410-EXPIRE-SKU-PARNT-REL.                                       29660000
281400                                                                  29670000
281500      PERFORM X100-REPLACE-SPEC-CHARS.                            29680000
281600      SET PS-MORE-PARENTS TO TRUE.                                29690000
281700                                                                  29700000
281800      PERFORM  D250-OPEN-PARNT-CSR-SKU.                           29710000
281900                                                                  29720000
282000      PERFORM  D260-FETCH-N-EXPIRE-PRNT-REL                       29730000
282100        UNTIL  PS-NO-MORE-PARENTS.                                29740000
282200                                                                  29750000
282300      PERFORM  D270-CLOSE-PARNT-CSR-SKU.                          29760000
282400                                                                  29770000
282500                                                                  29780000
282600      PERFORM  C455-EXPIRE-CLUSTER-SKU.                           29790000
282700                                                                  29800000
282800                                                                  29810000
282900***************************************************************** 29820000
283000*                                                               * 29830000
283100***************************************************************** 29840000
283200 C450-EXPIRE-CLUSTER.                                             29850000
283300*    DISPLAY 'C450-EXPIRE-CLUSTER'.                               29860006
283400                                                                  29870000
283500     MOVE 'C450-EXPIRE-CLUSTER'                                   29880000
283600               TO  PV-ABEND-PARAGRAPH.                            29890000
283700                                                                  29900000
283800     PERFORM X100-REPLACE-SPEC-CHARS.                             29910000
283900*    DISPLAY 'ITEM-CLUSTR-NAME = ' ITMCLT-ITEM-CLUSTR-NAME.       29920006
284000*    DISPLAY 'HIER-CDE         = ' ITMCLT-HIER-CDE.               29930006
284100                                                                  29940000
284200     IF ITMCLT-HIER-CDE = LOW-VALUES                              29950000
284300*        DISPLAY 'C450 ITMCLT-HIER-CDE = LOW-VALUES'              29960006
0822RM*        DISPLAY 'ITEM-CLUSTR-NAME: ' ITMCLT-ITEM-CLUSTR-NAME     29970009
                                                                        29980012
284500         EXEC SQL                                                 29990000
284600           UPDATE   TITMCLT                                       30000000
284700           SET   EFF_END_TMST        = :PV-CURRENT-TMST,          30010000
284800                 LAST_UPD_BY_UID     = 'MAKUT102',                30020000
284900                 LAST_UPD_TMST       = SYSDATE                    30030000
285000           WHERE                                                  30040000
285100                    ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME   30050000
285200              AND   HIER_CDE         IS NULL                      30060000
285300              AND   CRE_TMST         < :PV-CURRENT-TMST           30070000
285400         END-EXEC                                                 30080000
285500                                                                  30090000
285600         EVALUATE TRUE                                            30100000
285700           WHEN SQLCODE = ZEROS                                   30110000
0822RM             ADD +1 TO PV-INS-UPD-COUNT                           30120022
285800*            DISPLAY 'CLUSTER EXPIRED.'                           30130012
285900           WHEN SQLCODE = 1403                                    30140000
286000             DISPLAY 'CLUSTER DOES NOT EXIST, NOT EXPIRED.'       30150007
286100           WHEN OTHER                                             30160000
286200             DISPLAY PV-ABEND-PARAGRAPH                           30170000
286300             PERFORM Z999-SQL-ERROR                               30180000
286400         END-EVALUATE                                             30190000
286500                                                                  30200000
286600     ELSE                                                         30210000
286700***  IF ITMCLT-HIER-CDE NOT = LOW-VALUES                          30220000
286800                                                                  30230000
286900*        DISPLAY 'C450 ITMCLT-HIER-CDE NOT = LOW-VALUES'          30240006
0822RM*        DISPLAY 'ITEM-CLUSTR-NAME: ' ITMCLT-ITEM-CLUSTR-NAME     30250009
287100         EXEC SQL                                                 30260000
287200           UPDATE   TITMCLT                                       30270000
287300           SET   EFF_END_TMST        = :PV-CURRENT-TMST,          30280000
287400                 LAST_UPD_BY_UID     = 'MAKUT102',                30290000
287500                 LAST_UPD_TMST       = SYSDATE                    30300000
287600           WHERE                                                  30310000
287700                    ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME   30320000
287800              AND   HIER_CDE         = :ITMCLT-HIER-CDE           30330000
287900              AND   CRE_TMST         < :PV-CURRENT-TMST           30340000
288000         END-EXEC                                                 30350000
288100                                                                  30360000
288200         EVALUATE TRUE                                            30370000
288300           WHEN SQLCODE = ZEROS                                   30380000
0822RM             ADD +1 TO PV-INS-UPD-COUNT                           30390022
288400*            DISPLAY 'CLUSTER EXPIRED.'                           30400012
288500           WHEN SQLCODE = 1403                                    30410000
288600             DISPLAY 'CLUSTER DOES NOT EXIST, NOT EXPIRED.'       30420000
288700           WHEN OTHER                                             30430000
288800             DISPLAY PV-ABEND-PARAGRAPH                           30440000
288900             PERFORM Z999-SQL-ERROR                               30450000
289000         END-EVALUATE                                             30460000
289100                                                                  30470000
289200     END-IF.                                                      30480000
289300                                                                  30490000
289400                                                                  30500000
289500                                                                  30510000
289600***************************************************************** 30520000
289700*                                                               * 30530000
289800***************************************************************** 30540000
289900 C455-EXPIRE-CLUSTER-SKU.                                         30550000
290000     MOVE 'C455-EXPIRE-CLUSTER-SKU'                               30560000
290100               TO  PV-ABEND-PARAGRAPH.                            30570000
290200     PERFORM  X100-REPLACE-SPEC-CHARS.                            30580000
0822RM*    DISPLAY 'EXPIRE ITEM-CLUSTR-NAME =' ITMCLT-ITEM-CLUSTR-NAME. 30590009
-822RM*    DISPLAY '     EFF_END_TMST > ' PV-CURR-END-TMST              30600009
290500                                                                  30610000
290600     EXEC SQL                                                     30620000
290700       UPDATE   TITMCLT                                           30630000
290800       SET   EFF_END_TMST        = :PV-CURRENT-TMST,              30640000
290900             LAST_UPD_BY_UID     = 'MAKUT102',                    30650000
291000             LAST_UPD_TMST       = SYSDATE                        30660000
291100       WHERE                                                      30670000
291200                ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME       30680000
291300          AND   HIER_CDE         IS NULL                          30690000
291400          AND   ITEM_CLUSTR_CDE = 'I'                             30700000
291500          AND   ((EFF_END_TMST IS NULL) OR                        30710000
291600                (EFF_END_TMST > :PV-CURR-END-TMST))               30720000
291700     END-EXEC.                                                    30730000
291800                                                                  30740000
291900     EVALUATE TRUE                                                30750000
292000                                                                  30760000
292100       WHEN SQLCODE = ZEROS                                       30770000
0822RM         ADD +1 TO PV-INS-UPD-COUNT                               30780022
0822RM*        DISPLAY 'CLUSTER EXPIRED.'                               30790009
0822RM         CONTINUE                                                 30800009
292400       WHEN SQLCODE = 1403                                        30810000
292500         DISPLAY 'CLUSTER DOES NOT EXIST, NOT EXPIRED.'           30820000
292600                                                                  30830000
292700       WHEN OTHER                                                 30840000
292800         DISPLAY PV-ABEND-PARAGRAPH                               30850000
292900         PERFORM Z999-SQL-ERROR                                   30860000
293000     END-EVALUATE.                                                30870000
293100                                                                  30880000
293200                                                                  30890000
293300                                                                  30900000
293400******************************************************************30910000
293500*                                                                *30920000
293600*                                                                *30930000
293700******************************************************************30940000
293800 C500-EXPIRE-RELATIONSHIPS.                                       30950000
293900*    DISPLAY 'C500-EXPIRE-RELATIONSHIPS'.                         30960006
294000     MOVE ITMCLC-PRNT-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-1.       30970000
294100     MOVE ITMCLC-CHLD-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-2.       30980000
294200*    DISPLAY 'C500 PRNT = ' PV-WORK-CLUSTR-ID-1.                  30990006
294300*    DISPLAY 'C500 CHLD = ' PV-WORK-CLUSTR-ID-2.                  31000006
294400     MOVE 'C500-EXPIRE-RELATIONSHIPS'                             31010000
294500               TO  PV-ABEND-PARAGRAPH.                            31020000
294600     EXEC SQL                                                     31030000
294700       UPDATE   TITMCLC                                           31040000
294800        SET  EFF_END_TMST        =  :PV-CURRENT-TMST,             31050000
294900             LAST_UPD_TMST       =  SYSDATE,                      31060000
295000             LAST_UPD_BY_UID     =  'MAKUT102'                    31070000
295100         WHERE                                                    31080000
295200             PRNT_ITM_CLUSTR_ID  = :ITMCLC-PRNT-ITM-CLUSTR-ID     31090000
295300        AND  CHLD_ITM_CLUSTR_ID  = :ITMCLC-CHLD-ITM-CLUSTR-ID     31100000
295400     END-EXEC.                                                    31110000
295500                                                                  31120000
295600     EVALUATE TRUE                                                31130000
295700       WHEN SQLCODE = ZEROS                                       31140000
0822RM         ADD +1 TO PV-INS-UPD-COUNT                               31150022
295800*        DISPLAY 'C500 - SQLCODE = 0'                             31160006
0822RM*        CONTINUE                                                 31170015
296000       WHEN SQLCODE = 1403                                        31180000
296100         DISPLAY 'CAN NOT EXPIRE , RELATIONSHIP DOESN''T EXIST:'  31190000
296200         DISPLAY 'PRNT_ITM_CLUSTR_ID=' ITMCLC-PRNT-ITM-CLUSTR-ID  31200000
296300         DISPLAY 'CHLD_ITM_CLUSTR_ID=' ITMCLC-CHLD-ITM-CLUSTR-ID  31210000
296400       WHEN OTHER                                                 31220000
296500         DISPLAY PV-ABEND-PARAGRAPH                               31230000
296600         DISPLAY 'PRNT_ITM_CLUSTR_ID=' ITMCLC-PRNT-ITM-CLUSTR-ID  31240000
296700         DISPLAY 'CHLD_ITM_CLUSTR_ID=' ITMCLC-CHLD-ITM-CLUSTR-ID  31250000
296800         DISPLAY 'PV-CURRENT-TMST   =' PV-CURRENT-TMST            31260000
296900         PERFORM Z999-SQL-ERROR                                   31270000
297000     END-EVALUATE.                                                31280000
297100                                                                  31290000
297200                                                                  31300000
297300******************************************************************31310000
297400*                                                                *31320000
297500* TRANSFER ALL RELATIONSHIPS OF OLD RENUMBERED SKU TO THE NEW    *31330000
297600* SKU.                                                           *31340000
297700*                                                                *31350000
297800******************************************************************31360000
297900 C550-SAVE-RELATIONSHIPS.                                         31370000
298000     MOVE 'C550-SAVE-RELATIONSHIPS'                               31380000
298100               TO  PV-ABEND-PARAGRAPH.                            31390000
298200     EXEC SQL                                                     31400000
298300       SELECT                                                     31410000
298400           A.PRNT_ITM_CLUSTR_ID,                                  31420000
298500           A.CHLD_ITM_CLUSTR_ID,                                  31430000
298600           A.REL_TYP_CDE,                                         31440000
298700           A.EFF_BEG_TMST,                                        31450000
298800           A.EFF_END_TMST,                                        31460000
298900           A.CRE_BY_UID,                                          31470000
299000           A.CRE_TMST,                                            31480000
299100           A.LAST_UPD_BY_UID,                                     31490000
299200           A.LAST_UPD_TMST,                                       31500000
299300           A.CHLD_ITM_CLSTR_CDE                                   31510000
299400       INTO                                                       31520000
299500               :ITMCLC-PRNT-ITM-CLUSTR-ID,                        31530000
299600               :ITMCLC-CHLD-ITM-CLUSTR-ID,                        31540000
299700               :ITMCLC-REL-TYP-CDE,                               31550000
299800               :ITMCLC-EFF-BEG-TMST,                              31560000
299900               :ITMCLC-EFF-END-TMST,                              31570000
300000               :ITMCLC-CRE-BY-UID,                                31580000
300100               :ITMCLC-CRE-TMST,                                  31590000
300200               :ITMCLC-LAST-UPD-BY-UID,                           31600000
300300               :ITMCLC-LAST-UPD-TMST,                             31610000
300400               :ITMCLC-CHLD-ITM-CLSTR-CDE:PV-CHLD-CDE-NULL        31620000
300500       FROM     TITMCLC A,                                        31630000
300600                TITMCLT B                                         31640000
300700         WHERE                                                    31650000
300800           A.PRNT_ITM_CLUSTR_ID  = :ITMCLC-PRNT-ITM-CLUSTR-ID     31660000
300900      AND  A.CHLD_ITM_CLUSTR_ID  = :ITMCLC-CHLD-ITM-CLUSTR-ID     31670000
301000      AND  A.PRNT_ITM_CLUSTR_ID  = B.ITEM_CLUSTR_ID               31680000
301100      AND  B.CLUSTR_TYP_CDE      ='A'                             31690000
301200     END-EXEC.                                                    31700000
301300                                                                  31710000
301400     EVALUATE TRUE                                                31720000
301500       WHEN SQLCODE = ZEROS                                       31730000
301600       WHEN SQLCODE = 1403                                        31740000
301700        CONTINUE                                                  31750000
301800                                                                  31760000
301900       WHEN OTHER                                                 31770000
302000         DISPLAY 'PRNT_ITM_CLUSTR_ID =' ITMCLC-PRNT-ITM-CLUSTR-ID 31780000
302100         DISPLAY 'CHLD_ITM_CLUSTR_ID =' ITMCLC-CHLD-ITM-CLUSTR-ID 31790000
302200         DISPLAY PV-ABEND-PARAGRAPH                               31800000
302300         PERFORM Z999-SQL-ERROR                                   31810000
302400     END-EVALUATE.                                                31820000
302500                                                                  31830000
302600                                                                  31840000
302700     IF SQLCODE = ZEROS                                           31850000
302800                                                                  31860000
302900        MOVE  PV-RENUMBER-CLUSTR-ID TO ITMCLC-CHLD-ITM-CLUSTR-ID  31870000
303000        MOVE  PV-CURRENT-TMST       TO ITMCLC-EFF-BEG-TMST        31880000
303100        PERFORM C700-INSERT-ITMCLC                                31890000
303200                                                                  31900000
303300     END-IF.                                                      31910000
303400                                                                  31920000
303500******************************************************************31930000
303600*                                                                *31940000
303700*                                                                *31950000
303800******************************************************************31960000
303900 C700-INSERT-ITMCLC.                                              31970015
304000*    DISPLAY 'C700-INSERT-ITMCLC'.                                31980006
304100     MOVE ITMCLC-PRNT-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-1.       31990000
304200     MOVE ITMCLC-CHLD-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-2.       32000000
304300*    DISPLAY 'ITMCLC-PRNT-ITM-CLUSTR-ID: '                        32010006
304400*    DISPLAY PV-WORK-CLUSTR-ID-1.                                 32020006
304500*    DISPLAY 'ITMCLC-CHLD-ITM-CLUSTR-ID: '                        32030006
304600*    DISPLAY PV-WORK-CLUSTR-ID-2.                                 32040006
304700*    MOVE 'M'                    TO ITMCLC-REL-TYP-CDE.           32050000
304800     MOVE PC-NEG-1               TO PV-EFF-END-DTE-NULL.          32060000
304900                                                                  32070000
305000     MOVE 'C700-INSERT-ITMCLC'                                    32080000
305100               TO  PV-ABEND-PARAGRAPH.                            32090000
305200     EXEC SQL                                                     32100000
305300       INSERT INTO   TITMCLC                                      32110000
305400            (PRNT_ITM_CLUSTR_ID,                                  32120000
305500             CHLD_ITM_CLUSTR_ID,                                  32130000
305600             REL_TYP_CDE,                                         32140000
305700             EFF_BEG_TMST,                                        32150000
305800             EFF_END_TMST,                                        32160000
305900             CRE_BY_UID,                                          32170000
306000             CRE_TMST,                                            32180000
306100             LAST_UPD_BY_UID,                                     32190000
306200             LAST_UPD_TMST,                                       32200000
306300             CHLD_ITM_CLSTR_CDE,                                  32210000
306400             CHLD_ITM_UNT_QTY)                                    32220000
306500         VALUES                                                   32230000
306600            (:ITMCLC-PRNT-ITM-CLUSTR-ID,                          32240000
306700             :ITMCLC-CHLD-ITM-CLUSTR-ID,                          32250000
306800             :ITMCLC-REL-TYP-CDE,                                 32260000
306900             :ITMCLC-EFF-BEG-TMST,                                32270000
307000             :ITMCLC-EFF-END-TMST:PV-EFF-END-DTE-NULL,            32280000
307100             'MAKUT102',                                          32290000
307200             SYSDATE,                                             32300000
307300             'MAKUT102',                                          32310000
307400             SYSDATE,                                             32320000
307500             :ITMCLC-CHLD-ITM-CLSTR-CDE:PV-CHLD-CDE-NULL,         32330000
307600             :ITMCLC-CHLD-ITM-UNT-QTY:PV-CHLD-ITM-UNT-QTY-NULL)   32340000
307700     END-EXEC.                                                    32350000
307800                                                                  32360000
307900     EVALUATE TRUE                                                32370000
308000       WHEN SQLCODE = ZEROS                                       32380000
0822RM         ADD +1 TO PV-INS-UPD-COUNT                               32390022
0822RM*        DISPLAY 'PRNT-ITM-CLUSTR:' ITMCLC-PRNT-ITM-CLUSTR-ID     32400015
0822RM*        DISPLAY 'CHLD-ITM-CLUSTR:' ITMCLC-CHLD-ITM-CLUSTR-ID     32410015
0822RM*        DISPLAY 'REL-TYP-CDE:' ITMCLC-REL-TYP-CDE                32420015
0822RM*        DISPLAY 'EFF-BEG-TMST:' ITMCLC-EFF-BEG-TMST              32430015
0822RM*        DISPLAY 'EFF-END-TMST: ' ITMCLC-EFF-END-TMST             32440015
0822RM*        DISPLAY 'CHLD-ITM-CLSTR:' ITMCLC-CHLD-ITM-CLSTR-CDE      32450015
0822RM*        DISPLAY 'CHLD-ITM-UNT-QTY:' ITMCLC-CHLD-ITM-UNT-QTY      32460015
0822RM*        CONTINUE                                                 32470015
308900       WHEN SQLCODE = -1                                          32480000
309000         DISPLAY 'SQLCODE = -1 RELATIONSHIP ALREADY EXISTS: '     32490008
309100         DISPLAY 'PRNT-ITM-CLUSTR-ID = ' ITMCLC-PRNT-ITM-CLUSTR-ID32500008
309200         DISPLAY 'CHLD-ITM-CLUSTR-ID = ' ITMCLC-CHLD-ITM-CLUSTR-ID32510008
309300                                                                  32520000
309400         DISPLAY 'RESETTING PLSQL TABLE...'                       32530008
309500         EXEC SQL EXECUTE                                         32540000
309600           BEGIN                                                  32550000
309700               TITMCLC_TRIG_PKG.RESET_TABLE;                      32560000
309800           END;                                                   32570000
309900           END-EXEC                                               32580000
310000           EVALUATE TRUE                                          32590000
310100              WHEN SQLCODE = ZEROS                                32600000
310200                   CONTINUE                                       32610000
310300              WHEN OTHER                                          32620000
310400                   DISPLAY 'CAN NOT RESET PLSQL TABLE'            32630000
310500                   PERFORM Z999-SQL-ERROR                         32640000
310600           END-EVALUATE                                           32650000
310700           CONTINUE                                               32660000
310800       WHEN OTHER                                                 32670000
310900            DISPLAY 'PRNT-ITM-CLUSTR-ID = '                       32680000
311000                                      ITMCLC-PRNT-ITM-CLUSTR-ID   32690000
311100            DISPLAY 'CHLD-ITM-CLUSTR-ID = '                       32700000
311200                                      ITMCLC-CHLD-ITM-CLUSTR-ID   32710000
311300            DISPLAY PV-ABEND-PARAGRAPH                            32720000
311400            PERFORM Z999-SQL-ERROR                                32730000
311500     END-EVALUATE.                                                32740000
311600                                                                  32750000
311700                                                                  32760000
311800******************************************************************32770000
311900*                                                                *32780000
312000*                                                                *32790000
312100******************************************************************32800000
312200 C750-INSERT-TMDSEIT.                                             32810000
312300                                                                  32820000
312400                                                                  32830000
312500     MOVE 'C750-INSERT-TMDSEIT'                                   32840000
312600               TO  PV-ABEND-PARAGRAPH.                            32850000
312700     EXEC SQL                                                     32860000
312800       INSERT INTO   TMDSEIT                                      32870000
312900            (ITEM_CLUSTR_ID                                       32880000
313000            ,STAT_CHNG_DTE                                        32890000
313100            ,STAT_CDE                                             32900000
313200            ,SIZE_DESC                                            32910000
313300            ,COLOR_DESC                                           32920000
313400            ,VNDR_INHOUSE_NBR                                     32930000
313500            ,VNDR_STYL_ID                                         32940000
313600            ,UNIT_RTL_AMT                                         32950000
313700            ,UNIT_RTL_UOM_CDE                                     32960000
313800            ,GRP_QTY                                              32970000
313900            ,GRP_RTL_AMT                                          32980000
314000            ,ENT_ID                                               32990000
314100            ,E_ITM_IND                                            33000000
314200            ,KOHLS_SIZE_CDE                                       33010000
314300            ,NRF_CLOR_CDE)                                        33020000
314400         VALUES                                                   33030000
314500            (:MDSEIT-ITEM-CLUSTR-ID,                              33040000
314600             :MDSEIT-STAT-CHNG-DTE:PV-STAT-CHNG-DTE-NULL,         33050000
314700             :MDSEIT-STAT-CDE,                                    33060000
314800             :MDSEIT-SIZE-DESC:PV-SIZE-DESC-NULL,                 33070000
314900             :MDSEIT-COLOR-DESC:PV-COLOR-DESC-NULL,               33080000
315000             :MDSEIT-VNDR-INHOUSE-NBR:PV-VNDR-INHOUSE-NBR-NULL,   33090000
315100             :MDSEIT-VNDR-STYL-ID:PV-VNDR-STYL-ID-NULL,           33100000
315200             :MDSEIT-UNIT-RTL-AMT:PV-UNIT-RTL-AMT-NULL,           33110000
315300             :MDSEIT-UNIT-RTL-UOM-CDE:PV-UNIT-RTL-UOM-CDE-NULL,   33120000
315400             :MDSEIT-GRP-QTY:PV-GRP-QTY-NULL,                     33130000
315500             :MDSEIT-GRP-RTL-AMT:PV-GRP-RTL-AMT-NULL,             33140000
315600             :MDSEIT-ENT-ID:PV-ENT-ID-NULL,                       33150000
315700             :PC-N:PV-ZERO,                                       33160000
315800             :MDSEIT-KOHLS-SIZE-CDE:PV-KOHLS-SIZE-CDE-NULL,       33170000
315900             :MDSEIT-NRF-CLOR-CDE:PV-NRF-CLOR-CDE-NULL)           33180000
316000     END-EXEC.                                                    33190000
316100                                                                  33200000
316200     EVALUATE TRUE                                                33210000
316300       WHEN SQLCODE = ZEROS                                       33220012
0822RM         ADD +1 TO PV-INS-UPD-COUNT                               33230022
316500       WHEN OTHER                                                 33240000
316600         DISPLAY PV-ABEND-PARAGRAPH                               33250000
316700         DISPLAY 'ITEM-CLUSTER-ID = ' MDSEIT-ITEM-CLUSTR-ID       33260000
316800         PERFORM Z999-SQL-ERROR                                   33270000
316900     END-EVALUATE.                                                33280000
317000                                                                  33290000
317100                                                                  33300000
317200******************************************************************33310000
317300*                                                                *33320000
317400*                                                                *33330000
317500******************************************************************33340000
317600 C755-SELECT-TMDSEIT.                                             33350000
317700                                                                  33360000
317800                                                                  33370000
317900     MOVE 'C755-SELECT-TMDSEIT'                                   33380000
318000               TO  PV-ABEND-PARAGRAPH.                            33390000
318100     EXEC SQL                                                     33400000
318200       SELECT                                                     33410000
318300             STAT_CHNG_DTE                                        33420000
318400            ,STAT_CDE                                             33430000
318500            ,SIZE_DESC                                            33440000
318600            ,COLOR_DESC                                           33450000
318700            ,VNDR_INHOUSE_NBR                                     33460000
318800            ,VNDR_STYL_ID                                         33470000
318900            ,UNIT_RTL_AMT                                         33480000
319000            ,UNIT_RTL_UOM_CDE                                     33490000
319100            ,GRP_QTY                                              33500000
319200            ,GRP_RTL_AMT                                          33510000
319300            ,ENT_ID                                               33520000
319400            ,KOHLS_SIZE_CDE                                       33530000
319500            ,NRF_CLOR_CDE                                         33540000
319600        INTO                                                      33550000
319700             :MDSEIT-STAT-CHNG-DTE:PV-STAT-CHNG-DTE-NULL,         33560000
319800             :MDSEIT-STAT-CDE,                                    33570000
319900             :MDSEIT-SIZE-DESC:PV-SIZE-DESC-NULL,                 33580000
320000             :MDSEIT-COLOR-DESC:PV-COLOR-DESC-NULL,               33590000
320100             :MDSEIT-VNDR-INHOUSE-NBR:PV-VNDR-INHOUSE-NBR-NULL,   33600000
320200             :MDSEIT-VNDR-STYL-ID:PV-VNDR-STYL-ID-NULL,           33610000
320300             :MDSEIT-UNIT-RTL-AMT:PV-UNIT-RTL-AMT-NULL,           33620000
320400             :MDSEIT-UNIT-RTL-UOM-CDE:PV-UNIT-RTL-UOM-CDE-NULL,   33630000
320500             :MDSEIT-GRP-QTY:PV-GRP-QTY-NULL,                     33640000
320600             :MDSEIT-GRP-RTL-AMT:PV-GRP-RTL-AMT-NULL,             33650000
320700             :MDSEIT-ENT-ID:PV-ENT-ID-NULL,                       33660000
320800             :MDSEIT-KOHLS-SIZE-CDE:PV-KOHLS-SIZE-CDE-NULL,       33670000
320900             :MDSEIT-NRF-CLOR-CDE:PV-NRF-CLOR-CDE-NULL            33680000
321000        FROM   TMDSEIT                                            33690000
321100        WHERE ITEM_CLUSTR_ID = :MDSEIT-ITEM-CLUSTR-ID             33700000
321200     END-EXEC.                                                    33710000
321300                                                                  33720000
321400     EVALUATE TRUE                                                33730000
321500       WHEN SQLCODE = ZEROS                                       33740000
321600         CONTINUE                                                 33750000
321700       WHEN SQLCODE = +1403                                       33760000
0822RM*        DISPLAY 'NO TMDSEIT ROWS FOR:' MDSEIT-ITEM-CLUSTR-ID     33770028
0822RM         CONTINUE                                                 33771028
321900       WHEN OTHER                                                 33780000
322000         DISPLAY PV-ABEND-PARAGRAPH                               33790000
322100         DISPLAY 'ITEM-CLUSTER-ID = ' MDSEIT-ITEM-CLUSTR-ID       33800000
322200         PERFORM Z999-SQL-ERROR                                   33810000
322300     END-EVALUATE.                                                33820000
322400                                                                  33830000
322500                                                                  33840000
322600******************************************************************33850000
322700*                                                                *33860000
322800*                                                                *33870000
322900******************************************************************33880000
323000 C760-UPDATE-TMDSEIT.                                             33890000
323100                                                                  33900000
323200                                                                  33910000
323300     MOVE 'C760-UPDATE-TMDSEIT'                                   33920000
323400               TO  PV-ABEND-PARAGRAPH.                            33930000
323500     EXEC SQL                                                     33940000
323600     UPDATE   TMDSEIT                                             33950000
323700     SET  STAT_CHNG_DTE    =                                      33960000
323800               :MDSEIT-STAT-CHNG-DTE:PV-STAT-CHNG-DTE-NULL        33970000
323900         ,STAT_CDE         =:MDSEIT-STAT-CDE                      33980000
324000         ,SIZE_DESC        =:MDSEIT-SIZE-DESC:PV-SIZE-DESC-NULL   33990000
324100         ,COLOR_DESC       =:MDSEIT-COLOR-DESC:PV-COLOR-DESC-NULL 34000000
324200         ,VNDR_INHOUSE_NBR =                                      34010000
324300               :MDSEIT-VNDR-INHOUSE-NBR:PV-VNDR-INHOUSE-NBR-NULL  34020000
324400         ,VNDR_STYL_ID     =                                      34030000
324500               :MDSEIT-VNDR-STYL-ID:PV-VNDR-STYL-ID-NULL          34040000
324600         ,UNIT_RTL_AMT     =                                      34050000
324700               :MDSEIT-UNIT-RTL-AMT:PV-UNIT-RTL-AMT-NULL          34060000
324800         ,UNIT_RTL_UOM_CDE =                                      34070000
324900               :MDSEIT-UNIT-RTL-UOM-CDE:PV-UNIT-RTL-UOM-CDE-NULL  34080000
325000         ,GRP_QTY          =:MDSEIT-GRP-QTY:PV-GRP-QTY-NULL       34090000
325100         ,GRP_RTL_AMT     =:MDSEIT-GRP-RTL-AMT:PV-GRP-RTL-AMT-NULL34100000
325200         ,ENT_ID           =:MDSEIT-ENT-ID:PV-ENT-ID-NULL         34110000
325300         ,KOHLS_SIZE_CDE   =                                      34120000
325400               :MDSEIT-KOHLS-SIZE-CDE:PV-KOHLS-SIZE-CDE-NULL      34130000
325500         ,NRF_CLOR_CDE     =                                      34140000
325600               :MDSEIT-NRF-CLOR-CDE:PV-NRF-CLOR-CDE-NULL          34150000
325700        WHERE ITEM_CLUSTR_ID  = :MDSEIT-ITEM-CLUSTR-ID            34160000
325800     END-EXEC.                                                    34170000
325900                                                                  34180000
326000     EVALUATE TRUE                                                34190000
326100       WHEN SQLCODE = ZEROS                                       34200000
0822RM         ADD 1 TO PV-INS-UPD-COUNT                                34210022
0822RM*        DISPLAY 'UPDATED TMDSEIT:'                               34220015
0822RM*        DISPLAY 'ITEM-CLUSTER-ID  = ' MDSEIT-ITEM-CLUSTR-ID      34230015
0822RM*        DISPLAY 'STAT-CHNG-DTE    = ' MDSEIT-STAT-CHNG-DTE       34240015
0822RM*        DISPLAY 'STAT_CDE         = ' MDSEIT-STAT-CDE            34250015
0822RM*        DISPLAY 'SIZE_DESC        = ' MDSEIT-SIZE-DESC           34260015
0822RM*        DISPLAY 'COLOR_DESC       = ' MDSEIT-COLOR-DESC          34270015
0822RM*        DISPLAY 'VNDR_INHOUSE_NBR = ' MDSEIT-VNDR-INHOUSE-NBR    34280015
0822RM*        DISPLAY 'VNDR_STYL_ID     = ' MDSEIT-VNDR-STYL-ID        34290015
0822RM*        DISPLAY 'UNIT_RTL_AMT     = ' MDSEIT-UNIT-RTL-AMT        34300015
0822RM*        DISPLAY 'UNIT_RTL_UOM_CDE = ' MDSEIT-UNIT-RTL-UOM-CDE    34310015
0822RM*        DISPLAY 'GRP_QTY          = ' MDSEIT-GRP-QTY             34320015
0822RM*        DISPLAY 'GRP_RTL_AMT      = ' MDSEIT-GRP-RTL-AMT         34330015
0822RM*        DISPLAY 'ENT_ID           = ' MDSEIT-ENT-ID              34340015
0822RM*        DISPLAY 'KOHLS_SIZE_CDE   = ' MDSEIT-KOHLS-SIZE-CDE      34350015
0822RM*        DISPLAY 'NRF_CLOR_CDE     = ' MDSEIT-NRF-CLOR-CDE        34360015
0822RM*        CONTINUE                                                 34370015
327700       WHEN SQLCODE = +1403                                       34380000
327800         DISPLAY 'CAN NOT UPDATE TMDSEIT FOR:'                    34390000
327900         DISPLAY 'ITEM-CLUSTER-ID  = ' MDSEIT-ITEM-CLUSTR-ID      34400000
328000       WHEN OTHER                                                 34410000
328100         DISPLAY PV-ABEND-PARAGRAPH                               34420000
328200         DISPLAY 'ITEM-CLUSTER-ID = ' MDSEIT-ITEM-CLUSTR-ID       34430000
328300         DISPLAY 'STAT-CHNG-DTE    = ' MDSEIT-STAT-CHNG-DTE       34440000
328400         DISPLAY 'STAT_CDE         = ' MDSEIT-STAT-CDE            34450000
328500         DISPLAY 'SIZE_DESC        = ' MDSEIT-SIZE-DESC           34460000
328600         DISPLAY 'COLOR_DESC       = ' MDSEIT-COLOR-DESC          34470000
328700         DISPLAY 'VNDR_INHOUSE_NBR = ' MDSEIT-VNDR-INHOUSE-NBR    34480000
328800         DISPLAY 'VNDR_STYL_ID     = ' MDSEIT-VNDR-STYL-ID        34490000
328900         DISPLAY 'UNIT_RTL_AMT     = ' MDSEIT-UNIT-RTL-AMT        34500000
329000         DISPLAY 'UNIT_RTL_UOM_CDE = ' MDSEIT-UNIT-RTL-UOM-CDE    34510000
329100         DISPLAY 'GRP_QTY          = ' MDSEIT-GRP-QTY             34520000
329200         DISPLAY 'GRP_RTL_AMT      = ' MDSEIT-GRP-RTL-AMT         34530000
329300         DISPLAY 'ENT_ID           = ' MDSEIT-ENT-ID              34540000
329400         DISPLAY 'KOHLS_SIZE_CDE   = ' MDSEIT-KOHLS-SIZE-CDE      34550000
329500         DISPLAY 'NRF_CLOR_CDE     = ' MDSEIT-NRF-CLOR-CDE        34560000
329600         PERFORM Z999-SQL-ERROR                                   34570000
329700     END-EVALUATE.                                                34580000
329800                                                                  34590000
329900                                                                  34600000
330000***************************************************************** 34610000
330100* EXPIRE ALL CHILDREN ONE BY ONE AND ALL RELATIONSHIPS WITH     * 34620000
330200* THEM.                                                         * 34630000
330300*                                                               * 34640000
330400***************************************************************** 34650000
330500 C800-EXPIRE-CHILDREN.                                            34660000
330600                                                                  34670000
330700*    DISPLAY 'C800-EXPIRE-CHILDREN'.                              34680006
330800                                                                  34690000
330900     MOVE +1   TO PV-FETCH-COUNT.                                 34700000
331000                                                                  34710000
331100     PERFORM                                                      34720000
331200     UNTIL PV-FETCH-COUNT = ZERO                                  34730000
331300                                                                  34740000
331400      SET PS-MORE-CHILDREN TO TRUE                                34750000
331500                                                                  34760000
331600      PERFORM  B220-OPEN-CHILD-CURSOR                             34770000
331700                                                                  34780000
331800      MOVE ZERO TO PV-FETCH-COUNT                                 34790000
331900                                                                  34800000
332000      PERFORM  B230-FETCH-CHILD-CURSOR                            34810000
332100          UNTIL  PS-NO-MORE-CHILDREN                              34820000
332200                                                                  34830000
332300      PERFORM  B240-CLOSE-CHILD-CURSOR                            34840000
332400                                                                  34850000
332500                                                                  34860000
332600     END-PERFORM.                                                 34870000
332700                                                                  34880000
332800                                                                  34890000
332900***************************************************************** 34900000
333000*                                                               * 34910000
333100*  BUILD   GROUP CLUSTERS AND  THEIR                            * 34920000
333200*  RELATIONSHIPS TO SKU ITEM.                                   * 34930000
333300*                                                               * 34940000
333400***************************************************************** 34950000
333500                                                                  34960000
333600 C900-PROCESS-GRP-INFO.                                           34970000
333700                                                                  34980000
333800     PERFORM D400-GET-GRP-INFO.                                   34990000
333900                                                                  35000000
334000     IF SQLCODE = ZEROES   AND                                    35010000
334100       TSK-GROUP-CODE   NOT = SPACES                              35020000
334200                                                                  35030000
334300         IF PV-SKU-PROCESS-CODE = 'R'                             35040000
334400             MOVE MA025-MERCH-DEPT-NMBR TO MDSEAR-DEPT-NBR        35050000
334500         ELSE                                                     35060000
334600             MOVE  PV-WORK-DPT-2-4      TO MDSEAR-DEPT-NBR        35070000
334700         END-IF                                                   35080000
334800                                                                  35090000
334900         PERFORM B130-GET-PARENT-DPT                              35100000
335000         MOVE PV-DEPT-PRNT-CLUSTR-ID TO ITMCLT-OWNER-ID           35110000
335100                                                                  35120000
335200         MOVE 'S' TO ITMCLT-CLUSTR-TYP-CDE                        35130000
335300         MOVE LOW-VALUES TO ITMCLT-MDSE-NM-CDE                    35140000
335400         MOVE LOW-VALUES TO ITMCLT-PROD-SERV-CDE                  35150000
335500                                                                  35160000
335600         MOVE 'M'   TO    ITMCLT-HIER-TYP-CDE                     35170000
335700         MOVE 'C'   TO    ITMCLT-ITEM-CLUSTR-CDE                  35180000
335800                                                                  35190000
335900                                                                  35200000
336000         MOVE 'GRP' TO    ITMCLT-HIER-CDE                         35210000
336100                                                                  35220000
336200                                                                  35230000
336300         MOVE ZEROES    TO  PV-HIER-CDE-NULL                      35240000
336400                            PV-HIER-TYP-CDE-NULL                  35250000
336500                            PV-CLUSTR-TYP-CDE-NULL                35260000
336600                            PV-OWNER-ID-NULL                      35270000
336700                            PV-CHLD-CDE-NULL                      35280000
336800                                                                  35290000
336900         MOVE PC-NEG-1  TO  PV-MDSE-NM-CDE-NULL                   35300000
337000                            PV-PROD-SERV-CDE-NULL                 35310000
337100                                                                  35320000
337200         MOVE SPACES      TO    ITMCLT-ITEM-CLUSTR-NAME           35330000
337300* LLG UNCOMMENT LINE BELOW                                        35340000
337400*        IF PV-SKU-PROCESS-CODE = 'R'                             35350000
337500*            STRING  MA025-MERCH-DEPT-NMBR  DELIMITED BY SIZE     35360000
337600*                    '-' DELIMITED BY SIZE                        35370000
337700*                    MA025-MERCH-CLASS-NMBR DELIMITED BY SIZE     35380000
337800*                    '-' DELIMITED BY SIZE                        35390000
337900*                    TSK-GROUP-CODE   DELIMITED BY SIZE           35400000
338000*                          INTO    ITMCLT-ITEM-CLUSTR-NAME        35410000
338100*        ELSE                                                     35420000
338200         STRING  PV-WORK-DPT-2-4      DELIMITED BY SIZE           35430000
338300                 '-' DELIMITED BY SIZE                            35440000
338400                 PV-WORK-SUBCL-3-4    DELIMITED BY SIZE           35450000
338500                 '-' DELIMITED BY SIZE                            35460000
338600                 TSK-GROUP-CODE   DELIMITED BY SIZE               35470000
338700                       INTO    ITMCLT-ITEM-CLUSTR-NAME            35480000
338800*        END-IF                                                   35490000
338900         MOVE ITMCLT-ITEM-CLUSTR-NAME TO ITMCLT-ITEM-CLUSTR-DESC  35500000
339000                                                                  35510000
339100                                                                  35520000
339200*********** INSERT GROUP CLUSTR AND RELATIONSHIPS **************  35530000
339300*                                                              *  35540000
339400*                                                              *  35550000
339500         PERFORM D100-GET-CLUSTR-ID                               35560000
339600                                                                  35570000
339700         IF SQLCODE = 1403                                        35580000
**TEMP*            DISPLAY ' C900 CALL TO C200-INSERT-TITMCLT'          35590027
**TEMP*            ADD +1 TO PV-INS-UPD-COUNT                           35600027
                 PERFORM C200-INSERT-TITMCLT                            35610027
339900         END-IF                                                   35620000
340000                                                                  35630000
340100                                                                  35640000
340200         MOVE PV-SKU-CHLD-CLUSTR-ID TO ITMCLC-CHLD-ITM-CLUSTR-ID  35650000
340300         MOVE ITMCLT-ITEM-CLUSTR-ID TO ITMCLC-PRNT-ITM-CLUSTR-ID  35660000
340400                                       PV-GRP-CHLD-CLUSTR-ID      35670000
340500         MOVE 'M'         TO ITMCLC-REL-TYP-CDE                   35680000
340600         MOVE 'I'         TO ITMCLC-CHLD-ITM-CLSTR-CDE            35690000
**TEMP*            DISPLAY ' C900 CALL TO C700-INSERT-ITMCLC'           35700027
**TEMP*            ADD +1 TO PV-INS-UPD-COUNT                           35710027
               PERFORM C700-INSERT-ITMCLC                               35720027
340800                                                                  35730000
340900     END-IF.                                                      35740000
341000                                                                  35750000
341100*                                                                 35760000
341200                                                                  35770000
341300***************************************************************** 35780000
341400*                                                               * 35790000
341500*  BUILD VENDOR AND VENDOR STYLE CLUSTERS AND THEIR             * 35800000
341600*  RELATIONSHIPS TO SKU ITEM.                                   * 35810000
341700*                                                               * 35820000
341800***************************************************************** 35830000
341900                                                                  35840000
342000 C950-PROCESS-VENDOR-INFO.                                        35850000
342100                                                                  35860000
342200     MOVE 'C950-PROCESS-VENDOR-INFO' TO PV-ABEND-PARAGRAPH.       35870000
342300                                                                  35880000
342400     PERFORM D450-GET-VENDOR-INFO.                                35890000
342500                                                                  35900000
342600     IF SQLCODE = ZEROES                                          35910000
342700                                                                  35920000
342800                                                                  35930000
342900         MOVE PV-CURRENT-TMST    TO ITMCLT-EFF-BEG-TMST           35940000
343000         MOVE PC-NEG-1           TO PV-EFF-END-DTE-NULL           35950000
343100         MOVE 'S' TO ITMCLT-CLUSTR-TYP-CDE                        35960000
343200         MOVE LOW-VALUES TO ITMCLT-MDSE-NM-CDE                    35970000
343300         MOVE LOW-VALUES TO ITMCLT-PROD-SERV-CDE                  35980000
343400         MOVE PC-NEG-1   TO PV-MDSE-NM-CDE-NULL                   35990000
343500                            PV-PROD-SERV-CDE-NULL                 36000000
343600                                                                  36010000
343700         MOVE 'M'   TO    ITMCLT-HIER-TYP-CDE                     36020000
343800         MOVE 'C'   TO    ITMCLT-ITEM-CLUSTR-CDE                  36030000
343900         MOVE 'VND' TO    ITMCLT-HIER-CDE                         36040000
344000         MOVE ZEROES TO   PV-CLUSTR-TYP-CDE-NULL                  36050000
344100                          PV-HIER-TYP-CDE-NULL                    36060000
344200                          PV-HIER-CDE-NULL                        36070000
344300                                                                  36080000
344400         MOVE ENTNME-ENT-NAME-DESC (1:10)                         36090000
344500                             TO WS-VND-CLUSTR-NAME-DESC           36100000
344600         MOVE TSK-ENT-ID     TO WS-VND-CLUSTR-NAME-ENTID          36110000
344700         MOVE WS-VND-CLUSTR-NAME                                  36120000
344800                             TO ITMCLT-ITEM-CLUSTR-NAME           36130000
344900                                                                  36140000
345000         MOVE PV-DEPT-PRNT-CLUSTR-ID  TO ITMCLT-OWNER-ID          36150000
345100         MOVE ZERO                    TO PV-OWNER-ID-NULL         36160000
345200                                                                  36170000
345300******** INSERT VENDOR CLUSTER AND RELATIONSHIPS *********        36180000
345400                                                                  36190000
345500         PERFORM D100-GET-CLUSTR-ID                               36200000
345600                                                                  36210000
345700         IF SQLCODE = 1403                                        36220000
345800****  CAF BEGIN  ****                                             36230000
0822RM*            DISPLAY 'ORIGINAL VENDOR NAME NOT FOUND (D106)'      36240009
346000             PERFORM D106-SELECT-VND-CLUSTR-ID                    36250000
346100             IF SQLCODE = 1403                                    36260000
346200                 MOVE ENTNME-ENT-NAME-DESC                        36270000
346300                                     TO ITMCLT-ITEM-CLUSTR-DESC   36280000
346400                 PERFORM C200-INSERT-TITMCLT                      36290000
346500                 MOVE ITMCLT-ITEM-CLUSTR-ID                       36300000
346600                                     TO PV-VND-PRNT-CLUSTR-ID     36310000
346700                 PERFORM C955-CREATE-VNDR-STYLE-CLUSTS            36320000
346800             ELSE                                                 36330000
**TEMP*            DISPLAY 'C950 CALL TO D107-UPDATE-VND-ITM-CLU'       36331027
**TEMP*            ADD +1 TO PV-INS-UPD-COUNT                           36332027
                       PERFORM D107-UPDATE-VND-ITM-CLUSTR-NME           36340027
347000                 PERFORM C952-PROCESS-VST                         36350000
347100             END-IF                                               36360000
347200         ELSE                                                     36370000
0822RM*            DISPLAY 'ORIGINAL VENDOR NAME FOUND'                 36380009
347400             PERFORM C952-PROCESS-VST                             36390000
347500         END-IF                                                   36400000
347600     END-IF.                                                      36410000
347700******************************************************************36420000
347800*                                                                 36430000
347900******************************************************************36440000
348000 C952-PROCESS-VST.                                                36450000
348100                                                                  36460000
348200*    DISPLAY 'C952-PROCESS-VST'                                   36470006
348300     MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-VND-PRNT-CLUSTR-ID.         36480000
348400     MOVE 'VST' TO        ITMCLT-HIER-CDE.                        36490000
348500     MOVE TSK-LONG-VENDOR-STYLE                                   36500000
348600                             TO ITMCLT-ITEM-CLUSTR-NAME.          36510000
348700     MOVE PV-DEPT-PRNT-CLUSTR-ID      TO ITMCLT-OWNER-ID.         36520000
348800                                                                  36530000
348900*    DISPLAY ' SKU-PROCESS-CODE: ' PV-SKU-PROCESS-CODE.           36540006
349000     IF PV-SKU-PROCESS-CODE = 'C'                                 36550000
349100         PERFORM D105-GET-VST-CLUSTR-ID                           36560000
349200         IF SQLCODE = 1403                                        36570000
349300             PERFORM D105-GET-VST-CLUSTR-ID-NO-SKU                36580000
349400         END-IF                                                   36590000
349500     ELSE                                                         36600000
349600         IF PV-SKU-PROCESS-CODE = 'A'                             36610000
349700             PERFORM D105-GET-VST-CLUSTR-ID-NO-SKU                36620000
349800         ELSE                                                     36630000
349900********** I BELIEVE ONLY SKU RENUMBERS FALL THROUGH              36640000
350000********** TO THIS CODE - BUT A CHECK IS DONE TO VERIFY           36650000
350100********** THIS IS THE CASE - ALSO WE ONLY WANT TO MODIFY         36660000
350200********** THE PROCESSING FOR SKU RUNUMBERS THAT ARE WITHIN       36670000
350300********** THE SAME DEPT                                          36680000
350400             IF PV-SKU-PROCESS-CODE = 'R'                         36690000
350500               AND (MA025-MERCH-DEPT-NMBR =                       36700000
350600                          MA025-HIST-DEPT-NMBR)                   36710000
350700               AND (MA025-MERCH-CLASS-NMBR NOT =                  36720000
350800                          MA025-HIST-CLASS-NMBR)                  36730000
350900                 PERFORM D105-GET-VST-CLUSTR-ID-NO-SKU            36740000
351000             ELSE                                                 36750000
351100                 PERFORM D108-GET-VST-CLUSTR-ID-2                 36760000
351200             END-IF                                               36770000
351300         END-IF                                                   36780000
351400     END-IF.                                                      36790000
351500                                                                  36800000
351600********** AT THIS POINT, THE SQLCODE COULD BE THE RETURN         36810000
351700********** VALUE FROM                                             36820000
351800**********     D105-GET-VST-CLUSTR-ID                             36830000
351900**********     D105-GET-VST-CLUSTR-ID-NO-SKU                      36840000
352000**********     D108-GET-VST-CLUSTR-ID-2                           36850000
352100     IF SQLCODE = 1403                                            36860000
352200********** INSERT VENDOR STYLE CLUSTR AND RELATIONSHIP ****       36870000
352300         PERFORM C955-CREATE-VNDR-STYLE-CLUSTS                    36880000
352400     ELSE                                                         36890000
352500         MOVE ITMCLT-ITEM-CLUSTR-ID                               36900000
352600                                TO PV-VST-CHLD-CLUSTR-ID          36910000
352700         PERFORM C951-CREATE-VST-SKU-RELATION                     36920000
352800     END-IF.                                                      36930000
352900                                                                  36940000
353000**********  THE CLOSE FOR VSTCSR IS DONE HERE SO THAT THE         36950000
353100**********  ABOVE SQLCODE CHECK REFLECTS WHAT WAS RETURNED        36960000
353200**********  FROM THE SELECT/FETCH STATEMENTS - NOT THE            36970000
353300**********  CURSOR CLOSE STATEMENT                                36980000
353400     EXEC SQL                                                     36990000
353500         CLOSE VSTCSR                                             37000000
353600     END-EXEC.                                                    37010000
353700                                                                  37020000
353800****  CAF END ****                                                37030000
353900***************************************************************** 37040000
354000*  THIS PARAGRAPH CREATES THE VENDOR STYLE - SKU RELATIONSHIP   * 37050000
354100*  CLUSTER.                                                     * 37060000
354200***************************************************************** 37070000
354300*                                                                 37080000
354400 C951-CREATE-VST-SKU-RELATION.                                    37090000
354500     MOVE 'C951-CREATE-VST-SKU-RELATION' TO PV-ABEND-PARAGRAPH.   37100000
**TEMP     DISPLAY 'C951-CREATE-VST-SKU-RELATION'                       37101033
354600                                                                  37110000
354700     MOVE PC-NEG-1           TO PV-EFF-END-DTE-NULL.              37120000
354800     MOVE ZEROES             TO PV-CHLD-CDE-NULL.                 37130000
354900                                                                  37140000
355000     MOVE PV-SKU-CHLD-CLUSTR-ID TO ITMCLC-CHLD-ITM-CLUSTR-ID.     37150000
355100     MOVE PV-VST-CHLD-CLUSTR-ID TO ITMCLC-PRNT-ITM-CLUSTR-ID.     37160000
355200     MOVE 'M'    TO ITMCLC-REL-TYP-CDE.                           37170000
355300     MOVE 'I'    TO ITMCLC-CHLD-ITM-CLSTR-CDE.                    37180000
355400                                                                  37190000
355500     MOVE PV-CURRENT-TMST-NEW TO PV-NEW-TMST.                     37200000
                                                                        37200137
**TEMP*    DISPLAY 'FS500I-MAINT-LOG-REC '                              37200247
**TEMP*             FS500I-MAINTENANCE-LOG-RECORD.                      37200347
**TEMP*    DISPLAY 'BEFORE TIMESTAMP STUFF '                            37200447
**TEMP*    DISPLAY 'PV-CURRENT-TMST-NEW ' PV-CURRENT-TMST-NEW.          37200547
0822RM*- COMMENTED OUT THE FOLLOWING CODE REPLACING IT WITH THE         37200645
0822RM*- SQL BELOW                                                      37200745
0822RM*    PERFORM  UNTIL PV-NEW-TMST > PV-CURRENT-TMST-NEW             37210045
0822RM*        PERFORM G100-WASTE-TIME 1000 TIMES                       37220045
0822RM*        EXEC SQL                                                 37230045
0822RM*            SELECT SYSDATE                                       37240045
0822RM*            INTO :PV-NEW-TMST                                    37250045
0822RM*            FROM DUAL                                            37260045
0822RM*        END-EXEC                                                 37270045
0822RM*                                                                 37280045
0822RM*    END-PERFORM.                                                 37290045
                                                                        37290133
0822RM** REPLACE THE ABOVE SQL WITH THE FOLLOWING SQL                   37290234
0822RM     EXEC SQL                                                     37290345
0822RM         SELECT TO_CHAR(TO_DATE(:PV-CURRENT-TMST-NEW)+1/24/60/60, 37290945
0822RM                        'YYYY-MM-DD HH24:MI:SS')                  37291043
0822RM         INTO :PV-NEW-TMST                                        37291245
0822RM         FROM DUAL                                                37291340
356200     END-EXEC.                                                    37291440
                                                                        37292034
**TEMP*   DISPLAY ' SQL RETURN ' SQLCODE.                              337292147
0822RM     EVALUATE TRUE                                                37292245
0822RM       WHEN SQLCODE = ZEROS                                       37292345
0822RM         CONTINUE                                                 37292545
0822RM       WHEN OTHER                                                 37292645
0822RM         DISPLAY PV-ABEND-PARAGRAPH                               37292745
0822RM         PERFORM Z999-SQL-ERROR                                   37292945
0822RM     END-EVALUATE.                                                37293045
                                                                        37293145
**TEMP*    DISPLAY 'AFTER TIMESTAMP STUFF '                             37293247
**TEMP*    DISPLAY 'PV-NEW-TMST-TEST    ' PV-NEW-TMST-TEST.             37293347
**TEMP*    DISPLAY 'PV-NEW-TMST         ' PV-NEW-TMST                   37294047
**TEMP*    DISPLAY 'PV-CURRENT-TMST-NEW ' PV-CURRENT-TMST-NEW.          37295047
                                                                        37296034
356600     MOVE PV-NEW-TMST TO PV-CURRENT-TMST-NEW.                     37310000
                                                                        37315033
356700     MOVE PV-CURRENT-TMST-NEW TO ITMCLC-EFF-BEG-TMST.             37320000
356800     PERFORM C700-INSERT-ITMCLC.                                  37330000
356900                                                                  37340000
357000***************************************************************** 37350000
357100*  THIS PARAGRAPH CREATES THE VENDOR STYLE CLUSTER AND          * 37360000
357200*  RELATIONSHIP CLUSTERS.                                       * 37370000
357300***************************************************************** 37380000
357400*                                                                 37390000
357500 C955-CREATE-VNDR-STYLE-CLUSTS.                                   37400000
357600     MOVE 'C955-CREATE-VNDR-STYLE-CLUSTS' TO PV-ABEND-PARAGRAPH.  37410000
357700                                                                  37420000
357800     MOVE PV-CURRENT-TMST    TO ITMCLT-EFF-BEG-TMST               37430000
357900                                ITMCLC-EFF-BEG-TMST.              37440000
358000     MOVE PC-NEG-1           TO PV-EFF-END-DTE-NULL.              37450000
358100     MOVE 'S' TO ITMCLT-CLUSTR-TYP-CDE.                           37460000
358200     MOVE LOW-VALUES TO ITMCLT-MDSE-NM-CDE.                       37470000
358300     MOVE LOW-VALUES TO ITMCLT-PROD-SERV-CDE.                     37480000
358400     MOVE PC-NEG-1   TO PV-MDSE-NM-CDE-NULL                       37490000
358500                        PV-PROD-SERV-CDE-NULL.                    37500000
358600                                                                  37510000
358700     MOVE 'M'   TO    ITMCLT-HIER-TYP-CDE.                        37520000
358800     MOVE 'C'   TO    ITMCLT-ITEM-CLUSTR-CDE.                     37530000
358900     MOVE 'VST' TO    ITMCLT-HIER-CDE.                            37540000
359000     MOVE ZEROES TO   PV-CLUSTR-TYP-CDE-NULL                      37550000
359100                      PV-HIER-TYP-CDE-NULL                        37560000
359200                      PV-HIER-CDE-NULL                            37570000
359300                      PV-CHLD-CDE-NULL.                           37580000
359400                                                                  37590000
359500     MOVE TSK-LONG-VENDOR-STYLE                                   37600000
359600                             TO ITMCLT-ITEM-CLUSTR-NAME           37610000
359700                                ITMCLT-ITEM-CLUSTR-DESC.          37620000
359800                                                                  37630000
359900     MOVE PV-DEPT-PRNT-CLUSTR-ID  TO ITMCLT-OWNER-ID.             37640000
360000     MOVE ZERO                    TO PV-OWNER-ID-NULL.            37650000
360100                                                                  37660000
360200******** INSERT VENDOR STYLE CLUSTR AND RELATIONSHIPS ********    37670000
360300                                                                  37680000
360400     PERFORM C200-INSERT-TITMCLT.                                 37690000
360500                                                                  37700000
360600     MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-VST-CHLD-CLUSTR-ID.         37710000
360700     PERFORM C951-CREATE-VST-SKU-RELATION.                        37720000
360800                                                                  37730000
360900     MOVE PV-VST-CHLD-CLUSTR-ID TO ITMCLC-CHLD-ITM-CLUSTR-ID.     37740000
361000     MOVE PV-VND-PRNT-CLUSTR-ID TO ITMCLC-PRNT-ITM-CLUSTR-ID.     37750000
361100     MOVE 'M'    TO ITMCLC-REL-TYP-CDE.                           37760000
361200     MOVE 'C'    TO ITMCLC-CHLD-ITM-CLSTR-CDE.                    37770000
361300                                                                  37780000
361400     PERFORM C700-INSERT-ITMCLC.                                  37790000
361500                                                                  37800000
361600                                                                  37810000
361700******************************************************************37820000
361800*                                                                *37830000
361900* GET ITEM_CLUSTR_ID FOR THE GIVEN CLUSTER NAME AND HIERARCHY CDE*37840000
362000*                                                                *37850000
362100******************************************************************37860000
362200 D100-GET-CLUSTR-ID.                                              37870000
362300                                                                  37880000
362400     MOVE 'D100-GET-CLUSTR-ID'                                    37890000
362500               TO  PV-ABEND-PARAGRAPH.                            37900000
362600*    DISPLAY 'D100-GET-CLUSTR-ID'.                                37910046
362700*    DISPLAY 'ITMCLT-ITM-CL-NAME ' ITMCLT-ITEM-CLUSTR-NAME.       37920046
362800*    DISPLAY 'ITMCLT-HIER-CDE ' ITMCLT-HIER-CDE.                  37930046
362900     PERFORM X100-REPLACE-SPEC-CHARS.                             37940000
363000                                                                  37950000
363100     IF ITMCLT-HIER-CDE = LOW-VALUES                              37960000
363200                                                                  37970000
363300         EXEC SQL                                                 37980000
363400             SELECT ITEM_CLUSTR_ID,                               37990000
363500                    ITEM_CLUSTR_DESC,                             38000000
363600                    EFF_BEG_TMST,                                 38010000
363700                    EFF_END_TMST,                                 38020000
363800                    LAST_UPD_TMST                                 38030000
363900             INTO  :ITMCLT-ITEM-CLUSTR-ID,                        38040000
364000                   :ITMCLT-ITEM-CLUSTR-DESC,                      38050000
364100                   :ITMCLT-EFF-BEG-TMST,                          38060000
364200                   :ITMCLT-EFF-END-TMST:PV-EFF-END-DTE-NULL,      38070000
364300                   :ITMCLT-LAST-UPD-TMST                          38080000
364400             FROM   TITMCLT                                       38090000
364500             WHERE                                                38100000
364600                    ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME   38110000
364700             AND    HIER_CDE         IS NULL                      38120000
364800             AND  ((EFF_END_TMST IS NULL) OR                      38130000
364900                   (EFF_END_TMST > :PV-CURR-END-TMST))            38140000
365000         END-EXEC                                                 38150000
365100*                  (EFF_END_DTE > CURRENT DATE))                  38160000
365200                                                                  38170000
365300         EVALUATE TRUE                                            38180000
365400           WHEN SQLCODE = ZEROS                                   38190000
365500           WHEN SQLCODE = 1403                                    38200000
365600             CONTINUE                                             38210000
365700           WHEN OTHER                                             38220000
365800             DISPLAY PV-ABEND-PARAGRAPH                           38230000
365900             DISPLAY 'ITEM-CLUSTR-NAME = ' ITMCLT-ITEM-CLUSTR-NAME38240000
366000             PERFORM Z999-SQL-ERROR                               38250000
366100         END-EVALUATE                                             38260000
366200                                                                  38270000
366300     ELSE                                                         38280000
366400     IF ITMCLT-HIER-CDE = 'VND' OR 'VST'                          38290000
366500                                                                  38300000
366600         EXEC SQL                                                 38310000
366700             SELECT ITEM_CLUSTR_ID,                               38320000
366800                    ITEM_CLUSTR_DESC,                             38330000
366900                    EFF_BEG_TMST,                                 38340000
367000                    EFF_END_TMST,                                 38350000
367100                    LAST_UPD_TMST                                 38360000
367200             INTO  :ITMCLT-ITEM-CLUSTR-ID,                        38370000
367300                   :ITMCLT-ITEM-CLUSTR-DESC,                      38380000
367400                   :ITMCLT-EFF-BEG-TMST,                          38390000
367500                   :ITMCLT-EFF-END-TMST:PV-EFF-END-DTE-NULL,      38400000
367600                   :ITMCLT-LAST-UPD-TMST                          38410000
367700             FROM   TITMCLT                                       38420000
367800             WHERE                                                38430000
367900                    ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME   38440000
368000             AND    HIER_CDE         = :ITMCLT-HIER-CDE           38450000
368100             AND    OWNER_ID         = :ITMCLT-OWNER-ID           38460000
368200             AND  ((EFF_END_TMST IS NULL) OR                      38470000
368300                   (EFF_END_TMST > :PV-CURR-END-TMST))            38480000
368400         END-EXEC                                                 38490000
368500                                                                  38500000
368600*                  (EFF_END_DTE > CURRENT DATE))                  38510000
368700                                                                  38520000
368800         EVALUATE TRUE                                            38530000
368900           WHEN SQLCODE = ZEROS                                   38540000
369000           WHEN SQLCODE = 1403                                    38550000
369100             CONTINUE                                             38560000
369200           WHEN OTHER                                             38570000
369300             DISPLAY PV-ABEND-PARAGRAPH                           38580000
369400             DISPLAY 'ITEM-CLUSTR-NAME = ' ITMCLT-ITEM-CLUSTR-NAME38590000
369500             PERFORM Z999-SQL-ERROR                               38600000
369600         END-EVALUATE                                             38610000
369700                                                                  38620000
369800     ELSE                                                         38630000
369900                                                                  38640000
370000         EXEC SQL                                                 38650000
370100             SELECT ITEM_CLUSTR_ID,                               38660000
370200                    ITEM_CLUSTR_DESC,                             38670000
370300                    EFF_BEG_TMST,                                 38680000
370400                    EFF_END_TMST,                                 38690000
370500                    LAST_UPD_TMST                                 38700000
370600             INTO  :ITMCLT-ITEM-CLUSTR-ID,                        38710000
370700                   :ITMCLT-ITEM-CLUSTR-DESC,                      38720000
370800                   :ITMCLT-EFF-BEG-TMST,                          38730000
370900                   :ITMCLT-EFF-END-TMST:PV-EFF-END-DTE-NULL,      38740000
371000                   :ITMCLT-LAST-UPD-TMST                          38750000
371100             FROM   TITMCLT                                       38760000
371200             WHERE                                                38770000
371300                    ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME   38780000
371400             AND    HIER_CDE         = :ITMCLT-HIER-CDE           38790000
371500             AND  ((EFF_END_TMST IS NULL) OR                      38800000
371600                   (EFF_END_TMST > :PV-CURR-END-TMST))            38810000
371700         END-EXEC                                                 38820000
371800*                  (EFF_END_DTE > CURRENT DATE))                  38830000
371900                                                                  38840000
372000         EVALUATE TRUE                                            38850000
372100           WHEN SQLCODE = ZEROS                                   38860000
372200           WHEN SQLCODE = 1403                                    38870000
372300             CONTINUE                                             38880000
372400           WHEN OTHER                                             38890000
372500             DISPLAY PV-ABEND-PARAGRAPH                           38900000
372600             DISPLAY 'ITEM-CLUSTR-NAME = ' ITMCLT-ITEM-CLUSTR-NAME38910000
**TEMP             DISPLAY 'HIER-CDE ' ITMCLT-HIER-CDE                  38912046
372700             PERFORM Z999-SQL-ERROR                               38920000
372800         END-EVALUATE                                             38930000
372900                                                                  38940000
373000     END-IF                                                       38950000
373100     END-IF.                                                      38960000
373200                                                                  38970000
373300******************************************************************38980000
373400*  CHECK TO SEE IF THE VENDOR STYLE CLUSTER EXISTS WITH A        *38990000
373500*  RELATIONSHIP WITH THE VENDOR CLUSTER.                         *39000000
373600******************************************************************39010000
373700 D105-GET-VST-CLUSTR-ID.                                          39020000
373800                                                                  39030000
373900     MOVE 'D105-GET-VST-CLUSTR-ID'                                39040000
374000               TO  PV-ABEND-PARAGRAPH.                            39050000
374100                                                                  39060000
374200     PERFORM X100-REPLACE-SPEC-CHARS.                             39070000
374300                                                                  39080000
374400     EXEC SQL                                                     39090000
374500         SELECT /*+ INDEX(A IITMCLT1) */                          39100000
374600                ITEM_CLUSTR_ID,                                   39110000
374700                ITEM_CLUSTR_DESC,                                 39120000
374800                EFF_BEG_TMST,                                     39130000
374900                EFF_END_TMST                                      39140000
375000         INTO  :ITMCLT-ITEM-CLUSTR-ID,                            39150000
375100               :ITMCLT-ITEM-CLUSTR-DESC,                          39160000
375200               :ITMCLT-EFF-BEG-TMST,                              39170000
375300               :ITMCLT-EFF-END-TMST:PV-EFF-END-DTE-NULL           39180000
375400         FROM   TITMCLT A                                         39190000
375500         WHERE                                                    39200000
375600                ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME       39210000
375700         AND    HIER_CDE         = :ITMCLT-HIER-CDE               39220000
375800         AND    OWNER_ID         = :ITMCLT-OWNER-ID               39230000
375900         AND  ((EFF_END_TMST IS NULL) OR                          39240000
376000               (EFF_END_TMST > :PV-CURR-END-TMST))                39250000
376100         AND EXISTS                                               39260000
376200             (SELECT CHLD_ITM_CLUSTR_ID                           39270000
376300              FROM   TITMCLC                                      39280000
376400              WHERE                                               39290000
376500                  PRNT_ITM_CLUSTR_ID = :PV-VND-PRNT-CLUSTR-ID     39300000
376600              AND CHLD_ITM_CLUSTR_ID = A.ITEM_CLUSTR_ID           39310000
376700              AND REL_TYP_CDE        = 'M'                        39320000
376800              AND  ((EFF_END_TMST IS NULL) OR                     39330000
376900                    (EFF_END_TMST > :PV-CURR-END-TMST))           39340000
377000          AND EXISTS                                              39350000
377100             (SELECT CHLD_ITM_CLUSTR_ID                           39360000
377200                FROM  TITMCLC X                                   39370000
377300                WHERE                                             39380000
377400                X.PRNT_ITM_CLUSTR_ID = TITMCLC.CHLD_ITM_CLUSTR_ID 39390000
377500             AND X.CHLD_ITM_CLUSTR_ID = :PV-HOLD-ITEM-ID          39400000
377600             AND X.REL_TYP_CDE = 'M'                              39410000
377700             AND (( X.EFF_END_TMST IS NULL)                       39420000
377800                  OR (X.EFF_END_TMST > :PV-CURR-END-TMST))))      39430000
377900     END-EXEC.                                                    39440000
378000                                                                  39450000
378100     EVALUATE TRUE                                                39460000
378200       WHEN SQLCODE = ZEROS                                       39470000
378300       WHEN SQLCODE = 1403                                        39480000
378400         CONTINUE                                                 39490000
378500       WHEN OTHER                                                 39500000
378600         DISPLAY PV-ABEND-PARAGRAPH                               39510000
378700         DISPLAY 'ITEM-CLUSTR-NAME = ' ITMCLT-ITEM-CLUSTR-NAME    39520000
378800         DISPLAY 'PRNT-ITM-CLUSTR  = ' PV-VND-PRNT-CLUSTR-ID      39530000
378900         DISPLAY 'CHLD-ITM-CLUSTR  = ' PV-HOLD-ITEM-ID            39540000
379000         PERFORM Z999-SQL-ERROR                                   39550000
379100     END-EVALUATE.                                                39560000
379200                                                                  39570000
379300                                                                  39580000
379400******************************************************************39590000
379500*  CHECK FOR THE VENDOR STYLE NAME AND A CORRESPONDING           *39600000
379600*  VENDOR STYLE/VENDOR RELATIONSHIP.  DON'T LOOK FOR A SKU       *39610000
379700*  RELATIONSHIP.                                                 *39620000
379800*                                                                *39630000
379900*  THIS PARAGRAPH WAS ADDED TO FIX THE DUP VST PROBLEM.  THE     *39640000
380000*  SAME VENDOR STYLE WAS BEING ADDED TO TITMCLT WITH DIFFERENT   *39650000
380100*  CLUSTER ID'S.                                                 *39660000
380200*                                                                *39670000
380300*  THE PROBLEM OCCURRED WHEN A VENDOR STYLE NAME WAS CHANGED.    *39680000
380400*  THE FIRST SKU (AND NEWLY CREATED VENDOR STYLE RECORD) WOULD   *39690000
380500*  BE ADDED TO CLT CORRECTLY.  HOWEVER, PROCESSING OF SUBSEQUENT *39700000
380600*  SKUS WOULD RESULT IN THE CREATION OF ANOTHER VENDOR STYLE     *39710000
380700*  RECORD WITH A DIFFERENT CLUSTER ID.                           *39720000
380800*                                                                *39730000
380900*  D105-GET-VST-CLUSTR-ID LOOKS FOR THE VENDOR STYLE, A          *39740000
381000*  VENDOR STYLE/VENDOR RELATIONSHIP, AND A VENDOR SYTLE/SKU      *39750000
381100*  RELATIONSHIP.  FOR SUBSEQUENT SKUS, THE VENDOR STYLE EXISTS   *39760000
381200*  AND THE VENDOR STYLE/VENDOR RELATIONSHIP EXISTS.  THE VENDOR  *39770000
381300*  STYLE/SKU RELATIONSHIP DOES NOT.                              *39780000
381400*                                                                *39790000
381500*  SO THE FIRST D105 LOGIC WAS RETURNING "NOT FOUNDS" FOR ALL    *39800000
381600*  SUBSEQUENT SKUS AND THE C955-CREATE-VNDR-STYLE-CLUSTS LOGIC   *39810000
381700*  WAS BEING PERFORMED FOR ALL THE SKUS.                         *39820000
381800******************************************************************39830000
381900 D105-GET-VST-CLUSTR-ID-NO-SKU.                                   39840000
382000                                                                  39850000
382100     MOVE 'D105-GET-VST-CLUSTR-ID-NO-SKU'                         39860000
382200               TO  PV-ABEND-PARAGRAPH.                            39870000
382300                                                                  39880000
382400     EXEC SQL                                                     39890000
382500         OPEN VSTCSR                                              39900000
382600     END-EXEC.                                                    39910000
382700                                                                  39920000
382800     EXEC SQL                                                     39930000
382900         FETCH VSTCSR                                             39940000
383000         INTO  :ITMCLT-ITEM-CLUSTR-ID,                            39950000
383100               :ITMCLT-ITEM-CLUSTR-DESC,                          39960000
383200               :ITMCLT-EFF-BEG-TMST,                              39970000
383300               :ITMCLT-EFF-END-TMST:PV-EFF-END-DTE-NULL           39980000
383400     END-EXEC.                                                    39990000
383500                                                                  40000000
383600     EVALUATE TRUE                                                40010000
383700       WHEN SQLCODE = ZEROS                                       40020000
383800       WHEN SQLCODE = 1403                                        40030000
383900         CONTINUE                                                 40040000
384000       WHEN OTHER                                                 40050000
384100         DISPLAY PV-ABEND-PARAGRAPH                               40060000
384200         DISPLAY 'ITEM-CLUSTR-NAME = ' ITMCLT-ITEM-CLUSTR-NAME    40070000
384300         DISPLAY 'PRNT-ITM-CLUSTR  = ' PV-VND-PRNT-CLUSTR-ID      40080000
384400         PERFORM Z999-SQL-ERROR                                   40090000
384500     END-EVALUATE.                                                40100000
384600                                                                  40110000
384700                                                                  40120000
384800******************************************************************40130000
384900*  CHECK TO SEE IF THE VENDOR EXISTS WITH A DIFFERENT NAME IN    *40140000
385000*  THE SAME OWNER ID.                                            *40150000
385100******************************************************************40160000
385200 D106-SELECT-VND-CLUSTR-ID.                                       40170000
385300                                                                  40180000
385400     MOVE 'D106-SELECT-VND-CLUSTR-ID'                             40190000
385500               TO  PV-ABEND-PARAGRAPH.                            40200000
385600                                                                  40210000
385700     MOVE WS-VND-CLUSTR-NAME-ENTID TO WS-VND-ENTID.               40220000
385800                                                                  40230000
385900     EXEC SQL                                                     40240000
386000         SELECT ITEM_CLUSTR_ID,                                   40250000
386100                ITEM_CLUSTR_DESC,                                 40260000
386200                EFF_BEG_TMST,                                     40270000
386300                EFF_END_TMST                                      40280000
386400         INTO  :ITMCLT-ITEM-CLUSTR-ID,                            40290000
386500               :ITMCLT-ITEM-CLUSTR-DESC,                          40300000
386600               :ITMCLT-EFF-BEG-TMST,                              40310000
386700               :ITMCLT-EFF-END-TMST:PV-EFF-END-DTE-NULL           40320000
386800         FROM   TITMCLT A                                         40330000
386900         WHERE                                                    40340000
387000                HIER_CDE         = :ITMCLT-HIER-CDE               40350000
387100         AND    OWNER_ID         = :ITMCLT-OWNER-ID               40360000
387200         AND    SUBSTR(ITEM_CLUSTR_NAME,12,9)                     40370000
387300                          = LPAD(TO_CHAR(:TSK-ENT-ID),9,0)        40380000
387400         AND  ((EFF_END_TMST IS NULL) OR                          40390000
387500               (EFF_END_TMST > :PV-CURR-END-TMST))                40400000
387600     END-EXEC.                                                    40410000
387700                                                                  40420000
387800     EVALUATE TRUE                                                40430000
387900       WHEN SQLCODE = ZEROS                                       40440000
388000       WHEN SQLCODE = 1403                                        40450000
388100         CONTINUE                                                 40460000
388200       WHEN OTHER                                                 40470000
388300         DISPLAY PV-ABEND-PARAGRAPH                               40480000
388400         DISPLAY 'ITEM-CLUSTR-NAME ENT ID = ' TSK-ENT-ID          40490000
388500         DISPLAY '        OWNER ID = ' ITMCLT-OWNER-ID            40500000
388600         DISPLAY '        HIER CDE = ' ITMCLT-HIER-CDE            40510000
388700         PERFORM Z999-SQL-ERROR                                   40520000
388800     END-EVALUATE.                                                40530000
388900                                                                  40540000
389000******************************************************************40550000
389100*  UPDATE THE ITEM NAME IF THE VENDOR NAME HAS CHANGED.          *40560000
389200******************************************************************40570000
389300 D107-UPDATE-VND-ITM-CLUSTR-NME.                                  40580000
389400                                                                  40590000
389500     MOVE 'D107-UPDATE-VND-ITM-CLUSTR-NME'                        40600000
389600               TO  PV-ABEND-PARAGRAPH.                            40610000
389700                                                                  40620000
389800     EXEC SQL                                                     40630000
389900         UPDATE TITMCLT                                           40640000
390000            SET ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME       40650000
390100         WHERE                                                    40660000
390200                ITEM_CLUSTR_ID   = :ITMCLT-ITEM-CLUSTR-ID         40670000
390300         AND    HIER_CDE         = :ITMCLT-HIER-CDE               40680000
390400         AND    OWNER_ID         = :ITMCLT-OWNER-ID               40690000
390500         AND  ((EFF_END_TMST IS NULL) OR                          40700000
390600               (EFF_END_TMST > :PV-CURR-END-TMST))                40710000
390700     END-EXEC.                                                    40720000
390800                                                                  40730000
390900     EVALUATE TRUE                                                40740000
391000       WHEN SQLCODE = ZEROS                                       40750000
0822RM         ADD +1 TO PV-INS-UPD-COUNT                               40760022
391100*        DISPLAY 'UPDATE VENDOR NAME: ' ITMCLT-ITEM-CLUSTR-NAME   40770009
391200*        DISPLAY '    ITEM_CLUSTR_ID: ' ITMCLT-ITEM-CLUSTR-ID     40780009
0822RM         CONTINUE                                                 40790009
391300       WHEN SQLCODE = 1403                                        40800000
391400         CONTINUE                                                 40810000
391500       WHEN OTHER                                                 40820000
391600         DISPLAY PV-ABEND-PARAGRAPH                               40830000
391700         DISPLAY 'ITEM-CLUSTR-NAME ENT ID = ' TSK-ENT-ID          40840000
391800         DISPLAY '        OWNER ID = ' ITMCLT-OWNER-ID            40850000
391900         DISPLAY '        HIER CDE = ' ITMCLT-HIER-CDE            40860000
392000         PERFORM Z999-SQL-ERROR                                   40870000
392100     END-EVALUATE.                                                40880000
392200                                                                  40890000
392300******************************************************************40900000
392400*  CHECK TO SEE IF THE VENDOR STYLE CLUSTER EXISTS WITH A        *40910000
392500*  RELATIONSHIP WITH THE VENDOR CLUSTER.                         *40920000
392600*  THIS PROCESS IS FOR THE RENUMBERED OR NEW SKU'S               *40930000
392700******************************************************************40940000
392800 D108-GET-VST-CLUSTR-ID-2.                                        40950000
392900                                                                  40960000
393000*    DISPLAY 'D108-GET-VST-CLUSTR-ID-2'.                          40970006
393100     MOVE 'D108-GET-VST-CLUSTR-ID-2'                              40980000
393200               TO  PV-ABEND-PARAGRAPH.                            40990000
393300                                                                  41000000
393400     PERFORM X100-REPLACE-SPEC-CHARS.                             41010000
393500                                                                  41020000
393600     EXEC SQL                                                     41030000
393700         SELECT /*+ INDEX(A IITMCLT1) */                          41040000
393800                ITEM_CLUSTR_ID,                                   41050000
393900                ITEM_CLUSTR_DESC,                                 41060000
394000                EFF_BEG_TMST,                                     41070000
394100                EFF_END_TMST                                      41080000
394200         INTO  :ITMCLT-ITEM-CLUSTR-ID,                            41090000
394300               :ITMCLT-ITEM-CLUSTR-DESC,                          41100000
394400               :ITMCLT-EFF-BEG-TMST,                              41110000
394500               :ITMCLT-EFF-END-TMST:PV-EFF-END-DTE-NULL           41120000
394600         FROM   TITMCLT A                                         41130000
394700         WHERE                                                    41140000
394800                ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME       41150000
394900         AND    HIER_CDE         = :ITMCLT-HIER-CDE               41160000
395000         AND    OWNER_ID         = :ITMCLT-OWNER-ID               41170000
395100         AND  ((EFF_END_TMST IS NULL) OR                          41180000
395200               (EFF_END_TMST > :PV-CURR-END-TMST))                41190000
395300         AND EXISTS                                               41200000
395400             (SELECT CHLD_ITM_CLUSTR_ID                           41210000
395500              FROM   TITMCLC                                      41220000
395600              WHERE                                               41230000
395700                  PRNT_ITM_CLUSTR_ID = :PV-VND-PRNT-CLUSTR-ID     41240000
395800              AND CHLD_ITM_CLUSTR_ID = A.ITEM_CLUSTR_ID           41250000
395900              AND REL_TYP_CDE        = 'M'                        41260000
396000              AND  ((EFF_END_TMST IS NULL) OR                     41270000
396100                    (EFF_END_TMST > :PV-CURR-END-TMST))           41280000
396200          AND EXISTS                                              41290000
396300             (SELECT CHLD_ITM_CLUSTR_ID                           41300000
396400                FROM  TITMCLC X,                                  41310000
396500                      TITMCLT Y                                   41320000
396600                WHERE                                             41330000
396700                X.PRNT_ITM_CLUSTR_ID = TITMCLC.CHLD_ITM_CLUSTR_ID 41340000
396800             AND X.CHLD_ITM_CLUSTR_ID = Y.ITEM_CLUSTR_ID          41350000
396900             AND Y.ITEM_CLUSTR_NAME LIKE :PV-HOLD-DPT-SCL         41360000
397000             AND X.CHLD_ITM_CLSTR_CDE = 'I'                       41370000
397100             AND X.REL_TYP_CDE = 'M'                              41380000
397200             AND (( X.EFF_END_TMST IS NULL)                       41390000
397300                  OR (X.EFF_END_TMST > :PV-CURR-END-TMST))))      41400000
397400     END-EXEC.                                                    41410000
397500                                                                  41420000
397600     EVALUATE TRUE                                                41430000
397700       WHEN SQLCODE = ZEROS                                       41440000
397800       WHEN SQLCODE = 1403                                        41450000
397900         CONTINUE                                                 41460000
398000       WHEN SQLCODE = PC-MULT-VALUES                              41470000
398100         DISPLAY ' '                                              41480000
398200         DISPLAY '*********************************'              41490000
398300         DISPLAY 'MULTIPLE VST RECORDS FOUND FOR : '              41500000
398400                  ITMCLT-ITEM-CLUSTR-NAME                         41510000
398500         DISPLAY 'FISRT RECORD FOUND WAS USED.'                   41520000
398600         DISPLAY '*********************************'              41530000
398700         DISPLAY ' '                                              41540000
398800       WHEN OTHER                                                 41550000
398900         DISPLAY PV-ABEND-PARAGRAPH                               41560000
399000         DISPLAY 'ITEM-CLUSTR-NAME = ' ITMCLT-ITEM-CLUSTR-NAME    41570000
399100         DISPLAY 'PRNT-ITM-CLUSTR  = ' PV-VND-PRNT-CLUSTR-ID      41580000
399200         DISPLAY 'CHLD-ITM-CLUSTR  = ' PV-HOLD-ITEM-ID            41590000
399300         PERFORM Z999-SQL-ERROR                                   41600000
399400     END-EVALUATE.                                                41610000
399500                                                                  41620000
399600******************************************************************41630000
399700*                                                                *41640000
399800*                                                                *41650000
399900******************************************************************41660000
400000 D110-GET-NICK-NAME.                                              41670000
400100                                                                  41680000
400200*    DISPLAY 'D110-GET-NICK-NAME'.                                41690006
400300     MOVE ITMCLC-CHLD-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-2        41700000
400400*    DISPLAY 'CHLD-ITM-CLUSTR-ID: ' PV-WORK-CLUSTR-ID-2           41710006
400500     MOVE 'D110-GET-NICK-NAME'                                    41720000
400600               TO  PV-ABEND-PARAGRAPH.                            41730000
400700     EXEC SQL                                                     41740000
400800         SELECT ITEM_CLUSTR_NAME,                                 41750000
400900                HIER_CDE                                          41760000
401000         INTO   :ITMCLT-ITEM-CLUSTR-NAME,                         41770000
401100                :ITMCLT-HIER-CDE:PV-HIER-CDE-NULL                 41780000
401200         FROM   TITMCLT                                           41790000
401300         WHERE                                                    41800000
401400                ITEM_CLUSTR_ID   = :ITMCLC-CHLD-ITM-CLUSTR-ID     41810000
401500     END-EXEC.                                                    41820000
401600                                                                  41830000
401700     EVALUATE TRUE                                                41840000
401800       WHEN SQLCODE = ZEROS                                       41850000
401900         IF PV-HIER-CDE-NULL < 0                                  41860000
402000            MOVE LOW-VALUES TO ITMCLT-HIER-CDE                    41870000
402100         END-IF                                                   41880000
402200       WHEN OTHER                                                 41890000
402300         DISPLAY PV-ABEND-PARAGRAPH                               41900000
402400         PERFORM Z999-SQL-ERROR                                   41910000
402500     END-EVALUATE.                                                41920000
402600                                                                  41930000
402700******************************************************************41940000
402800*                                                                *41950000
402900*                                                                *41960000
403000******************************************************************41970000
403100 D120-GET-NEW-SKU-INFO.                                           41980000
403200                                                                  41990000
403300*    DISPLAY 'D120-GET-NEW-SKU-INFO'.                             42000006
403400                                                                  42010000
403500     MOVE 'D120-GET-NEW-SKU-INFO'                                 42020000
403600               TO  PV-ABEND-PARAGRAPH.                            42030000
403700     EXEC SQL                                                     42040000
403800        SELECT STATUS_CODE,                                       42050000
403900               STAT_CHNGD_DATE,                                   42060000
404000               LONG_VENDOR_STYLE,                                 42070000
404100               VNDR_IN_HSE_NMBR,                                  42080000
404200               LONG_SIZE_DESC,                                    42090000
404300               LONG_COLOR_DESC,                                   42100000
404400               GP_QTY,                                            42110000
404500               GP_RTL_AMT,                                        42120000
404600               CUR_UNIT_RTL_AMT,                                  42130000
404700               RTL_UNIT_MSRMNT,                                   42140000
404800               ENT_ID                                             42150000
404900        INTO   :PV-TSK-STATUS-CDE,                                42160000
405000               :PV-TSK-STATUS-CHNGD-DATE,                         42170000
405100               :MDSEIT-VNDR-STYL-ID,                              42180000
405200               :PV-TSK-VNDR-INHOUSE-NBR,                          42190000
405300               :MDSEIT-SIZE-DESC,                                 42200000
405400               :MDSEIT-COLOR-DESC,                                42210000
405500               :PV-TSK-GRP-QTY,                                   42220000
405600               :MDSEIT-GRP-RTL-AMT,                               42230000
405700               :MDSEIT-UNIT-RTL-AMT,                              42240000
405800               :MDSEIT-UNIT-RTL-UOM-CDE,                          42250000
405900               :MDSEIT-ENT-ID                                     42260000
406000        FROM TSK                                                  42270000
406100        WHERE ITEM_NMBR =:TSK-ITEM-NMBR                           42280000
406200     END-EXEC.                                                    42290000
406300                                                                  42300000
406400                                                                  42310000
406500     EVALUATE TRUE                                                42320000
406600       WHEN SQLCODE = ZEROS                                       42330000
406700                                                                  42340000
406800*          DISPLAY 'STATUS-CDE = '    PV-TSK-STATUS-CDE           42350006
406900*          DISPLAY 'INHOUSE-NBR ='    PV-TSK-VNDR-INHOUSE-NBR     42360006
407000*          DISPLAY 'GRP-QTY     ='    PV-TSK-GRP-QTY              42370006
407100                                                                  42380000
407200           MOVE PV-TSK-GRP-QTY        TO MDSEIT-GRP-QTY           42390000
407300           MOVE PV-TSK-STATUS-CDE     TO MDSEIT-STAT-CDE          42400000
407400           MOVE PV-TSK-VNDR-INHOUSE-NBR                           42410000
407500                                      TO MDSEIT-VNDR-INHOUSE-NBR  42420000
407600           MOVE PV-TSK-STATUS-CHNGD-DATE                          42430000
407700                                      TO TSK-STAT-CHNGD-DATE      42440000
407800                                                                  42450000
407900           PERFORM D121-GET-TSKXREF-INFO                          42460000
408000*          IF SQLCODE = ZERO                                      42470009
408100*              DISPLAY 'MDSEIT-UNIT-RTL-AMT ='                    42480009
408200*                                     MDSEIT-UNIT-RTL-AMT         42490009
408300*              DISPLAY 'MDSEIT-GRP-RTL-AMT =' MDSEIT-GRP-RTL-AMT  42500009
408400*          END-IF                                                 42510009
408500       WHEN SQLCODE = +1403                                       42520000
408600         CONTINUE                                                 42530000
408700       WHEN OTHER                                                 42540000
408800         DISPLAY PV-ABEND-PARAGRAPH                               42550000
408900         PERFORM Z999-SQL-ERROR                                   42560000
409000     END-EVALUATE.                                                42570000
409100                                                                  42580000
409200     IF SQLCODE = ZERO                                            42590000
409300     IF    TSK-STAT-CHNGD-DATE    > ZERO                          42600000
409400                                                                  42610000
409500       IF TSK-STAT-CHNGD-DATE  = 9999999                          42620000
409600        MOVE PC-NEG-1 TO PV-STAT-CHNG-DTE-NULL                    42630000
409700       ELSE                                                       42640000
409800         MOVE TSK-STAT-CHNGD-DATE    TO  PV-STAT-CHNGD-DATE       42650000
409900         IF PV-STAT-CHNGD-DATE(2:2) < 80                          42660000
410000           MOVE '20'                    TO  WS-DB-CC              42670000
410100*          MOVE  TSK-STAT-CHNGD-DATE    TO  PV-STAT-CHNGD-DATE    42680000
410200           MOVE  PV-STAT-CHNGD-DATE(2:2) TO WS-DB-YY              42690000
410300           MOVE  PV-STAT-CHNGD-DATE(4:2) TO WS-DB-MO              42700000
410400           MOVE  PV-STAT-CHNGD-DATE(6:2) TO WS-DB-DD              42710000
410500           MOVE  WS-DB2-DATE             TO MDSEIT-STAT-CHNG-DTE  42720000
410600           MOVE  ZERO    TO PV-STAT-CHNG-DTE-NULL                 42730000
410700         ELSE                                                     42740000
410800           MOVE '19'                    TO  WS-DB-CC              42750000
410900*          MOVE  TSK-STAT-CHNGD-DATE    TO  PV-STAT-CHNGD-DATE    42760000
411000           MOVE  PV-STAT-CHNGD-DATE(2:2) TO WS-DB-YY              42770000
411100           MOVE  PV-STAT-CHNGD-DATE(4:2) TO WS-DB-MO              42780000
411200           MOVE  PV-STAT-CHNGD-DATE(6:2) TO WS-DB-DD              42790000
411300           MOVE  WS-DB2-DATE             TO MDSEIT-STAT-CHNG-DTE  42800000
411400           MOVE  ZERO    TO PV-STAT-CHNG-DTE-NULL                 42810000
411500         END-IF                                                   42820000
411600       END-IF                                                     42830000
411700                                                                  42840000
411800     ELSE                                                         42850000
411900        MOVE PC-NEG-1 TO PV-STAT-CHNG-DTE-NULL                    42860000
412000     END-IF                                                       42870000
412100     END-IF.                                                      42880000
412200                                                                  42890000
412300******************************************************************42900000
412400* BECAUSE OF THE DB2 TABLES BEING SO LARGE, THEY ARE BROKEN      *42910000
412500* APART, THIS IS TO GET THE SIZE AND COLOR CODE INFORMATION.      42920000
412600******************************************************************42930000
412700  D121-GET-TSKXREF-INFO.                                          42940000
412800                                                                  42950000
412900     MOVE 'D121-GET-TSKXREF-INFO' TO  PV-ABEND-PARAGRAPH.         42960000
413000                                                                  42970000
413100     EXEC SQL                                                     42980000
413200        SELECT INTR_UPC_ID                                        42990000
413300        INTO   :SKXREF-INTR-UPC-ID                                43000000
413400        FROM TSKXREF                                              43010000
413500        WHERE ITM_NBR =:TSK-ITEM-NMBR                             43020000
413600     END-EXEC.                                                    43030000
413700                                                                  43040000
413800     EVALUATE TRUE                                                43050000
413900       WHEN SQLCODE = ZEROS                                       43060000
414000            PERFORM D122-GET-TUPC-INFO                            43070000
414100       WHEN SQLCODE = +1403                                       43080000
414200         CONTINUE                                                 43090000
414300       WHEN OTHER                                                 43100000
414400         DISPLAY PV-ABEND-PARAGRAPH                               43110000
414500         PERFORM Z999-SQL-ERROR                                   43120000
414600     END-EVALUATE.                                                43130000
414700                                                                  43140000
414800                                                                  43150000
414900******************************************************************43160000
415000* BECAUSE OF THE DB2 TABLES BEING SO LARGE, THEY ARE BROKEN      *43170000
415100* APART, THIS IS TO GET THE SIZE AND COLOR CODE INFORMATION.      43180000
415200******************************************************************43190000
415300 D122-GET-TUPC-INFO.                                              43200000
415400                                                                  43210000
415500     MOVE 'D122-GET-TUPC-INFO' TO  PV-ABEND-PARAGRAPH.            43220000
415600                                                                  43230000
415700     EXEC SQL                                                     43240000
415800        SELECT KOHLS_SIZE_CDE,                                    43250000
415900               NRF_CLOR_CDE                                       43260000
416000        INTO   :MDSEIT-KOHLS-SIZE-CDE,                            43270000
416100               :MDSEIT-NRF-CLOR-CDE                               43280000
416200        FROM  TUPC                                                43290000
416300        WHERE INTR_UPC_ID = :SKXREF-INTR-UPC-ID                   43300000
416400          AND UPC_TYP_CDE = 'I'                                   43310000
416500     END-EXEC.                                                    43320000
416600                                                                  43330000
416700     EVALUATE TRUE                                                43340000
416800       WHEN SQLCODE = ZEROS                                       43350000
0822RM*           DISPLAY 'MDSEIT-KOHLS-SIZE-CDE = '                    43360009
0822RM*                                   MDSEIT-KOHLS-SIZE-CDE         43370009
0822RM*           DISPLAY 'MDSEIT-NRF-CLOR-CDE = '                      43380009
0822RM*                                   MDSEIT-NRF-CLOR-CDE           43390009
0822RM         CONTINUE                                                 43400009
417300       WHEN SQLCODE = +1403                                       43410000
417400         CONTINUE                                                 43420000
417500       WHEN OTHER                                                 43430000
417600         DISPLAY PV-ABEND-PARAGRAPH                               43440000
417700         PERFORM Z999-SQL-ERROR                                   43450000
417800     END-EVALUATE.                                                43460000
417900                                                                  43470000
418000******************************************************************43480000
418100*                                                                *43490000
418200******************************************************************43500000
418300  D130-MOCK-UP-DESCRIPTION.                                       43510000
418400      MOVE 'D130-MOCK-UP-DESCRIPTION'                             43520000
418500                TO  PV-ABEND-PARAGRAPH.                           43530000
0822RM*     DISPLAY 'ATTEMPT TO FETCH DESCRIPTION FROM TSK'             43540009
0822RM*     DISPLAY '   FOR ' TSK-ITEM-NMBR                             43550009
418800                                                                  43560000
418900      EXEC SQL                                                    43570000
419000         SELECT SIZE_DESC,                                        43580000
419100                COLOR_DESC,                                       43590000
419200                SKU_DESC                                          43600000
419300         INTO   :TSK-SIZE-DESC,                                   43610000
419400                :TSK-COLOR-DESC,                                  43620000
419500                :TSK-SKU-DESC                                     43630000
419600        FROM TSK                                                  43640000
419700        WHERE ITEM_NMBR =: TSK-ITEM-NMBR                          43650000
419800      END-EXEC.                                                   43660000
419900                                                                  43670000
420000      EVALUATE TRUE                                               43680000
420100        WHEN SQLCODE = ZEROS                                      43690000
420200*          DISPLAY '   SIZE =  '  TSK-SIZE-DESC                   43700000
420300*          DISPLAY '   COLOR = '  TSK-COLOR-DESC                  43710000
420400*          DISPLAY '   DESC =  '  TSK-SKU-DESC                    43720000
420500           MOVE SPACES TO ITMCLT-ITEM-CLUSTR-DESC                 43730000
420600           STRING  TSK-SIZE-DESC  DELIMITED BY SIZE               43740000
420700                 ' '            DELIMITED BY SIZE                 43750000
420800                 TSK-COLOR-DESC DELIMITED BY SIZE                 43760000
420900                 ' '            DELIMITED BY SIZE                 43770000
421000                 TSK-SKU-DESC   DELIMITED BY SIZE                 43780000
421100                      INTO    ITMCLT-ITEM-CLUSTR-DESC             43790000
421200*          DISPLAY '   THE NEW ITEM-CLUSTR-DESC = '               43800006
421300*                    ITMCLT-ITEM-CLUSTR-DESC                      43810006
421400        WHEN SQLCODE = +1403                                      43820000
421500          DISPLAY                                                 43830000
421600            '   UNABLE TO MOCK UP TITMCLT DESCRIPTION FROM TSK'   43840000
421700        WHEN OTHER                                                43850000
421800          DISPLAY PV-ABEND-PARAGRAPH                              43860000
421900          PERFORM Z999-SQL-ERROR                                  43870000
422000      END-EVALUATE.                                               43880000
422100                                                                  43890000
422200******************************************************************43900000
422300*                                                                *43910000
422400*                                                                *43920000
422500******************************************************************43930000
422600 D200-OPEN-PARNT-CSR.                                             43940000
422700*    DISPLAY 'D200-OPEN-PARNT-CSR'.                               43950006
422800     MOVE 'D200-OPEN-PARNT-CSR'                                   43960000
422900               TO  PV-ABEND-PARAGRAPH.                            43970000
423000     EXEC SQL                                                     43980000
423100         OPEN  PRNTCSR                                            43990000
423200     END-EXEC.                                                    44000000
423300                                                                  44010000
423400     EVALUATE TRUE                                                44020000
423500       WHEN SQLCODE = ZEROS                                       44030000
423600          CONTINUE                                                44040000
423700       WHEN SQLCODE = 1403                                        44050000
423800         SET PS-NO-MORE-PARENTS   TO TRUE                         44060000
423900       WHEN OTHER                                                 44070000
424000         DISPLAY PV-ABEND-PARAGRAPH                               44080000
424100         PERFORM Z999-SQL-ERROR                                   44090000
424200     END-EVALUATE.                                                44100000
424300                                                                  44110000
424400******************************************************************44120000
424500*                                                                *44130000
424600*                                                                *44140000
424700******************************************************************44150000
424800 D201-OPEN-PARNT-CSR1.                                            44160000
424900                                                                  44170000
425000*    DISPLAY 'D201-OPEN-PARNT-CSR1'.                              44180006
425100     MOVE 'D200-OPEN-PARNT-CSR1'                                  44190000
425200               TO  PV-ABEND-PARAGRAPH.                            44200000
425300     EXEC SQL                                                     44210000
425400         OPEN  PRNTCSR1                                           44220000
425500     END-EXEC.                                                    44230000
425600                                                                  44240000
425700     EVALUATE TRUE                                                44250000
425800       WHEN SQLCODE = ZEROS                                       44260000
425900          CONTINUE                                                44270000
426000       WHEN SQLCODE = 1403                                        44280000
426100         SET PS-NO-MORE-PARENTS   TO TRUE                         44290000
426200       WHEN OTHER                                                 44300000
426300         DISPLAY PV-ABEND-PARAGRAPH                               44310000
426400         PERFORM Z999-SQL-ERROR                                   44320000
426500     END-EVALUATE.                                                44330000
426600                                                                  44340000
426700******************************************************************44350000
426800*                                                                *44360000
426900*                                                                *44370000
427000******************************************************************44380000
427100 D220-FETCH-PARNT-CSR.                                            44390000
427200*    DISPLAY 'D220-FETCH-PARNT-CSR'.                              44400006
427300     MOVE 'D220-FETCH-PARNT-CSR'                                  44410000
427400               TO  PV-ABEND-PARAGRAPH.                            44420000
427500                                                                  44430000
427600     EXEC SQL                                                     44440000
427700         FETCH PRNTCSR                                            44450000
427800         INTO  :ITMCLC-CHLD-ITM-CLUSTR-ID,                        44460000
427900               :ITMCLC-PRNT-ITM-CLUSTR-ID                         44470000
428000     END-EXEC.                                                    44480000
428100     EVALUATE TRUE                                                44490000
428200       WHEN SQLCODE = ZEROS                                       44500000
428300*        DISPLAY 'D220 SQLCODE = 0'                               44510006
428400         MOVE ITMCLC-CHLD-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-2    44520000
428500         MOVE ITMCLC-PRNT-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-1    44530000
428600*        DISPLAY 'ITMCLC PRNT: ' PV-WORK-CLUSTR-ID-1              44540006
428700*        DISPLAY 'ITMCLC CHLD: ' PV-WORK-CLUSTR-ID-2              44550006
428800                                                                  44560000
**TEMP*            DISPLAY ' D220 CALL TO C500-EXPIRE-RELATIONSHIPS'    44561027
**TEMP*            ADD +1 TO PV-INS-UPD-COUNT                           44562027
               PERFORM C500-EXPIRE-RELATIONSHIPS                        44570027
429000                                                                  44580000
429100         IF PS-SAVE-RELS                                          44590000
429200                                                                  44600000
429300             PERFORM C550-SAVE-RELATIONSHIPS                      44610000
429400         END-IF                                                   44620000
429500                                                                  44630000
429600       WHEN SQLCODE = 1403                                        44640000
429700         SET PS-NO-MORE-PARENTS   TO TRUE                         44650000
429800       WHEN OTHER                                                 44660000
429900         DISPLAY PV-ABEND-PARAGRAPH                               44670000
430000         PERFORM Z999-SQL-ERROR                                   44680000
430100     END-EVALUATE.                                                44690000
430200******************************************************************44700000
430300*                                                                *44710000
430400*                                                                *44720000
430500******************************************************************44730000
430600 D221-FETCH-PARNT-CSR1.                                           44740000
430700                                                                  44750000
430800*    DISPLAY 'D221-FETCH-PARNT-CSR1'.                             44760006
430900                                                                  44770000
431000     MOVE 'D221-FETCH-PARNT-CSR1'                                 44780000
431100               TO  PV-ABEND-PARAGRAPH.                            44790000
431200     EXEC SQL                                                     44800000
431300         FETCH PRNTCSR1                                           44810000
431400         INTO  :ITMCLC-CHLD-ITM-CLUSTR-ID,                        44820000
431500               :ITMCLC-PRNT-ITM-CLUSTR-ID                         44830000
431600     END-EXEC.                                                    44840000
431700     EVALUATE TRUE                                                44850000
431800       WHEN SQLCODE = ZEROS                                       44860000
431900*        DISPLAY 'D221 SQLCODE = 0'                               44870006
432000         MOVE ITMCLC-CHLD-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-2    44880000
432100         MOVE ITMCLC-PRNT-ITM-CLUSTR-ID TO PV-WORK-CLUSTR-ID-1    44890000
432200*        DISPLAY 'ITMCLC PRNT: ' PV-WORK-CLUSTR-ID-1              44900006
432300*        DISPLAY 'ITMCLC CHLD: ' PV-WORK-CLUSTR-ID-2              44910006
432400                                                                  44920000
**TEMP*        DISPLAY ' D221 CALL TO C500-EXPIRE-RELATIONSHIPS'        44921027
**TEMP*        ADD +1 TO PV-INS-UPD-COUNT                               44922027
               PERFORM C500-EXPIRE-RELATIONSHIPS                        44930027
432600                                                                  44940000
432700         IF PS-SAVE-RELS                                          44950000
432800                                                                  44960000
432900             PERFORM C550-SAVE-RELATIONSHIPS                      44970000
433000         END-IF                                                   44980000
433100                                                                  44990000
433200       WHEN SQLCODE = 1403                                        45000000
433300         SET PS-NO-MORE-PARENTS   TO TRUE                         45010000
433400       WHEN OTHER                                                 45020000
433500         DISPLAY PV-ABEND-PARAGRAPH                               45030000
433600         PERFORM Z999-SQL-ERROR                                   45040000
433700     END-EVALUATE.                                                45050000
433800******************************************************************45060000
433900*                                                                *45070000
434000*                                                                *45080000
434100******************************************************************45090000
434200 D230-CLOSE-PARNT-CSR.                                            45100000
434300*    DISPLAY 'D230-CLOSE-PARNT-CSR'.                              45110006
434400     MOVE 'D230-CLOSE-PARNT-CSR'                                  45120000
434500               TO  PV-ABEND-PARAGRAPH.                            45130000
434600                                                                  45140000
434700     EXEC SQL                                                     45150000
434800        CLOSE  PRNTCSR                                            45160000
434900     END-EXEC.                                                    45170000
435000     EVALUATE TRUE                                                45180000
435100       WHEN SQLCODE = ZEROS                                       45190000
435200         CONTINUE                                                 45200000
435300                                                                  45210000
435400       WHEN OTHER                                                 45220000
435500         DISPLAY PV-ABEND-PARAGRAPH                               45230000
435600         PERFORM Z999-SQL-ERROR                                   45240000
435700     END-EVALUATE.                                                45250000
435800                                                                  45260000
435900******************************************************************45270000
436000*                                                                *45280000
436100*                                                                *45290000
436200******************************************************************45300000
436300 D231-CLOSE-PARNT-CSR1.                                           45310000
436400*    DISPLAY 'D231-CLOSE-PARNT-CSR1'.                             45320006
436500                                                                  45330000
436600     MOVE 'D231-CLOSE-PARNT-CSR1'                                 45340000
436700               TO  PV-ABEND-PARAGRAPH.                            45350000
436800                                                                  45360000
436900     EXEC SQL                                                     45370000
437000        CLOSE  PRNTCSR1                                           45380000
437100     END-EXEC.                                                    45390000
437200     EVALUATE TRUE                                                45400000
437300       WHEN SQLCODE = ZEROS                                       45410000
437400         CONTINUE                                                 45420000
437500                                                                  45430000
437600       WHEN OTHER                                                 45440000
437700         DISPLAY PV-ABEND-PARAGRAPH                               45450000
437800         PERFORM Z999-SQL-ERROR                                   45460000
437900     END-EVALUATE.                                                45470000
438000                                                                  45480000
438100******************************************************************45490000
438200*                                                                *45500000
438300*                                                                *45510000
438400******************************************************************45520000
438500 D250-OPEN-PARNT-CSR-SKU.                                         45530000
438600     MOVE 'D250-OPEN-PARNT-SKU-CSR'                               45540000
438700               TO  PV-ABEND-PARAGRAPH.                            45550000
438800*    DISPLAY '   OPENING CURSOR TO EXPIRE PARENT RELS FOR'        45560000
438900*    DISPLAY '     ITEM_CLUSTR_NAME = ' ITMCLT-ITEM-CLUSTR-NAME   45570000
439000*    DISPLAY '     EFF_END_TMST > '                               45580000
439100*              PV-CURR-END-TMST                                   45590000
439200     EXEC SQL                                                     45600000
439300         OPEN  PRNTSKU                                            45610000
439400     END-EXEC.                                                    45620000
439500     EVALUATE TRUE                                                45630000
439600       WHEN SQLCODE = ZEROS                                       45640000
439700          CONTINUE                                                45650000
439800       WHEN SQLCODE = 1403                                        45660000
439900         SET PS-NO-MORE-PARENTS TO TRUE                           45670000
440000       WHEN OTHER                                                 45680000
440100         DISPLAY PV-ABEND-PARAGRAPH                               45690000
440200         PERFORM Z999-SQL-ERROR                                   45700000
440300     END-EVALUATE.                                                45710000
440400                                                                  45720000
440500******************************************************************45730000
440600*                                                                *45740000
440700*                                                                *45750000
440800******************************************************************45760000
440900*123456789012345678901234567890                                   45770000
441000 D260-FETCH-N-EXPIRE-PRNT-REL.                                    45780000
441100     MOVE 'D260-FETCH-N-EXPIRE-PRNT-REL'                          45790000
441200               TO  PV-ABEND-PARAGRAPH.                            45800000
441300     EXEC SQL                                                     45810000
441400         FETCH PRNTSKU                                            45820000
441500         INTO  :ITMCLC-CHLD-ITM-CLUSTR-ID,                        45830000
441600               :ITMCLC-PRNT-ITM-CLUSTR-ID                         45840000
441700     END-EXEC.                                                    45850000
441800     EVALUATE TRUE                                                45860000
441900       WHEN SQLCODE = ZEROS                                       45870000
442000                                                                  45880000
**TEMP*        DISPLAY ' D260 CALL TO C500-EXPIRE-RELATIONSHIPS'        45881027
**TEMP*        ADD +1 TO PV-INS-UPD-COUNT                               45882027
               PERFORM C500-EXPIRE-RELATIONSHIPS                        45890027
442200                                                                  45900000
442300         IF PS-SAVE-RELS                                          45910000
442400                                                                  45920000
442500             PERFORM C550-SAVE-RELATIONSHIPS                      45930000
442600         END-IF                                                   45940000
442700                                                                  45950000
442800       WHEN SQLCODE = 1403                                        45960000
442900         SET PS-NO-MORE-PARENTS   TO TRUE                         45970000
443000       WHEN OTHER                                                 45980000
443100         DISPLAY PV-ABEND-PARAGRAPH                               45990000
443200         PERFORM Z999-SQL-ERROR                                   46000000
443300     END-EVALUATE.                                                46010000
443400******************************************************************46020000
443500*                                                                *46030000
443600*                                                                *46040000
443700******************************************************************46050000
443800 D270-CLOSE-PARNT-CSR-SKU.                                        46060000
443900     MOVE 'D270-CLOSE-PARNT-CSR-SKU' TO PV-ABEND-PARAGRAPH.       46070000
444000     EXEC SQL                                                     46080000
444100        CLOSE  PRNTSKU                                            46090000
444200     END-EXEC.                                                    46100000
444300     EVALUATE TRUE                                                46110000
444400       WHEN SQLCODE = ZEROS                                       46120000
444500         CONTINUE                                                 46130000
444600                                                                  46140000
444700       WHEN OTHER                                                 46150000
444800         DISPLAY PV-ABEND-PARAGRAPH                               46160000
444900         PERFORM Z999-SQL-ERROR                                   46170000
445000     END-EVALUATE.                                                46180000
445100                                                                  46190000
445200***************************************************************** 46200000
445300* D400-GET-GRP-INFO                                             * 46210000
445400*                                                               * 46220000
445500*                                                               * 46230000
445600***************************************************************** 46240000
445700*                                                                 46250000
445800 D400-GET-GRP-INFO.                                               46260000
445900     MOVE 'D400-GET-GRP-INFO' TO PV-ABEND-PARAGRAPH.              46270000
446000                                                                  46280000
446100                                                                  46290000
446200     EXEC SQL                                                     46300000
446300          SELECT    GROUP_CODE                                    46310000
446400             INTO  :TSK-GROUP-CODE                                46320000
446500             FROM   TSK                                           46330000
446600             WHERE  ITEM_NMBR = :TSK-ITEM-NMBR                    46340000
446700     END-EXEC.                                                    46350000
446800                                                                  46360000
446900     EVALUATE TRUE                                                46370000
447000       WHEN SQLCODE = ZEROS                                       46380000
447100       WHEN SQLCODE = 1403                                        46390000
447200         CONTINUE                                                 46400000
447300       WHEN OTHER                                                 46410000
447400         DISPLAY PV-ABEND-PARAGRAPH                               46420000
447500         PERFORM Z999-SQL-ERROR                                   46430000
447600     END-EVALUATE.                                                46440000
447700                                                                  46450000
447800                                                                  46460000
447900***************************************************************** 46470000
448000* D450-GET-VENDOR-INFO                                          * 46480000
448100*                                                               * 46490000
448200***************************************************************** 46500000
448300*                                                                 46510000
448400 D450-GET-VENDOR-INFO.                                            46520000
448500*    DISPLAY 'D450-GET-VENDOR-INFO'                               46530006
448600     MOVE 'D450-GET-VENDOR-INFO' TO PV-ABEND-PARAGRAPH.           46540000
448700                                                                  46550000
448800                                                                  46560000
448900     EXEC SQL                                                     46570000
449000          SELECT    A.ENT_NAME_DESC,                              46580000
449100                    B.LONG_VENDOR_STYLE,                          46590000
449200                    B.ENT_ID                                      46600000
449300             INTO  :ENTNME-ENT-NAME-DESC,                         46610000
449400                   :TSK-LONG-VENDOR-STYLE,                        46620000
449500                   :TSK-ENT-ID                                    46630000
449600             FROM   TENTNME A,                                    46640000
449700                    TSK     B                                     46650000
449800             WHERE  B.ITEM_NMBR        = :TSK-ITEM-NMBR           46660000
449900              AND   A.ENT_ID           = B.ENT_ID                 46670000
450000              AND   A.TYPE_CDE         = :PC-ENT01-TYPE-CDE       46680000
450100     END-EXEC.                                                    46690000
450200                                                                  46700000
450300     EVALUATE TRUE                                                46710000
450400       WHEN SQLCODE = ZEROS                                       46720000
450500       WHEN SQLCODE = 1403                                        46730000
450600         CONTINUE                                                 46740000
450700       WHEN OTHER                                                 46750000
450800         DISPLAY PV-ABEND-PARAGRAPH                               46760000
450900         PERFORM Z999-SQL-ERROR                                   46770000
451000     END-EVALUATE.                                                46780000
451100                                                                  46790000
451200                                                                  46800000
451300     EJECT                                                        46810000
451400                                                                  46820000
451500******************************************************************46830000
451600*                                                                *46840000
451700*                                                                *46850000
451800******************************************************************46860000
451900 E100-PROCESS-RENUMBERED-SKUS.                                    46870000
452000*    DISPLAY 'E100-PROCESS-RENUMBERED-SKUS'.                      46880006
452100                                                                  46890000
452200     SET PS-MORE-RENUMBERS TO TRUE.                               46900000
452300     MOVE 'R' TO PV-SKU-PROCESS-CODE.                             46910000
452400                                                                  46920000
452500                                                                  46930000
452600     PERFORM E120-PROCESS-RNMBR-FILE                              46940000
452700     UNTIL PS-NO-MORE-RENUMBERS.                                  46950000
452800                                                                  46960000
452900                                                                  46970000
453000                                                                  46980000
453100                                                                  46990000
453200                                                                  47000000
453300******************************************************************47010000
453400*  SAC001 12/10/96                                               *47020000
453500*     THIS PARAGRAPH WAS CHANGED TO READ A SKU RENUMBER (MA025)  *47030000
453600*     EXTRACT FILE INSTEAD OF READING THE TSKURNMBR TABLE.       *47040000
453700******************************************************************47050000
453800 E120-PROCESS-RNMBR-FILE.                                         47060000
453900*    DISPLAY 'RENUMBER SKU PROCESS'.                              47070006
454000     MOVE 'E120-PROCESS-RNMBR-FILE'                               47080000
454100               TO  PV-ABEND-PARAGRAPH.                            47090000
454200                                                                  47100000
454300     READ SKU-REN-EXTRACT-FILE                                    47110000
454400             INTO  MA025-RECORD                                   47120000
454500      AT END                                                      47130000
454600              SET PS-NO-MORE-RENUMBERS TO TRUE.                   47140000
454700                                                                  47150000
454800*    IF PS-MORE-RENUMBERS  AND                                    47160000
454900*       PV-COMMIT-COUNT < 10                                      47170000
455000*         DISPLAY '*------------------------------*'              47180000
455100                                                                  47190000
0822RM*** ELIMINATE IF CHECK FOR MORE-RENUMBERS                         47200009
0822RM*** USE A CONSTANT FOR COMMIT COUNT - 1000                        47210009
0822RM*    IF PS-MORE-RENUMBERS AND                                     47220009
0822RM*       PV-COMMIT-COUNT = 10                                      47230009
0822RM     IF PV-INS-UPD-COUNT > PC-COMMIT-THRESHOLD                    47240022
0822RM         ADD PV-INS-UPD-COUNT TO PV-TOTAL-INS-UPD                 47250025
0822RM         MOVE 0               TO PV-INS-UPD-COUNT                 47251025
455400         PERFORM E130-COMMIT-RENUMBERS                            47260025
455500     END-IF.                                                      47270000
455600                                                                  47280000
455700     IF PS-NO-MORE-RENUMBERS                                      47290000
455800          PERFORM E130-COMMIT-RENUMBERS                           47310000
455900     ELSE                                                         47320000
456000          PERFORM  E150-INSERT-RENMBRD-SKU-PREP                   47330000
456100          PERFORM  E140-EXPIRE-RENUMBERED-SKU                     47340000
456200                                                                  47350000
456300          IF PV-OLD-SKU-CLUSTR-ID = ZERO                          47360000
456400             CONTINUE                                             47370000
456500          ELSE                                                    47380000
456600             PERFORM  E160-PROCESS-RENUMBER-RELS                  47390000
456700          END-IF                                                  47400000
456800          ADD +1 TO PV-INS-UPD-COUNT                              47410022
456900          ADD +1 TO PV-RENUMBER-READ                              47420000
0822RM*         DISPLAY 'PV-COMMIT-COUNT' PV-COMMIT-COUNT               47430009
0822RM*         DISPLAY 'RENUMBERED SKU : ' MA025-SKU-NMBR              47440009
457200*    ELSE                                                         47450000
457300     END-IF.                                                      47460000
457400                                                                  47470000
457500 E130-COMMIT-RENUMBERS.                                           47480000
457600                                                                  47490000
0822RM*         DISPLAY '*------------------------------*'              47500009
457800          EXEC SQL                                                47510000
457900            COMMIT                                                47520000
458000          END-EXEC                                                47530000
458100*         DISPLAY 'PV-COMMIT-COUNT' PV-COMMIT-COUNT               47540006
458200          MOVE ZERO TO PV-INS-UPD-COUNT                           47550022
458300          IF SQLCODE NOT = ZERO                                   47560000
458400             MOVE SQLCODE    TO SQLCODE2                          47570000
458500             MOVE SQLERRD(3) TO SQLERRD3                          47580000
458600             DISPLAY '** ABEND **       ** = SQLERROR'            47590000
458700             DISPLAY '** PROGRAM        ** = MAKUT102'            47600000
458800             DISPLAY '** SQLCODE        ** = ' SQLCODE2           47610000
458900             DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3           47620000
459000             DISPLAY '** SQLERRM        ** = ' SQLERRM            47630000
459100             DISPLAY '** SQLERRMC       ** = ' SQLERRMC           47640000
459200                                                                  47650000
459300             MOVE SPACES TO WS-MSG-TEXT                           47660000
459400                                                                  47670000
0822RM             DISPLAY 'FS500I-MAINT-LOG-REC '                      47680022
0822RM                      FS500I-MAINTENANCE-LOG-RECORD               47690023
0822RM             DISPLAY 'SD-SKU-DELETE-BKUP-RECORD '                 47700022
0822RM                      SD-SKU-DELETE-BKUP-RECORD                   47710023
0822RM             DISPLAY 'MA025-RECORD ' MA025-RECORD                 47720023
                                                                        47730022
459500             CALL 'SQLGLM' USING WS-MSG-TEXT,                     47740000
459600                            WS-MAX-SIZE,                          47750000
459700                            WS-MSG-LENGTH                         47760000
459800             DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT        47770000
0822RM*          ELSE                                                   47780022
0822RM*            DISPLAY '*** COMMIT ***'                             47790022
460200     END-IF.                                                      47800000
460300******************************************************************47810000
460400*                                                                *47820000
460500*                                                                *47830000
460600******************************************************************47840000
460700 E140-EXPIRE-RENUMBERED-SKU.                                      47850000
460800      MOVE 'E140-EXPIRE-RENUMBERED-SKU'                           47860000
460900               TO  PV-ABEND-PARAGRAPH.                            47870000
461000                                                                  47880000
461100      MOVE SPACES     TO    ITMCLT-ITEM-CLUSTR-NAME.              47890000
461200      IF MA025-HIST-DEPT-NMBR(1:1) = '0'                          47900000
461300          MOVE MA025-HIST-DEPT-NMBR TO PV-RENUM-DEPT              47910000
461400          STRING MA025-HIST-DEPT-NMBR  DELIMITED BY SIZE          47920000
461500                 '-' DELIMITED BY SIZE                            47930000
461600                 MA025-HIST-CLASS-NMBR DELIMITED BY SIZE          47940000
461700                 '-' DELIMITED BY SIZE                            47950000
461800                 PV-RENUM-DEPT-2-3     DELIMITED BY SIZE          47960000
461900                 MA025-HIST-CLASS-NMBR DELIMITED BY SIZE          47970000
462000                 MA025-HIST-SEQ-NMBR   DELIMITED BY SIZE          47980000
462100                     INTO ITMCLT-ITEM-CLUSTR-NAME                 47990000
462200      ELSE                                                        48000000
462300          STRING  MA025-HIST-DEPT-NMBR  DELIMITED BY SIZE         48010000
462400                  '-' DELIMITED BY SIZE                           48020000
462500                  MA025-HIST-CLASS-NMBR DELIMITED BY SIZE         48030000
462600                  '-' DELIMITED BY SIZE                           48040000
462700                  MA025-HIST-DEPT-NMBR  DELIMITED BY SIZE         48050000
462800                  MA025-HIST-CLASS-NMBR DELIMITED BY SIZE         48060000
462900                  MA025-HIST-SEQ-NMBR   DELIMITED BY SIZE         48070000
463000                        INTO    ITMCLT-ITEM-CLUSTR-NAME           48080000
463100      END-IF.                                                     48090000
463200                                                                  48100000
463300      MOVE LOW-VALUES TO    ITMCLT-HIER-CDE.                      48110000
463400                                                                  48120000
463500                                                                  48130000
463600      MOVE PC-NEG-1  TO    PV-HIER-CDE-NULL.                      48140000
463700                                                                  48150000
463800                                                                  48160000
463900      IF  PS-RNMBR-SKU-NOT-EXIST                                  48170000
464000         SET   PS-SAVE-RELS TO TRUE                               48180000
464100      ELSE                                                        48190000
464200         SET   PS-DONT-SAVE-RELS TO TRUE                          48200000
464300*        DISPLAY 'DONT SAVE RELATIONSHIPS'                        48210006
464400      END-IF.                                                     48220000
464500                                                                  48230000
464600      PERFORM  C410-EXPIRE-SKU-PARNT-REL.                         48240000
464700      SET   PS-DONT-SAVE-RELS TO TRUE.                            48250000
464800                                                                  48260000
464900******************************************************************48270000
465000*                                                                *48280000
465100*                                                                *48290000
465200******************************************************************48300000
465300*                                                                 48310000
465400 E150-INSERT-RENMBRD-SKU-PREP.                                    48320000
465500*    DISPLAY 'E150-INSERT-RENMBRD-SKU-PREP'.                      48330006
465600     MOVE 'E150-INSERT-RENMBRD-SKU-PREP'                          48340000
465700               TO  PV-ABEND-PARAGRAPH.                            48350000
465800                                                                  48360000
465900      MOVE SPACES     TO    ITMCLT-ITEM-CLUSTR-NAME.              48370000
466000      STRING  MA025-MERCH-DEPT-NMBR DELIMITED BY SIZE             48380000
466100              '-' DELIMITED BY SIZE                               48390000
466200              MA025-MERCH-CLASS-NMBR DELIMITED BY SIZE            48400000
466300                    INTO    ITMCLT-ITEM-CLUSTR-NAME.              48410000
466400      MOVE 'SCL'      TO    ITMCLT-HIER-CDE.                      48420000
466500      MOVE ZEROES     TO    PV-HIER-CDE-NULL.                     48430000
466600                                                                  48440000
466700      MOVE MA025-MERCH-DEPT-NMBR  TO WS-DPT.                      48450000
466800      MOVE MA025-MERCH-CLASS-NMBR TO WS-SCL.                      48460000
466900      MOVE WS-HOLD-DPT-SCL        TO PV-HOLD-DPT-SCL              48470000
467000                                                                  48480000
467100      PERFORM D100-GET-CLUSTR-ID.                                 48490000
467200                                                                  48500000
467300                                                                  48510000
467400      IF (SQLCODE = 1403)                                         48520000
467500         DISPLAY '*** E150 *** ITEM CLUSTR ID NOT FOUND FOR'      48530000
467600         DISPLAY '*** E150 *** ITEM CLUSTR NAME '                 48540000
467700                        ITMCLT-ITEM-CLUSTR-NAME                   48550000
467800         DISPLAY '*** E150 *** MAY CAUSE A S0C7.'                 48560000
467900      END-IF.                                                     48570000
468000                                                                  48580000
468100      MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-SCL-PRNT-CLUSTR-ID.        48590000
468200                                                                  48600000
468300      MOVE MA025-MERCH-DEPT-NMBR TO MDSEAR-DEPT-NBR.              48610000
468400      PERFORM B130-GET-PARENT-DPT.                                48620000
468500      MOVE PV-DEPT-PRNT-CLUSTR-ID TO ITMCLT-OWNER-ID.             48630000
468600                                                                  48640000
468700************************************************************      48650000
468800*  GET SKU DESCRIPTION                                     *      48660000
468900*                                                          *      48670000
469000                                                                  48680000
469100      MOVE SPACES     TO    ITMCLT-ITEM-CLUSTR-NAME.              48690000
469200      IF MA025-HIST-DEPT-NMBR(1:1) = '0'                          48700000
469300          MOVE MA025-HIST-DEPT-NMBR TO PV-RENUM-DEPT              48710000
469400          STRING MA025-HIST-DEPT-NMBR  DELIMITED BY SIZE          48720000
469500                 '-' DELIMITED BY SIZE                            48730000
469600                 MA025-HIST-CLASS-NMBR DELIMITED BY SIZE          48740000
469700                 '-' DELIMITED BY SIZE                            48750000
469800                 PV-RENUM-DEPT-2-3     DELIMITED BY SIZE          48760000
469900                 MA025-HIST-CLASS-NMBR DELIMITED BY SIZE          48770000
470000                 MA025-HIST-SEQ-NMBR   DELIMITED BY SIZE          48780000
470100                     INTO ITMCLT-ITEM-CLUSTR-NAME                 48790000
470200      ELSE                                                        48800000
470300          STRING  MA025-HIST-DEPT-NMBR  DELIMITED BY SIZE         48810000
470400                  '-' DELIMITED BY SIZE                           48820000
470500                  MA025-HIST-CLASS-NMBR DELIMITED BY SIZE         48830000
470600                  '-' DELIMITED BY SIZE                           48840000
470700                  MA025-HIST-DEPT-NMBR  DELIMITED BY SIZE         48850000
470800                  MA025-HIST-CLASS-NMBR DELIMITED BY SIZE         48860000
470900                  MA025-HIST-SEQ-NMBR   DELIMITED BY SIZE         48870000
471000                        INTO    ITMCLT-ITEM-CLUSTR-NAME           48880000
471100      END-IF.                                                     48890000
471200                                                                  48900000
471300      MOVE LOW-VALUES TO    ITMCLT-HIER-CDE.                      48910000
471400                                                                  48920000
471500      MOVE PC-NEG-1   TO    PV-HIER-CDE-NULL.                     48930000
471600                                                                  48940000
471700      PERFORM D100-GET-CLUSTR-ID.                                 48950000
471800                                                                  48960000
471900      IF SQLCODE = ZERO                                           48970000
472000         MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-OLD-SKU-CLUSTR-ID       48980000
472100      ELSE                                                        48990000
472200         MOVE ZERO TO PV-OLD-SKU-CLUSTR-ID                        49000000
472300* LLG UNCOMMENT LINE BELOW                                        49010000
472400*        MOVE MA025-ITEM-NBR TO TSK-ITEM-NMBR                     49020000
472500         PERFORM D130-MOCK-UP-DESCRIPTION                         49030000
472600      END-IF.                                                     49040000
472700*                                                          *      49050000
472800*                                                          *      49060000
472900************************************************************      49070000
473000                                                                  49080000
473100      MOVE SPACES TO ITMCLT-ITEM-CLUSTR-NAME.                     49090000
473200      IF MA025-MERCH-DEPT-NMBR(1:1) = '0'                         49100000
473300          MOVE MA025-MERCH-DEPT-NMBR TO PV-RENUM-DEPT             49110000
473400          STRING MA025-MERCH-DEPT-NMBR  DELIMITED BY SIZE         49120000
473500                 '-' DELIMITED BY SIZE                            49130000
473600                 MA025-MERCH-CLASS-NMBR DELIMITED BY SIZE         49140000
473700                 '-' DELIMITED BY SIZE                            49150000
473800                 PV-RENUM-DEPT-2-3      DELIMITED BY SIZE         49160000
473900                 MA025-MERCH-CLASS-NMBR DELIMITED BY SIZE         49170000
474000                 MA025-SEQ-NMBR         DELIMITED BY SIZE         49180000
474100                     INTO ITMCLT-ITEM-CLUSTR-NAME                 49190000
474200      ELSE                                                        49200000
474300          STRING  MA025-MERCH-DEPT-NMBR  DELIMITED BY SIZE        49210000
474400                  '-' DELIMITED BY SIZE                           49220000
474500                  MA025-MERCH-CLASS-NMBR DELIMITED BY SIZE        49230000
474600                  '-' DELIMITED BY SIZE                           49240000
474700                  MA025-MERCH-DEPT-NMBR  DELIMITED BY SIZE        49250000
474800                  MA025-MERCH-CLASS-NMBR DELIMITED BY SIZE        49260000
474900                  MA025-SEQ-NMBR         DELIMITED BY SIZE        49270000
475000                        INTO    ITMCLT-ITEM-CLUSTR-NAME           49280000
475100      END-IF.                                                     49290000
475200                                                                  49300000
475300*     MOVE MA025-MERCH-DEPT-NMBR                                  49310000
475400*                        TO    ITMCLT-OWNER-ID.                   49320000
475500                                                                  49330000
475600      MOVE ZERO          TO    PV-OWNER-ID-NULL                   49340000
475700                               PV-MDSE-NM-CDE-NULL                49350000
475800                               PV-PROD-SERV-CDE-NULL              49360000
475900                               PV-CHLD-CDE-NULL.                  49370000
476000                                                                  49380000
476100      MOVE LOW-VALUES    TO    ITMCLT-HIER-CDE.                   49390000
476200      MOVE LOW-VALUES    TO    ITMCLT-CLUSTR-TYP-CDE.             49400000
476300      MOVE LOW-VALUES    TO    ITMCLT-HIER-TYP-CDE.               49410000
476400      MOVE 'I'   TO    ITMCLT-ITEM-CLUSTR-CDE.                    49420000
476500      MOVE 'P'   TO    ITMCLT-PROD-SERV-CDE.                      49430000
476600      MOVE 'M'   TO    ITMCLT-MDSE-NM-CDE.                        49440000
476700                                                                  49450000
476800      MOVE PC-NEG-1      TO    PV-HIER-CDE-NULL                   49460000
476900                               PV-HIER-TYP-CDE-NULL               49470000
477000                               PV-CLUSTR-TYP-CDE-NULL.            49480000
477100                                                                  49490000
477200      MOVE PV-SCL-PRNT-CLUSTR-ID   TO ITMCLC-PRNT-ITM-CLUSTR-ID.  49500000
477300      MOVE PV-CURRENT-TMST         TO ITMCLT-EFF-BEG-TMST         49510000
477400                                      ITMCLC-EFF-BEG-TMST.        49520000
477500                                                                  49530000
477600************************************************************      49540000
477700* CHECK IF NEW SKU ALREADY EXIST                           *      49550000
477800************************************************************      49560000
477900*                                                          *      49570000
478000                                                                  49580000
478100      MOVE ITMCLT-ITEM-CLUSTR-DESC TO                             49590000
478200                        PV-SAVE-CLUSTR-DESC                       49600000
478300      PERFORM D100-GET-CLUSTR-ID.                                 49610000
478400                                                                  49620000
478500*                                                          *      49630000
478600************************************************************      49640000
478700                                                                  49650000
478800     IF SQLCODE = 1403                                            49660000
478900                                                                  49670000
479000      SET PS-RNMBR-SKU-NOT-EXIST    TO TRUE                       49680000
479100                                                                  49690000
479200       PERFORM E151-INSERT-RENUMBERED-SKU                         49700000
479300     ELSE                                                         49710000
479400       PERFORM E152-NEW-RENUMBER-EXISTS                           49720000
479500     END-IF.                                                      49730000
479600                                                                  49740000
479700                                                                  49750000
479800******************************************************************49760000
479900*  THIS CODE WAS FORMERLY CONTAINED IN E150-, I PULLED IT        *49770000
480000*  DOWN INTO ITS OWN PARAGRAPH.         NOV.1998                 *49780000
480100******************************************************************49790000
480200 E151-INSERT-RENUMBERED-SKU.                                      49800000
480300*    DISPLAY 'E151-INSERT-RENUMBERED-SKU'.                        49810006
480400                                                                  49820000
480500     MOVE 'M'     TO ITMCLC-REL-TYP-CDE                           49830000
480600     MOVE 'I'     TO ITMCLC-CHLD-ITM-CLSTR-CDE                    49840000
480700     PERFORM C200-INSERT-TITMCLT                                  49850000
480800     ADD +1 TO PV-RENUMBER-INSERTED                               49860000
480900     MOVE ITMCLT-ITEM-CLUSTR-ID TO ITMCLC-CHLD-ITM-CLUSTR-ID      49870000
481000                                   PV-RENUMBER-CLUSTR-ID          49880000
481100                                   MDSEIT-ITEM-CLUSTR-ID          49890000
481200                                   PV-HOLD-ITEM-ID                49900000
481300                                                                  49910000
481400     IF SQLCODE = ZERO                                            49920000
481500        PERFORM C700-INSERT-ITMCLC                                49930000
481600     END-IF                                                       49940000
481700                                                                  49950000
481800* LLG UNCOMMENT LINE BELOW                                        49960000
481900*    MOVE MA025-ITEM-NBR TO TSK-ITEM-NMBR                         49970000
482000     PERFORM D120-GET-NEW-SKU-INFO                                49980000
482100     IF SQLCODE = ZERO                                            49990000
**TEMP*            DISPLAY 'E151 CALL TO C750-INSERT-TMDSEIT '          49991027
**TEMP*            ADD +1 TO PV-INS-UPD-COUNT                           49992027
              PERFORM C750-INSERT-TMDSEIT                               50000027
482300     END-IF                                                       50010000
482400                                                                  50020000
482500     MOVE ITMCLT-ITEM-CLUSTR-ID   TO                              50030000
482600                                        PV-SKU-CHLD-CLUSTR-ID     50040000
482700                                                                  50050000
482800     PERFORM C900-PROCESS-GRP-INFO                                50060000
482900     PERFORM C950-PROCESS-VENDOR-INFO.                            50070000
483000                                                                  50080000
483100******************************************************************50090000
483200*  IF THE ITEM TO BE RENUMBERED TO ALREADY EXISTS, CHECK THE     *50100000
483300*  LAST UPDATE TIME ON TITMCLT.  IF THE LAST UPDATE TIME IS      *50110000
483400*  EARLIER THAN THE RENUMBER DATE, ASSUME THAT IT'S AN OLD       *50120000
483500*  ITEM THAT SHOULD HAVE BEEN EXPIRED PREVIOUSLY.  EXPIRE IT     *50130000
483600*  AND ITS RELATIONSHIPS, THEN INSERT THE RENUMBER.              *50140000
483700******************************************************************50150000
483800 E152-NEW-RENUMBER-EXISTS.                                        50160000
483900                                                                  50170000
484000                                                                  50180000
484100*    DISPLAY 'NEW SKU ALREADY EXISTS'                             50190006
484200     MOVE '0000-00-00' TO PV-SETUP-DATE-10                        50200000
484300     MOVE MA025-RNMBR-DATE(1:4) TO PV-SETUP-DATE-10(1:4)          50210000
484400     MOVE MA025-RNMBR-DATE(6:2) TO PV-SETUP-DATE-10(6:2)          50220000
484500     MOVE MA025-RNMBR-DATE(9:2) TO PV-SETUP-DATE-10(9:2)          50230000
484600*    DISPLAY 'ITMCLT-LAST-UPD-TMST ' ITMCLT-LAST-UPD-TMST         50240006
484700*       ' < PV-SETUP-DATE-10 ' PV-SETUP-DATE-10 ' ? '             50250006
484800     IF ITMCLT-LAST-UPD-TMST(1:10) <                              50260000
484900                PV-SETUP-DATE-10                                  50270000
485000*       DISPLAY 'ITEM SHOULD HAVE BEEN EXPIRED '                  50280006
485100*                     ITMCLT-ITEM-CLUSTR-NAME                     50290006
485200        PERFORM C410-EXPIRE-SKU-PARNT-REL                         50300000
485300        ADD +1 TO PV-RENUMBER-EXPIRED                             50310000
485400        PERFORM E151-INSERT-RENUMBERED-SKU                        50320000
485500*    ELSE                                                         50330006
485600*       DISPLAY '   SKIPPING RENUMBER'                            50340006
485700     END-IF.                                                      50350000
485800                                                                  50360000
485900                                                                  50370000
486000******************************************************************50380000
486100*                                                                *50390000
486200*                                                                *50400000
486300******************************************************************50410000
486400 E160-PROCESS-RENUMBER-RELS.                                      50420000
486500      MOVE 'E160-PROCESS-RENUMBER-RELS'                           50430000
486600               TO  PV-ABEND-PARAGRAPH.                            50440000
486700                                                                  50450000
486800**  INSERT OLD / NEW SKU RELATIONSHIP ROW **                      50460000
486900*                                                                 50470000
487000      INITIALIZE DCLTITMCLC.                                      50480000
487100      MOVE ZEROES                TO PV-CHLD-CDE-NULL.             50490000
487200                                                                  50500000
487300      MOVE PV-RENUMBER-CLUSTR-ID TO ITMCLC-PRNT-ITM-CLUSTR-ID.    50510000
487400      MOVE PV-OLD-SKU-CLUSTR-ID  TO ITMCLC-CHLD-ITM-CLUSTR-ID.    50520000
487500                                                                  50530000
487600      MOVE PV-CURRENT-TMST       TO ITMCLC-EFF-BEG-TMST.          50540000
487700                                                                  50550000
487800      MOVE 'R'        TO ITMCLC-REL-TYP-CDE.                      50560000
487900      MOVE 'I'        TO ITMCLC-CHLD-ITM-CLSTR-CDE.               50570000
488000                                                                  50580000
488100*     DISPLAY 'PRNT-CLUSTR-ID ='    ITMCLC-PRNT-ITM-CLUSTR-ID.    50590006
488200*     DISPLAY 'CHLD-CLUSTR-ID ='    ITMCLC-CHLD-ITM-CLUSTR-ID.    50600006
488300*     DISPLAY 'C700-INSERT-ITMCLC'.                               50610006
488400                                                                  50620000
488500      PERFORM C700-INSERT-ITMCLC.                                 50630000
488600      IF SQLCODE = ZERO                                           50640000
488700*                                                                 50650000
488800* SAC * 09/05/96                                                  50660000
488900**  UPDATE THE SALES TABLES WITH THE NEW CLUSTER ID.              50670000
489000*                                                                 50680000
**TEMP*            DISPLAY 'E160 CALL TO E165-UPDATE-TSKUSL00-TBLS'     50681027
**TEMP*            ADD +1 TO PV-INS-UPD-COUNT                           50682027
               PERFORM E165-UPDATE-TSKUSL00-TBLS                        50690027
489200                                                                  50700000
489300**  UPDATE PREVIOUS RENUMBER RELATIONSHIPS IF SKU WAS RENUMBERED  50710000
489400**  MORE THAN ONCE.                                               50720000
489500                                                                  50730000
489600                                                                  50740000
489700         MOVE PV-OLD-SKU-CLUSTR-ID  TO PV-SKU-ID                  50750000
489800                                                                  50760000
489900                                                                  50770000
               PERFORM E170-UPDATE-RENUMBER-REL                         50780023
490100                                                                  50790000
490200                                                                  50800000
490300      END-IF.                                                     50810000
490400                                                                  50820000
490500******************************************************************50830000
490600* SAC * 09/05/96                                                  50840000
490700**  CALL A STORED PROCEDURE TO UPDATE EACH OF THE 54 TSKUSL00     50850000
490800**  TABLES WITH THE NEW RENUMBERED SKU'S ITEM CLUSTER ID         *50860000
490900******************************************************************50870000
491000 E165-UPDATE-TSKUSL00-TBLS.                                       50880000
491100*                                                                 50890000
491200     MOVE 'E165-UPDATE-TSKUSL00-TBLS'                             50900000
491300               TO  PV-ABEND-PARAGRAPH.                            50910000
491400                                                                  50920000
491500     MOVE ZERO TO PV-ROWS-UPDATED.                                50930000
491600*    DISPLAY 'E165-UPDATE-TSKUSL00-TBLS...'.                      50940006
491700         EXEC SQL EXECUTE                                         50950000
491800           BEGIN                                                  50960000
491900               MAKSP200_PKG.UPD_TSKUSL00                          50970000
492000                   (:ITMCLC-PRNT-ITM-CLUSTR-ID                    50980000
492100                   ,:ITMCLC-CHLD-ITM-CLUSTR-ID                    50990000
492200                   ,:PV-ROWS-UPDATED);                            51000000
492300           END;                                                   51010000
492400         END-EXEC.                                                51020000
492500         EVALUATE TRUE                                            51030000
492600            WHEN SQLCODE = ZEROS                                  51040000
0822RM             ADD PV-ROWS-UPDATED TO PV-INS-UPD-COUNT              51050022
492700            WHEN SQLCODE = 1403                                   51060000
492800                DISPLAY 'TOTAL TSKUSL00 ROWS UPDATED ='           51070000
492900                         PV-ROWS-UPDATED                          51080000
493000            WHEN OTHER                                            51090000
493100            DISPLAY 'UNABLE TO UPDATE TSKUSL00 TABLES'            51100000
493200            PERFORM Z999-SQL-ERROR                                51110000
493300         END-EVALUATE.                                            51120000
493400*                                                                 51130000
493500******************************************************************51140000
493600*                                                                *51150000
493700*                                                                *51160000
493800******************************************************************51170000
493900 E170-UPDATE-RENUMBER-REL.                                        51180000
494000                                                                  51190000
494100     MOVE 'E170-UPDATE-RENUMBER-REL'                              51200000
494200               TO  PV-ABEND-PARAGRAPH.                            51210000
494300                                                                  51220000
494400                                                                  51230000
494500           EXEC SQL                                               51240027
494600           UPDATE   TITMCLC                                       51250027
494700            SET  EFF_END_TMST     = :PV-CURRENT-TMST,             51260027
494800                 LAST_UPD_TMST    = SYSDATE,                      51270027
494900                 LAST_UPD_BY_UID  = 'MAKUT102'                    51280027
495000            WHERE                                                 51290027
495100               PRNT_ITM_CLUSTR_ID = :PV-SKU-ID                    51300027
495200           AND REL_TYP_CDE        = 'R'                           51310027
495300           AND EFF_END_TMST IS NULL                               51320027
495400           END-EXEC.                                              51330027
                                                                        51331027
495500*           SET  EFF_END_TMST     = :PV-CURR-END-TMST,            51340000
495600     EVALUATE TRUE                                                51350027
495700       WHEN SQLCODE = ZEROS                                       51360027
0822RM         ADD +1 TO PV-INS-UPD-COUNT                               51370027
495800       WHEN SQLCODE = 1403                                        51380027
495900         CONTINUE                                                 51390027
496000       WHEN OTHER                                                 51400027
496100         DISPLAY PV-ABEND-PARAGRAPH                               51410027
496200         DISPLAY 'PRNT-ID =' PV-SKU-ID                            51420027
496300         PERFORM Z999-SQL-ERROR                                   51430027
496400     END-EVALUATE.                                                51440027
496500                                                                  51450000
496600     SET  PS-MORE-UPD-ROWS TO TRUE.                               51460000
496700     PERFORM E180-OPEN-UPD-CSR.                                   51470000
496800                                                                  51480000
**TEMP*         DISPLAY ' E160 CALL TO E185-FETCH-UPD-CSR'              51481027
**TEMP*         ADD +1 TO PV-INS-UPD-COUNT                              51482027
**TEMP     PERFORM E185-FETCH-UPD-CSR.                                  51490027
497000                                                                  51500000
497100     PERFORM UNTIL PS-NO-MORE-UPD-ROWS                            51510027
497200         PERFORM E185-FETCH-UPD-CSR                               51520027
497300     END-PERFORM.                                                 51530027
497400     PERFORM E190-CLOSE-UPD-CSR.                                  51540000
497500                                                                  51550000
497600******************************************************************51560000
497700*                                                                *51570000
497800******************************************************************51580000
497900 E180-OPEN-UPD-CSR.                                               51590000
498000     MOVE 'E180-OPEN-UPD-CSR'                                     51600000
498100               TO  PV-ABEND-PARAGRAPH.                            51610000
498200     EXEC SQL                                                     51620000
498300         OPEN   UPDCSR                                            51630000
498400     END-EXEC.                                                    51640000
498500     EVALUATE TRUE                                                51650000
498600       WHEN SQLCODE = ZEROS                                       51660000
498700          CONTINUE                                                51670000
498800       WHEN SQLCODE = 1403                                        51680000
498900         SET PS-NO-MORE-UPD-ROWS  TO TRUE                         51690000
499000       WHEN OTHER                                                 51700000
499100         DISPLAY PV-ABEND-PARAGRAPH                               51710000
499200         PERFORM Z999-SQL-ERROR                                   51720000
499300     END-EVALUATE.                                                51730000
499400                                                                  51740000
499500******************************************************************51750000
499600*                                                                *51760000
499700******************************************************************51770000
499800 E185-FETCH-UPD-CSR.                                              51780000
499900     MOVE 'E185-FETCH-UPD-CSR'                                    51790000
500000               TO  PV-ABEND-PARAGRAPH.                            51800000
500100                                                                  51810000
500200     EXEC SQL                                                     51820000
500300       FETCH UPDCSR                                               51830000
500400       INTO  :PV-SKU-ID,                                          51840000
500500             :ITMCLC-CHLD-ITM-CLUSTR-ID                           51850000
500600     END-EXEC.                                                    51860000
500700                                                                  51870000
500800     EVALUATE TRUE                                                51880000
500900       WHEN SQLCODE = ZEROS                                       51890000
501000         EXEC SQL                                                 51900000
501100           UPDATE   TITMCLC                                       51910000
501200           SET PRNT_ITM_CLUSTR_ID = :PV-RENUMBER-CLUSTR-ID,       51920000
501300               LAST_UPD_TMST       =  SYSDATE,                    51930000
501400               LAST_UPD_BY_UID     =  'MAKUT102'                  51940000
501500           WHERE                                                  51950000
501600                PRNT_ITM_CLUSTR_ID  = :PV-SKU-ID                  51960000
501700           AND  CHLD_ITM_CLUSTR_ID  = :ITMCLC-CHLD-ITM-CLUSTR-ID  51970000
501800           AND  REL_TYP_CDE         = 'R'                         51980000
501900         END-EXEC                                                 51990000
502000                                                                  52000000
502100         EVALUATE TRUE                                            52010000
502200          WHEN SQLCODE = ZEROS                                    52020000
0822RM             ADD +1 TO PV-INS-UPD-COUNT                           52030022
502300          WHEN SQLCODE = 1403                                     52040000
502400              CONTINUE                                            52050000
502500          WHEN OTHER                                              52060000
502600            DISPLAY PV-ABEND-PARAGRAPH                            52070000
502700            DISPLAY 'PV-SKU-ID = ' PV-SKU-ID                      52080000
502800            PERFORM Z999-SQL-ERROR                                52090000
502900          END-EVALUATE                                            52100000
503000                                                                  52110000
503100      WHEN SQLCODE = 1403                                         52120000
503200         SET PS-NO-MORE-UPD-ROWS TO TRUE                          52130000
503300      WHEN OTHER                                                  52140000
503400         DISPLAY PV-ABEND-PARAGRAPH                               52150000
503500         DISPLAY 'ERROR ON FETCH OF UPD-CSR'                      52160000
503600         DISPLAY 'PV-SKU-ID = ' PV-SKU-ID                         52170000
503700         PERFORM Z999-SQL-ERROR                                   52180000
503800      END-EVALUATE.                                               52190000
503900                                                                  52200000
504000                                                                  52210000
504100                                                                  52220000
504200******************************************************************52230000
504300*                                                                *52240000
504400*                                                                *52250000
504500******************************************************************52260000
504600 E190-CLOSE-UPD-CSR.                                              52270000
504700     MOVE 'E190-CLOSE-UPD-CSR' TO PV-ABEND-PARAGRAPH.             52280000
504800     EXEC SQL                                                     52290000
504900        CLOSE    UPDCSR                                           52300000
505000     END-EXEC.                                                    52310000
505100     EVALUATE TRUE                                                52320000
505200       WHEN SQLCODE = ZEROS                                       52330000
505300         CONTINUE                                                 52340000
505400                                                                  52350000
505500       WHEN OTHER                                                 52360000
505600         DISPLAY PV-ABEND-PARAGRAPH                               52370000
505700         PERFORM Z999-SQL-ERROR                                   52380000
505800     END-EVALUATE.                                                52390000
505900                                                                  52400000
506000******************************************************************52410000
506100*                                                                *52420000
506200*                                                                *52430000
506300******************************************************************52440000
506400 E200-PROCESS-DAILY-SKU-CHANGES.                                  52450000
506500     MOVE 'E200-PROCESS-DAILY-SKU-CHANGES'                        52460000
506600               TO  PV-ABEND-PARAGRAPH.                            52470000
506700                                                                  52480000
506800                                                                  52490000
506900      PERFORM  E220-READ-DAILY-CHANGES-FILE.                      52500000
507000                                                                  52510000
507100      PERFORM                                                     52520000
507200      UNTIL PS-DAILY-CHANGES-EOF                                  52530000
 07300                                                                  52540023
0822RM        ADD 1 TO WS-DAILY-RECS-READ                               52541023
507400*       DISPLAY '*------------------------------*'                52550006
507500*       DISPLAY 'PROCESSING '                                     52560006
507600*                FS500I-FUNCTION-CODE                             52570006
507700*                FS500I-OUTPUT-MESSAGE-SEQ                        52580006
507800*                ' RECORD...'                                     52590006
507900                                                                  52600000
508000        EVALUATE TRUE                                             52610000
508100                                                                  52620000
508200        WHEN FS500I-FUNCTION-CODE = 'A'                           52630000
508300                                                                  52640000
508400                MOVE 'A' TO PV-SKU-PROCESS-CODE                   52650000
508500                MOVE FS500I-TSKXREF-DEPT TO PV-WORK-DPT           52660000
508600                MOVE FS500I-TSKXREF-SUBCLASS TO PV-WORK-SUBCL     52670000
508700                PERFORM E230-PROCESS-INSERT-SKU                   52680000
508800                                                                  52690000
508900        WHEN FS500I-FUNCTION-CODE = 'C'                           52700000
509000                                                                  52710000
509100                MOVE 'C' TO PV-SKU-PROCESS-CODE                   52720000
509200                MOVE FS500I-TSKXREF-DEPT TO PV-WORK-DPT           52730000
509300                MOVE FS500I-TSKXREF-SUBCLASS TO PV-WORK-SUBCL     52740000
509400                PERFORM E240-UPDATE-SKU                           52750000
509500                                                                  52760000
509600        WHEN FS500I-FUNCTION-CODE = 'D'                           52770000
509700                                                                  52780000
509800                MOVE 'D' TO PV-SKU-PROCESS-CODE                   52790000
509900                PERFORM E250-PROCESS-EXPIRE-SKU                   52800000
510000                                                                  52810000
510100        END-EVALUATE                                              52820000
510200                                                                  52830000
510300        PERFORM  E220-READ-DAILY-CHANGES-FILE                     52840000
510400                                                                  52850000
510500        MOVE SPACES                TO WS-OUTPUT-MESSAGE-AREA      52860000
510600        MOVE FS500I-OUTPUT-MESSAGE TO WS-OUTPUT-MESSAGE-AREA      52870000
510700                                                                  52880000
0822RM**** COMMIT CHECK LOGIC                                           52890017
0822RM        IF PV-INS-UPD-COUNT > PC-COMMIT-THRESHOLD                 52900022
**TEMP*           DISPLAY 'E200 INS-UPD COUNT > 1K ' PV-INS-UPD-COUNT   52901027
0822RM            ADD PV-INS-UPD-COUNT TO PV-TOTAL-INS-UPD              52910025
0822RM            MOVE 0               TO PV-INS-UPD-COUNT              52911023
0822RM            PERFORM E130-COMMIT-RENUMBERS                         52920022
0822RM        END-IF                                                    52930019
                                                                        52940017
510800      END-PERFORM.                                                52950000
510900                                                                  52960000
511000                                                                  52970000
511100******************************************************************52980000
511200*                                                                *52990000
511300*                                                                *53000000
511400******************************************************************53010000
511500 E220-READ-DAILY-CHANGES-FILE.                                    53020000
511600                                                                  53030000
511700     READ DAILY-CHANGES-FILE                                      53040000
511800             INTO  FS500I-MAINTENANCE-LOG-RECORD                  53050000
511900      AT END  SET PS-DAILY-CHANGES-EOF   TO TRUE.                 53060000
**TEMP*    DISPLAY 'DAILY CHANGE REC: ' FS500I-MAINTENANCE-LOG-RECORD.  53061027
512000                                                                  53070000
512100                                                                  53080000
512200******************************************************************53090000
512300*                                                                *53100000
512400*                                                                *53110000
512500******************************************************************53120000
512600 E225-READ-WEEKLY-SKU-DELETES.                                    53130000
512700                                                                  53140000
512800     READ WEEKLY-SKU-DELETES-FILE                                 53150000
512900             INTO  SD-SKU-DELETE-BKUP-RECORD                      53160000
513000      AT END  SET PS-WEEKLY-DELETES-EOF   TO TRUE.                53170000
513100                                                                  53180000
513200                                                                  53190000
513300******************************************************************53200000
513400*                                                                *53210000
513500*                                                                *53220000
513600******************************************************************53230000
513700 E230-PROCESS-INSERT-SKU.                                         53240000
513800                                                                  53250000
513900                                                                  53260000
514000*    PROCESS A01 RECORD...                                        53270000
514100     EVALUATE TRUE                                                53280000
514200                                                                  53290000
514300      WHEN   FS500I-OUTPUT-MESSAGE-SEQ = 01                       53300000
514400                                                                  53310000
514500          PERFORM E235-CHECK-INSERT-SKU                           53320000
514600                                                                  53330000
514700      END-EVALUATE.                                               53340000
514800                                                                  53350000
514900******************************************************************53360000
515000*                                                                *53370000
515100*                                                                *53380000
515200******************************************************************53390000
515300 E235-CHECK-INSERT-SKU.                                           53400000
515400                                                                  53410000
515500      MOVE SPACES     TO    ITMCLT-ITEM-CLUSTR-NAME.              53420000
515600      STRING  PV-WORK-DPT-2-4   DELIMITED BY SIZE                 53430000
515700              '-' DELIMITED BY SIZE                               53440000
515800              PV-WORK-SUBCL-3-4 DELIMITED BY SIZE                 53450000
515900                    INTO    ITMCLT-ITEM-CLUSTR-NAME.              53460000
516000      MOVE 'SCL'      TO    ITMCLT-HIER-CDE.                      53470000
516100                                                                  53480000
516200      MOVE ZEROES     TO    PV-HIER-CDE-NULL.                     53490000
516300                                                                  53500000
516400      MOVE PV-WORK-DPT-2-4   TO WS-DPT.                           53510000
516500      MOVE PV-WORK-SUBCL-3-4 TO WS-SCL.                           53520000
516600      MOVE WS-HOLD-DPT-SCL   TO PV-HOLD-DPT-SCL                   53530000
516700                                                                  53540000
516800      PERFORM D100-GET-CLUSTR-ID.                                 53550000
516900      IF SQLCODE = ZERO                                           53560000
517000        MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-SCL-PRNT-CLUSTR-ID       53570000
517100        MOVE PV-WORK-DPT-2-4       TO MDSEAR-DEPT-NBR             53580000
517200        PERFORM B130-GET-PARENT-DPT                               53590000
517300        MOVE PV-DEPT-PRNT-CLUSTR-ID TO ITMCLT-OWNER-ID            53600000
517400                                                                  53610000
517500        MOVE SPACES TO ITMCLT-ITEM-CLUSTR-NAME                    53620000
517600        MOVE FS500I-NI-SKU TO PV-WORK-NI-SKU                      53630000
517700        IF PV-WORK-NI-SKU-X-1 = '0'                               53640000
517800            STRING  PV-WORK-DPT-2-4   DELIMITED BY SIZE           53650000
517900                    '-' DELIMITED BY SIZE                         53660000
518000                    PV-WORK-SUBCL-3-4 DELIMITED BY SIZE           53670000
518100                    '-' DELIMITED BY SIZE                         53680000
518200                    PV-WORK-NI-SKU-X-2-8 DELIMITED BY SIZE        53690000
518300                        INTO    ITMCLT-ITEM-CLUSTR-NAME           53700000
518400        ELSE                                                      53710000
518500            STRING  PV-WORK-DPT-2-4   DELIMITED BY SIZE           53720000
518600                    '-' DELIMITED BY SIZE                         53730000
518700                    PV-WORK-SUBCL-3-4 DELIMITED BY SIZE           53740000
518800                    '-' DELIMITED BY SIZE                         53750000
518900                    PV-WORK-NI-SKU    DELIMITED BY SIZE           53760000
519000                        INTO    ITMCLT-ITEM-CLUSTR-NAME           53770000
519100        END-IF                                                    53780000
519200*       MOVE    FS500I-TSK-DEPT  TO ITMCLT-OWNER-ID               53790000
519300        MOVE    ZERO             TO PV-OWNER-ID-NULL              53800000
519400                                                                  53810000
519500                                                                  53820000
519600******* CHECK IF SKU ALREADY EXIST ******************             53830000
519700                                                                  53840000
519800        MOVE LOW-VALUES TO    ITMCLT-HIER-CDE                     53850000
519900                                                                  53860000
520000        MOVE -1         TO    PV-HIER-CDE-NULL                    53870000
520100        PERFORM D100-GET-CLUSTR-ID                                53880000
520200                                                                  53890000
520300        IF SQLCODE = 1403                                         53900000
520400          PERFORM E236-INSERT-SKU                                 53910000
520500        ELSE                                                      53920000
520600                                                                  53930000
0822RM*         DISPLAY 'SKU ALREADY EXISTS: ' ITMCLT-ITEM-CLUSTR-NAME  53940036
520800          MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-HOLD-ITEM-ID           53950000
520900          PERFORM E237-CHECK-PRE-EXISTING-SKU                     53960000
521000                                                                  53970000
521100        END-IF                                                    53980000
521200                                                                  53990000
521300      END-IF.                                                     54000000
521400                                                                  54010000
521500******************************************************************54020000
521600*  THIS CODE WAS FORMERLY CONTAINED IN E235-, I PULLED IT        *54030000
521700*  DOWN INTO ITS OWN PARAGRAPH.         OCT.1998                 *54040000
521800******************************************************************54050000
521900 E236-INSERT-SKU.                                                 54060000
522000                                                                  54070000
522100                                                                  54080000
522200          MOVE SPACES                 TO WS-OUTPUT-MESSAGE-AREA   54090000
522300          MOVE FS500I-OUTPUT-MESSAGE  TO WS-OUTPUT-MESSAGE-AREA   54100000
522400***                                                               54110000
522500***   A TRANSACTION ID OF M101 TELLS US THIS RECORD IS            54120000
522600***   COMING FROM MAKUT101, WHICH FOLLOWS THE FILE LAYOUT OF      54130000
522700***   THE NEW VSM SYSTEM.  THIS LAYOUT HAS 20 CHARS FOR           54140000
522800***   THE COLOR AND SIZE DESCRIPTION.                             54150000
522900***                                                               54160000
523000          IF FS500I-TRANSACTION-ID = 'M101'                       54170000
523100             MOVE AM101-SIZE-DESCRIPTION  TO AM-SIZE-DESCRIPTION  54180000
523200             MOVE AM101-COLOR-DESCRIPTION TO AM-COLOR-DESCRIPTION 54190000
523300             MOVE AM101-SKU-DESCRIPTION   TO AM-SKU-DESCRIPTION   54200000
523400          END-IF                                                  54210000
523500                                                                  54220000
523600          STRING  AM-SIZE-DESCRIPTION DELIMITED BY SIZE           54230000
523700                  ' '            DELIMITED BY SIZE                54240000
523800                  AM-COLOR-DESCRIPTION DELIMITED BY SIZE          54250000
523900                  ' '            DELIMITED BY SIZE                54260000
524000                  AM-SKU-DESCRIPTION   DELIMITED BY SIZE          54270000
524100                       INTO    ITMCLT-ITEM-CLUSTR-DESC            54280000
524200                                                                  54290000
524300          MOVE LOW-VALUES   TO    ITMCLT-CLUSTR-TYP-CDE           54300000
524400          MOVE LOW-VALUES   TO    ITMCLT-HIER-TYP-CDE             54310000
524500          MOVE 'I'          TO    ITMCLT-ITEM-CLUSTR-CDE          54320000
524600          MOVE 'P'          TO    ITMCLT-PROD-SERV-CDE            54330000
524700          MOVE 'M'          TO    ITMCLT-MDSE-NM-CDE              54340000
524800          MOVE LOW-VALUES   TO    ITMCLT-HIER-CDE                 54350000
524900                                                                  54360000
525000          MOVE PC-NEG-1   TO    PV-HIER-CDE-NULL                  54370000
525100                                PV-HIER-TYP-CDE-NULL              54380000
525200                                PV-CLUSTR-TYP-CDE-NULL            54390000
525300                                                                  54400000
525400          MOVE ZERO       TO    PV-PROD-SERV-CDE-NULL             54410000
525500                                PV-MDSE-NM-CDE-NULL               54420000
525600                                PV-CHLD-CDE-NULL                  54430000
525700                                                                  54440000
525800          MOVE 'M'          TO    ITMCLC-REL-TYP-CDE              54450000
525900          MOVE 'I'          TO    ITMCLC-CHLD-ITM-CLSTR-CDE       54460000
526000                                                                  54470000
526100          MOVE PV-CURRENT-TMST         TO ITMCLT-EFF-BEG-TMST     54480000
526200                                          ITMCLC-EFF-BEG-TMST     54490000
**TEMP*            DISPLAY 'E236 CALL TO C200-INSERT-TITMCLT '          54491027
**TEMP*            ADD +1 TO PV-INS-UPD-COUNT                           54492027
                PERFORM C200-INSERT-TITMCLT                             54500027
526400                                                                  54510000
526500          MOVE PV-SCL-PRNT-CLUSTR-ID TO ITMCLC-PRNT-ITM-CLUSTR-ID 54520000
526600          MOVE ITMCLT-ITEM-CLUSTR-ID TO ITMCLC-CHLD-ITM-CLUSTR-ID 54530000
526700                                        PV-HOLD-ITEM-ID           54540000
526800                                                                  54550000
526900          IF SQLCODE = ZERO                                       54560000
**TEMP*            DISPLAY 'E236 CALL TO C700-INSERT-ITMCLC  '          54561027
**TEMP*            ADD +1 TO PV-INS-UPD-COUNT                           54562027
                   PERFORM C700-INSERT-ITMCLC                           54570027
527100          END-IF                                                  54580000
527200                                                                  54590000
527300          MOVE ITMCLT-ITEM-CLUSTR-ID  TO PV-SKU-CHLD-CLUSTR-ID    54600000
527400                                                                  54610000
527500          MOVE  FS500I-TSKXREF-ITM-NBR TO TSK-ITEM-NMBR           54620000
527600                                                                  54630000
527700          MOVE ITMCLT-ITEM-CLUSTR-ID TO MDSEIT-ITEM-CLUSTR-ID     54640000
527800          PERFORM D120-GET-NEW-SKU-INFO                           54650000
527900                                                                  54660000
528000          IF SQLCODE = ZERO                                       54670000
**TEMP*            DISPLAY 'E236 CALL TO C750-INSERT-TMDSEIT '          54671027
**TEMP*            ADD +1 TO PV-INS-UPD-COUNT                           54672027
                    PERFORM C750-INSERT-TMDSEIT                         54680027
528200          END-IF                                                  54690000
528300                                                                  54700000
528400          PERFORM C900-PROCESS-GRP-INFO                           54710000
528500          PERFORM C950-PROCESS-VENDOR-INFO.                       54720000
528600                                                                  54730000
528700******************************************************************54740000
528800*  IF TITMCLT.LAST_UPD_TMST < ADD DATE, WE KNOW THAT THE         *54750000
528900*  TITMCLT CONTAINS AN OLD DELETED SKU FOR WHICH THE DELETE      *54760000
529000*  DIDN'T BRIDGE.  EXPIRE IT AND INSERT THE NEW SKU.  OTHERWISE, *54770000
529100*  JUST SKIP THIS RECORD.                                        *54780000
529200******************************************************************54790000
529300 E237-CHECK-PRE-EXISTING-SKU.                                     54800000
529400                                                                  54810000
529500                                                                  54820000
529600      IF FS500I-FUNCTION-CODE = 'A'                               54830000
529700        MOVE FS500I-TRANSACTION-DATE TO                           54840000
529800                               PV-SETUP-DATE-7                    54850000
529900*       DISPLAY '    FS500I-TRANSACTION-DATE= '                   54860006
530000*                                      PV-SETUP-DATE-7            54870006
530100        IF PV-SETUP-DATE-7(2:1) > '7'                             54880000
530200           MOVE '1900-00-00' TO PV-SETUP-DATE-10                  54890000
530300        ELSE                                                      54900000
530400           MOVE '2000-00-00' TO PV-SETUP-DATE-10                  54910000
530500        END-IF                                                    54920000
530600        MOVE PV-SETUP-DATE-7(2:2) TO PV-SETUP-DATE-10(3:2)        54930000
530700        MOVE PV-SETUP-DATE-7(4:2) TO PV-SETUP-DATE-10(6:2)        54940000
530800        MOVE PV-SETUP-DATE-7(6:2) TO PV-SETUP-DATE-10(9:2)        54950000
530900*                                                                 54960000
531000*       DISPLAY 'ITMCLT-LAST-UPD-TMST ' ITMCLT-LAST-UPD-TMST      54970000
531100*       DISPLAY '   < FS500I-TRANSACTION-DATE '                   54980000
531200*                                      PV-SETUP-DATE-10 ' ? '     54990000
531300        IF ITMCLT-LAST-UPD-TMST < PV-SETUP-DATE-10                55000000
531400*          DISPLAY '    EXPIRE OLD'                               55010006
531500           SET   PS-DONT-SAVE-RELS TO TRUE                        55020000
531600           PERFORM C410-EXPIRE-SKU-PARNT-REL                      55030000
531700*          DISPLAY '    INSERT NEW'                               55040006
531800           PERFORM E236-INSERT-SKU                                55050000
531900*       ELSE                                                      55060006
532000*          DISPLAY '    SKIPPING THIS RECORD'                     55070006
532100        END-IF                                                    55080000
532200      END-IF.                                                     55090000
532300                                                                  55100000
532400                                                                  55110000
532500******************************************************************55120000
532600*                                                                *55130000
532700*                                                                *55140000
532800*                                                                *55150000
532900*                                                                *55160000
533000******************************************************************55170000
533100                                                                  55180000
533200 E240-UPDATE-SKU.                                                 55190000
533300                                                                  55200000
533400      MOVE SPACES      TO   ITMCLT-ITEM-CLUSTR-NAME.              55210000
533500      MOVE FS500I-NI-SKU TO PV-WORK-NI-SKU.                       55220000
533600      IF PV-WORK-NI-SKU-X-1 = '0'                                 55230000
533700          STRING  PV-WORK-DPT-2-4   DELIMITED BY SIZE             55240000
533800                  '-' DELIMITED BY SIZE                           55250000
533900                  PV-WORK-SUBCL-3-4 DELIMITED BY SIZE             55260000
534000                  '-' DELIMITED BY SIZE                           55270000
534100                  PV-WORK-NI-SKU-X-2-8 DELIMITED BY SIZE          55280000
534200                      INTO    ITMCLT-ITEM-CLUSTR-NAME             55290000
534300      ELSE                                                        55300000
534400          STRING  PV-WORK-DPT-2-4   DELIMITED BY SIZE             55310000
534500                  '-' DELIMITED BY SIZE                           55320000
534600                  PV-WORK-SUBCL-3-4 DELIMITED BY SIZE             55330000
534700                  '-' DELIMITED BY SIZE                           55340000
534800                  PV-WORK-NI-SKU    DELIMITED BY SIZE             55350000
534900                      INTO    ITMCLT-ITEM-CLUSTR-NAME             55360000
535000      END-IF.                                                     55370000
535100*     DISPLAY 'ITEM-CLUSTR-NAME = '                               55380006
535200*                           ITMCLT-ITEM-CLUSTR-NAME.              55390006
535300                                                                  55400000
535400      IF ITMCLT-ITEM-CLUSTR-NAME NOT = PV-ITEM-UPDATE-NAME        55410000
535500         MOVE ITMCLT-ITEM-CLUSTR-NAME TO PV-ITEM-UPDATE-NAME      55420000
535600         SET PS-TYPE28-NOT-PROCESSED  TO TRUE                     55430000
535700      END-IF.                                                     55440000
535800                                                                  55450000
535900      MOVE LOW-VALUES TO    ITMCLT-HIER-CDE.                      55460000
536000      MOVE PC-NEG-1   TO    PV-HIER-CDE-NULL.                     55470000
536100                                                                  55480000
536200      PERFORM D100-GET-CLUSTR-ID.                                 55490000
536300                                                                  55500000
536400      IF SQLCODE NOT = ZERO                                       55510000
536500        IF SQLCODE = 1403                                         55520000
536600*          DISPLAY 'CLUSTER NAME NOT FOUND, NOT UPDATED'          55530006
                 CONTINUE                                               55540006
536700        END-IF                                                    55550000
536800      ELSE                                                        55560000
536900*       DISPLAY 'ITEM-CLUSTR-ID = '  ITMCLT-ITEM-CLUSTR-ID        55570006
537000        MOVE ITMCLT-ITEM-CLUSTR-ID TO PV-HOLD-ITEM-ID             55580000
537100*       DISPLAY 'ITEM-CLUSTR-DESC =' ITMCLT-ITEM-CLUSTR-DESC      55590006
537200        MOVE ITMCLT-ITEM-CLUSTR-DESC (1:5)  TO TSK-SIZE-DESC      55600000
537300        MOVE ITMCLT-ITEM-CLUSTR-DESC (7:4) TO TSK-COLOR-DESC      55610000
537400        MOVE ITMCLT-ITEM-CLUSTR-DESC (12:25) TO TSK-SKU-DESC      55620000
537500                                                                  55630000
537600        MOVE ITMCLT-ITEM-CLUSTR-ID  TO MDSEIT-ITEM-CLUSTR-ID      55640000
537700        PERFORM C755-SELECT-TMDSEIT                               55650000
537800                                                                  55660000
537900        MOVE SPACES                 TO WS-OUTPUT-MESSAGE-AREA     55670000
538000        MOVE FS500I-OUTPUT-MESSAGE  TO WS-OUTPUT-MESSAGE-AREA     55680000
538100***                                                               55690000
538200***   A TRANSACTION ID OF M101 TELLS US THIS RECORD IS            55700000
538300***   COMING FROM MAKUT101, WHICH FOLLOWS THE FILE LAYOUT OF      55710000
538400***   THE NEW VSM SYSTEM.  THIS LAYOUT HAS 20 CHARS FOR           55720000
538500***   THE COLOR AND SIZE DESCRIPTION.                             55730000
538600***                                                               55740000
538700        EVALUATE TRUE                                             55750000
538800                                                                  55760000
538900*       PROCESS C01 RECORD...                                     55770000
539000        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 01                       55780000
539100           MOVE    CM-NEW-SKU-DESCRIPTION  TO   TSK-SKU-DESC      55790000
539200*       PROCESS C02 RECORD...                                     55800000
539300        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 02                       55810000
539400           IF FS500I-TRANSACTION-ID = 'M101'                      55820000
539500              MOVE CM101-NEW-SIZE-DESCRIPTION  TO                 55830000
539600                                                 TSK-SIZE-DESC    55840000
539700                                              MDSEIT-SIZE-DESC    55850000
539800           ELSE                                                   55860000
539900              MOVE CM-NEW-SIZE-DESCRIPTION     TO                 55870000
540000                                                 TSK-SIZE-DESC    55880000
540100                                              MDSEIT-SIZE-DESC    55890000
540200           END-IF                                                 55900000
540300           MOVE ZERO                     TO   PV-SIZE-DESC-NULL   55910000
540400*       PROCESS C03 RECORD...                                     55920000
540500        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 03                       55930000
540600           IF FS500I-TRANSACTION-ID = 'M101'                      55940000
540700              MOVE CM101-NEW-COLOR-DESCRIPTION  TO                55950000
540800                                                 TSK-COLOR-DESC   55960000
540900                                              MDSEIT-COLOR-DESC   55970000
541000           ELSE                                                   55980000
541100              MOVE CM-NEW-COLOR-DESCRIPTION   TO                  55990000
541200                                                 TSK-COLOR-DESC   56000000
541300                                              MDSEIT-COLOR-DESC   56010000
541400           END-IF                                                 56020000
541500           MOVE ZERO                      TO PV-COLOR-DESC-NULL   56030000
541600*       PROCESS C04 RECORD...                                     56040000
541700        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 04                       56050000
541800                                                                  56060000
541900           MOVE CM-NEW-STATUS-CODE       TO   MDSEIT-STAT-CDE     56070000
542000                                                                  56080000
542100*       PROCESS C05 RECORD...                                     56090000
542200        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 05                       56100000
542300           MOVE CM-NEW-IN-HSE-VENDOR-NUMBER                       56110000
542400                                    TO  MDSEIT-VNDR-INHOUSE-NBR   56120000
542500           MOVE ZERO                TO  PV-VNDR-INHOUSE-NBR-NULL  56130000
542600*       PROCESS C10 RECORD...                                     56140000
542700        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 10                       56150000
542800           MOVE CM-NEW-CURRENT-RETAIL TO  MDSEIT-UNIT-RTL-AMT     56160000
542900           MOVE ZERO                  TO  PV-UNIT-RTL-AMT-NULL    56170000
543000*       PROCESS C11 RECORD...                                     56180000
543100        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 11                       56190000
543200           MOVE CM-NEW-RETAIL-UM     TO  MDSEIT-UNIT-RTL-UOM-CDE  56200000
543300           MOVE ZERO                 TO  PV-UNIT-RTL-UOM-CDE-NULL 56210000
543400*       PROCESS C19 RECORD...                                     56220000
543500        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 19                       56230000
543600           MOVE CM-NEW-GP-QTY         TO  MDSEIT-GRP-QTY          56240000
543700           MOVE ZERO                  TO  PV-GRP-QTY-NULL         56250000
543800*       PROCESS C20 RECORD...                                     56260000
543900        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 20                       56270000
544000           MOVE CM-NEW-GP-RTL-AMT     TO  MDSEIT-GRP-RTL-AMT      56280000
544100           MOVE ZERO                  TO  PV-GRP-RTL-AMT-NULL     56290000
544200*       PROCESS C28 RECORD...                                     56300000
544300        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 28                       56310000
544400           PERFORM F100-PROCESS-NEW-VENDOR                        56320000
544500           SET PS-TYPE28-PROCESSED    TO TRUE                     56330000
544600           MOVE CM-NEW-LONG-VENDOR-STYLE TO MDSEIT-VNDR-STYL-ID   56340000
544700           MOVE ZERO                  TO  PV-VNDR-STYL-ID-NULL    56350000
544800*       PROCESS C31 RECORD...                                     56360000
544900        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 31                       56370000
545000           IF PS-TYPE28-NOT-PROCESSED                             56380000
545100               PERFORM F100-PROCESS-NEW-VENDOR                    56390000
545200           END-IF                                                 56400000
545300           UNSTRING CM-NEW-ENTERPRISE-ID DELIMITED BY ' ' INTO    56410000
545400               PV-MDSEIT-ENT-ID                                   56420000
545500           MOVE PV-MDSEIT-ENT-ID  TO  MDSEIT-ENT-ID               56430000
545600*          DISPLAY 'CM-NEW-ENTERPRISE-ID ' CM-NEW-ENTERPRISE-ID   56440000
545700*          DISPLAY 'PV-MDSEIT-ENT-ID    ' PV-MDSEIT-ENT-ID        56450000
545800*          DISPLAY 'MDSEIT-ENT-ID       ' MDSEIT-ENT-ID           56460000
545900           MOVE ZERO                  TO  PV-ENT-ID-NULL          56470000
546000*       PROCESS C16 RECORD...                                     56480000
546100        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 16                       56490000
546200           PERFORM  F300-PROCESS-NEW-GRP-CODE                     56500000
546300*       PROCESS C39 RECORD...                                     56510000
546400        WHEN FS500I-OUTPUT-MESSAGE-SEQ = 39                       56520000
546500           DISPLAY 'MEITGP-NBR CHGS ARE NOT CURRENTLY BRIDGED.'   56530000
546600*          C39 ARE FILTERED OUT BY THE SORT PRIOR TO THIS JOB.    56540000
546700                                                                  56550000
546800        END-EVALUATE                                              56560000
546900                                                                  56570000
547000        IF   FS500I-OUTPUT-MESSAGE-SEQ = 01 OR                    56580000
547100             FS500I-OUTPUT-MESSAGE-SEQ = 02 OR                    56590000
547200             FS500I-OUTPUT-MESSAGE-SEQ = 03                       56600000
547300             STRING  TSK-SIZE-DESC  DELIMITED BY SIZE             56610000
547400                     ' '            DELIMITED BY SIZE             56620000
547500                     TSK-COLOR-DESC DELIMITED BY SIZE             56630000
547600                     ' '            DELIMITED BY SIZE             56640000
547700                     TSK-SKU-DESC   DELIMITED BY SIZE             56650000
547800                            INTO    ITMCLT-ITEM-CLUSTR-DESC       56660000
547900*            DISPLAY 'THE NEW ITEM-CLUSTR-DESC ='                 56670006
548000*                                   ITMCLT-ITEM-CLUSTR-DESC       56680006
548100             MOVE LOW-VALUES TO    ITMCLT-HIER-CDE                56690000
548200             MOVE 'I'   TO    ITMCLT-ITEM-CLUSTR-CDE              56700000
548300             MOVE PC-NEG-1   TO    PV-HIER-CDE-NULL               56710000
548400             PERFORM  C350-UPDATE-CLUSTER                         56720000
548500        END-IF                                                    56730000
548600                                                                  56740000
548700        IF   FS500I-OUTPUT-MESSAGE-SEQ = 02 OR                    56750000
548800             FS500I-OUTPUT-MESSAGE-SEQ = 03 OR                    56760000
548900             FS500I-OUTPUT-MESSAGE-SEQ = 04 OR                    56770000
549000             FS500I-OUTPUT-MESSAGE-SEQ = 05 OR                    56780000
549100             FS500I-OUTPUT-MESSAGE-SEQ = 10 OR                    56790000
549200             FS500I-OUTPUT-MESSAGE-SEQ = 11 OR                    56800000
549300             FS500I-OUTPUT-MESSAGE-SEQ = 19 OR                    56810000
549400             FS500I-OUTPUT-MESSAGE-SEQ = 20 OR                    56820000
549500             FS500I-OUTPUT-MESSAGE-SEQ = 28 OR                    56830000
549600             FS500I-OUTPUT-MESSAGE-SEQ = 31                       56840000
549700                                                                  56850000
**TEMP*            DISPLAY 'E240 CALL TO C760-UPDATE-TMDSEIT '          56851027
**TEMP*            ADD +1 TO PV-INS-UPD-COUNT                           56852027
                   PERFORM C760-UPDATE-TMDSEIT                          56860027
549900         END-IF                                                   56870000
550000                                                                  56880000
550100      END-IF.                                                     56890000
550200*     END-IF FOR SQLCODE = ZERO   *                               56900000
550300                                                                  56910000
550400                                                                  56920000
550500 E250-PROCESS-EXPIRE-SKU.                                         56930000
550600                                                                  56940000
550700*     PROCESS D01 RECORD...                                       56950000
550800                                                                  56960000
550900     PERFORM E251-EXPIRE-SKU-PARNT-REL.                           56970000
551000                                                                  56980000
551100                                                                  56990000
551200 E251-EXPIRE-SKU-PARNT-REL.                                       57000000
551300                                                                  57010000
551400     MOVE FS500I-NI-SKU  TO PV-ITMCLT-SKU.                        57020000
551500     PERFORM  E253-OPEN-NI-SKU-PARNT-CSR.                         57030000
551600                                                                  57040000
551700     SET PS-MORE-PARENTS TO TRUE.                                 57050000
551800     PERFORM  E254-FETCH-N-EXPIRE-PRNT-REL                        57060000
551900       UNTIL  PS-NO-MORE-PARENTS.                                 57070000
552000                                                                  57080000
552100     PERFORM  E256-CLOSE-NI-SKU-PARNT-CSR.                        57090000
552200                                                                  57100000
**TEMP*         DISPLAY ' E251 CALL TO E257-EXPIRE-CLUSTER-SKU'         57101027
**TEMP*         ADD +1 TO PV-INS-UPD-COUNT                              57102027
552300     PERFORM  E257-EXPIRE-CLUSTER-SKU.                            57110000
552400                                                                  57120000
552500                                                                  57130000
552600 E253-OPEN-NI-SKU-PARNT-CSR.                                      57140000
552700                                                                  57150000
552800     MOVE 'E253-OPEN-NI-SKU-PARNT-CSR' TO PV-ABEND-PARAGRAPH.     57160000
552900                                                                  57170000
553000     EXEC SQL                                                     57180000
553100         OPEN  NISKUPRNT                                          57190000
553200     END-EXEC.                                                    57200000
553300                                                                  57210000
553400     EVALUATE TRUE                                                57220000
553500        WHEN SQLCODE = ZEROS                                      57230000
553600           CONTINUE                                               57240000
553700        WHEN OTHER                                                57250000
553800          DISPLAY PV-ABEND-PARAGRAPH                              57260000
553900          PERFORM Z999-SQL-ERROR                                  57270000
554000     END-EVALUATE.                                                57280000
554100                                                                  57290000
554200                                                                  57300000
554300 E254-FETCH-N-EXPIRE-PRNT-REL.                                    57310000
554400                                                                  57320000
554500     MOVE 'E254-FETCH-N-EXPIRE-PRNT-REL' TO PV-ABEND-PARAGRAPH.   57330000
554600                                                                  57340000
554700     EXEC SQL                                                     57350000
554800         FETCH NISKUPRNT                                          57360000
554900          INTO  :ITMCLC-CHLD-ITM-CLUSTR-ID,                       57370000
555000                :ITMCLC-PRNT-ITM-CLUSTR-ID                        57380000
555100     END-EXEC.                                                    57390000
555200                                                                  57400000
555300     EVALUATE TRUE                                                57410000
555400         WHEN SQLCODE = ZEROS                                     57420000
**TEMP*         DISPLAY ' E254 CALL TO E255-EXPIRE-RELATIONSHIPS'       57421027
**TEMP*         ADD +1 TO PV-INS-UPD-COUNT                              57422027
                   PERFORM E255-EXPIRE-RELATIONSHIPS                    57430027
555600         WHEN SQLCODE = 1403                                      57440000
555700              SET PS-NO-MORE-PARENTS   TO TRUE                    57450000
555800         WHEN OTHER                                               57460000
555900              DISPLAY PV-ABEND-PARAGRAPH                          57470000
556000              PERFORM Z999-SQL-ERROR                              57480000
556100     END-EVALUATE.                                                57490000
556200                                                                  57500000
556300                                                                  57510000
556400 E255-EXPIRE-RELATIONSHIPS.                                       57520000
556500                                                                  57530000
556600     MOVE 'E255-EXPIRE-RELATIONSHIPS' TO PV-ABEND-PARAGRAPH.      57540000
556700                                                                  57550000
556800* SET THE EFFECTIVE END DATE, BY USING THE VARIABLE               57560000
556900* PV-CURR-END-TMST WHICH IS SET UP AT THE START OF THE            57570000
557000* PROGRAM.                                                        57580000
557100                                                                  57590000
557200     EXEC SQL                                                     57600000
557300        UPDATE TITMCLC                                            57610000
557400           SET EFF_END_TMST       = :PV-CURR-END-TMST,            57620000
557500               LAST_UPD_TMST      =  SYSDATE,                     57630000
557600               LAST_UPD_BY_UID    =  'MAKUT102'                   57640000
557700         WHERE PRNT_ITM_CLUSTR_ID = :ITMCLC-PRNT-ITM-CLUSTR-ID    57650000
557800           AND CHLD_ITM_CLUSTR_ID = :ITMCLC-CHLD-ITM-CLUSTR-ID    57660000
557900           AND EFF_END_TMST IS NULL                               57670000
558000     END-EXEC.                                                    57680000
558100                                                                  57690000
558200     EVALUATE TRUE                                                57700000
558300         WHEN SQLCODE = ZEROS                                     57710000
0822RM             ADD +1 TO PV-INS-UPD-COUNT                           57720022
558400*          DISPLAY '**********************************'           57730012
558500*          DISPLAY 'E255-EXPIRE-RELATIONSHIPS'                    57740012
558600*          DISPLAY 'EXPIRATION COMPLETE FOR: '                    57750012
558700*          DISPLAY 'PRNT_ITM_CLUSTR_ID=' ITMCLC-PRNT-ITM-CLUSTR-ID57760012
558800*          DISPLAY 'CHLD_ITM_CLUSTR_ID=' ITMCLC-CHLD-ITM-CLUSTR-ID57770012
558900*          DISPLAY 'EFFECTIVE END TMST=' PV-CURR-END-TMST         57780012
559000*          DISPLAY '**********************************'           57790012
559100*          CONTINUE                                               57800000
559200         WHEN SQLCODE = 1403                                      57810000
559300           DISPLAY '**********************************'           57820000
559400           DISPLAY 'E255-EXPIRE-RELATIONSHIPS'                    57830000
559500           DISPLAY 'CANNOT EXPIRE, RELATIONSHIP DOESN''T EXIST:'  57840000
559600           DISPLAY 'PRNT_ITM_CLUSTR_ID=' ITMCLC-PRNT-ITM-CLUSTR-ID57850000
559700           DISPLAY 'CHLD_ITM_CLUSTR_ID=' ITMCLC-CHLD-ITM-CLUSTR-ID57860000
559800           DISPLAY '**********************************'           57870000
559900         WHEN OTHER                                               57880000
560000           DISPLAY PV-ABEND-PARAGRAPH                             57890000
560100           PERFORM Z999-SQL-ERROR                                 57900000
560200     END-EVALUATE.                                                57910000
560300                                                                  57920000
560400                                                                  57930000
560500 E256-CLOSE-NI-SKU-PARNT-CSR.                                     57940000
560600                                                                  57950000
560700     MOVE 'E256-CLOSE-NI-SKU-PARNT-CSR' TO PV-ABEND-PARAGRAPH.    57960000
560800                                                                  57970000
560900     EXEC SQL                                                     57980000
561000         CLOSE  NISKUPRNT                                         57990000
561100     END-EXEC.                                                    58000000
561200                                                                  58010000
561300     EVALUATE TRUE                                                58020000
561400         WHEN SQLCODE = ZEROS                                     58030000
561500             CONTINUE                                             58040000
561600         WHEN OTHER                                               58050000
561700             DISPLAY PV-ABEND-PARAGRAPH                           58060000
561800             PERFORM Z999-SQL-ERROR                               58070000
561900     END-EVALUATE.                                                58080000
562000                                                                  58090000
562100                                                                  58100000
562200 E257-EXPIRE-CLUSTER-SKU.                                         58110000
562300                                                                  58120000
562400     MOVE 'E257-EXPIRE-CLUSTER-SKU' TO PV-ABEND-PARAGRAPH.        58130000
562500*    DISPLAY 'E257-EXPIRE-CLUSTER-SKU'.                           58140006
0822RM*    DISPLAY 'ITMCLT SKU = ' PV-ITMCLT-SKU.                       58150020
562700                                                                  58160000
562800     EXEC SQL                                                     58170000
562900         UPDATE   TITMCLT                                         58180000
563000         SET   EFF_END_TMST    = :PV-CURRENT-TMST,                58190000
563100               LAST_UPD_BY_UID = 'MAKUT102',                      58200000
563200               LAST_UPD_TMST   = SYSDATE                          58210000
563300         WHERE SKU             = :PV-ITMCLT-SKU                   58220000
563400           AND HIER_CDE        IS NULL                            58230000
563500           AND ITEM_CLUSTR_CDE = 'I'                              58240000
563600           AND ((EFF_END_TMST IS NULL) OR                         58250000
563700               (EFF_END_TMST > :PV-CURR-END-TMST))                58260000
563800     END-EXEC.                                                    58270000
563900                                                                  58280000
564000     EVALUATE TRUE                                                58290000
564100         WHEN SQLCODE = ZEROS                                     58300000
0822RM             ADD +1 TO PV-INS-UPD-COUNT                           58310022
0822RM*            DISPLAY 'CLUSTER EXPIRED.'                           58320012
564300         WHEN SQLCODE = 1403                                      58330000
0822RM*            DISPLAY 'CLUSTER DOES NOT EXIST, NOT EXPIRED'        58340022
564400             DISPLAY 'CLUSTER ' PV-ITMCLT-SKU  'DOES NOT '        58350022
564400                     'EXIST, NOT EXPIRED'                         58360022
564500         WHEN OTHER                                               58370000
564600             DISPLAY PV-ABEND-PARAGRAPH                           58380000
564700             PERFORM Z999-SQL-ERROR                               58390000
564800     END-EVALUATE.                                                58400000
564900                                                                  58410000
565000                                                                  58420000
565100******************************************************************58430000
565200*                                                                *58440000
565300*                                                                *58450000
565400******************************************************************58460000
565500 E300-PROCESS-WKLY-SKU-DELETES.                                   58470023
565600                                                                  58480023
565700                                                                  58490000
565800      PERFORM  E225-READ-WEEKLY-SKU-DELETES.                      58500000
565900                                                                  58510000
566000      PERFORM                                                     58520000
566100      UNTIL PS-WEEKLY-DELETES-EOF                                 58530000
566200                                                                  58540000
0822RM      ADD 1 TO WS-DELETE-RECS-READ                                58541023
566300      MOVE SPACES          TO    ITMCLT-ITEM-CLUSTR-NAME          58550000
566400        STRING  SD-DEPT-NMBR     DELIMITED BY SIZE                58560000
566500                             '-' DELIMITED BY SIZE                58570000
566600                SD-CLASS-NMBR    DELIMITED BY SIZE                58580000
566700                             '-' DELIMITED BY SIZE                58590000
566800                SD-SEQ-NMBR      DELIMITED BY SIZE                58600000
566900                         INTO    ITMCLT-ITEM-CLUSTR-NAME          58610000
567000      MOVE LOW-VALUES TO    ITMCLT-HIER-CDE                       58620000
567100                                                                  58630000
567200      MOVE PC-NEG-1   TO    PV-HIER-CDE-NULL                      58640000
567300                                                                  58650000
567400                                                                  58660000
567500      PERFORM  C410-EXPIRE-SKU-PARNT-REL                          58670000
567600                                                                  58680000
0822RM**** COMMIT CHECK LOGIC                                           58690017
0822RM      IF PV-INS-UPD-COUNT > PC-COMMIT-THRESHOLD                   58700023
0822RM          ADD PV-INS-UPD-COUNT TO PV-TOTAL-INS-UPD                58710025
0822RM          MOVE 0               TO PV-INS-UPD-COUNT                58711025
0822RM           PERFORM E130-COMMIT-RENUMBERS                          58720017
0822RM      END-IF                                                      58730019
                                                                        58740017
567700      PERFORM  E225-READ-WEEKLY-SKU-DELETES                       58750000
567800                                                                  58760000
567900      END-PERFORM.                                                58770000
568000                                                                  58780000
568100                                                                  58790000
568200******************************************************************58800000
568300*                                                                *58810000
568400*                                                                *58820000
568500******************************************************************58830000
568600                                                                  58840000
568700 F100-PROCESS-NEW-VENDOR.                                         58850000
568800                                                                  58860000
568900     MOVE ITMCLT-ITEM-CLUSTR-ID  TO PV-SKU-CHLD-CLUSTR-ID.        58870000
569000                                                                  58880000
569100     MOVE  FS500I-TSKXREF-ITM-NBR TO TSK-ITEM-NMBR.               58890000
569200                                                                  58900000
569300     PERFORM F110-EXPIRE-OLD-RELS.                                58910000
569400                                                                  58920000
569500     MOVE PV-WORK-DPT-2-4 TO MDSEAR-DEPT-NBR.                     58930000
569600     PERFORM B130-GET-PARENT-DPT.                                 58940000
569700     MOVE PV-DEPT-PRNT-CLUSTR-ID TO ITMCLT-OWNER-ID.              58950000
569800                                                                  58960000
569900     PERFORM C950-PROCESS-VENDOR-INFO.                            58970000
570000                                                                  58980000
570100                                                                  58990000
570200 F110-EXPIRE-OLD-RELS.                                            59000000
570300                                                                  59010000
570400     MOVE 'F110-EXPIRE-OLD-RELS'                                  59020000
570500               TO  PV-ABEND-PARAGRAPH.                            59030000
570600                                                                  59040000
570700      EXEC SQL                                                    59050000
570800        SELECT /*+ INDEX(A IITMCLT0) */                           59060000
570900               A.ITEM_CLUSTR_ID                                   59070000
571000        INTO  :ITMCLT-ITEM-CLUSTR-ID                              59080000
571100        FROM    TITMCLT A,                                        59090000
571200                TITMCLC B                                         59100000
571300        WHERE A.HIER_CDE             = 'VST'                      59110000
571400        AND  B.PRNT_ITM_CLUSTR_ID    = A.ITEM_CLUSTR_ID           59120000
571500        AND  B.CHLD_ITM_CLUSTR_ID    = :PV-SKU-CHLD-CLUSTR-ID     59130000
571600        AND  B.REL_TYP_CDE           = 'M'                        59140000
571700        AND (B.EFF_END_TMST IS NULL OR                            59150000
571800             B.EFF_END_TMST > :PV-CURR-END-TMST)                  59160000
571900      END-EXEC.                                                   59170000
572000                                                                  59180000
572100     EVALUATE TRUE                                                59190000
572200                                                                  59200000
572300       WHEN SQLCODE = ZEROS                                       59210000
572400       WHEN SQLCODE = 1403                                        59220000
572500         CONTINUE                                                 59230000
572600       WHEN OTHER                                                 59240000
572700         DISPLAY PV-ABEND-PARAGRAPH                               59250000
572800         PERFORM Z999-SQL-ERROR                                   59260000
572900     END-EVALUATE.                                                59270000
573000                                                                  59280000
573100     IF SQLCODE = ZERO                                            59290000
573200       MOVE PV-SKU-CHLD-CLUSTR-ID TO ITMCLC-CHLD-ITM-CLUSTR-ID    59300000
573300       MOVE ITMCLT-ITEM-CLUSTR-ID TO ITMCLC-PRNT-ITM-CLUSTR-ID    59310000
573400                                                                  59320000
**TEMP*      DISPLAY ' F110 CALL TO C500-EXPIRE-RELATIONSHIPS'          59321027
**TEMP*      ADD +1 TO PV-INS-UPD-COUNT                                 59322027
             PERFORM C500-EXPIRE-RELATIONSHIPS                          59330027
573600     END-IF.                                                      59340000
573700                                                                  59350000
573800                                                                  59360000
573900 F300-PROCESS-NEW-GRP-CODE.                                       59370000
574000                                                                  59380000
**TEMP*    DISPLAY 'F300-PROCESS-NEW-GRP-CODE'.                         59390045
0822RM     MOVE 'F300-PROCESS-NEW-GRP-CODE'                             59391045
0822RM               TO  PV-ABEND-PARAGRAPH.                            59392045
574200                                                                  59400000
574300     MOVE ITMCLT-ITEM-CLUSTR-ID  TO PV-SKU-CHLD-CLUSTR-ID.        59410000
574400                                                                  59420000
574500     MOVE FS500I-TSKXREF-ITM-NBR TO TSK-ITEM-NMBR.                59430000
574600                                                                  59440000
574700     PERFORM F310-EXPIRE-OLD-GRP                                  59450000
574800        THRU F310-EXIT.                                           59460000
574900                                                                  59470000
575000     MOVE PV-WORK-DPT-2-4       TO MDSEAR-DEPT-NBR.               59480000
575100     PERFORM B130-GET-PARENT-DPT.                                 59490000
575200     MOVE PV-DEPT-PRNT-CLUSTR-ID TO ITMCLT-OWNER-ID.              59500000
575300                                                                  59510000
575400     MOVE 'S' TO ITMCLT-CLUSTR-TYP-CDE.                           59520000
575500     MOVE LOW-VALUES TO ITMCLT-MDSE-NM-CDE.                       59530000
575600     MOVE LOW-VALUES TO ITMCLT-PROD-SERV-CDE.                     59540000
575700                                                                  59550000
575800     MOVE 'M'   TO    ITMCLT-HIER-TYP-CDE.                        59560000
575900     MOVE 'C'   TO    ITMCLT-ITEM-CLUSTR-CDE.                     59570000
576000     MOVE 'GRP' TO    ITMCLT-HIER-CDE.                            59580000
576100                                                                  59590000
576200     MOVE ZEROES    TO    PV-HIER-CDE-NULL                        59600000
576300                          PV-HIER-TYP-CDE-NULL                    59610000
576400                          PV-CLUSTR-TYP-CDE-NULL                  59620000
576500                          PV-OWNER-ID-NULL                        59630000
576600                          PV-CHLD-CDE-NULL.                       59640000
576700                                                                  59650000
576800                                                                  59660000
576900     MOVE PC-NEG-1  TO    PV-MDSE-NM-CDE-NULL                     59670000
577000                          PV-PROD-SERV-CDE-NULL.                  59680000
577100                                                                  59690000
577200                                                                  59700000
577300     MOVE SPACES      TO    ITMCLT-ITEM-CLUSTR-NAME.              59710000
577400                                                                  59720000
577500     IF  CM-NEW-GROUP-CODE   NOT = SPACES                         59730000
577600         STRING PV-WORK-DPT-2-4    DELIMITED BY SIZE              59740032
577700                 '-' DELIMITED BY SIZE                            59750032
577800                 PV-WORK-SUBCL-3-4 DELIMITED BY SIZE              59760032
577900                 '-' DELIMITED BY SIZE                            59770032
578000                 CM-NEW-GROUP-CODE DELIMITED BY SIZE              59780032
578100                       INTO ITMCLT-ITEM-CLUSTR-NAME               59790032
578200         MOVE ITMCLT-ITEM-CLUSTR-NAME TO ITMCLT-ITEM-CLUSTR-DESC  59800032
578300*     DISPLAY 'GROUP NAME = ' ITMCLT-ITEM-CLUSTR-NAME             59810006
578400                                                                  59820000
578600         MOVE PV-CURRENT-TMST TO ITMCLT-EFF-BEG-TMST              59840032
578700                                 ITMCLC-EFF-BEG-TMST              59850032
578800                                                                  59860000
578900         PERFORM D100-GET-CLUSTR-ID                               59870032
579000                                                                  59880000
579100         IF SQLCODE = 1403                                        59890032
579200           PERFORM C200-INSERT-TITMCLT                            59900032
579300         END-IF                                                   59910032
579600                                                                  59940000
579700         MOVE PV-SKU-CHLD-CLUSTR-ID TO ITMCLC-CHLD-ITM-CLUSTR-ID  59950032
579800         MOVE ITMCLT-ITEM-CLUSTR-ID TO ITMCLC-PRNT-ITM-CLUSTR-ID  59960032
579900                                       PV-GRP-CHLD-CLUSTR-ID      59970032
580000         MOVE 'M'               TO ITMCLC-REL-TYP-CDE             59980032
580100         MOVE 'I'               TO ITMCLC-CHLD-ITM-CLSTR-CDE      59990032
580200                                                                  60000000
080300         MOVE PV-CURRENT-TMST-NEW TO PV-NEW-TMST                  60010045
0822RM**- COMMENTED OUT THE PERFORM THRU AND REPLACED WITH SQL BELOW    60011045
0822RM*        PERFORM UNTIL PV-NEW-TMST > PV-CURRENT-TMST-NEW          60020045
0822RM*            PERFORM G100-WASTE-TIME 1000 TIMES                   60030045
0822RM*            EXEC SQL                                             60040045
0822RM*                SELECT SYSDATE                                   60050045
0822RM*                INTO :PV-NEW-TMST                                60060045
0822RM*                FROM DUAL                                        60070045
0822RM*            END-EXEC                                             60080045
0822RM*                                                                 60090045
0822RM*        END-PERFORM                                              60100045
581300                                                                  60110000
0822RM                                                                  60111033
0822RM** REPLACE THE ABOVE SQL WITH THE FOLLOWING SQL                   60111145
0822RM         EXEC SQL                                                 60111245
0822RM             SELECT TO_CHAR(TO_DATE(:PV-CURRENT-TMST-NEW)         60111345
0822RM                            +1/24/60/60,                          60111445
0822RM                            'YYYY-MM-DD HH24:MI:SS')              60111545
0822RM             INTO :PV-NEW-TMST                                    60111645
0822RM             FROM DUAL                                            60111745
0822RM         END-EXEC                                                 60111845
                                                                        60111945
0822RM         EVALUATE TRUE                                            60112145
0822RM           WHEN SQLCODE = ZEROS                                   60112245
0822RM             CONTINUE                                             60112345
0822RM           WHEN OTHER                                             60112445
0822RM             DISPLAY PV-ABEND-PARAGRAPH                           60112545
0822RM             PERFORM Z999-SQL-ERROR                               60112645
0822RM         END-EVALUATE                                             60112745
                                                                        60119133
**TEMP         DISPLAY 'PV-NEW-TMST-TEST    ' PV-NEW-TMST-TEST          60119233
**TEMP         DISPLAY 'PV-NEW-TMST         ' PV-NEW-TMST               60119333
**TEMP         DISPLAY 'PV-CURRENT-TMST-NEW ' PV-CURRENT-TMST-NEW       60119433
                                                                        60119533
581400         MOVE PV-NEW-TMST TO PV-CURRENT-TMST-NEW                  60120032
581500         MOVE PV-CURRENT-TMST-NEW TO ITMCLC-EFF-BEG-TMST          60130032
581600         PERFORM C700-INSERT-ITMCLC                               60140032
581700                                                                  60150000
581800     END-IF.                                                      60160000
581900                                                                  60170000
582000                                                                  60180000
582100                                                                  60190000
582200 F310-EXPIRE-OLD-GRP.                                             60200000
582300     MOVE 'F310-EXPIRE-OLD-GRP'                                   60210000
582400               TO  PV-ABEND-PARAGRAPH.                            60220000
582500                                                                  60230000
582600      EXEC SQL                                                    60240000
582700        SELECT /*+ INDEX(A IITMCLT0) */                           60250000
582800               A.ITEM_CLUSTR_ID                                   60260000
582900        INTO  :ITMCLT-ITEM-CLUSTR-ID                              60270000
583000        FROM    TITMCLT A,                                        60280000
583100                TITMCLC B                                         60290000
583200        WHERE A.HIER_CDE             = 'GRP'                      60300000
583300        AND  B.PRNT_ITM_CLUSTR_ID    = A.ITEM_CLUSTR_ID           60310000
583400        AND  B.CHLD_ITM_CLUSTR_ID    = :PV-SKU-CHLD-CLUSTR-ID     60320000
583500        AND  B.REL_TYP_CDE           = 'M'                        60330000
583600        AND (B.EFF_END_TMST IS NULL OR                            60340000
583700             B.EFF_END_TMST > :PV-CURR-END-TMST)                  60350000
583800      END-EXEC.                                                   60360000
583900                                                                  60370000
584000     EVALUATE TRUE                                                60380000
584100                                                                  60390000
584200       WHEN SQLCODE = ZEROS                                       60400000
584300       WHEN SQLCODE = 1403                                        60410000
584400         CONTINUE                                                 60420000
584500       WHEN SQLCODE = PC-MULT-VALUES                              60430000
584600         PERFORM F320-EXPIRE-DUP-GRP                              60440000
584700            THRU F320-EXIT                                        60450000
584800         GO TO F310-EXIT                                          60460000
584900       WHEN OTHER                                                 60470000
585000         DISPLAY PV-ABEND-PARAGRAPH                               60480000
585100         PERFORM Z999-SQL-ERROR                                   60490000
585200     END-EVALUATE.                                                60500000
585300                                                                  60510000
585400      IF SQLCODE = ZERO                                           60520000
585500        MOVE PV-SKU-CHLD-CLUSTR-ID TO ITMCLC-CHLD-ITM-CLUSTR-ID   60530000
585600        MOVE ITMCLT-ITEM-CLUSTR-ID TO ITMCLC-PRNT-ITM-CLUSTR-ID   60540000
**TEMP*        DISPLAY ' F310 CALL TO C500-EXPIRE-RELATIONSHIPS'        60541027
**TEMP*        ADD +1 TO PV-INS-UPD-COUNT                               60542027
              PERFORM C500-EXPIRE-RELATIONSHIPS                         60550027
585800      ELSE                                                        60560000
585900        IF SQLCODE = 1403                                         60570000
586000         DISPLAY 'CAN NOT FIND OLD GRP: ' ITMCLT-ITEM-CLUSTR-NAME 60580000
586100        END-IF                                                    60590000
586200      END-IF.                                                     60600000
586300                                                                  60610000
586400 F310-EXIT.                                                       60620000
586500     EXIT.                                                        60630000
586600                                                                  60640000
586700                                                                  60650000
586800 F320-EXPIRE-DUP-GRP.                                             60660000
586900                                                                  60670000
587000     PERFORM VARYING PV-SUB1 FROM 1 BY 1                          60680000
587100         UNTIL PV-SUB1 > 50                                       60690000
587200             MOVE ZEROS TO PV-GRP-CDE-CLUSTER-ID (PV-SUB1)        60700000
587300     END-PERFORM.                                                 60710000
587400                                                                  60720000
587500     PERFORM F321-OPEN-GRP-CURSOR                                 60730000
587600        THRU F321-EXIT.                                           60740000
587700                                                                  60750000
587800     SET PS-MORE-DUPGRP-TO-PROCESS TO TRUE.                       60760000
587900     PERFORM F322-FETCH-GRP-CURSOR                                60770000
588000        THRU F322-EXIT                                            60780000
588100         VARYING PV-SUB1 FROM 1 BY 1                              60790000
588200         UNTIL PS-NO-MORE-DUPGRP-TO-PROCESS.                      60800000
588300                                                                  60810000
588400     PERFORM F323-CLOSE-GRP-CURSOR                                60820000
588500        THRU F323-EXIT.                                           60830000
588600                                                                  60840000
588700     PERFORM VARYING PV-SUB1 FROM 1 BY 1                          60850000
588800         UNTIL PV-GRP-CDE-CLUSTER-ID (PV-SUB1) = ZEROS            60860000
588900         OR PV-SUB1 > 50                                          60870000
589000                                                                  60880000
589100             MOVE PV-SKU-CHLD-CLUSTR-ID                           60890000
589200                   TO ITMCLC-CHLD-ITM-CLUSTR-ID                   60900000
589300             MOVE PV-GRP-CDE-CLUSTER-ID (PV-SUB1)                 60910000
589400                   TO ITMCLC-PRNT-ITM-CLUSTR-ID                   60920000
589500                                                                  60930000
**TEMP*        DISPLAY ' F320 CALL TO C500-EXPIRE-RELATIONSHIPS'        60931027
**TEMP*        ADD +1 TO PV-INS-UPD-COUNT                               60932027
                   PERFORM C500-EXPIRE-RELATIONSHIPS                    60940027
589700                                                                  60950000
589800     END-PERFORM.                                                 60960000
589900                                                                  60970000
590000 F320-EXIT.                                                       60980000
590100     EXIT.                                                        60990000
590200                                                                  61000000
590300                                                                  61010000
590400 F321-OPEN-GRP-CURSOR.                                            61020000
590500                                                                  61030000
590600     MOVE 'F321-OPEN-GRP-CURSOR' TO PV-ABEND-PARAGRAPH.           61040000
590700                                                                  61050000
590800     EXEC SQL                                                     61060000
590900         OPEN DUPGRPCSR                                           61070000
591000     END-EXEC.                                                    61080000
591100                                                                  61090000
591200     EVALUATE TRUE                                                61100000
591300       WHEN SQLCODE = ZEROS                                       61110000
591400         CONTINUE                                                 61120000
591500       WHEN OTHER                                                 61130000
591600         DISPLAY PV-ABEND-PARAGRAPH                               61140000
591700         PERFORM Z999-SQL-ERROR                                   61150000
591800     END-EVALUATE.                                                61160000
591900                                                                  61170000
592000 F321-EXIT.                                                       61180000
592100     EXIT.                                                        61190000
592200                                                                  61200000
592300                                                                  61210000
592400 F322-FETCH-GRP-CURSOR.                                           61220000
592500                                                                  61230000
592600     MOVE 'F322-FETCH-GRP-CURSOR' TO PV-ABEND-PARAGRAPH.          61240000
592700                                                                  61250000
592800     EXEC SQL                                                     61260000
592900         FETCH  DUPGRPCSR                                         61270000
593000         INTO  :ITMCLT-ITEM-CLUSTR-ID                             61280000
593100     END-EXEC.                                                    61290000
593200                                                                  61300000
593300     EVALUATE TRUE                                                61310000
593400       WHEN SQLCODE = ZEROS                                       61320000
593500         MOVE ITMCLT-ITEM-CLUSTR-ID                               61330000
593600             TO PV-GRP-CDE-CLUSTER-ID (PV-SUB1)                   61340000
593700       WHEN SQLCODE = 1403                                        61350000
593800         SET PS-NO-MORE-DUPGRP-TO-PROCESS TO TRUE                 61360000
593900       WHEN OTHER                                                 61370000
594000         DISPLAY PV-ABEND-PARAGRAPH                               61380000
594100         PERFORM Z999-SQL-ERROR                                   61390000
594200     END-EVALUATE.                                                61400000
594300                                                                  61410000
594400 F322-EXIT.                                                       61420000
594500     EXIT.                                                        61430000
594600                                                                  61440000
594700                                                                  61450000
594800 F323-CLOSE-GRP-CURSOR.                                           61460000
594900                                                                  61470000
595000     MOVE 'F323-CLOSE-GRP-CURSOR' TO PV-ABEND-PARAGRAPH.          61480000
595100                                                                  61490000
595200     EXEC SQL                                                     61500000
595300         CLOSE DUPGRPCSR                                          61510000
595400     END-EXEC.                                                    61520000
595500                                                                  61530000
595600     EVALUATE TRUE                                                61540000
595700       WHEN SQLCODE = ZEROS                                       61550000
595800         CONTINUE                                                 61560000
595900       WHEN OTHER                                                 61570000
596000         DISPLAY PV-ABEND-PARAGRAPH                               61580000
596100         PERFORM Z999-SQL-ERROR                                   61590000
596200     END-EVALUATE.                                                61600000
596300                                                                  61610000
596400 F323-EXIT.                                                       61620000
596500     EXIT.                                                        61630000
596600                                                                  61640000
596700                                                                  61650000
596800 G100-WASTE-TIME.                                                 61660000
596900                                                                  61670000
597000     MOVE SPACES      TO    PV-DUMMY.                             61680000
597100                                                                  61690000
597200******************************************************************61700000
597300*                                                                *61710000
597400 H100-CHECK-TRPLCTL.                                              61720000
597500*    -DETERMINE IF THE EXTRACT OF TMDSEAR SHOULD OCCUR.          *61730000
597600*    -THIS EXTRACT WILL OCCUR ONLY ONCE A DAY DURING THE FIRST   *61740000
597700*     RUN OF THE DAY.                                            *61750000
597800*  ASSUMPTION:  ALL TMDSEAR CHANGES WILL BE POSTED WITH          *61760000
597900*               YESTERDAY'S DATE.                                *61770000
598000******************************************************************61780000
598100     MOVE 'TMDSEAR'               TO RPLCTL-LOG-TBL-NME.          61790000
598200     SET PS-MDSEAR-NOT-OK         TO TRUE.                        61800000
598300     PERFORM H200-GET-RPLCTL-ROW.                                 61810000
598400*                                                                 61820000
598500*    IF THE LAST EXTRACT TIMESTAMP IS LESS THAN THE INPUT TIME,   61830000
598600*       SET THE SWITCH TO EXTRACT FROM THE TMDSEAR TABLE          61840000
598700*       AND UPDATE REPLICATION CONTROL TABLE WITH THE LAST        61850000
598800*       POSSIBLE SECOND OF THE DAY THAT WAS INPUT.                61860000
598900*                                                                 61870000
599000     IF RPLCTL-EXTR-END-TMST < PV-INPUT-END-TMST                  61880000
599100        MOVE RPLCTL-EXTR-END-TMST TO RPLCTL-EXTR-BEG-TMST         61890000
599200        MOVE PV-INPUT-END-TMST    TO RPLCTL-EXTR-END-TMST         61900000
599300        SET PS-MDSEAR-OK          TO TRUE                         61910000
**TEMP*         DISPLAY ' H100 CALL TO H300-UPD-RPLCTL-ROW '            61911027
**TEMP*         ADD +1 TO PV-INS-UPD-COUNT                              61912027
599400        PERFORM H300-UPD-RPLCTL-ROW                               61920027
599500     END-IF.                                                      61930000
599600******************************************************************61940000
599700*                                                                *61950000
599800 H200-GET-RPLCTL-ROW.                                             61960000
599900*    RETRIEVE THE LAST TMST THE CURRENT TABLE WAS EXTRACTED.     *61970000
600000*                                                                *61980000
600100******************************************************************61990000
600200     MOVE PC-APPL-ID     TO RPLCTL-APPL-ID.                       62000000
600300     MOVE PC-EXTR-PRC-ID TO RPLCTL-EXTR-PRC-ID.                   62010000
600400*    DISPLAY 'SELECTING FROM TRPLCTL FOR ' RPLCTL-EXTR-PRC-ID     62020006
600500*                                      ' ' RPLCTL-LOG-TBL-NME.    62030006
600600     EXEC SQL                                                     62040000
600700         SELECT                                                   62050000
600800                 EXTR_END_TMST                                    62060000
600900          INTO                                                    62070000
601000                 :RPLCTL-EXTR-END-TMST                            62080000
601100          FROM                                                    62090000
601200                TRPLCTL                                           62100000
601300          WHERE                                                   62110000
601400                APPL_ID     = :RPLCTL-APPL-ID                     62120000
601500            AND EXTR_PRC_ID = :RPLCTL-EXTR-PRC-ID                 62130000
601600            AND LOG_TBL_NME = :RPLCTL-LOG-TBL-NME                 62140000
601700     END-EXEC.                                                    62150000
601800                                                                  62160000
601900     EVALUATE TRUE                                                62170000
602000       WHEN SQLCODE = ZEROS                                       62180000
602100         CONTINUE                                                 62190000
602200       WHEN OTHER                                                 62200000
602300         DISPLAY PV-ABEND-PARAGRAPH                               62210000
602400         PERFORM Z999-SQL-ERROR                                   62220000
602500     END-EVALUATE.                                                62230000
602600                                                                  62240000
602700     DISPLAY 'THE LAST TIME THE MDSEAR CHANGES WERE PROCESSED = ' 62250006
602800              RPLCTL-EXTR-END-TMST.                               62260006
602900                                                                  62270000
603000******************************************************************62280000
603100*                                                                *62290000
603200 H300-UPD-RPLCTL-ROW.                                             62300000
603300*    UPDATE THE BEG AND END TMSTS OF THE TRPLCTL TABLE.          *62310000
603400*                                                                *62320000
603500******************************************************************62330000
603600     MOVE PC-APPL-ID     TO RPLCTL-APPL-ID.                       62340000
603700     MOVE PC-EXTR-PRC-ID TO RPLCTL-EXTR-PRC-ID.                   62350000
603800*    DISPLAY 'UPDATEING TRPLCTL WITH BEGIN AND END TIMESTAMPS...'.62360006
603900*    DISPLAY '    BEGIN TMST = ' RPLCTL-EXTR-BEG-TMST.            62370006
604000*    DISPLAY '      END TMST = ' RPLCTL-EXTR-END-TMST.            62380006
604100     EXEC SQL                                                     62390000
604200        UPDATE TRPLCTL                                            62400000
604300           SET EXTR_BEG_TMST = :RPLCTL-EXTR-BEG-TMST              62410000
604400              ,EXTR_END_TMST = :RPLCTL-EXTR-END-TMST              62420000
604500         WHERE                                                    62430000
604600                APPL_ID     = :RPLCTL-APPL-ID                     62440000
604700            AND EXTR_PRC_ID = :RPLCTL-EXTR-PRC-ID                 62450000
604800            AND LOG_TBL_NME = :RPLCTL-LOG-TBL-NME                 62460000
604900     END-EXEC.                                                    62470000
605000                                                                  62480000
605100     EVALUATE TRUE                                                62490000
605200       WHEN SQLCODE = ZEROS                                       62500000
0822RM         ADD 1 TO PV-INS-UPD-COUNT                                62510022
0822RM*        CONTINUE                                                 62520020
605400       WHEN OTHER                                                 62530000
605500         DISPLAY PV-ABEND-PARAGRAPH                               62540000
605600         PERFORM Z999-SQL-ERROR                                   62550000
605700     END-EVALUATE.                                                62560000
605800****************************************************************  62570000
605900*                                                              *  62580000
606000*                                                              *  62590000
606100****************************************************************  62600000
606200                                                                  62610000
606300 X100-REPLACE-SPEC-CHARS.                                         62620000
606400                                                                  62630000
606500*    DISPLAY 'X100-REPLACE-SPEC-CHARS'.                           62640006
606600*    DISPLAY 'ITEM_CLUSTR_DESC'                                   62650006
606700*    DISPLAY ITMCLT-ITEM-CLUSTR-DESC                              62660006
606800                                                                  62670000
606900     INSPECT ITMCLT-ITEM-CLUSTR-DESC                              62680000
607000     REPLACING ALL PC-Q     BY SPACE.                             62690000
607100                                                                  62700000
607200     INSPECT ITMCLT-ITEM-CLUSTR-DESC                              62710000
607300     REPLACING ALL PC-QUESTION BY SPACE.                          62720000
607400                                                                  62730000
607500     INSPECT ITMCLT-ITEM-CLUSTR-DESC                              62740000
607600     REPLACING ALL PC-DQ     BY SPACE.                            62750000
607700                                                                  62760000
607800     INSPECT ITMCLT-ITEM-CLUSTR-DESC                              62770000
607900     REPLACING ALL PC-UNDERSCORE BY SPACE.                        62780000
608000                                                                  62790000
608100     INSPECT ITMCLT-ITEM-CLUSTR-DESC                              62800000
608200     REPLACING ALL PC-ASTERISK   BY SPACE.                        62810000
608300                                                                  62820000
608400*    INSPECT ITMCLT-ITEM-CLUSTR-NAME                              62830000
608500*    REPLACING ALL PC-Q     BY SPACE.                             62840000
608600*                                                                 62850000
608700*    INSPECT ITMCLT-ITEM-CLUSTR-NAME                              62860000
608800*    REPLACING ALL PC-QUESTION BY SPACE.                          62870000
608900*                                                                 62880000
609000*    INSPECT ITMCLT-ITEM-CLUSTR-NAME                              62890000
609100*    REPLACING ALL PC-DQ     BY SPACE.                            62900000
609200*                                                                 62910000
609300*    INSPECT ITMCLT-ITEM-CLUSTR-NAME                              62920000
609400*    REPLACING ALL PC-UNDERSCORE BY SPACE.                        62930000
609500*                                                                 62940000
609600*    INSPECT ITMCLT-ITEM-CLUSTR-NAME                              62950000
609700*    REPLACING ALL PC-ASTERISK   BY SPACE.                        62960000
609800****************************************************************  62970000
609900*                                                              *  62980000
610000*                                                              *  62990000
610100****************************************************************  63000000
610200                                                                  63010000
610300********************************************                      63020000
610400* THIS PROCEDURE GETS THE RMS SKU                                 63030000
610500* FROM TSKXREF BASED ON THE DEPT NUMBER,                          63040000
610600* CLASS NUMBER, AND THE SKU SEQUENCE NUMBER.                      63050000
610700********************************************                      63060000
610800*X500-GET-RMS-SKU.                                                63070000
610900                                                                  63080000
611000*    IF SQLCODE = ZEROES                                          63090000
611100                                                                  63100000
611200*        MOVE ITMCLT-ITEM-CLUSTR-NAME TO                          63110000
611300*             PV-XREF-CRITERIA.                                   63120000
611400*        MOVE PV-XREF-DEPT TO SKXREF-DEPT-NBR.                    63130000
611500*        MOVE PV-XREF-CLASS TO SKXREF-CL-NBR.                     63140000
611600*        MOVE PV-XREF-SEQ TO SKXREF-SKU-SEQ-NBR.                  63150000
611700                                                                  63160000
611800*        EXEC SQL                                                 63170000
611900*              SELECT                                             63180000
612000*                 SKU                                             63190000
612100*              INTO                                               63200000
612200*                 :SKXREF-SKU                                     63210000
612300*              FROM                                               63220000
612400*                 TSKXREF                                         63230000
612500*              WHERE  DEPT_NBR = :SKXREF-DEPT-NBR                 63240000
612600*              AND CL_NBR   = :SKXREF-CL-NBR                      63250000
612700*              AND SKU_SEQ_NBR = :SKXREF-SKU-SEQ-NBR              63260000
612800*              AND SKU_STAT_CDE <> '00'                           63270000
612900*         END-EXEC.                                               63280000
613000                                                                  63290000
613100*         EVALUATE TRUE                                           63300000
613200*           WHEN SQLCODE = +1403                                  63310000
613300*             DISPLAY '******** XREF TABLE ERROR ********'        63320000
613400*             DISPLAY '*** DEPT NBR: ' SKXREF-DEPT-NBR            63330000
613500*             DISPLAY '*** CLASS NBR: ' SKXREF-CL-NBR             63340000
613600*             DISPLAY '*** SKU SEQ: ' SKXREF-SKU-SEQ-NBR          63350000
613700*             DISPLAY '*** NOT PART OF THE XREF TABLE ***'        63360000
613800*         END-EVALUATE.                                           63370000
613900                                                                  63380000
614000 Z999-SQL-ERROR.                                                  63390000
614100*---------------                                                  63400000
614200                                                                  63410000
614300     MOVE SQLCODE    TO SQLCODE2.                                 63420000
614400     MOVE SQLERRD(3) TO SQLERRD3.                                 63430000
0922RM     DISPLAY '** NBR OF RECORDS READ ' WS-DAILY-RECS-READ.        63431049
614500     DISPLAY '** ABEND **       ** = SQLERROR'.                   63440000
614600     DISPLAY '** PROGRAM        ** = MAKUT102'.                   63450000
614700     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  63460000
614800     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  63470000
614900     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   63480000
615000     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  63490000
615100     DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                63500000
615200                                                                  63510000
615300     MOVE SPACES TO WS-MSG-TEXT.                                  63520000
615400*    GET FULL TEXT OF ERROR MESSAGE                               63530000
615500                                                                  63540000
615600     CALL 'SQLGLM' USING WS-MSG-TEXT,                             63550000
615700                         WS-MAX-SIZE,                             63560000
615800                         WS-MSG-LENGTH.                           63570000
615900     DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               63580000
616000                                                                  63590000
0822RM     DISPLAY 'FS500I-MAINT-LOG-REC '                              63600022
0822RM              FS500I-MAINTENANCE-LOG-RECORD.                      63610022
0822RM     DISPLAY 'SD-SKU-DELETE-BKUP-RECORD '                         63620022
0822RM              SD-SKU-DELETE-BKUP-RECORD.                          63630022
0822RM     DISPLAY 'MA025-RECORD ' MA025-RECORD.                        63640022
                                                                        63650022
616100     EXEC SQL                                                     63660000
616200      ROLLBACK WORK RELEASE                                       63670000
616300     END-EXEC.                                                    63680000
616400                                                                  63690000
616500** A SQLCODE OF -2068 IS AN ORACLE DATABASE DISCONNECT ERROR      63700000
616600     IF SQLCODE = PC-ORACLE-DISCONNECT                            63710000
616700         MOVE +4016 TO PV-ABEND-CODE                              63720000
616800     ELSE                                                         63730000
616900         MOVE +4013 TO PV-ABEND-CODE.                             63740000
617000                                                                  63750000
617100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         63760000
617200*                                                                 63770000
617300******************************************************************63780000
