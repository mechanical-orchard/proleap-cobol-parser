000100*----------------------------------------------------------       00000100
000200 IDENTIFICATION DIVISION.                                         00000200
000300*----------------------------------------------------------       00000300
000400 PROGRAM-ID.    XSKRP023.                                         00000400
000500 AUTHOR.        JOSEPH MENYAH.                                    00000500
000600 DATE-WRITTEN.  OCTOBER , 2002.                                   00000600
000700                                                                  00000700
000800*----------------------------------------------------------       00000800
000900*            BUSINESS AD EVENT INTEGRITY CHECK                    00000900
001000*----------------------------------------------------------       00001000
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00002000
001020* EXTRACT FOR THE ADEVENT BUSINESS EVENT.                         00003000
001124*                                                                 00004000
001125*----------------------------------------------------------       00005000
001126* HISTORY LOG:                                                    00006000
001127*                                                                 00007000
001128*----------------------------------------------------------       00008000
001129* DATE:                                                           00009000
001130* WR/IR#:                                                         00010000
001131* PROGRAMMER:                                                     00020000
001140* DESCRIPTION:                                                    00030000
001150*                                                                 00040000
001160*----------------------------------------------------------       00050000
001170 ENVIRONMENT DIVISION.                                            00060000
001180*----------------------------------------------------------       00070000
001190 CONFIGURATION SECTION.                                           00080000
001200 SOURCE-COMPUTER. IBM-3090.                                       00090000
001300 OBJECT-COMPUTER. IBM-3090.                                       00100000
001400                                                                  00110000
001500 INPUT-OUTPUT SECTION.                                            00120000
001600                                                                  00130000
001700 FILE-CONTROL.                                                    00140000
004900     SELECT CONTROL-CARD                                          00150000
005000         ASSIGN TO INP00.                                         00151000
                                                                        00152000
004900     SELECT PROMO-EXTRACT-FILE                                    00153000
005000         ASSIGN TO INP01.                                         00154000
                                                                        00155000
004900     SELECT DOMAIN-EXTRACT-FILE                                   00156000
005000         ASSIGN TO INP02.                                         00157000
                                                                        00158000
                                                                        00159000
004900     SELECT ERROR-FILE                                            00160000
005000         ASSIGN TO OUT01.                                         00170000
                                                                        00180000
004900     SELECT REPORT-FILE                                           00190000
005000         ASSIGN TO RPT01.                                         00200000
                                                                        00201000
001900*----------------------------------------------------------       00202000
002000 DATA DIVISION.                                                   00203000
002100*----------------------------------------------------------       00204000
002200 FILE SECTION.                                                    00205000
002300                                                                  00206000
008000 FD  PROMO-EXTRACT-FILE                                           00207000
008100     RECORDING MODE IS F                                          00208000
008200     LABEL RECORDS ARE OMITTED                                    00209000
008300     RECORD CONTAINS 174 CHARACTERS                               00210000
008400     DATA RECORD IS AD-EVNT-RECORD.                               00220000
008500 01  PROMO-AD-EVNT-REC              PIC X(174).                   00230000
008600                                                                  00240000
008000 FD  DOMAIN-EXTRACT-FILE                                          00250000
008100     RECORDING MODE IS F                                          00260000
008200     LABEL RECORDS ARE OMITTED                                    00270000
008300     RECORD CONTAINS 174 CHARACTERS                               00280000
008400     DATA RECORD IS AD-EVNT-RECORD.                               00290000
008500 01  DOMAIN-AD-EVNT-REC              PIC X(174).                  00300000
006500                                                                  00310000
       FD  CONTROL-CARD                                                 00320000
           RECORDING MODE F                                             00330000
           BLOCK CONTAINS 0 RECORDS                                     00340000
           LABEL RECORDS ARE OMITTED                                    00350000
           DATA RECORD IS CONTROL-CARD-RECORD.                          00360000
       01  CONTROL-CARD-RECORD             PIC X(080).                  00370000
                                                                        00380000
       FD  REPORT-FILE                                                  00390000
           RECORDING MODE F                                             00400000
           BLOCK CONTAINS 0 RECORDS                                     00401000
           LABEL RECORDS ARE OMITTED                                    00402000
009600     RECORD CONTAINS 132 CHARACTERS                               00403000
           DATA RECORD IS REPORT-RECORD.                                00404000
       01  REPORT-RECORD                   PIC X(132).                  00405000
                                                                        00406000
       FD  ERROR-FILE                                                   00407000
           RECORDING MODE F                                             00408000
           BLOCK CONTAINS 0 RECORDS                                     00409000
           LABEL RECORDS ARE OMITTED                                    00410000
           DATA RECORD IS DIFFERENCES-RECORD.                           00410100
       01  DIFFERENCES-RECORD              PIC X(174).                  00410200
                                                                        00410300
002500*---------------------------------------------------------        00410400
002600                                                                  00410500
002700 WORKING-STORAGE SECTION.                                         00410600
002800*---------------------------------------------------------        00410700
003500* PC- PROGRAM CONSTANTS                                           00410800
003600*----------------------------------------------------------       00410900
003700 01  PC-PROGRAM-CONSTANTS.                                        00411000
003800     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKRP023'. 00412000
003900     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00413000
004000                                                                  00414000
097700 01  CD-CPU-DATE.                                                 00415000
097800     03  CD-CPU-YEAR             PIC 99.                          00416000
097900     03  CD-CPU-MONTH            PIC 99.                          00417000
098000     03  CD-CPU-DAY              PIC 99.                          00418000
098100                                                                  00419000
098200 01  CD-CPU-DATE-CC.                                              00420000
098300     03  CD-CPU-CENT             PIC 99.                          00430000
098400     03  CD-CPU-YYMMDD           PIC 9(6).                        00440000
                                                                        00450000
084800 01  PC-REPORT-NO                PIC  9(5)          VALUE 00001.  00460000
                                                                        00470000
011200 01  CT-CPU-TIME.                                                 00480000
011300     03  CT-HOUR                 PIC 99.                          00490000
011400     03  CT-MINUTE               PIC 99.                          00500000
011500     03  FILLER                  PIC 9(4).                        00501000
      *----------------------------------------------------------       00501100
      **PROGRAM                                                         00501200
      *----------------------------------------------------------       00501300
       01  PC-PROGRAM-COUNTER.                                          00501400
           05  PC-RECORD-COUNT                 PIC S9(09) VALUE ZEROS   00501500
                                                          COMP-3.       00501600
           05  PC-PROMO-EXTRACT-RECS-READ      PIC 9(09) VALUE ZEROS.   00501700
           05  PC-DOMAIN-EXTRACT-RECS-READ     PIC 9(09) VALUE ZEROS.   00501800
           05  PC-ERROR-RECORD-WRITTEN         PIC 9(09) VALUE ZEROS.   00501900
           05  PC-ERROR-REPORT-WRITTEN         PIC 9(09) VALUE ZEROS.   00502000
           05  PC-PAGE-CNT                     PIC 9(09) VALUE ZEROS.   00503000
004100*----------------------------------------------------------       00504000
004200* PS- PROGRAM SWITCHES                                            00505000
004300*----------------------------------------------------------       00506000
004400 01  PS-PROGRAM-SWITCHES.                                         00507000
004500     05  PS-EOF-PROMO-EXTRACT-SW          PIC X(01)  VALUE SPACE. 00508000
004600         88  PS-EOF-PROMO                        VALUE 'Y'.       00509000
004600         88  PS-NOT-EOF-PROMO                    VALUE 'N'.       00510000
004800                                                                  00520000
004500     05  PS-EOF-DOMAIN-EXTRACT-SW         PIC X(01)  VALUE SPACE. 00530000
004600         88  PS-EOF-DOMAIN                       VALUE 'Y'.       00540000
004600         88  PS-NOT-EOF-DOMAIN                   VALUE 'N'.       00550000
004800                                                                  00560000
004500     05  PS-NEW-RECORD-SW                 PIC X(01)  VALUE SPACE. 00570000
004600         88  PS-NEW-RECORD                       VALUE 'Y'.       00580000
004600         88  PS-NOT-NEW-RECORD                   VALUE 'N'.       00580100
004800                                                                  00580200
004900*----------------------------------------------------------       00580300
      *    CONTROL-CARD-LAYOUT.                                         00580400
004900*----------------------------------------------------------       00580500
       01  CONTROL-CARD-LAYOUT.                                         00580600
           05  CC-START-POINT                  PIC 9(05) VALUE ZEROS.   00580700
           05  FILLER                          PIC X(01) VALUE SPACES.  00580800
           05  CC-READ-FREQUENCY               PIC 9(05) VALUE ZEROS.   00580900
           05  FILLER                          PIC X(69) VALUE SPACES.  00581000
004900*----------------------------------------------------------       00582000
005000* PV- PROGRAM VARIABLES                                           00583000
005100*----------------------------------------------------------       00584000
005200 01 PV-PROGRAM-VARIABLES.                                         00585000
013800    05  ABEND-CODE              PIC S9(4)  VALUE ZEROS COMP SYNC. 00586000
005500    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   00587000
005600    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         00588000
005710    05  PV-AD-EVNT-ID-HOLD            PIC 9(10) VALUE 0.          00589000
005800    05  PV-ACTION-CODE                PIC X(01).                  00590000
005810        88  PV-INSERT-DATA                       VALUE 'I'.       00600000
005820        88  PV-UPDATE-DATA                       VALUE 'U'.       00610000
                                                                        00620000
006000    05  PV-RECORD-COUNT               PIC 9(05) VALUE ZEROS.      00630000
006000    05  PV-LD-STATUS-CDE              PIC X(02).                  00640000
006100        88  PV-NO-ERROR                          VALUE '00'.      00650000
006200        88  PV-CRITICAL-ERROR                    VALUE '01'.      00660000
006300        88  PV-NOT-CRITICAL-ERROR                VALUE '02'.      00670000
007000                                                                  00680000
           05  PS-ERROR-FOUND-SW               PIC X(01) VALUE 'N'.     00690000
               88  PS-ERROR-FOUND                        VALUE 'Y'.     00700000
               88  PS-ERROR-NOT-FOUND                    VALUE 'N'.     00710000
                                                                        00720000
007100    05  PV-STRT-PARM.                                             00730000
007200        10  PV-STRT-DTE-CC            PIC X(02).                  00740000
007200        10  PV-STRT-DTE-YY            PIC X(02).                  00750000
007400        10  PV-STRT-DTE-MM            PIC X(02).                  00760000
007600        10  PV-STRT-DTE-DD            PIC X(02).                  00770000
007400        10  FILLER                    PIC X.                      00780000
007400        10  PV-DECREMENT              PIC X(02).                  00790000
007400        10  FILLER                    PIC X(69).                  00800000
007700                                                                  00810000
007100    05  PV-PROMO-STRT-DTE           PIC X(10).                    00820000
007100    05  PV-PROMO-END-DTE            PIC X(10).                    00830000
                                                                        00840000
008600    05  PV-AD-EVNT-END-DTE-TM.                                    00850000
008700        10  PV-AD-EVNT-END-DTE.                                   00860000
008800            15  PV-AD-EVNT-DTE-TM2-CCYY   PIC X(04).              00870000
008900            15  FILLER                    PIC X(01).              00880000
009000            15  PV-AD-EVNT-DTE-TM2-MM     PIC X(02).              00890000
009100            15  FILLER                    PIC X(01).              00900000
009200            15  PV-AD-EVNT-DTE-TM2-DD     PIC X(02).              00910000
009300        10  PV-AD-EVNT-END-TM             PIC X(16).              00920000
009400                                                                  00930000
008600    05  PV-PROMO-SOURCE              PIC X(40) VALUE              00940000
              'DATA SOURCE IS THE PROMO DATABASE'.                      00950000
                                                                        00960000
008600    05  PV-PROMO-NF                  PIC X(40) VALUE              00970000
              'RECORD NOT FOUND IN XS DOMAIN'.                          00980000
                                                                        00980100
008600    05  PV-DOMAIN-SOURCE             PIC X(40) VALUE              00980200
              'DATA SOURCE IS THE XS DOMAIN DATABASE'.                  00980300
                                                                        00980400
008600    05  PV-DOMAIN-NF                  PIC X(40) VALUE             00980500
              'RECORD NOT FOUND IN PROMO TABLES'.                       00980600
                                                                        00980700
008600    05  PV-PROMO-KEY.                                             00980800
008700        10  PV-PM-AD-EVNT-ID              PIC 9(10).              00980900
                                                                        00981000
008600    05  PV-DOMAIN-KEY.                                            00981100
008700        10  PV-XS-AD-EVNT-ID              PIC 9(10).              00981200
                                                                        00981300
004900*----------------------------------------------------------       00981400
005000* PROMO ADEVENT COPY BOOK                                         00981500
005100*----------------------------------------------------------       00981600
           COPY PMRD701.                                                00981700
                                                                        00981800
000700 01  ERROR-RECORD.                                                00981900
000800   05 ERROR-BUSINESS-EVNT-ID         PIC 9(03) VALUE ZERO.        00982000
000900   05 ERROR-ACTION-CDE               PIC X(01) VALUE SPACES.      00983000
001000   05 ERROR-BUSINESS-EVNT-CRE-TMST   PIC X(26) VALUE SPACES.      00984000
001100   05 ERROR-AD-EVNT-ID               PIC 9(10) VALUE ZERO.        00985000
001200   05 ERROR-AD-EVNT-NBR-TXT          PIC X(15) VALUE SPACES.      00986000
001300   05 ERROR-CPLT-NM                  PIC X(40) VALUE SPACES.      00987000
001400   05 ERROR-STRT-DTE                 PIC X(26) VALUE SPACES.      00988000
001500   05 ERROR-END-DTE                  PIC X(26) VALUE SPACES.      00989000
001600   05 ERROR-STAT-CDE                 PIC X(01) VALUE SPACES.      00990000
001700   05 ERROR-LAST-UPD-TMST            PIC X(26) VALUE SPACES.      00990100
                                                                        00990200
042800     COPY DPWS132O.                                               00990400
042900                                                                  00990500
                                                                        00990600
043100 01  DR-HEAD2.                                                    00990700
043200     05  FILLER                 PIC X(41)    VALUE SPACES.        00990800
043300     05  DR-TITLE               PIC X(50)    VALUE                00990900
043400      'INTEGRITY CHECK PROGRAM  - AD EVENT BUSINESS EVENT'.       00991000
                                                                        00992000
043500                                                                  00993000
043100 01  DR-HEAD3.                                                    00993100
043200     05  FILLER                 PIC X(03)    VALUE                00993200
            'KEY'.                                                      00993300
043200     05  FILLER                 PIC X(15)    VALUE SPACES.        00993400
043200     05  FILLER                 PIC X(10)    VALUE                00993500
            'FIELD NAME'.                                               00993600
043200     05  FILLER                 PIC X(14)    VALUE SPACES.        00993700
043200     05  FILLER                 PIC X(05)    VALUE                00993800
            'VALUE'.                                                    00993900
043200     05  FILLER                 PIC X(31)    VALUE SPACES.        00994000
043200     05  FILLER                 PIC X(16)    VALUE                00994100
            'SOURCE / MESSAGE'.                                         00994200
043200     05  FILLER                 PIC X(35)    VALUE SPACES.        00994300
043500                                                                  00994400
043100 01  DR-HEAD5.                                                    00994500
043200     05  FILLER                 PIC X(132)   VALUE ALL '='.       00994600
000700 01  REPORT-DETAIL.                                               00994700
000800   05 PROMO-RPT-INFO.                                             00994800
000800      10 PROMO-EVNT-KEY              PIC 9(10) VALUE ZERO.        00994900
 00800      10 FILLER                      PIC X(5).                    00995000
 00800      10 PROMO-RPT-DATA-NAME         PIC X(20).                   00996000
 00800      10 FILLER                      PIC X(2).                    00996100
 00800      10 PROMO-RPT-DATA-VALUE        PIC X(40).                   00996200
000800   05 REPORT-NOTES                   PIC X(40).                   00996300
010900*----------------------------------------------------------       00996400
011000* AD EVENT BUSINESS EVENT RECORD LAYOUT                           00996500
011100*----------------------------------------------------------       00996600
011200     COPY XSRD015.                                                00996700
011800                                                                  00996800
011800                                                                  00996900
030310                                                                  00997000
031400*----------------------------------------------------------       00998000
031500 PROCEDURE DIVISION.                                              00999000
032100*----------------------------------------------------------       01000000
032200 0000-MAINLINE.                                                   01010000
128200     ACCEPT CD-CPU-DATE FROM DATE.                                01020000
128300     IF CD-CPU-YEAR > 80                                          01030000
128400         MOVE 19 TO CD-CPU-CENT                                   01040000
128500     ELSE                                                         01050000
128600         MOVE 20 TO CD-CPU-CENT.                                  01060000
128700     MOVE CD-CPU-DATE TO CD-CPU-YYMMDD.                           01070000
128800                                                                  01080000
128900     ACCEPT CT-CPU-TIME FROM TIME.                                01090000
032300                                                                  01100000
032400     PERFORM 1000-INITIALIZATION.                                 01110000
032500                                                                  01120000
032600     PERFORM 2000-PROCESS-EXTRACT-DATA                            01130000
032700             UNTIL PS-EOF-DOMAIN                                  01140000
032700                OR PS-EOF-PROMO.                                  01150000
                                                                        01160000
           PERFORM 3000-PROCESS-EXTRA-RECORDS                           01170000
032700             UNTIL PS-EOF-DOMAIN                                  01180000
032700               AND PS-EOF-PROMO.                                  01190000
035000                                                                  01200000
035100     PERFORM 9999-WRAPUP.                                         01210000
035200                                                                  01220000
035500     GOBACK.                                                      01230000
035700                                                                  01240000
035701*0000-EXIT.                                                       01250000
035702 EJECT.                                                           01260000
035703                                                                  01270000
035800*----------------------------------------------------------       01280000
035900* 1000-INITIALIZATION.                                            01290000
036000*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            01300000
036100*     UPDATE OR INSERT A RECORD.                                  01310000
036200*----------------------------------------------------------       01320000
036300 1000-INITIALIZATION.                                             01330000
                                                                        01340000
132408     MOVE CD-CPU-YEAR  TO DP132O-RUN-YEAR.                        01350000
132409     MOVE CD-CPU-MONTH TO DP132O-RUN-MONTH.                       01360000
132410     MOVE CD-CPU-DAY   TO DP132O-RUN-DAY.                         01370000
132420     MOVE CT-HOUR    TO DP132O-RUN-HOUR.                          01380000
132430     MOVE CT-MINUTE  TO DP132O-RUN-MINUTE.                        01390000
132440     MOVE 'XSKRP023' TO DP132O-PROGRAM-NAME.                      01400000
132450     MOVE 1          TO DP132O-REPORT-NUMBER.                     01410000
           SET PS-NOT-EOF-PROMO TO TRUE.                                01420000
           SET PS-NOT-EOF-DOMAIN TO TRUE.                               01430000
026600     OPEN INPUT  PROMO-EXTRACT-FILE                               01440000
026600                 DOMAIN-EXTRACT-FILE                              01450000
026600                 CONTROL-CARD                                     01460000
026600          OUTPUT ERROR-FILE                                       01470000
026600                 REPORT-FILE.                                     01480000
                                                                        01490000
           PERFORM 9999-PRINT-HEADINGS.                                 01500000
           PERFORM 9999-READ-CONTROL-CARD.                              01510000
           PERFORM 9999-READ-PROMO-EXTRACT.                             01520000
           PERFORM 9999-READ-DOMAIN-EXTRACT.                            01530000
                                                                        01540000
           IF XS015-AD-EVNT-ID NOT EQUAL TO PM701-AD-EVNT-ID            01550000
             MOVE 1 TO CC-START-POINT                                   01560000
             MOVE 1 TO CC-READ-FREQUENCY                                01570000
           END-IF.                                                      01580000
                                                                        01590000
           PERFORM 9999-READ-PROMO-EXTRACT CC-START-POINT TIMES.        01600000
           PERFORM 9999-READ-DOMAIN-EXTRACT  CC-START-POINT TIMES.      01610000
                                                                        01620000
056500                                                                  01630000
037240*1100-EXIT.                                                       01640000
037250 EJECT.                                                           01650000
037251                                                                  01660000
037260*----------------------------------------------------------       01670000
037300* 2000-PROCESS-EXTRACT-DATA.                                      01680000
037400*     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            01690000
037500*     SHOULD BE INSERTED INTO THE AD EVENT TABLE OR UPDATED.      01700000
037600*     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          01710000
037700*     PROCESS AN ERROR AND EXIT THE PROGRAM.                      01720000
037800*----------------------------------------------------------       01730000
037900 2000-PROCESS-EXTRACT-DATA.                                       01740000
           IF PM701-AD-EVNT-ID = XS015-AD-EVNT-ID                       01750000
                PERFORM 2100-COMPARE-FIELDS                             01760000
                PERFORM 9999-READ-DOMAIN-EXTRACT                        01770000
                        CC-READ-FREQUENCY TIMES                         01780000
                PERFORM 9999-READ-PROMO-EXTRACT                         01790000
                        CC-READ-FREQUENCY TIMES                         01800000
           ELSE                                                         01810000
              IF PM701-AD-EVNT-ID > XS015-AD-EVNT-ID                    01820000
                 MOVE PV-DOMAIN-NF    TO REPORT-NOTES                   01830000
                 MOVE PV-DOMAIN-KEY  TO PROMO-EVNT-KEY                  01840000
                 PERFORM 9999-WRITE-ERROR-REPORT                        01850000
                 MOVE PM701-ADEVENT-RECORD TO ERROR-RECORD              01860000
                 PERFORM 9999-WRITE-ERROR-RECORD                        01870000
                 PERFORM 9999-READ-DOMAIN-EXTRACT                       01880000
              ELSE                                                      01890000
                 MOVE PV-PROMO-NF TO REPORT-NOTES                       01900000
                 MOVE PV-PROMO-KEY TO PROMO-EVNT-KEY                    01910000
                 PERFORM 9999-WRITE-ERROR-REPORT                        01920000
                 MOVE XS015-ADEVENT-RECORD TO ERROR-RECORD              01930000
                 PERFORM 9999-WRITE-ERROR-RECORD                        01940000
                 PERFORM 9999-READ-PROMO-EXTRACT                        01941000
              END-IF                                                    01941100
           END-IF.                                                      01941200
038000                                                                  01941300
038110*2000-EXIT.                                                       01941400
038200 EJECT.                                                           01941500
                                                                        01941600
038300*------------------------------------------------------           01941700
038400* 2100-COMPARE-FIELDS.                                            01941800
038500*     COMPARES THE EXTRACT FILES AND NOTES ANY DIFFERENCES        01941900
038600*------------------------------------------------------           01942000
038210                                                                  01943000
054400 2100-COMPARE-FIELDS.                                             01944000
036600     IF PM701-BUSINESS-EVNT-ID NOT EQUAL XS015-BUSINESS-EVNT-ID   01945000
              MOVE 'PM701-BUSINESS-EVNT-ID' TO PROMO-RPT-DATA-NAME      01946000
              MOVE PM701-BUSINESS-EVNT-ID   TO PROMO-RPT-DATA-VALUE     01947000
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             01948000
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           01949000
              PERFORM 9999-WRITE-ERROR-REPORT                           01950000
              MOVE 'XS015-BUSINESS-EVNT-ID' TO PROMO-RPT-DATA-NAME      01960000
              MOVE XS015-BUSINESS-EVNT-ID   TO PROMO-RPT-DATA-VALUE     01970000
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             01980000
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           01990000
              PERFORM 9999-WRITE-ERROR-REPORT                           02000000
              SET PS-ERROR-FOUND     TO TRUE                            02010000
           END-IF.                                                      02020000
                                                                        02030000
036700     IF PM701-AD-EVNT-NBR-TXT NOT EQUAL TO XS015-AD-EVNT-NBR-TXT  02040000
              MOVE PM701-AD-EVNT-NBR-TXT   TO PROMO-RPT-DATA-VALUE      02050000
              MOVE 'PROMO-AD-EVNT-NBR-TXT' TO PROMO-RPT-DATA-NAME       02060000
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02070000
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02080000
              PERFORM 9999-WRITE-ERROR-REPORT                           02090000
              MOVE 'XS015-AD-EVNT-NBR-TXT' TO PROMO-RPT-DATA-NAME       02100000
              MOVE XS015-AD-EVNT-NBR-TXT   TO PROMO-RPT-DATA-VALUE      02110000
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02120000
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02130000
              PERFORM 9999-WRITE-ERROR-REPORT                           02140000
              SET PS-ERROR-FOUND     TO TRUE                            02150000
           END-IF.                                                      02160000
                                                                        02170000
036800     IF PM701-CPLT-NM NOT EQUAL TO XS015-CPLT-NM                  02180000
              MOVE PM701-CPLT-NM           TO PROMO-RPT-DATA-VALUE      02190000
              MOVE 'PROMO-CPLT-NM'             TO PROMO-RPT-DATA-NAME   02200000
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02210000
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02220000
              PERFORM 9999-WRITE-ERROR-REPORT                           02230000
              MOVE 'XS015-CPLT-NM'             TO PROMO-RPT-DATA-NAME   02240000
              MOVE XS015-CPLT-NM           TO PROMO-RPT-DATA-VALUE      02250000
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02260000
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02270000
              PERFORM 9999-WRITE-ERROR-REPORT                           02280000
              DISPLAY 'CPLT-NM OUT OF SYNCH'                            02290000
              SET PS-ERROR-FOUND     TO TRUE                            02300000
           END-IF.                                                      02310000
                                                                        02320000
036900     MOVE  PM701-STRT-DTE           TO PV-PROMO-STRT-DTE          02330000
036900     IF PV-PROMO-STRT-DTE NOT EQUAL TO XS015-STRT-DTE             02340000
              MOVE 'PROMO-STRT-DTE'            TO PROMO-RPT-DATA-NAME   02350000
              MOVE PM701-STRT-DTE          TO PROMO-RPT-DATA-VALUE      02360000
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02370000
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02380000
              PERFORM 9999-WRITE-ERROR-REPORT                           02390000
              MOVE 'XS015-STRT-DTE'        TO PROMO-RPT-DATA-NAME       02400000
              MOVE XS015-STRT-DTE          TO PROMO-RPT-DATA-VALUE      02410000
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02420000
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02430000
              PERFORM 9999-WRITE-ERROR-REPORT                           02440000
              DISPLAY 'START DATE OUT OF SYNC'                          02450000
              SET PS-ERROR-FOUND     TO TRUE                            02460000
           END-IF.                                                      02470000
                                                                        02480000
036900     MOVE  PM701-END-DTE           TO PV-PROMO-END-DTE            02490000
037000     IF PV-PROMO-END-DTE NOT EQUAL TO XS015-END-DTE               02500000
              MOVE 'PROMO-END-DTE'            TO PROMO-RPT-DATA-NAME    02510000
              MOVE PM701-END-DTE          TO PROMO-RPT-DATA-VALUE       02520000
              MOVE PV-PROMO-SOURCE         TO REPORT-NOTES              02530000
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02540000
              PERFORM 9999-WRITE-ERROR-REPORT                           02550000
              MOVE 'XS015-END-DTE'        TO PROMO-RPT-DATA-NAME        02560000
              MOVE XS015-END-DTE          TO PROMO-RPT-DATA-VALUE       02561000
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02562000
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02563000
              PERFORM 9999-WRITE-ERROR-REPORT                           02564000
              DISPLAY 'END DATE OUT OF SYNC'                            02565000
              SET PS-ERROR-FOUND     TO TRUE                            02566000
           END-IF.                                                      02567000
                                                                        02568000
037100     IF PM701-STAT-CDE NOT EQUAL TO XS015-STAT-CDE                02569000
              MOVE 'PROMO-STAT-CDE'           TO PROMO-RPT-DATA-NAME    02569100
              MOVE PM701-STAT-CDE         TO PROMO-RPT-DATA-VALUE       02569200
              MOVE PV-PROMO-SOURCE         TO REPORT-NOTES              02569300
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02569400
              PERFORM 9999-WRITE-ERROR-REPORT                           02569500
              MOVE 'XS015-STAT-CDE'       TO PROMO-RPT-DATA-NAME        02569600
              MOVE XS015-STAT-CDE         TO PROMO-RPT-DATA-VALUE       02569700
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02569800
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02569900
              PERFORM 9999-WRITE-ERROR-REPORT                           02570000
              DISPLAY 'STAT CODE OUT OF SYNC'                           02570100
              SET PS-ERROR-FOUND     TO TRUE                            02570200
           END-IF.                                                      02570300
           IF  PS-ERROR-FOUND                                           02570400
037200        IF PM701-LAST-UPD-TMST > XS015-LAST-UPD-TMST              02570500
                 PERFORM 9999-FORMAT-ERROR-RECORD                       02570600
                 PERFORM 9999-WRITE-ERROR-RECORD                        02570700
              END-IF                                                    02570800
              SET PS-ERROR-NOT-FOUND     TO TRUE                        02570900
           END-IF.                                                      02571000
054500                                                                  02572000
056900 2100-EXIT.                                                       02573000
057000     EXIT.                                                        02574000
043600 EJECT.                                                           02575000
043610                                                                  02576000
                                                                        02577000
      ******************************************************************02578000
      **COMPARES FIELDS BETWEEN FILES TO SEE IF ANY DIFFERENCES EXIST   02579000
      ******************************************************************02580000
       3000-PROCESS-EXTRA-RECORDS.                                      02590000
                                                                        02600000
           IF  PS-NOT-EOF-PROMO                                         02610000
               INITIALIZE REPORT-DETAIL                                 02620000
               MOVE PV-PROMO-NF             TO REPORT-NOTES             02630000
               MOVE PM701-AD-EVNT-ID         TO PROMO-EVNT-KEY          02640000
               PERFORM 9999-WRITE-ERROR-REPORT                          02650000
               MOVE PM701-ADEVENT-RECORD TO ERROR-RECORD                02660000
               PERFORM 9999-WRITE-ERROR-RECORD                          02670000
               PERFORM 9999-READ-PROMO-EXTRACT                          02680000
           END-IF.                                                      02690000
                                                                        02700000
           IF  PS-NOT-EOF-DOMAIN                                        02710000
               INITIALIZE REPORT-DETAIL                                 02720000
               MOVE PV-DOMAIN-NF             TO REPORT-NOTES            02730000
               MOVE XS015-AD-EVNT-ID         TO PROMO-EVNT-KEY          02740000
               PERFORM 9999-WRITE-ERROR-REPORT                          02750000
               MOVE XS015-ADEVENT-RECORD TO ERROR-RECORD                02760000
               PERFORM 9999-WRITE-ERROR-RECORD                          02770000
               PERFORM 9999-READ-DOMAIN-EXTRACT                         02780000
           END-IF.                                                      02790000
                                                                        02800000
056900 3000-EXIT.                                                       02810000
057000     EXIT.                                                        02820000
                                                                        02830000
       EJECT.                                                           02840000
059800*----------------------------------------------------------       02850000
059900* 9999-WRAPUP.                                                    02860000
059900* END OF PROGRAM ROUTINE                                          02870000
060000*----------------------------------------------------------       02880000
060100 9999-WRAPUP.                                                     02890000
026600     CLOSE PROMO-EXTRACT-FILE                                     02900000
026600           DOMAIN-EXTRACT-FILE                                    02910000
026600           ERROR-FILE                                             02920000
026600           REPORT-FILE.                                           02930000
                                                                        02940000
           IF  PC-ERROR-RECORD-WRITTEN > 0                              02950000
               MOVE 04               TO RETURN-CODE                     02960000
           END-IF.                                                      02970000
                                                                        02980000
060500                                                                  02990000
060710*9999-EXIT.                                                       03000000
060800 EJECT.                                                           03010000
      ***************************************************************** 03020000
      **FORMAT ERROR-RECORD                                             03030000
      ***************************************************************** 03040000
       9999-FORMAT-ERROR-RECORD.                                        03050000
           MOVE PM701-ADEVENT-RECORD TO ERROR-RECORD.                   03060000
                                                                        03070000
       EJECT.                                                           03080000
      ***************************************************************** 03090000
      **READ PROMO  EXTRACT FILE                                        03100000
      ***************************************************************** 03110000
       9999-READ-PROMO-EXTRACT.                                         03120000
           IF  PS-NOT-EOF-PROMO                                         03130000
               READ PROMO-EXTRACT-FILE INTO PM701-ADEVENT-RECORD        03140000
                    AT END                                              03150000
                       SET PS-EOF-PROMO TO TRUE                         03160000
               END-READ                                                 03170000
           END-IF.                                                      03180000
                                                                        03190000
           IF  PS-NOT-EOF-PROMO                                         03200000
               ADD +1                  TO PC-PROMO-EXTRACT-RECS-READ    03210000
               MOVE PM701-AD-EVNT-ID   TO PV-PM-AD-EVNT-ID              03220000
           END-IF.                                                      03230000
                                                                        03240000
       EJECT.                                                           03250000
      ***************************************************************** 03260000
      **READ XS EXTRACT FILE                                            03270000
      ***************************************************************** 03280000
       9999-READ-DOMAIN-EXTRACT.                                        03290000
           IF  PS-NOT-EOF-DOMAIN                                        03300000
               READ DOMAIN-EXTRACT-FILE INTO XS015-ADEVENT-RECORD       03310000
                    AT END                                              03320000
                       SET PS-EOF-DOMAIN TO TRUE                        03330000
               END-READ                                                 03340000
           END-IF.                                                      03350000
                                                                        03360000
           IF  PS-NOT-EOF-DOMAIN                                        03370000
               ADD +1              TO PC-DOMAIN-EXTRACT-RECS-READ       03380000
               MOVE XS015-AD-EVNT-ID   TO PV-XS-AD-EVNT-ID              03390000
           END-IF.                                                      03400000
                                                                        03410000
       EJECT.                                                           03420000
      ***************************************************************** 03430000
      **READ CONTROL CARD FOR FREQUENCY OF COMPARE                      03440000
      ***************************************************************** 03450000
       9999-READ-CONTROL-CARD.                                          03460000
                                                                        03470000
           READ CONTROL-CARD INTO CONTROL-CARD-LAYOUT.                  03480000
                                                                        03490000
       EJECT.                                                           03500000
      ***************************************************************** 03510000
      **WRITE ERROR RECORD                                              03520000
      ***************************************************************** 03530000
       9999-WRITE-ERROR-RECORD.                                         03540000
                                                                        03550000
           WRITE DIFFERENCES-RECORD FROM ERROR-RECORD.                  03560000
                                                                        03570000
           ADD +1                       TO PC-ERROR-RECORD-WRITTEN.     03580000
                                                                        03590000
       EJECT.                                                           03600000
      ***************************************************************** 03610000
      **WRITE ERROR REPORT                                              03620000
      ***************************************************************** 03630000
       9999-WRITE-ERROR-REPORT.                                         03640000
           IF PC-ERROR-REPORT-WRITTEN > 66                              03650000
              PERFORM 9999-PRINT-HEADINGS                               03660000
           ELSE                                                         03670000
              WRITE REPORT-RECORD FROM REPORT-DETAIL                    03680000
              INITIALIZE REPORT-DETAIL                                  03690000
              ADD +1 TO PC-ERROR-REPORT-WRITTEN                         03700000
           END-IF.                                                      03710000
                                                                        03720000
                                                                        03730000
       EJECT.                                                           03740000
      ***************************************************************** 03750000
      **PRINT HEADINGS                                                  03760000
      ***************************************************************** 03770000
       9999-PRINT-HEADINGS.                                             03780000
           ADD 1 TO PC-PAGE-CNT.                                        03790000
           MOVE PC-PAGE-CNT TO DP132O-PAGE-NUMBER.                      03800000
           MOVE ZEROS TO PC-ERROR-REPORT-WRITTEN.                       03810000
491700     WRITE REPORT-RECORD                                          03820000
491800         FROM DP132O-STANDRD-HEADER-132-COLS                      03830000
491900         AFTER ADVANCING PAGE.                                    03840000
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     03850000
                                                                        03860000
491700     WRITE REPORT-RECORD                                          03870000
491800         FROM DR-HEAD2                                            03880000
491900         AFTER ADVANCING 1 LINE.                                  03890000
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     03900000
                                                                        03910000
491700     WRITE REPORT-RECORD                                          03920000
491800         FROM DR-HEAD3                                            03930000
491900         AFTER ADVANCING 2 LINE.                                  03931000
           ADD +2                       TO PC-ERROR-REPORT-WRITTEN.     03932000
                                                                        03933000
491700     WRITE REPORT-RECORD                                          03934000
491800         FROM DR-HEAD5                                            03935000
491900         AFTER ADVANCING 1 LINE.                                  03936000
                                                                        03937000
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     03938000
                                                                        03939000
       EJECT.                                                           03940000
