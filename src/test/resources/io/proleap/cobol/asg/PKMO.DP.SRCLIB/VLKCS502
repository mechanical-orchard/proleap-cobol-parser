000100 IDENTIFICATION DIVISION.                                         00010026
000200 PROGRAM-ID.    VLKCS502.                                         00020026
000300 AUTHOR.        MICHAEL WALTERS.                                  00030026
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040026
000500 DATE-WRITTEN.  10/95.                                            00050026
000600 DATE-COMPILED.                                                   00060026
000700******************************************************************00070026
000800*    V502 - VENDOR TERMS INQUIRY PROGRAM                          00080026
000900*                                                                 00090026
001000*    DISPLAY PAYMENT, SHIPPING, AND PURCHASE TERMS FOR A SPECIFIED00100026
001100*    VENDOR.                                                      00110026
001200******************************************************************00120026
CICS  * CHANGED 11/11/2022    BY JIM HUNTER      WR: CHG0278236         00121043
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00122043
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00123043
CICS  ***************************************************************** 00124043
001300 ENVIRONMENT DIVISION.                                            00130026
001400 DATA DIVISION.                                                   00140026
001500 WORKING-STORAGE SECTION.                                         00150026
001600                                                                  00160026
001700 01  NI-NULL-INDICATORS.                                          00170026
001800     05  NI-EXTENT-DUN-NBR            PIC S9(4) COMP VALUE ZERO.  00180026
001900     05  NI-VNDAGR-PAYT-TERM-ID       PIC S9(4) COMP VALUE ZERO.  00190026
002000     05  NI-VNDAGR-FOB-POINT-TXT      PIC S9(4) COMP VALUE ZERO.  00200026
002100     05  NI-VNDAGR-SHIPT-POINT-TXT    PIC S9(4) COMP VALUE ZERO.  00210026
002200     05  NI-VNDAGR-RTV-RA-REQD-IND    PIC S9(4) COMP VALUE ZERO.  00220026
002300     05  NI-VNDAGR-RTV-NO-RA-REQD-IND PIC S9(4) COMP VALUE ZERO.  00230026
002400     05  NI-VNDAGR-DEBIT-DESTROY-IND  PIC S9(4) COMP VALUE ZERO.  00240026
002500     05  NI-VNDAGR-MARKOUT-IND        PIC S9(4) COMP VALUE ZERO.  00250026
002600     05  NI-VNDAGR-EXPIRATION-DATE    PIC S9(4) COMP VALUE ZERO.  00260026
002700     05  NI-VNDAGR-LEADTIME-DAYS-QTY  PIC S9(4) COMP VALUE ZERO.  00270026
002800     05  NI-VNDAGR-VND-AUTH-ID        PIC S9(4) COMP VALUE ZERO.  00280026
002900                                                                  00290026
003000 01  PC-PROGRAM-CONSTANTS.                                        00300026
003100     05  PC-MAX-DATE                  PIC X(10)                   00310026
003200                                               VALUE '9999-12-31'.00320026
003300     05  PC-PROD-STATUS               PIC X     VALUE ' '.        00330026
003400     05  PC-CURRENT-MAP-NAME          PIC X(8)  VALUE 'VL502A  '. 00340026
003500     05  PC-CURRENT-MAPSET-NAME       PIC X(8)  VALUE 'VLKM502 '. 00350026
003600     05  PC-CURRENT-PROGRAM-NAME      PIC X(8)  VALUE 'VLKCS502'. 00360026
003700     05  PC-INTER-APPL-RTV-CRIT-SPEC  PIC X     VALUE ' '.        00370026
003800     05  PC-INTER-APPL-CRIT-SPEC      PIC X     VALUE '1'.        00380026
003900     05  PC-INTER-APPL-LIST           PIC X     VALUE '2'.        00390026
004000     05  PC-SHIPPING                  PIC X     VALUE '1'.        00400026
004100     05  PC-PAYMENT                   PIC X     VALUE '2'.        00410026
004200     05  PC-PURCHASE                  PIC X     VALUE '3'.        00420026
004300     05  PC-PRIMARY                   PIC XX    VALUE '01'.       00430026
004400     05  PC-VALID-CHARS               PIC X.                      00440026
004500         88 VALID-CHARS               VALUES                      00450026
004600            'A' 'B' 'C' 'D' 'E' 'F' 'G' 'H' 'I' 'J' 'K' 'L'       00460026
004700            'M' 'N' 'O' 'P' 'Q' 'R' 'S' 'T' 'U' 'V' 'W' 'X'       00470026
004800            'Y' 'Z' '0' '1' '2' '3' '4' '5' '6' '7' '8' '9'       00480042
004900            '/' '%' '-'.                                          00490042
005000     05  PC-MAX-RETRIES               PIC S9(4) COMP SYNC         00500026
005100                                                VALUE +3.         00510026
005200     05  PC-MAX-REC-CNT               PIC S9(4) COMP SYNC         00520026
005300                                                VALUE +9999.      00530026
005400     05  PC-MAX-INSTR-COUNT           PIC S9(4) COMP SYNC         00540026
005500                                                VALUE +3.         00550026
005600     05  PC-TSYMSG-NUMBERS.                                       00560026
005700         10  PC-TSYMSG-00005          PIC 9(5)  VALUE 00005.      00570035
005800         10  PC-TSYMSG-00007          PIC 9(5)  VALUE 00007.      00580035
005900         10  PC-TSYMSG-00046          PIC 9(5)  VALUE 00046.      00590026
006000         10  PC-TSYMSG-00057          PIC 9(5)  VALUE 00057.      00600026
006100         10  PC-TSYMSG-00059          PIC 9(5)  VALUE 00059.      00610026
006200         10  PC-TSYMSG-00069          PIC 9(5)  VALUE 00069.      00620026
006300         10  PC-TSYMSG-00070          PIC 9(5)  VALUE 00070.      00630026
006400         10  PC-TSYMSG-00156          PIC 9(5)  VALUE 00156.      00640026
006500         10  PC-TSYMSG-00349          PIC 9(5)  VALUE 00349.      00650026
006600         10  PC-TSYMSG-00488          PIC 9(5)  VALUE 00488.      00660026
006700         10  PC-TSYMSG-00492          PIC 9(5)  VALUE 00492.      00670026
006800         10  PC-TSYMSG-00489          PIC 9(5)  VALUE 00489.      00680026
006900         10  PC-TSYMSG-00499          PIC 9(5)  VALUE 00499.      00690026
007000         10  PC-TSYMSG-00500          PIC 9(5)  VALUE 00500.      00700026
007100         10  PC-TSYMSG-01085          PIC 9(5)  VALUE 01085.      00710026
007200         10  PC-TSYMSG-01086          PIC 9(5)  VALUE 01086.      00720026
007300         10  PC-TSYMSG-03104          PIC 9(5)  VALUE 03104.      00730026
007400         10  PC-TSYMSG-03125          PIC 9(5)  VALUE 03125.      00740041
007500                                                                  00750026
007600 01  PS-PROGRAM-SWITCHES.                                         00760026
007700     05  PS-ERROR-SW                  PIC  X    VALUE 'N'.        00770026
007800         88  PS-NO-ERROR                        VALUE 'N'.        00780026
007900         88  PS-ERROR                           VALUE 'Y'.        00790026
008000     05  PS-END-OF-LIST-SW            PIC  X    VALUE 'N'.        00800026
008100         88  PS-NOT-END-OF-LIST                 VALUE 'N'.        00810026
008200         88  PS-END-OF-LIST                     VALUE 'Y'.        00820026
008300     05  PS-END-OF-VND-INSTR-CSR-SW   PIC  X    VALUE 'N'.        00830026
008400         88  PS-NOT-END-OF-VND-INSTR-CSR        VALUE 'N'.        00840026
008500         88  PS-END-OF-VND-INSTR-CSR            VALUE 'Y'.        00850026
008600     05  PS-FIELDS-CHANGED-SW         PIC X     VALUE 'N'.        00860026
008700         88  PS-NO-FIELDS-CHANGED               VALUE 'N'.        00870026
008800         88  PS-FIELDS-CHANGED                  VALUE 'Y'.        00880026
008900     05  PS-TERMS-EXIST-SW            PIC X     VALUE 'N'.        00890026
009000         88  PS-TERMS-DONT-EXIST                VALUE 'N'.        00900026
009100         88  PS-TERMS-EXIST                     VALUE 'Y'.        00910026
009200     05  PS-VALID-AUTH-ID-SW          PIC X     VALUE 'Y'.        00920026
009300         88  PS-VALID-AUTH-ID                   VALUE 'Y'.        00930026
009400         88  PS-INVALID-AUTH-ID                 VALUE 'N'.        00940026
009500                                                                  00950026
009600 01  PV-PROGRAM-VARIABLES.                                        00960026
009700     05  PV-AGRMT-TYP-ID              PIC X     VALUE SPACE.      00970026
009800     05  PV-TERMS-COUNT               PIC S9(9) COMP VALUE ZERO.  00980026
009900     05  PV-CUR-SEQ-NBR               PIC S9(4) COMP VALUE ZERO.  00990026
010000     05  PV-CUR-INSTR-SEQ-NBR         PIC S9(4) COMP VALUE ZERO.  01000026
010100     05  PV-NEW-SEQ-NBR               PIC S9(4) COMP VALUE ZERO.  01010026
010200     05  PV-CICS-RESPONSE             PIC S9(4) COMP SYNC         01020026
010300                                                VALUE ZERO.       01030026
010400     05  PV-RETRY-COUNTER             PIC S9(4) COMP SYNC         01040026
010500                                                VALUE ZERO.       01050026
010600     05  PV-VENDOR-NAME-LOW           PIC X(30) VALUE SPACES.     01060026
010700     05  PV-VENDOR-NAME-HIGH          PIC X(30) VALUE SPACES.     01070026
010800     05  PV-DEPT-NBR                  PIC XXX   VALUE SPACES.     01080026
010900     05  PV-INHOUSE-NBR-X.                                        01090026
011000         10  PV-INHOUSE-NBR           PIC 999   VALUE ZERO.       01100026
011100     05  PV-INHOUSE-NUMBER            PIC S999 COMP-3 VALUE ZERO. 01110026
011200     05  PV-INHOUSE-NBR-LOW           PIC S999 COMP-3 VALUE ZERO. 01120026
011300     05  PV-INHOUSE-NBR-HIGH          PIC S999 COMP-3 VALUE ZERO. 01130026
011400     05  PV-NUM-KOHLS-FRGHT-PCT       PIC 9(5)  VALUE ZERO.       01140026
011500     05  PV-NUM-VENDR-FRGHT-PCT       PIC 9(5)  VALUE ZERO.       01150026
011600     05  PV-NUM-DISCOUNT-PCT          PIC 99    VALUE ZERO.       01160026
011700     05  PV-EDIT-KOHLS-FRGHT-PCT      PIC ZZZ.99.                 01170026
011800     05  PV-EDIT-VENDR-FRGHT-PCT      PIC ZZZ.99.                 01180026
011900     05  PV-EDIT-DISCOUNT-DAYS        PIC ZZZ.                    01190026
012000     05  PV-EDIT-DISCOUNT-PCT         PIC ZZ.                     01200026
012100     05  PV-EDIT-DUE-DAYS             PIC ZZZ.                    01210026
012200     05  PV-EDIT-PAYT-TERM-ID         PIC ZZZ.                    01220026
012300     05  PV-INSTR-TXT                 PIC X(75).                  01230026
012400     05  PV-INSTR-SEQ-NBR             PIC S9(4) COMP.             01240026
012500     05  PV-STRING                    PIC X(10).                  01250026
012600     05  PV-LASTPOS                   PIC S9(04) COMP.            01260039
012700     05  PV-AUTHID.                                               01270026
012800         10  PV-AUTHID-AREA           OCCURS 10 TIMES             01280026
012900                                      INDEXED BY AUTHID-INDX.     01290026
013000             15  PV-AUTHID-ONE        PIC X(01).                  01300026
013100 01  UD-UPDT-INSTR-DISPLAY.                                       01310026
013200     05  FILLER                       PIC X(8)                    01320026
013300                                      VALUE 'ENT ID: '.           01330026
013400     05  UD-ENT-ID                    PIC 9(9).                   01340026
013500     05  FILLER                       PIC X(11)                   01350026
013600                                      VALUE ' DEPT NBR: '.        01360026
013700     05  UD-DPT-NBR                   PIC X(3).                   01370026
013800     05  FILLER                       PIC X(12)                   01380026
013900                                      VALUE ' AGREEMENT: '.       01390026
014000     05  UD-AGRMT-TYP-ID              PIC X(3).                   01400026
014100     05  FILLER                       PIC X(10)                   01410026
014200                                      VALUE ' SEQ NBR: '.         01420026
014300     05  UD-INSTR-SEQ-NBR             PIC X(3).                   01430026
014400                                                                  01440026
014500******************************************************************01450026
014600*    SELECTED ITEMS TEMPORARY STORAGE QUEUE ITEM LAYOUT           01460026
014700******************************************************************01470026
014800     COPY VNWS003.                                                01480026
014900                                                                  01490026
015000******************************************************************01500026
015100*    PAYMENT TERMS                                                01510026
015200******************************************************************01520026
015300     COPY POWS020.                                                01530026
015400                                                                  01540026
015500******************************************************************01550026
015600*    BMS MAP                                                      01560026
015700******************************************************************01570026
015800     COPY VLKM502.                                                01580026
015900                                                                  01590026
016000******************************************************************01600026
016100*    BMS ATTRIBUTES                                               01610026
016200******************************************************************01620026
016300     COPY DPWS015.                                                01630026
016400                                                                  01640026
016500******************************************************************01650026
016600*    FUNCTION KEYS                                                01660026
016700******************************************************************01670026
016800     COPY DPWS016.                                                01680026
016900                                                                  01690026
017000***************************************************************** 01700026
017100*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API             01710044
017200***************************************************************** 01720026
017300     COPY DPWS030.                                                01730026
CICS       COPY DPWS930.                                                01731043
017400                                                                  01740026
017500***************************************************************** 01750026
017600*    GLOBAL COMMUNICATION AREA                                    01760026
017700***************************************************************** 01770026
017800     COPY DPWS020.                                                01780026
017900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01790026
018000                                                                  01800026
018100***************************************************************** 01810026
018200*    INTER-APPLICATION COMMUNICATION AREA                         01820026
018300***************************************************************** 01830026
018400         10  INTER-APPL-COMM-AREA PIC X(200).                     01840026
018500     COPY VNWS001.                                                01850026
018600     COPY VNWS002.                                                01860026
018700                                                                  01870026
018800***************************************************************** 01880026
018900*    APPLICATION SPECIFIC COMMUNICATION AREA                      01890026
019000***************************************************************** 01900026
019100         10  ASC-SPECIFIC-COMMAREA.                               01910026
019200             15  ASC-INT-APPL-FORMAT-IND        PIC X.            01920026
019300             15  ASC-USE-SELECTION-QUEUE-IND                      01930026
019400                                                PIC X.            01940026
019500                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   01950026
019600             15  ASC-SEL-QUEUE-NAME             PIC X(8).         01960026
019700             15  ASC-NUMBER-OF-TS-ITEMS         PIC S9(5) COMP-3. 01970026
019800             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01980026
019900                                                PIC S9(9) COMP-3. 01990026
020000             15  ASC-SEL-SUB                    PIC S9(4) COMP.   02000026
020100             15  ASC-SEL-ITEM                   PIC S9(4) COMP.   02010026
020200             15  ASC-KEY-FIELDS.                                  02020026
020300                 20  ASC-DEPARTMENT             PIC XXX.          02030026
020400                 20  ASC-ENT-ID                 PIC S9(9) COMP.   02040026
020500             15  ASC-SCREEN-FIELDS.                               02050026
020600                 20  ASC-INHOUSE-NBR            PIC XXX.          02060026
020700                 20  ASC-ENT-NAME-DESC          PIC X(30).        02070026
020800                 20  ASC-DUN-NBR                PIC X(9).         02080026
020900                 20  ASC-PAYT-TERM-ID           PIC S9(4) COMP.   02090026
021000                 20  ASC-PAYT-TERM-ID-DESC      PIC X(28).        02100026
021100                 20  ASC-FRGT-TERM-ID           PIC ZZ9.          02110026
021200                 20  ASC-KOHLS-FRGT-PCT         PIC 9(3)V99.      02120026
021300                 20  ASC-VEND-FRGT-PCT          PIC 9(3)V99.      02130026
021400                 20  ASC-FOB-POINT-TXT          PIC X(20).        02140026
021500                 20  ASC-SHIPT-POINT-TXT        PIC X(20).        02150026
021600                 20  ASC-FRGT-PAYT-CDE          PIC X.            02160026
021700                 20  ASC-LEADTIME-DAYS-QTY      PIC XXX.          02170026
021800                 20  ASC-LEADTIME-DAYS-QTY-N    REDEFINES         02180026
021900                     ASC-LEADTIME-DAYS-QTY      PIC 999.          02190026
022000                 20  ASC-RTV-RA-REQD-IND-O      PIC X.            02200026
022100                 20  ASC-RTV-RA-REQD-IND        PIC X.            02210026
022200                 20  ASC-RTV-NO-RA-REQD-IND-O   PIC X.            02220026
022300                 20  ASC-RTV-NO-RA-REQD-IND     PIC X.            02230026
022400                 20  ASC-DEBIT-DESTROY-IND-O    PIC X.            02240026
022500                 20  ASC-DEBIT-DESTROY-IND      PIC X.            02250026
022600                 20  ASC-MARKOUT-IND-O          PIC X.            02260026
022700                 20  ASC-MARKOUT-IND            PIC X.            02270026
022800                 20  ASC-VND-AUTH-ID            PIC X(10).        02280038
022900                 20  ASC-VND-AUTH-ID-O          PIC X(10).        02290038
023000                 20  ASC-INSTR-SEQ-NBR1         PIC S9(4) COMP.   02300026
023100                 20  ASC-INSTR-TEXT1-O          PIC X(75).        02310026
023200                 20  ASC-INSTR-TEXT1            PIC X(75).        02320026
023300                 20  ASC-INSTR-SEQ-NBR2         PIC S9(4) COMP.   02330026
023400                 20  ASC-INSTR-TEXT2-O          PIC X(75).        02340026
023500                 20  ASC-INSTR-TEXT2            PIC X(75).        02350026
023600                 20  ASC-INSTR-SEQ-NBR3         PIC S9(4) COMP.   02360026
023700                 20  ASC-INSTR-TEXT3-O          PIC X(75).        02370026
023800                 20  ASC-INSTR-TEXT3            PIC X(75).        02380026
023900                                                                  02390026
024000******************************************************************02400026
024100*    ABEND PROCESSING                                             02410026
024200******************************************************************02420026
024300     COPY DPWS013.                                                02430026
024400                                                                  02440026
024500******************************************************************02450026
024600*    DB2 SQL COMMUNICATION AREA                                   02460026
024700******************************************************************02470026
024800     EXEC SQL                                                     02480026
024900          INCLUDE SQLCA                                           02490026
025000     END-EXEC.                                                    02500026
025100                                                                  02510026
025200******************************************************************02520026
025300*    DB2 DCLGEN FOR VENDOR DEPARTMENT TABLE                       02530026
025400******************************************************************02540026
025500     EXEC SQL                                                     02550026
025600          INCLUDE TVNDDPT                                         02560026
025700     END-EXEC.                                                    02570026
025800                                                                  02580026
025900******************************************************************02590026
026000*    DB2 DCLGEN FOR VENDOR EXTERNAL ENTERPRISE TABLE              02600026
026100******************************************************************02610026
026200     EXEC SQL                                                     02620026
026300          INCLUDE TEXTENT                                         02630026
026400     END-EXEC.                                                    02640026
026500                                                                  02650026
026600******************************************************************02660026
026700*    DB2 DCLGEN FOR VENDOR EXTERNAL ENTERPRISE NAME TABLE         02670026
026800******************************************************************02680026
026900     EXEC SQL                                                     02690026
027000          INCLUDE TENTNME                                         02700026
027100     END-EXEC.                                                    02710026
027200                                                                  02720026
027300******************************************************************02730026
027400*    DB2 DCLGEN FOR VENDOR AGREEMENT TABLE                        02740026
027500******************************************************************02750026
027600     EXEC SQL                                                     02760026
027700          INCLUDE TVNDAGR                                         02770026
027800     END-EXEC.                                                    02780026
027900                                                                  02790026
028000******************************************************************02800026
028100*    DB2 DCLGEN FOR VENDOR INSTRUCTION TABLE                      02810026
028200******************************************************************02820026
028300     EXEC SQL                                                     02830026
028400          INCLUDE TVNDINS                                         02840026
028500     END-EXEC.                                                    02850026
028600                                                                  02860026
028700******************************************************************02870026
028800*    DB2 DCLGEN FOR VENDOR PAYMENT TERMS TABLE                    02880026
028900******************************************************************02890026
029000     EXEC SQL                                                     02900026
029100          INCLUDE TPAYTRM                                         02910026
029200     END-EXEC.                                                    02920026
029300                                                                  02930026
029400******************************************************************02940026
029500*    DB2 DCLGEN FOR VENDOR FREIGHT TERMS TABLE                    02950026
029600******************************************************************02960026
029700     EXEC SQL                                                     02970026
029800          INCLUDE TFRGTRM                                         02980026
029900     END-EXEC.                                                    02990026
030000                                                                  03000026
030100*---------------------------------------------------------------* 03010026
030200*    VND-INSTR-CSR CURSOR DECLARATION                           * 03020026
030300*---------------------------------------------------------------* 03030026
030400                                                                  03040026
030500     EXEC SQL                                                     03050026
030600          DECLARE VND-INSTR-CSR CURSOR                            03060026
030700          FOR SELECT                                              03070026
030800                INSTR_SEQ_NBR                                     03080026
030900               ,VND_INSTR_TXT                                     03090026
031000          FROM                                                    03100026
031100                TVNDINS                                           03110026
031200          WHERE ENT_ID            = :ASC-ENT-ID                   03120026
031300            AND DEPT_NBR          = :ASC-DEPARTMENT               03130026
031400            AND AGRMT_TYP_ID      = :PC-PURCHASE                  03140026
031500          ORDER BY                                                03150026
031600                INSTR_SEQ_NBR                                     03160026
031700     END-EXEC.                                                    03170026
031800                                                                  03180026
031900 LINKAGE SECTION.                                                 03190026
032000                                                                  03200026
032100 01  DFHCOMMAREA.                                                 03210026
032200     05  FILLER                       OCCURS 1 TO 4072 TIMES      03220026
032300                                      DEPENDING ON EIBCALEN.      03230026
032400         10  FILLER                   PIC  X.                     03240026
032500                                                                  03250026
032600 PROCEDURE DIVISION.                                              03260026
032700******************************************************************03270026
032800*    CALL CICS ARCHITECTURE APPLICATION PROGRAM INTERFACE.        03280026
032900*                                                                 03290026
033000*    PERFORM PROGRAM LOGIC.                                       03300026
033100*                                                                 03310026
033200*    CALL CICS ARCHITECTURE APPLICATION PROGRAM INTERFACE.        03320026
033300******************************************************************03330026
033400 0000-MAIN-MODULE.                                                03340026
033500                                                                  03350026
033600     INITIALIZE DP030-CICS-API-FIELDS.                            03360026
033700     MOVE +1                     TO DP030-NUMBER-OF-MAPS.         03370026
033800     MOVE PC-CURRENT-MAPSET-NAME TO DP030-MAPSET-NAME.            03380026
033900     MOVE PC-CURRENT-MAP-NAME    TO DP030-MAP-NAME (1).           03390026
034000     SET DP030-RECEIVE-APPL-MAP  TO TRUE.                         03400026
034100     MOVE LENGTH OF VL502AI      TO DP030-MAP-LENGTH (1).         03410026
034200     MOVE 'PROGRAM ENTRY CALL'   TO DP013-MESSAGE-TEXT (1).       03420026
034300                                                                  03430026
034400     PERFORM 0001-CALL-CICS-ARCH-API.                             03440026
034500                                                                  03450026
034600     PERFORM 1000-CONTROL-PROCESSING.                             03460026
034700                                                                  03470026
034800     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          03480026
034900                                                                  03490026
035000     PERFORM 0001-CALL-CICS-ARCH-API.                             03500026
035100                                                                  03510026
035200 0001-CALL-CICS-ARCH-API.                                         03520026
035300                                                                  03530026
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03540043
035500                                    DFHCOMMAREA                   03550043
035600                                    DP030-CICS-API-FIELDS         03560043
035700                                    DP020-STANDARD-COMMAREA       03570043
035800                                    VL502AI.                      03580043
035900                                                                  03590026
036000     IF NOT DP030-RC-CALL-SUCCESSFUL                              03600026
036100         SET DP013-CICS-ABEND                                     03610026
036200             DP013-NO-ROLLBACK                                    03620026
036300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   03630026
036400         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        03640026
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03641043
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03642043
036700         MOVE DP030-RETURN-CODE TO DP013-MESSAGE-TEXT (3)         03670026
036800                                                                  03680026
036900         PERFORM DP013-0000-PROCESS-ABEND                         03690026
037000     END-IF.                                                      03700026
037100                                                                  03710026
037200******************************************************************03720026
037300*    EXECUTE APPROPRIATE LOGIC BASED ON ACTION TO BE PERFORMED    03730026
037400******************************************************************03740026
037500 1000-CONTROL-PROCESSING.                                         03750026
037600                                                                  03760026
037700     EVALUATE TRUE                                                03770026
037800                                                                  03780026
037900         WHEN DP020-NEXT-ACT-INITIAL                              03790026
038000              SET PS-NO-ERROR TO TRUE                             03800026
038100                                                                  03810026
038200              PERFORM 1100-PROCESS-INTER-APPL-COMM                03820026
038300                                                                  03830026
038400              IF PS-NO-ERROR                                      03840026
038500                  PERFORM 4000-BUILD-INITIAL-PANEL                03850026
038600                  PERFORM 3500-SAVE-SCREEN-FIELDS                 03860026
038700              END-IF                                              03870026
038800                                                                  03880026
038900                                                                  03890026
039000         WHEN DP020-NEXT-ACT-READ-MAP                             03900026
039100                                                                  03910026
039200              PERFORM 2000-PROCESS-PANEL                          03920026
039300                                                                  03930026
039400                                                                  03940026
039500         WHEN DP020-NEXT-ACT-RETURN                               03950026
039600                                                                  03960026
039700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03970026
039800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03980026
039900                                                                  03990026
040000                                                                  04000026
040100         WHEN OTHER                                               04010026
040200              SET DP013-LOGIC-ABEND                               04020026
040300                  DP013-NO-ROLLBACK TO TRUE                       04030026
040400              MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH   04040026
040500              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED' TO04050026
040600                                             DP013-MESSAGE-TEXT(1)04060026
040700              MOVE DP020-NEXT-APPL-ACTIVITY TO                    04070026
040800                                             DP013-MESSAGE-TEXT(2)04080026
040900              PERFORM DP013-0000-PROCESS-ABEND                    04090026
041000                                                                  04100026
041100     END-EVALUATE.                                                04110026
041200                                                                  04120026
041300 1100-PROCESS-INTER-APPL-COMM.                                    04130026
041400                                                                  04140026
041500     INITIALIZE ASC-SPECIFIC-COMMAREA.                            04150026
041600     MOVE DP020-INT-APPL-FORMAT-IND TO ASC-INT-APPL-FORMAT-IND.   04160026
041700                                                                  04170026
041800******************************************************************04180026
041900*   DEPENDING ON WHICH FIELD(S) WERE ENTERED / MISSING ON THE     04190026
042000*   CRITERIA SPEC. SCREEN, SEND THE APPROPRIATE ERROR MESSAGE     04200026
042100******************************************************************04210026
042200     EVALUATE DP020-INT-APPL-FORMAT-IND                           04220026
042300         WHEN PC-INTER-APPL-CRIT-SPEC                             04230026
042400         WHEN PC-INTER-APPL-RTV-CRIT-SPEC                         04240026
042500              IF (VN001-VENDOR-NAME       = SPACES AND            04250026
042600                  VN001-DEPARTMENT-NUMBER = SPACES AND            04260026
042700                  VN001-INHOUSE-NUMBER    = SPACES) OR            04270026
042800                 (VN001-DEPARTMENT-NUMBER > SPACES AND            04280026
042900                 (VN001-VENDOR-NAME       = SPACES AND            04290026
043000                  VN001-INHOUSE-NUMBER    = SPACES))              04300026
043100                   SET PS-ERROR                                   04310026
043200                       DP030-OVERRIDE-GO                          04320026
043300                       DP020-MSG-FATAL                            04330026
043400                       DP020-NEXT-ACT-APPL-ERROR TO TRUE          04340026
043500                   MOVE PC-TSYMSG-00488 TO DP020-MSG-NUMBER       04350026
043600              ELSE                                                04360026
043700                  PERFORM 1110-FORMAT-KEYS                        04370026
043800                  PERFORM 1120-GET-ENTERPRISE-ID                  04380026
043900              END-IF                                              04390026
044000                                                                  04400026
044100                                                                  04410026
044200         WHEN PC-INTER-APPL-LIST                                  04420026
044300              IF VN002-NUMBER-OF-SELECTED-ITEMS = ZERO            04430026
044400                  SET PS-ERROR                                    04440026
044500                      DP030-OVERRIDE-GO                           04450026
044600                      DP020-MSG-WARNING                           04460026
044700                      DP020-NEXT-ACT-APPL-ERROR TO TRUE           04470026
044800                  MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER        04480026
044900              ELSE                                                04490026
045000                  SET ASC-USE-SELECTION-QUEUE TO TRUE             04500026
045100                  MOVE VN002-NUMBER-OF-SELECTED-ITEMS TO          04510026
045200                                      ASC-NUMBER-OF-SELECTED-ITEMS04520026
045300                  MOVE VN002-NUMBER-OF-TS-ITEMS TO                04530026
045400                                            ASC-NUMBER-OF-TS-ITEMS04540026
045500                  MOVE VN002-SEL-QUEUE-NAME TO ASC-SEL-QUEUE-NAME 04550026
045600                  MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB        04560026
045700                  MOVE ZERO                 TO ASC-SEL-ITEM       04570026
045800                                                                  04580026
045900                  PERFORM 2010-GET-NEXT-VENDOR                    04590026
046000              END-IF                                              04600026
046100                                                                  04610026
046200                                                                  04620026
046300         WHEN OTHER                                               04630026
046400              SET PS-ERROR                                        04640026
046500                  DP030-OVERRIDE-GO                               04650026
046600                  DP020-MSG-FATAL                                 04660026
046700                  DP020-NEXT-ACT-APPL-ERROR TO TRUE               04670026
046800              MOVE PC-TSYMSG-00488 TO DP020-MSG-NUMBER            04680026
046900     END-EVALUATE.                                                04690026
047000                                                                  04700026
047100******************************************************************04710026
047200*   DEPENDING ON WHICH FIELD(S) WERE ENTERED ON THE CRITERIA SPEC.04720026
047300*   SCREEN, FORMAT THE KEYS NEEDED TO RETRIEVE THE DESIRED INFO.  04730026
047400******************************************************************04740026
047500 1110-FORMAT-KEYS.                                                04750026
047600                                                                  04760026
047700     MOVE VN001-DEPARTMENT-NUMBER   TO PV-DEPT-NBR.               04770026
047800                                                                  04780026
047900     IF VN001-INHOUSE-NUMBER > SPACES                             04790026
048000         MOVE VN001-INHOUSE-NUMBER  TO PV-INHOUSE-NBR-X           04800026
048100         MOVE PV-INHOUSE-NBR        TO PV-INHOUSE-NBR-LOW         04810026
048200                                       PV-INHOUSE-NBR-HIGH        04820026
048300         MOVE LOW-VALUES            TO PV-VENDOR-NAME-LOW         04830026
048400         MOVE HIGH-VALUES           TO PV-VENDOR-NAME-HIGH        04840026
048500     ELSE                                                         04850026
048600         MOVE ZERO                  TO PV-INHOUSE-NBR-LOW         04860026
048700         MOVE +999                  TO PV-INHOUSE-NBR-HIGH        04870026
048800         IF VN001-VENDOR-NAME > SPACES                            04880026
048900             MOVE VN001-VENDOR-NAME TO PV-VENDOR-NAME-LOW         04890026
049000                                       PV-VENDOR-NAME-HIGH        04900026
049100         ELSE                                                     04910026
049200             MOVE LOW-VALUES        TO PV-VENDOR-NAME-LOW         04920026
049300             MOVE HIGH-VALUES       TO PV-VENDOR-NAME-HIGH        04930026
049400         END-IF                                                   04940026
049500     END-IF.                                                      04950026
049600                                                                  04960026
049700                                                                  04970026
049800 1120-GET-ENTERPRISE-ID.                                          04980026
049900                                                                  04990026
050000     PERFORM WITH TEST AFTER                                      05000026
050100             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                05010026
050200             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         05020026
050300                     SQLCODE = ZERO OR                            05030026
050400                     SQLCODE = +100                               05040026
050500                                                                  05050026
050600     EXEC SQL                                                     05060026
050700          SELECT DISTINCT A.ENT_ID                                05070026
050800            INTO :VNDDPT-ENT-ID                                   05080026
050900            FROM TVNDDPT A                                        05090026
051000                ,TENTNME B                                        05100026
051100           WHERE A.ENT_ID    = B.ENT_ID                           05110026
051200             AND A.DEPT_NBR  = :PV-DEPT-NBR                       05120026
051300             AND A.INHOUSE_NBR BETWEEN :PV-INHOUSE-NBR-LOW        05130026
051400                                   AND :PV-INHOUSE-NBR-HIGH       05140026
051500             AND B.ENT_NAME_DESC BETWEEN :PV-VENDOR-NAME-LOW      05150026
051600                                     AND :PV-VENDOR-NAME-HIGH     05160026
051700     END-EXEC                                                     05170026
051800                                                                  05180026
051900     EVALUATE TRUE                                                05190026
052000         WHEN SQLCODE = ZERO                                      05200026
052100         WHEN SQLCODE = +100                                      05210026
052200         WHEN SQLCODE = -904                                      05220026
052300         WHEN SQLCODE = -913                                      05230026
052400              CONTINUE                                            05240026
052500                                                                  05250026
052600         WHEN SQLWARN0 NOT = SPACES                               05260026
052700         WHEN SQLCODE  NOT = ZERO                                 05270026
052800              MOVE '1120-GET-ENTERPRISE-ID' TO DP013-PARAGRAPH    05280026
052900              MOVE 'UNSUCCESSFUL SELECT ENTERPRISE ID' TO         05290026
053000                                            DP013-MESSAGE-TEXT (1)05300026
053100              MOVE SQLCA TO DP013-SQLCA                           05310026
053200              MOVE 'TVNDDPT ' TO DP013-DB2-TABLE-NAME (1)         05320026
053300              MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)         05330026
053400              SET DP013-DB2-ABEND                                 05340026
053500                  DP013-XCTL-DISPLAY-RESTART TO TRUE              05350026
053600                                                                  05360026
053700              PERFORM DP013-0000-PROCESS-ABEND                    05370026
053800     END-EVALUATE                                                 05380026
053900     END-PERFORM.                                                 05390026
054000                                                                  05400026
054100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         05410026
054200         MOVE '1120-GET-ENTERPRISE-ID' TO DP013-PARAGRAPH         05420026
054300         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE ID' TO   05430026
054400                                            DP013-MESSAGE-TEXT (1)05440026
054500         MOVE SQLCA      TO DP013-SQLCA                           05450026
054600         MOVE 'TVNDDPT ' TO DP013-DB2-TABLE-NAME (1)              05460026
054700         MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)              05470026
054800         SET DP013-DB2-ABEND                                      05480026
054900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   05490026
055000                                                                  05500026
055100         PERFORM DP013-0000-PROCESS-ABEND                         05510026
055200     END-IF.                                                      05520026
055300                                                                  05530026
055400     IF SQLCODE = ZERO                                            05540026
055500         MOVE PV-DEPT-NBR   TO ASC-DEPARTMENT                     05550026
055600         MOVE VNDDPT-ENT-ID TO ASC-ENT-ID                         05560026
055700     END-IF.                                                      05570026
055800                                                                  05580026
055900     IF SQLCODE = +100                                            05590026
056000         SET PS-ERROR                                             05600026
056100             DP020-MSG-FATAL                                      05610026
056200             DP020-NEXT-ACT-APPL-ERROR TO TRUE                    05620026
056300         IF VN001-INHOUSE-NUMBER > SPACES                         05630026
056400             MOVE PC-TSYMSG-00156 TO DP020-MSG-NUMBER             05640026
056500         ELSE                                                     05650026
056600             IF VN001-VENDOR-NAME > SPACES                        05660026
056700                 MOVE PC-TSYMSG-00489 TO DP020-MSG-NUMBER         05670026
056800             END-IF                                               05680026
056900         END-IF                                                   05690026
057000     END-IF.                                                      05700026
057100                                                                  05710026
057200******************************************************************05720026
057300*    PROCESS FUNCTION KEYS THAT DON'T REQUIRE DATA TO BE EDITED.  05730026
057400*    IF ONE OF THESE KEYS ISN'T USED, PERFORM DATA EDITS AND      05740026
057500*    PROCESS FUNCTION KEYS THAT REQUIRE DATA TO BE EDITED.        05750026
057600******************************************************************05760026
057700 2000-PROCESS-PANEL.                                              05770026
057800                                                                  05780026
057900     EVALUATE TRUE                                                05790026
058000         WHEN DP020-SRC-AID = DP016-CLEAR                         05800026
058100                                                                  05810026
058200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05820026
058300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05830026
058400                                                                  05840026
058500                                                                  05850026
058600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05860026
058700                                                                  05870026
058800              PERFORM 4000-BUILD-INITIAL-PANEL                    05880026
058900              PERFORM 3200-RESET-ATTRIBUTES                       05890026
059000              PERFORM 3500-SAVE-SCREEN-FIELDS                     05900026
059100                                                                  05910026
059200                                                                  05920026
059300         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05930026
059400              IF ASC-USE-SELECTION-QUEUE                          05940026
059500                                                                  05950026
059600                  PERFORM 2010-GET-NEXT-VENDOR                    05960026
059700                                                                  05970026
059800                  IF PS-END-OF-LIST                               05980026
059900                      SET PS-NOT-END-OF-LIST TO TRUE              05990026
060000                  ELSE                                            06000026
060100                      PERFORM 4000-BUILD-INITIAL-PANEL            06010026
060200                  END-IF                                          06020026
060300              ELSE                                                06030026
060400                  SET PS-END-OF-LIST                              06040026
060500                      DP020-MSG-INFORMATIONAL TO TRUE             06050026
060600                  MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER        06060026
060700              END-IF                                              06070026
060800                                                                  06080026
060900                                                                  06090026
061000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06100026
061100              IF ASC-USE-SELECTION-QUEUE                          06110026
061200                                                                  06120026
061300                  PERFORM 2020-GET-PREV-VENDOR                    06130026
061400                                                                  06140026
061500                  IF PS-END-OF-LIST                               06150026
061600                      SET PS-NOT-END-OF-LIST TO TRUE              06160026
061700                  ELSE                                            06170026
061800                      PERFORM 4000-BUILD-INITIAL-PANEL            06180026
061900                  END-IF                                          06190026
062000              ELSE                                                06200026
062100                  SET PS-END-OF-LIST                              06210026
062200                      DP020-MSG-INFORMATIONAL TO TRUE             06220026
062300                  MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER        06230026
062400              END-IF                                              06240026
062500                                                                  06250026
062600                                                                  06260026
062700         WHEN OTHER                                               06270026
062800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06280026
062900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06290026
063000             IF  PS-NO-ERROR                                      06300026
063100                 SET DP030-CONTINUE-GO                            06310026
063200                                   TO TRUE                        06320026
063300                 PERFORM 2100-CHECK-FUNCTION-KEY                  06330026
063400             ELSE                                                 06340026
063500                 SET DP030-OVERRIDE-GO                            06350026
063600                                 TO TRUE                          06360026
063700             END-IF                                               06370026
063800                                                                  06380026
063900     END-EVALUATE.                                                06390026
064000                                                                  06400026
064100 2010-GET-NEXT-VENDOR.                                            06410026
064200                                                                  06420026
064300     ADD +1 TO ASC-SEL-SUB.                                       06430026
064400                                                                  06440026
064500     IF ASC-SEL-SUB > VN003-MAX-ITEMS                             06450026
064600         ADD  +1 TO ASC-SEL-ITEM                                  06460026
064700         MOVE +1 TO ASC-SEL-SUB                                   06470026
064800     END-IF.                                                      06480026
064900                                                                  06490026
065000     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 06500026
065100                                                                  06510026
065200         PERFORM 9100-READ-SELECTION-QUEUE                        06520026
065300                                                                  06530026
065400         IF VN003-ITEM (ASC-SEL-SUB) > ZERO                       06540026
065500             MOVE VN003-DEPARTMENT (ASC-SEL-SUB) TO ASC-DEPARTMENT06550026
065600             MOVE VN003-ENT-ID     (ASC-SEL-SUB) TO ASC-ENT-ID    06560026
065700             SET VN003-INQ (ASC-SEL-SUB) TO TRUE                  06570026
065800                                                                  06580026
065900             PERFORM 9200-REWRITE-SELECTION-QUEUE                 06590026
066000                                                                  06600026
066100             INITIALIZE ASC-SCREEN-FIELDS                         06610026
066200         ELSE                                                     06620026
066300             SUBTRACT +1 FROM ASC-SEL-SUB                         06630026
066400             SET PS-END-OF-LIST                                   06640026
066500                 DP020-MSG-INFORMATIONAL TO TRUE                  06650026
066600             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             06660026
066700         END-IF                                                   06670026
066800     ELSE                                                         06680026
066900         SUBTRACT +1 FROM ASC-SEL-ITEM                            06690026
067000         MOVE VN003-MAX-ITEMS TO ASC-SEL-SUB                      06700026
067100         SET PS-END-OF-LIST                                       06710026
067200             DP020-MSG-INFORMATIONAL TO TRUE                      06720026
067300         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                 06730026
067400     END-IF.                                                      06740026
067500                                                                  06750026
067600 2020-GET-PREV-VENDOR.                                            06760026
067700                                                                  06770026
067800     SUBTRACT +1 FROM ASC-SEL-SUB.                                06780026
067900     IF ASC-SEL-SUB < +1                                          06790026
068000         SUBTRACT +1 FROM ASC-SEL-ITEM                            06800026
068100         MOVE VN003-MAX-ITEMS TO ASC-SEL-SUB                      06810026
068200     END-IF.                                                      06820026
068300                                                                  06830026
068400     IF ASC-SEL-ITEM > ZERO                                       06840026
068500                                                                  06850026
068600         PERFORM 9100-READ-SELECTION-QUEUE                        06860026
068700                                                                  06870026
068800         IF VN003-DEPARTMENT (ASC-SEL-SUB) > SPACES AND           06880026
068900            VN003-ENT-ID     (ASC-SEL-SUB) > ZERO                 06890026
069000             MOVE VN003-DEPARTMENT (ASC-SEL-SUB) TO ASC-DEPARTMENT06900026
069100             MOVE VN003-ENT-ID     (ASC-SEL-SUB) TO ASC-ENT-ID    06910026
069200         END-IF                                                   06920026
069300         INITIALIZE ASC-SCREEN-FIELDS                             06930026
069400     ELSE                                                         06940026
069500         MOVE +1 TO ASC-SEL-ITEM                                  06950026
069600                    ASC-SEL-SUB                                   06960026
069700         SET PS-END-OF-LIST                                       06970026
069800             DP020-MSG-INFORMATIONAL TO TRUE                      06980026
069900             MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER             06990026
070000     END-IF.                                                      07000026
070100                                                                  07010026
070200******************************************************************07020026
070300*    PROCESS FUNCTION KEYS THAT REQUIRE DATA TO BE EDITED         07030026
070400******************************************************************07040026
070500 2100-CHECK-FUNCTION-KEY.                                         07050026
070600                                                                  07060026
070700     EVALUATE TRUE                                                07070026
070800         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07080026
070900                                                                  07090026
071000              PERFORM 3600-COMPARE-SCREEN-FIELDS                  07100026
071100                                                                  07110026
071200              IF PS-FIELDS-CHANGED                                07120026
071300                  SET DP030-CONTINUE-GO TO TRUE                   07130026
071400                                                                  07140026
071500                  PERFORM 5000-UPDATE-TERMS                       07150026
071600                                                                  07160026
071700                  SET DP020-MSG-INFORMATIONAL TO TRUE             07170026
071800                  MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER        07180026
071900                                                                  07190026
072000                  PERFORM 3500-SAVE-SCREEN-FIELDS                 07200026
072100              ELSE                                                07210026
072200                  SET DP020-MSG-INFORMATIONAL TO TRUE             07220026
072300                  MOVE PC-TSYMSG-00046 TO DP020-MSG-NUMBER        07230026
072400              END-IF                                              07240026
072500                                                                  07250026
072600                                                                  07260026
072700                                                                  07270026
072800         WHEN DP020-SRC-AID = DP016-ENTER                         07280026
072900              CONTINUE                                            07290026
073000                                                                  07300026
073100                                                                  07310026
073200         WHEN OTHER                                               07320026
073300              SET DP013-CICS-ABEND                                07330026
073400                  DP013-NO-ROLLBACK                               07340026
073500                  DP013-XCTL-DISPLAY-RESTART TO TRUE              07350026
073600              MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH   07360026
073700              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API' TO  07370026
073800                                            DP013-MESSAGE-TEXT (1)07380026
073900              PERFORM DP013-0000-PROCESS-ABEND                    07390026
074000                                                                  07400026
074100     END-EVALUATE.                                                07410026
074200                                                                  07420026
074300******************************************************************07430026
074400** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **07440026
074500** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **07450026
074600******************************************************************07460026
074700 2200-MOVE-SCREEN-TO-COMMAREA.                                    07470026
074800                                                                  07480026
074900*                                                                 07490026
075000     IF  ARTVRQDL > ZERO                                          07500026
075100         MOVE ARTVRQDI         TO ASC-RTV-RA-REQD-IND             07510026
075200     ELSE                                                         07520026
075300         IF  ARTVRQDF = DP015-ERASE-EOF                           07530026
075400             INITIALIZE ASC-RTV-RA-REQD-IND                       07540026
075500         END-IF                                                   07550026
075600     END-IF.                                                      07560026
075700*                                                                 07570026
075800     IF  ARTVNRQL > ZERO                                          07580026
075900         MOVE ARTVNRQI         TO ASC-RTV-NO-RA-REQD-IND          07590026
076000     ELSE                                                         07600026
076100         IF  ARTVNRQF = DP015-ERASE-EOF                           07610026
076200             INITIALIZE ASC-RTV-NO-RA-REQD-IND                    07620026
076300         END-IF                                                   07630026
076400     END-IF.                                                      07640026
076500*                                                                 07650026
076600     IF  ADBTDSTL > ZERO                                          07660026
076700         MOVE ADBTDSTI         TO ASC-DEBIT-DESTROY-IND           07670026
076800     ELSE                                                         07680026
076900         IF  ADBTDSTF = DP015-ERASE-EOF                           07690026
077000             INITIALIZE ASC-DEBIT-DESTROY-IND                     07700026
077100         END-IF                                                   07710026
077200     END-IF.                                                      07720026
077300*                                                                 07730026
077400     IF  AMKOUTL  > ZERO                                          07740026
077500         MOVE AMKOUTI          TO ASC-MARKOUT-IND                 07750026
077600     ELSE                                                         07760026
077700         IF  AMKOUTF  = DP015-ERASE-EOF                           07770026
077800             INITIALIZE ASC-MARKOUT-IND                           07780026
077900         END-IF                                                   07790026
078000     END-IF.                                                      07800026
078100*                                                                 07810026
078200     IF AAUTHIDL > ZERO                                           07820026
078300         MOVE AAUTHIDI TO ASC-VND-AUTH-ID                         07830026
078400     ELSE                                                         07840026
078500         IF AAUTHIDF = DP015-ERASE-EOF                            07850026
078600             MOVE SPACE TO ASC-VND-AUTH-ID                        07860026
078700         END-IF                                                   07870026
078800     END-IF.                                                      07880026
078900*                                                                 07890026
079000     IF  ACMNT01L > ZERO                                          07900026
079100         MOVE ACMNT01I         TO ASC-INSTR-TEXT1                 07910026
079200     ELSE                                                         07920026
079300         IF  ACMNT01F = DP015-ERASE-EOF                           07930026
079400             INITIALIZE ASC-INSTR-TEXT1                           07940026
079500         END-IF                                                   07950026
079600     END-IF.                                                      07960026
079700*                                                                 07970026
079800     IF  ACMNT02L > ZERO                                          07980026
079900         MOVE ACMNT02I         TO ASC-INSTR-TEXT2                 07990026
080000     ELSE                                                         08000026
080100         IF  ACMNT02F = DP015-ERASE-EOF                           08010026
080200             INITIALIZE ASC-INSTR-TEXT2                           08020026
080300         END-IF                                                   08030026
080400     END-IF.                                                      08040026
080500*                                                                 08050026
080600     IF  ACMNT03L > ZERO                                          08060026
080700         MOVE ACMNT03I         TO ASC-INSTR-TEXT3                 08070026
080800     ELSE                                                         08080026
080900         IF  ACMNT03F = DP015-ERASE-EOF                           08090026
081000             INITIALIZE ASC-INSTR-TEXT3                           08100026
081100         END-IF                                                   08110026
081200     END-IF.                                                      08120026
081300                                                                  08130026
081400******************************************************************08140026
081500** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **08150026
081600** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **08160026
081700******************************************************************08170026
081800 3000-EDIT-DATA-IN-COMMAREA.                                      08180026
081900     SET PS-NO-ERROR               TO TRUE.                       08190026
082000     PERFORM 3200-RESET-ATTRIBUTES.                               08200026
082100                                                                  08210033
082200******************************************************************08220033
082300*   ONLY ONE OF THE FOUR PURCHASE TERMS FIELDS CAN = 'Y'          08230033
082400******************************************************************08240033
082500                                                                  08250026
082600     IF (ASC-RTV-RA-REQD-IND   = 'Y'                              08260033
082700         AND (   ASC-RTV-NO-RA-REQD-IND = 'Y'                     08270033
082800              OR ASC-DEBIT-DESTROY-IND = 'Y'                      08280033
082900              OR ASC-MARKOUT-IND       = 'Y'))                    08290033
083000         OR (ASC-RTV-NO-RA-REQD-IND = 'Y'                         08300033
083100             AND (   ASC-DEBIT-DESTROY-IND = 'Y'                  08310033
083200                  OR ASC-MARKOUT-IND       = 'Y'))                08320033
083300         OR (ASC-DEBIT-DESTROY-IND = 'Y'                          08330033
083400             AND ASC-MARKOUT-IND   = 'Y')                         08340033
083500         SET PS-ERROR                                             08350033
083600             DP020-MSG-FATAL                                      08360033
083700             DP030-SET-CURSOR-APPL-1 TO TRUE                      08370033
083800         MOVE PC-TSYMSG-00492 TO DP020-MSG-NUMBER                 08380033
083900         MOVE -1                    TO ARTVRQDL  ARTVNRQL         08390033
084000                                       ADBTDSTL  AMKOUTL          08400033
084100         MOVE DP015-UNP-ALP-BRT-OFF TO ARTVRQDA  ARTVNRQA         08410033
084200                                       ADBTDSTA  AMKOUTA          08420033
084300         MOVE DP015-RED             TO ARTVRQDC  ARTVNRQC         08430033
084400                                       ADBTDSTC  AMKOUTC          08440034
084500         MOVE DP015-REVERSE         TO ARTVRQDH  ARTVNRQH         08450033
084600                                       ADBTDSTH  AMKOUTH          08460033
084700     END-IF.                                                      08470033
084800                                                                  08480033
084900******************************************************************08490033
085000*   IF ONE OF THE ARRANGEMENTS IS 'Y', 'N' IS UPDATED IN TABLE FOR08500033
085100*      THE OTHER 3                                                08510033
085200*   OTHERWISE, EDITS FOR EACH OF THE ARRANGEMENTS FOLLOW          08520033
085300******************************************************************08530033
085400                                                                  08540033
085500     IF  ASC-RTV-RA-REQD-IND    = SPACE                           08550031
085600     AND ASC-RTV-NO-RA-REQD-IND = SPACE                           08560031
085700     AND ASC-DEBIT-DESTROY-IND  = SPACE                           08570031
085800     AND ASC-MARKOUT-IND        = SPACE                           08580031
085900        IF ASC-VND-AUTH-ID NOT = SPACE                            08590040
086000           PERFORM 3060-AUTH-ID-NOT-ALLOWED                       08600040
086100        END-IF                                                    08610040
086200     ELSE                                                         08620031
086300        IF  ASC-RTV-RA-REQD-IND        = 'Y'                      08630031
086400        AND ASC-RTV-NO-RA-REQD-IND NOT = 'Y'                      08640031
086500        AND ASC-DEBIT-DESTROY-IND  NOT = 'Y'                      08650031
086600        AND ASC-MARKOUT-IND        NOT = 'Y'                      08660031
086700            MOVE 'N' TO ASC-RTV-NO-RA-REQD-IND ARTVNRQO           08670031
086800                        ASC-DEBIT-DESTROY-IND  ADBTDSTO           08680031
086900                        ASC-MARKOUT-IND        AMKOUTO            08690032
087000        ELSE                                                      08700031
087100            IF  ASC-RTV-NO-RA-REQD-IND    = 'Y'                   08710031
087200            AND ASC-RTV-RA-REQD-IND   NOT = 'Y'                   08720031
087300            AND ASC-DEBIT-DESTROY-IND NOT = 'Y'                   08730031
087400            AND ASC-MARKOUT-IND       NOT = 'Y'                   08740031
087500                MOVE 'N' TO ASC-RTV-RA-REQD-IND    ARTVRQDO       08750031
087600                            ASC-DEBIT-DESTROY-IND  ADBTDSTO       08760031
087700                            ASC-MARKOUT-IND        AMKOUTO        08770032
087800                IF ASC-VND-AUTH-ID NOT = SPACE                    08780040
087900                   PERFORM 3060-AUTH-ID-NOT-ALLOWED               08790040
088000                END-IF                                            08800040
088100            ELSE                                                  08810031
088200                IF  ASC-DEBIT-DESTROY-IND      = 'Y'              08820031
088300                AND ASC-RTV-RA-REQD-IND    NOT = 'Y'              08830031
088400                AND ASC-RTV-NO-RA-REQD-IND NOT = 'Y'              08840031
088500                AND ASC-MARKOUT-IND        NOT = 'Y'              08850031
088600                    MOVE 'N' TO ASC-RTV-RA-REQD-IND  ARTVRQDO     08860031
088700                              ASC-RTV-NO-RA-REQD-IND ARTVNRQO     08870031
088800                              ASC-MARKOUT-IND        AMKOUTO      08880032
088900                    IF ASC-VND-AUTH-ID NOT = SPACE                08890040
089000                       PERFORM 3060-AUTH-ID-NOT-ALLOWED           08900040
089100                    END-IF                                        08910040
089200                ELSE                                              08920031
089300                    IF  ASC-MARKOUT-IND            = 'Y'          08930031
089400                    AND ASC-RTV-RA-REQD-IND    NOT = 'Y'          08940031
089500                    AND ASC-RTV-NO-RA-REQD-IND NOT = 'Y'          08950031
089600                    AND ASC-DEBIT-DESTROY-IND  NOT = 'Y'          08960031
089700                        MOVE 'N' TO ASC-RTV-RA-REQD-IND           08970031
089800                                    ARTVRQDO                      08980031
089900                                    ASC-RTV-NO-RA-REQD-IND        08990031
090000                                    ARTVNRQO                      09000031
090100                                    ASC-DEBIT-DESTROY-IND         09010031
090200                                    ADBTDSTO                      09020031
090300                        IF ASC-VND-AUTH-ID NOT = SPACE            09030040
090400                           PERFORM 3060-AUTH-ID-NOT-ALLOWED       09040040
090500                        END-IF                                    09050040
090600                    ELSE                                          09060031
090700                        IF  ASC-MARKOUT-IND            = 'N'      09070031
090800                        AND ASC-RTV-RA-REQD-IND        = 'N'      09080031
090900                        AND ASC-RTV-NO-RA-REQD-IND     = 'N'      09090031
091000                        AND ASC-DEBIT-DESTROY-IND      = 'N'      09100031
091100                            IF ASC-VND-AUTH-ID NOT = SPACE        09110040
091200                               PERFORM 3060-AUTH-ID-NOT-ALLOWED   09120040
091300                            END-IF                                09130040
091400                        END-IF                                    09140031
091500                    END-IF                                        09150031
091600                END-IF                                            09160031
091700            END-IF                                                09170031
091800        END-IF                                                    09180031
091900     END-IF.                                                      09190031
092000                                                                  09200033
092100******************************************************************09210033
092200*   MARKOUT INDICATOR MUST BE 'Y' OR 'N'                          09220033
092300******************************************************************09230033
092400     IF ASC-MARKOUT-IND NOT = 'Y' AND 'N'                         09240034
092500        SET PS-ERROR                                              09250034
092600            DP020-MSG-FATAL                                       09260034
092700            DP030-SET-CURSOR-APPL-1 TO TRUE                       09270034
092800        MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                  09280034
092900        MOVE -1                    TO AMKOUTL                     09290034
093000        MOVE DP015-UNP-ALP-BRT-OFF TO AMKOUTA                     09300034
093100        MOVE DP015-RED             TO AMKOUTC                     09310034
093200        MOVE DP015-REVERSE         TO AMKOUTH                     09320034
093300     END-IF.                                                      09330034
093400                                                                  09340033
093500******************************************************************09350033
093600*   DEBIT AND DESTROY INDICATOR MUST BE 'Y' OR 'N'                09360033
093700******************************************************************09370033
093800     IF ASC-DEBIT-DESTROY-IND NOT = 'Y' AND 'N'                   09380034
093900        SET PS-ERROR                                              09390034
094000            DP020-MSG-FATAL                                       09400034
094100            DP030-SET-CURSOR-APPL-1 TO TRUE                       09410034
094200        MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                  09420034
094300        MOVE -1                    TO ADBTDSTL                    09430034
094400        MOVE DP015-UNP-ALP-BRT-OFF TO ADBTDSTA                    09440034
094500        MOVE DP015-RED             TO ADBTDSTC                    09450034
094600        MOVE DP015-REVERSE         TO ADBTDSTH                    09460034
094700     END-IF.                                                      09470034
094800                                                                  09480033
094900******************************************************************09490033
095000*   RTV NO RA REQUIRED INDICATOR MUST BE 'Y' OR 'N'               09500033
095100******************************************************************09510033
095200     IF ASC-RTV-NO-RA-REQD-IND NOT = 'Y' AND 'N'                  09520034
095300        SET PS-ERROR                                              09530034
095400            DP020-MSG-FATAL                                       09540034
095500            DP030-SET-CURSOR-APPL-1 TO TRUE                       09550034
095600        MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                  09560034
095700        MOVE -1                    TO ARTVNRQL                    09570034
095800        MOVE DP015-UNP-ALP-BRT-OFF TO ARTVNRQA                    09580034
095900        MOVE DP015-RED             TO ARTVNRQC                    09590034
096000        MOVE DP015-REVERSE         TO ARTVNRQH                    09600034
096100     END-IF.                                                      09610034
096200                                                                  09620033
096300******************************************************************09630033
096400*   RTV RA REQUIRED INDICATOR MUST BE 'Y' OR 'N'                  09640033
096500******************************************************************09650033
096600     IF ASC-RTV-RA-REQD-IND NOT = 'Y' AND 'N'                     09660034
096700        SET PS-ERROR                                              09670034
096800            DP020-MSG-FATAL                                       09680034
096900            DP030-SET-CURSOR-APPL-1 TO TRUE                       09690034
097000        MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                  09700034
097100        MOVE -1                    TO ARTVRQDL                    09710034
097200        MOVE DP015-UNP-ALP-BRT-OFF TO ARTVRQDA                    09720034
097300        MOVE DP015-RED             TO ARTVRQDC                    09730034
097400        MOVE DP015-REVERSE         TO ARTVRQDH                    09740034
097500     END-IF.                                                      09750034
097600                                                                  09760033
097700******************************************************************09770026
097800*   VENDOR AUTHORIZATION ID EDIT                                  09780026
097900******************************************************************09790026
098000     IF (ASC-VND-AUTH-ID NOT = SPACES) AND                        09800031
098100        (ASC-RTV-RA-REQD-IND = 'Y')                               09810031
098200        PERFORM 3040-EDIT-VND-AUTH-ID                             09820031
098300        IF PS-INVALID-AUTH-ID                                     09830031
098400           SET PS-ERROR                                           09840031
098500               DP020-MSG-FATAL                                    09850031
098600               DP030-SET-CURSOR-APPL-1 TO TRUE                    09860031
098700           MOVE PC-TSYMSG-03104 TO DP020-MSG-NUMBER               09870031
098800           MOVE -1                    TO AAUTHIDL                 09880031
098900           MOVE DP015-UNP-ALP-BRT-OFF TO AAUTHIDA                 09890031
099000           MOVE DP015-RED             TO AAUTHIDC                 09900031
099100           MOVE DP015-REVERSE         TO AAUTHIDH                 09910031
099200        END-IF                                                    09920031
099300     END-IF.                                                      09930026
099400                                                                  09940026
099500******************************************************************09950026
099600*   EDIT THE VENDOR AUTHORIZATION ID.  IT CAN BE FREE-FORM, 10    09960026
099700*   POSITIONS LONG. SPECIAL CHARACTERS AND IMBEDDED SPACES ARE    09970026
099800*   NOT ALLOWED, ONLY A-Z AND 0-9 ARE USED. THE ONLY SPACES       09980026
099900*   ALLOWED ARE THOSE TRAILING AFTER ALL SIGNIFICANT POSITIONS.   09990026
100000******************************************************************10000026
100100 3040-EDIT-VND-AUTH-ID.                                           10010026
100200                                                                  10020026
100300     MOVE ZEROES TO PV-LASTPOS.                                   10030039
100400     MOVE SPACES TO PV-STRING.                                    10040039
100500     MOVE ASC-VND-AUTH-ID TO PV-STRING.                           10050039
100600     MOVE LENGTH OF PV-STRING TO PV-LASTPOS.                      10060039
100700                                                                  10070039
100800     PERFORM                                                      10080039
100900        UNTIL PV-STRING(PV-LASTPOS:1) > SPACES OR                 10090039
101000              PV-LASTPOS = +0                                     10100039
101100        COMPUTE PV-LASTPOS = PV-LASTPOS - 1                       10110039
101200     END-PERFORM.                                                 10120039
101300                                                                  10130039
101400     SET PS-VALID-AUTH-ID TO TRUE.                                10140039
101500     MOVE SPACES TO PV-AUTHID.                                    10150039
101600     MOVE ASC-VND-AUTH-ID TO PV-AUTHID.                           10160039
101700                                                                  10170039
101800     PERFORM 3050-CHECK-AUTH-ID                                   10180039
101900        VARYING AUTHID-INDX FROM 1 BY 1                           10190039
102000          UNTIL AUTHID-INDX > PV-LASTPOS                          10200039
102100             OR PS-INVALID-AUTH-ID.                               10210039
102200                                                                  10220039
102300 3050-CHECK-AUTH-ID.                                              10230039
102400                                                                  10240039
102500     MOVE PV-AUTHID-ONE(AUTHID-INDX) TO PC-VALID-CHARS.           10250039
102600                                                                  10260039
102700     IF NOT VALID-CHARS                                           10270039
102800        SET PS-INVALID-AUTH-ID TO TRUE                            10280039
102900     END-IF.                                                      10290039
103000                                                                  10300039
103100******************************************************************10310040
103200*   ERROR MESSAGE SET FOR ANYTHING IN THE AUTHORIZATION ID EXCEPT 10320040
103300*   WHEN RTV RA REQUIRED INDICATOR = 'Y'                          10330040
103400******************************************************************10340040
103500 3060-AUTH-ID-NOT-ALLOWED.                                        10350040
103600                                                                  10360040
103700     SET PS-ERROR                                                 10370040
103800         DP020-MSG-FATAL                                          10380040
103900         DP030-SET-CURSOR-APPL-1 TO TRUE.                         10390040
104000     MOVE PC-TSYMSG-03125 TO DP020-MSG-NUMBER.                    10400040
104100     MOVE -1                    TO AAUTHIDL.                      10410040
104200     MOVE DP015-UNP-ALP-BRT-OFF TO AAUTHIDA.                      10420040
104300     MOVE DP015-RED             TO AAUTHIDC.                      10430040
104400     MOVE DP015-REVERSE         TO AAUTHIDH.                      10440040
104500                                                                  10450040
104600                                                                  10460040
104700******************************************************************10470026
104800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **10480026
104900******************************************************************10490026
105000                                                                  10500026
105100 3200-RESET-ATTRIBUTES.                                           10510026
105200                                                                  10520026
105300     MOVE DP015-UNP-ALP-NOR-OFF    TO ARTVRQDA                    10530026
105400                                      ARTVNRQA                    10540026
105500                                      ADBTDSTA                    10550026
105600                                      AMKOUTA                     10560026
105700                                      AAUTHIDA                    10570026
105800                                      ACMNT01A                    10580026
105900                                      ACMNT02A                    10590026
106000                                      ACMNT03A.                   10600026
106100                                                                  10610026
106200     MOVE DP015-GREEN              TO ARTVRQDC                    10620026
106300                                      ARTVNRQC                    10630026
106400                                      ADBTDSTC                    10640026
106500                                      AMKOUTC                     10650026
106600                                      AAUTHIDC                    10660026
106700                                      ACMNT01C                    10670026
106800                                      ACMNT02C                    10680026
106900                                      ACMNT03C.                   10690026
107000                                                                  10700026
107100     MOVE DP015-UNDERLINE          TO ARTVRQDH                    10710026
107200                                      ARTVNRQH                    10720026
107300                                      ADBTDSTH                    10730026
107400                                      AMKOUTH                     10740026
107500                                      AAUTHIDH                    10750026
107600                                      ACMNT01H                    10760026
107700                                      ACMNT02H                    10770026
107800                                      ACMNT03H.                   10780026
107900                                                                  10790026
108000                                                                  10800026
108100*                                                                 10810026
108200******************************************************************10820026
108300*    SAVE SCREEN FIELDS FOR LATER COMPARISON                      10830026
108400******************************************************************10840026
108500 3500-SAVE-SCREEN-FIELDS.                                         10850026
108600                                                                  10860026
108700     MOVE ASC-RTV-RA-REQD-IND      TO ASC-RTV-RA-REQD-IND-O.      10870026
108800     MOVE ASC-RTV-NO-RA-REQD-IND   TO ASC-RTV-NO-RA-REQD-IND-O.   10880026
108900     MOVE ASC-DEBIT-DESTROY-IND    TO ASC-DEBIT-DESTROY-IND-O.    10890026
109000     MOVE ASC-MARKOUT-IND          TO ASC-MARKOUT-IND-O.          10900026
109100     MOVE ASC-VND-AUTH-ID          TO ASC-VND-AUTH-ID-O.          10910026
109200     MOVE ASC-INSTR-TEXT1          TO ASC-INSTR-TEXT1-O.          10920026
109300     MOVE ASC-INSTR-TEXT2          TO ASC-INSTR-TEXT2-O.          10930026
109400     MOVE ASC-INSTR-TEXT3          TO ASC-INSTR-TEXT3-O.          10940026
109500                                                                  10950026
109600                                                                  10960026
109700 3600-COMPARE-SCREEN-FIELDS.                                      10970026
109800                                                                  10980026
109900     SET PS-NO-FIELDS-CHANGED TO TRUE.                            10990026
110000                                                                  11000026
110100     IF ASC-RTV-RA-REQD-IND      NOT = ASC-RTV-RA-REQD-IND-O    OR11010026
110200        ASC-RTV-NO-RA-REQD-IND   NOT = ASC-RTV-NO-RA-REQD-IND-O OR11020026
110300        ASC-DEBIT-DESTROY-IND    NOT = ASC-DEBIT-DESTROY-IND-O  OR11030026
110400        ASC-MARKOUT-IND          NOT = ASC-MARKOUT-IND-O        OR11040026
110500        ASC-VND-AUTH-ID          NOT = ASC-VND-AUTH-ID-O        OR11050026
110600        ASC-INSTR-TEXT1          NOT = ASC-INSTR-TEXT1-O        OR11060026
110700        ASC-INSTR-TEXT2          NOT = ASC-INSTR-TEXT2-O        OR11070026
110800        ASC-INSTR-TEXT3          NOT = ASC-INSTR-TEXT3-O          11080026
110900         SET PS-FIELDS-CHANGED TO TRUE.                           11090026
111000                                                                  11100026
111100******************************************************************11110026
111200** SELECT INFORMATION FOR THE INITIAL PANEL                     **11120026
111300******************************************************************11130026
111400 4000-BUILD-INITIAL-PANEL.                                        11140026
111500                                                                  11150026
111600     SET PS-NO-ERROR                                              11160026
111700         DP030-SET-CURSOR-TRAILER TO TRUE.                        11170026
111800                                                                  11180026
111900     PERFORM 4010-GET-HEADING-INFO.                               11190026
112000                                                                  11200026
112100     PERFORM 4020-GET-PAYT-TERM-ID.                               11210026
112200                                                                  11220026
112300     PERFORM 4030-GET-PAYMENT-TERMS.                              11230026
112400                                                                  11240026
112500     PERFORM 4040-GET-SHIPPING-TERMS.                             11250026
112600                                                                  11260026
112700     PERFORM 4050-GET-PURCHASE-TERMS.                             11270026
112800                                                                  11280026
112900     PERFORM 4060-GET-RTV-INSTRUCTIONS.                           11290026
113000                                                                  11300026
113100     IF PS-NO-ERROR                                               11310026
113200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                    11320026
113300                                                                  11330026
113400 4010-GET-HEADING-INFO.                                           11340026
113500                                                                  11350026
113600     PERFORM WITH TEST AFTER                                      11360026
113700             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                11370026
113800             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         11380026
113900                     SQLCODE = ZERO OR                            11390026
114000                     SQLCODE = +100                               11400026
114100                                                                  11410026
114200     EXEC SQL                                                     11420026
114300          SELECT A.INHOUSE_NBR                                    11430026
114400                ,B.ENT_NAME_DESC                                  11440026
114500                ,C.DUN_NBR                                        11450026
114600            INTO :VNDDPT-INHOUSE-NBR                              11460026
114700                ,:ENTNME-ENT-NAME-DESC                            11470026
114800                ,:EXTENT-DUN-NBR                                  11480026
114900                 :NI-EXTENT-DUN-NBR                               11490026
115000            FROM TVNDDPT A, TENTNME B, TEXTENT C                  11500026
115100           WHERE A.ENT_ID   = :ASC-ENT-ID                         11510026
115200             AND A.DEPT_NBR = :ASC-DEPARTMENT                     11520026
115300             AND A.ENT_ID   = B.ENT_ID                            11530026
115400             AND B.SEQ_NBR  =                                     11540026
115500                 (SELECT MAX(SEQ_NBR)                             11550026
115600                    FROM TENTNME                                  11560026
115700                   WHERE ENT_ID   = :ASC-ENT-ID                   11570026
115800                     AND TYPE_CDE = :PC-PRIMARY)                  11580026
115900             AND B.TYPE_CDE = :PC-PRIMARY                         11590026
116000             AND A.ENT_ID   = C.ENT_ID                            11600026
116100     END-EXEC                                                     11610026
116200                                                                  11620026
116300     EVALUATE TRUE                                                11630026
116400         WHEN SQLCODE = ZERO                                      11640026
116500         WHEN SQLCODE = -904                                      11650026
116600         WHEN SQLCODE = -913                                      11660026
116700              CONTINUE                                            11670026
116800                                                                  11680026
116900         WHEN SQLWARN0 NOT = SPACES                               11690026
117000         WHEN SQLCODE  NOT = ZERO                                 11700026
117100              MOVE '4010-GET-HEADING-INFO' TO DP013-PARAGRAPH     11710026
117200              MOVE 'UNSUCCESSFUL SELECT HEADING INFO' TO          11720026
117300                                            DP013-MESSAGE-TEXT (1)11730026
117400              MOVE SQLCA TO DP013-SQLCA                           11740026
117500              MOVE 'TVNDDPT ' TO DP013-DB2-TABLE-NAME (1)         11750026
117600              MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)         11760026
117700              MOVE 'TEXTENT ' TO DP013-DB2-TABLE-NAME (3)         11770026
117800              SET DP013-DB2-ABEND                                 11780026
117900                  DP013-XCTL-DISPLAY-RESTART TO TRUE              11790026
118000                                                                  11800026
118100              PERFORM DP013-0000-PROCESS-ABEND                    11810026
118200     END-EVALUATE                                                 11820026
118300     END-PERFORM.                                                 11830026
118400                                                                  11840026
118500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         11850026
118600         MOVE '4010-GET-HEADING-INFO' TO DP013-PARAGRAPH          11860026
118700         MOVE 'MAX RETRIES EXCEEDED ON SELECT HEADING INFO' TO    11870026
118800                                            DP013-MESSAGE-TEXT (1)11880026
118900         MOVE SQLCA      TO DP013-SQLCA                           11890026
119000         MOVE 'TEXTENT ' TO DP013-DB2-TABLE-NAME (1)              11900026
119100         MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)              11910026
119200         SET DP013-DB2-ABEND                                      11920026
119300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   11930026
119400                                                                  11940026
119500         PERFORM DP013-0000-PROCESS-ABEND                         11950026
119600     END-IF.                                                      11960026
119700                                                                  11970026
119800     IF SQLCODE = ZERO                                            11980026
119900         MOVE VNDDPT-INHOUSE-NBR   TO ASC-INHOUSE-NBR             11990026
120000         MOVE ENTNME-ENT-NAME-DESC TO ASC-ENT-NAME-DESC           12000026
120100         IF NI-EXTENT-DUN-NBR = -1                                12010026
120200             MOVE SPACES           TO ASC-DUN-NBR                 12020026
120300         ELSE                                                     12030026
120400             MOVE EXTENT-DUN-NBR   TO ASC-DUN-NBR                 12040026
120500         END-IF                                                   12050026
120600     END-IF.                                                      12060026
120700                                                                  12070026
120800 4020-GET-PAYT-TERM-ID.                                           12080026
120900                                                                  12090026
121000     PERFORM WITH TEST AFTER                                      12100026
121100             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                12110026
121200             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         12120026
121300                     SQLCODE = ZERO OR                            12130026
121400                     SQLCODE = +100                               12140026
121500                                                                  12150026
121600     EXEC SQL                                                     12160026
121700          SELECT PAYT_TERM_ID                                     12170026
121800            INTO :VNDAGR-PAYT-TERM-ID                             12180026
121900                 :NI-VNDAGR-PAYT-TERM-ID                          12190026
122000            FROM TVNDAGR                                          12200026
122100           WHERE ENT_ID            = :ASC-ENT-ID                  12210026
122200             AND DEPT_NBR          = :ASC-DEPARTMENT              12220026
122300             AND AGRMT_TYP_ID      = :PC-PAYMENT                  12230026
122400             AND SEQ_NBR           =                              12240026
122500                 (SELECT MAX(SEQ_NBR)                             12250026
122600                    FROM TVNDAGR                                  12260026
122700                   WHERE ENT_ID            = :ASC-ENT-ID          12270026
122800                     AND DEPT_NBR          = :ASC-DEPARTMENT      12280026
122900                     AND AGRMT_TYP_ID      = :PC-PAYMENT)         12290026
123000     END-EXEC                                                     12300026
123100                                                                  12310026
123200     EVALUATE TRUE                                                12320026
123300         WHEN SQLCODE = ZERO                                      12330026
123400         WHEN SQLCODE = +100                                      12340026
123500         WHEN SQLCODE = -904                                      12350026
123600         WHEN SQLCODE = -913                                      12360026
123700              CONTINUE                                            12370026
123800                                                                  12380026
123900         WHEN SQLWARN0 NOT = SPACES                               12390026
124000         WHEN SQLCODE  NOT = ZERO                                 12400026
124100              MOVE '4020-GET-PAYT-TERM-ID' TO DP013-PARAGRAPH     12410026
124200              MOVE 'UNSUCCESSFUL SELECT PAY TERM ID' TO           12420026
124300                                            DP013-MESSAGE-TEXT (1)12430026
124400              MOVE SQLCA TO DP013-SQLCA                           12440026
124500              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         12450026
124600              SET DP013-DB2-ABEND                                 12460026
124700                  DP013-XCTL-DISPLAY-RESTART TO TRUE              12470026
124800                                                                  12480026
124900              PERFORM DP013-0000-PROCESS-ABEND                    12490026
125000     END-EVALUATE                                                 12500026
125100     END-PERFORM.                                                 12510026
125200                                                                  12520026
125300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         12530026
125400         MOVE '4020-GET-PAYT-TERM-ID' TO DP013-PARAGRAPH          12540026
125500         MOVE 'MAX RETRIES EXCEEDED ON SELECT PAY TERM ID' TO     12550026
125600                                            DP013-MESSAGE-TEXT (1)12560026
125700         MOVE SQLCA      TO DP013-SQLCA                           12570026
125800         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              12580026
125900         SET DP013-DB2-ABEND                                      12590026
126000             DP013-XCTL-DISPLAY-RESTART TO TRUE                   12600026
126100                                                                  12610026
126200         PERFORM DP013-0000-PROCESS-ABEND                         12620026
126300     END-IF.                                                      12630026
126400                                                                  12640026
126500     IF SQLCODE = ZERO                                            12650026
126600        IF NI-VNDAGR-PAYT-TERM-ID = -1                            12660026
126700            MOVE ZERO               TO ASC-PAYT-TERM-ID           12670026
126800        ELSE                                                      12680026
126900            MOVE VNDAGR-PAYT-TERM-ID TO ASC-PAYT-TERM-ID          12690026
127000        END-IF                                                    12700026
127100     END-IF.                                                      12710026
127200                                                                  12720026
127300 4030-GET-PAYMENT-TERMS.                                          12730026
127400                                                                  12740026
127500     PERFORM WITH TEST AFTER                                      12750026
127600             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                12760026
127700             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         12770026
127800                     SQLCODE = ZERO OR                            12780026
127900                     SQLCODE = +100                               12790026
128000                                                                  12800026
128100     EXEC SQL                                                     12810026
128200          SELECT DISCOUNT_DAYS_QTY                                12820026
128300                ,DISCOUNT_PCT                                     12830026
128400                ,DUE_DAY_QTY                                      12840026
128500                ,DUE_DAY_FR_DTE_TXT                               12850026
128600                ,OTHER_TXT                                        12860026
128700            INTO :PAYTRM-DISCOUNT-DAYS-QTY                        12870026
128800                ,:PAYTRM-DISCOUNT-PCT                             12880026
128900                ,:PAYTRM-DUE-DAY-QTY                              12890026
129000                ,:PAYTRM-DUE-DAY-FR-DTE-TXT                       12900026
129100                ,:PAYTRM-OTHER-TXT                                12910026
129200            FROM TPAYTRM                                          12920026
129300           WHERE PAY_TERM_ID = :ASC-PAYT-TERM-ID                  12930026
129400     END-EXEC                                                     12940026
129500                                                                  12950026
129600     EVALUATE TRUE                                                12960026
129700         WHEN SQLCODE = ZERO                                      12970026
129800         WHEN SQLCODE = +100                                      12980026
129900         WHEN SQLCODE = -904                                      12990026
130000         WHEN SQLCODE = -913                                      13000026
130100              CONTINUE                                            13010026
130200                                                                  13020026
130300         WHEN SQLWARN0 NOT = SPACES                               13030026
130400         WHEN SQLCODE  NOT = ZERO                                 13040026
130500              MOVE '4030-GET-PAYMENT-TERMS' TO DP013-PARAGRAPH    13050026
130600              MOVE 'UNSUCCESSFUL SELECT PAYMENT TERMS' TO         13060026
130700                                            DP013-MESSAGE-TEXT (1)13070026
130800              MOVE SQLCA TO DP013-SQLCA                           13080026
130900              MOVE 'TPAYTRM ' TO DP013-DB2-TABLE-NAME (1)         13090026
131000              SET DP013-DB2-ABEND                                 13100026
131100                  DP013-XCTL-DISPLAY-RESTART TO TRUE              13110026
131200                                                                  13120026
131300              PERFORM DP013-0000-PROCESS-ABEND                    13130026
131400     END-EVALUATE                                                 13140026
131500     END-PERFORM.                                                 13150026
131600                                                                  13160026
131700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         13170026
131800         MOVE '4030-GET-PAYT-TERM-ID' TO DP013-PARAGRAPH          13180026
131900         MOVE 'MAX RETRIES EXCEEDED ON SELECT PAYMENT TERMS' TO   13190026
132000                                            DP013-MESSAGE-TEXT (1)13200026
132100         MOVE SQLCA      TO DP013-SQLCA                           13210026
132200         MOVE 'TPAYTRM ' TO DP013-DB2-TABLE-NAME (1)              13220026
132300         SET DP013-DB2-ABEND                                      13230026
132400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   13240026
132500                                                                  13250026
132600         PERFORM DP013-0000-PROCESS-ABEND                         13260026
132700     END-IF.                                                      13270026
132800                                                                  13280026
132900     IF SQLCODE = ZERO                                            13290026
133000         PERFORM 4035-FORMAT-PAYT-TERM-DESC                       13300026
133100*                                                                 13310026
133200*        MULTIPLY PAYTRM-DISCOUNT-PCT BY +100 GIVING              13320026
133300*                                         PV-NUM-DISCOUNT-PCT     13330026
133400*        MOVE PV-NUM-DISCOUNT-PCT      TO PV-EDIT-DISCOUNT-PCT    13340026
133500*        MOVE PAYTRM-DISCOUNT-DAYS-QTY TO PV-EDIT-DISCOUNT-DAYS   13350026
133600*        MOVE PAYTRM-DUE-DAY-QTY       TO PV-EDIT-DUE-DAYS        13360026
133700*        IF PV-EDIT-DISCOUNT-PCT > SPACES                         13370026
133800*           IF PV-EDIT-DISCOUNT-DAYS > SPACES                     13380026
133900*              IF PV-EDIT-DUE-DAYS > SPACES                       13390026
134000*                 IF PAYTRM-DUE-DAY-FR-DTE-TXT > SPACES           13400026
134100*                     STRING PV-EDIT-DISCOUNT-PCT ' % '           13410026
134200*                            PV-EDIT-DISCOUNT-DAYS ' DAYS NET '   13420026
134300*                            PV-EDIT-DUE-DAYS ' '                 13430026
134400*                            DELIMITED BY SIZE                    13440026
134500*                            PAYTRM-DUE-DAY-FR-DTE-TXT            13450026
134600*                            DELIMITED BY ' '                     13460026
134700*                            INTO ASC-PAYMENT-TERMS               13470026
134800*                 ELSE                                            13480026
134900*                     STRING PV-EDIT-DISCOUNT-PCT ' % '           13490026
135000*                            PV-EDIT-DISCOUNT-DAYS ' DAYS NET '   13500026
135100*                            PV-EDIT-DUE-DAYS ' '                 13510026
135200*                            DELIMITED BY SIZE                    13520026
135300*                            INTO ASC-PAYMENT-TERMS               13530026
135400*                 END-IF                                          13540026
135500*              ELSE                                               13550026
135600*                  IF PAYTRM-DUE-DAY-FR-DTE-TXT > SPACES          13560026
135700*                      STRING PV-EDIT-DISCOUNT-PCT ' % '          13570026
135800*                             PV-EDIT-DISCOUNT-DAYS ' DAYS '      13580026
135900*                             DELIMITED BY SIZE                   13590026
136000*                             PAYTRM-DUE-DAY-FR-DTE-TXT           13600026
136100*                             DELIMITED BY ' '                    13610026
136200*                             INTO ASC-PAYMENT-TERMS              13620026
136300*                  ELSE                                           13630026
136400*                      STRING PV-EDIT-DISCOUNT-PCT ' % '          13640026
136500*                             PV-EDIT-DISCOUNT-DAYS ' DAYS '      13650026
136600*                             DELIMITED BY SIZE                   13660026
136700*                             INTO ASC-PAYMENT-TERMS              13670026
136800*                  END-IF                                         13680026
136900*              END-IF                                             13690026
137000*           END-IF                                                13700026
137100*        ELSE                                                     13710026
137200*            IF PV-EDIT-DUE-DAYS > SPACES                         13720026
137300*               IF PAYTRM-DUE-DAY-FR-DTE-TXT > SPACES             13730026
137400*                   STRING 'NET '                                 13740026
137500*                          PV-EDIT-DUE-DAYS ' '                   13750026
137600*                          DELIMITED BY SIZE                      13760026
137700*                          PAYTRM-DUE-DAY-FR-DTE-TXT              13770026
137800*                          DELIMITED BY ' '                       13780026
137900*                          INTO ASC-PAYMENT-TERMS                 13790026
138000*               ELSE                                              13800026
138100*                   STRING 'NET '                                 13810026
138200*                          PV-EDIT-DUE-DAYS                       13820026
138300*                          DELIMITED BY SIZE                      13830026
138400*                          INTO ASC-PAYMENT-TERMS                 13840026
138500*               END-IF                                            13850026
138600*            END-IF                                               13860026
138700         END-IF.                                                  13870026
138800                                                                  13880026
138900     IF SQLCODE = +100                                            13890026
139000         MOVE SPACES TO ASC-PAYT-TERM-ID-DESC.                    13900026
139100                                                                  13910026
139200 4035-FORMAT-PAYT-TERM-DESC.                                      13920026
139300                                                                  13930026
139400     COPY POPD001.                                                13940026
139500                                                                  13950026
139600 4040-GET-SHIPPING-TERMS.                                         13960026
139700                                                                  13970026
139800     PERFORM WITH TEST AFTER                                      13980026
139900             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                13990026
140000             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         14000026
140100                     SQLCODE = ZERO OR                            14010026
140200                     SQLCODE = +100                               14020026
140300                                                                  14030026
140400     EXEC SQL                                                     14040026
140500          SELECT VT1.FOB_POINT_TXT                                14050026
140600                ,VT1.SHIPT_POINT_TXT                              14060026
140700                ,COALESCE(B.FRGT_TERM_ID,0)                       14070026
140800                ,COALESCE(B.KOHLS_FRGT_PCT,0)                     14080026
140900                ,COALESCE(B.VND_FRGT_PCT,0)                       14090026
141000            INTO :VNDAGR-FOB-POINT-TXT                            14100026
141100                 :NI-VNDAGR-FOB-POINT-TXT                         14110026
141200                ,:VNDAGR-SHIPT-POINT-TXT                          14120026
141300                 :NI-VNDAGR-SHIPT-POINT-TXT                       14130026
141400                ,:FRGTRM-FRGT-TERM-ID                             14140026
141500                ,:FRGTRM-KOHLS-FRGT-PCT                           14150026
141600                ,:FRGTRM-VND-FRGT-PCT                             14160026
141700            FROM                                                  14170026
141800               (SELECT A.FOB_POINT_TXT                            14180026
141900                      ,A.SHIPT_POINT_TXT                          14190026
142000                      ,A.FRGT_TERM_ID                             14200026
142100                  FROM TVNDAGR A                                  14210026
142200                 WHERE ENT_ID            = :ASC-ENT-ID            14220026
142300                   AND DEPT_NBR          = :ASC-DEPARTMENT        14230026
142400                   AND AGRMT_TYP_ID      = '1'                    14240026
142500                   AND SEQ_NBR           =                        14250026
142600                       (SELECT MAX(SEQ_NBR)                       14260026
142700                          FROM TVNDAGR                            14270026
142800                         WHERE ENT_ID       = :ASC-ENT-ID         14280026
142900                           AND DEPT_NBR     = :ASC-DEPARTMENT     14290026
143000                           AND AGRMT_TYP_ID = :PC-SHIPPING))      14300026
143100                                           AS VT1                 14310026
143200            LEFT OUTER JOIN TFRGTRM B                             14320026
143300              ON B.FRGT_TERM_ID = VT1.FRGT_TERM_ID                14330026
143400     END-EXEC                                                     14340026
143500                                                                  14350026
143600     EVALUATE TRUE                                                14360026
143700         WHEN SQLCODE = ZERO                                      14370026
143800         WHEN SQLCODE = +100                                      14380026
143900         WHEN SQLCODE = -904                                      14390026
144000         WHEN SQLCODE = -913                                      14400026
144100              CONTINUE                                            14410026
144200                                                                  14420026
144300         WHEN SQLWARN0 NOT = SPACES                               14430026
144400         WHEN SQLCODE  NOT = ZERO                                 14440026
144500              MOVE '4040-GET-SHIPPING-TERMS' TO DP013-PARAGRAPH   14450026
144600              MOVE 'UNSUCCESSFUL SELECT SHIPPING TERMS' TO        14460026
144700                                            DP013-MESSAGE-TEXT (1)14470026
144800              MOVE SQLCA TO DP013-SQLCA                           14480026
144900              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         14490026
145000              SET DP013-DB2-ABEND                                 14500026
145100                  DP013-XCTL-DISPLAY-RESTART TO TRUE              14510026
145200                                                                  14520026
145300              PERFORM DP013-0000-PROCESS-ABEND                    14530026
145400     END-EVALUATE                                                 14540026
145500     END-PERFORM.                                                 14550026
145600                                                                  14560026
145700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         14570026
145800         MOVE '4040-GET-SHIPPING-TERMS' TO DP013-PARAGRAPH        14580026
145900         MOVE 'MAX RETRIES EXCEEDED ON SELECT SHIPPING TERMS' TO  14590026
146000                                            DP013-MESSAGE-TEXT (1)14600026
146100         MOVE SQLCA      TO DP013-SQLCA                           14610026
146200         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              14620026
146300         SET DP013-DB2-ABEND                                      14630026
146400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   14640026
146500                                                                  14650026
146600         PERFORM DP013-0000-PROCESS-ABEND                         14660026
146700     END-IF.                                                      14670026
146800                                                                  14680026
146900     IF SQLCODE = ZERO                                            14690026
147000        IF NI-VNDAGR-FOB-POINT-TXT = -1                           14700026
147100            MOVE SPACES               TO ASC-FOB-POINT-TXT        14710026
147200        ELSE                                                      14720026
147300            MOVE VNDAGR-FOB-POINT-TXT TO ASC-FOB-POINT-TXT        14730026
147400        END-IF                                                    14740026
147500        IF NI-VNDAGR-SHIPT-POINT-TXT = -1                         14750026
147600            MOVE SPACES                  TO ASC-SHIPT-POINT-TXT   14760026
147700        ELSE                                                      14770026
147800            MOVE VNDAGR-SHIPT-POINT-TXT TO ASC-SHIPT-POINT-TXT    14780026
147900        END-IF                                                    14790026
148000                                                                  14800026
148100        MOVE FRGTRM-FRGT-TERM-ID   TO ASC-FRGT-TERM-ID            14810026
148200        MOVE FRGTRM-KOHLS-FRGT-PCT TO ASC-KOHLS-FRGT-PCT          14820026
148300        MOVE FRGTRM-VND-FRGT-PCT   TO ASC-VEND-FRGT-PCT           14830026
148400                                                                  14840026
148500        IF FRGTRM-KOHLS-FRGT-PCT = 1.00                           14850026
148600           MOVE 'K' TO ASC-FRGT-PAYT-CDE                          14860026
148700        ELSE                                                      14870026
148800           IF FRGTRM-VND-FRGT-PCT = 1.00                          14880026
148900              MOVE 'V' TO ASC-FRGT-PAYT-CDE                       14890026
149000           ELSE                                                   14900026
149100              IF FRGTRM-KOHLS-FRGT-PCT > 0 AND                    14910026
149200                 FRGTRM-VND-FRGT-PCT   > 0                        14920026
149300                 MOVE 'B' TO ASC-FRGT-PAYT-CDE                    14930026
149400              ELSE                                                14940026
149500                 IF FRGTRM-FRGT-TERM-ID = 0                       14950026
149600                    MOVE ' ' TO ASC-FRGT-PAYT-CDE                 14960026
149700                 END-IF                                           14970026
149800              END-IF                                              14980026
149900           END-IF                                                 14990026
150000        END-IF                                                    15000026
150100     END-IF.                                                      15010026
150200                                                                  15020026
150300     IF SQLCODE = +100                                            15030026
150400         INITIALIZE ASC-FOB-POINT-TXT                             15040026
150500                    ASC-SHIPT-POINT-TXT                           15050026
150600                    ASC-FRGT-PAYT-CDE                             15060026
150700                    ASC-FRGT-TERM-ID                              15070026
150800                    ASC-KOHLS-FRGT-PCT                            15080026
150900                    ASC-VEND-FRGT-PCT.                            15090026
151000                                                                  15100026
151100 4050-GET-PURCHASE-TERMS.                                         15110026
151200                                                                  15120026
151300     PERFORM WITH TEST AFTER                                      15130026
151400             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                15140026
151500             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         15150026
151600                     SQLCODE = ZERO OR                            15160026
151700                     SQLCODE = +100                               15170026
151800                                                                  15180026
151900     EXEC SQL                                                     15190026
152000          SELECT LEADTIME_DAYS_QTY                                15200030
152100                ,RTV_RA_REQD_IND                                  15210026
152200                ,RTV_NO_RA_REQD_IND                               15220026
152300                ,DEBIT_DESTROY_IND                                15230026
152400                ,MARKOUT_IND                                      15240026
152500                ,VND_AUTH_ID                                      15250026
152600            INTO :VNDAGR-LEADTIME-DAYS-QTY                        15260030
152700                 :NI-VNDAGR-LEADTIME-DAYS-QTY                     15270026
152800                ,:VNDAGR-RTV-RA-REQD-IND                          15280026
152900                 :NI-VNDAGR-RTV-RA-REQD-IND                       15290026
153000                ,:VNDAGR-RTV-NO-RA-REQD-IND                       15300026
153100                 :NI-VNDAGR-RTV-NO-RA-REQD-IND                    15310026
153200                ,:VNDAGR-DEBIT-DESTROY-IND                        15320026
153300                 :NI-VNDAGR-DEBIT-DESTROY-IND                     15330026
153400                ,:VNDAGR-MARKOUT-IND                              15340026
153500                 :NI-VNDAGR-MARKOUT-IND                           15350026
153600                ,:VNDAGR-VND-AUTH-ID                              15360026
153700                 :NI-VNDAGR-VND-AUTH-ID                           15370026
153800            FROM TVNDAGR                                          15380026
153900           WHERE ENT_ID            = :ASC-ENT-ID                  15390026
154000             AND DEPT_NBR          = :ASC-DEPARTMENT              15400026
154100             AND AGRMT_TYP_ID      = :PC-PURCHASE                 15410026
154200             AND SEQ_NBR           =                              15420026
154300                 (SELECT MAX(SEQ_NBR)                             15430026
154400                    FROM TVNDAGR                                  15440026
154500                   WHERE ENT_ID            = :ASC-ENT-ID          15450026
154600                     AND DEPT_NBR          = :ASC-DEPARTMENT      15460026
154700                     AND AGRMT_TYP_ID      = :PC-PURCHASE)        15470026
154800     END-EXEC                                                     15480026
154900                                                                  15490026
155000     EVALUATE TRUE                                                15500026
155100         WHEN SQLCODE = ZERO                                      15510026
155200         WHEN SQLCODE = +100                                      15520026
155300         WHEN SQLCODE = -904                                      15530026
155400         WHEN SQLCODE = -913                                      15540026
155500              CONTINUE                                            15550026
155600                                                                  15560026
155700         WHEN SQLWARN0 NOT = SPACES                               15570026
155800         WHEN SQLCODE  NOT = ZERO                                 15580026
155900              MOVE '4050-GET-PURCHASE-TERMS' TO DP013-PARAGRAPH   15590026
156000              MOVE 'UNSUCCESSFUL SELECT PURCHASE TERMS' TO        15600026
156100                                            DP013-MESSAGE-TEXT (1)15610026
156200              MOVE SQLCA TO DP013-SQLCA                           15620026
156300              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         15630026
156400              SET DP013-DB2-ABEND                                 15640026
156500                  DP013-XCTL-DISPLAY-RESTART TO TRUE              15650026
156600                                                                  15660026
156700              PERFORM DP013-0000-PROCESS-ABEND                    15670026
156800     END-EVALUATE                                                 15680026
156900     END-PERFORM.                                                 15690026
157000                                                                  15700026
157100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         15710026
157200         MOVE '4050-GET-PURCHASE-TERMS' TO DP013-PARAGRAPH        15720026
157300         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHASE TERMS' TO  15730026
157400                                            DP013-MESSAGE-TEXT (1)15740026
157500         MOVE SQLCA      TO DP013-SQLCA                           15750026
157600         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              15760026
157700         SET DP013-DB2-ABEND                                      15770026
157800             DP013-XCTL-DISPLAY-RESTART TO TRUE                   15780026
157900                                                                  15790026
158000         PERFORM DP013-0000-PROCESS-ABEND                         15800026
158100     END-IF.                                                      15810026
158200                                                                  15820026
158300     IF SQLCODE = ZERO                                            15830030
158400        IF NI-VNDAGR-LEADTIME-DAYS-QTY = -1                       15840026
158500            MOVE ZERO                   TO ASC-LEADTIME-DAYS-QTY-N15850026
158600        ELSE                                                      15860026
158700            MOVE VNDAGR-LEADTIME-DAYS-QTY TO                      15870026
158800                                           ASC-LEADTIME-DAYS-QTY-N15880026
158900        END-IF                                                    15890026
159000        IF NI-VNDAGR-RTV-RA-REQD-IND = -1                         15900026
159100            MOVE SPACE                  TO ASC-RTV-RA-REQD-IND    15910026
159200        ELSE                                                      15920026
159300            MOVE VNDAGR-RTV-RA-REQD-IND TO ASC-RTV-RA-REQD-IND    15930026
159400        END-IF                                                    15940026
159500        IF NI-VNDAGR-RTV-NO-RA-REQD-IND = -1                      15950026
159600            MOVE SPACE                   TO ASC-RTV-NO-RA-REQD-IND15960026
159700        ELSE                                                      15970026
159800            MOVE VNDAGR-RTV-NO-RA-REQD-IND                        15980026
159900                                         TO ASC-RTV-NO-RA-REQD-IND15990026
160000        END-IF                                                    16000026
160100        IF NI-VNDAGR-DEBIT-DESTROY-IND = -1                       16010026
160200            MOVE SPACE                    TO ASC-DEBIT-DESTROY-IND16020026
160300        ELSE                                                      16030026
160400            MOVE VNDAGR-DEBIT-DESTROY-IND TO ASC-DEBIT-DESTROY-IND16040026
160500        END-IF                                                    16050026
160600        IF NI-VNDAGR-MARKOUT-IND = -1                             16060026
160700            MOVE SPACE              TO ASC-MARKOUT-IND            16070026
160800        ELSE                                                      16080026
160900            MOVE VNDAGR-MARKOUT-IND TO ASC-MARKOUT-IND            16090026
161000        END-IF                                                    16100026
161100        IF NI-VNDAGR-VND-AUTH-ID = -1                             16110026
161200            MOVE SPACE              TO ASC-VND-AUTH-ID            16120026
161300        ELSE                                                      16130026
161400            MOVE VNDAGR-VND-AUTH-ID TO ASC-VND-AUTH-ID            16140026
161500        END-IF                                                    16150026
161600     END-IF.                                                      16160026
161700                                                                  16170026
161800     IF SQLCODE = +100                                            16180026
161900         MOVE SPACE TO ASC-RTV-RA-REQD-IND                        16190026
162000                       ASC-RTV-NO-RA-REQD-IND                     16200026
162100                       ASC-DEBIT-DESTROY-IND                      16210026
162200                       ASC-MARKOUT-IND                            16220026
162300                       ASC-VND-AUTH-ID                            16230026
162400         MOVE ZERO  TO ASC-LEADTIME-DAYS-QTY                      16240028
162500     END-IF.                                                      16250026
162600                                                                  16260026
162700******************************************************************16270026
162800* 4060-GET-RTV-INSTRUCTIONS.                                     *16280026
162900*  USE THE VENDOR INSTRUCTION CURSOR TO GET ALL THE INSTRUCTION  *16290026
163000*  TEXT LINES FROM TVNDINS                                       *16300026
163100******************************************************************16310026
163200 4060-GET-RTV-INSTRUCTIONS.                                       16320026
163300                                                                  16330026
163400     PERFORM 8000-OPEN-VND-INSTR-CSR.                             16340026
163500                                                                  16350026
163600     PERFORM 8020-FETCH-VND-INSTR-CSR.                            16360026
163700                                                                  16370026
163800     IF PS-END-OF-VND-INSTR-CSR                                   16380026
163900         MOVE SPACES                      TO ASC-INSTR-TEXT1      16390026
164000                                             ASC-INSTR-TEXT2      16400026
164100                                             ASC-INSTR-TEXT3      16410026
164200         MOVE ZERO                        TO ASC-INSTR-SEQ-NBR1   16420026
164300                                             ASC-INSTR-SEQ-NBR2   16430026
164400                                             ASC-INSTR-SEQ-NBR3   16440026
164500     ELSE                                                         16450026
164600         MOVE VNDINS-VND-INSTR-TXT        TO ASC-INSTR-TEXT1      16460026
164700         MOVE VNDINS-INSTR-SEQ-NBR        TO ASC-INSTR-SEQ-NBR1   16470026
164800                                                                  16480026
164900         PERFORM 8020-FETCH-VND-INSTR-CSR                         16490026
165000         IF PS-END-OF-VND-INSTR-CSR                               16500026
165100             MOVE SPACES                  TO ASC-INSTR-TEXT2      16510026
165200                                             ASC-INSTR-TEXT3      16520026
165300             MOVE ZERO                    TO ASC-INSTR-SEQ-NBR2   16530026
165400                                             ASC-INSTR-SEQ-NBR3   16540026
165500         ELSE                                                     16550026
165600             MOVE VNDINS-VND-INSTR-TXT    TO ASC-INSTR-TEXT2      16560026
165700             MOVE VNDINS-INSTR-SEQ-NBR    TO ASC-INSTR-SEQ-NBR2   16570026
165800                                                                  16580026
165900             PERFORM 8020-FETCH-VND-INSTR-CSR                     16590026
166000             IF PS-END-OF-VND-INSTR-CSR                           16600026
166100                 MOVE SPACES              TO ASC-INSTR-TEXT3      16610026
166200                 MOVE ZERO                TO ASC-INSTR-SEQ-NBR3   16620026
166300             ELSE                                                 16630026
166400                 MOVE VNDINS-VND-INSTR-TXT                        16640026
166500                                          TO ASC-INSTR-TEXT3      16650026
166600                 MOVE VNDINS-INSTR-SEQ-NBR                        16660026
166700                                          TO ASC-INSTR-SEQ-NBR3   16670026
166800             END-IF                                               16680026
166900         END-IF                                                   16690026
167000     END-IF.                                                      16700026
167100                                                                  16710026
167200     PERFORM 8010-CLOSE-VND-INSTR-CSR.                            16720026
167300                                                                  16730026
167400                                                                  16740026
167500 4400-MOVE-COMMAREA-TO-SCREEN.                                    16750026
167600                                                                  16760026
167700     MOVE ASC-DEPARTMENT          TO ADPTNBRO.                    16770026
167800     MOVE ASC-ENT-NAME-DESC       TO AVNAMEO.                     16780026
167900     MOVE ASC-INHOUSE-NBR         TO AINHSO.                      16790026
168000     MOVE ASC-DUN-NBR             TO ADUNSO.                      16800026
168100     MOVE ASC-PAYT-TERM-ID        TO PV-EDIT-PAYT-TERM-ID.        16810026
168200     MOVE PV-EDIT-PAYT-TERM-ID    TO APAYTRMO.                    16820026
168300     MOVE ASC-PAYT-TERM-ID-DESC   TO APAYTXTO.                    16830026
168400     MOVE ASC-FOB-POINT-TXT       TO AFOBPNTO.                    16840026
168500     MOVE ASC-SHIPT-POINT-TXT     TO ASHPPNTO.                    16850026
168600     MOVE ASC-FRGT-PAYT-CDE       TO APAYFRGO.                    16860026
168700     MOVE ASC-FRGT-TERM-ID        TO AFRTIDTO.                    16870026
168800     MULTIPLY ASC-KOHLS-FRGT-PCT BY +100 GIVING                   16880026
168900                                     PV-NUM-KOHLS-FRGHT-PCT.      16890026
169000     MOVE PV-NUM-KOHLS-FRGHT-PCT  TO PV-EDIT-KOHLS-FRGHT-PCT.     16900026
169100     MOVE PV-EDIT-KOHLS-FRGHT-PCT TO AKFRGHTO.                    16910026
169200     MULTIPLY ASC-VEND-FRGT-PCT BY +100 GIVING                    16920026
169300                                     PV-NUM-VENDR-FRGHT-PCT.      16930026
169400     MOVE PV-NUM-VENDR-FRGHT-PCT  TO PV-EDIT-VENDR-FRGHT-PCT.     16940026
169500     MOVE PV-EDIT-VENDR-FRGHT-PCT TO AVFRGHTO.                    16950026
169600     MOVE ASC-RTV-RA-REQD-IND     TO ARTVRQDO.                    16960026
169700     MOVE ASC-RTV-NO-RA-REQD-IND  TO ARTVNRQO.                    16970026
169800     MOVE ASC-DEBIT-DESTROY-IND   TO ADBTDSTO.                    16980026
169900     MOVE ASC-MARKOUT-IND         TO AMKOUTO.                     16990026
170000     MOVE ASC-VND-AUTH-ID         TO AAUTHIDO.                    17000026
170100     MOVE ASC-INSTR-TEXT1         TO ACMNT01O.                    17010026
170200     MOVE ASC-INSTR-TEXT2         TO ACMNT02O.                    17020026
170300     MOVE ASC-INSTR-TEXT3         TO ACMNT03O.                    17030026
170400                                                                  17040026
170500                                                                  17050026
170600 5000-UPDATE-TERMS.                                               17060026
170700                                                                  17070026
170800     MOVE PC-PURCHASE TO PV-AGRMT-TYP-ID.                         17080026
170900     IF ASC-RTV-RA-REQD-IND      NOT = ASC-RTV-RA-REQD-IND-O    OR17090026
171000        ASC-RTV-NO-RA-REQD-IND   NOT = ASC-RTV-NO-RA-REQD-IND-O OR17100026
171100        ASC-DEBIT-DESTROY-IND    NOT = ASC-DEBIT-DESTROY-IND-O  OR17110026
171200        ASC-MARKOUT-IND          NOT = ASC-MARKOUT-IND-O        OR17120026
171300        ASC-VND-AUTH-ID          NOT = ASC-VND-AUTH-ID-O          17130026
171400                                                                  17140026
171500         PERFORM 5010-GET-CUR-SEQ-NBR                             17150026
171600                                                                  17160026
171700         PERFORM 5020-EXPIRE-OLD-TERMS                            17170026
171800                                                                  17180026
171900         PERFORM 5050-INSERT-NEW-PURCHASE-TERMS                   17190026
172000     END-IF.                                                      17200026
172100                                                                  17210026
172200*    THE MOVE OF PV-INSTR-SEQ-NBR TO ASC-INSTR-SEQ-NBR* IS        17220026
172300*    NEEDED SO AFTER THE INITIAL INSERT, THE PROGRAM WILL DO      17230026
172400*    UPDATES OF THE ROW JUST INSERTED.                            17240026
172500                                                                  17250026
172600     IF ASC-INSTR-TEXT1  NOT = ASC-INSTR-TEXT1-O                  17260026
172700         MOVE ASC-INSTR-TEXT1  TO PV-INSTR-TXT                    17270026
172800         MOVE ASC-INSTR-SEQ-NBR1                                  17280026
172900                               TO PV-INSTR-SEQ-NBR                17290026
173000         PERFORM 5100-UPDATE-VND-INSTR                            17300026
173100         MOVE PV-INSTR-SEQ-NBR TO ASC-INSTR-SEQ-NBR1              17310026
173200     END-IF.                                                      17320026
173300                                                                  17330026
173400     IF ASC-INSTR-TEXT2  NOT = ASC-INSTR-TEXT2-O                  17340026
173500         MOVE ASC-INSTR-TEXT2  TO PV-INSTR-TXT                    17350026
173600         MOVE ASC-INSTR-SEQ-NBR2                                  17360026
173700                               TO PV-INSTR-SEQ-NBR                17370026
173800         PERFORM 5100-UPDATE-VND-INSTR                            17380026
173900         MOVE PV-INSTR-SEQ-NBR TO ASC-INSTR-SEQ-NBR2              17390026
174000     END-IF.                                                      17400026
174100                                                                  17410026
174200     IF ASC-INSTR-TEXT3  NOT = ASC-INSTR-TEXT3-O                  17420026
174300         MOVE ASC-INSTR-TEXT3  TO PV-INSTR-TXT                    17430026
174400         MOVE ASC-INSTR-SEQ-NBR3                                  17440026
174500                               TO PV-INSTR-SEQ-NBR                17450026
174600         PERFORM 5100-UPDATE-VND-INSTR                            17460026
174700         MOVE PV-INSTR-SEQ-NBR TO ASC-INSTR-SEQ-NBR3              17470026
174800     END-IF.                                                      17480026
174900                                                                  17490026
175000                                                                  17500026
175100                                                                  17510026
175200 5010-GET-CUR-SEQ-NBR.                                            17520026
175300                                                                  17530026
175400     PERFORM WITH TEST AFTER                                      17540026
175500             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                17550026
175600             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         17560026
175700                     SQLCODE = ZERO OR                            17570026
175800                     SQLCODE = +100                               17580026
175900                                                                  17590026
176000     EXEC SQL                                                     17600026
176100          SELECT SEQ_NBR                                          17610026
176200            INTO :PV-CUR-SEQ-NBR                                  17620026
176300            FROM TVNDAGR                                          17630026
176400           WHERE ENT_ID            = :ASC-ENT-ID                  17640026
176500             AND DEPT_NBR          = :ASC-DEPARTMENT              17650026
176600             AND AGRMT_TYP_ID      = :PV-AGRMT-TYP-ID             17660026
176700             AND SEQ_NBR           =                              17670026
176800                 (SELECT MAX(SEQ_NBR)                             17680026
176900                    FROM TVNDAGR                                  17690026
177000                   WHERE ENT_ID           = :ASC-ENT-ID           17700026
177100                     AND DEPT_NBR         = :ASC-DEPARTMENT       17710026
177200                    AND AGRMT_TYP_ID      = :PV-AGRMT-TYP-ID)     17720026
177300     END-EXEC                                                     17730026
177400                                                                  17740026
177500     EVALUATE TRUE                                                17750026
177600         WHEN SQLCODE = ZERO                                      17760026
177700         WHEN SQLCODE = +100                                      17770026
177800         WHEN SQLCODE = -904                                      17780026
177900         WHEN SQLCODE = -913                                      17790026
178000              CONTINUE                                            17800026
178100                                                                  17810026
178200         WHEN SQLWARN0 NOT = SPACES                               17820026
178300         WHEN SQLCODE  NOT = ZERO                                 17830026
178400              MOVE '5010-GET-CUR-SEQ-NBR' TO DP013-PARAGRAPH      17840026
178500              MOVE 'UNSUCCESSFUL SELECT CUR SEQ NBR' TO           17850026
178600                                            DP013-MESSAGE-TEXT (1)17860026
178700              MOVE SQLCA TO DP013-SQLCA                           17870026
178800              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         17880026
178900              SET DP013-DB2-ABEND                                 17890026
179000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              17900026
179100                                                                  17910026
179200              PERFORM DP013-0000-PROCESS-ABEND                    17920026
179300     END-EVALUATE                                                 17930026
179400     END-PERFORM.                                                 17940026
179500                                                                  17950026
179600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         17960026
179700         MOVE '5010-GET-CUR-SEQ-NBR' TO DP013-PARAGRAPH           17970026
179800         MOVE 'MAX RETRIES EXCEEDED ON SELECT CUR SEQ NBR' TO     17980026
179900                                            DP013-MESSAGE-TEXT (1)17990026
180000         MOVE SQLCA      TO DP013-SQLCA                           18000026
180100         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              18010026
180200         SET DP013-DB2-ABEND                                      18020026
180300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   18030026
180400                                                                  18040026
180500         PERFORM DP013-0000-PROCESS-ABEND                         18050026
180600     END-IF.                                                      18060026
180700                                                                  18070026
180800     IF SQLCODE = ZERO                                            18080026
180900         ADD +1  PV-CUR-SEQ-NBR  GIVING PV-NEW-SEQ-NBR            18090026
181000     ELSE                                                         18100026
181100         IF SQLCODE = +100                                        18110026
181200             MOVE ZERO TO PV-CUR-SEQ-NBR                          18120026
181300             ADD +1  PV-CUR-SEQ-NBR  GIVING PV-NEW-SEQ-NBR        18130026
181400         END-IF                                                   18140026
181500     END-IF.                                                      18150026
181600                                                                  18160026
181700 5020-EXPIRE-OLD-TERMS.                                           18170026
181800                                                                  18180026
181900     PERFORM WITH TEST AFTER                                      18190026
182000             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                18200026
182100             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         18210026
182200                     SQLCODE = ZERO OR                            18220026
182300                     SQLCODE = +100                               18230026
182400                                                                  18240026
182500     EXEC SQL                                                     18250026
182600          UPDATE TVNDAGR                                          18260026
182700             SET EXPIRATION_DATE   = CURRENT DATE                 18270026
182800                ,LAST_UPD_ID       = :DP020-USERID                18280026
182900           WHERE ENT_ID            = :ASC-ENT-ID                  18290026
183000             AND DEPT_NBR          = :ASC-DEPARTMENT              18300026
183100             AND AGRMT_TYP_ID      = :PV-AGRMT-TYP-ID             18310026
183200             AND SEQ_NBR           = :PV-CUR-SEQ-NBR              18320026
183300     END-EXEC                                                     18330026
183400                                                                  18340026
183500     EVALUATE TRUE                                                18350026
183600         WHEN SQLCODE = ZERO                                      18360026
183700         WHEN SQLCODE = +100                                      18370026
183800         WHEN SQLCODE = -904                                      18380026
183900         WHEN SQLCODE = -913                                      18390026
184000              CONTINUE                                            18400026
184100                                                                  18410026
184200         WHEN SQLWARN0 NOT = SPACES                               18420026
184300         WHEN SQLCODE  NOT = ZERO                                 18430026
184400              MOVE '5020-EXPIRE-OLD-TERMS' TO DP013-PARAGRAPH     18440026
184500              MOVE 'UNSUCCESSFUL UPDATE - EXPIRE OLD TERMS' TO    18450026
184600                                            DP013-MESSAGE-TEXT (1)18460026
184700              MOVE SQLCA TO DP013-SQLCA                           18470026
184800              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         18480026
184900              SET DP013-DB2-ABEND                                 18490026
185000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              18500026
185100                                                                  18510026
185200              PERFORM DP013-0000-PROCESS-ABEND                    18520026
185300     END-EVALUATE                                                 18530026
185400     END-PERFORM.                                                 18540026
185500                                                                  18550026
185600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         18560026
185700         MOVE '5020-EXPIRE-OLD-TERMS' TO DP013-PARAGRAPH          18570026
185800         MOVE 'MAX RETRIES EXCEEDED ON UPDATE - EXPIRE OLD TERMS' 18580026
185900                                         TO DP013-MESSAGE-TEXT (1)18590026
186000         MOVE SQLCA      TO DP013-SQLCA                           18600026
186100         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              18610026
186200         SET DP013-DB2-ABEND                                      18620026
186300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   18630026
186400                                                                  18640026
186500         PERFORM DP013-0000-PROCESS-ABEND                         18650026
186600     END-IF.                                                      18660026
186700                                                                  18670026
186800     IF SQLCODE = +100                                            18680026
186900         SET PS-TERMS-DONT-EXIST TO TRUE                          18690026
187000                                                                  18700026
187100         PERFORM 5022-CHECK-IF-TERMS-EXIST                        18710026
187200                                                                  18720026
187300         IF PS-TERMS-EXIST                                        18730026
187400             MOVE '5020-EXPIRE-OLD-TERMS' TO DP013-PARAGRAPH      18740026
187500             MOVE 'UNSUCCESSFUL UPDATE - EXPIRE OLD TERMS' TO     18750026
187600                                            DP013-MESSAGE-TEXT (1)18760026
187700             MOVE SQLCA TO DP013-SQLCA                            18770026
187800             MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)          18780026
187900             SET DP013-DB2-ABEND                                  18790026
188000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18800026
188100                                                                  18810026
188200             PERFORM DP013-0000-PROCESS-ABEND                     18820026
188300         END-IF                                                   18830026
188400     END-IF.                                                      18840026
188500                                                                  18850026
188600 5022-CHECK-IF-TERMS-EXIST.                                       18860026
188700                                                                  18870026
188800     PERFORM WITH TEST AFTER                                      18880026
188900             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                18890026
189000             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         18900026
189100                     SQLCODE = ZERO                               18910026
189200                                                                  18920026
189300         EXEC SQL                                                 18930026
189400              SELECT COUNT (*)                                    18940026
189500                INTO :PV-TERMS-COUNT                              18950026
189600                FROM TVNDAGR                                      18960026
189700               WHERE ENT_ID            = :ASC-ENT-ID              18970026
189800                 AND DEPT_NBR          = :ASC-DEPARTMENT          18980026
189900                 AND AGRMT_TYP_ID      = :PV-AGRMT-TYP-ID         18990026
190000         END-EXEC                                                 19000026
190100                                                                  19010026
190200         EVALUATE TRUE                                            19020026
190300             WHEN SQLCODE = ZERO                                  19030026
190400             WHEN SQLCODE = -904                                  19040026
190500             WHEN SQLCODE = -913                                  19050026
190600                  CONTINUE                                        19060026
190700                                                                  19070026
190800             WHEN SQLWARN0 NOT = SPACES                           19080026
190900             WHEN SQLCODE  NOT = ZERO                             19090026
191000                  MOVE '5022-CHECK-IF-TERMS-EXIST'                19100026
191100                                       TO DP013-PARAGRAPH         19110026
191200                  MOVE 'UNSUCCESSFUL SELECT COUNT OF TERMS'       19120026
191300                                       TO DP013-MESSAGE-TEXT (1)  19130026
191400                  MOVE SQLCA TO DP013-SQLCA                       19140026
191500                  MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)     19150026
191600                  SET DP013-DB2-ABEND                             19160026
191700                      DP013-XCTL-DISPLAY-RESTART TO TRUE          19170026
191800                                                                  19180026
191900                  PERFORM DP013-0000-PROCESS-ABEND                19190026
192000         END-EVALUATE                                             19200026
192100     END-PERFORM.                                                 19210026
192200                                                                  19220026
192300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         19230026
192400         MOVE '5022-CHECK-IF-TERMS-EXIST' TO DP013-PARAGRAPH      19240026
192500         MOVE 'MAX RETRIES EXCEEDED ON SELECT COUNT OF TERMS' TO  19250026
192600                                            DP013-MESSAGE-TEXT (1)19260026
192700         MOVE SQLCA      TO DP013-SQLCA                           19270026
192800         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              19280026
192900         SET DP013-DB2-ABEND                                      19290026
193000             DP013-XCTL-DISPLAY-RESTART TO TRUE                   19300026
193100                                                                  19310026
193200         PERFORM DP013-0000-PROCESS-ABEND                         19320026
193300     END-IF.                                                      19330026
193400                                                                  19340026
193500     IF SQLCODE = ZERO                                            19350026
193600        IF PV-TERMS-COUNT > ZERO                                  19360026
193700            SET PS-TERMS-EXIST TO TRUE.                           19370026
193800                                                                  19380026
193900                                                                  19390026
194000 5050-INSERT-NEW-PURCHASE-TERMS.                                  19400026
194100                                                                  19410026
194200     MOVE ZERO TO NI-VNDAGR-EXPIRATION-DATE                       19420026
194300                  NI-VNDAGR-LEADTIME-DAYS-QTY                     19430026
194400                  NI-VNDAGR-RTV-RA-REQD-IND                       19440026
194500                  NI-VNDAGR-RTV-NO-RA-REQD-IND                    19450026
194600                  NI-VNDAGR-DEBIT-DESTROY-IND                     19460026
194700                  NI-VNDAGR-MARKOUT-IND                           19470026
194800                  NI-VNDAGR-VND-AUTH-ID.                          19480026
194900                                                                  19490026
195000     MOVE ASC-LEADTIME-DAYS-QTY-N TO VNDAGR-LEADTIME-DAYS-QTY.    19500026
195100     MOVE ASC-RTV-RA-REQD-IND     TO VNDAGR-RTV-RA-REQD-IND.      19510026
195200     MOVE ASC-RTV-NO-RA-REQD-IND  TO VNDAGR-RTV-NO-RA-REQD-IND.   19520026
195300     MOVE ASC-DEBIT-DESTROY-IND   TO VNDAGR-DEBIT-DESTROY-IND.    19530026
195400     MOVE ASC-MARKOUT-IND         TO VNDAGR-MARKOUT-IND.          19540026
195500     MOVE ASC-VND-AUTH-ID         TO VNDAGR-VND-AUTH-ID.          19550026
195600                                                                  19560026
195700     PERFORM WITH TEST AFTER                                      19570026
195800             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                19580026
195900             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         19590026
196000                     SQLCODE = ZERO                               19600026
196100                                                                  19610026
196200     EXEC SQL                                                     19620026
196300          INSERT INTO TVNDAGR                                     19630026
196400                 ( ENT_ID                                         19640026
196500                  ,DEPT_NBR                                       19650026
196600                  ,AGRMT_TYP_ID                                   19660026
196700                  ,SEQ_NBR                                        19670026
196800                  ,EFFECTIVE_DATE                                 19680026
196900                  ,EXPIRATION_DATE                                19690026
197000                  ,PROD_STATUS_IND                                19700026
197100                  ,RTV_RA_REQD_IND                                19710026
197200                  ,RTV_NO_RA_REQD_IND                             19720026
197300                  ,DEBIT_DESTROY_IND                              19730026
197400                  ,MARKOUT_IND                                    19740026
197500                  ,VND_AUTH_ID                                    19750026
197600                  ,LEADTIME_DAYS_QTY                              19760026
197700                  ,LAST_UPD_ID)                                   19770026
197800          VALUES ( :ASC-ENT-ID                                    19780026
197900                  ,:ASC-DEPARTMENT                                19790026
198000                  ,:PC-PURCHASE                                   19800026
198100                  ,:PV-NEW-SEQ-NBR                                19810026
198200                  , CURRENT DATE                                  19820026
198300                  ,:PC-MAX-DATE                                   19830026
198400                   :NI-VNDAGR-EXPIRATION-DATE                     19840026
198500                  ,:PC-PROD-STATUS                                19850026
198600                  ,:VNDAGR-RTV-RA-REQD-IND                        19860026
198700                   :NI-VNDAGR-RTV-RA-REQD-IND                     19870026
198800                  ,:VNDAGR-RTV-NO-RA-REQD-IND                     19880026
198900                   :NI-VNDAGR-RTV-NO-RA-REQD-IND                  19890026
199000                  ,:VNDAGR-DEBIT-DESTROY-IND                      19900026
199100                   :NI-VNDAGR-DEBIT-DESTROY-IND                   19910026
199200                  ,:VNDAGR-MARKOUT-IND                            19920026
199300                   :NI-VNDAGR-MARKOUT-IND                         19930026
199400                  ,:VNDAGR-VND-AUTH-ID                            19940026
199500                   :NI-VNDAGR-VND-AUTH-ID                         19950026
199600                  ,:VNDAGR-LEADTIME-DAYS-QTY                      19960026
199700                   :NI-VNDAGR-LEADTIME-DAYS-QTY                   19970026
199800                  ,:DP020-USERID)                                 19980026
199900     END-EXEC                                                     19990026
200000                                                                  20000026
200100     EVALUATE TRUE                                                20010026
200200         WHEN SQLCODE = ZERO                                      20020026
200300         WHEN SQLCODE = -904                                      20030026
200400         WHEN SQLCODE = -913                                      20040026
200500              CONTINUE                                            20050026
200600                                                                  20060026
200700         WHEN SQLWARN0 NOT = SPACES                               20070026
200800         WHEN SQLCODE  NOT = ZERO                                 20080026
200900              MOVE '5050-INSERT-NEW-PURCHASE-TERMS' TO            20090026
201000                                                   DP013-PARAGRAPH20100026
201100              MOVE 'UNSUCCESSFUL INSERT NEW PURCHASE TERMS' TO    20110026
201200                                            DP013-MESSAGE-TEXT (1)20120026
201300              MOVE SQLCA TO DP013-SQLCA                           20130026
201400              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         20140026
201500              SET DP013-DB2-ABEND                                 20150026
201600                  DP013-XCTL-DISPLAY-RESTART TO TRUE              20160026
201700                                                                  20170026
201800              PERFORM DP013-0000-PROCESS-ABEND                    20180026
201900     END-EVALUATE                                                 20190026
202000     END-PERFORM.                                                 20200026
202100                                                                  20210026
202200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         20220026
202300         MOVE '5050-INSERT-NEW-PURCHASE-TERMS' TO DP013-PARAGRAPH 20230026
202400         MOVE 'MAX RETRIES EXCEEDED ON INSERT NEW PURCH TERMS' TO 20240026
202500                                            DP013-MESSAGE-TEXT (1)20250026
202600         MOVE SQLCA      TO DP013-SQLCA                           20260026
202700         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              20270026
202800         SET DP013-DB2-ABEND                                      20280026
202900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   20290026
203000                                                                  20300026
203100         PERFORM DP013-0000-PROCESS-ABEND                         20310026
203200     END-IF.                                                      20320026
203300                                                                  20330026
203400*----------------------------------------------------------------*20340026
203500* UPDATE THE COMENTS ON THE VENDOR INSTRUCTION TABLE.            *20350026
203600*----------------------------------------------------------------*20360026
203700                                                                  20370026
203800 5100-UPDATE-VND-INSTR.                                           20380026
203900                                                                  20390026
204000     PERFORM WITH TEST AFTER                                      20400026
204100             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                20410026
204200             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         20420026
204300                     SQLCODE = ZERO OR                            20430026
204400                     SQLCODE = +100                               20440026
204500                                                                  20450026
204600         EXEC SQL                                                 20460026
204700              UPDATE TVNDINS                                      20470026
204800                 SET VND_INSTR_TXT  = :PV-INSTR-TXT               20480026
204900               WHERE ENT_ID         = :ASC-ENT-ID                 20490026
205000                 AND DEPT_NBR       = :ASC-DEPARTMENT             20500026
205100                 AND AGRMT_TYP_ID   = :PV-AGRMT-TYP-ID            20510026
205200                 AND INSTR_SEQ_NBR  = :PV-INSTR-SEQ-NBR           20520026
205300         END-EXEC                                                 20530026
205400                                                                  20540026
205500         EVALUATE TRUE                                            20550026
205600             WHEN SQLCODE = ZERO                                  20560026
205700             WHEN SQLCODE = +100                                  20570026
205800             WHEN SQLCODE = -904                                  20580026
205900             WHEN SQLCODE = -913                                  20590026
206000                  CONTINUE                                        20600026
206100                                                                  20610026
206200             WHEN SQLWARN0 NOT = SPACES                           20620026
206300             WHEN SQLCODE  NOT = ZERO                             20630026
206400                  MOVE '5100-UPDATE-VND-INSTR' TO DP013-PARAGRAPH 20640026
206500                  MOVE 'UNSUCCESSFUL UPDATE OF INSTRUCTIONS'      20650026
206600                                  TO DP013-MESSAGE-TEXT (1)       20660026
206700                  MOVE ASC-ENT-ID TO UD-ENT-ID                    20670026
206800                  MOVE ASC-DEPARTMENT                             20680026
206900                                  TO UD-DPT-NBR                   20690026
207000                  MOVE PV-AGRMT-TYP-ID                            20700026
207100                                  TO UD-AGRMT-TYP-ID              20710026
207200                  MOVE PV-INSTR-SEQ-NBR                           20720026
207300                                  TO UD-INSTR-SEQ-NBR             20730026
207400                  MOVE UD-UPDT-INSTR-DISPLAY                      20740026
207500                                  TO DP013-MESSAGE-TEXT (2)       20750026
207600                  MOVE SQLCA TO DP013-SQLCA                       20760026
207700                  MOVE 'TVNDINS ' TO DP013-DB2-TABLE-NAME (1)     20770026
207800                  SET DP013-DB2-ABEND                             20780026
207900                      DP013-XCTL-DISPLAY-RESTART TO TRUE          20790026
208000                                                                  20800026
208100                  PERFORM DP013-0000-PROCESS-ABEND                20810026
208200         END-EVALUATE                                             20820026
208300     END-PERFORM.                                                 20830026
208400                                                                  20840026
208500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         20850026
208600         MOVE '5100-UPDATE-VND-INSTR' TO DP013-PARAGRAPH          20860026
208700         MOVE 'MAX RETRIES EXCEEDED ON UPDATE OF INSTRUCTIONS'    20870026
208800                                         TO DP013-MESSAGE-TEXT (1)20880026
208900         MOVE ASC-ENT-ID              TO UD-ENT-ID                20890026
209000         MOVE ASC-DEPARTMENT          TO UD-DPT-NBR               20900026
209100         MOVE PV-AGRMT-TYP-ID         TO UD-AGRMT-TYP-ID          20910026
209200         MOVE PV-INSTR-SEQ-NBR        TO UD-INSTR-SEQ-NBR         20920026
209300         MOVE UD-UPDT-INSTR-DISPLAY   TO DP013-MESSAGE-TEXT (2)   20930026
209400         MOVE SQLCA      TO DP013-SQLCA                           20940026
209500         MOVE 'TVNDINS ' TO DP013-DB2-TABLE-NAME (1)              20950026
209600         SET DP013-DB2-ABEND                                      20960026
209700             DP013-XCTL-DISPLAY-RESTART TO TRUE                   20970026
209800                                                                  20980026
209900         PERFORM DP013-0000-PROCESS-ABEND                         20990026
210000     END-IF.                                                      21000026
210100                                                                  21010026
210200     IF SQLCODE = +100                                            21020026
210300         PERFORM 5110-GET-CUR-INSTR-SEQ-NBR                       21030026
210400         PERFORM 5120-INSERT-VND-INSTR                            21040026
210500     END-IF.                                                      21050026
210600                                                                  21060026
210700                                                                  21070026
210800 5110-GET-CUR-INSTR-SEQ-NBR.                                      21080026
210900                                                                  21090026
211000     PERFORM WITH TEST AFTER                                      21100026
211100             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                21110026
211200             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         21120026
211300                     SQLCODE = ZERO OR                            21130026
211400                     SQLCODE = +100                               21140026
211500                                                                  21150026
211600     EXEC SQL                                                     21160026
211700          SELECT INSTR_SEQ_NBR                                    21170026
211800            INTO :PV-CUR-INSTR-SEQ-NBR                            21180026
211900            FROM TVNDINS                                          21190026
212000           WHERE ENT_ID            = :ASC-ENT-ID                  21200026
212100             AND DEPT_NBR          = :ASC-DEPARTMENT              21210026
212200             AND AGRMT_TYP_ID      = :PV-AGRMT-TYP-ID             21220026
212300             AND INSTR_SEQ_NBR     =                              21230026
212400                 (SELECT MAX(INSTR_SEQ_NBR)                       21240026
212500                    FROM TVNDINS                                  21250026
212600                   WHERE ENT_ID           = :ASC-ENT-ID           21260026
212700                     AND DEPT_NBR         = :ASC-DEPARTMENT       21270026
212800                    AND AGRMT_TYP_ID      = :PV-AGRMT-TYP-ID)     21280026
212900     END-EXEC                                                     21290026
213000                                                                  21300026
213100     EVALUATE TRUE                                                21310026
213200         WHEN SQLCODE = ZERO                                      21320026
213300         WHEN SQLCODE = +100                                      21330026
213400         WHEN SQLCODE = -904                                      21340026
213500         WHEN SQLCODE = -913                                      21350026
213600              CONTINUE                                            21360026
213700                                                                  21370026
213800         WHEN SQLWARN0 NOT = SPACES                               21380026
213900         WHEN SQLCODE  NOT = ZERO                                 21390026
214000              MOVE '5110-GET-CUR-SEQ-NBR' TO DP013-PARAGRAPH      21400026
214100              MOVE 'UNSUCCESSFUL SELECT CUR SEQ NBR' TO           21410026
214200                                            DP013-MESSAGE-TEXT (1)21420026
214300              MOVE SQLCA TO DP013-SQLCA                           21430026
214400              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         21440026
214500              SET DP013-DB2-ABEND                                 21450026
214600                  DP013-XCTL-DISPLAY-RESTART TO TRUE              21460026
214700                                                                  21470026
214800              PERFORM DP013-0000-PROCESS-ABEND                    21480026
214900     END-EVALUATE                                                 21490026
215000     END-PERFORM.                                                 21500026
215100                                                                  21510026
215200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         21520026
215300         MOVE '5010-GET-CUR-SEQ-NBR' TO DP013-PARAGRAPH           21530026
215400         MOVE 'MAX RETRIES EXCEEDED ON SELECT CUR SEQ NBR' TO     21540026
215500                                            DP013-MESSAGE-TEXT (1)21550026
215600         MOVE SQLCA      TO DP013-SQLCA                           21560026
215700         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              21570026
215800         SET DP013-DB2-ABEND                                      21580026
215900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   21590026
216000                                                                  21600026
216100         PERFORM DP013-0000-PROCESS-ABEND                         21610026
216200     END-IF.                                                      21620026
216300                                                                  21630026
216400     IF SQLCODE = +100                                            21640026
216500         MOVE ZERO TO PV-CUR-INSTR-SEQ-NBR                        21650026
216600     END-IF.                                                      21660026
216700                                                                  21670026
216800     ADD +1  PV-CUR-INSTR-SEQ-NBR                                 21680026
216900             GIVING PV-INSTR-SEQ-NBR.                             21690026
217000                                                                  21700026
217100                                                                  21710026
217200*----------------------------------------------------------------*21720026
217300* UPDATE THE COMENTS ON THE VENDOR INSTRUCTION TABLE.            *21730026
217400*----------------------------------------------------------------*21740026
217500                                                                  21750026
217600 5120-INSERT-VND-INSTR.                                           21760026
217700                                                                  21770026
217800     PERFORM WITH TEST AFTER                                      21780026
217900             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                21790026
218000             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         21800026
218100                     SQLCODE = ZERO                               21810026
218200                                                                  21820026
218300         EXEC SQL                                                 21830026
218400          INSERT INTO TVNDINS                                     21840026
218500                 ( ENT_ID                                         21850026
218600                 , DEPT_NBR                                       21860026
218700                 , AGRMT_TYP_ID                                   21870026
218800                 , TYP_CDE                                        21880026
218900                 , INSTR_SEQ_NBR                                  21890026
219000                 , VND_INSTR_TXT )                                21900026
219100          VALUES ( :ASC-ENT-ID                                    21910026
219200                 , :ASC-DEPARTMENT                                21920026
219300                 , :PV-AGRMT-TYP-ID                               21930026
219400                 , 1                                              21940026
219500                 , :PV-INSTR-SEQ-NBR                              21950026
219600                 , :PV-INSTR-TXT )                                21960026
219700         END-EXEC                                                 21970026
219800                                                                  21980026
219900         EVALUATE TRUE                                            21990026
220000             WHEN SQLCODE = ZERO                                  22000026
220100             WHEN SQLCODE = -904                                  22010026
220200             WHEN SQLCODE = -913                                  22020026
220300                  CONTINUE                                        22030026
220400                                                                  22040026
220500             WHEN SQLWARN0 NOT = SPACES                           22050026
220600             WHEN SQLCODE  NOT = ZERO                             22060026
220700                  MOVE '5120-INSERT-VND-INSTR' TO DP013-PARAGRAPH 22070026
220800                  MOVE 'UNSUCCESSFUL INSERT OF INSTRUCTIONS'      22080026
220900                                  TO DP013-MESSAGE-TEXT (1)       22090026
221000                  MOVE ASC-ENT-ID TO UD-ENT-ID                    22100026
221100                  MOVE ASC-DEPARTMENT                             22110026
221200                                  TO UD-DPT-NBR                   22120026
221300                  MOVE PV-AGRMT-TYP-ID                            22130026
221400                                  TO UD-AGRMT-TYP-ID              22140026
221500                  MOVE PV-INSTR-SEQ-NBR                           22150026
221600                                  TO UD-INSTR-SEQ-NBR             22160026
221700                  MOVE UD-UPDT-INSTR-DISPLAY                      22170026
221800                                  TO DP013-MESSAGE-TEXT (2)       22180026
221900                  MOVE SQLCA TO DP013-SQLCA                       22190026
222000                  MOVE 'TVNDINS ' TO DP013-DB2-TABLE-NAME (1)     22200026
222100                  SET DP013-DB2-ABEND                             22210026
222200                      DP013-XCTL-DISPLAY-RESTART TO TRUE          22220026
222300                                                                  22230026
222400                  PERFORM DP013-0000-PROCESS-ABEND                22240026
222500         END-EVALUATE                                             22250026
222600     END-PERFORM.                                                 22260026
222700                                                                  22270026
222800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         22280026
222900         MOVE '5120-INSERT-VND-INSTR' TO DP013-PARAGRAPH          22290026
223000         MOVE 'MAX RETRIES EXCEEDED ON INSERT OF INSTRUCTIONS'    22300026
223100                                         TO DP013-MESSAGE-TEXT (1)22310026
223200         MOVE ASC-ENT-ID              TO UD-ENT-ID                22320026
223300         MOVE ASC-DEPARTMENT          TO UD-DPT-NBR               22330026
223400         MOVE PV-AGRMT-TYP-ID         TO UD-AGRMT-TYP-ID          22340026
223500         MOVE PV-INSTR-SEQ-NBR        TO UD-INSTR-SEQ-NBR         22350026
223600         MOVE UD-UPDT-INSTR-DISPLAY   TO DP013-MESSAGE-TEXT (2)   22360026
223700         MOVE SQLCA      TO DP013-SQLCA                           22370026
223800         MOVE 'TVNDINS ' TO DP013-DB2-TABLE-NAME (1)              22380026
223900         SET DP013-DB2-ABEND                                      22390026
224000             DP013-XCTL-DISPLAY-RESTART TO TRUE                   22400026
224100                                                                  22410026
224200         PERFORM DP013-0000-PROCESS-ABEND                         22420026
224300     END-IF.                                                      22430026
224400                                                                  22440026
224500                                                                  22450026
224600*----------------------------------------------------------------*22460026
224700* OPEN THE VND-INSTR-CSR CURSOR.                                 *22470026
224800*----------------------------------------------------------------*22480026
224900                                                                  22490026
225000 8000-OPEN-VND-INSTR-CSR.                                         22500026
225100     PERFORM                                                      22510026
225200         WITH TEST AFTER                                          22520026
225300         VARYING PV-RETRY-COUNTER                                 22530026
225400         FROM 1 BY 1                                              22540026
225500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22550026
225600                   OR (SQLCODE = ZERO))                           22560026
225700*                                                                 22570026
225800         EXEC SQL                                                 22580026
225900             OPEN VND-INSTR-CSR                                   22590026
226000         END-EXEC                                                 22600026
226100*                                                                 22610026
226200         EVALUATE TRUE                                            22620026
226300             WHEN SQLCODE = ZERO                                  22630026
226400             WHEN SQLCODE = -904                                  22640026
226500             WHEN SQLCODE = -913                                  22650026
226600                 CONTINUE                                         22660026
226700             WHEN SQLWARN0 NOT = SPACES                           22670026
226800             WHEN SQLCODE < ZERO                                  22680026
226900             WHEN SQLCODE > ZERO                                  22690026
227000                 MOVE '8000-OPEN-VND-INSTR-CSR'                   22700026
227100                                   TO DP013-PARAGRAPH             22710026
227200                 MOVE 'OPEN VENDOR INSTRUCTION CURSOR - '         22720026
227300                                   TO DP013-MESSAGE-TEXT (1)      22730026
227400                 MOVE SQLCA        TO DP013-SQLCA                 22740026
227500                 MOVE 'TVNDINS '   TO DP013-DB2-TABLE-NAME (1)    22750026
227600                 SET DP013-DB2-ABEND                              22760026
227700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           22770026
227800                 PERFORM DP013-0000-PROCESS-ABEND                 22780026
227900         END-EVALUATE                                             22790026
228000     END-PERFORM.                                                 22800026
228100*                                                                 22810026
228200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22820026
228300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             22830026
228400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   22840026
228500                                   TO DP013-MESSAGE-TEXT (1)      22850026
228600         MOVE SQLCA                TO DP013-SQLCA                 22860026
228700         MOVE 'TBUSFNC '           TO DP013-DB2-TABLE-NAME (1)    22870026
228800         SET DP013-DB2-ABEND                                      22880026
228900             DP013-XCTL-DISPLAY-RESTART                           22890026
229000                                   TO TRUE                        22900026
229100         PERFORM DP013-0000-PROCESS-ABEND                         22910026
229200     END-IF.                                                      22920026
229300                                                                  22930026
229400 EJECT                                                            22940026
229500*----------------------------------------------------------------*22950026
229600* CLOSE THE VENDOR INSTRUCTION CURSOR                            *22960026
229700*----------------------------------------------------------------*22970026
229800                                                                  22980026
229900 8010-CLOSE-VND-INSTR-CSR.                                        22990026
230000     EXEC SQL                                                     23000026
230100         CLOSE VND-INSTR-CSR                                      23010026
230200     END-EXEC                                                     23020026
230300*                                                                 23030026
230400     EVALUATE TRUE                                                23040026
230500         WHEN SQLCODE = ZERO                                      23050026
230600             CONTINUE                                             23060026
230700         WHEN SQLWARN0 NOT = SPACES                               23070026
230800         WHEN SQLCODE < ZERO                                      23080026
230900         WHEN SQLCODE > ZERO                                      23090026
231000             MOVE '8010-CLOSE-VND-INSTR-CSR'                      23100026
231100                               TO DP013-PARAGRAPH                 23110026
231200             MOVE 'CLOSE VENDOR INSTRUCTION CURSOR '              23120026
231300                               TO DP013-MESSAGE-TEXT (1)          23130026
231400             MOVE SQLCA        TO DP013-SQLCA                     23140026
231500             MOVE 'TVNDINS '   TO DP013-DB2-TABLE-NAME (1)        23150026
231600             SET DP013-DB2-ABEND                                  23160026
231700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23170026
231800             PERFORM DP013-0000-PROCESS-ABEND                     23180026
231900     END-EVALUATE.                                                23190026
232000                                                                  23200026
232100 EJECT                                                            23210026
232200*----------------------------------------------------------------*23220026
232300*    FETCH THE VENDOR INSTRUCTION CURSOR                         *23230026
232400*----------------------------------------------------------------*23240026
232500                                                                  23250026
232600 8020-FETCH-VND-INSTR-CSR.                                        23260026
232700                                                                  23270026
232800     EXEC SQL                                                     23280026
232900         FETCH VND-INSTR-CSR                                      23290026
233000         INTO  :VNDINS-INSTR-SEQ-NBR                              23300026
233100              ,:VNDINS-VND-INSTR-TXT                              23310026
233200     END-EXEC                                                     23320026
233300                                                                  23330026
233400     EVALUATE TRUE                                                23340026
233500         WHEN SQLCODE = ZERO                                      23350026
233600              CONTINUE                                            23360026
233700         WHEN SQLCODE = +100                                      23370026
233800             SET PS-END-OF-VND-INSTR-CSR                          23380026
233900                                   TO TRUE                        23390026
234000         WHEN SQLWARN0 NOT = SPACE                                23400026
234100         WHEN SQLCODE NOT = ZERO                                  23410026
234200              MOVE '8020-FETCH-VND-INS-CSR'                       23420026
234300                               TO DP013-PARAGRAPH                 23430026
234400              MOVE 'FETCH VENDOR-INSTRUCTION CURSOR '             23440026
234500                               TO DP013-MESSAGE-TEXT (1)          23450026
234600              MOVE SQLCA       TO DP013-SQLCA                     23460026
234700              SET DP013-DB2-ABEND                                 23470026
234800                               TO TRUE                            23480026
234900              PERFORM DP013-0000-PROCESS-ABEND                    23490026
235000     END-EVALUATE.                                                23500026
235100                                                                  23510026
235200 EJECT                                                            23520026
235300 9100-READ-SELECTION-QUEUE.                                       23530026
235400                                                                  23540026
235500     EXEC CICS READQ TS QUEUE (ASC-SEL-QUEUE-NAME)                23550026
235600                        INTO  (VN003-VENDOR-SEL-REC)              23560026
235700                        ITEM  (ASC-SEL-ITEM)                      23570026
235800                        RESP  (PV-CICS-RESPONSE)                  23580026
235900                        END-EXEC.                                 23590026
236000                                                                  23600026
236100     IF PV-CICS-RESPONSE NOT = DFHRESP (NORMAL)                   23610026
236200         SET DP013-LOGIC-ABEND                                    23620026
236300             DP013-NO-ROLLBACK TO TRUE                            23630026
236400         MOVE '9100-READ-SELECTION-QUEUE' TO DP013-PARAGRAPH      23640026
236500         MOVE 'UNSUCCESSFUL SELECTION TEMP STORAGE QUEUE READ' TO 23650026
236600                                            DP013-MESSAGE-TEXT (1)23660026
236700         PERFORM DP013-0000-PROCESS-ABEND                         23670026
236800     END-IF.                                                      23680026
236900                                                                  23690026
237000 9200-REWRITE-SELECTION-QUEUE.                                    23700026
237100                                                                  23710026
237200     EXEC CICS WRITEQ TS QUEUE   (ASC-SEL-QUEUE-NAME)             23720026
237300                         FROM    (VN003-VENDOR-SEL-REC)           23730026
237400                         ITEM    (ASC-SEL-ITEM)                   23740026
237500                         RESP    (PV-CICS-RESPONSE)               23750026
237600                         REWRITE                                  23760026
237700                         END-EXEC.                                23770026
237800                                                                  23780026
237900     IF PV-CICS-RESPONSE NOT = DFHRESP (NORMAL)                   23790026
238000         SET DP013-CICS-ABEND                                     23800026
238100             DP013-NO-ROLLBACK TO TRUE                            23810026
238200         MOVE '9200-REWRITE-SELECTION-QUEUE' TO DP013-PARAGRAPH   23820026
238300         MOVE 'UNSUCCESSFUL SELECTION TEMP STORAGE QUEUE REWRITE' 23830026
238400                                         TO DP013-MESSAGE-TEXT (1)23840026
238500         PERFORM DP013-0000-PROCESS-ABEND                         23850026
238600     END-IF.                                                      23860026
238700                                                                  23870026
238800******************************************************************23880026
238900*   ABEND PROCESSING                                              23890026
239000******************************************************************23900026
239100     COPY DPPD013.                                                23910026
