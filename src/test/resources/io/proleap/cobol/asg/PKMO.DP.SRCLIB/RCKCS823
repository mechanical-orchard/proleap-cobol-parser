000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RCKCS823.                                         00020000
000300 AUTHOR.        JOE LAROSA.                                       00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  FEBRUARY, 2003.                                   00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800*    E823 - TROUBLE/PRORATION EDITS                               00080000
000900*           CALLED FROM RCKCS821 USING RCWS823 COMMAREA.          00090000
000910*                                                                 00091001
000920* *** NOTE:  RCKCS821 IS LINKED FROM TMKCS520.  THE PROGRAM NAME  00092001
000930*            IS NOT IN THE PROGRAM IT IS IN TKRPRPM DATABASE      00093001
000940*            THE PARM THAT CONTAINS THE PROGRAM IS RCPROV         00094001
001000******************************************************************00100000
001010*                                                                 00101000
001020*********************************************************         00102000
001030* *   IF ANY CHANGES ARE MADE TO THIS PROGRAM         * *         00103000
001040* *   BE SURE TO CHECK THE BATCH PROGRAM (RCKUP823)   * *         00104000
001050* *   TO SEE IF THE SAME CHANGE SHOULD BE MADE        * *         00105000
001060*********************************************************         00106000
001061*********************************************************         00106100
001062*  TOM PRIMEAU 03/11/10 WR#38216                                  00106200
001063*  REMOVED 'PC-E-COMMERCE-DC' VARIABLE FROM WORKING STORAGE       00106300
001064*  ADDED 4 NEW WORKING STORAGE SWITCHES TO HOLD E_BUS_IND         00106400
001065*  FOR 4 POTENTION LOCATIONS WE ARE PROCESSING.                   00106500
001070*     FOR THE 4 POTENTIAL LOCATIONS WE WILL BE PROCESSING.        00107000
001080*  ADDED 'XLT_LOC' DCLGEN XLT00010.                               00108000
001090*  ADDED LOGIC TO                                                 00109000
001100*  ADDED PARAGRAPH 1530-CHECK-FOR-LOCATION TO COLLECT             00110000
001200*     'E_BUS_IND AND LOC_TYPE_CDE.                                00120000
001300*  PARAGRAPH ADDED CHECK FOR THE 4 NEW PS-ECOM SWITCHES WHICH     00130000
001400*      ARE SET BASED ON LOC TYPE INDICATOR 'DC' AND E_BUS_IND     00140000
001500*      ='Y'.                                                      00150000
001600*  MODIFIED 'IF' STATEMENT IN PARAGRAPH 1500- TO NO LONGER USE    00160000
001700*      PC-E-COMMERCE-DC VARIABLE, BUT INSTEAD USE THE NEW         00170000
001800*      SWITCHES THAT MAY HAE BEEN SET BASED ON THE CALLS TO       00180000
001900*      XLT_LOC TABLE. MODIFIED THE 'IF' STATEMENT IN PARAGRAPH    00190000
002000*      1510- TO NO LONGER USE THE PC-E-COMMERCE-DC VARIABLE.      00200000
002100*  ADDED CHECK FOR XLT_LOC FOR UNIT ID IN PARA- 3000-.            00210000
002200*                                                                 00220000
002300*  MODIFIED 'IF' STATEMENT IN PARAGRAPH 3000- FOR                 00230000
002400* IF (TM500-OPER-UNT-ID = RC821-OPER-UNT-ID) OR                   00240000
002500*    (TM500-OPER-UNT-ID = RC821-CRE-OPER-UNT-ID) OR               00250000
002600*    (TM500-OPER-UNT-ID = RC821-CURR-OPER-UNT-ID)                 00260000
002700* CONTINUE                                                        00270000
002800* CHANGED 'E-COMM FACILITY' CHECK TO USE 'PS-ECOM-SWITCH-TM500    00280000
002900*  INSTEAD OF HARDCODED '870' CHECK.                              00290000
002901******************************************************************00290100
002902 ENVIRONMENT DIVISION.                                            00290200
002903 CONFIGURATION SECTION.                                           00290300
002904 SOURCE-COMPUTER.        IBM-3090.                                00290400
002905 OBJECT-COMPUTER.        IBM-3090.                                00290500
002906                                                                  00290600
002907 DATA DIVISION.                                                   00290700
002908******************************************************************00290800
002909 WORKING-STORAGE SECTION.                                         00290900
002910******************************************************************00291000
002911 01  PS-PROGRAM-SWITCHES.                                         00291100
002912     05  PS-DONE-SW                   PIC X(01) VALUE 'N'.        00291200
002913         88  PS-DONE-NO                         VALUE 'N'.        00291300
002914         88  PS-DONE-YES                        VALUE 'Y'.        00291400
002915     05  PS-RULE-DONE-SW              PIC X(01) VALUE 'N'.        00291500
002916         88  PS-RULE-DONE-NO                    VALUE 'N'.        00291600
002917         88  PS-RULE-DONE-YES                   VALUE 'Y'.        00291700
002918     05  PS-END-OF-RULES-SW           PIC X(01) VALUE 'N'.        00291800
002919         88  PS-END-OF-RULES-YES                VALUE 'Y'.        00291900
002920         88  PS-END-OF-RULES-NO                 VALUE 'N'.        00292000
003000     05  PS-END-OF-RULE-ACT-SW        PIC X(01) VALUE 'N'.        00300000
003100         88  PS-END-OF-RULE-ACT-YES             VALUE 'Y'.        00310000
003200         88  PS-END-OF-RULE-ACT-NO              VALUE 'N'.        00320000
003300                                                                  00330000
003400     05  PS-BAD-PACK-RATIO-SW         PIC X(01) VALUE 'N'.        00340000
003500         88  PS-BAD-PACK-RATIO-YES              VALUE 'Y'.        00350000
003600         88  PS-BAD-PACK-RATIO-NO               VALUE 'N'.        00360000
003700     05  PS-BAD-INNER-PACK-SW         PIC X(01) VALUE 'N'.        00370000
003800         88  PS-BAD-INNER-PACK-YES              VALUE 'Y'.        00380000
003900         88  PS-BAD-INNER-PACK-NO               VALUE 'N'.        00390000
004000     05  PS-ANALYST-BAD-PACK-SW       PIC X(01) VALUE 'N'.        00400000
004100         88  PS-ANALYST-BAD-PACK-YES            VALUE 'Y'.        00410000
004200         88  PS-ANALYST-BAD-PACK-NO             VALUE 'N'.        00420000
004300     05  PS-ANALYST-BP-WITHIN-SW      PIC X(01) VALUE 'N'.        00430000
004400         88  PS-ANALYST-BP-WITHIN-YES           VALUE 'Y'.        00440000
004500         88  PS-ANALYST-BP-WITHIN-NO            VALUE 'N'.        00450000
004600     05  PS-PACK-RATIO-MATCH-SW       PIC X(01) VALUE 'N'.        00460000
004700         88  PS-PACK-RATIO-MATCH-NO             VALUE 'N'.        00470000
004800         88  PS-PACK-RATIO-MATCH-YES            VALUE 'Y'.        00480000
004900     05  PS-BEST-CASE-UNITS-SW        PIC X(01) VALUE 'N'.        00490000
005000         88  PS-BEST-CASE-UNITS-NO              VALUE 'N'.        00500000
005100         88  PS-BEST-CASE-UNITS-YES             VALUE 'Y'.        00510000
005200     05  PS-MISS-PACK-LINES-SW        PIC X(01) VALUE 'N'.        00520000
005300         88  PS-MISS-PACK-LINES-NO              VALUE 'N'.        00530000
005400         88  PS-MISS-PACK-LINES-YES             VALUE 'Y'.        00540000
005410     05  PS-PO-RCVR-TRBL-SW           PIC X(01) VALUE 'N'.        00541000
005420         88  PS-PO-RCVR-TRBL-NO                 VALUE 'N'.        00542000
005430         88  PS-PO-RCVR-TRBL-YES                VALUE 'Y'.        00543000
005431     05  PS-ASNS-TO-WMS-SW        PIC X(01) VALUE 'N'.            00543100
005432         88  PS-ASNS-TO-WMS-YES             VALUE 'Y'.            00543200
005433         88  PS-ASNS-TO-WMS-NO              VALUE 'N'.            00543300
005434     05  PS-ECOM-SWITCH           PIC X(01) VALUE SPACES.         00543400
005435         88  PS-ECOM-YES                    VALUE 'Y'.            00543500
005436         88  PS-ECOM-NO                     VALUE 'N'.            00543600
005437     05  PS-ECOM-SWITCH-CRE       PIC X(01) VALUE SPACES.         00543700
005438         88  PS-ECOM-CRE-YES                VALUE 'Y'.            00543800
005439         88  PS-ECOM-CRE-NO                 VALUE 'N'.            00543900
005440     05  PS-ECOM-SWITCH-CURR      PIC X(01) VALUE SPACES.         00544000
005441         88  PS-ECOM-CURR-YES               VALUE 'Y'.            00544100
005442         88  PS-ECOM-CURR-NO                VALUE 'N'.            00544200
005443     05  PS-ECOM-SWITCH-TM500     PIC X(01) VALUE SPACES.         00544300
005444         88  PS-ECOM-TM500-YES              VALUE 'Y'.            00544400
005445         88  PS-ECOM-TM500-NO               VALUE 'N'.            00544500
005500                                                                  00550000
005600 01  PC-PROGRAM-CONSTANTS.                                        00560000
005700     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'RCKCS823'. 00570000
005800     05  PC-LOG-QUEUE                 PIC X(04) VALUE 'CSSL'.     00580000
005900                                                                  00590000
006000     05  PC-TMKCS521                  PIC X(08) VALUE 'TMKCS521'. 00600000
006100     05  PC-600                       PIC S9(4) COMP VALUE +600.  00610000
006200     05  PC-OVER                      PIC X(05) VALUE ' OVER'.    00620000
006300     05  PC-SHORT                     PIC X(05) VALUE 'SHORT'.    00630000
006400     05  PC-NEW-STORE                 PIC X(11) VALUE             00640000
006500                                                ' NEW STORE '.    00650000
006600     05  PC-IMPORT                    PIC X(11) VALUE             00660000
006700                                                '   IMPORT  '.    00670000
006800     05  PC-IMPORT-PIC-AD             PIC X(11) VALUE             00680000
006900                                                'IMP PIC AD '.    00690000
006920     05  PC-379                       PIC S9(4) COMP VALUE +379.  00692000
006930     05  PC-406                       PIC S9(4) COMP VALUE +406.  00693000
007000                                                                  00700000
007100 01  DK-DATABASE-KEYS.                                            00710000
007200     05  DK-RULE-KEY                  PIC S9(9) COMP.             00720000
007300     05  DK-RULE-SEQ                  PIC S9(4) COMP.             00730000
007400     05  DK-RULE-RESULT               PIC X(01).                  00740000
007500                                                                  00750000
007600 01  PV-PROGRAM-VARIABLES.                                        00760000
007700     05  L                            PIC S9(4) COMP SYNC.        00770000
007800     05  DL                           PIC S9(4) COMP SYNC.        00780000
007900     05  PV-QUEUE-NAME.                                           00790000
008000         10  PV-TERM-ID               PIC X(4).                   00800000
008100         10  PV-TASK-NUMBER           PIC S9(5) COMP-3.           00810000
008200         10  PV-SEQ                   PIC 9.                      00820000
008300     05  PV-NULL-IND1                 PIC S9(4) VALUE ZERO        00830000
008400                                                COMP SYNC.        00840000
008500     05  PV-NULL-IND2                 PIC S9(4) VALUE ZERO        00850000
008600                                                COMP SYNC.        00860000
008700     05  PV-ITEM                      PIC S9(4) VALUE ZERO        00870000
008800                                                COMP SYNC.        00880000
008900     05  PV-CICS-RESP                 PIC S9(4) VALUE ZERO        00890000
009000                                                COMP SYNC.        00900000
009100     05  PV-RULE-SEQ                  PIC S9(4).                  00910000
009200     05  PV-RULE-RESULT               PIC X(01).                  00920000
009300         88  PV-RULE-RESULT-TRUE                VALUE 'Y'.        00930000
009400         88  PV-RULE-RESULT-FALSE               VALUE 'N'.        00940000
009500                                                                  00950000
009600     05  PV-UNTIED-PACK-LINES         PIC X(01).                  00960000
009700     05  PV-LINE-ODD-UNITS            PIC X(01).                  00970000
009800     05  PV-LINES-MISSING             PIC X(01).                  00980000
009900     05  PV-DIFFERENT-RATIOS          PIC X(01).                  00990000
010000     05  PV-BEST-CASE-ZERO            PIC X(01).                  01000000
010100     05  PV-LINE-ODU-OUT-OF-TOL       PIC X(01).                  01010000
010200     05  PV-PACK-ODU-OUT-OF-TOL       PIC X(01).                  01020000
010300     05  PV-LINE-ODUD-OUT-OF-TOL      PIC X(01).                  01030000
010400     05  PV-PACK-ODUD-OUT-OF-TOL      PIC X(01).                  01040000
010410     05  PV-COPER-UNT-ID          PIC S9(04) COMP VALUE +0.       01041000
010500     05  PV-OPER-UNT-ID           PIC S9(04) COMP VALUE +0.       01050000
010600     05  PV-UNIT-PRICE                PIC S9(7)V99.               01060000
010700     05  PV-PACK-PRICE                PIC S9(7)V99.               01070000
010800     05  PV-ITM-RECEIVED              PIC S9(7)V99.               01080000
010900     05  PV-TOT-RECEIVED              PIC S9(7)V99.               01090000
011000     05  PV-TOT-PLAN                  PIC S9(7)V99.               01100000
011100     05  PV-LINE-DOLLARS              PIC S9(7)V99.               01110000
011200     05  PV-PACK-DOLLARS              PIC S9(7)V99.               01120000
011300     05  PV-LINE-OV-AMT               PIC S9(7)V99.               01130000
011400     05  PV-LINE-SH-AMT               PIC S9(7)V99.               01140000
011500     05  PV-TOT-OTR                   PIC 9(07).                  01150000
011600     05  PV-TOTAL-DOLLARS-OVER-SHORT  PIC S9(7)V99.               01160000
011700     05  PV-UNITS-OVER-DOLLARS        PIC S9(7)V99.               01170000
011800     05  PV-UNITS-SHORT-DOLLARS       PIC S9(7)V99.               01180000
011900                                                                  01190000
012000     05  PV-ACCUM-RECD-UNITS          PIC 9(07).                  01200000
012100     05  PV-ACCUM-OTR-UNITS           PIC 9(06).                  01210000
012200     05  PV-ACCUM-RTL-DOLLARS         PIC 9(07)V99.               01220000
012300     05  PV-ACCUM-LINE-OV-QTY         PIC 9(06).                  01230000
012400     05  PV-ACCUM-LINE-OV-AMT         PIC 9(07)V99.               01240000
012500     05  PV-ACCUM-LINE-SH-QTY         PIC 9(06).                  01250000
012600     05  PV-ACCUM-LINE-SH-AMT         PIC 9(07)V99.               01260000
012700                                                                  01270000
012800     05  PV-ODD-UNIT-DOLLARS          PIC S9(7)V99.               01280000
012900     05  PV-TOT-ODD-UNIT-AMT          PIC S9(7)V99.               01290000
013000     05  PV-TOT-ODD-UNIT-QTY          PIC 9(07).                  01300000
013100     05  PV-TOTAL-LINE-OTR-UNITS      PIC 9(07).                  01310000
013200     05  PV-DISCREPANCY-IND           PIC X(01).                  01320000
013300     05  PV-AVG-UNITS                 PIC 9(04)V99.               01330000
013400     05  PV-UNIT-PERCENT              PIC 9(03)V9999.             01340000
013500     05  PV-UNIT-AVERAGE              PIC S9(4)V9999.             01350000
013600     05  PV-RATIO                     PIC 9(03)V99.               01360000
013700     05  PV-ITEM-IDX                  PIC S9(4)  VALUE +0 COMP.   01370000
013800     05  PV-SHIPT-OVRG-PCT            PIC S9(2)V COMP-3.          01380000
013900     05  PV-SHIPT-SHTG-PCT            PIC S9(2)V COMP-3.          01390000
014000     05  PV-TEMP-AMT                  PIC 9(9).                   01400000
014100     05  PV-DC-OPER-UNT-ID            PIC S9(4)  COMP.            01410000
014300     05  PV-PRO-RANDOM                PIC X(03).                  01430000
014400     05  PV-CURRENT-DATE              PIC X(10).                  01440000
014500     05  PV-DISTRO-QTY                PIC 9(07).                  01450000
014600     05  PV-PACKS-GIVEN-OUT           PIC 9(07).                  01460000
014700     05  PV-NUM-STORE-NEED-PACKS      PIC 9(07).                  01470000
014800     05  PV-PACKS-TO-GIVE-OUT         PIC 9(07).                  01480000
014900     05  PV-PACK-REC                  PIC 9(07).                  01490000
015000     05  PV-PACK-OV                   PIC 9(07).                  01500000
015100     05  PV-NEW-STR-CNT               PIC 9(04).                  01510000
015200     05  PV-OLD-STR-CNT               PIC 9(04).                  01520000
015300     05  PV-CS-STR-CNT                PIC 9(04).                  01530000
015400     05  PV-OVRG-STR-CNT              PIC 9(04).                  01540000
015500     05  PV-OVRG-QTY                  PIC 9(07).                  01550000
015600     05  PV-LINE-OV-QTY               PIC 9(07).                  01560000
015700     05  PV-LINE-SH-QTY               PIC 9(07).                  01570000
015800     05  PV-SUM-PACK-UNITS            PIC 9(07).                  01580000
015900     05  PV-SUM-PACK-OTR-UNITS        PIC 9(07).                  01590000
016000     05  PV-MSG-TEXT                  PIC X(17).                  01600000
016100     05  PV-LINE-UNITS                PIC 9(07).                  01610000
016200     05  PV-MISS-LINE-MSG             PIC X(01).                  01620000
016300     05  PV-RATIO-CHG-MSG             PIC X(01).                  01630000
016400     05  PV-TOT-QTY-OV-SH             PIC 9(07).                  01640000
016500     05  PV-ARULAL-STR-CNT            PIC 9(04).                  01650000
016600     05  PV-DISPERSAL-QTY             PIC 9(05).                  01660000
016700     05  PV-PACKS-PLANNED             PIC 9(05).                  01670000
016800     05  PV-UNITS-PLANNED             PIC 9(05).                  01680000
016900     05  PV-REMAINDER                 PIC 9(05)V9999.             01690000
017000** AHP - BEGIN - 04/23/08                                         01700000
017100     05  PV-DB2-COUNT                 PIC S9(09)  VALUE +0        01710000
017200                                                  COMP-3.         01720000
017201** AHP -  END - 04/23/08                                          01720100
017202                                                                  01720200
017203     05  SAVE-TM500-PO-LNE-NBR        PIC S9(9) COMP.             01720300
017204     05  SAVE-TM500-PREPK-ID          PIC S9(4) COMP.             01720400
017300     05  SAVE-TM500-PROCESS-IND       PIC X(03).                  01730000
017400                                                                  01740000
017500 01  RC001-WORK-FIELDS.                                           01750000
017600     05  RC001-LOG-QUEUE              PIC X(04) VALUE 'CSSL'.     01760000
017700     05  RC001-LOG-LINE               PIC X(80) VALUE SPACES.     01770000
017800     05  RC001-CICS-RESPONSE          PIC S9(8) COMP VALUE ZERO.  01780000
017900     05  RC001-SAVE-SQLCODE           PIC S9(8) COMP VALUE ZERO.  01790000
018000                                                                  01800000
018100 01  RC001-ERROR-MESSAGE-LINES.                                   01810000
018200     05  RC001-LINE-01.                                           01820000
018300         10  FILLER                   PIC X(44) VALUE             01830000
018400             '****** RCKCS823 - TROUBLE EDIT ERROR ****** '.      01840000
018500         10  FILLER                   PIC X(03) VALUE SPACES.     01850000
018600         10  FILLER                   PIC X(08) VALUE             01860000
018700                                                'USERID= '.       01870000
018800         10  RC001-USERID             PIC X(07) VALUE SPACES.     01880000
018900         10  FILLER                   PIC X(18) VALUE SPACES.     01890000
019000     05  RC001-LINE-02.                                           01900000
019100         10  RC001-DATE               PIC X(10) VALUE SPACES.     01910000
019200         10  FILLER                   PIC X(02) VALUE SPACES.     01920000
019300         10  RC001-TIME               PIC X(08) VALUE SPACES.     01930000
019400         10  FILLER                   PIC X(02) VALUE SPACES.     01940000
019500         10  FILLER                   PIC X(11) VALUE             01950000
019600                                                'PARAGRAPH= '.    01960000
019700         10  RC001-PARAGRAPH          PIC X(30) VALUE SPACES.     01970000
019800         10  FILLER                   PIC X(02) VALUE SPACES.     01980000
019900         10  FILLER                   PIC X(10) VALUE             01990000
020000                                                ' SQLCODE= '.     02000000
020100         10  RC001-SQLCODE            PIC -999.                   02010000
020200         10  FILLER                   PIC X(01) VALUE SPACES.     02020000
020300     05  RC001-LINE-03.                                           02030000
020400         10  FILLER                   PIC X(14) VALUE             02040000
020500                                                'PO/RCVR/LINE= '. 02050000
020600         10  RC001-PO.                                            02060000
020700             15  RC001-PO-NBR         PIC 9(08) VALUE ZEROES.     02070000
020800         10  FILLER                   PIC X(01) VALUE '/'.        02080000
020900         10  RC001-RCVR.                                          02090000
021000             15  RC001-REC-SEQ-NBR    PIC 9(03) VALUE ZEROES.     02100000
021100         10  FILLER                   PIC X(01) VALUE '/'.        02110000
021200         10  RC001-LINE.                                          02120000
021300             15 RC001-PO-LNE-NBR      PIC 9(03) VALUE ZEROES.     02130000
021400         10  FILLER                   PIC X(03) VALUE SPACES.     02140000
021500         10  FILLER                   PIC X(12) VALUE             02150000
021600                                                'OPER/FCLTY= '.   02160000
021700         10  RC001-OP.                                            02170000
021800             15 RC001-OPER-UNT-ID     PIC 9(04) VALUE ZEROES.     02180000
021900         10  FILLER                   PIC X(01) VALUE '/'.        02190000
022000         10  RC001-FCLTY.                                         02200000
022100             15  RC001-FCLTY-ID       PIC 9(01) VALUE ZEROES.     02210000
022200         10  FILLER                   PIC X(03) VALUE SPACES.     02220000
022300         10  FILLER                   PIC X(06) VALUE             02230000
022400                                                'PACK= '.         02240000
022500         10  RC001-PREPK-ID           PIC 9(04) VALUE ZEROES.     02250000
022600         10  FILLER                   PIC X(03) VALUE SPACES.     02260000
022700         10  FILLER                   PIC X(07) VALUE             02270000
022800                                                'STORE= '.        02280000
022900         10  RC001-STORE-NBR.                                     02290000
023000             15  RC001-STORE-NBR-N    PIC 9(04) VALUE ZEROES.     02300000
023100         10  FILLER                   PIC X(03) VALUE SPACES.     02310000
023200     05  RC001-LINE-04.                                           02320000
023300         10  RC001-SPECIAL-1          PIC X(40) VALUE SPACES.     02330000
023400         10  RC001-SPECIAL-2          PIC X(40) VALUE SPACES.     02340000
023500     05  RC001-LINE-05.                                           02350000
023600         10  FILLER                   PIC X(44) VALUE             02360000
023700             '****** RCKCS823 - TROUBLE EDIT ERROR ****** '.      02370000
023800         10  FILLER                   PIC X(36) VALUE SPACES.     02380000
023900                                                                  02390000
024000 01  TM-TROUBLE-MESSAGES.                                         02400000
024100*MESSAGE FORMAT 1 (PRICE DISCREPANCY).                            02410000
024200*    05  TM-PRICE-DISC-TEXT.                                      02420000
024300*        10  TM-PRICE-DISC-TEXT-1.                                02430000
024400*            15  FILLER               PIC X(15) VALUE             02440000
024500*                                     'PO UNIT RTL  : '.          02450000
024600*            15  TM-MF1-PO-UNT-RTL    PIC ZZZZZZ9.99.             02460000
024700*            15  FILLER               PIC X(15) VALUE             02470000
024800*                                     ' SKU UNIT RTL: '.          02480000
024900*            15  TM-MF1-SKU-UNT-RTL   PIC ZZZZZZ9.99.             02490000
025000*        10  TM-PRICE-DISC-TEXT-2.                                02500000
025100*            15  FILLER               PIC X(21)  VALUE            02510000
025200*                                     'PO GRP QTY   :       '.    02520000
025300*            15  TM-MF1-PO-GP-QTY     PIC ZZZ9.                   02530000
025400*            15  FILLER               PIC X(21)  VALUE            02540000
025500*                                     ' SKU GRP QTY :       '.    02550000
025600*            15  TM-MF1-SKU-GP-QTY    PIC ZZZ9.                   02560000
025700*        10  TM-PRICE-DISC-TEXT-3.                                02570000
025800*            15  FILLER               PIC X(15)  VALUE            02580000
025900*                                     'PO GRP RTL   : '.          02590000
026000*            15  TM-MF1-PO-GP-RTL     PIC ZZZZZZ9.99.             02600000
026100*            15  FILLER               PIC X(15)  VALUE            02610000
026200*                                     ' SKU GRP RTL : '.          02620000
026300*            15  TM-MF1-SKU-GP-RTL    PIC ZZZZZZ9.99.             02630000
026400*        10  FILLER                   PIC X(100) VALUE SPACES.    02640000
026500                                                                  02650000
026600*MESSAGE FORMAT 2 (STORE CLOSED).                                 02660000
026700     05  TM-STR-CLS-TEXT.                                         02670000
026800         10  FILLER                   PIC X(13)  VALUE            02680000
026900                                                 'STORE NUMBER '. 02690000
027000         10  TM-MF2-STR               PIC ZZZ9.                   02700000
027100         10  FILLER                   PIC X(07)  VALUE ' CLOSED'. 02710000
027200         10  FILLER                   PIC X(226) VALUE SPACES.    02720000
027300                                                                  02730000
027400*MESSAGE FORMAT 3 (STORE NOT OPEN).                               02740000
027500     05  TM-STR-NOT-RCVG-TEXT.                                    02750000
027600         10  FILLER                   PIC X(13)  VALUE            02760000
027700                                                 'STORE NUMBER '. 02770000
027800         10  TM-MF3-STR               PIC ZZZ9.                   02780000
027900         10  FILLER                   PIC X(23)  VALUE            02790000
028000             ' NOT OPEN FOR RECEIVING'.                           02800000
028100         10  FILLER                   PIC X(210) VALUE SPACES.    02810000
028200                                                                  02820000
028300*MESSAGE FORMAT 4 (WRONG DC).                                     02830000
028400     05  TM-WRONG-DC-TEXT.                                        02840000
028500         10  FILLER                   PIC X(26)  VALUE            02850000
028600             'WRONG DC FOR STORE NUMBER '.                        02860000
028700         10  TM-MF4-STR               PIC ZZZ9.                   02870000
028800         10  FILLER                   PIC X(220) VALUE SPACES.    02880000
028900                                                                  02890000
029000*MESSAGE FORMAT 5 (LINE STATUS).                                  02900000
029100     05  TM-LINE-STS-TEXT.                                        02910000
029200         10  FILLER                   PIC X(20)  VALUE            02920000
029300             'UNITS RECEIVED:     '.                              02930000
029400         10  TM-MF5-RCVD-QTY          PIC ZZZ9.                   02940000
029500         10  FILLER                   PIC X(226) VALUE SPACES.    02950000
029600                                                                  02960000
029700*MESSAGE FORMAT 6 (ZERO BEST CASE).                               02970000
029800     05  TM-ZERO-BEST-CASE-TEXT.                                  02980000
029900         10  TM-ZERO-BEST-CASE-LINE-1.                            02990000
030000             15  FILLER               PIC X(20)  VALUE            03000000
030100             'ZERO BEST CASE UNITS'.                              03010000
030200             15  FILLER               PIC X(30)  VALUE SPACES.    03020000
030300         10  FILLER                   PIC X(200) VALUE SPACES.    03030000
030400                                                                  03040000
030500*MESSAGE FORMAT 7 (PACK OVER).                                    03050000
030600     05  TM-PACK-OVER-TEXT.                                       03060000
030700         10  TM-PACK-OVER-LINE-1.                                 03070000
030800             15  FILLER               PIC X(09)  VALUE            03080000
030900                                                 'PACK REC:'.     03090000
031000             15  TM-MF7-REC           PIC ZZZZ9.                  03100000
031100             15  FILLER               PIC X(02)  VALUE SPACES.    03110000
031200             15  FILLER               PIC X(09)  VALUE            03120000
031300                                                 'PACK OTR:'.     03130000
031400             15  TM-MF7-OTR           PIC ZZZZ9.                  03140000
031500             15  FILLER               PIC X(03)  VALUE SPACES.    03150000
031600             15  FILLER               PIC X(08)  VALUE            03160000
031700                                                 'PACK OV:'.      03170000
031800             15  TM-MF7-OV-QTY        PIC ZZZ9.                   03180000
031900             15  FILLER               PIC X(01)  VALUE '/'.       03190000
032000             15  TM-MF7-OV-PCT        PIC ZZ9.                    03200000
032100             15  FILLER               PIC X(01)  VALUE '%'.       03210000
032200         10  TM-PACK-OVER-LINE-2.                                 03220000
032300             15  FILLER               PIC X(09)  VALUE            03230000
032400                                                 'PACK RT$:'.     03240000
032500             15  TM-MF7-RT-AMT        PIC $ZZZZ9.99.              03250002
032600             15  FILLER               PIC X(04)  VALUE SPACES.    03260004
032700             15  FILLER               PIC X(18)  VALUE            03270004
032800                                      'TOTAL PACK RT$ OV:'.       03280000
032900             15  TM-MF7-TOT-RT-AMT    PIC $ZZZZZ9.99.             03290003
033000         10  TM-PACK-OVER-LINE-3.                                 03300000
033100             15  FILLER               PIC X(09)  VALUE            03310000
033200                                                 'ODD UNIT:'.     03320000
033300             15  TM-MF7-ODD-QTY       PIC ZZZZ9.                  03330003
033400             15  FILLER               PIC X(10)  VALUE SPACES.    03340002
033500             15  FILLER               PIC X(17)  VALUE            03350000
033600                                      'TOTAL ODD UNIT$: '.        03360000
033700             15  TM-MF7-ODD-AMT       PIC $ZZZZ9.99.              03370003
033800         10  TM-PACK-OVER-LINE-4.                                 03380000
033900             15  TM-MF7-TEXT          PIC X(17).                  03390000
034000             15  FILLER               PIC X(03)  VALUE SPACES.    03400000
034100             15  FILLER               PIC X(20)  VALUE            03410000
034200                                      '#STORES ALLOC/AV UN:'.     03420000
034300             15  TM-MF7-STR-ALLOC     PIC ZZ9.                    03430000
034400             15  FILLER               PIC X(01)  VALUE '/'.       03440000
034500             15  TM-MF7-AVG-UN        PIC ZZ9.99.                 03450000
034600         10  FILLER                   PIC X(50)  VALUE SPACES.    03460000
034700                                                                  03470000
034800*MESSAGE FORMAT 8 (INVALID STORE DISTRO).                         03480000
034900     05  TM-INVALID-STORE-TEXT.                                   03490000
035000         10  TM-BAD-STORE-PLAN-LINE-1.                            03500000
035100             15  FILLER               PIC X(05)  VALUE            03510000
035200                                                 'STR: '.         03520000
035300             15  TM-MF8-STR           PIC ZZZ9.                   03530000
035400             15  FILLER               PIC X(41)  VALUE SPACES.    03540000
035500         10  TM-BAD-STORE-PLAN-LINE-2.                            03550000
035600             15  FILLER               PIC X(20)  VALUE            03560000
035700             'INVALID STORE DISTRO'.                              03570000
035800             15  FILLER               PIC X(30)  VALUE SPACES.    03580000
035900         10  TM-BAD-STORE-PLAN-LINE-3.                            03590000
036000             15  FILLER               PIC X(26)  VALUE            03600000
036100             'CHECK PACKS AND REALLOCATE'.                        03610000
036200             15  FILLER               PIC X(24)  VALUE SPACES.    03620000
036300         10  FILLER                   PIC X(100) VALUE SPACES.    03630000
036400                                                                  03640000
036500*MESSAGE FORMAT 9 (PENDING PRICE CHANGE).                         03650000
036600*    05  TM-PRICE-CHG-TEXT.                                       03660000
036700*        10  TM-PRICE-CHG-TEXT-1.                                 03670000
036800*            15  FILLER               PIC X(15)  VALUE            03680000
036900*                                     'PO UNIT RTL  : '.          03690000
037000*            15  TM-MF9-PO-UNT-RTL    PIC ZZZZZZ9.99.             03700000
037100*            15  FILLER               PIC X(15)  VALUE            03710000
037200*                                     ' PPC UNIT RTL: '.          03720000
037300*            15  TM-MF9-PTM-UNT-RTL   PIC ZZZZZZ9.99.             03730000
037400*        10  TM-PRICE-CHG-TEXT-2.                                 03740000
037500*            15  FILLER               PIC X(21)  VALUE            03750000
037600*                                     'PO GRP QTY   :       '.    03760000
037700*            15  TM-MF9-PO-GP-QTY     PIC ZZZ9.                   03770000
037800*            15  FILLER               PIC X(21)  VALUE            03780000
037900*                                     ' PPC GRP QTY :       '.    03790000
038000*            15  TM-MF9-PPC-GP-QTY    PIC ZZZ9.                   03800000
038100*        10  TM-PRICE-CHG-TEXT-3.                                 03810000
038200*            15  FILLER               PIC X(15)  VALUE            03820000
038300*                                     'PO GRP RTL   : '.          03830000
038400*            15  TM-MF9-PO-GP-RTL     PIC ZZZZZZ9.99.             03840000
038500*            15  FILLER               PIC X(15)  VALUE            03850000
038600*                                     ' PPC GRP RTL : '.          03860000
038700*            15  TM-MF9-PPC-GP-RTL    PIC ZZZZZZ9.99.             03870000
038800*        10  FILLER                   PIC X(100) VALUE SPACES.    03880000
038900*                                                                 03890000
039000*MESSAGE FORMAT 10 (SHORT).                                       03900000
039100     05  TM-SHORT-TEXT.                                           03910000
039200         10  TM-SHORT-TEXT-1.                                     03920000
039300             15  FILLER               PIC X(17)  VALUE            03930000
039400                                      'UNITS RECEIVED:  '.        03940000
039500             15  TM-MF10-RCVD-QTY     PIC ZZZZ9-.                 03950000
039600             15  FILLER               PIC X(04)  VALUE SPACES.    03960000
039700             15  FILLER               PIC X(18)  VALUE            03970000
039800                                      'UNITS OTR:        '.       03980000
039900             15  TM-MF10-OTR-QTY      PIC ZZZZ9.                  03990000
040000         10  TM-SHORT-TEXT-2.                                     04000000
040100             15  FILLER               PIC X(17)  VALUE            04010000
040200                                      'UNITS SHORT   :  '.        04020000
040300             15  TM-MF10-SH-QTY       PIC ZZZZ9-.                 04030000
040400             15  FILLER               PIC X(04)  VALUE SPACES.    04040000
040500             15  FILLER               PIC X(19)  VALUE            04050000
040600                                      'UNITS SHORT %:     '.      04060000
040700             15  TM-MF10-SH-PCT       PIC ZZ9.                    04070000
040800             15  FILLER               PIC X(01)  VALUE '%'.       04080000
040900         10  TM-SHORT-TEXT-3.                                     04090000
041000             15  FILLER               PIC X(19)  VALUE            04100000
041100                                      '#STORES ALLOC :    '.      04110000
041200             15  TM-MF10-STR-ALLOC    PIC ZZ9.                    04120000
041300             15  FILLER               PIC X(05)  VALUE SPACES.    04130000
041400             15  FILLER               PIC X(17)  VALUE            04140000
041500                                      'AV UNITS/STORE:  '.        04150000
041600             15  TM-MF10-AV-UN-STR    PIC ZZ9.99.                 04160000
041700         10  TM-SHORT-TEXT-4.                                     04170000
041800             15  FILLER               PIC X(13)  VALUE            04180000
041900                                      'RTL$/UNIT:   '.            04190000
042000             15  TM-MF10-RTL-UN       PIC $ZZZZ9.99.              04200000
042100             15  FILLER               PIC X(02)  VALUE SPACES.    04210000
042200             15  FILLER               PIC X(15)  VALUE            04220000
042300                                      'TOTAL RTL$ SH: '.          04230000
042400             15  TM-MF10-SH-AMT       PIC $ZZZZZZ9.99.            04240000
042500         10  FILLER                   PIC X(50)  VALUE SPACES.    04250000
042600                                                                  04260000
042700*MESSAGE FORMAT 11 (PACK SHORT).                                  04270000
042800     05  TM-PACK-SHORT-TEXT.                                      04280000
042900         10  TM-PACK-SHORT-LINE-1.                                04290000
043000             15  FILLER               PIC X(09)  VALUE            04300000
043100                                                 'PACK REC:'.     04310000
043200             15  TM-MF11-REC          PIC ZZZZ9.                  04320000
043300             15  FILLER               PIC X(02)  VALUE SPACES.    04330000
043400             15  FILLER               PIC X(09)  VALUE            04340000
043500                                                 'PACK OTR:'.     04350000
043600             15  TM-MF11-OTR          PIC ZZZZ9.                  04360000
043700             15  FILLER               PIC X(03)  VALUE SPACES.    04370000
043800             15  FILLER               PIC X(08)  VALUE            04380000
043900                                                 'PACK SH:'.      04390000
044000             15  TM-MF11-SH-QTY       PIC ZZZ9.                   04400000
044100             15  FILLER               PIC X(01)  VALUE '/'.       04410000
044200             15  TM-MF11-SH-PCT       PIC ZZ9.                    04420000
044300             15  FILLER               PIC X(01)  VALUE '%'.       04430000
044400         10  TM-PACK-SHORT-LINE-2.                                04440000
044500             15  FILLER               PIC X(09)  VALUE            04450000
044600                                                 'PACK RT$:'.     04460000
044700             15  TM-MF11-RT-AMT       PIC $ZZZZ9.99.              04470002
044800             15  FILLER               PIC X(04)  VALUE SPACES.    04480004
044900             15  FILLER               PIC X(18)  VALUE            04490004
045000                                      'TOTAL PACK RT$ SH:'.       04500000
045100             15  TM-MF11-TOT-RT-AMT   PIC $ZZZZZ9.99.             04510003
045200         10  TM-PACK-SHORT-LINE-3.                                04520000
045300             15  FILLER               PIC X(09)  VALUE            04530000
045400                                                 'ODD UNIT:'.     04540000
045500             15  TM-MF11-ODD-QTY      PIC ZZZZ9.                  04550005
045600             15  FILLER               PIC X(10)  VALUE SPACES.    04560006
045700             15  FILLER               PIC X(17)  VALUE            04570000
045800                                      'TOTAL ODD UNIT$: '.        04580000
045900             15  TM-MF11-ODD-AMT      PIC $ZZZZ9.99.              04590006
046000         10  TM-PACK-SHORT-LINE-4.                                04600000
046100             15  TM-MF11-TEXT         PIC X(17).                  04610000
046200             15  FILLER               PIC X(10)  VALUE SPACES.    04620000
046300             15  FILLER               PIC X(20)  VALUE            04630000
046400                                      '#STORES ALLOC:      '.     04640000
046500             15  TM-MF11-STR-ALLOC    PIC ZZ9.                    04650000
046600         10  FILLER                   PIC X(50)  VALUE SPACES.    04660000
046700                                                                  04670000
046800*MESSAGE FORMAT 12 (OVER).                                        04680000
046900     05  TM-OVER-TEXT.                                            04690000
047000         10  TM-OVER-TEXT-1.                                      04700000
047100             15  FILLER               PIC X(17)  VALUE            04710000
047200                                      'UNITS RECEIVED:  '.        04720000
047300             15  TM-MF12-RCVD-QTY     PIC ZZZZ9-.                 04730000
047400             15  FILLER               PIC X(04)  VALUE SPACES.    04740000
047500             15  FILLER               PIC X(18)  VALUE            04750000
047600                                      'UNITS OTR:        '.       04760000
047700             15  TM-MF12-OTR-QTY      PIC ZZZZ9.                  04770000
047800         10  TM-OVER-TEXT-2.                                      04780000
047900             15  FILLER               PIC X(17)  VALUE            04790000
048000                                      'UNITS OVER    :  '.        04800000
048100             15  TM-MF12-OV-QTY       PIC ZZZZ9-.                 04810000
048200             15  FILLER               PIC X(04)  VALUE SPACES.    04820000
048300             15  FILLER               PIC X(19)  VALUE            04830000
048400                                      'UNITS OVER  %:     '.      04840000
048500             15  TM-MF12-OV-PCT       PIC ZZ9.                    04850000
048600             15  FILLER               PIC X(01)  VALUE '%'.       04860000
048700         10  TM-OVER-TEXT-3.                                      04870000
048800             15  FILLER               PIC X(19)  VALUE            04880000
048900                                      '#STORES ALLOC :    '.      04890000
049000             15  TM-MF12-STR-ALLOC    PIC ZZ9.                    04900000
049100             15  FILLER               PIC X(05)  VALUE SPACES.    04910000
049200             15  FILLER               PIC X(17)  VALUE            04920000
049300                                      'AV UNITS/STORE:  '.        04930000
049400             15  TM-MF12-AV-UN-STR    PIC ZZ9.99.                 04940000
049500         10  TM-OVER-TEXT-4.                                      04950000
049600             15  FILLER               PIC X(13)  VALUE            04960000
049700                                      'RTL$/UNIT:   '.            04970000
049800             15  TM-MF12-RTL-UN       PIC $ZZZZ9.99.              04980000
049900             15  FILLER               PIC X(02)  VALUE SPACES.    04990000
050000             15  FILLER               PIC X(15)  VALUE            05000000
050100                                      'TOTAL RTL$ OV: '.          05010000
050200             15  TM-MF12-OV-AMT       PIC $ZZZZZZ9.99.            05020000
050300         10  FILLER                   PIC X(50)  VALUE SPACES.    05030000
050400                                                                  05040000
050500*MESSAGE FORMAT 13 (PACK NO DISTRO).                              05050000
050600     05  TM-PACK-NO-DISTRO-TEXT.                                  05060000
050700         10  TM-PACK-NO-DISTRO-LINE-1.                            05070000
050800             15  FILLER               PIC X(22)  VALUE            05080000
050900                 'PACKS RECEIVED:       '.                        05090000
051000             15  TM-MF13-RCVD-QTY     PIC ZZ9.                    05100000
051100             15  FILLER               PIC X(25)  VALUE SPACES.    05110000
051200         10  FILLER                   PIC X(200) VALUE SPACES.    05120000
051300                                                                  05130000
051400*MESSAGE FORMAT 14 (BAD PACK).                                    05140000
051500     05  TM-BAD-PACK-TEXT.                                        05150000
051600         10  TM-BAD-PACK-LINE-1.                                  05160000
051700             15  FILLER               PIC X(09)  VALUE            05170000
051800                                                 'PACK REC:'.     05180000
051900             15  TM-MF14-REC          PIC ZZZZ9.                  05190000
052000             15  FILLER               PIC X(02)  VALUE SPACES.    05200000
052100             15  FILLER               PIC X(09)  VALUE            05210000
052200                                                 'PACK OTR:'.     05220000
052300             15  TM-MF14-OTR          PIC ZZZZ9.                  05230000
052400             15  FILLER               PIC X(03)  VALUE SPACES.    05240000
052500             15  FILLER               PIC X(05)  VALUE 'PACK '.   05250000
052600             15  TM-MF14-OV-SH-1      PIC X(02).                  05260000
052700             15  FILLER               PIC X(01)  VALUE ':'.       05270000
052800             15  TM-MF14-PK-QTY       PIC ZZZ9.                   05280000
052900             15  FILLER               PIC X(01)  VALUE '/'.       05290000
053000             15  TM-MF14-PK-PCT       PIC ZZ9.                    05300000
053100             15  FILLER               PIC X(01)  VALUE '%'.       05310000
053200                                                                  05320000
053300                                                                  05330000
053400         10  TM-BAD-PACK-LINE-2.                                  05340000
053500             15  FILLER               PIC X(09)  VALUE            05350000
053600                                                 'PACK RT$:'.     05360000
053700             15  TM-MF14-RT-AMT       PIC $ZZZZ9.99.              05370002
053800             15  FILLER               PIC X(04)  VALUE SPACES.    05380005
053900             15  FILLER               PIC X(15)  VALUE            05390000
054000                                      'TOTAL PACK RT$ '.          05400000
054100             15  TM-MF14-OV-SH-2      PIC X(02).                  05410000
054200             15  FILLER               PIC X(01)  VALUE ':'.       05420000
054300             15  TM-MF14-TOT-RT-AMT   PIC $ZZZZZ9.99.             05430005
054400         10  TM-BAD-PACK-LINE-3.                                  05440000
054500             15  FILLER               PIC X(09)  VALUE            05450000
054600                                                 'ODD UNIT:'.     05460000
054700             15  TM-MF14-ODD-QTY      PIC ZZZZ9.                  05470003
054800             15  FILLER               PIC X(10)  VALUE SPACES.    05480002
054900             15  FILLER               PIC X(17)  VALUE            05490000
055000                                      'TOTAL ODD UNIT$: '.        05500000
055100             15  TM-MF14-ODD-AMT      PIC $ZZZZ9.99.              05510003
055200         10  TM-BAD-PACK-LINE-4.                                  05520000
055300             15  TM-MF14-TEXT         PIC X(17).                  05530000
055400             15  FILLER               PIC X(03)  VALUE SPACES.    05540000
055500             15  FILLER               PIC X(20)  VALUE            05550000
055600                                      '#STORES ALLOC/AV UN:'.     05560000
055700             15  TM-MF14-STR-ALLOC    PIC ZZ9.                    05570000
055800             15  FILLER               PIC X(01)  VALUE '/'.       05580000
055900             15  TM-MF14-AVG-UN       PIC ZZ9.99.                 05590000
056000         10  FILLER                   PIC X(50)  VALUE SPACES.    05600000
056100                                                                  05610000
056200*MESSAGE FORMAT 15 (BAD INNER PACK).                              05620000
056300     05  TM-BAD-INNER-PACK-TEXT.                                  05630000
056400         10  TM-BAD-INNER-PACK-LINE-1.                            05640000
056500             15  FILLER               PIC X(17)  VALUE            05650000
056600                 ' INNR PACK QTY : '.                             05660000
056700             15  TM-MF15-PACK-QTY     PIC ZZZZ9.                  05670000
056800             15  FILLER               PIC X(28)  VALUE SPACES.    05680000
056900         10  TM-BAD-INNER-PACK-LINE-2.                            05690000
057000             15  FILLER               PIC X(17)  VALUE            05700000
057100                 'UNITS RECEIVED : '.                             05710000
057200             15  TM-MF15-RCVD-QTY     PIC ZZZZ9.                  05720000
057300             15  FILLER               PIC X(28)  VALUE SPACES.    05730000
057400         10  TM-BAD-INNER-PACK-LINE-3.                            05740000
057500             15  FILLER               PIC X(18)  VALUE            05750000
057600                 '           STR :  '.                            05760000
057700             15  TM-MF15-STR-NBR      PIC ZZZ9.                   05770000
057800             15  FILLER               PIC X(28)  VALUE SPACES.    05780000
057900         10  TM-BAD-INNER-PACK-LINE-4.                            05790000
058000             15  FILLER               PIC X(17)  VALUE            05800000
058100                 ' STR ORDER QTY : '.                             05810000
058200             15  TM-MF15-STR-QTY      PIC ZZZZ9.                  05820000
058300             15  FILLER               PIC X(28)  VALUE SPACES.    05830000
058400         10  FILLER                   PIC X(50)  VALUE SPACES.    05840000
058500                                                                  05850000
058600******************************************************************05860000
058700* COPYBOOK AREAS                                                  05870000
058800******************************************************************05880000
058900* INPUT PASSED FROM RCKCS821                                      05890000
059000     COPY RCWS823.                                                05900000
059100                                                                  05910000
059200* TEMP STORAGE AREA.                                              05920000
059300     COPY RCWS821.                                                05930000
059400                                                                  05940000
059500* OUTPUT PASSED TO TROUBLE.                                       05950000
059600     COPY TMWS500.                                                05960000
059700                                                                  05970000
059800* OUTPUT PASSED BACK TO CALLING PROGRAM.                          05980000
059900     COPY TMWS501.                                                05990000
060000                                                                  06000000
060100******************************************************************06010000
060200* DB2 SQL COMMUNICATION AREA                                      06020000
060300******************************************************************06030000
060400     EXEC SQL                                                     06040000
060500         INCLUDE SQLCA                                            06050000
060600     END-EXEC.                                                    06060000
060700                                                                  06070000
060800******************************************************************06080000
060900* DB2 DCLGENS                                                     06090000
061000******************************************************************06100000
061100*LOCATION TABLE                                                   06110000
061200     EXEC SQL                                                     06120000
061300         INCLUDE XLT00010                                         06130000
061400     END-EXEC.                                                    06140000
061500                                                                  06150000
061501*TROUBLE REASON TABLE                                             06150100
061502     EXEC SQL                                                     06150200
061503         INCLUDE TTRBRSN                                          06150300
061504     END-EXEC.                                                    06150400
061505                                                                  06150500
061600*COMPANY CONTROL TABLE                                            06160000
061700     EXEC SQL                                                     06170000
061800         INCLUDE TCOCNTL                                          06180000
061900     END-EXEC.                                                    06190000
062000                                                                  06200000
062001* PARM TABLE                                                      06200100
062002     EXEC SQL                                                     06200200
062003         INCLUDE TKRPRPM                                          06200300
062004     END-EXEC.                                                    06200400
062005                                                                  06200500
062006** AHP - BEGIN 04/23/08                                           06200600
062007/                                                                 06200700
062008*----------------------------------------------------------------*06200800
062009*    DB2 DCLGEN FOR THE WST_INTGRTN_TYP TABLE                     06200900
062010*----------------------------------------------------------------*06201000
062011     EXEC SQL                                                     06201100
062012          INCLUDE WST00008                                        06201200
062013     END-EXEC.                                                    06201300
062014/                                                                 06201400
062015*----------------------------------------------------------------*06201500
062016*    DB2 DCLGEN FOR THE WST_ATTR_DEFN TABLE                       06201600
062017*----------------------------------------------------------------*06201700
062018     EXEC SQL                                                     06201800
062019          INCLUDE WST00009                                        06201900
062020     END-EXEC.                                                    06202000
062021/                                                                 06202100
062022*----------------------------------------------------------------*06202200
062023*    DB2 DCLGEN FOR THE WST_ATTR_ELEM TABLE                       06202300
062024*----------------------------------------------------------------*06202400
062025     EXEC SQL                                                     06202500
062026          INCLUDE WST00010                                        06202600
062027     END-EXEC.                                                    06202700
062028/                                                                 06202800
062029** AHP -  END  04/23/08                                           06202900
062030                                                                  06203000
062100*PRORATION KEY TABLE                                              06210000
062200     EXEC SQL                                                     06220000
062300         INCLUDE RCT00000                                         06230000
062400     END-EXEC.                                                    06240000
062500                                                                  06250000
062600*PRORATION RULE TABLE                                             06260000
062700     EXEC SQL                                                     06270000
062800         INCLUDE RCT00001                                         06280000
062900     END-EXEC.                                                    06290000
063000                                                                  06300000
063100*PRORATION ACTION TABLE                                           06310000
063200     EXEC SQL                                                     06320000
063300         INCLUDE RCT00002                                         06330000
063400     END-EXEC.                                                    06340000
063500                                                                  06350000
063600*PRORATION FUNCTION DESCRIPTION TABLE                             06360000
063700     EXEC SQL                                                     06370000
063800         INCLUDE RCT00003                                         06380000
063900     END-EXEC.                                                    06390000
064000                                                                  06400000
064100******************************************************************06410000
064200* RULE CURSOR                                                     06420000
064300******************************************************************06430000
064400     EXEC SQL                                                     06440000
064500         DECLARE RULE-DETL-CSR CURSOR FOR                         06450000
064600           SELECT PRRTN_RUL_ID                                    06460000
064700                , PRRTN_RUL_SEQ_NBR                               06470000
064800                , PRRTN_RUL_IND                                   06480000
064900                , PRRTN_ACTN_SEQ_NBR                              06490000
065000                , TRBL_RSN_CDE                                    06500000
065100                , MSG_FMT_NBR                                     06510000
065200                , ACTV_IND                                        06520000
065300                , ACTN_RSN_CDE                                    06530000
065400                , ACTN_TXT                                        06540000
065500           FROM RCT_PRRTN_ACTN                                    06550000
065600          WHERE PRRTN_RUL_ID      = :DK-RULE-KEY                  06560000
065700            AND PRRTN_RUL_SEQ_NBR = :DK-RULE-SEQ                  06570000
065800            AND PRRTN_RUL_IND     = :DK-RULE-RESULT               06580000
065900     END-EXEC.                                                    06590000
066000                                                                  06600000
066100******************************************************************06610000
066200******************************************************************06620000
066300 LINKAGE SECTION.                                                 06630000
066400                                                                  06640000
066500 01  DFHCOMMAREA.                                                 06650000
066600     05  FILLER                       OCCURS 1 TO 779 TIMES       06660000
066700                                      DEPENDING ON EIBCALEN.      06670000
066800         10  FILLER                   PIC X.                      06680000
066900                                                                  06690000
067000/*****************************************************************06700000
067100 PROCEDURE DIVISION.                                              06710000
067200******************************************************************06720000
067300 0000-MAIN-MODULE.                                                06730000
067400     MOVE '0000-MAIN-MODULE              ' TO RC001-PARAGRAPH.    06740000
067500                                                                  06750000
067600*LOAD PASSED DATA.                                                06760000
067700     MOVE DFHCOMMAREA        TO RC823-COMMAREA.                   06770000
067800     MOVE RC823-TM500-FIELDS TO TM500-FIELDS.                     06780000
067900     MOVE '823'              TO TM500-PREPACK-PGM-NBR.            06790000
068000                                                                  06800000
068100     EXEC SQL                                                     06810000
068200         SET :PV-CURRENT-DATE = CURRENT DATE                      06820000
068300     END-EXEC.                                                    06830000
068400                                                                  06840000
068500*READ TEMP STORAGE QUEUES.                                        06850000
068600     PERFORM 1000-READ-TEMP-STORAGE.                              06860000
068700                                                                  06870000
068800*SET DRIVER LINE OCCURRENCE.                                      06880000
068900     MOVE 1 TO DL.                                                06890000
069000     PERFORM                                                      06900000
069100       VARYING RC821-ITEM-IDX FROM 1 BY 1                         06910000
069200         UNTIL RC821-REC-LNE-NBR (RC821-ITEM-IDX) = 0             06920000
069300            OR RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              06930000
069400                                                                  06940000
069500         IF (RC821-REC-LNE-NBR (RC821-ITEM-IDX) > ZEROES)         06950000
069600           AND (RC821-REC-LNE-NBR (RC821-ITEM-IDX) =              06960000
069700                RC821-REC-DRV-LNE-NBR)                            06970000
069800             SET DL TO RC821-ITEM-IDX                             06980000
069900         END-IF                                                   06990000
070000     END-PERFORM.                                                 07000000
070100                                                                  07010000
070200*SET DISTRIBUTION QTY PER UNIT.                                   07020000
070300     IF RC821-PKGNG-CDE = 'I' OR 'M'                              07030000
070400         MOVE RC821-REC-PACK-RATO-QTY (DL)  TO PV-DISPERSAL-QTY   07040000
070500     ELSE                                                         07050000
070600         MOVE RC821-REC-INNER-PACK-QTY (DL) TO PV-DISPERSAL-QTY   07060000
070700     END-IF.                                                      07070000
070800                                                                  07080000
070900*INITIALIZE PROCESSING INDICATORS.                                07090000
071000     SET PS-DONE-NO              TO TRUE.                         07100000
071100     SET PS-ANALYST-BAD-PACK-NO  TO TRUE.                         07110000
071200     SET PS-ANALYST-BP-WITHIN-NO TO TRUE.                         07120000
071300     SET RC823-DO-ALLOCATION-YES TO TRUE.                         07130000
071400     SET TM500-CALL-SUCCESSFUL   TO TRUE.                         07140000
071500*10/13/03 ALLOWS A RULE TO FINISH BUT THAT IS IT                  07150000
071600     SET PS-RULE-DONE-NO         TO TRUE.                         07160000
071700                                                                  07170000
071800     MOVE 'N' TO PV-UNTIED-PACK-LINES.                            07180000
071900     MOVE 'N' TO PV-LINE-ODD-UNITS.                               07190000
072000     MOVE 'N' TO PV-LINES-MISSING.                                07200000
072100     MOVE 'N' TO PV-DIFFERENT-RATIOS.                             07210000
072200     MOVE 'N' TO PV-BEST-CASE-ZERO.                               07220000
072300     MOVE 'N' TO PV-LINE-ODU-OUT-OF-TOL.                          07230000
072400     MOVE 'N' TO PV-PACK-ODU-OUT-OF-TOL.                          07240000
072500     MOVE 'N' TO PV-LINE-ODUD-OUT-OF-TOL.                         07250000
072600     MOVE 'N' TO PV-PACK-ODUD-OUT-OF-TOL.                         07260000
072700     IF RC821-PKGNG-CDE = 'I' OR 'M'                              07270000
072800         PERFORM 0100-SET-ANALYST-FLAGS                           07280000
072900     END-IF.                                                      07290000
073000                                                                  07300000
073100*******************                                               07310000
073200* MAIN PROCESSING *                                               07320000
073300*******************                                               07330000
073400*PROCESS RULE-KEY LOOP.                                           07340000
073500     IF PS-DONE-NO                                                07350000
073600         PERFORM                                                  07360000
073700           VARYING RC823-RULE-IDX FROM 1 BY 1                     07370000
073800             UNTIL PS-DONE-YES                                    07380000
073900                OR RC823-RULE-KEY (RC823-RULE-IDX) NOT > ZEROES   07390000
074000                                                                  07400000
074100             MOVE RC823-RULE-KEY (RC823-RULE-IDX)                 07410000
074200                     TO DK-RULE-KEY                               07420000
074300             MOVE +1 TO DK-RULE-SEQ                               07430000
074400                        PV-RULE-SEQ                               07440000
074500             PERFORM 2000-SELECT-RULE                             07450000
074600                                                                  07460000
074700*PROCESS RULES ASSOCIATED W/KEY (PRRTN_RUL_ID).                   07470000
074800             IF PS-DONE-NO                                        07480000
074900*SKU LEVEL                                                        07490000
075000                 IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'K'      07500000
075100*10/13/03 DO NOT PROCESS SKU LEVEL TRB IF DONE                    07510000
075200                   AND NOT PS-DONE-YES                            07520000
075300                     PERFORM 2100-PROCESS-SKU-LVL-TRB             07530000
075400                 END-IF                                           07540000
075500*PACK LEVEL                                                       07550000
075600                 IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'P'      07560000
075700*10/13/03 DO NOT PROCESS SKU LEVEL TRB IF DONE                    07570000
075800                   AND NOT PS-DONE-YES                            07580000
075900                     PERFORM 2200-PROCESS-PACK-LVL-TRB            07590000
076000                 END-IF                                           07600000
076100*STORE LEVEL                                                      07610000
076200                 IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'S'      07620000
076300*10/13/03 DO NOT PROCESS SKU LEVEL TRB IF DONE                    07630000
076400                   AND NOT PS-DONE-YES                            07640000
076500                     PERFORM 2300-PROCESS-STORE-LVL-TRB           07650000
076600                 END-IF                                           07660000
076700             END-IF                                               07670000
076800                                                                  07680000
076900         END-PERFORM                                              07690000
077000     END-IF.                                                      07700000
077100                                                                  07710000
077300     IF RC823-DO-ALLOC-IND = 'N'                                  07730000
077400       AND TM500-IN-TROUBLE                                       07740000
077500         SET TM500-DIDNT-ALLOC-DUE-TO-TRBL TO TRUE                07750000
077600     END-IF.                                                      07760000
077601                                                                  07760100
077602*FOR MONROE ORDERS RECEIVED AT FINDLAY                            07760200
077603     SET PS-DONE-NO                                               07760300
077604         PS-PO-RCVR-TRBL-NO TO TRUE.                              07760400
077605     PERFORM 1500-TRBL-379-406-CHK.                               07760500
077606                                                                  07760600
077610*RETURN TO CALLING PROGRAM.                                       07761000
077700     PERFORM 0000-GOBACK.                                         07770000
077710                                                                  07771000
077800 0000-GOBACK.                                                     07780000
077900     MOVE TM500-FIELDS   TO RC823-TM500-FIELDS.                   07790000
078000     MOVE RC823-COMMAREA TO DFHCOMMAREA.                          07800000
078100     GOBACK.                                                      07810000
078200                                                                  07820000
078300******************************************************************07830000
078400 0100-SET-ANALYST-FLAGS.                                          07840000
078500     MOVE '0100-SET-ANALYST-FLAGS        ' TO RC001-PARAGRAPH.    07850000
078600                                                                  07860000
078700*UNTIED LINES.                                                    07870000
078800     IF RC821-PREPK-ID = 99                                       07880000
078900         MOVE 'Y' TO PV-UNTIED-PACK-LINES                         07890000
079000     END-IF.                                                      07900000
079100                                                                  07910000
079200*ODD UNITS.                                                       07920000
079300     IF RC821-TOTAL-ODD-UNITS > ZEROES                            07930000
079400         MOVE 'Y' TO PV-LINE-ODD-UNITS                            07940000
079500     END-IF.                                                      07950000
079600                                                                  07960000
079700*LINE MISSING.                                                    07970000
079800     PERFORM                                                      07980000
079900       VARYING RC821-ITEM-IDX FROM 1 BY 1                         07990000
080000         UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              08000000
080100                                                                  08010000
080200         IF (RC821-APP-PO-LNE-NBR (RC821-ITEM-IDX) NOT =          08020000
080300            RC821-REC-LNE-NBR (RC821-ITEM-IDX))                   08030000
080400           OR (RC821-REC-ITEM-NBR (RC821-ITEM-IDX) NOT =          08040000
080500            RC821-PO-ITEM-NBR (RC821-ITEM-IDX))                   08050000
080600             MOVE 'Y' TO PV-LINES-MISSING                         08060000
080700         END-IF                                                   08070000
080800     END-PERFORM.                                                 08080000
080900                                                                  08090000
081000*DIFFERENT RATIOS.                                                08100000
081100     PERFORM                                                      08110000
081200       VARYING RC821-ITEM-IDX FROM 1 BY 1                         08120000
081300         UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              08130000
081400                                                                  08140000
081500         IF RC821-PO-PACK-RATO-QTY (RC821-ITEM-IDX) NOT =         08150000
081600            RC821-REC-PACK-RATO-QTY (RC821-ITEM-IDX)              08160000
081700             MOVE 'Y' TO PV-DIFFERENT-RATIOS                      08170000
081800         END-IF                                                   08180000
081900     END-PERFORM.                                                 08190000
082000                                                                  08200000
082100*BEST CASE ZERO.                                                  08210000
082200     PERFORM                                                      08220000
082300       VARYING RC821-ITEM-IDX FROM 1 BY 1                         08230000
082400         UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              08240000
082500                                                                  08250000
082600         IF (RC821-REC-LNE-NBR (RC821-ITEM-IDX) > ZEROES)         08260000
082700           AND (RC821-BEST-CASE-UNITS (RC821-ITEM-IDX) = ZEROES)  08270000
082800             MOVE 'Y' TO PV-BEST-CASE-ZERO                        08280000
082900         END-IF                                                   08290000
083000     END-PERFORM.                                                 08300000
083100                                                                  08310000
083200*SET ANALYST BAD PACK.                                            08320000
083300     IF PV-UNTIED-PACK-LINES  = 'Y'                               08330000
083400       OR PV-BEST-CASE-ZERO   = 'Y'                               08340000
083500       OR PV-DIFFERENT-RATIOS = 'Y'                               08350000
083600       OR PV-LINES-MISSING    = 'Y'                               08360000
083700         SET PS-ANALYST-BAD-PACK-YES TO TRUE                      08370000
083800     END-IF.                                                      08380000
083900                                                                  08390000
084000*TEST ODD UNIT QTY VS. TOLERANCE QTY                              08400000
084100     IF PV-LINE-ODD-UNITS = 'Y'                                   08410000
084200         MOVE ZEROES TO PV-TOT-ODD-UNIT-QTY                       08420000
084300         PERFORM                                                  08430000
084400           VARYING RC821-ITEM-IDX FROM 1 BY 1                     08440000
084500             UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT          08450000
084600                                                                  08460000
084700             IF RC821-ODD-UNIT-QTY (RC821-ITEM-IDX) NOT <         08470000
084800                RC821-LNE-ODU-TOL-QTY                             08480000
084900                 SET PS-ANALYST-BAD-PACK-YES TO TRUE              08490000
085000                 MOVE 'Y' TO PV-LINE-ODU-OUT-OF-TOL               08500000
085100             END-IF                                               08510000
085200                                                                  08520000
085300             COMPUTE PV-TOT-ODD-UNIT-QTY                          08530000
085400                   = PV-TOT-ODD-UNIT-QTY                          08540000
085500                   + RC821-ODD-UNIT-QTY (RC821-ITEM-IDX)          08550000
085600         END-PERFORM                                              08560000
085700                                                                  08570000
085800         IF PV-TOT-ODD-UNIT-QTY NOT < RC821-PREPK-ODU-TOL-QTY     08580000
085900             SET PS-ANALYST-BAD-PACK-YES TO TRUE                  08590000
086000             MOVE 'Y' TO PV-PACK-ODU-OUT-OF-TOL                   08600000
086100         END-IF                                                   08610000
086200                                                                  08620000
086300     END-IF.                                                      08630000
086400                                                                  08640000
086500*TEST ODD UNIT DOLLARS.                                           08650000
086600     IF RC821-TOTAL-ODD-UNITS > ZEROES                            08660000
086700         MOVE ZEROES TO PV-TOT-ODD-UNIT-AMT                       08670000
086800         PERFORM                                                  08680000
086900           VARYING RC821-ITEM-IDX FROM 1 BY 1                     08690000
087000             UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT          08700000
087100                                                                  08710000
087200             IF RC821-PO-GP-QTY (RC821-ITEM-IDX) > 1              08720000
087300                 COMPUTE PV-UNIT-PRICE =                          08730000
087400                         RC821-PO-GP-RTL-AMT  (RC821-ITEM-IDX)    08740000
087500                       / RC821-PO-GP-QTY      (RC821-ITEM-IDX)    08750000
087600             ELSE                                                 08760000
087700                 MOVE RC821-PO-UNT-RTL-PR-AMT (RC821-ITEM-IDX)    08770000
087800                   TO PV-UNIT-PRICE                               08780000
087900             END-IF                                               08790000
088000                                                                  08800000
088100             COMPUTE PV-ODD-UNIT-DOLLARS = PV-UNIT-PRICE          08810000
088200                   * RC821-ODD-UNIT-QTY (RC821-ITEM-IDX)          08820000
088300                                                                  08830000
088400             COMPUTE PV-TOT-ODD-UNIT-AMT = PV-TOT-ODD-UNIT-AMT    08840000
088500                                         + PV-ODD-UNIT-DOLLARS    08850000
088600                                                                  08860000
088700             IF PV-ODD-UNIT-DOLLARS NOT < RC821-LNE-ODU-TOL-AMT   08870000
088800                 SET PS-ANALYST-BAD-PACK-YES TO TRUE              08880000
088900                 MOVE 'Y' TO PV-LINE-ODUD-OUT-OF-TOL              08890000
089000             END-IF                                               08900000
089100                                                                  08910000
089200             COMPUTE PV-TOT-ODD-UNIT-AMT = PV-TOT-ODD-UNIT-AMT    08920000
089300                                         + PV-ODD-UNIT-DOLLARS    08930000
089400         END-PERFORM                                              08940000
089500                                                                  08950000
089600         IF PV-TOT-ODD-UNIT-AMT NOT < RC821-PREPK-ODU-TOL-AMT     08960000
089700             SET PS-ANALYST-BAD-PACK-YES TO TRUE                  08970000
089800             MOVE 'Y' TO PV-PACK-ODUD-OUT-OF-TOL                  08980000
089900         END-IF                                                   08990000
090000     END-IF.                                                      09000000
090100                                                                  09010000
090200*SET ANALYST BAD PACK WITHIN.                                     09020000
090300     SET PS-ANALYST-BP-WITHIN-NO TO TRUE.                         09030000
090400     IF RC821-TOTAL-ODD-UNITS > ZEROES                            09040000
090500       AND NOT PS-ANALYST-BAD-PACK-YES                            09050000
090600       AND PV-LINE-ODU-OUT-OF-TOL  = 'N'                          09060000
090700       AND PV-LINE-ODUD-OUT-OF-TOL = 'N'                          09070000
090800       AND PV-PACK-ODU-OUT-OF-TOL  = 'N'                          09080000
090900       AND PV-PACK-ODUD-OUT-OF-TOL = 'N'                          09090000
091000         SET PS-ANALYST-BP-WITHIN-YES TO TRUE                     09100000
091100     END-IF.                                                      09110000
091200                                                                  09120000
091300******************************************************************09130000
091400*                                                                *09140000
091500*        R E A D   T E M P   S T O R A G E   Q U E U E S         *09150000
091600*                                                                *09160000
091700******************************************************************09170000
091800 1000-READ-TEMP-STORAGE.                                          09180000
091900     MOVE '1000-READ-TEMP-STORAGE        ' TO RC001-PARAGRAPH.    09190000
092000                                                                  09200000
092100     INITIALIZE RC821-DATA-FIELDS.                                09210000
092200                                                                  09220000
092300****************************************                          09230000
092400* READ IN THE RECEIVER QUEUE COMPONENT *                          09240000
092500****************************************                          09250000
092600     MOVE RC823-RECEIVER-QUEUE-NAME TO PV-QUEUE-NAME.             09260000
092700     MOVE +1                        TO PV-ITEM.                   09270000
092800     PERFORM 1100-READ-TEMP-RECEIVER-QUEUE.                       09280000
092900                                                                  09290000
093000*************************************                             09300000
093100* READ IN THE STORE QUEUE COMPONENT *                             09310000
093200*************************************                             09320000
093300     IF PS-DONE-NO                                                09330000
093400         MOVE RC823-STORE-QUEUE-NAME TO PV-QUEUE-NAME             09340000
093500         MOVE +1                     TO PV-ITEM                   09350000
093600         PERFORM 1200-READ-TEMP-STORE-QUEUE                       09360000
093700     END-IF.                                                      09370000
093800                                                                  09380000
093900************************************                              09390000
094000* READ IN THE ITEM QUEUE COMPONENT *                              09400000
094100************************************                              09410000
094200     IF PS-DONE-NO                                                09420000
094300         MOVE RC823-ITEM-QUEUE-NAME TO PV-QUEUE-NAME              09430000
094400         PERFORM 1300-READ-TEMP-ITEM-QUEUE                        09440000
094500           VARYING PV-ITEM FROM 1 BY 1                            09450000
094600             UNTIL PV-ITEM > RC823-ITEM-QUEUE-COUNT               09460000
094700                OR PS-DONE-YES                                    09470000
094800     END-IF.                                                      09480000
094900                                                                  09490000
095000******************************************************************09500000
095100 1100-READ-TEMP-RECEIVER-QUEUE.                                   09510000
095200     MOVE '1100-READ-TEMP-RECEIVER-QUEUE ' TO RC001-PARAGRAPH.    09520000
095300                                                                  09530000
095400*READ TEMP STORAGE QUEUE.                                         09540000
095500     EXEC CICS READQ TS                                           09550000
095600         QUEUE (PV-QUEUE-NAME)                                    09560000
095700         INTO  (RC821-PO-RECEIVER-CONTENTS)                       09570000
095800         ITEM  (PV-ITEM)                                          09580000
095900         RESP  (PV-CICS-RESP)                                     09590000
096000     END-EXEC.                                                    09600000
096100                                                                  09610000
096200     IF (PV-CICS-RESP = DFHRESP(NORMAL))                          09620000
096300       OR (PV-CICS-RESP = DFHRESP(ITEMERR))                       09630000
096400         CONTINUE                                                 09640000
096500     ELSE                                                         09650000
096600         SET PS-DONE-YES   TO TRUE                                09660000
096700         MOVE SPACES       TO TM501-TM500-RETURN-MSG              09670000
096800         MOVE '1100'       TO TM501-PARA                          09680000
096900         MOVE '823'        TO TM501-PGM                           09690000
097000         MOVE SQLCODE      TO TM500-SQLCODE                       09700000
097100         MOVE SQLCA        TO TM500-SQLCA                         09710000
097200         MOVE 94           TO TM501-PRORATION-ERROR-NBR           09720000
097300         PERFORM TM501-SET-TM500-RETURN-MSG                       09730000
097400         PERFORM RC001-RETURN-MSG                                 09740000
097500     END-IF.                                                      09750000
097600                                                                  09760000
097700******************************************************************09770000
097800 1200-READ-TEMP-STORE-QUEUE.                                      09780000
097900     MOVE '1200-READ-TEMP-STORE-QUEUE    ' TO RC001-PARAGRAPH.    09790000
098000                                                                  09800000
098100*READ TEMP STORAGE QUEUE.                                         09810000
098200     EXEC CICS READQ TS                                           09820000
098300         QUEUE (PV-QUEUE-NAME)                                    09830000
098400         INTO  (RC821-STORE-COMPONENTS)                           09840000
098500         ITEM  (PV-ITEM)                                          09850000
098600         RESP  (PV-CICS-RESP)                                     09860000
098700     END-EXEC.                                                    09870000
098800                                                                  09880000
098900     IF (PV-CICS-RESP = DFHRESP(NORMAL))                          09890000
099000       OR (PV-CICS-RESP = DFHRESP(ITEMERR))                       09900000
099100         CONTINUE                                                 09910000
099200     ELSE                                                         09920000
099300         SET PS-DONE-YES   TO TRUE                                09930000
099400         MOVE SPACES       TO TM501-TM500-RETURN-MSG              09940000
099500         MOVE '1200'       TO TM501-PARA                          09950000
099600         MOVE '823'        TO TM501-PGM                           09960000
099700         MOVE SQLCODE      TO TM500-SQLCODE                       09970000
099800         MOVE SQLCA        TO TM500-SQLCA                         09980000
099900         MOVE 60           TO TM501-PRORATION-ERROR-NBR           09990000
100000         PERFORM TM501-SET-TM500-RETURN-MSG                       10000000
100100         PERFORM RC001-RETURN-MSG                                 10010000
100200     END-IF.                                                      10020000
100300                                                                  10030000
100400******************************************************************10040000
100500 1300-READ-TEMP-ITEM-QUEUE.                                       10050000
100600     MOVE '1300-READ-TEMP-ITEM-QUEUE     ' TO RC001-PARAGRAPH.    10060000
100700                                                                  10070000
100800*READ TEMP STORAGE QUEUE.                                         10080000
100900     EXEC CICS READQ TS                                           10090000
101000         QUEUE (PV-QUEUE-NAME)                                    10100000
101100         INTO  (RC821-ITEM-COMPONENTS (PV-ITEM))                  10110000
101200         ITEM  (PV-ITEM)                                          10120000
101300         RESP  (PV-CICS-RESP)                                     10130000
101400     END-EXEC.                                                    10140000
101500                                                                  10150000
101600     IF (PV-CICS-RESP = DFHRESP(NORMAL))                          10160000
101700       OR (PV-CICS-RESP = DFHRESP(ITEMERR))                       10170000
101800         CONTINUE                                                 10180000
101900     ELSE                                                         10190000
102000         SET PS-DONE-YES   TO TRUE                                10200000
102100         MOVE SPACES       TO TM501-TM500-RETURN-MSG              10210000
102200         MOVE '1300'       TO TM501-PARA                          10220000
102300         MOVE '823'        TO TM501-PGM                           10230000
102400         MOVE SQLCODE      TO TM500-SQLCODE                       10240000
102500         MOVE SQLCA        TO TM500-SQLCA                         10250000
102600         MOVE 61           TO TM501-PRORATION-ERROR-NBR           10260000
102700         PERFORM TM501-SET-TM500-RETURN-MSG                       10270000
102800         PERFORM RC001-RETURN-MSG                                 10280000
102900     END-IF.                                                      10290000
103000                                                                  10300000
103001************************************************************      10300100
103002* CHECK LOCATION USING OPER-UNIT-ID FROM TEMP STORAGE             10300200
103003* QUE (ALLOCATION/PRORATION/TROUBLE - RC821).                     10300300
103004* CHECK E-BUS-IND ='Y' AND LOC-TYPE='DC'.                         10300400
103005* SET FLAGS BASED ON EQUALITY CHECK OF                            10300500
103006* RC821-CURRENT OPER IND, OR RC821-CRE-OPER-UNT-IND               10300600
103007* OR RC821-OPER-UNT-ID AGAINST RC-821-OPER-UNT-ID                 10300700
103008************************************************************      10300800
103010 1500-TRBL-379-406-CHK.                                           10301000
103011     MOVE '1500-TRBL-379-406-CHK         ' TO RC001-PARAGRAPH.    10301100
103012     MOVE RC821-OPER-UNT-ID TO PV-OPER-UNT-ID.                    10301200
103013     PERFORM 1530-CHECK-FOR-LOCATION.                             10301300
132360     IF XLT00010-E-BUS-IND = 'Y' AND                              13236000
132370        XLT00010-LOC-TYP-CDE = 'DC'                               13237000
132380        SET PS-ECOM-YES TO TRUE                                   13238000
132390     ELSE                                                         13239000
132400     IF RC821-CRE-OPER-UNT-ID NOT = RC821-OPER-UNT-ID             13240000
132500        MOVE RC821-CRE-OPER-UNT-ID TO PV-OPER-UNT-ID              13250000
132600        PERFORM 1530-CHECK-FOR-LOCATION                           13260000
132700        IF XLT00010-E-BUS-IND = 'Y'                               13270000
132800           AND XLT00010-LOC-TYP-CDE = 'DC'                        13280000
132900           SET PS-ECOM-CRE-YES TO TRUE                            13290000
133000     ELSE                                                         13300000
133100     IF RC821-CURR-OPER-UNT-ID NOT = RC821-OPER-UNT-ID            13310000
133200        AND RC821-CURR-OPER-UNT-ID NOT = RC821-CRE-OPER-UNT-ID    13320000
133300        MOVE RC821-CURR-OPER-UNT-ID TO                            13330000
133400           PV-OPER-UNT-ID                                         13340000
133500        PERFORM 1530-CHECK-FOR-LOCATION                           13350000
133600        IF XLT00010-E-BUS-IND = 'Y'                               13360000
133700           AND XLT00010-LOC-TYP-CDE = 'DC'                        13370000
133800           SET PS-ECOM-CURR-YES TO TRUE.                          13380000
133801                                                                  13380100
133802     IF (RC821-PO-TYP-CDE NOT = 'IE')                             13380200
133803       AND PS-ECOM-YES                                            13380300
133804       AND PS-ECOM-CRE-NO                                         13380400
133805       AND PS-ECOM-CURR-NO                                        13380500
133806       AND (RC821-PKGNG-CDE = 'B' OR 'C')                         13380600
133807*LOOP ALL ITEMS FOR THE RULE.                                     13380700
133808         PERFORM                                                  13380800
133809         VARYING RC821-ITEM-IDX FROM 1 BY 1                       13380900
133810         UNTIL (PS-DONE-YES                                       13381000
133811            OR RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              13381100
133812            OR RC821-REC-LNE-NBR (RC821-ITEM-IDX) NOT > ZEROES)   13381200
133813              IF RC821-SKU-INNER-PACK-QTY (RC821-ITEM-IDX) > 1    13381300
133814                  PERFORM 1510-CREATE-379-406-TRBL                13381400
133815              END-IF                                              13381500
133816         END-PERFORM                                              13381600
133817     END-IF.                                                      13381700
133818                                                                  13381800
133819 1510-CREATE-379-406-TRBL.                                        13381900
133820** AHP - BEGIN - 04/23/08                                         13382000
133830     INITIALIZE PV-DB2-COUNT                                      13383000
133840     PERFORM 1550-CHECK-FOR-REPURP                                13384000
133850     IF PV-DB2-COUNT > 0                                          13385000
133860*STILL REPURPING.                                                 13386000
133870         PERFORM 1520-CHECK-TKRPRPM                               13387000
133880         IF PS-ASNS-TO-WMS-YES                                    13388000
133890            IF PS-ECOM-CURR-YES                                   13389000
133900               CONTINUE                                           13390000
134000            ELSE                                                  13400000
134100               MOVE TM500-PO-LNE-NBR   TO SAVE-TM500-PO-LNE-NBR   13410000
134200               MOVE TM500-PREPK-ID     TO SAVE-TM500-PREPK-ID     13420000
134300               MOVE 5                  TO RCT00002-MSG-FMT-NBR    13430000
134400               MOVE PC-406             TO RCT00002-TRBL-RSN-CDE   13440000
134500               SET TM500-LINE-LEVEL    TO TRUE                    13450000
134600               MOVE RC821-REC-LNE-NBR (RC821-ITEM-IDX)            13460000
134700                                       TO TM500-PO-LNE-NBR        13470000
134800               MOVE ZERO               TO TM500-PREPK-ID          13480000
134900               PERFORM 8000-CREATE-TROUBLE                        13490000
135000            END-IF                                                13500000
135100         ELSE                                                     13510000
135200            MOVE TM500-PO-LNE-NBR     TO SAVE-TM500-PO-LNE-NBR    13520000
135300            MOVE TM500-PREPK-ID       TO SAVE-TM500-PREPK-ID      13530000
135400            MOVE 5                    TO RCT00002-MSG-FMT-NBR     13540000
135500            MOVE PC-406               TO RCT00002-TRBL-RSN-CDE    13550000
135600            SET TM500-LINE-LEVEL      TO TRUE                     13560000
135700            MOVE RC821-REC-LNE-NBR (RC821-ITEM-IDX)               13570000
135800                                      TO TM500-PO-LNE-NBR         13580000
135900            MOVE ZERO                 TO TM500-PREPK-ID           13590000
136000            PERFORM 8000-CREATE-TROUBLE                           13600000
136100         END-IF                                                   13610000
136200                                                                  13620000
136300         IF PS-PO-RCVR-TRBL-NO                                    13630000
136400             MOVE TM500-PO-LNE-NBR TO SAVE-TM500-PO-LNE-NBR       13640000
136500             MOVE TM500-PREPK-ID   TO SAVE-TM500-PREPK-ID         13650000
136600             MOVE ZERO             TO TM500-PO-LNE-NBR            13660000
136700                                      TM500-PREPK-ID              13670000
136800             SET TM500-PO-LEVEL    TO TRUE                        13680000
136900             MOVE PC-379           TO RCT00002-TRBL-RSN-CDE       13690000
137000             PERFORM 8000-CREATE-TROUBLE                          13700000
137100             SET PS-PO-RCVR-TRBL-YES                              13710000
137200                                   TO TRUE                        13720000
137300         END-IF                                                   13730000
137400     END-IF.                                                      13740000
137500                                                                  13750000
137501** AHP -  END - 04/23/08                                          13750100
137502*----------------------------------------------------------------*13750200
137503*  CHECK PARM TABLE TO SEE IF DC IS TURNED ON TO DOWNLOAD ASN'S   13750300
137504*  TO WMS.                                                        13750400
137505*----------------------------------------------------------------*13750500
137506 1520-CHECK-TKRPRPM.                                              13750600
137507                                                                  13750700
137508     MOVE RC821-CURR-OPER-UNT-ID TO PV-COPER-UNT-ID.              13750800
137509                                                                  13750900
137510     EXEC SQL                                                     13751000
137511          SELECT   FUNC_TXT                                       13751100
137512            INTO  :KRPRPM-FUNC-TXT                                13751200
137513            FROM                                                  13751300
137514                  TKRPRPM A                                       13751400
137515            WHERE                                                 13751500
137516                  LOC_ID            = :PV-COPER-UNT-ID            13751600
137517              AND SYS_PRC_FUNC_CDE  = 'ASNDWN'                    13751700
137518              AND FUNC_PRC_STAT_CDE = 'AC'                        13751800
137519              AND INTFC_SYS_CDE     = 'KHL'                       13751900
137520              AND FUNC_TXT          = 'Y'                         13752000
137521              AND FUNC_BEG_TMST    <= CURRENT TIMESTAMP           13752100
137522     END-EXEC.                                                    13752200
137523                                                                  13752300
137524     EVALUATE TRUE                                                13752400
137525         WHEN SQLCODE = ZERO                                      13752500
137526             SET PS-ASNS-TO-WMS-YES    TO TRUE                    13752600
137527         WHEN SQLCODE = +100                                      13752700
137528             SET PS-ASNS-TO-WMS-NO     TO TRUE                    13752800
137529         WHEN SQLWARN0 NOT = SPACES                               13752900
137530         WHEN SQLCODE  NOT = ZERO                                 13753000
137540            SET PS-DONE-YES   TO TRUE                             13754000
137550            MOVE SPACES       TO TM501-TM500-RETURN-MSG           13755000
137560            MOVE '1520'       TO TM501-PARA                       13756000
137570            MOVE '823'        TO TM501-PGM                        13757000
137580            MOVE SQLCODE      TO TM500-SQLCODE                    13758000
137590            MOVE SQLCA        TO TM500-SQLCA                      13759000
137600            MOVE 101          TO TM501-PRORATION-ERROR-NBR        13760000
137700            PERFORM TM501-SET-TM500-RETURN-MSG                    13770000
137701            PERFORM RC001-RETURN-MSG                              13770100
137702     END-EVALUATE.                                                13770200
137703                                                                  13770300
137704** AHP - BEGIN 04/23/08                                           13770400
137705*----------------------------------------------------------------*13770500
137706*  CHECK FOR XLT_LOC, LOCATION TABLE FOR LOCATION TYPE CODE 'DC'  13770600
137707*  AND E-BUS-IND = 'Y'.                                           13770700
137708*----------------------------------------------------------------*13770800
137709 1530-CHECK-FOR-LOCATION.                                         13770900
137710                                                                  13771000
137711     EXEC SQL                                                     13771100
137712         SELECT LOC_TYP_CDE                                       13771200
137713              , E_BUS_IND                                         13771300
137714           INTO :XLT00010-LOC-TYP-CDE                             13771400
137715              , :XLT00010-E-BUS-IND                               13771500
137716           FROM XLT_LOC                                           13771600
137717           WHERE LOC_NBR             = :PV-OPER-UNT-ID            13771700
137718            AND LOC_TYP_CDE = 'DC'                                13771800
137719            AND E_BUS_IND = 'Y'                                   13771900
137720           ORDER BY LOC_NBR                                       13772000
137730     END-EXEC.                                                    13773000
137731                                                                  13773100
137732     EVALUATE TRUE                                                13773200
137733       WHEN SQLCODE = ZERO                                        13773300
137734       WHEN SQLCODE = +100                                        13773400
137735           CONTINUE                                               13773500
137736       WHEN OTHER                                                 13773600
137737           SET PS-DONE-YES   TO TRUE                              13773700
137738           MOVE SPACES       TO TM501-TM500-RETURN-MSG            13773800
137739           MOVE '1530'       TO TM501-PARA                        13773900
137740           MOVE '823'        TO TM501-PGM                         13774000
137741           MOVE SQLCODE      TO TM500-SQLCODE                     13774100
137742           MOVE SQLCA        TO TM500-SQLCA                       13774200
137743           PERFORM TM501-SET-TM500-RETURN-MSG                     13774300
137744           PERFORM RC001-RETURN-MSG                               13774400
137745     END-EVALUATE.                                                13774500
137746                                                                  13774600
137747*----------------------------------------------------------------*13774700
137748*  CHECK FOR REPURPOSE                                            13774800
137749*----------------------------------------------------------------*13774900
137750 1550-CHECK-FOR-REPURP.                                           13775000
137760                                                                  13776000
137770     EXEC SQL                                                     13777000
137780        SELECT   COUNT(*)                                         13778000
137790        INTO :PV-DB2-COUNT                                        13779000
137800        FROM                                                      13780000
137900              WST_INTGRTN_TYP  A                                  13790000
138000           ,  WST_ATTR_DEFN    B                                  13800000
138100           ,  WST_ATTR_ELEM    C                                  13810000
138200           ,  WST_ATTR_ELEM    D                                  13820000
138300           ,  WST_ATTR_ELEM    E                                  13830000
138400           ,  WST_ATTR_ELEM    F                                  13840000
138500           ,  WST_ATTR_ELEM    G                                  13850000
138600       WHERE                                                      13860000
138700          A.INTGRTN_TYP_CDE   = 'EFCREPURP'                       13870000
138800         AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE              13880000
138900         AND B.ATTR_DEFN_SEQ_NBR = 1                              13890000
139000         AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE              13900000
139100         AND C.ATTR_DEFN_SEQ_NBR = 1                              13910000
139200         AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE              13920000
139300         AND D.ATTR_DEFN_SEQ_NBR = 2                              13930000
139400         AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE              13940000
139500         AND E.ATTR_DEFN_SEQ_NBR = 3                              13950000
139600         AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE              13960000
139700         AND F.ATTR_DEFN_SEQ_NBR = 4                              13970000
139800         AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE              13980000
139900         AND G.ATTR_DEFN_SEQ_NBR = 5                              13990000
140000         AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR            14000000
140100         AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR            14010000
140200         AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR            14020000
140300         AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR            14030000
140400         AND C.ATTR_ELEM_NBR     = :RC821-CURR-OPER-UNT-ID        14040000
140500         AND D.ATTR_ELEM_NBR     = :TM500-OPER-UNT-ID             14050000
140600         AND E.ATTR_ELEM_TXT     = 'Y'                            14060000
140700         AND F.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP              14070000
140800         AND G.ATTR_ELEM_TMST = '9999-09-09-23.59.59.999999'      14080000
140900     END-EXEC                                                     14090000
141000                                                                  14100000
141100***  C.ATTR_ELEM_NBR = 1 = DC NUMBER                              14110000
141200***  D.ATTR_ELEM_NBR = 2 = EFC NUMBER                             14120000
141300                                                                  14130000
141400***  WHEN 810 PROCESING FOR 870, CURR OPER = 810, CRE OPER = 870  14140000
141500                                                                  14150000
240700     EVALUATE TRUE                                                24070000
240800       WHEN SQLCODE = +0                                          24080000
241100       WHEN SQLCODE = +100                                        24110000
241101           CONTINUE                                               24110100
241102                                                                  24110200
241400       WHEN OTHER                                                 24140000
241500           SET PS-DONE-YES TO TRUE                                24150000
241600           MOVE SPACES     TO TM501-TM500-RETURN-MSG              24160000
241700           MOVE '1550'     TO TM501-PARA                          24170000
241800           MOVE '823'      TO TM501-PGM                           24180000
241900           MOVE SQLCODE    TO TM500-SQLCODE                       24190000
242000           MOVE SQLCA      TO TM500-SQLCA                         24200000
242100           MOVE 106        TO TM501-PRORATION-ERROR-NBR           24210000
242200           PERFORM TM501-SET-TM500-RETURN-MSG                     24220000
242300           PERFORM RC001-RETURN-MSG                               24230000
242400     END-EVALUATE.                                                24240000
242500                                                                  24250000
242600** AHP -  END - 04/23/08                                          24260000
242700                                                                  24270000
242701*2413-GET-DAYS-PR-CHG-NBR.                                     ***24270100
242702*                                                                *24270200
242703*           R U L E   T A B L E   P R O C E S S I N G            *24270300
242704*                                                                *24270400
242705******************************************************************24270500
242706 2000-SELECT-RULE.                                                24270600
242707     MOVE '2000-SELECT-RULE              ' TO RC001-PARAGRAPH.    24270700
242708                                                                  24270800
242709     EXEC SQL                                                     24270900
242710         SELECT A.PRRTN_RUL_ID                                    24271000
242711              , A.PRRTN_RUL_SEQ_NBR                               24271100
242712              , A.PRRTN_FUNC_CDE                                  24271200
242713              , A.PRRTN_OPRN_CDE                                  24271300
242714              , A.PRRTN_VAL_NBR                                   24271400
242715              , A.ACTV_IND                                        24271500
242716              , B.PRRTN_FUNC_DESC                                 24271600
242717           INTO :RCT00001-PRRTN-RUL-ID                            24271700
242718              , :RCT00001-PRRTN-RUL-SEQ-NBR                       24271800
242719              , :RCT00001-PRRTN-FUNC-CDE                          24271900
242720              , :RCT00001-PRRTN-OPRN-CDE                          24272000
242721              , :RCT00001-PRRTN-VAL-NBR                           24272100
242722              , :RCT00001-ACTV-IND                                24272200
242723              , :RCT00003-PRRTN-FUNC-DESC                         24272300
242724           FROM RCT_FUNC_RUL A                                    24272400
242725              , RCT_PRRTN_FUNC B                                  24272500
242726          WHERE A.PRRTN_RUL_ID      = :DK-RULE-KEY                24272600
242727            AND A.PRRTN_RUL_SEQ_NBR = :DK-RULE-SEQ                24272700
242728            AND A.PRRTN_FUNC_CDE    = B.PRRTN_FUNC_CDE            24272800
242729     END-EXEC.                                                    24272900
242730                                                                  24273000
242731     EVALUATE TRUE                                                24273100
242732       WHEN SQLCODE = ZERO                                        24273200
242733           SET PS-END-OF-RULES-NO TO TRUE                         24273300
242734                                                                  24273400
242735       WHEN SQLCODE = +100                                        24273500
242736           SET PS-DONE-YES   TO TRUE                              24273600
242737           MOVE SPACES       TO TM501-TM500-RETURN-MSG            24273700
242738           MOVE '2000'       TO TM501-PARA                        24273800
242739           MOVE '823'        TO TM501-PGM                         24273900
242740           MOVE SQLCODE      TO TM500-SQLCODE                     24274000
242741           MOVE SQLCA        TO TM500-SQLCA                       24274100
242742           MOVE 62           TO TM501-PRORATION-ERROR-NBR         24274200
242743           PERFORM TM501-SET-TM500-RETURN-MSG                     24274300
242744           PERFORM RC001-RETURN-MSG                               24274400
242745                                                                  24274500
242746       WHEN OTHER                                                 24274600
242747           SET PS-DONE-YES   TO TRUE                              24274700
242748           MOVE SPACES       TO TM501-TM500-RETURN-MSG            24274800
242749           MOVE '2000'       TO TM501-PARA                        24274900
242750           MOVE '823'        TO TM501-PGM                         24275000
242751           MOVE SQLCODE      TO TM500-SQLCODE                     24275100
242752           MOVE SQLCA        TO TM500-SQLCA                       24275200
242753           MOVE 63           TO TM501-PRORATION-ERROR-NBR         24275300
242754           PERFORM TM501-SET-TM500-RETURN-MSG                     24275400
242755           PERFORM RC001-RETURN-MSG                               24275500
242756     END-EVALUATE.                                                24275600
242757                                                                  24275700
242758******************************************************************24275800
242759* SKU LEVEL TROUBLE REQUIRES EVERY ITEM(SKU) TO BE PROCESSED.    *24275900
242760******************************************************************24276000
242761 2100-PROCESS-SKU-LVL-TRB.                                        24276100
242762     MOVE '2100-PROCESS-SKU-LVL-TRB      ' TO RC001-PARAGRAPH.    24276200
242763                                                                  24276300
242764*LOOP ALL ITEMS FOR THE RULE.                                     24276400
242765     PERFORM                                                      24276500
242766       VARYING RC821-ITEM-IDX FROM 1 BY 1                         24276600
242767         UNTIL PS-DONE-YES                                        24276700
242768            OR RC821-REC-LNE-NBR (RC821-ITEM-IDX) NOT > ZEROES    24276800
242769                                                                  24276900
242770         MOVE +1 TO DK-RULE-SEQ                                   24277000
242771                    PV-RULE-SEQ                                   24277100
242772         SET PS-END-OF-RULES-NO TO TRUE                           24277200
242773         PERFORM                                                  24277300
242774           UNTIL PS-END-OF-RULES-YES                              24277400
242775                                                                  24277500
242776             PERFORM 3000-SET-RULE-RESULT                         24277600
242777                                                                  24277700
242778             PERFORM 6000-PROCESS-RULE-ACTIONS                    24277800
242779                                                                  24277900
242780             IF PV-RULE-SEQ NOT = DK-RULE-SEQ                     24278000
242781                 IF PV-RULE-SEQ > DK-RULE-SEQ                     24278100
242782                     MOVE PV-RULE-SEQ TO DK-RULE-SEQ              24278200
242783                     PERFORM 2000-SELECT-RULE                     24278300
242784                 ELSE                                             24278400
242785                     SET PS-END-OF-RULES-YES TO TRUE              24278500
242786                     SET PS-DONE-YES TO TRUE                      24278600
242787                     MOVE SPACES     TO TM501-TM500-RETURN-MSG    24278700
242788                     MOVE '2100'     TO TM501-PARA                24278800
242789                     MOVE '823'      TO TM501-PGM                 24278900
242790                     MOVE SQLCODE    TO TM500-SQLCODE             24279000
242791                     MOVE SQLCA      TO TM500-SQLCA               24279100
242792                     MOVE 54         TO TM501-PRORATION-ERROR-NBR 24279200
242793                     PERFORM TM501-SET-TM500-RETURN-MSG           24279300
242794                     PERFORM RC001-RETURN-MSG                     24279400
242795                 END-IF                                           24279500
242796             ELSE                                                 24279600
242797                 MOVE +1 TO DK-RULE-SEQ                           24279700
242798                            PV-RULE-SEQ                           24279800
242799                 PERFORM 2000-SELECT-RULE                         24279900
242800                 SET PS-END-OF-RULES-YES TO TRUE                  24280000
242801             END-IF                                               24280100
242802         END-PERFORM                                              24280200
242803                                                                  24280300
242804     END-PERFORM.                                                 24280400
242805                                                                  24280500
242806*10/13/03 ALLOWS A RULE TO FINISH BUT THAT IS IT                  24280600
242807     IF  PS-RULE-DONE-YES                                         24280700
242808        SET PS-DONE-YES TO TRUE                                   24280800
242809     END-IF.                                                      24280900
242810                                                                  24281000
242811******************************************************************24281100
242812* PACK LEVEL TROUBLE REQUIRES EVERY PACK(ONLY 1) TO BE PROCESSED.*24281200
242813******************************************************************24281300
242814 2200-PROCESS-PACK-LVL-TRB.                                       24281400
242815     MOVE '2200-PROCESS-PACK-LVL-TRB     ' TO RC001-PARAGRAPH.    24281500
242816                                                                  24281600
242817     MOVE +1 TO DK-RULE-SEQ                                       24281700
242818                PV-RULE-SEQ                                       24281800
242819     SET PS-END-OF-RULES-NO TO TRUE                               24281900
242820     PERFORM                                                      24282000
242821       UNTIL PS-END-OF-RULES-YES                                  24282100
242822                                                                  24282200
242823         PERFORM 3000-SET-RULE-RESULT                             24282300
242824                                                                  24282400
242825         PERFORM 6000-PROCESS-RULE-ACTIONS                        24282500
242826                                                                  24282600
242827         IF PV-RULE-SEQ NOT = DK-RULE-SEQ                         24282700
242828             IF PV-RULE-SEQ > DK-RULE-SEQ                         24282800
242829                 MOVE PV-RULE-SEQ TO DK-RULE-SEQ                  24282900
242830                 PERFORM 2000-SELECT-RULE                         24283000
242831             ELSE                                                 24283100
242832                 SET PS-END-OF-RULES-YES TO TRUE                  24283200
242833                 SET PS-DONE-YES TO TRUE                          24283300
242834                 MOVE SPACES     TO TM501-TM500-RETURN-MSG        24283400
242835                 MOVE '2200'     TO TM501-PARA                    24283500
242836                 MOVE '823'      TO TM501-PGM                     24283600
242837                 MOVE SQLCODE    TO TM500-SQLCODE                 24283700
242838                 MOVE SQLCA      TO TM500-SQLCA                   24283800
242839                 MOVE 65         TO TM501-PRORATION-ERROR-NBR     24283900
242840                 PERFORM TM501-SET-TM500-RETURN-MSG               24284000
242841                 PERFORM RC001-RETURN-MSG                         24284100
242842             END-IF                                               24284200
242843         ELSE                                                     24284300
242844             SET PS-END-OF-RULES-YES TO TRUE                      24284400
242845         END-IF                                                   24284500
242846                                                                  24284600
242847     END-PERFORM.                                                 24284700
242848                                                                  24284800
242849*10/13/03 ALLOWS A RULE TO FINISH BUT THAT IS IT                  24284900
242850     IF  PS-RULE-DONE-YES                                         24285000
242851        SET PS-DONE-YES TO TRUE                                   24285100
242852     END-IF.                                                      24285200
242853                                                                  24285300
242854******************************************************************24285400
242855* STORE LEVEL TROUBLE REQUIRES EVERY STORE TO BE PROCESSED.      *24285500
242856******************************************************************24285600
242857 2300-PROCESS-STORE-LVL-TRB.                                      24285700
242858     MOVE '2300-PROCESS-STORE-LVL-TRB    ' TO RC001-PARAGRAPH.    24285800
242859                                                                  24285900
242860     PERFORM                                                      24286000
242861       VARYING RC821-STORE-IDX FROM 1 BY 1                        24286100
242862         UNTIL PS-DONE-YES                                        24286200
242863            OR RC821-STR-NBR (RC821-STORE-IDX) NOT > ZEROES       24286300
242864            OR RC821-STORE-IDX > RC821-MAX-STR-COUNT              24286400
242865                                                                  24286500
242866         MOVE +1 TO DK-RULE-SEQ                                   24286600
242867                    PV-RULE-SEQ                                   24286700
242868         SET PS-END-OF-RULES-NO TO TRUE                           24286800
242869         PERFORM                                                  24286900
242870           UNTIL PS-END-OF-RULES-YES                              24287000
242871                                                                  24287100
242872             PERFORM 3000-SET-RULE-RESULT                         24287200
242873                                                                  24287300
242874             PERFORM 6000-PROCESS-RULE-ACTIONS                    24287400
242875                                                                  24287500
242876             IF PV-RULE-SEQ NOT = DK-RULE-SEQ                     24287600
242877                 IF PV-RULE-SEQ > DK-RULE-SEQ                     24287700
242878                     MOVE PV-RULE-SEQ TO DK-RULE-SEQ              24287800
242879                     PERFORM 2000-SELECT-RULE                     24287900
242880                 ELSE                                             24288000
242881                     SET PS-END-OF-RULES-YES TO TRUE              24288100
242882                     SET PS-DONE-YES TO TRUE                      24288200
242883                     MOVE SPACES     TO TM501-TM500-RETURN-MSG    24288300
242884                     MOVE '2300'     TO TM501-PARA                24288400
242885                     MOVE '823'      TO TM501-PGM                 24288500
242886                     MOVE SQLCODE    TO TM500-SQLCODE             24288600
242887                     MOVE SQLCA      TO TM500-SQLCA               24288700
242888                     MOVE 66         TO TM501-PRORATION-ERROR-NBR 24288800
242889                     PERFORM TM501-SET-TM500-RETURN-MSG           24288900
242890                     PERFORM RC001-RETURN-MSG                     24289000
242891                 END-IF                                           24289100
242892             ELSE                                                 24289200
242893                 MOVE +1 TO DK-RULE-SEQ                           24289300
242894                            PV-RULE-SEQ                           24289400
242895                 PERFORM 2000-SELECT-RULE                         24289500
242896                 SET PS-END-OF-RULES-YES TO TRUE                  24289600
242897             END-IF                                               24289700
242898         END-PERFORM                                              24289800
242899                                                                  24289900
242900     END-PERFORM.                                                 24290000
242901                                                                  24290100
242902*10/13/03 ALLOWS A RULE TO FINISH BUT THAT IS IT                  24290200
242903     IF  PS-RULE-DONE-YES                                         24290300
242904        SET PS-DONE-YES TO TRUE                                   24290400
242905     END-IF.                                                      24290500
242906                                                                  24290600
242907******************************************************************24290700
242908*    - DETERMINE FUNCTION VALUE                                   24290800
242909*    - COMPARE FUNCTION VALUE TO TABLE VALUE                      24290900
242910*    - SET PV-RULE-RESULT TO 'Y'(TRUE) OR 'N'(FALSE)              24291000
242911******************************************************************24291100
242912 3000-SET-RULE-RESULT.                                            24291200
242913     MOVE '3000-SET-RULE-RESULT          ' TO RC001-PARAGRAPH.    24291300
242914                                                                  24291400
242915     MOVE SPACES TO PV-RULE-RESULT.                               24291500
242916                                                                  24291600
242917* UNITS < STORES ALLOC                                            24291700
242918     IF RCT00001-PRRTN-FUNC-CDE = 'ARULAL'                        24291800
242919         MOVE ZEROES TO PV-ARULAL-STR-CNT                         24291900
242920         PERFORM                                                  24292000
242921           VARYING L FROM 1 BY 1                                  24292100
242922             UNTIL L > RC821-MAX-STR-COUNT                        24292200
242923                                                                  24292300
242924             IF (RC821-STR-NBR (L) > ZEROES)                      24292400
242925               AND (RC821-ST-TYPE-CODE (L) NOT = 'CS')            24292500
242926               AND (RC821-STR-DISTRO-QTY (L) =                    24292600
242927                    RC821-STR-OTR-QTY (L))                        24292700
242928                 ADD 1 TO PV-ARULAL-STR-CNT                       24292800
242929             END-IF                                               24292900
242930         END-PERFORM                                              24293000
242931                                                                  24293100
242932         IF (TM500-UNITS-TO-ALLOC / PV-DISPERSAL-QTY)             24293200
242933                             < PV-ARULAL-STR-CNT                  24293300
242934             MOVE 'Y' TO PV-RULE-RESULT                           24293400
242935         ELSE                                                     24293500
242936             MOVE 'N' TO PV-RULE-RESULT                           24293600
242937         END-IF                                                   24293700
242938     END-IF.                                                      24293800
242939                                                                  24293900
242940* ANY ODD UNITS *                                                 24294000
242941     IF RCT00001-PRRTN-FUNC-CDE = 'LNODUE'                        24294100
242942         IF PV-LINE-ODD-UNITS = 'Y'                               24294200
242943             MOVE 'Y' TO PV-RULE-RESULT                           24294300
242944         ELSE                                                     24294400
242945             MOVE 'N' TO PV-RULE-RESULT                           24294500
242946         END-IF                                                   24294600
242947     END-IF.                                                      24294700
242948                                                                  24294800
242949* TOTAL UNITS OVER / SHORT *                                      24294900
242950     IF RCT00001-PRRTN-FUNC-CDE = 'TOTUOS'                        24295000
242951         MOVE ZEROES TO PV-TOT-QTY-OV-SH                          24295100
242952         PERFORM                                                  24295200
242953           VARYING L FROM 1 BY 1                                  24295300
242954             UNTIL RC821-REC-LNE-NBR (L) = ZEROES                 24295400
242955                OR L > RC821-MAX-ITEM-COUNT                       24295500
242956                                                                  24295600
242957             COMPUTE PV-TOT-QTY-OV-SH = PV-TOT-QTY-OV-SH          24295700
242958                   + (RC821-BEST-CASE-UNITS (L)                   24295800
242959                   - RC821-ITEM-OTR-QTY (L))                      24295900
242960         END-PERFORM                                              24296000
242961                                                                  24296100
242962         IF PV-TOT-QTY-OV-SH > ZEROES                             24296200
242963             MOVE 'Y' TO PV-RULE-RESULT                           24296300
242964         ELSE                                                     24296400
242965             MOVE 'N' TO PV-RULE-RESULT                           24296500
242966         END-IF                                                   24296600
242967     END-IF.                                                      24296700
242968                                                                  24296800
242969* CURRENT LOGIC *                                                 24296900
242970     IF RCT00001-PRRTN-FUNC-CDE = 'USLGTD'                        24297000
242971         IF RC821-SHORT-USE-EX-RULES-IND = 'Y'                    24297100
242972             MOVE 'Y' TO PV-RULE-RESULT                           24297200
242973         ELSE                                                     24297300
242974             MOVE 'N' TO PV-RULE-RESULT                           24297400
242975         END-IF                                                   24297500
242976     END-IF.                                                      24297600
242977                                                                  24297700
242978     IF (TM500-OPER-UNT-ID = RC821-OPER-UNT-ID) OR                24297800
242979        (TM500-OPER-UNT-ID = RC821-CRE-OPER-UNT-ID) OR            24297900
242980        (TM500-OPER-UNT-ID = RC821-CURR-OPER-UNT-ID)              24298000
242990        CONTINUE                                                  24299000
243000     ELSE                                                         24300000
243100        PERFORM 1530-CHECK-FOR-LOCATION                           24310000
243200        IF XLT00010-E-BUS-IND = 'Y' AND                           24320000
243300           XLT00010-LOC-TYP-CDE = 'DC'                            24330000
243301           SET PS-ECOM-TM500-YES TO TRUE.                         24330100
243302* E-COMM FACILITY *                                               24330200
243303     IF RCT00001-PRRTN-FUNC-CDE = 'ISECOM'                        24330300
243304         IF PS-ECOM-TM500-YES                                     24330400
243305             MOVE 'Y' TO PV-RULE-RESULT                           24330500
243306         ELSE                                                     24330600
243307             MOVE 'N' TO PV-RULE-RESULT                           24330700
243308         END-IF                                                   24330800
243309     END-IF.                                                      24330900
243310                                                                  24331000
243311* IS THERE ANY ANALYST BAD PACK *                                 24331100
243312     IF RCT00001-PRRTN-FUNC-CDE = 'ANBDPK'                        24331200
243313         IF PS-ANALYST-BAD-PACK-YES                               24331300
243314           OR PS-ANALYST-BP-WITHIN-YES                            24331400
243315             MOVE 'Y' TO PV-RULE-RESULT                           24331500
243316         ELSE                                                     24331600
243317             MOVE 'N' TO PV-RULE-RESULT                           24331700
243318         END-IF                                                   24331800
243319     END-IF.                                                      24331900
243320                                                                  24332000
243321* IS THERE ANALYST BAD PACK *                                     24332100
243322     IF RCT00001-PRRTN-FUNC-CDE = 'AABDPK'                        24332200
243323         IF PS-ANALYST-BAD-PACK-YES                               24332300
243324           OR PV-DIFFERENT-RATIOS = 'Y'                           24332400
243325           OR PV-LINES-MISSING    = 'Y'                           24332500
243326             MOVE 'Y' TO PV-RULE-RESULT                           24332600
243327         ELSE                                                     24332700
243328             MOVE 'N' TO PV-RULE-RESULT                           24332800
243329         END-IF                                                   24332900
243330     END-IF.                                                      24333000
243331                                                                  24333100
243332* IS THERE BAD PACK WITHIN *                                      24333200
243333     IF RCT00001-PRRTN-FUNC-CDE = 'BDPKWI'                        24333300
243334         IF PS-ANALYST-BAD-PACK-NO                                24333400
243335           AND PS-ANALYST-BP-WITHIN-YES                           24333500
243336             MOVE 'Y' TO PV-RULE-RESULT                           24333600
243337         ELSE                                                     24333700
243338             MOVE 'N' TO PV-RULE-RESULT                           24333800
243339         END-IF                                                   24333900
243340     END-IF.                                                      24334000
243341                                                                  24334100
243342* RESOLVE TROUBLE *                                               24334200
243343     IF RCT00001-PRRTN-FUNC-CDE = 'ISMRST'                        24334300
243344         IF TM500-PROCESS-IND = 'RLA'                             24334400
243345             MOVE 'Y' TO PV-RULE-RESULT                           24334500
243346         ELSE                                                     24334600
243347             MOVE 'N' TO PV-RULE-RESULT                           24334700
243348         END-IF                                                   24334800
243349     END-IF.                                                      24334900
243350                                                                  24335000
243351* DUMMY SKU *                                                     24335100
243352     IF RCT00001-PRRTN-FUNC-CDE = 'ISDMSK'                        24335200
243353         IF RC821-DUMMY-SKU-IND (RC821-ITEM-IDX) = 'Y'            24335300
243354             MOVE 'Y' TO PV-RULE-RESULT                           24335400
243355         ELSE                                                     24335500
243356             MOVE 'N' TO PV-RULE-RESULT                           24335600
243357         END-IF                                                   24335700
243358     END-IF.                                                      24335800
243359                                                                  24335900
243360* WEB ITEM *                                                      24336000
243361     IF RCT00001-PRRTN-FUNC-CDE = 'ISWBIT'                        24336100
243362         IF RC821-WEB-ITEM-IND (RC821-ITEM-IDX) = 'Y'             24336200
243363             MOVE 'Y' TO PV-RULE-RESULT                           24336300
243364         ELSE                                                     24336400
243365             MOVE 'N' TO PV-RULE-RESULT                           24336500
243366         END-IF                                                   24336600
243367     END-IF.                                                      24336700
243368                                                                  24336800
243369* ITEM CANCELLED /REVERSED *                                      24336900
243370     IF RCT00001-PRRTN-FUNC-CDE = 'ISITCR'                        24337000
243371         IF RC821-PO-LNE-STATUS-CDE (RC821-ITEM-IDX) =            24337100
243372                                          'CA' OR 'CB' OR 'RV'    24337200
243373             MOVE 'Y' TO PV-RULE-RESULT                           24337300
243374         ELSE                                                     24337400
243375             MOVE 'N' TO PV-RULE-RESULT                           24337500
243376         END-IF                                                   24337600
243377     END-IF.                                                      24337700
243378                                                                  24337800
243379* ITEM CANCELLED *                                                24337900
243380     IF RCT00001-PRRTN-FUNC-CDE = 'ISITCN'                        24338000
243381         IF RC821-PO-LNE-STATUS-CDE (RC821-ITEM-IDX) = 'CA'       24338100
243382             MOVE 'Y' TO PV-RULE-RESULT                           24338200
243383         ELSE                                                     24338300
243384             MOVE 'N' TO PV-RULE-RESULT                           24338400
243385         END-IF                                                   24338500
243386     END-IF.                                                      24338600
243387                                                                  24338700
243388* ITEM CANCELLED BALANCE *                                        24338800
243389     IF RCT00001-PRRTN-FUNC-CDE = 'ISITCB'                        24338900
243390         IF RC821-PO-LNE-STATUS-CDE (RC821-ITEM-IDX) = 'CB'       24339000
243391             MOVE 'Y' TO PV-RULE-RESULT                           24339100
243392         ELSE                                                     24339200
243393             MOVE 'N' TO PV-RULE-RESULT                           24339300
243394         END-IF                                                   24339400
243395     END-IF.                                                      24339500
243396                                                                  24339600
243397* ITEM REVISED *                                                  24339700
243398     IF RCT00001-PRRTN-FUNC-CDE = 'ISITRV'                        24339800
243399         IF RC821-PO-LNE-STATUS-CDE (RC821-ITEM-IDX) = 'RV'       24339900
243400             MOVE 'Y' TO PV-RULE-RESULT                           24340000
243401         ELSE                                                     24340100
243402             MOVE 'N' TO PV-RULE-RESULT                           24340200
243403         END-IF                                                   24340300
243404     END-IF.                                                      24340400
243405                                                                  24340500
243406* ITEM PREPACK *                                                  24340600
243407     IF RCT00001-PRRTN-FUNC-CDE = 'ISPKRC'                        24340700
243408         IF RC821-PKGNG-CDE = 'M' OR 'I'                          24340800
243409             MOVE 'Y' TO PV-RULE-RESULT                           24340900
243410         ELSE                                                     24341000
243411             MOVE 'N' TO PV-RULE-RESULT                           24341100
243412         END-IF                                                   24341200
243413     END-IF.                                                      24341300
243414                                                                  24341400
243415* DC LINE SPLIT *                                                 24341500
243416     IF RCT00001-PRRTN-FUNC-CDE = 'DCLSPE'                        24341600
243417         IF RC821-NO-TALLPLN-DISTRO-IND = 'Y'                     24341700
243418             MOVE 'N' TO PV-RULE-RESULT                           24341800
243419         ELSE                                                     24341900
243420             MOVE 'Y' TO PV-RULE-RESULT                           24342000
243421         END-IF                                                   24342100
243422     END-IF.                                                      24342200
243423                                                                  24342300
243424* PACK DC SPLIT *                                                 24342400
243425     IF RCT00001-PRRTN-FUNC-CDE = 'DCPSPE'                        24342500
243426         IF RC821-NO-TALLPLN-DISTRO-IND = 'Y'                     24342600
243427             MOVE 'N' TO PV-RULE-RESULT                           24342700
243428         ELSE                                                     24342800
243429             MOVE 'Y' TO PV-RULE-RESULT                           24342900
243430         END-IF                                                   24343000
243431     END-IF.                                                      24343100
243432                                                                  24343200
243433* DC LINE SPLIT & ALLOC *                                         24343300
243434     IF RCT00001-PRRTN-FUNC-CDE = 'DCAALE'                        24343400
243435         IF (RC821-NO-TALLPLN-DISTRO-IND = 'N')                   24343500
243436           AND (RC821-NO-TMESTDS-DISTRO-IND = 'N')                24343600
243437             MOVE 'N' TO PV-RULE-RESULT                           24343700
243438         ELSE                                                     24343800
243439             MOVE 'Y' TO PV-RULE-RESULT                           24343900
243440         END-IF                                                   24344000
243441     END-IF.                                                      24344100
243442                                                                  24344200
243443* LINE ALLOC *                                                    24344300
243444     IF RCT00001-PRRTN-FUNC-CDE = 'DSAALE'                        24344400
243445         IF RC821-NO-TMESTDS-DISTRO-IND = 'Y'                     24344500
243446             MOVE 'N' TO PV-RULE-RESULT                           24344600
243447         ELSE                                                     24344700
243448             MOVE 'Y' TO PV-RULE-RESULT                           24344800
243449         END-IF                                                   24344900
243450     END-IF.                                                      24345000
243451                                                                  24345100
243452* PACK ALLOC *                                                    24345200
243453     IF RCT00001-PRRTN-FUNC-CDE = 'DSPALE'                        24345300
243454         IF RC821-NO-TMESTDS-DISTRO-IND = 'Y'                     24345400
243455             MOVE 'N' TO PV-RULE-RESULT                           24345500
243456         ELSE                                                     24345600
243457             MOVE 'Y' TO PV-RULE-RESULT                           24345700
243458         END-IF                                                   24345800
243459     END-IF.                                                      24345900
243460                                                                  24346000
243461* DO PRORATION *                                                  24346100
243462     IF RCT00001-PRRTN-FUNC-CDE = 'DOPROR'                        24346200
243463         IF RC823-DO-ALLOC-IND = 'Y'                              24346300
243464             MOVE 'Y' TO PV-RULE-RESULT                           24346400
243465         ELSE                                                     24346500
243466             MOVE 'N' TO PV-RULE-RESULT                           24346600
243467         END-IF                                                   24346700
243468     END-IF.                                                      24346800
243469                                                                  24346900
243470* LINE UNTIED *                                                   24347000
243471     IF RCT00001-PRRTN-FUNC-CDE = 'ISPKUN'                        24347100
243472         IF RC821-PREPK-ID = 99                                   24347200
243473             MOVE 'Y' TO PV-RULE-RESULT                           24347300
243474         ELSE                                                     24347400
243475             MOVE 'N' TO PV-RULE-RESULT                           24347500
243476         END-IF                                                   24347600
243477     END-IF.                                                      24347700
243478                                                                  24347800
243479* CHECK FOR BAD INNER PACK *                                      24347900
243480     IF RCT00001-PRRTN-FUNC-CDE = 'BDINPK'                        24348000
243481         SET PS-BAD-INNER-PACK-NO TO TRUE                         24348100
243482         PERFORM 3500-CHECK-STR-PACK                              24348200
243483         IF PS-BAD-INNER-PACK-YES                                 24348300
243484             MOVE 'Y' TO PV-RULE-RESULT                           24348400
243485         ELSE                                                     24348500
243486             MOVE 'N' TO PV-RULE-RESULT                           24348600
243487         END-IF                                                   24348700
243488     END-IF.                                                      24348800
243489                                                                  24348900
243490* PBS RECEIVER *                                                  24349000
243491     IF RCT00001-PRRTN-FUNC-CDE = 'PBSRCV'                        24349100
243492         IF RC821-PACK-BY-STORE-IND = 'Y'                         24349200
243493             MOVE 'Y' TO PV-RULE-RESULT                           24349300
243494         ELSE                                                     24349400
243495             MOVE 'N' TO PV-RULE-RESULT                           24349500
243496         END-IF                                                   24349600
243497     END-IF.                                                      24349700
243498                                                                  24349800
243499* LINE ODU *                                                      24349900
243500***  IF RCT00001-PRRTN-FUNC-CDE = 'LNEODU'                        24350000
243501     IF RCT00001-PRRTN-FUNC-CDE = 'LODUOT'                        24350100
243502         IF PV-LINE-ODU-OUT-OF-TOL = 'Y'                          24350200
243503             MOVE 'Y' TO PV-RULE-RESULT                           24350300
243504         ELSE                                                     24350400
243505             MOVE 'N' TO PV-RULE-RESULT                           24350500
243506         END-IF                                                   24350600
243507     END-IF.                                                      24350700
243508                                                                  24350800
243509* LINE ODUD *                                                     24350900
243510***  IF RCT00001-PRRTN-FUNC-CDE = 'LNODUD'                        24351000
243511     IF RCT00001-PRRTN-FUNC-CDE = 'LODDOT'                        24351100
243512         IF PV-LINE-ODUD-OUT-OF-TOL = 'Y'                         24351200
243513             MOVE 'Y' TO PV-RULE-RESULT                           24351300
243514         ELSE                                                     24351400
243515             MOVE 'N' TO PV-RULE-RESULT                           24351500
243516         END-IF                                                   24351600
243517     END-IF.                                                      24351700
243518                                                                  24351800
243519* PACK ODU *                                                      24351900
243520***  IF RCT00001-PRRTN-FUNC-CDE = 'PKODUD'                        24352000
243521     IF RCT00001-PRRTN-FUNC-CDE = 'PODDOT'                        24352100
243522         IF PV-PACK-ODUD-OUT-OF-TOL = 'Y'                         24352200
243523             MOVE 'Y' TO PV-RULE-RESULT                           24352300
243524         ELSE                                                     24352400
243525             MOVE 'N' TO PV-RULE-RESULT                           24352500
243526         END-IF                                                   24352600
243527     END-IF.                                                      24352700
243528                                                                  24352800
243529* PACK ODU *                                                      24352900
243530***  IF RCT00001-PRRTN-FUNC-CDE = 'PKODUS'                        24353000
243531     IF RCT00001-PRRTN-FUNC-CDE = 'PODUOT'                        24353100
243532         IF PV-PACK-ODU-OUT-OF-TOL = 'Y'                          24353200
243533             MOVE 'Y' TO PV-RULE-RESULT                           24353300
243534         ELSE                                                     24353400
243535             MOVE 'N' TO PV-RULE-RESULT                           24353500
243536         END-IF                                                   24353600
243537     END-IF.                                                      24353700
243538                                                                  24353800
243539* PACK ODU *                                                      24353900
243540     IF RCT00001-PRRTN-FUNC-CDE = 'PKODUE'                        24354000
243541         IF RC821-TOTAL-ODD-UNITS > ZEROES                        24354100
243542             MOVE 'Y' TO PV-RULE-RESULT                           24354200
243543         ELSE                                                     24354300
243544             MOVE 'N' TO PV-RULE-RESULT                           24354400
243545         END-IF                                                   24354500
243546     END-IF.                                                      24354600
243547                                                                  24354700
243548* ODD UNITS OUT OF TOLERANCE                                      24354800
243549     IF RCT00001-PRRTN-FUNC-CDE = 'ODUOOT'                        24354900
243550         IF PV-LINE-ODU-OUT-OF-TOL = 'Y'                          24355000
243551           OR PV-LINE-ODUD-OUT-OF-TOL = 'Y'                       24355100
243552           OR PV-PACK-ODU-OUT-OF-TOL = 'Y'                        24355200
243553           OR PV-PACK-ODUD-OUT-OF-TOL = 'Y'                       24355300
243554             MOVE 'Y' TO PV-RULE-RESULT                           24355400
243555         ELSE                                                     24355500
243556             MOVE 'N' TO PV-RULE-RESULT                           24355600
243557         END-IF                                                   24355700
243558     END-IF.                                                      24355800
243559                                                                  24355900
243560* OVER-SHORT MATCH                                                24356000
243561     IF RCT00001-PRRTN-FUNC-CDE = 'ISOVSH'                        24356100
243562         IF RC821-OVER-SHORT-CDE = 'M'                            24356200
243563             MOVE 'Y' TO PV-RULE-RESULT                           24356300
243564         ELSE                                                     24356400
243565             MOVE 'N' TO PV-RULE-RESULT                           24356500
243566         END-IF                                                   24356600
243567     END-IF.                                                      24356700
243568                                                                  24356800
243569* PACK DC SPLIT & ALLOC *                                         24356900
243570     IF RCT00001-PRRTN-FUNC-CDE = 'PDCALE'                        24357000
243571         IF (RC821-NO-TALLPLN-DISTRO-IND = 'N')                   24357100
243572           AND (RC821-NO-TMESTDS-DISTRO-IND = 'N')                24357200
243573             MOVE 'Y' TO PV-RULE-RESULT                           24357300
243574         ELSE                                                     24357400
243575             MOVE 'N' TO PV-RULE-RESULT                           24357500
243576         END-IF                                                   24357600
243577     END-IF.                                                      24357700
243578                                                                  24357800
243579* STORE CLOSED *                                                  24357900
243580     IF RCT00001-PRRTN-FUNC-CDE = 'STCLSD'                        24358000
243581         IF (PV-CURRENT-DATE > RC821-CLOSED-DATE (RC821-STORE-IDX)24358100
243582           OR PV-CURRENT-DATE =                                   24358200
243583                              RC821-CLOSED-DATE (RC821-STORE-IDX))24358300
243584             MOVE 'Y' TO PV-RULE-RESULT                           24358400
243585         ELSE                                                     24358500
243586             MOVE 'N' TO PV-RULE-RESULT                           24358600
243587         END-IF                                                   24358700
243588     END-IF.                                                      24358800
243589                                                                  24358900
243590* OPEN FOR RECEIPT *                                              24359000
243591     IF RCT00001-PRRTN-FUNC-CDE = 'STOPRC'                        24359100
243592         IF (PV-CURRENT-DATE NOT <                                24359200
243593                 RC821-ST-DC-RCT-STA-DTE (RC821-STORE-IDX)        24359300
243594           AND PV-CURRENT-DATE NOT >                              24359400
243595                 RC821-ST-DC-RCT-STO-DTE (RC821-STORE-IDX))       24359500
243596             MOVE 'Y' TO PV-RULE-RESULT                           24359600
243597         ELSE                                                     24359700
243598             MOVE 'N' TO PV-RULE-RESULT                           24359800
243599         END-IF                                                   24359900
243600     END-IF.                                                      24360000
243601                                                                  24360100
243602* WRONG STORE DC *                                                24360200
243603     IF RCT00001-PRRTN-FUNC-CDE = 'WRDCST'                        24360300
243604         MOVE ZEROES TO PV-DC-OPER-UNT-ID                         24360400
243605         IF PV-CURRENT-DATE =                                     24360500
243606                 RC821-ST-DC-RCT-STA-DTE (RC821-STORE-IDX)        24360600
243607             MOVE RC821-ST-DC-NMBR (RC821-STORE-IDX)              24360700
243608               TO PV-DC-OPER-UNT-ID                               24360800
243609         END-IF                                                   24360900
243610         IF (PV-CURRENT-DATE >                                    24361000
243611                 RC821-ST-DC-RCT-STA-DTE (RC821-STORE-IDX))       24361100
243612           AND (PV-CURRENT-DATE <                                 24361200
243613                 RC821-ST-DC-RCT-STO-DTE (RC821-STORE-IDX))       24361300
243614             MOVE RC821-ST-DC-NMBR (RC821-STORE-IDX)              24361400
243615               TO PV-DC-OPER-UNT-ID                               24361500
243616         END-IF                                                   24361600
243617         IF PV-CURRENT-DATE =                                     24361700
243618                 RC821-ST-DC-RCT-STO-DTE (RC821-STORE-IDX)        24361800
243619             MOVE RC821-ST-DC-NMBR (RC821-STORE-IDX)              24361900
243620               TO PV-DC-OPER-UNT-ID                               24362000
243621         END-IF                                                   24362100
243622                                                                  24362200
243623         IF TM500-OPER-UNT-ID NOT = PV-DC-OPER-UNT-ID             24362300
243624             MOVE 'Y' TO PV-RULE-RESULT                           24362400
243625         ELSE                                                     24362500
243626             MOVE 'N' TO PV-RULE-RESULT                           24362600
243627         END-IF                                                   24362700
243628     END-IF.                                                      24362800
243629                                                                  24362900
243630* PACK RATIO MATCH *                                              24363000
243631     IF RCT00001-PRRTN-FUNC-CDE = 'PKRTMT'                        24363100
243632         IF PV-DIFFERENT-RATIOS = 'Y'                             24363200
243633             MOVE 'N' TO PV-RULE-RESULT                           24363300
243634         ELSE                                                     24363400
243635             MOVE 'Y' TO PV-RULE-RESULT                           24363500
243636         END-IF                                                   24363600
243637     END-IF.                                                      24363700
243638                                                                  24363800
243639* MISSING PACK LINES *                                            24363900
243640     IF RCT00001-PRRTN-FUNC-CDE = 'PKMSLN'                        24364000
243641         IF PV-LINES-MISSING = 'Y'                                24364100
243642             MOVE 'Y' TO PV-RULE-RESULT                           24364200
243643         ELSE                                                     24364300
243644             MOVE 'N' TO PV-RULE-RESULT                           24364400
243645         END-IF                                                   24364500
243646     END-IF.                                                      24364600
243647                                                                  24364700
243648* BEST CASE UNITS *                                               24364800
243649     IF RCT00001-PRRTN-FUNC-CDE = 'PKBCUN'                        24364900
243650                                                                  24365000
243651         SET PS-BEST-CASE-UNITS-YES TO TRUE                       24365100
243652         PERFORM                                                  24365200
243653           VARYING L FROM 1 BY 1                                  24365300
243654             UNTIL L > RC821-MAX-ITEM-COUNT                       24365400
243655                OR PS-BEST-CASE-UNITS-NO                          24365500
243656                                                                  24365600
243657             IF RC821-REC-LNE-NBR (L) > ZEROES                    24365700
243658               AND RC821-BEST-CASE-UNITS (L) = ZEROES             24365800
243659                 SET PS-BEST-CASE-UNITS-NO TO TRUE                24365900
243660             END-IF                                               24366000
243661                                                                  24366100
243662         END-PERFORM                                              24366200
243663                                                                  24366300
243664         IF PS-BEST-CASE-UNITS-NO                                 24366400
243665             MOVE 'Y' TO PV-RULE-RESULT                           24366500
243666         ELSE                                                     24366600
243667             MOVE 'N' TO PV-RULE-RESULT                           24366700
243668         END-IF                                                   24366800
243669     END-IF.                                                      24366900
243670                                                                  24367000
243671* PRICE EDIT *                                                    24367100
243672     IF RCT00001-PRRTN-FUNC-CDE = 'OUNPRC'                        24367200
243673                                                                  24367300
243674         MOVE ZEROES TO PV-UNIT-PRICE                             24367400
243675         PERFORM 3100-CALC-UNIT-PRICE                             24367500
243676                                                                  24367600
243677         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24367700
243678             IF PV-UNIT-PRICE >= RCT00001-PRRTN-VAL-NBR           24367800
243679                 MOVE 'Y' TO PV-RULE-RESULT                       24367900
243680             ELSE                                                 24368000
243681                 MOVE 'N' TO PV-RULE-RESULT                       24368100
243682             END-IF                                               24368200
243683         END-IF                                                   24368300
243684                                                                  24368400
243685         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24368500
243686             IF PV-UNIT-PRICE =  RCT00001-PRRTN-VAL-NBR           24368600
243687                 MOVE 'Y' TO PV-RULE-RESULT                       24368700
243688             ELSE                                                 24368800
243689                 MOVE 'N' TO PV-RULE-RESULT                       24368900
243690             END-IF                                               24369000
243691         END-IF                                                   24369100
243692                                                                  24369200
243693         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24369300
243694             IF PV-UNIT-PRICE <= RCT00001-PRRTN-VAL-NBR           24369400
243695                 MOVE 'Y' TO PV-RULE-RESULT                       24369500
243696             ELSE                                                 24369600
243697                 MOVE 'N' TO PV-RULE-RESULT                       24369700
243698             END-IF                                               24369800
243699         END-IF                                                   24369900
243700     END-IF.                                                      24370000
243701                                                                  24370100
243702                                                                  24370200
243703     IF RCT00001-PRRTN-FUNC-CDE = 'OPKPRC'                        24370300
243704                                                                  24370400
243705         MOVE ZEROES TO PV-UNIT-PRICE                             24370500
243706                        PV-PACK-PRICE                             24370600
243707         PERFORM 3110-CALC-PACK-UNIT-PRICE                        24370700
243708                                                                  24370800
243709         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24370900
243710             IF PV-PACK-PRICE >= RCT00001-PRRTN-VAL-NBR           24371000
243711                 MOVE 'Y' TO PV-RULE-RESULT                       24371100
243712             ELSE                                                 24371200
243713                 MOVE 'N' TO PV-RULE-RESULT                       24371300
243714             END-IF                                               24371400
243715         END-IF                                                   24371500
243716                                                                  24371600
243717         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24371700
243718             IF PV-PACK-PRICE =  RCT00001-PRRTN-VAL-NBR           24371800
243719                 MOVE 'Y' TO PV-RULE-RESULT                       24371900
243720             ELSE                                                 24372000
243721                 MOVE 'N' TO PV-RULE-RESULT                       24372100
243722             END-IF                                               24372200
243723         END-IF                                                   24372300
243724                                                                  24372400
243725         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24372500
243726             IF PV-PACK-PRICE <= RCT00001-PRRTN-VAL-NBR           24372600
243727                 MOVE 'Y' TO PV-RULE-RESULT                       24372700
243728             ELSE                                                 24372800
243729                 MOVE 'N' TO PV-RULE-RESULT                       24372900
243730             END-IF                                               24373000
243731         END-IF                                                   24373100
243732     END-IF.                                                      24373200
243733                                                                  24373300
243734* PERCENTAGE EDIT *                                               24373400
243735     IF RCT00001-PRRTN-FUNC-CDE = 'OUNPCT'                        24373500
243736                                                                  24373600
243737         MOVE ZEROES TO PV-TOT-RECEIVED                           24373700
243738                        PV-TOT-PLAN                               24373800
243739                        PV-UNIT-PERCENT                           24373900
243740                        PV-RATIO                                  24374000
243741         PERFORM 4000-PERCENT-OVER-SHORT                          24374100
243742                                                                  24374200
243743         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24374300
243744             IF PV-RATIO >= RCT00001-PRRTN-VAL-NBR                24374400
243745                 MOVE 'Y' TO PV-RULE-RESULT                       24374500
243746             ELSE                                                 24374600
243747                 MOVE 'N' TO PV-RULE-RESULT                       24374700
243748             END-IF                                               24374800
243749         END-IF                                                   24374900
243750                                                                  24375000
243751         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24375100
243752             IF PV-RATIO =  RCT00001-PRRTN-VAL-NBR                24375200
243753                 MOVE 'Y' TO PV-RULE-RESULT                       24375300
243754             ELSE                                                 24375400
243755                 MOVE 'N' TO PV-RULE-RESULT                       24375500
243756             END-IF                                               24375600
243757         END-IF                                                   24375700
243758                                                                  24375800
243759         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24375900
243760             IF PV-RATIO <= RCT00001-PRRTN-VAL-NBR                24376000
243761                 MOVE 'Y' TO PV-RULE-RESULT                       24376100
243762             ELSE                                                 24376200
243763                 MOVE 'N' TO PV-RULE-RESULT                       24376300
243764             END-IF                                               24376400
243765         END-IF                                                   24376500
243766     END-IF.                                                      24376600
243767                                                                  24376700
243768                                                                  24376800
243769     IF RCT00001-PRRTN-FUNC-CDE = 'OPKPCT'                        24376900
243770                                                                  24377000
243771         MOVE ZEROES TO PV-TOT-RECEIVED                           24377100
243772                        PV-TOT-PLAN                               24377200
243773                        PV-UNIT-PERCENT                           24377300
243774                        PV-RATIO                                  24377400
243775                        PV-TOTAL-LINE-OTR-UNITS                   24377500
243776         PERFORM 4000-PERCENT-OVER-SHORT                          24377600
243777                                                                  24377700
243778         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24377800
243779             IF PV-RATIO >= RCT00001-PRRTN-VAL-NBR                24377900
243780                 MOVE 'Y' TO PV-RULE-RESULT                       24378000
243781             ELSE                                                 24378100
243782                 MOVE 'N' TO PV-RULE-RESULT                       24378200
243783             END-IF                                               24378300
243784         END-IF                                                   24378400
243785                                                                  24378500
243786         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24378600
243787             IF PV-RATIO =  RCT00001-PRRTN-VAL-NBR                24378700
243788                 MOVE 'Y' TO PV-RULE-RESULT                       24378800
243789             ELSE                                                 24378900
243790                 MOVE 'N' TO PV-RULE-RESULT                       24379000
243791             END-IF                                               24379100
243792         END-IF                                                   24379200
243793                                                                  24379300
243794         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24379400
243795             IF PV-RATIO <= RCT00001-PRRTN-VAL-NBR                24379500
243796                 MOVE 'Y' TO PV-RULE-RESULT                       24379600
243797             ELSE                                                 24379700
243798                 MOVE 'N' TO PV-RULE-RESULT                       24379800
243799             END-IF                                               24379900
243800         END-IF                                                   24380000
243801     END-IF.                                                      24380100
243802                                                                  24380200
243803                                                                  24380300
243804     IF RCT00001-PRRTN-FUNC-CDE = 'LNSHRT'                        24380400
243805                                                                  24380500
243806         MOVE ZEROES TO PV-TOT-RECEIVED                           24380600
243807                        PV-TOT-PLAN                               24380700
243808                        PV-UNIT-PERCENT                           24380800
243809                        PV-RATIO                                  24380900
243810         PERFORM 4000-PERCENT-OVER-SHORT                          24381000
243811                                                                  24381100
243812         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24381200
243813             IF PV-RATIO >= RCT00001-PRRTN-VAL-NBR                24381300
243814                 MOVE 'Y' TO PV-RULE-RESULT                       24381400
243815             ELSE                                                 24381500
243816                 MOVE 'N' TO PV-RULE-RESULT                       24381600
243817             END-IF                                               24381700
243818         END-IF                                                   24381800
243819                                                                  24381900
243820         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24382000
243821             IF PV-RATIO =  RCT00001-PRRTN-VAL-NBR                24382100
243822                 MOVE 'Y' TO PV-RULE-RESULT                       24382200
243823             ELSE                                                 24382300
243824                 MOVE 'N' TO PV-RULE-RESULT                       24382400
243825             END-IF                                               24382500
243826         END-IF                                                   24382600
243827                                                                  24382700
243828         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24382800
243829             IF PV-RATIO <= RCT00001-PRRTN-VAL-NBR                24382900
243830                 MOVE 'Y' TO PV-RULE-RESULT                       24383000
243831             ELSE                                                 24383100
243832                 MOVE 'N' TO PV-RULE-RESULT                       24383200
243833             END-IF                                               24383300
243834         END-IF                                                   24383400
243835     END-IF.                                                      24383500
243836                                                                  24383600
243837                                                                  24383700
243838     IF RCT00001-PRRTN-FUNC-CDE = 'PKSHRT'                        24383800
243839                                                                  24383900
243840         MOVE ZEROES TO PV-TOT-RECEIVED                           24384000
243841                        PV-TOT-PLAN                               24384100
243842                        PV-UNIT-PERCENT                           24384200
243843                        PV-RATIO                                  24384300
243844                        PV-TOTAL-LINE-OTR-UNITS                   24384400
243845         PERFORM 4000-PERCENT-OVER-SHORT                          24384500
243846                                                                  24384600
243847         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24384700
243848             IF PV-RATIO >= RCT00001-PRRTN-VAL-NBR                24384800
243849                 MOVE 'Y' TO PV-RULE-RESULT                       24384900
243850             ELSE                                                 24385000
243851                 MOVE 'N' TO PV-RULE-RESULT                       24385100
243852             END-IF                                               24385200
243853         END-IF                                                   24385300
243854                                                                  24385400
243855         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24385500
243856             IF PV-RATIO =  RCT00001-PRRTN-VAL-NBR                24385600
243857                 MOVE 'Y' TO PV-RULE-RESULT                       24385700
243858             ELSE                                                 24385800
243859                 MOVE 'N' TO PV-RULE-RESULT                       24385900
243860             END-IF                                               24386000
243861         END-IF                                                   24386100
243862                                                                  24386200
243863         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24386300
243864             IF PV-RATIO <= RCT00001-PRRTN-VAL-NBR                24386400
243865                 MOVE 'Y' TO PV-RULE-RESULT                       24386500
243866             ELSE                                                 24386600
243867                 MOVE 'N' TO PV-RULE-RESULT                       24386700
243868             END-IF                                               24386800
243869         END-IF                                                   24386900
243870     END-IF.                                                      24387000
243871                                                                  24387100
243872* AVERAGE EDIT *                                                  24387200
243873     IF RCT00001-PRRTN-FUNC-CDE = 'OUNAVG'                        24387300
243874                                                                  24387400
243875         MOVE ZEROES TO PV-TOT-RECEIVED                           24387500
243876                        PV-UNIT-AVERAGE                           24387600
243877         PERFORM 3300-CALC-UNIT-AVERAGE                           24387700
243878                                                                  24387800
243879         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24387900
243880             IF PV-UNIT-AVERAGE >= RCT00001-PRRTN-VAL-NBR         24388000
243881                 MOVE 'Y' TO PV-RULE-RESULT                       24388100
243882             ELSE                                                 24388200
243883                 MOVE 'N' TO PV-RULE-RESULT                       24388300
243884             END-IF                                               24388400
243885         END-IF                                                   24388500
243886                                                                  24388600
243887         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24388700
243888             IF PV-UNIT-AVERAGE =  RCT00001-PRRTN-VAL-NBR         24388800
243889                 MOVE 'Y' TO PV-RULE-RESULT                       24388900
243890             ELSE                                                 24389000
243891                 MOVE 'N' TO PV-RULE-RESULT                       24389100
243892             END-IF                                               24389200
243893         END-IF                                                   24389300
243894                                                                  24389400
243895         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24389500
243896             IF PV-UNIT-AVERAGE <= RCT00001-PRRTN-VAL-NBR         24389600
243897                 MOVE 'Y' TO PV-RULE-RESULT                       24389700
243898             ELSE                                                 24389800
243899                 MOVE 'N' TO PV-RULE-RESULT                       24389900
243900             END-IF                                               24390000
243901         END-IF                                                   24390100
243902     END-IF.                                                      24390200
243903                                                                  24390300
243904                                                                  24390400
243905     IF RCT00001-PRRTN-FUNC-CDE = 'OPKAVG'                        24390500
243906                                                                  24390600
243907         MOVE ZEROES TO PV-TOT-RECEIVED                           24390700
243908                        PV-UNIT-AVERAGE                           24390800
243909         PERFORM 3310-CALC-PACK-AVERAGE                           24390900
243910                                                                  24391000
243911         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24391100
243912             IF PV-UNIT-AVERAGE >= RCT00001-PRRTN-VAL-NBR         24391200
243913                 MOVE 'Y' TO PV-RULE-RESULT                       24391300
243914             ELSE                                                 24391400
243915                 MOVE 'N' TO PV-RULE-RESULT                       24391500
243916             END-IF                                               24391600
243917         END-IF                                                   24391700
243918                                                                  24391800
243919         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24391900
243920             IF PV-UNIT-AVERAGE =  RCT00001-PRRTN-VAL-NBR         24392000
243921                 MOVE 'Y' TO PV-RULE-RESULT                       24392100
243922             ELSE                                                 24392200
243923                 MOVE 'N' TO PV-RULE-RESULT                       24392300
243924             END-IF                                               24392400
243925         END-IF                                                   24392500
243926                                                                  24392600
243927         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24392700
243928             IF PV-UNIT-AVERAGE <= RCT00001-PRRTN-VAL-NBR         24392800
243929                 MOVE 'Y' TO PV-RULE-RESULT                       24392900
243930             ELSE                                                 24393000
243931                 MOVE 'N' TO PV-RULE-RESULT                       24393100
243932             END-IF                                               24393200
243933         END-IF                                                   24393300
243934     END-IF.                                                      24393400
243935                                                                  24393500
243936* CHECK FOR BAD STORE ALLOCATION *                                24393600
243937     IF RCT00001-PRRTN-FUNC-CDE = 'BDSTAL'                        24393700
243938         SET PS-BAD-PACK-RATIO-NO TO TRUE                         24393800
243939         PERFORM 3400-CHECK-STR-PLAN                              24393900
243940         IF PS-BAD-PACK-RATIO-YES                                 24394000
243941             MOVE 'Y' TO PV-RULE-RESULT                           24394100
243942         ELSE                                                     24394200
243943             MOVE 'N' TO PV-RULE-RESULT                           24394300
243944         END-IF                                                   24394400
243945     END-IF.                                                      24394500
243946                                                                  24394600
243947                                                                  24394700
243948********************                                              24394800
243949* UNKNOWN FUNCTION *                                              24394900
243950********************                                              24395000
243951     IF PV-RULE-RESULT NOT > SPACES                               24395100
243952         MOVE '*** UNKNOWN FUNCTION CODE ***' TO RC001-SPECIAL-1  24395200
243953         STRING '   FUNCTION = '        DELIMITED BY SIZE         24395300
243954                RCT00001-PRRTN-FUNC-CDE DELIMITED BY SIZE         24395400
243955                                            INTO RC001-SPECIAL-2  24395500
243956         SET PS-DONE-YES TO TRUE                                  24395600
243957         MOVE SPACES     TO TM501-TM500-RETURN-MSG                24395700
243958         MOVE '3000'     TO TM501-PARA                            24395800
243959         MOVE '823'      TO TM501-PGM                             24395900
243960         MOVE SQLCODE    TO TM500-SQLCODE                         24396000
243961         MOVE SQLCA      TO TM500-SQLCA                           24396100
243962         MOVE 67         TO TM501-PRORATION-ERROR-NBR             24396200
243963         PERFORM TM501-SET-TM500-RETURN-MSG                       24396300
243964         PERFORM RC001-RETURN-MSG                                 24396400
243965     END-IF.                                                      24396500
243966                                                                  24396600
243967******************************************************************24396700
243968******************************************************************24396800
243969 3100-CALC-UNIT-PRICE.                                            24396900
243970     MOVE '3100-CALC-UNIT-PRICE          ' TO RC001-PARAGRAPH.    24397000
243971                                                                  24397100
243972     PERFORM                                                      24397200
243973       VARYING L FROM 1 BY 1                                      24397300
243974         UNTIL L > RC821-ITEM-COUNT                               24397400
243975                                                                  24397500
243976         IF RC821-PO-GP-QTY (L) > 1                               24397600
243977             COMPUTE PV-UNIT-PRICE =                              24397700
243978                     RC821-PO-GP-RTL-AMT (L)                      24397800
243979                   / RC821-PO-GP-QTY (L)                          24397900
243980         ELSE                                                     24398000
243981             COMPUTE PV-UNIT-PRICE =                              24398100
243982                     RC821-PO-UNT-RTL-PR-AMT (L)                  24398200
243983         END-IF                                                   24398300
243984                                                                  24398400
243985     END-PERFORM.                                                 24398500
243986                                                                  24398600
243987******************************************************************24398700
243988 3110-CALC-PACK-UNIT-PRICE.                                       24398800
243989     MOVE '3110-CALC-PACK-UNIT-PRICE     ' TO RC001-PARAGRAPH.    24398900
243990                                                                  24399000
243991     PERFORM                                                      24399100
243992       VARYING L FROM 1 BY 1                                      24399200
243993         UNTIL L > RC821-ITEM-COUNT                               24399300
243994                                                                  24399400
243995         IF RC821-PO-GP-QTY (L) > 1                               24399500
243996             COMPUTE PV-UNIT-PRICE = RC821-PO-GP-RTL-AMT (L)      24399600
243997                                   / RC821-PO-GP-QTY (L)          24399700
243998         ELSE                                                     24399800
243999             COMPUTE PV-UNIT-PRICE =                              24399900
244000                                   RC821-PO-UNT-RTL-PR-AMT (L)    24400000
244001         END-IF                                                   24400100
244002                                                                  24400200
244003         IF PV-UNIT-PRICE > PV-PACK-PRICE                         24400300
244004             MOVE PV-UNIT-PRICE TO PV-PACK-PRICE                  24400400
244005         END-IF                                                   24400500
244006                                                                  24400600
244007     END-PERFORM.                                                 24400700
244008                                                                  24400800
244009******************************************************************24400900
244010 3300-CALC-UNIT-AVERAGE.                                          24401000
244011     MOVE '3300-CALC-UNIT-AVERAGE        ' TO RC001-PARAGRAPH.    24401100
244012                                                                  24401200
244013     PERFORM                                                      24401300
244014       VARYING L FROM 1 BY 1                                      24401400
244015         UNTIL L > RC821-ITEM-COUNT                               24401500
244016                                                                  24401600
244017         IF RC821-DTL-CK-ITM-QTY (L) > +0                         24401700
244018             COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED            24401800
244019                                     + RC821-DTL-CK-ITM-QTY (L)   24401900
244020         ELSE                                                     24402000
244021             COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED            24402100
244022                                     + RC821-PKSL-ITM-QTY (L)     24402200
244023         END-IF                                                   24402300
244024     END-PERFORM.                                                 24402400
244025                                                                  24402500
244026     MOVE ZEROES TO PV-NEW-STR-CNT                                24402600
244027                    PV-OLD-STR-CNT                                24402700
244028                    PV-CS-STR-CNT                                 24402800
244029                    PV-OVRG-STR-CNT.                              24402900
244030                                                                  24403000
244031     PERFORM                                                      24403100
244032       VARYING L FROM 1 BY 1                                      24403200
244033         UNTIL L > RC821-MAX-STR-COUNT                            24403300
244034                                                                  24403400
244035         IF RC821-STR-NBR (L) > ZEROES                            24403500
244036             IF RC821-ST-TYPE-CODE (L) = 'CS'                     24403600
244037                 ADD 1 TO PV-CS-STR-CNT                           24403700
244038             ELSE                                                 24403800
244039                 IF RC821-EXISTING-STORE-CDE (L) = '1'            24403900
244040                     ADD 1 TO PV-OLD-STR-CNT                      24404000
244041                 ELSE                                             24404100
244042                     ADD 1 TO PV-NEW-STR-CNT                      24404200
244043                 END-IF                                           24404300
244044             END-IF                                               24404400
244045         END-IF                                                   24404500
244046     END-PERFORM.                                                 24404600
244047                                                                  24404700
244048     IF PV-OLD-STR-CNT > ZEROES                                   24404800
244049         MOVE PV-OLD-STR-CNT TO PV-OVRG-STR-CNT                   24404900
244050     ELSE                                                         24405000
244051         IF PV-NEW-STR-CNT > ZEROES                               24405100
244052             MOVE PV-NEW-STR-CNT TO PV-OVRG-STR-CNT               24405200
244053         ELSE                                                     24405300
244054             MOVE PV-CS-STR-CNT  TO PV-OVRG-STR-CNT               24405400
244055         END-IF                                                   24405500
244056     END-IF.                                                      24405600
244057                                                                  24405700
244058     IF PV-OVRG-STR-CNT NOT > ZEROES                              24405800
244059         MOVE 1 TO PV-OVRG-STR-CNT                                24405900
244060     END-IF.                                                      24406000
244061                                                                  24406100
244062     COMPUTE PV-UNIT-AVERAGE = (PV-TOT-RECEIVED                   24406200
244063                             - RC821-SUM-STR-OTR-QTY)             24406300
244064                             / PV-OVRG-STR-CNT.                   24406400
244065                                                                  24406500
244066******************************************************************24406600
244067 3310-CALC-PACK-AVERAGE.                                          24406700
244068     MOVE '3310-CALC-PACK-AVERAGE        ' TO RC001-PARAGRAPH.    24406800
244069                                                                  24406900
244070     PERFORM                                                      24407000
244071       VARYING L FROM 1 BY 1                                      24407100
244072         UNTIL L > RC821-ITEM-COUNT                               24407200
244073                                                                  24407300
244074         COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED                24407400
244075                                 + RC821-BEST-CASE-UNITS (L)      24407500
244076                                                                  24407600
244077         COMPUTE PV-TOT-OTR = PV-TOT-OTR                          24407700
244078                            + RC821-ITEM-OTR-QTY (L)              24407800
244079                                                                  24407900
244080     END-PERFORM.                                                 24408000
244081                                                                  24408100
244082     MOVE ZEROES TO PV-NEW-STR-CNT                                24408200
244083                    PV-OLD-STR-CNT                                24408300
244084                    PV-CS-STR-CNT                                 24408400
244085                    PV-OVRG-STR-CNT.                              24408500
244086                                                                  24408600
244087     PERFORM                                                      24408700
244088       VARYING L FROM 1 BY 1                                      24408800
244089         UNTIL L > RC821-MAX-STR-COUNT                            24408900
244090                                                                  24409000
244091         IF RC821-STR-NBR (L) > ZEROES                            24409100
244092             IF RC821-ST-TYPE-CODE (L) = 'CS'                     24409200
244093                 ADD 1 TO PV-CS-STR-CNT                           24409300
244094             ELSE                                                 24409400
244095                 IF RC821-EXISTING-STORE-CDE (L) = '1'            24409500
244096                     ADD 1 TO PV-OLD-STR-CNT                      24409600
244097                 ELSE                                             24409700
244098                     ADD 1 TO PV-NEW-STR-CNT                      24409800
244099                 END-IF                                           24409900
244100             END-IF                                               24410000
244101         END-IF                                                   24410100
244102     END-PERFORM.                                                 24410200
244103                                                                  24410300
244104     IF PV-OLD-STR-CNT > ZEROES                                   24410400
244105         MOVE PV-OLD-STR-CNT TO PV-OVRG-STR-CNT                   24410500
244106     ELSE                                                         24410600
244107         IF PV-NEW-STR-CNT > ZEROES                               24410700
244108             MOVE PV-NEW-STR-CNT TO PV-OVRG-STR-CNT               24410800
244109         ELSE                                                     24410900
244110             MOVE PV-CS-STR-CNT  TO PV-OVRG-STR-CNT               24411000
244111         END-IF                                                   24411100
244112     END-IF.                                                      24411200
244113                                                                  24411300
244114     IF PV-OVRG-STR-CNT NOT > ZEROES                              24411400
244115         MOVE 1 TO PV-OVRG-STR-CNT                                24411500
244116     END-IF.                                                      24411600
244117                                                                  24411700
244118     COMPUTE PV-UNIT-AVERAGE = (PV-TOT-RECEIVED                   24411800
244119                             - PV-TOT-OTR)                        24411900
244120                             / PV-OVRG-STR-CNT.                   24412000
244121                                                                  24412100
244122******************************************************************24412200
244123 3400-CHECK-STR-PLAN.                                             24412300
244124     MOVE '3400-CHECK-STR-PLAN           ' TO RC001-PARAGRAPH.    24412400
244125                                                                  24412500
244126     PERFORM                                                      24412600
244127       VARYING L FROM 1 BY 1                                      24412700
244128         UNTIL L > RC821-MAX-STR-COUNT                            24412800
244129            OR RC821-STR-NBR (L) NOT > ZEROES                     24412900
244130            OR PS-BAD-PACK-RATIO-YES                              24413000
244131                                                                  24413100
244132         IF RC821-STR-VAL-OOR-IND (L) = 'N'                       24413200
244133           OR RC821-STR-GOOD-PLAN-IND (L) = 'N'                   24413300
244134             SET PS-BAD-PACK-RATIO-YES TO TRUE                    24413400
244135         END-IF                                                   24413500
244136                                                                  24413600
244137     END-PERFORM.                                                 24413700
244138                                                                  24413800
244139******************************************************************24413900
244140 3500-CHECK-STR-PACK.                                             24414000
244141     MOVE '3500-CHECK-STR-PACK           ' TO RC001-PARAGRAPH.    24414100
244142                                                                  24414200
244143     PERFORM                                                      24414300
244144       VARYING L FROM 1 BY 1                                      24414400
244145         UNTIL L > RC821-MAX-STR-COUNT                            24414500
244146            OR RC821-STR-NBR (L) NOT > ZEROES                     24414600
244147            OR PS-BAD-INNER-PACK-YES                              24414700
244148                                                                  24414800
244149         DIVIDE PV-DISPERSAL-QTY                                  24414900
244150           INTO RC821-STR-DISTRO-QTY (L)                          24415000
244151         GIVING PV-PACKS-PLANNED  REMAINDER PV-REMAINDER          24415100
244152         IF PV-REMAINDER > ZEROES                                 24415200
244153             SET PS-BAD-INNER-PACK-YES TO TRUE                    24415300
244154         END-IF                                                   24415400
244155                                                                  24415500
244156     END-PERFORM.                                                 24415600
244157                                                                  24415700
244158******************************************************************24415800
244159* COMMON ROUTINE USED TO CALCULATE OVER/SHORT PERCENTAGE          24415900
244160******************************************************************24416000
244161 4000-PERCENT-OVER-SHORT.                                         24416100
244162     MOVE '4000-PERCENT-OVER-SHORT       ' TO RC001-PARAGRAPH.    24416200
244163                                                                  24416300
244164     MOVE ZEROES TO PV-TOT-RECEIVED                               24416400
244165                    PV-TOT-PLAN.                                  24416500
244166                                                                  24416600
244167     PERFORM                                                      24416700
244168       VARYING PV-ITEM-IDX FROM 1 BY 1                            24416800
244169         UNTIL PV-ITEM-IDX > RC821-ITEM-COUNT                     24416900
244170                                                                  24417000
244171         IF RC821-DTL-CK-ITM-QTY(PV-ITEM-IDX) > +0                24417100
244172             COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED            24417200
244173                   + RC821-DTL-CK-ITM-QTY(PV-ITEM-IDX)            24417300
244174         ELSE                                                     24417400
244175             COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED            24417500
244176                   + RC821-PKSL-ITM-QTY(PV-ITEM-IDX)              24417600
244177         END-IF                                                   24417700
244178                                                                  24417800
244179         COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED                24417900
244180               + RC821-ITEM-DISTRO-QTY(PV-ITEM-IDX)               24418000
244181               - RC821-ITEM-DISTRO-OTR-QTY(PV-ITEM-IDX)           24418100
244182                                                                  24418200
244183         COMPUTE PV-TOT-PLAN = PV-TOT-PLAN                        24418300
244184               + RC821-ITEM-DISTRO-QTY(PV-ITEM-IDX)               24418400
244185                                                                  24418500
244186     END-PERFORM.                                                 24418600
244187                                                                  24418700
244188     IF PV-TOT-PLAN > 0                                           24418800
244189         IF PV-TOT-PLAN > PV-TOT-RECEIVED                         24418900
244190             COMPUTE PV-UNIT-PERCENT ROUNDED = (PV-TOT-PLAN       24419000
244191                                             - PV-TOT-RECEIVED)   24419100
244192                                             / PV-TOT-PLAN        24419200
244193         ELSE                                                     24419300
244194             COMPUTE PV-UNIT-PERCENT ROUNDED = (PV-TOT-RECEIVED   24419400
244195                                             - PV-TOT-PLAN)       24419500
244196                                             / PV-TOT-PLAN        24419600
244197         END-IF                                                   24419700
244198     ELSE                                                         24419800
244199         COMPUTE PV-UNIT-PERCENT = 10                             24419900
244200     END-IF.                                                      24420000
244201                                                                  24420100
244202     IF PV-UNIT-PERCENT < 10                                      24420200
244203         COMPUTE PV-RATIO = PV-UNIT-PERCENT * 100                 24420300
244204     ELSE                                                         24420400
244205         MOVE 999 TO PV-RATIO                                     24420500
244206     END-IF.                                                      24420600
244207                                                                  24420700
244208******************************************************************24420800
244209* COMMON ROUTINE USED TO CALCULATE OVER/SHORT DOLLARS             24420900
244210******************************************************************24421000
244211 4001-PERCENT-OV-SH-DOLLARS.                                      24421100
244212     MOVE '4001-PERCENT-OV-SH-DOLLARS    ' TO RC001-PARAGRAPH.    24421200
244213                                                                  24421300
244214     MOVE ZEROES TO PV-TOTAL-DOLLARS-OVER-SHORT                   24421400
244215                    PV-TOT-RECEIVED                               24421500
244216                    PV-TOT-PLAN.                                  24421600
244217                                                                  24421700
244218     PERFORM                                                      24421800
244219       VARYING PV-ITEM-IDX FROM 1 BY 1                            24421900
244220         UNTIL PV-ITEM-IDX > RC821-ITEM-COUNT                     24422000
244221                                                                  24422100
244222         MOVE ZEROES TO PV-TOT-RECEIVED                           24422200
244223                        PV-TOT-PLAN                               24422300
244224                                                                  24422400
244225         IF RC821-DTL-CK-ITM-QTY(PV-ITEM-IDX) > +0                24422500
244226             COMPUTE PV-ITM-RECEIVED =                            24422600
244227                     RC821-DTL-CK-ITM-QTY(PV-ITEM-IDX)            24422700
244228         ELSE                                                     24422800
244229             COMPUTE PV-ITM-RECEIVED =                            24422900
244230                     RC821-PKSL-ITM-QTY(PV-ITEM-IDX)              24423000
244231         END-IF                                                   24423100
244232                                                                  24423200
244233         COMPUTE PV-TOT-RECEIVED = PV-ITM-RECEIVED                24423300
244234               + (RC821-ITEM-DISTRO-QTY(PV-ITEM-IDX)              24423400
244235               - RC821-ITEM-DISTRO-OTR-QTY(PV-ITEM-IDX))          24423500
244236                                                                  24423600
244237         MOVE RC821-ITEM-DISTRO-QTY(PV-ITEM-IDX)                  24423700
244238                                TO PV-TOT-PLAN                    24423800
244239                                                                  24423900
244240         IF RC821-PO-GP-QTY (PV-ITEM-IDX) > 1                     24424000
244241             COMPUTE PV-UNIT-PRICE =                              24424100
244242                     RC821-PO-GP-RTL-AMT (PV-ITEM-IDX)            24424200
244243                   / RC821-PO-GP-QTY  (PV-ITEM-IDX)               24424300
244244         ELSE                                                     24424400
244245             MOVE RC821-PO-UNT-RTL-PR-AMT (PV-ITEM-IDX)           24424500
244246                  TO PV-UNIT-PRICE                                24424600
244247         END-IF                                                   24424700
244248                                                                  24424800
244249         IF PV-TOT-PLAN > 0                                       24424900
244250             IF PV-TOT-PLAN > PV-TOT-RECEIVED                     24425000
244251                 COMPUTE PV-UNITS-SHORT-DOLLARS = (PV-TOT-PLAN    24425100
244252                                               - PV-TOT-RECEIVED) 24425200
244253                                               * PV-UNIT-PRICE    24425300
244254                 COMPUTE PV-TOTAL-DOLLARS-OVER-SHORT =            24425400
244255                         PV-TOTAL-DOLLARS-OVER-SHORT              24425500
244256                       - PV-UNITS-SHORT-DOLLARS                   24425600
244257             END-IF                                               24425700
244258             IF PV-TOT-PLAN < PV-TOT-RECEIVED                     24425800
244259                 COMPUTE PV-UNITS-OVER-DOLLARS = (PV-TOT-RECEIVED 24425900
244260                                               - PV-TOT-PLAN)     24426000
244261                                               * PV-UNIT-PRICE    24426100
244262                 COMPUTE PV-TOTAL-DOLLARS-OVER-SHORT =            24426200
244263                         PV-TOTAL-DOLLARS-OVER-SHORT              24426300
244264                       + PV-UNITS-OVER-DOLLARS                    24426400
244265             END-IF                                               24426500
244266         END-IF                                                   24426600
244267     END-PERFORM.                                                 24426700
244268                                                                  24426800
244269     IF PV-TOTAL-DOLLARS-OVER-SHORT < 0                           24426900
244270         COMPUTE PV-TOTAL-DOLLARS-OVER-SHORT =                    24427000
244271                 PV-TOTAL-DOLLARS-OVER-SHORT * -1                 24427100
244272     END-IF.                                                      24427200
244273                                                                  24427300
244274******************************************************************24427400
244275*                                                                *24427500
244276*         D E T A I L   T A B L E   P R O C E S S I N G          *24427600
244277*                                                                *24427700
244278******************************************************************24427800
244279 6000-PROCESS-RULE-ACTIONS.                                       24427900
244280     MOVE '6000-PROCESS-RULE-ACTIONS     ' TO RC001-PARAGRAPH.    24428000
244281                                                                  24428100
244282     MOVE PV-RULE-RESULT TO DK-RULE-RESULT.                       24428200
244283                                                                  24428300
244284     PERFORM 6100-OPEN-DETL-CURSOR.                               24428400
244285                                                                  24428500
244286     PERFORM                                                      24428600
244287       UNTIL PS-END-OF-RULE-ACT-YES                               24428700
244288                                                                  24428800
244289         PERFORM 6200-FETCH-DETL-CURSOR                           24428900
244290                                                                  24429000
244291     END-PERFORM.                                                 24429100
244292                                                                  24429200
244293     PERFORM 6300-CLOSE-DETL-CURSOR.                              24429300
244294                                                                  24429400
244295******************************************************************24429500
244296 6100-OPEN-DETL-CURSOR.                                           24429600
244297     MOVE '6100-OPEN-DETL-CURSOR         ' TO RC001-PARAGRAPH.    24429700
244298                                                                  24429800
244299     EXEC SQL                                                     24429900
244300         OPEN RULE-DETL-CSR                                       24430000
244301     END-EXEC.                                                    24430100
244302                                                                  24430200
244303     EVALUATE TRUE                                                24430300
244304       WHEN SQLCODE = ZERO                                        24430400
244305           SET PS-END-OF-RULE-ACT-NO TO TRUE                      24430500
244306                                                                  24430600
244307       WHEN OTHER                                                 24430700
244308           SET PS-DONE-YES TO TRUE                                24430800
244309           MOVE SPACES     TO TM501-TM500-RETURN-MSG              24430900
244310           MOVE '6100'     TO TM501-PARA                          24431000
244311           MOVE '823'      TO TM501-PGM                           24431100
244312           MOVE SQLCODE    TO TM500-SQLCODE                       24431200
244313           MOVE SQLCA      TO TM500-SQLCA                         24431300
244314           MOVE 68         TO TM501-PRORATION-ERROR-NBR           24431400
244315           PERFORM TM501-SET-TM500-RETURN-MSG                     24431500
244316           PERFORM RC001-RETURN-MSG                               24431600
244317     END-EVALUATE.                                                24431700
244318                                                                  24431800
244319******************************************************************24431900
244320 6200-FETCH-DETL-CURSOR.                                          24432000
244321     MOVE '6200-FETCH-DETL-CURSOR        ' TO RC001-PARAGRAPH.    24432100
244322                                                                  24432200
244323     EXEC SQL                                                     24432300
244324         FETCH RULE-DETL-CSR                                      24432400
244325          INTO :RCT00002-PRRTN-RUL-ID                             24432500
244326             , :RCT00002-PRRTN-RUL-SEQ-NBR                        24432600
244327             , :RCT00002-PRRTN-RUL-IND                            24432700
244328             , :RCT00002-PRRTN-ACTN-SEQ-NBR                       24432800
244329             , :RCT00002-TRBL-RSN-CDE :PV-NULL-IND1               24432900
244330             , :RCT00002-MSG-FMT-NBR                              24433000
244331             , :RCT00002-ACTV-IND                                 24433100
244332             , :RCT00002-ACTN-RSN-CDE                             24433200
244333             , :RCT00002-ACTN-TXT                                 24433300
244334     END-EXEC.                                                    24433400
244335                                                                  24433500
244336     EVALUATE TRUE                                                24433600
244337       WHEN SQLCODE = ZERO                                        24433700
244338           PERFORM 7000-DETERMINE-ACTION                          24433800
244339                                                                  24433900
244340       WHEN SQLCODE = +100                                        24434000
244341           SET PS-END-OF-RULE-ACT-YES TO TRUE                     24434100
244342                                                                  24434200
244343       WHEN OTHER                                                 24434300
244344           SET PS-DONE-YES TO TRUE                                24434400
244345           MOVE SPACES     TO TM501-TM500-RETURN-MSG              24434500
244346           MOVE '6200'     TO TM501-PARA                          24434600
244347           MOVE '823'      TO TM501-PGM                           24434700
244348           MOVE SQLCODE    TO TM500-SQLCODE                       24434800
244349           MOVE SQLCA      TO TM500-SQLCA                         24434900
244350           MOVE 69         TO TM501-PRORATION-ERROR-NBR           24435000
244351           PERFORM TM501-SET-TM500-RETURN-MSG                     24435100
244352           PERFORM RC001-RETURN-MSG                               24435200
244353     END-EVALUATE.                                                24435300
244354                                                                  24435400
244355******************************************************************24435500
244356 6300-CLOSE-DETL-CURSOR.                                          24435600
244357     MOVE '6300-CLOSE-DETL-CURSOR        ' TO RC001-PARAGRAPH.    24435700
244358                                                                  24435800
244359     EXEC SQL                                                     24435900
244360         CLOSE RULE-DETL-CSR                                      24436000
244361     END-EXEC.                                                    24436100
244362                                                                  24436200
244363     EVALUATE TRUE                                                24436300
244364       WHEN SQLCODE = ZERO                                        24436400
244365           CONTINUE                                               24436500
244366                                                                  24436600
244367       WHEN OTHER                                                 24436700
244368           SET PS-DONE-YES TO TRUE                                24436800
244369           MOVE SPACES     TO TM501-TM500-RETURN-MSG              24436900
244370           MOVE '6300'     TO TM501-PARA                          24437000
244371           MOVE '823'      TO TM501-PGM                           24437100
244372           MOVE SQLCODE    TO TM500-SQLCODE                       24437200
244400           MOVE SQLCA      TO TM500-SQLCA                         24440000
244500           MOVE 70         TO TM501-PRORATION-ERROR-NBR           24450000
244600           PERFORM TM501-SET-TM500-RETURN-MSG                     24460000
244700           PERFORM RC001-RETURN-MSG                               24470000
244800     END-EVALUATE.                                                24480000
244900                                                                  24490000
245000******************************************************************24500000
245100*                                                                *24510000
245200*     D E T E R M I N E   A C T I O N   P R O C E S S I N G      *24520000
245300*                                                                *24530000
245400******************************************************************24540000
245500 7000-DETERMINE-ACTION.                                           24550000
245600     MOVE '7000-DETERMINE-ACTION         ' TO RC001-PARAGRAPH.    24560000
245700                                                                  24570000
245800*RULE ACTION = 'RULE' (READ NEXT RULE)                            24580000
245900     IF RCT00002-ACTN-RSN-CDE = 'RULE    '                        24590000
246000         MOVE RCT00002-ACTN-TXT(1:4) TO PV-RULE-SEQ               24600000
246100     END-IF.                                                      24610000
246200                                                                  24620000
246300*RULE ACTION = 'END   ' (NO ACTION REQUIRED)                      24630000
246400     IF RCT00002-ACTN-RSN-CDE = 'END     '                        24640000
246500         CONTINUE                                                 24650000
246600     END-IF.                                                      24660000
246700                                                                  24670000
246800*RULE ACTION = 'NOPROR' (DO NOT DO PRORATION)                     24680000
246900     IF RCT00002-ACTN-RSN-CDE = 'NOPROR  '                        24690000
247000         MOVE 'N' TO RC823-DO-ALLOC-IND                           24700000
247100***      SET TM500-DIDNT-ALLOC-DUE-TO-TRBL TO TRUE                24710000
247200*10/13/03 - STOP ONCE A RULE IS DONE PROCESSING.                  24720000
247300         SET PS-RULE-DONE-YES TO TRUE                             24730000
247400     END-IF.                                                      24740000
247500                                                                  24750000
247600*RULE ACTION = 'NOTIFY' / 'TROUBLE' (CREATE TROUBLE)              24760000
247700     IF RCT00002-ACTN-RSN-CDE = 'TROUBLE ' OR 'NOTIFY  '          24770000
247800       IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'S'                24780000
247900         PERFORM                                                  24790000
248000           VARYING RC821-ITEM-IDX FROM 1 BY 1                     24800000
248100            UNTIL RC821-REC-LNE-NBR (RC821-ITEM-IDX) = 0          24810000
248200               OR RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT           24820000
248300                 PERFORM 8000-CREATE-TROUBLE                      24830000
248400         END-PERFORM                                              24840000
248500       ELSE                                                       24850000
248600             PERFORM 8000-CREATE-TROUBLE                          24860000
248700       END-IF                                                     24870000
248800     END-IF.                                                      24880000
248900                                                                  24890000
249000*RULE ACTION = 'RESOLVE' (RESOLVE THE TROUBLE)                    24900000
249100     IF RCT00002-ACTN-RSN-CDE = 'RESOLVE '                        24910000
249200       IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'S'                24920000
249300         PERFORM                                                  24930000
249400           VARYING RC821-ITEM-IDX FROM 1 BY 1                     24940000
249500            UNTIL RC821-REC-LNE-NBR (RC821-ITEM-IDX) = 0          24950000
249600               OR RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT           24960000
249700                 PERFORM 8100-RESOLVE-TROUBLE                     24970000
249800         END-PERFORM                                              24980000
249900       ELSE                                                       24990000
250000             PERFORM 8100-RESOLVE-TROUBLE                         25000000
250100       END-IF                                                     25010000
250200     END-IF.                                                      25020000
250300                                                                  25030000
250400*INVALID ACTION REQUEST.                                          25040000
250500     IF RCT00002-ACTN-RSN-CDE = 'RULE    '                        25050000
250600       OR RCT00002-ACTN-RSN-CDE = 'END     '                      25060000
250700       OR RCT00002-ACTN-RSN-CDE = 'NOPROR  '                      25070000
250800       OR RCT00002-ACTN-RSN-CDE = 'TROUBLE '                      25080000
250900       OR RCT00002-ACTN-RSN-CDE = 'NOTIFY  '                      25090000
251000       OR RCT00002-ACTN-RSN-CDE = 'RESOLVE '                      25100000
251100         CONTINUE                                                 25110000
251200     ELSE                                                         25120000
251300         SET PS-DONE-YES TO TRUE                                  25130000
251400         MOVE SPACES     TO TM501-TM500-RETURN-MSG                25140000
251500         MOVE '7000'     TO TM501-PARA                            25150000
251600         MOVE '823'      TO TM501-PGM                             25160000
251700         MOVE SQLCODE    TO TM500-SQLCODE                         25170000
251800         MOVE SQLCA      TO TM500-SQLCA                           25180000
251900         MOVE 71         TO TM501-PRORATION-ERROR-NBR             25190000
252000         PERFORM TM501-SET-TM500-RETURN-MSG                       25200000
252100         PERFORM RC001-RETURN-MSG                                 25210000
252200     END-IF.                                                      25220000
252300                                                                  25230000
252400******************************************************************25240000
252500*                                                                *25250000
252600*         C R E A T E   T R O U B L E   M E S S A G E S          *25260000
252700*                                                                *25270000
252800******************************************************************25280000
252900 8000-CREATE-TROUBLE.                                             25290000
253000     MOVE '8000-CREATE-TROUBLE           ' TO RC001-PARAGRAPH.    25300000
253700                                                                  25370000
253800     MOVE RCT00002-TRBL-RSN-CDE TO TM500-TRBL-RSN-CDE.            25380000
253900     EXEC SQL                                                     25390000
254000         SELECT NOTIF_IND                                         25400000
254100           INTO :TRBRSN-NOTIF-IND                                 25410000
254200           FROM TTRBRSN                                           25420000
254300          WHERE TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE                25430000
254400     END-EXEC.                                                    25440000
254500                                                                  25450000
254600     EVALUATE SQLCODE                                             25460000
254700       WHEN +0                                                    25470000
254800           CONTINUE                                               25480000
254900                                                                  25490000
255000       WHEN OTHER                                                 25500000
255100           SET PS-DONE-YES      TO TRUE                           25510000
255200           MOVE SPACES          TO TM501-TM500-RETURN-MSG         25520000
255300           MOVE '8000'          TO TM501-PARA                     25530000
255400           MOVE '823'           TO TM501-PGM                      25540000
255500           MOVE SQLCODE         TO TM500-SQLCODE                  25550000
255600           MOVE SQLCA           TO TM500-SQLCA                    25560000
255700           MOVE 100             TO TM501-PRORATION-ERROR-NBR      25570000
255800           PERFORM TM501-SET-TM500-RETURN-MSG                     25580000
255900           PERFORM RC001-RETURN-MSG                               25590000
256000     END-EVALUATE.                                                25600000
256010                                                                  25601000
256011*** TROUBLES 379 AND 406 LINE NBR AND PACK ID ARE SAVED           25601100
256012*** IN PARAGRAPH 1510                                             25601200
256013     IF TM500-TRBL-RSN-CDE = PC-379 OR PC-406                     25601300
256014         CONTINUE                                                 25601400
256015     ELSE                                                         25601500
256020         MOVE TM500-PO-LNE-NBR  TO SAVE-TM500-PO-LNE-NBR          25602000
256030         MOVE TM500-PREPK-ID    TO SAVE-TM500-PREPK-ID            25603000
256040     END-IF.                                                      25604000
256060     MOVE TM500-PROCESS-IND     TO SAVE-TM500-PROCESS-IND.        25606000
256100                                                                  25610000
256110     MOVE 'CRA'                 TO TM500-PROCESS-IND.             25611000
256200     SET TM500-CREATE           TO TRUE.                          25620000
256300     SET TM500-ADD-DETAILS      TO TRUE.                          25630000
256400     IF TRBRSN-NOTIF-IND = 'T'                                    25640000
256500         SET TM500-IN-TROUBLE   TO TRUE                           25650000
256600     END-IF.                                                      25660000
256700                                                                  25670000
256800     MOVE RC821-DEPT-NBR        TO TM500-DEPT-NBR.                25680000
256900     MOVE 'RCKCS823'            TO TM500-CRE-UID.                 25690000
257000                                                                  25700000
257010     IF TM500-TRBL-RSN-CDE = PC-379 OR PC-406                     25701000
257020         PERFORM 8004-379-406-TRBL                                25702000
257030     ELSE                                                         25703000
257031         PERFORM 8002-NON-379-406-TRBL                            25703100
257040     END-IF.                                                      25704000
258800                                                                  25880000
258900     PERFORM 8010-DETERMINE-MSG-TEXT.                             25890000
259000                                                                  25900000
259100     EXEC CICS                                                    25910000
259200         LINK PROGRAM  (PC-TMKCS521)                              25920000
259300              COMMAREA (TM500-FIELDS)                             25930000
259400              LENGTH   (PC-600)                                   25940000
259500     END-EXEC.                                                    25950000
259600                                                                  25960000
259700     EVALUATE TRUE                                                25970000
259800       WHEN TM500-CALL-SUCCESSFUL                                 25980000
259900       WHEN TM500-TTRBNTF-UPDATE-NOT-FND                          25990000
260000       WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                         26000000
260100           MOVE SAVE-TM500-PO-LNE-NBR  TO TM500-PO-LNE-NBR        26010000
260200           MOVE SAVE-TM500-PREPK-ID    TO TM500-PREPK-ID          26020000
260300           MOVE SAVE-TM500-PROCESS-IND TO TM500-PROCESS-IND       26030000
260400                                                                  26040000
260500       WHEN TM500-CREATE AND TM500-DUPLICATE-TROUBLE              26050000
260600*JPL     AND (TM500-TRBL-RSN-CDE = PC-133 OR                      26060000
260700*JPL          TM500-TRBL-RSN-CDE = PC-134 OR                      26070000
260800*JPL          TM500-TRBL-RSN-CDE = PC-135 OR                      26080000
260900*JPL          TM500-TRBL-RSN-CDE = PC-136)                        26090000
261000           MOVE SAVE-TM500-PO-LNE-NBR  TO TM500-PO-LNE-NBR        26100000
261100           MOVE SAVE-TM500-PREPK-ID    TO TM500-PREPK-ID          26110000
261200           MOVE SAVE-TM500-PROCESS-IND TO TM500-PROCESS-IND       26120000
261300                                                                  26130000
261400       WHEN OTHER                                                 26140000
261500           MOVE SAVE-TM500-PO-LNE-NBR  TO TM500-PO-LNE-NBR        26150000
261600           MOVE SAVE-TM500-PREPK-ID    TO TM500-PREPK-ID          26160000
261700           MOVE SAVE-TM500-PROCESS-IND TO TM500-PROCESS-IND       26170000
261800                                                                  26180000
261900           SET PS-DONE-YES TO TRUE                                26190000
262000           MOVE SPACES     TO TM501-TM500-RETURN-MSG              26200000
262100           MOVE '8000'     TO TM501-PARA                          26210000
262200           MOVE '823'      TO TM501-PGM                           26220000
262300           MOVE SQLCODE    TO TM500-SQLCODE                       26230000
262400           MOVE SQLCA      TO TM500-SQLCA                         26240000
262500           MOVE 72         TO TM501-PRORATION-ERROR-NBR           26250000
262600           PERFORM TM501-SET-TM500-RETURN-MSG                     26260000
262700           PERFORM RC001-RETURN-MSG                               26270000
262800     END-EVALUATE.                                                26280000
262900                                                                  26290000
262901 8002-NON-379-406-TRBL.                                           26290100
262910     IF (RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'K' OR 'S')         26291000
262920         MOVE RC821-REC-LNE-NBR (RC821-ITEM-IDX)                  26292000
262930                                TO TM500-PO-LNE-NBR               26293000
262940         MOVE ZERO              TO TM500-PREPK-ID                 26294000
262950         SET TM500-LINE-LEVEL   TO TRUE                           26295000
262960         IF TRBRSN-NOTIF-IND = 'T'                                26296000
262970             ADD 1 TO TM500-LINES-IN-TRBL-COUNT                   26297000
262980         END-IF                                                   26298000
262990     ELSE                                                         26299000
262991         MOVE ZERO              TO TM500-PO-LNE-NBR               26299100
262992         SET TM500-PACK-LEVEL   TO TRUE                           26299200
262993     END-IF.                                                      26299300
262994                                                                  26299400
262995     IF RC823-PRORATE-IND (RC823-RULE-IDX) = 'O' OR 'S'           26299500
262996         PERFORM 4000-PERCENT-OVER-SHORT                          26299600
262997         MOVE PV-RATIO TO TM500-OVER-SHORT-PCT                    26299700
262998     END-IF.                                                      26299800
262999 8004-379-406-TRBL.                                               26299900
263000     IF TM500-LINE-LEVEL                                          26300000
263001       AND TRBRSN-NOTIF-IND = 'T'                                 26300100
263002          ADD 1 TO TM500-LINES-IN-TRBL-COUNT                      26300200
263003     END-IF.                                                      26300300
263004                                                                  26300400
263010******************************************************************26301000
263100*    THIS PARAGRAPH CREATES THE FREEFORM TEXT OF TROUBLE RECORD.  26310000
263200******************************************************************26320000
263300 8010-DETERMINE-MSG-TEXT.                                         26330000
263400     MOVE '8010-DETERMINE-MSG-TEXT       ' TO RC001-PARAGRAPH.    26340000
263500                                                                  26350000
263600     MOVE SPACES TO TM500-FREEFORM-TEXT.                          26360000
263700                                                                  26370000
263800*MESSAGE FORMAT1.                                                 26380000
263900*    IF RCT00002-MSG-FMT-NBR = 1                                  26390000
264000*        MOVE RC821-PO-UNT-RTL-PR-AMT (RC821-ITEM-IDX)            26400000
264100*                                    TO TM-MF1-PO-UNT-RTL         26410000
264200*        MOVE RC821-SK-UNT-RTL-PR-AMT (RC821-ITEM-IDX)            26420000
264300*                                    TO TM-MF1-SKU-UNT-RTL        26430000
264400*        MOVE RC821-PO-GP-QTY (RC821-ITEM-IDX)                    26440000
264500*                                    TO TM-MF1-PO-GP-QTY          26450000
264600*        MOVE RC821-SK-GP-QTY (RC821-ITEM-IDX)                    26460000
264700*                                    TO TM-MF1-SKU-GP-QTY         26470000
264800*        MOVE RC821-PO-GP-RTL-AMT (RC821-ITEM-IDX)                26480000
264900*                                    TO TM-MF1-PO-GP-RTL          26490000
265000*        MOVE RC821-SK-GP-RTL-AMT (RC821-ITEM-IDX)                26500000
265100*                                    TO TM-MF1-SKU-GP-RTL         26510000
265200*        MOVE TM-PRICE-DISC-TEXT     TO TM500-FREEFORM-TEXT       26520000
265300*    END-IF.                                                      26530000
265400                                                                  26540000
265500*MESSAGE FORMAT2.                                                 26550000
265600     IF RCT00002-MSG-FMT-NBR = 2                                  26560000
265700         MOVE RC821-STR-NBR (RC821-STORE-IDX)                     26570000
265800                                     TO TM-MF2-STR                26580000
265900         MOVE TM-STR-CLS-TEXT        TO TM500-FREEFORM-TEXT       26590000
266000     END-IF.                                                      26600000
266100                                                                  26610000
266200*MESSAGE FORMAT3.                                                 26620000
266300     IF RCT00002-MSG-FMT-NBR = 3                                  26630000
266400         MOVE RC821-STR-NBR (RC821-STORE-IDX)                     26640000
266500                                     TO TM-MF3-STR                26650000
266600         MOVE TM-STR-NOT-RCVG-TEXT   TO TM500-FREEFORM-TEXT       26660000
266700     END-IF.                                                      26670000
266800                                                                  26680000
266900*MESSAGE FORMAT4.                                                 26690000
267000     IF RCT00002-MSG-FMT-NBR = 4                                  26700000
267100         MOVE RC821-STR-NBR (RC821-STORE-IDX)                     26710000
267200                                     TO TM-MF4-STR                26720000
267300         MOVE TM-WRONG-DC-TEXT       TO TM500-FREEFORM-TEXT       26730000
267400     END-IF.                                                      26740000
267500                                                                  26750000
267600*MESSAGE FORMAT5.                                                 26760000
267700     IF RCT00002-MSG-FMT-NBR = 5                                  26770000
267800         PERFORM 8011-CALC-ITEM                                   26780000
267900                                                                  26790000
268000         MOVE PV-ACCUM-RECD-UNITS    TO TM-MF5-RCVD-QTY           26800000
268100         MOVE TM-LINE-STS-TEXT       TO TM500-FREEFORM-TEXT       26810000
268200     END-IF.                                                      26820000
268300                                                                  26830000
268400*MESSAGE FORMAT6.                                                 26840000
268500     IF RCT00002-MSG-FMT-NBR = 6                                  26850000
268600         MOVE TM-ZERO-BEST-CASE-TEXT TO TM500-FREEFORM-TEXT       26860000
268700     END-IF.                                                      26870000
268800                                                                  26880000
268900*MESSAGE FORMAT7.                                                 26890000
269000     IF RCT00002-MSG-FMT-NBR = 7                                  26900000
269100         PERFORM 8011-CALC-ITEM                                   26910000
269200                                                                  26920000
269300         COMPUTE PV-PACK-REC = RC821-BEST-CASE-UNITS (DL)         26930000
269400                             / RC821-REC-PACK-RATO-QTY (DL)       26940000
269500         MOVE PV-PACK-REC          TO TM-MF7-REC                  26950000
269600         MOVE RC821-SUM-STR-OTR-PK TO TM-MF7-OTR                  26960000
269700                                                                  26970000
269800         COMPUTE PV-PACK-OV = PV-PACK-REC                         26980000
269900                            - RC821-SUM-STR-OTR-PK                26990000
270000         MOVE PV-PACK-OV           TO TM-MF7-OV-QTY               27000000
270100                                                                  27010000
270200         PERFORM 4000-PERCENT-OVER-SHORT                          27020000
270300         MOVE PV-RATIO TO TM-MF7-OV-PCT                           27030000
270400                                                                  27040000
270500         IF TM-MF7-OV-PCT = '  0'                                 27050000
270600           AND PV-UNIT-PERCENT > ZEROES                           27060000
270700             MOVE 1        TO TM-MF7-OV-PCT                       27070000
270800         END-IF                                                   27080000
270900                                                                  27090000
271000         MOVE PV-PACK-DOLLARS         TO TM-MF7-RT-AMT            27100000
271100         MOVE PV-ACCUM-LINE-OV-AMT    TO TM-MF7-TOT-RT-AMT        27110000
271200         MOVE RC821-TOTAL-ODD-UNITS   TO TM-MF7-ODD-QTY           27120000
271300         IF RC821-TOTAL-ODD-UNITS > ZEROES                        27130000
271400             PERFORM 8012-CALC-ODD-UNIT-AMT                       27140000
271500             MOVE PV-ODD-UNIT-DOLLARS TO TM-MF7-ODD-AMT           27150000
271600         ELSE                                                     27160000
271700             MOVE ZEROES              TO TM-MF7-ODD-AMT           27170000
271800         END-IF                                                   27180000
271900         PERFORM 8013-CALC-MSG-TEXT                               27190000
272000         MOVE PV-MSG-TEXT             TO TM-MF7-TEXT              27200000
272100         MOVE RC821-STR-COUNT         TO TM-MF7-STR-ALLOC         27210000
272200         PERFORM 8014-COUNT-STORES                                27220000
272300         PERFORM 8015-CALC-OVRG-QTY                               27230000
272400         COMPUTE PV-AVG-UNITS = PV-OVRG-QTY                       27240000
272500                              / PV-OVRG-STR-CNT                   27250000
272600         MOVE PV-AVG-UNITS            TO TM-MF7-AVG-UN            27260000
272700         MOVE TM-PACK-OVER-TEXT       TO TM500-FREEFORM-TEXT      27270000
272800     END-IF.                                                      27280000
272900                                                                  27290000
273000*MESSAGE FORMAT8.                                                 27300000
273100     IF RCT00002-MSG-FMT-NBR = 8                                  27310000
273200         MOVE RC821-STR-NBR (RC821-STORE-IDX)                     27320000
273300                                      TO TM-MF8-STR               27330000
273400         MOVE TM-INVALID-STORE-TEXT   TO TM500-FREEFORM-TEXT      27340000
273500     END-IF.                                                      27350000
273600                                                                  27360000
275400*MESSAGE FORMAT10.                                                27540000
275500     IF RCT00002-MSG-FMT-NBR = 10                                 27550000
275600         PERFORM 8011-CALC-ITEM                                   27560000
275700                                                                  27570000
275800         MOVE PV-ACCUM-RECD-UNITS     TO TM-MF10-RCVD-QTY         27580000
275900         MOVE RC821-SUM-STR-OTR-QTY   TO TM-MF10-OTR-QTY          27590000
276000                                                                  27600000
276100         COMPUTE TM-MF10-SH-QTY = RC821-SUM-STR-OTR-QTY           27610000
276200                                - PV-ACCUM-RECD-UNITS             27620000
276300                                                                  27630000
276400         PERFORM 4000-PERCENT-OVER-SHORT                          27640000
276500         MOVE PV-RATIO TO TM-MF10-SH-PCT                          27650000
276600                                                                  27660000
276700         IF TM-MF10-SH-PCT = '  0'                                27670000
276800           AND PV-UNIT-PERCENT > ZEROES                           27680000
276900             MOVE 1        TO TM-MF10-SH-PCT                      27690000
277000         END-IF                                                   27700000
277100                                                                  27710000
277200         MOVE RC821-STR-COUNT      TO TM-MF10-STR-ALLOC           27720000
277300         COMPUTE PV-AVG-UNITS = PV-ACCUM-RECD-UNITS               27730000
277400                              / RC821-STR-COUNT                   27740000
277500         MOVE PV-AVG-UNITS         TO TM-MF10-AV-UN-STR           27750000
277600                                                                  27760000
277700         MOVE PV-UNIT-PRICE        TO TM-MF10-RTL-UN              27770000
277800         MOVE PV-ACCUM-LINE-SH-AMT TO TM-MF10-SH-AMT              27780000
277900                                                                  27790000
278000         MOVE TM-SHORT-TEXT        TO TM500-FREEFORM-TEXT         27800000
278100     END-IF.                                                      27810000
278200                                                                  27820000
278300*MESSAGE FORMAT11.                                                27830000
278400     IF RCT00002-MSG-FMT-NBR = 11                                 27840000
278500         PERFORM 8011-CALC-ITEM                                   27850000
278600                                                                  27860000
278700         COMPUTE PV-PACK-REC = RC821-BEST-CASE-UNITS (DL)         27870000
278800                             / RC821-REC-PACK-RATO-QTY (DL)       27880000
278900         MOVE PV-PACK-REC          TO TM-MF11-REC                 27890000
279000         MOVE RC821-SUM-STR-OTR-PK TO TM-MF11-OTR                 27900000
279100                                                                  27910000
279200         COMPUTE TM-MF11-SH-QTY = RC821-SUM-STR-OTR-PK            27920000
279300                                - PV-PACK-REC                     27930000
279400                                                                  27940000
279500         PERFORM 4000-PERCENT-OVER-SHORT                          27950000
279600         MOVE PV-RATIO TO TM-MF11-SH-PCT                          27960000
279700                                                                  27970000
279800         IF TM-MF11-SH-PCT = '  0'                                27980000
279900           AND PV-UNIT-PERCENT > ZEROES                           27990000
280000             MOVE 1        TO TM-MF11-SH-PCT                      28000000
280100         END-IF                                                   28010000
280200                                                                  28020000
280300         MOVE PV-PACK-DOLLARS         TO TM-MF11-RT-AMT           28030000
280400         MOVE PV-ACCUM-LINE-SH-AMT    TO TM-MF11-TOT-RT-AMT       28040000
280500                                                                  28050000
280600         MOVE RC821-TOTAL-ODD-UNITS   TO TM-MF11-ODD-QTY          28060000
280700         IF RC821-TOTAL-ODD-UNITS > ZEROES                        28070000
280800             PERFORM 8012-CALC-ODD-UNIT-AMT                       28080000
280900             MOVE PV-ODD-UNIT-DOLLARS TO TM-MF11-ODD-AMT          28090000
281000         ELSE                                                     28100000
281100             MOVE ZEROES              TO TM-MF11-ODD-AMT          28110000
281200         END-IF                                                   28120000
281300                                                                  28130000
281400         PERFORM 8013-CALC-MSG-TEXT                               28140000
281500         MOVE PV-MSG-TEXT             TO TM-MF11-TEXT             28150000
281600         MOVE RC821-STR-COUNT         TO TM-MF11-STR-ALLOC        28160000
281700         MOVE TM-PACK-SHORT-TEXT      TO TM500-FREEFORM-TEXT      28170000
281800     END-IF.                                                      28180000
281900                                                                  28190000
282000*MESSAGE FORMAT12.                                                28200000
282100     IF RCT00002-MSG-FMT-NBR = 12                                 28210000
282200         PERFORM 8011-CALC-ITEM                                   28220000
282300                                                                  28230000
282400         MOVE PV-ACCUM-RECD-UNITS   TO TM-MF12-RCVD-QTY           28240000
282500         MOVE RC821-SUM-STR-OTR-QTY TO TM-MF12-OTR-QTY            28250000
282600         COMPUTE TM-MF12-OV-QTY = PV-ACCUM-RECD-UNITS             28260000
282700                                - RC821-SUM-STR-OTR-QTY           28270000
282800                                                                  28280000
282900         PERFORM 4000-PERCENT-OVER-SHORT                          28290000
283000         MOVE PV-RATIO TO TM-MF12-OV-PCT                          28300000
283100                                                                  28310000
283200         IF TM-MF12-OV-PCT = '  0'                                28320000
283300           AND PV-UNIT-PERCENT > ZEROES                           28330000
283400             MOVE 1        TO TM-MF12-OV-PCT                      28340000
283500         END-IF                                                   28350000
283600                                                                  28360000
283700         MOVE RC821-STR-COUNT TO TM-MF12-STR-ALLOC                28370000
283800                                                                  28380000
283900         PERFORM 8014-COUNT-STORES                                28390000
284000         COMPUTE PV-AVG-UNITS = (TM500-UNITS-TO-ALLOC             28400000
284100                               - RC821-SUM-STR-OTR-QTY)           28410000
284200                               / PV-OVRG-STR-CNT                  28420000
284300         MOVE PV-AVG-UNITS         TO TM-MF12-AV-UN-STR           28430000
284400         MOVE PV-UNIT-PRICE        TO TM-MF12-RTL-UN              28440000
284500         MOVE PV-ACCUM-LINE-OV-AMT TO TM-MF12-OV-AMT              28450000
284600         MOVE TM-OVER-TEXT         TO TM500-FREEFORM-TEXT         28460000
284700     END-IF.                                                      28470000
284800                                                                  28480000
284900*MESSAGE FORMAT13.                                                28490000
285000     IF RCT00002-MSG-FMT-NBR = 13                                 28500000
285100         PERFORM 8011-CALC-ITEM                                   28510000
285200                                                                  28520000
285300         MOVE PV-ACCUM-RECD-UNITS    TO TM-MF13-RCVD-QTY          28530000
285400         MOVE TM-PACK-NO-DISTRO-TEXT TO TM500-FREEFORM-TEXT       28540000
285500     END-IF.                                                      28550000
285600                                                                  28560000
285700*MESSAGE FORMAT14.                                                28570000
285800     IF RCT00002-MSG-FMT-NBR = 14                                 28580000
285900         MOVE SPACES TO TM-MF14-OV-SH-1                           28590000
286000                        TM-MF14-OV-SH-2                           28600000
286100                                                                  28610000
286200         PERFORM 8011-CALC-ITEM                                   28620000
286300         PERFORM 8014-COUNT-STORES                                28630000
286400         PERFORM 8015-CALC-OVRG-QTY                               28640000
286500                                                                  28650000
286600         COMPUTE PV-PACK-REC = RC821-BEST-CASE-UNITS (DL)         28660000
286700                             / RC821-REC-PACK-RATO-QTY (DL)       28670000
286800         MOVE PV-PACK-REC          TO TM-MF14-REC                 28680000
286900         MOVE RC821-SUM-STR-OTR-PK TO TM-MF14-OTR                 28690000
287000                                                                  28700000
287100         MOVE PV-PACK-DOLLARS      TO TM-MF14-RT-AMT              28710000
287200         MOVE ZEROES               TO TM-MF14-AVG-UN              28720000
287300                                                                  28730000
287400         PERFORM 4001-PERCENT-OV-SH-DOLLARS                       28740000
287500         PERFORM 4000-PERCENT-OVER-SHORT                          28750000
287600                                                                  28760000
287700         IF PV-TOT-PLAN < PV-TOT-RECEIVED                         28770000
287800           OR PV-TOT-PLAN = PV-TOT-RECEIVED                       28780000
287900             MOVE 'OV' TO TM-MF14-OV-SH-1                         28790000
288000                          TM-MF14-OV-SH-2                         28800000
288100             COMPUTE TM-MF14-PK-QTY = PV-PACK-REC                 28810000
288200                                    - RC821-SUM-STR-OTR-PK        28820000
288300             IF PV-TOT-PLAN = PV-TOT-RECEIVED                     28830000
288400                 MOVE ZEROES TO TM-MF14-PK-QTY                    28840000
288500             END-IF                                               28850000
288600             IF PV-PACK-REC < RC821-SUM-STR-OTR-PK                28860000
288700                 MOVE ZEROES TO TM-MF14-PK-QTY                    28870000
288800             END-IF                                               28880000
288900                                                                  28890000
289000             MOVE PV-RATIO TO TM-MF14-PK-PCT                      28900000
289100                                                                  28910000
289200             IF TM-MF14-PK-PCT = '  0'                            28920000
289300               AND PV-UNIT-PERCENT > ZEROES                       28930000
289400                 MOVE 1        TO TM-MF14-PK-PCT                  28940000
289500             END-IF                                               28950000
289600                                                                  28960000
289700             MOVE PV-PACK-DOLLARS      TO TM-MF14-RT-AMT          28970000
289800***          MOVE PV-ACCUM-LINE-OV-AMT TO TM-MF14-TOT-RT-AMT      28980000
289900             MOVE PV-TOTAL-DOLLARS-OVER-SHORT                     28990000
290000                                       TO TM-MF14-TOT-RT-AMT      29000000
290100***          COMPUTE PV-AVG-UNITS = (PV-PACK-REC                  29010000
290200***                               - RC821-SUM-STR-OTR-PK)         29020000
290300             COMPUTE PV-AVG-UNITS = PV-OVRG-QTY                   29030000
290400                                  / PV-OVRG-STR-CNT               29040000
290500             MOVE PV-AVG-UNITS TO TM-MF14-AVG-UN                  29050000
290600         END-IF                                                   29060000
290700                                                                  29070000
290800         IF PV-TOT-PLAN > PV-TOT-RECEIVED                         29080000
290900             MOVE 'SH' TO TM-MF14-OV-SH-1                         29090000
291000                          TM-MF14-OV-SH-2                         29100000
291100             COMPUTE TM-MF14-PK-QTY = RC821-SUM-STR-OTR-PK        29110000
291200                                    - PV-PACK-REC                 29120000
291300                                                                  29130000
291400             MOVE PV-RATIO TO TM-MF14-PK-PCT                      29140000
291500                                                                  29150000
291600             IF TM-MF14-PK-PCT = '  0'                            29160000
291700               AND PV-UNIT-PERCENT > ZEROES                       29170000
291800                 MOVE 1        TO TM-MF14-PK-PCT                  29180000
291900             END-IF                                               29190000
292000                                                                  29200000
292100             MOVE PV-PACK-DOLLARS      TO TM-MF14-RT-AMT          29210000
292200***          MOVE PV-ACCUM-LINE-SH-AMT TO TM-MF14-TOT-RT-AMT      29220000
292300             MOVE PV-TOTAL-DOLLARS-OVER-SHORT                     29230000
292400                                       TO TM-MF14-TOT-RT-AMT      29240000
292500                                                                  29250000
292600***          COMPUTE PV-AVG-UNITS = PV-PACK-REC                   29260000
292700             COMPUTE PV-AVG-UNITS = PV-ACCUM-RECD-UNITS           29270000
292800                                  / RC821-STR-COUNT               29280000
292900             MOVE PV-AVG-UNITS         TO TM-MF14-AVG-UN          29290000
293000         END-IF                                                   29300000
293100                                                                  29310000
293200         MOVE RC821-TOTAL-ODD-UNITS    TO TM-MF14-ODD-QTY         29320000
293300         IF RC821-TOTAL-ODD-UNITS > ZEROES                        29330000
293400             PERFORM 8012-CALC-ODD-UNIT-AMT                       29340000
293500             MOVE PV-ODD-UNIT-DOLLARS  TO TM-MF14-ODD-AMT         29350000
293600         ELSE                                                     29360000
293700             MOVE ZEROES               TO TM-MF14-ODD-AMT         29370000
293800         END-IF                                                   29380000
293900                                                                  29390000
294000         PERFORM 8013-CALC-MSG-TEXT                               29400000
294100         MOVE PV-MSG-TEXT      TO TM-MF14-TEXT                    29410000
294200         MOVE RC821-STR-COUNT  TO TM-MF14-STR-ALLOC               29420000
294300                                                                  29430000
294400         MOVE TM-BAD-PACK-TEXT TO TM500-FREEFORM-TEXT             29440000
294500     END-IF.                                                      29450000
294600                                                                  29460000
294700*MESSAGE FORMAT15.                                                29470000
294800     IF RCT00002-MSG-FMT-NBR = 15                                 29480000
294900         MOVE PV-DISPERSAL-QTY       TO TM-MF15-PACK-QTY          29490000
295000         MOVE TM500-UNITS-TO-ALLOC   TO TM-MF15-RCVD-QTY          29500000
295100         MOVE RC821-STR-NBR (RC821-STORE-IDX)                     29510000
295200                                     TO TM-MF15-STR-NBR           29520000
295300         MOVE RC821-STR-DISTRO-QTY (RC821-STORE-IDX)              29530000
295400                                     TO TM-MF15-STR-QTY           29540000
295500                                                                  29550000
295600         MOVE TM-BAD-INNER-PACK-TEXT TO TM500-FREEFORM-TEXT       29560000
295700     END-IF.                                                      29570000
295800                                                                  29580000
295900******************************************************************29590000
296000 8011-CALC-ITEM.                                                  29600000
296100     MOVE '8011-CALC-ITEM                ' TO RC001-PARAGRAPH.    29610000
296200                                                                  29620000
296300     MOVE ZEROES TO PV-LINE-UNITS                                 29630000
296400                    PV-UNIT-PRICE                                 29640000
296500                    PV-LINE-DOLLARS                               29650000
296600                    PV-PACK-DOLLARS                               29660000
296700                    PV-ACCUM-OTR-UNITS                            29670000
296800                    PV-ACCUM-RTL-DOLLARS                          29680000
296900                    PV-ACCUM-RECD-UNITS                           29690000
297000                    PV-LINE-OV-QTY                                29700000
297100                    PV-ACCUM-LINE-OV-QTY                          29710000
297200                    PV-LINE-OV-AMT                                29720000
297300                    PV-ACCUM-LINE-OV-AMT                          29730000
297400                    PV-LINE-SH-QTY                                29740000
297500                    PV-ACCUM-LINE-SH-QTY                          29750000
297600                    PV-LINE-SH-AMT                                29760000
297700                    PV-ACCUM-LINE-SH-AMT.                         29770000
297800                                                                  29780000
297900     IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'P' OR 'S'           29790000
298000     PERFORM                                                      29800000
298100       VARYING PV-ITEM-IDX FROM 1 BY 1                            29810000
298200         UNTIL PV-ITEM-IDX > RC821-MAX-ITEM-COUNT                 29820000
298300         IF RC821-REC-SKU-NBR (PV-ITEM-IDX) > +0                  29830000
298400*DETERMINE RECEIVED UNITS                                         29840000
298500             IF RC821-PKGNG-CDE = 'I' OR 'M'                      29850000
298600                 MOVE RC821-BEST-CASE-UNITS (PV-ITEM-IDX)         29860000
298700                   TO PV-LINE-UNITS                               29870000
298800             ELSE                                                 29880000
298900                 IF RC821-DTL-CK-ITM-QTY (PV-ITEM-IDX) > +0       29890000
299000                     MOVE RC821-DTL-CK-ITM-QTY (PV-ITEM-IDX)      29900000
299100                       TO PV-LINE-UNITS                           29910000
299200                 ELSE                                             29920000
299300                     MOVE RC821-PKSL-ITM-QTY (PV-ITEM-IDX)        29930000
299400                       TO PV-LINE-UNITS                           29940000
299500                 END-IF                                           29950000
299600             END-IF                                               29960000
299700*CALC RETAIL DOLLARS                                              29970000
299800             IF RC821-PO-GP-QTY (PV-ITEM-IDX) > 1                 29980000
299900                 COMPUTE PV-UNIT-PRICE =                          29990000
300000                         RC821-PO-GP-RTL-AMT  (PV-ITEM-IDX)       30000000
300100                       / RC821-PO-GP-QTY      (PV-ITEM-IDX)       30010000
300200             ELSE                                                 30020000
300300                 MOVE RC821-PO-UNT-RTL-PR-AMT (PV-ITEM-IDX)       30030000
300400                   TO PV-UNIT-PRICE                               30040000
300500             END-IF                                               30050000
300600*ACCUM RECEIVED UNITS                                             30060000
300700             COMPUTE PV-ACCUM-RECD-UNITS = PV-ACCUM-RECD-UNITS    30070000
300800                                         + PV-LINE-UNITS          30080000
300900*ACCUM OTR UNITS                                                  30090000
301000             COMPUTE PV-ACCUM-OTR-UNITS = PV-ACCUM-OTR-UNITS      30100000
301100                   + RC821-ITEM-OTR-QTY (PV-ITEM-IDX)             30110000
301200                                                                  30120000
301300*ACCUM PACK DOLLARS                                               30130000
301400             COMPUTE PV-PACK-DOLLARS = PV-PACK-DOLLARS            30140000
301500                   + (PV-UNIT-PRICE                               30150000
301600                   * RC821-REC-PACK-RATO-QTY (PV-ITEM-IDX))       30160000
301700                                                                  30170000
301800*ACCUM RETAIL DOLLARS                                             30180000
301900             COMPUTE PV-LINE-DOLLARS = PV-LINE-UNITS              30190000
302000                                     * PV-UNIT-PRICE              30200000
302100                                                                  30210000
302200             COMPUTE PV-ACCUM-RTL-DOLLARS = PV-ACCUM-RTL-DOLLARS  30220000
302300                                         + PV-LINE-DOLLARS        30230000
302400                                                                  30240000
302500             IF RC821-OVER-SHORT-CDE = 'O' OR 'M'                 30250000
302600*CALC OVERAGE QTY/DOLLARS                                         30260000
302700                 COMPUTE PV-LINE-OV-QTY =                         30270000
302800                         PV-LINE-UNITS                            30280000
302900                       - RC821-ITEM-OTR-QTY (PV-ITEM-IDX)         30290000
303000                 COMPUTE PV-LINE-OV-AMT = PV-LINE-OV-QTY          30300000
303100                                        * PV-UNIT-PRICE           30310000
303200*ACCUM OVERAGE QTY/DOLLARS                                        30320000
303300                 COMPUTE PV-ACCUM-LINE-OV-QTY =                   30330000
303400                         PV-ACCUM-LINE-OV-QTY + PV-LINE-OV-QTY    30340000
303500                 COMPUTE PV-ACCUM-LINE-OV-AMT =                   30350000
303600                         PV-ACCUM-LINE-OV-AMT + PV-LINE-OV-AMT    30360000
303700             END-IF                                               30370000
303800                                                                  30380000
303900             IF RC821-OVER-SHORT-CDE = 'S'                        30390000
304000*CALC SHORTAGE QTY/DOLLARS                                        30400000
304100                 COMPUTE PV-LINE-SH-QTY =                         30410000
304200                         RC821-ITEM-OTR-QTY (PV-ITEM-IDX)         30420000
304300                       - PV-LINE-UNITS                            30430000
304400                 COMPUTE PV-LINE-SH-AMT = PV-LINE-SH-QTY          30440000
304500                                        * PV-UNIT-PRICE           30450000
304600*ACCUM SHORTAGE QTY/DOLLARS                                       30460000
304700                 COMPUTE PV-ACCUM-LINE-SH-QTY =                   30470000
304800                         PV-ACCUM-LINE-SH-QTY + PV-LINE-SH-QTY    30480000
304900                 COMPUTE PV-ACCUM-LINE-SH-AMT =                   30490000
305000                         PV-ACCUM-LINE-SH-AMT + PV-LINE-SH-AMT    30500000
305100             END-IF                                               30510000
305200         END-IF                                                   30520000
305300     END-PERFORM                                                  30530000
305400     ELSE                                                         30540000
305500         IF RC821-REC-SKU-NBR (RC821-ITEM-IDX) > +0               30550000
305600*DETERMINE RECEIVED UNITS                                         30560000
305700*10/15/03    IF RC821-PKGNG-CDE = 'I' OR 'M'                      30570000
305800*10/15/03        MOVE RC821-BEST-CASE-UNITS (RC821-ITEM-IDX)      30580000
305900*10/15/03          TO PV-LINE-UNITS                               30590000
306000*10/15/03    ELSE                                                 30600000
306100                 IF RC821-DTL-CK-ITM-QTY (RC821-ITEM-IDX) > +0    30610000
306200                     MOVE RC821-DTL-CK-ITM-QTY (RC821-ITEM-IDX)   30620000
306300                       TO PV-LINE-UNITS                           30630000
306400                 ELSE                                             30640000
306500                     MOVE RC821-PKSL-ITM-QTY (RC821-ITEM-IDX)     30650000
306600                       TO PV-LINE-UNITS                           30660000
306700                 END-IF                                           30670000
306800*10/15/03    END-IF                                               30680000
306900*CALC RETAIL DOLLARS                                              30690000
307000             IF RC821-PO-GP-QTY (RC821-ITEM-IDX) > 1              30700000
307100                 COMPUTE PV-UNIT-PRICE =                          30710000
307200                         RC821-PO-GP-RTL-AMT  (RC821-ITEM-IDX)    30720000
307300                       / RC821-PO-GP-QTY      (RC821-ITEM-IDX)    30730000
307400             ELSE                                                 30740000
307500                 MOVE RC821-PO-UNT-RTL-PR-AMT (RC821-ITEM-IDX)    30750000
307600                   TO PV-UNIT-PRICE                               30760000
307700             END-IF                                               30770000
307800*ACCUM RECEIVED UNITS                                             30780000
307900             COMPUTE PV-ACCUM-RECD-UNITS = PV-ACCUM-RECD-UNITS    30790000
308000                                         + PV-LINE-UNITS          30800000
308100*ACCUM OTR UNITS                                                  30810000
308200             COMPUTE PV-ACCUM-OTR-UNITS = PV-ACCUM-OTR-UNITS      30820000
308300                   + RC821-ITEM-OTR-QTY (RC821-ITEM-IDX)          30830000
308400                                                                  30840000
308500*ACCUM PACK DOLLARS                                               30850000
308600             COMPUTE PV-PACK-DOLLARS = PV-PACK-DOLLARS            30860000
308700                   + (PV-UNIT-PRICE                               30870000
308800                   * RC821-REC-PACK-RATO-QTY (RC821-ITEM-IDX))    30880000
308900                                                                  30890000
309000*ACCUM RETAIL DOLLARS                                             30900000
309100             COMPUTE PV-LINE-DOLLARS = PV-LINE-UNITS              30910000
309200                                     * PV-UNIT-PRICE              30920000
309300                                                                  30930000
309400             COMPUTE PV-ACCUM-RTL-DOLLARS = PV-ACCUM-RTL-DOLLARS  30940000
309500                                         + PV-LINE-DOLLARS        30950000
309600                                                                  30960000
309700             IF RC821-OVER-SHORT-CDE = 'O' OR 'M'                 30970000
309800*CALC OVERAGE QTY/DOLLARS                                         30980000
309900                 COMPUTE PV-LINE-OV-QTY =                         30990000
310000                         PV-LINE-UNITS                            31000000
310100                       - RC821-ITEM-OTR-QTY (RC821-ITEM-IDX)      31010000
310200                 COMPUTE PV-LINE-OV-AMT = PV-LINE-OV-QTY          31020000
310300                                        * PV-UNIT-PRICE           31030000
310400*ACCUM OVERAGE QTY/DOLLARS                                        31040000
310500                 COMPUTE PV-ACCUM-LINE-OV-QTY =                   31050000
310600                         PV-ACCUM-LINE-OV-QTY + PV-LINE-OV-QTY    31060000
310700                 COMPUTE PV-ACCUM-LINE-OV-AMT =                   31070000
310800                         PV-ACCUM-LINE-OV-AMT + PV-LINE-OV-AMT    31080000
310900             END-IF                                               31090000
311000                                                                  31100000
311100             IF RC821-OVER-SHORT-CDE = 'S'                        31110000
311200*CALC SHORTAGE QTY/DOLLARS                                        31120000
311300                 COMPUTE PV-LINE-SH-QTY =                         31130000
311400                         RC821-ITEM-OTR-QTY (RC821-ITEM-IDX)      31140000
311500                       - PV-LINE-UNITS                            31150000
311600                 COMPUTE PV-LINE-SH-AMT = PV-LINE-SH-QTY          31160000
311700                                        * PV-UNIT-PRICE           31170000
311800*ACCUM SHORTAGE QTY/DOLLARS                                       31180000
311900                 COMPUTE PV-ACCUM-LINE-SH-QTY =                   31190000
312000                         PV-ACCUM-LINE-SH-QTY + PV-LINE-SH-QTY    31200000
312100                 COMPUTE PV-ACCUM-LINE-SH-AMT =                   31210000
312200                         PV-ACCUM-LINE-SH-AMT + PV-LINE-SH-AMT    31220000
312300             END-IF                                               31230000
312400         END-IF                                                   31240000
312500     END-IF.                                                      31250000
312600                                                                  31260000
312700******************************************************************31270000
312800 8012-CALC-ODD-UNIT-AMT.                                          31280000
312900     MOVE '8012-CALC-ODD-UNIT-AMT        ' TO RC001-PARAGRAPH.    31290000
313000                                                                  31300000
313100     MOVE ZEROES TO PV-UNIT-PRICE                                 31310000
313200                    PV-ODD-UNIT-DOLLARS.                          31320000
313300                                                                  31330000
313400     PERFORM                                                      31340000
313500       VARYING PV-ITEM-IDX FROM 1 BY 1                            31350000
313600         UNTIL PV-ITEM-IDX > RC821-MAX-ITEM-COUNT                 31360000
313700                                                                  31370000
313800         IF RC821-PO-GP-QTY (PV-ITEM-IDX) > 1                     31380000
313900             COMPUTE PV-UNIT-PRICE =                              31390000
314000                     RC821-PO-GP-RTL-AMT  (PV-ITEM-IDX)           31400000
314100                   / RC821-PO-GP-QTY      (PV-ITEM-IDX)           31410000
314200         ELSE                                                     31420000
314300             MOVE RC821-PO-UNT-RTL-PR-AMT (PV-ITEM-IDX)           31430000
314400               TO PV-UNIT-PRICE                                   31440000
314500         END-IF                                                   31450000
314600                                                                  31460000
314700         COMPUTE PV-ODD-UNIT-DOLLARS  = PV-ODD-UNIT-DOLLARS       31470000
314800               + (RC821-ODD-UNIT-QTY (PV-ITEM-IDX)                31480000
314900               * PV-UNIT-PRICE)                                   31490000
315000                                                                  31500000
315100     END-PERFORM.                                                 31510000
315200                                                                  31520000
315300******************************************************************31530000
315400 8013-CALC-MSG-TEXT.                                              31540000
315500     MOVE '8013-CALC-MSG-TEXT            ' TO RC001-PARAGRAPH.    31550000
315600                                                                  31560000
315700     IF PV-DIFFERENT-RATIOS = 'N'                                 31570000
315800       AND PV-LINES-MISSING = 'N'                                 31580000
315900         MOVE 'PACK IS INTACT   ' TO PV-MSG-TEXT                  31590000
316000     END-IF.                                                      31600000
316100                                                                  31610000
316200     IF PV-DIFFERENT-RATIOS = 'Y'                                 31620000
316300       AND PV-LINES-MISSING = 'Y'                                 31630000
316400         MOVE 'MISS LN/RATIO CHG' TO PV-MSG-TEXT                  31640000
316500     END-IF.                                                      31650000
316600                                                                  31660000
316700     IF PV-DIFFERENT-RATIOS = 'N'                                 31670000
316800       AND PV-LINES-MISSING = 'Y'                                 31680000
316900         MOVE 'MISSING LINES    ' TO PV-MSG-TEXT                  31690000
317000     END-IF.                                                      31700000
317100                                                                  31710000
317200     IF PV-DIFFERENT-RATIOS = 'Y'                                 31720000
317300       AND PV-LINES-MISSING = 'N'                                 31730000
317400         MOVE 'RATIO CHANGES    ' TO PV-MSG-TEXT                  31740000
317500     END-IF.                                                      31750000
317600                                                                  31760000
317700******************************************************************31770000
317800 8014-COUNT-STORES.                                               31780000
317900     MOVE '8014-COUNT-STORES             ' TO RC001-PARAGRAPH.    31790000
318000                                                                  31800000
318100*OVERAGE STORE COUNT.                                             31810000
318200     MOVE ZEROES TO PV-NEW-STR-CNT                                31820000
318300                    PV-OLD-STR-CNT                                31830000
318400                    PV-CS-STR-CNT                                 31840000
318500                    PV-OVRG-STR-CNT.                              31850000
318600                                                                  31860000
318700     PERFORM                                                      31870000
318800       VARYING L FROM 1 BY 1                                      31880000
318900         UNTIL L > RC821-MAX-STR-COUNT                            31890000
319000                                                                  31900000
319100         IF RC821-STR-NBR (L) > ZEROES                            31910000
319200             IF RC821-ST-TYPE-CODE (L) = 'CS'                     31920000
319300                 ADD 1 TO PV-CS-STR-CNT                           31930000
319400             ELSE                                                 31940000
319500                 IF RC821-EXISTING-STORE-CDE (L) = '1'            31950000
319600                     ADD 1 TO PV-NEW-STR-CNT                      31960000
319700                 ELSE                                             31970000
319800                     ADD 1 TO PV-OLD-STR-CNT                      31980000
319900                 END-IF                                           31990000
320000             END-IF                                               32000000
320100         END-IF                                                   32010000
320200     END-PERFORM.                                                 32020000
320300                                                                  32030000
320400     IF PV-OLD-STR-CNT > ZEROES                                   32040000
320500         MOVE PV-OLD-STR-CNT TO PV-OVRG-STR-CNT                   32050000
320600     ELSE                                                         32060000
320700         IF PV-NEW-STR-CNT > ZEROES                               32070000
320800             MOVE PV-NEW-STR-CNT TO PV-OVRG-STR-CNT               32080000
320900         ELSE                                                     32090000
321000             MOVE PV-CS-STR-CNT  TO PV-OVRG-STR-CNT               32100000
321100         END-IF                                                   32110000
321200     END-IF.                                                      32120000
321300                                                                  32130000
321400     IF PV-OVRG-STR-CNT NOT > ZEROES                              32140000
321500         MOVE 1 TO PV-OVRG-STR-CNT                                32150000
321600     END-IF.                                                      32160000
321700                                                                  32170000
321800******************************************************************32180000
321900 8015-CALC-OVRG-QTY.                                              32190000
322000     MOVE '8015-CALC-OVRG-QTY            ' TO RC001-PARAGRAPH.    32200000
322100                                                                  32210000
322200*OVERAGE QTY.                                                     32220000
322300     MOVE ZEROES TO PV-OVRG-QTY                                   32230000
322400                    PV-SUM-PACK-UNITS                             32240000
322500                    PV-SUM-PACK-OTR-UNITS.                        32250000
322600                                                                  32260000
322700     PERFORM                                                      32270000
322800       VARYING PV-ITEM-IDX FROM 1 BY 1                            32280000
322900         UNTIL PV-ITEM-IDX > RC821-MAX-ITEM-COUNT                 32290000
323000                                                                  32300000
323100         IF RC821-DTL-CK-ITM-QTY (PV-ITEM-IDX) > +0               32310000
323200             COMPUTE PV-SUM-PACK-UNITS = PV-SUM-PACK-UNITS        32320000
323300                   + RC821-DTL-CK-ITM-QTY (PV-ITEM-IDX)           32330000
323400         ELSE                                                     32340000
323500             COMPUTE PV-SUM-PACK-UNITS = PV-SUM-PACK-UNITS        32350000
323600                   + RC821-PKSL-ITM-QTY (PV-ITEM-IDX)             32360000
323700         END-IF                                                   32370000
323800                                                                  32380000
323900         COMPUTE PV-SUM-PACK-OTR-UNITS = PV-SUM-PACK-OTR-UNITS    32390000
324000               + RC821-ITEM-OTR-QTY (PV-ITEM-IDX)                 32400000
324100                                                                  32410000
324200     END-PERFORM.                                                 32420000
324300                                                                  32430000
324400     COMPUTE PV-OVRG-QTY = (PV-SUM-PACK-UNITS                     32440000
324500                         - PV-SUM-PACK-OTR-UNITS).                32450000
324600                                                                  32460000
324700******************************************************************32470000
324800******************************************************************32480000
324900 8100-RESOLVE-TROUBLE.                                            32490000
325000     MOVE '8100-RESOLVE-TROUBLE          ' TO RC001-PARAGRAPH.    32500000
325100                                                                  32510000
325200     MOVE 'U' TO TM500-CRUD-IND.                                  32520000
325300                                                                  32530000
325400     EXEC CICS                                                    32540000
325500         LINK PROGRAM  (PC-TMKCS521)                              32550000
325600              COMMAREA (TM500-FIELDS)                             32560000
325700              LENGTH   (PC-600)                                   32570000
325800     END-EXEC.                                                    32580000
325900                                                                  32590000
326000     EVALUATE TRUE                                                32600000
326100       WHEN TM500-CALL-SUCCESSFUL                                 32610000
326200       WHEN TM500-TTRBNTF-UPDATE-NOT-FND                          32620000
326300           CONTINUE                                               32630000
326400                                                                  32640000
326500       WHEN OTHER                                                 32650000
326600           SET PS-DONE-YES TO TRUE                                32660000
326700           MOVE SPACES     TO TM501-TM500-RETURN-MSG              32670000
326800           MOVE '8100'     TO TM501-PARA                          32680000
326900           MOVE '823'      TO TM501-PGM                           32690000
327000           MOVE SQLCODE    TO TM500-SQLCODE                       32700000
327100           MOVE SQLCA      TO TM500-SQLCA                         32710000
327200           MOVE 73         TO TM501-PRORATION-ERROR-NBR           32720000
327300           PERFORM TM501-SET-TM500-RETURN-MSG                     32730000
327400           PERFORM RC001-RETURN-MSG                               32740000
327500     END-EVALUATE.                                                32750000
327600                                                                  32760000
327700******************************************************************32770000
327800*                                                                *32780000
327900*        W R I T E   A B E N D S   T O   C I C S   L O G         *32790000
328000*                                                                *32800000
328100******************************************************************32810000
328200* -------------------                                             32820000
328300*    COPY RCPD001.                                                32830000
328400* -------------------                                             32840000
328500 RC001-RETURN-MSG.                                                32850000
328600                                                                  32860000
328700     EXEC CICS                                                    32870000
328800         ASSIGN                                                   32880000
328900         USERID (RC001-USERID)                                    32890000
329000     END-EXEC.                                                    32900000
329100                                                                  32910000
329200     MOVE SQLCODE TO RC001-SAVE-SQLCODE.                          32920000
329300                                                                  32930000
329400     EXEC SQL                                                     32940000
329500         SELECT CURRENT_DATE                                      32950000
329600              , CURRENT_TIME                                      32960000
329700         INTO  :RC001-DATE                                        32970000
329800             , :RC001-TIME                                        32980000
329900         FROM TCOCNTL                                             32990000
330000     END-EXEC.                                                    33000000
330100                                                                  33010000
330200*GET THE QUEUE.                                                   33020000
330300     EXEC CICS                                                    33030000
330400         ENQ                                                      33040000
330500         RESOURCE (RC001-LOG-QUEUE)                               33050000
330600     END-EXEC.                                                    33060000
330700                                                                  33070000
330800*WRITE RC001-LINE-01.                                             33080000
330900     MOVE RC001-LINE-01            TO RC001-LOG-LINE.             33090000
331000     PERFORM RC001-WRITE-CSSL.                                    33100000
331100                                                                  33110000
331200*WRITE RC001-LINE-02.                                             33120000
331300     MOVE RC001-SAVE-SQLCODE       TO RC001-SQLCODE.              33130000
331400     MOVE RC001-LINE-02            TO RC001-LOG-LINE.             33140000
331500     PERFORM RC001-WRITE-CSSL.                                    33150000
331600                                                                  33160000
331700*WRITE RC001-LINE-03.                                             33170000
331800     MOVE TM500-PO-NBR             TO RC001-PO-NBR.               33180000
331900     MOVE TM500-REC-SEQ-NBR        TO RC001-REC-SEQ-NBR.          33190000
332000     MOVE RC821-REC-DRV-LNE-NBR    TO RC001-PO-LNE-NBR.           33200000
332100     MOVE TM500-OPER-UNT-ID        TO RC001-OPER-UNT-ID.          33210000
332200     MOVE TM500-FCLTY-ID           TO RC001-FCLTY-ID.             33220000
332300     MOVE RC821-PREPK-ID           TO RC001-PREPK-ID.             33230000
332400                                                                  33240000
332500     MOVE RC001-LINE-03            TO RC001-LOG-LINE.             33250000
332600     PERFORM RC001-WRITE-CSSL.                                    33260000
332700                                                                  33270000
332800*WRITE RC001-LINE-04.                                             33280000
332900     MOVE RC001-LINE-04            TO RC001-LOG-LINE.             33290000
333000     PERFORM RC001-WRITE-CSSL.                                    33300000
333100                                                                  33310000
333200*WRITE RC001-LINE-05.                                             33320000
333300     MOVE RC001-LINE-05            TO RC001-LOG-LINE.             33330000
333400     PERFORM RC001-WRITE-CSSL.                                    33340000
333500                                                                  33350000
333600*RELEASE THE QUEUE.                                               33360000
333700     EXEC CICS                                                    33370000
333800         DEQ                                                      33380000
333900         RESOURCE (RC001-LOG-QUEUE)                               33390000
334000     END-EXEC.                                                    33400000
334100                                                                  33410000
334200*RETURN TO CALLING PROGRAM                                        33420000
334300     PERFORM RC001-GOBACK.                                        33430000
334400                                                                  33440000
334500******************************************************************33450000
334600 RC001-WRITE-CSSL.                                                33460000
334700                                                                  33470000
334800     EXEC CICS                                                    33480000
334900         WRITEQ TD                                                33490000
335000             QUEUE (RC001-LOG-QUEUE)                              33500000
335100             FROM  (RC001-LOG-LINE)                               33510000
335200             RESP  (RC001-CICS-RESPONSE)                          33520000
335300     END-EXEC.                                                    33530000
335400                                                                  33540000
335500     IF RC001-CICS-RESPONSE = DFHRESP(NORMAL)                     33550000
335600         CONTINUE                                                 33560000
335700     ELSE                                                         33570000
335800         EXEC CICS                                                33580000
335900              ABEND                                               33590000
336000              ABCODE (EIBTRMID)                                   33600000
336100         END-EXEC                                                 33610000
336200     END-IF.                                                      33620000
336300                                                                  33630000
336400******************************************************************33640000
336500 RC001-GOBACK.                                                    33650000
336600                                                                  33660000
336700     PERFORM 0000-GOBACK.                                         33670000
336800                                                                  33680000
336900******************************************************************33690000
337000     COPY TMPD501.                                                33700000
337100******************************************************************33710000
