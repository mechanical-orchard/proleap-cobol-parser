       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    MLKRP211.                                                 
       AUTHOR.        BARBARA HULL.                                             
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  07-30-98.                                                 
       DATE-COMPILED.                                                           
      ******************************************************************        
      *                                                                         
      * MLKRP211 - DESCRIPTION.............                                     
      *                                                                         
W28545* THIS PROGRAM WILL CREATE THE SKU RECLASS BY BUYER REPORT.               
      *                                                                         
      *                                                                         
      ******************** HISTORY OF CHANGES **************************        
      * CHG ID/                                                        *        
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *        
      * -------  ----------  ----------------------------------------  *        
      * 21731    01/24/2002  RECOMPILE FOR NON-INTELLIGENT SKU         *        
W28545* 28545    03/01/2006  ADD STORE NUMBER TO MLRD113               *        
      *                                                                *        
      ******************************************************************        
      *                                                                         
       ENVIRONMENT DIVISION.                                                    
      *                                                                         
       CONFIGURATION SECTION.                                                   
      *                                                                         
       SOURCE-COMPUTER.        IBM-3090.                                        
       OBJECT-COMPUTER.        IBM-3090.                                00200000
      *                                                                 00210000
       INPUT-OUTPUT SECTION.                                            00220000
       FILE-CONTROL.                                                    00230000
                                                                        00240000
           SELECT CONTROL-FILE                                          00250000
               ASSIGN TO INP01.                                         00260000
                                                                        00270000
           SELECT RPT-EXTRACT-FILE                                      00280000
               ASSIGN TO INP02.                                         00290000
                                                                        00300000
           SELECT SKU-RENUM-BUYER-REPORT                                00310000
               ASSIGN TO RPT01.                                         00320000
                                                                        00330000
      ******************************************************************00340000
       DATA DIVISION.                                                   00350000
      ******************************************************************00360000
                                                                        00370000
       FILE SECTION.                                                    00380000
                                                                        00390000
       FD  CONTROL-FILE                                                 00400000
           LABEL RECORDS ARE STANDARD                                   00410000
           RECORDING MODE IS F                                          00420000
           BLOCK CONTAINS 0 RECORDS.                                    00430000
       01  CONTROL-REC                 PIC X(80).                       00440000
                                                                        00450000
       FD  RPT-EXTRACT-FILE                                             00460000
           LABEL RECORDS ARE STANDARD                                   00470000
           RECORDING MODE IS F                                          00480000
           BLOCK CONTAINS 0 RECORDS.                                    00490000
W28545 01  RPT-EXTRACT-REC             PIC X(139).                      00500011
                                                                        00510000
       FD  SKU-RENUM-BUYER-REPORT                                       00520000
           LABEL RECORDS ARE OMITTED                                    00530000
           RECORDING MODE IS F                                          00540000
           BLOCK CONTAINS 0 RECORDS.                                    00550000
       01  SKU-RENUM-BUYER-REC         PIC X(150).                      00560001
                                                                        00570000
      *                                                                 00580000
      ******************************************************************00590000
       WORKING-STORAGE SECTION.                                         00600000
      ******************************************************************00610000
                                                                        00620000
       01  PS-PROGRAM-SWITCHES.                                         00630000
           05  PS-MORE-EXTR-RECS-SW    PIC X       VALUE 'Y'.           00640014
               88  PS-MORE-EXTR-RECS               VALUE 'Y'.           00650000
               88  PS-NO-MORE-EXTR-RECS            VALUE 'N'.           00660000
           05  PS-TDTATTR-FOUND        PIC X       VALUE 'N'.           00670001
               88  PS-TDTATTR-IS-FOUND             VALUE 'Y'.           00680001
               88  PS-TDTATTR-IS-NOT-FOUND         VALUE 'N'.           00690001
                                                                        00700000
       01  PA-PROGRAM-ACCUMULATORS                 COMP-3.              00710000
           05  PA-EXTR-RECORDS-READ    PIC S9(13)  VALUE ZERO.          00720000
                                                                        00730000
       01  CD-COUNTER-DISPLAY.                                          00740000
           05  CD-COUNT-HOLD1          PIC Z,ZZZ,ZZZ,ZZZ,ZZ9.           00750000
                                                                        00760000
       01  PC-PROGRAM-CONSTANTS.                                        00770000
           05  PC-MAX-LINE-COUNT       PIC S9(3) COMP-3 VALUE +60.      00780023
           05  PC-C                    PIC X     VALUE 'C'.             00790033
           05  PC-D                    PIC X     VALUE 'D'.             00791033
           05  PC-N                    PIC X     VALUE 'N'.             00792033
                                                                        00800000
       01  PV-PROGRAM-VARIABLES.                                        00810000
           05  PV-LINE-COUNT           PIC S9(3) COMP-3.                00820000
           05  PV-PAGE-COUNT           PIC S9(7) COMP-3.                00830000
                                                                        00840000
           05  PV-DATE-YYMMDD.                                          00850000
               10  PV-DATE-YYMMDD-YY   PIC XX.                          00860000
               10  PV-DATE-YYMMDD-MM   PIC XX.                          00870000
               10  PV-DATE-YYMMDD-DD   PIC XX.                          00880000
           05  PV-TIME-HHMMSS.                                          00890000
               10  PV-TIME-HHMMSS-HH   PIC XX.                          00900000
               10  PV-TIME-HHMMSS-MM   PIC XX.                          00910000
               10  PV-TIME-HHMMSS-SS   PIC XX.                          00920000
                                                                        00930000
           05  PV-SPLIT-DATE.                                           00940000
               10  PV-SPLIT-DATE-CCYY  PIC X(4).                        00950000
               10  PV-HYPHEN-1         PIC X.                           00960000
               10  PV-SPLIT-DATE-MM    PIC X(2).                        00970000
               10  PV-HYPHEN-2         PIC X.                           00980000
               10  PV-SPLIT-DATE-DD    PIC X(2).                        00990000
           05  PV-FRMT-DATE.                                            01000000
               10  PV-FRMT-DATE-MM     PIC X(2).                        01010000
               10  PV-HYPHEN-1ST       PIC X.                           01020000
               10  PV-FRMT-DATE-DD     PIC X(2).                        01030000
               10  PV-HYPHEN-2ND       PIC X.                           01040000
               10  PV-FRMT-DATE-CCYY   PIC X(4).                        01050000
                                                                        01060001
           05  PV-KY-DTE               PIC X(10).                       01070003
                                                                        01080003
           05  PV-REPORT-TOTALS.                                        01090001
               10  PV-RPT-BYR-RTL-AMT  PIC S9(12)V99.                   01100013
               10  PV-RPT-BYR-COST-AMT PIC S9(12)V99.                   01110013
                                                                        01120001
               10  PV-RPT-DEPT-RTL-AMT PIC S9(12)V99.                   01130013
               10  PV-RPT-DEPT-COST-AMT                                 01140001
                                       PIC S9(12)V99.                   01150013
                                                                        01160001
               10  PV-RPT-MAJ-CL-RTL-AMT                                01170013
                                       PIC S9(12)V99.                   01180013
               10  PV-RPT-MAJ-CL-COST-AMT                               01190013
                                       PIC S9(12)V99.                   01200013
                                                                        01210013
           05  PV-PREV-KEY-DATA.                                        01220013
               10  PV-PREV-BYR-NBR     PIC X(03).                       01230001
               10  PV-PREV-DEPT-NBR    PIC X(03).                       01240001
               10  PV-PREV-MAJ-CL-NBR  PIC X(02).                       01250013
           05  PV-PREV-OTHER-DATA.                                      01260021
               10  PV-PREV-BYR-FIR-NAME                                 01270021
                                       PIC X(12).                       01280022
               10  PV-PREV-BYR-LAST-NAME                                01290021
                                       PIC X(18).                       01300022
               10  PV-PREV-DEPT-DESC   PIC X(25).                       01310022
               10  PV-PREV-MAJ-CL-DESC PIC X(25).                       01320022
                                                                        01330001
           05  PV-FRMT-BUYER-DATA.                                      01340001
               10  PV-FRMT-BYR-NBR     PIC X(03).                       01350001
               10  PV-FRMT-BYR-HYPHEN  PIC X(01).                       01360001
               10  PV-FRMT-BYR-NAME    PIC X(31).                       01370001
           05  PV-FRMT-DEPT-DATA.                                       01380001
               10  PV-FRMT-DEPT-NBR    PIC X(03).                       01390001
               10  PV-FRMT-DEPT-HYPHEN PIC X(01).                       01400001
               10  PV-FRMT-DEPT-DESC   PIC X(25).                       01410001
           05  PV-FRMT-MAJ-CL-NMBR.                                     01420016
               10  FILLER              PIC X.                           01430015
               10  PV-FRMT-MAJ-CL-NMBR-2                                01440016
                                       PIC X.                           01450015
           05  PV-MAJ-CL-NBR           PIC XX.                          01460015
                                                                        01470015
           05  PV-FRMT-MAJ-CL-DATA.                                     01480013
               10  PV-FRMT-MAJ-CL-NBR  PIC X(02).                       01490013
               10  PV-FRMT-MAJ-CL-HYPHEN                                01500013
                                       PIC X(01).                       01510013
               10  PV-FRMT-MAJ-CL-DESC PIC X(25).                       01520013
           05  PV-FRMT-SUB-CL-DATA.                                     01530013
               10  PV-FRMT-SUB-CL-NBR  PIC X(02).                       01540013
               10  PV-FRMT-SUB-CL-HYPHEN                                01550013
                                       PIC X(01).                       01560001
               10  PV-FRMT-SUB-CL-DESC PIC X(25).                       01570013
                                                                        01580000
       EJECT                                                            01590000
                                                                        01600000
       01 ABEND-AREAS.                                                  01610000
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           01620000
                                                   COMP SYNC.           01630000
               88  AC-BAD-DATA                     VALUE +4003.         01640000
               88  AC-DB2-ERROR                    VALUE +4013.         01650000
           05  AA-ABEND-LIT            PIC X(40)   VALUE                01660000
                 '*****       ABEND'.                                   01670000
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                01680000
                   '*****   PROGRAM: MLKRP211'.                         01690000
           05  AA-PARAGRAPH-LIT.                                        01700000
               10  FILLER              PIC X(17)   VALUE                01710000
                   '***** PARAGRAPH: '.                                 01720000
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        01730000
           05  AA-MESSAGE-LINE.                                         01740000
               10  FILLER              PIC X(06)   VALUE '*****'.       01750000
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        01760000
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                01770000
                   '*****    DB2 ERROR'.                                01780000
           05  AA-DB2-OPERATION-LIT.                                    01790000
               10  FILLER              PIC X(17)   VALUE                01800000
                   '***** OPERATION: '.                                 01810000
               10  AA-DB2-OPERATION.                                    01820000
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        01830000
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        01840000
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        01850000
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        01860000
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        01870000
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        01880000
                                                                        01890000
       EJECT                                                            01900000
                                                                        01910000
      *** INPUT CONTROL RECORD                                          01920001
       01  CC-CONTROL-CARD.                                             01930001
           05  CC-EXTR-START-CCYY-MM-DD                                 01940001
                                       PIC X(10).                       01950001
           05  FILLER                  PIC X(70).                       01960031
                                                                        01970001
      *** REPORT EXTRACT RECORDS                                        01980000
           COPY MLRD113.                                                01990023
                                                                        02000000
       EJECT                                                            02010000
                                                                        02020000
      ******************************************************************02030000
      ***  STANDARD REPORT HEADING                                      02040000
      ******************************************************************02050000
                                                                        02060000
           COPY DPWS150O.                                               02070023
                                                                        02080000
      ******************************************************************02090000
      ***  REPORT TITLE LINES                                           02100000
      ******************************************************************02110000
       01  HD-REPORT-TITLE-2.                                           02120000
           05  FILLER                  PIC X       VALUE SPACE.         02130000
           05  FILLER                  PIC X(55)   VALUE SPACES.        02140001
           05  FILLER                  PIC X(39)                        02150000
W28545         VALUE ' SKU RECLASS FINANCIAL REPORT BY BUYER'.          02160000
           05  FILLER                  PIC X(55)   VALUE SPACES.        02170001
                                                                        02180000
       01  HD-REPORT-TITLE-3.                                           02190000
           05  FILLER                  PIC X       VALUE SPACE.         02200000
           05  FILLER                  PIC X(58)   VALUE SPACES.        02210030
           05  FILLER                  PIC X(04)   VALUE 'FOR '.        02220013
           05  HD-T3-FROM-MM-DD-CCYY   PIC X(10).                       02230000
           05  FILLER                  PIC X(16)                        02240013
                                       VALUE ' - BATCH NUMBER '.        02250013
           05  HD-T3-CR-BATCH-NBR      PIC X(03)   VALUE SPACES.        02260036
           05  FILLER                  PIC X(03)   VALUE ' - '.         02261036
           05  HD-T3-DR-BATCH-NBR      PIC X(03)   VALUE SPACES.        02262036
           05  FILLER                  PIC X(52)   VALUE SPACES.        02270036
                                                                        02280000
      ******************************************************************02290000
      ***  REPORT COLUMN HEADING LINES                                  02300000
      ******************************************************************02310000
       01  HD-COLUMN-HEADING-1.                                         02320000
           05  FILLER                  PIC X(30)   VALUE 'BUYER'.       02330014
           05  FILLER                  PIC X       VALUE SPACE.         02340014
           05  FILLER                  PIC X(25)   VALUE 'DEPARTMENT'.  02350014
           05  FILLER                  PIC X       VALUE SPACE.         02360014
           05  FILLER                  PIC X(25)   VALUE 'CLASS'.       02370014
           05  FILLER                  PIC X       VALUE SPACE.         02380014
           05  FILLER                  PIC X(25)   VALUE 'SUBCLASS'.    02390014
           05  FILLER                  PIC X(14)   VALUE SPACE.         02400014
           05  FILLER                  PIC X(06)   VALUE 'RETAIL'.      02410001
           05  FILLER                  PIC X(17)   VALUE SPACE.         02420014
           05  FILLER                  PIC X(04)   VALUE 'COST'.        02430001
           05  FILLER                  PIC X(01)   VALUE SPACE.         02440001
                                                                        02450000
      ******************************************************************02460000
      ***  REPORT DETAIL LINES                                          02470000
      ******************************************************************02480000
       01  DL-LINE-1.                                                   02490000
           05  DL-BUYER                PIC X(30).                       02500014
           05  FILLER                  PIC X       VALUE SPACE.         02510014
           05  DL-DEPARTMENT           PIC X(25).                       02520014
           05  FILLER                  PIC X       VALUE SPACE.         02530014
           05  DL-MAJ-CL               PIC X(25).                       02540014
           05  FILLER                  PIC X       VALUE SPACE.         02550014
           05  DL-SUB-CL               PIC X(25).                       02560014
           05  FILLER                  PIC X(02)   VALUE SPACE.         02570014
           05  DL-RETAIL               PIC ZZZ,ZZZ,ZZZ,ZZ9.99-.         02580013
           05  FILLER                  PIC X(02)   VALUE SPACE.         02590014
           05  DL-COST                 PIC ZZZ,ZZZ,ZZZ,ZZ9.99-.         02600013
                                                                        02610000
      ******************************************************************02620000
      ***  REPORT END OF REPORT LINE                                    02630000
      ******************************************************************02640000
       01  ER-END-OF-REPORT-LINE.                                       02650000
           05  FILLER                  PIC X(21)   VALUE                02660000
                                          '*** END OF REPORT ***'.      02670000
                                                                        02680000
       EJECT                                                            02690000
                                                                        02700000
      ******************************************************************02710005
      *  DB2 COMMUNICATION AREA                                         02720005
      ******************************************************************02730005
           EXEC SQL                                                     02740005
                INCLUDE SQLCA                                           02750005
           END-EXEC.                                                    02760005
                                                                        02770005
      ******************************************************************02780002
      *  DB2 ERROR MESSAGES FORMAT AREA.                                02790002
      ******************************************************************02800002
           COPY DPWS004.                                                02810002
                                                                        02820002
      ******************************************************************02830005
      *  DB2 DTATTR TABLE LAYOUT                                        02840005
      ******************************************************************02850005
           EXEC SQL                                                     02860005
                INCLUDE TDTATTR                                         02870005
           END-EXEC.                                                    02880005
                                                                        02890005
       EJECT                                                            02900002
                                                                        02910002
      ******************************************************************02920000
       PROCEDURE DIVISION.                                              02930000
      ******************************************************************02940000
                                                                        02950000
      ******************************************************************02960000
       0000-MAINLINE-MLKRP211.                                          02970029
      ******************************************************************02980000
      *                                                                 02990000
           PERFORM 1000-INITIALIZATION.                                 03000029
                                                                        03010000
           PERFORM 2000-MAIN-PROCESS.                                   03020029
                                                                        03030000
           PERFORM 8000-EOJ.                                            03040029
                                                                        03050000
           STOP RUN.                                                    03060000
                                                                        03070000
       EJECT                                                            03080000
                                                                        03090000
      ******************************************************************03100000
       1000-INITIALIZATION.                                             03110029
      ******************************************************************03120000
      *                                                                 03130000
           OPEN INPUT  CONTROL-FILE                                     03140000
                       RPT-EXTRACT-FILE.                                03150000
           OPEN OUTPUT SKU-RENUM-BUYER-REPORT.                          03160000
                                                                        03170000
           PERFORM 4000-READ-CONTROL-FILE.                              03180029
                                                                        03190000
           DISPLAY ' '.                                                 03200000
           DISPLAY '*** CONTROL CARD VALUES FOR MLKRP211 FOLLOW ***'.   03210001
           DISPLAY CC-CONTROL-CARD.                                     03220001
                                                                        03230000
           PERFORM 1100-EDIT-CONTROL-CARD.                              03240029
                                                                        03250001
           INITIALIZE PV-PROGRAM-VARIABLES.                             03260006
                                                                        03270006
           MOVE '-'                    TO PV-FRMT-BYR-HYPHEN            03280006
                                          PV-FRMT-DEPT-HYPHEN           03290006
                                          PV-FRMT-MAJ-CL-HYPHEN         03300013
                                          PV-FRMT-SUB-CL-HYPHEN.        03310013
                                                                        03320006
       EJECT                                                            03330000
                                                                        03340000
      ******************************************************************03350001
       1100-EDIT-CONTROL-CARD.                                          03360029
      ******************************************************************03370001
      *                                                                 03380001
           MOVE PC-N                   TO PS-TDTATTR-FOUND.             03390001
           MOVE CC-EXTR-START-CCYY-MM-DD                                03400001
                                       TO PV-KY-DTE.                    03410001
                                                                        03420001
           PERFORM 7000-SELECT-TDTATTR-FOR-EDIT.                        03430029
                                                                        03440001
           IF PS-TDTATTR-IS-NOT-FOUND                                   03450001
               MOVE '1100-EDIT-CONTROL-CARD'                            03460029
                                       TO AA-PARAGRAPH-NAME             03470001
               MOVE 'CTL CARD START DATE IS INVALID'                    03480001
                                       TO AA-MESSAGE                    03490001
               MOVE +4002              TO ABEND-CODE                    03500001
               PERFORM 9900-COMMON-ABEND-ROUTINE                        03510029
           END-IF.                                                      03520001
                                                                        03530001
       EJECT                                                            03540001
                                                                        03550001
      ******************************************************************03560000
       2000-MAIN-PROCESS.                                               03570029
      ******************************************************************03580000
      *                                                                 03590000
           PERFORM 4100-READ-RPT-EXTRACT-FILE.                          03600029
                                                                        03610000
           IF PS-MORE-EXTR-RECS                                         03620001
               MOVE ML113-BYR-NBR      TO PV-PREV-BYR-NBR               03630001
               MOVE ML113-DEPT-NBR     TO PV-PREV-DEPT-NBR              03640001
                                                                        03650015
               MOVE ML113-SUB-CL-NBR   TO PV-FRMT-MAJ-CL-NMBR           03660016
               MOVE ZERO               TO PV-FRMT-MAJ-CL-NMBR-2         03670016
               MOVE PV-FRMT-MAJ-CL-NMBR                                 03680016
                                       TO PV-MAJ-CL-NBR                 03690016
                                                                        03700015
               MOVE PV-MAJ-CL-NBR      TO PV-PREV-MAJ-CL-NBR            03710015
                                                                        03720021
               MOVE ML113-BYR-FIR-NAME TO PV-PREV-BYR-FIR-NAME          03730021
               MOVE ML113-BYR-LAST-NAME                                 03740021
                                       TO PV-PREV-BYR-LAST-NAME         03750021
               MOVE ML113-DEPT-DESC    TO PV-PREV-DEPT-DESC             03760021
               MOVE ML113-MAJ-CL-DESC  TO PV-PREV-MAJ-CL-DESC           03770021
           END-IF.                                                      03780001
                                                                        03790001
           PERFORM 2100-BUILD-REPORT-TITLE.                             03800029
                                                                        03810013
           PERFORM 6000-WRITE-REPORT-TITLE.                             03820029
                                                                        03830013
           PERFORM                                                      03840000
             UNTIL PS-NO-MORE-EXTR-RECS                                 03850000
               PERFORM 3000-CREATE-REPORT                               03860029
               PERFORM 4100-READ-RPT-EXTRACT-FILE                       03870029
           END-PERFORM.                                                 03880000
                                                                        03890000
       EJECT                                                            03900000
                                                                        03910000
      ******************************************************************03920013
       2100-BUILD-REPORT-TITLE.                                         03930029
      ******************************************************************03940013
      *                                                                 03950013
           ACCEPT PV-DATE-YYMMDD FROM DATE.                             03960013
           MOVE PV-DATE-YYMMDD-YY      TO DP150O-RUN-YEAR.              03970013
           MOVE PV-DATE-YYMMDD-MM      TO DP150O-RUN-MONTH.             03980013
           MOVE PV-DATE-YYMMDD-DD      TO DP150O-RUN-DAY.               03990013
           ACCEPT PV-TIME-HHMMSS FROM TIME.                             04000013
           MOVE PV-TIME-HHMMSS-HH      TO DP150O-RUN-HOUR.              04010013
           MOVE PV-TIME-HHMMSS-MM      TO DP150O-RUN-MINUTE.            04020013
           MOVE 'MLKRP211'             TO DP150O-PROGRAM-NAME.          04030013
           MOVE 1                      TO DP150O-REPORT-NUMBER.         04040013
                                                                        04050013
           MOVE CC-EXTR-START-CCYY-MM-DD                                04060013
                                       TO PV-SPLIT-DATE.                04070013
           MOVE PV-SPLIT-DATE-CCYY     TO PV-FRMT-DATE-CCYY.            04080013
           MOVE PV-SPLIT-DATE-MM       TO PV-FRMT-DATE-MM.              04090013
           MOVE PV-SPLIT-DATE-DD       TO PV-FRMT-DATE-DD.              04100013
           MOVE '-'                    TO PV-HYPHEN-1ST                 04110013
                                          PV-HYPHEN-2ND.                04120013
           MOVE PV-FRMT-DATE           TO HD-T3-FROM-MM-DD-CCYY.        04130013
                                                                        04140013
           IF PS-MORE-EXTR-RECS                                         04150013
               MOVE PC-D               TO HD-T3-DR-BATCH-NBR(1:1)       04151032
               MOVE ML113-BATCH-NBR(2:2)                                04160032
                                       TO HD-T3-DR-BATCH-NBR(2:2)       04160132
               MOVE PC-C               TO HD-T3-CR-BATCH-NBR(1:1)       04160232
               MOVE ML113-BATCH-NBR(2:2)                                04160332
                                       TO HD-T3-CR-BATCH-NBR(2:2)       04161035
           ELSE                                                         04170027
               MOVE SPACES             TO HD-T3-DR-BATCH-NBR            04180032
                                          HD-T3-CR-BATCH-NBR            04181032
           END-IF.                                                      04190013
                                                                        04200013
       EJECT                                                            04210013
                                                                        04220013
      ******************************************************************04230000
       3000-CREATE-REPORT.                                              04240029
      ******************************************************************04250000
      *                                                                 04260000
           MOVE ML113-SUB-CL-NBR       TO PV-FRMT-MAJ-CL-NMBR.          04270016
           MOVE ZERO                   TO PV-FRMT-MAJ-CL-NMBR-2.        04280016
           MOVE PV-FRMT-MAJ-CL-NMBR    TO PV-MAJ-CL-NBR.                04290016
                                                                        04300015
           IF ML113-BYR-NBR NOT = PV-PREV-BYR-NBR                       04310001
               PERFORM 6200-WRITE-MAJ-CL-TOTAL                          04320029
               PERFORM 6300-WRITE-DEPT-TOTAL                            04330029
               PERFORM 6400-WRITE-BYR-TOTAL                             04340029
               MOVE 0                  TO PV-PAGE-COUNT                 04350004
               PERFORM 6000-WRITE-REPORT-TITLE                          04360029
           ELSE                                                         04370001
               IF ML113-DEPT-NBR NOT = PV-PREV-DEPT-NBR                 04380001
                   PERFORM 6200-WRITE-MAJ-CL-TOTAL                      04390029
                   PERFORM 6300-WRITE-DEPT-TOTAL                        04400029
               ELSE                                                     04410013
                   IF PV-MAJ-CL-NBR NOT = PV-PREV-MAJ-CL-NBR            04420015
                       PERFORM 6200-WRITE-MAJ-CL-TOTAL                  04430029
                   END-IF                                               04440013
               END-IF                                                   04450001
           END-IF.                                                      04460001
                                                                        04470000
           PERFORM 6100-WRITE-SUB-CL-TOTAL.                             04480029
                                                                        04490001
           MOVE ML113-BYR-NBR          TO PV-PREV-BYR-NBR.              04500001
           MOVE ML113-DEPT-NBR         TO PV-PREV-DEPT-NBR.             04510001
           MOVE PV-MAJ-CL-NBR          TO PV-PREV-MAJ-CL-NBR.           04520015
                                                                        04530001
           MOVE ML113-BYR-FIR-NAME     TO PV-PREV-BYR-FIR-NAME.         04540021
           MOVE ML113-BYR-LAST-NAME    TO PV-PREV-BYR-LAST-NAME.        04550021
           MOVE ML113-DEPT-DESC        TO PV-PREV-DEPT-DESC.            04560021
           MOVE ML113-MAJ-CL-DESC      TO PV-PREV-MAJ-CL-DESC.          04570021
                                                                        04580021
       EJECT                                                            04590000
                                                                        04600000
      ******************************************************************04610029
       4000-READ-CONTROL-FILE.                                          04620029
      ******************************************************************04630029
      *                                                                 04640029
           READ CONTROL-FILE                                            04650029
             INTO CC-CONTROL-CARD                                       04660029
               AT END                                                   04670029
                 MOVE '4000-READ-CONTROL-FILE'                          04680029
                                       TO AA-PARAGRAPH-NAME             04690029
                 MOVE 'CONTROL CARD IS MISSING'                         04700029
                                       TO AA-MESSAGE                    04710029
                 MOVE +4001            TO ABEND-CODE                    04720029
                 PERFORM 9900-COMMON-ABEND-ROUTINE                      04730029
           END-READ.                                                    04740029
                                                                        04750029
       EJECT                                                            04760029
                                                                        04770029
      ******************************************************************04780029
       4100-READ-RPT-EXTRACT-FILE.                                      04790029
      ******************************************************************04800029
      *                                                                 04810029
           READ RPT-EXTRACT-FILE                                        04820029
             INTO ML113-SKU-RNMBR-BYR-EXTRACT                           04830029
               AT END                                                   04840029
                   SET PS-NO-MORE-EXTR-RECS                             04850029
                                       TO TRUE                          04860029
           END-READ.                                                    04870029
                                                                        04880029
           IF PS-MORE-EXTR-RECS                                         04890029
               ADD 1                   TO PA-EXTR-RECORDS-READ          04900029
           END-IF.                                                      04910029
                                                                        04920029
       EJECT                                                            04930029
                                                                        04940029
      ******************************************************************04950000
       6000-WRITE-REPORT-TITLE.                                         04960029
      ******************************************************************04970000
      *                                                                 04980000
           ADD 1                       TO PV-PAGE-COUNT.                04990000
           MOVE PV-PAGE-COUNT          TO DP150O-PAGE-NUMBER.           05000001
                                                                        05010000
           WRITE SKU-RENUM-BUYER-REC FROM DP150O-STANDRD-HEADER-150-COLS05020001
               AFTER ADVANCING PAGE.                                    05030000
                                                                        05040000
           WRITE SKU-RENUM-BUYER-REC FROM HD-REPORT-TITLE-2             05050000
               AFTER ADVANCING 1 LINE.                                  05060000
                                                                        05070000
           WRITE SKU-RENUM-BUYER-REC FROM HD-REPORT-TITLE-3             05080000
               AFTER ADVANCING 1 LINE.                                  05090000
                                                                        05100000
           WRITE SKU-RENUM-BUYER-REC FROM HD-COLUMN-HEADING-1           05110000
               AFTER ADVANCING 2 LINES.                                 05120000
                                                                        05130000
           MOVE +5                     TO PV-LINE-COUNT.                05140001
                                                                        05150000
       EJECT                                                            05160000
                                                                        05170000
      ******************************************************************05180029
       6100-WRITE-SUB-CL-TOTAL.                                         05190029
      ******************************************************************05200029
      *                                                                 05210029
           IF PV-LINE-COUNT > PC-MAX-LINE-COUNT                         05220029
               PERFORM 6000-WRITE-REPORT-TITLE.                         05230029
                                                                        05240029
           MOVE SPACES                 TO DL-BUYER                      05250029
                                          DL-DEPARTMENT                 05260029
                                          DL-MAJ-CL.                    05270029
                                                                        05280029
      * LINE COUNT = 5 INDICATES THE FIRST DETAIL LINE ON A PAGE.       05290029
           IF PV-LINE-COUNT = 5                                         05300029
               PERFORM 6910-NEW-PAGE-DTL-LINE-LBLS                      05310029
           ELSE                                                         05320029
               PERFORM 6920-CK-3-DIFF-BREAK-LBLS                        05330029
           END-IF.                                                      05340029
                                                                        05350029
           MOVE ML113-SUB-CL-NBR       TO PV-FRMT-SUB-CL-NBR.           05360029
           MOVE ML113-SUB-CL-DESC      TO PV-FRMT-SUB-CL-DESC.          05370029
           MOVE PV-FRMT-SUB-CL-DATA    TO DL-SUB-CL.                    05380029
                                                                        05390029
           MOVE ML113-RTL-AMT          TO DL-RETAIL.                    05400029
           MOVE ML113-COST-AMT         TO DL-COST.                      05410029
                                                                        05420029
           WRITE SKU-RENUM-BUYER-REC FROM DL-LINE-1                     05430029
               AFTER ADVANCING 2 LINE.                                  05440029
           ADD 2                       TO PV-LINE-COUNT.                05450029
                                                                        05460029
           ADD ML113-RTL-AMT           TO PV-RPT-MAJ-CL-RTL-AMT.        05470029
           ADD ML113-COST-AMT          TO PV-RPT-MAJ-CL-COST-AMT.       05480029
                                                                        05490029
       EJECT                                                            05500029
                                                                        05510029
      ******************************************************************05520029
       6200-WRITE-MAJ-CL-TOTAL.                                         05530029
      ******************************************************************05540029
      *                                                                 05550029
           IF PV-LINE-COUNT > PC-MAX-LINE-COUNT                         05560029
               PERFORM 6000-WRITE-REPORT-TITLE.                         05570029
                                                                        05580029
           MOVE SPACES                 TO DL-BUYER                      05590029
                                          DL-DEPARTMENT                 05600029
                                          DL-MAJ-CL.                    05610029
                                                                        05620029
      * LINE COUNT = 5 INDICATES THE FIRST DETAIL LINE ON A PAGE.       05630029
           IF PV-LINE-COUNT = 5                                         05640029
               PERFORM 6930-NEW-PAGE-TOT-LINE-LBLS                      05650029
           END-IF.                                                      05660029
                                                                        05670029
           MOVE '*** CLASS TOTALS ***     '                             05680029
                                       TO DL-SUB-CL.                    05690029
                                                                        05700029
           MOVE PV-RPT-MAJ-CL-RTL-AMT  TO DL-RETAIL.                    05710029
           MOVE PV-RPT-MAJ-CL-COST-AMT TO DL-COST.                      05720029
                                                                        05730029
           WRITE SKU-RENUM-BUYER-REC FROM DL-LINE-1                     05740029
               AFTER ADVANCING 2 LINE.                                  05750029
           ADD 2                       TO PV-LINE-COUNT.                05760029
                                                                        05770029
           MOVE SPACES                 TO SKU-RENUM-BUYER-REC.          05780029
           WRITE SKU-RENUM-BUYER-REC                                    05790029
               AFTER ADVANCING 1 LINE.                                  05800029
           ADD 1                       TO PV-LINE-COUNT.                05810029
                                                                        05820029
           ADD PV-RPT-MAJ-CL-RTL-AMT   TO PV-RPT-DEPT-RTL-AMT.          05830029
           ADD PV-RPT-MAJ-CL-COST-AMT  TO PV-RPT-DEPT-COST-AMT.         05840029
                                                                        05850029
           MOVE ZERO                   TO PV-RPT-MAJ-CL-RTL-AMT         05860029
                                          PV-RPT-MAJ-CL-COST-AMT.       05870029
                                                                        05880029
       EJECT                                                            05890029
                                                                        05900029
      ******************************************************************05910029
       6300-WRITE-DEPT-TOTAL.                                           05920029
      ******************************************************************05930029
      *                                                                 05940029
           IF PV-LINE-COUNT > PC-MAX-LINE-COUNT                         05950029
               PERFORM 6000-WRITE-REPORT-TITLE.                         05960029
                                                                        05970029
           MOVE SPACES                 TO DL-BUYER                      05980029
                                          DL-DEPARTMENT                 05990029
                                          DL-MAJ-CL.                    06000029
                                                                        06010029
      * LINE COUNT = 5 INDICATES THE FIRST DETAIL LINE ON A PAGE.       06020029
           IF PV-LINE-COUNT = 5                                         06030029
               PERFORM 6930-NEW-PAGE-TOT-LINE-LBLS                      06040029
           END-IF.                                                      06050029
                                                                        06060029
           MOVE '*** DEPARTMENT TOTALS ***'                             06070029
                                       TO DL-SUB-CL.                    06080029
                                                                        06090029
           MOVE PV-RPT-DEPT-RTL-AMT    TO DL-RETAIL.                    06100029
           MOVE PV-RPT-DEPT-COST-AMT   TO DL-COST.                      06110029
                                                                        06120029
           WRITE SKU-RENUM-BUYER-REC FROM DL-LINE-1                     06130029
               AFTER ADVANCING 2 LINE.                                  06140029
           ADD 2                       TO PV-LINE-COUNT.                06150029
                                                                        06160029
           MOVE SPACES                 TO SKU-RENUM-BUYER-REC.          06170029
           WRITE SKU-RENUM-BUYER-REC                                    06180029
               AFTER ADVANCING 1 LINE.                                  06190029
           ADD 1                       TO PV-LINE-COUNT.                06200029
                                                                        06210029
           ADD PV-RPT-DEPT-RTL-AMT     TO PV-RPT-BYR-RTL-AMT.           06220029
           ADD PV-RPT-DEPT-COST-AMT    TO PV-RPT-BYR-COST-AMT.          06230029
                                                                        06240029
           MOVE ZERO                   TO PV-RPT-DEPT-RTL-AMT           06250029
                                          PV-RPT-DEPT-COST-AMT.         06260029
                                                                        06270029
       EJECT                                                            06280029
                                                                        06290029
      ******************************************************************06300029
       6400-WRITE-BYR-TOTAL.                                            06310029
      ******************************************************************06320029
      *                                                                 06330029
           IF PV-LINE-COUNT > PC-MAX-LINE-COUNT                         06340029
               PERFORM 6000-WRITE-REPORT-TITLE.                         06350029
                                                                        06360029
           MOVE SPACES                 TO DL-BUYER                      06370029
                                          DL-DEPARTMENT                 06380029
                                          DL-MAJ-CL.                    06390029
                                                                        06400029
      * LINE COUNT = 5 INDICATES THE FIRST DETAIL LINE ON A PAGE.       06410029
           IF PV-LINE-COUNT = 5                                         06420029
               PERFORM 6930-NEW-PAGE-TOT-LINE-LBLS                      06430029
           END-IF.                                                      06440029
                                                                        06450029
           MOVE '*** BUYER TOTALS ***     '                             06460029
                                       TO DL-SUB-CL.                    06470029
                                                                        06480029
           MOVE PV-RPT-BYR-RTL-AMT     TO DL-RETAIL.                    06490029
           MOVE PV-RPT-BYR-COST-AMT    TO DL-COST.                      06500029
                                                                        06510029
           WRITE SKU-RENUM-BUYER-REC FROM DL-LINE-1                     06520029
               AFTER ADVANCING 2 LINE.                                  06530029
           ADD 2                       TO PV-LINE-COUNT.                06540029
                                                                        06550029
           MOVE ZERO                   TO PV-RPT-BYR-RTL-AMT            06560029
                                          PV-RPT-BYR-COST-AMT.          06570029
                                                                        06580029
       EJECT                                                            06590029
                                                                        06600029
      ******************************************************************06610029
       6910-NEW-PAGE-DTL-LINE-LBLS.                                     06620029
      ******************************************************************06630029
      *                                                                 06640029
           MOVE ML113-BYR-NBR          TO PV-FRMT-BYR-NBR.              06650029
           MOVE SPACES                 TO PV-FRMT-BYR-NAME.             06660029
           STRING ML113-BYR-FIR-NAME DELIMITED BY '  '                  06670029
                  ' '                                                   06680029
                  ML113-BYR-LAST-NAME DELIMITED BY '  '                 06690029
                  INTO PV-FRMT-BYR-NAME.                                06700029
           MOVE PV-FRMT-BUYER-DATA     TO DL-BUYER.                     06710029
                                                                        06720029
           MOVE ML113-DEPT-NBR         TO PV-FRMT-DEPT-NBR.             06730029
           MOVE ML113-DEPT-DESC        TO PV-FRMT-DEPT-DESC.            06740029
           MOVE PV-FRMT-DEPT-DATA      TO DL-DEPARTMENT.                06750029
                                                                        06760029
           MOVE PV-MAJ-CL-NBR          TO PV-FRMT-MAJ-CL-NBR.           06770029
           MOVE ML113-MAJ-CL-DESC      TO PV-FRMT-MAJ-CL-DESC.          06780029
           MOVE PV-FRMT-MAJ-CL-DATA    TO DL-MAJ-CL.                    06790029
                                                                        06800029
       EJECT                                                            06810029
                                                                        06820029
      ******************************************************************06830029
       6920-CK-3-DIFF-BREAK-LBLS.                                       06840029
      ******************************************************************06850029
      *                                                                 06860029
           IF (ML113-BYR-NBR NOT = PV-PREV-BYR-NBR)                     06870029
               MOVE ML113-BYR-NBR      TO PV-FRMT-BYR-NBR               06880029
               MOVE SPACES             TO PV-FRMT-BYR-NAME              06890029
               STRING ML113-BYR-FIR-NAME DELIMITED BY '  '              06900029
                      ' '                                               06910029
                      ML113-BYR-LAST-NAME DELIMITED BY '  '             06920029
                      INTO PV-FRMT-BYR-NAME                             06930029
               MOVE PV-FRMT-BUYER-DATA                                  06940029
                                       TO DL-BUYER                      06950029
           END-IF.                                                      06960029
                                                                        06970029
           IF (ML113-DEPT-NBR NOT = PV-PREV-DEPT-NBR)                   06980029
               MOVE ML113-DEPT-NBR     TO PV-FRMT-DEPT-NBR              06990029
               MOVE ML113-DEPT-DESC    TO PV-FRMT-DEPT-DESC             07000029
               MOVE PV-FRMT-DEPT-DATA  TO DL-DEPARTMENT                 07010029
           END-IF.                                                      07020029
                                                                        07030029
           IF (PV-MAJ-CL-NBR NOT = PV-PREV-MAJ-CL-NBR)                  07040029
               MOVE PV-MAJ-CL-NBR      TO PV-FRMT-MAJ-CL-NBR            07050029
               MOVE ML113-MAJ-CL-DESC  TO PV-FRMT-MAJ-CL-DESC           07060029
               MOVE PV-FRMT-MAJ-CL-DATA                                 07070029
                                       TO DL-MAJ-CL                     07080029
           END-IF.                                                      07090029
                                                                        07100029
       EJECT                                                            07110029
                                                                        07120029
      ******************************************************************07130029
       6930-NEW-PAGE-TOT-LINE-LBLS.                                     07140029
      ******************************************************************07150029
      *                                                                 07160029
           MOVE PV-PREV-BYR-NBR        TO PV-FRMT-BYR-NBR.              07170029
           MOVE SPACES                 TO PV-FRMT-BYR-NAME.             07180029
           IF (PV-PREV-BYR-FIR-NAME = SPACES)                           07190029
             AND (PV-PREV-BYR-LAST-NAME = SPACES)                       07200029
               MOVE SPACES             TO DL-BUYER                      07210029
           ELSE                                                         07220029
               STRING PV-PREV-BYR-FIR-NAME DELIMITED BY '  '            07230029
                  ' '                                                   07240029
                  PV-PREV-BYR-LAST-NAME DELIMITED BY '  '               07250029
                  INTO PV-FRMT-BYR-NAME                                 07260029
               MOVE PV-FRMT-BUYER-DATA TO DL-BUYER                      07270029
           END-IF.                                                      07280029
                                                                        07290029
           IF (PV-PREV-DEPT-NBR = SPACES)                               07300029
             AND (PV-PREV-DEPT-DESC = SPACES)                           07310029
               MOVE SPACES             TO DL-DEPARTMENT                 07320029
           ELSE                                                         07330029
               MOVE PV-PREV-DEPT-NBR   TO PV-FRMT-DEPT-NBR              07340029
               MOVE PV-PREV-DEPT-DESC  TO PV-FRMT-DEPT-DESC             07350029
               MOVE PV-FRMT-DEPT-DATA  TO DL-DEPARTMENT                 07360029
           END-IF.                                                      07370029
                                                                        07380029
           IF (PV-PREV-MAJ-CL-NBR = SPACES)                             07390029
             AND (PV-PREV-MAJ-CL-DESC = SPACES)                         07400029
               MOVE SPACES             TO DL-MAJ-CL                     07410029
           ELSE                                                         07420029
               MOVE PV-PREV-MAJ-CL-NBR TO PV-FRMT-MAJ-CL-NBR            07430029
               MOVE PV-PREV-MAJ-CL-DESC                                 07440029
                                       TO PV-FRMT-MAJ-CL-DESC           07450029
               MOVE PV-FRMT-MAJ-CL-DATA                                 07460029
                                       TO DL-MAJ-CL                     07470029
           END-IF.                                                      07480029
                                                                        07490029
       EJECT                                                            07500029
                                                                        07510029
      ******************************************************************07520029
       7000-SELECT-TDTATTR-FOR-EDIT.                                    07530029
      ******************************************************************07540029
      *                                                                 07550029
           EXEC SQL                                                     07560029
               SELECT KY_DTE                                            07570029
                 INTO :DTATTR-KY-DTE                                    07580029
                 FROM TDTATTR                                           07590029
                WHERE (KY_DTE = :PV-KY-DTE)                             07600029
           END-EXEC.                                                    07610029
                                                                        07620029
           EVALUATE TRUE                                                07630029
               WHEN SQLCODE = 0                                         07640029
                   MOVE 'Y'            TO PS-TDTATTR-FOUND              07650029
               WHEN SQLCODE = +100                                      07660029
                   CONTINUE                                             07670029
               WHEN OTHER                                               07680029
                   MOVE '7000-SELECT-TDTATTR-FOR-EDIT'                  07690029
                                       TO AA-PARAGRAPH-NAME             07700029
                   MOVE 'TDTATTR TABLE ERROR'                           07710029
                                       TO AA-MESSAGE                    07720029
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              07730029
                   PERFORM 9901-SQL-ERROR                               07740029
           END-EVALUATE.                                                07750029
                                                                        07760029
       EJECT                                                            07770029
                                                                        07780029
      ******************************************************************07790000
       8000-EOJ.                                                        07800029
      ******************************************************************07810000
      *                                                                 07820000
           PERFORM 6200-WRITE-MAJ-CL-TOTAL.                             07830029
                                                                        07840001
           PERFORM 6300-WRITE-DEPT-TOTAL.                               07850029
                                                                        07860014
           PERFORM 6400-WRITE-BYR-TOTAL.                                07870029
                                                                        07880015
           PERFORM 8100-DISPLAY-PROCESS-SUMMARY.                        07890029
                                                                        07900000
           CLOSE CONTROL-FILE                                           07910015
                 RPT-EXTRACT-FILE                                       07920015
                 SKU-RENUM-BUYER-REPORT.                                07930015
                                                                        07940000
       EJECT                                                            07950000
                                                                        07960000
      ******************************************************************07970015
       8100-DISPLAY-PROCESS-SUMMARY.                                    07980029
      ******************************************************************07990015
      *                                                                 08000015
           DISPLAY ' '.                                                 08010015
           DISPLAY '  PROGRAM MLKRP211 PROCESSING SUMMARY'.             08020015
           DISPLAY '  -----------------------------------'.             08030015
           DISPLAY ' '.                                                 08040015
                                                                        08050015
           MOVE PA-EXTR-RECORDS-READ TO CD-COUNT-HOLD1.                 08060015
           DISPLAY 'DIFFERENCE RECORDS READ = ' CD-COUNT-HOLD1.         08070015
                                                                        08080015
           DISPLAY ' '.                                                 08090015
                                                                        08100015
       EJECT                                                            08110015
                                                                        08120015
      ******************************************************************08130000
       9900-COMMON-ABEND-ROUTINE.                                       08140029
      ******************************************************************08150000
      *                                                                 08160000
           DISPLAY AA-ABEND-LIT.                                        08170000
           DISPLAY AA-PROGRAM-LIT.                                      08180000
           DISPLAY AA-PARAGRAPH-LIT.                                    08190000
           DISPLAY AA-MESSAGE-LINE.                                     08200000
           DISPLAY ABEND-CODE.                                          08210000
                                                                        08220000
           CALL 'ILBOABN0' USING ABEND-CODE.                            08230000
                                                                        08240000
       EJECT                                                            08250001
                                                                        08260001
      ******************************************************************08270001
       9901-SQL-ERROR.                                                  08280029
      ******************************************************************08290001
      *                                                                 08300001
           CLOSE CONTROL-FILE                                           08310001
                 RPT-EXTRACT-FILE                                       08320001
                 SKU-RENUM-BUYER-REPORT.                                08330001
                                                                        08340001
           DISPLAY AA-ABEND-LIT.                                        08350001
           DISPLAY AA-DB2-ERROR-LIT.                                    08360001
           DISPLAY AA-PROGRAM-LIT.                                      08370001
           DISPLAY AA-PARAGRAPH-LIT.                                    08380001
           DISPLAY AA-MESSAGE-LINE.                                     08390001
           DISPLAY AA-DB2-OPERATION-LIT.                                08400001
           SET AC-DB2-ERROR TO TRUE.                                    08410001
           MOVE +4013                  TO ABEND-CODE.                   08420001
                                                                        08430001
           COPY DPPD004.                                                08440001
           CALL 'ILBOABN0' USING ABEND-CODE.                            08450001
                                                                        08460001
