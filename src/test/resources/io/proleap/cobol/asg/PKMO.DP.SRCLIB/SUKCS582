000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    SUKCS582.                                         00040000
000500 AUTHOR.        LARRY SCHLEICHER.                                 00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  DEC, 2001.                                        00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    S582 - UPDATE VENDOR/DEPARTMENT RANKING                     *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER TO UPDATE THE VENDOR RANKING.  *00120000
001300*    THE ENT ID AND VENDOR NAME ARE PROTECTED FIELD.             *00130000
001400*----------------------------------------------------------------*00140000
001500*    CHANGES                                                     *00150000
      *    MADE BY: CHERI PARMLEY        PR#5148D                      *00150100
      *    DATE:    10/01/2013                                         *00150200
      *                                                                *00150300
      *    NEW RANKING 'RFID' WAS ADDED TO THE SCREEN.                 *00150400
      *    CHANGES CAN BE FOUND WITH *CLP 10/01/13                     *00150500
      *                                                                *00150600
001600*----------------------------------------------------------------*00150700
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00150901
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00151001
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00151101
001130*                                                                 00151202
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00151302
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00151402
263968*---------------------------------------------------------------* 00151501
001700*                                                                 00151600
001800 ENVIRONMENT DIVISION.                                            00151700
001900                                                                  00151800
002000                                                                  00152000
002100                                                                  00153000
002200 DATA DIVISION.                                                   00154000
002300                                                                  00155000
002400                                                                  00156000
002500 WORKING-STORAGE SECTION.                                         00157000
002600                                                                  00158000
002700 01  DK-DB2-KEYS.                                                 00159000
002800     05  DK-VENDOR-RANKING-CDE          PIC  X(06)  VALUE SPACE.  00160000
002900     05  DK-ENT-ID                      PIC S9(09)  COMP          00170000
003000                                                    VALUE ZERO.   00180000
003100     05  DK-PKGNG-TYP-CDE               PIC  X(02)  VALUE SPACE.  00190000
003200     05  DK-DEPT-NBR                    PIC S9(04)  COMP-3        00200000
003300                                                    VALUE ZERO.   00210000
003400*                                                                 00220000
003500 01  PC-PROGRAM-CONSTANTS.                                        00230000
003600     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'SUKCS582'.  00240000
003700     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'SU582A  '.  00250000
003800     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'SUKM582 '.  00260000
003900     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00270000
004000                                              COMP.               00280000
004100     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00290000
004200                                              COMP.               00300000
004300     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1           00310000
004400                                              COMP.               00320000
004500     05  PC-UPD-VSAM              PIC  X(01)  VALUE 'Y'.          00330000
004600     05  PC-INTER-APPL-CODES.                                     00340000
004700         10  PC-INTER-APPL-CRIT-SPEC                              00350000
004800                                  PIC  X(01)  VALUE '1'.          00360000
004900         10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '2'.          00370000
005000     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       00380000
005100                                                                  00390000
005200     05  PC-TSYMSG-NUMBERS.                                       00400000
005300         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00410000
005400         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00420000
005500         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00430000
005600         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00440000
005700         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       00450000
005800         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00460000
005900         10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       00470000
006000         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       00480000
006100         10  PC-TSYMSG-02844      PIC  9(05)  VALUE  02844.       00490000
006200         10  PC-TSYMSG-02846      PIC  9(05)  VALUE  02846.       00500000
006300         10  PC-TSYMSG-02847      PIC  9(05)  VALUE  02847.       00510000
006400         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       00520000
006500*                                                                 00530000
006600 01  PS-PROGRAM-SWITCHES.                                         00540000
006700     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00550000
006800         88  PS-ERROR                         VALUE  'Y'.         00560000
006900         88  PS-NO-ERROR                      VALUE  'N'.         00570000
007000     05  PS-RANKING-FOUND-SW      PIC  X(01)  VALUE  'Y'.         00580000
007100         88  PS-RANKING-FOUND                 VALUE  'Y'.         00590000
007200         88  PS-RANKING-NOT-FOUND             VALUE  'N'.         00600000
007300     05  PS-END-OF-RANKINGS-SW    PIC  X(01)  VALUE  'N'.         00610000
007400         88  PS-END-OF-RANKINGS               VALUE  'Y'.         00620000
007500         88  PS-NOT-END-OF-RANKINGS           VALUE  'N'.         00630000
007600     05  PS-ACCESS-SW             PIC  X(01)  VALUE  'N'.         00640000
007700         88  PS-ACCESS-ALLOWED                VALUE  'Y'.         00650000
007800         88  PS-ACCESS-NOT-ALLOWED            VALUE  'N'.         00660000
007900*                                                                 00670000
008000 01  PV-PROGRAM-VARIABLES.                                        00680000
008100     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00690000
008200                                              COMP SYNC.          00700000
008300     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00710000
008400                                              COMP SYNC.          00720000
008500     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            00730000
008600                                              COMP SYNC.          00740000
008700     05  PV-BULK-VND-RNKG-CDE     PIC  X(06).                     00750000
008800     05  PV-PREPACK-VND-RNKG-CDE  PIC  X(06).                     00760000
008900     05  PV-PBS-VND-RNKG-CDE      PIC  X(06).                     00770000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   00780000
008900     05  PV-RFID-VND-RNKG-CDE     PIC  X(06).                     00790000
      *CLP 10/01/13 END   - PR# 5148D                                   00800000
009000     05  PV-BULK-VND-RNKG-DESC    PIC  X(30).                     00810000
009100     05  PV-PREPACK-VND-RNKG-DESC PIC  X(30).                     00820000
009200     05  PV-PBS-VND-RNKG-DESC     PIC  X(30).                     00830000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   00840000
009200     05  PV-RFID-VND-RNKG-DESC    PIC  X(30).                     00850000
      *CLP 10/01/13 END   - PR# 5148D                                   00860000
009300                                                                  00870000
009400     EJECT                                                        00880000
009500**--------------------------------------------------------------**00890000
009600** THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **00900000
009700** SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.         **00910000
009800**--------------------------------------------------------------**00920000
009900     COPY SUWS019.                                                00930000
010000 EJECT                                                            00940000
010100                                                                  00950000
010200*----------------------------------------------------------------*00960000
010300**  SECURITY SUBROUTINE PARAMETERS                                00970000
010400*----------------------------------------------------------------*00980000
010500     COPY DPWS008.                                                00990000
010600*----------------------------------------------------------------*01000000
010700*    MAP LAYOUT                                                  *01010000
010800*----------------------------------------------------------------*01020000
010900                                                                  01030000
011000     COPY SUKM582.                                                01040000
011100                                                                  01050000
011200 EJECT                                                            01060000
011300*----------------------------------------------------------------*01070000
011400*    ATTRIBUTE SETTINGS COPYBOOK.                                *01080000
011500*----------------------------------------------------------------*01090000
011600                                                                  01100000
011700     COPY DPWS015.                                                01110000
011800                                                                  01120000
011900*----------------------------------------------------------------*01130000
012000*    FUNCTION KEYS COPYBOOK                                      *01140000
012100*----------------------------------------------------------------*01150000
012200                                                                  01160000
012300     COPY DPWS016.                                                01170000
012400                                                                  01180000
012500 EJECT                                                            01190000
012600**--------------------------------------------------------------**01200000
012700** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01210000
012800** SUB-ROUTINE (DPKUT100).                                      **01220000
012900**--------------------------------------------------------------**01230000
013000     COPY DPWS010I.                                               01240000
013100 EJECT                                                            01250000
013200**--------------------------------------------------------------**01260000
013400** PARAMETERS FOR CALLING CICS ARCHITECTURE API                 **01280002
013500**--------------------------------------------------------------**01290000
013600     COPY DPWS030.                                                01300000
013600     COPY DPWS930.                                                01301002
013700 EJECT                                                            01310000
013800**--------------------------------------------------------------**01320000
013900*    STANDARD COMMAREA.                                           01330000
014000**--------------------------------------------------------------**01340000
014100                                                                  01350000
014200     COPY DPWS020.                                                01360000
014300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01370000
014400                                                                  01380000
014500***************************************************************** 01390000
014600*    INTER-APPLICATION COMMAREA.                                  01400000
014700***************************************************************** 01410000
014800                                                                  01420000
014900         10  INTER-APPL-COMM-AREA PIC X(200).                     01430000
015000     COPY SUWS017.                                                01440000
015100     COPY SUWS018.                                                01450000
015200***************************************************************** 01460000
015300*    SPECIFIC COMMMAREA FOR SUKCS582.                             01470000
015400***************************************************************** 01480000
015500         10  ASC-SPECIFIC-COMMAREA.                               01490000
015600             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            01500000
015700             15  ASC-ENT-ID.                                      01510000
015800                 20  ASC-ENT-ID-N          PIC  9(09).            01520000
015900             15  ASC-DEPT-NBR.                                    01530000
016000                 20  ASC-DEPT-NBR-N        PIC  9(04).            01540000
016100             15  ASC-VENDOR-DESC           PIC  X(30).            01550000
016200             15  ASC-DEPT-DESC             PIC  X(30).            01560000
016300             15  ASC-HOLD-BULK-RANKING     PIC  X(06).            01570000
016400             15  ASC-HOLD-PRE-PACK-RANKING PIC  X(06).            01580000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   01590000
016500             15  ASC-HOLD-PBS-RANKING      PIC  X(06).            01600000
      *CLP 10/01/13 END   - PR# 5148D                                   01610000
016500             15  ASC-HOLD-RFID-RANKING     PIC  X(06).            01620000
016600             15  ASC-BULK-RANKING          PIC  X(06).            01630000
016700             15  ASC-BULK-RANKING-DESC     PIC  X(30).            01640000
016800             15  ASC-PRE-PACK-RANKING      PIC  X(06).            01650000
016900             15  ASC-PRE-PACK-RANKING-DESC PIC  X(30).            01660000
017000             15  ASC-PBS-RANKING           PIC  X(06).            01670000
017100             15  ASC-PBS-RANKING-DESC      PIC  X(30).            01680000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   01690000
017000             15  ASC-RFID-RANKING          PIC  X(06).            01700000
017100             15  ASC-RFID-RANKING-DESC     PIC  X(30).            01710000
      *CLP 10/01/13 END   - PR# 5148D                                   01711000
017200             15  ASC-USE-SELECTION-QUEUE-IND                      01712000
017300                                           PIC  X(01).            01713000
017400                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 01714000
017500             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            01715000
017600             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    01716000
017700             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01717000
017800                                           PIC S9(09)  COMP-3.    01718000
017900             15  ASC-SEL-SUB               PIC S9(04)  COMP.      01719000
018000             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      01720000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   01730000
018100         10  FILLER                        PIC  X(2602).          01740000
      *CLP 10/01/13 END   - PR# 5148D                                   01750000
018200     EJECT                                                        01760000
018300*----------------------------------------------------------------*01770000
018400*    ABEND PROCESSING COPYBOOK.                                  *01780000
018500*----------------------------------------------------------------*01790000
018600                                                                  01800000
018700     COPY DPWS013.                                                01810000
018800                                                                  01820000
018900 EJECT                                                            01830000
019000                                                                  01840000
019100*----------------------------------------------------------------*01850000
019200*    DB2 DCLGEN FOR THE VENDOR RANKING CODES                      01860000
019300*    (SUT_VND_RNKG_CDE)                                           01870000
019400*----------------------------------------------------------------*01880000
019500     EXEC SQL                                                     01890000
019600          INCLUDE SUT00016                                        01900000
019700     END-EXEC.                                                    01910000
019800*----------------------------------------------------------------*01920000
019900*    DB2 DCLGEN FOR THE AUDIT PARM TABLE                          01930000
020000*    (SUT_PO_AUD_PARM)                                            01940000
020100*----------------------------------------------------------------*01950000
020200     EXEC SQL                                                     01960000
020300          INCLUDE SUT00017                                        01970000
020400     END-EXEC.                                                    01980000
020500*----------------------------------------------------------------*01990000
020600*    DB2 DCLGEN FOR THE VENDOR RANKING TABLE (SUT_VND_DEPT_RNKG)  02000000
020700*----------------------------------------------------------------*02010000
020800     EXEC SQL                                                     02020000
020900          INCLUDE SUT00018                                        02030000
021000     END-EXEC.                                                    02040000
021100                                                                  02050000
021200*    DB2 AREA FOR COMMUNICATIONS                                  02060000
021300                                                                  02070000
021400     EXEC SQL                                                     02080000
021500          INCLUDE SQLCA                                           02090000
021600     END-EXEC.                                                    02100000
021700                                                                  02110000
021800*---------------------------------------------------------------* 02120000
021900*    CURSOR FOR ALL THE RANKINGS FOR VENDOR                       02130000
022000*---------------------------------------------------------------* 02140000
022100     EXEC SQL                                                     02150000
022200          DECLARE RANKINGS-CSR CURSOR                             02160000
022300          FOR SELECT                                              02170000
022400                B.VND_RNKG_CDE                                    02180000
022500             ,  B.PKGNG_TYP_CDE                                   02190000
022600             ,  C.VND_RNKG_DESC                                   02200000
022700          FROM                                                    02210000
022800                SUT_VND_DEPT_RNKG A                               02220000
022900             ,  SUT_PO_AUD_PARM B                                 02230000
023000             ,  SUT_VND_RNKG_CDE C                                02240000
023100          WHERE                                                   02250000
023200                A.ENT_ID         = :DK-ENT-ID                     02260000
023300            AND A.DEPT_NBR       = :DK-DEPT-NBR                   02270000
023400            AND A.VND_RNKG_CDE   = B.VND_RNKG_CDE                 02280000
023500            AND A.PKGNG_TYP_CDE  = B.PKGNG_TYP_CDE                02290000
023600            AND B.VND_RNKG_CDE   = C.VND_RNKG_CDE                 02300000
023700            AND B.EFF_BEG_TMST IN                                 02310000
023800            (SELECT MAX(C.EFF_BEG_TMST)                           02320000
023900              FROM SUT_PO_AUD_PARM C                              02330000
024000              WHERE C.VND_RNKG_CDE  = B.VND_RNKG_CDE              02340000
024100                AND C.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE)            02350000
024200     END-EXEC.                                                    02360000
024300                                                                  02370000
024400 EJECT                                                            02380000
024500 LINKAGE SECTION.                                                 02390000
024600                                                                  02400000
024700 01  DFHCOMMAREA.                                                 02410000
024800     05  FILLER                         OCCURS  1 TO 4072 TIMES   02420000
024900                                        DEPENDING ON EIBCALEN.    02430000
025000         10  FILLER                     PIC X.                    02440000
025100                                                                  02450000
025200                                                                  02460000
025300 PROCEDURE DIVISION.                                              02470000
025400***************************************************************** 02480000
025500** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02490000
025600** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02500000
025700** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02510000
025800**                                                             ** 02520000
025900** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02530000
026000** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02540000
026100***************************************************************** 02550000
026200 0000-MAIN-MODULE.                                                02560000
026300     INITIALIZE DP030-CICS-API-FIELDS.                            02570000
026400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02580000
026500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02590000
026600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02600000
026700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02610000
026800     MOVE LENGTH OF SU582AI        TO DP030-MAP-LENGTH (1).       02620000
026900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02630000
027000     PERFORM 0001-CALL-CICS-ARCH-API.                             02640000
027100*                                                                 02650000
027200     PERFORM 1000-CONTROL-PROCESSING                              02660000
027300*                                                                 02670000
027400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02680000
027500     PERFORM 0001-CALL-CICS-ARCH-API.                             02690000
027600                                                                  02700000
027700 0001-CALL-CICS-ARCH-API.                                         02710000
027800*    CALL 'DPKCS030' USING DFHEIBLK                               02720002
027800     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02721002
027900                           DFHCOMMAREA                            02730000
028000                           DP030-CICS-API-FIELDS                  02740000
028100                           DP020-STANDARD-COMMAREA                02750000
028200                           SU582AI.                               02760000
028300*                                                                 02770000
028400     IF  DP030-RC-CALL-SUCCESSFUL                                 02780000
028500         CONTINUE                                                 02790000
028600     ELSE                                                         02800000
028700         SET DP013-NO-ROLLBACK                                    02810000
028800             DP013-XCTL-DISPLAY-RESTART                           02820000
028900             DP013-CICS-ABEND      TO TRUE                        02830000
029000         MOVE 'BEFORE 0000-MAIN-MODULE'                           02840000
029100                                   TO DP013-PARAGRAPH             02850000
029200*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX02860002
029300*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      02870002
029200         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL. RETURN-CODE O02871002
029300-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02872002
029400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02880000
029500         PERFORM DP013-0000-PROCESS-ABEND                         02890000
029600     END-IF.                                                      02900000
029700 EJECT                                                            02910000
029800*----------------------------------------------------------------*02920000
029900*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02930000
030000*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02940000
030100*----------------------------------------------------------------*02950000
030200                                                                  02960000
030300 1000-CONTROL-PROCESSING.                                         02970000
030400                                                                  02980000
030500     EVALUATE TRUE                                                02990000
030600         WHEN DP020-NEXT-ACT-INITIAL                              03000000
030700              PERFORM 1100-FIND-OBJECT-KEYS                       03010000
030800              IF  PS-ERROR                                        03020000
030900                  CONTINUE                                        03030000
031000              ELSE                                                03040000
031100                  PERFORM 4000-BUILD-INITIAL-PANEL                03050000
031200                  IF  SQLCODE = +100                              03060000
031300                      SET DP020-NEXT-ACT-APPL-ERROR TO TRUE       03070000
031400                      MOVE PC-TSYMSG-00148                        03080000
031500                                   TO DP020-MSG-NUMBER            03090000
031600                      SET DP020-MSG-INFORMATIONAL TO TRUE         03100000
031700                  END-IF                                          03110000
031800              END-IF                                              03120000
031900                                                                  03130000
032000         WHEN DP020-NEXT-ACT-READ-MAP                             03140000
032100             PERFORM 2000-PROCESS-PANEL                           03150000
032200                                                                  03160000
032300         WHEN DP020-NEXT-ACT-RETURN                               03170000
032400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03180000
032500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03190000
032600                                                                  03200000
032700         WHEN OTHER                                               03210000
032800             SET DP013-LOGIC-ABEND TO TRUE                        03220000
032900             SET DP013-NO-ROLLBACK TO TRUE                        03230000
033000             MOVE '1000-CONTROL-PROCESSING'                       03240000
033100                                   TO DP013-PARAGRAPH             03250000
033200             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03260000
033300                                   TO DP013-MESSAGE-TEXT(1)       03270000
033400             MOVE DP020-NEXT-APPL-ACTIVITY                        03280000
033500                                   TO DP013-MESSAGE-TEXT(2)       03290000
033600             PERFORM DP013-0000-PROCESS-ABEND                     03300000
033700     END-EVALUATE.                                                03310000
033800******************************************************************03320000
033900** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **03330000
034000** INTER-APPLICATION FORMAT CODE.                               **03340000
034100******************************************************************03350000
034200 1100-FIND-OBJECT-KEYS.                                           03360000
034300     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03370000
034400     MOVE DP020-INT-APPL-FORMAT-IND                               03380000
034500                                   TO ASC-INT-APPL-FORMAT-IND.    03390000
034600     EVALUATE DP020-INT-APPL-FORMAT-IND                           03400000
034700         WHEN PC-INTER-APPL-CRIT-SPEC                             03410000
034800             IF  SU017-ENT-ID > ZERO                              03420000
034900                 MOVE SU017-ENT-ID TO ASC-ENT-ID-N                03430000
035000                 MOVE SU017-DEPT-NBR                              03440000
035100                                   TO ASC-DEPT-NBR-N              03450000
035200                 MOVE SU017-VENDOR-DESC                           03460000
035300                                   TO ASC-VENDOR-DESC             03470000
035400                 MOVE SU017-DEPT-DESC                             03480000
035500                                   TO ASC-DEPT-DESC               03490000
035600             ELSE                                                 03500000
035700                 MOVE PC-TSYMSG-00148                             03510000
035800                                   TO DP020-MSG-NUMBER            03520000
035900                 SET DP020-MSG-FATAL                              03530000
036000                     DP020-NEXT-ACT-APPL-ERROR                    03540000
036100                                   TO TRUE                        03550000
036200             END-IF                                               03560000
036300                                                                  03570000
036400         WHEN PC-INTER-APPL-LIST                                  03580000
036500             SET ASC-USE-SELECTION-QUEUE TO TRUE                  03590000
036600             MOVE SU018-NUMBER-OF-SELECTED-ITEMS                  03600000
036700                                   TO ASC-NUMBER-OF-SELECTED-ITEMS03610000
036800             MOVE SU018-NUMBER-OF-TS-ITEMS                        03620000
036900                                   TO ASC-NUMBER-OF-TS-ITEMS      03630000
037000             MOVE SU018-SEL-QUEUE-NAME                            03640000
037100                                   TO ASC-SEL-QUEUE-NAME          03650000
037200             PERFORM 1120-PREPARE-LIST-ENTRY                      03660000
037300                                                                  03670000
037400         WHEN OTHER                                               03680000
037500             IF  DP020-NAV-KEY-DATA > SPACE                       03690000
037600                 PERFORM 1110-EDIT-NAV-KEY                        03700000
037700             ELSE                                                 03710000
037800                 MOVE PC-TSYMSG-00148                             03720000
037900                                   TO DP020-MSG-NUMBER            03730000
038000                 SET DP020-MSG-FATAL                              03740000
038100                     DP020-NEXT-ACT-APPL-ERROR                    03750000
038200                                   TO TRUE                        03760000
038300             END-IF                                               03770000
038400     END-EVALUATE.                                                03780000
038500******************************************************************03790000
038600** EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE   **03800000
038700** COMMAND LINE.  A VALID MESSAGE NUMBER IS THE ONLY KEY        **03810000
038800** ACCEPTED.                                                    **03820000
038900******************************************************************03830000
039000 1110-EDIT-NAV-KEY.                                               03840000
039100     IF  ASC-ENT-ID > SPACE                                       03850000
039200         MOVE DP020-NAV-KEY-DATA   TO DP010I-UNEDITED-FIELD       03860000
039300         MOVE LENGTH OF ASC-ENT-ID                                03870000
039400                                   TO DP010I-MAXIMUM-DIGITS       03880000
039500         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     03890000
039600         SET DP010I-NEGATIVE-NOT-ALLOWED                          03900000
039700                                   TO TRUE                        03910000
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         03921001
263968              USING DP010I-NUMERIC-EDIT-AREA                      03922001
039900         IF  DP010I-ERROR-DETECTED                                03930000
040000             SET PS-ERROR                                         03940000
040100                 DP020-MSG-FATAL   TO TRUE                        03950000
040200*            -- INVALID DATA IN KEY FIELD ---                     03960000
040300             MOVE PC-TSYMSG-00302  TO DP020-MSG-NUMBER            03970000
040400             SET DP020-NEXT-ACT-APPL-ERROR                        03980000
040500                                   TO TRUE                        03990000
040600         ELSE                                                     04000000
040700             MOVE DP010I-NUMERIC-FIELD                            04010000
040800                                   TO ASC-ENT-ID-N                04020000
040900         END-IF                                                   04030000
041000     END-IF.                                                      04040000
041100*----------------------------------------------------------------*04050000
041200* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *04060000
041300* STORAGE QUEUE PASSED FROM THE LIST.                            *04070000
041400*----------------------------------------------------------------*04080000
041500 1120-PREPARE-LIST-ENTRY.                                         04090000
041600     MOVE SU019-MAX-ITEMS          TO ASC-SEL-SUB.                04100000
041700     MOVE ZERO                     TO ASC-SEL-ITEM.               04110000
041800     PERFORM 2110-GET-NEXT-MESSAGE.                               04120000
041900*----------------------------------------------------------------*04130000
042000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04140000
042100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04150000
042200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04160000
042300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04170000
042400* FUNCTION KEYS CAN GET THIS FAR.                                *04180000
042500*----------------------------------------------------------------*04190000
042600                                                                  04200000
042700 2000-PROCESS-PANEL.                                              04210000
042800                                                                  04220000
042900     EVALUATE TRUE                                                04230000
043000                                                                  04240000
043100         WHEN DP020-SRC-AID = DP016-CLEAR                         04250000
043200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04260000
043300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04270000
043400                                                                  04280000
043500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04290000
043600             SET DP030-DONT-ERASE                                 04300000
043700                 DP030-SEND-DATAONLY (PC-APPL-MAP)                04310000
043800                                   TO TRUE                        04320000
043900             PERFORM 4000-BUILD-INITIAL-PANEL                     04330000
044000             PERFORM 3200-RESET-ATTRIBUTES                        04340000
044100                                                                  04350000
044200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04360000
044300             IF  ASC-USE-SELECTION-QUEUE                          04370000
044400                 PERFORM 2110-GET-NEXT-MESSAGE                    04380000
044500                 PERFORM 4000-BUILD-INITIAL-PANEL                 04390000
044600                 PERFORM 3200-RESET-ATTRIBUTES                    04400000
044700             ELSE                                                 04410000
044800*                --- BOTTOM OF LIST ---                           04420000
044900                 MOVE PC-TSYMSG-00070                             04430000
045000                                   TO DP020-MSG-NUMBER            04440000
045100                 SET DP020-MSG-INFORMATIONAL                      04450000
045200                                   TO TRUE                        04460000
045300             END-IF                                               04470000
045400                                                                  04480000
045500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             04490000
045600             IF  ASC-USE-SELECTION-QUEUE                          04500000
045700                 PERFORM 2120-GET-PREV-MESSAGE                    04510000
045800                 PERFORM 4000-BUILD-INITIAL-PANEL                 04520000
045900                 PERFORM 3200-RESET-ATTRIBUTES                    04530000
046000             ELSE                                                 04540000
046100*                --- TOP OF LIST ---                              04550000
046200                 MOVE PC-TSYMSG-00069                             04560000
046300                                   TO DP020-MSG-NUMBER            04570000
046400                 SET DP020-MSG-INFORMATIONAL                      04580000
046500                                   TO TRUE                        04590000
046600             END-IF                                               04600000
046700                                                                  04610000
046800         WHEN OTHER                                               04620000
046900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04630000
047000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04640000
047100             IF  PS-NO-ERROR                                      04650000
047200                 SET DP030-CONTINUE-GO                            04660000
047300                                   TO TRUE                        04670000
047400                 PERFORM 2100-CHECK-FUNCTION-KEY                  04680000
047500             ELSE                                                 04690000
047600                 SET DP030-OVERRIDE-GO                            04700000
047700                                   TO TRUE                        04710000
047800             END-IF                                               04720000
047900     END-EVALUATE.                                                04730000
048000*----------------------------------------------------------------*04740000
048100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04750000
048200* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04760000
048300* FROM THE CICS ARCHITECTURE API.                                *04770000
048400*----------------------------------------------------------------*04780000
048500                                                                  04790000
048600 2100-CHECK-FUNCTION-KEY.                                         04800000
048700     EVALUATE TRUE                                                04810000
048800         WHEN DP020-SRC-AID = DP016-ENTER                         04820000
048900             CONTINUE                                             04830000
049000                                                                  04840000
049100* F15 - UPDATE VENDOR RANK   (LOCAL-FUNC-01)                      04850000
049200*                                                                 04860000
049300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04870000
049400             MOVE 'SUVNDRKU' TO DP008-FUNCTION-NAME               04880000
049500             PERFORM 2105-RACF-ACCESS                             04890000
049600             IF  PS-ACCESS-NOT-ALLOWED                            04900000
049700                 SET  PS-ERROR                                    04910000
049800                      DP020-MSG-FATAL TO TRUE                     04920000
049900                 MOVE PC-TSYMSG-02844 TO DP020-MSG-NUMBER         04930000
050000                 MOVE -1              TO ABULKCPL                 04940000
050100                 SET  DP030-SET-CURSOR-APPL-1 TO TRUE             04950000
050200                 SET DP030-OVERRIDE-GO        TO TRUE             04960000
050300             END-IF                                               04970000
050400             IF PS-NO-ERROR                                       04980000
050500                 SET DP030-CONTINUE-GO TO TRUE                    04990000
050600                 MOVE PC-TSYMSG-02847                             05000000
050700                               TO DP020-MSG-NUMBER                05010000
050800                 SET DP020-MSG-INFORMATIONAL                      05020000
050900                               TO TRUE                            05030000
051000             END-IF                                               05040000
051100                                                                  05050000
051200* F2  - CONFIRM UPDATE                                            05060000
051300*                                                                 05070000
051400         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    05080000
051500             MOVE 'SUVNDRKU' TO DP008-FUNCTION-NAME               05090000
051600             PERFORM 2105-RACF-ACCESS                             05100000
051700             IF  PS-ACCESS-NOT-ALLOWED                            05110000
051800                 SET  PS-ERROR                                    05120000
051900                      DP020-MSG-FATAL TO TRUE                     05130000
052000                 MOVE PC-TSYMSG-02844 TO DP020-MSG-NUMBER         05140000
052100                 MOVE -1              TO ABULKCPL                 05150000
052200                 SET  DP030-SET-CURSOR-APPL-1 TO TRUE             05160000
052300                 SET DP030-OVERRIDE-GO        TO TRUE             05170000
052400             END-IF                                               05180000
052500             IF PS-NO-ERROR                                       05190000
052600                 PERFORM 5000-UPDATE-VENDOR-RANKINGS              05200000
052700*            --- UPDATES SUCCESSFUL ---                           05210000
052800                 MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER        05220000
052900                 SET DP020-MSG-INFORMATIONAL                      05230000
053000                                       TO TRUE                    05240000
053100             END-IF                                               05250000
053200                                                                  05260000
053300                                                                  05270000
053400* F23 - DEPARTMENT LIST (LOCAL-FUNC-02)                           05280000
053500*                                                                 05290000
053600         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              05300000
053700             PERFORM 2130-PREPARE-INTER-APPL-COMM                 05310000
053800                                                                  05320000
053900         WHEN OTHER                                               05330000
054000             SET DP013-NO-ROLLBACK                                05340000
054100                 DP013-XCTL-DISPLAY-RESTART                       05350000
054200                 DP013-CICS-ABEND  TO TRUE                        05360000
054300             MOVE '2000-PROCESS-PANEL'                            05370000
054400                                   TO DP013-PARAGRAPH             05380000
054500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05390000
054600                                   TO DP013-MESSAGE-TEXT (1)      05400000
054700             PERFORM DP013-0000-PROCESS-ABEND                     05410000
054800     END-EVALUATE.                                                05420000
054900                                                                  05430000
055000*----------------------------------------------------------------*05440000
055100* CHECK TO SEE IF USER HAS RACF AUTHORIZATION                     05450000
055200*----------------------------------------------------------------*05460000
055300 2105-RACF-ACCESS.                                                05470000
055400                                                                  05480000
055500      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  05490000
055600      SET DP008-ACCESS-TYPE-USE          TO TRUE                  05500000
055700                                                                  05510000
055800      EXEC CICS                                                   05520000
055900         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 05530000
056000              COMMAREA (DP008-SECURITY-COMMAREA)                  05540000
056100              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             05550000
056200      END-EXEC                                                    05560000
056300                                                                  05570000
056400      IF DP008-CALL-SUCCESSFUL                                    05580000
056500         IF DP008-ACCESS-ALLOWED                                  05590000
056600             SET PS-ACCESS-ALLOWED TO TRUE                        05600000
056700         ELSE                                                     05610000
056800             SET PS-ACCESS-NOT-ALLOWED TO TRUE                    05620000
056900         END-IF                                                   05630000
057000     ELSE                                                         05640000
057100         MOVE '2105-RACF-ACCESS'                                  05650000
057200                               TO DP013-PARAGRAPH                 05660000
057300          MOVE 'UNABLE TO ACCESS CICS'                            05670000
057400                               TO DP013-MESSAGE-TEXT (1)          05680000
057500          MOVE SQLCA                 TO DP013-SQLCA               05690000
057600          SET DP013-DB2-ABEND                                     05700000
057700              DP013-XCTL-DISPLAY-RESTART                          05710000
057800                               TO TRUE                            05720000
057900          PERFORM DP013-0000-PROCESS-ABEND                        05730000
058000      END-IF.                                                     05740000
058100                                                                  05750000
058200 2110-GET-NEXT-MESSAGE.                                           05760000
058300     ADD +1                        TO ASC-SEL-SUB.                05770000
058400     IF  ASC-SEL-SUB > SU019-MAX-ITEMS                            05780000
058500         ADD +1                    TO ASC-SEL-ITEM                05790000
058600         MOVE +1                   TO ASC-SEL-SUB                 05800000
058700     END-IF.                                                      05810000
058800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                05820000
058900         PERFORM 9100-READ-SEL-QUEUE                              05830000
059000         IF  SU019-ITEM (ASC-SEL-SUB) > ZERO                      05840000
059100             MOVE SU019-ENT-ID      (ASC-SEL-SUB)                 05850000
059200                                   TO ASC-ENT-ID-N                05860000
059300             MOVE SU019-DEPT-NBR    (ASC-SEL-SUB)                 05870000
059400                                   TO ASC-DEPT-NBR-N              05880000
059500             MOVE SU019-VENDOR-DESC (ASC-SEL-SUB)                 05890000
059600                                   TO ASC-VENDOR-DESC             05900000
059700             MOVE SU019-DEPT-DESC   (ASC-SEL-SUB)                 05910000
059800                                   TO ASC-DEPT-DESC               05920000
060000             IF SU019-ACTION-SW (ASC-SEL-SUB) = SPACES            05930000
060010                 SET SU019-INQ (ASC-SEL-SUB)                      05940000
060100                                       TO TRUE                    05950000
060200             END-IF                                               05960000
060300             PERFORM 9200-REWRITE-LIST-QUEUE                      05970000
060400         ELSE                                                     05980000
060500             SUBTRACT +1 FROM ASC-SEL-SUB                         05990000
060600*            --- BOTTOM OF LIST ---                               06000000
060700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06010000
060800             SET DP020-MSG-INFORMATIONAL                          06020000
060900                                   TO TRUE                        06030000
061000         END-IF                                                   06040000
061100     ELSE                                                         06050000
061200         SUBTRACT +1 FROM ASC-SEL-ITEM                            06060000
061300         MOVE SU019-MAX-ITEMS      TO ASC-SEL-SUB                 06070000
061400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06080000
061500         SET DP020-MSG-INFORMATIONAL                              06090000
061600                                   TO TRUE                        06100000
061700     END-IF.                                                      06110000
061800******************************************************************06120000
061900** GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED        **06130000
062000** OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.          **06140000
062100******************************************************************06150000
062200 2120-GET-PREV-MESSAGE.                                           06160000
062300     SUBTRACT +1 FROM ASC-SEL-SUB.                                06170000
062400     IF  ASC-SEL-SUB < +1                                         06180000
062500         SUBTRACT +1 FROM ASC-SEL-ITEM                            06190000
062600         MOVE SU019-MAX-ITEMS      TO ASC-SEL-SUB                 06200000
062700     END-IF.                                                      06210000
062800*                                                                 06220000
062900     IF  ASC-SEL-ITEM > ZERO                                      06230000
063000         PERFORM 9100-READ-SEL-QUEUE                              06240000
063100         MOVE SU019-ENT-ID      (ASC-SEL-SUB)                     06250000
063200                                   TO ASC-ENT-ID-N                06260000
063300         MOVE SU019-DEPT-NBR    (ASC-SEL-SUB)                     06270000
063400                                   TO ASC-DEPT-NBR-N              06280000
063500         MOVE SU019-VENDOR-DESC (ASC-SEL-SUB)                     06290000
063600                                   TO ASC-VENDOR-DESC             06300000
063700         MOVE SU019-DEPT-DESC   (ASC-SEL-SUB)                     06310000
063800                                   TO ASC-DEPT-DESC               06320000
063900     ELSE                                                         06330000
064000         MOVE +1                   TO ASC-SEL-ITEM                06340000
064100                                      ASC-SEL-SUB                 06350000
064200*        --- TOP OF LIST ---                                      06360000
064300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06370000
064400         SET DP020-MSG-INFORMATIONAL                              06380000
064500                                   TO TRUE                        06390000
064600     END-IF.                                                      06400000
064700******************************************************************06410000
064800** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **06420000
064900** INTER-APPLICATION COMMAREA.                                  **06430000
065000******************************************************************06440000
065100 2130-PREPARE-INTER-APPL-COMM.                                    06450000
065200     INITIALIZE SU017-INTER-APPL-COMMAREA.                        06460000
065300     MOVE ASC-ENT-ID-N             TO SU017-ENT-ID.               06470000
065400     MOVE ASC-DEPT-NBR-N           TO SU017-DEPT-NBR.             06480000
065500     MOVE ASC-VENDOR-DESC          TO SU017-VENDOR-DESC.          06490000
065600     MOVE ASC-DEPT-DESC            TO SU017-DEPT-DESC.            06500000
065700 EJECT                                                            06510000
065800*----------------------------------------------------------------*06520000
065900* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *06530000
066000* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *06540000
066100* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *06550000
066200*----------------------------------------------------------------*06560000
066300                                                                  06570000
066400 2200-MOVE-SCREEN-TO-COMMAREA.                                    06580000
066500     IF  ABULKCPL > ZERO                                          06590000
066600         MOVE ABULKCPI             TO ASC-BULK-RANKING            06600000
066700     ELSE                                                         06610000
066800         IF  ABULKCPF = DP015-ERASE-EOF                           06620000
066900             MOVE SPACE            TO ASC-BULK-RANKING            06630000
067000         END-IF                                                   06640000
067100     END-IF.                                                      06650000
067200                                                                  06660000
067300     IF  APREPAKL > ZERO                                          06670000
067400         MOVE APREPAKI             TO ASC-PRE-PACK-RANKING        06680000
067500     ELSE                                                         06690000
067600         IF  APREPAKF = DP015-ERASE-EOF                           06700000
067700             MOVE SPACE            TO ASC-PRE-PACK-RANKING        06710000
067800         END-IF                                                   06720000
067900     END-IF.                                                      06730000
068000                                                                  06740000
068100     IF  APACKBSL > ZERO                                          06750000
068200         MOVE APACKBSI             TO ASC-PBS-RANKING             06760000
068300     ELSE                                                         06770000
068400         IF  APACKBSF = DP015-ERASE-EOF                           06780000
068500             MOVE SPACE            TO ASC-PBS-RANKING             06790000
068600         END-IF                                                   06800000
068700     END-IF.                                                      06810000
068000                                                                  06820000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   06830000
068100     IF  ARFIDBSL > ZERO                                          06840000
068200         MOVE ARFIDBSI             TO ASC-RFID-RANKING            06850000
068300     ELSE                                                         06860000
068400         IF  ARFIDBSF = DP015-ERASE-EOF                           06870000
068500             MOVE SPACE            TO ASC-RFID-RANKING            06871000
068600         END-IF                                                   06872000
068700     END-IF.                                                      06873000
      *CLP 10/01/13 END   - PR# 5148D                                   06874000
068800 EJECT                                                            06875000
068900*----------------------------------------------------------------*06876000
069000* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *06877000
069100* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *06878000
069200* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *06879000
069300*----------------------------------------------------------------*06880000
069400                                                                  06890000
069500 3000-EDIT-DATA-IN-COMMAREA.                                      06900000
069600     PERFORM 3200-RESET-ATTRIBUTES.                               06910000
069700     IF ASC-BULK-RANKING NOT = SPACE AND                          06920000
069800        ASC-BULK-RANKING NOT = ASC-HOLD-BULK-RANKING              06930000
069900         MOVE ASC-BULK-RANKING TO DK-VENDOR-RANKING-CDE           06940000
070000         SET PS-RANKING-FOUND TO TRUE                             06950000
070100         PERFORM 3100-SELECT-VEND-RANKING                         06960000
070200         IF PS-RANKING-NOT-FOUND                                  06970000
070300             SET PS-ERROR                                         06980000
070400                 DP020-MSG-FATAL   TO TRUE                        06990000
070500             MOVE PC-TSYMSG-02846  TO DP020-MSG-NUMBER            07000000
070600             MOVE DP015-UNP-ALP-BRT-OFF                           07010000
070700                                   TO ABULKCPA                    07020000
070800             MOVE DP015-RED        TO ABULKCPC                    07030000
070900             MOVE DP015-REVERSE    TO ABULKCPH                    07040000
071000             MOVE -1               TO ABULKCPL                    07050000
071100             SET DP030-SET-CURSOR-APPL-1                          07060000
071200                                   TO TRUE                        07070000
071300         ELSE                                                     07080000
071400             IF ASC-BULK-RANKING = 'DEFALT'                       07090000
071500                 MOVE SPACES       TO ASC-BULK-RANKING-DESC       07100000
071600                                      ABKCPDSO                    07110000
071700             ELSE                                                 07120000
071800                 MOVE SUT00016-VND-RNKG-DESC                      07130000
071900                                   TO ASC-BULK-RANKING-DESC       07140000
072000                                      ABKCPDSO                    07150000
072100             END-IF                                               07160000
072200         END-IF                                                   07170000
072300     ELSE                                                         07180000
072400         IF ASC-BULK-RANKING = SPACE AND                          07190000
072500            ASC-BULK-RANKING NOT = ASC-HOLD-BULK-RANKING          07200000
072600             MOVE 'DEFALT'         TO ASC-BULK-RANKING            07210000
072700                                      ABULKCPO                    07220000
072800             MOVE SPACES           TO ASC-BULK-RANKING-DESC       07230000
072900                                      ABKCPDSO                    07240000
073000     END-IF.                                                      07250000
073100                                                                  07260000
073200     IF ASC-PRE-PACK-RANKING NOT = SPACE AND                      07270000
073300        ASC-PRE-PACK-RANKING NOT = ASC-HOLD-PRE-PACK-RANKING      07280000
073400         MOVE ASC-PRE-PACK-RANKING TO DK-VENDOR-RANKING-CDE       07290000
073500         SET PS-RANKING-FOUND TO TRUE                             07300000
073600         PERFORM 3100-SELECT-VEND-RANKING                         07310000
073700         IF PS-RANKING-NOT-FOUND                                  07320000
073800             SET PS-ERROR                                         07330000
073900                 DP020-MSG-FATAL   TO TRUE                        07340000
074000             MOVE PC-TSYMSG-02846  TO DP020-MSG-NUMBER            07350000
074100             MOVE DP015-UNP-ALP-BRT-OFF                           07360000
074200                                   TO APREPAKA                    07370000
074300             MOVE DP015-RED        TO APREPAKC                    07380000
074400             MOVE DP015-REVERSE    TO APREPAKH                    07390000
074500             MOVE -1               TO APREPAKL                    07400000
074600             SET DP030-SET-CURSOR-APPL-1                          07410000
074700                                   TO TRUE                        07420000
074800         ELSE                                                     07430000
074900             IF ASC-PRE-PACK-RANKING = 'DEFALT'                   07440000
075000                 MOVE SPACES       TO ASC-PRE-PACK-RANKING-DESC   07450000
075100                                      APREPDSO                    07460000
075200             ELSE                                                 07470000
075300                 MOVE SUT00016-VND-RNKG-DESC                      07480000
075400                                   TO ASC-PRE-PACK-RANKING-DESC   07490000
075500                                      APREPDSO                    07500000
075600             END-IF                                               07510000
075700         END-IF                                                   07520000
075800     ELSE                                                         07530000
075900         IF ASC-PRE-PACK-RANKING = SPACE AND                      07540000
076000            ASC-PRE-PACK-RANKING NOT = ASC-HOLD-PRE-PACK-RANKING  07550000
076100             MOVE 'DEFALT'         TO ASC-PRE-PACK-RANKING        07560000
076200                                      APREPAKO                    07570000
076300             MOVE SPACES           TO ASC-PRE-PACK-RANKING-DESC   07580000
076400                                      APREPDSO                    07590000
076500     END-IF.                                                      07600000
076600                                                                  07610000
076700     IF ASC-PBS-RANKING NOT = SPACE AND                           07620000
076800        ASC-PBS-RANKING NOT = ASC-HOLD-PBS-RANKING                07630000
076900         MOVE ASC-PBS-RANKING TO DK-VENDOR-RANKING-CDE            07640000
077000         SET PS-RANKING-FOUND TO TRUE                             07650000
077100         PERFORM 3100-SELECT-VEND-RANKING                         07660000
077200         IF PS-RANKING-NOT-FOUND                                  07670000
077300             SET PS-ERROR                                         07680000
077400                 DP020-MSG-FATAL   TO TRUE                        07690000
077500             MOVE PC-TSYMSG-02846  TO DP020-MSG-NUMBER            07700000
077600             MOVE DP015-UNP-ALP-BRT-OFF                           07710000
077700                                   TO APACKBSA                    07720000
077800             MOVE DP015-RED        TO APACKBSC                    07730000
077900             MOVE DP015-REVERSE    TO APACKBSH                    07740000
078000             MOVE -1               TO APACKBSL                    07750000
078100             SET DP030-SET-CURSOR-APPL-1                          07760000
078200                                   TO TRUE                        07770000
078300         ELSE                                                     07780000
078400             IF ASC-PBS-RANKING = 'DEFALT'                        07790000
078500                 MOVE SPACES       TO ASC-PBS-RANKING-DESC        07800000
078600                                      APKBSDSO                    07810000
078700             ELSE                                                 07820000
078800                 MOVE SUT00016-VND-RNKG-DESC                      07830000
078900                                   TO ASC-PBS-RANKING-DESC        07840000
079000                                      APKBSDSO                    07850000
079100             END-IF                                               07860000
079200         END-IF                                                   07870000
079300     ELSE                                                         07880000
079400         IF ASC-PBS-RANKING = SPACE AND                           07890000
079500            ASC-PBS-RANKING NOT = ASC-HOLD-PBS-RANKING            07900000
079600             MOVE 'DEFALT'         TO ASC-PBS-RANKING             07910000
079700                                      APACKBSO                    07920000
079800             MOVE SPACES           TO ASC-PBS-RANKING-DESC        07930000
079900                                      APKBSDSO                    07940000
080000     END-IF.                                                      07950000
080100                                                                  07960000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   07970000
076700     IF ASC-RFID-RANKING NOT = SPACE AND                          07980000
076800        ASC-RFID-RANKING NOT = ASC-HOLD-RFID-RANKING              07990000
076900         MOVE ASC-RFID-RANKING TO DK-VENDOR-RANKING-CDE           08000000
077000         SET PS-RANKING-FOUND TO TRUE                             08010000
077100         PERFORM 3100-SELECT-VEND-RANKING                         08011000
077200         IF PS-RANKING-NOT-FOUND                                  08012000
077300             SET PS-ERROR                                         08013000
077400                 DP020-MSG-FATAL   TO TRUE                        08014000
077500             MOVE PC-TSYMSG-02846  TO DP020-MSG-NUMBER            08015000
077600             MOVE DP015-UNP-ALP-BRT-OFF                           08016000
077700                                   TO ARFIDBSA                    08017000
077800             MOVE DP015-RED        TO ARFIDBSC                    08018000
077900             MOVE DP015-REVERSE    TO ARFIDBSH                    08019000
078000             MOVE -1               TO ARFIDBSL                    08019100
078100             SET DP030-SET-CURSOR-APPL-1                          08019200
078200                                   TO TRUE                        08019300
078300         ELSE                                                     08019400
078400             IF ASC-RFID-RANKING = 'DEFALT'                       08019500
078500                 MOVE SPACES       TO ASC-RFID-RANKING-DESC       08019600
078600                                      ARFIDDSO                    08019700
078700             ELSE                                                 08019800
078800                 MOVE SUT00016-VND-RNKG-DESC                      08019900
078900                                   TO ASC-RFID-RANKING-DESC       08020000
079000                                      ARFIDDSO                    08020100
079100             END-IF                                               08020200
079200         END-IF                                                   08020300
079300     ELSE                                                         08020400
079400         IF ASC-RFID-RANKING = SPACE AND                          08020500
079500            ASC-RFID-RANKING NOT = ASC-HOLD-RFID-RANKING          08020600
079600             MOVE 'DEFALT'         TO ASC-RFID-RANKING            08020700
079700                                      ARFIDBSO                    08020800
079800             MOVE SPACES           TO ASC-RFID-RANKING-DESC       08020900
079900                                      ARFIDDSO                    08021000
080000     END-IF.                                                      08021100
      *CLP 10/01/13 END   - PR# 5148D                                   08021200
080200*                                                                 08021300
080300     IF  PS-NO-ERROR                                              08021400
080400         MOVE -1                   TO ABULKCPL                    08021500
080500         SET DP030-SET-CURSOR-APPL-1                              08021600
080600                                   TO TRUE                        08021700
080700     END-IF.                                                      08021800
080800 3100-SELECT-VEND-RANKING.                                        08021900
080900     PERFORM                                                      08022000
081000         WITH TEST AFTER                                          08023000
081100         VARYING PV-RETRY-COUNTER                                 08024000
081200         FROM 1 BY 1                                              08025000
081300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08026000
081400                   OR (SQLCODE = ZERO)                            08027000
081500                   OR (SQLCODE = +100))                           08028000
081600*                                                                 08029000
081700         EXEC SQL                                                 08030000
081800             SELECT                                               08040000
081900                 VND_RNKG_DESC                                    08050000
082000             INTO                                                 08060000
082100                 :SUT00016-VND-RNKG-DESC                          08070000
082200             FROM SUT_VND_RNKG_CDE                                08080000
082300             WHERE  VND_RNKG_CDE = :DK-VENDOR-RANKING-CDE         08090000
082400         END-EXEC                                                 08100000
082500                                                                  08110000
082600         EVALUATE TRUE                                            08120000
082700             WHEN SQLCODE = ZERO                                  08130000
082800             WHEN SQLCODE = -904                                  08140000
082900             WHEN SQLCODE = -913                                  08150000
083000                 CONTINUE                                         08160000
083100             WHEN SQLCODE = +100                                  08170000
083200                  SET PS-RANKING-NOT-FOUND TO TRUE                08180000
083300             WHEN SQLWARN0 NOT = SPACES                           08190000
083400             WHEN SQLCODE < ZERO                                  08200000
083500             WHEN SQLCODE > ZERO                                  08210000
083600                 MOVE '3100-SELECT-VEND-RANKING'                  08220000
083700                                   TO DP013-PARAGRAPH             08230000
083800                 MOVE 'SELECT VENDOR RANKING CODE'                08240000
083900                                   TO DP013-MESSAGE-TEXT (1)      08250000
084000                 MOVE DK-VENDOR-RANKING-CDE                       08260000
084100                                   TO DP013-MESSAGE-TEXT (2)      08270000
084200                 MOVE SQLCA        TO DP013-SQLCA                 08280000
084300                 MOVE 'SUT00016'   TO DP013-DB2-TABLE-NAME (1)    08290000
084400                 SET DP013-DB2-ABEND                              08300000
084500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08310000
084600                 PERFORM DP013-0000-PROCESS-ABEND                 08320000
084700         END-EVALUATE                                             08330000
084800     END-PERFORM.                                                 08340000
084900*                                                                 08350000
085000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08360000
085100         MOVE '3100-SELECT-VEND-RANKING'                          08370000
085200                                   TO DP013-PARAGRAPH             08380000
085300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     08390000
085400                                   TO DP013-MESSAGE-TEXT (1)      08400000
085500         MOVE 'SELECT VENDOR RANKING CODE'                        08410000
085600                                   TO DP013-MESSAGE-TEXT (2)      08420000
085700         MOVE DK-VENDOR-RANKING-CDE                               08430000
085800                                   TO DP013-MESSAGE-TEXT (3)      08440000
085900         MOVE SQLCA                TO DP013-SQLCA                 08450000
086000         MOVE 'SUT00016'           TO DP013-DB2-TABLE-NAME (1)    08460000
086100         SET DP013-DB2-ABEND                                      08470000
086200             DP013-XCTL-DISPLAY-RESTART                           08480000
086300                                   TO TRUE                        08490000
086400         PERFORM DP013-0000-PROCESS-ABEND                         08500000
086500     END-IF.                                                      08510000
086600 EJECT                                                            08520000
086700*                                                                 08530000
086800*----------------------------------------------------------------*08540000
086900* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *08550000
087000* MAP.                                                           *08560000
087100*----------------------------------------------------------------*08570000
087200 3200-RESET-ATTRIBUTES.                                           08580000
087300     MOVE DP015-UNP-ALP-NOR-OFF    TO ABULKCPA                    08590000
087400                                      APREPAKA                    08600000
087500                                      APACKBSA                    08610000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   08620000
087500                                      ARFIDBSA.                   08630000
      *CLP 10/01/13 END   - PR# 5148D                                   08640000
087600     MOVE DP015-GREEN              TO ABULKCPC                    08650000
087700                                      APREPAKC                    08660000
087800                                      APACKBSC                    08670000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   08680000
087500                                      ARFIDBSC.                   08690000
      *CLP 10/01/13 END   - PR# 5148D                                   08700000
087900     MOVE DP015-UNDERLINE          TO ABULKCPH                    08710000
088000                                      APREPAKH                    08720000
088100                                      APACKBSH                    08730000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   08740000
088100                                      ARFIDBSH.                   08750000
      *CLP 10/01/13 END   - PR# 5148D                                   08760000
088200*                                                                 08770000
088300*                                                                 08780000
088400*----------------------------------------------------------------*08790000
088500*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *08800000
088600*    ENTRY.                                                      *08810000
088700*----------------------------------------------------------------*08820000
088800                                                                  08830000
088900 4000-BUILD-INITIAL-PANEL.                                        08840000
089000     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        08850000
089100     MOVE -1                       TO ABULKCPL.                   08860000
089200     MOVE ASC-ENT-ID-N             TO DK-ENT-ID.                  08870000
089300     MOVE ASC-DEPT-NBR-N           TO DK-DEPT-NBR.                08880000
089400     PERFORM 4100-PROCESS-RANKINGS-CURSOR.                        08890000
089500     IF  SQLCODE = ZERO                                           08900000
089600         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     08910000
089700     END-IF.                                                      08920000
089800                                                                  08930000
089900 4100-PROCESS-RANKINGS-CURSOR.                                    08940000
090000     MOVE 'DEFALT'  TO PV-BULK-VND-RNKG-CDE                       08950000
090100                       PV-PREPACK-VND-RNKG-CDE                    08960000
090200                       PV-PBS-VND-RNKG-CDE                        08970000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   08980000
090200                       PV-RFID-VND-RNKG-CDE.                      08990000
      *CLP 10/01/13 END   - PR# 5148D                                   09000000
090300     MOVE SPACES    TO PV-BULK-VND-RNKG-DESC                      09010000
090400                       PV-PREPACK-VND-RNKG-DESC                   09020000
090500                       PV-PBS-VND-RNKG-DESC                       09030000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   09040000
090500                       PV-RFID-VND-RNKG-DESC.                     09050000
      *CLP 10/01/13 END   - PR# 5148D                                   09051000
090600     SET PS-NOT-END-OF-RANKINGS TO TRUE.                          09052000
090700     PERFORM 4200-OPEN-RANKINGS-CSR.                              09053000
090800     PERFORM 4250-FETCH-RANKINGS-CSR                              09054000
090900         UNTIL PS-END-OF-RANKINGS.                                09055000
091000     PERFORM 4300-CLOSE-RANKINGS-CSR.                             09056000
091100     MOVE PV-BULK-VND-RNKG-CDE      TO ASC-BULK-RANKING           09057000
091200                                       ASC-HOLD-BULK-RANKING.     09058000
091300     MOVE PV-PREPACK-VND-RNKG-CDE   TO ASC-PRE-PACK-RANKING       09059000
091400                                       ASC-HOLD-PRE-PACK-RANKING. 09060000
091500     MOVE PV-PBS-VND-RNKG-CDE       TO ASC-PBS-RANKING            09070000
091600                                       ASC-HOLD-PBS-RANKING.      09080000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   09090000
091500     MOVE PV-RFID-VND-RNKG-CDE      TO ASC-RFID-RANKING           09100000
091600                                       ASC-HOLD-RFID-RANKING.     09110000
      *CLP 10/01/13 END   - PR# 5148D                                   09120000
091700     MOVE PV-BULK-VND-RNKG-DESC     TO ASC-BULK-RANKING-DESC.     09130000
091800     MOVE PV-PREPACK-VND-RNKG-DESC  TO ASC-PRE-PACK-RANKING-DESC. 09140000
091900     MOVE PV-PBS-VND-RNKG-DESC      TO ASC-PBS-RANKING-DESC.      09150000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   09160000
091900     MOVE PV-RFID-VND-RNKG-DESC     TO ASC-RFID-RANKING-DESC.     09170000
      *CLP 10/01/13 END   - PR# 5148D                                   09180000
092000                                                                  09190000
092100 4200-OPEN-RANKINGS-CSR.                                          09200000
092200     PERFORM                                                      09210000
092300         WITH TEST AFTER                                          09220000
092400         VARYING PV-RETRY-COUNTER                                 09230000
092500         FROM 1 BY 1                                              09240000
092600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09250000
092700                   OR (SQLCODE = ZERO))                           09260000
092800                 MOVE 'CURSOR:  ALL-VENDOR-CSR'                   09270000
092900                                   TO DP013-MESSAGE-TEXT (2)      09280000
093000             EXEC SQL                                             09290000
093100                  OPEN RANKINGS-CSR                               09300000
093200             END-EXEC                                             09310000
093300                                                                  09320000
093400                                                                  09330000
093500         EVALUATE TRUE                                            09340000
093600             WHEN SQLCODE = ZERO                                  09350000
093700             WHEN SQLCODE = -904                                  09360000
093800             WHEN SQLCODE = -913                                  09370000
093900                 CONTINUE                                         09380000
094000             WHEN SQLWARN0 NOT = SPACES                           09390000
094100             WHEN SQLCODE < ZERO                                  09400000
094200             WHEN SQLCODE > ZERO                                  09410000
094300                 MOVE '4200-OPEN-RANKINGS-CSR'                    09420000
094400                                   TO DP013-PARAGRAPH             09430000
094500                 MOVE 'OPEN THE RANKINGS CURSOR - '               09440000
094600                                   TO DP013-MESSAGE-TEXT (1)      09450000
094700                 MOVE SQLCA        TO DP013-SQLCA                 09460000
094800                 MOVE 'SUT00017'   TO DP013-DB2-TABLE-NAME (1)    09470000
094900                 SET DP013-DB2-ABEND                              09480000
095000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09490000
095100                 PERFORM DP013-0000-PROCESS-ABEND                 09500000
095200         END-EVALUATE                                             09510000
095300     END-PERFORM.                                                 09520000
095400*                                                                 09530000
095500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09540000
095600         MOVE '4200-OPEN-RANKINGS-CSR'                            09550000
095700                                   TO DP013-PARAGRAPH             09560000
095800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09570000
095900                                   TO DP013-MESSAGE-TEXT (1)      09580000
096000         MOVE SQLCA                TO DP013-SQLCA                 09590000
096100         MOVE 'SUT00017'           TO DP013-DB2-TABLE-NAME (1)    09600000
096200         SET DP013-DB2-ABEND                                      09610000
096300             DP013-XCTL-DISPLAY-RESTART                           09620000
096400                                   TO TRUE                        09630000
096500         PERFORM DP013-0000-PROCESS-ABEND                         09640000
096600     END-IF.                                                      09650000
096700                                                                  09660000
096800 EJECT                                                            09670000
096900 4250-FETCH-RANKINGS-CSR.                                         09680000
097000                                                                  09690000
097100     EXEC SQL                                                     09700000
097200          FETCH RANKINGS-CSR                                      09710000
097300          INTO  :SUT00017-VND-RNKG-CDE                            09720000
097400             ,  :SUT00017-PKGNG-TYP-CDE                           09730000
097500             ,  :SUT00016-VND-RNKG-DESC                           09740000
097600     END-EXEC.                                                    09750000
097700                                                                  09760000
097800     EVALUATE TRUE                                                09770000
097900         WHEN SQLCODE = ZERO                                      09780000
098000             IF SUT00017-PKGNG-TYP-CDE = 'BC'                     09790000
098100                 MOVE SUT00017-VND-RNKG-CDE                       09800000
098200                              TO PV-BULK-VND-RNKG-CDE             09810000
098300                 MOVE SUT00016-VND-RNKG-DESC                      09820000
098400                              TO PV-BULK-VND-RNKG-DESC            09830000
098500             ELSE                                                 09840000
098600                 IF SUT00017-PKGNG-TYP-CDE = 'PP'                 09850000
098700                     MOVE SUT00017-VND-RNKG-CDE                   09860000
098800                                  TO PV-PREPACK-VND-RNKG-CDE      09870000
098900                     MOVE SUT00016-VND-RNKG-DESC                  09880000
099000                              TO PV-PREPACK-VND-RNKG-DESC         09890000
099100                 ELSE                                             09900000
099200                     IF SUT00017-PKGNG-TYP-CDE = 'PS'             09910000
099300                         MOVE SUT00017-VND-RNKG-CDE               09920000
099400                                      TO PV-PBS-VND-RNKG-CDE      09930000
099500                         MOVE SUT00016-VND-RNKG-DESC              09940000
099600                              TO PV-PBS-VND-RNKG-DESC             09950000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   09960000
                           ELSE                                         09961000
099200                         IF SUT00017-PKGNG-TYP-CDE = 'RF'         09962000
099300                            MOVE SUT00017-VND-RNKG-CDE            09963000
099400                                          TO PV-RFID-VND-RNKG-CDE 09964000
099500                            MOVE SUT00016-VND-RNKG-DESC           09965000
099600                                  TO PV-RFID-VND-RNKG-DESC        09966000
099700                         END-IF                                   09967000
                           END-IF                                       09968000
      *CLP 10/01/13 END   - PR# 5148D                                   09969000
099800                 END-IF                                           09970000
099900             END-IF                                               09980000
100000         WHEN SQLCODE = +100                                      09990000
100100             SET PS-END-OF-RANKINGS TO TRUE                       10000000
100200         WHEN SQLWARN0 NOT = SPACE                                10010000
100300         WHEN SQLCODE NOT = ZERO                                  10020000
100400              MOVE '4250-FETCH-RANKINGS-CSR'                      10030000
100500                               TO DP013-PARAGRAPH                 10040000
100600              MOVE 'FETCH RANKINGS CURSOR'                        10050000
100700                               TO DP013-MESSAGE-TEXT (1)          10060000
100800              MOVE SQLCA       TO DP013-SQLCA                     10070000
100900              SET DP013-DB2-ABEND                                 10080000
101000                               TO TRUE                            10090000
101100              PERFORM DP013-0000-PROCESS-ABEND                    10100000
101200     END-EVALUATE.                                                10110000
101300                                                                  10120000
101400                                                                  10130000
101500*----------------------------------------------------------------*10140000
101600* CLOSE THE RANKINGS CURSOR                                      *10150000
101700*----------------------------------------------------------------*10160000
101800                                                                  10170000
101900 4300-CLOSE-RANKINGS-CSR.                                         10180000
102000     EXEC SQL                                                     10190000
102100         CLOSE RANKINGS-CSR                                       10200000
102200     END-EXEC.                                                    10210000
102300                                                                  10220000
102400*                                                                 10230000
102500     EVALUATE TRUE                                                10240000
102600         WHEN SQLCODE = ZERO                                      10250000
102700             CONTINUE                                             10260000
102800         WHEN SQLWARN0 NOT = SPACES                               10270000
102900         WHEN SQLCODE < ZERO                                      10280000
103000         WHEN SQLCODE > ZERO                                      10290000
103100             MOVE '4300-CLOSE-RANKINGS-CSR'                       10300000
103200                               TO DP013-PARAGRAPH                 10310000
103300             MOVE 'CLOSE THE RANKINGS CURSOR '                    10320000
103400                               TO DP013-MESSAGE-TEXT (1)          10330000
103500             MOVE SQLCA        TO DP013-SQLCA                     10340000
103600             MOVE 'SUT00017'   TO DP013-DB2-TABLE-NAME (1)        10350000
103700             SET DP013-DB2-ABEND                                  10360000
103800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10370000
103900             PERFORM DP013-0000-PROCESS-ABEND                     10380000
104000     END-EVALUATE.                                                10390000
104100                                                                  10400000
104200*----------------------------------------------------------------*10410000
104300*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *10420000
104400*----------------------------------------------------------------*10430000
104500                                                                  10440000
104600 4400-MOVE-COMMAREA-TO-SCREEN.                                    10450000
104700     MOVE ASC-ENT-ID                 TO AENTIDO.                  10460000
104800     MOVE ASC-VENDOR-DESC            TO AVENNMO.                  10470000
104900     MOVE ASC-DEPT-NBR               TO ADEPTO.                   10480000
105000     MOVE ASC-DEPT-DESC              TO ADPTNMO.                  10490000
105100     MOVE ASC-BULK-RANKING           TO ABULKCPO.                 10500000
105200     MOVE ASC-PRE-PACK-RANKING       TO APREPAKO.                 10510000
105300     MOVE ASC-PBS-RANKING            TO APACKBSO.                 10520000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   10530000
105300     MOVE ASC-RFID-RANKING           TO ARFIDBSO.                 10531000
      *CLP 10/01/13 END   - PR# 5148D                                   10532000
105400     MOVE ASC-BULK-RANKING-DESC      TO ABKCPDSO.                 10533000
105500     MOVE ASC-PRE-PACK-RANKING-DESC  TO APREPDSO.                 10534000
105600     MOVE ASC-PBS-RANKING-DESC       TO APKBSDSO.                 10535000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   10536000
105600     MOVE ASC-RFID-RANKING-DESC      TO ARFIDDSO.                 10537000
      *CLP 10/01/13 END   - PR# 5148D                                   10538000
105700                                                                  10539000
105800 EJECT                                                            10540000
105900*----------------------------------------------------------------*10550000
106000* APPLY THE CHANGES TO THE MESSAGE TO THE DB2 TABLE.             *10560000
106100*----------------------------------------------------------------*10570000
106200 5000-UPDATE-VENDOR-RANKINGS.                                     10580000
106300     MOVE ASC-ENT-ID-N             TO DK-ENT-ID.                  10590000
106400     MOVE ASC-DEPT-NBR-N           TO DK-DEPT-NBR.                10600000
106500     IF ASC-HOLD-BULK-RANKING NOT = ASC-BULK-RANKING              10610000
106600         MOVE ASC-BULK-RANKING     TO DK-VENDOR-RANKING-CDE       10620000
106700         MOVE 'BC'                 TO DK-PKGNG-TYP-CDE            10630000
106800         IF ASC-BULK-RANKING = 'DEFALT'                           10640000
106900             MOVE ASC-HOLD-BULK-RANKING                           10650000
107000                                       TO DK-VENDOR-RANKING-CDE   10660000
107100             PERFORM 5150-DELETE-RANKING                          10670000
107200             MOVE 'DEFALT'             TO ASC-BULK-RANKING        10680000
107300             MOVE SPACES               TO ASC-BULK-RANKING-DESC   10690000
107400         ELSE                                                     10700000
107500             IF ASC-HOLD-BULK-RANKING = 'DEFALT'                  10710000
107600                 PERFORM 5050-ADD-RANKING                         10720000
107700             ELSE                                                 10730000
107800                 PERFORM 5100-UPDATE-RANKING                      10740000
107900             END-IF                                               10750000
108000         END-IF                                                   10760000
108100         MOVE ASC-BULK-RANKING     TO ASC-HOLD-BULK-RANKING       10770000
108200     END-IF.                                                      10780000
108300                                                                  10790000
108400     IF ASC-HOLD-PRE-PACK-RANKING NOT = ASC-PRE-PACK-RANKING      10800000
108500         MOVE ASC-PRE-PACK-RANKING TO DK-VENDOR-RANKING-CDE       10810000
108600         MOVE 'PP'                 TO DK-PKGNG-TYP-CDE            10820000
108700         IF ASC-PRE-PACK-RANKING = 'DEFALT'                       10830000
108800             MOVE ASC-HOLD-PRE-PACK-RANKING                       10840000
108900                                       TO DK-VENDOR-RANKING-CDE   10850000
109000             PERFORM 5150-DELETE-RANKING                          10860000
109100             MOVE 'DEFALT'             TO ASC-PRE-PACK-RANKING    10870000
109200             MOVE SPACES             TO ASC-PRE-PACK-RANKING-DESC 10880000
109300         ELSE                                                     10890000
109400             IF ASC-HOLD-PRE-PACK-RANKING = 'DEFALT'              10900000
109500                 PERFORM 5050-ADD-RANKING                         10910000
109600             ELSE                                                 10920000
109700                 PERFORM 5100-UPDATE-RANKING                      10930000
109800             END-IF                                               10940000
109900         END-IF                                                   10950000
110000         MOVE ASC-PRE-PACK-RANKING TO ASC-HOLD-PRE-PACK-RANKING   10960000
110100     END-IF.                                                      10970000
110200                                                                  10980000
110300     IF ASC-HOLD-PBS-RANKING NOT = ASC-PBS-RANKING                10990000
110400         MOVE ASC-PBS-RANKING      TO DK-VENDOR-RANKING-CDE       11000000
110500         MOVE 'PS'                 TO DK-PKGNG-TYP-CDE            11010000
110600         IF ASC-PBS-RANKING = 'DEFALT'                            11020000
110700             MOVE ASC-HOLD-PBS-RANKING TO DK-VENDOR-RANKING-CDE   11030000
110800             PERFORM 5150-DELETE-RANKING                          11040000
110900             MOVE 'DEFALT'             TO ASC-PBS-RANKING         11050000
111000             MOVE SPACES               TO ASC-PBS-RANKING-DESC    11060000
111100         ELSE                                                     11070000
111200             IF ASC-HOLD-PBS-RANKING = 'DEFALT'                   11080000
111300                 PERFORM 5050-ADD-RANKING                         11090000
111400             ELSE                                                 11100000
111500                 PERFORM 5100-UPDATE-RANKING                      11110000
111600             END-IF                                               11120000
111700         END-IF                                                   11130000
111800         MOVE ASC-PBS-RANKING      TO ASC-HOLD-PBS-RANKING        11140000
111900     END-IF.                                                      11150000
112000                                                                  11160000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   11170000
110300     IF ASC-HOLD-RFID-RANKING NOT = ASC-RFID-RANKING              11180000
110400         MOVE ASC-RFID-RANKING     TO DK-VENDOR-RANKING-CDE       11190000
110500         MOVE 'RF'                 TO DK-PKGNG-TYP-CDE            11200000
110600         IF ASC-RFID-RANKING = 'DEFALT'                           11201000
110700             MOVE ASC-HOLD-RFID-RANKING TO DK-VENDOR-RANKING-CDE  11202000
110800             PERFORM 5150-DELETE-RANKING                          11203000
110900             MOVE 'DEFALT'             TO ASC-RFID-RANKING        11204000
111000             MOVE SPACES               TO ASC-RFID-RANKING-DESC   11205000
111100         ELSE                                                     11206000
111200             IF ASC-HOLD-RFID-RANKING = 'DEFALT'                  11207000
111300                 PERFORM 5050-ADD-RANKING                         11208000
111400             ELSE                                                 11209000
111500                 PERFORM 5100-UPDATE-RANKING                      11209100
111600             END-IF                                               11209200
111700         END-IF                                                   11209300
111800         MOVE ASC-RFID-RANKING      TO ASC-HOLD-RFID-RANKING      11209400
111900     END-IF.                                                      11209500
      *CLP 10/01/13 END   - PR# 5148D                                   11209600
112100     IF  ASC-USE-SELECTION-QUEUE                                  11209700
112200         PERFORM 5200-UPDATE-SELECTION-QUEUE                      11209800
112300     END-IF.                                                      11209900
112400******************************************************************11210000
112500** ADD THE ROW ON THE DB2 TABLE.                                **11220000
112600******************************************************************11230000
112700 5050-ADD-RANKING.                                                11240000
112800     PERFORM                                                      11250000
112900         WITH TEST AFTER                                          11260000
113000         VARYING PV-RETRY-COUNTER                                 11270000
113100         FROM 1 BY 1                                              11280000
113200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11290000
113300                   OR (SQLCODE = ZERO))                           11300000
113400         EXEC SQL                                                 11310000
113500             INSERT INTO SUT_VND_DEPT_RNKG                        11320000
113600               ( ENT_ID                                           11330000
113700              ,  DEPT_NBR                                         11340000
113800              ,  VND_RNKG_CDE                                     11350000
113900              ,  PKGNG_TYP_CDE)                                   11360000
114000              VALUES                                              11370000
114100               ( :DK-ENT-ID                                       11380000
114200               , :DK-DEPT-NBR                                     11390000
114300               , :DK-VENDOR-RANKING-CDE                           11400000
114400               , :DK-PKGNG-TYP-CDE)                               11410000
114500         END-EXEC                                                 11420000
114600                                                                  11430000
114700         EVALUATE TRUE                                            11440000
114800             WHEN SQLCODE = ZERO                                  11450000
114900             WHEN SQLCODE = -904                                  11460000
115000             WHEN SQLCODE = -913                                  11470000
115100                 CONTINUE                                         11480000
115200             WHEN SQLWARN0 NOT = SPACES                           11490000
115300             WHEN SQLCODE < ZERO                                  11500000
115400             WHEN SQLCODE > ZERO                                  11510000
115500                 MOVE '5050-ADD-RANKING'                          11520000
115600                                   TO DP013-PARAGRAPH             11530000
115700                 MOVE 'ADD A ROW ON THE VENDOR RANKING TABLE'     11540000
115800                                   TO DP013-MESSAGE-TEXT(1)       11550000
115900                 MOVE SQLCA        TO DP013-SQLCA                 11560000
116000                 MOVE 'SUT00018'   TO DP013-DB2-TABLE-NAME (1)    11570000
116100                 SET DP013-DB2-ABEND                              11580000
116200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11590000
116300                 PERFORM DP013-0000-PROCESS-ABEND                 11600000
116400         END-EVALUATE                                             11610000
116500     END-PERFORM.                                                 11620000
116600*                                                                 11630000
116700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11640000
116800         MOVE '5050-ADD-RANKING'                                  11650000
116900                                   TO DP013-PARAGRAPH             11660000
117000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A SYS11670000
117100-             'TEM MESSAGE'        TO DP013-MESSAGE-TEXT (1)      11680000
117200         MOVE SQLCA                TO DP013-SQLCA                 11690000
117300         MOVE 'SUT00018'           TO DP013-DB2-TABLE-NAME (1)    11700000
117400         SET DP013-DB2-ABEND                                      11710000
117500             DP013-XCTL-DISPLAY-RESTART                           11720000
117600                                   TO TRUE                        11730000
117700         PERFORM DP013-0000-PROCESS-ABEND                         11740000
117800     END-IF.                                                      11750000
117900******************************************************************11760000
118000** UPDATE THE ROW ON THE DB2 TABLE.                             **11770000
118100******************************************************************11780000
118200 5100-UPDATE-RANKING.                                             11790000
118300     PERFORM                                                      11800000
118400         WITH TEST AFTER                                          11810000
118500         VARYING PV-RETRY-COUNTER                                 11820000
118600         FROM 1 BY 1                                              11830000
118700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11840000
118800                   OR (SQLCODE = ZERO))                           11850000
118900         EXEC SQL                                                 11860000
119000             UPDATE SUT_VND_DEPT_RNKG                             11870000
119100                 SET VND_RNKG_CDE  = :DK-VENDOR-RANKING-CDE       11880000
119200             WHERE ENT_ID          = :DK-ENT-ID                   11890000
119300               AND DEPT_NBR        = :DK-DEPT-NBR                 11900000
119400               AND PKGNG_TYP_CDE   = :DK-PKGNG-TYP-CDE            11910000
119500         END-EXEC                                                 11920000
119600                                                                  11930000
119700         EVALUATE TRUE                                            11940000
119800             WHEN SQLCODE = ZERO                                  11950000
119900             WHEN SQLCODE = -904                                  11960000
120000             WHEN SQLCODE = -913                                  11970000
120100                 CONTINUE                                         11980000
120200             WHEN SQLWARN0 NOT = SPACES                           11990000
120300             WHEN SQLCODE < ZERO                                  12000000
120400             WHEN SQLCODE > ZERO                                  12010000
120500                 MOVE '5100-UPDATE-RANKING'                       12020000
120600                                   TO DP013-PARAGRAPH             12030000
120700                 MOVE 'UPDATE A ROW ON THE VENDOR RANKING TABLE'  12040000
120800                                   TO DP013-MESSAGE-TEXT(1)       12050000
120900                 MOVE SQLCA        TO DP013-SQLCA                 12060000
121000                 MOVE 'SUT00018'   TO DP013-DB2-TABLE-NAME (1)    12070000
121100                 SET DP013-DB2-ABEND                              12080000
121200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12090000
121300                 PERFORM DP013-0000-PROCESS-ABEND                 12100000
121400         END-EVALUATE                                             12110000
121500     END-PERFORM.                                                 12120000
121600*                                                                 12130000
121700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12140000
121800         MOVE '5100-UPDATE-RANKING'                               12150000
121900                                   TO DP013-PARAGRAPH             12160000
122000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A SYS12170000
122100-             'TEM MESSAGE'        TO DP013-MESSAGE-TEXT (1)      12180000
122200         MOVE SQLCA                TO DP013-SQLCA                 12190000
122300         MOVE 'SUT00018'           TO DP013-DB2-TABLE-NAME (1)    12200000
122400         SET DP013-DB2-ABEND                                      12210000
122500             DP013-XCTL-DISPLAY-RESTART                           12220000
122600                                   TO TRUE                        12230000
122700         PERFORM DP013-0000-PROCESS-ABEND                         12240000
122800     END-IF.                                                      12250000
122900******************************************************************12260000
123000** UPDATE THE ROW ON THE DB2 TABLE.                             **12270000
123100******************************************************************12280000
123200 5150-DELETE-RANKING.                                             12290000
123300     PERFORM                                                      12300000
123400         WITH TEST AFTER                                          12310000
123500         VARYING PV-RETRY-COUNTER                                 12320000
123600         FROM 1 BY 1                                              12330000
123700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12340000
123800                   OR (SQLCODE = ZERO))                           12350000
123900         EXEC SQL                                                 12360000
124000             DELETE FROM SUT_VND_DEPT_RNKG                        12370000
124100             WHERE ENT_ID          = :DK-ENT-ID                   12380000
124200               AND DEPT_NBR        = :DK-DEPT-NBR                 12390000
124300               AND VND_RNKG_CDE    = :DK-VENDOR-RANKING-CDE       12400000
124400               AND PKGNG_TYP_CDE   = :DK-PKGNG-TYP-CDE            12410000
124500         END-EXEC                                                 12420000
124600                                                                  12430000
124700         EVALUATE TRUE                                            12440000
124800             WHEN SQLCODE = ZERO                                  12450000
124900             WHEN SQLCODE = -904                                  12460000
125000             WHEN SQLCODE = -913                                  12470000
125100                 CONTINUE                                         12480000
125200             WHEN SQLWARN0 NOT = SPACES                           12490000
125300             WHEN SQLCODE < ZERO                                  12500000
125400             WHEN SQLCODE > ZERO                                  12510000
125500                 MOVE '5150-DELETE-RANKING'                       12520000
125600                                   TO DP013-PARAGRAPH             12530000
125700                 MOVE 'DELETE A ROW ON THE VENDOR RANKING TABLE'  12540000
125800                                   TO DP013-MESSAGE-TEXT(1)       12550000
125900                 MOVE SQLCA        TO DP013-SQLCA                 12560000
126000                 MOVE 'SUT00018'   TO DP013-DB2-TABLE-NAME (1)    12570000
126100                 SET DP013-DB2-ABEND                              12580000
126200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12590000
126300                 PERFORM DP013-0000-PROCESS-ABEND                 12600000
126400         END-EVALUATE                                             12610000
126500     END-PERFORM.                                                 12620000
126600*                                                                 12630000
126700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12640000
126800         MOVE '5150-DELETE-RANKING'                               12650000
126900                                   TO DP013-PARAGRAPH             12660000
127000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A SYS12670000
127100-             'TEM MESSAGE'        TO DP013-MESSAGE-TEXT (1)      12680000
127200         MOVE SQLCA                TO DP013-SQLCA                 12690000
127300         MOVE 'SUT00019'           TO DP013-DB2-TABLE-NAME (1)    12700000
127400         SET DP013-DB2-ABEND                                      12710000
127500             DP013-XCTL-DISPLAY-RESTART                           12720000
127600                                   TO TRUE                        12730000
127700         PERFORM DP013-0000-PROCESS-ABEND                         12740000
127800     END-IF.                                                      12750000
127900 EJECT                                                            12760000
128000*----------------------------------------------------------------*12770000
128100* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *12780000
128200* OBJECT WAS UDPATED.                                            *12790000
128300*----------------------------------------------------------------*12800000
128400 5200-UPDATE-SELECTION-QUEUE.                                     12810000
128500     PERFORM 9100-READ-SEL-QUEUE.                                 12820000
128600     SET SU019-UPD (ASC-SEL-SUB) TO TRUE.                         12830000
128700     PERFORM 9200-REWRITE-LIST-QUEUE.                             12840000
128800 EJECT                                                            12850000
128900*----------------------------------------------------------------*12860000
129000* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *12870000
129100*----------------------------------------------------------------*12880000
129200                                                                  12890000
129300 9100-READ-SEL-QUEUE.                                             12900000
129400     EXEC CICS                                                    12910000
129500         READQ TS                                                 12920000
129600             QUEUE (ASC-SEL-QUEUE-NAME)                           12930000
129700             INTO  (SU019-SELECT-RECORD)                          12940000
129800             ITEM  (ASC-SEL-ITEM)                                 12950000
129900             RESP  (PV-CICS-RESPONSE)                             12960000
130000     END-EXEC.                                                    12970000
130100                                                                  12980000
130200     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   12990000
130300         CONTINUE                                                 13000000
130400     ELSE                                                         13010000
130500         SET DP013-LOGIC-ABEND                                    13020000
130600             DP013-NO-ROLLBACK     TO TRUE                        13030000
130700         MOVE '9100-READ-SEL-QUEUE'                               13040000
130800                                   TO DP013-PARAGRAPH             13050000
130900         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   13060000
131000                                   TO DP013-MESSAGE-TEXT (1)      13070000
131100         PERFORM DP013-0000-PROCESS-ABEND                         13080000
131200     END-IF.                                                      13090000
131300*----------------------------------------------------------------*13100000
131400* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *13110000
131500*----------------------------------------------------------------*13120000
131600 9200-REWRITE-LIST-QUEUE.                                         13130000
131700     EXEC CICS                                                    13140000
131800          WRITEQ TS                                               13150000
131900              QUEUE  (ASC-SEL-QUEUE-NAME)                         13160000
132000              FROM   (SU019-SELECT-RECORD)                        13170000
132100              ITEM   (ASC-SEL-ITEM)                               13180000
132200              RESP   (PV-CICS-RESPONSE)                           13190000
132300              REWRITE                                             13200000
132400     END-EXEC.                                                    13210000
132500                                                                  13220000
132600     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               13230000
132700         SET DP013-CICS-ABEND                                     13240000
132800             DP013-NO-ROLLBACK     TO TRUE                        13250000
132900         MOVE '9200-REWRITE-LIST-QUEUE'                           13260000
133000                                   TO DP013-PARAGRAPH             13270000
133100         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   13280000
133200                                   TO DP013-MESSAGE-TEXT (1)      13290000
133300         PERFORM DP013-0000-PROCESS-ABEND                         13300000
133400     END-IF.                                                      13310000
133500                                                                  13320000
133600 EJECT                                                            13330000
133700*----------------------------------------------------------------*13340000
133800*    ABEND PROCESSOR MODULE                                      *13350000
133900*----------------------------------------------------------------*13360000
134000                                                                  13370000
134100     COPY DPPD013.                                                13380000
