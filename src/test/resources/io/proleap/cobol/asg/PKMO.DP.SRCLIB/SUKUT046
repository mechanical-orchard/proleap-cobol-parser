000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.    SUKUT046.                                         00040000
000500 AUTHOR.        DENISE HAHN                                       00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   AUGUST, 2004.                                     00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000*   THIS PROGRAM READS CARTON DETAIL FILE (PF 2200=-FOR TRIPS     00100010
001100*   THAT WERE CLOSED AT DC, CLOSED AT DC & UNLOADED AT STORE,     00110000
001200*   UNLOADED AT STORE.  FOR ALL UNLOADED AT STORE RECORDS CREATES 00120000
001210*   A 'SE' STORE EXPECTED REVERSAL ENTRY FOR INTRANSIT.           00121000
001220******************************************************************00122003
001230 ENVIRONMENT DIVISION.                                            00123004
001240 CONFIGURATION SECTION.                                           00124004
001250                                                                  00125004
001260 SOURCE-COMPUTER.        IBM-3090.                                00126004
001270 OBJECT-COMPUTER.        IBM-3090.                                00127004
001280                                                                  00128004
001290 INPUT-OUTPUT SECTION.                                            00129004
001300 FILE-CONTROL.                                                    00130004
001400                                                                  00140004
001500     SELECT CARTON-DTL-INP-FILE                                   00150004
001600         ASSIGN TO IN01.                                          00160004
001700                                                                  00170004
001800     SELECT CARTON-DTL-OUT-FILE                                   00180004
001900         ASSIGN TO OUT01.                                         00190004
002000                                                                  00200004
002100******************************************************************00210004
002200 DATA DIVISION.                                                   00220004
002300 FILE SECTION.                                                    00230004
002400                                                                  00240004
002500 FD  CARTON-DTL-INP-FILE                                          00250004
002600     RECORDING MODE IS F                                          00260004
002700     LABEL RECORDS ARE STANDARD                                   00270004
002800     BLOCK CONTAINS 0 RECORDS.                                    00280004
002900                                                                  00290004
003000 01  CARTON-DTL-INP-RECORD   PIC  X(100).                         00300004
003100*                                                                 00310004
003200 FD  CARTON-DTL-OUT-FILE                                          00320004
003300     RECORDING MODE IS F                                          00330004
003400     LABEL RECORDS ARE STANDARD                                   00340004
003500     BLOCK CONTAINS 0 RECORDS.                                    00350004
003600                                                                  00360004
003700 01  CARTON-DTL-OUT-RECORD  PIC  X(100).                          00370004
003800*                                                                 00380004
003900******************************************************************00390004
004000 WORKING-STORAGE SECTION.                                         00400004
004100******************************************************************00410004
004200******************************************************************00420004
004300*  CARTON OUTPUT FILE LAYOUT                                      00430004
004400******************************************************************00440004
004500     COPY PCRD010.                                                00450004
004600                                                                  00460004
004700******************************************************************00470004
004800*  COMMUNICATIONS AREA FOR DB2                                    00480004
004900******************************************************************00490004
005000     EXEC SQL                                                     00500004
005100          INCLUDE SQLCA                                           00510004
005200     END-EXEC.                                                    00520004
005300                                                                  00530004
005400******************************************************************00540004
005500*  CENTRAL STOCK PULL REQUEST                                     00550004
005600******************************************************************00560004
005700     EXEC SQL                                                     00570004
005800          INCLUDE TCEPLRQ                                         00580004
005900     END-EXEC.                                                    00590004
006000                                                                  00600004
006100******************************************************************00610004
006200*  CENTRAL STOCK PULL STORE                                       00620004
006300******************************************************************00630004
006400     EXEC SQL                                                     00640004
006500          INCLUDE TCEPLST                                         00650004
006600     END-EXEC.                                                    00660004
006610                                                                  00661004
006620******************************************************************00662004
006630*  XLT_DC_LOC_ASGMT - DC LABOR ASSIGNMENT                         00663004
006640******************************************************************00664004
006650     EXEC SQL                                                     00665004
006660          INCLUDE XLT00014                                        00666004
006670     END-EXEC.                                                    00667004
006680                                                                  00668004
006690******************************************************************00669004
006700*  XLT_LOC - LOCATION ASSIGNMENT                                  00670004
006701******************************************************************00670104
006702     EXEC SQL                                                     00670204
006703          INCLUDE XLT00010                                        00670304
006704     END-EXEC.                                                    00670404
006705                                                                  00670504
006706******************************************************************00670604
006707*  PO-RECEIVER DATABASE                                           00670704
006708******************************************************************00670804
006709     EXEC SQL                                                     00670904
006710          INCLUDE TRECEIV                                         00671004
006711     END-EXEC.                                                    00671104
006712                                                                  00671204
006713******************************************************************00671304
006714*  PARAMATER DATABASE                                             00671404
006715******************************************************************00671504
006716     EXEC SQL                                                     00671604
006717          INCLUDE TKRPRPM                                         00671704
006718     END-EXEC.                                                    00671804
006719                                                                  00671904
006720******************************************************************00672004
006730 01  PS-PROGRAM-SWITCHES.                                         00673004
006740     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00674004
006750         88  PS-END-OF-FILE                        VALUE 'Y'.     00675004
006760         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00676004
006770     05  PS-CNTL-STK-IN-TRANSIT-SW   PIC  X(01)    VALUE 'N'.     00677004
006780         88  PS-CNTL-STK-IN-TRANSIT-YES            VALUE 'Y'.     00678004
006790         88  PS-CNTL-STK-IN-TRANSIT-NO             VALUE 'N'.     00679004
006800     05  PS-RCVR-IN-TRANSIT-SW       PIC  X(01)    VALUE 'N'.     00680004
006900         88  PS-RCVR-IN-TRANSIT-YES                VALUE 'Y'.     00690004
007000         88  PS-RCVR-IN-TRANSIT-NO                 VALUE 'N'.     00700004
007100                                                                  00710004
007200 01  PC-PROGRAM-CONSTANTS.                                        00720004
007300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT046'. 00730004
007400                                                                  00740004
007500 01  PV-PROGRAM-VARIABLES.                                        00750004
007600     05  PV-PARAGRAPH-NAME           PIC  X(30)     VALUE SPACES. 00760004
007700     05  PV-SH-READ-COUNT            PIC  9(9) COMP VALUE ZEROS.  00770004
007800     05  PV-UN-READ-COUNT            PIC  9(9) COMP VALUE ZEROS.  00780004
007900     05  PV-READ-COUNT               PIC  9(9) COMP VALUE ZEROS.  00790004
008000     05  PV-READ-COUNT2              PIC  9(9) COMP VALUE ZEROS.  00800004
008001     05  PV-WRITE-COUNT              PIC  9(9) COMP VALUE ZEROS.  00800100
008002     05  PV-SH-WRITE-COUNT           PIC  9(9) COMP VALUE ZEROS.  00800200
008003     05  PV-UN-WRITE-COUNT           PIC  9(9) COMP VALUE ZEROS.  00800300
008004     05  PV-SE-CNTL-STK-WRITE-COUNT  PIC  9(9) COMP VALUE ZEROS.  00800400
008005     05  PV-SE-RCVR-WRITE-COUNT      PIC  9(9) COMP VALUE ZEROS.  00800500
008006     05  PV-NO-STORE-EXPT-COUNT      PIC  9(9) COMP VALUE ZEROS.  00800604
008007     05  PV-DISPLAY-PO               PIC  Z(9).                   00800701
008008     05  PV-DISPLAY-COUNT            PIC  ZZZ,ZZZ,ZZ9.            00800801
008009     05  PV-DISPLAY-COUNT2           PIC  ZZZ,ZZZ,ZZ9.            00800901
008010     05  PV-DISPLAY-SQLCODE          PIC  +999.                   00801001
008011     05  PV-PREV-PO                  PIC S9(09) COMP VALUE ZEROS. 00801101
008012     05  PV-PREV-RCVR                PIC S9(09) COMP VALUE ZEROS. 00801201
008013     05  PV-PREV-STORE               PIC S9(04) COMP VALUE ZEROS. 00801304
008014                                                                  00801401
008016 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO     00801607
008017                                                   COMP SYNC.     00801707
008018 01  PV-ABEND-FIELDS.                                             00801807
008019     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'SUKUT046'.00801904
008020     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00802004
008021     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00802104
008022     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    00802204
008023     05  PV-ABEND-STRUCTURE-2         PIC X(20)  VALUE SPACES.    00802304
008024     05  PV-ABEND-STRUCTURE-3         PIC X(20)  VALUE SPACES.    00802404
008025     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    00802504
008026     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00802604
008027     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00802704
008028     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00802804
008029     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    00802904
008030*  USED FOR DB2 ERROR MESSAGE BUILDING                            00803006
008031     COPY DPWS004.                                                00803106
008032******************************************************************00803201
008033 PROCEDURE DIVISION.                                              00803301
008034******************************************************************00803401
008035******************************************************************00803504
008036* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     00803604
008037*      PROGRAM.                                                   00803704
008038******************************************************************00803804
008039 0000-PROGRAM-MAINLINE.                                           00803904
008040                                                                  00804004
008041     DISPLAY '***** SUKUT046 STARTED *****'.                      00804104
008042                                                                  00804204
008043     PERFORM 1000-INITIALIZE.                                     00804304
008044     PERFORM 2000-PROCESS-CARTON-FILE                             00804404
008045         UNTIL PS-END-OF-FILE.                                    00804504
008046     PERFORM 9000-EOJ-ROUTINE.                                    00804604
008047                                                                  00804704
008048     STOP RUN.                                                    00804804
008050                                                                  00805004
008060******************************************************************00806004
008070*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    00807004
008080*    -- OPEN INPUT FILE                                           00808004
008090*    -- OPEN OUTPUT FILE                                          00809004
008100*    -- READ INPUT FILE                                           00810004
008200******************************************************************00820004
008300 1000-INITIALIZE.                                                 00830004
008400                                                                  00840004
008500     OPEN INPUT  CARTON-DTL-INP-FILE.                             00850004
008600     OPEN OUTPUT CARTON-DTL-OUT-FILE.                             00860004
008700                                                                  00870004
008800     PERFORM 7000-READ-FILE.                                      00880004
008900                                                                  00890004
009000******************************************************************00900004
009100*  RETRIEVING INTR-UPC-ID AND WRITE RECORD TO OUTPUT              00910004
009200******************************************************************00920004
009300 2000-PROCESS-CARTON-FILE.                                        00930004
009400                                                                  00940004
009500     IF  PC010-SHIPPD-DC                                          00950004
009600         PERFORM 8000-WRITE-OUTPUT                                00960004
009700         ADD +1  TO  PV-SH-WRITE-COUNT                            00970004
009800     END-IF.                                                      00980004
009900                                                                  00990004
010000     IF  PC010-UNLOAD-ST                                          01000004
010100         PERFORM 8000-WRITE-OUTPUT                                01010004
010200         ADD +1  TO  PV-UN-WRITE-COUNT                            01020004
010550         PERFORM 2100-PROCESS-UNLOAD                              01055000
010560     END-IF                                                       01056000
010570                                                                  01057004
010580     PERFORM 7000-READ-FILE.                                      01058004
010590                                                                  01059004
010600******************************************************************01060004
010700* PROCESS UNLOADED AT STORE RECORDS AND CREATE 'SE' (STORE        01070004
010800* EXPECTED) REVERSAL ENTRIES FOR INTRANSIT.                       01080004
010900******************************************************************01090004
011000 2100-PROCESS-UNLOAD.                                             01100004
011100                                                                  01110004
011200     IF  PC010-PO-NBR        =  PV-PREV-PO     AND                01120004
011300         PC010-RCVR-SEQ-NBR  =  PV-PREV-RCVR   AND                01130004
011310         PC010-STR-NBR       =  PV-PREV-STORE                     01131004
011320         CONTINUE                                                 01132004
011330     ELSE                                                         01133004
011340         SET  PS-CNTL-STK-IN-TRANSIT-NO                           01134004
011350              PS-RCVR-IN-TRANSIT-NO         TO TRUE               01135004
011360         IF  PC010-RCVR-SEQ-NBR  =  0                             01136004
011370             PERFORM 2200-CHECK-CNTL-STK-IN-TRANSIT               01137004
011380         ELSE                                                     01138004
011390             PERFORM 2300-CHECK-RCVR-IN-TRANSIT                   01139004
011400         END-IF                                                   01140004
011500         MOVE PC010-PO-NBR        TO  PV-PREV-PO                  01150004
011600         MOVE PC010-RCVR-SEQ-NBR  TO  PV-PREV-RCVR                01160004
011700         MOVE PC010-STR-NBR       TO  PV-PREV-STORE               01170004
011800     END-IF.                                                      01180004
011900                                                                  01190004
012000     IF  PS-RCVR-IN-TRANSIT-YES                                   01200004
012100         SET  PC010-TRN-STR-EXPECTED  TO  TRUE                    01210004
012200         PERFORM 8000-WRITE-OUTPUT                                01220004
012300         ADD +1  TO  PV-SE-RCVR-WRITE-COUNT                       01230004
012400     ELSE                                                         01240004
012500         IF  PS-CNTL-STK-IN-TRANSIT-YES                           01250004
012600             SET  PC010-TRN-STR-EXPECTED  TO  TRUE                01260004
012700             PERFORM 8000-WRITE-OUTPUT                            01270004
012800             ADD +1  TO  PV-SE-CNTL-STK-WRITE-COUNT               01280004
012900         ELSE                                                     01290004
013000            DISPLAY 'INTR UPC ' PC010-INTR-UPC-ID                 01300004
013100            DISPLAY 'LOC NBR ' PC010-STR-NBR                      01310004
013200            DISPLAY 'PO RCVR ' PC010-PO-NBR  PC010-RCVR-SEQ-NBR   01320004
013300            ADD +1  TO  PV-NO-STORE-EXPT-COUNT                    01330004
013400         END-IF                                                   01340004
013410     END-IF.                                                      01341004
013420                                                                  01342004
013430******************************************************************01343004
013440*  CHECK IF CENTRAL STOCK PULL WAS AFTER STORE EXPECTED PROCESS   01344004
013450*  WAS TURNED ON                                                  01345004
013460******************************************************************01346004
013470 2200-CHECK-CNTL-STK-IN-TRANSIT.                                  01347004
013480                                                                  01348004
013490     MOVE PC010-STR-NBR  TO  XLT00014-LOC-NBR                     01349004
013500                                                                  01350004
013600     EXEC SQL                                                     01360004
013700         SELECT A.CNSTK_REQ_PL_NBR                                01370004
013800           INTO :CEPLRQ-CNSTK-REQ-PL-NBR                          01380004
013900         FROM TCEPLRQ   A                                         01390004
014000            , TCEPLST   B                                         01400004
014100            , XLT_DC_LOC_ASGMT   C                                01410004
014200            , TKRPRPM   D                                         01420004
014300            , TKRPRPM   E                                         01430004
014400            , XLT_LOC   F                                         01440004
014500         WHERE A.CNSTK_REQ_PL_NBR = :PC010-PO-NBR                 01450004
014600           AND B.CNSTK_REQ_PL_NBR = A.CNSTK_REQ_PL_NBR            01460004
014700           AND B.STAT_CDE         = 'NW'                          01470004
014800           AND B.PL_LNE_NBR       = 0                             01480004
014900           AND C.LOC_NBR          = :XLT00014-LOC-NBR             01490004
014910           AND C.EFF_BEG_DTE      =                               01491004
014920                (SELECT MAX(EFF_BEG_DTE)                          01492004
014921                   FROM XLT_DC_LOC_ASGMT Z                        01492104
014922                  WHERE Z.LOC_NBR = C.LOC_NBR                     01492204
014923                    AND EFF_BEG_DTE <= CURRENT DATE)              01492304
014924           AND D.LOC_ID           = C.DC_NBR                      01492404
014925           AND D.INTFC_SYS_CDE    = 'KHL'                         01492504
014926           AND D.SYS_PRC_FUNC_CDE = 'STREXP'                      01492604
014927           AND B.CRE_TMST        >= D.FUNC_BEG_TMST               01492704
014928           AND E.LOC_ID           = A.CNSTK_LOC_ID                01492804
014929           AND E.INTFC_SYS_CDE    = 'RDM'                         01492904
014930           AND E.SYS_PRC_FUNC_CDE = 'RDMCSL'                      01493004
014931           AND E.FUNC_PRC_STAT_CDE = 'AC'                         01493104
014932           AND B.CRE_TMST        >= E.FUNC_BEG_TMST               01493204
014933           AND F.LOC_NBR          = C.LOC_NBR                     01493304
014934           AND NOT F.E_BUS_IND    = 'Y'                           01493404
014935           AND F.LOC_TYP_CDE       =  'DS'                        01493504
014936       WITH UR                                                    01493609
014937       END-EXEC.                                                  01493704
014938                                                                  01493804
014940                                                                  01494008
014941                                                                  01494108
014942     EVALUATE TRUE                                                01494208
014943         WHEN SQLCODE = ZERO                                      01494308
014944         WHEN SQLCODE = -811                                      01494408
014950              SET  PS-CNTL-STK-IN-TRANSIT-YES  TO  TRUE           01495004
014960         WHEN SQLCODE = +100                                      01496004
014961              SET  PS-CNTL-STK-IN-TRANSIT-NO   TO  TRUE           01496104
014962         WHEN SQLWARN0 NOT = SPACES                               01496204
014963         WHEN SQLCODE < ZERO                                      01496304
014964         WHEN SQLCODE > ZERO                                      01496404
014965             MOVE  PC010-PO-NBR    TO  PV-DISPLAY-PO              01496504
014966             MOVE  SQLCODE         TO  PV-DISPLAY-SQLCODE         01496604
014967             MOVE  '2200-CHECK-CNTL-STK-IN-TRANSIT'               01496704
014968                                   TO  PV-ABEND-PARAGRAPH         01496804
014969             MOVE 'SELECT TCEPLRQ'                                01496904
014970                                   TO PV-ABEND-OPERATION          01497004
014971             MOVE 'PO BRING PROCESSED: '                          01497104
014972                                   TO PV-DB2-OPERATION-MESSAGE-1  01497204
014973             MOVE PV-DISPLAY-PO                                   01497304
014975                                   TO PV-DB2-OPERATION-MESSAGE-2  01497504
014976             MOVE  'CHECK CENTRAL STOCK-STORE EXPECTED'           01497604
014977                                   TO PV-DB2-OPERATION-MESSAGE-3  01497704
014978             MOVE 'TCEPLRQ'        TO PV-ABEND-STRUCTURE-1        01497805
014979             MOVE 'TCEPLST'        TO PV-ABEND-STRUCTURE-2        01497905
014985             PERFORM 9900-DB2-ABEND                               01498504
014986     END-EVALUATE.                                                01498604
014987                                                                  01498704
014988                                                                  01498804
014989******************************************************************01498904
014990*  CHECK IF RECEIVER WAS CREATED AFTER STORE EXPECTED PROCESS     01499004
014991*  WAS TURNED ON                                                  01499104
014992******************************************************************01499204
014993 2300-CHECK-RCVR-IN-TRANSIT.                                      01499304
014994                                                                  01499404
014995     EXEC SQL                                                     01499504
014996          SELECT  A.ORD_NBR                                       01499604
014997            INTO  :RECEIV-ORD-NBR                                 01499704
014998            FROM  TRECEIV  A                                      01499804
014999               ,  XLT_DC_LOC_ASGMT B                              01499904
015000               ,  TKRPRPM  C                                      01500004
015001               ,  XLT_LOC  D                                      01500104
015002           WHERE  A.ORD_NBR           =  :PC010-PO-NBR            01500204
015003             AND  A.REC_SEQ_NBR       =  :PC010-RCVR-SEQ-NBR      01500304
015010             AND  NOT A.REC_TYP_CDE   IN ('AP', 'CR', 'CD')       01501004
015020             AND  B.LOC_NBR           =  :PC010-STR-NBR           01502004
015030             AND  B.EFF_BEG_DTE       =                           01503004
015040                  (SELECT MAX(Z.EFF_BEG_DTE)                      01504004
015050                     FROM XLT_DC_LOC_ASGMT Z                      01505004
015060                    WHERE Z.LOC_NBR   = B.LOC_NBR                 01506004
015070                      AND EFF_BEG_DTE <= CURRENT DATE)            01507004
015080             AND  C.LOC_ID            =  B.DC_NBR                 01508004
015090             AND  C.INTFC_SYS_CDE     =  'KHL'                    01509004
015100             AND  C.SYS_PRC_FUNC_CDE  =  'STREXP'                 01510004
015101             AND  A.CRE_TMST         >=  C.FUNC_BEG_TMST          01510104
015102             AND  D.LOC_NBR           =  B.LOC_NBR                01510204
015103             AND  NOT D.E_BUS_IND     =  'Y'                      01510304
015104             AND  D.LOC_TYP_CDE       =  'DS'                     01510404
015105     WITH UR                                                      01510509
015106     END-EXEC.                                                    01510604
015107                                                                  01510704
015108     EVALUATE TRUE                                                01510804
015109         WHEN SQLCODE = ZERO                                      01510904
015110         WHEN SQLCODE = -811                                      01511004
015111              SET  PS-RCVR-IN-TRANSIT-YES  TO  TRUE               01511104
015112         WHEN SQLCODE = +100                                      01511204
015113              SET  PS-RCVR-IN-TRANSIT-NO   TO  TRUE               01511304
015114         WHEN SQLWARN0 NOT = SPACES                               01511404
015115         WHEN SQLCODE < ZERO                                      01511504
015116         WHEN SQLCODE > ZERO                                      01511604
015126             MOVE  PC010-PO-NBR    TO  PV-DISPLAY-PO              01512604
015127             MOVE  SQLCODE         TO  PV-DISPLAY-SQLCODE         01512704
015128             MOVE  '2300-CHECK-RCVR-IN-TRANSIT'                   01512804
015129                                   TO  PV-ABEND-PARAGRAPH         01512904
015130             MOVE 'SELECT TRECEIV'                                01513004
015131                                   TO PV-ABEND-OPERATION          01513104
015132             MOVE 'PO BRING PROCESSED: '                          01513204
015133                                   TO PV-DB2-OPERATION-MESSAGE-1  01513304
015134             MOVE  PV-DISPLAY-PO                                  01513404
015135                                   TO PV-DB2-OPERATION-MESSAGE-2  01513504
015136             MOVE  'CHECK RECEIVER-STORE EXPECTED '               01513604
015137                                   TO PV-DB2-OPERATION-MESSAGE-3  01513704
015138             MOVE 'TRECEIV'        TO PV-ABEND-STRUCTURE-1        01513805
015144             PERFORM 9900-DB2-ABEND                               01514404
015145     END-EVALUATE.                                                01514504
015146                                                                  01514604
015147                                                                  01514704
015148******************************************************************01514804
015149*  READ INPUT FILE.                                               01514904
015150******************************************************************01515004
015151 7000-READ-FILE.                                                  01515104
015152      INITIALIZE PC010-PCT-INTRANSIT-REC.                         01515204
015160                                                                  01516004
015170      READ CARTON-DTL-INP-FILE INTO                               01517004
015180          PC010-PCT-INTRANSIT-REC                                 01518004
015190            AT END SET PS-END-OF-FILE TO TRUE.                    01519004
015200                                                                  01520004
015300      IF PS-END-OF-FILE                                           01530004
015400         CONTINUE                                                 01540004
015500      ELSE                                                        01550004
015600         IF  PC010-SHIPPD-DC                                      01560004
015700             ADD +1  TO  PV-SH-READ-COUNT                         01570004
015800         END-IF                                                   01580004
015900         IF  PC010-UNLOAD-ST                                      01590004
016000             ADD +1  TO  PV-UN-READ-COUNT                         01600004
016100         END-IF                                                   01610004
016200         ADD +1 TO PV-READ-COUNT                                  01620004
016300                   PV-READ-COUNT2                                 01630004
016400         IF  PV-READ-COUNT2  >= 200000                            01640004
016500             MOVE PV-READ-COUNT            TO  PV-DISPLAY-COUNT2  01650004
016600             DISPLAY '  PROCESSED RECORDS..: ' PV-DISPLAY-COUNT2  01660004
016610             MOVE  ZEROES  TO PV-READ-COUNT2                      01661004
016620         END-IF                                                   01662004
016630      END-IF.                                                     01663004
016640                                                                  01664004
016650******************************************************************01665004
016660*  WRITE OUTPUT FILE.                                             01666004
016670******************************************************************01667004
016680 8000-WRITE-OUTPUT.                                               01668004
016690                                                                  01669004
016700     WRITE CARTON-DTL-OUT-RECORD FROM                             01670004
016800         PC010-PCT-INTRANSIT-REC.                                 01680004
016900                                                                  01690004
017000     ADD +1 TO PV-WRITE-COUNT.                                    01700004
017100                                                                  01710004
017200******************************************************************01720004
017300*  CLOSE INPUT FILE.  DISPLAY COUNTS.                             01730004
017400******************************************************************01740004
017500 9000-EOJ-ROUTINE.                                                01750004
017600     CLOSE CARTON-DTL-INP-FILE                                    01760004
017700           CARTON-DTL-OUT-FILE.                                   01770004
017800                                                                  01780004
017900     MOVE PV-SH-READ-COUNT           TO  PV-DISPLAY-COUNT.        01790004
018000     DISPLAY 'TOTAL SHIPPED READ...: '   PV-DISPLAY-COUNT.        01800004
018100     MOVE PV-UN-READ-COUNT           TO  PV-DISPLAY-COUNT.        01810004
018200     DISPLAY 'TOTAL UNLOAD READ....: '   PV-DISPLAY-COUNT.        01820004
018300     MOVE PV-READ-COUNT              TO  PV-DISPLAY-COUNT.        01830004
018400     DISPLAY 'TOTAL RECORDS READ...: '   PV-DISPLAY-COUNT.        01840004
018500                                                                  01850004
018510     DISPLAY '                       '.                           01851004
018520                                                                  01852004
018530     MOVE PV-SH-WRITE-COUNT          TO  PV-DISPLAY-COUNT.        01853004
018540     DISPLAY 'TOTAL SHIPPED WRITTEN: '   PV-DISPLAY-COUNT.        01854004
018550     MOVE PV-UN-WRITE-COUNT          TO  PV-DISPLAY-COUNT.        01855004
018560     DISPLAY 'TOTAL UNLOAD WRITTEN.: '   PV-DISPLAY-COUNT.        01856004
018570                                                                  01857004
018580     DISPLAY '                       '.                           01858004
018590                                                                  01859004
018600     MOVE PV-SE-CNTL-STK-WRITE-COUNT TO  PV-DISPLAY-COUNT.        01860004
018700     DISPLAY 'TOTAL SE - CNTL STOCK: '   PV-DISPLAY-COUNT.        01870004
018800     MOVE PV-SE-RCVR-WRITE-COUNT     TO  PV-DISPLAY-COUNT.        01880004
018900     DISPLAY 'TOTAL SE - RECEIVER..: '   PV-DISPLAY-COUNT.        01890004
018901     MOVE PV-NO-STORE-EXPT-COUNT     TO  PV-DISPLAY-COUNT.        01890104
018902     DISPLAY 'TOTAL NO STORE EXPTED: '   PV-DISPLAY-COUNT.        01890204
018903                                                                  01890304
018904     DISPLAY '                       '.                           01890404
018930                                                                  01893000
018931     MOVE PV-WRITE-COUNT             TO  PV-DISPLAY-COUNT.        01893100
018932     DISPLAY 'TOTAL RECORDS WRITTEN: '   PV-DISPLAY-COUNT.        01893204
018933     DISPLAY '                       '.                           01893304
018934     DISPLAY '*****  SUKUT046 ENDED  *****'.                      01893404
018935                                                                  01893504
018936                                                                  01893604
018937 9900-DB2-ABEND.                                                  01893704
018938             MOVE  SQLCODE         TO  PV-DISPLAY-SQLCODE         01893804
018939             DISPLAY 'PO BRING PROCESSED: ' PV-DISPLAY-PO         01893904
018940             DISPLAY 'PARAGRAPH.........: '                       01894004
018941                                 '2200-CHECK-CNTL-STK-IN-TRANSIT' 01894104
018942             DISPLAY 'PROCESS...........: '                       01894204
018943                             'CHECK CENTRAL STOCK-STORE EXPECTED' 01894304
018944             DISPLAY 'SQLCODE...........: ' PV-DISPLAY-SQLCODE    01894404
018945                                                                  01894504
018947     DISPLAY '*** DB2 ERROR '.                                    01894704
018950     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE                01895004
018960     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM                  01896004
018970     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               01897004
018980     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               01898004
018990     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       01899004
019000     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       01900004
019100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       01910004
019200     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             01920004
019300     DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.             01930004
019400                                                                  01940004
019600                                                                  01960004
019700     COPY DPPD004.                                                01970004
019800                                                                  01980004
019900     IF SQLCODE NOT = -911                                        01990004
020000         EXEC SQL                                                 02000004
020100              ROLLBACK                                            02010004
020200         END-EXEC                                                 02020004
020300     END-IF.                                                      02030004
020400                                                                  02040004
020500     MOVE +4013                  TO PV-ABEND-CODE.                02050004
020600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02060004
020700                                                                  02070004
