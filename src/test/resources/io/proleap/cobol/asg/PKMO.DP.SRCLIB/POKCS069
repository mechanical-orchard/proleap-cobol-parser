000100*--------------------------------------------------------------*  07/10/95
000200 IDENTIFICATION DIVISION.                                         POKCS069
000300*--------------------------------------------------------------*     LV001
000400 PROGRAM-ID.    POKCS069.                                         POKCS069
000500 AUTHOR.        SCOTT VANG.                                       POKCS069
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          POKCS069
000700 DATE-WRITTEN.  03-24-95.                                         POKCS069
000800 DATE-COMPILED.                                                   POKCS069
000900*--------------------------------------------------------------*  POKCS069
001000/                                                                 POKCS069
001100*---------------------------------------------------------------* POKCS069
001200*    W069 - PURCHASE ORDER RECEIVER LIST.                       * POKCS069
001300*                                                               * POKCS069
001400*    THIS PROGRAM GENERATES A LIST OF RECEIVERS BY PURCHASE     * POKCS069
001500*    ORDER.  THE PURCHASE ORDER NUMBER AND VENDOR NAME ARE      * POKCS069
001600*    PASSED TO THE PROGRAM, THE REMAINING INFORMATION DISPLAYED * POKCS069
001700*    IS RETRIEVED FROM DB2 TABLES.  EACH RECEIVER FOR THE PO    * POKCS069
001800*    IS LISTED ON THE SCREEN.  TOTALS FOR DOLLARS AND UNITS     * POKCS069
001900*    ARE ALSO CALCULATED AND DISPLAYED ON THE SCREEN.           * POKCS069
002000*    ORDERED DOLLARS AND UNITS, SHIP DATE, CANCEL DATE, AND     * POKCS069
002100*    EXT CANCEL DATE ARE NOW DISPLAYED AT THE TOP OF THE SCREEN * POKCS069
002200*                                                               * POKCS069
002300*---------------------------------------------------------------* POKCS069
653895* 02/09/2009  T.KONTAROVICH EXPAND RECORD SEQUENCE FIELD TO    *          
653895*                           FOUR DIGITS (INC000000653895)        *        
002300*---------------------------------------------------------------* POKCS069
C98147* 11/18/2014  LINDA FRIESS             - CHG0098147                       
C98147*    - EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND COMMAREA                 
C98147*----------------------------------------------------------------*        
076319* DATE  10/27/2021                                                        
076320*            - CHANGE CALL OF 'DPKUT100' TO                     *         
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 *         
076322*              MAKING THE CALL DYNAMIC VS STATIC                *         
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126                
076312*                                                               *         
076318*---------------------------------------------------------------*         
CICS  *  CHANGED 11/15/2022    BY BARB SCHULTZ    WR: CHG0278485      *         
CICS  *                                                               *         
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   *         
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    *         
CICS  *---------------------------------------------------------------*         
002401*  CHANGED 04/04/2023    BY JEAN KURK       WR: CHG0286438      *         
002402*                                                               *         
002403*  ADD ORDER BY REC_SEQ_NBR TO RCVR-CSR                         *         
002405*---------------------------------------------------------------*         
002400/                                                                 POKCS069
002500*--------------------------------------------------------------*  POKCS069
002600 ENVIRONMENT DIVISION.                                            POKCS069
002700*--------------------------------------------------------------*  POKCS069
002800                                                                  POKCS069
002900*--------------------------------------------------------------*  POKCS069
003000 DATA DIVISION.                                                   POKCS069
003100*--------------------------------------------------------------*  POKCS069
003200                                                                  POKCS069
003300 WORKING-STORAGE SECTION.                                         POKCS069
003400                                                                  POKCS069
003500 01  DK-DB2-KEYS.                                                 POKCS069
003600     05  DK-REC-SEQ-NBR                 PIC S9(09) COMP VALUE +0. POKCS069
003700                                                                  POKCS069
003800 01  PC-PROGRAM-CONSTANTS.                                        POKCS069
003900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         POKCS069
004000                                                    'PO069A  '.   POKCS069
004100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         POKCS069
004200                                                    'POKM069 '.   POKCS069
004300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         POKCS069
004400                                                    'POKCS069'.   POKCS069
004500     05  PC-VEA                         PIC  X(04)  VALUE 'VE-A'. POKCS069
004600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      POKCS069
004700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      POKCS069
004800     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    POKCS069
004900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     POKCS069
005000                                                    COMP SYNC.    POKCS069
005100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      POKCS069
005200                                                    COMP SYNC.    POKCS069
005300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         POKCS069
005400                                                    +1000000      POKCS069
005500                                                    COMP-3.       POKCS069
005600     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      POKCS069
005700                                                    COMP SYNC.    POKCS069
005800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      POKCS069
005900                                                    COMP-3.       POKCS069
006000     05  PC-TSYMSG-NUMBERS.                                       POKCS069
006100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  POKCS069
006200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  POKCS069
006300         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  POKCS069
006400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  POKCS069
006500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  POKCS069
006600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  POKCS069
006700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  POKCS069
006800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  POKCS069
006900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  POKCS069
007000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  POKCS069
007100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  POKCS069
007200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  POKCS069
007300         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  POKCS069
007400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  POKCS069
007500         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  POKCS069
007600         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  POKCS069
007700                                                                  POKCS069
007800 01  PS-PROGRAM-SWITCHES.                                         POKCS069
007900     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    POKCS069
008000         88  PS-NO-ERROR                            VALUE 'Y'.    POKCS069
008100         88  PS-ERROR                               VALUE 'N'.    POKCS069
008200     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    POKCS069
008300         88  PS-COMMAREA-VALID                      VALUE 'Y'.    POKCS069
008400         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    POKCS069
008500     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    POKCS069
008600         88  PS-DONE                                VALUE 'Y'.    POKCS069
008700         88  PS-NOT-DONE                            VALUE 'N'.    POKCS069
008800     05  PS-AURECD-EOF-SW               PIC  X(01)  VALUE 'N'.    POKCS069
008900         88  PS-AURECD-EOF                          VALUE 'Y'.    POKCS069
009000         88  PS-AURECD-NOT-EOF                      VALUE 'N'.    POKCS069
009100     05  PS-AURECD-NOT-FOUND-SW         PIC  X(01)  VALUE 'N'.    POKCS069
009200         88  PS-AURECD-FOUND                        VALUE 'Y'.    POKCS069
009300         88  PS-AURECD-NOT-FOUND                    VALUE 'N'.    POKCS069
009400                                                                  POKCS069
009500 01  PV-PROGRAM-VARIABLES.                                        POKCS069
009600     05  PV-AURECD-AUD-TYP-CDE          PIC  X(01)  VALUE SPACE.  POKCS069
009700     05  PV-AURECD-ADJ-CYC-NBR          PIC S9(09)  VALUE ZERO.   POKCS069
009800     05  PV-AURECD-ORD-LNE-NBR          PIC S9(09)  VALUE ZERO    POKCS069
009810                                                    COMP SYNC.    POKCS069
009900     05  PV-SUB                         PIC S9(04)  VALUE +0      POKCS069
010000                                                    COMP SYNC.    POKCS069
010100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      POKCS069
010200                                                    COMP SYNC.    POKCS069
010300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      POKCS069
010400                                                    COMP-3.       POKCS069
010500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      POKCS069
010600                                                    COMP-3.       POKCS069
010700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      POKCS069
010800                                                    COMP-3.       POKCS069
010900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      POKCS069
011000                                                    COMP-3.       POKCS069
011100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      POKCS069
011200                                                    COMP-3.       POKCS069
011300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      POKCS069
011400                                                    COMP-3.       POKCS069
011500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      POKCS069
011600                                                    COMP-3.       POKCS069
011700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      POKCS069
011800                                                    COMP SYNC.    POKCS069
011900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      POKCS069
012000                                                    COMP SYNC.    POKCS069
012100     05  PV-ITEM                        PIC S9(04)  VALUE +0      POKCS069
012200                                                    COMP SYNC.    POKCS069
012300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      POKCS069
012400                                                    COMP SYNC.    POKCS069
012500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      POKCS069
012600                                                    COMP SYNC.    POKCS069
012700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      POKCS069
012800                                                    COMP SYNC.    POKCS069
012900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      POKCS069
013000                                                    COMP SYNC.    POKCS069
013100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      POKCS069
013200                                                    COMP SYNC.    POKCS069
013300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      POKCS069
013400                                                    COMP SYNC.    POKCS069
013500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      POKCS069
013600                                                    COMP SYNC.    POKCS069
013700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      POKCS069
013800                                                    COMP SYNC.    POKCS069
013900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      POKCS069
014000                                                    COMP SYNC.    POKCS069
014100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      POKCS069
014200                                                    COMP SYNC.    POKCS069
014300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      POKCS069
014400                                                    COMP SYNC.    POKCS069
014500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      POKCS069
014600                                                    COMP SYNC.    POKCS069
014700     05  PV-DOLLARS-VERIFIED            PIC S9(10)V99 VALUE +0    POKCS069
014800                                                      COMP-3.     POKCS069
014810     05  PV-CALC-DLRS-VERIFIED          PIC S9(10)V99 VALUE +0    POKCS069
014820                                                      COMP-3.     POKCS069
014900     05  PV-DOLLARS-VERIFIED-NULL       PIC S9(04)  VALUE +0      POKCS069
015000                                                    COMP.         POKCS069
015100     05  PV-UNITS-VERIFIED              PIC S9(06)  VALUE +0      POKCS069
015200                                                      COMP-3.     POKCS069
015300     05  PV-UNITS-VERIFIED-NULL         PIC S9(04)  VALUE +0      POKCS069
015400                                                    COMP.         POKCS069
015500     05  PV-SUM-UNIT-QTY                PIC S9(06)  VALUE +0      POKCS069
015600                                                      COMP-3.     POKCS069
015610     05  PV-SUM-LINE-UNIT-QTY           PIC S9(06)  VALUE +0      POKCS069
015620                                                      COMP-3.     POKCS069
015700     05  PV-REC-DTE                     PIC X(10) VALUE SPACES.   POKCS069
015800     05  PV-REC-TIM                     PIC X(15) VALUE SPACES.   POKCS069
015900     05  PV-VER-DTE                     PIC X(10) VALUE SPACES.   POKCS069
016000     05  PV-VER-TIM                     PIC X(15) VALUE SPACES.   POKCS069
016100     05  PV-UPD-DTE                     PIC X(10) VALUE SPACES.   POKCS069
016200     05  PV-UPD-TIM                     PIC X(15) VALUE SPACES.   POKCS069
016300     05  PV-UPD-DTE-FIRST               PIC X(06) VALUE SPACES.   POKCS069
016400     05  PV-UPD-TIM-FIRST               PIC X(15) VALUE SPACES.   POKCS069
016500                                                                  POKCS069
016600     05  PV-ORD-DTE                     PIC X(10) VALUE SPACES.   POKCS069
016700     05  PV-CAN-DTE                     PIC X(10) VALUE SPACES.   POKCS069
016800     05  PV-EXT-DTE                     PIC X(10) VALUE SPACES.   POKCS069
016900                                                                  POKCS069
017000     05  PV-TOT-DOLLARS-VER             PIC S9(09)V99 VALUE +0    POKCS069
017100                                                       COMP-3.    POKCS069
017200     05  PV-TOT-UNITS-VER               PIC S9(07) VALUE +0       POKCS069
017300                                                       COMP-3.    POKCS069
017400                                                                          
017500     05  PV-UPD-TMST              PIC X(26).                              
017600     05  PV-UPD-TMST-RDF REDEFINES PV-UPD-TMST.                           
017700         10  PV-UPD-TMST-CC       PIC X(02).                              
017800         10  PV-UPD-TMST-YY       PIC X(02).                              
017900         10  FILLER               PIC X(01).                              
018000         10  PV-UPD-TMST-MM       PIC X(02).                              
018100         10  FILLER               PIC X(01).                              
018200         10  PV-UPD-TMST-DD       PIC X(02).                              
018300         10  FILLER               PIC X(01).                              
018400         10  PV-UPD-TMST-TIME     PIC X(15).                              
018500                                                                          
018600     05  PV-UPD-DATE.                                                     
018700         10  PV-UPD-DATE-MM             PIC 9(2)   VALUE ZEROS.           
018800         10  PV-UPD-DATE-DD             PIC 9(2)   VALUE ZEROS.           
018900         10  PV-UPD-DATE-YY             PIC 9(2)   VALUE ZEROS.           
019000                                                                          
019100*---------------------------------------------------------------* POKCS069
019200*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * POKCS069
019300*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * POKCS069
019400*   APPLICATION-SPECIFIC COMMAREA.                              * POKCS069
019500*---------------------------------------------------------------* POKCS069
019600 01  LQW-LIST-QUEUE-WORK-AREA.                                    POKCS069
019700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  POKCS069
019800     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           POKCS069
019900                                        INDEXED BY LQW-IDX.       POKCS069
020000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       POKCS069
020100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               POKCS069
020200         10  LQW-SELECTED-SW            PIC  X(01).               POKCS069
020300             88  LQW-SELECT                         VALUE 'S'.    POKCS069
020400             88  LQW-DESELECT                       VALUE ' '.    POKCS069
653895         10  LQW-REC-SEQ-NBR            PIC  9(04).               POKCS069
020600         10  LQW-FCT-LOC                PIC  9(04) COMP.          POKCS069
020700         10  LQW-FCLTY-ID               PIC  9(04) COMP.          POKCS069
020800         10  LQW-RCVR-STAT-CD           PIC  X(04).               POKCS069
020900         10  LQW-ARRIVAL-DTE            PIC  X(08).               POKCS069
021000         10  LQW-ARRIVAL-TIM            PIC  X(05).               POKCS069
021100         10  LQW-VERIFIED-DTE           PIC  X(08).               POKCS069
021200         10  LQW-VERIFIED-TIM           PIC  X(05).               POKCS069
021300         10  LQW-CTN-CNT                PIC S9(04)  COMP-3.       POKCS069
021400         10  LQW-PCS-VERFD              PIC S9(06)  COMP-3.       POKCS069
021500         10  LQW-DOL-VERFD              PIC S9(10)V99 COMP-3.     POKCS069
021600         10  LQW-CYC-NBR                PIC S9(9)     COMP.       POKCS069
021700/                                                                 POKCS069
021800*---------------------------------------------------------------* POKCS069
021900*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * POKCS069
022000*---------------------------------------------------------------* POKCS069
022100     COPY RCWS013.                                                POKCS069
022200/                                                                 POKCS069
022300*---------------------------------------------------------------* POKCS069
022400*    MAP LAYOUT                                                 * POKCS069
022500*---------------------------------------------------------------* POKCS069
022600     COPY POKM069.                                                POKCS069
022700                                                                  POKCS069
022800 01  MR-OCCURS-LAYOUT                   REDEFINES  PO069AO.       POKCS069
022900     05  FILLER                         PIC X(48).                POKCS069
023000     05  FILLER.                                                  POKCS069
023100         10  MR-PO-NBRL                 PIC S9(04) COMP.          POKCS069
023200         10  MR-PO-NBRA                 PIC  X(01).               POKCS069
023300         10  MR-PO-NBRC                 PIC  X(01).               POKCS069
023400         10  MR-PO-NBRH                 PIC  X(01).               POKCS069
023500         10  MR-PO-NBR-X.                                         POKCS069
C98147             15  MR-PO-NBR              PIC  ZZZZZZZZ.            POKCS069
023700                                                                  POKCS069
023800         10  MR-ORD-UNITSL              PIC S9(04) COMP.          POKCS069
023900         10  MR-ORD-UNITSA              PIC  X(01).               POKCS069
024000         10  MR-ORD-UNITSC              PIC  X(01).               POKCS069
024100         10  MR-ORD-UNITSH              PIC  X(01).               POKCS069
024200         10  MR-ORD-UNITS-X.                                      POKCS069
024300             15  MR-ORD-UNITS           PIC  ZZZZZZ9.             POKCS069
024400                                                                  POKCS069
024500         10  MR-ENT-NAME-DESCL          PIC S9(04) COMP.          POKCS069
024600         10  MR-ENT-NAME-DESCA          PIC  X(01).               POKCS069
024700         10  MR-ENT-NAME-DESCC          PIC  X(01).               POKCS069
024800         10  MR-ENT-NAME-DESCH          PIC  X(01).               POKCS069
024900         10  MR-ENT-NAME-DESC           PIC  X(30).               POKCS069
025000                                                                  POKCS069
025100         10  MR-ORD-DOLSL               PIC S9(04) COMP.          POKCS069
025200         10  MR-ORD-DOLSA               PIC  X(01).               POKCS069
025300         10  MR-ORD-DOLSC               PIC  X(01).               POKCS069
025400         10  MR-ORD-DOLSH               PIC  X(01).               POKCS069
025500         10  MR-ORD-DOLS-X.                                       POKCS069
025600             15  MR-ORD-DOLS            PIC  ZZZ,ZZZ,ZZ9.99.      POKCS069
025700                                                                  POKCS069
025800         10  MR-ORDER-DTEL              PIC S9(04) COMP.          POKCS069
025900         10  MR-ORDER-DTEA              PIC  X(01).               POKCS069
026000         10  MR-ORDER-DTEC              PIC  X(01).               POKCS069
026100         10  MR-ORDER-DTEH              PIC  X(01).               POKCS069
026200         10  MR-ORDER-DTE               PIC  X(08).               POKCS069
026300                                                                  POKCS069
026400         10  MR-CANCEL-DTEL             PIC S9(04) COMP.          POKCS069
026500         10  MR-CANCEL-DTEA             PIC  X(01).               POKCS069
026600         10  MR-CANCEL-DTEC             PIC  X(01).               POKCS069
026700         10  MR-CANCEL-DTEH             PIC  X(01).               POKCS069
026800         10  MR-CANCEL-DTE              PIC  X(08).               POKCS069
026900                                                                  POKCS069
027000         10  MR-EXTCAN-DTEL             PIC S9(04) COMP.          POKCS069
027100         10  MR-EXTCAN-DTEA             PIC  X(01).               POKCS069
027200         10  MR-EXTCAN-DTEC             PIC  X(01).               POKCS069
027300         10  MR-EXTCAN-DTEH             PIC  X(01).               POKCS069
027400         10  MR-EXTCAN-DTE              PIC  X(08).               POKCS069
027500                                                                  POKCS069
027600     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          POKCS069
027700         10  MR-SELECTL                 PIC S9(04) COMP.          POKCS069
027800         10  MR-SELECTA                 PIC  X(01).               POKCS069
027900         10  MR-SELECTC                 PIC  X(01).               POKCS069
028000         10  MR-SELECTH                 PIC  X(01).               POKCS069
028100         10  MR-SELECT                  PIC  X(01).               POKCS069
028200                                                                  POKCS069
028300         10  MR-REC-SEQ-NBRL            PIC S9(04) COMP.          POKCS069
028400         10  MR-REC-SEQ-NBRA            PIC  X(01).               POKCS069
028500         10  MR-REC-SEQ-NBRC            PIC  X(01).               POKCS069
028600         10  MR-REC-SEQ-NBRH            PIC  X(01).               POKCS069
653895         10  MR-REC-SEQ-NBR             PIC  ZZZZ.                POKCS069
028800                                                                  POKCS069
028900         10  MR-REC-SEQ-LOCL            PIC S9(04) COMP.          POKCS069
029000         10  MR-REC-SEQ-LOCA            PIC  X(01).               POKCS069
029100         10  MR-REC-SEQ-LOCC            PIC  X(01).               POKCS069
029200         10  MR-REC-SEQ-LOCH            PIC  X(01).               POKCS069
029300         10  MR-REC-SEQ-LOC             PIC  ZZZZ.                POKCS069
029400                                                                  POKCS069
029500         10  MR-REC-STAT-CDL            PIC S9(04) COMP.          POKCS069
029600         10  MR-REC-STAT-CDA            PIC  X(01).               POKCS069
029700         10  MR-REC-STAT-CDC            PIC  X(01).               POKCS069
029800         10  MR-REC-STAT-CDH            PIC  X(01).               POKCS069
029900         10  MR-REC-STAT-CD             PIC  X(04).               POKCS069
030000                                                                  POKCS069
030100         10  MR-ARRIVAL-DTEL            PIC S9(04) COMP.          POKCS069
030200         10  MR-ARRIVAL-DTEA            PIC  X(01).               POKCS069
030300         10  MR-ARRIVAL-DTEC            PIC  X(01).               POKCS069
030400         10  MR-ARRIVAL-DTEH            PIC  X(01).               POKCS069
030500         10  MR-ARRIVAL-DTE             PIC  X(08).               POKCS069
030600                                                                  POKCS069
030700         10  MR-ARRIVAL-TIMEL           PIC S9(04) COMP.          POKCS069
030800         10  MR-ARRIVAL-TIMEA           PIC  X(01).               POKCS069
030900         10  MR-ARRIVAL-TIMEC           PIC  X(01).               POKCS069
031000         10  MR-ARRIVAL-TIMEH           PIC  X(01).               POKCS069
031100         10  MR-ARRIVAL-TIME            PIC  X(05).               POKCS069
031200                                                                  POKCS069
031300         10  MR-VERIFIED-DTEL           PIC S9(04) COMP.          POKCS069
031400         10  MR-VERIFIED-DTEA           PIC  X(01).               POKCS069
031500         10  MR-VERIFIED-DTEC           PIC  X(01).               POKCS069
031600         10  MR-VERIFIED-DTEH           PIC  X(01).               POKCS069
031700         10  MR-VERIFIED-DTE            PIC  X(08).               POKCS069
031800                                                                  POKCS069
031900         10  MR-VERIFIED-TIMEL          PIC S9(04) COMP.          POKCS069
032000         10  MR-VERIFIED-TIMEA          PIC  X(01).               POKCS069
032100         10  MR-VERIFIED-TIMEC          PIC  X(01).               POKCS069
032200         10  MR-VERIFIED-TIMEH          PIC  X(01).               POKCS069
032300         10  MR-VERIFIED-TIME           PIC  X(05).               POKCS069
032400                                                                  POKCS069
032500         10  MR-DOL-VERFDL              PIC S9(04) COMP.          POKCS069
032600         10  MR-DOL-VERFDA              PIC  X(01).               POKCS069
032700         10  MR-DOL-VERFDC              PIC  X(01).               POKCS069
032800         10  MR-DOL-VERFDH              PIC  X(01).               POKCS069
032900         10  MR-DOL-VERFD-X.                                      POKCS069
033000             15  MR-DOL-VERFD           PIC  ZZ,ZZZ,ZZZ.ZZ-.      POKCS069
033100                                                                  POKCS069
033200         10  MR-PCS-VERFDL              PIC S9(04) COMP.          POKCS069
033300         10  MR-PCS-VERFDA              PIC  X(01).               POKCS069
033400         10  MR-PCS-VERFDC              PIC  X(01).               POKCS069
033500         10  MR-PCS-VERFDH              PIC  X(01).               POKCS069
033600         10  MR-PCS-VERFD-X.                                      POKCS069
033700             15  MR-PCS-VERFD           PIC  ZZZZZZ-.             POKCS069
033800                                                                  POKCS069
033900         10  MR-CARTON-CNTL             PIC S9(04) COMP.          POKCS069
034000         10  MR-CARTON-CNTA             PIC  X(01).               POKCS069
034100         10  MR-CARTON-CNTC             PIC  X(01).               POKCS069
034200         10  MR-CARTON-CNTH             PIC  X(01).               POKCS069
034300         10  MR-CARTON-CNT-X.                                     POKCS069
034400             15  MR-CARTON-CNT          PIC   ZZZZ.               POKCS069
034500                                                                  POKCS069
034600     05  FILLER.                                                  POKCS069
034700         10  MR-DOLLARTOTL              PIC S9(04) COMP.          POKCS069
034800         10  MR-DOLLARTOTA              PIC  X(01).               POKCS069
034900         10  MR-DOLLARTOTC              PIC  X(01).               POKCS069
035000         10  MR-DOLLARTOTH              PIC  X(01).               POKCS069
035100         10  MR-DOLLARTOT-X.                                      POKCS069
035200             15  MR-DOLLARTOT           PIC  ZZZ,ZZZ,ZZ9.99.      POKCS069
035300                                                                  POKCS069
035400     05  FILLER.                                                  POKCS069
035500         10  MR-UNITSTOTL               PIC S9(04) COMP.          POKCS069
035600         10  MR-UNITSTOTA               PIC  X(01).               POKCS069
035700         10  MR-UNITSTOTC               PIC  X(01).               POKCS069
035800         10  MR-UNITSTOTH               PIC  X(01).               POKCS069
035900         10  MR-UNITSTOT-X.                                       POKCS069
036000             15  MR-UNITSTOT            PIC  ZZZZZZ9.             POKCS069
036100/                                                                 POKCS069
036200*---------------------------------------------------------------* POKCS069
036300*    ATTRIBUTE SETTINGS COPYBOOK.                               * POKCS069
036400*---------------------------------------------------------------* POKCS069
036500     COPY DPWS015.                                                POKCS069
036600/                                                                 POKCS069
036700*---------------------------------------------------------------* POKCS069
036800*    FUNCTION KEYS COPYBOOK.                                    * POKCS069
036900*---------------------------------------------------------------* POKCS069
037000     COPY DPWS016.                                                POKCS069
037100/                                                                 POKCS069
037200*---------------------------------------------------------------* POKCS069
037300*    NUMERIC EDIT LAYOUT.                                       * POKCS069
037400*---------------------------------------------------------------* POKCS069
037500     COPY DPWS010I.                                               POKCS069
037600/                                                                 POKCS069
037700*---------------------------------------------------------------* POKCS069
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * POKCS069
037900*---------------------------------------------------------------* POKCS069
038000     COPY DPWS030.                                                POKCS069
CICS       COPY DPWS930.                                                POKCS069
038100/                                                                 POKCS069
038200*---------------------------------------------------------------* POKCS069
038300*    STANDARD COMMAREA.                                         * POKCS069
038400*---------------------------------------------------------------* POKCS069
038500     COPY DPWS020.                                                POKCS069
038600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                POKCS069
038700/                                                                 POKCS069
038800*---------------------------------------------------------------* POKCS069
038900* INTER-APPLICATION COMMAREA.                                   * POKCS069
039000*---------------------------------------------------------------* POKCS069
039100         10  INTER-APPL-COMM-AREA       PIC X(200).               POKCS069
039200     COPY POWS017.                                                POKCS069
039300     COPY RCWS015.                                                POKCS069
039400/                                                                 POKCS069
039500*---------------------------------------------------------------* POKCS069
039600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * POKCS069
039700*---------------------------------------------------------------* POKCS069
039800         10  ASC-SPECIFIC-COMMAREA.                               POKCS069
039900             15  ASC-LIST-KEYS.                                   POKCS069
040000                 20  ASC-KEY-PO-NBR      PIC S9(09) COMP.         POKCS069
040100                 20  ASC-ORD-UNITS       PIC S9(07) COMP.         POKCS069
040200                 20  ASC-KEY-VENDOR-NME  PIC  X(30).              POKCS069
040300                 20  ASC-ORD-DOLLARS     PIC S9(09)V99 COMP.      POKCS069
040400                 20  ASC-ORDER-DTE       PIC X(08).               POKCS069
040500                 20  ASC-CANCEL-DTE      PIC X(08).               POKCS069
040600                 20  ASC-EXTCAN-DTE      PIC X(08).               POKCS069
040700             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                POKCS069
040800                 20  ASC-BLOCK-MODIFIED-SW                        POKCS069
040900                                        PIC X(01).                POKCS069
041000                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    POKCS069
041100                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    POKCS069
041200                                                                  POKCS069
041300                 20  ASC-ITEM-ARRAY.                              POKCS069
041400                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        POKCS069
041500                         30  ASC-LIST-ITEM-NUMBER                 POKCS069
041600                                        PIC S9(09)  COMP-3.       POKCS069
041700                         30  ASC-TEMP-SELECTED-SW                 POKCS069
041800                                        PIC X(01).                POKCS069
041900                             88  ASC-VALID-SELECT   VALUE ' '     POKCS069
042000                                                          'S'     POKCS069
042100                                                          'B'     POKCS069
042200                                                          'E'.    POKCS069
042300                             88  ASC-TEMP-NO-SELECT VALUE ' '.    POKCS069
042400                             88  ASC-TEMP-SELECT    VALUE 'S'.    POKCS069
042500                             88  ASC-TEMP-BEGIN     VALUE 'B'.    POKCS069
042600                             88  ASC-TEMP-END       VALUE 'E'.    POKCS069
042700                         30  ASC-SELECTED-SW                      POKCS069
042800                                        PIC X(01).                POKCS069
042900                             88  ASC-NO-SELECT      VALUE ' '.    POKCS069
043000                             88  ASC-SELECT         VALUE 'S'.    POKCS069
043100                             88  ASC-BEGIN          VALUE 'B'.    POKCS069
043200                             88  ASC-END            VALUE 'E'.    POKCS069
653895                         30  ASC-REC-SEQ-NBR                      POKCS069
653895                                        PIC 9(04).                POKCS069
043500                         30  ASC-LOC                              POKCS069
043600                                        PIC 9(04) COMP.           POKCS069
043700                         30  ASC-FCLTY-ID                         POKCS069
043800                                        PIC 9(04) COMP.           POKCS069
043900                         30  ASC-RECEIVER-STAT                    POKCS069
044000                                        PIC X(04).                POKCS069
044100                         30  ASC-ARRIVAL-DTE      PIC X(08).      POKCS069
044200                                                                  POKCS069
044300                         30  ASC-ARRIVAL-TIM      PIC X(05).      POKCS069
044400                                                                  POKCS069
044500                         30  ASC-VERIFIED-DTE     PIC X(08).      POKCS069
044600                                                                  POKCS069
044700                         30  ASC-VERIFIED-TIM     PIC X(05).      POKCS069
044800                                                                  POKCS069
044900                         30  ASC-CTN-CNT                          POKCS069
045000                                        PIC S9(04)  COMP-3.       POKCS069
045100                         30  ASC-PCS-VERFD                        POKCS069
045200                                        PIC S9(06)  COMP-3.       POKCS069
045300                         30  ASC-DOL-VERFD                        POKCS069
045400                                        PIC S9(10)V99 COMP-3.     POKCS069
045500                         30  ASC-CYC-NBR                          POKCS069
045600                                        PIC S9(9)     COMP.       POKCS069
045700                                                                  POKCS069
045800             15  ASC-TOT-DOLLARS-VER       PIC S9(09)V99          POKCS069
045900                                                 COMP-3.          POKCS069
046000                                                                  POKCS069
046100             15  ASC-TOT-UNITS-VER         PIC S9(07)             POKCS069
046200                                                 COMP-3.          POKCS069
046300                                                                  POKCS069
046400             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     POKCS069
046500             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     POKCS069
046600             15  ASC-NUMBER-OF-ITEMS-READ                         POKCS069
046700                                        PIC S9(09) COMP-3.        POKCS069
046800             15  ASC-NUMBER-OF-SELECTED-ITEMS                     POKCS069
046900                                        PIC S9(09) COMP-3.        POKCS069
047000             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        POKCS069
047100             15  ASC-ITEM-AT-TOP-OF-PANEL                         POKCS069
047200                                        PIC S9(09) COMP-3.        POKCS069
047300             15  ASC-ITEM-AT-BOT-OF-PANEL                         POKCS069
047400                                        PIC S9(09) COMP-3.        POKCS069
047500             15  ASC-HIGHEST-BLOCK-WRITTEN                        POKCS069
047600                                        PIC S9(04) COMP SYNC.     POKCS069
047700             15  ASC-START-OF-SELECTED-RANGE                      POKCS069
047800                                        PIC S9(09) COMP-3.        POKCS069
047900             15  ASC-END-OF-SELECTED-RANGE                        POKCS069
048000                                        PIC S9(09) COMP-3.        POKCS069
048100             15  ASC-ITEMS-LEFT-INDICATOR                         POKCS069
048200                                        PIC X(01).                POKCS069
048300                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     POKCS069
048400                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     POKCS069
048500             15  ASC-TEMP-QUEUE-UPDATE-SW                         POKCS069
048600                                        PIC X(01).                POKCS069
048700                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     POKCS069
048800                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     POKCS069
048900             15  ASC-LIST-QUEUE-NAME.                             POKCS069
049000                 20  ASC-LIST-TERM-ID   PIC X(04).                POKCS069
049100                 20  ASC-LIST-TASK-NUMBER                         POKCS069
049200                                        PIC S9(05) COMP-3.        POKCS069
049300                 20  ASC-LIST-SEQ       PIC 9(01).                POKCS069
049400             15  ASC-SEL-QUEUE-NAME.                              POKCS069
049500                 20  ASC-SEL-TERM-ID    PIC X(04).                POKCS069
049600                 20  ASC-SEL-TASK-NUMBER                          POKCS069
049700                                        PIC S9(05) COMP-3.        POKCS069
049800                 20  ASC-SEL-SEQ        PIC 9(01).                POKCS069
049900                                                                  POKCS069
050000             15  ASC-START-ITEM-REQUEST.                          POKCS069
050100                 20  ASC-START-ITEM-REQUEST-N                     POKCS069
050200                                        PIC 9(07).                POKCS069
050300             15  ASC-ENT-NAME-DESC      PIC X(30).                POKCS069
050400/                                                                 POKCS069
050500*---------------------------------------------------------------* POKCS069
050600*    ABEND PROCESSING COPYBOOK.                                 * POKCS069
050700*---------------------------------------------------------------* POKCS069
050800     COPY DPWS013.                                                POKCS069
050900/                                                                 POKCS069
051000*---------------------------------------------------------------* POKCS069
051100*    DB2 AREA FOR RECEIVER DISTRIBUTION TABLE                   * POKCS069
051200*---------------------------------------------------------------* POKCS069
051300     EXEC SQL                                                     POKCS069
051400          INCLUDE TRECDIS                                         POKCS069
051500     END-EXEC.                                                    POKCS069
051600/                                                                 POKCS069
051700*---------------------------------------------------------------* POKCS069
051800*    DB2 AREA FOR RECEIVER TABLE                                * POKCS069
051900*---------------------------------------------------------------* POKCS069
052000     EXEC SQL                                                     POKCS069
052100          INCLUDE TRECEIV                                         POKCS069
052200     END-EXEC.                                                    POKCS069
052300/                                                                 POKCS069
052400*---------------------------------------------------------------* POKCS069
052500*    DB2 AREA FOR RECEIPT ITEM TABLE                            * POKCS069
052600*---------------------------------------------------------------* POKCS069
052700     EXEC SQL                                                     POKCS069
052800          INCLUDE TRECITM                                         POKCS069
052900     END-EXEC.                                                    POKCS069
053000/                                                                 POKCS069
053100*---------------------------------------------------------------* POKCS069
053200*    DB2 AREA FOR RECEIPT DISTRIBUTION AUDIT TABLE              * POKCS069
053300*---------------------------------------------------------------* POKCS069
053400     EXEC SQL                                                     POKCS069
053500          INCLUDE TAURECD                                         POKCS069
053600     END-EXEC.                                                    POKCS069
053700/                                                                 POKCS069
053800*---------------------------------------------------------------* POKCS069
053900*    DB2 AREA FOR PURCHASE ITEM TABLE                           * POKCS069
054000*---------------------------------------------------------------* POKCS069
054100     EXEC SQL                                                     POKCS069
054200          INCLUDE TPURITM                                         POKCS069
054300     END-EXEC.                                                    POKCS069
054400/                                                                 POKCS069
054500*---------------------------------------------------------------* POKCS069
054600*    DB2 AREA FOR PURCHASE ORDER TABLE                          * POKCS069
054700*---------------------------------------------------------------* POKCS069
054800     EXEC SQL                                                     POKCS069
054900          INCLUDE TPURCHS                                         POKCS069
055000     END-EXEC.                                                    POKCS069
055100/                                                                 POKCS069
055200*---------------------------------------------------------------* POKCS069
055300*    DB2 AREA FOR PURCHASE ORDER DATE TABLE                     * POKCS069
055400*---------------------------------------------------------------* POKCS069
055500     EXEC SQL                                                     POKCS069
055600          INCLUDE TPLNSHP                                         POKCS069
055700     END-EXEC.                                                    POKCS069
055800/                                                                 POKCS069
055900*---------------------------------------------------------------* POKCS069
056000*    DB2 AREA FOR COMMUNICATIONS                                * POKCS069
056100*---------------------------------------------------------------* POKCS069
056200     EXEC SQL                                                     POKCS069
056300          INCLUDE SQLCA                                           POKCS069
056400     END-EXEC.                                                    POKCS069
056500/                                                                 POKCS069
056600*---------------------------------------------------------------* POKCS069
056700*  CURSOR TO SELECT RECEIVERS                                   * POKCS069
056800*---------------------------------------------------------------* POKCS069
056900     EXEC SQL                                                     POKCS069
057000          DECLARE RCVR-CSR CURSOR FOR                             POKCS069
057100          SELECT                                                  POKCS069
057200                 A.REC_SEQ_NBR                                    POKCS069
057300                ,A.OPER_UNT_ID                                    POKCS069
057400                ,A.STATUS_CDE                                     POKCS069
057500                ,A.FCLTY_ID                                       POKCS069
057600                ,DATE(A.REC_TMST)                                 POKCS069
057700                ,TIME(A.REC_TMST)                                 POKCS069
057800                ,DATE(A.VERFYD_TMST)                              POKCS069
057900                ,TIME(A.VERFYD_TMST)                              POKCS069
058000                ,A.ACTL_CART_CNT                                  POKCS069
058100                ,A.EXPTED_CART_CNT                                POKCS069
058200          FROM   TRECEIV A                                        POKCS069
058300                                                                  POKCS069
058400          WHERE A.ORD_NBR = :ASC-KEY-PO-NBR                       POKCS069
058500            AND A.VER_STATUS_CDE = 'A'                            POKCS069
058500          ORDER BY REC_SEQ_NBR                                    POKCS069
058600     END-EXEC.                                                    POKCS069
058700                                                                  POKCS069
058800*---------------------------------------------------------------* POKCS069
058900*  CURSOR TO SELECT ADJUSTMENTS                                 * POKCS069
059000*---------------------------------------------------------------* POKCS069
059100                                                                          
059200     EXEC SQL                                                     POKCS069
059300          DECLARE AURECD-CSR CURSOR FOR                           POKCS069
059400             SELECT UPD_TMST                                      POKCS069
059500                   ,AP_VERIFY_ITM_QTY                             POKCS069
059600                   ,AUD_TYP_CDE                                           
059700                   ,ADJ_CYC_NBR                                   POKCS069
059800                   ,ORD_LNE_NBR                                           
059900             FROM   TAURECD                                       POKCS069
060000             WHERE ORD_NBR        = :ASC-KEY-PO-NBR               POKCS069
060100               AND VER_STATUS_CDE = 'A'                           POKCS069
060200               AND REC_SEQ_NBR    = :RECEIV-REC-SEQ-NBR                   
060300               AND (UPD_PGM_ID    = 'RCKCS279' OR                         
060400                    UPD_PGM_ID    = 'RCKCS280' OR                         
060402                    UPD_PGM_ID    = 'RCKPV818' OR                         
060403                    UPD_PGM_ID    = 'RCKPV819'OR                          
060404                    UPD_PGM_ID    = 'RCKPV820'OR                          
060405                    UPD_PGM_ID    = 'SUKPV702')                           
060410               AND NOT AUD_FUNC_CDE  = 'T'                                
060500             ORDER BY ADJ_CYC_NBR, UPD_TMST                               
060600     END-EXEC.                                                    POKCS069
060700/                                                                 POKCS069
060800*---------------------------------------------------------------* POKCS069
060900 LINKAGE SECTION.                                                 POKCS069
061000*---------------------------------------------------------------* POKCS069
061100 01  DFHCOMMAREA.                                                 POKCS069
061200     05  FILLER                         OCCURS  1 TO 4072 TIMES   POKCS069
061300                                        DEPENDING ON EIBCALEN.    POKCS069
061400         10  FILLER                     PIC X.                    POKCS069
061500/                                                                 POKCS069
061600*---------------------------------------------------------------* POKCS069
061700 PROCEDURE DIVISION.                                              POKCS069
061800*---------------------------------------------------------------* POKCS069
061900*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * POKCS069
062000*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * POKCS069
062100*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * POKCS069
062200*---------------------------------------------------------------* POKCS069
062300 0000-MAIN-MODULE.                                                POKCS069
062400                                                                  POKCS069
062500     INITIALIZE DP030-CICS-API-FIELDS.                            POKCS069
062600                                                                  POKCS069
062700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       POKCS069
062800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          POKCS069
062900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         POKCS069
063000                                                                  POKCS069
063100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       POKCS069
063200                                                                  POKCS069
063300     MOVE LENGTH OF PO069AI        TO DP030-MAP-LENGTH (1).       POKCS069
063400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     POKCS069
063500                                                                  POKCS069
063600     PERFORM 9000-CALL-CICS-ARCH-API.                             POKCS069
063700     PERFORM 1000-CONTROL-PROCESSING                              POKCS069
063800                                                                  POKCS069
063900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     POKCS069
064000     PERFORM 9000-CALL-CICS-ARCH-API.                             POKCS069
064100/                                                                 POKCS069
064200*----------------------------------------------------------------*POKCS069
064300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *POKCS069
064400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *POKCS069
064500*                                                                *POKCS069
064600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *POKCS069
064700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *POKCS069
064800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *POKCS069
064900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *POKCS069
065000*----------------------------------------------------------------*POKCS069
065100 1000-CONTROL-PROCESSING.                                         POKCS069
065200                                                                  POKCS069
065300     EVALUATE TRUE                                                POKCS069
065400                                                                  POKCS069
065500         WHEN DP020-NEXT-ACT-INITIAL                              POKCS069
065600             INITIALIZE ASC-SPECIFIC-COMMAREA                     POKCS069
065700                                                                  POKCS069
065800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            POKCS069
065900                                      ASC-SEL-TERM-ID             POKCS069
066000             MOVE DP020-SRC-TASK-NUMBER                           POKCS069
066100                                   TO ASC-LIST-TASK-NUMBER        POKCS069
066200                                      ASC-SEL-TASK-NUMBER         POKCS069
066300             MOVE PC-LIST-QUEUE-SEQ                               POKCS069
066400                                   TO ASC-LIST-SEQ                POKCS069
066500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 POKCS069
066600                                                                  POKCS069
066700             SET PS-COMMAREA-VALID    TO TRUE                     POKCS069
066800             MOVE SPACE               TO ASC-START-ITEM-REQUEST   POKCS069
066900                                                                  POKCS069
067000             IF  PS-COMMAREA-NOT-VALID                            POKCS069
067100                 SET DP020-NEXT-ACT-APPL-ERROR                    POKCS069
067200                                   TO TRUE                        POKCS069
067300             ELSE                                                 POKCS069
067400                 MOVE PO017-PO-NBR TO ASC-KEY-PO-NBR              POKCS069
067500                 PERFORM 4000-BUILD-INITIAL-PANEL                 POKCS069
067600             END-IF                                               POKCS069
067700                                                                  POKCS069
067800         WHEN DP020-NEXT-ACT-READ-MAP                             POKCS069
067900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        POKCS069
068000                                   TO PV-TOP-ITEM                 POKCS069
068100             PERFORM 2000-PROCESS-PANEL                           POKCS069
068200                                                                  POKCS069
068300         WHEN DP020-NEXT-ACT-RETURN                               POKCS069
068400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        POKCS069
068500                                   TO PV-TOP-ITEM                 POKCS069
068600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    POKCS069
068700             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 POKCS069
068800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   POKCS069
068900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS069
069000                                                                  POKCS069
069100         WHEN OTHER                                               POKCS069
069200             SET DP013-LOGIC-ABEND TO TRUE                        POKCS069
069300             SET DP013-NO-ROLLBACK TO TRUE                        POKCS069
069400             MOVE '1000-CONTROL-PROCESSING'                       POKCS069
069500                                   TO DP013-PARAGRAPH             POKCS069
069600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    POKCS069
069700                                   TO DP013-MESSAGE-TEXT(1)       POKCS069
069800             PERFORM DP013-0000-PROCESS-ABEND                     POKCS069
069900     END-EVALUATE.                                                POKCS069
070000                                                                  POKCS069
070100/                                                                 POKCS069
070200*----------------------------------------------------------------*POKCS069
070300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *POKCS069
070400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *POKCS069
070500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *POKCS069
070600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *POKCS069
070700* FUNCTION KEYS CAN GET THIS FAR.                                *POKCS069
070800*----------------------------------------------------------------*POKCS069
070900 2000-PROCESS-PANEL.                                              POKCS069
071000     EVALUATE TRUE                                                POKCS069
071100         WHEN DP020-SRC-AID = DP016-CLEAR                         POKCS069
071200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    POKCS069
071300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   POKCS069
071400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS069
071500                                                                  POKCS069
071600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    POKCS069
071700             PERFORM 2050-DELETE-LIST-QUEUE                       POKCS069
071800             MOVE RC015-PO-NBR TO ASC-KEY-PO-NBR                  POKCS069
071900             PERFORM 4000-BUILD-INITIAL-PANEL                     POKCS069
072000                                                                  POKCS069
072100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    POKCS069
072200             PERFORM 2140-DESELECT-ALL-ITEMS                      POKCS069
072300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS069
072400                                                                  POKCS069
072500         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 POKCS069
072600              PERFORM 2150-SELECT-ALL-ITEMS                       POKCS069
072700              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                POKCS069
072800                                                                  POKCS069
072900         WHEN OTHER                                               POKCS069
073000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 POKCS069
073100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   POKCS069
073200             IF  PS-NO-ERROR                                      POKCS069
073300                 SET DP030-CONTINUE-GO TO TRUE                    POKCS069
073400                 PERFORM 2100-CHECK-FUNCTION-KEY                  POKCS069
073500             ELSE                                                 POKCS069
073600                 SET DP030-OVERRIDE-GO TO TRUE                    POKCS069
073700             END-IF                                               POKCS069
073800     END-EVALUATE.                                                POKCS069
073900/                                                                 POKCS069
074000*----------------------------------------------------------------*POKCS069
074100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *POKCS069
074200*----------------------------------------------------------------*POKCS069
074300 2050-DELETE-LIST-QUEUE.                                          POKCS069
074400                                                                  POKCS069
074500     EXEC CICS                                                    POKCS069
074600         DELETEQ TS                                               POKCS069
074700           QUEUE (ASC-LIST-QUEUE-NAME)                            POKCS069
074800            RESP (PV-CICS-RESP)                                   POKCS069
074900     END-EXEC.                                                    POKCS069
075000                                                                  POKCS069
075100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       POKCS069
075200        (PV-CICS-RESP = DFHRESP(QIDERR))                          POKCS069
075300         CONTINUE                                                 POKCS069
075400     ELSE                                                         POKCS069
075500         SET DP013-CICS-ABEND      TO TRUE                        POKCS069
075600         SET DP013-NO-ROLLBACK     TO TRUE                        POKCS069
075700                                                                  POKCS069
075800         MOVE '2050-DELETE-LIST-QUEUE'                            POKCS069
075900                                   TO DP013-PARAGRAPH             POKCS069
076000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    POKCS069
076100                                   TO DP013-MESSAGE-TEXT (1)      POKCS069
076200         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
076300     END-IF.                                                      POKCS069
076400                                                                  POKCS069
076500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  POKCS069
076600/                                                                 POKCS069
076700*----------------------------------------------------------------*POKCS069
076800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*POKCS069
076900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *POKCS069
077000* CICS ARCHITECTURE API.                                         *POKCS069
077100*----------------------------------------------------------------*POKCS069
077200 2100-CHECK-FUNCTION-KEY.                                         POKCS069
077300                                                                  POKCS069
077400     EVALUATE TRUE                                                POKCS069
077500         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  POKCS069
077600             INITIALIZE RC015-INTER-APPL-COMMAREA                 POKCS069
077700                                                                  POKCS069
077800             IF ASC-NUMBER-OF-SELECTED-ITEMS > 0                  POKCS069
077900                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                 POKCS069
078000                                TO RC015-NUMBER-OF-SELECTED-ITEMS POKCS069
078100                MOVE ASC-LOC (ASC-BLK-SUB ASC-ITEM-SUB)           POKCS069
078200                                TO RC015-OPER-UNT-ID              POKCS069
078300                MOVE ASC-FCLTY-ID (ASC-BLK-SUB ASC-ITEM-SUB)      POKCS069
078400                                TO RC015-FCLTY-ID                 POKCS069
078500             ELSE                                                 POKCS069
078600                MOVE ZEROES     TO RC015-OPER-UNT-ID              POKCS069
078700                MOVE ZEROES     TO RC015-FCLTY-ID                 POKCS069
078800                MOVE ZEROES     TO RC015-NUMBER-OF-SELECTED-ITEMS POKCS069
078900             END-IF                                               POKCS069
079000                                                                  POKCS069
079100             PERFORM 5000-PREPARE-SEL-QUEUE                       POKCS069
079200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > +0                POKCS069
079300                 PERFORM 7000-FORMAT-COMMAREA                     POKCS069
079400             END-IF                                               POKCS069
079500                                                                  POKCS069
079600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  POKCS069
079700             MOVE +1               TO PV-TOP-ITEM                 POKCS069
079800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS069
079900             PERFORM 3200-RESET-ATTRIBUTES                        POKCS069
080000                                                                  POKCS069
080100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   POKCS069
080200             PERFORM 2110-BROWSE-BACKWARD                         POKCS069
080300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS069
080400             PERFORM 3200-RESET-ATTRIBUTES                        POKCS069
080500                                                                  POKCS069
080600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   POKCS069
080700             PERFORM 2120-BROWSE-FORWARD                          POKCS069
080800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS069
080900             PERFORM 3200-RESET-ATTRIBUTES                        POKCS069
081000                                                                  POKCS069
081100         WHEN DP020-SRC-AID = DP016-ENTER                         POKCS069
081200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   POKCS069
081300             IF  PS-ERROR                                         POKCS069
081400                 CONTINUE                                         POKCS069
081500             ELSE                                                 POKCS069
081600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             POKCS069
081700             END-IF                                               POKCS069
081800                                                                  POKCS069
081900         WHEN OTHER                                               POKCS069
082000             SET DP013-NO-ROLLBACK                                POKCS069
082100                 DP013-XCTL-DISPLAY-RESTART                       POKCS069
082200                 DP013-CICS-ABEND  TO TRUE                        POKCS069
082300             MOVE '2100-CHECK-FUNCTION-KEY1'                      POKCS069
082400                                   TO DP013-PARAGRAPH             POKCS069
082500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      POKCS069
082600                                   TO DP013-MESSAGE-TEXT (1)      POKCS069
082700             PERFORM DP013-0000-PROCESS-ABEND                     POKCS069
082800     END-EVALUATE.                                                POKCS069
082900/                                                                 POKCS069
083000*----------------------------------------------------------------*POKCS069
083100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *POKCS069
083200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *POKCS069
083300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *POKCS069
083400*    MESSAGE.                                                    *POKCS069
083500*----------------------------------------------------------------*POKCS069
083600 2110-BROWSE-BACKWARD.                                            POKCS069
083700                                                                  POKCS069
083800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    POKCS069
083900         GIVING PV-TOP-ITEM.                                      POKCS069
084000                                                                  POKCS069
084100     IF  ((PV-TOP-ITEM < +1)                                      POKCS069
084200       OR (PV-TOP-ITEM = +1))                                     POKCS069
084300         MOVE +1                   TO PV-TOP-ITEM                 POKCS069
084400*        -- TOP OF LIST --                                        POKCS069
084500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            POKCS069
084600         SET DP020-MSG-INFORMATIONAL                              POKCS069
084700                                   TO TRUE                        POKCS069
084800     END-IF.                                                      POKCS069
084900/                                                                 POKCS069
085000*----------------------------------------------------------------*POKCS069
085100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *POKCS069
085200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *POKCS069
085300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *POKCS069
085400*----------------------------------------------------------------*POKCS069
085500 2120-BROWSE-FORWARD.                                             POKCS069
085600                                                                  POKCS069
085700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              POKCS069
085800         GIVING PV-TOP-ITEM.                                      POKCS069
085900                                                                  POKCS069
086000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   POKCS069
086100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            POKCS069
086200                                   TO PV-TOP-ITEM                 POKCS069
086300*        -- BOTTOM OF LIST --                                     POKCS069
086400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            POKCS069
086500         SET DP020-MSG-INFORMATIONAL                              POKCS069
086600                                   TO TRUE                        POKCS069
086700     ELSE                                                         POKCS069
086800         COMPUTE PV-BOTTOM-ITEM =                                 POKCS069
086900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 POKCS069
087000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            POKCS069
087100*            -- BOTTOM OF LIST --                                 POKCS069
087200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            POKCS069
087300             SET DP020-MSG-INFORMATIONAL                          POKCS069
087400                                   TO TRUE                        POKCS069
087500         END-IF                                                   POKCS069
087600     END-IF.                                                      POKCS069
087700/                                                                 POKCS069
087800*----------------------------------------------------------------*POKCS069
087900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *POKCS069
088000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *POKCS069
088100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *POKCS069
088200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *POKCS069
088300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *POKCS069
088400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *POKCS069
088500*----------------------------------------------------------------*POKCS069
088600 2130-CHECK-FOR-JUMP-BROWSE.                                      POKCS069
088700                                                                  POKCS069
088800     SET PS-NO-ERROR               TO TRUE.                       POKCS069
088900     IF (ASC-START-ITEM-REQUEST = SPACE)                          POKCS069
089000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            POKCS069
089100                                   TO PV-TOP-ITEM                 POKCS069
089200     ELSE                                                         POKCS069
089300         MOVE ASC-START-ITEM-REQUEST                              POKCS069
089400                                   TO DP010I-UNEDITED-FIELD       POKCS069
089500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       POKCS069
089600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     POKCS069
089700         SET DP010I-NEGATIVE-NOT-ALLOWED                          POKCS069
089800                                   TO TRUE                        POKCS069
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
264230                         USING DP010I-NUMERIC-EDIT-AREA                   
090000                                                                  POKCS069
090100         IF  NOT DP010I-ERROR-DETECTED                            POKCS069
090200             MOVE DP010I-NUMERIC-FIELD                            POKCS069
090300                                   TO ASC-START-ITEM-REQUEST-N    POKCS069
090400             IF  ASC-START-ITEM-REQUEST-N > ZERO                  POKCS069
090500                 IF  ASC-START-ITEM-REQUEST-N >                   POKCS069
090600                                          ASC-NUMBER-OF-ITEMS-READPOKCS069
090700                     MOVE SPACE TO ASC-START-ITEM-REQUEST         POKCS069
090800                     COMPUTE PV-TOP-ITEM =                        POKCS069
090900                             ASC-NUMBER-OF-ITEMS-READ             POKCS069
091000                             - PC-ITEMS-PER-PANEL + 1             POKCS069
091100                     IF  PV-TOP-ITEM < +1                         POKCS069
091200                         MOVE +1   TO PV-TOP-ITEM                 POKCS069
091300                         MOVE PC-TSYMSG-00070                     POKCS069
091400                                   TO DP020-MSG-NUMBER            POKCS069
091500                         SET DP020-MSG-INFORMATIONAL              POKCS069
091600                                   TO TRUE                        POKCS069
091700                     END-IF                                       POKCS069
091800                 ELSE                                             POKCS069
091900                     MOVE ASC-START-ITEM-REQUEST-N                POKCS069
092000                                   TO PV-TOP-ITEM                 POKCS069
092100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      POKCS069
092200                     COMPUTE PV-BOTTOM-ITEM =                     POKCS069
092300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     POKCS069
092400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READPOKCS069
092500*                        -- BOTTOM OF LIST --                     POKCS069
092600                         MOVE PC-TSYMSG-00070                     POKCS069
092700                                   TO DP020-MSG-NUMBER            POKCS069
092800                         SET DP020-MSG-INFORMATIONAL              POKCS069
092900                                   TO TRUE                        POKCS069
093000                     END-IF                                       POKCS069
093100                 END-IF                                           POKCS069
093200             ELSE                                                 POKCS069
093300*                --- VALUE OUT OF RANGE ----                      POKCS069
093400                 MOVE PC-TSYMSG-00101                             POKCS069
093500                                   TO DP020-MSG-NUMBER            POKCS069
093600                 MOVE -1           TO ASTRTITL                    POKCS069
093700                 SET DP030-SET-CURSOR-APPL-1                      POKCS069
093800                                   TO TRUE                        POKCS069
093900                 MOVE DP015-REVERSE                               POKCS069
094000                                   TO ASTRTITH                    POKCS069
094100                 MOVE DP015-RED    TO ASTRTITC                    POKCS069
094200                 MOVE DP015-UNP-NUM-BRT-MDT                       POKCS069
094300                                   TO ASTRTITA                    POKCS069
094400                 SET DP020-MSG-FATAL                              POKCS069
094500                                   TO TRUE                        POKCS069
094600                 SET PS-ERROR      TO TRUE                        POKCS069
094700             END-IF                                               POKCS069
094800                                                                  POKCS069
094900         ELSE                                                     POKCS069
095000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            POKCS069
095100             MOVE -1               TO ASTRTITL                    POKCS069
095200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  POKCS069
095300             MOVE DP015-REVERSE    TO ASTRTITH                    POKCS069
095400             MOVE DP015-RED        TO ASTRTITC                    POKCS069
095500             MOVE DP015-UNP-NUM-BRT-MDT                           POKCS069
095600                                   TO ASTRTITA                    POKCS069
095700             SET DP020-MSG-FATAL   TO TRUE                        POKCS069
095800             SET PS-ERROR          TO TRUE                        POKCS069
095900         END-IF                                                   POKCS069
096000     END-IF.                                                      POKCS069
096100/                                                                 POKCS069
096200*----------------------------------------------------------------*POKCS069
096300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *POKCS069
096400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *POKCS069
096500*----------------------------------------------------------------*POKCS069
096600 2140-DESELECT-ALL-ITEMS.                                         POKCS069
096700                                                                  POKCS069
096800     MOVE +1                       TO ASC-BLK-SUB.                POKCS069
096900                                                                  POKCS069
097000     PERFORM 2141-CLEAR-SELECTED-INDS                             POKCS069
097100         VARYING ASC-ITEM-SUB                                     POKCS069
097200         FROM 1 BY 1                                              POKCS069
097300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS069
097400                                                                  POKCS069
097500     ADD +1                        TO ASC-BLK-SUB.                POKCS069
097600                                                                  POKCS069
097700     PERFORM 2141-CLEAR-SELECTED-INDS                             POKCS069
097800         VARYING ASC-ITEM-SUB                                     POKCS069
097900         FROM 1 BY 1                                              POKCS069
098000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS069
098100                                                                  POKCS069
098200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               POKCS069
098300                                   TO PV-LIST-ITEM-NUMBER.        POKCS069
098400                                                                  POKCS069
098500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            POKCS069
098600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    POKCS069
098700                                                                  POKCS069
098800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     POKCS069
098900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      POKCS069
099000         MOVE +1                   TO ASC-BLK-SUB                 POKCS069
099100                                                                  POKCS069
099200         PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS069
099300                                                                  POKCS069
099400         MOVE +1                   TO PV-BLOCK-NUMBER             POKCS069
099500                                                                  POKCS069
099600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         POKCS069
099700             PV-FIRST-BLOCK-IN-ARRAY - 1                          POKCS069
099800                                                                  POKCS069
099900         PERFORM                                                  POKCS069
100000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       POKCS069
100100                                                                  POKCS069
100200             PERFORM 4410-READ-TEMP-STORAGE                       POKCS069
100300                                                                  POKCS069
100400             PERFORM 2141-CLEAR-SELECTED-INDS                     POKCS069
100500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 POKCS069
100600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS069
100700                                                                  POKCS069
100800             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS069
100900                                                                  POKCS069
101000             ADD +1                TO PV-BLOCK-NUMBER             POKCS069
101100                                                                  POKCS069
101200         END-PERFORM                                              POKCS069
101300                                                                  POKCS069
101400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         POKCS069
101500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     POKCS069
101600                                                                  POKCS069
101700         PERFORM                                                  POKCS069
101800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       POKCS069
101900                   ASC-HIGHEST-BLOCK-WRITTEN                      POKCS069
102000                                                                  POKCS069
102100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          POKCS069
102200                                   TO PV-BLOCK-NUMBER             POKCS069
102300                                                                  POKCS069
102400             PERFORM 4410-READ-TEMP-STORAGE                       POKCS069
102500                                                                  POKCS069
102600             PERFORM 2141-CLEAR-SELECTED-INDS                     POKCS069
102700                 VARYING ASC-ITEM-SUB                             POKCS069
102800                 FROM 1 BY 1                                      POKCS069
102900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS069
103000                                                                  POKCS069
103100             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS069
103200                                                                  POKCS069
103300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      POKCS069
103400                                                                  POKCS069
103500         END-PERFORM                                              POKCS069
103600                                                                  POKCS069
103700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             POKCS069
103800                                   TO PV-BLOCK-NUMBER             POKCS069
103900                                                                  POKCS069
104000         PERFORM 4410-READ-TEMP-STORAGE                           POKCS069
104100     END-IF.                                                      POKCS069
104200                                                                  POKCS069
104300     MOVE +0                      TO ASC-NUMBER-OF-SELECTED-ITEMS.POKCS069
104400     MOVE +0                      TO ASC-START-OF-SELECTED-RANGE. POKCS069
104500     MOVE +0                      TO ASC-END-OF-SELECTED-RANGE.   POKCS069
104600                                                                  POKCS069
104700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        POKCS069
104800/                                                                 POKCS069
104900*----------------------------------------------------------------*POKCS069
105000*    MARK EACH ITEM AS BEING NOT SELECTED.                       *POKCS069
105100*----------------------------------------------------------------*POKCS069
105200 2141-CLEAR-SELECTED-INDS.                                        POKCS069
105300                                                                  POKCS069
105400     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          POKCS069
105500             NOT EQUAL ZERO                                       POKCS069
105600         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          POKCS069
105700             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          POKCS069
105800                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    POKCS069
105900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  POKCS069
106000                                   TO TRUE                        POKCS069
106100         END-IF                                                   POKCS069
106200     END-IF.                                                      POKCS069
106300/                                                                 POKCS069
106400*----------------------------------------------------------------*POKCS069
106500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *POKCS069
106600*  FOR ALL ITEMS.                                                *POKCS069
106700*----------------------------------------------------------------*POKCS069
106800 2150-SELECT-ALL-ITEMS.                                           POKCS069
106900                                                                  POKCS069
107000     MOVE +1                       TO ASC-BLK-SUB.                POKCS069
107100                                                                  POKCS069
107200     PERFORM 2151-SET-SELECTED-INDS                               POKCS069
107300         VARYING ASC-ITEM-SUB                                     POKCS069
107400         FROM 1 BY 1                                              POKCS069
107500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS069
107600                                                                  POKCS069
107700     ADD +1                        TO ASC-BLK-SUB.                POKCS069
107800                                                                  POKCS069
107900     PERFORM 2151-SET-SELECTED-INDS                               POKCS069
108000         VARYING ASC-ITEM-SUB                                     POKCS069
108100         FROM 1 BY 1                                              POKCS069
108200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS069
108300                                                                  POKCS069
108400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               POKCS069
108500                                   TO PV-LIST-ITEM-NUMBER.        POKCS069
108600                                                                  POKCS069
108700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            POKCS069
108800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    POKCS069
108900                                                                  POKCS069
109000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     POKCS069
109100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    POKCS069
109200         MOVE +1                   TO ASC-BLK-SUB                 POKCS069
109300                                                                  POKCS069
109400         PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS069
109500                                                                  POKCS069
109600         MOVE +1                   TO PV-BLOCK-NUMBER             POKCS069
109700                                                                  POKCS069
109800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         POKCS069
109900             PV-FIRST-BLOCK-IN-ARRAY - 1                          POKCS069
110000                                                                  POKCS069
110100         PERFORM                                                  POKCS069
110200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       POKCS069
110300                                                                  POKCS069
110400             PERFORM 4410-READ-TEMP-STORAGE                       POKCS069
110500                                                                  POKCS069
110600             PERFORM 2151-SET-SELECTED-INDS                       POKCS069
110700                 VARYING ASC-ITEM-SUB                             POKCS069
110800                 FROM 1 BY 1                                      POKCS069
110900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS069
111000                                                                  POKCS069
111100             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS069
111200                                                                  POKCS069
111300             ADD +1                TO PV-BLOCK-NUMBER             POKCS069
111400         END-PERFORM                                              POKCS069
111500                                                                  POKCS069
111600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         POKCS069
111700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     POKCS069
111800                                                                  POKCS069
111900         PERFORM                                                  POKCS069
112000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       POKCS069
112100                   ASC-HIGHEST-BLOCK-WRITTEN                      POKCS069
112200                                                                  POKCS069
112300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          POKCS069
112400                                   TO PV-BLOCK-NUMBER             POKCS069
112500                                                                  POKCS069
112600             PERFORM 4410-READ-TEMP-STORAGE                       POKCS069
112700                                                                  POKCS069
112800             PERFORM 2151-SET-SELECTED-INDS                       POKCS069
112900                 VARYING ASC-ITEM-SUB                             POKCS069
113000                 FROM 1 BY 1                                      POKCS069
113100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS069
113200                                                                  POKCS069
113300             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS069
113400                                                                  POKCS069
113500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      POKCS069
113600         END-PERFORM                                              POKCS069
113700                                                                  POKCS069
113800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             POKCS069
113900                                   TO PV-BLOCK-NUMBER             POKCS069
114000                                                                  POKCS069
114100         PERFORM 4410-READ-TEMP-STORAGE                           POKCS069
114200     END-IF.                                                      POKCS069
114300                                                                  POKCS069
114400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             POKCS069
114500          ASC-NUMBER-OF-SELECTED-ITEMS.                           POKCS069
114600                                                                  POKCS069
114700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        POKCS069
114800/                                                                 POKCS069
114900*----------------------------------------------------------------*POKCS069
115000*    MARK EACH ITEM AS BEING SELECTED.                           *POKCS069
115100*----------------------------------------------------------------*POKCS069
115200 2151-SET-SELECTED-INDS.                                          POKCS069
115300                                                                  POKCS069
115400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           POKCS069
115500             NOT EQUAL ZERO                                       POKCS069
115600         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             POKCS069
115700             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             POKCS069
115800                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        POKCS069
115900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  POKCS069
116000                                   TO TRUE                        POKCS069
116100         END-IF                                                   POKCS069
116200     END-IF.                                                      POKCS069
116300/                                                                 POKCS069
116400*----------------------------------------------------------------*POKCS069
116500*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *POKCS069
116600*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *POKCS069
116700*----------------------------------------------------------------*POKCS069
116800 2200-MOVE-SCREEN-TO-COMMAREA.                                    POKCS069
116900                                                                  POKCS069
117000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             POKCS069
117100     MOVE +1                       TO PV-SUB.                     POKCS069
117200                                                                  POKCS069
117300     PERFORM 3100-SET-SUBSCRIPTS.                                 POKCS069
117400                                                                  POKCS069
117500     IF  ASTRTITL > ZERO                                          POKCS069
117600         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      POKCS069
117700     ELSE                                                         POKCS069
117800         IF  ASTRTITF = DP015-ERASE-EOF                           POKCS069
117900             INITIALIZE ASC-START-ITEM-REQUEST                    POKCS069
118000         END-IF                                                   POKCS069
118100     END-IF.                                                      POKCS069
118200                                                                  POKCS069
118300     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          POKCS069
118400         VARYING PV-SUB                                           POKCS069
118500         FROM 1 BY 1                                              POKCS069
118600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      POKCS069
118700/                                                                 POKCS069
118800*----------------------------------------------------------------*POKCS069
118900*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *POKCS069
119000*----------------------------------------------------------------*POKCS069
119100 2210-MOVE-LINES-TO-COMMAREA.                                     POKCS069
119200                                                                  POKCS069
119300     IF  MR-SELECTL (PV-SUB) > ZERO                               POKCS069
119400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     POKCS069
119500                                   TO TRUE                        POKCS069
119600         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        POKCS069
119700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      POKCS069
119800     ELSE                                                         POKCS069
119900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                POKCS069
120000             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         POKCS069
120100             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        POKCS069
120200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      POKCS069
120300         END-IF                                                   POKCS069
120400     END-IF.                                                      POKCS069
120500                                                                  POKCS069
120600     ADD +1                        TO ASC-ITEM-SUB.               POKCS069
120700                                                                  POKCS069
120800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        POKCS069
120900         ADD +1                    TO ASC-BLK-SUB                 POKCS069
121000         MOVE +1                   TO ASC-ITEM-SUB                POKCS069
121100     END-IF.                                                      POKCS069
121200/                                                                 POKCS069
121300*----------------------------------------------------------------*POKCS069
121400*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *POKCS069
121500*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *POKCS069
121600*----------------------------------------------------------------*POKCS069
121700 3000-EDIT-DATA-IN-COMMAREA.                                      POKCS069
121800                                                                  POKCS069
121900     SET PS-NO-ERROR               TO TRUE.                       POKCS069
122000                                                                  POKCS069
122100     PERFORM 3200-RESET-ATTRIBUTES.                               POKCS069
122200                                                                  POKCS069
122300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     POKCS069
122400**                                                                POKCS069
122500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              POKCS069
122600* EDITTING IS DONE FROM THE BOTTOM UP.                            POKCS069
122700**                                                                POKCS069
122800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       POKCS069
122900         ASC-ITEMS-DISPLAYED - 1.                                 POKCS069
123000                                                                  POKCS069
123100     PERFORM 3100-SET-SUBSCRIPTS.                                 POKCS069
123200     PERFORM 3300-EDIT-SELECTIONS                                 POKCS069
123300         VARYING PV-SUB                                           POKCS069
123400         FROM PV-SUB BY -1                                        POKCS069
123500         UNTIL PV-SUB < +1                                        POKCS069
123600                                                                  POKCS069
123700     IF  PS-NO-ERROR                                              POKCS069
123800         PERFORM 3400-CHECK-RANGE-SEQUENCE                        POKCS069
123900     END-IF.                                                      POKCS069
124000                                                                  POKCS069
124100     IF  ((PS-NO-ERROR)                                           POKCS069
124200       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   POKCS069
124300       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    POKCS069
124400             PERFORM 3500-MARK-RANGE-AS-SELECTED                  POKCS069
124500     END-IF.                                                      POKCS069
124600/                                                                 POKCS069
124700*----------------------------------------------------------------*POKCS069
124800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *POKCS069
124900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*POKCS069
125000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *POKCS069
125100*                                                                *POKCS069
125200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *POKCS069
125300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *POKCS069
125400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *POKCS069
125500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *POKCS069
125600*----------------------------------------------------------------*POKCS069
125700 3100-SET-SUBSCRIPTS.                                             POKCS069
125800                                                                  POKCS069
125900     COMPUTE ASC-ITEM-SUB =                                       POKCS069
126000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        POKCS069
126100                                                                  POKCS069
126200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         POKCS069
126300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            POKCS069
126400                                                                  POKCS069
126500         MOVE PC-MAX-BLOCKS-IN-ARRAY                              POKCS069
126600                                   TO ASC-BLK-SUB                 POKCS069
126700     ELSE                                                         POKCS069
126800         MOVE +1                   TO ASC-BLK-SUB                 POKCS069
126900     END-IF.                                                      POKCS069
127000/                                                                 POKCS069
127100*----------------------------------------------------------------*POKCS069
127200*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *POKCS069
127300*----------------------------------------------------------------*POKCS069
127400 3200-RESET-ATTRIBUTES.                                           POKCS069
127500                                                                  POKCS069
127600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   POKCS069
127700     MOVE DP015-GREEN              TO ASTRTITC.                   POKCS069
127800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   POKCS069
127900                                                                  POKCS069
128000     IF DP020-NEXT-ACT-RETURN                                     POKCS069
128100     OR DP020-NEXT-ACT-READ-MAP                                   POKCS069
128200        PERFORM                                                   POKCS069
128300            VARYING PV-SUB                                        POKCS069
128400            FROM 1 BY 1                                           POKCS069
128500            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    POKCS069
128600            MOVE DP015-UNP-ALP-NOR-OFF                            POKCS069
128700                                      TO MR-SELECTA (PV-SUB)      POKCS069
128800            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      POKCS069
128900            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      POKCS069
129000        END-PERFORM                                               POKCS069
129100     ELSE                                                         POKCS069
129200        PERFORM                                                   POKCS069
129300            VARYING PV-SUB                                        POKCS069
129400            FROM 1 BY 1                                           POKCS069
129500            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     POKCS069
129600            MOVE DP015-UNP-ALP-NOR-OFF                            POKCS069
129700                                      TO MR-SELECTA (PV-SUB)      POKCS069
129800            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      POKCS069
129900            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      POKCS069
130000        END-PERFORM                                               POKCS069
130100     END-IF.                                                      POKCS069
130200/                                                                 POKCS069
130300*----------------------------------------------------------------*POKCS069
130400*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *POKCS069
130500*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *POKCS069
130600*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *POKCS069
130700*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *POKCS069
130800*----------------------------------------------------------------*POKCS069
130900 3300-EDIT-SELECTIONS.                                            POKCS069
131000                                                                  POKCS069
131100     EVALUATE TRUE                                                POKCS069
131200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     POKCS069
131300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         POKCS069
131400                 CONTINUE                                         POKCS069
131500                                                                  POKCS069
131600         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         POKCS069
131700             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        POKCS069
131800                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMSPOKCS069
131900                 MOVE ASC-TEMP-SELECTED-SW                        POKCS069
132000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   POKCS069
132100                                   TO ASC-SELECTED-SW             POKCS069
132200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   POKCS069
132300             END-IF                                               POKCS069
132400                                                                  POKCS069
132500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     POKCS069
132600                 = SPACE                                          POKCS069
132700             EVALUATE TRUE                                        POKCS069
132800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       POKCS069
132900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSPOKCS069
133000                     MOVE SPACE    TO ASC-SELECTED-SW             POKCS069
133100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   POKCS069
133200                                                                  POKCS069
133300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        POKCS069
133400                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE POKCS069
133500                     MOVE SPACE    TO ASC-SELECTED-SW             POKCS069
133600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   POKCS069
133700                                                                  POKCS069
133800                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          POKCS069
133900                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   POKCS069
134000                     MOVE SPACE    TO ASC-SELECTED-SW             POKCS069
134100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   POKCS069
134200             END-EVALUATE                                         POKCS069
134300                                                                  POKCS069
134400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           POKCS069
134500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            POKCS069
134600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    POKCS069
134700             END-IF                                               POKCS069
134800             PERFORM 3310-EDIT-RANGE                              POKCS069
134900                                                                  POKCS069
135000         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             POKCS069
135100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            POKCS069
135200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    POKCS069
135300             END-IF                                               POKCS069
135400             PERFORM 3310-EDIT-RANGE                              POKCS069
135500                                                                  POKCS069
135600         WHEN OTHER                                               POKCS069
135700             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            POKCS069
135800             SET DP020-MSG-FATAL   TO TRUE                        POKCS069
135900             MOVE -1               TO MR-SELECTL (PV-SUB)         POKCS069
136000             SET DP030-SET-CURSOR-APPL-1                          POKCS069
136100                                   TO TRUE                        POKCS069
136200             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         POKCS069
136300             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         POKCS069
136400             SET PS-ERROR          TO TRUE                        POKCS069
136500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            POKCS069
136600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     POKCS069
136700                 MOVE SPACE        TO ASC-SELECTED-SW             POKCS069
136800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   POKCS069
136900             END-IF                                               POKCS069
137000     END-EVALUATE.                                                POKCS069
137100                                                                  POKCS069
137200     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             POKCS069
137300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               POKCS069
137400                                                                  POKCS069
137500     IF  ASC-ITEM-SUB < 1                                         POKCS069
137600         SUBTRACT +1 FROM ASC-BLK-SUB                             POKCS069
137700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                POKCS069
137800     END-IF.                                                      POKCS069
137900/                                                                 POKCS069
138000*----------------------------------------------------------------*POKCS069
138100*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *POKCS069
138200*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *POKCS069
138300*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *POKCS069
138400*  THE ENDING.                                                   *POKCS069
138500*----------------------------------------------------------------*POKCS069
138600 3310-EDIT-RANGE.                                                 POKCS069
138700                                                                  POKCS069
138800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                POKCS069
138900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   POKCS069
139000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)POKCS069
139100                                   TO ASC-SELECTED-SW             POKCS069
139200                                        (ASC-BLK-SUB ASC-ITEM-SUB)POKCS069
139300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE POKCS069
139400         ELSE                                                     POKCS069
139500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     POKCS069
139600                 CONTINUE                                         POKCS069
139700             ELSE                                                 POKCS069
139800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        POKCS069
139900                 MOVE PC-TSYMSG-00054                             POKCS069
140000                                   TO DP020-MSG-NUMBER            POKCS069
140100                 SET DP020-MSG-FATAL                              POKCS069
140200                                   TO TRUE                        POKCS069
140300                 MOVE -1           TO MR-SELECTL (PV-SUB)         POKCS069
140400                 SET DP030-SET-CURSOR-APPL-1                      POKCS069
140500                                   TO TRUE                        POKCS069
140600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         POKCS069
140700                 MOVE DP015-UNDERLINE                             POKCS069
140800                                   TO MR-SELECTH (PV-SUB)         POKCS069
140900                 SET PS-ERROR      TO TRUE                        POKCS069
141000             END-IF                                               POKCS069
141100         END-IF                                                   POKCS069
141200     ELSE                                                         POKCS069
141300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     POKCS069
141400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) POKCS069
141500                                   TO ASC-SELECTED-SW             POKCS069
141600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   POKCS069
141700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   POKCS069
141800         ELSE                                                     POKCS069
141900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       POKCS069
142000                 CONTINUE                                         POKCS069
142100             ELSE                                                 POKCS069
142200*                -- ONLY ONE END-OF-RANGE ALLOWED --              POKCS069
142300                 MOVE PC-TSYMSG-00055                             POKCS069
142400                                   TO DP020-MSG-NUMBER            POKCS069
142500                 SET DP020-MSG-FATAL                              POKCS069
142600                                   TO TRUE                        POKCS069
142700                 MOVE -1           TO MR-SELECTL (PV-SUB)         POKCS069
142800                 SET DP030-SET-CURSOR-APPL-1                      POKCS069
142900                                   TO TRUE                        POKCS069
143000                 SET PS-ERROR      TO TRUE                        POKCS069
143100             END-IF                                               POKCS069
143200         END-IF                                                   POKCS069
143300     END-IF.                                                      POKCS069
143400/                                                                 POKCS069
143500*----------------------------------------------------------------*POKCS069
143600*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *POKCS069
143700*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *POKCS069
143800*----------------------------------------------------------------*POKCS069
143900 3400-CHECK-RANGE-SEQUENCE.                                       POKCS069
144000                                                                  POKCS069
144100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       POKCS069
144200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      POKCS069
144300       AND  ASC-START-OF-SELECTED-RANGE >                         POKCS069
144400                                         ASC-END-OF-SELECTED-RANGEPOKCS069
144500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                POKCS069
144600         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            POKCS069
144700         SET DP020-MSG-FATAL       TO TRUE                        POKCS069
144800         SET PS-ERROR              TO TRUE                        POKCS069
144900         PERFORM 3410-POSITION-AT-ERROR                           POKCS069
145000     END-IF.                                                      POKCS069
145100/                                                                 POKCS069
145200*----------------------------------------------------------------*POKCS069
145300*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *POKCS069
145400*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *POKCS069
145500*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *POKCS069
145600*----------------------------------------------------------------*POKCS069
145700 3410-POSITION-AT-ERROR.                                          POKCS069
145800                                                                  POKCS069
145900     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       POKCS069
146000                                                                  POKCS069
146100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 POKCS069
146200                    - PV-TOP-ITEM + 1.                            POKCS069
146300                                                                  POKCS069
146400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      POKCS069
146500         CONTINUE                                                 POKCS069
146600     ELSE                                                         POKCS069
146700         MOVE -1                   TO MR-SELECTL (PV-SUB)         POKCS069
146800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         POKCS069
146900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         POKCS069
147000     END-IF.                                                      POKCS069
147100                                                                  POKCS069
147200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   POKCS069
147300                    - PV-TOP-ITEM + 1.                            POKCS069
147400                                                                  POKCS069
147500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      POKCS069
147600         CONTINUE                                                 POKCS069
147700     ELSE                                                         POKCS069
147800         MOVE -1                   TO MR-SELECTL (PV-SUB)         POKCS069
147900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         POKCS069
148000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         POKCS069
148100     END-IF.                                                      POKCS069
148200/                                                                 POKCS069
148300*----------------------------------------------------------------*POKCS069
148400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *POKCS069
148500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *POKCS069
148600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *POKCS069
148700*----------------------------------------------------------------*POKCS069
148800 3500-MARK-RANGE-AS-SELECTED.                                     POKCS069
148900                                                                  POKCS069
149000     MOVE +1                       TO ASC-BLK-SUB.                POKCS069
149100                                                                  POKCS069
149200     PERFORM 3510-MARK-SELECTED-INDS                              POKCS069
149300         VARYING ASC-ITEM-SUB                                     POKCS069
149400         FROM 1 BY 1                                              POKCS069
149500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS069
149600                                                                  POKCS069
149700     ADD +1                        TO ASC-BLK-SUB.                POKCS069
149800                                                                  POKCS069
149900     PERFORM 3510-MARK-SELECTED-INDS                              POKCS069
150000         VARYING ASC-ITEM-SUB                                     POKCS069
150100         FROM 1 BY 1                                              POKCS069
150200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS069
150300                                                                  POKCS069
150400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               POKCS069
150500                                   TO PV-LIST-ITEM-NUMBER.        POKCS069
150600                                                                  POKCS069
150700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            POKCS069
150800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         POKCS069
150900               PC-ITEMS-PER-PANEL).                               POKCS069
151000                                                                  POKCS069
151100     MOVE ASC-START-OF-SELECTED-RANGE                             POKCS069
151200                                   TO PV-START-OF-SELECTED-RANGE. POKCS069
151300                                                                  POKCS069
151400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            POKCS069
151500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  POKCS069
151600               PC-ITEMS-PER-PANEL).                               POKCS069
151700                                                                  POKCS069
151800     MOVE ASC-END-OF-SELECTED-RANGE                               POKCS069
151900                                   TO PV-END-OF-SELECTED-RANGE.   POKCS069
152000                                                                  POKCS069
152100     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             POKCS069
152200         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    POKCS069
152300               PC-ITEMS-PER-PANEL).                               POKCS069
152400                                                                  POKCS069
152500     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             POKCS069
152600         PV-FIRST-BLOCK-IN-ARRAY + 1.                             POKCS069
152700                                                                  POKCS069
152800     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    POKCS069
152900        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        POKCS069
153000         MOVE +1                   TO ASC-BLK-SUB                 POKCS069
153100         PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS069
153200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         POKCS069
153300             PV-FIRST-BLOCK-IN-ARRAY - 1                          POKCS069
153400                                                                  POKCS069
153500         PERFORM                                                  POKCS069
153600             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      POKCS069
153700                   PV-PREV-BLOCK-IN-ARRAY                         POKCS069
153800             MOVE PV-FIRST-BLOCK-IN-RANGE                         POKCS069
153900                                   TO PV-BLOCK-NUMBER             POKCS069
154000             PERFORM 4410-READ-TEMP-STORAGE                       POKCS069
154100             PERFORM 3510-MARK-SELECTED-INDS                      POKCS069
154200                 VARYING ASC-ITEM-SUB                             POKCS069
154300                 FROM 1 BY 1                                      POKCS069
154400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS069
154500             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS069
154600             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     POKCS069
154700         END-PERFORM                                              POKCS069
154800                                                                  POKCS069
154900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         POKCS069
155000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     POKCS069
155100         PERFORM                                                  POKCS069
155200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       POKCS069
155300                   PV-LAST-BLOCK-IN-RANGE                         POKCS069
155400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          POKCS069
155500                                   TO PV-BLOCK-NUMBER             POKCS069
155600             PERFORM 4410-READ-TEMP-STORAGE                       POKCS069
155700             PERFORM 3510-MARK-SELECTED-INDS                      POKCS069
155800                 VARYING ASC-ITEM-SUB                             POKCS069
155900                 FROM 1 BY 1                                      POKCS069
156000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS069
156100             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS069
156200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      POKCS069
156300         END-PERFORM                                              POKCS069
156400                                                                  POKCS069
156500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             POKCS069
156600                                   TO PV-BLOCK-NUMBER             POKCS069
156700         PERFORM 4410-READ-TEMP-STORAGE                           POKCS069
156800     END-IF.                                                      POKCS069
156900                                                                  POKCS069
157000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE POKCS069
157100                                      ASC-END-OF-SELECTED-RANGE.  POKCS069
157200/                                                                 POKCS069
157300*----------------------------------------------------------------*POKCS069
157400* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *POKCS069
157500*----------------------------------------------------------------*POKCS069
157600 3510-MARK-SELECTED-INDS.                                         POKCS069
157700                                                                  POKCS069
157800     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         POKCS069
157900         ASC-START-OF-SELECTED-RANGE)                             POKCS069
158000     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         POKCS069
158100         ASC-START-OF-SELECTED-RANGE)                             POKCS069
158200                                                                  POKCS069
158300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     POKCS069
158400             ASC-END-OF-SELECTED-RANGE)                           POKCS069
158500         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     POKCS069
158600             ASC-END-OF-SELECTED-RANGE)                           POKCS069
158700                                                                  POKCS069
158800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          POKCS069
158900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   POKCS069
159000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   POKCS069
159100                                   TO TRUE                        POKCS069
159200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              POKCS069
159300                                   TO TRUE                        POKCS069
159400                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMSPOKCS069
159500             END-IF                                               POKCS069
159600         END-IF                                                   POKCS069
159700     END-IF.                                                      POKCS069
159800/                                                                 POKCS069
159900*----------------------------------------------------------------*POKCS069
160000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *POKCS069
160100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *POKCS069
160200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *POKCS069
160300*    DISPLAY THE PANEL TO USER.                                  *POKCS069
160400*----------------------------------------------------------------*POKCS069
160500 4000-BUILD-INITIAL-PANEL.                                        POKCS069
160600                                                                  POKCS069
160700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             POKCS069
160800                ASC-BLOCK-ENTRIES (2).                            POKCS069
160900                                                                  POKCS069
161000     MOVE +1                       TO ASC-BLK-SUB.                POKCS069
161100                                                                  POKCS069
161200     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       POKCS069
161300                                                                  POKCS069
161400     MOVE +0                       TO ASC-ITEM-SUB                POKCS069
161500                                      ASC-NUMBER-OF-ITEMS-READ    POKCS069
161600                                      ASC-NUMBER-OF-SELECTED-ITEMSPOKCS069
161700                                      ASC-HIGHEST-BLOCK-WRITTEN   POKCS069
161800                                      ASC-START-OF-SELECTED-RANGE POKCS069
161900                                      ASC-END-OF-SELECTED-RANGE   POKCS069
162000                                      ASC-ITEM-AT-TOP-OF-PANEL.   POKCS069
162100                                                                  POKCS069
162200     MOVE PO017-ENT-NAME-DESC  TO ASC-KEY-VENDOR-NME.             POKCS069
162300                                                                  POKCS069
162400     PERFORM 4010-OPEN-CURSOR.                                    POKCS069
162500                                                                  POKCS069
162600     PERFORM 4300-READ-ITEMS-FROM-DB.                             POKCS069
162700                                                                  POKCS069
162800     PERFORM 4020-CLOSE-CURSOR.                                   POKCS069
162900                                                                  POKCS069
163000     MOVE +1                       TO PV-TOP-ITEM.                POKCS069
163100                                                                  POKCS069
163200     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          POKCS069
163300         SET DP020-NEXT-ACT-APPL-ERROR                            POKCS069
163400                                   TO TRUE                        POKCS069
163500         SET DP020-MSG-FATAL       TO TRUE                        POKCS069
163600         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            POKCS069
163700     ELSE                                                         POKCS069
163800         MOVE -1                   TO MR-SELECTL (1)              POKCS069
163900         SET DP030-SET-CURSOR-APPL-1                              POKCS069
164000                                   TO TRUE                        POKCS069
164100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     POKCS069
164200     END-IF.                                                      POKCS069
164300/                                                                 POKCS069
164400*----------------------------------------------------------------*POKCS069
164500* OPEN THE RCVR CURSOR.                                          *POKCS069
164600*----------------------------------------------------------------*POKCS069
164700 4010-OPEN-CURSOR.                                                POKCS069
164800                                                                  POKCS069
164900         EXEC SQL                                                 POKCS069
165000             OPEN RCVR-CSR                                        POKCS069
165100         END-EXEC                                                 POKCS069
165200                                                                  POKCS069
165300     EVALUATE TRUE                                                POKCS069
165400         WHEN SQLCODE = ZERO                                      POKCS069
165500                 CONTINUE                                         POKCS069
165600                                                                  POKCS069
165700         WHEN SQLCODE = -904                                      POKCS069
165800         WHEN SQLCODE = -911                                      POKCS069
165900         WHEN SQLCODE = -913                                      POKCS069
166000              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       POKCS069
166100              SET PS-ERROR                                        POKCS069
166200                  DP020-NEXT-ACT-APPL-ERROR                       POKCS069
166300                  DP020-MSG-FATAL                                 POKCS069
166400                      TO TRUE                                     POKCS069
166500              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) POKCS069
166600              PERFORM 9000-CALL-CICS-ARCH-API                     POKCS069
166700                                                                  POKCS069
166800         WHEN SQLWARN0 NOT = SPACES                               POKCS069
166900         WHEN SQLCODE < ZERO                                      POKCS069
167000         WHEN SQLCODE > ZERO                                      POKCS069
167100             MOVE '4010-OPEN-CURSOR'                              POKCS069
167200                               TO DP013-PARAGRAPH                 POKCS069
167300             MOVE 'OPEN RCVR-CSR CURSOR'                          POKCS069
167400                               TO DP013-MESSAGE-TEXT (1)          POKCS069
167500             MOVE SQLCA        TO DP013-SQLCA                     POKCS069
167600             MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)        POKCS069
167700             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        POKCS069
167800             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (3)        POKCS069
167900             SET DP013-DB2-ABEND                                  POKCS069
168000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               POKCS069
168100             PERFORM DP013-0000-PROCESS-ABEND                     POKCS069
168200     END-EVALUATE.                                                POKCS069
168300/                                                                 POKCS069
168400*----------------------------------------------------------------*POKCS069
168500* CLOSE THE RCVR CURSOR                                          *POKCS069
168600*----------------------------------------------------------------*POKCS069
168700 4020-CLOSE-CURSOR.                                               POKCS069
168800                                                                  POKCS069
168900     EXEC SQL                                                     POKCS069
169000         CLOSE RCVR-CSR                                           POKCS069
169100     END-EXEC.                                                    POKCS069
169200                                                                  POKCS069
169300     EVALUATE TRUE                                                POKCS069
169400         WHEN SQLCODE = ZERO                                      POKCS069
169500             CONTINUE                                             POKCS069
169600         WHEN SQLCODE = -904                                      POKCS069
169700         WHEN SQLCODE = -911                                      POKCS069
169800         WHEN SQLCODE = -913                                      POKCS069
169900              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       POKCS069
170000              SET PS-ERROR                                        POKCS069
170100                  DP020-NEXT-ACT-APPL-ERROR                       POKCS069
170200                  DP020-MSG-FATAL                                 POKCS069
170300                      TO TRUE                                     POKCS069
170400              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) POKCS069
170500              PERFORM 9000-CALL-CICS-ARCH-API                     POKCS069
170600                                                                  POKCS069
170700         WHEN SQLWARN0 NOT = SPACES                               POKCS069
170800         WHEN SQLCODE < ZERO                                      POKCS069
170900         WHEN SQLCODE > ZERO                                      POKCS069
171000             MOVE '4020-CLOSE-CURSOR'                             POKCS069
171100                                   TO DP013-PARAGRAPH             POKCS069
171200             MOVE 'CLOSE RCVR-CSR CURSOR'                         POKCS069
171300                                   TO DP013-MESSAGE-TEXT (1)      POKCS069
171400             MOVE SQLCA            TO DP013-SQLCA                 POKCS069
171500             MOVE 'TRECCEIV'   TO DP013-DB2-TABLE-NAME (1)        POKCS069
171600             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        POKCS069
171700             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (3)        POKCS069
171800             SET DP013-DB2-ABEND                                  POKCS069
171900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               POKCS069
172000             PERFORM DP013-0000-PROCESS-ABEND                     POKCS069
172100     END-EVALUATE.                                                POKCS069
172200/                                                                 POKCS069
172300*----------------------------------------------------------------*POKCS069
172400*    GET THE UNITS AND DOLLARS ORDERED FROM TPURCHS, THEN        *POKCS069
172500*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *POKCS069
172600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *POKCS069
172700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *POKCS069
172800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *POKCS069
172900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *POKCS069
173000*                                                                *POKCS069
173100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *POKCS069
173200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *POKCS069
173300*    UPON INITIALIZATION.                                        *POKCS069
173400*----------------------------------------------------------------*POKCS069
173500 4300-READ-ITEMS-FROM-DB.                                         POKCS069
173600                                                                  POKCS069
173700     PERFORM 4305-GET-ORDERED.                                    POKCS069
173800                                                                  POKCS069
173900     PERFORM 4307-GET-ORD-DATES.                                  POKCS069
174000                                                                  POKCS069
174100     PERFORM                                                      POKCS069
174200         VARYING PV-READ-COUNT                                    POKCS069
174300         FROM 1 BY 1                                              POKCS069
174400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    POKCS069
174500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         POKCS069
174600                                                                  POKCS069
174700         PERFORM 4310-FETCH                                       POKCS069
174800                                                                          
174900         IF ASC-NO-ITEMS-LEFT-ON-DB                                       
175000            CONTINUE                                                      
175100         ELSE                                                             
175200            PERFORM 4800-INCR-ASC-COMM-AREA                               
175300            PERFORM 4315-GET-DETAIL                               POKCS069
175400            PERFORM 4500-PROCESS-ADJUSTS                                  
175500         END-IF                                                           
175600                                                                          
175700     END-PERFORM.                                                 POKCS069
175800                                                                          
175900     MOVE PLNSHP-DONT-SHIP-BEF-DTE   TO PV-ORD-DTE.               POKCS069
176000     MOVE PLNSHP-CAN-IFNOT-SHIP-DTE  TO PV-CAN-DTE.               POKCS069
176100     MOVE PLNSHP-EXT-CAN-DTE         TO PV-EXT-DTE.               POKCS069
176200                                                                  POKCS069
176300     STRING PV-ORD-DTE(6:2) '/'                                   POKCS069
176400            PV-ORD-DTE(9:2) '/'                                   POKCS069
176500            PV-ORD-DTE(3:2)                                       POKCS069
176600            DELIMITED BY SIZE INTO ASC-ORDER-DTE                  POKCS069
176700                                                                  POKCS069
176800     STRING PV-CAN-DTE(6:2) '/'                                   POKCS069
176900            PV-CAN-DTE(9:2) '/'                                   POKCS069
177000            PV-CAN-DTE(3:2)                                       POKCS069
177100            DELIMITED BY SIZE INTO ASC-CANCEL-DTE                 POKCS069
177200                                                                  POKCS069
177300     IF PV-EXT-DTE = '0001-01-01'                                 POKCS069
177400        MOVE SPACES TO PV-EXT-DTE                                 POKCS069
177500                       ASC-EXTCAN-DTE                             POKCS069
177600     ELSE                                                         POKCS069
177700        STRING PV-EXT-DTE(6:2) '/'                                POKCS069
177800               PV-EXT-DTE(9:2) '/'                                POKCS069
177900               PV-EXT-DTE(3:2)                                    POKCS069
178000               DELIMITED BY SIZE INTO ASC-EXTCAN-DTE              POKCS069
178100     END-IF.                                                      POKCS069
178200                                                                          
178300     MOVE PV-TOT-DOLLARS-VER         TO ASC-TOT-DOLLARS-VER       POKCS069
178400     MOVE PV-TOT-UNITS-VER           TO ASC-TOT-UNITS-VER         POKCS069
178500     MOVE PURCHS-TOT-VAL-RTL-AMT     TO ASC-ORD-DOLLARS           POKCS069
178600     MOVE PURCHS-TOT-UNT-QTY         TO ASC-ORD-UNITS             POKCS069
178700                                                                  POKCS069
178800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          POKCS069
178900         MOVE +1                   TO ASC-BLK-SUB                 POKCS069
179000         PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS069
179100         ADD +1                    TO ASC-BLK-SUB                 POKCS069
179200         PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS069
179300                                                                  POKCS069
179400         MOVE 1                    TO ASC-BLK-SUB                 POKCS069
179500                                      PV-BLOCK-NUMBER             POKCS069
179600         PERFORM 4410-READ-TEMP-STORAGE                           POKCS069
179700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             POKCS069
179800             MOVE 2                TO ASC-BLK-SUB                 POKCS069
179900                                      PV-BLOCK-NUMBER             POKCS069
180000             PERFORM 4410-READ-TEMP-STORAGE                       POKCS069
180100         END-IF                                                   POKCS069
180200     END-IF.                                                      POKCS069
180300/                                                                 POKCS069
180400*----------------------------------------------------------------*POKCS069
180500*    GET ORDERED UNITS AND DOLLARS FOR PO                        *POKCS069
180600*----------------------------------------------------------------*POKCS069
180700 4305-GET-ORDERED.                                                POKCS069
180800                                                                  POKCS069
180900         EXEC SQL                                                 POKCS069
181000            SELECT  TOT_VAL_RTL_AMT                               POKCS069
181100                   ,TOT_UNT_QTY                                   POKCS069
181200              INTO :PURCHS-TOT-VAL-RTL-AMT                        POKCS069
181300                  ,:PURCHS-TOT-UNT-QTY                            POKCS069
181400              FROM  TPURCHS                                       POKCS069
181500              WHERE PO_NBR          = :ASC-KEY-PO-NBR             POKCS069
181600                AND VER_STATUS_CDE  = 'A'                         POKCS069
181700                AND PO_CATEG_CDE    = 'MR'                        POKCS069
181800         END-EXEC.                                                POKCS069
181900                                                                  POKCS069
182000     EVALUATE TRUE                                                POKCS069
182100         WHEN SQLCODE = -904                                      POKCS069
182200         WHEN SQLCODE = -911                                      POKCS069
182300         WHEN SQLCODE = -913                                      POKCS069
182400              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       POKCS069
182500              SET PS-ERROR                                        POKCS069
182600                  DP020-NEXT-ACT-APPL-ERROR                       POKCS069
182700                  DP020-MSG-FATAL                                 POKCS069
182800                      TO TRUE                                     POKCS069
182900              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) POKCS069
183000              PERFORM 9000-CALL-CICS-ARCH-API                     POKCS069
183100                                                                  POKCS069
183200         WHEN SQLWARN0 NOT = SPACES                               POKCS069
183300         WHEN SQLCODE < ZERO                                      POKCS069
183400         WHEN SQLCODE > ZERO                                      POKCS069
183500             MOVE '4305-GET-ORDERED'                              POKCS069
183600                               TO DP013-PARAGRAPH                 POKCS069
183700             MOVE 'GET-ORDERED'                                   POKCS069
183800                               TO DP013-MESSAGE-TEXT (1)          POKCS069
183900             MOVE SQLCA        TO DP013-SQLCA                     POKCS069
184000             MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)        POKCS069
184100             SET DP013-DB2-ABEND                                  POKCS069
184200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               POKCS069
184300             PERFORM DP013-0000-PROCESS-ABEND                     POKCS069
184400     END-EVALUATE.                                                POKCS069
184500/                                                                 POKCS069
184600*----------------------------------------------------------------*POKCS069
184700*    GET ORDER DATES FOR PO                                      *POKCS069
184800*----------------------------------------------------------------*POKCS069
184900 4307-GET-ORD-DATES.                                              POKCS069
185000                                                                  POKCS069
185100         EXEC SQL                                                 POKCS069
185200            SELECT  CHAR(DONT_SHIP_BEF_DTE)                       POKCS069
185300                   ,CHAR(CAN_IFNOT_SHIP_DTE)                      POKCS069
185400                   ,CHAR(EXT_CAN_DTE)                             POKCS069
185500              INTO :PLNSHP-DONT-SHIP-BEF-DTE                      POKCS069
185600                  ,:PLNSHP-CAN-IFNOT-SHIP-DTE                     POKCS069
185700                  ,:PLNSHP-EXT-CAN-DTE                            POKCS069
185800              FROM  TPLNSHP                                       POKCS069
185900              WHERE PO_NBR          = :ASC-KEY-PO-NBR             POKCS069
186000                AND VER_STATUS_CDE  = 'A'                         POKCS069
186100         END-EXEC.                                                POKCS069
186200                                                                  POKCS069
186300     EVALUATE TRUE                                                POKCS069
186400         WHEN SQLCODE = -904                                      POKCS069
186500         WHEN SQLCODE = -911                                      POKCS069
186600         WHEN SQLCODE = -913                                      POKCS069
186700              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       POKCS069
186800              SET PS-ERROR                                        POKCS069
186900                  DP020-NEXT-ACT-APPL-ERROR                       POKCS069
187000                  DP020-MSG-FATAL                                 POKCS069
187100                      TO TRUE                                     POKCS069
187200              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) POKCS069
187300              PERFORM 9000-CALL-CICS-ARCH-API                     POKCS069
187400                                                                  POKCS069
187500         WHEN SQLWARN0 NOT = SPACES                               POKCS069
187600         WHEN SQLCODE < ZERO                                      POKCS069
187700         WHEN SQLCODE > ZERO                                      POKCS069
187800             MOVE '4307-GET-ORD-DATES'                            POKCS069
187900                               TO DP013-PARAGRAPH                 POKCS069
188000             MOVE 'GET-ORD-DATES'                                 POKCS069
188100                               TO DP013-MESSAGE-TEXT (1)          POKCS069
188200             MOVE SQLCA        TO DP013-SQLCA                     POKCS069
188300             MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)        POKCS069
188400             SET DP013-DB2-ABEND                                  POKCS069
188500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               POKCS069
188600             PERFORM DP013-0000-PROCESS-ABEND                     POKCS069
188700     END-EVALUATE.                                                POKCS069
188800/                                                                 POKCS069
188900*----------------------------------------------------------------*POKCS069
189000*    FETCH A RCVR ROW                                            *POKCS069
189100*----------------------------------------------------------------*POKCS069
189200 4310-FETCH.                                                      POKCS069
189300                                                                  POKCS069
189400     EXEC SQL                                                     POKCS069
189500         FETCH RCVR-CSR                                           POKCS069
189600          INTO :RECEIV-REC-SEQ-NBR                                POKCS069
189700              ,:RECEIV-OPER-UNT-ID                                POKCS069
189800              ,:RECEIV-STATUS-CDE                                 POKCS069
189900              ,:RECEIV-FCLTY-ID                                   POKCS069
190000              ,:PV-REC-DTE                                        POKCS069
190100              ,:PV-REC-TIM                                        POKCS069
190200              ,:PV-VER-DTE                                        POKCS069
190300              ,:PV-VER-TIM                                        POKCS069
190400              ,:RECEIV-ACTL-CART-CNT                              POKCS069
190500              ,:RECEIV-EXPTED-CART-CNT                            POKCS069
190600     END-EXEC.                                                    POKCS069
190700                                                                  POKCS069
190800     EVALUATE TRUE                                                POKCS069
190900         WHEN SQLCODE = +0                                        POKCS069
191000              CONTINUE                                            POKCS069
191100         WHEN SQLCODE = +100                                      POKCS069
191200              SET ASC-NO-ITEMS-LEFT-ON-DB                         POKCS069
191300                                   TO TRUE                        POKCS069
191400         WHEN SQLWARN0 NOT = SPACE                                POKCS069
191500         WHEN SQLCODE < +0                                        POKCS069
191600         WHEN SQLCODE > +0                                        POKCS069
191700              MOVE '4310-FETCH-CURSOR'                            POKCS069
191800                                   TO DP013-PARAGRAPH             POKCS069
191900              MOVE 'FETCH RCVR CURSOR'                            POKCS069
192000                                   TO DP013-MESSAGE-TEXT (1)      POKCS069
192100              MOVE SQLCA           TO DP013-SQLCA                 POKCS069
192200              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    POKCS069
192300              MOVE 'TSTATCD'       TO DP013-DB2-TABLE-NAME (2)    POKCS069
192400              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (3)    POKCS069
192500              SET DP013-DB2-ABEND  TO TRUE                        POKCS069
192600              PERFORM DP013-0000-PROCESS-ABEND                    POKCS069
192700     END-EVALUATE.                                                POKCS069
192800                                                                  POKCS069
192900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS069
193000         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             POKCS069
193100         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             POKCS069
193200                                   TO DP013-MESSAGE-TEXT (1)      POKCS069
193300         MOVE SQLCA                TO DP013-SQLCA                 POKCS069
193400         SET DP013-DB2-ABEND                                      POKCS069
193500             DP013-XCTL-DISPLAY-RESTART                           POKCS069
193600                                   TO TRUE                        POKCS069
193700         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
193800     END-IF.                                                      POKCS069
193900                                                                  POKCS069
194000/                                                                 POKCS069
194100 4315-GET-DETAIL.                                                 POKCS069
194200                                                                  POKCS069
194300      PERFORM 4320-GET-UNITS-VER.                                 POKCS069
194400                                                                  POKCS069
194500      PERFORM 4330-GET-DOLLARS-VER.                               POKCS069
194600                                                                  POKCS069
194700      MOVE RECEIV-REC-SEQ-NBR   TO ASC-REC-SEQ-NBR                POKCS069
194800                                    (ASC-BLK-SUB ASC-ITEM-SUB).   POKCS069
194900      MOVE RECEIV-OPER-UNT-ID   TO ASC-LOC                        POKCS069
195000                                    (ASC-BLK-SUB ASC-ITEM-SUB).   POKCS069
195100      MOVE RECEIV-STATUS-CDE    TO ASC-RECEIVER-STAT              POKCS069
195200                                    (ASC-BLK-SUB ASC-ITEM-SUB).   POKCS069
195300      MOVE RECEIV-FCLTY-ID      TO ASC-FCLTY-ID                   POKCS069
195400                                    (ASC-BLK-SUB ASC-ITEM-SUB).   POKCS069
195500                                                                  POKCS069
195600      STRING PV-REC-DTE(6:2) '/'                                  POKCS069
195700             PV-REC-DTE(9:2) '/'                                  POKCS069
195800             PV-REC-DTE(3:2)                                      POKCS069
195900             DELIMITED BY SIZE                                    POKCS069
196000                         INTO ASC-ARRIVAL-DTE                     POKCS069
196100                                (ASC-BLK-SUB ASC-ITEM-SUB).       POKCS069
196200                                                                  POKCS069
196300      STRING PV-REC-TIM(1:2) ':'                                  POKCS069
196400             PV-REC-TIM(4:2)                                      POKCS069
196500             DELIMITED BY SIZE                                    POKCS069
196600                         INTO ASC-ARRIVAL-TIM                     POKCS069
196700                                (ASC-BLK-SUB ASC-ITEM-SUB).       POKCS069
196800                                                                  POKCS069
196900      IF (ASC-ARRIVAL-DTE (ASC-BLK-SUB ASC-ITEM-SUB)) =           POKCS069
197000          '09/09/99' AND                                          POKCS069
197100         (ASC-ARRIVAL-TIM (ASC-BLK-SUB ASC-ITEM-SUB)) =           POKCS069
197200          '09:09'                                                 POKCS069
197300          MOVE 'ENROUTE '                                         POKCS069
197400             TO ASC-ARRIVAL-DTE (ASC-BLK-SUB ASC-ITEM-SUB)        POKCS069
197500          MOVE SPACES                                             POKCS069
197600             TO ASC-ARRIVAL-TIM (ASC-BLK-SUB ASC-ITEM-SUB)        POKCS069
197700      END-IF.                                                     POKCS069
197800                                                                  POKCS069
197900      STRING PV-VER-DTE(6:2) '/'                                  POKCS069
198000             PV-VER-DTE(9:2) '/'                                  POKCS069
198100             PV-VER-DTE(3:2)                                      POKCS069
198200             DELIMITED BY SIZE                                    POKCS069
198300                             INTO ASC-VERIFIED-DTE                POKCS069
198400                                 (ASC-BLK-SUB ASC-ITEM-SUB).      POKCS069
198500                                                                  POKCS069
198600      STRING PV-VER-TIM(1:2) ':'                                  POKCS069
198700             PV-VER-TIM(4:2)                                      POKCS069
198800             DELIMITED BY SIZE                                    POKCS069
198900                             INTO ASC-VERIFIED-TIM                POKCS069
199000                                 (ASC-BLK-SUB ASC-ITEM-SUB)       POKCS069
199100                                                                  POKCS069
199200      IF (ASC-VERIFIED-DTE (ASC-BLK-SUB ASC-ITEM-SUB)) =          POKCS069
199300         '09/09/99' AND                                           POKCS069
199400         (ASC-VERIFIED-TIM (ASC-BLK-SUB ASC-ITEM-SUB)) =          POKCS069
199500          '09:09'                                                 POKCS069
199600          MOVE SPACES                                             POKCS069
199700             TO ASC-VERIFIED-DTE (ASC-BLK-SUB ASC-ITEM-SUB)       POKCS069
199800                ASC-VERIFIED-TIM (ASC-BLK-SUB ASC-ITEM-SUB)       POKCS069
199900      END-IF.                                                     POKCS069
200000                                                                  POKCS069
200100      IF  RECEIV-ACTL-CART-CNT GREATER THAN ZERO                  POKCS069
200200          MOVE RECEIV-ACTL-CART-CNT                               POKCS069
200300                                TO ASC-CTN-CNT                    POKCS069
200400                                    (ASC-BLK-SUB ASC-ITEM-SUB)    POKCS069
200500      ELSE                                                        POKCS069
200600          MOVE RECEIV-EXPTED-CART-CNT                             POKCS069
200700                                TO ASC-CTN-CNT                    POKCS069
200800                                    (ASC-BLK-SUB ASC-ITEM-SUB)    POKCS069
200900      END-IF.                                                     POKCS069
201000                                                                  POKCS069
201100      IF (ASC-VERIFIED-TIM (ASC-BLK-SUB ASC-ITEM-SUB)) =          POKCS069
201200          SPACES                                                  POKCS069
201300          MOVE ZEROES TO                                          POKCS069
201400                      ASC-DOL-VERFD (ASC-BLK-SUB ASC-ITEM-SUB)    POKCS069
201500                      ASC-PCS-VERFD (ASC-BLK-SUB ASC-ITEM-SUB)    POKCS069
201600      ELSE                                                        POKCS069
201700          MOVE PV-DOLLARS-VERIFIED TO  ASC-DOL-VERFD              POKCS069
201800                                    (ASC-BLK-SUB ASC-ITEM-SUB)    POKCS069
201900                                                                  POKCS069
202000          MOVE PV-UNITS-VERIFIED   TO  ASC-PCS-VERFD              POKCS069
202100                                    (ASC-BLK-SUB ASC-ITEM-SUB)    POKCS069
202200      END-IF.                                                     POKCS069
202300                                                                  POKCS069
202400      COMPUTE PV-TOT-DOLLARS-VER = PV-TOT-DOLLARS-VER +           POKCS069
202500               ASC-DOL-VERFD (ASC-BLK-SUB ASC-ITEM-SUB).          POKCS069
202600                                                                  POKCS069
202700      COMPUTE PV-TOT-UNITS-VER = PV-TOT-UNITS-VER +               POKCS069
202800             ASC-PCS-VERFD (ASC-BLK-SUB ASC-ITEM-SUB).            POKCS069
202900                                                                          
203000                                                                          
203100*----------------------------------------------------------------*POKCS069
203200*    GET UNITS VERIFIED FROM DB2 TABLES                          *POKCS069
203300*----------------------------------------------------------------*POKCS069
203400 4320-GET-UNITS-VER.                                              POKCS069
203500                                                                  POKCS069
203600         MOVE RECEIV-REC-SEQ-NBR     TO DK-REC-SEQ-NBR            POKCS069
203700                                                                  POKCS069
203800         EXEC SQL                                                 POKCS069
203900            SELECT  SUM(B.AP_VERIFY_ITM_QTY)                      POKCS069
204000              INTO :PV-UNITS-VERIFIED:PV-UNITS-VERIFIED-NULL      POKCS069
204100              FROM  TRECITM A,                                    POKCS069
204200                    TRECDIS B,                                    POKCS069
204300                    TRECEIV C                                     POKCS069
204400            WHERE C.ORD_NBR            = :ASC-KEY-PO-NBR          POKCS069
204500              AND A.STATUS_CDE         = 'VE'                     POKCS069
204600              AND A.VER_STATUS_CDE     = 'A'                      POKCS069
204700              AND B.ORD_NBR            = A.ORD_NBR                POKCS069
204800              AND B.REC_SEQ_NBR        = A.REC_SEQ_NBR            POKCS069
204900              AND B.VER_STATUS_CDE     = 'A'                      POKCS069
205000              AND C.REC_SEQ_NBR        = :DK-REC-SEQ-NBR          POKCS069
205100              AND C.ORD_NBR            = A.ORD_NBR                POKCS069
205200              AND C.REC_SEQ_NBR        = A.REC_SEQ_NBR            POKCS069
205300              AND C.STATUS_CDE         = 'VE'                     POKCS069
205400              AND C.VER_STATUS_CDE     = 'A'                      POKCS069
205500              AND A.ORD_LNE_NBR        = B.ORD_LNE_NBR            POKCS069
205600         END-EXEC.                                                POKCS069
205700                                                                  POKCS069
205800     EVALUATE TRUE                                                POKCS069
205900         WHEN SQLCODE = ZERO                                      POKCS069
206000              IF PV-UNITS-VERIFIED-NULL < ZERO                    POKCS069
206100                 MOVE ZEROS TO PV-UNITS-VERIFIED                  POKCS069
206200              END-IF                                              POKCS069
206300                                                                  POKCS069
206400         WHEN SQLCODE = -904                                      POKCS069
206500         WHEN SQLCODE = -911                                      POKCS069
206600         WHEN SQLCODE = -913                                      POKCS069
206700              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       POKCS069
206800              SET PS-ERROR                                        POKCS069
206900                  DP020-NEXT-ACT-APPL-ERROR                       POKCS069
207000                  DP020-MSG-FATAL                                 POKCS069
207100                      TO TRUE                                     POKCS069
207200              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) POKCS069
207300              PERFORM 9000-CALL-CICS-ARCH-API                     POKCS069
207400                                                                  POKCS069
207500         WHEN SQLWARN0 NOT = SPACES                               POKCS069
207600         WHEN SQLCODE < ZERO                                      POKCS069
207700         WHEN SQLCODE > ZERO                                      POKCS069
207800             MOVE '4320-GET-UNITS-VER'                            POKCS069
207900                               TO DP013-PARAGRAPH                 POKCS069
208000             MOVE 'GET-UNITS-VER'                                 POKCS069
208100                               TO DP013-MESSAGE-TEXT (1)          POKCS069
208200             MOVE SQLCA        TO DP013-SQLCA                     POKCS069
208300             MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)        POKCS069
208400             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        POKCS069
208500             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (3)        POKCS069
208600             SET DP013-DB2-ABEND                                  POKCS069
208700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               POKCS069
208800             PERFORM DP013-0000-PROCESS-ABEND                     POKCS069
208900     END-EVALUATE.                                                POKCS069
209000                                                                          
209100/                                                                 POKCS069
209200*----------------------------------------------------------------*POKCS069
209300*    GET DOLLARS VERIFIED FROM DB2 TABLES                        *POKCS069
209400*----------------------------------------------------------------*POKCS069
209500 4330-GET-DOLLARS-VER.                                            POKCS069
209600                                                                  POKCS069
209700         MOVE RECEIV-REC-SEQ-NBR     TO DK-REC-SEQ-NBR            POKCS069
209800                                                                  POKCS069
209900         EXEC SQL                                                 POKCS069
210000            SELECT  SUM(C.AP_VERIFY_ITM_QTY * A.UNT_RTL_PR_AMT)   POKCS069
210100              INTO :PV-DOLLARS-VERIFIED:PV-DOLLARS-VERIFIED-NULL  POKCS069
210200              FROM  TPURITM A,                                    POKCS069
210300                    TRECITM B,                                    POKCS069
210400                    TRECDIS C,                                    POKCS069
210500                    TRECEIV D                                     POKCS069
210600            WHERE D.ORD_NBR            = :ASC-KEY-PO-NBR          POKCS069
210700              AND A.APP_PO_LNE_NBR     = B.ORD_LNE_NBR            POKCS069
210800              AND A.VER_NBR            = B.PO_VER_NBR             POKCS069
210900              AND B.ORD_NBR            = A.PO_NBR                 POKCS069
211000              AND B.STATUS_CDE         = 'VE'                     POKCS069
211100              AND B.VER_STATUS_CDE     = 'A'                      POKCS069
211200              AND C.ORD_NBR            = A.PO_NBR                 POKCS069
211300              AND C.ORD_LNE_NBR        = B.ORD_LNE_NBR            POKCS069
211400              AND C.REC_SEQ_NBR        = B.REC_SEQ_NBR            POKCS069
211500              AND C.VER_STATUS_CDE     = 'A'                      POKCS069
211600              AND D.REC_SEQ_NBR        = :DK-REC-SEQ-NBR          POKCS069
211700              AND D.ORD_NBR            = B.ORD_NBR                POKCS069
211800              AND D.REC_SEQ_NBR        = B.REC_SEQ_NBR            POKCS069
211900              AND D.STATUS_CDE         = 'VE'                     POKCS069
212000              AND D.VER_STATUS_CDE     = 'A'                      POKCS069
212100         END-EXEC.                                                POKCS069
212200                                                                  POKCS069
212300     EVALUATE TRUE                                                POKCS069
212400         WHEN SQLCODE = ZERO                                      POKCS069
212500              IF PV-DOLLARS-VERIFIED-NULL < ZERO                  POKCS069
212600                 MOVE ZEROS TO PV-DOLLARS-VERIFIED                POKCS069
212700              END-IF                                              POKCS069
212800                                                                  POKCS069
212900         WHEN SQLCODE = -904                                      POKCS069
213000         WHEN SQLCODE = -911                                      POKCS069
213100         WHEN SQLCODE = -913                                      POKCS069
213200              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       POKCS069
213300              SET PS-ERROR                                        POKCS069
213400                  DP020-NEXT-ACT-APPL-ERROR                       POKCS069
213500                  DP020-MSG-FATAL                                 POKCS069
213600                      TO TRUE                                     POKCS069
213700              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) POKCS069
213800              PERFORM 9000-CALL-CICS-ARCH-API                     POKCS069
213900                                                                  POKCS069
214000         WHEN SQLWARN0 NOT = SPACES                               POKCS069
214100         WHEN SQLCODE < ZERO                                      POKCS069
214200         WHEN SQLCODE > ZERO                                      POKCS069
214300             MOVE '4330-GET-DOLLARS-VER'                          POKCS069
214400                               TO DP013-PARAGRAPH                 POKCS069
214500             MOVE 'GET-DOLLARS-VER'                               POKCS069
214600                               TO DP013-MESSAGE-TEXT (1)          POKCS069
214700             MOVE SQLCA        TO DP013-SQLCA                     POKCS069
214800             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)        POKCS069
214900             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (2)        POKCS069
215000             SET DP013-DB2-ABEND                                  POKCS069
215100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               POKCS069
215200             PERFORM DP013-0000-PROCESS-ABEND                     POKCS069
215300     END-EVALUATE.                                                POKCS069
215400/                                                                 POKCS069
215500*----------------------------------------------------------------*POKCS069
215600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *POKCS069
215700*----------------------------------------------------------------*POKCS069
215800 4400-MOVE-COMMAREA-TO-SCREEN.                                    POKCS069
215900                                                                  POKCS069
216000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             POKCS069
216100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          POKCS069
216200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          POKCS069
216300             MOVE +1               TO ASC-BLK-SUB                 POKCS069
216400             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS069
216500             ADD +1                TO ASC-BLK-SUB                 POKCS069
216600             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS069
216700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             POKCS069
216800                 GIVING PV-BLOCK-NUMBER                           POKCS069
216900                 REMAINDER PV-REMAINDER                           POKCS069
217000             IF  PV-REMAINDER > ZERO                              POKCS069
217100                 ADD +1            TO PV-BLOCK-NUMBER             POKCS069
217200             END-IF                                               POKCS069
217300             MOVE +1               TO ASC-BLK-SUB                 POKCS069
217400             PERFORM 4410-READ-TEMP-STORAGE                       POKCS069
217500             ADD +1                TO ASC-BLK-SUB                 POKCS069
217600                                      PV-BLOCK-NUMBER             POKCS069
217700             PERFORM 4410-READ-TEMP-STORAGE                       POKCS069
217800     END-IF.                                                      POKCS069
217900                                                                  POKCS069
218000     MOVE +1                       TO ASC-BLK-SUB.                POKCS069
218100                                                                  POKCS069
218200     COMPUTE ASC-ITEM-SUB =                                       POKCS069
218300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              POKCS069
218400         + PC-ITEMS-PER-PANEL).                                   POKCS069
218500                                                                  POKCS069
218600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        POKCS069
218700         ADD +1                    TO ASC-BLK-SUB                 POKCS069
218800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            POKCS069
218900     END-IF.                                                      POKCS069
219000                                                                  POKCS069
219100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           POKCS069
219200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                POKCS069
219300                                                                  POKCS069
219400*    PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        POKCS069
219500     PERFORM 4420-FORMAT-LIST-LINES                               POKCS069
219600         VARYING PV-SUB                                           POKCS069
219700         FROM PC-ITEMS-PER-PANEL BY -1                            POKCS069
219800         UNTIL PV-SUB < +1.                                       POKCS069
219900                                                                  POKCS069
220000     COMPUTE ASC-ITEMS-DISPLAYED =                                POKCS069
220100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          POKCS069
220200                                                                  POKCS069
220300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    POKCS069
220400                                      ASTRTITO.                   POKCS069
220500                                                                  POKCS069
220600     MOVE ASC-KEY-PO-NBR           TO MR-PO-NBR.                  POKCS069
220700     MOVE ASC-KEY-VENDOR-NME       TO MR-ENT-NAME-DESC.           POKCS069
220800                                                                  POKCS069
220900     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    POKCS069
221000     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    POKCS069
221100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            POKCS069
221200                                   TO ASELITO.                    POKCS069
221300                                                                  POKCS069
221400     IF  DP020-MSG-NUMBER-X = SPACE                               POKCS069
221500         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  POKCS069
221600*            --- MORE ITEMS TO DISPLAY ----                       POKCS069
221700             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            POKCS069
221800             SET DP020-MSG-INFORMATIONAL                          POKCS069
221900                                   TO TRUE                        POKCS069
222000         END-IF                                                   POKCS069
222100     END-IF.                                                      POKCS069
222200/                                                                 POKCS069
222300*----------------------------------------------------------------*POKCS069
222400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *POKCS069
222500*----------------------------------------------------------------*POKCS069
222600 4410-READ-TEMP-STORAGE.                                          POKCS069
222700                                                                  POKCS069
222800     EXEC CICS                                                    POKCS069
222900         READQ TS                                                 POKCS069
223000             QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS069
223100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               POKCS069
223200             ITEM  (PV-BLOCK-NUMBER)                              POKCS069
223300             RESP  (PV-CICS-RESP)                                 POKCS069
223400     END-EXEC.                                                    POKCS069
223500                                                                  POKCS069
223600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       POKCS069
223700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     POKCS069
223800         CONTINUE                                                 POKCS069
223900     ELSE                                                         POKCS069
224000         SET DP013-CICS-ABEND      TO TRUE                        POKCS069
224100         SET DP013-NO-ROLLBACK     TO TRUE                        POKCS069
224200         MOVE '4410-READ-TEMP-STORAGE'                            POKCS069
224300                                   TO DP013-PARAGRAPH             POKCS069
224400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      POKCS069
224500                                   TO DP013-MESSAGE-TEXT(1)       POKCS069
224600         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
224700     END-IF.                                                      POKCS069
224800                                                                  POKCS069
224900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      POKCS069
225000                                   TO TRUE.                       POKCS069
225100                                                                  POKCS069
225200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         POKCS069
225300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               POKCS069
225400     END-IF.                                                      POKCS069
225500/                                                                 POKCS069
225600*----------------------------------------------------------------*POKCS069
225700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *POKCS069
225800*----------------------------------------------------------------*POKCS069
225900 4420-FORMAT-LIST-LINES.                                          POKCS069
226000                                                                  POKCS069
226100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      POKCS069
226200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                POKCS069
226300         MOVE DP015-HL-OFF         TO MR-SELECTH (PV-SUB)         POKCS069
226400         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         POKCS069
226500         MOVE SPACES             TO MR-PO-NBR-X                   POKCS069
226600                                    MR-ENT-NAME-DESC              POKCS069
226700         MOVE SPACE              TO MR-SELECT (PV-SUB)            POKCS069
226800                                    MR-REC-STAT-CD (PV-SUB)       POKCS069
226900                                    MR-ARRIVAL-DTE (PV-SUB)       POKCS069
227000                                    MR-ARRIVAL-TIME (PV-SUB)      POKCS069
227100                                    MR-VERIFIED-DTE (PV-SUB)      POKCS069
227200                                    MR-VERIFIED-TIME (PV-SUB)     POKCS069
227300                                                                  POKCS069
227400         MOVE ZEROS              TO MR-REC-SEQ-LOC (PV-SUB)       POKCS069
227500                                    MR-REC-SEQ-NBR (PV-SUB)       POKCS069
227600                                    MR-CARTON-CNT (PV-SUB)        POKCS069
227700                                    MR-PCS-VERFD (PV-SUB)         POKCS069
227800                                    MR-DOL-VERFD (PV-SUB)         POKCS069
227900     ELSE                                                         POKCS069
228000         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      POKCS069
228100                                                   > SPACE        POKCS069
228200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) POKCS069
228300                                   TO MR-SELECT (PV-SUB)          POKCS069
228400         ELSE                                                     POKCS069
228500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      POKCS069
228600                                   TO MR-SELECT (PV-SUB)          POKCS069
228700         END-IF                                                   POKCS069
228800                                                                  POKCS069
228900         IF  DP030-SET-CURSOR-TRAILER                             POKCS069
229000             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)POKCS069
229100                 > SPACE)                                         POKCS069
229200               OR (PV-SUB = 1))                                   POKCS069
229300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               POKCS069
229400                MOVE -1            TO MR-SELECTL (PV-SUB)         POKCS069
229500             END-IF                                               POKCS069
229600         END-IF                                                   POKCS069
229700                                                                  POKCS069
229800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           POKCS069
229900             IF ASC-RECEIVER-STAT (ASC-BLK-SUB ASC-ITEM-SUB)              
230000                                   = PC-VEA                               
230100                MOVE DP015-YELLOW  TO MR-REC-SEQ-NBRC (PV-SUB)            
230200                                      MR-REC-SEQ-LOCC (PV-SUB)            
230300                                      MR-REC-STAT-CDC (PV-SUB)            
230400                                      MR-VERIFIED-DTEC (PV-SUB)           
230500                                      MR-VERIFIED-TIMEC (PV-SUB)          
230600                                      MR-CARTON-CNTC (PV-SUB)             
230700                                      MR-PCS-VERFDC (PV-SUB)              
230800                                      MR-DOL-VERFDC (PV-SUB)              
230810             ELSE                                                         
230820                MOVE DP015-BLUE    TO MR-REC-SEQ-NBRC (PV-SUB)            
230830                                      MR-REC-SEQ-LOCC (PV-SUB)            
230840                                      MR-REC-STAT-CDC (PV-SUB)            
230850                                      MR-VERIFIED-DTEC (PV-SUB)           
230860                                      MR-VERIFIED-TIMEC (PV-SUB)          
230870                                      MR-CARTON-CNTC (PV-SUB)             
230880                                      MR-PCS-VERFDC (PV-SUB)              
230890                                      MR-DOL-VERFDC (PV-SUB)              
230900             END-IF                                                       
231000             MOVE ASC-REC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      POKCS069
231100                                   TO MR-REC-SEQ-NBR (PV-SUB)     POKCS069
231200             MOVE ASC-LOC       (ASC-BLK-SUB ASC-ITEM-SUB)        POKCS069
231300                                 TO MR-REC-SEQ-LOC (PV-SUB)       POKCS069
231400             MOVE ASC-RECEIVER-STAT (ASC-BLK-SUB ASC-ITEM-SUB)    POKCS069
231500                                 TO MR-REC-STAT-CD (PV-SUB)       POKCS069
231600             MOVE ASC-ARRIVAL-DTE (ASC-BLK-SUB ASC-ITEM-SUB)      POKCS069
231700                                   TO MR-ARRIVAL-DTE (PV-SUB)     POKCS069
231800             MOVE ASC-ARRIVAL-TIM (ASC-BLK-SUB ASC-ITEM-SUB)      POKCS069
231900                                   TO MR-ARRIVAL-TIME (PV-SUB)    POKCS069
232000             MOVE ASC-VERIFIED-DTE (ASC-BLK-SUB ASC-ITEM-SUB)     POKCS069
232100                                   TO MR-VERIFIED-DTE (PV-SUB)    POKCS069
232200             MOVE ASC-VERIFIED-TIM (ASC-BLK-SUB ASC-ITEM-SUB)     POKCS069
232300                                   TO MR-VERIFIED-TIME (PV-SUB)   POKCS069
232400             MOVE ASC-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)          POKCS069
232500                                 TO MR-CARTON-CNT (PV-SUB)        POKCS069
232600             MOVE ASC-PCS-VERFD (ASC-BLK-SUB ASC-ITEM-SUB)        POKCS069
232700                                 TO MR-PCS-VERFD (PV-SUB)         POKCS069
232800             MOVE ASC-DOL-VERFD (ASC-BLK-SUB ASC-ITEM-SUB)        POKCS069
232900                                 TO MR-DOL-VERFD (PV-SUB)         POKCS069
233000         END-IF                                                   POKCS069
233100     END-IF.                                                      POKCS069
233200                                                                  POKCS069
233300     MOVE ASC-TOT-DOLLARS-VER TO MR-DOLLARTOT.                    POKCS069
233400     MOVE ASC-TOT-UNITS-VER   TO MR-UNITSTOT.                     POKCS069
233500     MOVE ASC-ORD-DOLLARS     TO MR-ORD-DOLS.                     POKCS069
233600     MOVE ASC-ORD-UNITS       TO MR-ORD-UNITS.                    POKCS069
233700     MOVE ASC-ORDER-DTE       TO MR-ORDER-DTE.                    POKCS069
233800     MOVE ASC-CANCEL-DTE      TO MR-CANCEL-DTE.                   POKCS069
233900     MOVE ASC-EXTCAN-DTE      TO MR-EXTCAN-DTE.                   POKCS069
234000                                                                  POKCS069
234100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               POKCS069
234200                                                                  POKCS069
234300     IF  ASC-ITEM-SUB < + 1                                       POKCS069
234400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                POKCS069
234500         MOVE +1                   TO ASC-BLK-SUB                 POKCS069
234600     END-IF.                                                      POKCS069
234700/                                                                 POKCS069
234800*----------------------------------------------------------------*POKCS069
234900*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *POKCS069
235000*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *POKCS069
235100*  ISSUE A WARNING.                                              *POKCS069
235200*----------------------------------------------------------------*POKCS069
235300 4430-CHECK-FOR-BEGIN-AND-END.                                    POKCS069
235400                                                                  POKCS069
235500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       POKCS069
235600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     POKCS069
235700*            -- NO END-OF-RANGE SPECFIED ---                      POKCS069
235800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            POKCS069
235900             SET DP020-MSG-WARNING TO TRUE                        POKCS069
236000             PERFORM 4431-POSITION-AT-WARNING                     POKCS069
236100         END-IF                                                   POKCS069
236200     ELSE                                                         POKCS069
236300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     POKCS069
236400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                POKCS069
236500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            POKCS069
236600             SET DP020-MSG-WARNING TO TRUE                        POKCS069
236700             PERFORM 4431-POSITION-AT-WARNING                     POKCS069
236800         END-IF                                                   POKCS069
236900     END-IF.                                                      POKCS069
237000/                                                                 POKCS069
237100*----------------------------------------------------------------*POKCS069
237200*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *POKCS069
237300*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *POKCS069
237400*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *POKCS069
237500*  POSITION THE CURSOR THERE.                                    *POKCS069
237600*----------------------------------------------------------------*POKCS069
237700 4431-POSITION-AT-WARNING.                                        POKCS069
237800                                                                  POKCS069
237900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 POKCS069
238000                    - PV-TOP-ITEM + 1.                            POKCS069
238100                                                                  POKCS069
238200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      POKCS069
238300         CONTINUE                                                 POKCS069
238400     ELSE                                                         POKCS069
238500         SET DP030-SET-CURSOR-APPL-1                              POKCS069
238600                                   TO TRUE                        POKCS069
238700         MOVE -1                   TO MR-SELECTL (PV-SUB)         POKCS069
238800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         POKCS069
238900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         POKCS069
239000     END-IF.                                                      POKCS069
239100                                                                  POKCS069
239200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   POKCS069
239300                    - PV-TOP-ITEM + 1.                            POKCS069
239400                                                                  POKCS069
239500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      POKCS069
239600         CONTINUE                                                 POKCS069
239700     ELSE                                                         POKCS069
239800         SET DP030-SET-CURSOR-APPL-1                              POKCS069
239900                                   TO TRUE                        POKCS069
240000         MOVE -1                   TO MR-SELECTL (PV-SUB)         POKCS069
240100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         POKCS069
240200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         POKCS069
240300     END-IF.                                                      POKCS069
240400                                                                  POKCS069
240500/                                                                 POKCS069
240600*----------------------------------------------------------------*POKCS069
240700*  ADJUSTMENTS MADE TO VERIFIED RECEIPTS VIA RCKCS279 OR         *POKCS069
240800*  RCKCS280 ARE FETCHED FROM THE RECEIPT DISTRIBUTION AUDIT      *POKCS069
240900*  TABLE.                                                        *POKCS069
241000*----------------------------------------------------------------*POKCS069
241100 4500-PROCESS-ADJUSTS.                                            POKCS069
241200                                                                  POKCS069
241300     INITIALIZE PV-SUM-UNIT-QTY.                                          
241310     INITIALIZE PV-DOLLARS-VERIFIED.                                      
241400     INITIALIZE PV-AURECD-ADJ-CYC-NBR.                                    
241500     INITIALIZE PV-AURECD-ORD-LNE-NBR.                                    
241600                                                                          
241700     SET PS-AURECD-NOT-FOUND TO TRUE.                                     
241800     SET PS-AURECD-NOT-EOF   TO TRUE.                                     
241900                                                                          
242000     PERFORM 4600-OPEN-AURECD-CSR.                                        
242100                                                                          
242200     PERFORM 4610-GET-AURECD-UNITS                                        
242300         UNTIL PS-AURECD-EOF.                                             
242400                                                                          
242500     PERFORM 4630-CLOSE-AURECD-CSR.                                       
242600                                                                          
242700                                                                          
242800 4600-OPEN-AURECD-CSR.                                            POKCS069
242900                                                                  POKCS069
243000     EXEC SQL                                                     POKCS069
243100          OPEN AURECD-CSR                                         POKCS069
243200     END-EXEC                                                     POKCS069
243300                                                                  POKCS069
243400     EVALUATE TRUE                                                POKCS069
243500         WHEN SQLCODE = ZERO                                      POKCS069
243600                 CONTINUE                                         POKCS069
243700                                                                  POKCS069
243800         WHEN SQLCODE = -904                                      POKCS069
243900         WHEN SQLCODE = -911                                      POKCS069
244000         WHEN SQLCODE = -913                                      POKCS069
244100              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       POKCS069
244200              SET PS-ERROR                                        POKCS069
244300                  DP020-NEXT-ACT-APPL-ERROR                       POKCS069
244400                  DP020-MSG-FATAL                                 POKCS069
244500                      TO TRUE                                     POKCS069
244600              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) POKCS069
244700              PERFORM 9000-CALL-CICS-ARCH-API                     POKCS069
244800                                                                  POKCS069
244900         WHEN SQLWARN0 NOT = SPACES                               POKCS069
245000         WHEN SQLCODE < ZERO                                      POKCS069
245100         WHEN SQLCODE > ZERO                                      POKCS069
245200             MOVE '4600-OPEN-AURECD-CSR'                          POKCS069
245300                               TO DP013-PARAGRAPH                 POKCS069
245400             MOVE 'OPEN AURECD-CSR CURSOR'                        POKCS069
245500                               TO DP013-MESSAGE-TEXT (1)          POKCS069
245600             MOVE SQLCA        TO DP013-SQLCA                     POKCS069
245700             MOVE 'TAURECD '   TO DP013-DB2-TABLE-NAME (1)        POKCS069
245800             SET DP013-DB2-ABEND                                  POKCS069
245900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               POKCS069
246000             PERFORM DP013-0000-PROCESS-ABEND                     POKCS069
246100     END-EVALUATE.                                                POKCS069
246200                                                                  POKCS069
246300/                                                                 POKCS069
246400*----------------------------------------------------------------*POKCS069
246500*  THE QUANTITY FOR ALL ROWS ON TAURECD ARE TOTALLED BY LINE     *POKCS069
246600*  FOR ADJUSTMENTS MADE IN ONE CYCLE FOR THIS RECEIPT.           *        
246700*  THE ADJUSTED ROWS ARE GROUPED BY THE ADJ_CYC_NBR AND CONSIST  *        
246800*  OF 'BEFORE' AND 'AFTER' ROWS.                                 *        
246900*                                                                *        
247000*  THE DOLLAR AMOUNT IS THEN CALCULATED FOR EACH LINE AND        *        
247100*  ACCUMULATED FOR THE CYCLE.                                    *        
247200*----------------------------------------------------------------*POKCS069
247300 4610-GET-AURECD-UNITS.                                           POKCS069
247400                                                                  POKCS069
247500      PERFORM 4620-FETCH-AURECD.                                          
247600                                                                          
247700      IF PV-AURECD-ADJ-CYC-NBR > ZERO                                     
247800         CONTINUE                                                         
247900      ELSE                                                                
248000         MOVE AURECD-UPD-TMST    TO PV-UPD-TMST                           
248100         MOVE PV-UPD-TMST-DD     TO PV-UPD-DATE-DD                        
248200         MOVE PV-UPD-TMST-MM     TO PV-UPD-DATE-MM                        
248300         MOVE PV-UPD-TMST-YY     TO PV-UPD-DATE-YY                        
248400         MOVE PV-UPD-DATE        TO PV-UPD-DTE-FIRST                      
248500         MOVE PV-UPD-TMST-TIME   TO PV-UPD-TIM-FIRST                      
248600         MOVE AURECD-ORD-LNE-NBR TO PV-AURECD-ORD-LNE-NBR                 
248700         MOVE AURECD-ADJ-CYC-NBR TO PV-AURECD-ADJ-CYC-NBR.                
248800                                                                          
248900      IF PS-AURECD-FOUND                                                  
249000         IF PS-AURECD-EOF                                                 
249100            PERFORM 4800-INCR-ASC-COMM-AREA                               
249200            PERFORM 4640-CALC-DOLLARS                                     
249300            PERFORM 4650-GET-AURECD-DETAIL                        POKCS069
249400         ELSE                                                             
249500            IF AURECD-ADJ-CYC-NBR = PV-AURECD-ADJ-CYC-NBR                 
249600               IF AURECD-ORD-LNE-NBR = PV-AURECD-ORD-LNE-NBR              
249700                  CONTINUE                                                
249800               ELSE                                                       
249900                  PERFORM 4640-CALC-DOLLARS                       POKCS069
250000                  MOVE AURECD-ORD-LNE-NBR TO PV-AURECD-ORD-LNE-NBR        
250100            ELSE                                                          
250200               PERFORM 4800-INCR-ASC-COMM-AREA                            
250300               PERFORM 4640-CALC-DOLLARS                          POKCS069
250400               PERFORM 4650-GET-AURECD-DETAIL                     POKCS069
250500               MOVE AURECD-UPD-TMST       TO PV-UPD-TMST                  
250600               MOVE PV-UPD-TMST-DD        TO PV-UPD-DATE-DD               
250700               MOVE PV-UPD-TMST-MM        TO PV-UPD-DATE-MM               
250800               MOVE PV-UPD-TMST-YY        TO PV-UPD-DATE-YY               
250900               MOVE PV-UPD-DATE           TO PV-UPD-DTE-FIRST             
251000               MOVE PV-UPD-TMST-TIME      TO PV-UPD-TIM-FIRST             
251100               MOVE AURECD-ADJ-CYC-NBR TO PV-AURECD-ADJ-CYC-NBR           
251200               MOVE AURECD-ORD-LNE-NBR TO PV-AURECD-ORD-LNE-NBR           
251300               MOVE ZEROES TO PV-SUM-UNIT-QTY                             
251310                              PV-DOLLARS-VERIFIED                         
251320                              PV-SUM-LINE-UNIT-QTY                        
251400            END-IF                                                        
251500            IF AURECD-AUD-TYP-CDE = 'A'                                   
251600               ADD AURECD-AP-VERIFY-ITM-QTY TO                            
251610                   PV-SUM-LINE-UNIT-QTY                                   
251700            ELSE                                                          
251800               IF AURECD-AUD-TYP-CDE = 'B'                                
251900                  SUBTRACT AURECD-AP-VERIFY-ITM-QTY                       
252000                      FROM PV-SUM-LINE-UNIT-QTY.                          
252100                                                                  POKCS069
252200 4620-FETCH-AURECD.                                               POKCS069
252300                                                                  POKCS069
252400     EXEC SQL                                                     POKCS069
252500         FETCH AURECD-CSR                                         POKCS069
252600          INTO :AURECD-UPD-TMST                                   POKCS069
252700              ,:AURECD-AP-VERIFY-ITM-QTY                          POKCS069
252800              ,:AURECD-AUD-TYP-CDE                                        
252900              ,:AURECD-ADJ-CYC-NBR                                        
253000              ,:AURECD-ORD-LNE-NBR                                        
253100     END-EXEC.                                                    POKCS069
253200                                                                  POKCS069
253300     EVALUATE TRUE                                                POKCS069
253400         WHEN SQLCODE = +0                                        POKCS069
253500              SET PS-AURECD-FOUND  TO TRUE                        POKCS069
253600         WHEN SQLCODE = +100                                      POKCS069
253700              SET PS-AURECD-EOF    TO TRUE                        POKCS069
253800         WHEN SQLWARN0 NOT = SPACE                                POKCS069
253900         WHEN SQLCODE < +0                                        POKCS069
254000         WHEN SQLCODE > +0                                        POKCS069
254100              MOVE '4620-FETCH-AURECD'                            POKCS069
254200                                   TO DP013-PARAGRAPH             POKCS069
254300              MOVE 'FETCH AURECD CURSOR'                          POKCS069
254400                                   TO DP013-MESSAGE-TEXT (1)      POKCS069
254500              MOVE SQLCA           TO DP013-SQLCA                 POKCS069
254600              MOVE 'TAURECD'       TO DP013-DB2-TABLE-NAME (1)    POKCS069
254700              SET DP013-DB2-ABEND  TO TRUE                        POKCS069
254800              PERFORM DP013-0000-PROCESS-ABEND                    POKCS069
254900     END-EVALUATE.                                                POKCS069
255000                                                                  POKCS069
255100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS069
255200         MOVE '4620-FETCH-AURECD'  TO DP013-PARAGRAPH             POKCS069
255300         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             POKCS069
255400                                   TO DP013-MESSAGE-TEXT (1)      POKCS069
255500         MOVE SQLCA                TO DP013-SQLCA                 POKCS069
255600         SET DP013-DB2-ABEND                                      POKCS069
255700             DP013-XCTL-DISPLAY-RESTART                           POKCS069
255800                                   TO TRUE                        POKCS069
255900         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
256000     END-IF.                                                      POKCS069
256100                                                                  POKCS069
256200*----------------------------------------------------------------*POKCS069
256300* CLOSE THE ADJ CURSOR                                           *POKCS069
256400*----------------------------------------------------------------*POKCS069
256500 4630-CLOSE-AURECD-CSR.                                           POKCS069
256600                                                                  POKCS069
256700     EXEC SQL                                                     POKCS069
256800         CLOSE AURECD-CSR                                         POKCS069
256900     END-EXEC.                                                    POKCS069
257000                                                                  POKCS069
257100     EVALUATE TRUE                                                POKCS069
257200         WHEN SQLCODE = ZERO                                      POKCS069
257300             CONTINUE                                             POKCS069
257400         WHEN SQLCODE = -904                                      POKCS069
257500         WHEN SQLCODE = -911                                      POKCS069
257600         WHEN SQLCODE = -913                                      POKCS069
257700              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       POKCS069
257800              SET PS-ERROR                                        POKCS069
257900                  DP020-NEXT-ACT-APPL-ERROR                       POKCS069
258000                  DP020-MSG-FATAL                                 POKCS069
258100                      TO TRUE                                     POKCS069
258200              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) POKCS069
258300              PERFORM 9000-CALL-CICS-ARCH-API                     POKCS069
258400                                                                  POKCS069
258500         WHEN SQLWARN0 NOT = SPACES                               POKCS069
258600         WHEN SQLCODE < ZERO                                      POKCS069
258700         WHEN SQLCODE > ZERO                                      POKCS069
258800             MOVE '4630-CLOSE-AURECD-CSR'                         POKCS069
258900                               TO DP013-PARAGRAPH                 POKCS069
259000             MOVE 'CLOSE AURECD CURSOR'                           POKCS069
259100                               TO DP013-MESSAGE-TEXT (1)          POKCS069
259200             MOVE SQLCA        TO DP013-SQLCA                     POKCS069
259300             MOVE 'TAURECD '   TO DP013-DB2-TABLE-NAME (1)        POKCS069
259400             SET DP013-DB2-ABEND                                  POKCS069
259500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               POKCS069
259600             PERFORM DP013-0000-PROCESS-ABEND                     POKCS069
259700     END-EVALUATE.                                                POKCS069
259800                                                                          
259900                                                                          
260000 4640-CALC-DOLLARS.                                               POKCS069
260100                                                                  POKCS069
260200     PERFORM 4645-GET-DOLLARS-VER.                                POKCS069
260210                                                                          
260220     ADD PV-SUM-LINE-UNIT-QTY TO                                          
260230         PV-SUM-UNIT-QTY.                                                 
260300                                                                          
260400     COMPUTE PV-CALC-DLRS-VERIFIED =                                    13
260500                (PURITM-UNT-RTL-PR-AMT * PV-SUM-LINE-UNIT-QTY).         13
260510                                                                          
260520     ADD PV-CALC-DLRS-VERIFIED TO                                         
260530         PV-DOLLARS-VERIFIED.                                             
260540                                                                          
260550     MOVE ZEROS TO PV-SUM-LINE-UNIT-QTY.                                  
260600                                                                          
260700*----------------------------------------------------------------*POKCS069
260800*    GET DOLLARS VERIFIED FROM DB2 TABLES                        *POKCS069
260900*----------------------------------------------------------------*POKCS069
261000 4645-GET-DOLLARS-VER.                                            POKCS069
261100                                                                  POKCS069
261200      MOVE RECEIV-REC-SEQ-NBR     TO DK-REC-SEQ-NBR               POKCS069
261300                                                                  POKCS069
261400      EXEC SQL                                                    POKCS069
261500         SELECT  A.UNT_RTL_PR_AMT                                         
261600           INTO :PURITM-UNT-RTL-PR-AMT                            POKCS069
261700           FROM  TPURITM A,                                       POKCS069
261800                 TRECITM B,                                       POKCS069
261900                 TRECEIV C                                                
262000         WHERE C.ORD_NBR            = :ASC-KEY-PO-NBR             POKCS069
262100           AND A.APP_PO_LNE_NBR     = :PV-AURECD-ORD-LNE-NBR      POKCS069
262200           AND A.APP_PO_LNE_NBR     = B.ORD_LNE_NBR               POKCS069
262300           AND A.VER_NBR            = B.PO_VER_NBR                POKCS069
262400           AND B.ORD_NBR            = A.PO_NBR                    POKCS069
262500           AND B.STATUS_CDE         = 'VE'                        POKCS069
262600           AND B.VER_STATUS_CDE     = 'A'                         POKCS069
262700           AND C.REC_SEQ_NBR        = :DK-REC-SEQ-NBR             POKCS069
262800           AND C.ORD_NBR            = B.ORD_NBR                   POKCS069
262900           AND C.REC_SEQ_NBR        = B.REC_SEQ_NBR               POKCS069
263000           AND C.STATUS_CDE         = 'VE'                        POKCS069
263100           AND C.VER_STATUS_CDE     = 'A'                         POKCS069
263200      END-EXEC.                                                   POKCS069
263300                                                                  POKCS069
263400     EVALUATE TRUE                                                POKCS069
263500         WHEN SQLCODE = ZERO                                      POKCS069
263600              IF PV-DOLLARS-VERIFIED-NULL < ZERO                  POKCS069
263700                 MOVE ZEROS TO PV-DOLLARS-VERIFIED                POKCS069
263800              END-IF                                              POKCS069
263900                                                                  POKCS069
264000         WHEN SQLCODE = -904                                      POKCS069
264100         WHEN SQLCODE = -911                                      POKCS069
264200         WHEN SQLCODE = -913                                      POKCS069
264300              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       POKCS069
264400              SET PS-ERROR                                        POKCS069
264500                  DP020-NEXT-ACT-APPL-ERROR                       POKCS069
264600                  DP020-MSG-FATAL                                 POKCS069
264700                      TO TRUE                                     POKCS069
264800              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) POKCS069
264900              PERFORM 9000-CALL-CICS-ARCH-API                     POKCS069
265000                                                                  POKCS069
265100         WHEN SQLWARN0 NOT = SPACES                               POKCS069
265200         WHEN SQLCODE < ZERO                                      POKCS069
265300         WHEN SQLCODE > ZERO                                      POKCS069
265400             MOVE '4645-GET-DOLLARS-VER'                          POKCS069
265500                               TO DP013-PARAGRAPH                 POKCS069
265600             MOVE 'GET ADJUSTMENT DOLLARS VER'                    POKCS069
265700                               TO DP013-MESSAGE-TEXT (1)          POKCS069
265800             MOVE SQLCA        TO DP013-SQLCA                     POKCS069
265900             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)        POKCS069
266000             MOVE 'TAURECD '   TO DP013-DB2-TABLE-NAME (2)        POKCS069
266100             MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (3)        POKCS069
266200             MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (4)        POKCS069
266300             SET DP013-DB2-ABEND                                  POKCS069
266400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               POKCS069
266500             PERFORM DP013-0000-PROCESS-ABEND                     POKCS069
266600     END-EVALUATE.                                                POKCS069
266700                                                                          
266800                                                                          
266900 4650-GET-AURECD-DETAIL.                                          POKCS069
267000                                                                  POKCS069
267100     MOVE RECEIV-REC-SEQ-NBR  TO ASC-REC-SEQ-NBR                  POKCS069
267200                                  (ASC-BLK-SUB ASC-ITEM-SUB).     POKCS069
267300     MOVE RECEIV-OPER-UNT-ID  TO ASC-LOC                          POKCS069
267400                                  (ASC-BLK-SUB ASC-ITEM-SUB).     POKCS069
267500     MOVE PC-VEA              TO ASC-RECEIVER-STAT                POKCS069
267600                                  (ASC-BLK-SUB ASC-ITEM-SUB).     POKCS069
267700     MOVE RECEIV-FCLTY-ID     TO ASC-FCLTY-ID                     POKCS069
267800                                  (ASC-BLK-SUB ASC-ITEM-SUB).     POKCS069
267900                                                                  POKCS069
268000     STRING PV-UPD-DTE-FIRST(1:2) '/'                             POKCS069
268100            PV-UPD-DTE-FIRST(3:2) '/'                             POKCS069
268200            PV-UPD-DTE-FIRST(5:2)                                 POKCS069
268300            DELIMITED BY SIZE                                     POKCS069
268400                             INTO ASC-VERIFIED-DTE                POKCS069
268500                                 (ASC-BLK-SUB ASC-ITEM-SUB).      POKCS069
268600                                                                  POKCS069
268700     STRING PV-UPD-TIM-FIRST(1:2) ':'                             POKCS069
268800            PV-UPD-TIM-FIRST(4:2)                                 POKCS069
268900            DELIMITED BY SIZE                                     POKCS069
269000                             INTO ASC-VERIFIED-TIM                POKCS069
269100                                 (ASC-BLK-SUB ASC-ITEM-SUB).      POKCS069
269200                                                                  POKCS069
269300     MOVE ZEROES              TO ASC-CTN-CNT                      POKCS069
269400                                 (ASC-BLK-SUB ASC-ITEM-SUB).      POKCS069
269500                                                                  POKCS069
269600     MOVE PV-DOLLARS-VERIFIED TO ASC-DOL-VERFD                    POKCS069
269700                                 (ASC-BLK-SUB ASC-ITEM-SUB).      POKCS069
269800                                                                  POKCS069
269900     MOVE PV-SUM-UNIT-QTY     TO  ASC-PCS-VERFD                   POKCS069
270000                                 (ASC-BLK-SUB ASC-ITEM-SUB).      POKCS069
270100                                                                          
270200     MOVE PV-AURECD-ADJ-CYC-NBR  TO ASC-CYC-NBR                   POKCS069
270300                                 (ASC-BLK-SUB ASC-ITEM-SUB).      POKCS069
270400                                                                          
270500 4800-INCR-ASC-COMM-AREA.                                         POKCS069
270600                                                                          
270700     IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                         POKCS069
270800         ADD +1                  TO ASC-ITEM-SUB                  POKCS069
270900     ELSE                                                         POKCS069
271000         ADD +1                  TO ASC-BLK-SUB                   POKCS069
271100         MOVE +1                 TO ASC-ITEM-SUB                  POKCS069
271200                                                                  POKCS069
271300         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 POKCS069
271400             MOVE +1             TO ASC-BLK-SUB                   POKCS069
271500             SET ASC-BLOCK-MODIFIED (1)                           POKCS069
271600                                 TO TRUE                          POKCS069
271700             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS069
271800             MOVE ASC-BLOCK-ENTRIES                               POKCS069
271900                         (PC-MAX-BLOCKS-IN-ARRAY)                 POKCS069
272000                          TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)       POKCS069
272100             ADD +1              TO ASC-BLK-SUB                   POKCS069
272200             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           POKCS069
272300             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              POKCS069
272400                                 TO TRUE                          POKCS069
272500           END-IF                                                 POKCS069
272600       END-IF                                                     POKCS069
272700       ADD +1                      TO ASC-NUMBER-OF-ITEMS-READ    POKCS069
272800       MOVE ASC-NUMBER-OF-ITEMS-READ                              POKCS069
272900                             TO ASC-LIST-ITEM-NUMBER              POKCS069
273000                                (ASC-BLK-SUB ASC-ITEM-SUB).       POKCS069
273100                                                                          
273200*----------------------------------------------------------------*POKCS069
273300* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *POKCS069
273400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *POKCS069
273500* FOR THE SELECTED ITEMS QUEUE.                                  *POKCS069
273600*                                                                *POKCS069
273700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *POKCS069
273800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *POKCS069
273900* THE ARRAY IS FULL.                                             *POKCS069
274000*----------------------------------------------------------------*POKCS069
274100 5000-PREPARE-SEL-QUEUE.                                          POKCS069
274200                                                                  POKCS069
274300     MOVE +1                       TO ASC-BLK-SUB.                POKCS069
274400     PERFORM 5100-WRITE-TEMP-STORAGE.                             POKCS069
274500     ADD +1                        TO ASC-BLK-SUB.                POKCS069
274600     PERFORM 5100-WRITE-TEMP-STORAGE.                             POKCS069
274700                                                                  POKCS069
274800     MOVE ASC-SEL-QUEUE-NAME       TO RC015-SEL-QUEUE-NAME.       POKCS069
274900     PERFORM 6010-DELETE-SEL-QUEUE.                               POKCS069
275000                                                                  POKCS069
275100     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      POKCS069
275200         SET ASC-UPDATE-TSQ        TO TRUE                        POKCS069
275300     END-IF.                                                      POKCS069
275400                                                                  POKCS069
275500     SET RC013-IDX                 TO 1.                          POKCS069
275600     MOVE ZERO                     TO RC015-NUMBER-OF-TS-ITEMS.   POKCS069
275700     INITIALIZE RC013-SELECTED-ITEM-ARRAY.                        POKCS069
275800                                                                  POKCS069
275900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           POKCS069
276000             VARYING PV-ITEM                                      POKCS069
276100             FROM 1 BY 1                                          POKCS069
276200             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     POKCS069
276300                                                                  POKCS069
276400     IF  RC013-IDX > 1                                            POKCS069
276500         PERFORM 5205-WRITE-SEL-QUEUE                             POKCS069
276600         ADD +1                    TO RC015-NUMBER-OF-TS-ITEMS    POKCS069
276700     END-IF.                                                      POKCS069
276800                                                                  POKCS069
276900/                                                                 POKCS069
277000*----------------------------------------------------------------*POKCS069
277100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *POKCS069
277200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *POKCS069
277300*----------------------------------------------------------------*POKCS069
277400 5100-WRITE-TEMP-STORAGE.                                         POKCS069
277500                                                                  POKCS069
277600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     POKCS069
277700                                   TO PV-LIST-ITEM-NUMBER.        POKCS069
277800     COMPUTE PV-BLOCK-NUMBER =                                    POKCS069
277900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    POKCS069
278000                                                                  POKCS069
278100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             POKCS069
278200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             POKCS069
278300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      POKCS069
278400             PERFORM 5105-REWRITE-ASC-LISTQ                       POKCS069
278500         END-IF                                                   POKCS069
278600     ELSE                                                         POKCS069
278700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       POKCS069
278800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            POKCS069
278900         PERFORM 5110-WRITE-ASC-LISTQ                             POKCS069
279000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   POKCS069
279100     END-IF.                                                      POKCS069
279200                                                                  POKCS069
279300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      POKCS069
279400                                   TO TRUE.                       POKCS069
279500/                                                                 POKCS069
279600*----------------------------------------------------------------*POKCS069
279700*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *POKCS069
279800*  SPECIFIC COMMAREA.                                            *POKCS069
279900*----------------------------------------------------------------*POKCS069
280000 5105-REWRITE-ASC-LISTQ.                                          POKCS069
280100                                                                  POKCS069
280200     EXEC CICS                                                    POKCS069
280300         WRITEQ TS                                                POKCS069
280400             QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS069
280500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               POKCS069
280600             ITEM  (PV-BLOCK-NUMBER)                              POKCS069
280700             REWRITE                                              POKCS069
280800             RESP  (PV-CICS-RESP)                                 POKCS069
280900     END-EXEC.                                                    POKCS069
281000                                                                  POKCS069
281100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           POKCS069
281200         CONTINUE                                                 POKCS069
281300     ELSE                                                         POKCS069
281400         SET DP013-CICS-ABEND      TO TRUE                        POKCS069
281500         SET DP013-NO-ROLLBACK     TO TRUE                        POKCS069
281600         MOVE '5105-REWRITE-ASC-LISTQ'                            POKCS069
281700                                   TO DP013-PARAGRAPH             POKCS069
281800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     POKCS069
281900                                   TO DP013-MESSAGE-TEXT(1)       POKCS069
282000         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
282100     END-IF.                                                      POKCS069
282200/                                                                 POKCS069
282300*----------------------------------------------------------------*POKCS069
282400*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *POKCS069
282500*  SPECIFIC COMMAREA.                                            *POKCS069
282600*----------------------------------------------------------------*POKCS069
282700 5110-WRITE-ASC-LISTQ.                                            POKCS069
282800                                                                  POKCS069
282900     EXEC CICS                                                    POKCS069
283000         WRITEQ TS                                                POKCS069
283100             QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS069
283200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               POKCS069
283300             ITEM  (PV-BLOCK-NUMBER)                              POKCS069
283400             RESP  (PV-CICS-RESP)                                 POKCS069
283500     END-EXEC.                                                    POKCS069
283600                                                                  POKCS069
283700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      POKCS069
283800         SET DP013-CICS-ABEND      TO TRUE                        POKCS069
283900         SET DP013-NO-ROLLBACK     TO TRUE                        POKCS069
284000         MOVE '5110-WRITE-ASC-LISTQ'                              POKCS069
284100                                   TO DP013-PARAGRAPH             POKCS069
284200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           POKCS069
284300                                   TO DP013-MESSAGE-TEXT(1)       POKCS069
284400         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
284500     END-IF.                                                      POKCS069
284600/                                                                 POKCS069
284700*----------------------------------------------------------------*POKCS069
284800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *POKCS069
284900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *POKCS069
285000*----------------------------------------------------------------*POKCS069
285100 5200-FILL-SEL-QUEUE-RECORD.                                      POKCS069
285200                                                                  POKCS069
285300     PERFORM 6112-READ-LIST-QUEUE.                                POKCS069
285400                                                                  POKCS069
285500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       POKCS069
285600         PERFORM                                                  POKCS069
285700         VARYING LQW-IDX                                          POKCS069
285800         FROM 1 BY 1                                              POKCS069
285900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            POKCS069
286000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          POKCS069
286100                                                                  POKCS069
286200             IF  LQW-SELECT (LQW-IDX)                             POKCS069
286300                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              POKCS069
286400                                   TO RC013-ITEM (RC013-IDX)      POKCS069
286500                 MOVE LQW-REC-SEQ-NBR (LQW-IDX)                   POKCS069
286600                                   TO RC013-REC-SEQ-NBR           POKCS069
286700                                        (RC013-IDX)               POKCS069
286800                                     RC015-REC-SEQ-NBR            POKCS069
286900                 MOVE ASC-KEY-PO-NBR                              POKCS069
287000                                   TO RC013-PO-NBR (RC013-IDX)    POKCS069
287100                                                                          
287200*  RC013-SHIPT-ID WILL BE USED IN RCKCS282 TO PASS SELECTED               
287300*  ADJUSTED LINE NUMBERS TO RCKCS283.                                     
287400                 MOVE ZEROES       TO RC013-SHIPT-ID (RC013-IDX)  POKCS069
287500                 MOVE LQW-FCT-LOC (LQW-IDX)                       POKCS069
287600                                   TO RC013-OPER-UNT-ID(RC013-IDX)POKCS069
287700                 MOVE LQW-FCLTY-ID (LQW-IDX)                      POKCS069
287800                                   TO RC013-FCLTY-ID(RC013-IDX)   POKCS069
287900                                                                          
288000* THIS IS THE CYCLE NUMBER THAT IDENTIFIES A UNIQUE                       
288100* ADJUSTMENT IN TAURECD.  IT WILL BE USED BY PROGRAMS                     
288200* RCKCS282 AND RCKCS283                                                   
288300                 MOVE LQW-CYC-NBR (LQW-IDX)                       POKCS069
288400                                   TO RC013-TRIP-ID(RC013-IDX)    POKCS069
288600                                                                          
288700* THIS DATE WILL BE SHOWN IN THE HEADING OF RCKCS282 AND                  
288800* RCKCS282.                                                               
288900                 MOVE LQW-VERIFIED-DTE (LQW-IDX)                  POKCS069
289000                                   TO RC013-ARRIVAL-DTE           POKCS069
289100                                      (RC013-IDX)                         
289200                                                                          
289300                 MOVE SPACE        TO RC013-ACTION-SW (RC013-IDX) POKCS069
289400                 SET RC013-IDX UP BY 1                            POKCS069
289500                 IF  RC013-IDX > RC013-MAX-ITEMS                  POKCS069
289600                     PERFORM 5205-WRITE-SEL-QUEUE                 POKCS069
289700                     ADD +1        TO RC015-NUMBER-OF-TS-ITEMS    POKCS069
289800                     INITIALIZE RC013-SELECTED-ITEM-ARRAY         POKCS069
289900                     SET RC013-IDX TO 1                           POKCS069
290000                 END-IF                                           POKCS069
290100             END-IF                                               POKCS069
290200         END-PERFORM                                              POKCS069
290300     END-IF.                                                      POKCS069
290400/                                                                 POKCS069
290500*----------------------------------------------------------------*POKCS069
290600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *POKCS069
290700*----------------------------------------------------------------*POKCS069
290800 5205-WRITE-SEL-QUEUE.                                            POKCS069
290900                                                                  POKCS069
291000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            POKCS069
291100                                   TO RC013-SELECTED-ITEMS.       POKCS069
291200                                                                  POKCS069
291300     EXEC CICS                                                    POKCS069
291400          WRITEQ TS                                               POKCS069
291500              QUEUE (ASC-SEL-QUEUE-NAME)                          POKCS069
291600              FROM  (RC013-DC-SELECT-RECORD)                      POKCS069
291700              ITEM  (PV-SEL-QUEUE-ITEM)                           POKCS069
291800              RESP  (PV-CICS-RESP)                                POKCS069
291900     END-EXEC.                                                    POKCS069
292000                                                                  POKCS069
292100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          POKCS069
292200         CONTINUE                                                 POKCS069
292300     ELSE                                                         POKCS069
292400         SET DP013-CICS-ABEND      TO TRUE                        POKCS069
292500         SET DP013-NO-ROLLBACK     TO TRUE                        POKCS069
292600         MOVE '5205-WRITE-SEL-QUEUE'                              POKCS069
292700                                   TO DP013-PARAGRAPH             POKCS069
292800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          POKCS069
292900                                   TO DP013-MESSAGE-TEXT(1)       POKCS069
293000         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
293100     END-IF.                                                      POKCS069
293200/                                                                 POKCS069
293300*----------------------------------------------------------------*POKCS069
293400*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *POKCS069
293500*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *POKCS069
293600*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *POKCS069
293700*  THE USER.                                                     *POKCS069
293800*----------------------------------------------------------------*POKCS069
293900 6000-REFRESH-PANEL-FROM-TEMP.                                    POKCS069
294000                                                                  POKCS069
294100     IF  ASC-UPDATE-TSQ                                           POKCS069
294200         SET ASC-NO-TSQ-UPDATE     TO TRUE                        POKCS069
294300         MOVE ZERO                 TO PV-SAVE-ITEM                POKCS069
294400                                      PV-SEL-QUEUE-ITEM           POKCS069
294500         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        POKCS069
294600                                   TO PV-HOLD-SELECTED-ITEMS      POKCS069
294700         PERFORM 6100-UPDATE-TSQ                                  POKCS069
294800             UNTIL PV-ITEMS-PROCESSED >                           POKCS069
294900                                     ASC-NUMBER-OF-SELECTED-ITEMS POKCS069
295000         PERFORM 6010-DELETE-SEL-QUEUE                            POKCS069
295100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         POKCS069
295200                    ASC-BLOCK-ENTRIES (2)                         POKCS069
295300     END-IF.                                                      POKCS069
295400/                                                                 POKCS069
295500*----------------------------------------------------------------*POKCS069
295600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *POKCS069
295700*----------------------------------------------------------------*POKCS069
295800 6010-DELETE-SEL-QUEUE.                                           POKCS069
295900                                                                  POKCS069
296000     EXEC CICS                                                    POKCS069
296100         DELETEQ TS                                               POKCS069
296200             QUEUE (ASC-SEL-QUEUE-NAME)                           POKCS069
296300             RESP  (PV-CICS-RESP)                                 POKCS069
296400     END-EXEC.                                                    POKCS069
296500                                                                  POKCS069
296600     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      POKCS069
296700         (PV-CICS-RESP = DFHRESP(QIDERR)))                        POKCS069
296800         CONTINUE                                                 POKCS069
296900     ELSE                                                         POKCS069
297000         SET DP013-CICS-ABEND      TO TRUE                        POKCS069
297100         SET DP013-NO-ROLLBACK     TO TRUE                        POKCS069
297200         MOVE '6010-DELETE-SEL-QUEUE'                             POKCS069
297300                                   TO DP013-PARAGRAPH             POKCS069
297400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         POKCS069
297500                                   TO DP013-MESSAGE-TEXT (1)      POKCS069
297600         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
297700     END-IF.                                                      POKCS069
297800/                                                                 POKCS069
297900*----------------------------------------------------------------*POKCS069
298000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *POKCS069
298100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *POKCS069
298200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *POKCS069
298300*    THE TEMP QUEUE.                                             *POKCS069
298400*----------------------------------------------------------------*POKCS069
298500 6100-UPDATE-TSQ.                                                 POKCS069
298600                                                                  POKCS069
298700     ADD 1                         TO PV-SEL-QUEUE-ITEM.          POKCS069
298800     PERFORM 6105-READ-SEL-QUEUE.                                 POKCS069
298900                                                                  POKCS069
299000     PERFORM                                                      POKCS069
299100         VARYING RC013-IDX                                        POKCS069
299200         FROM 1 BY 1                                              POKCS069
299300         UNTIL ((PV-ITEMS-PROCESSED >                             POKCS069
299400                              PV-HOLD-SELECTED-ITEMS)             POKCS069
299500         OR (RC013-IDX GREATER THAN RC013-MAX-ITEMS))             POKCS069
299600         IF  RC013-ACTION-SW (RC013-IDX) > SPACE                  POKCS069
299700             PERFORM 6110-PROCESS-ITEMS                           POKCS069
299800         END-IF                                                   POKCS069
299900         ADD +1                    TO PV-ITEMS-PROCESSED          POKCS069
300000     END-PERFORM.                                                 POKCS069
300100                                                                  POKCS069
300200     PERFORM 6111-WRITE-LIST-QUEUE.                               POKCS069
300300/                                                                 POKCS069
300400*----------------------------------------------------------------*POKCS069
300500*    READ THE LIST QUEUE RECORD.                                 *POKCS069
300600*----------------------------------------------------------------*POKCS069
300700 6105-READ-SEL-QUEUE.                                             POKCS069
300800                                                                  POKCS069
300900     EXEC CICS                                                    POKCS069
301000          READQ TS                                                POKCS069
301100              QUEUE (ASC-SEL-QUEUE-NAME)                          POKCS069
301200              INTO  (RC013-DC-SELECT-RECORD)                      POKCS069
301300              ITEM  (PV-SEL-QUEUE-ITEM)                           POKCS069
301400              RESP  (PV-CICS-RESP)                                POKCS069
301500     END-EXEC.                                                    POKCS069
301600                                                                  POKCS069
301700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          POKCS069
301800         CONTINUE                                                 POKCS069
301900     ELSE                                                         POKCS069
302000         SET DP013-CICS-ABEND      TO TRUE                        POKCS069
302100         SET DP013-NO-ROLLBACK     TO TRUE                        POKCS069
302200         MOVE '6105-READ-SEL-QUEUE'                               POKCS069
302300                                   TO DP013-PARAGRAPH             POKCS069
302400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           POKCS069
302500                                   TO DP013-MESSAGE-TEXT(1)       POKCS069
302600         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
302700     END-IF.                                                      POKCS069
302800/                                                                 POKCS069
302900*----------------------------------------------------------------*POKCS069
303000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*POKCS069
303100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*POKCS069
303200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *POKCS069
303300*----------------------------------------------------------------*POKCS069
303400 6110-PROCESS-ITEMS.                                              POKCS069
303500                                                                  POKCS069
303600     COMPUTE PV-ITEM = 1 + ((RC013-ITEM (RC013-IDX) - 1)          POKCS069
303700                     / PC-ITEMS-PER-PANEL).                       POKCS069
303800                                                                  POKCS069
303900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           POKCS069
304000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          POKCS069
304100             PERFORM 6111-WRITE-LIST-QUEUE                        POKCS069
304200         END-IF                                                   POKCS069
304300         MOVE PV-ITEM              TO PV-SAVE-ITEM                POKCS069
304400                                                                  POKCS069
304500         PERFORM 6112-READ-LIST-QUEUE                             POKCS069
304600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               POKCS069
304700             CONTINUE                                             POKCS069
304800         END-IF                                                   POKCS069
304900     END-IF.                                                      POKCS069
305000                                                                  POKCS069
305100     COMPUTE PV-SUB = (RC013-ITEM (RC013-IDX)                     POKCS069
305200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              POKCS069
305300                                                                  POKCS069
305400     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       POKCS069
305500     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        POKCS069
305600                                     (PV-SUB).                    POKCS069
305700                                                                  POKCS069
305800     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                POKCS069
305900/                                                                 POKCS069
306000*----------------------------------------------------------------*POKCS069
306100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *POKCS069
306200*----------------------------------------------------------------*POKCS069
306300 6111-WRITE-LIST-QUEUE.                                           POKCS069
306400                                                                  POKCS069
306500     EXEC CICS                                                    POKCS069
306600         WRITEQ TS                                                POKCS069
306700             QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS069
306800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     POKCS069
306900             ITEM  (PV-SAVE-ITEM)                                 POKCS069
307000             REWRITE                                              POKCS069
307100             RESP  (PV-CICS-RESP)                                 POKCS069
307200     END-EXEC.                                                    POKCS069
307300                                                                  POKCS069
307400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          POKCS069
307500     OR  PV-CICS-RESP = DFHRESP (ITEMERR)                         POKCS069
307600         CONTINUE                                                 POKCS069
307700     ELSE                                                         POKCS069
307800         SET DP013-CICS-ABEND      TO TRUE                        POKCS069
307900         SET DP013-NO-ROLLBACK     TO TRUE                        POKCS069
308000         MOVE '6111-WRITE-LIST-QUEUE'                             POKCS069
308100                                   TO DP013-PARAGRAPH             POKCS069
308200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  POKCS069
308300                                   TO DP013-MESSAGE-TEXT(1)       POKCS069
308400         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
308500     END-IF.                                                      POKCS069
308600/                                                                 POKCS069
308700*----------------------------------------------------------------*POKCS069
308800*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*POKCS069
308900*----------------------------------------------------------------*POKCS069
309000 6112-READ-LIST-QUEUE.                                            POKCS069
309100                                                                  POKCS069
309200     EXEC CICS                                                    POKCS069
309300         READQ TS                                                 POKCS069
309400             QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS069
309500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     POKCS069
309600             ITEM  (PV-ITEM)                                      POKCS069
309700             RESP  (PV-CICS-RESP)                                 POKCS069
309800     END-EXEC.                                                    POKCS069
309900                                                                  POKCS069
310000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          POKCS069
310100         CONTINUE                                                 POKCS069
310200     ELSE                                                         POKCS069
310300         SET DP013-CICS-ABEND      TO TRUE                        POKCS069
310400         SET DP013-NO-ROLLBACK     TO TRUE                        POKCS069
310500         MOVE '6112-READ-LIST-QUEUE'                              POKCS069
310600                                   TO DP013-PARAGRAPH             POKCS069
310700         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    POKCS069
310800                                   TO DP013-MESSAGE-TEXT(1)       POKCS069
310900         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
311000     END-IF.                                                      POKCS069
311100/                                                                 POKCS069
311200*----------------------------------------------------------------*POKCS069
311300*    FORMAT COMMAREA AFTER A LOCAL GOTO AND A SELECTED ITEM      *POKCS069
311400*----------------------------------------------------------------*POKCS069
311500 7000-FORMAT-COMMAREA.                                            POKCS069
311600                                                                  POKCS069
311700     IF ASC-BLOCK-MODIFIED-SW(1) = 'Y'                            POKCS069
311800        MOVE 1                   TO PV-BLOCK-NUMBER               POKCS069
311900     ELSE                                                         POKCS069
312000        MOVE 2                   TO PV-BLOCK-NUMBER               POKCS069
312100     END-IF.                                                      POKCS069
312200                                                                  POKCS069
312300     PERFORM VARYING PV-SUB FROM 1 BY 1                           POKCS069
312400             UNTIL PV-SUB > PC-ITEMS-PER-PANEL                    POKCS069
312500         IF  ASC-SELECTED-SW  (PV-BLOCK-NUMBER PV-SUB) = 'S'      POKCS069
312600             MOVE ASC-REC-SEQ-NBR (PV-BLOCK-NUMBER PV-SUB)        POKCS069
312700                                  TO RC015-REC-SEQ-NBR            POKCS069
312800             MOVE ASC-LOC         (PV-BLOCK-NUMBER PV-SUB)        POKCS069
312900                                  TO RC015-OPER-UNT-ID            POKCS069
313000             MOVE ASC-FCLTY-ID (PV-BLOCK-NUMBER PV-SUB)           POKCS069
313100                                  TO RC015-FCLTY-ID               POKCS069
313200             COMPUTE PV-SUB = PC-ITEMS-PER-PANEL + 1              POKCS069
313300         END-IF                                                   POKCS069
313400     END-PERFORM.                                                 POKCS069
313500                                                                  POKCS069
313600     MOVE ASC-KEY-PO-NBR          TO RC015-PO-NBR.                POKCS069
313700*                                    PO017-PO-NBR.                POKCS069
313800/                                                                 POKCS069
313900*---------------------------------------------------------------* POKCS069
314000*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * POKCS069
314100*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * POKCS069
314200*---------------------------------------------------------------* POKCS069
314300 9000-CALL-CICS-ARCH-API.                                         POKCS069
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      POKCS069
314500                                    DFHCOMMAREA                   POKCS069
314600                                    DP030-CICS-API-FIELDS         POKCS069
314700                                    DP020-STANDARD-COMMAREA       POKCS069
314800                                    PO069AI.                      POKCS069
314900                                                                  POKCS069
315000     IF DP030-RC-CALL-SUCCESSFUL OR                               POKCS069
315100        DP030-RC-APPL-ERROR                                       POKCS069
315200         CONTINUE                                                 POKCS069
315300     ELSE                                                         POKCS069
315400         SET DP013-NO-ROLLBACK                                    POKCS069
315500             DP013-XCTL-DISPLAY-RESTART                           POKCS069
315600             DP013-CICS-ABEND      TO TRUE                        POKCS069
315700         MOVE '9000-CALL-CICS-ARCH-API'                           POKCS069
315800                                   TO DP013-PARAGRAPH             POKCS069
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE OPOKCS069
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      POKCS069
316100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      POKCS069
316200         PERFORM DP013-0000-PROCESS-ABEND                         POKCS069
316300     END-IF.                                                      POKCS069
316400/                                                                 POKCS069
316500*----------------------------------------------------------------*POKCS069
316600*    ABEND PROCESSOR MODULE                                      *POKCS069
316700*----------------------------------------------------------------*POKCS069
316800     COPY DPPD013.                                                POKCS069
316900*----------------------------------------------------------------*POKCS069
317000*----------------------------------------------------------------*POKCS069
