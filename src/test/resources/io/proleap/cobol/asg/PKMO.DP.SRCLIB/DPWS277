000100******************************************************************        
000200**   DPWS277 - COMMARAREA USED BY DPKCS277 TO HOLD DATA WHILE             
000300**             CALCULATING OPEN-TO-RECEIVE IN THE RECEIVING               
000400**             SYSTEM.  DPWS277 WILL ALSO CALL THE RECEIVING              
000500**             PACK VALIDATION ROUTINE CALLED RCKCS806 FOR                
000600**             PROCESSING PREPACK DATA.                                   
000700******************************************************************        
000800 01  DP277-COMMAREA.                                                      
000900     05  DP277-PROCESSING-FLAGS.                                          
001000                                                                          
001100******************************************************************        
001200** DP277-OTR-TYPE DETERMINES THE LEVEL OF DETAIL TO BE PROCESSED.         
001300** IF STORE-LEVEL-OTR IS REQUESTED, THEN ONE LINE AND ALL THE             
001400** STORE'S OTR DATA IS RETURNED.  LINE-LEVEL-OTR WILL DETERMINE           
001500** OTR INFORMATION AT A LINE SUMMARY LEVEL. LINE LEVEL TOTALLS            
001600** ONLY INCLUDE THE LINES IN A PACK.                                      
001700******************************************************************        
001800         10  DP277-OTR-TYPE             PIC X.                            
001900             88  DP277-STORE-LEVEL-OTR          VALUE 'S'.                
002000             88  DP277-LINE-LEVEL-OTR           VALUE 'L'.                
002100                                                                          
002200******************************************************************        
002300** DP277-OTR-SCOPE DETERMINES THE SCOPE OF DETERMINING OTR.               
002400** RECEIVER-OTR WILL ONLY PROCESS PREVIOUS OR VERIFIED RECEIVERS          
002500** TO THE CURRENT RECEIVER.  WHEREAS PO-OTR PROCESSES ALL THE             
002600** RECEIVERS.                                                             
002700******************************************************************        
002800         10  DP277-OTR-SCOPE            PIC X.                            
002900             88  DP277-RECEIVER-OTR             VALUE 'R'.                
003000             88  DP277-PO-OTR                   VALUE 'P'.                
003100                                                                          
003200******************************************************************        
003300** DP277-STORE-PLAN-SCOPE DETERMINES WHICH STORE PLAN TO USE              
003400** FOR STORE ALLOCATION INCLUDING TMESTDS OR TSPSTDS.                     
003500** NOTE DP277-STORE-PLAN-SCOPE IS ONLY APPLICABLE FOR STORE-LEVEL         
003600** OTR AND ONLY USED FOR STORE ALLOCATION IN TRANSCRIPTION AND            
003700** REDISTRO FUNCTIONS. ALL OTHER APPLICATIONS THAT USE                    
003800** DPKCS277 SHOULD IGNORE THIS SWITCH.                                    
003900******************************************************************        
004000         10  DP277-STORE-PLAN-SCOPE     PIC X   VALUE 'M'.                
004100             88  DP277-SPECIFIC-PLAN            VALUE 'S'.                
004200             88  DP277-MASTER-PLAN              VALUE 'M'.                
004300                                                                          
004400******************************************************************        
004500** DP277-KEYS CAN CONTAIN A PO-LNE-NBR OR PREPK-ID DEPENDING              
004600** ON THE TYPE OF OTR REQUEST.  PASSING A LNE-NBR IS FOR                  
004700** PROCESSING A STORE OTR.  WHEREAS PASSING A PREPK-ID IS FOR             
004800** PROCESSING THE LINE OTR.  ONLY THE LINES TIED TO A PREPK-ID            
004900** ARE CONSIDERED. IF REQUESTING A PACK VALIDATION THEN A                 
005000** PREPK-ID MUST BE PASSED. THE OTHER KEYS ARE ALWAYS MANDITORY.          
005100******************************************************************        
005200     05  DP277-KEYS.                                                      
005300         10  DP277-PO-NBR             PIC S9(9) COMP                      
005400                                                VALUE ZERO.               
005500         10  DP277-PO-LNE-NBR         PIC S9(9) COMP                      
005600                                                VALUE ZERO.               
005700         10  DP277-REC-SEQ-NBR        PIC S9(9) COMP                      
005800                                                VALUE ZERO.               
005900         10  DP277-PO-PREPK-ID        PIC S9(4) COMP                      
006000                                                VALUE ZERO.               
006100         10  DP277-OPER-UNT-ID        PIC S9(4) COMP                      
006200                                                VALUE ZERO.               
006300         10  DP277-FCLTY-ID           PIC S9(4) COMP                      
006400                                                VALUE ZERO.               
006500         10  DP277-STR-NBR            PIC S9(4) COMP                      
006600                                                VALUE ZERO.               
006700                                                                          
006800******************************************************************        
006900** DP277-WORK-FIELDS IS USED BY DBPD277 WHICH IS A COPYBOOK               
007000** UTILIZIED BY CALLING PROGRAMS OF DPKCS277.                             
007100******************************************************************        
007200     05  DP277-WORK-FIELDS.                                               
007300         10  DP277-SEARCH-NBR         PIC S9(4) COMP                      
007400                                                VALUE ZERO.               
007500         10  DP277-TOTAL-OTR          PIC S9(7) COMP-3                    
007600                                                VALUE ZERO.               
007700         10  DP277-TOTAL-PK-OTR       PIC S9(7) COMP-3                    
007800                                                VALUE ZERO.               
007700         10  DP277-TOTAL-DISTRO-OTR   PIC S9(7) COMP-3                    
007800                                                VALUE ZERO.               
007900         10  DP277-OTR-OUT            PIC S9(9) COMP-3                    
008000                                                VALUE ZERO.               
008100         10  DP277-OTR-OUT-X          PIC X(5)  VALUE SPACE.              
008200         10  DP277-PK-OTR-OUT         PIC S9(9) COMP-3                    
008300                                                VALUE ZERO.               
008810         10  DP277-DISTRO-OTR-OUT     PIC S9(9) COMP-3                    
008300                                                VALUE ZERO.               
008400         10  DP277-ORDER-QTY          PIC S9(9) COMP-3                    
008500                                                VALUE ZERO.               
008600         10  DP277-ORDER-QTY-X        PIC X(5)  VALUE SPACE.              
008700         10  DP277-ORDER-PK-QTY       PIC S9(9) COMP-3                    
008800                                                VALUE ZERO.               
008810         10  DP277-CURR-SPLIT-QTY     PIC S9(9) COMP.                     
008810         10  DP277-CURR-SPLIT-PK      PIC S9(9) COMP.                     
008810         10  DP277-DISTRO-REQ-ID      PIC S9(9) COMP.                     
008810         10  DP277-ALLOC-OUTR-PK-QTY  PIC S9(5) COMP-3.                   
008810         10  DP277-PK-SIZE-RND-CDE    PIC X(1) VALUE SPACE.               
008900                                                                          
009000******************************************************************        
009100** DP277-LINE-TABLE IS A COPY OF ALL THE LINES IN A PACK.  IT WILL        
009200** CONTAIN THE LINE DISTRIBUTION FOR THE ENTIRE LINE AND THE              
009300** OPEN TO RECEIVE BY LINE. ONLY THE LINES IN THE PREPK-ID WILL           
009400** EVER BE RETRIEVED.                                                     
009500******************************************************************        
009600     05  DP277-LINE-TABLE.                                                
009700         10  DP277-LNE-WORK-AREA OCCURS 100 TIMES                         
009800                             INDEXED BY DP277-LNE-IDX                     
009900                                        DP277-LNE-ERR-IDX.                
010000             15  DP277-LNE-NBR           PIC S9(9) COMP.                  
010110             15  DP277-LNE-DISTRO-QTY    PIC S9(9) COMP-3.                
010200             15  DP277-LNE-DISTRO-QTY-X  PIC X(05).                       
010300             15  DP277-LNE-DISTRO-PK     PIC S9(9) COMP-3.                
010300             15  DP277-LNE-DISTRO-PK-X   PIC X(05).                       
010400             15  DP277-LNE-OTR-QTY       PIC S9(9) COMP-3.                
010500             15  DP277-LNE-OTR-QTY-X     PIC X(05).                       
010600             15  DP277-LNE-OTR-PK        PIC S9(9) COMP-3.                
010600             15  DP277-LNE-OTR-PK-X      PIC X(05).                       
010600             15  DP277-LNE-DISTRO-OTR    PIC S9(9) COMP-3.                
010600             15  DP277-LNE-DISTRO-OTR-X  PIC X(05).                       
010700                                                                          
010800******************************************************************        
010900** DP277-STORE-TABLE IS A COPY OF ALL THE STORE'S ALLOCATION              
011000** CONTRAINTS,  STORE DISTRIBUTION QUANTITIES AND OPEN TO RECEIVE.        
011100** TRANCRIPTION AND REDISTRO REQUIRE THE STORE ALLOCATION                 
011200** INFORMATION.                                                           
011300******************************************************************        
011400     05  DP277-STORE-TABLE.                                               
011500         10  DP277-STR-WORK-AREA OCCURS 250 TIMES                         
011600                             INDEXED BY DP277-STR-IDX                     
011700                                        DP277-STR-ERR-IDX.                
011800             15  DP277-STORE-NBR       PIC S9(4) COMP.                    
011900             15  DP277-ALLOC-SEQ-CDE   PIC X.                             
012000             15  DP277-RNK-SEQ-NBR     PIC S9(4) COMP.                    
012100             15  DP277-STR-CNSTR-CDE   PIC X.                             
012200             15  DP277-STR-CNSTR-QTY   PIC S9(9) COMP.                    
012300             15  DP277-STR-DISTRO-QTY  PIC S9(9) COMP-3.                  
012400             15  DP277-STR-DISTRO-QTY-X                                   
012500                                       PIC X(05).                         
012600             15  DP277-STR-DISTRO-PK   PIC S9(9) COMP-3.                  
012600             15  DP277-STR-DISTRO-PK-X PIC X(05).                         
012700             15  DP277-STR-OTR-QTY     PIC S9(9) COMP-3.                  
012800             15  DP277-STR-OTR-QTY-X   PIC X(05).                         
012900             15  DP277-STR-OTR-PK      PIC S9(9) COMP-3.                  
012900             15  DP277-STR-OTR-PK-X    PIC X(05).                         
012900             15  DP277-STR-DISTRO-OTR  PIC S9(9) COMP-3.                  
012900             15  DP277-STR-DISTRO-OTR-X                                   
012500                                       PIC X(05).                         
013000                                                                          
013100******************************************************************        
013200** DP277-RETURN-DATA PROVIDES A MECHANISM FOR PASSING                     
013300** PROCESSING OR DB2 ERRORS BACK TO THE CALLING PROGRAM.                  
013400** THE CALLING PROGRAM MUST HANDLE THE ERROR PROCESSING.                  
013500******************************************************************        
013600     05  DP277-RETURN-DATA.                                               
013700         10  DP277-RETURN-CODE        PIC 9(3).                           
013800         10  DP277-ABEND-ACTION-IND   PIC X(01).                          
013900             88  DP277-NO-DISTRO                VALUE 'D'.                
014000             88  DP277-INVALID-DISTRO           VALUE 'I'.                
014100             88  DP277-CROAK                    VALUE 'C'.                
014200             88  DP277-SOFT-ABORT               VALUE 'S'.                
014300         10  DP277-SEVERITY-IND       PIC X(01).                          
014400             88  DP277-FATAL-ERROR              VALUE 'F'.                
014500             88  DP277-WARNING-ERROR            VALUE 'W'.                
014600         10  DP277-MSG-NUMBER         PIC 9(05).                          
