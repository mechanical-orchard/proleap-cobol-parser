000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'CONVERT RDM INVENTORY BALANCE TO CE FORMAT'.              00020000
000300 PROGRAM-ID.      WSKUT021.                                       00030000
000400 AUTHOR.          DENNIS STEFFEN.                                 00040000
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
000600 DATE-WRITTEN.    JULY 2000.                                      00060000
000700 DATE-COMPILED.                                                   00070000
000800*                                                                 00080000
000900* THIS PROGRAM CONVERTS THE INVENTORY BALANCE UPLOAD FILE INTO    00090000
001000* THE CE018 FORMAT.  THIS IS INPUT TO CENTRAL STOCK INVENTORY     00100000
001100* REPORT CEKRP005 IN PROC CEK1001.                                00110000
196385***************************************************************** 00110100
196385* 2020-05-20 JEAN KURK  RENAME FROM WMKUT016 TO WSKUT016          00111000
196385***************************************************************** 00112000
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627         00114001
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00115001
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00116001
263627***************************************************************** 00117001
001200*                                                                 00120000
001300 ENVIRONMENT DIVISION.                                            00130000
001400 CONFIGURATION SECTION.                                           00140000
001500 SOURCE-COMPUTER. IBM-3090.                                       00150000
001600 OBJECT-COMPUTER. IBM-3090.                                       00160000
001700 INPUT-OUTPUT SECTION.                                            00170000
001800 FILE-CONTROL.                                                    00180000
001900     SELECT INV-BALANCE-FILE ASSIGN TO UT-S-INP01.                00190000
002000     SELECT CE010-FILE       ASSIGN TO UT-S-OUT01.                00200000
002000     SELECT CE-DATE-FILE     ASSIGN TO UT-S-OUT02.                00201000
002100                                                                  00202000
002200 DATA DIVISION.                                                   00203000
002300 FILE SECTION.                                                    00204000
002400                                                                  00205000
002500 FD  INV-BALANCE-FILE                                             00206000
002600     RECORDING MODE IS F                                          00207000
002700     LABEL RECORDS ARE STANDARD                                   00208000
002800     RECORD CONTAINS 128                                          00209000
002900     BLOCK CONTAINS 0 RECORDS                                     00210000
003000     DATA RECORD IS INV-BALANCE-RECORD.                           00220000
003100 01  INV-BALANCE-RECORD               PIC X(128).                 00230000
003200                                                                  00240000
003300 FD  CE010-FILE                                                   00250000
003400     RECORDING MODE IS F                                          00260000
003500     LABEL RECORDS ARE STANDARD                                   00270000
003600     RECORD CONTAINS 175                                          00280000
003700     BLOCK CONTAINS 0 RECORDS                                     00290000
003800     DATA RECORD IS SKU-RECORD.                                   00300000
003900 01  SKU-RECORD                       PIC X(175).                 00310000
004100                                                                  00320000
004200 FD  CE-DATE-FILE                                                 00330000
004300     RECORDING MODE IS F                                          00340000
004400     LABEL RECORDS ARE STANDARD                                   00350000
004500     RECORD CONTAINS 50                                           00360000
004600     BLOCK CONTAINS 0 RECORDS                                     00370000
004700     DATA RECORD IS CE-DATE-RECORD.                               00380000
004800 01  CE-DATE-RECORD                   PIC X(50).                  00390000
004000                                                                  00400000
004100 WORKING-STORAGE SECTION.                                         00410000
004200*                                                                 00420000
004300 01  DK-DB2-KEY-FIELDS.                                           00430000
004400     05  DK-CNSTK-LOC-ID              PIC S9(4) COMP.             00440000
004500*                                                                 00450000
004600 01  PV-PROGRAM-VARIABLES.                                        00460000
004700     05  PV-READ-COUNT                PIC S9(07) COMP-3           00470000
004800                                          VALUE ZERO.             00480000
004900     05  PV-WRITE-COUNT               PIC S9(07) COMP-3           00490000
005000                                          VALUE ZERO.             00500000
004900     05  PV-DATE-REC-COUNT            PIC S9(07) COMP-3           00501000
005000                                          VALUE ZERO.             00502000
005100     05  PV-AVAIL-UNITS               PIC S9(09) COMP-3           00503000
005200                                          VALUE ZERO.             00504000
005300     05  PV-RECVD-UNITS               PIC S9(09) COMP-3           00505000
005400                                          VALUE ZERO.             00506000
005500     05  PV-DISTRIB-UNITS             PIC S9(09) COMP-3           00507000
005600                                          VALUE ZERO.             00508000
005700     05  PV-TOTAL-UNITS               PIC S9(09) COMP-3           00509000
005800                                          VALUE ZERO.             00510000
005900     05  PV-SYSTEM-DATE              PIC  9(06)    VALUE ZERO.    00520000
006000     05  PV-DISP-NBR                  PIC Z,ZZZ,ZZ9.              00530000
006100     05  PV-RETRY-COUNT               PIC S9(04)  VALUE +0        00540000
006200                                                  COMP SYNC.      00550000
006300     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00560000
006400                                                 COMP SYNC.       00570000
006500     05  PV-PARAGRAPH-NAME            PIC  X(30)  VALUE SPACES.   00580000
006600     05  PV-ERROR-MESSAGE-1           PIC  X(60)  VALUE SPACES.   00590000
006700     05  PV-ERROR-MESSAGE-2           PIC  X(60)  VALUE SPACES.   00600000
006800     05  PV-ITEM-MSG.                                             00610000
006900         10  PV-ITEM-MSG-DESC         PIC  X(11)  VALUE           00620000
007000                     'ITEM NBR = '.                               00630000
007100         10  PV-ITEM-NUMBER           PIC  9(15).                 00640000
007200     05  PV-LOC-MSG.                                              00650000
007300         10  PV-LOC-MSG-DESC          PIC  X(12)  VALUE           00660000
007400                     'LOCATION = '.                               00670000
007500         10  PV-LOC-NUMBER            PIC  9(04).                 00680000
007600     05  PV-HOLD-DEPT                 PIC 9(4).                   00690000
007600     05  PV-SUB-CLASS-READ            PIC X(3).                   00700000
006700     05  PV-SUB-CLASS.                                            00710000
006700         10  PV-SUB-CLASS-1           PIC X(1) VALUE '0'.         00720000
006700         10  PV-SUB-CLASS-2-3         PIC 9(2).                   00730000
007000                                                                  00740000
006700     05  PV-HOLD-SIZE-CDE             PIC 9(9).                   00750000
006700     05  PV-SIZE-CDE.                                             00751000
006700         10  FILLER                   PIC 9(4).                   00752000
006700         10  PV-SIZE-CDE-5-9          PIC 9(5).                   00753000
007000                                                                  00754000
007700                                                                  00755000
007800 01  PV-ABEND-FIELDS.                                             00756000
007900     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'WSKUT021'.00757000
008000     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00758000
008100     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00759000
008200     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    00760000
008300     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    00770000
008400     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    00780000
008500     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    00790000
008600     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00800000
008700     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00810000
008800     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00820000
008900     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    00830000
009000     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      00840000
009100     05  PV-FIELD-VALUE               PIC X(80)  VALUE SPACES.    00850000
009100     05  PV-ABEND-PULL-SKU            PIC X(08)  VALUE SPACES.    00860000
009200                                                                  00870000
009300 01  PV-ABEND-CODE                    PIC S9(04)     VALUE +0     00880000
009400                                                     COMP SYNC.   00890000
009500     88  ABEND-4001-CTRL-CARD-ERROR                  VALUE +4001. 00900000
009600     88  ABEND-4002-INPUT-DATE-ERROR                 VALUE +4002. 00910000
009700     88  ABEND-4003-START-DATE-ERROR                 VALUE +4003. 00920000
009800     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00930000
009900*                                                                 00940000
010000 01  PC-PROGRAM-CONSTANTS.                                        00950000
010100     05  PC-PGMNAME                   PIC X(08) VALUE             00960000
010200                                                  'WSKUT021'.     00970000
010300     05  PC-MPS-PROGRAM-NAME         PIC  X(08) VALUE             00980000
010400                                                  'DPKUT039'.     00990000
010500     05  PC-CURRENT-OPERATING-COMPANY                             01000000
010600                                     PIC  X(02) VALUE '03'.       01010000
010700     05  PC-SYSTEM-CODE              PIC  X(02) VALUE 'MP'.       01020000
010800*                                                                 01030000
010900 01  PS-PROGRAM-SWITCHES.                                         01040000
011000     05  PS-EOF-INV-BALANCE-SWITCH    PIC X       VALUE 'N'.      01050000
011100         88  PS-EOF-INV-BALANCE-FILE              VALUE 'Y'.      01060000
011200     05  PS-RECORD-FOUND-SW           PIC X       VALUE 'N'.      01070000
011300         88  PS-NO-RECORD-FOUND                   VALUE 'N'.      01080000
011400         88  PS-RECORD-FOUND                      VALUE 'Y'.      01090000
011500                                                                  01100000
011900/                                                                 01110000
011700*  RMS INVENTORY BALANCE UPLOAD FILE                              01120000
011800     COPY CERD022.                                                01130000
011900/                                                                 01140000
012000*  CENTRAL STOCK SKU RECORD                                       01150000
012100     COPY CERD010.                                                01160000
011900/                                                                 01170000
012000*  CENTRAL STOCK DATE EXTRACT RECORD                              01180000
012100     COPY CERD011.                                                01190000
012200/                                                                 01200000
012300     COPY DPWS010I.                                               01210000
012400/                                                                 01220000
012500*  USED FOR DB2 ERROR MESSAGE BUILDING                            01230000
012600     COPY DPWS004.                                                01240000
012700                                                                  01250000
012500*  USED FOR DB2 ITEM DOMAIN                                       01260000
012600     COPY XLWS001.                                                01270000
012700                                                                  01280000
012800*   DB2 SQL COMMUNICATION AREA                                    01290000
012900     EXEC SQL                                                     01300000
013000          INCLUDE SQLCA                                           01310000
013100     END-EXEC.                                                    01320000
014800                                                                  01330000
014900     EXEC SQL                                                     01340000
015000         INCLUDE  TMDSEAR                                         01350000
015100     END-EXEC.                                                    01360000
015200                                                                  01370000
016600     EXEC SQL                                                     01380000
016700          INCLUDE TCEPLIT                                         01390000
016800     END-EXEC.                                                    01400000
016900/                                                                 01410000
017000     EXEC SQL                                                     01420000
017100          INCLUDE TCEPLST                                         01430000
017200     END-EXEC.                                                    01440000
017300/                                                                 01450000
017400     EXEC SQL                                                     01460000
017500          INCLUDE TCEPLRQ                                         01470000
017600     END-EXEC.                                                    01480000
017700/                                                                 01490000
017800     EXEC SQL                                                     01500000
017900        DECLARE DATE_CSR CURSOR FOR                               01510000
018000        SELECT                                                    01520000
018100            C.CRE_TMST                                            01530000
018200        FROM TCEPLIT A                                            01540000
018300           , TCEPLRQ B                                            01550000
018400           , TCEPLST C                                            01560000
018500        WHERE                                                     01570000
018600            A.ITM_NBR                     = :XL001-ITM-NBR        01580000
018700        AND B.CNSTK_REQ_PL_NBR            = A.CNSTK_REQ_PL_NBR    01590000
018800        AND B.CNSTK_LOC_ID                = :DK-CNSTK-LOC-ID      01600000
018900        AND B.STAT_CDE        IN ('NW', 'IP', 'PD')               01610000
019000        AND A.CNSTK_REQ_PL_NBR            = C.CNSTK_REQ_PL_NBR    01620000
019100        AND A.PL_LNE_NBR                  = C.PL_LNE_NBR          01630000
019200        AND A.STAT_CDE        IN ('NW', 'IP', 'PD')               01640000
019300        AND C.STAT_CDE                    = 'NW'                  01650000
019400        ORDER BY C.CRE_TMST DESC                                  01660000
019500     END-EXEC.                                                    01670000
019600                                                                  01680000
019700 PROCEDURE DIVISION.                                              01690000
019800                                                                  01700000
019900 0000-PROGRAM-MAINLINE.                                           01710000
020000                                                                  01720000
020100     PERFORM 1000-INITIALIZATION.                                 01730000
020200                                                                  01740000
020300     PERFORM 2000-PROCESS-INV-BALANCE                             01750000
020400         UNTIL PS-EOF-INV-BALANCE-FILE                            01760000
020500                                                                  01770000
020700     PERFORM 9000-END-ROUTINE.                                    01780000
020800                                                                  01790000
020900     GOBACK.                                                      01800000
021000/                                                                 01810000
021100 1000-INITIALIZATION.                                             01820000
021200                                                                  01830000
021300     OPEN INPUT INV-BALANCE-FILE                                  01840000
021400          OUTPUT CE010-FILE                                       01850000
021400          OUTPUT CE-DATE-FILE.                                    01860000
021500                                                                  01870000
021600     PERFORM 8000-READ-INV-BALANCE-FILE.                          01880000
021800                                                                  01890000
021900 2000-PROCESS-INV-BALANCE.                                        01900000
022000                                                                  01910000
052602     PERFORM 7220-CALL-XLKUT-DOMAIN-PGM.                          01920000
022200     PERFORM 7250-SELECT-DATE.                                    01930000
022300     PERFORM 7500-SELECT-BYR.                                     01940000
022400                                                                  01950000
022500     PERFORM 8200-EDIT-AVAIL-UNITS.                               01960000
022600     PERFORM 8210-EDIT-RECVD-UNITS.                               01970000
022700     PERFORM 8220-EDIT-DISTRIB-UNITS.                             01980000
022800     PERFORM 8230-EDIT-TOTAL-UNITS.                               01990000
022900                                                                  02000000
023000     PERFORM 2100-MOVE-FIELDS.                                    02010000
023100                                                                  02020000
023200     PERFORM 8100-WRITE-SKU-RECORD.                               02030000
023200     PERFORM 2200-CREATE-CE011-RECORD.                            02040000
023400                                                                  02050000
023500     PERFORM 8000-READ-INV-BALANCE-FILE.                          02060000
023600                                                                  02070000
023700 2100-MOVE-FIELDS.                                                02080000
023800                                                                  02090000
023900     INITIALIZE CE010-SKU-RECORD.                                 02100000
024000                                                                  02110000
024100     MOVE XL001-ITM-NBR               TO CE010-ITEM-NMBR.         02120000
018100     MOVE CE022-LOCATION              TO CE010-CNTRL-STK-ID.      02130000
024300     MOVE XL001-DEPT-NBR-3CH          TO CE010-DEPT.              02140000
024300     MOVE XL001-SUB-CL-NBR-2CH        TO CE010-CLASS.             02150000
024400     MOVE XL001-SKU-NBR               TO CE010-SKU-NBR.           02160000
024500     MOVE XL001-SKU-DESC              TO CE010-SKU-DESC.          02170000
024600     MOVE XL001-VS-NBR                TO CE010-VENDOR-STYLE-CODE. 02180000
036600     MOVE XL001-SIZE-DESC             TO CE010-SIZE-DESC.         02190000
024800     MOVE XL001-SHRT-CLOR-DESC        TO CE010-COLOR-DESC.        02200000
024900     MOVE XL001-UNT-RTL-AMT           TO CE010-CUR-UNIT-RTL-AMT.  02210000
025000     MOVE MDSEAR-BYR-NBR              TO CE010-BUYER.             02220000
025100                                                                  02230000
025200     IF PS-RECORD-FOUND                                           02240000
025300         MOVE CEPLST-CRE-TMST(6:2)        TO CE010-PULL-MM        02250000
025400         MOVE CEPLST-CRE-TMST(9:2)        TO CE010-PULL-DD        02260000
025500         MOVE CEPLST-CRE-TMST(3:2)        TO CE010-PULL-YY        02270000
025600     ELSE                                                         02280000
025700         MOVE '00'                        TO CE010-PULL-MM        02290000
025800         MOVE '00'                        TO CE010-PULL-DD        02300000
025900         MOVE '00'                        TO CE010-PULL-YY        02310000
026000     END-IF.                                                      02320000
018500     ADD PV-AVAIL-UNITS PV-RECVD-UNITS PV-DISTRIB-UNITS           02330000
018600                             GIVING CE010-AVAILABLE.              02340000
018620     MOVE PV-AVAIL-UNITS              TO CE010-AVAIL-UNITS.       02350000
018640     MOVE PV-RECVD-UNITS              TO CE010-RECEIVED-UNITS.    02360000
018660     MOVE PV-DISTRIB-UNITS            TO CE010-DISTRIBUTED-UNITS. 02370000
018680     MOVE PV-TOTAL-UNITS              TO CE010-TOTAL-UNITS.       02380000
018700                                                                  02390000
018800 2200-CREATE-CE011-RECORD.                                        02400000
018900                                                                  02410000
019000     INITIALIZE CE011-DATE-TIME-RECORD.                           02411000
019100     MOVE CE022-TRANS-MO              TO CE011-TMST-MM.           02412000
019200     MOVE '/'                         TO CE011-SLASH-1.           02413000
019300     MOVE CE022-TRANS-DA              TO CE011-TMST-DD.           02414000
019400     MOVE '/'                         TO CE011-SLASH-2.           02415000
019410     IF CE022-TRANS-YR(3:2) > 80                                  02416000
019600         MOVE 19                      TO CE011-TMST-CC            02417000
019700     ELSE                                                         02418000
019800         MOVE 20                      TO CE011-TMST-CC            02419000
019900     END-IF                                                       02420000
020000     MOVE CE022-TRANS-YR(3:2)         TO CE011-TMST-YY.           02420100
020100     MOVE CE022-TRANS-HR              TO CE011-TMST-HOUR.         02420200
020200     MOVE ':'                         TO CE011-COLEN-1.           02420300
020300     MOVE CE022-TRANS-MI              TO CE011-TMST-MIN.          02420400
020400     MOVE ':'                         TO CE011-COLEN-2.           02420500
020500     MOVE ZERO                        TO CE011-TMST-SEC.          02420600
020600                                                                  02420700
020700     PERFORM 8150-WRITE-DATE-RECORD.                              02420800
020800                                                                  02420900
047300                                                                  02421000
052602 7220-CALL-XLKUT-DOMAIN-PGM.                                      02422000
038406     INITIALIZE XL001-ITEM-COMMAREA.                              02423000
052603     MOVE '7220-SELECT-SKU-BY-SKU'  TO PV-ABEND-PARAGRAPH.        02424000
052604                                                                  02425000
028800     MOVE CE022-ITEM-NBR(1:8)         TO XL001-KEY-SKU.           02426000
052606                                                                  02427000
052607     SET  XL001-BY-NUMERIC-SKU                                    02428000
052608          XL001-SELECT-SKU                                        02429000
052608          XL001-SELECT-SKU-STR                                    02430000
                XL001-SELECT-VND-STYL     TO TRUE.                      02440000
052609                                                                  02450000
052610     CALL XL001-VSM-PGM USING  XL001-ITEM-COMMAREA.               02460000
052611                                                                  02470000
052612     EVALUATE TRUE                                                02480000
052613       WHEN XL001-SKU-SQLCODE = +0                                02490000
052614                                                                  02500000
052614           PERFORM 7230-SELECT-VND-STYL                           02510000
052615                                                                  02520000
052616       WHEN XL001-SKU-SQLCODE = +100                              02530000
052617           MOVE '*** UNKNOWN ***' TO XL001-SKU-DESC               02540000
052618                                                                  02550000
052618       WHEN XL001-SKU-CONTENTION                                  02551000
052620           MOVE '7220-SELECT-SKU-BY-SKU'  TO PV-ABEND-PARAGRAPH   02552000
052621           MOVE 'CONTENTION ABEND ON ROW FROM XLV_SKU'            02553000
052621                                           TO PV-ABEND-OPERATION  02554000
052625           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    02555000
052626           STRING 'SELECT XLKUT001 USING ITEM# - '                02556000
052627                                        PV-ABEND-PULL-SKU         02557000
052628             DELIMITED BY SIZE                                    02558000
052629             INTO PV-DB2-OPERATION-MESSAGE-1                      02559000
062200           MOVE XL001-SKU-SQLCODE TO PV-SQLCODE                   02560000
052626           STRING 'SQLCODE = ' PV-SQLCODE                         02560100
052628             DELIMITED BY SIZE                                    02560200
052629             INTO PV-DB2-OPERATION-MESSAGE-2                      02560300
052634           PERFORM 9900-DB2-ABEND                                 02560400
052618                                                                  02560500
052619       WHEN OTHER                                                 02560600
052620           MOVE '7220-SELECT-SKU-BY-SKU'  TO PV-ABEND-PARAGRAPH   02560700
052621           MOVE 'OTHER ABEND ON ROW FROM XLV_SKU'                 02560800
052621                                           TO PV-ABEND-OPERATION  02560900
052625           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    02561000
052626           STRING 'SELECT XLKUT001 USING ITEM# - '                02561100
052627                                        PV-ABEND-PULL-SKU         02561200
052628             DELIMITED BY SIZE                                    02561300
052629             INTO PV-DB2-OPERATION-MESSAGE-1                      02561400
062200           MOVE XL001-SKU-SQLCODE TO PV-SQLCODE                   02561500
052626           STRING 'SQLCODE = ' PV-SQLCODE                         02561600
052628             DELIMITED BY SIZE                                    02561700
052629             INTO PV-DB2-OPERATION-MESSAGE-2                      02561800
052634           PERFORM 9900-DB2-ABEND                                 02561900
052635     END-EVALUATE.                                                02562000
052636                                                                  02562100
052636 7230-SELECT-VND-STYL.                                            02562200
052636                                                                  02562300
052603     MOVE '7230-SELECT-VND-STYL'          TO PV-ABEND-PARAGRAPH.  02562400
052636                                                                  02562500
052612     EVALUATE TRUE                                                02562600
052613       WHEN XL001-VND-STYL-SQLCODE = +0                           02562700
052614                                                                  02562800
052614           PERFORM 7240-SELECT-SKU-STR                            02562900
052614                                                                  02563000
052616       WHEN XL001-VND-STYL-SQLCODE = +100                         02563100
052618           MOVE SPACES                    TO XL001-DEPT-NBR-3CH   02563200
052618                                             XL001-MAJ-CL-NBR-2CH 02563300
052618                                             XL001-SUB-CL-NBR-2CH 02563400
052618                                                                  02563500
052618       WHEN XL001-VND-STYL-CONTENTION                             02563600
052620           MOVE '7230-SELECT-VND-STYL'    TO PV-ABEND-PARAGRAPH   02563700
052621           MOVE 'SELECT ROW FROM XLV_VND_STYL'                    02563800
                                                TO PV-ABEND-OPERATION   02563900
052625           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    02564000
052626           STRING 'SELECT XLKUT001 USING ITEM# - '                02564100
052627                                        PV-ABEND-PULL-SKU         02564200
052628             DELIMITED BY SIZE                                    02564300
052629             INTO PV-DB2-OPERATION-MESSAGE-1                      02564400
062200           MOVE XL001-VND-STYL-SQLCODE TO PV-SQLCODE              02564500
052626           STRING 'SQLCODE = ' PV-SQLCODE                         02564600
052628             DELIMITED BY SIZE                                    02564700
052629             INTO PV-DB2-OPERATION-MESSAGE-2                      02564800
052634           PERFORM 9900-DB2-ABEND                                 02564900
052618                                                                  02565000
052619       WHEN OTHER                                                 02565100
052620           MOVE '7230-SELECT-VND-STYL'    TO PV-ABEND-PARAGRAPH   02565200
052621           MOVE 'SELECT ROW FROM XLV_VND_STYL'                    02565300
                                                TO PV-ABEND-OPERATION   02565400
052625           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    02565500
052626           STRING 'SELECT XLKUT001 USING ITEM# - '                02565600
052627                                        PV-ABEND-PULL-SKU         02565700
052628             DELIMITED BY SIZE                                    02565800
052629             INTO PV-DB2-OPERATION-MESSAGE-1                      02565900
062200           MOVE XL001-VND-STYL-SQLCODE TO PV-SQLCODE              02566000
052626           STRING 'SQLCODE = ' PV-SQLCODE                         02566100
052628             DELIMITED BY SIZE                                    02566200
052629             INTO PV-DB2-OPERATION-MESSAGE-2                      02566300
052634           PERFORM 9900-DB2-ABEND                                 02566400
052635     END-EVALUATE.                                                02566500
052636                                                                  02566600
052636 7240-SELECT-SKU-STR.                                             02566700
052636                                                                  02566800
052603     MOVE '7240-SELECT-SKU-STR '          TO PV-ABEND-PARAGRAPH.  02566900
052636                                                                  02567000
052612     EVALUATE TRUE                                                02567100
052613       WHEN XL001-SKU-STR-SQLCODE = +0                            02567200
052614                                                                  02567300
052614           CONTINUE                                               02567400
052614                                                                  02567500
052616       WHEN XL001-SKU-STR-SQLCODE = +100                          02567600
052618           MOVE 0                         TO XL001-UNT-RTL-AMT    02567700
052618                                                                  02567800
052618       WHEN XL001-SKU-STR-CONTENTION                              02567900
052620           MOVE '7240-SELECT-SKU-STR'     TO PV-ABEND-PARAGRAPH   02568000
052621           MOVE 'SELECT ROW FROM XLV_SKU_STR'                     02568100
                                                TO PV-ABEND-OPERATION   02568200
052625           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    02568300
052626           STRING 'SELECT XLKUT001 USING ITEM# - '                02568400
052627                                        PV-ABEND-PULL-SKU         02568500
052628             DELIMITED BY SIZE                                    02568600
052629             INTO PV-DB2-OPERATION-MESSAGE-1                      02568700
062200           MOVE XL001-SKU-STR-SQLCODE TO PV-SQLCODE               02568800
052626           STRING 'SQLCODE = ' PV-SQLCODE                         02568900
052628             DELIMITED BY SIZE                                    02569000
052629             INTO PV-DB2-OPERATION-MESSAGE-2                      02569100
052634           PERFORM 9900-DB2-ABEND                                 02569200
052618                                                                  02569300
052619       WHEN OTHER                                                 02569400
052620           MOVE '7240-SELECT-SKU-STR'     TO PV-ABEND-PARAGRAPH   02569500
052621           MOVE 'SELECT ROW FROM XLV_SKU_STR'                     02569600
                                                TO PV-ABEND-OPERATION   02569700
052625           MOVE CE022-ITEM-NBR(1:8)       TO PV-ABEND-PULL-SKU    02569800
052626           STRING 'SELECT XLKUT001 USING ITEM# - '                02569900
052627                                        PV-ABEND-PULL-SKU         02570000
052628             DELIMITED BY SIZE                                    02570100
052629             INTO PV-DB2-OPERATION-MESSAGE-1                      02570200
062200           MOVE XL001-SKU-STR-SQLCODE TO PV-SQLCODE               02570300
052626           STRING 'SQLCODE = ' PV-SQLCODE                         02570400
052628             DELIMITED BY SIZE                                    02570500
052629             INTO PV-DB2-OPERATION-MESSAGE-2                      02570600
052634           PERFORM 9900-DB2-ABEND                                 02570700
052635     END-EVALUATE.                                                02570800
034200                                                                  02570900
034400 7250-SELECT-DATE.                                                02571000
034500     MOVE CE022-LOCATION              TO DK-CNSTK-LOC-ID.         02571100
034600     PERFORM 7260-OPEN-DATE-CURSOR.                               02571200
034700     PERFORM 7300-FETCH-DATE-CURSOR.                              02571300
034800     PERFORM 7400-CLOSE-DATE-CURSOR.                              02571400
034900                                                                  02571500
035000 7260-OPEN-DATE-CURSOR.                                           02571600
035100     EXEC SQL                                                     02571700
035200         OPEN DATE_CSR                                            02571800
035300     END-EXEC.                                                    02571900
035400                                                                  02572000
035500     EVALUATE TRUE                                                02573000
035600         WHEN SQLCODE = +0                                        02574000
035700              CONTINUE                                            02575000
035800         WHEN SQLWARN0 NOT = SPACE                                02576000
035900         WHEN SQLCODE  NOT = +0                                   02577000
036000              MOVE '7260-OPEN-DATE-CURSOR'                        02578000
036100                             TO PV-ABEND-PARAGRAPH                02579000
036200              MOVE 'OPEN DATE  CURSOR'                            02580000
036300                             TO PV-ABEND-OPERATION                02590000
036400              MOVE 'TCEPLIT'   TO PV-ABEND-STRUCTURE-1            02600000
036500              MOVE 'TCEPLST'   TO PV-ABEND-STRUCTURE-2            02610000
036600              MOVE 'TCEPLRQ'   TO PV-ABEND-STRUCTURE-3            02620000
036700              PERFORM 9900-DB2-ABEND                              02630000
036800     END-EVALUATE.                                                02640000
036900                                                                  02650000
037000 7300-FETCH-DATE-CURSOR.                                          02660000
037100     INITIALIZE DCLTCEPLST.                                       02670000
037200                                                                  02680000
037300     PERFORM                                                      02690000
037400         WITH TEST AFTER                                          02700000
037500         VARYING PV-RETRY-COUNT                                   02710000
037600         FROM 1 BY 1                                              02720000
037700         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 02730000
037800            OR  (SQLCODE = +0 OR SQLCODE = +100))                 02740000
037900                                                                  02750000
038000         EXEC SQL                                                 02760000
038100              FETCH DATE_CSR                                      02770000
038200               INTO   :CEPLST-CRE-TMST                            02780000
038300         END-EXEC                                                 02790000
038400                                                                  02800000
038500         EVALUATE TRUE                                            02810000
038600             WHEN SQLCODE = +0                                    02820000
038700                  CONTINUE                                        02830000
038800                  SET PS-RECORD-FOUND    TO TRUE                  02840000
038900             WHEN SQLCODE = +100                                  02850000
039000                  SET PS-NO-RECORD-FOUND TO TRUE                  02860000
039100             WHEN SQLWARN0 NOT = SPACE                            02870000
039200             WHEN SQLCODE  NOT = +0                               02880000
039300                  MOVE '7300-FETCH-DATE-CURSOR'                   02890000
039400                                       TO PV-ABEND-PARAGRAPH      02900000
039500                  MOVE 'FETCH DATE CURSOR'                        02910000
039600                                       TO PV-ABEND-OPERATION      02920000
039700                  MOVE 'TCEPLIT'   TO PV-ABEND-STRUCTURE-1        02930000
039800                  MOVE 'TCEPLST'   TO PV-ABEND-STRUCTURE-2        02940000
039900                  MOVE 'TCEPLRQ'   TO PV-ABEND-STRUCTURE-3        02950000
040000                  MOVE XL001-ITM-NBR TO PV-ITEM-NUMBER            02960000
040100                  MOVE PV-ITEM-MSG TO PV-DB2-OPERATION-MESSAGE-1  02970000
040200                  MOVE DK-CNSTK-LOC-ID  TO PV-LOC-NUMBER          02980000
040300                  MOVE PV-LOC-MSG  TO PV-DB2-OPERATION-MESSAGE-2  02990000
040400                  PERFORM 9900-DB2-ABEND                          03000000
040500         END-EVALUATE                                             03010000
040600                                                                  03020000
040700         IF  PV-RETRY-COUNT > PC-MAX-RETRIES                      03030000
040800             MOVE '7300-FETCH-DATE-CURSOR'                        03040000
040900                                     TO PV-ABEND-PARAGRAPH        03050000
041000             MOVE 'MAX RETRIES EXCEEDED'                          03060000
041100                                     TO PV-ABEND-OPERATION        03070000
041200             PERFORM 9900-DB2-ABEND                               03080000
041300         END-IF                                                   03090000
041400     END-PERFORM.                                                 03100000
041500                                                                  03110000
041600 7400-CLOSE-DATE-CURSOR.                                          03120000
041700                                                                  03130000
041800     EXEC SQL                                                     03140000
041900         CLOSE DATE_CSR                                           03150000
042000     END-EXEC.                                                    03160000
042100                                                                  03170000
042200     EVALUATE TRUE                                                03180000
042300         WHEN SQLCODE = +0                                        03190000
042400              CONTINUE                                            03200000
042500         WHEN SQLWARN0 NOT = SPACE                                03210000
042600         WHEN SQLCODE  NOT = +0                                   03220000
042700              MOVE '7400-CLOSE-DATE-CURSOR'                       03230000
042800                             TO PV-ABEND-PARAGRAPH                03240000
042900              MOVE 'CLOSE DATE  CURSOR'                           03250000
043000                             TO PV-ABEND-OPERATION                03260000
043100              MOVE 'TCEPLIT'   TO PV-ABEND-STRUCTURE-1            03270000
043200              MOVE 'TCEPLST'   TO PV-ABEND-STRUCTURE-2            03280000
043300              MOVE 'TCEPLRQ'   TO PV-ABEND-STRUCTURE-3            03290000
043400              PERFORM 9900-DB2-ABEND                              03300000
043500     END-EVALUATE.                                                03310000
043600                                                                  03320000
043700 7500-SELECT-BYR.                                                 03330000
           MOVE XL001-SUB-CL-NBR-2CH  TO PV-SUB-CLASS-2-3.              03340000
           MOVE PV-SUB-CLASS         TO PV-SUB-CLASS-READ.              03350000
051762                                                                  03360000
051763     EXEC SQL                                                     03370000
051764         SELECT BYR_NBR                                           03380000
051765           INTO                                                   03390000
051766                :MDSEAR-BYR-NBR                                   03400000
051767           FROM TMDSEAR                                           03410000
051768          WHERE DEPT_NBR   = :XL001-DEPT-NBR-3CH                  03420000
051769            AND MAJ_CL_NBR = :XL001-MAJ-CL-NBR-2CH                03430000
051770            AND SUB_CL_NBR = :PV-SUB-CLASS-READ                   03440000
051771            AND MDSELV_CDE = 'SCL'                                03450000
                  AND (CURRENT DATE BETWEEN STRT_DTE AND END_DTE)       03460000
051772     END-EXEC.                                                    03470000
051773                                                                  03480000
051774     EVALUATE TRUE                                                03490000
051775         WHEN SQLCODE = ZERO                                      03500000
051776              CONTINUE                                            03510000
051777         WHEN SQLCODE = +100                                      03520000
051778              MOVE 0               TO MDSEAR-BYR-NBR              03530000
051779         WHEN OTHER                                               03540000
051780              MOVE '7500-SELECT-BYR' TO PV-ABEND-PARAGRAPH        03550000
051782              MOVE 'READ BYR'                                     03560000
033900                                 TO PV-ABEND-OPERATION            03570000
051784              MOVE CE022-ITEM-NBR(1:8) TO PV-FIELD-VALUE          03580000
051785              PERFORM 9900-DB2-ABEND                              03590000
051786     END-EVALUATE.                                                03600000
050800                                                                  03610000
050900 8000-READ-INV-BALANCE-FILE.                                      03620000
051000     READ INV-BALANCE-FILE                                        03630000
051100         INTO CE022-INV-BAL-UPLOAD-RECORD                         03640000
051200     AT END                                                       03650000
051300         SET PS-EOF-INV-BALANCE-FILE  TO TRUE                     03660000
051400     NOT AT END                                                   03670000
051500             ADD 1                 TO PV-READ-COUNT               03680000
051600     END-READ.                                                    03690000
051700                                                                  03700000
051800 8100-WRITE-SKU-RECORD.                                           03710000
051900     WRITE SKU-RECORD FROM CE010-SKU-RECORD                       03720000
052000     ADD 1                            TO PV-WRITE-COUNT.          03730000
051800 8150-WRITE-DATE-RECORD.                                          03740000
051900     WRITE CE-DATE-RECORD FROM CE011-DATE-TIME-RECORD.            03750000
052000     ADD 1                            TO PV-DATE-REC-COUNT.       03760000
051700                                                                  03770000
052100 8200-EDIT-AVAIL-UNITS.                                           03780000
052200     MOVE ZERO                        TO PV-AVAIL-UNITS           03790000
052300     MOVE CE022-AVAIL-UNITS           TO DP010I-UNEDITED-FIELD    03800000
052400     MOVE LENGTH OF CE022-AVAIL-UNITS TO DP010I-MAXIMUM-DIGITS    03810000
052500     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  03820000
052600     SET DP010I-NEGATIVE-ALLOWED      TO TRUE                     03830000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03841001
263627          USING DP010I-NUMERIC-EDIT-AREA                          03842001
052800                                                                  03850000
052900     IF DP010I-ERROR-DETECTED                                     03860000
053000         CONTINUE                                                 03870000
053100     ELSE                                                         03880000
053200         MOVE DP010I-NUMERIC-FIELD    TO PV-AVAIL-UNITS           03890000
053300     END-IF.                                                      03900000
053400                                                                  03910000
053500 8210-EDIT-RECVD-UNITS.                                           03920000
053600     MOVE ZERO                        TO PV-RECVD-UNITS           03930000
053700     MOVE CE022-RECVD-UNITS           TO DP010I-UNEDITED-FIELD    03940000
053800     MOVE LENGTH OF CE022-RECVD-UNITS TO DP010I-MAXIMUM-DIGITS    03950000
053900     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  03960000
054000     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                     03970000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03981001
263627          USING DP010I-NUMERIC-EDIT-AREA                          03982001
054200                                                                  03990000
054300     IF DP010I-ERROR-DETECTED                                     04000000
054400         CONTINUE                                                 04010000
054500     ELSE                                                         04020000
054600         MOVE DP010I-NUMERIC-FIELD    TO PV-RECVD-UNITS           04030000
054700     END-IF.                                                      04040000
054800                                                                  04050000
054900 8220-EDIT-DISTRIB-UNITS.                                         04060000
055000     MOVE ZERO                        TO PV-DISTRIB-UNITS         04070000
055100     MOVE CE022-DISTRIB-UNITS         TO DP010I-UNEDITED-FIELD    04080000
055200     MOVE LENGTH OF CE022-DISTRIB-UNITS TO DP010I-MAXIMUM-DIGITS  04090000
055300     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  04100000
055400     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                     04110000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             04121001
263627          USING DP010I-NUMERIC-EDIT-AREA                          04122001
055600                                                                  04130000
055700     IF DP010I-ERROR-DETECTED                                     04140000
055800         CONTINUE                                                 04150000
055900     ELSE                                                         04160000
056000         MOVE DP010I-NUMERIC-FIELD    TO PV-DISTRIB-UNITS         04170000
056100     END-IF.                                                      04180000
056200                                                                  04190000
056300 8230-EDIT-TOTAL-UNITS.                                           04200000
056400     MOVE ZERO                        TO PV-TOTAL-UNITS           04210000
056500     MOVE CE022-TOTAL-UNITS           TO DP010I-UNEDITED-FIELD    04220000
056600     MOVE LENGTH OF CE022-TOTAL-UNITS TO DP010I-MAXIMUM-DIGITS    04230000
056700     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  04240000
056800     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                     04250000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             04261001
263627          USING DP010I-NUMERIC-EDIT-AREA                          04262001
057000                                                                  04270000
057100     IF DP010I-ERROR-DETECTED                                     04280000
057200         CONTINUE                                                 04290000
057300     ELSE                                                         04300000
057400         MOVE DP010I-NUMERIC-FIELD    TO PV-TOTAL-UNITS           04310000
057500     END-IF.                                                      04320000
057600/                                                                 04330000
057700 9000-END-ROUTINE.                                                04340000
057800                                                                  04350000
057900     CLOSE INV-BALANCE-FILE                                       04360000
058000           CE010-FILE                                             04370000
058000           CE-DATE-FILE.                                          04380000
058200                                                                  04390000
058300     DISPLAY SPACES                                               04400000
058400     MOVE PV-READ-COUNT               TO PV-DISP-NBR              04410000
058500     DISPLAY 'INV BALANCE READ      = ' PV-DISP-NBR.              04420000
058600     MOVE PV-WRITE-COUNT              TO PV-DISP-NBR              04430000
058700     DISPLAY 'CE018 RECORDS WRITTEN = ' PV-DISP-NBR.              04440000
059000/                                                                 04450000
059100 9900-DB2-ABEND.                                                  04460000
059200                                                                  04470000
059300     MOVE SQLCODE TO PV-SQLCODE.                                  04480000
059400     DISPLAY '*** DB2 ERROR '.                                    04490000
059500     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       04500000
059600     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 04510000
059700     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               04520000
059800     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               04530000
059900     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       04540000
060000     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       04550000
060100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       04560000
060200     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             04570000
060300     DISPLAY '* FIELD VALUE * = ' PV-FIELD-VALUE.                 04580000
060400                                                                  04590000
060500     IF PV-ABEND-STRUCTURE-2 > SPACES                             04600000
060600         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          04610000
060700     END-IF.                                                      04620000
060800                                                                  04630000
060900                                                                  04640000
061000     COPY DPPD004.                                                04650000
061100                                                                  04660000
061200     IF SQLCODE NOT = -911                                        04670000
061300         EXEC SQL                                                 04680000
061400              ROLLBACK                                            04690000
061500         END-EXEC                                                 04700000
061600     END-IF.                                                      04710000
061700                                                                  04720000
061800     MOVE +4013                  TO PV-ABEND-CODE.                04730000
061900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04740000
062000                                                                  04750000
