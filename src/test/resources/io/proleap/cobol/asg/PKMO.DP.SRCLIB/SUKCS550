000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    SUKCS550.                                         00040000
000500 AUTHOR.        GERMAN BANDA.                                     00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  FEBRUARY 2000.                                    00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    S550 - TRIP LIST CRITERIA SPECIFICATION                     *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER TO ENTER DATA TO BE USED BY    *00120000
001300*    SUBSEQUENT PROGRAMS TO CREATE A LIST.                       *00130000
001400*----------------------------------------------------------------*00140000
001500*    CHANGES                                                     *        
      *    MADE BY: CHERI PARMLEY                                      *        
      *    DATE:    09/24/2014                                         *        
      *                                                                *        
      *    CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO#    *        
      *    FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *CLP 09/24/2014      *        
      *                                                                *        
001600*----------------------------------------------------------------*        
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968                 
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263968* MAKING THE CALL DYNAMIC VS STATIC.                                      
263968*                                                                         
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099                 
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                                   
263968*---------------------------------------------------------------*         
001500                                                                  00150000
001600                                                                  00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800                                                                  00180000
001900 DATA DIVISION.                                                   00190000
002000                                                                  00200000
002100 WORKING-STORAGE SECTION.                                         00210000
002200                                                                  00220000
002300 01  DK-DB2-KEYS.                                                 00230000
002400     05  DK-OPER-UNT-ID            PIC S9(04) COMP VALUE +0.      00240000
002500     05  DK-FCLTY-ID               PIC S9(04) COMP VALUE +0.      00250000
002600     05  DK-SCAC-ID                PIC  X(04)  VALUE SPACE.       00260000
002700     05  DK-TRIP-ID                PIC S9(09)  VALUE +0 COMP.     00270000
002800     05  DK-TRIP-STATUS            PIC  X(02)  VALUE SPACES.      00280000
002900     05  DK-TRLR-NBR               PIC  X(10)  VALUE SPACE.       00290000
      *CLP 09/24/2014                                                           
003000     05  DK-PO-NBR                 PIC S9(08)  VALUE +0 COMP.     00300000
003100     05  DK-REC-SEQ-NBR            PIC S9(09)  VALUE +0 COMP.     00310000
003200     05  DK-SERIAL-SHIP-CDE        PIC S9(18)V COMP-3.            00320000
003300                                                                  00330000
003400 01  PV-PROGRAM-VARIABLES.                                        00340000
003500     05  PV-LOCATION.                                             00350000
003600         10  PV-DP020-LOCATION       PIC  9(04).                  00360022
003700     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE +0     00370000
003800                                                    COMP SYNC.    00380000
003900     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      00390016
004000                                                    COMP SYNC.    00400016
004100     05  PV-CICS-MSG-AREA                PIC  X(100) VALUE SPACE. 00410016
004200     05  PV-COMMAREA-LENGTH             PIC S9(04)  VALUE +0      00420016
004300                                                    COMP SYNC.    00430016
004400*JPL                                                              00440000
004500     05  PV-SUB1                         PIC S9(4) COMP SYNC.     00450000
004600     05  PV-SUB2                         PIC S9(4) COMP SYNC.     00460000
004700                                                                  00470000
004800     05  PV-INPUT-FIELD                  PIC X(18).               00480000
004900     05  FILLER REDEFINES PV-INPUT-FIELD.                         00490000
005000         10  PV-INPUT-BYTES OCCURS 18 TIMES.                      00500000
005100             15  PV-IN-BYTE              PIC X(01).               00510000
005200                                                                  00520000
005300     05  PV-OUTPUT-FIELD                 PIC X(18).               00530000
005400     05  FILLER REDEFINES PV-OUTPUT-FIELD.                        00540000
005500         10  PV-OUTPUT-BYTE OCCURS 18 TIMES.                      00550000
005600             15  PV-OUT-BYTE             PIC X(01).               00560000
005700     05  PV-DISP-OPER-UNT-ID          PIC ZZZ9.                   00570033
005800     05  PV-DISP-FCLTY-ID             PIC ZZZ9.                   00571033
005900                                                                  00572033
006000                                                                  00573033
006100                                                                  00574033
006200 01  DN-DB2-NULL-INDICATORS.                                      00580000
006300     05  DN-VEH-NBR                 PIC S9(04) COMP VALUE ZEROES. 00590000
006400*                                                                 00600000
006500                                                                  00610000
006600 01  PC-PROGRAM-CONSTANTS.                                        00620000
006700     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'SU550A'.   00630000
006800     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'SUKM550 '. 00640000
006900     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'SUKCS550'. 00650000
007000     05  PC-03                     PIC  X(02)  VALUE  '03'.       00660000
007100     05  PC-DC                     PIC  X(02)  VALUE  'DC'.       00670000
007200     05  PC-1                      PIC  X(04)  VALUE  '   1'.     00680029
007300******************************************************************00690017
007400*   SYSTEM MESSAGES                                              *00700017
007500******************************************************************00710017
007600* 00005 - INVALID VALUE                                          *00720017
007700* 00007 - REQUIRED ENTRY                                         *00730017
007800* 00008 - MUST BE NUMERIC                                        *00740017
007900* 00330 - ENTRY OF A FIELD REQUIRED FOR FUNCTION SELECTED        *00750017
008000* 00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN;IF UNSUCCESSFUL CA*00760017
008100* 00726 - PURCHASE ORDER NOT FOUND                               *00770017
008200* 00743 - TRIP DOES NOT EXIST                                    *00780017
008300* 00955 - WRONG OPERATING UNIT/FACILITY FOR THIS RECEIVER        *00790017
008400* 01245 - PO NUMBER AND RECEIVER REQUIRED                        *00800017
008500* 01551 - SCAC/TRAILER OR TRIP ID ARE REQUIRED FOR USE OF THIS FU*00810017
008600* 03045 - NOT A VALID OPER ID FOR THIS TRIP, VALID OPER ID IS &VA*00820017
008700******************************************************************00830017
008800     05  PC-TSYMSG-NUMBERS.                                       00840017
008900         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.      00850017
009000         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00860017
009100         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00870017
009200         10  PC-TSYMSG-00330       PIC  9(05)  VALUE  00330.      00880017
009300         10  PC-TSYMSG-00551       PIC  9(05)  VALUE  00551.      00890017
009400         10  PC-TSYMSG-00726       PIC  9(05)  VALUE  00726.      00900017
009500         10  PC-TSYMSG-00743       PIC  9(05)  VALUE  00743.      00910017
009600         10  PC-TSYMSG-00955       PIC  9(05)  VALUE  00955.      00920017
009700         10  PC-TSYMSG-01245       PIC  9(05)  VALUE  01245.      00930017
009800         10  PC-TSYMSG-01551       PIC  9(05)  VALUE  01551.      00940017
009900         10  PC-TSYMSG-03045       PIC  9(05)  VALUE  03045.      00950017
010000*                                                                 00960017
010100     05  PC-UNLDG                  PIC  X(02)  VALUE 'UG'.        00970017
010200     05  PC-UNLDD                  PIC  X(02)  VALUE 'UN'.        00980017
010300     05  PC-ARRVD                  PIC  X(02)  VALUE 'AR'.        00990017
010400     05  PC-ENROUTE                PIC  X(02)  VALUE 'EN'.        01000017
010500     05  PC-DEPARTED               PIC  X(02)  VALUE 'DP'.        01010017
010600     05  PC-X                      PIC  X(01)  VALUE  'X'.        01020017
010700     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            01030017
010800                                               COMP-3.            01040017
010900                                                                  01050017
011000 01  PS-PROGRAM-SWITCHES.                                         01060017
011100     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        01070017
011200         88  PS-ERROR                          VALUE  'Y'.        01080017
011300         88  PS-NO-ERROR                       VALUE  'N'.        01090017
011400     05  PS-TRAILER-EXISTS-SW      PIC  X(01)  VALUE  'N'.        01100017
011500         88  PS-TRAILER-EXISTS                 VALUE  'Y'.        01110017
011600         88  PS-TRAILER-DOESNT-EXIST           VALUE  'N'.        01120017
011700     05  PS-TRIP-EXISTS-SW         PIC  X(01)  VALUE  'N'.        01130017
011800         88  PS-TRIP-EXISTS                    VALUE  'Y'.        01140017
011900         88  PS-TRIP-DOESNT-EXIST              VALUE  'N'.        01150017
012000     05  PS-SCAC-EXISTS-SW         PIC  X(01)  VALUE  'N'.        01160017
012100         88  PS-SCAC-EXISTS                    VALUE  'Y'.        01170017
012200         88  PS-SCAC-DOESNT-EXIST              VALUE  'N'.        01180017
012300     05  PS-TRIP-STATUS-EXISTS-SW  PIC  X(01)  VALUE  'N'.        01190017
012400         88  PS-TRIP-STATUS-EXISTS             VALUE  'Y'.        01200017
012500         88  PS-NO-TRIP-STATUS                 VALUE  'N'.        01210017
012600     05  PS-PO-EXISTS-SW           PIC  X(01)  VALUE  'N'.        01220017
012700         88  PS-PO-EXISTS                      VALUE  'Y'.        01230017
012800         88  PS-PO-DOESNT-EXIST                VALUE  'N'.        01240017
012900     05  PS-RECEIVER-EXISTS-SW     PIC  X(01)  VALUE  'N'.        01250017
013000         88  PS-RECEIVER-EXISTS                VALUE  'Y'.        01260017
013100         88  PS-RECEIVER-DOESNT-EXIST          VALUE  'N'.        01270017
013200     05  PS-SHIP-CDE-EXISTS-SW     PIC  X(01)  VALUE  'N'.        01280017
013300         88  PS-SHIP-CDE-EXISTS                VALUE  'Y'.        01290017
013400         88  PS-SHIP-CDE-DOESNT-EXIST          VALUE  'N'.        01300017
013500     05  PS-DEPARTED-CHKD-SW       PIC  X(01)  VALUE  'N'.        01310017
013600         88  PS-DEPARTED-CHKD                  VALUE  'Y'.        01320017
013700         88  PS-DEPARTED-NOT-CHKD              VALUE  'N'.        01330017
013800     05  PS-TRIP-OPER-ERROR-SW     PIC  X(01)  VALUE  'N'.        01340017
013900         88  PS-TRIP-OPER-ERROR-YES            VALUE  'Y'.        01350017
014000         88  PS-TRIP-OPER-ERROR-NO             VALUE  'N'.        01360017
014100     05  PS-VALID-LOC-SW           PIC  X(01)  VALUE  'N'.        01370023
014200         88  PS-VALID-LOC                      VALUE  'Y'.        01380023
014300         88  PS-INVALID-LOC                    VALUE  'N'.        01390023
014400                                                                  01400017
014500 01  PM-PROGRAM-MESSAGES.                                         01410017
014600     05  PM-ABEND-INFO-A.                                         01420017
014700         10  FILLER                PIC X(15)   VALUE              01430017
014800                                   'DP020-SRC-AID: '.             01440017
014900         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      01450017
015000         10  FILLER                PIC X(19)   VALUE              01460017
015100                                   '. DP020-FK-ACTION: '.         01470017
015200         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      01480017
015300         10  FILLER                PIC X(22)   VALUE              01490017
015400                                   '. DP020-FK-DISPN-IND: '.      01500017
015500         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      01510017
015600         10  FILLER                PIC X(01)   VALUE '.'.         01520017
015700         10  FILLER                PIC X(19)   VALUE SPACE.       01530017
015800                                                                  01540017
015900*----------------------------------------------------------------*01560017
016000*    MAP LAYOUT                                                  *01570017
016100*----------------------------------------------------------------*01580017
016200                                                                  01590017
016300     COPY SUKM550.                                                01600017
016400     EJECT                                                        01610017
016500                                                                  01620017
016600***************************************************************** 01630017
016700*   XLWS071 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 01640017
016800*             LOCATION MODULE (XLKUT071)                        * 01650017
016900***************************************************************** 01660017
017000     COPY XLWS071.                                                01670017
017100                                                                  01680017
017200*----------------------------------------------------------------*01690017
017300*    ATTRIBUTE SETTINGS COPYBOOK.                                *01700017
017400*----------------------------------------------------------------*01710017
017500                                                                  01720017
017600     COPY DPWS015.                                                01730017
017700                                                                  01740017
017800*----------------------------------------------------------------*01750017
017900*    FUNCTION KEYS COPYBOOK                                      *01760017
018000*----------------------------------------------------------------*01770017
018100                                                                  01780017
018200     COPY DPWS016.                                                01790017
018300 EJECT                                                            01800017
018400******************************************************************01810017
018500** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01820017
018600** SUB-ROUTINE (DPKUT100).                                      **01830017
018700******************************************************************01840017
018800     COPY DPWS010I.                                               01850017
018900 EJECT                                                            01860017
019000******************************************************************01870017
019100** PARAMETERS FOR CALLING CICS ARCHITECTURE API                 **01880017
019300******************************************************************01900017
019400     COPY DPWS030.                                                01910017
019400     COPY DPWS930.                                                01910017
019500 EJECT                                                            01920017
019600***************************************************************** 01930017
019700*    STANDARD COMMAREA.                                           01940017
019800***************************************************************** 01950017
019900                                                                  01960017
020000     COPY DPWS020.                                                01970017
020100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01980017
020200                                                                  01990017
020300***************************************************************** 02000017
020400*    INTER-APPLICATION COMMAREA.                                  02010017
020500***************************************************************** 02020017
020600                                                                  02030017
020700         10  INTER-APPL-COMM-AREA PIC X(200).                     02040017
020800     COPY SUWS002.                                                02050017
020900     COPY RCWS015.                                                02060017
021000***************************************************************** 02070017
021100*    SPECIFIC COMMMAREA FOR DSKCS601.                             02080017
021200***************************************************************** 02090017
021300         10  ASC-SPECIFIC-COMMAREA.                               02100017
021400             15  ASC-LIST-KEYS.                                   02110017
021500                 20  ASC-KEY-OPER-UNT-ID             PIC S9(04)   02120017
021600                                                     COMP.        02130017
021700                 20  ASC-KEY-FCLTY-ID                PIC S9(04)   02140017
021800                                                     COMP.        02150017
021900                 20  ASC-KEY-TRIP-ID                 PIC S9(09)   02160017
022000                                                     COMP-3.      02170017
022100             15  ASC-OPER-UNT-ID             PIC  X(04).          02180017
022200             15  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID      02190017
022300                                             PIC  Z(04).          02200017
022400             15  ASC-OPER-UNT-ID-9 REDEFINES ASC-OPER-UNT-ID      02210017
022500                                             PIC  9(04).          02220017
022600             15  ASC-FCLTY-NME               PIC  X(25).          02230017
022700             15  ASC-FCLTY-ID                PIC  X(04).          02240017
022800             15  ASC-FCLTY-ID-N REDEFINES ASC-FCLTY-ID            02250017
022900                                             PIC  Z(04).          02260017
023000             15  ASC-SCAC                    PIC  X(04).          02270017
023100             15  ASC-TRAILER                 PIC  X(10).          02280017
023200             15  ASC-TRIP-ID                 PIC  X(09).          02290017
023300             15  ASC-TRIP-ID-N REDEFINES ASC-TRIP-ID              02300017
023400                                             PIC  Z(09).          02310017
023500             15  ASC-STATUS-UG               PIC  X(02).          02320017
023600             15  ASC-STATUS-UN               PIC  X(02).          02330017
023700             15  ASC-STATUS-AR               PIC  X(02).          02340017
023800             15  ASC-STATUS-EN               PIC  X(02).          02350017
023900             15  ASC-STATUS-DP               PIC  X(02).          02360017
      *CLP 09/24/2014                                                           
024000             15  ASC-PO-NBR                  PIC  X(08).          02370017
024100             15  ASC-PO-NBR-N REDEFINES ASC-PO-NBR                02380017
024200                                             PIC  Z(08).          02390017
024300             15  ASC-REC-SEQ-NBR             PIC  X(4).           02400017
024400             15  ASC-REC-SEQ-NBR-N REDEFINES                      02410017
024500                         ASC-REC-SEQ-NBR     PIC  Z(04).          02420017
024600             15  ASC-SERIAL-SHIP-CDE         PIC  X(18).          02430017
024700             15  ASC-SERIAL-SHIP-CDE-N REDEFINES                  02440017
024800                 ASC-SERIAL-SHIP-CDE         PIC  9(18).          02450017
      *CLP 09/24/2014                                                           
024900             15  FILLER                      PIC  X(43).          02460017
025000     EJECT                                                        02470017
025100*----------------------------------------------------------------*02480017
025200*    ABEND PROCESSING COPYBOOK.                                  *02490017
025300*----------------------------------------------------------------*02500017
025400                                                                  02510017
025500     COPY DPWS013.                                                02520017
025600                                                                  02530017
025700*----------------------------------------------------------------*02540017
025800*    DB2 AREA FOR EXTERNAL ENTITY TABLE                          *02550017
025900*----------------------------------------------------------------*02560017
026000                                                                  02570017
026100     EXEC SQL                                                     02580017
026200          INCLUDE TEXTENT                                         02590017
026300     END-EXEC.                                                    02600017
026400                                                                  02610017
026500*----------------------------------------------------------------*02620017
026600*    DB2 AREA FOR TRIP TABLE                                     *02630017
026700*----------------------------------------------------------------*02640017
026800                                                                  02650017
026900     EXEC SQL                                                     02660017
027000          INCLUDE TVHTRIP                                         02670017
027100     END-EXEC.                                                    02680017
027200                                                                  02690017
027300*----------------------------------------------------------------*02700017
027400*    DB2 AREA FOR TRIP STATUS TABLE                              *02710017
027500*----------------------------------------------------------------*02720017
027600                                                                  02730017
027700     EXEC SQL                                                     02740017
027800          INCLUDE TTRIPST                                         02750017
027900     END-EXEC.                                                    02760017
028000                                                                  02770017
028100*----------------------------------------------------------------*02780017
028200*    DB2 AREA FOR SHIP UNIT TABLE                                *02790017
028300*----------------------------------------------------------------*02800017
028400                                                                  02810017
028500     EXEC SQL                                                     02820017
028600          INCLUDE TSHPUNT                                         02830017
028700     END-EXEC.                                                    02840017
028800                                                                  02850017
028900*----------------------------------------------------------------*02860017
029000*    DB2 AREA FOR VEHICLE TABLE                                  *02870017
029100*----------------------------------------------------------------*02880017
029200                                                                  02890017
029300     EXEC SQL                                                     02900017
029400          INCLUDE TVEHICL                                         02910017
029500     END-EXEC.                                                    02920017
029600*----------------------------------------------------------------*02930017
029700*    DB2 AREA FOR SHIPMENT PO TABLE                               02940017
029800*----------------------------------------------------------------*02950017
029900                                                                  02960017
030000     EXEC SQL                                                     02970017
030100          INCLUDE TSHPTPO                                         02980017
030200     END-EXEC.                                                    02990017
030300*----------------------------------------------------------------*03000017
030400*    DB2 AREA FOR RECEIV   TABLE                                  03010017
030500*----------------------------------------------------------------*03020017
030600                                                                  03030017
030700     EXEC SQL                                                     03040017
030800          INCLUDE TRECEIV                                         03050017
030900     END-EXEC.                                                    03060017
031000*----------------------------------------------------------------*03070017
031100                                                                  03080017
031200*  COMMUNICATION AREAS FOR DB2                                    03090017
031300*                                                                 03100017
031400     EXEC SQL                                                     03110017
031500         INCLUDE SQLCA                                            03120017
031600     END-EXEC.                                                    03130017
031700*----------------------------------------------------------------*03140017
031800                                                                  03150017
031900 EJECT                                                            03160017
032000 LINKAGE SECTION.                                                 03170017
032100                                                                  03180017
032200 01  DFHCOMMAREA.                                                 03190017
032300     05  FILLER                         OCCURS  1 TO 4072 TIMES   03200017
032400                                        DEPENDING ON EIBCALEN.    03210017
032500         10  FILLER                     PIC X.                    03220017
032600                                                                  03230017
032700                                                                  03240017
032800 PROCEDURE DIVISION.                                              03250017
032900***************************************************************** 03260017
033000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03270017
033100** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03280017
033200** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03290017
033300**                                                             ** 03300017
033400** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03310017
033500** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03320017
033600***************************************************************** 03330017
033700 0000-MAIN-MODULE.                                                03340017
033800     INITIALIZE DP030-CICS-API-FIELDS.                            03350017
033900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03360017
034000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03370017
034100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03380017
034200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03390017
034300     MOVE LENGTH OF SU550AI        TO DP030-MAP-LENGTH (1).       03400017
034400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03410017
034500     PERFORM 0001-CALL-CICS-ARCH-API.                             03420017
034600*                                                                 03430017
034700     PERFORM 1000-CONTROL-PROCESSING                              03440017
034800*                                                                 03450017
034900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03460017
035000     PERFORM 0001-CALL-CICS-ARCH-API.                             03470017
035100                                                                  03480017
035200 0001-CALL-CICS-ARCH-API.                                         03490017
035300*    CALL 'DPKCS030' USING DFHEIBLK                               03500017
035300     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03500017
035400                           DFHCOMMAREA                            03510017
035500                           DP030-CICS-API-FIELDS                  03520017
035600                           DP020-STANDARD-COMMAREA                03530017
035700                           SU550AI.                               03540017
035800*                                                                 03550017
035900     IF  DP030-RC-CALL-SUCCESSFUL                                 03560017
036000         CONTINUE                                                 03570017
036100     ELSE                                                         03580017
036200         SET DP013-NO-ROLLBACK                                    03590017
036300             DP013-XCTL-DISPLAY-RESTART                           03600017
036400             DP013-CICS-ABEND      TO TRUE                        03610017
036500         MOVE 'BEFORE 0000-MAIN-MODULE'                           03620017
036600                                   TO DP013-PARAGRAPH             03630017
036700*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX03640017
036800*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      03650017
036700         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03640017
036800-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03650017
036900         MOVE DP030-RETURN-CODE                                   03660017
037000                                   TO DP013-MESSAGE-TEXT (3)      03670017
037100         PERFORM DP013-0000-PROCESS-ABEND                         03680017
037200     END-IF.                                                      03690017
037300 EJECT                                                            03700017
037400*----------------------------------------------------------------*03710017
037500*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03720017
037600*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03730017
037700*----------------------------------------------------------------*03740017
037800                                                                  03750017
037900 1000-CONTROL-PROCESSING.                                         03760017
038000                                                                  03770017
038100     EVALUATE TRUE                                                03780017
038200         WHEN DP020-NEXT-ACT-INITIAL                              03790017
038300         WHEN DP020-NEXT-ACT-RETURN                               03800017
038400             INITIALIZE ASC-SPECIFIC-COMMAREA                     03810017
038500             MOVE DP020-LOCATION-NBR TO PV-DP020-LOCATION         03820017
038600             MOVE PV-DP020-LOCATION                               03830021
038700                                 TO ASC-OPER-UNT-ID               03840021
038800                                    ASC-KEY-OPER-UNT-ID           03850021
038900             MOVE 1              TO ASC-FCLTY-ID-N                03860017
039000                                    ASC-KEY-FCLTY-ID              03870017
039100             PERFORM 4000-BUILD-INITIAL-PANEL                     03880017
039200                                                                  03890017
039300                                                                  03900017
039400         WHEN DP020-NEXT-ACT-READ-MAP                             03910017
039500             PERFORM 2000-FKEY-PROCESSING                         03920017
039600                                                                  03930017
039700         WHEN OTHER                                               03940017
039800             SET DP013-LOGIC-ABEND                                03950017
039900                 DP013-NO-ROLLBACK TO TRUE                        03960017
040000             MOVE '1000-CONTROL-PROCESSING'                       03970017
040100                                   TO  DP013-PARAGRAPH            03980017
040200             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03990017
040300                                   TO  DP013-MESSAGE-TEXT(1)      04000017
040400             MOVE DP020-NEXT-APPL-ACTIVITY                        04010017
040500                                   TO DP013-MESSAGE-TEXT(2)       04020017
040600             PERFORM DP013-0000-PROCESS-ABEND                     04030017
040700     END-EVALUATE.                                                04040017
040800                                                                  04050017
040900*----------------------------------------------------------------*04060017
041000* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*04070017
041100* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*04080017
041200* EDITS.                                                         *04090017
041300*----------------------------------------------------------------*04100017
041400                                                                  04110017
041500 2000-FKEY-PROCESSING.                                            04120017
041600                                                                  04130017
041700     EVALUATE TRUE                                                04140017
041800                                                                  04150017
041900         WHEN DP020-SRC-AID = DP016-CLEAR                         04160017
042000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04170017
042100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04180017
042200                                                                  04190017
042300         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04200017
042400             INITIALIZE ASC-SPECIFIC-COMMAREA                     04210017
042500             MOVE DP020-LOCATION-NBR TO PV-DP020-LOCATION         04220017
042600             MOVE PV-DP020-LOCATION                               04230021
042700                                 TO ASC-OPER-UNT-ID               04240021
042800                                    ASC-KEY-OPER-UNT-ID           04250021
042900             MOVE 1              TO ASC-FCLTY-ID-N                04260017
043000                                    ASC-KEY-FCLTY-ID              04270017
043100             PERFORM 4000-BUILD-INITIAL-PANEL                     04280017
043200             PERFORM 3200-RESET-ATTRIBUTES                        04290017
043300                                                                  04300017
043400         WHEN OTHER                                               04310017
043500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04320017
043600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04330017
043700             IF  PS-NO-ERROR                                      04340017
043800                 SET DP030-CONTINUE-GO TO TRUE                    04350017
043900                 PERFORM 2100-CHECK-FUNCTION-KEY                  04360017
044000                 IF  PS-NO-ERROR                                  04370017
044100                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         04380017
044200                 ELSE                                             04390017
044300                     SET DP030-OVERRIDE-GO TO TRUE                04400017
044400                 END-IF                                           04410017
044500             ELSE                                                 04420017
044600                 SET DP030-OVERRIDE-GO TO TRUE                    04430017
044700             END-IF                                               04440017
044800     END-EVALUATE.                                                04450017
044900******************************************************************04460017
045000** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **04470017
045100** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **04480017
045200** FROM THE CICS ARCHITECTURE API.                              **04490017
045300******************************************************************04500017
045400 2100-CHECK-FUNCTION-KEY.                                         04510017
045500     EVALUATE TRUE                                                04520017
045600*************                                                     04530017
045700*F17 TRLRLIST                                                     04540017
045800*************                                                     04550017
045900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04560017
046000             IF PS-DEPARTED-CHKD                                  04570017
046100                 IF PS-TRAILER-EXISTS OR PS-TRIP-EXISTS           04580017
046200                    SET PS-DEPARTED-NOT-CHKD TO TRUE              04590017
046300                    PERFORM 2110-PREPARE-INTER-APPL-COMM          04600017
046400                 ELSE                                             04610017
046500                    INITIALIZE SU002-INTER-APPL-COMMAREA          04620017
046600                        SET PS-ERROR                              04630017
046700                            DP020-MSG-FATAL  TO TRUE              04640017
046800                        MOVE PC-TSYMSG-01551 TO DP020-MSG-NUMBER  04650017
046900                        MOVE DP015-UNP-ALP-BRT-OFF                04660017
047000                                             TO ATRIPA            04670017
047100                                                ASCACA            04680017
047200                                                ATRLRA            04690017
047300                        MOVE DP015-RED       TO ATRIPC            04700017
047400                                                ASCACC            04710017
047500                                                ATRLRC            04720017
047600                        MOVE DP015-REVERSE   TO ATRIPH            04730017
047700                                                ASCACH            04740017
047800                                                ATRLRH            04750017
047900                        MOVE -1              TO ASCACL            04760017
048000                        SET DP030-SET-CURSOR-APPL-1               04770017
048100                                             TO TRUE              04780017
048200                        SET DP030-OVERRIDE-GO TO TRUE             04790017
048300                 END-IF                                           04800017
048400             ELSE                                                 04810017
048500                    PERFORM 2110-PREPARE-INTER-APPL-COMM          04820017
048600             END-IF                                               04830017
048700*************                                                     04840017
048800*F23 PORCVLST                                                     04850017
048900*************                                                     04860017
049000                                                                  04870017
049100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              04880017
049200             IF PS-TRAILER-EXISTS OR PS-TRIP-EXISTS OR            04890017
049300                (PS-PO-EXISTS AND PS-RECEIVER-EXISTS)             04900017
049400                PERFORM 2110-PREPARE-INTER-APPL-COMM              04910017
049500             ELSE                                                 04920017
049600                IF PS-PO-EXISTS OR                                04930017
049700                   PS-RECEIVER-EXISTS                             04940017
049800                     INITIALIZE SU002-INTER-APPL-COMMAREA         04950017
049900                     SET PS-ERROR                                 04960017
050000                         DP020-MSG-FATAL  TO TRUE                 04970017
050100                     MOVE PC-TSYMSG-01245 TO DP020-MSG-NUMBER     04980017
050200                     MOVE DP015-UNP-ALP-BRT-OFF                   04990017
050300                                          TO APOA                 05000017
050400                                             ASEQNBRA             05010017
050500                                                                  05020017
050600                     MOVE DP015-RED       TO APOC                 05030017
050700                                             ASEQNBRC             05040017
050800                                                                  05050017
050900                     MOVE DP015-REVERSE   TO APOH                 05060017
051000                                             ASEQNBRH             05070017
051100                                                                  05080017
051200                     MOVE -1              TO APOL                 05090017
051300                     SET DP030-SET-CURSOR-APPL-1                  05100017
051400                                          TO TRUE                 05110017
051500                     SET DP030-OVERRIDE-GO TO TRUE                05120017
051600                ELSE                                              05130017
051700                     IF PS-SCAC-EXISTS OR                         05140017
051800                        ASC-TRAILER > SPACES                      05150017
051900                        INITIALIZE SU002-INTER-APPL-COMMAREA      05160017
052000                        SET PS-ERROR                              05170017
052100                            DP020-MSG-FATAL  TO TRUE              05180017
052200                        MOVE PC-TSYMSG-01551 TO DP020-MSG-NUMBER  05190017
052300                        MOVE DP015-UNP-ALP-BRT-OFF                05200017
052400                                             TO ATRIPA            05210017
052500                                                ASCACA            05220017
052600                                                ATRLRA            05230017
052700                        MOVE DP015-RED       TO ATRIPC            05240017
052800                                                ASCACC            05250017
052900                                                ATRLRC            05260017
053000                        MOVE DP015-REVERSE   TO ATRIPH            05270017
053100                                                ASCACH            05280017
053200                                                ATRLRH            05290017
053300                        MOVE -1              TO ASCACL            05300017
053400                        SET DP030-SET-CURSOR-APPL-1               05310017
053500                                             TO TRUE              05320017
053600                        SET DP030-OVERRIDE-GO TO TRUE             05330017
053700                     ELSE                                         05340017
053800                        INITIALIZE SU002-INTER-APPL-COMMAREA      05350017
053900                        SET PS-ERROR                              05360017
054000                            DP020-MSG-FATAL  TO TRUE              05370017
054100                        MOVE PC-TSYMSG-00330 TO DP020-MSG-NUMBER  05380017
054200                        MOVE DP015-UNP-ALP-BRT-OFF                05390017
054300                                             TO ATRIPA            05400017
054400                                                ASCACA            05410017
054500                                                ATRLRA            05420017
054600                                                APOA              05430017
054700                                                ASEQNBRA          05440017
054800                        MOVE DP015-RED       TO ATRIPC            05450017
054900                                                ASCACC            05460017
055000                                                ATRLRC            05470017
055100                                                APOC              05480017
055200                                                ASEQNBRC          05490017
055300                        MOVE DP015-REVERSE   TO ATRIPH            05500017
055400                                                ASCACH            05510017
055500                                                ATRLRH            05520017
055600                                                APOH              05530017
055700                                                ASEQNBRH          05540017
055800                        MOVE -1              TO ASCACL            05550017
055900                        SET DP030-SET-CURSOR-APPL-1               05560017
056000                                             TO TRUE              05570017
056100                        SET DP030-OVERRIDE-GO TO TRUE             05580017
056200                     END-IF                                       05590017
056300                END-IF                                            05600017
056400             END-IF                                               05610017
056500*************                                                     05620017
056600*F24 CTNRCLST                                                     05630017
056700*************                                                     05640017
056800         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              05650017
056900             IF ASC-PO-NBR  = SPACES OR ZEROS OR                  05660017
057000                ASC-REC-SEQ-NBR = SPACES OR ZEROS                 05670017
057100                 INITIALIZE SU002-INTER-APPL-COMMAREA             05680017
057200                 SET PS-ERROR                                     05690017
057300                     DP020-MSG-FATAL  TO TRUE                     05700017
057400                 MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER         05710017
057500                 MOVE DP015-UNP-ALP-BRT-OFF                       05720017
057600                                      TO APOA                     05730017
057700                                         ASEQNBRA                 05740017
057800                 MOVE DP015-RED       TO APOC                     05750017
057900                                         ASEQNBRC                 05760017
058000                 MOVE DP015-REVERSE   TO APOH                     05770017
058100                                         ASEQNBRH                 05780017
058200                 MOVE -1              TO APOL                     05790017
058300                 SET DP030-SET-CURSOR-APPL-1                      05800017
058400                                      TO TRUE                     05810017
058500                 SET DP030-OVERRIDE-GO TO TRUE                    05820017
058600             ELSE                                                 05830017
058700                 PERFORM 2110-PREPARE-INTER-APPL-COMM             05840017
058800             END-IF                                               05850017
058900*************                                                     05860017
059000*F22 CTNDTLST -SERIAL-SHIP CDE REQUIRED                           05870017
059100*************                                                     05880017
059200         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              05890017
059300             IF ASC-SERIAL-SHIP-CDE  = SPACES OR ZEROS            05900017
059400                 INITIALIZE SU002-INTER-APPL-COMMAREA             05910017
059500                 SET PS-ERROR                                     05920017
059600                     DP020-MSG-FATAL  TO TRUE                     05930017
059700                 MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER         05940017
059800                 MOVE DP015-UNP-ALP-BRT-OFF                       05950017
059900                                      TO ASERSHPA                 05960017
060000                 MOVE DP015-RED       TO ASERSHPC                 05970017
060100                 MOVE DP015-REVERSE   TO ASERSHPH                 05980017
060200                 MOVE -1              TO ASERSHPL                 05990017
060300                 SET DP030-SET-CURSOR-APPL-1                      06000017
060400                                      TO TRUE                     06010017
060500                 SET DP030-OVERRIDE-GO TO TRUE                    06020017
060600             ELSE                                                 06030017
060700                 PERFORM 2110-PREPARE-INTER-APPL-COMM             06040017
060800             END-IF                                               06050017
060900                                                                  06060017
061000         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              06070017
061100             PERFORM 2115-PREPARE-INTER-APPL-COMM                 06080017
061200                                                                  06090017
061300         WHEN DP020-SRC-AID = DP016-ENTER                         06100017
061400             CONTINUE                                             06110017
061500                                                                  06120017
061600         WHEN OTHER                                               06130017
061700             SET DP013-NO-ROLLBACK                                06140017
061800                 DP013-XCTL-DISPLAY-RESTART                       06150017
061900                 DP013-CICS-ABEND  TO TRUE                        06160017
062000             MOVE '2100-CHECK-FUNCTION-KEY'                       06170017
062100                                   TO DP013-PARAGRAPH             06180017
062200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06190017
062300                                   TO DP013-MESSAGE-TEXT (1)      06200017
062400             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 06210017
062500                                   TO DP013-MESSAGE-TEXT (2)      06220017
062600             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                06230017
062700             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 06240017
062800                                   TO PM-A-FK-ACTION              06250017
062900             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              06260017
063000                                   TO PM-A-FK-DISPN               06270017
063100             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      06280017
063200             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        06290017
063300                                   TO DP013-MESSAGE-TEXT (4)      06300017
063400             PERFORM DP013-0000-PROCESS-ABEND                     06310017
063500     END-EVALUATE.                                                06320017
063600******************************************************************06330017
063700** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **06340017
063800** INTER-APPLICATION COMMAREA.                                  **06350017
063900******************************************************************06360017
064000 2110-PREPARE-INTER-APPL-COMM.                                    06370017
064100     INITIALIZE SU002-INTER-APPL-COMMAREA.                        06380017
064200     MOVE ASC-KEY-OPER-UNT-ID          TO SU002-OPER-UNT-ID.      06390017
064300     MOVE ASC-KEY-FCLTY-ID             TO SU002-FCLTY-ID.         06400017
064400     MOVE ASC-FCLTY-NME                TO SU002-FCLTY-NME.        06410017
064500     MOVE ASC-SCAC                     TO SU002-SCAC.             06420017
064600     MOVE ASC-TRAILER                  TO SU002-TRLR-NBR.         06430017
064700     MOVE ASC-STATUS-UG                TO SU002-STATUS-UG.        06440017
064800     MOVE ASC-STATUS-UN                TO SU002-STATUS-UN.        06450017
064900     MOVE ASC-STATUS-AR                TO SU002-STATUS-AR.        06460017
065000     MOVE ASC-STATUS-EN                TO SU002-STATUS-EN.        06470017
065100     MOVE ASC-STATUS-DP                TO SU002-STATUS-DP.        06480017
065200     MOVE ASC-TRIP-ID                  TO SU002-TRIP-ID.          06490017
065300     MOVE ASC-PO-NBR                   TO SU002-PO-NBR.           06500017
065400     MOVE ASC-REC-SEQ-NBR              TO SU002-REC-SEQ-NBR.      06510017
065500     MOVE ASC-SERIAL-SHIP-CDE-N        TO SU002-SHIPT-UNT-ID.     06520017
065600/                                                                 06530017
065700 2115-PREPARE-INTER-APPL-COMM.                                    06540017
065800     INITIALIZE RC015-INTER-APPL-COMMAREA.                        06550017
065900     MOVE ASC-KEY-OPER-UNT-ID    TO RC015-OPER-UNT-ID.            06560017
066000     MOVE ASC-KEY-FCLTY-ID       TO RC015-FCLTY-ID.               06570017
066100     MOVE ASC-PO-NBR             TO RC015-PO-NBR                  06580017
066200     MOVE ASC-REC-SEQ-NBR        TO RC015-REC-SEQ-NBR.            06590017
066300     MOVE ASC-TRIP-ID            TO RC015-TRIP-ID.                06600017
066400/                                                                 06610017
066500*----------------------------------------------------------------*06620017
066600* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*06630017
066700* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *06640017
066800* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *06650017
066900*----------------------------------------------------------------*06660017
067000                                                                  06670017
067100 2200-MOVE-SCREEN-TO-COMMAREA.                                    06680017
067200                                                                  06690017
067300     IF  AOPERL > ZERO                                            06700017
067400         MOVE AOPERI               TO ASC-OPER-UNT-ID             06710017
067500     ELSE                                                         06720017
067600         IF  AOPERF = DP015-ERASE-EOF                             06730017
067700             MOVE ZERO             TO ASC-OPER-UNT-ID-N           06740017
067800                                      ASC-KEY-OPER-UNT-ID         06750017
067900         END-IF                                                   06760017
068000     END-IF.                                                      06770017
068100                                                                  06780017
068200     IF  AFCLTYL > ZERO                                           06790017
068300         MOVE AFCLTYI              TO ASC-FCLTY-ID                06800017
068400     ELSE                                                         06810017
068500         IF  AFCLTYF = DP015-ERASE-EOF                            06820017
068600             MOVE ZERO             TO ASC-FCLTY-ID-N              06830017
068700                                      ASC-KEY-FCLTY-ID            06840017
068800         END-IF                                                   06850017
068900     END-IF.                                                      06860017
069000                                                                  06870017
069100     IF  ASCACL > ZERO                                            06880017
069200         MOVE ASCACI               TO ASC-SCAC                    06890017
069300     ELSE                                                         06900017
069400         IF  ASCACF = DP015-ERASE-EOF                             06910017
069500             MOVE SPACES           TO ASC-SCAC                    06920017
069600         END-IF                                                   06930017
069700     END-IF.                                                      06940017
069800                                                                  06950017
069900     IF  ATRLRL > ZERO                                            06960017
070000         MOVE ATRLRI               TO ASC-TRAILER                 06970017
070100     ELSE                                                         06980017
070200         IF  ATRLRF = DP015-ERASE-EOF                             06990017
070300             MOVE SPACES           TO ASC-TRAILER                 07000017
070400         END-IF                                                   07010017
070500     END-IF.                                                      07020017
070600                                                                  07030017
070700                                                                  07040017
070800     IF  AUNLDGL > ZERO                                           07050017
070900         IF  AUNLDGI > SPACES                                     07060017
071000             MOVE PC-UNLDG             TO ASC-STATUS-UG           07070017
071100         ELSE                                                     07080017
071200             MOVE SPACES               TO ASC-STATUS-UG           07090017
071300         END-IF                                                   07100017
071400     ELSE                                                         07110017
071500         IF  AUNLDGF = DP015-ERASE-EOF                            07120017
071600             MOVE SPACES           TO ASC-STATUS-UG               07130017
071700         END-IF                                                   07140017
071800     END-IF.                                                      07150017
071900                                                                  07160017
072000     IF  AUNLDDL > ZERO                                           07170017
072100         IF  AUNLDDI > SPACES                                     07180017
072200             MOVE PC-UNLDD             TO ASC-STATUS-UN           07190017
072300         ELSE                                                     07200017
072400             MOVE SPACES               TO ASC-STATUS-UN           07210017
072500         END-IF                                                   07220017
072600     ELSE                                                         07230017
072700         IF  AUNLDDF = DP015-ERASE-EOF                            07240017
072800             MOVE SPACES           TO ASC-STATUS-UN               07250017
072900         END-IF                                                   07260017
073000     END-IF.                                                      07270017
073100                                                                  07280017
073200     IF  AARRVDL > ZERO                                           07290017
073300         IF  AARRVDI > SPACES                                     07300017
073400             MOVE PC-ARRVD             TO ASC-STATUS-AR           07310017
073500         ELSE                                                     07320017
073600             MOVE SPACES               TO ASC-STATUS-AR           07330017
073700     ELSE                                                         07340017
073800         IF  AARRVDF = DP015-ERASE-EOF                            07350017
073900             MOVE SPACES           TO ASC-STATUS-AR               07360017
074000         END-IF                                                   07370017
074100     END-IF.                                                      07380017
074200                                                                  07390017
074300     IF  AENRTEL > ZERO                                           07400017
074400         IF  AENRTEI > SPACES                                     07410017
074500             MOVE PC-ENROUTE           TO ASC-STATUS-EN           07420017
074600         ELSE                                                     07430017
074700             MOVE SPACES               TO ASC-STATUS-EN           07440017
074800     ELSE                                                         07450017
074900         IF  AENRTEF = DP015-ERASE-EOF                            07460017
075000             MOVE SPACES           TO ASC-STATUS-EN               07470017
075100         END-IF                                                   07480017
075200     END-IF.                                                      07490017
075300                                                                  07500017
075400     IF  ADEPRTL > ZERO                                           07510017
075500         IF  ADEPRTI > SPACES                                     07520017
075600             MOVE PC-DEPARTED          TO ASC-STATUS-DP           07530017
075700             SET PS-DEPARTED-CHKD      TO TRUE                    07540017
075800         ELSE                                                     07550017
075900             MOVE SPACES               TO ASC-STATUS-DP           07560017
076000     ELSE                                                         07570017
076100         IF  ADEPRTF = DP015-ERASE-EOF                            07580017
076200             MOVE SPACES           TO ASC-STATUS-DP               07590017
076300         END-IF                                                   07600017
076400     END-IF.                                                      07610017
076500************************************************************      07620017
076600     IF  ATRIPL > ZERO                                            07630017
076700         MOVE ATRIPI               TO ASC-TRIP-ID                 07640017
076800     ELSE                                                         07650017
076900         IF  ATRIPF = DP015-ERASE-EOF                             07660017
077000             MOVE ZERO             TO ASC-TRIP-ID-N               07670017
077100                                      ASC-KEY-TRIP-ID             07680017
077200         END-IF                                                   07690017
077300     END-IF.                                                      07700017
077400                                                                  07710017
077500     IF  APOL   > ZERO                                            07720017
077600         MOVE APOI                 TO ASC-PO-NBR                  07730017
077700     ELSE                                                         07740017
077800         IF  APOF = DP015-ERASE-EOF                               07750017
077900             MOVE ZERO             TO ASC-PO-NBR-N                07760017
078000         END-IF                                                   07770017
078100     END-IF.                                                      07780017
078200                                                                  07790017
078300     IF  ASEQNBRL   > ZERO                                        07800017
078400         MOVE ASEQNBRI             TO ASC-REC-SEQ-NBR             07810017
078500     ELSE                                                         07820017
078600         IF  ASEQNBRF = DP015-ERASE-EOF                           07830017
078700             MOVE ZERO             TO ASC-REC-SEQ-NBR-N           07840017
078800         END-IF                                                   07850017
078900     END-IF.                                                      07860017
079000                                                                  07870017
079100     IF  ASERSHPL   > ZERO                                        07880017
079200         MOVE ASERSHPI             TO ASC-SERIAL-SHIP-CDE         07890017
079300     ELSE                                                         07900017
079400         IF  ASERSHPF = DP015-ERASE-EOF                           07910017
079500             MOVE SPACES           TO ASC-SERIAL-SHIP-CDE         07920017
079600         END-IF                                                   07930017
079700     END-IF.                                                      07940017
079800*----------------------------------------------------------------*07950017
079900* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *07960017
080000* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *07970017
080100* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*07980017
080200* IN THE DESTINATION PROGRAM, NOT HERE.                          *07990017
080300*----------------------------------------------------------------*08000017
080400                                                                  08010017
080500 3000-EDIT-DATA-IN-COMMAREA.                                      08020017
080600     PERFORM 3200-RESET-ATTRIBUTES.                               08030017
080700     PERFORM 3005-EDIT-SERIAL-SHIP-CODE.                          08040017
080800                                                                  08050017
080900     IF  ASC-OPER-UNT-ID NOT = SPACES                             08060017
081000         MOVE ASC-OPER-UNT-ID    TO DP010I-UNEDITED-FIELD         08070017
081100         MOVE LENGTH OF ASC-OPER-UNT-ID                           08080017
081200                                 TO DP010I-MAXIMUM-DIGITS         08090017
081300         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       08100017
081400         SET DP010I-NEGATIVE-NOT-ALLOWED                          08110017
081500                                 TO TRUE                          08120017
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263968              USING DP010I-NUMERIC-EDIT-AREA                              
081700         IF  DP010I-ERROR-DETECTED                                08140017
081800             SET PS-ERROR                                         08150017
081900                 DP020-MSG-FATAL TO TRUE                          08160017
082000             MOVE PC-TSYMSG-00008                                 08170017
082100                                 TO DP020-MSG-NUMBER              08180017
082200             MOVE DP015-UNP-ALP-BRT-OFF                           08190017
082300                                 TO AOPERA                        08200017
082400             MOVE DP015-RED      TO AOPERC                        08210017
082500             MOVE DP015-REVERSE  TO AOPERH                        08220017
082600             MOVE -1             TO AOPERL                        08230017
082700             SET DP030-SET-CURSOR-APPL-1                          08240017
082800                                 TO TRUE                          08250017
082900         ELSE                                                     08260017
083000             MOVE DP010I-NUMERIC-FIELD                            08270017
083100                                 TO ASC-OPER-UNT-ID-N             08280017
083200                                    ASC-KEY-OPER-UNT-ID           08290017
083300                                    DK-OPER-UNT-ID                08300017
083400             MOVE ASC-OPER-UNT-ID                                 08310017
083500                                 TO AOPERO                        08320017
083600             PERFORM 3020-VALIDATE-OPER-UNT-ID                    08330017
083700             IF  PS-INVALID-LOC                                   08340024
083800                 SET PS-ERROR                                     08350017
083900                     DP020-MSG-FATAL     TO TRUE                  08360017
084000                 MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER      08370017
084100                 MOVE DP015-UNP-ALP-BRT-OFF                       08380017
084200                                         TO AOPERA                08390017
084300                 MOVE DP015-RED          TO AOPERC                08400017
084400                 MOVE DP015-REVERSE      TO AOPERH                08410017
084500                 MOVE -1                 TO AOPERL                08420017
084600                 SET DP030-SET-CURSOR-APPL-1                      08430017
084700                                         TO TRUE                  08440017
084800             END-IF                                               08450017
084900         END-IF                                                   08460017
085000     ELSE                                                         08470017
085100         SET PS-ERROR                                             08480017
085200             DP020-MSG-FATAL         TO TRUE                      08490017
085300         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          08500017
085400         MOVE DP015-UNP-ALP-BRT-OFF  TO AOPERA                    08510017
085500         MOVE DP015-RED              TO AOPERC                    08520017
085600         MOVE DP015-REVERSE          TO AOPERH                    08530017
085700         MOVE -1                     TO AOPERL                    08540017
085800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08550017
085900     END-IF.                                                      08560017
086000                                                                  08570017
086100     IF  ASC-FCLTY-ID NOT = SPACES                                08580017
086200         MOVE ASC-FCLTY-ID       TO DP010I-UNEDITED-FIELD         08590017
086300         MOVE LENGTH OF ASC-FCLTY-ID                              08600017
086400                                 TO DP010I-MAXIMUM-DIGITS         08610017
086500         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       08620017
086600         SET DP010I-NEGATIVE-NOT-ALLOWED                          08630017
086700                                 TO TRUE                          08640017
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263968              USING DP010I-NUMERIC-EDIT-AREA                              
086900         IF  DP010I-ERROR-DETECTED                                08660017
087000             SET PS-ERROR                                         08670017
087100                 DP020-MSG-FATAL TO TRUE                          08680017
087200             MOVE PC-TSYMSG-00008                                 08690017
087300                                 TO DP020-MSG-NUMBER              08700017
087400             MOVE DP015-UNP-ALP-BRT-OFF                           08710017
087500                                 TO AFCLTYA                       08720017
087600             MOVE DP015-RED      TO AFCLTYC                       08730017
087700             MOVE DP015-REVERSE  TO AFCLTYH                       08740017
087800             MOVE -1             TO AFCLTYL                       08750017
087900             SET DP030-SET-CURSOR-APPL-1                          08760017
088000                                 TO TRUE                          08770017
088100         ELSE                                                     08780017
088200             MOVE DP010I-NUMERIC-FIELD                            08790017
088300                                 TO ASC-FCLTY-ID-N                08800017
088400                                    ASC-KEY-FCLTY-ID              08810017
088500                                    DK-FCLTY-ID                   08820017
088600             MOVE ASC-FCLTY-ID   TO AFCLTYO                       08830017
088700             IF  ASC-FCLTY-ID NOT = PC-1                          08840029
088800                 SET PS-ERROR                                     08850028
088900                     DP020-MSG-FATAL     TO TRUE                  08860028
089000                 MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER      08870028
089100                 MOVE DP015-UNP-ALP-BRT-OFF                       08880028
089200                                         TO AFCLTYA               08890028
089300                 MOVE DP015-RED          TO AFCLTYC               08900028
089400                 MOVE DP015-REVERSE      TO AFCLTYH               08910028
089500                 MOVE -1                 TO AFCLTYL               08920028
089600                 SET DP030-SET-CURSOR-APPL-1                      08930028
089700                                         TO TRUE                  08940028
089800             ELSE                                                 08950028
089900                 MOVE XL071-LOC-NM       TO ASC-FCLTY-NME         08960025
090000                                            AFDESCO               08970017
090100             END-IF                                               08980028
090200         END-IF                                                   08990017
090300     ELSE                                                         09000017
090400         SET PS-ERROR                                             09010017
090500             DP020-MSG-FATAL         TO TRUE                      09020017
090600         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          09030017
090700         MOVE DP015-UNP-ALP-BRT-OFF  TO AFCLTYA                   09040017
090800         MOVE DP015-RED              TO AFCLTYC                   09050017
090900         MOVE DP015-REVERSE          TO AFCLTYH                   09060017
091000         MOVE -1                     TO AFCLTYL                   09070017
091100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      09080017
091200     END-IF.                                                      09090017
091300                                                                  09100017
091400     IF ASC-REC-SEQ-NBR NOT = SPACES                              09110017
091500         MOVE ASC-REC-SEQ-NBR  TO DP010I-UNEDITED-FIELD           09120017
091600         MOVE LENGTH OF ASC-REC-SEQ-NBR                           09130017
091700                                 TO DP010I-MAXIMUM-DIGITS         09140017
091800         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       09150017
091900         SET DP010I-NEGATIVE-NOT-ALLOWED                          09160017
092000                                 TO TRUE                          09170017
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263968              USING DP010I-NUMERIC-EDIT-AREA                              
092200         IF  DP010I-ERROR-DETECTED                                09190017
092300             SET PS-ERROR                                         09200017
092400                 DP020-MSG-FATAL TO TRUE                          09210017
092500             MOVE PC-TSYMSG-00008                                 09220017
092600                                 TO DP020-MSG-NUMBER              09230017
092700            MOVE DP015-UNP-ALP-BRT-OFF                            09240017
092800                                    TO ASEQNBRA                   09250017
092900            MOVE DP015-RED          TO ASEQNBRC                   09260017
093000            MOVE DP015-REVERSE      TO ASEQNBRH                   09270017
093100            MOVE -1                 TO ASEQNBRL                   09280017
093200             SET DP030-SET-CURSOR-APPL-1                          09290017
093300                                 TO TRUE                          09300017
093400         ELSE                                                     09310017
093500             MOVE DP010I-NUMERIC-FIELD TO ASC-REC-SEQ-NBR-N       09320017
093600                                          DK-REC-SEQ-NBR          09330017
093700             SET PS-RECEIVER-EXISTS       TO TRUE                 09340017
093800         END-IF                                                   09350017
093900     END-IF.                                                      09360017
094000                                                                  09370017
094100     IF  ASC-PO-NBR   NOT = SPACES                                09380017
094200         MOVE ASC-PO-NBR         TO DP010I-UNEDITED-FIELD         09390017
094300         MOVE LENGTH OF ASC-PO-NBR                                09400017
094400                                 TO DP010I-MAXIMUM-DIGITS         09410017
094500         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       09420017
094600         SET DP010I-NEGATIVE-NOT-ALLOWED                          09430017
094700                                 TO TRUE                          09440017
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263968              USING DP010I-NUMERIC-EDIT-AREA                              
094900         IF  DP010I-ERROR-DETECTED                                09460017
095000             SET PS-ERROR                                         09470017
095100                 DP020-MSG-FATAL TO TRUE                          09480017
095200             MOVE PC-TSYMSG-00008                                 09490017
095300                                 TO DP020-MSG-NUMBER              09500017
095400             MOVE DP015-UNP-ALP-BRT-OFF                           09510017
095500                                 TO APOA                          09520017
095600             MOVE DP015-RED      TO APOC                          09530017
095700             MOVE DP015-REVERSE  TO APOH                          09540017
095800             MOVE -1             TO APOL                          09550017
095900             SET DP030-SET-CURSOR-APPL-1                          09560017
096000                                 TO TRUE                          09570017
096100         ELSE                                                     09580017
096200             MOVE DP010I-NUMERIC-FIELD                            09590017
096300                                 TO ASC-PO-NBR-N                  09600017
096400                                    DK-PO-NBR                     09610017
096500             PERFORM 3070-VALIDATE-PO-NBR                         09620017
096600             IF  SQLCODE = +100                                   09630017
096700                 SET PS-ERROR                                     09640017
096800                     DP020-MSG-FATAL TO TRUE                      09650017
096900                 MOVE PC-TSYMSG-00726                             09660017
097000                                     TO DP020-MSG-NUMBER          09670017
097100                 MOVE DP015-UNP-ALP-BRT-OFF                       09680017
097200                                     TO APOA                      09690017
097300                 MOVE DP015-RED      TO APOC                      09700017
097400                 MOVE DP015-REVERSE  TO APOH                      09710017
097500                 MOVE -1             TO APOL                      09720017
097600                 SET DP030-SET-CURSOR-APPL-1                      09730017
097700                                     TO TRUE                      09740017
097800                 MOVE ASC-PO-NBR     TO APOO                      09750017
097900             ELSE                                                 09760017
098000                 IF ASC-KEY-OPER-UNT-ID = RECEIV-CURR-OPER-UNT-ID 09770017
098100                     CONTINUE                                     09780017
098200                 ELSE                                             09790017
098300                     SET PS-ERROR                                 09800017
098400                         DP020-MSG-FATAL TO TRUE                  09810017
098500                     MOVE PC-TSYMSG-00955                         09820017
098600                                         TO DP020-MSG-NUMBER      09830017
098700                     MOVE DP015-UNP-ALP-BRT-OFF                   09840017
098800                                         TO AOPERA                09850017
098900                     MOVE DP015-RED      TO AOPERC                09860017
099000                     MOVE DP015-REVERSE  TO AOPERH                09870017
099100                     MOVE -1             TO AOPERL                09880017
099200                     SET DP030-SET-CURSOR-APPL-1                  09890017
099300                                         TO TRUE                  09900017
099400                 END-IF                                           09910017
099500             END-IF                                               09920017
099600         END-IF                                                   09930017
099700     END-IF.                                                      09940017
099800                                                                  09950017
099900                                                                  09960017
100000                                                                  09970017
100100     IF PS-NO-ERROR                                               09980017
100200         IF ASC-SCAC > SPACES                                     09990017
100300             MOVE ASC-SCAC         TO DK-SCAC-ID                  10000017
100400             PERFORM 3100-VALIDATE-SCAC-CDE                       10010017
100500             IF PS-SCAC-EXISTS                                    10020017
100600                 IF ASC-TRAILER > SPACES                          10030017
100700                     MOVE ASC-TRAILER      TO DK-TRLR-NBR         10040017
100800                     PERFORM 3050-VALIDATE-TRAILER                10050017
100900                     IF PS-TRAILER-EXISTS                         10060017
101000                         PERFORM 3010-GET-TRIP-ID                 10070017
101100                     ELSE                                         10080017
101200                         SET PS-ERROR                             10090017
101300                             DP020-MSG-FATAL  TO TRUE             10100017
101400                         MOVE PC-TSYMSG-00743 TO DP020-MSG-NUMBER 10110017
101500                         MOVE DP015-UNP-ALP-BRT-OFF               10120017
101600                                              TO AOPERA           10130017
101700                                                 ASCACA           10140017
101800                                                 ATRLRA           10150017
101900                                                 ATRIPA           10160017
102000                         MOVE DP015-RED       TO AOPERC           10170017
102100                                                 ASCACC           10180017
102200                                                 ATRLRC           10190017
102300                                                 ATRIPC           10200017
102400                         MOVE DP015-REVERSE   TO AOPERH           10210017
102500                                                 ASCACH           10220017
102600                                                 ATRLRH           10230017
102700                                                 ATRIPH           10240017
102800                         MOVE -1              TO ATRIPL           10250017
102900                         SET DP030-SET-CURSOR-APPL-1              10260017
103000                                              TO TRUE             10270017
103100                     END-IF                                       10280017
103200                 END-IF                                           10290017
103300             ELSE                                                 10300017
103400                 SET PS-ERROR                                     10310017
103500                     DP020-MSG-FATAL  TO TRUE                     10320017
103600                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         10330017
103700                 MOVE DP015-UNP-ALP-BRT-OFF                       10340017
103800                                      TO ASCACA                   10350017
103900                 MOVE DP015-RED       TO ASCACC                   10360017
104000                 MOVE DP015-REVERSE   TO ASCACH                   10370017
104100                 MOVE -1              TO ASCACL                   10380017
104200                 SET DP030-SET-CURSOR-APPL-1                      10390017
104300                                      TO TRUE                     10400017
104400             END-IF                                               10410017
104500         END-IF                                                   10420017
104600     END-IF.                                                      10430017
104700                                                                  10440017
104800     IF  ASC-TRIP-ID NOT = SPACES                                 10450017
104900         MOVE ASC-TRIP-ID        TO DP010I-UNEDITED-FIELD         10460017
105000         MOVE LENGTH OF ASC-TRIP-ID                               10470017
105100                                 TO DP010I-MAXIMUM-DIGITS         10480017
105200         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       10490017
105300         SET DP010I-NEGATIVE-NOT-ALLOWED                          10500017
105400                                 TO TRUE                          10510017
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263968              USING DP010I-NUMERIC-EDIT-AREA                              
105600         IF  DP010I-ERROR-DETECTED                                10530017
105700             SET PS-ERROR                                         10540017
105800                 DP020-MSG-FATAL TO TRUE                          10550017
105900             MOVE PC-TSYMSG-00008                                 10560017
106000                                 TO DP020-MSG-NUMBER              10570017
106100             MOVE DP015-UNP-ALP-BRT-OFF                           10580017
106200                                 TO ATRIPA                        10590017
106300             MOVE DP015-RED      TO ATRIPC                        10600017
106400             MOVE DP015-REVERSE  TO ATRIPH                        10610017
106500             MOVE -1             TO ATRIPL                        10620017
106600             SET DP030-SET-CURSOR-APPL-1                          10630017
106700                                 TO TRUE                          10640017
106800         ELSE                                                     10650017
106900             MOVE DP010I-NUMERIC-FIELD                            10660017
107000                                 TO ASC-TRIP-ID-N                 10670017
107100                                    ASC-KEY-TRIP-ID               10680017
107200                                    DK-TRIP-ID                    10690017
107300             MOVE ASC-TRIP-ID    TO ATRIPO                        10700017
107400                                                                  10710017
107500             PERFORM 3040-VALIDATE-TRIP                           10720017
107600             IF PS-TRIP-EXISTS                                    10730017
107700                 PERFORM 3045-VALIDATE-TRIP-TO-OPER               10740017
107800                 IF PS-TRIP-OPER-ERROR-YES                        10750017
107900                    SET PS-ERROR                                  10760017
108000                        DP020-MSG-FATAL     TO TRUE               10770017
108100                    MOVE PC-TSYMSG-03045    TO DP020-MSG-NUMBER   10780017
108200                    MOVE TRIPST-OPER-UNT-ID                       10790017
108300                                            TO DP020-MSG-TEXT     10800017
108400                    MOVE DP015-UNP-ALP-BRT-OFF                    10810017
108500                                            TO ATRIPA             10820017
108600                    MOVE DP015-RED          TO ATRIPC             10830017
108700                    MOVE DP015-REVERSE      TO ATRIPH             10840017
108800                    MOVE -1                 TO ATRIPL             10850017
108900                    SET DP030-SET-CURSOR-APPL-1                   10860017
109000                                            TO TRUE               10870017
109100                    MOVE ZERO               TO ASC-TRIP-ID-N      10880017
109200                                               ASC-KEY-TRIP-ID    10890017
109300                 END-IF                                           10900017
109400             ELSE                                                 10910017
109500                 SET PS-ERROR                                     10920017
109600                     DP020-MSG-FATAL     TO TRUE                  10930017
109700                 MOVE PC-TSYMSG-00743    TO DP020-MSG-NUMBER      10940017
109800                 MOVE DP015-UNP-ALP-BRT-OFF                       10950017
109900                                         TO ATRIPA                10960017
110000                 MOVE DP015-RED          TO ATRIPC                10970017
110100                 MOVE DP015-REVERSE      TO ATRIPH                10980017
110200                 MOVE -1                 TO ATRIPL                10990017
110300                 SET DP030-SET-CURSOR-APPL-1                      11000017
110400                                         TO TRUE                  11010017
110500                 MOVE ZERO               TO ASC-TRIP-ID-N         11020017
110600                                            ASC-KEY-TRIP-ID       11030017
110700                                                                  11040017
110800             END-IF                                               11050017
110900         END-IF                                                   11060017
111000     END-IF.                                                      11070017
111100                                                                  11080017
111200*JPL-------------------------------------------------------------*11090017
111300 3005-EDIT-SERIAL-SHIP-CODE.                                      11100017
111400                                                                  11110017
111500     MOVE ASC-SERIAL-SHIP-CDE TO PV-INPUT-FIELD.                  11120017
111600     MOVE SPACES              TO PV-OUTPUT-FIELD.                 11130017
111700     MOVE +18                 TO PV-SUB2.                         11140017
111800                                                                  11150017
111900     PERFORM                                                      11160017
112000       VARYING PV-SUB1 FROM 18 BY -1                              11170017
112100         UNTIL PV-SUB1 = ZERO OR PS-ERROR                         11180017
112200                                                                  11190017
112300         IF PV-IN-BYTE (PV-SUB1) > SPACES                         11200017
112400             IF PV-IN-BYTE (PV-SUB1) NUMERIC                      11210017
112500                 MOVE PV-IN-BYTE (PV-SUB1)                        11220017
112600                   TO PV-OUT-BYTE (PV-SUB2)                       11230017
112700                 SUBTRACT 1 FROM PV-SUB2                          11240017
112800             ELSE                                                 11250017
112900                 SET PS-ERROR                                     11260017
113000                     DP020-MSG-FATAL         TO TRUE              11270017
113100                 MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER  11280017
113200                 MOVE DP015-UNP-ALP-BRT-OFF  TO ASERSHPA          11290017
113300                 MOVE DP015-RED              TO ASERSHPC          11300017
113400                 MOVE DP015-REVERSE          TO ASERSHPH          11310017
113500                 MOVE -1                     TO ASERSHPL          11320017
113600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              11330017
113700              END-IF                                              11340017
113800         END-IF                                                   11350017
113900                                                                  11360017
114000     END-PERFORM.                                                 11370017
114100                                                                  11380017
114200     IF PS-NO-ERROR                                               11390017
114300         INSPECT PV-OUTPUT-FIELD                                  11400017
114400           REPLACING ALL SPACES BY ZEROES                         11410017
114500                                                                  11420017
114600         MOVE PV-OUTPUT-FIELD TO ASC-SERIAL-SHIP-CDE-N            11430017
114700     END-IF.                                                      11440017
114800                                                                  11450017
114900******************************************************************11460017
115000******************************************************************11470017
115100 3010-GET-TRIP-ID.                                                11480017
115200                                                                  11490017
115300     MOVE DK-OPER-UNT-ID              TO PV-DISP-OPER-UNT-ID      11491033
115400     MOVE DK-FCLTY-ID                 TO PV-DISP-FCLTY-ID         11492033
115500                                                                  11493033
115600     PERFORM                                                      11500017
115700         WITH TEST AFTER                                          11510017
115800         VARYING PV-RETRY-COUNTER                                 11520017
115900         FROM 1 BY 1                                              11530017
116000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11540017
116100             OR (SQLCODE = +0)                                    11550017
116200             OR (SQLCODE = +100)                                  11560017
116300             OR (SQLCODE = -305))                                 11570017
116400                                                                  11580017
116500         EXEC SQL                                                 11590017
116600              SELECT DISTINCT                                     11600017
116700                     B.STATUS_DTE                                 11610017
116800                   , B.TRIP_ID                                    11620017
116900                INTO :TRIPST-STATUS-DTE                           11630017
117000                   , :TRIPST-TRIP-ID                              11640017
117100              FROM   TVHTRIP A                                    11650017
117200                    ,TTRIPST B                                    11660017
117300                    ,TVEHICL C                                    11670017
117400              WHERE A.OWNER_SCAC_ID = :DK-SCAC-ID                 11680017
117500                AND A.VEH_NBR       = :DK-TRLR-NBR                11690017
117600                AND B.OPER_UNT_ID   = :DK-OPER-UNT-ID             11700017
117700                AND B.FCLTY_ID      = :DK-FCLTY-ID                11710017
117800                AND A.TRIP_ID = B.TRIP_ID                         11720017
117900                AND B.TRIP_ID = C.CURR_TRIP_ID                    11730017
118000                AND B.STATUS_DTE =                                11740017
118100                      (SELECT MAX(D.STATUS_DTE)                   11750017
118200                         FROM TTRIPST D                           11760017
118300                        WHERE D.TRIP_ID       = A.TRIP_ID)        11770017
118400         END-EXEC                                                 11780017
118500                                                                  11790017
118600         EVALUATE TRUE                                            11800017
118700             WHEN SQLCODE = +0                                    11810017
118800                     MOVE TRIPST-TRIP-ID TO ASC-TRIP-ID           11820017
118900                                                                  11830017
119000             WHEN SQLCODE = -305                                  11840017
119100             WHEN SQLCODE = +100                                  11850017
119200             WHEN SQLCODE = -904                                  11860017
119300             WHEN SQLCODE = -913                                  11870017
119400                  CONTINUE                                        11880017
119500                                                                  11890017
119600             WHEN SQLWARN0 NOT = SPACES                           11900017
119700             WHEN SQLCODE < +0                                    11910017
119800             WHEN SQLCODE > +0                                    11920017
119900                  MOVE '3010-GET-TRIP-ID'                         11930017
120000                                  TO DP013-PARAGRAPH              11940017
120100                  MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'           11950017
120200                                  TO DP013-MESSAGE-TEXT (1)       11960017
120300                                                                          
120400                 PERFORM 3010X-DISP-TRIP-KEYS                             
120500                                                                          
120600                  MOVE SQLCA      TO DP013-SQLCA                  11970017
120700                  MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)     11980017
120800                  MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)     11990017
120900                  MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (3)     12000017
121000                  SET DP013-DB2-ABEND                             12010017
121100                      DP013-XCTL-DISPLAY-RESTART                  12020017
121200                                  TO TRUE                         12030017
121300                  PERFORM DP013-0000-PROCESS-ABEND                12040017
121400         END-EVALUATE                                             12050017
121500     END-PERFORM.                                                 12060017
121600                                                                  12070017
121700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    12080017
121800         SQLCODE NOT = +0                                         12090017
121900         MOVE '3010-GET-TRIP-ID'                                  12100017
122000                                  TO DP013-PARAGRAPH              12110017
122100         MOVE 'MAX RETRIES EXCEEDED ON SELECT TVHTRIP'            12120017
122200                                  TO DP013-MESSAGE-TEXT (1)       12130017
122300         PERFORM 3010X-DISP-TRIP-KEYS                                     
122400         MOVE SQLCA               TO DP013-SQLCA                  12140017
122500         MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1)     12150017
122600         MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (2)     12160017
122700         MOVE 'TVEHICL '          TO DP013-DB2-TABLE-NAME (3)     12170017
122800         SET DP013-DB2-ABEND                                      12180017
122900             DP013-XCTL-DISPLAY-RESTART                           12190017
123000                                  TO TRUE                         12200017
123100         PERFORM DP013-0000-PROCESS-ABEND                         12210017
123200     END-IF.                                                      12220017
123300                                                                  12230017
123400     IF  SQLCODE = -305                                           12240017
123500      OR SQLCODE = +100                                           12250017
123600         PERFORM                                                  12260017
123700             WITH TEST AFTER                                      12270017
123800             VARYING PV-RETRY-COUNTER                             12280017
123900             FROM 1 BY 1                                          12290017
124000             UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)           12300017
124100                 OR (SQLCODE = +0)                                12310017
124200                 OR (SQLCODE = -305))                             12320017
124300                                                                  12330017
124400             EXEC SQL                                             12340017
124500                  SELECT DISTINCT                                 12350017
124600                         B.STATUS_DTE                             12360017
124700                       , B.TRIP_ID                                12370017
124800                    INTO :TRIPST-STATUS-DTE                       12380017
124900                       , :TRIPST-TRIP-ID                          12390017
125000                  FROM   TVHTRIP A                                12400017
125100                        ,TTRIPST B                                12410017
125200                  WHERE A.OWNER_SCAC_ID = :DK-SCAC-ID             12420017
125300                    AND A.VEH_NBR       = :DK-TRLR-NBR            12430017
125400                    AND B.OPER_UNT_ID   = :DK-OPER-UNT-ID         12440017
125500                    AND B.FCLTY_ID      = :DK-FCLTY-ID            12450017
125600                    AND A.TRIP_ID = B.TRIP_ID                     12460017
125700                    AND B.STATUS_TME =                            12470017
125800                       (SELECT MAX(F.STATUS_TME)                  12480017
125900                        FROM   TVHTRIP E                          12490017
126000                              ,TTRIPST F                          12500017
126100                        WHERE E.OWNER_SCAC_ID = :DK-SCAC-ID       12510017
126200                          AND E.VEH_NBR       = :DK-TRLR-NBR      12520017
126300                          AND F.OPER_UNT_ID   = :DK-OPER-UNT-ID   12530017
126400                          AND F.FCLTY_ID      = :DK-FCLTY-ID      12540017
126500                          AND E.TRIP_ID       = F.TRIP_ID         12550017
126600                          AND F.STATUS_DTE =                      12560017
126700                       (SELECT MAX(D.STATUS_DTE)                  12570017
126800                        FROM   TVHTRIP C                          12580017
126900                              ,TTRIPST D                          12590017
127000                        WHERE C.OWNER_SCAC_ID = :DK-SCAC-ID       12600017
127100                          AND C.VEH_NBR       = :DK-TRLR-NBR      12610017
127200                          AND D.OPER_UNT_ID   = :DK-OPER-UNT-ID   12620017
127300                          AND D.FCLTY_ID      = :DK-FCLTY-ID      12630017
127400                          AND C.TRIP_ID       = D.TRIP_ID))       12640017
127500             END-EXEC                                             12650017
127600                                                                  12660017
127700             EVALUATE TRUE                                        12670017
127800                 WHEN SQLCODE = -305                              12680017
127900                 WHEN SQLCODE = +100                              12690017
128000                     SET PS-TRIP-DOESNT-EXIST                     12700017
128100                                     TO TRUE                      12710017
128200                 WHEN SQLCODE = +0                                12720017
128300                      MOVE TRIPST-TRIP-ID TO ASC-TRIP-ID          12730017
128400                 WHEN SQLWARN0 NOT = SPACES                       12740017
128500                 WHEN SQLCODE < +0                                12750017
128600                 WHEN SQLCODE > +0                                12760017
128700                      MOVE '3010-GET-TRIP-ID-2'                   12770033
128800                                      TO DP013-PARAGRAPH          12780017
128900                      MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'       12790017
129000                                      TO DP013-MESSAGE-TEXT (1)   12800017
129100                      PERFORM 3010X-DISP-TRIP-KEYS                        
129200                      MOVE SQLCA      TO DP013-SQLCA              12810017
129300                      MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1) 12820017
129400                      MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2) 12830017
129500                      SET DP013-DB2-ABEND                         12840017
129600                          DP013-XCTL-DISPLAY-RESTART              12850017
129700                                      TO TRUE                     12860017
129800                      PERFORM DP013-0000-PROCESS-ABEND            12870017
129900             END-EVALUATE                                         12880017
130000         END-PERFORM                                              12890017
130100                                                                  12900017
130200         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                12910017
130300             SQLCODE NOT = +0                                     12920017
130400             MOVE '3010-GET-TRIP-ID-2'                            12930033
130500                                      TO DP013-PARAGRAPH          12940017
130600             MOVE 'MAX RETRIES EXCEEDED ON SELECT TVHTRIP'        12950017
130700                                      TO DP013-MESSAGE-TEXT (1)   12960017
130800             PERFORM 3010X-DISP-TRIP-KEYS                                 
130900             MOVE SQLCA               TO DP013-SQLCA              12970017
131000             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1) 12980017
131100             MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (2) 12990017
131200             SET DP013-DB2-ABEND                                  13000017
131300                 DP013-XCTL-DISPLAY-RESTART                       13010017
131400                                      TO TRUE                     13020017
131500             PERFORM DP013-0000-PROCESS-ABEND                     13030017
131600         END-IF                                                   13040017
131700     END-IF.                                                      13050017
131800                                                                  13060017
131900 3010X-DISP-TRIP-KEYS.                                                    
132000                                                                          
132100     STRING DK-SCAC-ID ' / '                                              
132200            DK-TRLR-NBR ' / '                                             
132300            PV-DISP-OPER-UNT-ID  ' / '                                    
132400            PV-DISP-FCLTY-ID DELIMITED BY SIZE INTO                       
132500              DP013-MESSAGE-TEXT (2).                                     
132600                                                                          
132700*----------------------------------------------------------------*13070017
132800*  CHECK THE OPER UNIT TABLE TO VERIFY THE OPER UNIT             *13080017
132900*  ENTERED ON THE MAP IS VALID.                                  *13090017
133000*----------------------------------------------------------------*13100017
133100* LOCATION HIERARCHY DOMAIN TABLE XLT00010                        13110032
133200                                                                  13120017
133300 3020-VALIDATE-OPER-UNT-ID.                                       13130017
133400                                                                  13140017
133500     INITIALIZE XL071-COMMAREA-REC.                               13150017
133600     MOVE ASC-OPER-UNT-ID  TO XL071-LOCATION-NUMBER.              13160017
133700                                                                  13170017
133800     CALL XL071-LOCATION-MODULE USING                             13180017
133900                                    DFHEIBLK                      13190017
134000                                    XL071-COMMAREA                13200017
134100                                    XL071-COMMAREA-REC.           13210017
134200                                                                  13220017
134300     EVALUATE TRUE                                                13230017
134400         WHEN XL071-NO-ERRORS                                     13240017
134500              CONTINUE                                            13250017
134600         WHEN XL071-LOC-NOT-FOUND                                 13260030
134700         WHEN XL071-DC-ASGMT-NOT-FND                              13270030
134800              SET PS-INVALID-LOC TO TRUE                          13280030
134900         WHEN OTHER                                               13290017
135000              INITIALIZE PV-CICS-MSG-AREA                         13300017
135100              STRING ' SUKCS550 - CALL XLKUT071 -'                13310031
135200                     ' SQLCODE=' XL071-SQLCODE                    13320017
135300                     ' TABLE='   XL071-DB2-TABLE                  13330017
135400                                              DELIMITED BY SIZE   13340017
135500                                         INTO PV-CICS-MSG-AREA    13350017
135600              MOVE LENGTH OF PV-CICS-MSG-AREA                     13360017
135700                                        TO PV-COMMAREA-LENGTH     13370017
135800              EXEC CICS                                           13380017
135900                   WRITEQ TD                                      13390017
136000                    QUEUE  ('CSSL')                               13400017
136100                     FROM  (PV-CICS-MSG-AREA)                     13410017
136200                   LENGTH  (PV-COMMAREA-LENGTH)                   13420017
136300                     RESP  (PV-CICS-RESPONSE)                     13430017
136400              END-EXEC                                            13440017
136500              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              13450017
136600              PERFORM 9900-SOFT-ABORT                             13460017
136700     END-EVALUATE.                                                13470017
136800                                                                  13480017
136900     IF XL071-LOC-TYP-CDE = 'DC'                                  13490023
137000        SET PS-VALID-LOC            TO TRUE                       13500023
137100     ELSE                                                         13510023
137200        SET PS-INVALID-LOC          TO TRUE                       13520023
137300     END-IF.                                                      13530023
137400                                                                  13540017
137500                                                                  13550017
137600******************************************************************13560017
137700*CHECK THE TRIP TABLE TO VERIFY THE TRIP ENTERED ON THE MAP IS ***13570017
137800*VALID                                                         ***13580017
137900******************************************************************13590017
138000 3040-VALIDATE-TRIP.                                              13600017
138100                                                                  13610017
138200     EXEC SQL                                                     13620017
138300          SELECT  TRIP_ID                                         13630017
138400               ,  OWNER_SCAC_ID                                   13640017
138500               ,  VEH_NBR                                         13650017
138600            INTO :TRIPST-TRIP-ID                                  13660017
138700               , :VHTRIP-OWNER-SCAC-ID                            13670017
138800               , :VHTRIP-VEH-NBR :DN-VEH-NBR                      13680017
138900          FROM   TVHTRIP                                          13690017
139000          WHERE  TRIP_ID        = :DK-TRIP-ID                     13700017
139100     END-EXEC.                                                    13710017
139200                                                                  13720017
139300     EVALUATE TRUE                                                13730017
139400         WHEN SQLCODE = +0                                        13740017
139500             SET PS-TRIP-EXISTS TO TRUE                           13750017
139600             MOVE VHTRIP-OWNER-SCAC-ID TO ASC-SCAC                13760017
139700             MOVE ASC-SCAC             TO ASCACO                  13770017
139800             IF DN-VEH-NBR = -1                                   13780017
139900                MOVE SPACES            TO ASC-TRAILER             13790017
140000             ELSE                                                 13800017
140100                MOVE VHTRIP-VEH-NBR    TO ASC-TRAILER             13810017
140200             END-IF                                               13820017
140300             MOVE ASC-TRAILER          TO ATRLRO                  13830017
140400         WHEN SQLCODE = +100                                      13840017
140500             CONTINUE                                             13850017
140600                                                                  13860017
140700         WHEN SQLWARN0 NOT = SPACES                               13870017
140800         WHEN SQLCODE < +0                                        13880017
140900         WHEN SQLCODE > +0                                        13890017
141000              MOVE '3040-VALIDATE-TRIP'                           13900017
141100                              TO DP013-PARAGRAPH                  13910017
141200              MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'               13920017
141300                              TO DP013-MESSAGE-TEXT (1)           13930017
141400              MOVE DK-TRIP-ID TO DP013-MESSAGE-TEXT (2)           13940017
141500              MOVE SQLCA      TO DP013-SQLCA                      13950017
141600              MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)         13960017
141700              MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)         13970017
141800              SET DP013-DB2-ABEND                                 13980017
141900                  DP013-XCTL-DISPLAY-RESTART                      13990017
142000                              TO TRUE                             14000017
142100              PERFORM DP013-0000-PROCESS-ABEND                    14010017
142200     END-EVALUATE.                                                14020017
142300                                                                  14030017
142400*----------------------------------------------------------------*14040017
142500******************************************************************14050017
142600*CHECK THE TRIP ENTERED  IS FOR THE OPER ID ENTERED            ***14060017
142700******************************************************************14070017
142800 3045-VALIDATE-TRIP-TO-OPER.                                      14080017
142900                                                                  14090017
143000     EXEC SQL                                                     14100017
143100         SELECT DISTINCT                                          14110017
143200                B.OPER_UNT_ID                                     14120017
143300         INTO   :TRIPST-OPER-UNT-ID                               14130017
143400         FROM   TVHTRIP A                                         14140017
143500               ,TTRIPST B                                         14150017
143600         WHERE A.TRIP_ID = :DK-TRIP-ID                            14160017
143700           AND A.TRIP_ID = B.TRIP_ID                              14170017
143800           AND B.STATUS_DTE =                                     14180017
143900                 (SELECT MAX(D.STATUS_DTE)                        14190017
144000                    FROM TTRIPST D                                14200017
144100                   WHERE D.TRIP_ID       = A.TRIP_ID)             14210017
144200     END-EXEC.                                                    14220017
144300                                                                  14230017
144400     EVALUATE TRUE                                                14240017
144500         WHEN SQLCODE = +0                                        14250017
144600              IF ASC-OPER-UNT-ID-9 = TRIPST-OPER-UNT-ID           14260017
144700                  SET PS-TRIP-OPER-ERROR-NO  TO TRUE              14270017
144800              ELSE                                                14280017
144900                  SET PS-TRIP-OPER-ERROR-YES TO TRUE              14290017
145000              END-IF                                              14300017
145100         WHEN SQLCODE = +100                                      14310017
145200             CONTINUE                                             14320017
145300                                                                  14330017
145400         WHEN SQLWARN0 NOT = SPACES                               14340017
145500         WHEN SQLCODE < +0                                        14350017
145600         WHEN SQLCODE > +0                                        14360017
145700              MOVE '3040-VALIDATE-TRIP'                           14370017
145800                              TO DP013-PARAGRAPH                  14380017
145900              MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'               14390017
146000                              TO DP013-MESSAGE-TEXT (1)           14400017
146100              MOVE DK-TRIP-ID TO DP013-MESSAGE-TEXT (2)           14410017
146200              MOVE SQLCA      TO DP013-SQLCA                      14420017
146300              MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)         14430017
146400              MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)         14440017
146500              SET DP013-DB2-ABEND                                 14450017
146600                  DP013-XCTL-DISPLAY-RESTART                      14460017
146700                              TO TRUE                             14470017
146800              PERFORM DP013-0000-PROCESS-ABEND                    14480017
146900     END-EVALUATE.                                                14490017
147000                                                                  14500017
147100*----------------------------------------------------------------*14510017
147200*  CHECK THE VEHICLE TRIP TABLE AND TRIP STATUS TABLE TO VERIFY  *14520017
147300*  THE TRAILER ENTERED ON THE MAP IS VALID                       *14530017
147400*----------------------------------------------------------------*14540017
147500 3050-VALIDATE-TRAILER.                                           14550017
147600                                                                  14560017
147700     EXEC SQL                                                     14570017
147800          SELECT B.TRIP_ID                                        14580017
147900            INTO :TRIPST-TRIP-ID                                  14590017
148000          FROM   TVHTRIP A                                        14600017
148100                ,TTRIPST B                                        14610017
148200          WHERE A.OWNER_SCAC_ID = :DK-SCAC-ID                     14620017
148300            AND A.VEH_NBR       = :DK-TRLR-NBR                    14630017
148400            AND B.OPER_UNT_ID   = :DK-OPER-UNT-ID                 14640017
148500            AND B.FCLTY_ID      = :DK-FCLTY-ID                    14650017
148600            AND A.TRIP_ID = B.TRIP_ID                             14660017
148700     END-EXEC.                                                    14670017
148800                                                                  14680017
148900     EVALUATE TRUE                                                14690017
149000         WHEN SQLCODE = +0                                        14700017
149100         WHEN SQLCODE = -811                                      14710017
149200             SET PS-TRAILER-EXISTS TO TRUE                        14720017
149300                                                                  14730017
149400         WHEN SQLCODE = +100                                      14740017
149500              CONTINUE                                            14750017
149600                                                                  14760017
149700         WHEN SQLWARN0 NOT = SPACES                               14770017
149800         WHEN SQLCODE < +0                                        14780017
149900         WHEN SQLCODE > +0                                        14790017
150000              MOVE '3050-VALIDATE-TRAILER'                        14800017
150100                              TO DP013-PARAGRAPH                  14810017
150200              MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'               14820017
150300                              TO DP013-MESSAGE-TEXT (1)           14830017
150400              MOVE SQLCA      TO DP013-SQLCA                      14840017
150500              MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)         14850017
150600              MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)         14860017
150700              MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (3)         14870017
150800              SET DP013-DB2-ABEND                                 14880017
150900                  DP013-XCTL-DISPLAY-RESTART                      14890017
151000                              TO TRUE                             14900017
151100              PERFORM DP013-0000-PROCESS-ABEND                    14910017
151200     END-EVALUATE.                                                14920017
151300                                                                  14930017
151400*----------------------------------------------------------------*14940017
151500*  CHECK THE EXTERNAL ENTERPRISE TABLE TO VERIFY THE SCAC CODE   *14950017
151600*  ENTERED IS VALID.                                             *14960017
151700*----------------------------------------------------------------*14970017
151800                                                                  14980017
151900 3060-VALIDATE-SHIP-CDE.                                          14990017
152000                                                                  15000017
152100     EXEC SQL                                                     15010017
152200            SELECT  DISTINCT                                      15020017
152300                    SHIPT_UNT_ID                                  15030017
152400             INTO  :SHPUNT-SHIPT-UNT-ID                           15040017
152500             FROM  TSHPUNT                                        15050017
152600             WHERE  SHIPT_UNT_ID = :DK-SERIAL-SHIP-CDE            15060017
152700               AND  ACTV_IND     = 'A'                            15070017
152800     END-EXEC.                                                    15080017
152900                                                                  15090017
153000     EVALUATE TRUE                                                15100017
153100         WHEN SQLCODE = +0                                        15110017
153200         WHEN SQLCODE = -811                                      15120017
153300             SET PS-SHIP-CDE-EXISTS       TO TRUE                 15130017
153400                                                                  15140017
153500         WHEN SQLCODE = +100                                      15150017
153600             SET PS-SHIP-CDE-DOESNT-EXIST TO TRUE                 15160017
153700                                                                  15170017
153800         WHEN SQLWARN0 NOT = SPACES                               15180017
153900         WHEN SQLCODE < +0                                        15190017
154000         WHEN SQLCODE > +0                                        15200017
154100             MOVE '3060-VALIDATE-SHIP-CDE'                        15210017
154200                             TO DP013-PARAGRAPH                   15220017
154300             MOVE 'SELECT SHIP CODE'                              15230017
154400                             TO DP013-MESSAGE-TEXT (1)            15240017
154500             MOVE DK-SERIAL-SHIP-CDE  TO DP013-MESSAGE-TEXT (2)   15250017
154600             MOVE SQLCA      TO DP013-SQLCA                       15260017
154700             MOVE 'TSHPUNT'  TO DP013-DB2-TABLE-NAME (1)          15270017
154800             SET DP013-DB2-ABEND                                  15280017
154900                             TO TRUE                              15290017
155000             SET DP013-XCTL-DISPLAY-RESTART                       15300017
155100                             TO TRUE                              15310017
155200             PERFORM DP013-0000-PROCESS-ABEND                     15320017
155300     END-EVALUATE.                                                15330017
155400                                                                  15340017
155500******************************************************************15350017
155600* VALIDATE PO NUMBER FROM TSHPTPO                                 15360017
155700******************************************************************15370017
155800 3070-VALIDATE-PO-NBR.                                            15380017
155900                                                                  15390017
156000     IF PS-RECEIVER-EXISTS                                        15400017
156100         EXEC SQL                                                 15410017
156200            SELECT  DISTINCT                                      15420017
156300                    ORD_NBR                                       15430017
156400                   ,REC_SEQ_NBR                                   15440017
156500                   ,CURR_OPER_UNT_ID                              15450017
156600              INTO  :RECEIV-ORD-NBR                               15460017
156700                   ,:RECEIV-REC-SEQ-NBR                           15470017
156800                   ,:RECEIV-CURR-OPER-UNT-ID                      15480017
156900              FROM  TRECEIV                                       15490017
157000             WHERE  ORD_NBR = :DK-PO-NBR                          15500017
157100             AND    REC_SEQ_NBR = :DK-REC-SEQ-NBR                 15510017
157200         END-EXEC                                                 15520017
157300      ELSE                                                        15530017
157400           MOVE ASC-KEY-OPER-UNT-ID TO RECEIV-CURR-OPER-UNT-ID    15540017
157500         EXEC SQL                                                 15550017
157600            SELECT  DISTINCT                                      15560017
157700                    PO_NBR                                        15570017
157800              INTO :SHPTPO-PO-NBR                                 15580017
157900              FROM  TSHPTPO                                       15590017
158000             WHERE  PO_NBR = :DK-PO-NBR                           15600017
158100         END-EXEC                                                 15610017
158200      END-IF                                                      15620017
158300                                                                  15630017
158400         EVALUATE TRUE                                            15640017
158500             WHEN SQLCODE = +0                                    15650017
158600                 SET PS-PO-EXISTS TO TRUE                         15660017
158700             WHEN SQLCODE = +100                                  15670017
158800             WHEN SQLCODE = -811                                  15680017
158900             WHEN SQLCODE = -904                                  15690017
159000             WHEN SQLCODE = -913                                  15700017
159100                 CONTINUE                                         15710017
159200                                                                  15720017
159300             WHEN SQLWARN0 NOT = SPACES                           15730017
159400             WHEN SQLCODE < +0                                    15740017
159500             WHEN SQLCODE > +0                                    15750017
159600                 MOVE '3070-VALIDATE-PO-NBR'                      15760017
159700                                 TO DP013-PARAGRAPH               15770017
159800                 MOVE 'SELECT PO NUMBER   '                       15780017
159900                                 TO DP013-MESSAGE-TEXT (1)        15790017
160000                 MOVE SQLCA      TO DP013-SQLCA                   15800017
160100                 MOVE 'TSHPTPO'  TO DP013-DB2-TABLE-NAME (1)      15810017
160200                 SET DP013-DB2-ABEND                              15820017
160300                                 TO TRUE                          15830017
160400                 SET DP013-XCTL-DISPLAY-RESTART                   15840017
160500                                 TO TRUE                          15850017
160600                 PERFORM DP013-0000-PROCESS-ABEND                 15860017
160700         END-EVALUATE.                                            15870017
160800                                                                  15880017
160900/                                                                 15890017
161000*----------------------------------------------------------------*15900017
161100*  CHECK THE EXTERNAL ENTERPRISE TABLE TO VERIFY THE SCAC CODE   *15910017
161200*  ENTERED IS VALID.                                             *15920017
161300*----------------------------------------------------------------*15930017
161400                                                                  15940017
161500 3100-VALIDATE-SCAC-CDE.                                          15950017
161600                                                                  15960017
161700     EXEC SQL                                                     15970017
161800        SELECT  A.SCAC_CDE                                        15980017
161900          INTO :EXTENT-SCAC-CDE                                   15990017
162000          FROM  TEXTENT A                                         16000017
162100         WHERE  A.SCAC_CDE    = :DK-SCAC-ID                       16010017
162200           AND  A.CARRIER_IND = 'Y'                               16020017
P40473         WITH UR                                                          
162300     END-EXEC.                                                    16030017
162400                                                                  16040017
162500     EVALUATE TRUE                                                16050017
162600         WHEN SQLCODE = +0                                        16060017
162700         WHEN SQLCODE = -811                                      16070017
162800             SET PS-SCAC-EXISTS       TO TRUE                     16080017
162900                                                                  16090017
163000         WHEN SQLCODE = +100                                      16100017
163100             SET PS-SCAC-DOESNT-EXIST TO TRUE                     16110017
163200                                                                  16120017
163300         WHEN SQLWARN0 NOT = SPACES                               16130017
163400         WHEN SQLCODE < +0                                        16140017
163500         WHEN SQLCODE > +0                                        16150017
163600             MOVE '3100-VALIDATE-SCAC-CDE'                        16160017
163700                             TO DP013-PARAGRAPH                   16170017
163800             MOVE 'SELECT SCAC CODE'                              16180017
163900                             TO DP013-MESSAGE-TEXT (1)            16190017
164000             MOVE DK-SCAC-ID TO DP013-MESSAGE-TEXT (2)            16200017
164100             MOVE SQLCA      TO DP013-SQLCA                       16210017
164200             MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)          16220017
164300             SET DP013-DB2-ABEND                                  16230017
164400                             TO TRUE                              16240017
164500             SET DP013-XCTL-DISPLAY-RESTART                       16250017
164600                             TO TRUE                              16260017
164700             PERFORM DP013-0000-PROCESS-ABEND                     16270017
164800     END-EVALUATE.                                                16280017
164900                                                                  16290017
165000******************************************************************16300017
165100** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **16310017
165200** MAP.                                                         **16320017
165300******************************************************************16330017
165400 3200-RESET-ATTRIBUTES.                                           16340017
165500     MOVE DP015-UNP-ALP-NOR-OFF    TO AOPERA                      16350017
165600                                      AFCLTYA                     16360017
165700                                      ASCACA                      16370017
165800                                      ATRLRA                      16380017
165900                                      ATRIPA                      16390017
166000                                      APOA                        16400017
166100                                      ASEQNBRA                    16410017
166200                                      ASERSHPA.                   16420017
166300     MOVE DP015-GREEN              TO AOPERC                      16430017
166400                                      AFCLTYC                     16440017
166500                                      ASCACC                      16450017
166600                                      ATRLRC                      16460017
166700                                      ATRIPC                      16470017
166800                                      APOC                        16480017
166900                                      ASEQNBRC                    16490017
167000                                      ASERSHPC.                   16500017
167100     MOVE DP015-UNDERLINE          TO AOPERH                      16510017
167200                                      AFCLTYH                     16520017
167300                                      ASCACH                      16530017
167400                                      ATRLRH                      16540017
167500                                      ATRIPH                      16550017
167600                                      APOH                        16560017
167700                                      ASEQNBRH                    16570017
167800                                      ASERSHPH.                   16580017
167900     MOVE SPACES                   TO AMSGLNO.                    16590017
168000                                                                  16600017
168100*----------------------------------------------------------------*16610017
168200*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *16620017
168300*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *16630017
168400*  IT HERE.                                                      *16640017
168500*----------------------------------------------------------------*16650017
168600 4000-BUILD-INITIAL-PANEL.                                        16660017
168700     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        16670017
168800     MOVE -1                       TO ASCACL.                     16680017
168900                                                                  16690017
169000     MOVE SPACE                    TO ASCACO                      16700017
169100                                      ATRLRO.                     16710017
169200     MOVE ZEROES                   TO ATRIPO                      16720017
169300                                      APOO                        16730017
169400                                      ASEQNBRO                    16740017
169500                                      ASERSHPO.                   16750017
169600                                                                  16760017
169700     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     16770017
169800     MOVE ASC-FCLTY-ID             TO AFCLTYO.                    16780017
169900     MOVE PC-X                     TO AARRVDO.                    16790017
170000     MOVE PC-X                     TO AUNLDGO.                    16800017
170100     MOVE DP015-UNP-ALP-NOR-MDT    TO AUNLDGA.                    16810017
170200     MOVE DP015-UNP-ALP-NOR-MDT    TO AARRVDA.                    16820017
170300*                                                                 16830017
170400*----------------------------------------------------------------*16840017
170500*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *16850017
170600*----------------------------------------------------------------*16860017
170700 4400-MOVE-COMMAREA-TO-SCREEN.                                    16870017
170800     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     16880017
170900     MOVE ASC-FCLTY-ID             TO AFCLTYO.                    16890017
171000     MOVE ASC-FCLTY-NME            TO AFDESCO.                    16900017
171100     MOVE ASC-SCAC                 TO ASCACO.                     16910017
171200     MOVE ASC-TRAILER              TO ATRLRO.                     16920017
171300     IF ASC-STATUS-UG > SPACES                                    16930017
171400        MOVE PC-X                  TO AUNLDGO                     16940017
171500     END-IF.                                                      16950017
171600     IF ASC-STATUS-UN > SPACES                                    16960017
171700        MOVE PC-X                  TO AUNLDDO                     16970017
171800     END-IF.                                                      16980017
171900     IF ASC-STATUS-AR > SPACES                                    16990017
172000        MOVE PC-X                  TO AARRVDO                     17000017
172100     END-IF.                                                      17010017
172200     MOVE ASC-TRIP-ID              TO ATRIPO.                     17020017
172300     MOVE ASC-PO-NBR               TO APOO.                       17030017
172400     MOVE ASC-REC-SEQ-NBR          TO ASEQNBRO.                   17040017
172500     MOVE ASC-SERIAL-SHIP-CDE-N    TO ASERSHPO.                   17050017
172600 EJECT                                                            17060017
172700                                                                  17070017
172800 9900-SOFT-ABORT.                                                 17080017
172900     SET PS-ERROR         TO TRUE.                                17090017
173000     SET DP020-MSG-FATAL  TO TRUE.                                17100017
173100     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    17110017
173200     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE.                       17120017
173300     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          17130017
173400     PERFORM 0001-CALL-CICS-ARCH-API.                             17140017
173500                                                                  17150017
173600******************************************************************17160017
173700 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  17170017
173800                                                                  17180017
173900     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           17190017
174000     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          17200017
174100     INITIALIZE DP013-SRC-TASK-NUMBER                             17210017
174200                DP013-STACK.                                      17220017
174300     SET DP013-LINK-RETURN            TO TRUE.                    17230017
174400                                                                  17240017
174500     EXEC CICS                                                    17250017
174600         LINK                                                     17260017
174700             PROGRAM   (DP013-NAME)                               17270017
174800             COMMAREA  (DP013-PARAMETERS)                         17280017
174900             LENGTH    (DP013-LENGTH)                             17290017
175000     END-EXEC.                                                    17300017
175100/                                                                 17310017
175200*----------------------------------------------------------------*17320017
175300*    ABEND PROCESSOR MODULE                                      *17330017
175400*----------------------------------------------------------------*17340017
175500                                                                  17350017
175600     COPY DPPD013.                                                17360017
