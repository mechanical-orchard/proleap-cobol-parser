000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.    VNKCS009.                                         00020003
000300 AUTHOR.        TOM RUSKA. G&R.                                   00030003
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040003
000500 DATE-WRITTEN.  07/06/93.                                         00050003
000600 DATE-COMPILED.                                                   00060003
000700                                                                  00070003
000800*---------------------------------------------------------------* 00080003
000900*    TRANID      - V009                                         * 00090003
001000*    TYPE        - CICS ARCHITECTURE INQUIRY - DB2              * 00100003
001100*    DESCRIPTION - VENDOR ADDRESS/REP INQUIRY                   * 00110003
001200*    MAPSET      - VNKM009                                      * 00120003
001300*                                                               * 00130003
001400*    THIS SCREEN ALLOWS USERS TO VIEW VENDOR ADDRESS AND REP    * 00140003
001500*    INFORMATION FOR A SPECIFIC BUSINESS FUNCTION.              * 00150003
001300*                                                               * 00151026
001300*    CHANGES:                                                   * 00152026
001300*    DATE:  01/05/2023                                          * 00153026
001420*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00153126
001450*      MADE BY: JEAN KURK               WR/IR #: CHG0277999      *00153226
001300*                                                               * 00154026
001600*---------------------------------------------------------------* 00160003
001700                                                                  00170003
001800 ENVIRONMENT DIVISION.                                            00180003
001900 DATA DIVISION.                                                   00190003
002000/                                                                 00200003
002100 WORKING-STORAGE SECTION.                                         00210003
002200                                                                  00220003
002300 01  DK-DB2-KEYS.                                                 00230003
002400     05  DK-ENT-ID                    PIC S9(09) VALUE +0         00240003
002500                                                 COMP.            00250003
002600     05  DK-FUNCTION-ID               PIC S9(04) VALUE +0         00260003
002700                                                 COMP.            00270003
002800                                                                  00280003
002900 01  PC-PROGRAM-CONSTANTS.                                        00290003
003000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00300003
003100                                                    'VNKCS009'.   00310003
003200     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00320003
003300                                                    'VN009A  '.   00330003
003400     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00340003
003500                                                    'VNKM009 '.   00350003
003600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00360003
003700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00370003
003800     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.      00380003
003900     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '1'.    00390003
004000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +1      00400003
004100                                                    COMP SYNC.    00410003
004200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00420003
004300                                                    COMP SYNC.    00430003
004400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00440003
004500                                                    +1000000      00450003
004600                                                    COMP-3.       00460003
004700     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00470003
004800                                                    COMP-3.       00480003
004810     05  PC-DPKUT410                    PIC  X(08)  VALUE         00481015
004900                                                    'DPKUT410'.   00490015
004901     05  PC-REMIT-FUNCTION-ID           PIC S9(04)  VALUE +9      00490119
004910                                                    COMP.         00491019
004911     05  PC-1099-FUNCTION-ID            PIC S9(04)  VALUE +16     00491119
004920                                                    COMP.         00492019
005000     05  PC-TSYMSG-NUMBERS.                                       00500003
005100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00510003
005200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00520003
005300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00530003
005400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00540003
005500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00550003
005600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00560003
005700         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00570003
005800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00580003
005900         10  PC-TSYMSG-00460            PIC  9(05)  VALUE 00460.  00590003
006000                                                                  00600003
006100 01  PS-PROGRAM-SWITCHES.                                         00610003
006200     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00620003
006300         88  PS-NO-ERROR                            VALUE 'Y'.    00630003
006400         88  PS-ERROR                               VALUE 'N'.    00640003
006500     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00650003
006600         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00660003
006700         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00670003
006800     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    00680003
006900         88  PS-LIST-END                            VALUE 'Y'.    00690003
007000         88  PS-NO-LIST-END                         VALUE 'N'.    00700003
007100                                                                  00710003
007200 01  PV-PROGRAM-VARIABLES.                                        00720003
007300     05  PV-SUB                         PIC S9(04)   VALUE +0     00730003
007400                                                     COMP SYNC.   00740003
007500     05  PV-REMAINDER                   PIC S9(04)   VALUE +0     00750003
007600                                                     COMP SYNC.   00760003
007700     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     00770003
007800                                                     COMP-3.      00780003
007900     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     00790003
008000                                                     COMP-3.      00800003
008100     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     00810003
008200                                                     COMP-3.      00820003
008300     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     00830003
008400                                                     COMP SYNC.   00840003
008500     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     00850003
008600                                                     COMP SYNC.   00860003
008700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     00870003
008800                                                     COMP SYNC.   00880003
008900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     00890003
009000                                                     COMP SYNC.   00900003
009100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      00910003
009200                                                    COMP SYNC.    00920003
009210     05  PV-DPKUT410-COMMAREA           PIC  X(01)   VALUE SPACES.00921015
009300                                                                  00930003
009400     05  PV-DB2-TIMESTAMP               PIC  X(26).               00940003
009500     05  FILLER REDEFINES PV-DB2-TIMESTAMP.                       00950003
009600         10  PV-DB2-TIMESTAMP-CC        PIC  X(02).               00960003
009700         10  PV-DB2-TIMESTAMP-YY        PIC  X(02).               00970003
009800         10  FILLER                     PIC  X(01).               00980003
009900         10  PV-DB2-TIMESTAMP-MM        PIC  X(02).               00990003
010000         10  FILLER                     PIC  X(01).               01000003
010100         10  PV-DB2-TIMESTAMP-DD        PIC  X(02).               01010003
010200         10  FILLER                     PIC  X(16).               01020003
010300                                                                  01030003
010400/                                                                 01040003
010500*----------------------------------------------------------------*01050003
010600*    MAP LAYOUT                                                  *01060003
010700*----------------------------------------------------------------*01070003
010800                                                                  01080003
010900     COPY VNKM009.                                                01090003
011000                                                                  01100003
011100/                                                                 01110003
011200*---------------------------------------------------------------* 01120003
011300*    ABEND PROCESSING COPYBOOK.                                 * 01130003
011400*---------------------------------------------------------------* 01140003
011500     COPY DPWS013.                                                01150003
011600                                                                  01160003
011700/                                                                 01170003
011800*---------------------------------------------------------------* 01180003
011900*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01190003
012000*---------------------------------------------------------------* 01200003
012100     COPY DPWS015.                                                01210003
012200                                                                  01220003
012300*---------------------------------------------------------------* 01230003
012400*    FUNCTION KEYS COPYBOOK.                                    * 01240003
012500*---------------------------------------------------------------* 01250003
012600     COPY DPWS016.                                                01260003
012700                                                                  01270003
012800*---------------------------------------------------------------* 01280003
012900*    NUMERIC EDIT LAYOUT.                                       * 01290003
013000*---------------------------------------------------------------* 01300003
013100     COPY DPWS010I.                                               01310003
013200                                                                  01320003
013210*---------------------------------------------------------------* 01321007
013220*    STATE/PROVINCE/COUNTRY SUBROUTINE                          * 01322007
013230*---------------------------------------------------------------* 01323007
013240     COPY DPWS410.                                                01324009
013250                                                                  01325007
013300/                                                                 01330003
013400*---------------------------------------------------------------* 01340003
013500*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 01350026
013600*---------------------------------------------------------------* 01360003
013700     COPY DPWS030.                                                01370003
013700     COPY DPWS930.                                                01371026
013800                                                                  01380003
013900/                                                                 01390003
014000*----------------------------------------------------------------*01400003
014100*    STANDARD COMMAREA.                                          *01410003
014200*----------------------------------------------------------------*01420003
014300                                                                  01430003
014400     COPY DPWS020.                                                01440003
014500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01450003
014600                                                                  01460003
014700*----------------------------------------------------------------*01470003
014800*    INTER-APPLICATION COMMAREA.                                 *01480003
014900*----------------------------------------------------------------*01490003
015000                                                                  01500003
015100         10  INTER-APPL-COMM-AREA PIC X(200).                     01510003
015200     COPY VNWS001.                                                01520003
015300     COPY VNWS002.                                                01530003
015400*----------------------------------------------------------------*01540003
015500*    SPECIFIC COMMMAREA FOR VNKCS009.                            *01550003
015600*----------------------------------------------------------------*01560003
015700         10  ASC-SPECIFIC-COMMAREA.                               01570003
015800             15  ASC-LIST-KEYS.                                   01580003
015900                 20  ASC-KEY-ENT-ID       PIC S9(09) COMP.        01590003
016000                 20  ASC-KEY-FUNCTION-ID  PIC S9(04) COMP.        01600003
016100             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           01610003
016200                 20  ASC-ITEM-ARRAY.                              01620003
016300                     25  ASC-ITEM-ENTRIES OCCURS 1 TIMES.         01630003
016400                         30  ASC-LIST-ITEM-NUMBER PIC S9(09)      01640003
016500                                                  COMP-3.         01650003
016510                         30  ASC-LAST-UPDATE-DATE PIC X(10).      01651005
016520                         30  ASC-LAST-UPDATE-ID   PIC X(08).      01652005
016600                         30  ASC-FIRST-NAME       PIC X(15).      01660003
016700                         30  ASC-LAST-NAME        PIC X(15).      01670003
016800                         30  ASC-TITLE            PIC X(35).      01680003
016900                         30  ASC-TEL1-NBR         PIC X(18).      01690003
017000                         30  ASC-TEL1-EXT-NBR     PIC X(04).      01700003
017010                         30  ASC-TEL1-CC-NBR      PIC X(03).      01701005
017100                         30  ASC-TEL2-NBR         PIC X(18).      01710003
017200                         30  ASC-TEL2-EXT-NBR     PIC X(04).      01720003
017210                         30  ASC-TEL2-CC-NBR      PIC X(03).      01721005
017300                         30  ASC-FAX-NBR          PIC X(24).      01730017
017310                         30  ASC-ROOM-NBR         PIC X(10).      01731005
017400                         30  ASC-EMAIL-ADDR       PIC X(64).      01740003
017500                         30  ASC-ADR-EXNAM-TEXT   PIC X(11).      01750019
017600                         30  ASC-ADDR1-EXNAME     PIC X(40).      01760019
017610                         30  ASC-ADDRESS-TEXT     PIC X(11).      01761019
017700                         30  ASC-ADDR12-DESC      PIC X(40).      01770019
017800                         30  ASC-ADDR23-DESC      PIC X(40).      01780019
017900                         30  ASC-ADDR34-DESC      PIC X(40).      01790019
018100                         30  ASC-CITY             PIC X(30).      01810003
018110                         30  ASC-ZIP              PIC X(12).      01811019
018200                         30  ASC-ST-PROV-CDE      PIC X(06).      01820024
018300                         30  ASC-ST-PROV          PIC X(18).      01830024
018400                         30  ASC-COUNTRY-CDE      PIC X(03).      01840024
018500                         30  ASC-COUNTRY          PIC X(30).      01850024
018700                         30  ASC-ATTENTION-TO-TXT PIC X(40).      01870003
018800                         30  ASC-COMMENT1-TXT     PIC X(60).      01880003
018900                         30  ASC-COMMENT2-TXT     PIC X(60).      01890003
019000                         30  ASC-COMMENT3-TXT     PIC X(60).      01900003
019100             15  ASC-VENDOR-NAME        PIC X(30).                01910003
019200             15  ASC-DUN-NBR            PIC X(09).                01920003
019300             15  ASC-FUNCTION-NAME      PIC X(25).                01930005
019400                                                                  01940003
019500             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     01950003
019600             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     01960003
019700             15  ASC-SEL-SUB            PIC S9(04) COMP SYNC.     01970003
019800             15  ASC-SEL-ITEM           PIC S9(04) COMP SYNC.     01980003
019900             15  ASC-NUMBER-OF-ITEMS-READ                         01990003
020000                                        PIC S9(09) COMP-3.        02000003
020100             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05) COMP-3.        02010003
020200             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        02020003
020300             15  ASC-ITEM-AT-TOP-OF-PANEL                         02030003
020400                                        PIC S9(09) COMP-3.        02040003
020500             15  ASC-ITEM-AT-BOT-OF-PANEL                         02050003
020600                                        PIC S9(09) COMP-3.        02060003
020700             15  ASC-HIGHEST-BLOCK-WRITTEN                        02070003
020800                                        PIC S9(04) COMP SYNC.     02080003
020900             15  ASC-ITEMS-LEFT-INDICATOR                         02090003
021000                                        PIC  X(01).               02100003
021100                 88  ASC-ITEMS-LEFT-ON-DB     VALUE 'Y'.          02110003
021200                 88  ASC-NO-ITEMS-LEFT-ON-DB  VALUE 'N'.          02120003
021300             15  ASC-USE-SELECTION-QUEUE-IND                      02130003
021400                                        PIC  X(01).               02140003
021500                 88  ASC-USE-SELECTION-QUEUE  VALUE 'Y'.          02150003
021600             15  ASC-DTL-QUEUE-NAME.                              02160003
021700                 20  ASC-DTL-TERM-ID     PIC  X(04).              02170003
021800                 20  ASC-DTL-TASK-NUMBER PIC S9(05) COMP-3.       02180003
021900                 20  ASC-DTL-SEQ         PIC  9(01).              02190003
022000             15  ASC-SEL-QUEUE-NAME.                              02200003
022100                 20  ASC-SEL-TERM-ID     PIC  X(04).              02210003
022200                 20  ASC-SEL-TASK-NUMBER PIC S9(05) COMP-3.       02220003
022300                 20  ASC-SEL-SEQ         PIC  9(01).              02230003
022400                                                                  02240003
022500/                                                                 02250003
022600*---------------------------------------------------------------* 02260003
022700*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02270003
022800*---------------------------------------------------------------* 02280003
022900     COPY VNWS003.                                                02290003
023000                                                                  02300003
023100/                                                                 02310003
023200*----------------------------------------------------------------*02320003
023300*    DB2 SQL COMMUNICATION AREA                                   02330003
023400*----------------------------------------------------------------*02340003
023500     EXEC SQL                                                     02350003
023600          INCLUDE SQLCA                                           02360003
023700     END-EXEC.                                                    02370003
023800                                                                  02380003
023900/                                                                 02390003
024000*----------------------------------------------------------------*02400003
024100*    DB2 DCLGEN FOR BUSINESS LOCATION TABLE                       02410003
024200*----------------------------------------------------------------*02420003
024300     EXEC SQL                                                     02430003
024400          INCLUDE TBUSLOC                                         02440003
024500     END-EXEC.                                                    02450003
024600                                                                  02460003
024700/                                                                 02470003
024800*----------------------------------------------------------------*02480003
024900*    DB2 DCLGEN FOR BUSINESS FUNCTION TABLE                       02490003
025000*----------------------------------------------------------------*02500003
025100     EXEC SQL                                                     02510003
025200          INCLUDE TBUSFNC                                         02520003
025300     END-EXEC.                                                    02530003
025400                                                                  02540003
025500/                                                                 02550003
025600*----------------------------------------------------------------*02560003
025700*    DB2 DCLGEN FOR ENTERPRISE REPRESENTATIVE TABLE               02570003
025800*----------------------------------------------------------------*02580003
025900     EXEC SQL                                                     02590003
026000          INCLUDE TENTREP                                         02600003
026100     END-EXEC.                                                    02610003
026200                                                                  02620003
026300/                                                                 02630003
026400*----------------------------------------------------------------*02640003
026500*    DB2 DCLGEN FOR VENDOR EXTERNAL ENTERPRISE NAME TABLE         02650003
026600*----------------------------------------------------------------*02660003
026700     EXEC SQL                                                     02670003
026800          INCLUDE TENTNME                                         02680003
026900     END-EXEC.                                                    02690003
027000                                                                  02700003
027100/                                                                 02710003
027200*----------------------------------------------------------------*02720003
027300*    DB2 DCLGEN FOR VENDOR EXTERNAL ENTERPRISE NAME TABLE         02730003
027400*----------------------------------------------------------------*02740003
027500     EXEC SQL                                                     02750003
027600          INCLUDE TEXTENT                                         02760003
027700     END-EXEC.                                                    02770003
027800                                                                  02780003
027900/                                                                 02790003
028000*---------------------------------------------------------------* 02800003
028100*  CURSOR TO LIST ALL ADDRESSES/REPS FOR A FUNCTION             * 02810003
028200*---------------------------------------------------------------* 02820003
028300                                                                  02830003
028400     EXEC SQL                                                     02840003
028500         DECLARE ADDRESS-CSR CURSOR FOR                           02850003
028600             SELECT A.ENT_ID                                      02860003
028700                   ,A.SEQ_NBR                                     02870003
028800                   ,A.FIRST_NAME                                  02880003
028900                   ,A.LAST_NAME                                   02890003
029000                   ,A.TITLE_NAME                                  02900003
029100                   ,A.TEL1_NBR                                    02910003
029200                   ,A.TEL1_EXT_NBR                                02920003
029210                   ,A.TEL_1_CNTRY_CDE                             02921005
029300                   ,A.TEL2_NBR                                    02930003
029400                   ,A.TEL2_EXT_NBR                                02940003
029410                   ,A.TEL_2_CNTRY_CDE                             02941005
029500                   ,A.FAX_NBR                                     02950003
029510                   ,B.ROOM_NBR                                    02951005
029600                   ,A.EMAIL_ADDR_ID                               02960003
029700                   ,A.FUNCTION_ID                                 02970003
029800                   ,A.LAST_UPDATE_TMST                            02980003
029900                   ,A.LAST_UPDATE_ID                              02990003
030000                   ,B.ADDRESS_LINE1_DESC                          03000003
030100                   ,B.ADDRESS_LINE2_DESC                          03010003
030200                   ,B.ADDRESS_LINE3_DESC                          03020003
030300                   ,B.ADDRESS_LINE4_DESC                          03030019
030400                   ,B.ATTENTION_TO_TXT                            03040003
030500                   ,B.CITY_NAME                                   03050003
030600                   ,B.ST_PROV_CDE                                 03060006
030700                   ,B.ZIP_CDE                                     03070003
030800                   ,B.CNTRY_CDE                                   03080006
031100                   ,B.COMMENT1_TXT                                03110003
031200                   ,B.COMMENT2_TXT                                03120003
031300                   ,B.COMMENT3_TXT                                03130003
031400                   ,C.FUNCTION_NAME                               03140003
031410                   ,B.EXTD_VND_NM                                 03141017
031420                   ,B.ALT_1099_VND_NM                             03142017
031500             FROM TENTREP A                                       03150003
031600                 ,TBUSLOC B                                       03160003
031700                 ,TBUSFNC C                                       03170003
031800             WHERE A.ENT_ID         = :DK-ENT-ID                  03180003
031900               AND A.FUNCTION_ID    = :DK-FUNCTION-ID             03190003
032000               AND A.ENT_ID         = B.ENT_ID                    03200003
032100               AND A.ENT_BUS_LOC_ID = B.SEQ_NBR                   03210003
032200               AND B.FUNCTION_ID    = C.FUNCTION_ID               03220003
032300             ORDER BY A.SEQ_NBR                                   03230003
032400     END-EXEC.                                                    03240003
032500                                                                  03250003
032600/                                                                 03260003
032700 LINKAGE SECTION.                                                 03270003
032800                                                                  03280003
032900 01  DFHCOMMAREA.                                                 03290003
033000     05  FILLER                       OCCURS  1 TO 4072 TIMES     03300003
033100                                      DEPENDING ON EIBCALEN.      03310003
033200         10  FILLER                   PIC X.                      03320003
033300                                                                  03330003
033400/                                                                 03340003
033500 PROCEDURE DIVISION.                                              03350003
033600                                                                  03360003
033700*----------------------------------------------------------------*03370003
033800*    THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. *03380003
033900*    THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  *03390003
034000*    MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            *03400003
034100*                                                                *03410003
034200*    THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  *03420003
034300*    LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       *03430003
034400*----------------------------------------------------------------*03440003
034500 0000-MAIN-MODULE.                                                03450003
034600                                                                  03460003
034700     INITIALIZE DP030-CICS-API-FIELDS.                            03470003
034800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03480003
034900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03490003
035000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03500003
035100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03510003
035200     MOVE LENGTH OF VN009AI        TO DP030-MAP-LENGTH (1).       03520003
035300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03530003
035400     PERFORM 0001-CALL-CICS-ARCH-API.                             03540003
035500                                                                  03550003
035600     PERFORM 1000-CONTROL-PROCESSING.                             03560003
035700                                                                  03570003
035800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03580003
035900     PERFORM 0001-CALL-CICS-ARCH-API.                             03590003
036000                                                                  03600003
036100/                                                                 03610003
036200 0001-CALL-CICS-ARCH-API.                                         03620003
036300                                                                  03630003
036400*    CALL 'DPKCS030' USING DFHEIBLK                               03640026
036400     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03641026
036500                           DFHCOMMAREA                            03650003
036600                           DP030-CICS-API-FIELDS                  03660003
036700                           DP020-STANDARD-COMMAREA                03670003
036800                           VN009AI.                               03680003
036900                                                                  03690003
037000     IF  DP030-RC-CALL-SUCCESSFUL                                 03700003
037100         CONTINUE                                                 03710003
037200     ELSE                                                         03720003
037300         SET DP013-NO-ROLLBACK                                    03730003
037400             DP013-XCTL-DISPLAY-RESTART                           03740003
037500             DP013-CICS-ABEND      TO TRUE                        03750003
037600         MOVE 'BEFORE 0000-MAIN-MODULE'                           03760003
037700                                   TO DP013-PARAGRAPH             03770003
037800*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX03780026
037900*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      03790026
037800         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03791026
037900-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03792026
038000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03800003
038100         PERFORM DP013-0000-PROCESS-ABEND                         03810003
038200     END-IF.                                                      03820003
038300                                                                  03830003
038400/                                                                 03840003
038500*'---------------------------------------------------------------*03850003
038600*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03860003
038700*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03870003
038800*----------------------------------------------------------------*03880003
038900                                                                  03890003
039000 1000-CONTROL-PROCESSING.                                         03900003
039100                                                                  03910003
039200     EVALUATE TRUE                                                03920003
039300         WHEN DP020-NEXT-ACT-INITIAL                              03930003
039400             INITIALIZE ASC-SPECIFIC-COMMAREA                     03940003
039500             MOVE EIBTRMID         TO ASC-DTL-TERM-ID             03950003
039600             MOVE DP020-SRC-TASK-NUMBER                           03960003
039700                                   TO ASC-DTL-TASK-NUMBER         03970003
039800             MOVE PC-DTL-QUEUE-SEQ TO ASC-DTL-SEQ                 03980003
039900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 03990003
040000                                                                  04000003
040100***-----$TEMPLATE NOTE$-------------------------------------------04010003
040200*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04020003
040300*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04030003
040400*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04040003
040500***---------------------------------------------------------------04050003
040600             IF  PS-COMMAREA-NOT-VALID                            04060003
040700                 SET DP020-NEXT-ACT-APPL-ERROR                    04070003
040800                                   TO TRUE                        04080003
040900             ELSE                                                 04090003
041000                 PERFORM 2050-DELETE-DETAIL-QUEUE                 04100003
041100                                                                  04110003
041200                 PERFORM UNTIL ASC-NUMBER-OF-ITEMS-READ > ZERO    04120003
041300                         OR    PS-LIST-END                        04130003
041400                     PERFORM 4000-BUILD-INITIAL-PANEL             04140003
041500                                                                  04150003
041600                     IF ASC-NUMBER-OF-ITEMS-READ < 1              04160003
041700                        PERFORM 2140-GET-NEXT-FUNCTION            04170003
041800                     END-IF                                       04180003
041900                 END-PERFORM                                      04190003
042000                                                                  04200003
042100                 IF  ASC-NUMBER-OF-ITEMS-READ = ZERO              04210003
042200                     SET DP020-NEXT-ACT-APPL-ERROR                04220003
042300                         DP020-MSG-FATAL                          04230003
042400                                   TO TRUE                        04240003
042500                     MOVE PC-TSYMSG-00050                         04250003
042600                                   TO DP020-MSG-NUMBER            04260003
042700                 ELSE                                             04270003
042800                     MOVE SPACES   TO DP020-MSG-NUMBER-X          04280003
042900                                      DP020-MSG-SEVERITY-IND      04290003
043000                     IF  ASC-ITEM-AT-BOT-OF-PANEL <               04300003
043100                                    ASC-NUMBER-OF-ITEMS-READ      04310003
043200*                        --- MORE ITEMS TO DISPLAY ----           04320003
043300                         MOVE PC-TSYMSG-00279                     04330003
043400                                   TO DP020-MSG-NUMBER            04340003
043500                         SET DP020-MSG-INFORMATIONAL              04350003
043600                                   TO TRUE                        04360003
043700                     END-IF                                       04370003
043800                 END-IF                                           04380003
043900             END-IF                                               04390003
044000                                                                  04400003
044100         WHEN DP020-NEXT-ACT-READ-MAP                             04410003
044200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04420003
044300                                   TO PV-TOP-ITEM                 04430003
044400             PERFORM 2000-PROCESS-PANEL                           04440003
044500                                                                  04450003
044600         WHEN DP020-NEXT-ACT-RETURN                               04460003
044700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04470003
044800                                   TO PV-TOP-ITEM                 04480003
044900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04490003
045000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04500003
045100                                                                  04510003
045200         WHEN OTHER                                               04520003
045300             SET DP013-LOGIC-ABEND TO TRUE                        04530003
045400             SET DP013-NO-ROLLBACK TO TRUE                        04540003
045500             MOVE '1000-CONTROL-PROCESSING'                       04550003
045600                                   TO DP013-PARAGRAPH             04560003
045700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04570003
045800                                   TO DP013-MESSAGE-TEXT(1)       04580003
045900             PERFORM DP013-0000-PROCESS-ABEND                     04590003
046000     END-EVALUATE.                                                04600003
046100                                                                  04610003
046200/                                                                 04620003
046300*----------------------------------------------------------------*04630003
046400*    DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE  *04640003
046500*    INTER-APPLICATION FORMAT CODE.                              *04650003
046600*----------------------------------------------------------------*04660003
046700 1100-PROCESS-INTER-APPL-COMM.                                    04670003
046800                                                                  04680003
046900                                                                  04690003
047000     SET PS-COMMAREA-VALID         TO TRUE.                       04700003
047100                                                                  04710003
047200     EVALUATE DP020-INT-APPL-FORMAT-IND                           04720003
047300                                                                  04730003
047400         WHEN PC-LIST-FORMAT                                      04740003
047500             IF  VN002-NUMBER-OF-SELECTED-ITEMS = ZERO            04750003
047600                 MOVE PC-TSYMSG-00057                             04760003
047700                                   TO DP020-MSG-NUMBER            04770003
047800                 SET DP020-MSG-WARNING                            04780003
047900                     PS-COMMAREA-NOT-VALID                        04790003
048000                                   TO TRUE                        04800003
048100             ELSE                                                 04810003
048200                 SET ASC-USE-SELECTION-QUEUE TO TRUE              04820003
048300                 MOVE VN002-NUMBER-OF-TS-ITEMS                    04830003
048400                                   TO ASC-NUMBER-OF-TS-ITEMS      04840003
048500                 MOVE VN002-SEL-QUEUE-NAME                        04850003
048600                                   TO ASC-SEL-QUEUE-NAME          04860003
048700                 PERFORM 1120-PREPARE-LIST-ENTRY                  04870003
048800             END-IF                                               04880003
048900                                                                  04890003
049000         WHEN OTHER                                               04900003
049100             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            04910003
049200             SET DP020-MSG-FATAL                                  04920003
049300                 DP020-NEXT-ACT-APPL-ERROR                        04930003
049400                                   TO TRUE                        04940003
049500                                                                  04950003
049600     END-EVALUATE.                                                04960003
049700                                                                  04970003
049800/                                                                 04980003
049900*----------------------------------------------------------------*04990003
050000*    ENTRY IS FROM A LIST.  GET THE FUNCTION ID FROM THE         *05000003
050100*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *05010003
050200*----------------------------------------------------------------*05020003
050300 1120-PREPARE-LIST-ENTRY.                                         05030003
050400                                                                  05040003
050500     MOVE VN003-MAX-ITEMS          TO ASC-SEL-SUB.                05050003
050600     MOVE ZERO                     TO ASC-SEL-ITEM.               05060003
050700     PERFORM 2140-GET-NEXT-FUNCTION.                              05070003
050800                                                                  05080003
050900/                                                                 05090003
051000*----------------------------------------------------------------*05100003
051100*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*05110003
051200*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*05120003
051300*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *05130003
051400*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *05140003
051500*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *05150003
051600*----------------------------------------------------------------*05160003
051700                                                                  05170003
051800 2000-PROCESS-PANEL.                                              05180003
051900                                                                  05190003
052000     EVALUATE TRUE                                                05200003
052100         WHEN DP020-SRC-AID = DP016-CLEAR                         05210003
052200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05220003
052300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05230003
052400                                                                  05240003
052500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05250003
052600             MOVE ASC-KEY-ENT-ID   TO DK-ENT-ID                   05260003
052700             MOVE ASC-KEY-FUNCTION-ID                             05270003
052800                                   TO DK-FUNCTION-ID              05280003
052900             PERFORM 2050-DELETE-DETAIL-QUEUE                     05290003
053000             PERFORM 4000-BUILD-INITIAL-PANEL                     05300003
053100                                                                  05310003
053200         WHEN OTHER                                               05320003
053300             IF PS-NO-ERROR                                       05330003
053400                PERFORM 2100-CHECK-FUNCTION-KEY                   05340003
053500             END-IF                                               05350003
053600     END-EVALUATE.                                                05360003
053700                                                                  05370003
053800/                                                                 05380003
053900*----------------------------------------------------------------*05390003
054000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05400003
054100*----------------------------------------------------------------*05410003
054200 2050-DELETE-DETAIL-QUEUE.                                        05420003
054300                                                                  05430003
054400     EXEC CICS                                                    05440003
054500         DELETEQ TS                                               05450003
054600           QUEUE (ASC-DTL-QUEUE-NAME)                             05460003
054700            RESP (PV-CICS-RESP)                                   05470003
054800     END-EXEC.                                                    05480003
054900                                                                  05490003
055000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05500003
055100        (PV-CICS-RESP = DFHRESP(QIDERR))                          05510003
055200         CONTINUE                                                 05520003
055300     ELSE                                                         05530003
055400         SET DP013-CICS-ABEND                                     05540003
055500             DP013-NO-ROLLBACK     TO TRUE                        05550003
055600                                                                  05560003
055700         MOVE '2050-DELETE-DTL-QUEUE'                             05570003
055800                                   TO DP013-PARAGRAPH             05580003
055900         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'  05590003
056000                                   TO DP013-MESSAGE-TEXT (1)      05600003
056100         PERFORM DP013-0000-PROCESS-ABEND                         05610003
056200     END-IF.                                                      05620003
056300                                                                  05630003
056400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05640003
056500                                                                  05650003
056600/                                                                 05660003
056700*----------------------------------------------------------------*05670003
056800*    ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED    *05680003
056900*    FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED*05690003
057000*    FROM THE CICS ARCHITECTURE API.                             *05700003
057100*----------------------------------------------------------------*05710003
057200                                                                  05720003
057300 2100-CHECK-FUNCTION-KEY.                                         05730003
057400                                                                  05740003
057500     EVALUATE TRUE                                                05750003
057600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05760003
057700             MOVE +1               TO PV-TOP-ITEM                 05770003
057800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05780003
057900                                                                  05790003
058000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05800003
058100             PERFORM 2110-BROWSE-BACKWARD                         05810003
058200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05820003
058300                                                                  05830003
058400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05840003
058500             PERFORM 2120-BROWSE-FORWARD                          05850003
058600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05860003
058700                                                                  05870003
058800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05880003
058900             IF  ASC-USE-SELECTION-QUEUE                          05890003
059000                 PERFORM WITH TEST AFTER                          05900003
059100                         UNTIL ASC-NUMBER-OF-ITEMS-READ > ZERO    05910003
059200                         OR    PS-LIST-END                        05920003
059300                     PERFORM 2140-GET-NEXT-FUNCTION               05930003
059400                     IF  PS-LIST-END                              05940003
059500                         MOVE PC-TSYMSG-00070                     05950003
059600                                   TO DP020-MSG-NUMBER            05960003
059700                         SET DP020-MSG-INFORMATIONAL              05970003
059800                                   TO TRUE                        05980003
059900                     ELSE                                         05990003
060000                         PERFORM 2050-DELETE-DETAIL-QUEUE         06000003
060100                         PERFORM 4000-BUILD-INITIAL-PANEL         06010003
060200                     END-IF                                       06020003
060300                 END-PERFORM                                      06030003
060400                 SET PS-NO-LIST-END                               06040003
060500                                   TO TRUE                        06050003
060600             ELSE                                                 06060003
060700                 MOVE PC-TSYMSG-00070                             06070003
060800                                   TO DP020-MSG-NUMBER            06080003
060900                 SET DP020-MSG-INFORMATIONAL                      06090003
061000                                   TO TRUE                        06100003
061100             END-IF                                               06110003
061200                                                                  06120003
061300         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06130003
061400             IF  ASC-USE-SELECTION-QUEUE                          06140003
061500                 PERFORM WITH TEST AFTER                          06150003
061600                         UNTIL ASC-NUMBER-OF-ITEMS-READ > ZERO    06160003
061700                         OR    PS-LIST-END                        06170003
061800                     PERFORM 2150-GET-PREV-FUNCTION               06180003
061900                     IF  PS-LIST-END                              06190003
062000                         MOVE PC-TSYMSG-00069                     06200003
062100                                   TO DP020-MSG-NUMBER            06210003
062200                         SET DP020-MSG-INFORMATIONAL              06220003
062300                                   TO TRUE                        06230003
062400                     ELSE                                         06240003
062500                         PERFORM 2050-DELETE-DETAIL-QUEUE         06250003
062600                         PERFORM 4000-BUILD-INITIAL-PANEL         06260003
062700                     END-IF                                       06270003
062800                 END-PERFORM                                      06280003
062900                 SET PS-NO-LIST-END                               06290003
063000                                   TO TRUE                        06300003
063100             ELSE                                                 06310003
063200                 MOVE PC-TSYMSG-00069                             06320003
063300                                   TO DP020-MSG-NUMBER            06330003
063400                 SET DP020-MSG-INFORMATIONAL                      06340003
063500                                   TO TRUE                        06350003
063600             END-IF                                               06360003
063700                                                                  06370003
063800         WHEN DP020-SRC-AID = DP016-ENTER                         06380003
063900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06390003
064000                                                                  06400003
064100         WHEN OTHER                                               06410003
064200             SET DP013-NO-ROLLBACK                                06420003
064300                 DP013-XCTL-DISPLAY-RESTART                       06430003
064400                 DP013-CICS-ABEND  TO TRUE                        06440003
064500             MOVE '2100-CHECK-FUNCTION-KEY'                       06450003
064600                                   TO DP013-PARAGRAPH             06460003
064700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06470003
064800                                   TO DP013-MESSAGE-TEXT (1)      06480003
064900             PERFORM DP013-0000-PROCESS-ABEND                     06490003
065000     END-EVALUATE.                                                06500003
065100                                                                  06510003
065200/                                                                 06520003
065300*----------------------------------------------------------------*06530003
065400*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06540003
065500*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06550003
065600*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06560003
065700*    MESSAGE.                                                    *06570003
065800*----------------------------------------------------------------*06580003
065900                                                                  06590003
066000 2110-BROWSE-BACKWARD.                                            06600003
066100                                                                  06610003
066200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06620003
066300         GIVING PV-TOP-ITEM.                                      06630003
066400                                                                  06640003
066500     IF  ((PV-TOP-ITEM < +1)                                      06650003
066600       OR (PV-TOP-ITEM = +1))                                     06660003
066700         MOVE +1                   TO PV-TOP-ITEM                 06670003
066800*        -- TOP OF LIST --                                        06680003
066900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06690003
067000         SET DP020-MSG-INFORMATIONAL                              06700003
067100                                   TO TRUE                        06710003
067200     END-IF.                                                      06720003
067300                                                                  06730003
067400/                                                                 06740003
067500*----------------------------------------------------------------*06750003
067600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06760003
067700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06770003
067800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06780003
067900*----------------------------------------------------------------*06790003
068000                                                                  06800003
068100 2120-BROWSE-FORWARD.                                             06810003
068200                                                                  06820003
068300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06830003
068400         GIVING PV-TOP-ITEM.                                      06840003
068500                                                                  06850003
068600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06860003
068700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06870003
068800                                   TO PV-TOP-ITEM                 06880003
068900*        -- BOTTOM OF LIST --                                     06890003
069000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06900003
069100         SET DP020-MSG-INFORMATIONAL                              06910003
069200                                   TO TRUE                        06920003
069300     ELSE                                                         06930003
069400         COMPUTE PV-BOTTOM-ITEM =                                 06940003
069500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06950003
069600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06960003
069700*            -- BOTTOM OF LIST --                                 06970003
069800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06980003
069900             SET DP020-MSG-INFORMATIONAL                          06990003
070000                                   TO TRUE                        07000003
070100         END-IF                                                   07010003
070200     END-IF.                                                      07020003
070300                                                                  07030003
070400/                                                                 07040003
070500*----------------------------------------------------------------*07050003
070600*    GET THE KEY OF THE NEXT SELECTED OBJECT FROM THE            *07060003
070700*    THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                     *07070003
070800*----------------------------------------------------------------*07080003
070900 2140-GET-NEXT-FUNCTION.                                          07090003
071000                                                                  07100003
071100     ADD +1                        TO ASC-SEL-SUB.                07110003
071200                                                                  07120003
071300     IF  ASC-SEL-SUB > VN003-MAX-ITEMS                            07130003
071400         ADD +1                    TO ASC-SEL-ITEM                07140003
071500         MOVE +1                   TO ASC-SEL-SUB                 07150003
071600     END-IF.                                                      07160003
071700                                                                  07170003
071800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07180003
071900         PERFORM 9100-READ-SEL-QUEUE                              07190003
072000         IF  VN003-ITEM (ASC-SEL-SUB) > ZERO                      07200003
072100             MOVE VN003-ENT-ID (ASC-SEL-SUB)                      07210003
072200                                   TO DK-ENT-ID                   07220003
072300             MOVE VN003-FUNCTION-ID (ASC-SEL-SUB)                 07230003
072400                                   TO DK-FUNCTION-ID              07240003
072500             SET VN003-INQ (ASC-SEL-SUB)                          07250003
072600                                   TO TRUE                        07260003
072700             PERFORM 9200-REWRITE-LIST-QUEUE                      07270003
072800         ELSE                                                     07280003
072900             SUBTRACT +1 FROM ASC-SEL-SUB                         07290003
073000*            --- BOTTOM OF LIST ---                               07300003
073100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07310003
073200             SET DP020-MSG-INFORMATIONAL                          07320003
073300                 PS-LIST-END                                      07330003
073400                                   TO TRUE                        07340003
073500         END-IF                                                   07350003
073600     ELSE                                                         07360003
073700         SUBTRACT +1 FROM ASC-SEL-ITEM                            07370003
073800         MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB                 07380003
073900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07390003
074000         SET DP020-MSG-INFORMATIONAL                              07400003
074100             PS-LIST-END                                          07410003
074200                                   TO TRUE                        07420003
074300     END-IF.                                                      07430003
074400                                                                  07440003
074500/                                                                 07450003
074600*----------------------------------------------------------------*07460003
074700*    GET THE KEY OF THE PREVIOUS SELECTED OBJECT FROM THE        *07470014
074800*    SELECTED-ITEMS TEMP. STORAGE QUEUE.                         *07480003
074900*----------------------------------------------------------------*07490003
075000 2150-GET-PREV-FUNCTION.                                          07500003
075100                                                                  07510003
075200     SUBTRACT +1 FROM ASC-SEL-SUB.                                07520003
075300                                                                  07530003
075400     IF  ASC-SEL-SUB < +1                                         07540003
075500         SUBTRACT +1 FROM ASC-SEL-ITEM                            07550003
075600         MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB                 07560003
075700     END-IF.                                                      07570003
075800                                                                  07580003
075900     IF  ASC-SEL-ITEM > ZERO                                      07590003
076000         PERFORM 9100-READ-SEL-QUEUE                              07600003
076100         MOVE VN003-ENT-ID (ASC-SEL-SUB)                          07610003
076200                                   TO DK-ENT-ID                   07620003
076300         MOVE VN003-FUNCTION-ID (ASC-SEL-SUB)                     07630003
076400                                   TO DK-FUNCTION-ID              07640003
076500     ELSE                                                         07650003
076600         MOVE +1                   TO ASC-SEL-ITEM                07660003
076700                                      ASC-SEL-SUB                 07670003
076800*        --- TOP OF LIST ---                                      07680003
076900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07690003
077000         SET DP020-MSG-INFORMATIONAL                              07700003
077100             PS-LIST-END           TO TRUE                        07710003
077200     END-IF.                                                      07720003
077300                                                                  07730003
077400/                                                                 07740003
077500 4000-BUILD-INITIAL-PANEL.                                        07750003
077600                                                                  07760003
077700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             07770003
077800                ASC-BLOCK-ENTRIES (2).                            07780003
077900                                                                  07790003
078000     MOVE +1                       TO ASC-BLK-SUB.                07800003
078100                                                                  07810003
078200     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       07820003
078300                                                                  07830003
078400     MOVE +0                       TO ASC-ITEM-SUB                07840003
078500                                      ASC-NUMBER-OF-ITEMS-READ    07850003
078600                                      ASC-HIGHEST-BLOCK-WRITTEN   07860003
078700                                      ASC-ITEM-AT-TOP-OF-PANEL.   07870003
078800                                                                  07880003
078900     PERFORM 4010-OPEN-CURSOR.                                    07890003
079000                                                                  07900003
079100     PERFORM 4300-READ-ITEMS-FROM-DB.                             07910003
079200                                                                  07920003
079300     PERFORM 4020-CLOSE-CURSOR.                                   07930003
079400                                                                  07940003
079500     MOVE +1                       TO PV-TOP-ITEM.                07950003
079600                                                                  07960003
079700     IF  DP020-NEXT-ACT-INITIAL                                   07970003
079800     AND ASC-NUMBER-OF-ITEMS-READ = ZERO                          07980003
079900         CONTINUE                                                 07990003
080000     ELSE                                                         08000003
080100         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      08010003
080200             CONTINUE                                             08020003
080300         ELSE                                                     08030003
080400             SET DP030-SET-CURSOR-TRAILER                         08040003
080500                                   TO TRUE                        08050003
080600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08060003
080700         END-IF                                                   08070003
080800     END-IF.                                                      08080003
080900                                                                  08090003
081000/                                                                 08100003
081100*----------------------------------------------------------------*08110003
081200* OPEN THE ADDRESS CURSOR                                        *08120003
081300*----------------------------------------------------------------*08130003
081400                                                                  08140003
081500 4010-OPEN-CURSOR.                                                08150003
081600                                                                  08160003
081700     PERFORM                                                      08170003
081800         WITH TEST AFTER                                          08180003
081900         VARYING PV-RETRY-COUNTER                                 08190003
082000         FROM 1 BY 1                                              08200003
082100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08210003
082200            OR (SQLCODE = +0))                                    08220003
082300                                                                  08230003
082400         EXEC SQL                                                 08240003
082500             OPEN ADDRESS-CSR                                     08250003
082600         END-EXEC                                                 08260003
082700                                                                  08270003
082800         EVALUATE TRUE                                            08280003
082900             WHEN SQLCODE = +0                                    08290003
083000                  CONTINUE                                        08300003
083100             WHEN SQLCODE = -904                                  08310003
083200             WHEN SQLCODE = -913                                  08320003
083300                  CONTINUE                                        08330003
083400             WHEN SQLWARN0 NOT = SPACE                            08340003
083500             WHEN SQLCODE  NOT = +0                               08350003
083600                  MOVE '4010-OPEN-CURSOR'                         08360003
083700                                   TO DP013-PARAGRAPH             08370003
083800                  MOVE 'OPEN ADDRESS-CSR CURSOR'                  08380003
083900                                   TO DP013-MESSAGE-TEXT (1)      08390003
084000                  MOVE SQLCA       TO DP013-SQLCA                 08400003
084100                  MOVE 'TENTREP'   TO DP013-DB2-TABLE-NAME (1)    08410003
084200                  MOVE 'TBUSLOC'   TO DP013-DB2-TABLE-NAME (2)    08420003
084300                  MOVE 'TBUSFNC'   TO DP013-DB2-TABLE-NAME (3)    08430003
084400                  SET DP013-DB2-ABEND                             08440003
084500                                   TO TRUE                        08450003
084600                  PERFORM DP013-0000-PROCESS-ABEND                08460003
084700         END-EVALUATE                                             08470003
084800     END-PERFORM.                                                 08480003
084900                                                                  08490003
085000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08500003
085100         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             08510003
085200         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              08520003
085300                                   TO DP013-MESSAGE-TEXT (1)      08530003
085400         MOVE SQLCA                TO DP013-SQLCA                 08540003
085500         SET DP013-DB2-ABEND       TO TRUE                        08550003
085600         PERFORM DP013-0000-PROCESS-ABEND                         08560003
085700     END-IF.                                                      08570003
085800                                                                  08580003
085900/                                                                 08590003
086000*----------------------------------------------------------------*08600003
086100* CLOSE THE ADDRESS CURSOR                                       *08610003
086200*----------------------------------------------------------------*08620003
086300                                                                  08630003
086400 4020-CLOSE-CURSOR.                                               08640003
086500                                                                  08650003
086600     EXEC SQL                                                     08660003
086700         CLOSE ADDRESS-CSR                                        08670003
086800     END-EXEC.                                                    08680003
086900                                                                  08690003
087000     EVALUATE TRUE                                                08700003
087100         WHEN SQLCODE = +0                                        08710003
087200              CONTINUE                                            08720003
087300         WHEN SQLWARN0 NOT = SPACE                                08730003
087400         WHEN SQLCODE  NOT = +0                                   08740003
087500              MOVE '4020-CLOSE-CURSOR'                            08750003
087600                                   TO DP013-PARAGRAPH             08760003
087700              MOVE 'CLOSE ADDRESS-CSR CURSOR'                     08770003
087800                                   TO DP013-MESSAGE-TEXT (1)      08780003
087900              MOVE SQLCA           TO DP013-SQLCA                 08790003
088000               MOVE 'TENTREP'      TO DP013-DB2-TABLE-NAME (1)    08800003
088100               MOVE 'TBUSLOC'      TO DP013-DB2-TABLE-NAME (2)    08810003
088200               MOVE 'TBUSFNC'      TO DP013-DB2-TABLE-NAME (3)    08820003
088300              SET DP013-DB2-ABEND  TO TRUE                        08830003
088400              PERFORM DP013-0000-PROCESS-ABEND                    08840003
088500     END-EVALUATE.                                                08850003
088600                                                                  08860003
088700/                                                                 08870003
088800*----------------------------------------------------------------*08880003
088900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *08890003
089000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *08900003
089100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *08910003
089200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *08920003
089300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *08930003
089400*                                                                *08940003
089500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *08950003
089600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *08960003
089700*    UPON INITIALIZATION.                                        *08970003
089800*----------------------------------------------------------------*08980003
089900                                                                  08990003
090000 4300-READ-ITEMS-FROM-DB.                                         09000003
090100                                                                  09010003
090200     PERFORM 4320-GET-VENDOR-NAME.                                09020003
090300                                                                  09030003
090400     PERFORM                                                      09040003
090500         VARYING PV-READ-COUNT                                    09050003
090600         FROM 1 BY 1                                              09060003
090700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    09070003
090800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         09080003
090900                                                                  09090003
091000         PERFORM 4310-FETCH                                       09100003
091100                                                                  09110003
091200         IF  ASC-ITEMS-LEFT-ON-DB                                 09120003
091300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                09130003
091400                 ADD +1            TO ASC-ITEM-SUB                09140003
091500             ELSE                                                 09150003
091600                 ADD +1            TO ASC-BLK-SUB                 09160003
091700                 MOVE +1           TO ASC-ITEM-SUB                09170003
091800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         09180003
091900                     MOVE +1       TO ASC-BLK-SUB                 09190003
092000                     PERFORM 5100-WRITE-TEMP-STORAGE              09200003
092100                     MOVE ASC-BLOCK-ENTRIES                       09210003
092200                               (PC-MAX-BLOCKS-IN-ARRAY)           09220003
092300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 09230003
092400                     ADD +1        TO ASC-BLK-SUB                 09240003
092500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   09250003
092600                 END-IF                                           09260003
092700             END-IF                                               09270003
092800             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    09280003
092900             MOVE ASC-NUMBER-OF-ITEMS-READ                        09290003
093000                                   TO ASC-LIST-ITEM-NUMBER        09300003
093100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09310003
093200             MOVE ENTREP-ENT-ID      TO ASC-KEY-ENT-ID            09320003
093300             MOVE ENTREP-FUNCTION-ID TO ASC-KEY-FUNCTION-ID       09330003
093400             MOVE ENTREP-FIRST-NAME                               09340003
093500                                   TO ASC-FIRST-NAME              09350003
093600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09360003
093700             MOVE ENTREP-LAST-NAME TO ASC-LAST-NAME               09370003
093800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09380003
093900             MOVE ENTREP-TITLE-NAME                               09390003
094000                                   TO ASC-TITLE                   09400003
094100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09410003
094200             MOVE ENTREP-TEL1-NBR  TO ASC-TEL1-NBR                09420003
094300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09430003
094400             MOVE ENTREP-TEL1-EXT-NBR                             09440003
094500                                   TO ASC-TEL1-EXT-NBR            09450003
094600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09460003
094601             MOVE ENTREP-TEL-1-CNTRY-CDE                          09460106
094610                                   TO ASC-TEL1-CC-NBR             09461006
094620                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09462006
094700             MOVE ENTREP-TEL2-NBR  TO ASC-TEL2-NBR                09470003
094800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09480003
094900             MOVE ENTREP-TEL2-EXT-NBR                             09490003
095000                                   TO ASC-TEL2-EXT-NBR            09500003
095100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09510003
095110             MOVE ENTREP-TEL-2-CNTRY-CDE                          09511006
095120                                   TO ASC-TEL2-CC-NBR             09512006
095130                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09513006
095200             MOVE ENTREP-FAX-NBR   TO ASC-FAX-NBR                 09520003
095300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09530003
095400             MOVE ENTREP-EMAIL-ADDR-ID TO ASC-EMAIL-ADDR          09540003
095500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09550003
095600             MOVE ENTREP-LAST-UPDATE-TMST                         09560003
095700                                   TO PV-DB2-TIMESTAMP            09570003
095800             STRING PV-DB2-TIMESTAMP-MM DELIMITED BY SIZE         09580003
095900                    '/'                 DELIMITED BY SIZE         09590003
096000                    PV-DB2-TIMESTAMP-DD DELIMITED BY SIZE         09600003
096100                    '/'                 DELIMITED BY SIZE         09610003
096200                    PV-DB2-TIMESTAMP-CC DELIMITED BY SIZE         09620003
096300                    PV-DB2-TIMESTAMP-YY DELIMITED BY SIZE         09630003
096400                                 INTO ASC-LAST-UPDATE-DATE        09640003
096500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09650003
096600             MOVE ENTREP-LAST-UPDATE-ID                           09660003
096700                                   TO ASC-LAST-UPDATE-ID          09670003
096800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09680003
096821             EVALUATE ASC-KEY-FUNCTION-ID                         09682119
096822                                                                  09682219
096823                 WHEN PC-REMIT-FUNCTION-ID                        09682319
096824                      MOVE 'EXTD NAME.:'                          09682419
096825                                   TO ASC-ADR-EXNAM-TEXT          09682519
096826                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09682619
096827                      MOVE 'ADDRESS...:'                          09682719
096828                                   TO ASC-ADDRESS-TEXT            09682819
096829                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09682919
096830                      MOVE BUSLOC-EXTD-VND-NM                     09683019
096831                                   TO ASC-ADDR1-EXNAME            09683119
096832                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09683219
096833                      MOVE BUSLOC-ADDRESS-LINE1-DESC              09683319
096834                                   TO ASC-ADDR12-DESC             09683419
096835                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09683519
096836                      MOVE BUSLOC-ADDRESS-LINE2-DESC              09683619
096837                                   TO ASC-ADDR23-DESC             09683719
096838                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09683819
096839                      MOVE BUSLOC-ADDRESS-LINE3-DESC              09683919
096840                                   TO ASC-ADDR34-DESC             09684019
096841                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09684119
096842                                                                  09684219
096843                 WHEN PC-1099-FUNCTION-ID                         09684319
096844                      MOVE '1099 VEND.:'                          09684419
096845                                   TO ASC-ADR-EXNAM-TEXT          09684519
096846                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09684619
096847                      MOVE 'ADDRESS...:'                          09684719
096848                                   TO ASC-ADDRESS-TEXT            09684819
096849                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09684919
096850                      MOVE BUSLOC-ALT-1099-VND-NM                 09685019
096851                                   TO ASC-ADDR1-EXNAME            09685119
096852                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09685219
096853                      MOVE BUSLOC-ADDRESS-LINE1-DESC              09685319
096854                                   TO ASC-ADDR12-DESC             09685419
096855                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09685519
096856                      MOVE BUSLOC-ADDRESS-LINE2-DESC              09685619
096857                                   TO ASC-ADDR23-DESC             09685719
096858                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09685819
096859                      MOVE BUSLOC-ADDRESS-LINE3-DESC              09685919
096860                                   TO ASC-ADDR34-DESC             09686019
096861                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09686119
096862                                                                  09686219
096863                 WHEN OTHER                                       09686319
096864                      MOVE 'ADDRESS...:'                          09686419
096865                                   TO ASC-ADR-EXNAM-TEXT          09686519
096866                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09686619
096867                      MOVE SPACES  TO ASC-ADDRESS-TEXT            09686719
096868                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09686819
096869                      MOVE BUSLOC-ADDRESS-LINE1-DESC              09686919
096870                                   TO ASC-ADDR1-EXNAME            09687019
096871                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09687119
096872                      MOVE BUSLOC-ADDRESS-LINE2-DESC              09687219
096873                                   TO ASC-ADDR12-DESC             09687319
096874                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09687419
096875                      MOVE BUSLOC-ADDRESS-LINE3-DESC              09687519
096876                                   TO ASC-ADDR23-DESC             09687619
096877                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09687719
096878                      MOVE BUSLOC-ADDRESS-LINE4-DESC              09687819
096879                                   TO ASC-ADDR34-DESC             09687919
096880                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09688019
096881                                                                  09688119
096882             END-EVALUATE                                         09688219
096890                                                                  09689019
098100             MOVE BUSLOC-CITY-NAME TO ASC-CITY                    09810003
098200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09820003
098500             MOVE BUSLOC-ZIP-CDE   TO ASC-ZIP                     09850003
098600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09860003
099300             MOVE BUSLOC-ROOM-NBR  TO ASC-ROOM-NBR                09930003
099400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09940003
099500             MOVE BUSLOC-ATTENTION-TO-TXT                         09950003
099600                                   TO ASC-ATTENTION-TO-TXT        09960003
099700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09970003
099800             MOVE BUSLOC-COMMENT1-TXT                             09980003
099900                                   TO ASC-COMMENT1-TXT            09990003
100000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10000003
100100             MOVE BUSLOC-COMMENT2-TXT                             10010003
100200                                   TO ASC-COMMENT2-TXT            10020003
100300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10030003
100400             MOVE BUSLOC-COMMENT3-TXT                             10040003
100500                                   TO ASC-COMMENT3-TXT            10050003
100600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10060003
100627                                                                  10062717
100630             PERFORM 5000-RETRIEVE-ST-PRV-CNTY-NAME               10063017
100700         END-IF                                                   10070003
100800     END-PERFORM.                                                 10080003
100900                                                                  10090003
101000     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          10100003
101100         MOVE +1                   TO ASC-BLK-SUB                 10110003
101200         PERFORM 5100-WRITE-TEMP-STORAGE                          10120003
101300         ADD +1                    TO ASC-BLK-SUB                 10130003
101400         PERFORM 5100-WRITE-TEMP-STORAGE                          10140003
101500         MOVE 1                    TO ASC-BLK-SUB                 10150003
101600                                      PV-BLOCK-NUMBER             10160003
101700         PERFORM 4410-READ-TEMP-STORAGE                           10170003
101800         IF  ASC-HIGHEST-BLOCK-WRITTEN > 1                        10180003
101900             MOVE 2                TO ASC-BLK-SUB                 10190003
102000                                      PV-BLOCK-NUMBER             10200003
102100             PERFORM 4410-READ-TEMP-STORAGE                       10210003
102200         END-IF                                                   10220003
102300     END-IF.                                                      10230003
102400                                                                  10240003
102500/                                                                 10250003
102600*----------------------------------------------------------------*10260003
102700*    FETCH A ROW FROM THE ADDRESS CURSOR                         *10270003
102800*----------------------------------------------------------------*10280003
102900                                                                  10290003
103000 4310-FETCH.                                                      10300003
103100                                                                  10310003
103200     EXEC SQL                                                     10320003
103300          FETCH  ADDRESS-CSR                                      10330003
103400           INTO :ENTREP-ENT-ID                                    10340003
103500               ,:ENTREP-SEQ-NBR                                   10350003
103600               ,:ENTREP-FIRST-NAME                                10360003
103700               ,:ENTREP-LAST-NAME                                 10370003
103800               ,:ENTREP-TITLE-NAME                                10380003
103900               ,:ENTREP-TEL1-NBR                                  10390003
104000               ,:ENTREP-TEL1-EXT-NBR                              10400003
104010               ,:ENTREP-TEL-1-CNTRY-CDE                           10401006
104100               ,:ENTREP-TEL2-NBR                                  10410003
104200               ,:ENTREP-TEL2-EXT-NBR                              10420003
104210               ,:ENTREP-TEL-2-CNTRY-CDE                           10421006
104300               ,:ENTREP-FAX-NBR                                   10430003
104310               ,:BUSLOC-ROOM-NBR                                  10431006
104400               ,:ENTREP-EMAIL-ADDR-ID                             10440003
104500               ,:ENTREP-FUNCTION-ID                               10450003
104600               ,:ENTREP-LAST-UPDATE-TMST                          10460003
104700               ,:ENTREP-LAST-UPDATE-ID                            10470003
104800               ,:BUSLOC-ADDRESS-LINE1-DESC                        10480003
104900               ,:BUSLOC-ADDRESS-LINE2-DESC                        10490003
105000               ,:BUSLOC-ADDRESS-LINE3-DESC                        10500003
105100               ,:BUSLOC-ADDRESS-LINE4-DESC                        10510019
105200               ,:BUSLOC-ATTENTION-TO-TXT                          10520003
105300               ,:BUSLOC-CITY-NAME                                 10530003
105400               ,:BUSLOC-ST-PROV-CDE                               10540006
105500               ,:BUSLOC-ZIP-CDE                                   10550003
105600               ,:BUSLOC-CNTRY-CDE                                 10560006
105900               ,:BUSLOC-COMMENT1-TXT                              10590003
106000               ,:BUSLOC-COMMENT2-TXT                              10600003
106100               ,:BUSLOC-COMMENT3-TXT                              10610003
106200               ,:ASC-FUNCTION-NAME                                10620003
106210               ,:BUSLOC-EXTD-VND-NM                               10621017
106220               ,:BUSLOC-ALT-1099-VND-NM                           10622017
106300     END-EXEC.                                                    10630003
106400                                                                  10640003
106500     EVALUATE TRUE                                                10650003
106600         WHEN SQLCODE = +0                                        10660003
106700              CONTINUE                                            10670003
106800         WHEN SQLCODE = +100                                      10680003
106900              SET ASC-NO-ITEMS-LEFT-ON-DB                         10690003
107000                                   TO TRUE                        10700003
107100         WHEN SQLWARN0 NOT = SPACE                                10710003
107200         WHEN SQLCODE < +0                                        10720003
107300         WHEN SQLCODE > +0                                        10730003
107400              MOVE '4310-FETCH-CURSOR'                            10740003
107500                                   TO DP013-PARAGRAPH             10750003
107600              MOVE 'FETCH ADDRESS CURSOR'                         10760003
107700                                   TO DP013-MESSAGE-TEXT (1)      10770003
107800              MOVE SQLCA           TO DP013-SQLCA                 10780003
107900              MOVE 'TENTREP'       TO DP013-DB2-TABLE-NAME (1)    10790003
108000              MOVE 'TBUSLOC'       TO DP013-DB2-TABLE-NAME (2)    10800003
108100              SET DP013-DB2-ABEND  TO TRUE                        10810003
108200              PERFORM DP013-0000-PROCESS-ABEND                    10820003
108300     END-EVALUATE.                                                10830003
108400                                                                  10840003
108500/                                                                 10850003
108600*----------------------------------------------------------------*10860003
108700* GET THE VENDOR NAME                                            *10870003
108800*----------------------------------------------------------------*10880003
108900                                                                  10890003
109000 4320-GET-VENDOR-NAME.                                            10900003
109100                                                                  10910003
109200     PERFORM                                                      10920003
109300         WITH TEST AFTER                                          10930003
109400         VARYING PV-RETRY-COUNTER                                 10940003
109500         FROM 1 BY 1                                              10950003
109600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10960003
109700            OR (SQLCODE = +0))                                    10970003
109800                                                                  10980003
109900         EXEC SQL                                                 10990003
110000             SELECT A.ENT_NAME_DESC                               11000003
110100                  , B.DUN_NBR                                     11010003
110200              INTO  :ENTNME-ENT-NAME-DESC                         11020003
110300                  , :EXTENT-DUN-NBR                               11030003
110400              FROM  TENTNME A                                     11040003
110500                 ,  TEXTENT B                                     11050003
110600              WHERE A.ENT_ID   = :DK-ENT-ID                       11060003
110700                AND A.ENT_ID   = B.ENT_ID                         11070003
110800                AND A.TYPE_CDE = '01'                             11080003
110900         END-EXEC                                                 11090003
111000                                                                  11100003
111100         EVALUATE TRUE                                            11110003
111200             WHEN SQLCODE = +0                                    11120003
111300                 MOVE ENTNME-ENT-NAME-DESC                        11130003
111400                                 TO ASC-VENDOR-NAME               11140003
111500                 MOVE EXTENT-DUN-NBR                              11150003
111600                                 TO ASC-DUN-NBR                   11160003
111700             WHEN SQLCODE = -904                                  11170003
111800             WHEN SQLCODE = -913                                  11180003
111900                 CONTINUE                                         11190003
112000             WHEN SQLWARN0 NOT = SPACE                            11200003
112100             WHEN SQLCODE < +0                                    11210003
112200             WHEN SQLCODE > +0                                    11220003
112300                 MOVE '4320-GET-VENDOR-NAME'                      11230003
112400                                 TO DP013-PARAGRAPH               11240003
112500                 MOVE 'SELECT ON ENTERPRISE NAME TABLE'           11250003
112600                                 TO DP013-MESSAGE-TEXT (1)        11260003
112700                 MOVE SQLCA      TO DP013-SQLCA                   11270003
112800                 MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (1)      11280003
112900                     SET DP013-DB2-ABEND                          11290003
113000                         DP013-XCTL-DISPLAY-RESTART               11300003
113100                                 TO TRUE                          11310003
113200                 PERFORM DP013-0000-PROCESS-ABEND                 11320003
113300         END-EVALUATE                                             11330003
113400     END-PERFORM.                                                 11340003
113500                                                                  11350003
113600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11360003
113700         MOVE '4320-GET-VENDOR-NAME' TO DP013-PARAGRAPH           11370003
113800         MOVE 'MAX RETRIES EXCEEDED FOR SELECT ON TENTNME'        11380003
113900                                   TO DP013-MESSAGE-TEXT (1)      11390003
114000         MOVE SQLCA                TO DP013-SQLCA                 11400003
114100         SET DP013-DB2-ABEND       TO TRUE                        11410003
114200         PERFORM DP013-0000-PROCESS-ABEND                         11420003
114300     END-IF.                                                      11430003
114400                                                                  11440003
114500/                                                                 11450003
114600*----------------------------------------------------------------*11460003
114700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *11470003
114800*----------------------------------------------------------------*11480003
114900                                                                  11490003
115000 4400-MOVE-COMMAREA-TO-SCREEN.                                    11500003
115100                                                                  11510003
115200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             11520003
115300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          11530003
115400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          11540003
115500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             11550003
115600                 GIVING PV-BLOCK-NUMBER                           11560003
115700                 REMAINDER PV-REMAINDER                           11570003
115800             IF  PV-REMAINDER > ZERO                              11580003
115900                 ADD +1           TO PV-BLOCK-NUMBER              11590003
116000             END-IF                                               11600003
116100             MOVE +1              TO ASC-BLK-SUB                  11610003
116200             PERFORM 4410-READ-TEMP-STORAGE                       11620003
116300             ADD +1               TO ASC-BLK-SUB                  11630003
116400                                     PV-BLOCK-NUMBER              11640003
116500             PERFORM 4410-READ-TEMP-STORAGE                       11650003
116600     END-IF.                                                      11660003
116700                                                                  11670003
116800     MOVE +1                       TO ASC-BLK-SUB.                11680003
116900                                                                  11690003
117000     COMPUTE ASC-ITEM-SUB =                                       11700003
117100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              11710003
117200         + PC-ITEMS-PER-PANEL).                                   11720003
117300                                                                  11730003
117400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11740003
117500         ADD +1                    TO ASC-BLK-SUB                 11750003
117600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11760003
117700     END-IF.                                                      11770003
117800                                                                  11780003
117900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           11790003
118000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                11800003
118100                                                                  11810003
118200     PERFORM 4420-FORMAT-LIST-LINES                               11820003
118300         VARYING PV-SUB                                           11830003
118400         FROM PC-ITEMS-PER-PANEL BY -1                            11840003
118500         UNTIL PV-SUB < +1.                                       11850003
118600                                                                  11860003
118700     COMPUTE ASC-ITEMS-DISPLAYED =                                11870003
118800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          11880003
118900                                                                  11890003
119000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   11900003
119100                                                                  11910003
119200     MOVE ASC-VENDOR-NAME          TO AVNNAMEO.                   11920003
119300     MOVE ASC-DUN-NBR              TO ADUNSO.                     11930003
119400     MOVE ASC-FUNCTION-NAME        TO AFUNCNMO.                   11940003
119500                                                                  11950003
119600     IF  DP020-MSG-NUMBER-X = SPACE                               11960003
119700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  11970003
119800*            --- MORE ITEMS TO DISPLAY ----                       11980003
119900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            11990003
120000             SET DP020-MSG-INFORMATIONAL                          12000003
120100                                   TO TRUE                        12010003
120200         END-IF                                                   12020003
120300     END-IF.                                                      12030003
120400                                                                  12040003
120500/                                                                 12050003
120600*----------------------------------------------------------------*12060003
120700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *12070003
120800*----------------------------------------------------------------*12080003
120900                                                                  12090003
121000 4410-READ-TEMP-STORAGE.                                          12100003
121100                                                                  12110003
121200     EXEC CICS                                                    12120003
121300         READQ TS                                                 12130003
121400             QUEUE (ASC-DTL-QUEUE-NAME)                           12140003
121500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               12150003
121600             ITEM  (PV-BLOCK-NUMBER)                              12160003
121700             RESP  (PV-CICS-RESP)                                 12170003
121800     END-EXEC.                                                    12180003
121900                                                                  12190003
122000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       12200003
122100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     12210003
122200         CONTINUE                                                 12220003
122300     ELSE                                                         12230003
122400         SET DP013-CICS-ABEND      TO TRUE                        12240003
122500         SET DP013-NO-ROLLBACK     TO TRUE                        12250003
122600         MOVE '4410-READ-TEMP-STORAGE'                            12260003
122700                                   TO DP013-PARAGRAPH             12270003
122800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      12280003
122900                                   TO DP013-MESSAGE-TEXT(1)       12290003
123000         PERFORM DP013-0000-PROCESS-ABEND                         12300003
123100     END-IF.                                                      12310003
123200                                                                  12320003
123300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         12330003
123400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               12340003
123500     END-IF.                                                      12350003
123600                                                                  12360003
123700/                                                                 12370003
123800*----------------------------------------------------------------*12380003
123900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *12390003
124000*----------------------------------------------------------------*12400003
124100                                                                  12410003
124200 4420-FORMAT-LIST-LINES.                                          12420003
124300                                                                  12430003
124400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      12440003
124500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                12450003
124600         MOVE SPACES               TO AVNNAMEO                    12460003
124700                                      ADUNSO                      12470003
124800                                      AFUNCNMO                    12480003
124900                                      AFNAMEO                     12490003
125000                                      ALNAMEO                     12500003
125100                                      ATITLEO                     12510003
125200                                      APHONE1O                    12520003
125300                                      AEXT1O                      12530003
125310                                      ACPC1O                      12531008
125400                                      APHONE2O                    12540003
125500                                      AEXT2O                      12550003
125510                                      ACPC2O                      12551008
125600                                      AFAXO                       12560003
125610                                      AROOMO                      12561008
125700                                      AEMAILO                     12570003
125800                                      AUPDTO                      12580003
125900                                      AUPIDO                      12590003
125910                                      AD1ENMTO                    12591019
125920                                      AD1ENMO                     12592019
126000                                      AADDR12O                    12600019
126100                                      AADDR23O                    12610019
126200                                      AADDR34O                    12620019
126400                                      ACITYO                      12640003
126410                                      AZIPCDEO                    12641008
126500                                      ASTPRVCO                    12650024
126600                                      ASTPRVO                     12660024
126700                                      ACNTRYCO                    12670024
126800                                      ACNTRYO                     12680024
127000                                      AATTNTOO                    12700003
127100                                      ACOMM1O                     12710003
127200                                      ACOMM2O                     12720003
127300                                      ACOMM3O                     12730003
127400     ELSE                                                         12740003
127500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           12750003
127600             MOVE ASC-FIRST-NAME (ASC-BLK-SUB ASC-ITEM-SUB)       12760003
127700                                   TO AFNAMEO                     12770003
127800             MOVE ASC-LAST-NAME (ASC-BLK-SUB ASC-ITEM-SUB)        12780003
127900                                   TO ALNAMEO                     12790003
128000             MOVE ASC-TITLE (ASC-BLK-SUB ASC-ITEM-SUB)            12800003
128100                                   TO ATITLEO                     12810003
128200             MOVE ASC-TEL1-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         12820003
128300                                   TO APHONE1O                    12830003
128400             MOVE ASC-TEL1-EXT-NBR (ASC-BLK-SUB ASC-ITEM-SUB)     12840003
128500                                   TO AEXT1O                      12850003
128510             MOVE ASC-TEL1-CC-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)     12851008
128520                                   TO ACPC1O                      12852008
128600             MOVE ASC-TEL2-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         12860003
128700                                   TO APHONE2O                    12870003
128800             MOVE ASC-TEL2-EXT-NBR (ASC-BLK-SUB ASC-ITEM-SUB)     12880003
128900                                   TO AEXT2O                      12890003
128910             MOVE ASC-TEL2-CC-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)     12891008
128920                                   TO ACPC2O                      12892008
129000             MOVE ASC-FAX-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          12900003
129100                                   TO AFAXO                       12910003
129110             MOVE ASC-ROOM-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         12911008
129120                                   TO AROOMO                      12912008
129200             MOVE ASC-EMAIL-ADDR (ASC-BLK-SUB ASC-ITEM-SUB)       12920003
129300                                   TO AEMAILO                     12930003
129400             MOVE ASC-LAST-UPDATE-DATE (ASC-BLK-SUB ASC-ITEM-SUB) 12940003
129500                                   TO AUPDTO                      12950003
129600             MOVE ASC-LAST-UPDATE-ID (ASC-BLK-SUB ASC-ITEM-SUB)   12960003
129700                                   TO AUPIDO                      12970003
129730             MOVE ASC-ADDR1-EXNAME (ASC-BLK-SUB ASC-ITEM-SUB)     12973019
129740                                   TO AD1ENMO                     12974019
129800             MOVE ASC-ADDR12-DESC (ASC-BLK-SUB ASC-ITEM-SUB)      12980019
129900                                   TO AADDR12O                    12990020
130000             MOVE ASC-ADDR23-DESC (ASC-BLK-SUB ASC-ITEM-SUB)      13000019
130100                                   TO AADDR23O                    13010020
130200             MOVE ASC-ADDR34-DESC (ASC-BLK-SUB ASC-ITEM-SUB)      13020019
130300                                   TO AADDR34O                    13030020
130600             MOVE ASC-CITY (ASC-BLK-SUB ASC-ITEM-SUB)             13060003
130700                                   TO ACITYO                      13070003
131000             MOVE ASC-ZIP (ASC-BLK-SUB ASC-ITEM-SUB)              13100003
131100                                   TO AZIPCDEO                    13110003
131110             MOVE ASC-ST-PROV-CDE (ASC-BLK-SUB ASC-ITEM-SUB)      13111024
131120                                   TO ASTPRVCO                    13112024
131130             MOVE ASC-ST-PROV (ASC-BLK-SUB ASC-ITEM-SUB)          13113024
131140                                   TO ASTPRVO                     13114024
131200             MOVE ASC-COUNTRY-CDE (ASC-BLK-SUB ASC-ITEM-SUB)      13120024
131300                                   TO ACNTRYCO                    13130024
131400             MOVE ASC-COUNTRY (ASC-BLK-SUB ASC-ITEM-SUB)          13140024
131500                                   TO ACNTRYO                     13150024
131800             MOVE ASC-ATTENTION-TO-TXT (ASC-BLK-SUB ASC-ITEM-SUB) 13180003
131900                                   TO AATTNTOO                    13190003
132000             MOVE ASC-COMMENT1-TXT (ASC-BLK-SUB ASC-ITEM-SUB)     13200003
132100                                   TO ACOMM1O                     13210003
132200             MOVE ASC-COMMENT2-TXT (ASC-BLK-SUB ASC-ITEM-SUB)     13220003
132300                                   TO ACOMM2O                     13230003
132400             MOVE ASC-COMMENT3-TXT (ASC-BLK-SUB ASC-ITEM-SUB)     13240003
132500                                   TO ACOMM3O                     13250003
132501                                                                  13250119
132502             EVALUATE ASC-KEY-FUNCTION-ID                         13250219
132503                                                                  13250319
132504                 WHEN PC-REMIT-FUNCTION-ID                        13250419
132505                 WHEN PC-1099-FUNCTION-ID                         13250519
132506                      MOVE ASC-ADR-EXNAM-TEXT                     13250620
132507                           (ASC-BLK-SUB ASC-ITEM-SUB)             13250720
132508                                                TO AD1ENMTO       13250820
132509                      MOVE ASC-ADDRESS-TEXT                       13250920
132510                           (ASC-BLK-SUB ASC-ITEM-SUB)             13251020
132511                                                TO ADDR12TO       13251120
132512                 WHEN OTHER                                       13251219
132513                      MOVE ASC-ADR-EXNAM-TEXT                     13251320
132514                           (ASC-BLK-SUB ASC-ITEM-SUB)             13251420
132515                                                TO AD1ENMTO       13251520
132516                      MOVE SPACES               TO ADDR12TO       13251619
132517                                                                  13251719
132518             END-EVALUATE                                         13251819
132520                                                                  13252019
132600         END-IF                                                   13260003
132700     END-IF.                                                      13270003
132800                                                                  13280003
132900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13290003
133000                                                                  13300003
133100     IF  ASC-ITEM-SUB < + 1                                       13310003
133200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13320003
133300         MOVE +1                   TO ASC-BLK-SUB                 13330003
133400     END-IF.                                                      13340003
133500                                                                  13350003
133501*----------------------------------------------------------------*13350116
133502*    RETRIEVE COUNTRY AND STATE NAME                             *13350216
133503*----------------------------------------------------------------*13350316
133504 5000-RETRIEVE-ST-PRV-CNTY-NAME.                                  13350407
133505                                                                  13350507
133506     MOVE BUSLOC-ST-PROV-CDE     TO DP410-STATE-CODE.             13350609
133507     MOVE BUSLOC-CNTRY-CDE       TO DP410-COUNTRY-CODE.           13350709
133508                                                                  13350807
133509     CALL PC-DPKUT410 USING DFHEIBLK                              13350915
133510                            PV-DPKUT410-COMMAREA                  13351015
133511                            DP410-ST-PROV-CNTRY-ROUTINE.          13351115
133512                                                                  13351207
133513     EVALUATE TRUE                                                13351313
133514                                                                  13351413
133515         WHEN  DP410-NO-ERRORS                                    13351513
133516             MOVE DP410-STATE-CODE   TO ASC-ST-PROV-CDE           13351624
133517                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13351724
133518             MOVE DP410-STATE-NAME   TO ASC-ST-PROV               13351813
133519                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13351913
133520             IF DP410-COUNTRY-CODE = 'US '                        13352025
133521                 MOVE SPACES         TO ASC-COUNTRY-CDE           13352125
133522                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13352224
133523             ELSE                                                 13352325
133524                 MOVE DP410-COUNTRY-CODE TO ASC-COUNTRY-CDE       13352425
133525                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13352525
133526             END-IF                                               13352625
133527             MOVE DP410-COUNTRY-NAME TO ASC-COUNTRY               13352725
133528                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13352825
133529                                                                  13352925
133530         WHEN  DP410-DEADLOCK-BYPASS-ROUTINE                      13353025
133531             MOVE DP410-STATE-CODE TO ASC-ST-PROV-CDE             13353125
133532                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13353225
133535             IF DP410-COUNTRY-CODE = 'US '                        13353525
133536                 MOVE SPACES         TO ASC-COUNTRY-CDE           13353625
133537                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13353725
133538             ELSE                                                 13353825
133539                 MOVE DP410-COUNTRY-CODE TO ASC-COUNTRY-CDE       13353925
133540                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13354025
133541             END-IF                                               13354125
133542             MOVE SPACES             TO ASC-ST-PROV               13354225
133543                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13354325
133544                                        ASC-COUNTRY               13354425
133545                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13354525
133546                                                                  13354625
133547         WHEN  DP410-DB2-ERROR                                    13354725
133548             MOVE DP410-PARAGRAPH-NAME                            13354825
133549                                     TO DP013-PARAGRAPH           13354913
133550             MOVE DP410-PROGRAM-NAME TO DP013-MESSAGE-TEXT (1)    13355013
133560             MOVE DP410-MESSAGE      TO DP013-MESSAGE-TEXT (2)    13356013
133570             MOVE DP410-SQLCODE      TO DP013-SQLCA               13357013
133592             SET DP013-DB2-ABEND     TO TRUE                      13359213
133594             PERFORM DP013-0000-PROCESS-ABEND                     13359413
133595                                                                  13359513
133596         WHEN OTHER                                               13359613
133597             MOVE DP410-STATE-CODE   TO ASC-ST-PROV-CDE           13359724
133598                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13359824
133603             MOVE DP410-STATE-NAME   TO ASC-ST-PROV               13360313
133604                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13360413
133607             IF DP410-COUNTRY-CODE = 'US '                        13360725
133608                 MOVE SPACES         TO ASC-COUNTRY-CDE           13360825
133609                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13360925
133610             ELSE                                                 13361025
133611                 MOVE DP410-COUNTRY-CODE TO ASC-COUNTRY-CDE       13361125
133612                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13361225
133613             END-IF                                               13361325
133614             MOVE DP410-COUNTRY-NAME TO ASC-COUNTRY               13361413
133615                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13361513
133616     END-EVALUATE.                                                13361613
133620/                                                                 13362003
133700*----------------------------------------------------------------*13370003
133800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *13380003
133900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *13390003
134000*----------------------------------------------------------------*13400003
134100                                                                  13410003
134200 5100-WRITE-TEMP-STORAGE.                                         13420003
134300                                                                  13430003
134400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     13440003
134500                                   TO PV-LIST-ITEM-NUMBER.        13450003
134600                                                                  13460003
134700     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                           13470003
134800         ASC-HIGHEST-BLOCK-WRITTEN + 1.                           13480003
134900                                                                  13490003
135000     EXEC CICS                                                    13500003
135100         WRITEQ TS                                                13510003
135200             QUEUE (ASC-DTL-QUEUE-NAME)                           13520003
135300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               13530003
135400             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                     13540003
135500             RESP  (PV-CICS-RESP)                                 13550003
135600     END-EXEC.                                                    13560003
135700                                                                  13570003
135800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      13580003
135900         SET DP013-CICS-ABEND                                     13590003
136000             DP013-NO-ROLLBACK     TO TRUE                        13600003
136100         MOVE '5100-WRITE-TEMP-STORAGE'                           13610003
136200                                   TO DP013-PARAGRAPH             13620003
136300         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'       13630003
136400                                   TO DP013-MESSAGE-TEXT(1)       13640003
136500         PERFORM DP013-0000-PROCESS-ABEND                         13650003
136600     END-IF.                                                      13660003
136700                                                                  13670003
136800     ADD +1                        TO ASC-HIGHEST-BLOCK-WRITTEN.  13680003
136900                                                                  13690003
137000/                                                                 13700003
137100*----------------------------------------------------------------*13710003
137200*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *13720003
137300*----------------------------------------------------------------*13730003
137400                                                                  13740003
137500 9100-READ-SEL-QUEUE.                                             13750003
137600     EXEC CICS                                                    13760003
137700         READQ TS                                                 13770003
137800             QUEUE (ASC-SEL-QUEUE-NAME)                           13780003
137900             INTO  (VN003-VENDOR-SEL-REC)                         13790003
138000             ITEM  (ASC-SEL-ITEM)                                 13800003
138100             RESP  (PV-CICS-RESP)                                 13810003
138200     END-EXEC.                                                    13820003
138300                                                                  13830003
138400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       13840003
138500         CONTINUE                                                 13850003
138600     ELSE                                                         13860003
138700         SET DP013-LOGIC-ABEND                                    13870003
138800             DP013-NO-ROLLBACK     TO TRUE                        13880003
138900         MOVE '9100-READ-SEL-QUEUE'                               13890003
139000                                   TO DP013-PARAGRAPH             13900003
139100         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   13910003
139200                                   TO DP013-MESSAGE-TEXT (1)      13920003
139300         PERFORM DP013-0000-PROCESS-ABEND                         13930003
139400     END-IF.                                                      13940003
139500                                                                  13950003
139600/                                                                 13960003
139700*----------------------------------------------------------------*13970003
139800*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *13980003
139900*----------------------------------------------------------------*13990003
140000 9200-REWRITE-LIST-QUEUE.                                         14000003
140100     EXEC CICS                                                    14010003
140200          WRITEQ TS                                               14020003
140300              QUEUE  (ASC-SEL-QUEUE-NAME)                         14030003
140400              FROM   (VN003-VENDOR-SEL-REC)                       14040003
140500              ITEM   (ASC-SEL-ITEM)                               14050003
140600              RESP   (PV-CICS-RESP)                               14060003
140700              REWRITE                                             14070003
140800     END-EXEC.                                                    14080003
140900                                                                  14090003
141000     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   14100003
141100         SET DP013-CICS-ABEND                                     14110003
141200             DP013-NO-ROLLBACK     TO TRUE                        14120003
141300         MOVE '9200-REWRITE-LIST-QUEUE'                           14130003
141400                                   TO DP013-PARAGRAPH             14140003
141500         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   14150003
141600                                   TO DP013-MESSAGE-TEXT (1)      14160003
141700         PERFORM DP013-0000-PROCESS-ABEND                         14170003
141800     END-IF.                                                      14180003
141900                                                                  14190003
142000/                                                                 14200003
142100*----------------------------------------------------------------*14210003
142200*    ABEND PROCESSOR MODULE                                      *14220003
142300*----------------------------------------------------------------*14230003
142400                                                                  14240003
142500     COPY DPPD013.                                                14250003
