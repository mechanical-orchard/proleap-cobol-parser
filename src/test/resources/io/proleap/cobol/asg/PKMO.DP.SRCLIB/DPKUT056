000100 IDENTIFICATION DIVISION.                                         00010000
000200*                                                                 00020000
000300 PROGRAM-ID.    DPKUT056.                                         00030000
000400*                                                                 00040000
000500 AUTHOR.        CALVIN BUSH.                                      00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  10/01/91.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000** THIS PROGRAM WILL EXTRACT INFORMATION FROM THE CICS ARCHI-   **00100000
001100** TECTURE TABLES.  THIS INFORMATION WILL THEN BE LOADED INTO   **00110000
001200** ARCHITECTURE TABLES FOR A DIFFERENT REGION.                  **00120000
001300**                                                              **00130000
001400** THE EXTRACT WILL BE DONE FOR EACH MNEMONIC PROVIDED IN A     **00140000
001500** CONTROL FILE.  FOR EACH MNEMONIC, THIS PROGRAM WILL EXTRACT  **00150000
001600** INFORMATION FROM THE FOLLOWING TABLES: TMNEMONIC, TCICSROUTE,**00160000
001700** TMENUITEM.  THERE MAY NOT BE ANY ENTRIES IN TMENUITEM FOR A  **00170000
001800** GIVEN MNEMONIC.                                              **00180000
001900**                                                              **00190000
002000** CHANGES:                                                     **00200000
002100**   12-09-1992  (CAL BUSH)  --  WR#2170                        **00210000
002200**   - PASS RETURN CODE OF 8 IF ONE OR MORE MNEMONICS WAS NOT   **00220000
002300**     FOUND.                                                   **00230000
002400**                                                              **00240000
002410**   04-16-1996  (CAL BUSH)  --  WR#3767                        **00241000
002420**   - ADD FKEY-DISPN-IND TO OUTPUT RECORD.                     **00242000
002440**                                                              **00244000
980828**   08-28-1998  (JEFF ROUBIK)  --  WR10232                     **00241000
980828**   - MODIFIED TMENUITEM_CURSOR TO SELECT ITEMS BY MENU_NAME   **00242000
980828**     TOO.  THAT WAY THE WHOLE MENU WILL BE REFRESHED INCASE   **00242000
980828**     A SEQUENCE NUMBER CHANGED.                               **00242000
980828**                                                              **00244000
990909**   09-09-1999  (JEFF ROUBIK)  --  WR10808                     **00241000
990909**   - ADDED ACCURATE LOCATION REQUIRED INDICATOR TO MNEMONIC   **00242000
990909**     TABLE.                                                   **00242000
002900**                                                              **00290000
003000******************************************************************00300000
003100     EJECT                                                        00310000
003200 ENVIRONMENT DIVISION.                                            00320000
003300                                                                  00330000
003400 CONFIGURATION SECTION.                                           00340000
003500                                                                  00350000
003600 SOURCE-COMPUTER.                        IBM-3090.                00360000
003700 OBJECT-COMPUTER.                        IBM-3090.                00370000
003800                                                                  00380000
003900 INPUT-OUTPUT SECTION.                                            00390000
004000                                                                  00400000
004100 FILE-CONTROL.                                                    00410000
004200                                                                  00420000
004300     SELECT INPUT-MNEMONIC-FILE          ASSIGN TO INP01.         00430000
004400                                                                  00440000
004500     SELECT TMNEMONIC-EXT-FILE           ASSIGN TO OUT01.         00450000
004600                                                                  00460000
004700     SELECT TMENUITEM-EXT-FILE           ASSIGN TO OUT02.         00470000
004800                                                                  00480000
004900     SELECT TCICSROUTE-EXT-FILE          ASSIGN TO OUT03.         00490000
005000                                                                  00500000
005100******************************************************************00510000
005200 DATA DIVISION.                                                   00520000
005300******************************************************************00530000
005400                                                                  00540000
005500 FILE SECTION.                                                    00550000
005600                                                                  00560000
005700 FD  INPUT-MNEMONIC-FILE                                          00570000
005800     RECORDING MODE IS F                                          00580000
005900     LABEL RECORDS ARE STANDARD                                   00590000
006000     BLOCK CONTAINS 0 RECORDS                                     00600000
006100     RECORD CONTAINS 80 CHARACTERS.                               00610000
006200                                                                  00620000
006300 01  INPUT-MNEMONIC-RECORD          PIC X(80).                    00630000
006400                                                                  00640000
006500 FD  TMNEMONIC-EXT-FILE                                           00650000
006600     RECORDING MODE IS F                                          00660000
006700     LABEL RECORDS ARE STANDARD                                   00670000
006800     BLOCK CONTAINS 0 RECORDS                                     00680000
006900     RECORD CONTAINS 127 CHARACTERS.                              00690000
007000                                                                  00700000
990909 01  TMNEMONIC-EXT-RECORD           PIC X(127).                           
007200                                                                  00720000
007300 FD  TMENUITEM-EXT-FILE                                           00730000
007400     RECORDING MODE IS F                                          00740000
007500     LABEL RECORDS ARE STANDARD                                   00750000
007600     BLOCK CONTAINS 0 RECORDS                                     00760000
007700     RECORD CONTAINS 76 CHARACTERS.                               00770000
007800                                                                  00780000
007900 01  TMENUITEM-EXT-RECORD           PIC X(76).                    00790000
008000                                                                  00800000
008100 FD  TCICSROUTE-EXT-FILE                                          00810000
008200     RECORDING MODE IS F                                          00820000
008300     LABEL RECORDS ARE STANDARD                                   00830000
008400     BLOCK CONTAINS 0 RECORDS                                     00840000
008500     RECORD CONTAINS 56 CHARACTERS.                               00850000
008600                                                                  00860000
008700 01  TCICSROUTE-EXT-RECORD           PIC X(56).                   00870000
008800     EJECT                                                        00880000
008900 WORKING-STORAGE SECTION.                                         00890000
009000                                                                  00900000
009100 01  DK-DB2-KEYS.                                                 00910000
009200     05  DK-MNEMONIC             PIC  X(08)  VALUE SPACE.         00920000
009300*                                                                 00930000
009400 01  IR-INPUT-RECORD-LAYOUT.                                      00940000
009500     05  IR-MNEMONIC             PIC  X(08)  VALUE SPACE.         00950000
009600     05  FILLER                  PIC  X(72)  VALUE SPACE.         00960000
009700*                                                                 00970000
009800 01  IV-INDICATOR-VARIABLES.                                      00980000
009900     05  IV-DESC                 PIC S9(04)  VALUE +0 COMP.       00990000
010000*                                                                 01000000
010100 01  PV-PROGRAM-VARIABLES.                                        01010000
010200     05  PV-PARAGRAPH-NAME       PIC  X(30)  VALUE SPACE.         01020000
010300     05  PV-DB2-OPERATION-ATTEMPTED                               01030000
010400                                 PIC  X(30)  VALUE SPACE.         01040000
010500     05  PV-TMNEMONIC-COUNT      PIC S9(05)   VALUE +0 COMP-3.    01050000
010600     05  PV-TMENUITEM-COUNT      PIC S9(05)   VALUE +0 COMP-3.    01060000
010700     05  PV-TCICSROUTE-COUNT     PIC S9(05)   VALUE +0 COMP-3.    01070000
010800*                                                                 01080000
010900 01  PS-PROGRAM-SWITCHES.                                         01090000
011000     05  PS-END-OF-INPUT-SW      PIC  X(01)   VALUE 'N'.          01100000
011100         88  PS-END-OF-INPUT                  VALUE 'Y'.          01110000
011200     05  PS-END-OF-TMENUITEM-TABLE-SW                             01120000
011300                                 PIC  X(01)   VALUE 'N'.          01130000
011400         88  PS-END-OF-TMENUITEM-TABLE        VALUE 'Y'.          01140000
011500     05  PS-END-OF-TCICSROUTE-TABLE-SW                            01150000
011600                                 PIC  X(01)   VALUE 'N'.          01160000
011700         88  PS-END-OF-TCICSROUTE-TABLE       VALUE 'Y'.          01170000
011800     05  PS-SET-RC-8-SW          PIC  X(01)   VALUE 'N'.          01180000
011900         88  PS-SET-RC-8                      VALUE 'Y'.          01190000
012000*                                                                 01200000
012100 01  ABEND-CODE                  PIC S9(04)   VALUE +0            01210000
012200                                 COMP SYNC.                       01220000
012300*                                                                 01230000
012400*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                01240000
012500*                                                                 01250000
012600                                                                  01260000
012700     EXEC SQL                                                     01270000
012800         INCLUDE SQLCA                                            01280000
012900     END-EXEC.                                                    01290000
013000*                                                                 01300000
013100*  VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        01310000
013200*                                                                 01320000
013300     COPY DPWS004.                                                01330000
013400                                                                  01340000
013500******************************************************************01350000
013600*  DCLGEN FOR MNEMONIC TABLE                                      01360000
013700******************************************************************01370000
013800     EXEC SQL                                                     01380000
013900         INCLUDE TMNMNC                                           01390000
014000     END-EXEC.                                                    01400000
014100                                                                  01410000
014200******************************************************************01420000
014300*  DCLGEN FOR MENUITEM TABLE                                      01430000
014400******************************************************************01440000
014500     EXEC SQL                                                     01450000
014600         INCLUDE TMNUITM                                          01460000
014700     END-EXEC.                                                    01470000
014800                                                                  01480000
014900******************************************************************01490000
015000*  DCLGEN FOR CICS ROUTE TABLE                                    01500000
015100******************************************************************01510000
015200     EXEC SQL                                                     01520000
015300         INCLUDE TCICSRTE                                         01530000
015400     END-EXEC.                                                    01540000
015500******************************************************************01550000
015600*  SELECT FOR TMENUITEM TABLE                                     01560000
015700******************************************************************01570000
015800     EXEC SQL                                                     01580000
015900         DECLARE    TMENUITEM_CURSOR CURSOR FOR                   01590000
016000             SELECT MENU_NAME,                                    01600000
016100                    ITEM_MNEMONIC_CODE,                           01610000
016200                    DESC,                                         01620000
016300                    SEQUENCE_NMBR,                                01630000
016400                    LAST_UPDATE_TMESTP,                           01640000
016500                    IN_APLCTN_COMM_CDE                            01650000
016600             FROM   TMENUITEM                                     01660000
016700             WHERE  ITEM_MNEMONIC_CODE = :DK-MNEMONIC             01670000
980828                OR  MENU_NAME          = :DK-MNEMONIC                     
016800     END-EXEC.                                                    01680000
016900                                                                  01690000
017000******************************************************************01700000
017100*  SELECT FOR TCICSROUTE TABLE                                    01710000
017200******************************************************************01720000
017300     EXEC SQL                                                     01730000
017400         DECLARE    TCICSROUTE_CURSOR CURSOR FOR                  01740000
017500             SELECT MNEMONIC_CODE,                                01750000
017600                    AID_SEQUENCE_NMBR,                            01760000
017700                    DEST_MNEMONIC_CODE,                           01770000
017800                    ACTION_CODE,                                  01780000
017900                    LAST_UPDATE_TMESTP,                           01790000
018000                    ROUTE_STACK_INDCT,                            01800000
018100                    FUNC_KEY_LBL_NAME,                            01810000
018200                    IN_APLCTN_COMM_CDE,                           01820000
018210                    FUNC_KY_DISPN_IND                             01821000
018300             FROM   TCICSROUTE                                    01830000
018400             WHERE  MNEMONIC_CODE = :DK-MNEMONIC                  01840000
018500     END-EXEC.                                                    01850000
018600     EJECT                                                        01860000
018700 PROCEDURE DIVISION.                                              01870000
018800******************************************************************01880000
018900*                 0000-MAINLINE                                  *01890000
019000******************************************************************01900000
019100 0000-MAINLINE.                                                   01910000
019200                                                                  01920000
019300     PERFORM 1000-INITIALIZE.                                     01930000
019400                                                                  01940000
019500     PERFORM 2000-PROCESS-MNEMONICS                               01950000
019600         UNTIL PS-END-OF-INPUT.                                   01960000
019700                                                                  01970000
019800     PERFORM 9000-EOJ-ROUTINE.                                    01980000
019900                                                                  01990000
020000     STOP RUN.                                                    02000000
020100******************************************************************02010000
020200**  THIS PARAGRAPH OPENS THE FILES AND PERFORMS A PRIMING READ  **02020000
020300**  ON THE INPUT FILE.                                          **02030000
020400******************************************************************02040000
020500 1000-INITIALIZE.                                                 02050000
020600     DISPLAY ' **** DPKUT056 - ARCHITECTURE BATCH EXTRACT ****'.  02060000
020700     OPEN INPUT  INPUT-MNEMONIC-FILE                              02070000
020800          OUTPUT TMNEMONIC-EXT-FILE                               02080000
020900                 TMENUITEM-EXT-FILE                               02090000
021000                 TCICSROUTE-EXT-FILE.                             02100000
021100     PERFORM 2100-READ-INPUT-MNEMONIC.                            02110000
021200     EJECT                                                        02120000
021300******************************************************************02130000
021400** THIS PARAGRAPH CONTROLS THE PROCESSING FOR EACH INPUT RECORD **02140000
021500** READ.  THE MNEMONIC FROM THE INPUT FILE WILL BE MOVED TO THE **02150000
021600** DB2 KEY FIELD.  ALL CURSORS ARE THEN OPENED AND A PRIMING    **02160000
021700** FETCH IS DONE ON EACH.  EACH TABLE IS THEN PROCESSED UNTIL   **02170000
021800** NO MORE ROWS ARE FOUND.  ALL CURSORS ARE CLOSED AND THE NEXT **02180000
021900** INPUT RECORD IS READ.                                        **02190000
022000******************************************************************02200000
022100 2000-PROCESS-MNEMONICS.                                          02210000
022200     MOVE IR-MNEMONIC TO DK-MNEMONIC.                             02220000
022300     DISPLAY 'PROCESSING MNEMONIC ('                              02230000
022400             DK-MNEMONIC                                          02240000
022500             ')'.                                                 02250000
022600*                                                                 02260000
022700     PERFORM 2200-INITIALIZE-MNEMONIC.                            02270000
022800*                                                                 02280000
022900     PERFORM 2300-PROCESS-TMNEMONIC-TABLE.                        02290000
023000*                                                                 02300000
023100     PERFORM 2400-PROCESS-TMENUITEM-TABLE                         02310000
023200         UNTIL PS-END-OF-TMENUITEM-TABLE.                         02320000
023300*                                                                 02330000
023400     PERFORM 2500-PROCESS-TCICSROUTE-TABLE                        02340000
023500         UNTIL PS-END-OF-TCICSROUTE-TABLE.                        02350000
023600*                                                                 02360000
023700     PERFORM 2600-TERMINATE-MNEMONIC.                             02370000
023800*                                                                 02380000
023900     PERFORM 2100-READ-INPUT-MNEMONIC.                            02390000
024000*                                                                 02400000
024100*                                                                 02410000
024200 2100-READ-INPUT-MNEMONIC.                                        02420000
024300     READ INPUT-MNEMONIC-FILE INTO IR-INPUT-RECORD-LAYOUT         02430000
024400         AT END                                                   02440000
024500             SET PS-END-OF-INPUT TO TRUE.                         02450000
024600******************************************************************02460000
024700** OPEN ALL CURSORS AND DO A PRIMING FETCH ON EACH.             **02470000
024800******************************************************************02480000
024900 2200-INITIALIZE-MNEMONIC.                                        02490000
025000     INITIALIZE  PS-END-OF-TMENUITEM-TABLE-SW                     02500000
025100                 PS-END-OF-TCICSROUTE-TABLE-SW.                   02510000
025200                                                                  02520000
025300     EXEC SQL                                                     02530000
025400         OPEN TMENUITEM_CURSOR                                    02540000
025500     END-EXEC.                                                    02550000
025600                                                                  02560000
025700     EVALUATE TRUE                                                02570000
025800         WHEN SQLWARN0 NOT = SPACES                               02580000
025900         WHEN SQLCODE < 0                                         02590000
026000         WHEN SQLCODE > 0                                         02600000
026100             MOVE '1000-INITIALIZE'                               02610000
026200                 TO PV-PARAGRAPH-NAME                             02620000
026300             MOVE 'OPEN TMENUITEM CURSOR'                         02630000
026400                  TO PV-DB2-OPERATION-ATTEMPTED                   02640000
026500             PERFORM 9100-SQL-ABEND                               02650000
026600         WHEN SQLCODE = 0                                         02660000
026700             CONTINUE                                             02670000
026800     END-EVALUATE.                                                02680000
026900                                                                  02690000
027000     PERFORM 7100-FETCH-TMENUITEM-ROW.                            02700000
027100                                                                  02710000
027200     EXEC SQL                                                     02720000
027300         OPEN TCICSROUTE_CURSOR                                   02730000
027400     END-EXEC.                                                    02740000
027500                                                                  02750000
027600     EVALUATE TRUE                                                02760000
027700         WHEN SQLWARN0 NOT = SPACES                               02770000
027800         WHEN SQLCODE < 0                                         02780000
027900         WHEN SQLCODE > 0                                         02790000
028000             MOVE '1000-INITIALIZE'                               02800000
028100                 TO PV-PARAGRAPH-NAME                             02810000
028200             MOVE 'OPEN TCICSROUTE CURSOR'                        02820000
028300                  TO PV-DB2-OPERATION-ATTEMPTED                   02830000
028400             PERFORM 9100-SQL-ABEND                               02840000
028500         WHEN SQLCODE = 0                                         02850000
028600             CONTINUE                                             02860000
028700     END-EVALUATE.                                                02870000
028800                                                                  02880000
028900     PERFORM 7200-FETCH-TCICSROUTE-ROW.                           02890000
029000                                                                  02900000
029100     IF  PS-END-OF-TCICSROUTE-TABLE                               02910000
029200         DISPLAY '** NO ROWS FOUND ON TCICSROUTE TABLE '          02920000
029300                 'FOR (' DK-MNEMONIC ') **'                       02930000
029400     END-IF.                                                      02940000
029500     EJECT                                                        02950000
029600******************************************************************02960000
029700** WRITE THE MNEMONIC TABLE DATA TO THE OUTPUT FILE.            **02970000
029800******************************************************************02980000
029900 2300-PROCESS-TMNEMONIC-TABLE.                                    02990000
030000     PERFORM 7000-SELECT-TMNEMONIC-ROW.                           03000000
030100     WRITE TMNEMONIC-EXT-RECORD                                   03010000
030200         FROM DCLTMNEMONIC.                                       03020000
030300                                                                  03030000
030400******************************************************************03040000
030500** WRITE THE MENUITEM TABLE DATA TO THE OUTPUT FILE AND FETCH   **03050000
030600** THE NEXT ROW.                                                **03060000
030700******************************************************************03070000
030800 2400-PROCESS-TMENUITEM-TABLE.                                    03080000
030900     IF IV-DESC NEGATIVE                                          03090000
031000        MOVE SPACE              TO TMENUITEM-DESC                 03100000
031100     END-IF.                                                      03110000
031200                                                                  03120000
031300     WRITE TMENUITEM-EXT-RECORD                                   03130000
031400         FROM DCLTMENUITEM.                                       03140000
031500                                                                  03150000
031600     PERFORM 7100-FETCH-TMENUITEM-ROW.                            03160000
031700******************************************************************03170000
031800** WRITE THE CICSROUTE TABLE DATA TO THE OUTPUT FILE AND FETCH  **03180000
031900** THE NEXT ROW.                                                **03190000
032000******************************************************************03200000
032100                                                                  03210000
032200 2500-PROCESS-TCICSROUTE-TABLE.                                   03220000
032300                                                                  03230000
032400     WRITE TCICSROUTE-EXT-RECORD                                  03240000
032500         FROM DCLTCICSROUTE.                                      03250000
032600                                                                  03260000
032700     PERFORM 7200-FETCH-TCICSROUTE-ROW.                           03270000
032800                                                                  03280000
032900     EJECT                                                        03290000
033000******************************************************************03300000
033100** CLOSE ALL CURSORS.                                           **03310000
033200******************************************************************03320000
033300 2600-TERMINATE-MNEMONIC.                                         03330000
033400     EXEC SQL                                                     03340000
033500         CLOSE TMENUITEM_CURSOR                                   03350000
033600     END-EXEC.                                                    03360000
033700                                                                  03370000
033800     IF SQLCODE NOT = 0                                           03380000
033900         MOVE '2600-TERMINATE-MNEMONIC'                           03390000
034000             TO PV-PARAGRAPH-NAME                                 03400000
034100         MOVE 'BAD CLOSE ON TMENUITEM CURSOR'                     03410000
034200             TO PV-DB2-OPERATION-ATTEMPTED                        03420000
034300         PERFORM 9100-SQL-ABEND                                   03430000
034400     END-IF.                                                      03440000
034500                                                                  03450000
034600     EXEC SQL                                                     03460000
034700         CLOSE TCICSROUTE_CURSOR                                  03470000
034800     END-EXEC.                                                    03480000
034900                                                                  03490000
035000     IF SQLCODE NOT = 0                                           03500000
035100         MOVE '2600-TERMINATE-MNEMONIC'                           03510000
035200             TO PV-PARAGRAPH-NAME                                 03520000
035300         MOVE 'BAD CLOSE ON TCICSROUTE CURSOR'                    03530000
035400             TO PV-DB2-OPERATION-ATTEMPTED                        03540000
035500         PERFORM 9100-SQL-ABEND                                   03550000
035600     END-IF.                                                      03560000
035700     EJECT                                                        03570000
035800*                                                                 03580000
035900*                                                                 03590000
036000 7000-SELECT-TMNEMONIC-ROW.                                       03600000
036100     EXEC SQL                                                     03610000
036200         SELECT MNEMONIC_CODE,                                    03620000
036300                TRANS_ID_CODE,                                    03630000
036400                AVAIL_INDCT,                                      03640000
036500                CMAREA_FRMT_CODE,                                 03650000
036600                SAVE_CMAREA_INDCT,                                03660000
036700                CMAREA_LNGTH_MSRMT,                               03670000
036800                PANEL_TITLE_NAME,                                 03680000
036900                LAST_UPDATE_TMESTP,                               03690000
037000                GLBL_ACCS_IND,                                    03700000
037100                PGM_NAME,                                         03710000
037200                SCRN_TYP_CDE,                                     03720000
037210                UPD_VSAM_IND,                                     03721000
                      DB2_PKG_CDE,                                              
990909                CMNT_TXT,                                                 
990909                ACRT_LOC_REQR_IND                                         
037300         INTO   :TMNEMONIC-MNEMONIC-CODE,                         03730000
037400                :TMNEMONIC-TRANS-ID-CODE,                         03740000
037500                :TMNEMONIC-AVAIL-INDCT,                           03750000
037600                :TMNEMONIC-CMAREA-FRMT-CODE,                      03760000
037700                :TMNEMONIC-SAVE-CMAREA-INDCT,                     03770000
037800                :TMNEMONIC-CMAREA-LNGTH-MSRMT,                    03780000
037900                :TMNEMONIC-PANEL-TITLE-NAME,                      03790000
038000                :TMNEMONIC-LAST-UPDATE-TMESTP,                    03800000
038100                :TMNEMONIC-GLBL-ACCS-IND,                         03810000
038200                :TMNEMONIC-PGM-NAME,                              03820000
038300                :TMNEMONIC-SCRN-TYP-CDE,                          03830000
038310                :TMNEMONIC-UPD-VSAM-IND,                          03831000
                      :TMNEMONIC-DB2-PKG-CDE,                                   
990909                :TMNEMONIC-CMNT-TXT,                                      
990909                :TMNEMONIC-ACRT-LOC-REQR-IND                              
038400         FROM   TMNEMONIC                                         03840000
038500         WHERE  MNEMONIC_CODE = :DK-MNEMONIC                      03850000
038600     END-EXEC.                                                    03860000
038700*                                                                 03870000
038800     EVALUATE TRUE                                                03880000
038900         WHEN SQLCODE = 0                                         03890000
039000             ADD +1 TO PV-TMNEMONIC-COUNT                         03900000
039100         WHEN SQLCODE = +100                                      03910000
039200             SET PS-SET-RC-8 TO TRUE                              03920000
039300             DISPLAY '** NO ROWS FOUND ON TMNEMONIC TABLE '       03930000
039400                 'FOR (' DK-MNEMONIC ') **'                       03940000
039500         WHEN SQLWARN0 NOT = SPACES                               03950000
039600         WHEN SQLCODE < 0                                         03960000
039700         WHEN SQLCODE > 0                                         03970000
039800             MOVE '7000-SELECT-TMNEMONIC-ROW      '               03980000
039900                 TO PV-PARAGRAPH-NAME                             03990000
040000             MOVE 'SELECT ROW ON TMNEMONIC TABLE  '               04000000
040100                 TO PV-DB2-OPERATION-ATTEMPTED                    04010000
040200             PERFORM 9100-SQL-ABEND                               04020000
040300     END-EVALUATE.                                                04030000
040400*                                                                 04040000
040500******************************************************************04050000
040600**  FETCH A ROW FROM THE MENUITEM TABLE                         **04060000
040700**  (NOTE INDICATOR VARIABLE ON TMENUITEM-DESC)                 **04070000
040800******************************************************************04080000
040900*                                                                 04090000
041000 7100-FETCH-TMENUITEM-ROW.                                        04100000
041100                                                                  04110000
041200     EXEC SQL                                                     04120000
041300         FETCH TMENUITEM_CURSOR                                   04130000
041400             INTO :TMENUITEM-MENU-NAME,                           04140000
041500                  :TMENUITEM-ITEM-MNEMONIC-CODE,                  04150000
041600                  :TMENUITEM-DESC:IV-DESC,                        04160000
041700                  :TMENUITEM-SEQUENCE-NMBR,                       04170000
041800                  :TMENUITEM-LAST-UPDATE-TMESTP,                  04180000
041900                  :TMENUITEM-IN-APLCTN-COMM-CDE                   04190000
042000     END-EXEC.                                                    04200000
042100                                                                  04210000
042200     EVALUATE TRUE                                                04220000
042300         WHEN SQLCODE = 0                                         04230000
042400             ADD +1 TO PV-TMENUITEM-COUNT                         04240000
042500         WHEN SQLCODE = +100                                      04250000
042600             SET PS-END-OF-TMENUITEM-TABLE TO TRUE                04260000
042700         WHEN SQLWARN0 NOT = SPACES                               04270000
042800         WHEN SQLCODE < 0                                         04280000
042900         WHEN SQLCODE > 0                                         04290000
043000             MOVE '7100-FETCH-TMENUITEM-ROW      '                04300000
043100                 TO PV-PARAGRAPH-NAME                             04310000
043200             MOVE 'FETCH ROW ON TMENUITEM TABLE  '                04320000
043300                 TO PV-DB2-OPERATION-ATTEMPTED                    04330000
043400             PERFORM 9100-SQL-ABEND                               04340000
043500     END-EVALUATE.                                                04350000
043600*                                                                 04360000
043700*                                                                 04370000
043800 7200-FETCH-TCICSROUTE-ROW.                                       04380000
043900                                                                  04390000
044000     EXEC SQL                                                     04400000
044100         FETCH TCICSROUTE_CURSOR                                  04410000
044200             INTO :TCICSROUTE-MNEMONIC-CODE,                      04420000
044300                  :TCICSROUTE-AID-SEQUENCE-NMBR,                  04430000
044400                  :TCICSROUTE-DEST-MNEMONIC-CODE,                 04440000
044500                  :TCICSROUTE-ACTION-CODE,                        04450000
044600                  :TCICSROUTE-LAST-UPDATE-TMESTP,                 04460000
044700                  :TCICSROUTE-ROUTE-STACK-INDCT,                  04470000
044800                  :TCICSROUTE-FUNC-KEY-LBL-NAME,                  04480000
044900                  :TCICSROUTE-IN-APLCTN-COMM-CDE,                 04490000
044910                  :TCICSROUTE-FUNC-KY-DISPN-IND                   04491000
045000     END-EXEC.                                                    04500000
045100                                                                  04510000
045200     EVALUATE TRUE                                                04520000
045300         WHEN SQLCODE = 0                                         04530000
045400             ADD +1 TO PV-TCICSROUTE-COUNT                        04540000
045500         WHEN SQLCODE = +100                                      04550000
045600             SET PS-END-OF-TCICSROUTE-TABLE TO TRUE               04560000
045700         WHEN SQLWARN0 NOT = SPACES                               04570000
045800         WHEN SQLCODE < 0                                         04580000
045900         WHEN SQLCODE > 0                                         04590000
046000             MOVE '7200-FETCH-TCICSROUTE-ROW      '               04600000
046100                 TO PV-PARAGRAPH-NAME                             04610000
046200             MOVE 'FETCH ROW ON TCICSROUTE TABLE  '               04620000
046300                 TO PV-DB2-OPERATION-ATTEMPTED                    04630000
046400             PERFORM 9100-SQL-ABEND                               04640000
046500     END-EVALUATE.                                                04650000
046600                                                                  04660000
046700     EJECT                                                        04670000
046800******************************************************************04680000
046900** THIS PARAGRAPH DISPLAYS FETCH COUNTS AND CLOSES THE FILES.   **04690000
047000******************************************************************04700000
047100                                                                  04710000
047200 9000-EOJ-ROUTINE.                                                04720000
047300                                                                  04730000
047400     DISPLAY ' '.                                                 04740000
047500                                                                  04750000
047600     IF  PS-SET-RC-8                                              04760000
047700         MOVE +0008    TO RETURN-CODE                             04770000
047800         DISPLAY '****************************************'       04780000
047900         DISPLAY '** AN ERROR OCCURRED WHILE EXTRACTING **'       04790000
048000         DISPLAY '** MNEMONIC(S) FROM SOURCE TABLES.    **'       04800000
048100         DISPLAY '** SEE PREVIOUS MESSAGES FOR DETAILS. **'       04810000
048200         DISPLAY '****************************************'       04820000
048300     ELSE                                                         04830000
048400         MOVE +0000    TO RETURN-CODE                             04840000
048500         DISPLAY '****************************************'       04850000
048600         DISPLAY '** ALL MNEMONICS WERE SUCCESSFULLY    **'       04860000
048700         DISPLAY '** EXTRACTED FROM THE SOURCE TABLES.  **'       04870000
048800         DISPLAY '****************************************'       04880000
048900     END-IF.                                                      04890000
049000                                                                  04900000
049100     CLOSE INPUT-MNEMONIC-FILE                                    04910000
049200           TMNEMONIC-EXT-FILE                                     04920000
049300           TMENUITEM-EXT-FILE                                     04930000
049400           TCICSROUTE-EXT-FILE.                                   04940000
049500                                                                  04950000
049600     EJECT                                                        04960000
049700******************************************************************04970000
049800*      9100-SQL-ABEND                                            *04980000
049900*  ==> PROCESSES:                                                *04990000
050000*    - PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *05000000
050100*  ==> PERFORMED FROM: NUMEROUS PARAGRAPHS                       *05010000
050200******************************************************************05020000
050300 9100-SQL-ABEND.                                                  05030000
050400     DISPLAY '9100-SQL-ABEND'                                     05040000
050500     DISPLAY '** ABEND     **'.                                   05050000
050600     DISPLAY '** PROGRAM   ** = DPKUT056'.                        05060000
050700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05070000
050800     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     05080000
050900                                                                  05090000
051000******************************************************************05100000
051100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05110000
051200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05120000
051300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05130000
051400* FORMAT.                                                         05140000
051500******************************************************************05150000
051600     COPY DPPD004.                                                05160000
051700                                                                  05170000
051800     IF SQLCODE NOT = -911                                        05180000
051900         EXEC SQL                                                 05190000
052000             COMMIT                                               05200000
052100         END-EXEC                                                 05210000
052200     END-IF.                                                      05220000
052300                                                                  05230000
052400     MOVE +4013 TO ABEND-CODE.                                    05240000
052500     CALL 'ILBOABN0' USING ABEND-CODE.                            05250000
