000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT265.                                        00020001
000300 AUTHOR.         MIKE BESKE.                                      00030001
000400*DATE-WRITTEN.   OCTOBER 2006.                                    00040001
000500*************************************************************     00050000
000600*    COBOL 2                                                *     00060000
000700*                                                           *     00070000
000800*    BUMP INVOICE EXTRACT AGAINST THE RECEIVING EXTRACT TO  *     00080006
000900*    UPDATE RECEIVING DETAIL MATCHED BY DC                  *     00090005
001000*                                                           *     00100004
001100*    THERE ARE 3 REASONS THIS IS NECESSARY:                 *     00110000
001200*    1. TO REDUCE THE NUMBER OF RECEIVING RECORDS.  ONLY    *     00120000
001300*       THOSE RECEIVING RECORDS WHERE AN INVOICE WITH A     *     00130000
001400*       MATCHING PO/DC IS FOUND WILL BE RE-WRITTEN.         *     00140002
001500*    2. TO POPULATE THE VENDOR NAME AND NUMBER FIELDS ON    *     00150000
001600*       THE RECEIVING RECORD WITH THE CORRESPONDING FIELDS  *     00160000
001700*       FROM THE INVOICE RECORD WITH THE MATCHING PO NUMBER *     00170000
001800*       (AND DC NUMBER WHEN APPROPRIATE).                   *     00180002
001900*    3. TO MODIFY THE DC NUMBER TO ZERO ON THE RECEIVING    *     00190003
002000*       RECORDS WHERE THE MATCHING INVOICES ARE BULK.       *     00200000
002100*                                                           *     00210000
002200*************************************************************     00220000
002300*                                                           *     00230000
002400* INPUT                                                     *     00240000
002500* INP01   -  INVOICE FILE - SORTED INTO PO/MATCH LOC SEQ    *     00250003
002600* INP02   -  RECEIVING EXTRACT - SORTED INTO PO/DC SEQ      *     00260003
002700*                                                           *     00270000
002800* OUTPUT                                                    *     00280000
002900* OUT01   -  UPDATED RECEIVING EXTRACT RECORDS              *     00290000
003000*                                                           *     00300000
003100*************************************************************     00310000
003200* CHANGE LOG:                                               *     00320000
003300*                                                           *     00330000
003400* DATE  03/11/2007                                                00340008
003500*     CHANGE MADE: MATCH BY DC PROJECT                            00350002
003600*     INITIAL VERSION.                                            00360002
003700*     MADE BY: MIKE BESKE              WR/IR #: WR21578           00370000
003800*                                                                 00380000
003400* DATE  05/11/2021                                                00381009
003500*     CHANGE MADE: RECOMPILED FOR UPDATED APWS008 COPYBOOK        00382009
003700*     MADE BY: JEAN KURK               WR/IR #: CHG0256545        00384009
003800*                                                                 00385009
003900******************************************************************00390000
004000                                                                  00400000
004100 ENVIRONMENT DIVISION.                                            00410000
004200                                                                  00420000
004300 INPUT-OUTPUT SECTION.                                            00430000
004400                                                                  00440000
004500 FILE-CONTROL.                                                    00450000
004600     SELECT INVOICES-FILE      ASSIGN    TO UT-S-INP01.           00460000
004700     SELECT RECEIV-FILE        ASSIGN    TO UT-S-INP02.           00470000
004800     SELECT RECEIV-OUT-FILE    ASSIGN    TO UT-S-OUT01.           00480000
004900 DATA DIVISION.                                                   00490000
005000                                                                  00500000
005100 FILE SECTION.                                                    00510000
005200 FD  INVOICES-FILE                                                00520000
005300         LABEL RECORDS  ARE STANDARD                              00530000
005400         RECORDING MODE IS  F                                     00540000
005500         DATA RECORD    IS  INVOICE-RECORD.                       00550000
005600                                                                  00560000
005700 01  INVOICE-RECORD                PIC X(175).                    00570000
005800                                                                  00580000
005900 FD  RECEIV-FILE                                                  00590000
006000         LABEL RECORDS  ARE STANDARD                              00600000
006100         RECORDING MODE IS  F                                     00610000
006200         DATA RECORD    IS  RECEIV-IN.                            00620000
006300                                                                  00630000
006400 01  RECEIV-IN                     PIC X(090).                    00640000
006500                                                                  00650000
006600 FD  RECEIV-OUT-FILE                                              00660000
006700         LABEL RECORDS  ARE STANDARD                              00670000
006800         RECORDING MODE IS  F                                     00680000
006900         DATA RECORD    IS  RECEIV-OUT-REC.                       00690000
007000                                                                  00700000
007100 01  RECEIV-OUT-REC                PIC X(090).                    00710000
007200                                                                  00720000
007300/                                                                 00730000
007400 WORKING-STORAGE SECTION.                                         00740000
007500                                                                  00750000
007600 01  FILLER                        PIC X(25) VALUE                00760000
007700                             'WS FOR APKUT265 BEGINS==>'.         00770001
007800 01  ABEND-CODE                    PIC S9(4) COMP SYNC            00780000
007900                                             VALUE ZEROS.         00790000
008000 01  PV-ABEND-FIELDS.                                             00800000
008100     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT265'. 00810001
008200     05  PV-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.     00820000
008300     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00830000
008400     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00840000
008500     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     00850000
008600     05  PV-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     00860000
008700     05  PV-ABEND-STRUCTURE-3         PIC X(8)  VALUE SPACES.     00870000
008800     05  PV-ABEND-STRUCTURE-4         PIC X(8)  VALUE SPACES.     00880000
008900     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.     00890000
009000                                                                  00900000
009100 01  PV-WORK-AREA.                                                00910000
009200     05  PV-PROGRAM-NAME         PIC X(08)     VALUE 'APKUT265'.  00920001
009300     05  PV-INVOICE-IN-REC-CNT   PIC 9(09)     VALUE 0.           00930000
009400     05  PV-RECEIV-IN-REC-CNT    PIC 9(09)     VALUE 0.           00940000
009500     05  PV-RECEIV-OUT-REC-CNT   PIC 9(09)     VALUE 0.           00950000
009600*                                                                 00960000
009700 01  PV-SWITCHES.                                                 00970000
009800     05  END-OF-INVOICE-SW       PIC X(01) VALUE 'N'.             00980000
009900         88  END-OF-INVOICES               VALUE 'Y'.             00990000
010000         88  NOT-END-OF-INVOICES           VALUE 'N'.             01000000
010100     05  END-OF-RECEIV-SW        PIC X(01) VALUE 'N'.             01010000
010200         88  END-OF-RECEIV                 VALUE 'Y'.             01020000
010300         88  NOT-END-OF-RECEIV             VALUE 'N'.             01030000
010400                                                                  01040000
010500 01  FILLER                      PIC X(35)  VALUE                 01050000
010600     'BEGINNING OF AP060 INPUT FILE    **'.                       01060000
010700     COPY APRD060.                                                01070000
010800                                                                  01080000
010900 01  FILLER                      PIC X(35)  VALUE                 01090000
011000     'BEGINNING OF AP021 INPUT FILE    **'.                       01100000
011100     COPY APRD021.                                                01110000
011200                                                                  01120000
011300 01  FILLER                      PIC X(35)  VALUE                 01130000
011400     'END OF AP WORK RECORD AREA       **'.                       01140000
011500                                                                  01150000
011600 01  FILLER                        PIC X(25) VALUE                01160000
011700          '<====PV FOR APKUT265 ENDS'.                            01170001
011800                                                                  01180000
011900*LINKAGE SECTION.                                                 01190000
012000                                                                  01200000
012100                                                                  01210000
012200 PROCEDURE DIVISION.                                              01220000
012300                                                                  01230000
012400 A100-MAINLINE.                                                   01240000
012500                                                                  01250000
012600     PERFORM H100-HOUSEKEEPING.                                   01260000
012700                                                                  01270000
012800     PERFORM B100-PROCESSING                                      01280000
012900        UNTIL END-OF-INVOICES.                                    01290000
013000                                                                  01300000
013100     PERFORM Z900-END-OF-JOB.                                     01310000
013200                                                                  01320000
013300     GOBACK.                                                      01330000
013400        EJECT                                                     01340000
013500                                                                  01350000
013600 B100-PROCESSING.                                                 01360000
013700     MOVE 'B100-PROCESSING  '    TO PV-ABEND-PARAGRAPH.           01370000
013800                                                                  01380000
013900     IF NOT END-OF-RECEIV                                         01390000
014000        IF AP060-PO-NBR =  AP021-PO-NBR                           01400000
014100           IF AP060-MTCH-LOC-NBR = AP021-DC-NBR                   01410007
014200              PERFORM B200-PROCESS-BY-DC                          01420007
014300                 UNTIL END-OF-RECEIV OR                           01430007
014400                      (AP060-PO-NBR NOT = AP021-PO-NBR)  OR       01440007
014500                      (AP060-PO-NBR     = AP021-PO-NBR AND        01450007
014600                       AP060-MTCH-LOC-NBR NOT = AP021-DC-NBR)     01460007
014700              PERFORM R100-READ-INVOICE                           01470007
014800           ELSE                                                   01480007
014900              IF AP060-MTCH-LOC-NBR > AP021-DC-NBR                01490007
015000                 PERFORM R200-READ-RECEIV                         01500007
015100              ELSE                                                01510007
015200                 PERFORM R100-READ-INVOICE                        01520007
015300              END-IF                                              01530007
015400           END-IF                                                 01540007
015500        ELSE                                                      01550000
015600           IF AP060-PO-NBR > AP021-PO-NBR                         01560000
015700              PERFORM R200-READ-RECEIV                            01570000
015800           ELSE                                                   01580000
015900              PERFORM R100-READ-INVOICE                           01590000
016000           END-IF                                                 01600000
016100        END-IF                                                    01610000
016200     ELSE                                                         01620000
016300        PERFORM R100-READ-INVOICE                                 01630000
016400     END-IF.                                                      01640000
016500                                                                  01650000
016600 B200-PROCESS-BY-DC.                                              01660007
016700                                                                  01670000
016800**  THE BY STORE PROCESS WILL REWRITE THE RECEIVER RECORD         01680000
016900**  THAT MATCH THE PO DC                                          01690003
017000                                                                  01700000
017100     MOVE AP060-VENDOR-NAME   TO AP021-VENDOR-NAME.               01710000
017200     MOVE AP060-VENDOR-NUMBER TO AP021-VENDOR-NBR.                01720000
017300     MOVE AP021-DC-NBR        TO AP021-STR-NBR.                   01730002
017400                                                                  01740000
017500     PERFORM W100-WRITE-UPDATED.                                  01750000
017600     PERFORM R200-READ-RECEIV.                                    01760000
017700                                                                  01770000
017800 H100-HOUSEKEEPING.                                               01780000
017900*                                                                 01790000
018000***************************************************************** 01800000
018100*    OPEN FILES                                                   01810000
018200***************************************************************** 01820000
018300*                                                                 01830000
018400     MOVE 'H100-HOUSEKEEPING' TO PV-ABEND-PARAGRAPH.              01840000
018500                                                                  01850000
018600     SET NOT-END-OF-INVOICES     TO TRUE.                         01860000
018700     SET NOT-END-OF-RECEIV       TO TRUE.                         01870000
018800                                                                  01880000
018900     OPEN INPUT  INVOICES-FILE                                    01890000
019000                 RECEIV-FILE                                      01900000
019100          OUTPUT RECEIV-OUT-FILE.                                 01910002
019200                                                                  01920000
019300     PERFORM R100-READ-INVOICE.                                   01930000
019400     PERFORM R200-READ-RECEIV.                                    01940000
019500                                                                  01950000
019600 R100-READ-INVOICE.                                               01960000
019700*                                                                 01970000
019800***************************************************************** 01980000
019900*     READ THE SELECTED INVOICE FILE                              01990000
020000***************************************************************** 02000000
020100*                                                                 02010000
020200     MOVE 'R100-READ-INVOICE' TO PV-ABEND-PARAGRAPH.              02020000
020300                                                                  02030000
020400     IF NOT END-OF-INVOICES                                       02040000
020500        READ INVOICES-FILE INTO AP060-INVOICE-EXTRACT             02050000
020600          AT END  SET END-OF-INVOICES TO TRUE.                    02060000
020700                                                                  02070000
020800     IF NOT END-OF-INVOICES                                       02080000
020900        ADD 1 TO PV-INVOICE-IN-REC-CNT.                           02090000
021000                                                                  02100000
021100 R200-READ-RECEIV.                                                02110000
021200*                                                                 02120000
021300***************************************************************** 02130000
021400*     READ THE DUMPED RECEIV BATCH MATCH FILE                     02140000
021500***************************************************************** 02150000
021600*                                                                 02160000
021700     MOVE 'R200-READ-RECEIV  ' TO PV-ABEND-PARAGRAPH.             02170000
021800                                                                  02180000
021900     IF NOT END-OF-RECEIV                                         02190000
022000        READ RECEIV-FILE INTO AP021-RECORD                        02200000
022100          AT END  SET END-OF-RECEIV TO TRUE.                      02210000
022200                                                                  02220000
022300     IF NOT END-OF-RECEIV                                         02230000
022400        ADD 1 TO PV-RECEIV-IN-REC-CNT.                            02240000
022500                                                                  02250000
022600 W100-WRITE-UPDATED.                                              02260000
022700*                                                                 02270000
022800***************************************************************** 02280000
022900*     WRITE THE DUMPED BATCH MATCH FILE    - BULK                 02290000
023000***************************************************************** 02300000
023100*                                                                 02310000
023200     MOVE 'W100-WRITE-UPDATED' TO PV-ABEND-PARAGRAPH.             02320000
023300                                                                  02330000
023400     WRITE RECEIV-OUT-REC  FROM AP021-RECORD.                     02340000
023500                                                                  02350000
023600     ADD 1 TO PV-RECEIV-OUT-REC-CNT.                              02360000
023700                                                                  02370000
023800 Z900-END-OF-JOB.                                                 02380000
023900*                                                                 02390000
024000***************************************************************** 02400000
024100*     CLOSE OUTPUT FILES,      REPORT ON NECESSARY TOTALS         02410000
024200***************************************************************** 02420000
024300*                                                                 02430000
024400     MOVE 'Z900-END-OF-JOB  ' TO PV-ABEND-PARAGRAPH.              02440000
024500                                                                  02450000
024600     DISPLAY '************************************************'.  02460000
024700     DISPLAY 'TOTAL INVOICE  RECORDS READ    = '                  02470000
024800              PV-INVOICE-IN-REC-CNT.                              02480000
024900     DISPLAY 'TOTAL AP021 RECDIS RECS READ   = '                  02490000
025000              PV-RECEIV-IN-REC-CNT.                               02500000
025100     DISPLAY '************************************************'.  02510000
025200     DISPLAY 'TOTAL AP021 RECDIS RECORDS OUT = '                  02520000
025300              PV-RECEIV-OUT-REC-CNT.                              02530000
025400     DISPLAY '************************************************'.  02540000
025500                                                                  02550000
025600     DISPLAY ' PROGRAM APKUT265 ENDS NORMALLY '.                  02560001
025700                                                                  02570000
025800     CLOSE       INVOICES-FILE                                    02580000
025900                 RECEIV-FILE                                      02590000
026000                 RECEIV-OUT-FILE.                                 02600002
026100                                                                  02610000
026200 Z999-ABEND.                                                      02620000
026300*                                                                 02630000
026400***************************************************************** 02640000
026500*     PROCESS ABENDS                                              02650000
026600***************************************************************** 02660000
026700*                                                                 02670000
026800                                                                  02680000
026900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02690000
027000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02700000
027100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02710000
027200                                                                  02720000
027300     CALL 'ILBOABN0' USING ABEND-CODE.                            02730000
