000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.             RCKUT126.                                00050001
000600 AUTHOR.                 GERMAN BANDA.                            00060001
000700 INSTALLATION.           KOHLS.                                   00070001
000800 DATE-WRITTEN            SEPTEMBER, 2003.                         00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200* THIS PROGRAM WILL DETERMINE IF AN ASSOCIATE CAN PERFORM A MANUAL00120001
001300* PROCESS FOR THE PO/RCVR. (CONFIRM/UNCONFIRM, VERIFY/UNVERIFY,   00130001
001400* SMOOTH, IGNORE UCC128 DATA AND PRINT PHYSICAL LABELS).IT WILL BE00140001
001500* CALLED BY OTHER CICS PROGRAMS AND USED TO DETERMINE F-KEY       00150001
001600* ELIGIBILITY                                                     00160001
001700******************************************************************00170001
001800                                                                  00180001
001900******************************************************************00190001
002000 ENVIRONMENT DIVISION.                                            00200001
002100******************************************************************00210001
002200                                                                  00220001
002300******************************************************************00230001
002400 DATA DIVISION.                                                   00240001
002500******************************************************************00250001
002600                                                                  00260001
002700******************************************************************00270001
002800 WORKING-STORAGE SECTION.                                         00280001
002900******************************************************************00290001
003000                                                                  00300001
003100     COPY RCWS039.                                                00310001
003200******************************************************************00320011
003300**COPYBOOK LAYOUT FOR DATA PASSED FOR DC AUTOVE PARM CHECK *******00330011
003400**PROGRAM (RCKUT127)                                       *******00340011
003500******************************************************************00350011
003600     COPY RCWS040.                                                00360011
003700                                                                  00370001
003800*----------------------------------------------------------------*00380002
003900**  SECURITY SUBROUTINE PARAMETERS                                00390002
004000*----------------------------------------------------------------*00400002
004100     COPY DPWS008.                                                00410002
004200                                                                  00420002
004300                                                                  00430002
004400*                                                                 00440001
004500 01  DK-DB2-KEYS.                                                 00450001
004600     05  DK-PO-NBR                       PIC S9(09) COMP SYNC.    00460001
004700     05  DK-REC-SEQ-NBR                  PIC S9(09) COMP SYNC.    00470001
004800     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00480001
004900     05  DK-FCLTY-ID                     PIC S9(04) COMP.         00490001
007800     05  DK-CURRENT-TIMESTAMP            PIC X(26)   VALUE SPACES.00491027
007801                                                                  00500001
007802 01  PC-PROGRAM-CONSTANTS.                                        00510001
007803     05  PC-DEFAULT-TMST           PIC X(26)  VALUE               00520001
007804                                  '9999-09-09-09.09.09.999999'.   00530001
007805     05  PC-CURRENT-PROGRAM-NAME   PIC X(08)  VALUE 'RCKUT126'.   00540001
007806     05  PC-LOGGING-PROGRAM-NAME   PIC X(08)  VALUE 'SUKPV702'.   00550001
007807     05  PC-AUTOVE-PARM-PROGRAM    PIC X(08)  VALUE 'RCKUT127'.   00560009
007808     05  PC-DEFAULT-DATE           PIC X(10)  VALUE '9999-09-09'. 00570001
007809                                                                  00580001
007810                                                                  00590001
007811 01  PS-PROGRAM-SWITCHES.                                         00600001
007812     05  PS-ERROR-SW                    PIC  X(01)  VALUE  'N'.   00610002
007813         88  PS-NO-ERROR                            VALUE  'N'.   00620002
007814         88  PS-ERROR                               VALUE  'Y'.   00630002
007815     05  PS-LOG-MESSAGE-SW              PIC  X       VALUE 'N'.   00640001
007816         88  PS-LOG-MESSAGE                          VALUE 'Y'.   00650001
007817         88  PS-NO-LOG-MESSAGE                       VALUE 'N'.   00660001
007818     05  PS-BEFORE-ONLY-LOGGING-SW      PIC  X       VALUE 'N'.   00670001
007819         88  PS-BEFORE-ONLY-LOGGING                  VALUE 'Y'.   00680001
007820         88  PS-NOT-BEFORE-ONLY-LOGGING              VALUE 'N'.   00690001
007821* JAK 04/2007 - ADD WMOS SWITCH                                   00690130
007822     05  PS-DC-ON-WMOS-SW               PIC  X       VALUE 'N'.   00691027
007823         88  PS-DC-ON-WMOS-YES                       VALUE 'Y'.   00692027
007824         88  PS-DC-ON-WMOS-NO                        VALUE 'N'.   00693027
007825                                                                  00700001
007826 01  PV-PROGRAM-VARIABLES.                                        00710001
007827     05  PV-NULL-IND                    PIC S9(04)  VALUE +0      00720001
007828                                                    COMP SYNC.    00730001
007829     05  PV-RACF-FUNCTION-NAME          PIC  X(08).               00740002
007830     05  PV-CICS-MSG-AREA                PIC  X(100) VALUE SPACE. 00750001
007831     05  PV-NOTIF-NBR                    PIC S9(9) VALUE ZERO     00760001
007832                                                COMP SYNC.        00770001
007900     05  PV-FROM-PARAGRAPH               PIC X(35) VALUE SPACES.  00790001
008000     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00800001
008100                                                COMP SYNC.        00810001
008200     05  PV-CICS-RESPONSE                PIC S9(04)  VALUE +0     00820001
008300                                                COMP SYNC.        00830001
008400     05  PV-DISPLAY-SQLCODE              PIC -9(05) VALUE ZEROES. 00840001
008500     05  PV-DISP-SHIPT-UNT-ID            PIC 9(18).               00850001
008600     05  PV-DISP-PO                      PIC 9(09).               00860001
008700     05  PV-DISP-RCVR-SEQ-NBR            PIC 9(04).               00870001
008800     05  PV-DISP-OPER-UNT-ID             PIC   9(04).             00880001
008900     05  PV-DISPLAY-CICS-RESP            PIC 999999999-           00890001
009000                                                 VALUE ZEROS.     00900001
009100                                                                  00910001
009200*----------------------------------------------------------------*00920001
009300*    SQL AND COBOL DECLARATIONS FOR THE RECEIVER TABLE (TRECEIV)  00930002
009400*----------------------------------------------------------------*00940001
009500     EXEC SQL                                                     00950001
009600          INCLUDE TRECEIV                                         00960002
009700     END-EXEC.                                                    00970001
009800*----------------------------------------------------------------*00980002
009900*  SQL AND COBOL DECLARATIONS FOR PARMS (TKRPRPM)                 00990002
010000*----------------------------------------------------------------*01000002
010100     EXEC SQL                                                     01010001
010200          INCLUDE TKRPRPM                                         01020001
010300     END-EXEC.                                                    01030001
010301* JAK 04/2007 - ADD WST00008/9/10                                 01031030
010302*----------------------------------------------------------------*01031130
010303*  SQL AND COBOL DECLARATIONS FOR WST_INTGRTN_TYP                 01032029
010304*----------------------------------------------------------------*01033029
010305     EXEC SQL                                                     01034029
010306          INCLUDE WST00008                                        01035029
010307     END-EXEC.                                                    01036029
010308*----------------------------------------------------------------*01037029
010309*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_DEFN                   01038029
010310*----------------------------------------------------------------*01039029
010311     EXEC SQL                                                     01039129
010312          INCLUDE WST00009                                        01039229
010313     END-EXEC.                                                    01039329
010314*----------------------------------------------------------------*01039429
010315*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_ELEM                   01039529
010316*----------------------------------------------------------------*01039629
010317     EXEC SQL                                                     01039729
010318          INCLUDE WST00010                                        01039829
010319     END-EXEC.                                                    01039929
010400                                                                  01040001
010500*----------------------------------------------------------------*01050022
010600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR LOGISTICS DOMAIN       01060022
010700*  LOCATION MASTER TABLE                                          01070022
010800*----------------------------------------------------------------*01080022
010900     EXEC SQL                                                     01090022
011000         INCLUDE XLT00010                                         01100022
011100     END-EXEC.                                                    01110022
011200******************************************************************01120001
011300*  COMMUNICATIONS AREA FOR DB2                                    01130001
011400******************************************************************01140001
011500     EXEC SQL                                                     01150001
011600         INCLUDE SQLCA                                            01160001
011700     END-EXEC.                                                    01170001
011800                                                                  01180001
011900******************************************************************01190001
012000 LINKAGE SECTION.                                                 01200001
012100 01  DFHCOMMAREA.                                                 01210001
012200     05  FILLER                         OCCURS  1 TO 4072 TIMES   01220001
012300                                      DEPENDING ON EIBCALEN.      01230001
012400         10  FILLER                   PIC X.                      01240001
012500******************************************************************01250001
012600                                                                  01260001
012700******************************************************************01270001
012800 PROCEDURE DIVISION.                                              01280001
012900******************************************************************01290001
013000 0000-PROGRAM-MAINLINE.                                           01300001
013100     INITIALIZE PV-PROGRAM-VARIABLES                              01310001
013200                PS-PROGRAM-SWITCHES                               01320001
013300                RC039-FIELDS.                                     01330001
013400     MOVE DFHCOMMAREA              TO  RC039-FIELDS.              01340001
013500     SET PS-NO-ERROR TO TRUE.                                     01350001
013600     PERFORM 7100-CHECK-FOR-LOGGING.                              01360001
013700                                                                  01370012
013800     IF PS-LOG-MESSAGE                                            01380001
013900         MOVE RC039-PO-NBR        TO PV-DISP-PO                   01390001
014000         MOVE RC039-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR         01400001
014100         STRING   ' RCKUT126 PROGRAM STARTED -'                   01410001
014200                  ' CALLED BY-'                                   01420001
014300                  RC039-PROGRAM-NAME                              01430001
014400                  ' PO='                                          01440001
014500                  PV-DISP-PO                                      01450001
014600                  ' RCVR='                                        01460001
014700                  PV-DISP-RCVR-SEQ-NBR                            01470001
014800                  ' FUNC REQ=' RC039-FUNCTION-REQ                 01480012
014900                  DELIMITED BY SIZE                               01490001
015000                                  INTO PV-CICS-MSG-AREA           01500001
015100         MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG          01510001
015200         PERFORM 9999-WRITE-TO-CSSL                               01520001
015300     END-IF.                                                      01530001
015400                                                                  01540002
015500     PERFORM 1000-PROCESS-FUNC-REQST.                             01550001
015600                                                                  01560001
015700     IF PS-LOG-MESSAGE                                            01570012
015800         INITIALIZE PV-CICS-MSG-AREA                              01580013
015900         MOVE RC039-PO-NBR        TO PV-DISP-PO                   01590012
016000         MOVE RC039-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR         01600012
016100         STRING   ' RCKUT126 -'                                   01610012
016200                  ' PO='                                          01620012
016300                  PV-DISP-PO                                      01630012
016400                  ' RCVR='                                        01640012
016500                  PV-DISP-RCVR-SEQ-NBR                            01650012
016600                  ' FUNC SW=' RC039-FUNCTION-SW                   01660012
016700                  ' FUNC REASON=' RC039-NO-FUNC-REASON            01670012
016800                  DELIMITED BY SIZE                               01680012
016900                                  INTO PV-CICS-MSG-AREA           01690012
017000         MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG          01700012
017100         PERFORM 9999-WRITE-TO-CSSL                               01710012
017200     END-IF.                                                      01720012
017300     MOVE RC039-FIELDS                  TO DFHCOMMAREA.           01730006
017400     GOBACK.                                                      01740001
017500                                                                  01750001
017600 1000-PROCESS-FUNC-REQST.                                         01760001
017700                                                                  01770001
017800     SET  PS-NO-ERROR            TO TRUE.                         01780002
017900     MOVE RC039-PO-NBR           TO DK-PO-NBR.                    01790006
018000     MOVE RC039-REC-SEQ-NBR      TO DK-REC-SEQ-NBR.               01800001
018100                                                                  01810002
018200                                                                  01820002
018300     EVALUATE TRUE                                                01830001
018400         WHEN RC039-FUNC-CNFM                                     01840002
018500             PERFORM 2000-CHECK-RECEIPT                           01850002
018600             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 01860002
018700                PERFORM 2100-CHECK-AP-RECEIVER                    01870002
018800             END-IF                                               01880002
018900             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 01890002
019000                PERFORM 2200-CHECK-TKRPRPM-AUTOVE                 01900002
019100             END-IF                                               01910002
019200             IF RC040-AUTO-VE-YES AND PS-NO-ERROR                 01920016
019300                MOVE 'MANLCNFM'      TO PV-RACF-FUNCTION-NAME     01930002
019400                PERFORM 2500-CHECK-FOR-RACF                       01940002
019401* JAK 04/2007 - ADD CHECK OF DC-ON-WMOS                           01941026
019402             ELSE                                                 01941126
019403                 IF PS-DC-ON-WMOS-YES                             01942026
019404                     SET RC039-FUNCTION-NO TO TRUE                01943026
019500                 END-IF                                           01950026
019510             END-IF                                               01951026
019600         WHEN RC039-FUNC-UNCNFM                                   01960002
019700             PERFORM 2000-CHECK-RECEIPT                           01970002
019800             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 01980002
019900                PERFORM 2100-CHECK-AP-RECEIVER                    01990002
020000             END-IF                                               02000002
020100             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 02010002
020200                PERFORM 2200-CHECK-TKRPRPM-AUTOVE                 02020002
020300             END-IF                                               02030002
020400             IF RC040-AUTO-VE-YES AND PS-NO-ERROR                 02040016
020500                MOVE 'MANLUNCM'      TO PV-RACF-FUNCTION-NAME     02050002
020600                PERFORM 2500-CHECK-FOR-RACF                       02060002
020601* JAK 04/2007 - ADD CHECK OF DC-ON-WMOS                           02071026
020602             ELSE                                                 02072026
020603                 IF PS-DC-ON-WMOS-YES                             02073026
020604                     SET RC039-FUNCTION-NO TO TRUE                02074026
020605                 END-IF                                           02075026
020700             END-IF                                               02076026
020800         WHEN RC039-FUNC-VRFY                                     02080002
020900             PERFORM 2000-CHECK-RECEIPT                           02090002
021000             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 02100002
021100                PERFORM 2100-CHECK-AP-RECEIVER                    02110002
021200             END-IF                                               02120002
021300             IF PS-NO-ERROR                                       02130031
021400                PERFORM 2200-CHECK-TKRPRPM-AUTOVE                 02140002
021500             END-IF                                               02150002
021600             IF RC040-AUTO-VE-YES AND PS-NO-ERROR                 02160016
021700                MOVE 'MANLVRFY'      TO PV-RACF-FUNCTION-NAME     02170002
021800                PERFORM 2500-CHECK-FOR-RACF                       02180002
021801* JAK 04/2007 - ADD CHECK OF DC-ON-WMOS                           02181026
021802             ELSE                                                 02182026
021803                 IF PS-DC-ON-WMOS-YES                             02183026
021804                    IF RC039-FUNCTION-YES AND PS-NO-ERROR         02183132
021805                      MOVE 'MANLVRFY'                                   02
021806                           TO PV-RACF-FUNCTION-NAME                     02
021807                      PERFORM 2500-CHECK-FOR-RACF                       02
021808                    ELSE                                                  
021809                     SET RC039-FUNCTION-NO TO TRUE                02184026
021810                    END-IF                                           02185
021820                 END-IF                                           02185026
021900             END-IF                                               02190002
022000         WHEN RC039-FUNC-UNVRFY                                   02200002
022100             PERFORM 2000-CHECK-RECEIPT                           02210002
022200             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 02220002
022300                PERFORM 2100-CHECK-AP-RECEIVER                    02230002
022400             END-IF                                               02240002
022500             IF PS-NO-ERROR                                       02250031
022600                PERFORM 2200-CHECK-TKRPRPM-AUTOVE                 02260002
022700             END-IF                                               02270002
022800             IF RC040-AUTO-VE-YES AND PS-NO-ERROR                 02280016
022900                MOVE 'MANLUNVE'      TO PV-RACF-FUNCTION-NAME     02290002
023000                PERFORM 2500-CHECK-FOR-RACF                       02300002
023001* JAK 04/2007 - ADD CHECK OF DC-ON-WMOS                           02301026
023002             ELSE                                                 02302026
023003                 IF PS-DC-ON-WMOS-YES                             02303026
023004                    IF RC039-FUNCTION-YES AND PS-NO-ERROR                 
023005                      MOVE 'MANLUNVE'                                   02
023006                           TO PV-RACF-FUNCTION-NAME                     02
023007                      PERFORM 2500-CHECK-FOR-RACF                       02
023008                    ELSE                                                  
023009                     SET RC039-FUNCTION-NO TO TRUE                        
023010                    END-IF                                           02185
023020                 END-IF                                           02305026
023100             END-IF                                               02310002
023200         WHEN RC039-FUNC-SMOOTH                                   02320002
023300             PERFORM 2000-CHECK-RECEIPT                           02330002
023400             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 02340002
023500                PERFORM 2100-CHECK-AP-RECEIVER                    02350002
023600             END-IF                                               02360002
023700             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 02370002
023800                PERFORM 2200-CHECK-TKRPRPM-AUTOVE                 02380002
023900             END-IF                                               02390002
024000             IF RC040-AUTO-VE-YES AND PS-NO-ERROR                 02400016
024100                MOVE 'PBSMOOTH'      TO PV-RACF-FUNCTION-NAME     02410002
024200                PERFORM 2500-CHECK-FOR-RACF                       02420002
024201* JAK 04/2007 - ADD CHECK OF DC-ON-WMOS                           02421026
024202             ELSE                                                 02422026
024203                 IF PS-DC-ON-WMOS-YES                             02423026
024204                     SET RC039-FUNCTION-NO TO TRUE                02424026
024205                 END-IF                                           02425026
024300             END-IF                                               02430002
024400         WHEN RC039-FUNC-PHY-LBL                                  02440002
024500             PERFORM 2000-CHECK-RECEIPT                           02450002
024600             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 02460002
024700                PERFORM 2100-CHECK-AP-RECEIVER                    02470002
024800             END-IF                                               02480002
024900             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 02490002
025000                PERFORM 2200-CHECK-TKRPRPM-AUTOVE                 02500002
025100             END-IF                                               02510002
025200             IF RC040-AUTO-VE-YES AND PS-NO-ERROR                 02520016
025300                MOVE 'PHYLABEL'      TO PV-RACF-FUNCTION-NAME     02530002
025400                PERFORM 2500-CHECK-FOR-RACF                       02540002
025401* JAK 04/2007 - ADD CHECK OF DC-ON-WMOS                           02541026
025402             ELSE                                                 02542026
025403                 IF PS-DC-ON-WMOS-YES                             02543026
025404                     SET RC039-FUNCTION-NO TO TRUE                02544026
025405                 END-IF                                           02545026
025500             END-IF                                               02550002
025600         WHEN RC039-PO-AUTOVE-CHECK                               02560002
025700             PERFORM 2000-CHECK-RECEIPT                           02570002
025800             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 02580002
025900                PERFORM 2100-CHECK-AP-RECEIVER                    02590002
026000             END-IF                                               02600002
026100             IF RC039-FUNCTION-NO AND PS-NO-ERROR                 02610002
026200                PERFORM 2200-CHECK-TKRPRPM-AUTOVE                 02620002
026300             END-IF                                               02630002
026400     END-EVALUATE.                                                02640001
026500                                                                  02650001
026600                                                                  02660001
026700 2000-CHECK-RECEIPT.                                              02670001
026800                                                                  02680001
026810* JAK 04/2007 - ADD CURR_OPER_UNT_ID TO SELECT                    02681026
026900     EXEC SQL                                                     02690001
027000          SELECT   A.PKGNG_CDE                                    02700001
027100               ,   A.PACK_BY_ST_IND                               02710001
027200               ,   A.REC_TYP_CDE                                  02720001
027300               ,   B.LOC_TYP_CDE                                  02730022
027310               ,   A.CURR_OPER_UNT_ID                             02731026
027400            INTO  :RECEIV-PKGNG-CDE                               02740001
027500               ,  :RECEIV-PACK-BY-ST-IND                          02750001
027600               ,  :RECEIV-REC-TYP-CDE                             02760001
027700               ,  :XLT00010-LOC-TYP-CDE                           02770022
027710               ,  :RECEIV-CURR-OPER-UNT-ID                        02771026
027800            FROM                                                  02780001
027900                  TRECEIV A                                       02790001
028000               ,  XLT_LOC B                                       02800022
028100            WHERE                                                 02810001
028200                  A.ORD_NBR         = :DK-PO-NBR                  02820001
028300              AND A.REC_SEQ_NBR     = :DK-REC-SEQ-NBR             02830001
028400              AND A.OPER_UNT_ID     =  B.LOC_NBR                  02840022
028500     END-EXEC.                                                    02850001
028600                                                                  02860001
028700     EVALUATE TRUE                                                02870001
028800         WHEN SQLCODE = ZERO                                      02880001
028900             MOVE RECEIV-PKGNG-CDE      TO RC039-PKGNG-CDE        02890001
029000             MOVE RECEIV-PACK-BY-ST-IND TO RC039-PBS-IND          02900001
029100             MOVE RECEIV-REC-TYP-CDE    TO RC039-REC-TYPE-CDE     02910005
029110             MOVE RECEIV-CURR-OPER-UNT-ID TO DK-OPER-UNT-ID       02911027
029200             IF XLT00010-LOC-TYP-CDE  = ('DS' OR 'HQ') OR         02920025
029300                RECEIV-REC-TYP-CDE = 'CR'                         02930025
029400                SET RC039-FUNCTION-YES TO TRUE                    02940001
029500             ELSE                                                 02950001
029600                SET RC039-FUNCTION-NO                             02960001
029700                    RC039-NOT-STR-CORP   TO TRUE                  02970001
029800             END-IF                                               02980001
029801             PERFORM 2040-GET-CURR-TMST                           02981027
029802             PERFORM 2050-CHECK-DC-WMOS                           02982027
029900         WHEN SQLWARN0 NOT = SPACES                               02990001
030000         WHEN SQLCODE  NOT = ZERO                                 03000001
030100             SET RC039-INVALID-SQL     TO TRUE                    03010001
030200             MOVE RC039-PO-NBR    TO  PV-DISP-PO                  03020006
030300             MOVE RC039-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR     03030001
030400             STRING   ' RCKUT126-2000-'                           03040001
030500                      ' CALLED BY-'                               03050001
030600                      RC039-PROGRAM-NAME                          03060001
030700                      ' PO='                                      03070001
030800                      PV-DISP-PO                                  03080001
030900                      ' RCVR='                                    03090001
031000                      PV-DISP-RCVR-SEQ-NBR                        03100001
031100                      DELIMITED BY SIZE                           03110001
031200                                      INTO PV-CICS-MSG-AREA       03120001
031300             PERFORM 9999-WRITE-TO-CSSL                           03130001
031400             MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG      03140001
031500             SET RC039-INVALID-SQL      TO TRUE                   03150001
031600     END-EVALUATE.                                                03160001
031700                                                                  03170001
031701* JAK 04/2007 - BEGIN - ADD CHECK TO SEE IF DC IN WMOS            03170126
031702 2040-GET-CURR-TMST.                                              03171027
031703                                                                  03172026
031704     EXEC SQL                                                     03172127
031705         SET :DK-CURRENT-TIMESTAMP = CURRENT TIMESTAMP            03172227
031706     END-EXEC.                                                    03172327
031707                                                                  03172427
031708                                                                  03172527
031709 2050-CHECK-DC-WMOS.                                              03173027
031710                                                                  03173127
031711     EXEC SQL                                                     03174026
031712          SELECT   A.INTGRTN_TYP_DESC                             03175026
031713            INTO  :WST00008-INTGRTN-TYP-DESC                      03179126
031714            FROM                                                  03179626
031715                  WST_INTGRTN_TYP  A                              03179726
031716               ,  WST_ATTR_DEFN    B                              03179826
031717               ,  WST_ATTR_ELEM    C                              03179926
031718               ,  WST_ATTR_ELEM    D                              03180026
031719               ,  WST_ATTR_ELEM    E                              03180126
031720            WHERE                                                 03180226
031721                  A.INTGRTN_TYP_CDE   = 'WMOSON'                  03180326
031722              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         03180426
031723              AND B.ATTR_DEFN_SEQ_NBR = 1                         03180526
031724              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         03180626
031725              AND C.ATTR_DEFN_SEQ_NBR = 1                         03180726
031726              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         03180826
031727              AND D.ATTR_DEFN_SEQ_NBR = 2                         03180926
031728              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         03181026
031729              AND E.ATTR_DEFN_SEQ_NBR = 3                         03181126
031730              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       03181226
031731              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       03181326
031732              AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID           03181427
031733              AND E.ATTR_ELEM_TMST   <= :DK-CURRENT-TIMESTAMP     03181527
031734     END-EXEC.                                                    03181626
031735                                                                  03181726
031736     EVALUATE TRUE                                                03181826
031737         WHEN SQLCODE = ZERO                                      03181926
031738             SET PS-DC-ON-WMOS-YES      TO TRUE                   03182026
031739         WHEN SQLCODE = +100                                      03182126
031740             SET PS-DC-ON-WMOS-NO       TO TRUE                   03182226
031741         WHEN SQLWARN0 NOT = SPACES                               03183026
031742         WHEN SQLCODE  NOT = ZERO                                 03183126
031743             SET RC039-INVALID-SQL     TO TRUE                    03183226
031744             MOVE DK-OPER-UNT-ID  TO  PV-DISP-OPER-UNT-ID         03183328
031745             STRING   ' RCKUT126-2050-'                           03183526
031746                      ' CALLED BY-'                               03183626
031747                      RC039-PROGRAM-NAME                          03183726
031748                      ' OPER-'                                    03183826
031749                      PV-DISP-OPER-UNT-ID                         03183927
031750                      ' TMST='                                    03184027
031751                      DK-CURRENT-TIMESTAMP                        03184127
031752                      DELIMITED BY SIZE                           03184226
031753                                      INTO PV-CICS-MSG-AREA       03184326
031754             PERFORM 9999-WRITE-TO-CSSL                           03184426
031755             MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG      03184526
031756     END-EVALUATE.                                                03184726
031757* JAK 04/2007 - END                                               03184826
031758                                                                  03184926
031800 2100-CHECK-AP-RECEIVER.                                          03185001
031900                                                                  03190014
032000     IF PS-LOG-MESSAGE                                            03200014
032100         INITIALIZE PV-CICS-MSG-AREA                              03210014
032200         STRING   ' RCKUT126 -'                                   03220014
032300                  ' PO='                                          03230014
032400                  PV-DISP-PO                                      03240014
032500                  ' RCVR='                                        03250014
032600                  PV-DISP-RCVR-SEQ-NBR                            03260014
032700                  '    2100-CHECK-AP-RECEIVER'                    03270014
032800                  DELIMITED BY SIZE                               03280014
032900                                  INTO PV-CICS-MSG-AREA           03290014
033000         MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG          03300014
033100         PERFORM 9999-WRITE-TO-CSSL                               03310014
033200     END-IF.                                                      03320014
033300                                                                  03330001
033400     IF RC039-REC-TYPE-CDE = 'AP'                                 03340005
033500        SET RC039-FUNCTION-YES TO TRUE                            03350001
033600     ELSE                                                         03360001
033700        SET RC039-FUNCTION-NO                                     03370001
033800            RC039-NOT-AP-RCVR  TO TRUE                            03380001
033900     END-IF.                                                      03390001
034000                                                                  03400001
034100 2200-CHECK-TKRPRPM-AUTOVE.                                       03410001
034200                                                                  03420014
034300     IF PS-LOG-MESSAGE                                            03430014
034400         INITIALIZE PV-CICS-MSG-AREA                              03440014
034500         STRING   ' RCKUT126 -'                                   03450014
034600                  ' PO='                                          03460014
034700                  PV-DISP-PO                                      03470014
034800                  ' RCVR='                                        03480014
034900                  PV-DISP-RCVR-SEQ-NBR                            03490014
035000                  '    2200-CHECK-TKRPRPM-AUTOVE'                 03500014
035100                  DELIMITED BY SIZE                               03510014
035200                                  INTO PV-CICS-MSG-AREA           03520014
035300         MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG          03530014
035400         PERFORM 9999-WRITE-TO-CSSL                               03540014
035500     END-IF.                                                      03550014
035600                                                                  03560014
035700     MOVE RC039-PO-NBR            TO RC040-PO-NBR                 03570009
035800     MOVE RC039-REC-SEQ-NBR       TO RC040-PO-RCVR                03580009
035900     SET  RC040-RCVR-EXISTS       TO TRUE                         03590015
036000     MOVE RC039-SIGNON-LOCATION   TO RC040-SIGNON-LOCATION        03600009
036100     MOVE RC039-USER-ID           TO RC040-USER-ID                03610009
036200     MOVE PC-CURRENT-PROGRAM-NAME TO RC040-CALLING-PROGRAM        03620009
036300                                                                  03630009
036400     CALL PC-AUTOVE-PARM-PROGRAM  USING DFHEIBLK                  03640021
036500                                        RC040-COMMAREA            03650021
036600                                        RC040-FIELDS.             03660021
036700                                                                  03670009
036800     EVALUATE TRUE                                                03680010
036900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03690010
037000            IF RC040-SUCCESSFUL                                   03700010
037100               IF RC040-AUTO-VE-YES                               03710011
037200                  SET RC039-FUNCTION-NO                           03720011
037300                      RC039-DC-IS-AUTO-VE TO TRUE                 03730011
037400               ELSE                                               03740018
037500                  SET RC039-FUNCTION-YES  TO TRUE                 03750019
037600               END-IF                                             03760017
037700            ELSE                                                  03770017
037800              SET RC039-INVALID-SQL     TO TRUE                   03780017
037900              MOVE RC039-PO-NBR    TO  PV-DISP-PO                 03790017
038000              MOVE RC039-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR    03800017
038100              STRING   ' RCKUT126-2200-'                          03810017
038200                       ' CALLED BY-'                              03820017
038300                       RC039-PROGRAM-NAME                         03830017
038400                       ' PO='                                     03840017
038500                       PV-DISP-PO                                 03850017
038600                       ' RCVR='                                   03860010
038700                       PV-DISP-RCVR-SEQ-NBR                       03870010
038800                       DELIMITED BY SIZE                          03880010
038900                                       INTO PV-CICS-MSG-AREA      03890010
039000              PERFORM 9999-WRITE-TO-CSSL                          03900010
039100              MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG     03910010
039200              PERFORM 9998-RETURN                                 03920011
039300            END-IF                                                03930010
039400         WHEN OTHER                                               03940011
039500              SET RC039-INVALID-SQL     TO TRUE                   03950011
039600              MOVE RC039-PO-NBR    TO  PV-DISP-PO                 03960011
039700              MOVE RC039-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR    03970011
039800              STRING   ' RCKUT126-2200-'                          03980011
039900                       ' CALLED BY-'                              03990011
040000                       RC039-PROGRAM-NAME                         04000011
040100                       ' PO='                                     04010011
040200                       PV-DISP-PO                                 04020011
040300                       ' RCVR='                                   04030011
040400                       PV-DISP-RCVR-SEQ-NBR                       04040011
040500                       DELIMITED BY SIZE                          04050011
040600                                       INTO PV-CICS-MSG-AREA      04060011
040700              PERFORM 9999-WRITE-TO-CSSL                          04070011
040800              MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG     04080011
040900              PERFORM 9998-RETURN                                 04090011
041000         END-EVALUATE.                                            04100011
041100                                                                  04110002
041200                                                                  04120001
041300 2500-CHECK-FOR-RACF.                                             04130002
041400                                                                  04140014
041500     IF PS-LOG-MESSAGE                                            04150014
041600         INITIALIZE PV-CICS-MSG-AREA                              04160014
041700         STRING   ' RCKUT126 -'                                   04170014
041800                  ' PO='                                          04180014
041900                  PV-DISP-PO                                      04190014
042000                  ' RCVR='                                        04200014
042100                  PV-DISP-RCVR-SEQ-NBR                            04210014
042200                  '    2500-CHECK-FOR-RACF'                       04220014
042300                  DELIMITED BY SIZE                               04230014
042400                                  INTO PV-CICS-MSG-AREA           04240014
042500         MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG          04250014
042600         PERFORM 9999-WRITE-TO-CSSL                               04260014
042700     END-IF.                                                      04270014
042800                                                                  04280014
042900     SET  DP008-RSRC-TYPE-FUNC           TO TRUE                  04290002
043000     MOVE PV-RACF-FUNCTION-NAME          TO DP008-FUNCTION-NAME   04300002
043100     SET  DP008-ACCESS-TYPE-USE          TO TRUE                  04310002
043200                                                                  04320002
043300     EXEC CICS                                                    04330002
043400        LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                  04340002
043500             COMMAREA (DP008-SECURITY-COMMAREA)                   04350002
043600             LENGTH (DP008-SECURITY-COMMAREA-LENGTH)              04360002
043700     END-EXEC                                                     04370002
043800                                                                  04380002
043900     IF DP008-CALL-SUCCESSFUL                                     04390002
044000        IF DP008-ACCESS-ALLOWED                                   04400002
044100           SET RC039-FUNCTION-YES TO TRUE                         04410002
044200        ELSE                                                      04420002
044300           SET RC039-FUNCTION-NO                                  04430002
044400               RC039-RACF         TO TRUE                         04440002
044500        END-IF                                                    04450002
044600     ELSE                                                         04460002
044700        SET RC039-INVALID-SQL     TO TRUE                         04470002
044800        MOVE RC039-PO-NBR        TO PV-DISP-PO                    04480006
044900        MOVE RC039-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR          04490002
045000        STRING   ' RCKUT126-2500-'                                04500002
045100                 ' CALLED BY-'                                    04510002
045200                 RC039-PROGRAM-NAME                               04520002
045300                 ' PO='                                           04530002
045400                 PV-DISP-PO                                       04540002
045500                 ' RCVR='                                         04550002
045600                 PV-DISP-RCVR-SEQ-NBR                             04560002
045700                 DELIMITED BY SIZE                                04570002
045800                                 INTO PV-CICS-MSG-AREA            04580002
045900        PERFORM 9999-WRITE-TO-CSSL                                04590002
046000        MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG           04600002
046100        SET RC039-INVALID-SQL      TO TRUE                        04610002
046200     END-IF.                                                      04620002
046300                                                                  04630002
046400                                                                  04640002
046500                                                                  04650002
046600                                                                  04660002
046700 7100-CHECK-FOR-LOGGING.                                          04670002
046800                                                                  04680014
046900     IF PS-LOG-MESSAGE                                            04690014
047000         INITIALIZE PV-CICS-MSG-AREA                              04700014
047100         STRING   ' RCKUT126 -'                                   04710014
047200                  ' PO='                                          04720014
047300                  PV-DISP-PO                                      04730014
047400                  ' RCVR='                                        04740014
047500                  PV-DISP-RCVR-SEQ-NBR                            04750014
047600                  '    7100-CHECK-FOR-LOGGING'                    04760014
047700                  DELIMITED BY SIZE                               04770014
047800                                  INTO PV-CICS-MSG-AREA           04780014
047900         MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG          04790014
048000         PERFORM 9999-WRITE-TO-CSSL                               04800014
048100     END-IF.                                                      04810014
048200                                                                  04820014
048300                                                                  04830001
048400     EXEC SQL                                                     04840001
048500          SELECT FUNC_TXT                                         04850001
048600            INTO :KRPRPM-FUNC-TXT                                 04860001
048700            FROM TKRPRPM                                          04870001
048800           WHERE LOC_ID            = :RC039-OPER-UNT-ID           04880024
048900             AND INTFC_SYS_CDE    = 'KHL'                         04890001
049000             AND SYS_PRC_FUNC_CDE = 'RC126D'                      04900023
049100             AND FUNC_PRC_STAT_CDE = 'AC'                         04910001
049200     END-EXEC.                                                    04920001
049300                                                                  04930001
049400     EVALUATE TRUE                                                04940001
049500         WHEN SQLCODE = ZERO                                      04950001
049600             IF KRPRPM-FUNC-TXT = 'Y'                             04960001
049700                 SET PS-LOG-MESSAGE  TO TRUE                      04970001
049800             ELSE                                                 04980001
049900                 SET PS-NO-LOG-MESSAGE  TO TRUE                   04990001
050000             END-IF                                               05000001
050100         WHEN SQLCODE = +100                                      05010001
050200             SET PS-NO-LOG-MESSAGE  TO TRUE                       05020001
050300         WHEN SQLWARN0 NOT = SPACES                               05030001
050400         WHEN SQLCODE NOT EQUAL ZERO                              05040001
050500             SET PS-ERROR                                         05050001
050600                 RC039-INVALID-SQL    TO TRUE                     05060001
050700             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       05070001
050800             STRING   ' RCKUT126-7100-'                           05080001
050900                      ' CALLED BY-'                               05090001
051000                      RC039-PROGRAM-NAME                          05100001
051100                      '  SQLCODE='                                05110001
051200                      PV-DISPLAY-SQLCODE                          05120001
051300                      ' '                                         05130001
051400                      DELIMITED BY SIZE                           05140001
051500                                      INTO PV-CICS-MSG-AREA       05150001
051600             PERFORM 9999-WRITE-TO-CSSL                           05160001
051700             MOVE PV-CICS-MSG-AREA      TO RC039-CRA-RET-MSG      05170001
051800             SET RC039-INVALID-SQL TO TRUE                        05180001
051900             PERFORM 9998-RETURN                                  05190001
052000     END-EVALUATE.                                                05200001
052100                                                                  05210001
052200                                                                  05220001
052300*-----------------------------------------------------------------05230001
052400*  RETURN TO CALLING PROGRAM                                      05240001
052500*-----------------------------------------------------------------05250001
052600 9998-RETURN.                                                     05260001
052700                                                                  05270001
052800     MOVE SQLCA                         TO RC039-SQLCA            05280001
052900                                           PV-CICS-MSG-AREA.      05290001
053000     PERFORM 9999-WRITE-TO-CSSL.                                  05300001
053100     MOVE RC039-FIELDS                  TO DFHCOMMAREA.           05310004
053200                                                                  05320001
053300     EXEC CICS                                                    05330001
053400          RETURN                                                  05340001
053500     END-EXEC.                                                    05350001
053600                                                                  05360001
053700 9999-WRITE-TO-CSSL.                                              05370001
053800                                                                  05380001
053900     MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.      05390001
054000                                                                  05400001
054100     EXEC CICS                                                    05410001
054200          WRITEQ TD                                               05420001
054300           QUEUE   ('CSSL')                                       05430001
054400            FROM   (PV-CICS-MSG-AREA)                             05440001
054500          LENGTH   (PV-COMMAREA-LENGTH)                           05450001
054600            RESP   (PV-CICS-RESPONSE)                             05460001
054700     END-EXEC.                                                    05470001
054800                                                                  05480001
