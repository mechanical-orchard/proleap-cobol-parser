000100 IDENTIFICATION DIVISION.                                         00010015
000200 PROGRAM-ID.    RCKCS238.                                         00020015
000300 AUTHOR.        TOM RUSKA.                                        00030015
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040015
000500 DATE-WRITTEN.  03-14-94.                                         00050015
000600 DATE-COMPILED.                                                   00060015
000700                                                                  00070015
000800*---------------------------------------------------------------* 00080015
000900*    E238 - PURCHASE ORDER SHIPMENT LIST                        * 00090015
001000*                                                               * 00100015
001100*    THIS PROGRAM GENERATES A LIST OF SHIPMENTS FOR A PO.       * 00110015
001200*                                                               * 00120015
001300*    NO SELECTIONS CAN BE MADE FROM THIS SCREEN                 * 00130015
001400*---------------------------------------------------------------* 00140015
001410* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00141024
001420* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00142025
001430* MAKING THE CALL DYNAMIC VS STATIC.                              00143025
001440*---------------------------------------------------------------* 00144025
001500/                                                                 00150015
001600 ENVIRONMENT DIVISION.                                            00160015
001700                                                                  00170015
001800 DATA DIVISION.                                                   00180015
001900                                                                  00190015
002000 WORKING-STORAGE SECTION.                                         00200015
002100                                                                  00210015
002200 01  DK-DB2-KEYS.                                                 00220015
002300     05  DK-PRO-NBR                      PIC  X(16)  VALUE SPACE. 00230015
002400     05  DK-BOL-NBR                      PIC  X(16)  VALUE SPACE. 00240015
002500     05  DK-OPER-UNT-ID                  PIC S9(04) COMP VALUE +0.00250015
002600     05  DK-FCLTY-ID                     PIC S9(04) COMP VALUE +0.00260015
002700     05  DK-PO-NBR                       PIC S9(09) COMP VALUE +0.00270015
002800     05  DK-REC-SEQ-NBR                  PIC S9(09) COMP VALUE +0.00280015
002900     05  DK-SHIPT-ID                     PIC S9(09) COMP VALUE +0.00290015
003000     05  DK-DEPT-NBR                     PIC  X(03)  VALUE SPACES.00300015
003100     05  DK-OPER-SET-ID                  PIC S9(04) COMP VALUE +0.00310015
003200                                                                  00320015
003300 01  PC-PROGRAM-CONSTANTS.                                        00330015
003400     05  PC-CURRENT-MAP-NAME             PIC  X(08)  VALUE        00340015
003500                                                     'RC238A  '.  00350015
003600     05  PC-CURRENT-MAPSET-NAME          PIC  X(08)  VALUE        00360015
003700                                                     'RCKM238 '.  00370015
003800     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00380015
003900                                                     'RCKCS238'.  00390015
004000     05  PC-AUDIT-RTN                   PIC  X(08)  VALUE         00400021
004100                                                    'RCKCS290'.   00410021
004200     05  PC-AUDIT-RTN-LENGTH            PIC S9(04)  VALUE  +300   00420021
004300                                                    COMP SYNC.    00430021
004400     05  PC-LIST-QUEUE-SEQ               PIC  9(01)  VALUE 1.     00440021
004500     05  PC-SEL-QUEUE-SEQ                PIC  9(01)  VALUE 2.     00450021
004600     05  PC-INTER-APPL-CODES.                                     00460021
004700         10 PC-INTER-APPL-DETAIL         PIC  X(01)  VALUE '1'.   00470021
004800         10 PC-INTER-APPL-LIST           PIC  X(01)  VALUE '2'.   00480021
004900     05  PC-ITEMS-PER-PANEL              PIC S9(04)  VALUE +11    00490021
005000                                                     COMP SYNC.   00500021
005100     05  PC-MAX-BLOCKS-IN-ARRAY          PIC S9(04)  VALUE +2     00510021
005200                                                     COMP SYNC.   00520021
005300     05  PC-MAX-ITEMS                    PIC S9(09)  VALUE        00530021
005400                                                     +1000000     00540021
005500                                                     COMP-3.      00550021
005600     05  PC-MSG-NUMBER-LENGTH            PIC S9(04)  VALUE +7     00560021
005700                                                     COMP SYNC.   00570021
005800     05  PC-MAX-RETRIES                  PIC S9(03)  VALUE 3      00580021
005900                                                     COMP-3.      00590021
006000     05  PC-ZERO                         PIC S9(09) COMP VALUE +0.00600021
006100     05  PC-IP                           PIC  X(02)  VALUE 'IP'.  00610025
006200     05  PC-VE                           PIC  X(02)  VALUE 'VE'.  00620021
006300     05  PC-A                            PIC  X(01)  VALUE 'A'.   00630021
006400     05  PC-U                            PIC  X(01)  VALUE 'U'.   00640021
006500     05  PC-Y                            PIC  X(01)  VALUE 'Y'.   00650021
006600     05  PC-CM                           PIC  X(02)  VALUE 'CM'.  00660021
006700                                                                  00670021
006800     05  PC-TSYMSG-NUMBERS.                                       00680021
006900         10  PC-TSYMSG-00004             PIC  9(05)  VALUE 00004. 00690021
007000         10  PC-TSYMSG-00005             PIC  9(05)  VALUE 00005. 00700021
007100         10  PC-TSYMSG-00008             PIC  9(05)  VALUE 00008. 00710021
007200         10  PC-TSYMSG-00045             PIC  9(05)  VALUE 00045. 00720021
007300         10  PC-TSYMSG-00047             PIC  9(05)  VALUE 00047. 00730021
007400         10  PC-TSYMSG-00050             PIC  9(05)  VALUE 00050. 00740021
007500         10  PC-TSYMSG-00051             PIC  9(05)  VALUE 00051. 00750021
007600         10  PC-TSYMSG-00053             PIC  9(05)  VALUE 00053. 00760021
007700         10  PC-TSYMSG-00057             PIC  9(05)  VALUE 00057. 00770021
007800         10  PC-TSYMSG-00069             PIC  9(05)  VALUE 00069. 00780021
007900         10  PC-TSYMSG-00070             PIC  9(05)  VALUE 00070. 00790021
008000         10  PC-TSYMSG-00101             PIC  9(05)  VALUE 00101. 00800021
008100         10  PC-TSYMSG-00279             PIC  9(05)  VALUE 00279. 00810021
008200         10  PC-TSYMSG-01061             PIC  9(05)  VALUE 01061. 00820021
008300         10  PC-TSYMSG-01078             PIC  9(05)  VALUE 01078. 00830021
008400         10  PC-TSYMSG-01079             PIC  9(05)  VALUE 01079. 00840021
008500                                                                  00850021
008600 01  PS-PROGRAM-SWITCHES.                                         00860021
008700     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'Y'.   00870021
008800         88  PS-NO-ERROR                             VALUE 'Y'.   00880021
008900         88  PS-ERROR                                VALUE 'N'.   00890021
009000     05  PS-COMMAREA-SW                  PIC  X(01)  VALUE 'N'.   00900021
009100         88  PS-COMMAREA-VALID                       VALUE 'Y'.   00910021
009200         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   00920021
009300     05  PS-IN-PROCESS-SW                PIC  X(01)  VALUE 'N'.   00930021
009400         88  PS-IN-PROCESS                           VALUE 'Y'.   00940021
009500         88  PS-NOT-IN-PROCESS                       VALUE 'N'.   00950021
009600     05  PS-RECORD-FOUND-SW              PIC  X(01)  VALUE 'Y'.   00960021
009700         88  PS-RECORD-FOUND                         VALUE 'Y'.   00970021
009800         88  PS-NO-RECORD-FOUND                      VALUE 'N'.   00980021
009900                                                                  00990021
010000 01  PV-PROGRAM-VARIABLES.                                        01000021
010100     05  PV-SUB                          PIC S9(04)  VALUE +0     01010021
010200                                                     COMP SYNC.   01020021
010300     05  PV-REMAINDER                    PIC S9(04)  VALUE +0     01030021
010400                                                     COMP SYNC.   01040021
010500     05  PV-READ-COUNT                   PIC S9(09)  VALUE +0     01050021
010600                                                     COMP-3.      01060021
010700     05  PV-ITEM-IN-USE                  PIC S9(09)  VALUE +0     01070021
010800                                                     COMP-3.      01080021
010900     05  PV-TOP-ITEM                     PIC S9(09)  VALUE +0     01090021
011000                                                     COMP-3.      01100021
011100     05  PV-BOTTOM-ITEM                  PIC S9(09)  VALUE +0     01110021
011200                                                     COMP-3.      01120021
011300     05  PV-BLOCK-NUMBER                 PIC S9(04)  VALUE +0     01130021
011400                                                     COMP SYNC.   01140021
011500     05  PV-CICS-RESP                    PIC S9(04)  VALUE +0     01150021
011600                                                     COMP SYNC.   01160021
011700     05  PV-ITEM                         PIC S9(04)  VALUE +0     01170021
011800                                                     COMP SYNC.   01180021
011900     05  PV-SEL-QUEUE-ITEM               PIC S9(04)  VALUE +0     01190021
012000                                                     COMP SYNC.   01200021
012100     05  PV-HIGHEST-BLOCK-WRITTEN        PIC S9(04)  VALUE +0     01210021
012200                                                     COMP SYNC.   01220021
012300     05  PV-LIST-ITEM-NUMBER             PIC S9(04)  VALUE +0     01230021
012400                                                     COMP SYNC.   01240021
012500     05  PV-FIRST-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0     01250021
012600                                                     COMP SYNC.   01260021
012700     05  PV-NEXT-BLOCK-IN-ARRAY          PIC S9(04)  VALUE +0     01270021
012800                                                     COMP SYNC.   01280021
012900     05  PV-PREV-BLOCK-IN-ARRAY          PIC S9(04)  VALUE +0     01290021
013000                                                     COMP SYNC.   01300021
013100     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE +0     01310021
013200                                                     COMP SYNC.   01320021
013300     05  PV-TRN-CDE                      PIC X VALUE SPACE.       01330021
013400     05  PV-PO-REC-SEQ.                                           01340021
013500** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  01350023
013600         10  PV-PO-NBR                   PIC ZZZZZZZZ.            01360023
013700         10  FILLER                      PIC X(01)   VALUE '-'.   01370021
013800         10  PV-REC-SEQ-NBR              PIC 9(03).               01380021
013900                                                                  01390021
014000     05  PV-MESSAGE.                                              01400021
014100         10  PV-MESSAGE1                 PIC X(10).               01410021
014200         10  FILLER                      PIC X(01).               01420021
014300         10  PV-MESSAGE2                 PIC X(10).               01430021
014400                                                                  01440021
014500******************************************************************01450021
014600**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01460021
014700**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01470021
014800**  APPLICATION-SPECIFIC COMMAREA.                              **01480021
014900******************************************************************01490021
015000 01  LQW-LIST-QUEUE-WORK-AREA.                                    01500021
015100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01510021
015200     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           01520021
015300                                        INDEXED BY LQW-IDX.       01530021
015400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01540021
015500         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01550021
015600         10  LQW-SELECTED-SW            PIC  X(01).               01560021
015700             88  LQW-SELECT                         VALUE 'S'.    01570021
015800             88  LQW-DESELECT                       VALUE ' '.    01580021
015900         10  LQW-CTN-CNT                PIC S9(04)  COMP.         01590021
016000         10  LQW-ACTL-CTN-CNT           PIC S9(04)  COMP.         01600021
016100         10  LQW-DMG-CTN-CNT            PIC S9(04)  COMP.         01610021
016200         10  LQW-SHIPT-ID               PIC S9(09)  COMP.         01620021
016300         10  LQW-PO-NBR                 PIC S9(09)  COMP.         01630021
016400         10  LQW-REC-SEQ-NBR            PIC S9(09)  COMP.         01640021
016500         10  LQW-PRO-NBR                PIC  X(16).               01650021
016600         10  LQW-BOL-NBR                PIC  X(16).               01660021
016700         10  LQW-PKSL-IND               PIC  X(01).               01670021
016800         10  LQW-SCAC                   PIC  X(04).               01680021
016900         10  LQW-TRAILER                PIC  X(10).               01690021
017000         10  LQW-STATUS                 PIC  X(02).               01700021
017100         10  LQW-PRIMARY-IND            PIC  X(01).               01710021
017200         10  LQW-OPER-UNT-ID            PIC  S9(04) COMP.         01720021
017300         10  LQW-FCLTY-ID               PIC  S9(04) COMP.         01730021
017400         10  LQW-TRIP-ID                PIC  S9(09) COMP.         01740021
017500                                                                  01750021
017600                                                                  01760021
017700/                                                                 01770021
017800*---------------------------------------------------------------* 01780021
017900*  RECORD LAYOUT 'INSERT AUDIT MODULE'  RCKCS290                * 01790021
018000*---------------------------------------------------------------* 01800021
018100                                                                  01810021
018200     COPY RCWS031.                                                01820021
018300                                                                  01830021
018400/                                                                 01840021
018500*---------------------------------------------------------------* 01850021
018600*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 01860021
018700*---------------------------------------------------------------* 01870021
018800                                                                  01880021
018900     COPY RCWS013.                                                01890021
019000                                                                  01900021
019100/                                                                 01910021
019200*---------------------------------------------------------------* 01920021
019300*    MAP LAYOUT                                                 * 01930021
019400*---------------------------------------------------------------* 01940021
019500                                                                  01950021
019600     COPY RCKM238.                                                01960021
019700                                                                  01970021
019800 01  MR-OCCURS-LAYOUT                    REDEFINES RC238AO.       01980021
019900** CHG0094517  CHANGED FILLER LENGTH FROM 121 TO 122              01990023
020000     05  FILLER                          PIC X(122).              02000023
020100                                                                  02010021
020200     05  MR-SCROLL-AREA                  OCCURS 11 TIMES.         02020021
020300         10  MR-SELECTL                 PIC S9(04) COMP.          02030021
020400         10  MR-SELECTA                 PIC  X(01).               02040021
020500         10  MR-SELECTC                 PIC  X(01).               02050021
020600         10  MR-SELECTH                 PIC  X(01).               02060021
020700         10  MR-SELECTI                 PIC  X(01).               02070021
020800                                                                  02080021
020900         10  MR-CARTON-CNTL             PIC S9(04) COMP.          02090021
021000         10  MR-CARTON-CNTA             PIC  X(01).               02100021
021100         10  MR-CARTON-CNTC             PIC  X(01).               02110021
021200         10  MR-CARTON-CNTH             PIC  X(01).               02120021
021300         10  MR-CARTON-CNT-X.                                     02130021
021400             15  MR-CARTON-CNT          PIC  9(04).               02140021
021500                                                                  02150021
021600         10  MR-ACTL-CARTON-CNTL        PIC S9(04) COMP.          02160021
021700         10  MR-ACTL-CARTON-CNTA        PIC  X(01).               02170021
021800         10  MR-ACTL-CARTON-CNTC        PIC  X(01).               02180021
021900         10  MR-ACTL-CARTON-CNTH        PIC  X(01).               02190021
022000         10  MR-ACTL-CARTON-CNT-X.                                02200021
022100             15  MR-ACTL-CARTON-CNT     PIC  9(04).               02210021
022200                                                                  02220021
022300         10  MR-DMG-CARTON-CNTL         PIC S9(04) COMP.          02230021
022400         10  MR-DMG-CARTON-CNTA         PIC  X(01).               02240021
022500         10  MR-DMG-CARTON-CNTC         PIC  X(01).               02250021
022600         10  MR-DMG-CARTON-CNTH         PIC  X(01).               02260021
022700         10  MR-DMG-CARTON-CNT-X.                                 02270021
022800             15  MR-DMG-CARTON-CNT      PIC  9(04).               02280021
022900                                                                  02290021
023000         10  MR-PRO-NBRL                PIC S9(04) COMP.          02300021
023100         10  MR-PRO-NBRA                PIC  X(01).               02310021
023200         10  MR-PRO-NBRC                PIC  X(01).               02320021
023300         10  MR-PRO-NBRH                PIC  X(01).               02330021
023400         10  MR-PRO-NBR                 PIC  X(16).               02340021
023500                                                                  02350021
023600         10  MR-BOL-NBRL                PIC S9(04) COMP.          02360021
023700         10  MR-BOL-NBRA                PIC  X(01).               02370021
023800         10  MR-BOL-NBRC                PIC  X(01).               02380021
023900         10  MR-BOL-NBRH                PIC  X(01).               02390021
024000         10  MR-BOL-NBR                 PIC  X(16).               02400021
024100                                                                  02410021
024200         10  MR-PKSL-INDL               PIC S9(04) COMP.          02420021
024300         10  MR-PKSL-INDA               PIC  X(01).               02430021
024400         10  MR-PKSL-INDC               PIC  X(01).               02440021
024500         10  MR-PKSL-INDH               PIC  X(01).               02450021
024600         10  MR-PKSL-IND                PIC  X(01).               02460021
024700                                                                  02470021
024800         10  MR-SCACL                   PIC S9(04) COMP.          02480021
024900         10  MR-SCACA                   PIC  X(01).               02490021
025000         10  MR-SCACC                   PIC  X(01).               02500021
025100         10  MR-SCACH                   PIC  X(01).               02510021
025200         10  MR-SCAC                    PIC  X(04).               02520021
025300                                                                  02530021
025400         10  MR-TRAILERL                PIC S9(04) COMP.          02540021
025500         10  MR-TRAILERA                PIC  X(01).               02550021
025600         10  MR-TRAILERC                PIC  X(01).               02560021
025700         10  MR-TRAILERH                PIC  X(01).               02570021
025800         10  MR-TRAILER                 PIC  X(10).               02580021
025900                                                                  02590021
026000         10  MR-STATUSL                 PIC S9(04) COMP.          02600021
026100         10  MR-STATUSA                 PIC  X(01).               02610021
026200         10  MR-STATUSC                 PIC  X(01).               02620021
026300         10  MR-STATUSH                 PIC  X(01).               02630021
026400         10  MR-STATUS                  PIC  X(02).               02640021
026500                                                                  02650021
026600*----------------------------------------------------------------*02660021
026700**  SECURITY SUBROUTINE PARAMETERS                                02670021
026800*----------------------------------------------------------------*02680021
026900     COPY DPWS008.                                                02690021
027000/                                                                 02700021
027100*---------------------------------------------------------------* 02710021
027200*    ABEND PROCESSING COPYBOOK.                                 * 02720021
027300*---------------------------------------------------------------* 02730021
027400                                                                  02740021
027500     COPY DPWS013.                                                02750021
027600                                                                  02760021
027700/                                                                 02770021
027800*---------------------------------------------------------------* 02780021
027900*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02790021
028000*---------------------------------------------------------------* 02800021
028100                                                                  02810021
028200     COPY DPWS015.                                                02820021
028300                                                                  02830021
028400*---------------------------------------------------------------* 02840021
028500*    FUNCTION KEYS COPYBOOK.                                    * 02850021
028600*---------------------------------------------------------------* 02860021
028700                                                                  02870021
028800     COPY DPWS016.                                                02880021
028900                                                                  02890021
029000*---------------------------------------------------------------* 02900021
029100*    NUMERIC EDIT LAYOUT.                                       * 02910021
029200*---------------------------------------------------------------* 02920021
029300                                                                  02930021
029400     COPY DPWS010I.                                               02940021
029500/                                                                 02950021
029600******************************************************************02960025
029700** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **02970025
029710** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **02971025
029800******************************************************************02980025
029900                                                                  02990021
030000     COPY DPWS030.                                                03000021
030010     COPY DPWS930.                                                03001025
030100/                                                                 03010021
030200*---------------------------------------------------------------* 03020021
030300*    STANDARD COMMAREA.                                         * 03030021
030400*---------------------------------------------------------------* 03040021
030500                                                                  03050021
030600     COPY DPWS020.                                                03060021
030700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03070021
030800                                                                  03080021
030900*---------------------------------------------------------------* 03090021
031000* INTER-APPLICATION COMMAREA.                                   * 03100021
031100*---------------------------------------------------------------* 03110021
031200                                                                  03120021
031300         10  INTER-APPL-COMM-AREA       PIC X(200).               03130021
031400     COPY RCWS012.                                                03140021
031500     COPY RCWS015.                                                03150021
031600*---------------------------------------------------------------* 03160021
031700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03170021
031800*---------------------------------------------------------------* 03180021
031900         10  ASC-SPECIFIC-COMMAREA.                               03190021
032000             15  ASC-LIST-KEYS.                                   03200021
032100                 20  ASC-KEY-OPER-UNT-ID             PIC S9(04)   03210021
032200                                                         COMP.    03220021
032300                 20  ASC-KEY-FCLTY-ID                PIC S9(04)   03230021
032400                                                         COMP.    03240021
032500                 20  ASC-KEY-PO-NBR                  PIC S9(09)   03250021
032600                                                         COMP.    03260021
032700                 20  ASC-KEY-REC-SEQ-NBR             PIC S9(09)   03270021
032800                                                         COMP.    03280021
032900                 20  ASC-KEY-PROCESS-AREA            PIC  X(04).  03290021
033000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03300021
033100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03310021
033200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03320021
033300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03330021
033400                                                                  03340021
033500                 20  ASC-ITEM-ARRAY.                              03350021
033600                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        03360021
033700                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   03370021
033800                                                     COMP-3.      03380021
033900                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03390021
034000                             88  ASC-VALID-TRAILER   VALUE ' '    03400021
034100                                                           'S'    03410021
034200                                                           'B'    03420021
034300                                                           'E'.   03430021
034400                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03440021
034500                             88  ASC-TEMP-SELECT     VALUE 'S'.   03450021
034600                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03460021
034700                             88  ASC-TEMP-END        VALUE 'E'.   03470021
034800                         30  ASC-SELECTED-SW         PIC  X(01).  03480021
034900                             88  ASC-NO-SELECT       VALUE ' '.   03490021
035000                             88  ASC-SELECT          VALUE 'S'.   03500021
035100                             88  ASC-BEGIN           VALUE 'B'.   03510021
035200                             88  ASC-END             VALUE 'E'.   03520021
035300                         30  ASC-CTN-CNT             PIC S9(04)   03530021
035400                                                         COMP.    03540021
035500                         30  ASC-ACTL-CTN-CNT        PIC S9(04)   03550021
035600                                                         COMP.    03560021
035700                         30  ASC-DMG-CTN-CNT         PIC S9(04)   03570021
035800                                                         COMP.    03580021
035900                         30  ASC-SHIPT-ID            PIC S9(09)   03590021
036000                                                         COMP.    03600021
036100                         30  ASC-PO-NBR              PIC S9(09)   03610021
036200                                                         COMP.    03620021
036300                         30  ASC-REC-SEQ-NBR         PIC S9(09)   03630021
036400                                                         COMP.    03640021
036500                         30  ASC-PRO-NBR             PIC  X(16).  03650021
036600                         30  ASC-BOL-NBR             PIC  X(16).  03660021
036700                         30  ASC-PKSL-IND            PIC  X(01).  03670021
036800                         30  ASC-SCAC                PIC  X(04).  03680021
036900                         30  ASC-TRAILER             PIC  X(10).  03690021
037000                         30  ASC-STATUS              PIC  X(02).  03700021
037100                         30  ASC-PRIMARY-IND         PIC  X(01).  03710021
037200                         30  ASC-OPER-UNT-ID         PIC  S9(04)  03720021
037300                                                          COMP.   03730021
037400                         30  ASC-FCLTY-ID            PIC  S9(04)  03740021
037500                                                          COMP.   03750021
037600                         30  ASC-TRIP-ID             PIC  S9(09)  03760021
037700                                                          COMP.   03770021
037800                                                                  03780021
037900             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     03790021
038000             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03800021
038100             15  ASC-SEL-SUB            PIC S9(04) COMP SYNC.     03810021
038200             15  ASC-SEL-ITEM           PIC S9(04) COMP SYNC.     03820021
038300             15  ASC-NUMBER-OF-ITEMS-READ                         03830021
038400                                        PIC S9(09) COMP-3.        03840021
038500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03850021
038600                                                          COMP-3. 03860021
038700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03870021
038800                                                          COMP-3. 03880021
038900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03890021
039000                                                          COMP-3. 03900021
039100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03910021
039200                                                          COMP-3. 03920021
039300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03930021
039400                                                          COMP    03940021
039500                                                          SYNC.   03950021
039600             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03960021
039700                                                          COMP-3. 03970021
039800             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03980021
039900                                                          COMP-3. 03990021
040000             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05) COMP-3.        04000021
040100             15  ASC-USE-SELECTION-QUEUE-IND                      04010021
040200                                           PIC  X(01).            04020021
040300                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 04030021
040400             15  ASC-ITEMS-LEFT-INDICATOR                         04040021
040500                                        PIC  X(01).               04050021
040600                 88  ASC-ITEMS-LEFT-ON-DB     VALUE 'Y'.          04060021
040700                 88  ASC-NO-ITEMS-LEFT-ON-DB  VALUE 'N'.          04070021
040800             15  ASC-LIST-QUEUE-NAME.                             04080021
040900                 20  ASC-LIST-TERM-ID           PIC  X(04).       04090021
041000                 20  ASC-LIST-TASK-NUMBER       PIC S9(05) COMP-3.04100021
041100                 20  ASC-LIST-SEQ               PIC  9(01).       04110021
041200             15  ASC-SEL-QUEUE-NAME.                              04120021
041300                 20  ASC-SEL-TERM-ID            PIC X(04).        04130021
041400                 20  ASC-SEL-TASK-NUMBER        PIC S9(05) COMP-3.04140021
041500                 20  ASC-SEL-SEQ                PIC 9(01).        04150021
041600                                                                  04160021
041700             15  ASC-START-ITEM-REQUEST.                          04170021
041800                 20  ASC-START-ITEM-REQUEST-N   PIC  9(07).       04180021
041900                                                                  04190021
042000             15  ASC-ENT-NAME-DESC              PIC  X(25).       04200021
042100             15  ASC-DETACH-SW                  PIC  X(01).       04210021
042200                 88  ASC-DETACH-SUCCESSFUL    VALUE 'Y'.          04220021
042300                                                                  04230021
042400/                                                                 04240021
042500*---------------------------------------------------------------* 04250021
042600*    DB2 AREA FOR SHIPMENT PO TABLE                             * 04260021
042700*---------------------------------------------------------------* 04270021
042800     EXEC SQL                                                     04280021
042900          INCLUDE TSHPTPO                                         04290021
043000     END-EXEC.                                                    04300021
043100                                                                  04310021
043200/                                                                 04320021
043300*---------------------------------------------------------------* 04330021
043400*    DB2 AREA FOR AUDIT SHIPMENT PO TABLE                       * 04340021
043500*---------------------------------------------------------------* 04350021
043600     EXEC SQL                                                     04360021
043700          INCLUDE TAUSHPO                                         04370021
043800     END-EXEC.                                                    04380021
043900                                                                  04390021
044000/                                                                 04400021
044100*---------------------------------------------------------------* 04410021
044200*    DB2 AREA FOR RECEIVER TABLE                                * 04420021
044300*---------------------------------------------------------------* 04430021
044400     EXEC SQL                                                     04440021
044500          INCLUDE TRECEIV                                         04450021
044600     END-EXEC.                                                    04460021
044700                                                                  04470021
044800/                                                                 04480021
044900*---------------------------------------------------------------* 04490021
045000*    DB2 AREA FOR SHIPMENT TABLE                                * 04500021
045100*---------------------------------------------------------------* 04510021
045200     EXEC SQL                                                     04520021
045300          INCLUDE TSHIPMT                                         04530021
045400     END-EXEC.                                                    04540021
045500                                                                  04550021
045600/                                                                 04560021
045700*---------------------------------------------------------------* 04570021
045800*    DB2 AREA FOR TRIP TABLE                                    * 04580021
045900*---------------------------------------------------------------* 04590021
046000     EXEC SQL                                                     04600021
046100          INCLUDE TVHTRIP                                         04610021
046200     END-EXEC.                                                    04620021
046300                                                                  04630021
046400/                                                                 04640021
046500*---------------------------------------------------------------* 04650021
046600*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 04660021
046700*---------------------------------------------------------------* 04670021
046800     EXEC SQL                                                     04680021
046900          INCLUDE TENTNME                                         04690021
047000     END-EXEC.                                                    04700021
047100                                                                  04710021
047200/                                                                 04720021
047300*---------------------------------------------------------------* 04730021
047400*    DB2 AREA FOR THE PO TABLE                                  * 04740021
047500*---------------------------------------------------------------* 04750021
047600     EXEC SQL                                                     04760021
047700          INCLUDE TPURCHS                                         04770021
047800     END-EXEC.                                                    04780021
047900                                                                  04790021
048000/                                                                 04800021
048100*---------------------------------------------------------------* 04810021
048200*    DB2 AREA FOR COMMUNICATIONS                                * 04820021
048300*---------------------------------------------------------------* 04830021
048400     EXEC SQL                                                     04840021
048500          INCLUDE SQLCA                                           04850021
048600     END-EXEC.                                                    04860021
048700                                                                  04870021
048800/                                                                 04880021
048900*---------------------------------------------------------------* 04890021
049000*    DB2 AREA FOR THE TRIP STATUS TABLE                         * 04900021
049100*---------------------------------------------------------------* 04910021
049200     EXEC SQL                                                     04920021
049300          INCLUDE TTRIPST                                         04930021
049400     END-EXEC.                                                    04940021
049500                                                                  04950021
049600/                                                                 04960021
049700*---------------------------------------------------------------* 04970021
049800*    DB2 AREA FOR THE TRIP STATUS CODE TABLE                    * 04980021
049900*---------------------------------------------------------------* 04990021
050000     EXEC SQL                                                     05000021
050100          INCLUDE TTRSTYP                                         05010021
050200     END-EXEC.                                                    05020021
050300                                                                  05030021
050400/                                                                 05040021
050500*----------------------------------------------------------------*05050021
050600*    DB2 AREA FOR WORK ORDER TABLE                               *05060021
050700*----------------------------------------------------------------*05070021
050800                                                                  05080021
050900     EXEC SQL                                                     05090021
051000          INCLUDE TWRKORD                                         05100021
051100     END-EXEC.                                                    05110021
051200                                                                  05120021
051300/                                                                 05130021
051400*----------------------------------------------------------------*05140021
051500*    DB2 AREA FOR TDCFAAS  DEPT/CLASS FACILITY LOC. ASSIGNMENTS  *05150021
051600*----------------------------------------------------------------*05160021
051700                                                                  05170021
051800     EXEC SQL                                                     05180021
051900          INCLUDE TDCFAAS                                         05190021
052000     END-EXEC.                                                    05200021
052100                                                                  05210021
052200/                                                                 05220021
052300*----------------------------------------------------------------*05230021
052400*    DB2 AREA FOR OPERATION SET TABLE                            *05240021
052500*----------------------------------------------------------------*05250021
052600                                                                  05260021
052700     EXEC SQL                                                     05270021
052800          INCLUDE TOPRSET                                         05280021
052900     END-EXEC.                                                    05290021
053000                                                                  05300021
053100/                                                                 05310021
053200*---------------------------------------------------------------* 05320021
053300*    DB2 AREA FOR PURCHASE ORDER LINE ITEM TABLE                * 05330021
053400*---------------------------------------------------------------* 05340021
053500     EXEC SQL                                                     05350021
053600          INCLUDE TPURITM                                         05360021
053700     END-EXEC.                                                    05370021
053800                                                                  05380021
053900/                                                                 05390021
054000*---------------------------------------------------------------* 05400021
054100*     PO-SHIPMENT CURSOR DECLARE                                * 05410021
054200*---------------------------------------------------------------* 05420021
054300                                                                  05430021
054400     EXEC SQL                                                     05440021
054500          DECLARE PO-SHIPMENT CURSOR FOR                          05450021
054600             SELECT A.EXPTED_CART_CNT                             05460021
054700                   ,A.ACTL_CART_CNT                               05470021
054800                   ,A.DMG_CART_CNT                                05480021
054900                   ,A.PKSL_IND                                    05490021
055000                   ,A.SHIPT_ID                                    05500021
055100                   ,A.REC_SEQ_NBR                                 05510021
055200                   ,A.PRIM_SHIPT_IND                              05520021
055300                   ,B.PRO_NBR                                     05530021
055400                   ,B.BOL_NBR                                     05540021
055500                   ,C.OWNER_SCAC_ID                               05550021
055600                   ,C.VEH_NBR                                     05560021
055700                   ,C.TRIP_ID                                     05570021
055800                   ,D.TRIP_STATUS_CDE                             05580021
055900                   ,D.OPER_UNT_ID                                 05590021
056000                   ,D.FCLTY_ID                                    05600021
056100               FROM TSHPTPO A,                                    05610021
056200                    TSHIPMT B,                                    05620021
056300                    TVHTRIP C,                                    05630021
056400                    TTRIPST D,                                    05640021
056500                    TTRSTYP E                                     05650021
056600              WHERE A.PO_NBR        = :DK-PO-NBR                  05660021
056700                AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR             05670021
056800                AND C.VEH_NBR IS NOT NULL                         05680021
056900                AND A.SHIPT_ID = B.SHIPT_ID                       05690021
057000                AND B.TRIP_ID  = C.TRIP_ID                        05700021
057100                AND E.PRTY_CDE =                                  05710021
057200                    (SELECT MAX(G.PRTY_CDE)                       05720021
057300                       FROM TTRIPST F                             05730021
057400                           ,TTRSTYP G                             05740021
057500                      WHERE F.TRIP_ID         = B.TRIP_ID         05750021
057600                        AND F.TRIP_STATUS_CDE = G.TRIP_STATUS_CDE)05760021
057700                AND  C.TRIP_ID         = D.TRIP_ID                05770021
057800                AND  D.TRIP_STATUS_CDE = E.TRIP_STATUS_CDE        05780021
057900             ORDER BY B.PRO_NBR                                   05790021
058000                     ,B.BOL_NBR                                   05800021
058100     END-EXEC.                                                    05810021
058200                                                                  05820021
058300/                                                                 05830021
058400 LINKAGE SECTION.                                                 05840021
058500                                                                  05850021
058600 01  DFHCOMMAREA.                                                 05860021
058700     05  FILLER                          OCCURS 1 TO 4072 TIMES   05870021
058800                                         DEPENDING ON EIBCALEN.   05880021
058900         10  FILLER                      PIC X.                   05890021
059000                                                                  05900021
059100/                                                                 05910021
059200 PROCEDURE DIVISION.                                              05920021
059300******************************************************************05930021
059400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05940021
059500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05950021
059600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05960021
059700******************************************************************05970021
059800 0000-MAIN-MODULE.                                                05980021
059900                                                                  05990021
060000     INITIALIZE DP030-CICS-API-FIELDS.                            06000021
060100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06010021
060200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06020021
060300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06030021
060400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06040021
060500     MOVE LENGTH OF RC238AI        TO DP030-MAP-LENGTH (1).       06050021
060600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06060021
060700                                                                  06070021
060800     PERFORM 0001-CALL-CICS-ARCH-API.                             06080021
060900     PERFORM 1000-CONTROL-PROCESSING                              06090021
061000                                                                  06100021
061100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06110021
061200     PERFORM 0001-CALL-CICS-ARCH-API.                             06120021
061300                                                                  06130021
061400******************************************************************06140021
061500**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06150021
061600**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06160021
061700******************************************************************06170021
061800 0001-CALL-CICS-ARCH-API.                                         06180021
061910     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06191025
062000                                    DFHCOMMAREA                   06200025
062100                                    DP030-CICS-API-FIELDS         06210025
062200                                    DP020-STANDARD-COMMAREA       06220025
062300                                    RC238AI.                      06230025
062400*                                                                 06240021
062500     IF DP030-RC-CALL-SUCCESSFUL                                  06250021
062600         CONTINUE                                                 06260021
062700     ELSE                                                         06270021
062800         SET DP013-NO-ROLLBACK                                    06280021
062900             DP013-XCTL-DISPLAY-RESTART                           06290021
063000             DP013-CICS-ABEND      TO TRUE                        06300021
063100         MOVE 'BEFORE 0000-MAIN-MODULE'                           06310021
063200                                   TO DP013-PARAGRAPH             06320021
063220         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O06322025
063230-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06323025
063500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06350021
063600         PERFORM DP013-0000-PROCESS-ABEND                         06360021
063700     END-IF.                                                      06370021
063800*----------------------------------------------------------------*06380021
063900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06390021
064000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06400021
064100*                                                                *06410021
064200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06420021
064300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06430021
064400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06440021
064500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06450021
064600*----------------------------------------------------------------*06460021
064700                                                                  06470021
064800 1000-CONTROL-PROCESSING.                                         06480021
064900                                                                  06490021
065000     EVALUATE TRUE                                                06500021
065100                                                                  06510021
065200         WHEN DP020-NEXT-ACT-INITIAL                              06520021
065300             INITIALIZE ASC-SPECIFIC-COMMAREA                     06530021
065400             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06540021
065500                                      ASC-SEL-TERM-ID             06550021
065600             MOVE DP020-SRC-TASK-NUMBER                           06560021
065700                                   TO ASC-LIST-TASK-NUMBER        06570021
065800                                      ASC-SEL-TASK-NUMBER         06580021
065900             MOVE PC-LIST-QUEUE-SEQ                               06590021
066000                                   TO ASC-LIST-SEQ                06600021
066100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06610021
066200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06620021
066300                                                                  06630021
066400             IF  PS-COMMAREA-NOT-VALID                            06640021
066500                 CONTINUE                                         06650021
066600             ELSE                                                 06660021
066700                 PERFORM 4000-BUILD-INITIAL-PANEL                 06670021
066800             END-IF                                               06680021
066900                                                                  06690021
067000         WHEN DP020-NEXT-ACT-READ-MAP                             06700021
067100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06710021
067200                                   TO PV-TOP-ITEM                 06720021
067300             PERFORM 2000-PROCESS-PANEL                           06730021
067400                                                                  06740021
067500         WHEN DP020-NEXT-ACT-RETURN                               06750021
067600             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06760021
067700             MOVE ASC-KEY-REC-SEQ-NBR                             06770021
067800                                   TO DK-REC-SEQ-NBR              06780021
067900             PERFORM 2050-DELETE-LIST-QUEUE                       06790021
068000             PERFORM 4000-BUILD-INITIAL-PANEL                     06800021
068100                                                                  06810021
068200         WHEN OTHER                                               06820021
068300             SET DP013-LOGIC-ABEND TO TRUE                        06830021
068400             SET DP013-NO-ROLLBACK TO TRUE                        06840021
068500             MOVE '1000-CONTROL-PROCESSING'                       06850021
068600                                   TO DP013-PARAGRAPH             06860021
068700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06870021
068800                                   TO DP013-MESSAGE-TEXT(1)       06880021
068900             PERFORM DP013-0000-PROCESS-ABEND                     06890021
069000     END-EVALUATE.                                                06900021
069100/                                                                 06910021
069200*----------------------------------------------------------------*06920021
069300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06930021
069400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06940021
069500*----------------------------------------------------------------*06950021
069600                                                                  06960021
069700 1100-PROCESS-INTER-APPL-COMM.                                    06970021
069800                                                                  06980021
069900     SET PS-COMMAREA-VALID         TO TRUE.                       06990021
070000     MOVE SPACES                   TO ASC-START-ITEM-REQUEST.     07000021
070100                                                                  07010021
070200     EVALUATE DP020-INT-APPL-FORMAT-IND                           07020021
070300                                                                  07030021
070400         WHEN PC-INTER-APPL-DETAIL                                07040021
070500             MOVE RC012-OPER-UNT-ID                               07050021
070600                                   TO ASC-KEY-OPER-UNT-ID         07060021
070700             MOVE RC012-FCLTY-ID   TO ASC-KEY-FCLTY-ID            07070021
070800             MOVE RC012-PO-NBR     TO ASC-KEY-PO-NBR              07080021
070900                                      DK-PO-NBR                   07090021
071000             MOVE RC012-REC-SEQ-NBR                               07100021
071100                                   TO ASC-KEY-REC-SEQ-NBR         07110021
071200                                      DK-REC-SEQ-NBR              07120021
071300             PERFORM 1140-GET-ENT-NAME                            07130021
071400                                                                  07140021
071500         WHEN PC-INTER-APPL-LIST                                  07150021
071600             SET ASC-USE-SELECTION-QUEUE TO TRUE                  07160021
071700             MOVE RC015-NUMBER-OF-SELECTED-ITEMS                  07170021
071800                                   TO ASC-NUMBER-OF-SELECTED-ITEMS07180021
071900             MOVE RC015-NUMBER-OF-TS-ITEMS                        07190021
072000                                   TO ASC-NUMBER-OF-TS-ITEMS      07200021
072100             MOVE RC015-SEL-QUEUE-NAME                            07210021
072200                                   TO ASC-SEL-QUEUE-NAME          07220021
072300             PERFORM 1120-PREPARE-LIST-ENTRY                      07230021
072400                                                                  07240021
072500         WHEN OTHER                                               07250021
072600             SET PS-COMMAREA-NOT-VALID TO TRUE                    07260021
072700                                                                  07270021
072800     END-EVALUATE.                                                07280021
072900                                                                  07290021
073000*----------------------------------------------------------------*07300021
073100* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *07310021
073200* STORAGE QUEUE PASSED FROM THE LIST.                            *07320021
073300*----------------------------------------------------------------*07330021
073400 1120-PREPARE-LIST-ENTRY.                                         07340021
073500     MOVE RC013-MAX-ITEMS          TO ASC-SEL-SUB.                07350021
073600     MOVE ZERO                     TO ASC-SEL-ITEM.               07360021
073700     PERFORM 2150-GET-NEXT-RECORD.                                07370021
073800/                                                                 07380021
073900*----------------------------------------------------------------*07390021
074000*    GET THE VENDOR NAME                                         *07400021
074100*----------------------------------------------------------------*07410021
074200* ADD THE NEW FIELD DEPT # TO BE RETRIEVED FROM TPURCHS           07420021
074300*----------------------------------------------------------------*07430021
074400 1140-GET-ENT-NAME.                                               07440021
074500                                                                  07450021
074600     PERFORM                                                      07460021
074700         WITH TEST AFTER                                          07470021
074800         VARYING PV-RETRY-COUNTER                                 07480021
074900         FROM 1 BY 1                                              07490021
075000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07500021
075100             OR (SQLCODE = +0)                                    07510021
075200             OR (SQLCODE = +100))                                 07520021
075300                                                                  07530021
075400         EXEC SQL                                                 07540021
075500              SELECT ENT_NAME_DESC,                               07550021
075600                     A.DEPT_NBR                                   07560021
075700                INTO :ENTNME-ENT-NAME-DESC,                       07570021
075800                     :DK-DEPT-NBR                                 07580021
075900                FROM TPURCHS A                                    07590021
076000                    ,TENTNME B                                    07600021
076100               WHERE A.PO_NBR         = :DK-PO-NBR                07610021
076200                 AND A.VER_STATUS_CDE = 'A'                       07620021
076300                 AND B.TYPE_CDE       = '01'                      07630021
076400                 AND A.ENT_ID = B.ENT_ID                          07640021
076500         END-EXEC                                                 07650021
076600                                                                  07660021
076700         EVALUATE TRUE                                            07670021
076800             WHEN SQLCODE = +0                                    07680021
076900                  MOVE ENTNME-ENT-NAME-DESC TO ASC-ENT-NAME-DESC  07690021
077000                                                                  07700021
077100             WHEN SQLCODE = +100                                  07710021
077200             WHEN SQLCODE = -904                                  07720021
077300             WHEN SQLCODE = -913                                  07730021
077400                  CONTINUE                                        07740021
077500                                                                  07750021
077600             WHEN SQLWARN0 NOT = SPACES                           07760021
077700             WHEN SQLCODE < +0                                    07770021
077800             WHEN SQLCODE > +0                                    07780021
077900                  MOVE '1140-GET-ENT-NAME'                        07790021
078000                                  TO DP013-PARAGRAPH              07800021
078100                  MOVE 'UNSUCCESSFUL SELECT ON TENTNME TABLE'     07810021
078200                                  TO DP013-MESSAGE-TEXT (1)       07820021
078300                  MOVE SQLCA      TO DP013-SQLCA                  07830021
078400                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     07840021
078500                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)     07850021
078600                  SET DP013-DB2-ABEND                             07860021
078700                      DP013-XCTL-DISPLAY-RESTART                  07870021
078800                                  TO TRUE                         07880021
078900                  PERFORM DP013-0000-PROCESS-ABEND                07890021
079000         END-EVALUATE                                             07900021
079100     END-PERFORM.                                                 07910021
079200                                                                  07920021
079300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    07930021
079400         SQLCODE NOT = +0                                         07940021
079500         MOVE '1140-GET-ENT-NAME  '                               07950021
079600                                  TO DP013-PARAGRAPH              07960021
079700         MOVE 'MAX RETRIES EXCEEDED ON SELECT TENTNME TABLE'      07970021
079800                                  TO DP013-MESSAGE-TEXT (1)       07980021
079900         MOVE SQLCA               TO DP013-SQLCA                  07990021
080000         MOVE 'TPURCHS'           TO DP013-DB2-TABLE-NAME (1)     08000021
080100         MOVE 'TENTNME'           TO DP013-DB2-TABLE-NAME (2)     08010021
080200         SET DP013-DB2-ABEND                                      08020021
080300             DP013-XCTL-DISPLAY-RESTART                           08030021
080400                                  TO TRUE                         08040021
080500         PERFORM DP013-0000-PROCESS-ABEND                         08050021
080600     END-IF.                                                      08060021
080700                                                                  08070021
080800/                                                                 08080021
080900*----------------------------------------------------------------*08090021
081000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08100021
081100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08110021
081200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08120021
081300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08130021
081400* FUNCTION KEYS CAN GET THIS FAR.                                *08140021
081500*----------------------------------------------------------------*08150021
081600                                                                  08160021
081700 2000-PROCESS-PANEL.                                              08170021
081800                                                                  08180021
081900     EVALUATE TRUE                                                08190021
082000         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    08200021
082100             IF  ASC-DETACH-SUCCESSFUL                            08210021
082200                 MOVE PC-TSYMSG-00045                             08220021
082300                                   TO DP020-MSG-NUMBER            08230021
082400                 SET DP020-MSG-FATAL                              08240021
082500                     PS-ERROR      TO TRUE                        08250021
082600                 PERFORM 3200-RESET-ATTRIBUTES                    08260021
082700             ELSE                                                 08270021
082800                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               08280021
082900                 IF PS-NO-ERROR                                   08290021
083000                     SET DP030-CONTINUE-GO                        08300021
083100                                   TO TRUE                        08310021
083200                     IF ASC-NUMBER-OF-SELECTED-ITEMS = 0          08320021
083300                         SET DP030-OVERRIDE-GO                    08330021
083400                                           TO TRUE                08340021
083500                         MOVE PC-TSYMSG-00057                     08350021
083600                                   TO DP020-MSG-NUMBER            08360021
083700                         SET DP020-MSG-WARNING                    08370021
083800                                    TO TRUE                       08380021
083900                     ELSE                                         08390021
084000                         IF ASC-NUMBER-OF-SELECTED-ITEMS > 1      08400021
084100                             SET DP030-OVERRIDE-GO                08410021
084200                                           TO TRUE                08420021
084300                             MOVE PC-TSYMSG-00047                 08430021
084400                                           TO DP020-MSG-NUMBER    08440021
084500                             SET DP020-MSG-WARNING                08450021
084600                                           TO TRUE                08460021
084700                         ELSE                                     08470021
084800                             PERFORM 5000-PREPARE-SEL-QUEUE       08480021
084900                             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR   08490021
085000                             MOVE ASC-KEY-REC-SEQ-NBR             08500021
085100                                           TO DK-REC-SEQ-NBR      08510021
085200                             PERFORM 2050-DELETE-LIST-QUEUE       08520021
085300                             PERFORM 4000-BUILD-INITIAL-PANEL     08530021
085400                                                                  08540021
085500                         END-IF                                   08550021
085600                     END-IF                                       08560021
085700                 END-IF                                           08570021
085800             END-IF                                               08580021
085900                                                                  08590021
086000         WHEN DP020-SRC-AID = DP016-CLEAR                         08600021
086100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08610021
086200             PERFORM 3200-RESET-ATTRIBUTES                        08620021
086300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08630021
086400                                                                  08640021
086500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08650021
086600             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   08660021
086700             MOVE ASC-KEY-REC-SEQ-NBR                             08670021
086800                                   TO DK-REC-SEQ-NBR              08680021
086900             PERFORM 2050-DELETE-LIST-QUEUE                       08690021
087000             PERFORM 4000-BUILD-INITIAL-PANEL                     08700021
087100                                                                  08710021
087200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             08720021
087300             IF  ASC-USE-SELECTION-QUEUE                          08730021
087400                 SET PS-RECORD-FOUND TO TRUE                      08740021
087500                 PERFORM 2150-GET-NEXT-RECORD                     08750021
087600                 IF PS-NO-RECORD-FOUND                            08760021
087700                     CONTINUE                                     08770021
087800                 ELSE                                             08780021
087900                     PERFORM 3200-RESET-ATTRIBUTES                08790021
088000                     PERFORM 4000-BUILD-INITIAL-PANEL             08800021
088100                 END-IF                                           08810021
088200             ELSE                                                 08820021
088300*                --- BOTTOM OF LIST ---                           08830021
088400                 MOVE PC-TSYMSG-00070                             08840021
088500                                   TO DP020-MSG-NUMBER            08850021
088600                 SET DP020-MSG-INFORMATIONAL                      08860021
088700                                   TO TRUE                        08870021
088800             END-IF                                               08880021
088900                                                                  08890021
089000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             08900021
089100             IF  ASC-USE-SELECTION-QUEUE                          08910021
089200                 SET PS-RECORD-FOUND TO TRUE                      08920021
089300                 PERFORM 2160-GET-PREV-RECORD                     08930021
089400                 IF PS-NO-RECORD-FOUND                            08940021
089500                     CONTINUE                                     08950021
089600                 ELSE                                             08960021
089700                     PERFORM 3200-RESET-ATTRIBUTES                08970021
089800                     PERFORM 4000-BUILD-INITIAL-PANEL             08980021
089900                 END-IF                                           08990021
090000             ELSE                                                 09000021
090100*                --- TOP OF LIST ---                              09010021
090200                 MOVE PC-TSYMSG-00069                             09020021
090300                                   TO DP020-MSG-NUMBER            09030021
090400                 SET DP020-MSG-INFORMATIONAL                      09040021
090500                                   TO TRUE                        09050021
090600             END-IF                                               09060021
090700                                                                  09070021
090800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    09080021
090900             PERFORM 2140-DESELECT-ALL-ITEMS                      09090021
091000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09100021
091100                                                                  09110021
091200         WHEN OTHER                                               09120021
091300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 09130021
091400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09140021
091500             IF  PS-NO-ERROR                                      09150021
091600                 SET DP030-CONTINUE-GO                            09160021
091700                                 TO TRUE                          09170021
091800                 PERFORM 2100-CHECK-FUNCTION-KEY                  09180021
091900             ELSE                                                 09190021
092000                 SET DP030-OVERRIDE-GO                            09200021
092100                                 TO TRUE                          09210021
092200             END-IF                                               09220021
092300     END-EVALUATE.                                                09230021
092400/                                                                 09240021
092500*----------------------------------------------------------------*09250021
092600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *09260021
092700*----------------------------------------------------------------*09270021
092800 2050-DELETE-LIST-QUEUE.                                          09280021
092900                                                                  09290021
093000     EXEC CICS                                                    09300021
093100         DELETEQ TS                                               09310021
093200             QUEUE (ASC-LIST-QUEUE-NAME)                          09320021
093300             RESP  (PV-CICS-RESP)                                 09330021
093400     END-EXEC.                                                    09340021
093500                                                                  09350021
093600     IF (PV-CICS-RESP = DFHRESP(NORMAL))                          09360021
093700     OR (PV-CICS-RESP = DFHRESP(QIDERR))                          09370021
093800         CONTINUE                                                 09380021
093900     ELSE                                                         09390021
094000         SET DP013-CICS-ABEND      TO TRUE                        09400021
094100         SET DP013-NO-ROLLBACK     TO TRUE                        09410021
094200                                                                  09420021
094300         MOVE '2050-DELETE-LIST-QUEUE'                            09430021
094400                                   TO DP013-PARAGRAPH             09440021
094500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09450021
094600                                   TO DP013-MESSAGE-TEXT (1)      09460021
094700         PERFORM DP013-0000-PROCESS-ABEND                         09470021
094800     END-IF.                                                      09480021
094900                                                                  09490021
095000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09500021
095100/                                                                 09510021
095200*----------------------------------------------------------------*09520021
095300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09530021
095400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09540021
095500* CICS ARCHITECTURE API.                                         *09550021
095600*----------------------------------------------------------------*09560021
095700                                                                  09570021
095800 2100-CHECK-FUNCTION-KEY.                                         09580021
095900                                                                  09590021
096000     EVALUATE TRUE                                                09600021
096100                                                                  09610021
096200         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  09620021
096300             IF  ASC-NUMBER-OF-SELECTED-ITEMS > +0                09630021
096400                 INITIALIZE RC015-INTER-APPL-COMMAREA             09640021
096500                 MOVE ASC-KEY-OPER-UNT-ID                         09650021
096600                                TO  RC015-OPER-UNT-ID             09660021
096700                 MOVE ASC-KEY-FCLTY-ID                            09670021
096800                                TO  RC015-FCLTY-ID                09680021
096900                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                09690021
097000                                TO  RC015-NUMBER-OF-SELECTED-ITEMS09700021
097100                 MOVE ASC-NUMBER-OF-TS-ITEMS                      09710021
097200                                TO  RC015-NUMBER-OF-TS-ITEMS      09720021
097300                 MOVE ASC-SEL-QUEUE-NAME                          09730021
097400                                TO  RC015-SEL-QUEUE-NAME          09740021
097500                 PERFORM 5000-PREPARE-SEL-QUEUE                   09750021
097600             ELSE                                                 09760021
097700                 MOVE PC-TSYMSG-00057                             09770021
097800                                   TO DP020-MSG-NUMBER            09780021
097900                 MOVE -1           TO ASEL01L                     09790021
098000                 SET DP030-SET-CURSOR-APPL-1                      09800021
098100                                   TO TRUE                        09810021
098200                 SET DP020-MSG-FATAL                              09820021
098300                                   TO TRUE                        09830021
098400                 SET PS-ERROR      TO TRUE                        09840021
098500             END-IF                                               09850021
098600                                                                  09860021
098700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09870021
098800             IF ASC-NUMBER-OF-SELECTED-ITEMS = 0                  09880021
098900                 SET DP030-OVERRIDE-GO                            09890021
099000                                   TO TRUE                        09900021
099100                 MOVE PC-TSYMSG-00057                             09910021
099200                                   TO DP020-MSG-NUMBER            09920021
099300                 SET DP020-MSG-WARNING                            09930021
099400                                    TO TRUE                       09940021
099500             ELSE                                                 09950021
099600                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 1              09960021
099700                     SET DP030-OVERRIDE-GO                        09970021
099800                                       TO TRUE                    09980021
099900                     MOVE PC-TSYMSG-00047                         09990021
100000                                       TO DP020-MSG-NUMBER        10000021
100100                     SET DP020-MSG-WARNING                        10010021
100200                                        TO TRUE                   10020021
100300                 ELSE                                             10030021
100400                     PERFORM 2170-CHECK-RACF-ACCESS               10040021
100500                     IF DP008-ACCESS-DENIED                       10050021
100600*                    -- NO SECURITY CLEARANCE FOR FUNCTION --     10060021
100700                         SET DP030-OVERRIDE-GO                    10070021
100800                                           TO TRUE                10080021
100900                         MOVE PC-TSYMSG-01061                     10090021
101000                                           TO DP020-MSG-NUMBER    10100021
101100                         SET DP020-MSG-WARNING                    10110021
101200                                        TO TRUE                   10120021
101300                         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN     10130021
101400                     ELSE                                         10140021
101500                         MOVE PC-TSYMSG-00004                     10150021
101600                                       TO DP020-MSG-NUMBER        10160021
101700                         SET DP020-MSG-INFORMATIONAL   TO TRUE    10170021
101800                     END-IF                                       10180021
101900                                                                  10190021
102000                 END-IF                                           10200021
102100             END-IF                                               10210021
102200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  10220021
102300             MOVE +1               TO PV-TOP-ITEM                 10230021
102400             PERFORM 3200-RESET-ATTRIBUTES                        10240021
102500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10250021
102600                                                                  10260021
102700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   10270021
102800             PERFORM 2110-BROWSE-BACKWARD                         10280021
102900             PERFORM 3200-RESET-ATTRIBUTES                        10290021
103000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10300021
103100                                                                  10310021
103200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   10320021
103300             PERFORM 2120-BROWSE-FORWARD                          10330021
103400             PERFORM 3200-RESET-ATTRIBUTES                        10340021
103500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10350021
103600                                                                  10360021
103700         WHEN DP020-SRC-AID = DP016-ENTER                         10370021
103800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10380021
103900             IF  PS-ERROR                                         10390021
104000                 CONTINUE                                         10400021
104100             ELSE                                                 10410021
104200                 PERFORM 3200-RESET-ATTRIBUTES                    10420021
104300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10430021
104400             END-IF                                               10440021
104500                                                                  10450021
104600         WHEN OTHER                                               10460021
104700             SET DP013-NO-ROLLBACK                                10470021
104800                 DP013-XCTL-DISPLAY-RESTART                       10480021
104900                 DP013-CICS-ABEND  TO TRUE                        10490021
105000             MOVE '2100-CHECK-FUNCTION-KEY'                       10500021
105100                                   TO DP013-PARAGRAPH             10510021
105200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10520021
105300                                   TO DP013-MESSAGE-TEXT (1)      10530021
105400             PERFORM DP013-0000-PROCESS-ABEND                     10540021
105500     END-EVALUATE.                                                10550021
105600                                                                  10560021
105700/                                                                 10570021
105800*----------------------------------------------------------------*10580021
105900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10590021
106000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10600021
106100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10610021
106200*    MESSAGE.                                                    *10620021
106300*----------------------------------------------------------------*10630021
106400                                                                  10640021
106500 2110-BROWSE-BACKWARD.                                            10650021
106600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10660021
106700         GIVING PV-TOP-ITEM.                                      10670021
106800                                                                  10680021
106900     IF  ((PV-TOP-ITEM < +1)                                      10690021
107000       OR (PV-TOP-ITEM = +1))                                     10700021
107100         MOVE +1                   TO PV-TOP-ITEM                 10710021
107200*        -- TOP OF LIST --                                        10720021
107300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10730021
107400         SET DP020-MSG-INFORMATIONAL TO TRUE                      10740021
107500     END-IF.                                                      10750021
107600                                                                  10760021
107700                                                                  10770021
107800*----------------------------------------------------------------*10780021
107900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10790021
108000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10800021
108100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10810021
108200*----------------------------------------------------------------*10820021
108300                                                                  10830021
108400 2120-BROWSE-FORWARD.                                             10840021
108500                                                                  10850021
108600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10860021
108700         GIVING PV-TOP-ITEM.                                      10870021
108800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10880021
108900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10890021
109000                                   TO PV-TOP-ITEM                 10900021
109100*        -- BOTTOM OF LIST --                                     10910021
109200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10920021
109300         SET DP020-MSG-INFORMATIONAL                              10930021
109400                                   TO TRUE                        10940021
109500     ELSE                                                         10950021
109600         COMPUTE PV-BOTTOM-ITEM =                                 10960021
109700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10970021
109800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10980021
109900*            -- BOTTOM OF LIST --                                 10990021
110000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11000021
110100             SET DP020-MSG-INFORMATIONAL                          11010021
110200                                   TO TRUE                        11020021
110300         END-IF                                                   11030021
110400     END-IF.                                                      11040021
110500/                                                                 11050021
110600/                                                                 11060021
110700*----------------------------------------------------------------*11070021
110800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *11080021
110900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *11090021
111000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *11100021
111100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *11110021
111200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *11120021
111300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *11130021
111400*----------------------------------------------------------------*11140021
111500                                                                  11150021
111600 2130-CHECK-FOR-JUMP-BROWSE.                                      11160021
111700                                                                  11170021
111800     SET PS-NO-ERROR               TO TRUE.                       11180021
111900                                                                  11190021
112000     IF (ASC-START-ITEM-REQUEST = SPACE)                          11200021
112100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11210021
112200                                   TO PV-TOP-ITEM                 11220021
112300     ELSE                                                         11230021
112400         MOVE ASC-START-ITEM-REQUEST                              11240021
112500                                   TO DP010I-UNEDITED-FIELD       11250021
112600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       11260021
112700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     11270021
112800         SET DP010I-NEGATIVE-NOT-ALLOWED                          11280021
112900                                   TO TRUE                        11290021
113010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11301024
113020              USING DP010I-NUMERIC-EDIT-AREA                      11302024
113100                                                                  11310021
113200         IF  NOT DP010I-ERROR-DETECTED                            11320021
113300             MOVE DP010I-NUMERIC-FIELD                            11330021
113400                                   TO  ASC-START-ITEM-REQUEST-N   11340021
113500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  11350021
113600                 IF  ASC-START-ITEM-REQUEST-N >                   11360021
113700                                          ASC-NUMBER-OF-ITEMS-READ11370021
113800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         11380021
113900                     COMPUTE PV-TOP-ITEM =                        11390021
114000                             ASC-NUMBER-OF-ITEMS-READ             11400021
114100                             - PC-ITEMS-PER-PANEL + 1             11410021
114200                     IF  PV-TOP-ITEM < +1                         11420021
114300                         MOVE +1   TO PV-TOP-ITEM                 11430021
114400                         MOVE PC-TSYMSG-00070                     11440021
114500                                   TO DP020-MSG-NUMBER            11450021
114600                         SET DP020-MSG-INFORMATIONAL              11460021
114700                                   TO TRUE                        11470021
114800                     END-IF                                       11480021
114900                 ELSE                                             11490021
115000                     MOVE ASC-START-ITEM-REQUEST-N                11500021
115100                                   TO PV-TOP-ITEM                 11510021
115200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11520021
115300                     COMPUTE PV-BOTTOM-ITEM =                     11530021
115400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11540021
115500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11550021
115600*                        -- BOTTOM OF LIST --                     11560021
115700                         MOVE PC-TSYMSG-00070                     11570021
115800                                   TO DP020-MSG-NUMBER            11580021
115900                         SET DP020-MSG-INFORMATIONAL              11590021
116000                                   TO TRUE                        11600021
116100                     END-IF                                       11610021
116200                 END-IF                                           11620021
116300             ELSE                                                 11630021
116400*                --- VALUE OUT OF RANGE ----                      11640021
116500                 MOVE PC-TSYMSG-00101                             11650021
116600                                   TO DP020-MSG-NUMBER            11660021
116700                 MOVE -1           TO ASTRTITL                    11670021
116800                 SET DP030-SET-CURSOR-APPL-1                      11680021
116900                                   TO TRUE                        11690021
117000                 MOVE DP015-REVERSE                               11700021
117100                                   TO ASTRTITH                    11710021
117200                 MOVE DP015-RED    TO ASTRTITC                    11720021
117300                 MOVE DP015-UNP-NUM-BRT-MDT                       11730021
117400                                   TO ASTRTITA                    11740021
117500                 SET DP020-MSG-FATAL                              11750021
117600                                   TO TRUE                        11760021
117700                 SET PS-ERROR      TO TRUE                        11770021
117800             END-IF                                               11780021
117900                                                                  11790021
118000         ELSE                                                     11800021
118100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11810021
118200             MOVE -1               TO ASTRTITL                    11820021
118300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11830021
118400             MOVE DP015-REVERSE    TO ASTRTITH                    11840021
118500             MOVE DP015-RED        TO ASTRTITC                    11850021
118600             MOVE DP015-UNP-NUM-BRT-MDT                           11860021
118700                                   TO ASTRTITA                    11870021
118800             SET DP020-MSG-FATAL   TO TRUE                        11880021
118900             SET PS-ERROR          TO TRUE                        11890021
119000         END-IF                                                   11900021
119100     END-IF.                                                      11910021
119200                                                                  11920021
119300*----------------------------------------------------------------*11930021
119400*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *11940021
119500*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *11950021
119600*----------------------------------------------------------------*11960021
119700 2140-DESELECT-ALL-ITEMS.                                         11970021
119800     MOVE +1                       TO ASC-BLK-SUB.                11980021
119900                                                                  11990021
120000     PERFORM 2141-CLEAR-SELECTED-INDS                             12000021
120100         VARYING ASC-ITEM-SUB                                     12010021
120200         FROM 1 BY 1                                              12020021
120300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12030021
120400                                                                  12040021
120500     ADD +1                        TO ASC-BLK-SUB.                12050021
120600                                                                  12060021
120700     PERFORM 2141-CLEAR-SELECTED-INDS                             12070021
120800         VARYING ASC-ITEM-SUB                                     12080021
120900         FROM 1 BY 1                                              12090021
121000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12100021
121100                                                                  12110021
121200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12120021
121300                                   TO PV-LIST-ITEM-NUMBER.        12130021
121400                                                                  12140021
121500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12150021
121600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12160021
121700                                                                  12170021
121800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12180021
121900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      12190021
122000         MOVE +1                   TO ASC-BLK-SUB                 12200021
122100                                                                  12210021
122200         PERFORM 5100-WRITE-TEMP-STORAGE                          12220021
122300                                                                  12230021
122400         MOVE +1                   TO PV-BLOCK-NUMBER             12240021
122500                                                                  12250021
122600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12260021
122700             PV-FIRST-BLOCK-IN-ARRAY - 1                          12270021
122800                                                                  12280021
122900         PERFORM                                                  12290021
123000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12300021
123100                                                                  12310021
123200             PERFORM 4410-READ-TEMP-STORAGE                       12320021
123300                                                                  12330021
123400             PERFORM 2141-CLEAR-SELECTED-INDS                     12340021
123500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 12350021
123600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12360021
123700                                                                  12370021
123800             PERFORM 5100-WRITE-TEMP-STORAGE                      12380021
123900                                                                  12390021
124000             ADD +1                TO PV-BLOCK-NUMBER             12400021
124100                                                                  12410021
124200         END-PERFORM                                              12420021
124300                                                                  12430021
124400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12440021
124500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12450021
124600                                                                  12460021
124700         PERFORM                                                  12470021
124800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12480021
124900                   ASC-HIGHEST-BLOCK-WRITTEN                      12490021
125000                                                                  12500021
125100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12510021
125200                                   TO PV-BLOCK-NUMBER             12520021
125300                                                                  12530021
125400             PERFORM 4410-READ-TEMP-STORAGE                       12540021
125500                                                                  12550021
125600             PERFORM 2141-CLEAR-SELECTED-INDS                     12560021
125700                 VARYING ASC-ITEM-SUB                             12570021
125800                 FROM 1 BY 1                                      12580021
125900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12590021
126000                                                                  12600021
126100             PERFORM 5100-WRITE-TEMP-STORAGE                      12610021
126200                                                                  12620021
126300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12630021
126400                                                                  12640021
126500         END-PERFORM                                              12650021
126600                                                                  12660021
126700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12670021
126800                                   TO PV-BLOCK-NUMBER             12680021
126900                                                                  12690021
127000         PERFORM 4410-READ-TEMP-STORAGE                           12700021
127100     END-IF.                                                      12710021
127200                                                                  12720021
127300                                                                  12730021
127400     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 12740021
127500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.12750021
127600     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  12760021
127700                                                                  12770021
127800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12780021
127900                                                                  12790021
128000 EJECT                                                            12800021
128100*----------------------------------------------------------------*12810021
128200*    MARK EACH ITEM AS BEING NOT SELECTED.                       *12820021
128300*----------------------------------------------------------------*12830021
128400                                                                  12840021
128500 2141-CLEAR-SELECTED-INDS.                                        12850021
128600                                                                  12860021
128700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12870021
128800             NOT EQUAL ZERO                                       12880021
128900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12890021
129000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12900021
129100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12910021
129200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12920021
129300                                   TO TRUE                        12930021
129400         END-IF                                                   12940021
129500     END-IF.                                                      12950021
129600                                                                  12960021
129700 EJECT                                                            12970021
129800 2150-GET-NEXT-RECORD.                                            12980021
129900                                                                  12990021
130000     ADD +1                        TO ASC-SEL-SUB.                13000021
130100     IF  ASC-SEL-SUB > RC013-MAX-ITEMS                            13010021
130200         ADD +1                    TO ASC-SEL-ITEM                13020021
130300         MOVE +1                   TO ASC-SEL-SUB                 13030021
130400     END-IF.                                                      13040021
130500     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                13050021
130600         PERFORM 9100-READ-SEL-QUEUE                              13060021
130700         IF  RC013-ITEM (ASC-SEL-SUB) > ZERO                      13070021
130800             MOVE RC013-OPER-UNT-ID (ASC-SEL-SUB)                 13080021
130900                                   TO ASC-KEY-OPER-UNT-ID         13090021
131000             MOVE RC013-FCLTY-ID (ASC-SEL-SUB)                    13100021
131100                                   TO ASC-KEY-FCLTY-ID            13110021
131200             MOVE RC013-PO-NBR (ASC-SEL-SUB)                      13120021
131300                                   TO ASC-KEY-PO-NBR              13130021
131400                                      DK-PO-NBR                   13140021
131500             MOVE RC013-REC-SEQ-NBR (ASC-SEL-SUB)                 13150021
131600                                   TO ASC-KEY-REC-SEQ-NBR         13160021
131700                                      DK-REC-SEQ-NBR              13170021
131800             PERFORM 1140-GET-ENT-NAME                            13180021
131900             SET RC013-INQ (ASC-SEL-SUB)                          13190021
132000                                   TO TRUE                        13200021
132100             PERFORM 9200-REWRITE-LIST-QUEUE                      13210021
132200         ELSE                                                     13220021
132300             SUBTRACT +1 FROM ASC-SEL-SUB                         13230021
132400*            --- BOTTOM OF LIST ---                               13240021
132500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13250021
132600             SET DP020-MSG-INFORMATIONAL                          13260021
132700                 PS-NO-RECORD-FOUND                               13270021
132800                                   TO TRUE                        13280021
132900         END-IF                                                   13290021
133000     ELSE                                                         13300021
133100         SUBTRACT +1 FROM ASC-SEL-ITEM                            13310021
133200         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 13320021
133300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13330021
133400         SET DP020-MSG-INFORMATIONAL                              13340021
133500             PS-NO-RECORD-FOUND                                   13350021
133600                                   TO TRUE                        13360021
133700     END-IF.                                                      13370021
133800                                                                  13380021
133900 2160-GET-PREV-RECORD.                                            13390021
134000     SUBTRACT +1 FROM ASC-SEL-SUB.                                13400021
134100     IF  ASC-SEL-SUB < +1                                         13410021
134200         SUBTRACT +1 FROM ASC-SEL-ITEM                            13420021
134300         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 13430021
134400     END-IF.                                                      13440021
134500*                                                                 13450021
134600     IF  ASC-SEL-ITEM > ZERO                                      13460021
134700         PERFORM 9100-READ-SEL-QUEUE                              13470021
134800         MOVE RC013-OPER-UNT-ID (ASC-SEL-SUB)                     13480021
134900                                   TO ASC-KEY-OPER-UNT-ID         13490021
135000         MOVE RC013-FCLTY-ID (ASC-SEL-SUB)                        13500021
135100                                   TO ASC-KEY-FCLTY-ID            13510021
135200         MOVE RC013-PO-NBR (ASC-SEL-SUB)                          13520021
135300                                   TO ASC-KEY-PO-NBR              13530021
135400                                      DK-PO-NBR                   13540021
135500         MOVE RC013-REC-SEQ-NBR (ASC-SEL-SUB)                     13550021
135600                                   TO ASC-KEY-REC-SEQ-NBR         13560021
135700                                      DK-REC-SEQ-NBR              13570021
135800         PERFORM 1140-GET-ENT-NAME                                13580021
135900     ELSE                                                         13590021
136000         MOVE +1                   TO ASC-SEL-ITEM                13600021
136100                                      ASC-SEL-SUB                 13610021
136200*        --- TOP OF LIST ---                                      13620021
136300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13630021
136400         SET DP020-MSG-INFORMATIONAL                              13640021
136500             PS-NO-RECORD-FOUND                                   13650021
136600                                   TO TRUE                        13660021
136700     END-IF.                                                      13670021
136800                                                                  13680021
136900 2170-CHECK-RACF-ACCESS.                                          13690021
137000     SET DP008-RSRC-TYPE-FUNC     TO TRUE                         13700021
137100     MOVE 'RCVRMNT '              TO DP008-FUNCTION-NAME          13710021
137200     SET DP008-ACCESS-TYPE-USE    TO TRUE                         13720021
137300                                                                  13730021
137400     EXEC CICS                                                    13740021
137500        LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                  13750021
137600             COMMAREA (DP008-SECURITY-COMMAREA)                   13760021
137700             LENGTH (DP008-SECURITY-COMMAREA-LENGTH)              13770021
137800     END-EXEC                                                     13780021
137900                                                                  13790021
138000     IF DP008-CALL-SUCCESSFUL                                     13800021
138100         CONTINUE                                                 13810021
138200     ELSE                                                         13820021
138300        MOVE '2170-CHECK-RACF-ACCESS'                             13830021
138400                              TO DP013-PARAGRAPH                  13840021
138500         MOVE 'UNABLE TO ACCESS CICS'                             13850021
138600                              TO DP013-MESSAGE-TEXT (1)           13860021
138700         MOVE SQLCA           TO DP013-SQLCA                      13870021
138800         SET DP013-DB2-ABEND                                      13880021
138900             DP013-XCTL-DISPLAY-RESTART                           13890021
139000                              TO TRUE                             13900021
139100         PERFORM DP013-0000-PROCESS-ABEND                         13910021
139200     END-IF.                                                      13920021
139300 EJECT                                                            13930021
139400/                                                                 13940021
139500******************************************************************13950021
139600** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **13960021
139700** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **13970021
139800******************************************************************13980021
139900 2200-MOVE-SCREEN-TO-COMMAREA.                                    13990021
140000                                                                  14000021
140100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             14010021
140200     MOVE +1                       TO PV-SUB.                     14020021
140300*                                                                 14030021
140400     PERFORM 3100-SET-SUBSCRIPTS.                                 14040021
140500     IF  ASTRTITL > ZERO                                          14050021
140600         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          14060021
140700     ELSE                                                         14070021
140800         IF  ASTRTITF = DP015-ERASE-EOF                           14080021
140900             INITIALIZE ASC-START-ITEM-REQUEST                    14090021
141000         END-IF                                                   14100021
141100     END-IF.                                                      14110021
141200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          14120021
141300         VARYING PV-SUB                                           14130021
141400         FROM 1 BY 1                                              14140021
141500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      14150021
141600******************************************************************14160021
141700** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**14170021
141800******************************************************************14180021
141900 2210-MOVE-LINES-TO-COMMAREA.                                     14190021
142000     IF  MR-SELECTL (PV-SUB) > ZERO                               14200021
142100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             14210021
142200         MOVE MR-SELECTI (PV-SUB)                                 14220021
142300                                   TO ASC-TEMP-SELECTED-SW        14230021
142400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14240021
142500     ELSE                                                         14250021
142600         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                14260021
142700                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     14270021
142800                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        14280021
142900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14290021
143000         END-IF                                                   14300021
143100     END-IF.                                                      14310021
143200     ADD +1                        TO ASC-ITEM-SUB.               14320021
143300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14330021
143400         ADD +1                    TO ASC-BLK-SUB                 14340021
143500         MOVE +1                   TO ASC-ITEM-SUB                14350021
143600     END-IF.                                                      14360021
143700******************************************************************14370021
143800** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **14380021
143900** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **14390021
144000******************************************************************14400021
144100 3000-EDIT-DATA-IN-COMMAREA.                                      14410021
144200     SET PS-NO-ERROR               TO TRUE.                       14420021
144300     PERFORM 3200-RESET-ATTRIBUTES.                               14430021
144400     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14440021
144500**                                                                14450021
144600* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14460021
144700* EDITTING IS DONE FROM THE BOTTOM UP.                            14470021
144800**                                                                14480021
144900     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14490021
145000         ASC-ITEMS-DISPLAYED - 1.                                 14500021
145100     PERFORM 3100-SET-SUBSCRIPTS.                                 14510021
145200     PERFORM 3300-EDIT-SELECTIONS                                 14520021
145300         VARYING PV-SUB                                           14530021
145400         FROM PV-SUB BY -1                                        14540021
145500         UNTIL PV-SUB < +1                                        14550021
145600*                                                                 14560021
145700     IF ASC-NUMBER-OF-SELECTED-ITEMS > +1                         14570021
145800         MOVE PC-TSYMSG-00047   TO DP020-MSG-NUMBER               14580021
145900         SET DP020-MSG-FATAL    TO TRUE                           14590021
146000         SET DP030-SET-CURSOR-APPL-1                              14600021
146100                                TO TRUE                           14610021
146200         SET PS-ERROR           TO TRUE                           14620021
146300     END-IF.                                                      14630021
146400*                                                                 14640021
146500 EJECT                                                            14650021
146600*----------------------------------------------------------------*14660021
146700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14670021
146800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14680021
146900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14690021
147000*                                                                *14700021
147100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14710021
147200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14720021
147300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14730021
147400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14740021
147500*----------------------------------------------------------------*14750021
147600                                                                  14760021
147700 3100-SET-SUBSCRIPTS.                                             14770021
147800                                                                  14780021
147900     COMPUTE ASC-ITEM-SUB =                                       14790021
148000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14800021
148100                                                                  14810021
148200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14820021
148300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14830021
148400                                                                  14840021
148500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14850021
148600     ELSE                                                         14860021
148700         MOVE +1                     TO ASC-BLK-SUB               14870021
148800     END-IF.                                                      14880021
148900******************************************************************14890021
149000** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **14900021
149100******************************************************************14910021
149200                                                                  14920021
149300 3200-RESET-ATTRIBUTES.                                           14930021
149400                                                                  14940021
149500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   14950021
149600     MOVE DP015-GREEN              TO ASTRTITC.                   14960021
149700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14970021
149800     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       14980021
149900                                                                  14990021
150000     PERFORM                                                      15000021
150100         VARYING PV-SUB                                           15010021
150200         FROM 1 BY 1                                              15020021
150300         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        15030021
150400         MOVE DP015-UNP-ALP-NOR-OFF                               15040021
150500                                   TO MR-SELECTA (PV-SUB)         15050021
150600         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         15060021
150700         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         15070021
150800     END-PERFORM.                                                 15080021
150900                                                                  15090021
151000******************************************************************15100021
151100** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **15110021
151200** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **15120021
151300** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **15130021
151400** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **15140021
151500******************************************************************15150021
151600 3300-EDIT-SELECTIONS.                                            15160021
151700     EVALUATE TRUE                                                15170021
151800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15180021
151900             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         15190021
152000                 CONTINUE                                         15200021
152100         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         15210021
152200             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        15220021
152300                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   15230021
152400                 MOVE ASC-TEMP-SELECTED-SW                        15240021
152500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15250021
152600                                TO ASC-SELECTED-SW                15260021
152700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15270021
152800             END-IF                                               15280021
152900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15290021
153000                 = SPACE                                          15300021
153100             EVALUATE TRUE                                        15310021
153200                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15320021
153300                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15330021
153400                     MOVE SPACE TO ASC-SELECTED-SW                15340021
153500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15350021
153600                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        15360021
153700                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    15370021
153800                     MOVE SPACE TO ASC-SELECTED-SW                15380021
153900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15390021
154000                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          15400021
154100                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      15410021
154200                     MOVE SPACE TO ASC-SELECTED-SW                15420021
154300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15430021
154400             END-EVALUATE                                         15440021
154500         WHEN OTHER                                               15450021
154600             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15460021
154700             SET DP020-MSG-FATAL    TO TRUE                       15470021
154800             MOVE -1                TO MR-SELECTL (PV-SUB)        15480021
154900             SET DP030-SET-CURSOR-APPL-1                          15490021
155000                                    TO TRUE                       15500021
155100             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15510021
155200             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15520021
155300             SET PS-ERROR TO TRUE                                 15530021
155400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15540021
155500                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15550021
155600                 MOVE SPACE         TO ASC-SELECTED-SW            15560021
155700                                        (ASC-BLK-SUB ASC-ITEM-SUB)15570021
155800             END-IF                                               15580021
155900     END-EVALUATE.                                                15590021
156000                                                                  15600021
156100     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 15610021
156200     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15620021
156300     IF  ASC-ITEM-SUB < 1                                         15630021
156400         SUBTRACT +1 FROM ASC-BLK-SUB                             15640021
156500         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15650021
156600     END-IF.                                                      15660021
156700/                                                                 15670021
156800*----------------------------------------------------------------*15680021
156900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15690021
157000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15700021
157100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15710021
157200*    DISPLAY THE PANEL TO USER.                                  *15720021
157300*----------------------------------------------------------------*15730021
157400                                                                  15740021
157500 4000-BUILD-INITIAL-PANEL.                                        15750021
157600                                                                  15760021
157700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             15770021
157800                ASC-BLOCK-ENTRIES (2).                            15780021
157900                                                                  15790021
158000     MOVE +1                       TO ASC-BLK-SUB.                15800021
158100                                                                  15810021
158200     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       15820021
158300                                                                  15830021
158400     MOVE +0                       TO ASC-ITEM-SUB                15840021
158500                                      ASC-NUMBER-OF-ITEMS-READ    15850021
158600                                      ASC-NUMBER-OF-SELECTED-ITEMS15860021
158700                                      ASC-HIGHEST-BLOCK-WRITTEN   15870021
158800                                      ASC-START-OF-SELECTED-RANGE 15880021
158900                                      ASC-END-OF-SELECTED-RANGE   15890021
159000                                      ASC-ITEM-AT-TOP-OF-PANEL.   15900021
159100                                                                  15910021
159200                                                                  15920021
159300     PERFORM 4010-OPEN-CURSOR.                                    15930021
159400                                                                  15940021
159500     PERFORM 4300-READ-ITEMS-FROM-DB.                             15950021
159600                                                                  15960021
159700     PERFORM 4020-CLOSE-CURSOR.                                   15970021
159800                                                                  15980021
159900     MOVE +1                   TO  PV-TOP-ITEM.                   15990021
160000                                                                  16000021
160100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16010021
160200         SET DP020-NEXT-ACT-APPL-ERROR                            16020021
160300             DP020-MSG-FATAL       TO TRUE                        16030021
160400         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            16040021
160500     ELSE                                                         16050021
160600         MOVE -1                   TO ASEL01L                     16060021
160700         SET DP030-SET-CURSOR-APPL-1                              16070021
160800                                   TO TRUE                        16080021
160900         PERFORM 3200-RESET-ATTRIBUTES                            16090021
161000         MOVE ASC-KEY-OPER-UNT-ID  TO DK-OPER-UNT-ID              16100021
161100         MOVE ASC-KEY-FCLTY-ID     TO DK-FCLTY-ID                 16110021
161200         PERFORM 4100-GET-OPER-SET-INFO                           16120021
161300         MOVE DCFAAS-OPER-SET-ID   TO DK-OPER-SET-ID              16130021
161400         PERFORM 4200-GET-PROCESS-AREA                            16140021
161500         MOVE WRKORD-INST-PRC-AREA-ID TO ASC-KEY-PROCESS-AREA     16150021
161600         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16160021
161700     END-IF.                                                      16170021
161800                                                                  16180021
161900/                                                                 16190021
162000*----------------------------------------------------------------*16200021
162100* OPEN THE RECEIVER CURSOR.                                      *16210021
162200*----------------------------------------------------------------*16220021
162300                                                                  16230021
162400 4010-OPEN-CURSOR.                                                16240021
162500                                                                  16250021
162600     EXEC SQL                                                     16260021
162700          OPEN PO-SHIPMENT                                        16270021
162800     END-EXEC.                                                    16280021
162900                                                                  16290021
163000                                                                  16300021
163100*----------------------------------------------------------------*16310021
163200* CLOSE THE RECEIVER CURSOR.                                     *16320021
163300*----------------------------------------------------------------*16330021
163400                                                                  16340021
163500 4020-CLOSE-CURSOR.                                               16350021
163600                                                                  16360021
163700     EXEC SQL                                                     16370021
163800          CLOSE PO-SHIPMENT                                       16380021
163900     END-EXEC.                                                    16390021
164000                                                                  16400021
164100/                                                                 16410021
164200 4100-GET-OPER-SET-INFO.                                          16420021
164300                                                                  16430021
164400                                                                  16440021
164500*  THIS IS THE OPER SET DEFAULT THAT IS ASSIGNED IN CNUDCLOC      16450021
164600*  BY OPER-UNIT, FACILTY, DEPT, AND CLASS.                        16460021
164700                                                                  16470021
164800     PERFORM                                                      16480021
164900         WITH TEST AFTER                                          16490021
165000         VARYING PV-RETRY-COUNTER                                 16500021
165100         FROM 1 BY 1                                              16510021
165200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16520021
165300             OR (SQLCODE = +0)                                    16530021
165400             OR (SQLCODE = +100))                                 16540021
165500                                                                  16550021
165600         EXEC SQL                                                 16560021
165700              SELECT A.OPER_SET_ID                                16570021
165800                INTO :DCFAAS-OPER-SET-ID                          16580021
165900                FROM TDCFAAS A                                    16590021
166000                    ,TOPRSET B                                    16600021
166100               WHERE A.OPER_UNT_ID       = :DK-OPER-UNT-ID        16610021
166200                 AND A.FCLTY_ID          = :DK-FCLTY-ID           16620021
166300                 AND A.DEPT_NBR          = :DK-DEPT-NBR           16630021
166400                 AND A.FCLTY_LOC_TYP_CDE = 'PA'                   16640021
166500                 AND A.RANK_NBR          = 1                      16650021
166600                 AND B.VER_STATUS_CDE    = 'A'                    16660021
166700                 AND B.OPER_UNT_ID       = A.OPER_UNT_ID          16670022
166800                 AND A.CL_NBR            =                        16680021
166900                    (SELECT MIN(C.CL_NBR)                         16690021
167000                      FROM TPURITM C                              16700021
167100                     WHERE C.PO_NBR      = :DK-PO-NBR             16710021
167200                       AND C.VER_STATUS_CDE = 'A')                16720021
167300                 AND A.OPER_SET_ID = B.OPER_SET_ID                16730021
167400         END-EXEC                                                 16740021
167500                                                                  16750021
167600         EVALUATE TRUE                                            16760021
167700             WHEN SQLCODE = +0                                    16770021
167800             WHEN SQLCODE = +100                                  16780021
167900             WHEN SQLCODE = -904                                  16790021
168000             WHEN SQLCODE = -913                                  16800021
168100                  CONTINUE                                        16810021
168200                                                                  16820021
168300             WHEN SQLWARN0 NOT = SPACES                           16830021
168400             WHEN SQLCODE < +0                                    16840021
168500             WHEN SQLCODE > +0                                    16850021
168600                  MOVE '4100-GET-OPER-SET-INFO'                   16860021
168700                                  TO DP013-PARAGRAPH              16870021
168800                  MOVE 'UNSUCCESSFUL SELECT ON TDCFAAS TABLE'     16880021
168900                                  TO DP013-MESSAGE-TEXT (1)       16890021
169000                  MOVE SQLCA      TO DP013-SQLCA                  16900021
169100                  MOVE 'TDCFAAS ' TO DP013-DB2-TABLE-NAME (1)     16910021
169200                  MOVE 'TOPRSET ' TO DP013-DB2-TABLE-NAME (2)     16920021
169300                  SET DP013-DB2-ABEND                             16930021
169400                      DP013-XCTL-DISPLAY-RESTART                  16940021
169500                                  TO TRUE                         16950021
169600                  PERFORM DP013-0000-PROCESS-ABEND                16960021
169700         END-EVALUATE                                             16970021
169800     END-PERFORM.                                                 16980021
169900                                                                  16990021
170000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    17000021
170100         SQLCODE NOT = +0                                         17010021
170200         MOVE '4100-GET-OPER-SET-INFO'  TO DP013-PARAGRAPH        17020021
170300         MOVE 'MAX RETRIES EXCEEDED ON FACILITY LOC ASSIGNMENTS'  17030021
170400                                  TO DP013-MESSAGE-TEXT (1)       17040021
170500         MOVE SQLCA               TO DP013-SQLCA                  17050021
170600         MOVE 'TDCFAAS'           TO DP013-DB2-TABLE-NAME (1)     17060021
170700         MOVE 'TOPRSET'           TO DP013-DB2-TABLE-NAME (2)     17070021
170800         SET DP013-DB2-ABEND                                      17080021
170900             DP013-XCTL-DISPLAY-RESTART                           17090021
171000                                  TO TRUE                         17100021
171100         PERFORM DP013-0000-PROCESS-ABEND                         17110021
171200     END-IF.                                                      17120021
171300                                                                  17130021
171400 4200-GET-PROCESS-AREA.                                           17140021
171500                                                                  17150021
171600     PERFORM                                                      17160021
171700         WITH TEST AFTER                                          17170021
171800         VARYING PV-RETRY-COUNTER                                 17180021
171900         FROM 1 BY 1                                              17190021
172000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17200021
172100             OR (SQLCODE = +0)                                    17210021
172200             OR (SQLCODE = +100))                                 17220021
172300                                                                  17230021
172400         EXEC SQL                                                 17240021
172500             SELECT INST_PRC_AREA_ID                              17250021
172600              INTO  :WRKORD-INST-PRC-AREA-ID                      17260021
172700             FROM TWRKORD                                         17270021
172800            WHERE ORD_NBR          =  :DK-PO-NBR                  17280021
172900              AND RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR             17290021
173000              AND OPER_SET_ID      =  :DK-OPER-SET-ID             17300021
173100              AND VER_STATUS_CDE   =  :PC-A                       17310021
173200              AND ORD_LNE_NBR      =  :PC-ZERO                    17320021
173300              AND STAT_CDE         =  :PC-CM                      17330021
173400         END-EXEC                                                 17340021
173500                                                                  17350021
173600         EVALUATE TRUE                                            17360021
173700             WHEN SQLCODE = +0                                    17370021
173800             WHEN SQLCODE = +100                                  17380021
173900             WHEN SQLCODE = -904                                  17390021
174000             WHEN SQLCODE = -913                                  17400021
174100                 CONTINUE                                         17410021
174200                                                                  17420021
174300             WHEN SQLWARN0 NOT = SPACES                           17430021
174400             WHEN SQLCODE < +0                                    17440021
174500             WHEN SQLCODE > +0                                    17450021
174600                 MOVE '4200-GET-PROCESS-AREA'                     17460021
174700                                   TO DP013-PARAGRAPH             17470021
174800                 MOVE 'SELECT TWRKORD'                            17480021
174900                                   TO DP013-MESSAGE-TEXT(1)       17490021
175000                 MOVE SQLCA        TO DP013-SQLCA                 17500021
175100                 MOVE 'TWRKORD'    TO DP013-DB2-TABLE-NAME (1)    17510021
175200                 SET DP013-DB2-ABEND                              17520021
175300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17530021
175400                 PERFORM DP013-0000-PROCESS-ABEND                 17540021
175500         END-EVALUATE                                             17550021
175600     END-PERFORM.                                                 17560021
175700                                                                  17570021
175800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    17580021
175900         SQLCODE NOT = +0                                         17590021
176000         MOVE '4200-GET-PROCESS-AREA'                             17600021
176100                                   TO DP013-PARAGRAPH             17610021
176200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              17620021
176300                                   TO DP013-MESSAGE-TEXT (1)      17630021
176400         MOVE 'TO SELECT TWRKORD'                                 17640021
176500                                   TO DP013-MESSAGE-TEXT (2)      17650021
176600         MOVE SQLCA                TO DP013-SQLCA                 17660021
176700         MOVE 'TWRKORD'            TO DP013-DB2-TABLE-NAME (1)    17670021
176800         SET DP013-DB2-ABEND                                      17680021
176900             DP013-XCTL-DISPLAY-RESTART                           17690021
177000                                   TO TRUE                        17700021
177100         PERFORM DP013-0000-PROCESS-ABEND                         17710021
177200     END-IF.                                                      17720021
177300                                                                  17730021
177400/                                                                 17740021
177500*----------------------------------------------------------------*17750021
177600*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17760021
177700*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17770021
177800*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17780021
177900*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17790021
178000*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17800021
178100*                                                                *17810021
178200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17820021
178300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17830021
178400*    UPON INITIALIZATION.                                        *17840021
178500*----------------------------------------------------------------*17850021
178600                                                                  17860021
178700 4300-READ-ITEMS-FROM-DB.                                         17870021
178800                                                                  17880021
178900     PERFORM                                                      17890021
179000         VARYING PV-READ-COUNT                                    17900021
179100         FROM 1 BY 1                                              17910021
179200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17920021
179300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17930021
179400                                                                  17940021
179500         PERFORM 4310-FETCH                                       17950021
179600                                                                  17960021
179700         IF  ASC-ITEMS-LEFT-ON-DB                                 17970021
179800             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17980021
179900                 ADD +1            TO ASC-ITEM-SUB                17990021
180000             ELSE                                                 18000021
180100                 ADD +1            TO ASC-BLK-SUB                 18010021
180200                 MOVE +1           TO ASC-ITEM-SUB                18020021
180300                                                                  18030021
180400                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18040021
180500                     MOVE +1       TO ASC-BLK-SUB                 18050021
180600                     PERFORM 5100-WRITE-TEMP-STORAGE              18060021
180700                     MOVE ASC-BLOCK-ENTRIES                       18070021
180800                               (PC-MAX-BLOCKS-IN-ARRAY)           18080021
180900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18090021
181000                     ADD +1        TO ASC-BLK-SUB                 18100021
181100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18110021
181200                 END-IF                                           18120021
181300             END-IF                                               18130021
181400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18140021
181500             MOVE ASC-NUMBER-OF-ITEMS-READ                        18150021
181600                                   TO ASC-LIST-ITEM-NUMBER        18160021
181700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18170021
181800             MOVE SHPTPO-EXPTED-CART-CNT TO                       18180021
181900                  ASC-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)          18190021
182000             MOVE SHPTPO-ACTL-CART-CNT TO                         18200021
182100                  ASC-ACTL-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)     18210021
182200             MOVE SHPTPO-DMG-CART-CNT TO                          18220021
182300                  ASC-DMG-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)      18230021
182400             MOVE SHPTPO-SHIPT-ID     TO                          18240021
182500                  ASC-SHIPT-ID    (ASC-BLK-SUB ASC-ITEM-SUB)      18250021
182600             MOVE ASC-KEY-PO-NBR      TO                          18260021
182700                  ASC-PO-NBR      (ASC-BLK-SUB ASC-ITEM-SUB)      18270021
182800             MOVE SHPTPO-REC-SEQ-NBR  TO                          18280021
182900                  ASC-REC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      18290021
183000             MOVE SHPTPO-PRIM-SHIPT-IND TO                        18300021
183100                  ASC-PRIMARY-IND (ASC-BLK-SUB ASC-ITEM-SUB)      18310021
183200             MOVE SHIPMT-PRO-NBR TO                               18320021
183300                  ASC-PRO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          18330021
183400             MOVE SHIPMT-BOL-NBR TO                               18340021
183500                  ASC-BOL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          18350021
183600             MOVE SHPTPO-PKSL-IND TO                              18360021
183700                  ASC-PKSL-IND (ASC-BLK-SUB ASC-ITEM-SUB)         18370021
183800             MOVE VHTRIP-OWNER-SCAC-ID TO                         18380021
183900                  ASC-SCAC (ASC-BLK-SUB ASC-ITEM-SUB)             18390021
184000             MOVE VHTRIP-VEH-NBR TO                               18400021
184100                  ASC-TRAILER (ASC-BLK-SUB ASC-ITEM-SUB)          18410021
184200             MOVE VHTRIP-TRIP-ID TO                               18420021
184300                  ASC-TRIP-ID (ASC-BLK-SUB ASC-ITEM-SUB)          18430021
184400             MOVE TRIPST-TRIP-STATUS-CDE TO                       18440021
184500                  ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           18450021
184600             MOVE TRIPST-OPER-UNT-ID     TO                       18460021
184700                  ASC-OPER-UNT-ID (ASC-BLK-SUB ASC-ITEM-SUB)      18470021
184800             MOVE TRIPST-FCLTY-ID        TO                       18480021
184900                  ASC-FCLTY-ID (ASC-BLK-SUB ASC-ITEM-SUB)         18490021
185000         END-IF                                                   18500021
185100     END-PERFORM.                                                 18510021
185200                                                                  18520021
185300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          18530021
185400         MOVE +1               TO ASC-BLK-SUB                     18540021
185500         PERFORM 5100-WRITE-TEMP-STORAGE                          18550021
185600         ADD +1                TO ASC-BLK-SUB                     18560021
185700         PERFORM 5100-WRITE-TEMP-STORAGE                          18570021
185800                                                                  18580021
185900         MOVE 1                TO ASC-BLK-SUB                     18590021
186000                                  PV-BLOCK-NUMBER                 18600021
186100         PERFORM 4410-READ-TEMP-STORAGE                           18610021
186200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             18620021
186300             MOVE 2            TO ASC-BLK-SUB                     18630021
186400                                  PV-BLOCK-NUMBER                 18640021
186500             PERFORM 4410-READ-TEMP-STORAGE                       18650021
186600         END-IF                                                   18660021
186700     END-IF.                                                      18670021
186800                                                                  18680021
186900/                                                                 18690021
187000*----------------------------------------------------------------*18700021
187100*    FETCH THE RECEIVER NUMBER CURSOR.                           *18710021
187200                                                                  18720021
187300 4310-FETCH.                                                      18730021
187400                                                                  18740021
187500     EXEC SQL                                                     18750021
187600          FETCH PO-SHIPMENT                                       18760021
187700          INTO  :SHPTPO-EXPTED-CART-CNT                           18770021
187800               ,:SHPTPO-ACTL-CART-CNT                             18780021
187900               ,:SHPTPO-DMG-CART-CNT                              18790021
188000               ,:SHPTPO-PKSL-IND                                  18800021
188100               ,:SHPTPO-SHIPT-ID                                  18810021
188200               ,:SHPTPO-REC-SEQ-NBR                               18820021
188300               ,:SHPTPO-PRIM-SHIPT-IND                            18830021
188400               ,:SHIPMT-PRO-NBR                                   18840021
188500               ,:SHIPMT-BOL-NBR                                   18850021
188600               ,:VHTRIP-OWNER-SCAC-ID                             18860021
188700               ,:VHTRIP-VEH-NBR                                   18870021
188800               ,:VHTRIP-TRIP-ID                                   18880021
188900               ,:TRIPST-TRIP-STATUS-CDE                           18890021
189000               ,:TRIPST-OPER-UNT-ID                               18900021
189100               ,:TRIPST-FCLTY-ID                                  18910021
189200     END-EXEC.                                                    18920021
189300                                                                  18930021
189400     EVALUATE TRUE                                                18940021
189500         WHEN SQLCODE = ZERO                                      18950021
189600              CONTINUE                                            18960021
189700         WHEN SQLCODE = +100                                      18970021
189800              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 18980021
189900         WHEN SQLWARN0 NOT EQUAL SPACE                            18990021
190000         WHEN SQLCODE NOT EQUAL ZERO                              19000021
190100              MOVE '4310-FETCH-CURSOR'                            19010021
190200                               TO DP013-PARAGRAPH                 19020021
190300              MOVE 'FETCH PO SHIPMEMT CURSOR'                     19030021
190400                               TO DP013-MESSAGE-TEXT (1)          19040021
190500              MOVE SQLCA       TO DP013-SQLCA                     19050021
190600              SET DP013-DB2-ABEND                                 19060021
190700                               TO TRUE                            19070021
190800              PERFORM DP013-0000-PROCESS-ABEND                    19080021
190900     END-EVALUATE.                                                19090021
191000                                                                  19100021
191100/                                                                 19110021
191200*----------------------------------------------------------------*19120021
191300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *19130021
191400*----------------------------------------------------------------*19140021
191500                                                                  19150021
191600 4400-MOVE-COMMAREA-TO-SCREEN.                                    19160021
191700                                                                  19170021
191800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             19180021
191900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          19190021
192000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          19200021
192100             MOVE +1    TO ASC-BLK-SUB                            19210021
192200             PERFORM 5100-WRITE-TEMP-STORAGE                      19220021
192300             ADD +1     TO ASC-BLK-SUB                            19230021
192400             PERFORM 5100-WRITE-TEMP-STORAGE                      19240021
192500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             19250021
192600                 GIVING PV-BLOCK-NUMBER                           19260021
192700                 REMAINDER PV-REMAINDER                           19270021
192800             IF  PV-REMAINDER > ZERO                              19280021
192900                 ADD +1 TO PV-BLOCK-NUMBER                        19290021
193000             END-IF                                               19300021
193100             MOVE +1    TO ASC-BLK-SUB                            19310021
193200             PERFORM 4410-READ-TEMP-STORAGE                       19320021
193300             ADD +1     TO ASC-BLK-SUB                            19330021
193400                           PV-BLOCK-NUMBER                        19340021
193500             PERFORM 4410-READ-TEMP-STORAGE                       19350021
193600     END-IF.                                                      19360021
193700                                                                  19370021
193800     MOVE +1            TO ASC-BLK-SUB.                           19380021
193900                                                                  19390021
194000     COMPUTE ASC-ITEM-SUB =                                       19400021
194100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              19410021
194200         + PC-ITEMS-PER-PANEL).                                   19420021
194300                                                                  19430021
194400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19440021
194500         ADD +1         TO ASC-BLK-SUB                            19450021
194600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19460021
194700     END-IF.                                                      19470021
194800                                                                  19480021
194900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19490021
195000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19500021
195100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19510021
195200     PERFORM 4420-FORMAT-LIST-LINES                               19520021
195300         VARYING PV-SUB                                           19530021
195400         FROM PC-ITEMS-PER-PANEL BY -1                            19540021
195500         UNTIL PV-SUB < +1.                                       19550021
195600                                                                  19560021
195700     MOVE ASC-KEY-OPER-UNT-ID   TO AOPERO.                        19570021
195800     MOVE ASC-KEY-FCLTY-ID      TO AFCLTYO.                       19580021
195900     MOVE ASC-KEY-PO-NBR        TO PV-PO-NBR.                     19590021
196000     MOVE DK-REC-SEQ-NBR        TO PV-REC-SEQ-NBR.                19600021
196100     MOVE PV-PO-REC-SEQ         TO APONBRO.                       19610021
196200     MOVE ASC-ENT-NAME-DESC     TO AVNNAMEO.                      19620021
196300     MOVE ASC-KEY-PROCESS-AREA  TO APROCO.                        19630021
196400                                                                  19640021
196500     COMPUTE ASC-ITEMS-DISPLAYED =                                19650021
196600         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19660021
196700     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    19670021
196800                                      ASTRTITO.                   19680021
196900     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19690021
197000     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19700021
197100                                                                  19710021
197200     IF  DP020-MSG-NUMBER-X = SPACE                               19720021
197300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19730021
197400*            --- MORE ITEMS TO DISPLAY ----                       19740021
197500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19750021
197600             SET DP020-MSG-INFORMATIONAL TO TRUE                  19760021
197700         END-IF                                                   19770021
197800     END-IF.                                                      19780021
197900/                                                                 19790021
198000*----------------------------------------------------------------*19800021
198100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19810021
198200*----------------------------------------------------------------*19820021
198300                                                                  19830021
198400 4410-READ-TEMP-STORAGE.                                          19840021
198500                                                                  19850021
198600     EXEC CICS                                                    19860021
198700         READQ TS                                                 19870021
198800             QUEUE (ASC-LIST-QUEUE-NAME)                          19880021
198900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19890021
199000             ITEM  (PV-BLOCK-NUMBER)                              19900021
199100             RESP  (PV-CICS-RESP)                                 19910021
199200     END-EXEC.                                                    19920021
199300                                                                  19930021
199400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       19940021
199500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     19950021
199600         CONTINUE                                                 19960021
199700     ELSE                                                         19970021
199800         SET DP013-CICS-ABEND     TO TRUE                         19980021
199900         SET DP013-NO-ROLLBACK    TO TRUE                         19990021
200000         MOVE '4410-READ-TEMP-STORAGE'                            20000021
200100                                  TO DP013-PARAGRAPH              20010021
200200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20020021
200300                                  TO DP013-MESSAGE-TEXT(1)        20030021
200400         PERFORM DP013-0000-PROCESS-ABEND                         20040021
200500     END-IF.                                                      20050021
200600                                                                  20060021
200700     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20070021
200800         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20080021
200900     END-IF.                                                      20090021
201000/                                                                 20100021
201100*----------------------------------------------------------------*20110021
201200*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *20120021
201300*----------------------------------------------------------------*20130021
201400                                                                  20140021
201500 4420-FORMAT-LIST-LINES.                                          20150021
201600                                                                  20160021
201700     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       20170021
201800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20180021
201900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           20190021
202000         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           20200021
202100         MOVE ZEROES             TO AOPERO                        20210021
202200                                    AFCLTYO                       20220021
202300         MOVE SPACES             TO AVNNAMEO                      20230021
202400                                    APONBRO                       20240021
202500                                    MR-SELECTI (PV-SUB)           20250021
202600                                    MR-CARTON-CNT-X (PV-SUB)      20260021
202700                                    MR-ACTL-CARTON-CNT-X (PV-SUB) 20270021
202800                                    MR-DMG-CARTON-CNT-X (PV-SUB)  20280021
202900                                    MR-PRO-NBR (PV-SUB)           20290021
203000                                    MR-BOL-NBR (PV-SUB)           20300021
203100                                    MR-PKSL-IND(PV-SUB)           20310021
203200                                    MR-SCAC (PV-SUB)              20320021
203300                                    MR-TRAILER (PV-SUB)           20330021
203400                                    MR-STATUS (PV-SUB)            20340021
203500     ELSE                                                         20350021
203600         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20360021
203700                                                   > SPACE        20370021
203800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 20380021
203900                                 TO MR-SELECTI (PV-SUB)           20390021
204000         ELSE                                                     20400021
204100             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20410021
204200                                 TO MR-SELECTI (PV-SUB)           20420021
204300         END-IF                                                   20430021
204400*                                                                 20440021
204500         IF  DP030-SET-CURSOR-TRAILER                             20450021
204600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)20460021
204700                 > SPACE)                                         20470021
204800               OR (PV-SUB = 1))                                   20480021
204900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               20490021
205000                MOVE -1          TO MR-SELECTL (PV-SUB)           20500021
205100             END-IF                                               20510021
205200         END-IF                                                   20520021
205300*                                                                 20530021
205400         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL            20540021
205500             MOVE ASC-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)          20550021
205600                                 TO MR-CARTON-CNT (PV-SUB)        20560021
205700             MOVE ASC-ACTL-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)     20570021
205800                                 TO MR-ACTL-CARTON-CNT (PV-SUB)   20580021
205900             MOVE ASC-DMG-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)      20590021
206000                                 TO MR-DMG-CARTON-CNT (PV-SUB)    20600021
206100             MOVE ASC-PRO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          20610021
206200                                 TO MR-PRO-NBR (PV-SUB)           20620021
206300             MOVE ASC-BOL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          20630021
206400                                 TO MR-BOL-NBR (PV-SUB)           20640021
206500             MOVE ASC-PKSL-IND (ASC-BLK-SUB ASC-ITEM-SUB)         20650021
206600                                 TO MR-PKSL-IND (PV-SUB)          20660021
206700             MOVE ASC-SCAC (ASC-BLK-SUB ASC-ITEM-SUB)             20670021
206800                                 TO MR-SCAC (PV-SUB)              20680021
206900             MOVE ASC-TRAILER (ASC-BLK-SUB ASC-ITEM-SUB)          20690021
207000                                 TO MR-TRAILER (PV-SUB)           20700021
207100             MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           20710021
207200                                 TO MR-STATUS (PV-SUB)            20720021
207300             IF ASC-PRIMARY-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'Y'  20730021
207400                 MOVE DP015-YELLOW                                20740021
207500                                 TO MR-CARTON-CNTC (PV-SUB)       20750021
207600                                    MR-ACTL-CARTON-CNTC (PV-SUB)  20760021
207700                                    MR-DMG-CARTON-CNTC (PV-SUB)   20770021
207800                                    MR-PRO-NBRC (PV-SUB)          20780021
207900                                    MR-BOL-NBRC (PV-SUB)          20790021
208000                                    MR-PKSL-INDC (PV-SUB)         20800021
208100                                    MR-SCACC (PV-SUB)             20810021
208200                                    MR-TRAILERC (PV-SUB)          20820021
208300                                    MR-STATUSC (PV-SUB)           20830021
208400             END-IF                                               20840021
208500         END-IF                                                   20850021
208600     END-IF.                                                      20860021
208700                                                                  20870021
208800     SUBTRACT +1 FROM ASC-ITEM-SUB                                20880021
208900                                                                  20890021
209000     IF  ASC-ITEM-SUB < + 1                                       20900021
209100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  20910021
209200         MOVE +1                 TO ASC-BLK-SUB                   20920021
209300     END-IF.                                                      20930021
209400                                                                  20940021
209500******************************************************************20950021
209600** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **20960021
209700** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **20970021
209800** ISSUE A WARNING.                                             **20980021
209900******************************************************************20990021
210000 4430-CHECK-FOR-BEGIN-AND-END.                                    21000021
210100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21010021
210200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21020021
210300*            -- NO END-OF-RANGE SPECFIED ---                      21030021
210400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21040021
210500             SET DP020-MSG-WARNING TO TRUE                        21050021
210600             PERFORM 4431-POSITION-AT-WARNING                     21060021
210700         END-IF                                                   21070021
210800     ELSE                                                         21080021
210900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21090021
211000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                21100021
211100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21110021
211200             SET DP020-MSG-WARNING TO TRUE                        21120021
211300             PERFORM 4431-POSITION-AT-WARNING                     21130021
211400         END-IF                                                   21140021
211500     END-IF.                                                      21150021
211600******************************************************************21160021
211700** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **21170021
211800** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **21180021
211900** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **21190021
212000** POSITION THE CURSOR THERE.                                   **21200021
212100******************************************************************21210021
212200 4431-POSITION-AT-WARNING.                                        21220021
212300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 21230021
212400                    - PV-TOP-ITEM + 1.                            21240021
212500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21250021
212600         CONTINUE                                                 21260021
212700     ELSE                                                         21270021
212800         SET DP030-SET-CURSOR-APPL-1                              21280021
212900                                   TO TRUE                        21290021
213000         MOVE -1                   TO MR-SELECTL (PV-SUB)         21300021
213100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21310021
213200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21320021
213300     END-IF.                                                      21330021
213400*                                                                 21340021
213500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21350021
213600                    - PV-TOP-ITEM + 1.                            21360021
213700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21370021
213800         CONTINUE                                                 21380021
213900     ELSE                                                         21390021
214000         SET DP030-SET-CURSOR-APPL-1                              21400021
214100                                   TO TRUE                        21410021
214200         MOVE -1                   TO MR-SELECTL (PV-SUB)         21420021
214300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21430021
214400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21440021
214500     END-IF.                                                      21450021
214600 EJECT                                                            21460021
214700                                                                  21470021
214800*----------------------------------------------------------------*21480021
214900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *21490021
215000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *21500021
215100* FOR THE SELECTED ITEMS QUEUE.                                  *21510021
215200*                                                                *21520021
215300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *21530021
215400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *21540021
215500* THE ARRAY IS FULL.                                             *21550021
215600*----------------------------------------------------------------*21560021
215700                                                                  21570021
215800 5000-PREPARE-SEL-QUEUE.                                          21580021
215900                                                                  21590021
216000     MOVE +1                   TO  ASC-BLK-SUB.                   21600021
216100     PERFORM 5100-WRITE-TEMP-STORAGE.                             21610021
216200     ADD +1                    TO  ASC-BLK-SUB.                   21620021
216300     PERFORM 5100-WRITE-TEMP-STORAGE.                             21630021
216400                                                                  21640021
216500     MOVE ASC-SEL-QUEUE-NAME   TO  RC015-SEL-QUEUE-NAME.          21650021
216600     PERFORM 6010-DELETE-SEL-QUEUE.                               21660021
216700                                                                  21670021
216800     SET RC013-IDX             TO  1.                             21680021
216900     MOVE ZERO                 TO RC015-NUMBER-OF-TS-ITEMS.       21690021
217000     INITIALIZE RC013-SELECTED-ITEM-ARRAY.                        21700021
217100                                                                  21710021
217200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           21720021
217300             VARYING PV-ITEM                                      21730021
217400             FROM 1 BY 1                                          21740021
217500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     21750021
217600                                                                  21760021
217700     IF  RC013-IDX > 1                                            21770021
217800         PERFORM 5205-WRITE-SEL-QUEUE                             21780021
217900         ADD +1                TO RC015-NUMBER-OF-TS-ITEMS        21790021
218000     END-IF.                                                      21800021
218100/                                                                 21810021
218200*----------------------------------------------------------------*21820021
218300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *21830021
218400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *21840021
218500*----------------------------------------------------------------*21850021
218600                                                                  21860021
218700 5100-WRITE-TEMP-STORAGE.                                         21870021
218800                                                                  21880021
218900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     21890021
219000                                   TO PV-LIST-ITEM-NUMBER.        21900021
219100                                                                  21910021
219200     COMPUTE PV-BLOCK-NUMBER =                                    21920021
219300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    21930021
219400                                                                  21940021
219500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             21950021
219600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             21960021
219700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      21970021
219800             PERFORM 5105-REWRITE-ASC-LISTQ                       21980021
219900         END-IF                                                   21990021
220000     ELSE                                                         22000021
220100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22010021
220200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22020021
220300         PERFORM 5110-WRITE-ASC-LISTQ                             22030021
220400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22040021
220500     END-IF.                                                      22050021
220600                                                                  22060021
220700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22070021
220800                                                                  22080021
220900******************************************************************22090021
221000** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **22100021
221100** SPECIFIC COMMAREA.                                           **22110021
221200******************************************************************22120021
221300 5105-REWRITE-ASC-LISTQ.                                          22130021
221400     EXEC CICS                                                    22140021
221500         WRITEQ TS                                                22150021
221600             QUEUE (ASC-LIST-QUEUE-NAME)                          22160021
221700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22170021
221800             ITEM  (PV-BLOCK-NUMBER)                              22180021
221900             REWRITE                                              22190021
222000             RESP  (PV-CICS-RESP)                                 22200021
222100     END-EXEC.                                                    22210021
222200                                                                  22220021
222300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           22230021
222400         CONTINUE                                                 22240021
222500     ELSE                                                         22250021
222600         SET DP013-CICS-ABEND            TO TRUE                  22260021
222700         SET DP013-NO-ROLLBACK           TO TRUE                  22270021
222800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       22280021
222900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     22290021
223000                                         TO DP013-MESSAGE-TEXT(1) 22300021
223100         PERFORM DP013-0000-PROCESS-ABEND                         22310021
223200     END-IF.                                                      22320021
223300                                                                  22330021
223400                                                                  22340021
223500******************************************************************22350021
223600** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **22360021
223700** SPECIFIC COMMAREA.                                           **22370021
223800******************************************************************22380021
223900 5110-WRITE-ASC-LISTQ.                                            22390021
224000                                                                  22400021
224100     EXEC CICS                                                    22410021
224200         WRITEQ TS                                                22420021
224300             QUEUE (ASC-LIST-QUEUE-NAME)                          22430021
224400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22440021
224500             ITEM  (PV-BLOCK-NUMBER)                              22450021
224600             RESP  (PV-CICS-RESP)                                 22460021
224700     END-EXEC.                                                    22470021
224800                                                                  22480021
224900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22490021
225000         SET DP013-CICS-ABEND      TO TRUE                        22500021
225100         SET DP013-NO-ROLLBACK     TO TRUE                        22510021
225200         MOVE '5110-WRITE-ASC-LISTQ'                              22520021
225300                                   TO DP013-PARAGRAPH             22530021
225400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           22540021
225500                                   TO DP013-MESSAGE-TEXT(1)       22550021
225600         PERFORM DP013-0000-PROCESS-ABEND                         22560021
225700     END-IF.                                                      22570021
225800                                                                  22580021
225900*----------------------------------------------------------------*22590021
226000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *22600021
226100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *22610021
226200*----------------------------------------------------------------*22620021
226300                                                                  22630021
226400 5200-FILL-SEL-QUEUE-RECORD.                                      22640021
226500                                                                  22650021
226600     PERFORM 6112-READ-LIST-QUEUE.                                22660021
226700                                                                  22670021
226800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       22680021
226900         PERFORM                                                  22690021
227000         VARYING LQW-IDX                                          22700021
227100         FROM 1 BY 1                                              22710021
227200         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            22720021
227300           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          22730021
227400                                                                  22740021
227500             IF  LQW-SELECT (LQW-IDX)                             22750021
227600                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              22760021
227700                                   TO RC013-ITEM (RC013-IDX)      22770021
227800                 MOVE LQW-PO-NBR (LQW-IDX)                        22780021
227900                                   TO RC013-PO-NBR (RC013-IDX)    22790021
228000                                      DK-PO-NBR                   22800021
228100                 MOVE LQW-REC-SEQ-NBR (LQW-IDX)                   22810021
228200                                   TO RC013-REC-SEQ-NBR           22820021
228300                                      (RC013-IDX)                 22830021
228400                                      DK-REC-SEQ-NBR              22840021
228500                 MOVE LQW-SHIPT-ID (LQW-IDX)                      22850021
228600                                   TO RC013-SHIPT-ID (RC013-IDX)  22860021
228700                                      DK-SHIPT-ID                 22870021
228800                 MOVE LQW-PRO-NBR (LQW-IDX)                       22880021
228900                                   TO RC013-PRO-NBR (RC013-IDX)   22890021
229000                 MOVE LQW-BOL-NBR (LQW-IDX)                       22900021
229100                                   TO RC013-BOL-NBR (RC013-IDX)   22910021
229200                 MOVE LQW-SCAC (LQW-IDX)                          22920021
229300                               TO RC013-OWNER-SCAC-ID (RC013-IDX) 22930021
229400                 MOVE LQW-TRAILER (LQW-IDX)                       22940021
229500                               TO RC013-VEH-NBR (RC013-IDX)       22950021
229600                 MOVE LQW-OPER-UNT-ID (LQW-IDX)                   22960021
229700                               TO RC013-OPER-UNT-ID (RC013-IDX)   22970021
229800                 MOVE LQW-FCLTY-ID (LQW-IDX)                      22980021
229900                               TO RC013-FCLTY-ID (RC013-IDX)      22990021
230000                 MOVE LQW-TRIP-ID (LQW-IDX)                       23000021
230100                               TO RC013-TRIP-ID (RC013-IDX)       23010021
230200                 IF DP020-FK-CONFIRM (DP020-SRC-AID)              23020021
230300                     MOVE ASC-HIGHEST-BLOCK-WRITTEN TO PV-ITEM    23030021
230400                     IF LQW-PRIMARY-IND (LQW-IDX) = 'N'           23040021
230500                         MOVE SPACE TO RC013-ACTION-SW (RC013-IDX)23050021
230600                         MOVE ASC-KEY-OPER-UNT-ID                 23060021
230700                                               TO DK-OPER-UNT-ID  23070021
230800                         MOVE ASC-KEY-FCLTY-ID TO DK-FCLTY-ID     23080021
230900                         SET PS-NOT-IN-PROCESS TO TRUE            23090021
231000                         PERFORM 5500-SELECT-RECEIVER             23100021
231100                         IF PS-IN-PROCESS                         23110021
231200                             PERFORM 5300-DETACH-SHIPMENT         23120021
231300                             PERFORM 5550-LINK-AUDIT-MODULE       23130021
231400                             SUBTRACT LQW-CTN-CNT (LQW-IDX)       23140021
231500                                 FROM RECEIV-EXPTED-CART-CNT      23150021
231600                             PERFORM 5600-UPDATE-RECEIVER         23160021
231700                         ELSE                                     23170021
231800                             SET DP030-OVERRIDE-GO                23180021
231900                                               TO TRUE            23190021
232000                             MOVE PC-TSYMSG-01079                 23200021
232100                                               TO DP020-MSG-NUMBER23210021
232200                             SET DP020-MSG-WARNING                23220021
232300                                                TO TRUE           23230021
232400                         END-IF                                   23240021
232500                     ELSE                                         23250021
232600                         SET DP030-OVERRIDE-GO                    23260021
232700                                           TO TRUE                23270021
232800                         MOVE PC-TSYMSG-01078                     23280021
232900                                           TO DP020-MSG-NUMBER    23290021
233000                         SET DP020-MSG-WARNING                    23300021
233100                                            TO TRUE               23310021
233200                     END-IF                                       23320021
233300                 ELSE                                             23330021
233400                     MOVE SPACE    TO RC013-ACTION-SW (RC013-IDX) 23340021
233500                     SET RC013-IDX UP BY 1                        23350021
233600                     IF  RC013-IDX > RC013-MAX-ITEMS              23360021
233700                         PERFORM 5205-WRITE-SEL-QUEUE             23370021
233800                         ADD +1        TO RC015-NUMBER-OF-TS-ITEMS23380021
233900                         INITIALIZE RC013-SELECTED-ITEM-ARRAY     23390021
234000                         SET RC013-IDX TO  1                      23400021
234100                     END-IF                                       23410021
234200                 END-IF                                           23420021
234300             END-IF                                               23430021
234400         END-PERFORM                                              23440021
234500     END-IF.                                                      23450021
234600                                                                  23460021
234700*----------------------------------------------------------------*23470021
234800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *23480021
234900*----------------------------------------------------------------*23490021
235000                                                                  23500021
235100 5205-WRITE-SEL-QUEUE.                                            23510021
235200                                                                  23520021
235300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23530021
235400                                   TO RC013-SELECTED-ITEMS.       23540021
235500                                                                  23550021
235600     EXEC CICS                                                    23560021
235700          WRITEQ TS                                               23570021
235800              QUEUE (ASC-SEL-QUEUE-NAME)                          23580021
235900              FROM  (RC013-DC-SELECT-RECORD)                      23590021
236000              ITEM  (PV-SEL-QUEUE-ITEM)                           23600021
236100              RESP  (PV-CICS-RESP)                                23610021
236200     END-EXEC.                                                    23620021
236300                                                                  23630021
236400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23640021
236500         CONTINUE                                                 23650021
236600     ELSE                                                         23660021
236700         SET DP013-CICS-ABEND      TO TRUE                        23670021
236800         SET DP013-NO-ROLLBACK     TO TRUE                        23680021
236900         MOVE '5205-WRITE-SEL-QUEUE'                              23690021
237000                                   TO DP013-PARAGRAPH             23700021
237100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          23710021
237200                                   TO DP013-MESSAGE-TEXT(1)       23720021
237300         PERFORM DP013-0000-PROCESS-ABEND                         23730021
237400     END-IF.                                                      23740021
237500 5300-DETACH-SHIPMENT.                                            23750021
237600                                                                  23760021
237700     PERFORM                                                      23770021
237800         WITH TEST AFTER                                          23780021
237900         VARYING PV-RETRY-COUNTER                                 23790021
238000         FROM 1 BY 1                                              23800021
238100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               23810021
238200             OR (SQLCODE = +0))                                   23820021
238300                                                                  23830021
238400         EXEC SQL                                                 23840021
238500           UPDATE TSHPTPO                                         23850021
238600              SET REC_SEQ_NBR      = :PC-ZERO,                    23860021
238700                  LAST_UPD_PGM_ID  = :PC-CURRENT-PROGRAM-NAME,    23870021
238800                  LAST_UPD_DTE     = CURRENT DATE,                23880021
238900                  LAST_UPD_TIME    = CURRENT TIME,                23890021
239000                  LAST_UPD_USER_ID = :DP020-USERID,               23900021
239100                  PRIM_SHIPT_IND   = :PC-Y                        23910021
239200           WHERE  SHIPT_ID    = :DK-SHIPT-ID                      23920021
239300             AND  PO_NBR      = :DK-PO-NBR                        23930021
239400             AND  REC_SEQ_NBR = :DK-REC-SEQ-NBR                   23940021
239500         END-EXEC                                                 23950021
239600                                                                  23960021
239700         EVALUATE TRUE                                            23970021
239800             WHEN SQLCODE = +0                                    23980021
239900             WHEN SQLCODE = -904                                  23990021
240000             WHEN SQLCODE = -913                                  24000021
240100                 CONTINUE                                         24010021
240200                                                                  24020021
240300             WHEN SQLWARN0 NOT = SPACES                           24030021
240400             WHEN SQLCODE < +0                                    24040021
240500             WHEN SQLCODE > +0                                    24050021
240600                 MOVE '5300-DETACH-SHIPMENT'                      24060021
240700                                   TO DP013-PARAGRAPH             24070021
240800                 MOVE 'UPDATE INFO ON TSHIPMT     '               24080021
240900                                   TO DP013-MESSAGE-TEXT(1)       24090021
241000                 MOVE SQLCA        TO DP013-SQLCA                 24100021
241100                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    24110021
241200                 SET DP013-DB2-ABEND                              24120021
241300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           24130021
241400                 PERFORM DP013-0000-PROCESS-ABEND                 24140021
241500         END-EVALUATE                                             24150021
241600     END-PERFORM.                                                 24160021
241700                                                                  24170021
241800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    24180021
241900         SQLCODE NOT = +0                                         24190021
242000         MOVE '5300-DETACH-SHIPMENT'                              24200021
242100                                   TO DP013-PARAGRAPH             24210021
242200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              24220021
242300                                   TO DP013-MESSAGE-TEXT (1)      24230021
242400         MOVE 'TO UPDATE A TSHIPMT ROW'                           24240021
242500                                   TO DP013-MESSAGE-TEXT (2)      24250021
242600         MOVE SQLCA                TO DP013-SQLCA                 24260021
242700         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    24270021
242800         SET DP013-DB2-ABEND                                      24280021
242900             DP013-XCTL-DISPLAY-RESTART                           24290021
243000                                   TO TRUE                        24300021
243100         PERFORM DP013-0000-PROCESS-ABEND                         24310021
243200     END-IF.                                                      24320021
243300     EVALUATE TRUE                                                24330021
243400         WHEN SQLCODE = ZERO                                      24340021
243500              MOVE PC-U           TO PV-TRN-CDE                   24350021
243600              PERFORM 5400-INSERT-TAUSHPO                         24360021
243700     END-EVALUATE.                                                24370021
243800                                                                  24380021
243900                                                                  24390021
244000*----------------------------------------------------------------*24400015
244100 5400-INSERT-TAUSHPO.                                             24410021
244200                                                                  24420021
244300     PERFORM                                                      24430021
244400         WITH TEST AFTER                                          24440021
244500         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     24450021
244600         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            24460021
244700                (SQLCODE = ZERO)   OR                             24470021
244800                (SQLCODE = +100)                                  24480021
244900                                                                  24490021
245000         EXEC SQL                                                 24500021
245100             SELECT SHIPT_ID,                                     24510021
245200                    PO_NBR,                                       24520021
245300                    REC_SEQ_NBR,                                  24530021
245400                    EXPTED_CART_CNT,                              24540021
245500                    ACTL_CART_CNT,                                24550021
245600                    DMG_CART_CNT,                                 24560021
245700                    PKSL_IND,                                     24570021
245800                    VEND_NAME,                                    24580021
245900                    FRGT_CHG_AMT,                                 24590021
246000                    LAST_UPD_PGM_ID,                              24600021
246100                    CRE_USER_ID,                                  24610021
246200                    CARR_CART_CT,                                 24620021
246300                    CARR_LAST_UPD_DTE,                            24630021
246400                    CARR_LAST_UPD_TIME,                           24640021
246500                    VEND_CART_CT,                                 24650021
246600                    VEND_LAST_UPD_DTE,                            24660021
246700                    VEND_LAST_UPD_TIME,                           24670021
246800                    CRE_TMST,                                     24680021
246900                    LAST_UPD_DTE,                                 24690021
247000                    LAST_UPD_TIME,                                24700021
247100                    LAST_UPD_USER_ID                              24710021
247200                  , SPLT_XMIT_IND                                 24720021
247300                  , SPLT_XMIT_DTE                                 24730021
247400                  , SPLT_XMIT_TM                                  24740021
247500               INTO :SHPTPO-SHIPT-ID,                             24750021
247600                    :SHPTPO-PO-NBR,                               24760021
247700                    :SHPTPO-REC-SEQ-NBR,                          24770021
247800                    :SHPTPO-EXPTED-CART-CNT,                      24780021
247900                    :SHPTPO-ACTL-CART-CNT,                        24790021
248000                    :SHPTPO-DMG-CART-CNT,                         24800021
248100                    :SHPTPO-PKSL-IND,                             24810021
248200                    :SHPTPO-VEND-NAME,                            24820021
248300                    :SHPTPO-FRGT-CHG-AMT,                         24830021
248400                    :SHPTPO-LAST-UPD-PGM-ID,                      24840021
248500                    :SHPTPO-CRE-USER-ID,                          24850021
248600                    :SHPTPO-CARR-CART-CT,                         24860021
248700                    :SHPTPO-CARR-LAST-UPD-DTE,                    24870021
248800                    :SHPTPO-CARR-LAST-UPD-TIME,                   24880021
248900                    :SHPTPO-VEND-CART-CT,                         24890021
249000                    :SHPTPO-VEND-LAST-UPD-DTE,                    24900021
249100                    :SHPTPO-VEND-LAST-UPD-TIME,                   24910021
249200                    :SHPTPO-CRE-TMST,                             24920021
249300                    :SHPTPO-LAST-UPD-DTE,                         24930021
249400                    :SHPTPO-LAST-UPD-TIME,                        24940021
249500                    :SHPTPO-LAST-UPD-USER-ID                      24950021
249600                  , :SHPTPO-SPLT-XMIT-IND                         24960021
249700                  , :SHPTPO-SPLT-XMIT-DTE                         24970021
249800                  , :SHPTPO-SPLT-XMIT-TM                          24980021
249900               FROM TSHPTPO                                       24990021
250000              WHERE  SHIPT_ID = :DK-SHIPT-ID                      25000021
250100                AND  PO_NBR   = :DK-PO-NBR                        25010021
250200         END-EXEC                                                 25020021
250300                                                                  25030021
250400         EVALUATE TRUE                                            25040021
250500             WHEN SQLCODE = ZERO                                  25050021
250600             WHEN SQLCODE = +100                                  25060021
250700             WHEN SQLCODE = -904                                  25070021
250800             WHEN SQLCODE = -913                                  25080021
250900                 CONTINUE                                         25090021
251000                                                                  25100021
251100             WHEN SQLWARN0 NOT = SPACE                            25110021
251200             WHEN SQLCODE  NOT = +0                               25120021
251300                  MOVE SPACES TO PV-MESSAGE                       25130021
251400                  MOVE SHPTPO-SHIPT-ID TO PV-MESSAGE1             25140021
251500                  MOVE SHPTPO-PO-NBR   TO PV-MESSAGE2             25150021
251600                  MOVE '5400-INSERT-TAUSHPO'                      25160021
251700                                   TO DP013-PARAGRAPH             25170021
251800                  MOVE 'SELECT TSHPTPO DATA'                      25180021
251900                                   TO DP013-MESSAGE-TEXT (1)      25190021
252000                  MOVE PV-MESSAGE  TO DP013-MESSAGE-TEXT (2)      25200021
252100                  MOVE SQLCA       TO DP013-SQLCA                 25210021
252200                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (1)    25220021
252300                  SET DP013-DB2-ABEND                             25230021
252400                                   TO TRUE                        25240021
252500                  PERFORM DP013-0000-PROCESS-ABEND                25250021
252600         END-EVALUATE                                             25260021
252700                                                                  25270021
252800     END-PERFORM.                                                 25280021
252900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    25290021
253000         SQLCODE NOT = +0                                         25300021
253100         MOVE '5400-INSERT-TAUSHPO'                               25310021
253200                                   TO DP013-PARAGRAPH             25320021
253300         MOVE 'MAX RETRIES EXCEEDED FOR SELECT TAUSHPO'           25330021
253400                                   TO DP013-MESSAGE-TEXT (1)      25340021
253500         MOVE SQLCA                TO DP013-SQLCA                 25350021
253600         SET DP013-DB2-ABEND       TO TRUE                        25360021
253700         PERFORM DP013-0000-PROCESS-ABEND                         25370021
253800     END-IF.                                                      25380021
253900                                                                  25390021
254000      MOVE PV-TRN-CDE              TO AUSHPO-TRN-CDE              25400021
254100     PERFORM                                                      25410021
254200         WITH TEST AFTER                                          25420021
254300         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     25430021
254400         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            25440021
254500                 SQLCODE = ZERO                                   25450021
254600                                                                  25460021
254700         EXEC SQL                                                 25470021
254800             INSERT INTO TAUSHPO                                  25480021
254900                   (SHIPT_ID,                                     25490021
255000                    PO_NBR,                                       25500021
255100                    REC_SEQ_NBR,                                  25510021
255200                    EXPTED_CART_CNT,                              25520021
255300                    ACTL_CART_CNT,                                25530021
255400                    DMG_CART_CNT,                                 25540021
255500                    PKSL_IND,                                     25550021
255600                    VEND_NAME,                                    25560021
255700                    FRGT_CHG_AMT,                                 25570021
255800                    LAST_UPD_PGM_ID,                              25580021
255900                    CRE_USER_ID,                                  25590021
256000                    CARR_CART_CT,                                 25600021
256100                    CARR_LAST_UPD_DTE,                            25610021
256200                    CARR_LAST_UPD_TIME,                           25620021
256300                    VEND_CART_CT,                                 25630021
256400                    VEND_LAST_UPD_DTE,                            25640021
256500                    VEND_LAST_UPD_TIME,                           25650021
256600                    CRE_TMST,                                     25660021
256700                    LAST_UPD_DTE,                                 25670021
256800                    LAST_UPD_TIME,                                25680021
256900                    LAST_UPD_USER_ID                              25690021
257000                  , SPLT_XMIT_IND                                 25700021
257100                  , SPLT_XMIT_DTE                                 25710021
257200                  , SPLT_XMIT_TM                                  25720021
257300                  , TRN_CDE )                                     25730021
257400             VALUES                                               25740021
257500                  (:SHPTPO-SHIPT-ID,                              25750021
257600                   :SHPTPO-PO-NBR,                                25760021
257700                   :SHPTPO-REC-SEQ-NBR,                           25770021
257800                   :SHPTPO-EXPTED-CART-CNT,                       25780021
257900                   :SHPTPO-ACTL-CART-CNT,                         25790021
258000                   :SHPTPO-DMG-CART-CNT,                          25800021
258100                   :SHPTPO-PKSL-IND,                              25810021
258200                   :SHPTPO-VEND-NAME,                             25820021
258300                   :SHPTPO-FRGT-CHG-AMT,                          25830021
258400                   :SHPTPO-LAST-UPD-PGM-ID,                       25840021
258500                   :SHPTPO-CRE-USER-ID,                           25850021
258600                   :SHPTPO-CARR-CART-CT,                          25860021
258700                   :SHPTPO-CARR-LAST-UPD-DTE,                     25870021
258800                   :SHPTPO-CARR-LAST-UPD-TIME,                    25880021
258900                   :SHPTPO-VEND-CART-CT,                          25890021
259000                   :SHPTPO-VEND-LAST-UPD-DTE,                     25900021
259100                   :SHPTPO-VEND-LAST-UPD-TIME,                    25910021
259200                   :SHPTPO-CRE-TMST,                              25920021
259300                   :SHPTPO-LAST-UPD-DTE,                          25930021
259400                   :SHPTPO-LAST-UPD-TIME,                         25940021
259500                   :SHPTPO-LAST-UPD-USER-ID                       25950021
259600                 , :SHPTPO-SPLT-XMIT-IND                          25960021
259700                 , :SHPTPO-SPLT-XMIT-DTE                          25970021
259800                 , :SHPTPO-SPLT-XMIT-TM                           25980021
259900                 , :AUSHPO-TRN-CDE )                              25990021
260000         END-EXEC                                                 26000021
260100                                                                  26010021
260200                                                                  26020021
260300         EVALUATE TRUE                                            26030021
260400             WHEN SQLCODE = +0                                    26040021
260500             WHEN SQLCODE = -904                                  26050021
260600             WHEN SQLCODE = -913                                  26060021
260700                 CONTINUE                                         26070021
260800                                                                  26080021
260900             WHEN SQLWARN0 NOT = SPACES                           26090021
261000             WHEN SQLCODE < +0                                    26100021
261100             WHEN SQLCODE > +0                                    26110021
261200                 MOVE SPACES TO PV-MESSAGE                        26120021
261300                 MOVE SHPTPO-SHIPT-ID TO PV-MESSAGE1              26130021
261400                 MOVE SHPTPO-PO-NBR   TO PV-MESSAGE2              26140021
261500                 MOVE '5400-INSERT-TAUSHPO'                       26150021
261600                                   TO DP013-PARAGRAPH             26160021
261700                 MOVE 'INSERT A ROW ON TAUSHPO'                   26170021
261800                                   TO DP013-MESSAGE-TEXT(1)       26180021
261900                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       26190021
262000                 MOVE SQLCA        TO DP013-SQLCA                 26200021
262100                 MOVE 'TAUSHPO'    TO DP013-DB2-TABLE-NAME (1)    26210021
262200                 SET DP013-DB2-ABEND                              26220021
262300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           26230021
262400                 PERFORM DP013-0000-PROCESS-ABEND                 26240021
262500         END-EVALUATE                                             26250021
262600     END-PERFORM.                                                 26260021
262700                                                                  26270021
262800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    26280021
262900         SQLCODE NOT = +0                                         26290021
263000         MOVE '5400-INSERT-TAUSHPO'                               26300021
263100                                   TO DP013-PARAGRAPH             26310021
263200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              26320021
263300                                   TO DP013-MESSAGE-TEXT (1)      26330021
263400         MOVE 'TO INSERT A TAUSHPO ROW'                           26340021
263500                                   TO DP013-MESSAGE-TEXT (2)      26350021
263600         MOVE SQLCA                TO DP013-SQLCA                 26360021
263700         MOVE 'TAUSHPO'            TO DP013-DB2-TABLE-NAME (1)    26370021
263800         SET DP013-DB2-ABEND                                      26380021
263900             DP013-XCTL-DISPLAY-RESTART                           26390021
264000                                   TO TRUE                        26400021
264100         PERFORM DP013-0000-PROCESS-ABEND                         26410021
264200     END-IF.                                                      26420021
264300                                                                  26430021
264400 5500-SELECT-RECEIVER.                                            26440021
264500                                                                  26450021
264600     PERFORM                                                      26460021
264700         WITH TEST AFTER                                          26470021
264800         VARYING PV-RETRY-COUNTER                                 26480021
264900         FROM 1 BY 1                                              26490021
265000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               26500021
265100            OR (SQLCODE = +0)                                     26510021
265200            OR (SQLCODE = +100))                                  26520021
265300                                                                  26530021
265400         EXEC SQL                                                 26540021
265500            SELECT  A.STATUS_CDE,                                 26550021
265600                    A.EXPTED_CART_CNT                             26560021
265700              INTO :RECEIV-STATUS-CDE,                            26570021
265800                   :RECEIV-EXPTED-CART-CNT                        26580021
265900              FROM  TRECEIV A                                     26590021
266000             WHERE A.OPER_UNT_ID = :DK-OPER-UNT-ID                26600021
266100               AND A.FCLTY_ID    = :DK-FCLTY-ID                   26610021
266200               AND A.ORD_NBR     = :DK-PO-NBR                     26620021
266300               AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR                26630021
266400               AND A.VER_STATUS_CDE = 'A'                         26640021
266500         END-EXEC                                                 26650021
266600                                                                  26660021
266700         EVALUATE TRUE                                            26670021
266800             WHEN SQLCODE = +0                                    26680021
266900                 CONTINUE                                         26690021
267000                                                                  26700021
267100             WHEN SQLCODE = +100                                  26710021
267200             WHEN SQLCODE = -904                                  26720021
267300             WHEN SQLCODE = -913                                  26730021
267400                 CONTINUE                                         26740021
267500                                                                  26750021
267600             WHEN SQLWARN0 NOT = SPACE                            26760021
267700             WHEN SQLCODE < +0                                    26770021
267800             WHEN SQLCODE > +0                                    26780021
267900                 MOVE '5500-SELECT-TRECEIV'                       26790021
268000                                   TO DP013-PARAGRAPH             26800021
268100                 MOVE 'SELECT ON TRECEIV'                         26810021
268200                                   TO DP013-MESSAGE-TEXT (1)      26820021
268300                 MOVE SQLCA        TO DP013-SQLCA                 26830021
268400                 MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (1)    26840021
268500                 MOVE 'TSTATCD'    TO DP013-DB2-TABLE-NAME (2)    26850021
268600                 SET DP013-DB2-ABEND                              26860021
268700                                   TO TRUE                        26870021
268800                 SET DP013-XCTL-DISPLAY-RESTART                   26880021
268900                                   TO TRUE                        26890021
269000                 PERFORM DP013-0000-PROCESS-ABEND                 26900021
269100         END-EVALUATE                                             26910021
269200     END-PERFORM.                                                 26920021
269300                                                                  26930021
269400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    26940021
269500         SQLCODE NOT = +0                                         26950021
269600         MOVE '5500-SELECT-TRECEIV'                               26960021
269700                                   TO DP013-PARAGRAPH             26970021
269800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     26980021
269900                                   TO DP013-MESSAGE-TEXT (1)      26990021
270000         MOVE 'RECEIVER INFO'                                     27000021
270100                                   TO DP013-MESSAGE-TEXT (2)      27010021
270200         MOVE SQLCA                TO DP013-SQLCA                 27020021
270300         MOVE 'TRECEIV'            TO DP013-DB2-TABLE-NAME (1)    27030021
270400         MOVE 'TSTATCD'            TO DP013-DB2-TABLE-NAME (2)    27040021
270500         SET DP013-DB2-ABEND       TO TRUE                        27050021
270600         SET DP013-XCTL-DISPLAY-RESTART                           27060021
270700                                   TO TRUE                        27070021
270800         PERFORM DP013-0000-PROCESS-ABEND                         27080021
270900     END-IF.                                                      27090021
271000                                                                  27100021
271100     IF RECEIV-STATUS-CDE = PC-VE                                 27110021
271200        CONTINUE                                                  27120021
271300     ELSE                                                         27130021
271400        SET PS-IN-PROCESS TO TRUE                                 27140021
271500     END-IF.                                                      27150021
271600/                                                                 27160021
271700*----------------------------------------------------------------*27170021
271800*    LINK TO AUDIT MODULE * RCKCS290                             *27180021
271900*----------------------------------------------------------------*27190021
272000                                                                  27200021
272100 5550-LINK-AUDIT-MODULE.                                          27210021
272200                                                                  27220021
272300     MOVE 'V'              TO RC031-TABLE-TO-AUDIT.               27230021
272400     MOVE 'B'              TO RC031-AUD-TYP-CDE.                  27240021
272500     MOVE 'U'              TO RC031-AUD-FUNC-CDE.                 27250021
272600     MOVE DK-OPER-UNT-ID   TO RC031-OPER-UNT-ID.                  27260021
272700     MOVE DK-FCLTY-ID      TO RC031-FCLTY-ID.                     27270021
272800     MOVE DK-PO-NBR        TO RC031-PO-NBR.                       27280021
272900     MOVE DK-REC-SEQ-NBR   TO RC031-REC-SEQ-NBR.                  27290021
273000                                                                  27300021
273100     EXEC CICS                                                    27310021
273200          LINK PROGRAM  (PC-AUDIT-RTN)                            27320021
273300          COMMAREA (RC031-FIELDS)                                 27330021
273400          LENGTH   (PC-AUDIT-RTN-LENGTH)                          27340021
273500     END-EXEC.                                                    27350021
273600                                                                  27360021
273700     EVALUATE TRUE                                                27370021
273800         WHEN RC031-CALL-SUCCESSFUL                               27380021
273900             CONTINUE                                             27390021
274000         WHEN OTHER                                               27400021
274100             MOVE '5550-LINK-AUDIT-MODULE'                        27410021
274200                                 TO DP013-PARAGRAPH               27420021
274300             MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'                27430021
274400                                 TO DP013-MESSAGE-TEXT (1)        27440021
274500             MOVE RC031-RETURN-DESC                               27450021
274600                                 TO DP013-MESSAGE-TEXT (2)        27460021
274700             MOVE RC031-SQLCA    TO DP013-SQLCA                   27470021
274800             SET DP013-DB2-ABEND                                  27480021
274900                 DP013-XCTL-DISPLAY-RESTART                       27490021
275000                                 TO TRUE                          27500021
275100             PERFORM DP013-0000-PROCESS-ABEND                     27510021
275200     END-EVALUATE.                                                27520021
275300/                                                                 27530021
275400 5600-UPDATE-RECEIVER.                                            27540021
275500                                                                  27550021
275600     PERFORM                                                      27560021
275700         WITH TEST AFTER                                          27570021
275800         VARYING PV-RETRY-COUNTER                                 27580021
275900         FROM 1 BY 1                                              27590021
276000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               27600021
276100             OR (SQLCODE = +0))                                   27610021
276200                                                                  27620021
276300         EXEC SQL                                                 27630021
276400           UPDATE TRECEIV                                         27640021
276500               SET   EXPTED_CART_CNT   =  :RECEIV-EXPTED-CART-CNT 27650021
276600                    ,UPD_TMST          =  CURRENT TIMESTAMP       27660021
276700                    ,UPD_UID           =  :DP020-USERID           27670021
276800                    ,UPD_PGM_ID        =  :PC-CURRENT-PROGRAM-NAME27680021
276900               WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID             27690021
277000                 AND FCLTY_ID       = :DK-FCLTY-ID                27700021
277100                 AND ORD_NBR        = :DK-PO-NBR                  27710021
277200                 AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR             27720021
277300                 AND VER_STATUS_CDE = 'A'                         27730021
277400         END-EXEC                                                 27740021
277500                                                                  27750021
277600         EVALUATE TRUE                                            27760021
277700             WHEN SQLCODE = +0                                    27770021
277800             WHEN SQLCODE = -904                                  27780021
277900             WHEN SQLCODE = -913                                  27790021
278000                 CONTINUE                                         27800021
278100                                                                  27810021
278200             WHEN SQLWARN0 NOT = SPACES                           27820021
278300             WHEN SQLCODE < +0                                    27830021
278400             WHEN SQLCODE > +0                                    27840021
278500                 MOVE '5600-UPDATE-TRECEIV'                       27850021
278600                                   TO DP013-PARAGRAPH             27860021
278700                 MOVE 'ERROR UPDATING TRECEIV'                    27870021
278800                                   TO DP013-MESSAGE-TEXT(1)       27880021
278900                 MOVE SQLCA        TO DP013-SQLCA                 27890021
279000                 MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (1)    27900021
279100                 SET DP013-DB2-ABEND                              27910021
279200                     DP013-XCTL-DISPLAY-RESTART                   27920021
279300                                   TO TRUE                        27930021
279400                 PERFORM DP013-0000-PROCESS-ABEND                 27940021
279500         END-EVALUATE                                             27950021
279600     END-PERFORM.                                                 27960021
279700                                                                  27970021
279800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    27980021
279900         SQLCODE NOT = +0                                         27990021
280000         MOVE '5600-UPDATE-TRECEIV'                               28000021
280100                                   TO DP013-PARAGRAPH             28010021
280200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              28020021
280300                                   TO DP013-MESSAGE-TEXT (1)      28030021
280400         MOVE 'TO UPDATE A TRECEIV ROW'                           28040021
280500                                   TO DP013-MESSAGE-TEXT (2)      28050021
280600         MOVE SQLCA                TO DP013-SQLCA                 28060021
280700         MOVE 'TRECEIV'            TO DP013-DB2-TABLE-NAME (1)    28070021
280800         SET DP013-DB2-ABEND                                      28080021
280900             DP013-XCTL-DISPLAY-RESTART                           28090021
281000                                   TO TRUE                        28100021
281100         PERFORM DP013-0000-PROCESS-ABEND                         28110021
281200     END-IF.                                                      28120021
281300                                                                  28130021
281400                                                                  28140021
281500 EJECT                                                            28150021
281600*----------------------------------------------------------------*28160021
281700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *28170021
281800*----------------------------------------------------------------*28180021
281900 6010-DELETE-SEL-QUEUE.                                           28190021
282000                                                                  28200021
282100     EXEC CICS                                                    28210021
282200         DELETEQ TS                                               28220021
282300             QUEUE (ASC-SEL-QUEUE-NAME)                           28230021
282400             RESP  (PV-CICS-RESP)                                 28240021
282500     END-EXEC.                                                    28250021
282600*                                                                 28260021
282700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      28270021
282800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         28280021
282900         CONTINUE                                                 28290021
283000     ELSE                                                         28300021
283100         SET DP013-CICS-ABEND TO TRUE                             28310021
283200         SET DP013-NO-ROLLBACK TO TRUE                            28320021
283300         MOVE '6010-DELETE-SEL-QUEUE'                             28330021
283400                        TO DP013-PARAGRAPH                        28340021
283500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         28350021
283600                        TO DP013-MESSAGE-TEXT (1)                 28360021
283700         PERFORM DP013-0000-PROCESS-ABEND                         28370021
283800     END-IF.                                                      28380021
283900                                                                  28390021
284000/                                                                 28400021
284100*----------------------------------------------------------------*28410021
284200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28420021
284300*----------------------------------------------------------------*28430021
284400                                                                  28440021
284500 6112-READ-LIST-QUEUE.                                            28450021
284600                                                                  28460021
284700     EXEC CICS                                                    28470021
284800         READQ TS                                                 28480021
284900             QUEUE (ASC-LIST-QUEUE-NAME)                          28490021
285000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28500021
285100             ITEM  (PV-ITEM)                                      28510021
285200             RESP  (PV-CICS-RESP)                                 28520021
285300     END-EXEC.                                                    28530021
285400*                                                                 28540021
285500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28550021
285600         CONTINUE                                                 28560021
285700     ELSE                                                         28570021
285800         SET DP013-CICS-ABEND        TO TRUE                      28580021
285900         SET DP013-NO-ROLLBACK       TO TRUE                      28590021
286000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           28600021
286100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    28610021
286200                                     TO DP013-MESSAGE-TEXT(1)     28620021
286300         PERFORM DP013-0000-PROCESS-ABEND                         28630021
286400     END-IF.                                                      28640021
286500                                                                  28650021
286600******************************************************************28660021
286700* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *28670021
286800******************************************************************28680021
286900 9100-READ-SEL-QUEUE.                                             28690021
287000     EXEC CICS                                                    28700021
287100         READQ TS                                                 28710021
287200             QUEUE (ASC-SEL-QUEUE-NAME)                           28720021
287300             INTO  (RC013-DC-SELECT-RECORD)                       28730021
287400             ITEM  (ASC-SEL-ITEM)                                 28740021
287500             RESP  (PV-CICS-RESP)                                 28750021
287600     END-EXEC.                                                    28760021
287700                                                                  28770021
287800     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        28780021
287900         CONTINUE                                                 28790021
288000     ELSE                                                         28800021
288100         SET DP013-LOGIC-ABEND                                    28810021
288200             DP013-NO-ROLLBACK     TO TRUE                        28820021
288300         MOVE '9100-READ-SEL-QUEUE'                               28830021
288400                                   TO DP013-PARAGRAPH             28840021
288500         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    28850021
288600                                   TO DP013-MESSAGE-TEXT (1)      28860021
288700         PERFORM DP013-0000-PROCESS-ABEND                         28870021
288800     END-IF.                                                      28880021
288900                                                                  28890021
289000/                                                                 28900021
289100******************************************************************28910021
289200* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *28920021
289300******************************************************************28930021
289400 9200-REWRITE-LIST-QUEUE.                                         28940021
289500     EXEC CICS                                                    28950021
289600          WRITEQ TS                                               28960021
289700              QUEUE   (ASC-SEL-QUEUE-NAME)                        28970021
289800              FROM    (RC013-DC-SELECT-RECORD)                    28980021
289900              ITEM    (ASC-SEL-ITEM)                              28990021
290000              RESP    (PV-CICS-RESP)                              29000021
290100              REWRITE                                             29010021
290200     END-EXEC.                                                    29020021
290300                                                                  29030021
290400     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    29040021
290500         SET DP013-CICS-ABEND                                     29050021
290600             DP013-NO-ROLLBACK     TO TRUE                        29060021
290700         MOVE '9200-REWRITE-LIST-QUEUE'                           29070021
290800                                   TO DP013-PARAGRAPH             29080021
290900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   29090021
291000                                   TO DP013-MESSAGE-TEXT (1)      29100021
291100         PERFORM DP013-0000-PROCESS-ABEND                         29110021
291200     END-IF.                                                      29120021
291300                                                                  29130021
291400/                                                                 29140021
291500*----------------------------------------------------------------*29150021
291600*    ABEND PROCESSOR MODULE                                      *29160021
291700*----------------------------------------------------------------*29170021
291800                                                                  29180021
291900     COPY DPPD013.                                                29190021
