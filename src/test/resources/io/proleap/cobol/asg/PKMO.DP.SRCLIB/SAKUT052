000100 IDENTIFICATION DIVISION.                                         00010008
000200                                                                  00020008
000300 PROGRAM-ID.      SAKUT052.                                       00030008
000400 AUTHOR.          STEVEN NOWAK.                                   00040008
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050008
000600 DATE-WRITTEN.    07/01/09.                                       00060012
000700 DATE-COMPILED.                                                   00070008
000800                                                                  00080008
000900******************************************************************00090008
001000*  MODULE TYPE:   COBOL2 BATCH.                                   00100008
001100*                                                                 00110008
001200* THIS PROGRAM PREPARES THE BLUE MARTINI UPDATE FILE TO BE        00120008
001300* PROCESSED BY SAKUP009 UNDER THE DB2 CHECKPOINT RESTART SYSTEM.  00130008
001400*                                                                 00140008
001500* THE PROGRAM READS THE BLUE MARTINI UPDATE FILE, REFORMATS THE   00150008
001600* RECORDS AND SETS A CHECKPOINT INDICATOR ON THE RECORD BASED     00160008
001700* ON HOW CHECKPOINTS WILL BE TAKEN BY THE MAINTENANCE PROGRAM.    00170008
001800* AFTER A RECORD HAS BEEN REFORMATTED IT IS PASSED TO THE         00180008
001900* TRANSACTION PREPARATION MODULE (DPKUT900) WHICH DOES SOME MORE  00190008
002000* PROCESSING ON THE RECORDS AND WRITES THE REFORMATTED RECORDS    00200008
002100* OUT TO A SEQUENTIAL FILE.                                       00210008
002200*                                                                 00220008
002300* THE PROGRAM COMMUNICATES WITH THE TRANSACTION PREPARATION       00230008
002400* MODULE USING FUNCTION CODES (OPEN, WRITE, & CLOSE) AND CHECKS   00240008
002500* THE RETURN CODE AFTER EACH REQUEST.  IF AN INVALID RETURN CODE  00250008
002600* IS RECEIVED, ANY INFORMATION THAT MAY BE HELPFUL IN RESOLVING   00260008
002700* THE BAD RETURN CODE IS DISPLAYED ON SYSOUT AND THE PROGRAM      00270008
002800* ABENDS.                                                         00280008
002900*                                                                 00290008
003000*========================== CHANGE LOG ===========================00300008
003100* CHANGE       BY           DATE    DESCRIPTION                   00310014
003200*=================================================================00320008
003300* WR36527     TKMA409     07-01-09  CREATE PROGRAM                00330014
003400*                                                                 00340008
260107* CHG0260107  JIM HUNTER  08-19-21  ADD COPYBOOK DPWS990 TO MAKE  00343014
260107*                                   THE CALL TO DPKUT900 DYNAMIC. 00344014
003400*                                                                 00345016
264776* CHG0264776  JIM HUNTER  12-13-21  SETTING THE CHECKPOINT IND    00346016
264776*                                   FOR A BREAK IN REGISTER TO    00347016
264776*                                   FORCE MORE CHECKPOINTS FOR    00348016
264776*                                   STORE 873 WHICH IS ONLY TAKING00349016
264776*                                   1 AND CAUSING SAKUP009 TO     00349116
264776*                                   ABEND WHEN WRITING TOO MANY   00349216
264776*                                   MQ MSGS WITHOUT A COMMIT.     00349316
003500******************************************************************00350008
003600                                                                  00360008
003700 ENVIRONMENT DIVISION.                                            00370008
003800 CONFIGURATION SECTION.                                           00380008
003900                                                                  00390008
004000 SOURCE-COMPUTER.    IBM-3090.                                    00400008
004100 OBJECT-COMPUTER.    IBM-3090.                                    00410008
004200                                                                  00420008
004300 INPUT-OUTPUT SECTION.                                            00430008
004400 FILE-CONTROL.                                                    00440008
004500                                                                  00450008
004600     SELECT UPDATE-FILE   ASSIGN TO INP01.                        00460008
004700                                                                  00470008
004800 DATA DIVISION.                                                   00480008
004900 FILE SECTION.                                                    00490008
005000                                                                  00500008
005100 FD  UPDATE-FILE                                                  00510008
005200     RECORDING MODE IS F                                          00520008
005300     BLOCK CONTAINS 0 RECORDS                                     00530008
005400     LABEL RECORDS ARE OMITTED.                                   00540008
005500                                                                  00550008
005600 01  UPDATE-REC                       PIC  X(26).                 00560009
005700                                                                  00570008
005800***************************************************************** 00580008
005900*                       WORKING STORAGE                           00590008
006000***************************************************************** 00600008
006100 WORKING-STORAGE SECTION.                                         00610008
006200                                                                  00620008
006300 01  W-START                          PIC  X(40)                  00630008
006400     VALUE 'SAKUT052 - WORKING STORAGE BEGINS HERE'.              00640008
006500                                                                  00650008
006600                                                                  00660008
006700***************************************************************** 00670008
006800*                         SWITCHES                                00680008
006900***************************************************************** 00690008
007000 01  PROGRAM-SWITCHES.                                            00700008
007100     05  PS-INPUT-UPDATE-EOF-SW       PIC  X(01) VALUE 'N'.       00710008
007200         88  PS-INPUT-UPDATE-EOF                 VALUE 'Y'.       00720008
007300                                                                  00730008
007400******************************************************************00740008
007500*                       ACCUMULATORS                              00750008
007600******************************************************************00760008
007700 01  PROGRAM-ACCUMULATORS.                                        00770008
007800     05  PA-READ                      PIC  9(11) VALUE ZEROS.     00780008
007900     05  PA-WRITTEN                   PIC  9(11) VALUE ZEROS.     00790008
008000                                                                  00800008
008100******************************************************************00810008
008200*                           CONSTANTS                             00820008
008300******************************************************************00830008
008400 01  PROGRAM-CONSTANTS.                                           00840008
008500     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'SAKUT052'.00850008
008600                                                                  00860008
008700     05  PC-TRAN-PREP-FUNC-CODES.                                 00870008
008800         10  PC-TRAN-PREP-FUNC-OPEN   PIC  X(05) VALUE 'OPEN '.   00880008
008900         10  PC-TRAN-PREP-FUNC-WRITE  PIC  X(05) VALUE 'WRITE'.   00890008
009000         10  PC-TRAN-PREP-FUNC-CLOSE  PIC  X(05) VALUE 'CLOSE'.   00900008
009100                                                                  00910008
009200     05  PC-JOB-NAME                  PIC  X(08) VALUE 'SAK051  '.00920008
009300     05  PC-PLAN-NAME                 PIC  X(08) VALUE 'SAKUP009'.00930008
009600     05  PC-TRANS-RECORD-LENGTH       PIC S9(04) VALUE +26 COMP.  00931010
009600                                                                  00960008
009700******************************************************************00970008
009800*                          VARIABLES                              00980008
009900******************************************************************00990008
010000 01  PROGRAM-VARIABLES.                                           01000008
010100     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01010008
010200     05  PV-OPERATION-MSG             PIC  X(60) VALUE SPACES.    01020008
010300     05  PV-RET-CODE                  PIC  9(04) VALUE ZEROS.     01030008
010400                                                                  01040008
010500     05  PV-CHECKPOINT-TYPE           PIC  X(01) VALUE SPACE.     01050008
010600         88  CONTROL-BREAK                       VALUE 'C'.       01060008
010700         88  LOGICAL-TRANSACTION                 VALUE 'L'.       01070008
010800         88  TIME-INTERVAL                       VALUE 'T'.       01080008
010900         88  REQUESTED-BY-PROGRAM                VALUE 'R'.       01090008
011000                                                                  01100008
011100     05  PV-HOLD-PARTN-NBR            PIC S9(04) COMP             01110008
011200                                                 VALUE ZEROS.     01120008
011300     05  PV-HOLD-STR-NBR              PIC S9(04) COMP             01130008
011400                                                 VALUE ZEROS.     01140008
264776     05  PV-HOLD-RGST-ID              PIC S9(04) COMP             01141016
264776                                                 VALUE ZEROS.     01142016
011500                                                                  01150008
011600******************************************************************01160008
011700*               SYSTEM TIME AND DATE VARIABLES                    01170008
011800******************************************************************01180008
011900 01  SYS-DATE-TIME.                                               01190008
012000     05  SYS-DATE                     PIC  X(08) VALUE SPACES.    01200008
012100     05  SYS-TIME                     PIC  X(08) VALUE SPACES.    01210008
012200                                                                  01220008
012300 01  ST-BEG-TIME.                                                 01230008
012400     05  ST-BEG-HR                    PIC  9(02) VALUE ZEROS.     01240008
012500     05  FILLER                       PIC  X(01) VALUE ':'.       01250008
012600     05  ST-BEG-MN                    PIC  9(02) VALUE ZEROS.     01260008
012700                                                                  01270008
012800 01  ST-END-TIME.                                                 01280008
012900     05  ST-END-HR                    PIC  9(02) VALUE ZEROS.     01290008
013000     05  FILLER                       PIC  X(01) VALUE ':'.       01300008
013100     05  ST-END-MN                    PIC  9(02) VALUE ZEROS.     01310008
013200                                                                  01320008
013300 01  SD-EDIT-DATE.                                                01330008
013400     05  SD-MONTH                     PIC  9(02) VALUE ZEROS.     01340008
013500     05  FILLER                       PIC  X(01) VALUE '-'.       01350008
013600     05  SD-DAY                       PIC  9(02) VALUE ZEROS.     01360008
013700     05  FILLER                       PIC  X(01) VALUE '-'.       01370008
013800     05  SD-CENT                      PIC  9(02) VALUE ZEROS.     01380008
013900     05  SD-YEAR                      PIC  9(02) VALUE ZEROS.     01390008
014000                                                                  01400008
014100******************************************************************01410008
014200*                        ERROR HANDLING                           01420008
014300******************************************************************01430008
014400 01  ABEND-CODE                       PIC S9(04) VALUE ZEROS      01440008
014500                                                 COMP SYNC.       01450008
014600     88  ABEND-4002-READ-ERROR             VALUE +4002.           01460008
014700     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           01470008
014800                                                                  01480008
014900                                                                  01490008
015000******************************************************************01500008
015100*  TSASUM - TOTALS BY STORE REGISTER FILE                         01510008
015200******************************************************************01520008
015300     COPY SARD012.                                                01530008
015400                                                                  01540008
015500******************************************************************01550008
015600*  TRANSACTION PREPARATION MODULE LINKAGE SECTION                 01560008
015700******************************************************************01570008
260107     COPY DPWS990.                                                01580013
015900                                                                  01590008
015800     COPY DPLS000.                                                01591013
015900                                                                  01592013
016000******************************************************************01600008
016100*  SQL COMMUNICATIONS WORK AREA                                   01610008
016200******************************************************************01620008
016300     COPY SQLCA2.                                                 01630008
016400                                                                  01640008
016500                                                                  01650008
016600                                                                  01660008
016700                                                                  01670008
016800 PROCEDURE DIVISION.                                              01680008
016900******************************************************************01690008
017000* MAINLINE-PROCESSING                                             01700008
017100******************************************************************01710008
017200                                                                  01720008
017300     PERFORM A100-INITIALIZE.                                     01730008
017400                                                                  01740008
017500     PERFORM B100-PROCESS-UPDATE-INPUT-FILE                       01750008
017600       UNTIL PS-INPUT-UPDATE-EOF.                                 01760008
017700                                                                  01770008
017800     PERFORM Z990-END-OF-JOB-ROUTINE.                             01780008
017900                                                                  01790008
018000     GOBACK.                                                      01800008
018100                                                                  01810008
018200                                                                  01820008
018300******************************************************************01830008
018400* PREFORMS TASK INITIATION                                        01840008
018500******************************************************************01850008
018600 A100-INITIALIZE.                                                 01860008
018700                                                                  01870008
018800     OPEN INPUT UPDATE-FILE.                                      01880008
018900                                                                  01890008
019000     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 01900008
019100                                                                  01910008
019200     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            01920008
019300     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            01930008
019400                                                                  01940008
019500     MOVE SYS-DATE (1:2) TO SD-CENT.                              01950008
019600     MOVE SYS-DATE (3:2) TO SD-YEAR.                              01960008
019700     MOVE SYS-DATE (5:2) TO SD-MONTH.                             01970008
019800     MOVE SYS-DATE (7:2) TO SD-DAY.                               01980008
019900                                                                  01990008
020000     PERFORM C100-ISSUE-OPEN-REQUEST.                             02000008
020100                                                                  02010008
020200     PERFORM C200-READ-UPDATE-INPUT-FILE.                         02020008
020300                                                                  02030008
020400     IF PS-INPUT-UPDATE-EOF                                       02040008
020500         MOVE 'C200-READ-UPDATE-INPUT-FILE' TO PV-PARAGRAPH-NAME  02050008
020600         MOVE '** EMPTY UPDATE FILE - NO DATA **'                 02060008
020700                                            TO PV-OPERATION-MSG   02070008
021000     END-IF.                                                      02100008
021100                                                                  02110008
021200     MOVE SA012-PARTN-NBR TO PV-HOLD-PARTN-NBR.                   02120008
021300     MOVE SA012-STR-NBR   TO PV-HOLD-STR-NBR.                     02130008
264776     MOVE SA012-RGST-ID   TO PV-HOLD-RGST-ID.                     02131016
021400                                                                  02140008
021500                                                                  02150008
021600******************************************************************02160008
021700* PROCESS THE UPDATE FILE. IF A RECORD IS READ, GATHER WHATEVER   02170008
021800* OTHER DATA IS NECESSARY TO TAKE CHECKPOINTS BASED ON THE TYPE OF02180008
021900* CHECKPOINTS BEING TAKEN BY SAKUP009 AND ISSUE A WRITE REQUEST   02190008
022000* TO THE TRANSACTION PREPARATION PROGRAM.                         02200008
022100******************************************************************02210008
022200 B100-PROCESS-UPDATE-INPUT-FILE.                                  02220008
022300                                                                  02230008
022400     IF CONTROL-BREAK                                             02240008
022500         PERFORM C300-CKPT-BY-CNTL-BREAK                          02250008
022600     ELSE                                                         02260008
022700         IF LOGICAL-TRANSACTION                                   02270008
022800             PERFORM C400-CKPT-BY-LOGICAL-TRANS                   02280008
022900         ELSE                                                     02290008
023000             PERFORM C500-CKPT-BY-TIME-OR-REQUEST                 02300008
023100         END-IF                                                   02310008
023200     END-IF.                                                      02320008
023300                                                                  02330008
023400     PERFORM C200-READ-UPDATE-INPUT-FILE.                         02340008
023500                                                                  02350008
023600                                                                  02360008
023700******************************************************************02370008
023800* ISSUE AN 'OPEN' REQUEST TO THE TRANSACTION PREPARATION MODULE   02380008
023900******************************************************************02390008
024000 C100-ISSUE-OPEN-REQUEST.                                         02400008
024100                                                                  02410008
024200     MOVE PC-TRAN-PREP-FUNC-OPEN TO DP000-FUNC-CODE.              02420008
024300     MOVE PC-JOB-NAME            TO DP000-JOB-NAME.               02430008
024400     MOVE PC-PLAN-NAME           TO DP000-PLAN-NAME.              02440008
024500                                                                  02450008
024600     PERFORM Z100-CALL-TRANS-PREP-MODULE.                         02460008
024700                                                                  02470008
024800     MOVE DP000-CKPT-TYPE-CODE   TO PV-CHECKPOINT-TYPE.           02480008
024900                                                                  02490008
025000                                                                  02500008
025100******************************************************************02510008
025200* READ THE UPDATE INPUT FILE                                      02520008
025300******************************************************************02530008
025400 C200-READ-UPDATE-INPUT-FILE.                                     02540008
025500                                                                  02550008
025600     READ UPDATE-FILE INTO SA012-BLUMART-REC                      02560008
025700       AT END SET PS-INPUT-UPDATE-EOF TO TRUE.                    02570008
025800                                                                  02580008
025900     IF PS-INPUT-UPDATE-EOF                                       02590008
026000         CONTINUE                                                 02600008
026100     ELSE                                                         02610008
026200         ADD +1 TO PA-READ                                        02620008
026300     END-IF.                                                      02630008
026400                                                                  02640008
026500                                                                  02650008
026600******************************************************************02660008
026700* THIS ROUTINE SETS THE CHECKPOINT INDICATOR ON THE TRANSACATION  02670008
026800* RECORD "ON" IF THERE IS A CHANGE IN THE STORE NUMBER. AFTER     02680008
026900* THE TRANSACTION RECORD HAS BEEN FORMATTED, A WRITE REQUEST IS   02690008
027000* ISSUED TO THE TRANSACTION PREPARATION MODULE.                   02700008
027100*                                                                 02710008
027200* NOTE: AT THIS TIME CONTROL/LOGIC BREAK PROCESSING IS IDENTICAL. 02720008
027300******************************************************************02730008
027400 C300-CKPT-BY-CNTL-BREAK.                                         02740008
027500                                                                  02750008
027600     IF  SA012-PARTN-NBR = PV-HOLD-PARTN-NBR                      02760008
027700     AND SA012-STR-NBR   = PV-HOLD-STR-NBR                        02770008
264776     AND SA012-RGST-ID   = PV-HOLD-RGST-ID                        02771016
027800         MOVE 'N' TO DP000-CHECKPOINT-IND                         02780008
027900     ELSE                                                         02790008
028000         MOVE 'Y' TO DP000-CHECKPOINT-IND                         02800008
028100         MOVE SA012-PARTN-NBR TO PV-HOLD-PARTN-NBR                02810008
028200         MOVE SA012-STR-NBR   TO PV-HOLD-STR-NBR                  02820008
264776         MOVE SA012-RGST-ID   TO PV-HOLD-RGST-ID                  02821016
028300     END-IF.                                                      02830008
028400                                                                  02840008
028500     MOVE PC-TRANS-RECORD-LENGTH  TO DP000-TRANS-REC-LENGTH.      02850008
028600     MOVE SA012-BLUMART-REC       TO DP000-TRANS-REC.             02860008
028700     MOVE PC-TRAN-PREP-FUNC-WRITE TO DP000-FUNC-CODE.             02870008
028800     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              02880008
028900     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             02890008
029000                                                                  02900008
029100     PERFORM Z100-CALL-TRANS-PREP-MODULE.                         02910008
029200                                                                  02920008
029300     ADD +1 TO PA-WRITTEN.                                        02930008
029400                                                                  02940008
029500                                                                  02950008
029600******************************************************************02960008
029700* THIS ROUTINE SETS THE CHECKPOINT INDICATOR ON THE TRANSACTION   02970008
029800* RECORD "ON".  THE UPDATE PROGRAM WILL CHECK THE CHECKPOINT      02980008
029900* FREQUENCY TO KNOW WHETHER A CHECKPOINT SHOULD BE TAKEN. AFTER   02990008
030000* THE TRANSACTION RECORD HAS BEEN FORMATTED, A WRITE REQUEST IS   03000008
030100* ISSUED TO THE TRANSACTION PREPARATION MODULE.                   03010008
030200******************************************************************03020008
030300 C400-CKPT-BY-LOGICAL-TRANS.                                      03030008
030400                                                                  03040008
030500     IF  SA012-PARTN-NBR = PV-HOLD-PARTN-NBR                      03050008
030600     AND SA012-STR-NBR   = PV-HOLD-STR-NBR                        03060008
264776     AND SA012-RGST-ID   = PV-HOLD-RGST-ID                        03061016
030700         MOVE 'N' TO DP000-CHECKPOINT-IND                         03070008
030800     ELSE                                                         03080008
030900         MOVE 'Y' TO DP000-CHECKPOINT-IND                         03090008
031000         MOVE SA012-PARTN-NBR TO PV-HOLD-PARTN-NBR                03100008
031100         MOVE SA012-STR-NBR   TO PV-HOLD-STR-NBR                  03110008
264776         MOVE SA012-RGST-ID   TO PV-HOLD-RGST-ID                  03111016
031200     END-IF.                                                      03120008
031300                                                                  03130008
031400     MOVE PC-TRANS-RECORD-LENGTH  TO DP000-TRANS-REC-LENGTH.      03140008
031500     MOVE SA012-BLUMART-REC       TO DP000-TRANS-REC.             03150008
031600     MOVE PC-TRAN-PREP-FUNC-WRITE TO DP000-FUNC-CODE.             03160008
031700     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              03170008
031800     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             03180008
031900                                                                  03190008
032000     PERFORM Z100-CALL-TRANS-PREP-MODULE.                         03200008
032100                                                                  03210008
032200     ADD +1 TO PA-WRITTEN.                                        03220008
032300                                                                  03230008
032400                                                                  03240008
032500******************************************************************03250008
032600* THIS ROUTINE BUILDS THE TRANSACTION RECORD AND ISSUES A WRITE   03260008
032700* REQUEST TO THE TRANSACTION PREPARATION MODULE IF CHECKPOINTS ARE03270008
032800* TAKEN BY TIME INTERVAL (SECONDS) OR REQUESTED BY THE MAINTENANCE03280008
032900* PROGRAM.                                                        03290008
033000******************************************************************03300008
033100 C500-CKPT-BY-TIME-OR-REQUEST.                                    03310008
033200                                                                  03320008
033300     MOVE 'N'                     TO DP000-CHECKPOINT-IND.        03330008
033400                                                                  03340008
033500     MOVE PC-TRANS-RECORD-LENGTH  TO DP000-TRANS-REC-LENGTH.      03350008
033600     MOVE SA012-BLUMART-REC       TO DP000-TRANS-REC.             03360008
033700     MOVE PC-TRAN-PREP-FUNC-WRITE TO DP000-FUNC-CODE.             03370008
033800     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              03380008
033900     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             03390008
034000                                                                  03400008
034100     PERFORM Z100-CALL-TRANS-PREP-MODULE.                         03410008
034200                                                                  03420008
034300     ADD +1 TO PA-WRITTEN.                                        03430008
034400                                                                  03440008
034500                                                                  03450008
034600******************************************************************03460008
034700* ISSUE A 'CLOSE' REQUEST TO THE TRANSACTION PREPARATION MODULE   03470008
034800******************************************************************03480008
034900 C600-ISSUE-CLOSE-REQUEST.                                        03490008
035000                                                                  03500008
035100     MOVE PC-TRAN-PREP-FUNC-CLOSE TO DP000-FUNC-CODE.             03510008
035200     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              03520008
035300     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             03530008
035400                                                                  03540008
035500     PERFORM Z100-CALL-TRANS-PREP-MODULE.                         03550008
035600                                                                  03560008
035700                                                                  03570008
035800******************************************************************03580008
035900* VERIFY THE RETURN CODE ON THE CALLED MODULE                     03590008
036000******************************************************************03600008
036100 Z100-CALL-TRANS-PREP-MODULE.                                     03610008
036200                                                                  03620008
036300     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         03630008
036400                                                                  03640008
036500     IF  DP000-GOOD-RET-CODE                                      03650008
036600         CONTINUE                                                 03660008
036700                                                                  03670008
036800     ELSE                                                         03680008
036900         MOVE 'Z100-CALL-TRANS-PREP-MODULE' TO PV-PARAGRAPH-NAME  03690008
037000         MOVE '** BAD CALL TO TRANS PREP MODULE **'               03700008
037100                                            TO PV-OPERATION-MSG   03710008
037200         MOVE DP000-RET-CODE                TO PV-RET-CODE        03720008
037300                                                                  03730008
037400         SET ABEND-4019-CAL-SUB-ERROR TO TRUE                     03740008
037500                                                                  03750008
037600         PERFORM Z200-ABEND                                       03760008
037700     END-IF.                                                      03770008
037800                                                                  03780008
037900                                                                  03790008
038000******************************************************************03800008
038100* NON-DB2 ABEND                                                   03810008
038200******************************************************************03820008
038300 Z200-ABEND.                                                      03830008
038400                                                                  03840008
038500     PERFORM Z999-CONTROLS.                                       03850008
038600                                                                  03860008
038700     DISPLAY '                     '.                             03870008
038800     DISPLAY '** ABEND           **'.                             03880008
038900     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          03890008
039000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        03900008
039100     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         03910008
039200     DISPLAY '** RETURN CODE     ** = ' PV-RET-CODE.              03920008
039300                                                                  03930008
039400     CALL 'ILBOABN0' USING ABEND-CODE.                            03940008
039500                                                                  03950008
039600                                                                  03960008
039700******************************************************************03970008
039800* PREFORMS TASK TERMINATION PROCESSING                            03980008
039900******************************************************************03990008
040000 Z990-END-OF-JOB-ROUTINE.                                         04000008
040100                                                                  04010008
040200     CLOSE UPDATE-FILE.                                           04020008
040300                                                                  04030008
040400     PERFORM C600-ISSUE-CLOSE-REQUEST.                            04040008
040500                                                                  04050008
040600     PERFORM Z999-CONTROLS.                                       04060008
040700                                                                  04070008
040800                                                                  04080008
040900******************************************************************04090008
041000* DISPLAY CONTROLS FROM THE PROGRAM                               04100008
041100******************************************************************04110008
041200 Z999-CONTROLS.                                                   04120008
041300                                                                  04130008
041400     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 04140008
041500                                                                  04150008
041600     MOVE SYS-TIME (1:2) TO ST-END-HR.                            04160008
041700     MOVE SYS-TIME (3:2) TO ST-END-MN.                            04170008
041800                                                                  04180008
041900     DISPLAY '                    '.                              04190008
042000     DISPLAY '**********************'.                            04200008
042100     DISPLAY '   SAKUT052 CONTROLS  '.                            04210008
042200     DISPLAY '**********************'.                            04220008
042300     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         04230008
042400     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          04240008
042500     DISPLAY 'END TIME  = ' ST-END-TIME.                          04250008
042600     DISPLAY '======================'.                            04260008
042700     DISPLAY 'RECORDS READ    = ' PA-READ.                        04270008
042800     DISPLAY '                  '.                                04280008
042900     DISPLAY 'RECORDS WRITTEN = ' PA-WRITTEN.                     04290008
043000     DISPLAY '                  '.                                04300008
043100                                                                  04310008
043200                                                                  04320008
043300******************************************************************04330008
043400* TRANSACTION PREPARATION MODULE CALL AND ERROR ROUTINES          04340008
043500******************************************************************04350008
043600     COPY DPPD000.                                                04360008
043700                                                                  04370008
043800                                                                  04380008
