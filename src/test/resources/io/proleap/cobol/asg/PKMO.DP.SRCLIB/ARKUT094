000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             ARKUT094.                                00050000
000600 AUTHOR.                 RICHARD WARNER.                          00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            09-14-2011.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* CREATE FIRST DATA NON-MONS BATCHES.                             00120000
001300* READS IN FD NON-MONS SORTED IN PRIN ORDER.                      00130000
001400* COPIES RECORDS TO OUTPUT ADDING BATCH HEADERS.                  00140000
001500******************************************************************00150000
P10237*             MODIFICATION LOG                                    00151005
P10237******************************************************************00151105
P10237* REQUIREMENT   : EMPLOYEE DISCOUNT CHANGES COSA SECURITY PROJECT 00152005
P10237* WR/IR#        : CHG0125054                                      00153019
P10237* AUTHOR        : COGNIZANT                                       00154005
P10237* DATE  CHANGED : 2015-08-27                                      00155005
P10237* CHANGES MADE  : MODIFIED THE CODE TO DE-TOKENIZE THE ACCONT     00156005
P10237*                 NUMBER AND INTERNALLY SORTED THE RECORDS BASED  00157005
P10237*                 ON PRIN AND ACCOUNT NUMBER                      00157105
001700******************************************************************00170000
001800 ENVIRONMENT DIVISION.                                            00180000
001900******************************************************************00190000
002000                                                                  00200000
002100 CONFIGURATION SECTION.                                           00210000
002200                                                                  00220000
002300 SOURCE-COMPUTER.        IBM-3090.                                00230000
002400 OBJECT-COMPUTER.        IBM-3090.                                00240000
002500                                                                  00250000
002600 INPUT-OUTPUT SECTION.                                            00260000
002700                                                                  00270000
002800 FILE-CONTROL.                                                    00280000
002900                                                                  00290000
003000     SELECT FD-NON-MONS-IN-FILE                                   00300000
003100         ASSIGN TO INP01.                                         00310000
003200                                                                  00320000
003300     SELECT FD-NON-MONS-OUT-FILE                                  00330000
003400         ASSIGN TO OUT01.                                         00340000
003500                                                                  00350000
P10237     SELECT SORT-WORK-FILE                                        00351005
P10237         ASSIGN TO SORTWK01                                       00352005
P10237                   SORTWK02                                       00353005
P10237                   SORTWK03                                       00354005
P10237                   SORTWK04                                       00355005
P10237                   SORTWK05                                       00356005
P10237                   SORTWK06.                                      00357005
P10237                                                                  00358005
003600******************************************************************00360000
003700 DATA DIVISION.                                                   00370000
003800******************************************************************00380000
003900                                                                  00390000
004000 FILE SECTION.                                                    00400000
004100                                                                  00410000
004200 FD FD-NON-MONS-IN-FILE                                           00420000
004300     RECORDING MODE IS F                                          00430000
004400     BLOCK CONTAINS 0 RECORDS                                     00440000
004500     LABEL RECORDS ARE STANDARD.                                  00450000
004600 01 FD-NON-MONS-IN-REC              PIC X(80).                    00460000
004700                                                                  00470000
004800 FD FD-NON-MONS-OUT-FILE                                          00480000
004900     RECORDING MODE IS F                                          00490000
005000     BLOCK CONTAINS 0 RECORDS                                     00500000
005100     LABEL RECORDS ARE STANDARD.                                  00510000
005200 01 EMPLOYEE-DISC-UPDATE-REC        PIC X(80).                    00520001
005300                                                                  00530000
P10237 SD SORT-WORK-FILE                                                00531005
P10237     RECORD CONTAINS 80 CHARACTERS                                00532005
P10237     DATA RECORD IS SORT-WORK-RECORD.                             00533005
P10237                                                                  00535005
P10237 01  SORT-WORK-RECORD.                                            00535105
P10237     05  SR-ACCT-NBR                  PIC  X(16).                 00536005
P10237     05  FILLER                       PIC  X(54).                 00537005
P10237     05  SR-KOHLS-SORT-PRIN           PIC  X(04).                 00538005
P10237     05  FILLER                       PIC  X(06).                 00539005
P10237                                                                  00539105
005400 WORKING-STORAGE SECTION.                                         00540000
005500******************************************************************00550000
005600*                        ABEND CODES                              00560000
005700******************************************************************00570000
005800     COPY ARWS052.                                                00580000
005900                                                                  00590000
006000******************************************************************00600000
006100*                        SWITCHES                                 00610000
006200******************************************************************00620000
006300 01 PS-PROGRAM-SWITCHES.                                          00630000
006400    05 PS-PROCESSING-SW               PIC X      VALUE SPACES.    00640000
006500       88 PS-CONTINUE-PROCESSING                 VALUE 'Y'.       00650000
006600       88 PS-STOP-PROCESSING                     VALUE 'N'.       00660000
P10237    05 PS-END-OF-SORT-IND             PIC X      VALUE SPACES.    00671005
P10237       88 PS-END-OF-SORT                         VALUE 'Y'.       00672005
P10237       88 PS-NOT-END-OF-SORT                     VALUE 'N'.       00673005
006700                                                                  00674005
006800******************************************************************00680000
006900*                        CONSTANTS                                00690000
007000******************************************************************00700000
007100 01 PC-PROGRAM-CONSTANTS.                                         00710000
007200    05 PC-PROGRAM-NAME                PIC X(8)   VALUE 'ARKUT094'.00720000
007300                                                                  00730000
007400******************************************************************00740000
007500*                        VARIABLES                                00750000
007600******************************************************************00760000
007700 01 PV-PROGRAM-VARIABLES.                                         00770000
007800    05 PV-NON-MON-COUNT               PIC S9(9)  VALUE ZEROES     00780000
007900                                                 COMP.            00790000
008000    05 PV-READ-COUNT                  PIC S9(9)  VALUE ZEROES     00800000
008100                                                 COMP.            00810000
008200    05 PV-BTCH-DATE.                                              00820000
008300       10 PV-BTCH-DATE-YYYY           PIC 9(04)  VALUE ZEROS.     00830000
008400       10 PV-BTCH-DATE-MM             PIC 9(02)  VALUE ZEROS.     00840000
008500       10 PV-BTCH-DATE-DD             PIC 9(02)  VALUE ZEROS.     00850000
008600    05 PV-BTCH-NBR.                                               00860000
008700       10 PV-BTCH-SEQ-NBR             PIC 9(1)   VALUE ZERO.      00870000
008800       10 PV-BTCH-MM                  PIC 9(2)   VALUE ZEROS.     00880000
008900       10 PV-BTCH-DD                  PIC 9(2)   VALUE ZEROS.     00890000
008910    05 PV-PREV-PRIN                   PIC X(4)   VALUE SPACES.    00891001
P10237    05 PV-SORT-RETURN                 PIC 9(02)  VALUE ZEROS.     00892005
P10237    05 PV-RECORDS-INTO-SORT           PIC S9(09) VALUE +0 COMP-3. 00893005
P10237    05 PV-RECORDS-OUT-OF-SORT         PIC S9(09) VALUE +0 COMP-3. 00894005
P10237    05 PV-PARAGRAPH-NAME              PIC X(30)  VALUE SPACES.    00896005
P10237    05 PV-OPERATION-MSG-1             PIC X(40)  VALUE SPACES.    00897005
P10237    05 PV-OPERATION-MSG-2             PIC X(40)  VALUE SPACES.    00898005
P10237    05 PV-ACCT-NBR-12.                                            00899005
P10237       10 PV-ACCT-NBR-10              PIC X(10)  VALUE SPACES.    00899105
P10237       10 FILLER                      PIC X(02)  VALUE '00'.      00899205
P10237                                                                  00899305
009000******************************************************************00900000
009100*                        COPYBOOKS                                00910000
009200******************************************************************00920000
009300                                                                  00930000
009400******************************************************************00940000
009500* FD NON-MON UPDATE RECORD LAYOUT                                 00950000
009600******************************************************************00960000
009700     COPY ARRD068.                                                00970000
009800                                                                  00980000
P10237******************************************************************00981005
P10237* LAYOUT THAT DEFINES THE PARAMETERS NEEDED TO INVOKE PROTEGRITY *00982005
P10237* MODULE                                                         *00983005
P10237******************************************************************00984005
P10237     COPY PTYCCSIP.                                               00985005
P10237                                                                  00986005
P10237******************************************************************00987005
P10237* LAYOUT THAT DEFINES THE WORKING VARIABLES TO INVOKE PROTEGRITY *00988005
P10237* MODULE                                                         *00989005
P10237******************************************************************00989105
P10237     COPY DPWS031.                                                00989205
P10237                                                                  00989305
009900******************************************************************00990000
010000 PROCEDURE DIVISION.                                              01000000
010100******************************************************************01010000
010200*--------------*                                                  01020000
010300 0000-MAINLINE.                                                   01030000
010400*--------------*                                                  01040000
010500                                                                  01050000
010600     PERFORM Z050-INITIALIZE.                                     01060000
010700                                                                  01070000
010800     PERFORM 1000-PROCESS-IN-NON-MONS-FILE.                       01080000
010900                                                                  01090000
011000     PERFORM Z100-END-PROC.                                       01100000
011100                                                                  01110000
011200     STOP RUN.                                                    01120000
011300                                                                  01130000
011400*-------------------------------*                                 01140000
011500 1000-PROCESS-IN-NON-MONS-FILE.                                   01150000
011600*-------------------------------*                                 01160000
011700     SET PS-CONTINUE-PROCESSING TO TRUE.                          01171010
011800                                                                  01180000
P10237     PERFORM 2000-INTERNAL-SORT.                                  01190008
012000                                                                  01200000
P10237*-------------------------------*                                 01453005
P10237 2000-INTERNAL-SORT.                                              01454008
P10237*-------------------------------*                                 01455005
P10237     SORT SORT-WORK-FILE                                          01456005
P10237          ON ASCENDING KEY SR-KOHLS-SORT-PRIN                     01457005
P10237                           SR-ACCT-NBR                            01458005
P10237          INPUT PROCEDURE  IS 2100-RELEASE-RECORDS-TO-SORT        01459008
P10237          OUTPUT PROCEDURE IS 2200-RETURN-SORT-WORK-FILE.         01459108
P10237                                                                  01459205
P10237     MOVE SORT-RETURN              TO PV-SORT-RETURN.             01459305
P10237                                                                  01459405
P10237     IF PV-SORT-RETURN NOT = ZERO                                 01459505
P10237        MOVE '2000-INTERNAL-SORT'  TO PV-PARAGRAPH-NAME           01459608
P10237        MOVE 'INTERNAL SORT ERROR' TO PV-OPERATION-MSG-1          01459805
P10237        MOVE PV-SORT-RETURN        TO PV-OPERATION-MSG-2          01460005
P10237        MOVE +4012                 TO ABEND-CODE                  01460105
P10237        PERFORM Z999-ABEND                                        01460205
P10237     END-IF.                                                      01460305
P10237                                                                  01460405
P10237*---------------------------------------*                         01461105
P10237 2100-RELEASE-RECORDS-TO-SORT SECTION.                            01461208
P10237*---------------------------------------*                         01461305
P10237                                                                  01461505
P10237     PERFORM 4000-READ-IN-NON-MONS                                01461605
P10237       UNTIL PS-STOP-PROCESSING.                                  01461705
P10237                                                                  01461805
P10237 2100-EXIT SECTION.                                               01461908
P10237                                                                  01462005
P10237*---------------------------------------*                         01462105
P10237 2200-RETURN-SORT-WORK-FILE SECTION.                              01462208
P10237*---------------------------------------*                         01462305
P10237                                                                  01462505
P10237     RETURN SORT-WORK-FILE AT END                                 01462605
P10237                SET PS-END-OF-SORT TO TRUE                        01462705
P10237     END-RETURN.                                                  01462805
P10237                                                                  01462905
P10237     PERFORM UNTIL PS-END-OF-SORT                                 01463005
P10237        MOVE SORT-WORK-RECORD      TO AR068-EMP-DISC-UPDATE-REC   01463105
P10237        PERFORM 3000-PROCESS-NON-MONS                             01463308
P10237        RETURN SORT-WORK-FILE AT END                              01463505
P10237                SET PS-END-OF-SORT TO TRUE                        01463605
P10237        END-RETURN                                                01463705
P10237        ADD +1                     TO PV-RECORDS-OUT-OF-SORT      01463805
P10237     END-PERFORM.                                                 01463905
P10237                                                                  01464005
P10237 2200-EXIT SECTION.                                               01464108
P10237                                                                  01464205
012400*-------------------------------*                                 01464308
012500 3000-PROCESS-NON-MONS.                                           01464408
012600*-------------------------------*                                 01464508
012700                                                                  01464608
012800*    CHECK IF NEED BATCH HEADER AND CREATE                        01464708
012900                                                                  01464808
013000     IF AR068-KOHLS-SORT-PRIN NOT = PV-PREV-PRIN                  01465010
013100        ADD 1                         TO PV-BTCH-SEQ-NBR          01465110
013200        MOVE PV-BTCH-NBR              TO AR068-BTCH-NBR           01465210
013300        MOVE AR068-KOHLS-SORT-PRIN    TO AR068-PRCNPL-USER-NBR    01465310
013400        WRITE EMPLOYEE-DISC-UPDATE-REC                            01465510
013500           FROM AR068-EMP-DISC-UPD-HDR-REC                        01465610
013510        MOVE AR068-KOHLS-SORT-PRIN    TO PV-PREV-PRIN             01465710
013600     END-IF.                                                      01465810
013700                                                                  01465910
013900     MOVE SPACES                      TO AR068-KOHLS-SORT-PRIN.   01466010
014000                                                                  01466110
014100     WRITE EMPLOYEE-DISC-UPDATE-REC                               01466310
014200        FROM AR068-EMP-DISC-UPDATE-REC.                           01466410
014300     ADD 1                       TO PV-NON-MON-COUNT.             01466510
014500                                                                  01466610
014600*-------------------------------*                                 01467005
014700 4000-READ-IN-NON-MONS.                                           01470000
014800*-------------------------------*                                 01480000
014900                                                                  01490000
P10237     INITIALIZE PV-ACCT-NBR-12.                                   01491016
P10237                                                                  01492005
015000     READ FD-NON-MONS-IN-FILE                                     01500000
P10237        INTO SORT-WORK-RECORD                                     01510005
015200        AT END                                                    01520000
015300           SET PS-STOP-PROCESSING TO TRUE                         01530000
P10237        NOT AT END                                                01531005
P10237           ADD 1 TO PV-RECORDS-INTO-SORT                          01531111
P10237           MOVE SR-ACCT-NBR(7:10) TO PV-ACCT-NBR-10               01532005
P10237           PERFORM 4100-DETOKENIZE-ACCT-NBR                       01533017
P10237           RELEASE SORT-WORK-RECORD                               01534010
015400     END-READ.                                                    01540000
015500                                                                  01550000
015600     IF NOT PS-STOP-PROCESSING                                    01552009
015700        ADD 1 TO PV-READ-COUNT                                    01553009
015800     END-IF.                                                      01554009
015900                                                                  01555009
P10237*------------------------*                                        01599117
P10237 4100-DETOKENIZE-ACCT-NBR.                                        01599217
P10237*------------------------*                                        01599417
P10237                                                                  01599605
P10237     INITIALIZE DP031-PROTEG-PGM-PARAMETERS                       01599705
P10237               CSI-PARAMETERS.                                    01599805
P10237                                                                  01599905
P10237     MOVE 'ACCT-NBR'              TO DP031-FIELD.                 01600005
P10237     SET CSI-DECRYPT-FUNCTION     TO TRUE.                        01600105
P10237     SET DP031-ACCTNBR            TO TRUE.                        01600205
P10237     MOVE PV-ACCT-NBR-12          TO DP031-CIPHER-TEXT.           01600305
P10237     MOVE 12                      TO DP031-INPUT-LEN.             01600405
P10237                                                                  01600505
P10237     PERFORM DP031-0000-PROTG-TOKEN-DETOKEN.                      01600605
P10237                                                                  01600705
P10237     IF CSI-RETURN-CODE NOT = ZERO                                01600805
P10237        DISPLAY 'ACCOUNT NBR     : ' SR-ACCT-NBR                  01600905
P10237        DISPLAY 'KOHLS SORT PRIN : ' SR-KOHLS-SORT-PRIN           01601005
P10237        PERFORM DP031-9999-ABEND                                  01601105
P10237     ELSE                                                         01601205
P10237        MOVE DP031-CLEAR-TEXT     TO PV-ACCT-NBR-12               01601308
P10237        MOVE PV-ACCT-NBR-10       TO SR-ACCT-NBR(7:10)            01601405
P10237     END-IF.                                                      01601613
P10237                                                                  01601713
016000******************************************************************01602005
016100* Z050 - INITIALIZE                                               01610000
016200******************************************************************01620000
016300 Z050-INITIALIZE.                                                 01630000
016400                                                                  01640000
016500     OPEN INPUT FD-NON-MONS-IN-FILE.                              01650000
016600     OPEN OUTPUT FD-NON-MONS-OUT-FILE.                            01660000
016700                                                                  01670000
016800     ACCEPT PV-BTCH-DATE FROM DATE YYYYMMDD.                      01680000
016900     MOVE PV-BTCH-DATE-MM           TO PV-BTCH-MM.                01690000
017000     MOVE PV-BTCH-DATE-DD           TO PV-BTCH-DD.                01700000
017100                                                                  01710000
017200******************************************************************01720000
017300* Z100 - PREFORMS TASK TERMINATION PROCESSING                     01730000
017400******************************************************************01740000
017500 Z100-END-PROC.                                                   01750000
017600     DISPLAY ' '.                                                 01760000
017700     DISPLAY '**********************'.                            01770000
017800     DISPLAY '   ARKUT094 CONTROLS  '.                            01780000
017900     DISPLAY '**********************'.                            01790000
018000     DISPLAY ' '.                                                 01800000
018100     DISPLAY 'RECORDS READ   : ' PV-READ-COUNT.                   01810000
018200     DISPLAY 'NON MON UPDATE : ' PV-NON-MON-COUNT.                01820000
P10237     DISPLAY 'SORT IN        : ' PV-RECORDS-INTO-SORT.            01821008
P10237     DISPLAY 'SORT OUT       : ' PV-RECORDS-OUT-OF-SORT.          01822008
018300     IF PV-NON-MON-COUNT = 0                                      01830000
018400        DISPLAY ' '                                               01840000
018500        DISPLAY '*** NO NON-MONS TO SEND TO FIRST DATA ***'       01850000
018600     END-IF.                                                      01860000
018700                                                                  01870000
018800     CLOSE FD-NON-MONS-IN-FILE                                    01880000
018900           FD-NON-MONS-OUT-FILE.                                  01890000
019000                                                                  01900000
019100******************************************************************01910000
019200* Z999 - ABEND ROUTINE                                            01920000
019300******************************************************************01930000
019400 Z999-ABEND.                                                      01940000
019500                                                                  01950000
P10237     DISPLAY '** ABEND           **'.                             01951005
P10237     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          01952005
P10237     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        01953005
P10237     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       01954005
P10237     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       01955005
019600     CALL 'ILBOABN0' USING ABEND-CODE.                            01960000
019700                                                                  01970000
P10237******************************************************************01971005
P10237* COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE        01972005
P10237* PROTEGRITY MODULE FOR PROTECTION / UNPROTECTION                 01973005
P10237******************************************************************01974005
P10237     COPY DPPD031.                                                01975005
P10237                                                                  01976005
019800******************************************************************01980000
