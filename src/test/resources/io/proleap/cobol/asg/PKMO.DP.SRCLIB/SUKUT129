000010 IDENTIFICATION DIVISION.                                         00010000
000011*  COMMENT                                                        00020000
000012 PROGRAM-ID.         SUKUT129.                                    00030000
000013 AUTHOR.             DAN HINTZ.                                   00040000
000014 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00050000
000015 DATE-WRITTEN.       OCTOBER 2008.                                00060000
000016******************************************************************00070000
000017* I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES 00080000
000018* SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.        00090000
000019* THIS PROGRAM USES MQSERIES.                                     00100000
000020******************************************************************00110000
000030* I M P O R T A N T --- WHEN RECOMPILING THIS PROGRAM, IT NEEDS   00120000
000040* TO BE COMPILED FOR BOTH "BATCH" AND FOR "CICS".  IT ALSO NEEDS  00130000
000050* TO BE PROMOTED TO Q/A AND PRODUCTION TWICE, ONCE FOR BATCH, AND 00140000
000051* ONCE FOR CICS.                                                  00150000
000052******************************************************************00160000
000053******************************************************************00170000
000054*                    DIRECTIVE GENERATOR                          00180000
000055* THIS PROGRAM WILL BUILD DIRECTIVE MESSAGES AS MQ MESSAGES AND   00190000
000056* SEND THEM TO AN MQ QUEUE.  THERE IS A TIBCO PROCESS THAT WILL   00200000
000057* PICK UP THESE MESSAGES AND SEND THEM TO THE SORTER.             00210000
000058******************************************************************00220000
000059 ENVIRONMENT DIVISION.                                            00230000
000060******************************************************************00240000
000061 CONFIGURATION SECTION.                                           00250000
000062 SOURCE-COMPUTER.    IBM-3090.                                    00260000
000063 OBJECT-COMPUTER.    IBM-3090.                                    00270000
000064                                                                  00280000
000065******************************************************************00290000
000066 DATA DIVISION.                                                   00300000
000067******************************************************************00310000
000068 WORKING-STORAGE SECTION.                                         00320000
000069******************************************************************00330000
000070 01  PS-PROGRAM-SWITCHES.                                         00340000
000080     05  PS-END-OF-CURSOR-SW         PIC X(01) VALUE 'N'.         00350000
000090         88  PS-END-OF-CURSOR                  VALUE 'Y'.         00360000
000100         88  PS-NOT-END-OF-CURSOR              VALUE 'N'.         00370000
000110     05  PS-PRIOR-DIRECTIVE-SW       PIC X(01) VALUE 'N'.         00380000
000120         88  PS-PRIOR-DIRECTIVE                VALUE 'Y'.         00390000
000130         88  PS-NO-PRIOR-DIRECTIVE             VALUE 'N'.         00400000
000140     05  PS-BATCH-ONLINE-CALL-SW     PIC X(01) VALUE 'O'.         00410000
000150         88  PS-BATCH-CALL                     VALUE 'B'.         00420000
000160         88  PS-ONLINE-CALL                    VALUE 'O'.         00430000
000170     05  PS-DIRECTIVE-ACTION-SW      PIC X(01) VALUE 'A'.         00440000
000180         88  PS-ADD-DIRECTIVE                  VALUE 'A'.         00450000
000190         88  PS-DELETE-DIRECTIVE               VALUE 'D'.         00460000
000191     05  PS-MQCONN-SUCCESSFUL-IND    PIC X(01) VALUE SPACES.      00470000
000192         88  PS-MQCONN-SUCCESSFUL              VALUE 'Y'.         00480000
000193     05  PS-MQOPEN-SUCCESSFUL-IND    PIC X(01) VALUE SPACES.      00490000
000194         88  PS-MQOPEN-SUCCESSFUL              VALUE 'Y'.         00500000
1023RM     05  PS-DRCTV-MQOPEN-SUCCESSFUL-IND PIC X(01) VALUE SPACES.   00510027
1023RM         88  PS-DRCTV-MQOPEN-SUCCESSFUL           VALUE 'Y'.      00520027
000195     05  PS-MQPUT-SUCCESSFUL-IND     PIC X(01) VALUE SPACES.      00530000
000196         88  PS-MQPUT-SUCCESSFUL               VALUE 'Y'.         00540000
000197         88  PS-MQPUT-SUCCESSFUL-NO            VALUE 'N'.         00550023
1023RM     05  PS-DRCTV-MQPUT-SUCCESSFUL-IND PIC X(01) VALUE SPACES.    00560035
1023RM         88  PS-DRCTV-MQPUT-SUCCESSFUL         VALUE 'Y'.         00570035
1023RM         88  PS-DRCTV-MQPUT-SUCCESSFUL-NO      VALUE 'N'.         00580035
000198     05  PS-CHECK-DELETE-SW          PIC X(01) VALUE 'N'.         00590023
000199         88  PS-CHECK-DELETE                   VALUE 'Y'.         00600023
000200         88  PS-CHECK-DELETE-NO                VALUE 'N'.         00610023
1023RM     05  PS-ADDL-DRTVMSGQ-SW         PIC X(01) VALUE 'N'.         00620027
1023RM         88  PS-ADDL-DRTVMSGQ-YES              VALUE 'Y'.         00630027
1023RM         88  PS-ADDL-DRTVMSGQ-NO               VALUE 'N'.         00640027
000201                                                                  00650023
000202 01  PC-PROGRAM-CONSTANTS.                                        00660023
000203     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'SUKUT129'.  00670023
000204     05  PC-MAX-RETRIES              PIC S9(3) VALUE +5 COMP-3.   00680023
000205     05  PC-DEFAULT-TMST             PIC X(26) VALUE              00690023
000206                                     '9999-09-09-09.09.09.999999'.00700023
000207     05  PC-MARRIAGEMISSION          PIC X(15) VALUE              00710023
000208                                               'MARRIAGEMISSION'. 00720023
000209     05  PC-DIRVGENSUKUT129          PIC X(15) VALUE              00730023
000210                                               'DIRVGENSUKUT129'. 00740023
000211     05  PC-READY                    PIC X(06) VALUE 'READY '.    00750023
000212     05  PC-ERROR                    PIC X(06) VALUE 'ERROR '.    00760023
000213     05  PC-ALL                      PIC X(03) VALUE 'ALL'.       00770023
000214     05  PC-ADD                      PIC X(03) VALUE 'ADD'.       00780023
000215     05  PC-DELETE                   PIC X(06) VALUE 'DELETE'.    00790023
000216     05  PC-UNIQUE                   PIC X(06) VALUE 'UNIQUE'.    00800023
000217     05  PC-NONUNIQUE                PIC X(09) VALUE 'NONUNIQUE'. 00810023
000218     05  PC-START-OF-TEXT            PIC X(01) VALUE X'02'.       00820023
000219     05  PC-END-OF-TEXT              PIC X(01) VALUE X'03'.       00830023
000220     05  PC-CARET                    PIC X(01) VALUE X'B0'.       00840023
000221     05  PC-COLON                    PIC X(01) VALUE ':'.         00850023
000222     05  PC-APOSTROPHE               PIC X(01) VALUE X'7D'.       00860023
000223     05  PC-CARAT                    PIC X(01) VALUE X'5F'.       00870023
000230     05  PC-SPACE                    PIC X(01) VALUE X'40'.       00880000
000240     05  PC-1                        PIC X(01) VALUE '1'.         00890000
000250     05  PC-S                        PIC X(01) VALUE 'S'.         00900000
000260     05  PC-P                        PIC X(01) VALUE 'P'.         00910000
000261     05  PC-U                        PIC X(01) VALUE 'U'.         00920012
000262     05  PC-RFD                      PIC X(03) VALUE 'RFD'.       00930012
000263     05  PC-RLF                      PIC X(03) VALUE 'RLF'.       00940014
000264     05  PC-50                       PIC 9(02) VALUE 50.          00950014
000265     05  PC-WAIT-15-SECS             PIC S9(9) VALUE 1500.        00960014
000266     05  PC-MQPUT-RETRY-COUNTER      PIC 9(3)  VALUE ZERO.        00970014
000267     05  PC-DELAY-INTERVAL.                                       00980014
000268         10  FILLER                  PIC X(2)  VALUE SPACES.      00990014
000269         10  PC-DELAY-TIME           PIC 9(8)  VALUE 3000.        01000014
000270                                                                  01010014
000271 01  DK-DATABASE-KEYS.                                            01020014
000272     05  DK-OPER-UNT-ID              PIC S9(4) COMP VALUE ZERO.   01030014
000273     05  DK-PO-NBR                   PIC S9(9) COMP VALUE ZERO.   01040014
000280     05  DK-RCVR-SEQ-NBR             PIC S9(9) COMP VALUE ZERO.   01050000
000290     05  DK-PO-LNE-NBR               PIC S9(9) COMP VALUE ZERO.   01060000
000291     05  DK-PREPK-ID                 PIC S9(4) COMP VALUE ZERO.   01070000
000292     05  DK-AUD-CNTL-NBR             PIC S9(9) COMP VALUE ZERO.   01080000
000293     05  DK-DIRV-RSN-CDE             PIC X(03) VALUE SPACES.      01090000
000294     05  DK-BRCDE-TYP-CDE            PIC X(01) VALUE SPACES.      01100000
000295     05  DK-BRCDE-NBR                PIC X(22) VALUE SPACES.      01110000
000296     05  DK-SHIPT-UNT-ID             PIC S9(18) COMP-3 VALUE ZERO.01120000
000297                                                                  01130000
000298 01  PA-PROGRAM-ACCUMULATORS.                                     01140000
000299     05  PA-CNTL-READ                PIC S9(9) VALUE +0 COMP-3.   01150000
000300     05  PA-XFER-READ                PIC S9(9) VALUE +0 COMP-3.   01160000
000301     05  PA-TOTAL-MQ-MSGS-SENT       PIC S9(9) VALUE +0 COMP-3.   01170000
000302                                                                  01180000
000303 01  PV-PROGRAM-VARIABLES.                                        01190000
000304     05  PV-DIRV-RSN-CDE             PIC X(03) VALUE SPACES.      01200000
000305     05  PV-LGCL-LOC-NM              PIC X(32) VALUE SPACES.      01210000
000306     05  PV-LGCL-LOC-NM-HOLD         PIC X(32) VALUE SPACES.      01220000
000307     05  PV-ORIG-CASI-CDE            PIC X(01) VALUE SPACES.      01230000
000308     05  PV-ORIG-CRE-TMST            PIC X(26) VALUE SPACES.      01240020
000309     05  PV-CURR-CASI-CDE            PIC X(01) VALUE SPACES.      01250020
000310     05  PV-CART-STAT-CDE            PIC X(01) VALUE SPACES.      01260020
000311     05  PV-AUD-STAT-CDE             PIC X(01) VALUE SPACES.      01270020
000320     05  PV-AUD-FAIL-RSN             PIC X(04) VALUE SPACES.      01280000
000330     05  PV-STR-ZN                   PIC X(05) VALUE SPACES.      01290000
000340     05  PV-SEASET-CDE               PIC X(05) VALUE SPACES.      01300000
000350     05  PV-MLT-USE-CDE              PIC X(01) VALUE SPACES.      01310000
000360         88  PV-UNIQUE                         VALUE 'U'.         01320000
000370         88  PV-NONUNIQUE                      VALUE 'N'.         01330000
000380     05  PV-UNIQUE-IND               PIC X(09) VALUE SPACES.      01340000
000390     05  PV-ACTN-CDE                 PIC X(06) VALUE SPACES.      01350000
000391     05  PV-ASSOC-ID                 PIC X(08) VALUE SPACES.      01360000
000392     05  PV-CURRENT-TMST             PIC X(26) VALUE SPACES.      01370000
000393     05  PV-BARCODE-22               PIC X(22) VALUE SPACES.      01380000
000394     05  PV-BARCODE-22-R             REDEFINES                    01390000
000395         PV-BARCODE-22.                                           01400000
000396         10  PV-BARCODE-01-02        PIC 9(02).                   01410000
000397         10  PV-BARCODE-03-20        PIC 9(18).                   01420000
000398         10  PV-BARCODE-21-22        PIC X(02).                   01430000
000399     05  PV-DC-NBR                   PIC 9(04) VALUE ZEROS.       01440000
000400     05  PV-ACKNL-SEQ-NBR-X.                                      01450000
000401         10  PV-ACKNL-SEQ-NBR-N      PIC 9(09) VALUE ZERO.        01460000
000402     05  PV-DIRECTIVE-PORT-X.                                     01470000
000403         10  PV-DIRECTIVE-PORT-N     PIC 9(09) VALUE ZERO.        01480000
000404     05  PV-PRIORITY-IND-X.                                       01490000
000405         10  PV-PRIORITY-IND-N       PIC 9(09) VALUE ZERO.        01500000
000406     05  PV-CURSOR-COUNT             PIC S9(4) VALUE +0 COMP SYNC.01510000
000407     05  PV-RETRY-COUNT              PIC S9(4) VALUE +0 COMP SYNC.01520000
000408     05  PV-MSG-LENGTH               PIC S9(9) BINARY.            01530000
000409     05  PV-MSG-LENGTH-DISPLAY       PIC 9(09).                   01540000
000410     05  PV-CHAR-POSN                PIC 9(08) VALUE ZEROES.      01550000
000411     05  PV-POINTER                  PIC S9(5) VALUE +0           01560000
000412                                               COMP-3.            01570000
000413     05  PV-HOLD-COMPLETION-CODE     PIC S9(9) BINARY.            01580000
000414     05  PV-HOLD-REASON              PIC S9(9) BINARY.            01590000
000415     05  PV-HOLD-PROCESS-TYPE        PIC X(16) VALUE SPACES.      01600000
000416     05  PV-SAVE-PROCESS-TYPE        PIC X(16).                   01610000
000417     05  PV-PO-NBR-X.                                             01620000
000418         10  PV-PO-NBR               PIC 9(09) VALUE ZEROES.      01630000
000419     05  PV-RCVR-SEQ-NBR-X.                                       01640000
000420         10  PV-RCVR-SEQ-NBR         PIC 9(04) VALUE ZEROES.      01650000
000421     05  PV-PO-LNE-NBR-X.                                         01660000
000422         10  PV-PO-LNE-NBR           PIC 9(04) VALUE ZEROES.      01670000
000423     05  PV-PO-PREPK-ID-X.                                        01680000
000424         10  PV-PO-PREPK-ID          PIC 9(04) VALUE ZEROES.      01690000
000425     05  PV-AUD-CNTL-NBR-X.                                       01700000
000426         10  PV-AUD-CNTL-NBR         PIC 9(09) VALUE ZEROES.      01710000
000427     05  PV-STR-NBR-X.                                            01720000
000428         10  PV-STR-NBR              PIC 9(04) VALUE ZEROES.      01730000
000429     05  PV-HOLD-GROUP-PROCESS-ID    PIC 9(18) VALUE ZEROES.      01740000
000430     05  PV-CURR-GROUP-PROCESS-ID    PIC 9(18) VALUE ZEROES.      01750000
000431     05  PV-CURR-STR-NBR             PIC 9(04) VALUE ZEROES.      01760000
000432     05  PV-CNT1                     PIC 9(04) VALUE ZEROES.      01770000
000433     05  PV-CNT2                     PIC 9(04) VALUE ZEROES.      01780000
000434     05  PV-CASI-TXT                 PIC X(01) VALUE ZEROES.      01790008
000435     05  PV-CARET-TRIMMED-RECORD     PIC X(1000)                  01800008
000436                                               VALUE SPACES.      01810008
1023RM     05  PV-DB2-TEST                     PIC S9(04) VALUE ZEROES  01820027
1023RM                                                COMP.             01830027
1023RM     05  PV-NULL                        PIC S9(04)  VALUE +0      01840029
1023RM                                                    COMP SYNC.    01850029
000437 01  PV-DISPLAY-VARIABLES.                                        01860008
000438     05  PV-OPER-UNT-ID-DISP.                                     01870008
000439         10  PV-OPER-UNT-ID-N        PIC 9(04) VALUE ZERO.        01880008
000440     05  PV-PO-NBR-DISP.                                          01890008
000441         10  PV-PO-NBR-N             PIC 9(09) VALUE ZERO.        01900008
000442     05  PV-RCVR-SEQ-NBR-DISP.                                    01910008
000443         10  PV-RCVR-SEQ-NBR-N       PIC 9(04) VALUE ZERO.        01920008
000444     05  PV-PO-LNE-NBR-DISP.                                      01930008
000445         10  PV-PO-LNE-NBR-N         PIC 9(04) VALUE ZERO.        01940008
000446     05  PV-PREPK-ID-DISP.                                        01950008
000447         10  PV-PREPK-ID-N           PIC 9(05) VALUE ZERO.        01960008
000448     05  PV-AUD-CNTL-NBR-DISP.                                    01970008
000449         10  PV-AUD-CNTL-NBR-N       PIC 9(09) VALUE ZERO.        01980008
000450     05  PV-SHIPT-UNT-ID-DISP.                                    01990008
000451         10  PV-SHIPT-UNT-ID-N       PIC 9(18) VALUE ZERO.        02000008
000452                                                                  02010008
000453 01  PV-FIELD-LENGTHS.                                            02020008
000454     05  PV-PUB-LOC-LGTH             PIC 9(03) VALUE 0.           02030008
000455     05  PV-PUB-TYP-LGTH             PIC 9(03) VALUE 0.           02040008
000456     05  PV-SUB-LOC-LGTH             PIC 9(03) VALUE 0.           02050008
000457     05  PV-SUB-TYP-LGTH             PIC 9(03) VALUE 0.           02060008
000458     05  PV-ACTN-CDE-LGTH            PIC 9(03) VALUE 0.           02070008
000459     05  PV-BRCDE-NBR-LGTH           PIC 9(03) VALUE 0.           02080008
000460     05  PV-AUD-RSN-LGTH             PIC 9(03) VALUE 0.           02090008
000461     05  PV-DIRV-RSN-LGTH            PIC 9(03) VALUE 0.           02100008
000462     05  PV-STR-ZN-LGTH              PIC 9(03) VALUE 0.           02110008
000463     05  PV-ENT-NME-LGTH             PIC 9(03) VALUE 0.           02120008
000464     05  PV-LGCL-LOC-NM-LGTH         PIC 9(03) VALUE 0.           02130008
000465     05  PV-SEASET-LGTH              PIC 9(03) VALUE 0.           02140008
000466     05  PV-ASSOC-ID-LGTH            PIC 9(03) VALUE 0.           02150008
000467     05  PV-UNIQUE-IND-LGTH          PIC 9(03) VALUE 0.           02160008
000468     05  PV-ACKNL-SEQ-NBR-LGTH       PIC 9(03) VALUE 0.           02170008
000469     05  PV-DIRECTIVE-PORT-LGTH      PIC 9(03) VALUE 0.           02180008
000470     05  PV-PO-NBR-LGTH              PIC 9(03) VALUE 0.           02190008
000471     05  PV-PO-LNE-NBR-LGTH          PIC 9(03) VALUE 0.           02200008
000472     05  PV-PO-PREPK-ID-LGTH         PIC 9(03) VALUE 0.           02210008
000473     05  PV-RCVR-SEQ-NBR-LGTH        PIC 9(03) VALUE 0.           02220008
000474     05  PV-AUD-CNTL-NBR-LGTH        PIC 9(03) VALUE 0.           02230008
000475     05  PV-STR-NBR-LGTH             PIC 9(03) VALUE 0.           02240008
000476     05  PV-PRIORITY-IND-LGTH        PIC 9(03) VALUE 0.           02250008
000477     05  PV-CARET-TRIMMED-REC-LGTH   PIC 9(05) VALUE 0.           02260008
000478     05  PV-ACKNL-SEQ-NBR-STRT       PIC 9(03) VALUE 0.           02270008
000479     05  PV-DIRECTIVE-PORT-STRT      PIC 9(03) VALUE 0.           02280008
000480     05  PV-PO-NBR-STRT              PIC 9(03) VALUE 0.           02290008
000481     05  PV-PO-LNE-NBR-STRT          PIC 9(03) VALUE 0.           02300008
000482     05  PV-PO-PREPK-ID-STRT         PIC 9(03) VALUE 0.           02310008
000483     05  PV-RCVR-SEQ-NBR-STRT        PIC 9(03) VALUE 0.           02320008
000484     05  PV-AUD-CNTL-NBR-STRT        PIC 9(03) VALUE 0.           02330008
000485     05  PV-STR-NBR-STRT             PIC 9(03) VALUE 0.           02340008
000486     05  PV-PRIORITY-IND-STRT        PIC 9(03) VALUE 0.           02350008
000487     05  PV-POSITION                 PIC 9(05) VALUE 0.           02360008
000488     05  PV-FIELD-LGTH               PIC 9(05) VALUE 0.           02370008
000489     05  PV-FLAG1                    PIC 9(05) VALUE 0.           02380008
000490     05  PV-WORK-FIELD               PIC X(300) VALUE SPACES.     02390008
000491     05  PV-WORK-KEY                 PIC 9(06) VALUE 0.           02400008
000492                                                                  02410008
1023RM 01  PV-DRTV-QUEUE-DATA.                                          02420035
1023RM     10  PV-DRTV-INTGRTN-TYP-DESC    PIC   X(50).                 02430035
1023RM     10  PV-DRTV-LCL-QUE-MGR.                                     02440035
1023RM         49  PV-DRTV-LCL-QUE-MGR-LEN PIC S9(4) COMP.              02450035
1023RM         49  PV-DRTV-LCL-QUE-MGR-TEXT PIC X(50).                  02460035
1023RM     10  PV-DRTV-RMT-QUE-MGR.                                     02470035
1023RM         49  PV-DRTV-RMT-QUE-MGR-LEN PIC S9(4) COMP.              02480035
1023RM         49  PV-DRTV-RMT-QUE-MGR-TEXT PIC X(50).                  02490035
1023RM     10  PV-DRTV-QUE-NM.                                          02500035
1023RM         49  PV-DRTV-QUE-NM-LEN      PIC S9(4) COMP.              02510035
1023RM         49  PV-DRTV-QUE-NM-TEXT     PIC X(50).                   02520035
1023RM     10  PV-DRTV-DC-NBR              PIC  S9(9) COMP.             02530035
000493 01  PV-DATE-AND-TIME.                                            02540008
000494     05  PV-TIMESTAMP.                                            02550008
000495         10  PV-TIMESTAMP-DATE.                                   02560008
000496             15  PV-TIMESTAMP-YEAR   PIC X(04) VALUE SPACES.      02570008
000497             15  FILLER              PIC X(01) VALUE SPACES.      02580008
000498             15  PV-TIMESTAMP-MONTH  PIC X(02) VALUE SPACES.      02590008
000499             15  FILLER              PIC X(01) VALUE SPACES.      02600008
000500             15  PV-TIMESTAMP-DAY    PIC X(02) VALUE SPACES.      02610008
000501         10  FILLER                  PIC X(01) VALUE SPACES.      02620008
000502         10  PV-TIMESTAMP-TIME.                                   02630008
000503             15  PV-TIMESTAMP-HOUR   PIC X(02) VALUE SPACES.      02640008
000504             15  FILLER              PIC X(01) VALUE SPACES.      02650008
000505             15  PV-TIMESTAMP-MINUTE PIC X(02) VALUE SPACES.      02660008
000506             15  FILLER              PIC X(01) VALUE SPACES.      02670008
000507             15  PV-TIMESTAMP-SECOND PIC X(02) VALUE SPACES.      02680008
000508             15  FILLER              PIC X(01) VALUE SPACES.      02690008
000509             15  PV-TIMESTAMP-NANO   PIC X(06) VALUE SPACES.      02700008
000510                                                                  02710008
000511     05  PV-WORK-DATE                PIC X(10) VALUE SPACES.      02720008
000512     05  PV-WORK-DATE-R              REDEFINES                    02730008
000513         PV-WORK-DATE.                                            02740008
000514         10  PV-WORK-DATE-YEAR       PIC X(04).                   02750008
000515         10  FILLER                  PIC X(01).                   02760008
000516         10  PV-WORK-DATE-MONTH      PIC X(02).                   02770008
000517         10  FILLER                  PIC X(01).                   02780008
000518         10  PV-WORK-DATE-DAY        PIC X(02).                   02790008
000519                                                                  02800008
000520     05  PV-SEND-DATE.                                            02810008
000521         10  PV-SEND-DATE-MONTH      PIC X(02) VALUE SPACES.      02820008
000522         10  FILLER                  PIC X(01) VALUE '/'.         02830008
000523         10  PV-SEND-DATE-DAY        PIC X(02) VALUE SPACES.      02840008
000524         10  FILLER                  PIC X(01) VALUE '/'.         02850008
000525         10  PV-SEND-DATE-YEAR       PIC X(04) VALUE SPACES.      02860008
000526                                                                  02870008
000527     05  PV-SEND-TIME.                                            02880008
000528         10  PV-SEND-TIME-HOUR       PIC X(02) VALUE SPACES.      02890008
000529         10  FILLER                  PIC X(01) VALUE ':'.         02900008
000530         10  PV-SEND-TIME-MINUTE     PIC X(02) VALUE SPACES.      02910008
000531         10  FILLER                  PIC X(01) VALUE ':'.         02920008
000532         10  PV-SEND-TIME-SECOND     PIC X(02) VALUE SPACES.      02930008
000533         10  FILLER                  PIC X(01) VALUE '.'.         02940008
000534         10  PV-SEND-TIME-NANO       PIC X(06) VALUE SPACES.      02950008
000535                                                                  02960008
000536     05  PV-AUD-DATE.                                             02970008
000537         10  PV-AUD-DATE-MONTH       PIC X(02) VALUE SPACES.      02980008
000538         10  PV-AUD-DATE-SL1         PIC X(01) VALUE '/'.         02990008
000539         10  PV-AUD-DATE-DAY         PIC X(02) VALUE SPACES.      03000008
000540         10  PV-AUD-DATE-SL2         PIC X(01) VALUE '/'.         03010008
000541         10  PV-AUD-DATE-YEAR        PIC X(04) VALUE SPACES.      03020008
000542                                                                  03030008
000543 01  PV-DIRECTIVE-INFORMATION.                                    03040008
000544     05  PV-PUBLISHER-LOCATION       PIC X(30) VALUE SPACES.      03050008
000545     05  PV-PUBLISHER-TYPE           PIC X(30) VALUE SPACES.      03060008
000546     05  PV-SUBSCRIBER-LOCATION      PIC X(30) VALUE SPACES.      03070008
000547     05  PV-SUBSCRIBER-TYPE          PIC X(30) VALUE SPACES.      03080008
000548     05  PV-ACKNL-SEQ-NBR            PIC S9(9) VALUE +0 COMP SYNC.03090008
000549     05  PV-DIRECTIVE-PORT           PIC S9(9) VALUE +0 COMP SYNC.03100008
000550     05  PV-PRIORITY-IND             PIC S9(9) VALUE +0 COMP SYNC.03110008
000551                                                                  03120008
000552 01  ABEND-CODE                      PIC S9(4) VALUE +0 COMP SYNC.03130008
000553 01  PV-ABEND-VARIABLES.                                          03140008
000554     05  PV-SQLCODE                  PIC S9(9).                   03150008
000555     05  PV-DISPLAY-SQLCODE          PIC -------999.              03160008
000556     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SUKUT129'.  03170008
000557     05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.      03180008
000558     05  PV-ABEND-OPER-MESSAGE-1     PIC X(79) VALUE SPACES.      03190008
000559     05  PV-ABEND-OPER-MESSAGE-2     PIC X(79) VALUE SPACES.      03200008
000560     05  PV-ABEND-OPER-MESSAGE-3     PIC X(79) VALUE SPACES.      03210008
000561     05  PV-ABEND-OPER-MESSAGE-4     PIC X(79) VALUE SPACES.      03220008
000562     05  PV-ABEND-TABLE-1            PIC X(19) VALUE SPACES.      03230008
000563     05  PV-ABEND-TABLE-2            PIC X(19) VALUE SPACES.      03240008
000564     05  PV-ABEND-TABLE-3            PIC X(19) VALUE SPACES.      03250008
000565     05  PV-ABEND-TABLE-4            PIC X(19) VALUE SPACES.      03260008
000566     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      03270008
000567                                                                  03280008
000568***DIRECTIVE GENERATOR MESSAGE COPYBOOK                           03290008
000569***  COPY SUWS093.                                                03300008
000570                                                                  03310008
000571*----------------------------------------------------------------*03320008
000580*    NUMERIC EDIT ROUTINE LAYOUT                                  03330000
000590*----------------------------------------------------------------*03340000
000600     COPY DPWS010I.                                               03350000
000610                                                                  03360000
000620 01  PV-HOLD-MQ-OUTPUT-RECORD.                                    03370000
000630     05  PV-MQ-OUTPUT-CHAR OCCURS 1000 TIMES                      03380000
000640                                     PIC X(01).                   03390000
000650 01  PV-MSG.                                                      03400000
000660     05  PV-MQC-CONTROL-RECORD.                                   03410000
000670         10  PV-MQC-PROCESS-TYPE     PIC X(10) VALUE SPACES.      03420000
000680         10  PV-MQC-GROUP-ID-X       PIC X(06) VALUE SPACES.      03430000
000690         10  PV-MQC-GROUP-ID     REDEFINES                        03440000
000700             PV-MQC-GROUP-ID-X       PIC 9(06).                   03450000
000800         10  PV-MQC-STR-NBR-X        PIC X(04) VALUE SPACES.      03460000
000810         10  PV-MQC-STR-NBR      REDEFINES                        03470000
000820             PV-MQC-STR-NBR-X        PIC 9(04).                   03480000
000830                                                                  03490000
000840***************************************************************** 03500000
000850 01  PE-MQ-ABEND-VARIABLES.                                       03510000
000860     05  PE-MQ-QMANAGER              PIC X(05) VALUE SPACES.      03520000
000870     05  PE-MQ-QMANAGER-REMOTE       PIC X(30) VALUE SPACES.      03530000
000880     05  PE-MQ-QNAME                 PIC X(48) VALUE SPACES.      03540000
000890     05  PE-MQ-COMPLETION-CODE       PIC 9(04) VALUE ZEROES.      03550000
000891     05  PE-MQ-REASON-CODE           PIC 9(04) VALUE ZEROES.      03560000
000892                                                                  03570000
000893******************************************************************03580000
000894*  DB2 FORMATTED MESSAGE AREA                                     03590000
000895******************************************************************03600000
000896     COPY DPWS004.                                                03610000
000897                                                                  03620000
000898******************************************************************03630000
000899*  COMMUNICATIONS AREA FOR DB2                                    03640000
000900******************************************************************03650000
001000     EXEC SQL                                                     03660000
001010          INCLUDE SQLCA                                           03670000
001020     END-EXEC.                                                    03680000
001030                                                                  03690000
001040     COPY SQLCA2.                                                 03700000
001050                                                                  03710000
001060******************************************************************03720000
001070*  DB2 DECLARATION - WMOS - PROVIDER QUEUE INFORMATION (PUT/WRITE)03730000
001080*      TABLE (WSV_PRVDR_QUE)                                      03740000
001090******************************************************************03750000
001100     EXEC SQL                                                     03760000
001110         INCLUDE WSV00005                                         03770000
001120     END-EXEC.                                                    03780000
001130                                                                  03790000
001140******************************************************************03800000
001150*  DB2 DECLARATION - WMOS INTEGRATION TYPE                        03810000
001160*      TABLE (WST_INTGRTN_TYP)                                    03820000
001161******************************************************************03830000
001162     EXEC SQL                                                     03840000
001163         INCLUDE WST00008                                         03850000
001164     END-EXEC.                                                    03860000
001165                                                                  03870000
001166******************************************************************03880000
001167*  DB2 DECLARATION - WMOS ATTRIBUTE DEFINITION                    03890000
001168*      TABLE (WST_ATTR_DEFN)                                      03900000
001169******************************************************************03910000
001170     EXEC SQL                                                     03920000
001180         INCLUDE WST00009                                         03930000
001190     END-EXEC.                                                    03940000
001191                                                                  03950000
001192******************************************************************03960000
001193*  DB2 DECLARATION - WMOS ATTRIBUTE ELEMENTS                      03970000
001194*      TABLE (WST_ATTR_ELEM)                                      03980000
001195******************************************************************03990000
001196     EXEC SQL                                                     04000000
001197         INCLUDE WST00010                                         04010000
001198     END-EXEC.                                                    04020000
001199                                                                  04030000
001200******************************************************************04040000
001210*  DB2 DECLARATION - SHIPPING UNIT - CARTON DIRECTIVE TRACKING    04050000
001220*      TABLE (SUT_CART_DIRV_TRKG)                                 04060000
001230******************************************************************04070000
001231     EXEC SQL                                                     04080000
001232         INCLUDE SUT00102                                         04090000
001233     END-EXEC.                                                    04100000
001234                                                                  04110000
001235******************************************************************04120000
001236*  DB2 DECLARATION - SHIPPING UNIT - PURCHASE ORDER AUDIT REQUEST 04130000
001237*      TABLE (SUT_PO_AUD_REQ)                                     04140000
001238******************************************************************04150000
001239     EXEC SQL                                                     04160000
001240         INCLUDE SUT00015                                         04170000
001250     END-EXEC.                                                    04180000
001260                                                                  04190000
001270******************************************************************04200000
001280*  DB2 DECLARATION - EXTERNAL ENTERPRISE NAME TABLE (TENTNME)     04210000
001290******************************************************************04220000
001291     EXEC SQL                                                     04230000
001292         INCLUDE TENTNME                                          04240000
001293     END-EXEC.                                                    04250000
001294                                                                  04260000
001295******************************************************************04270000
001296*  DB2 DECLARATION - EXTERNAL PO HEADER TABLE (TPURCHS)           04280000
001297******************************************************************04290000
001298     EXEC SQL                                                     04300000
001299         INCLUDE TPURCHS                                          04310000
001300     END-EXEC.                                                    04320000
001301                                                                  04330000
001302******************************************************************04340000
001303*  DB2 DECLARATION - SEASONAL SET TABLE (TSEASET)                 04350000
001304******************************************************************04360000
001305     EXEC SQL                                                     04370000
001306         INCLUDE TSEASET                                          04380000
001307     END-EXEC.                                                    04390000
001308                                                                  04400000
001309******************************************************************04410000
001310*  DB2 DECLARATION - SEASONAL SET TABLE (TKRPRPM)                 04420000
001311******************************************************************04430000
001312     EXEC SQL                                                     04440000
001313         INCLUDE TKRPRPM                                          04450000
001314     END-EXEC.                                                    04460000
001315                                                                  04470000
001316******************************************************************04480000
001317*  DB2 DECLARATION - DB2 DUMMY SYSTEM TABLE (SYSIBM.SYSDUMMY1)    04490000
001318******************************************************************04500000
001319     EXEC SQL                                                     04510000
001320         INCLUDE SYSDUMMY                                         04520000
001321     END-EXEC.                                                    04530000
001322                                                                  04540000
001323******************************************************************04550000
001324* COBOL CURSOR DECLARATION TO LIST ALL CARTONS FOR AN AUDIT      *04560000
001325* THIS CURSOR WILL BRING BACK ALL CARTON FOR THIS                *04570000
001326* DC-AUDIT CONTROL NUMBER THAT HAVE NOT ALREADY BEEN RELEASED    *04580000
001327* THE SUBSELECT CONTAINS THE RELEASED CARTONS.                   *04590000
001328******************************************************************04600000
001329     EXEC SQL                                                     04610000
001330         DECLARE AUD_CNTL_CART_LST CURSOR FOR                     04620000
001331          SELECT DISTINCT A.BRCDE_NBR                             04630000
001332                        , A.SHIPT_UNT_ID                          04640000
001333            FROM SUT_CART_DIRV_TRKG A                             04650000
001334           WHERE  A.OPER_UNT_ID    = :DK-OPER-UNT-ID              04660000
001335             AND  A.AUD_CNTL_NBR   = :DK-AUD-CNTL-NBR             04670000
001336             AND  NOT EXISTS                                      04680000
001337                 (SELECT B.BRCDE_NBR                              04690000
001338                    FROM SUT_CART_DIRV_TRKG B                     04700000
001339             WHERE  B.DIRV_RSN_CDE IN ('RLC', 'RLO', 'RLR','RFD') 04710004
001340                     AND  B.OPER_UNT_ID    = :DK-OPER-UNT-ID      04720000
001341                     AND  B.AUD_CNTL_NBR   = :DK-AUD-CNTL-NBR     04730000
001342                     AND  A.BRCDE_NBR      =  B.BRCDE_NBR         04740000
001343                 )                                                04750000
001344     END-EXEC.                                                    04760000
001345                                                                  04770000
001346******************************************************************04780000
001347* COBOL CURSOR DECLARATION TO LIST ALL CARTONS FOR A PO/RCVR.    *04790000
001348* THIS CURSOR WILL BRING BACK ALL CARTON FOR THIS                *04800000
001349* DC-PO-RECEIVER                                                 *04810000
001350* THAT HAVE NOT ALREADY BEEN RELEASED                            *04820000
001351* THE SUBSELECT CONTAINS THE RELEASED CARTONS.                   *04830000
001352******************************************************************04840000
001353     EXEC SQL                                                     04850000
001354         DECLARE PO_RCVR_CART_LST CURSOR FOR                      04860000
001355          SELECT DISTINCT A.BRCDE_NBR                             04870000
001356                         ,A.SHIPT_UNT_ID                          04880000
001357            FROM SUT_CART_DIRV_TRKG A                             04890000
001358           WHERE  A.OPER_UNT_ID    = :DK-OPER-UNT-ID              04900000
001359             AND  A.PO_NBR         = :DK-PO-NBR                   04910000
001360             AND  A.RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR             04920000
001370             AND  NOT EXISTS                                      04930000
001380                 (SELECT B.BRCDE_NBR                              04940000
001390                    FROM SUT_CART_DIRV_TRKG B                     04950000
001391               WHERE B.DIRV_RSN_CDE IN ('RLC', 'RLO', 'RLR','RFD')04960004
001392                     AND B.OPER_UNT_ID    = :DK-OPER-UNT-ID       04970000
001393                     AND B.PO_NBR         = :DK-PO-NBR            04980000
001394                     AND B.RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR      04990000
001395                     AND A.BRCDE_NBR      =  B.BRCDE_NBR          05000000
001396                 )                                                05010000
001397     END-EXEC.                                                    05020000
001398                                                                  05030000
001399******************************************************************05040000
001400* COBOL CURSOR DECLARATION TO LIST ALL CARTONS FOR A PO/RCVR/LINE*05050000
001401* DC-PO-RECEIVER-LINE                                            *05060000
001402* THAT HAVE NOT ALREADY BEEN RELEASED                            *05070000
001403* THE SUBSELECT CONTAINS THE RELEASED CARTONS.                   *05080000
001404******************************************************************05090000
001405     EXEC SQL                                                     05100000
001406         DECLARE PO_RCVR_LNE_CART_LST CURSOR FOR                  05110000
001407          SELECT DISTINCT A.BRCDE_NBR                             05120000
001408                         ,A.SHIPT_UNT_ID                          05130000
001409            FROM SUT_CART_DIRV_TRKG A                             05140000
001410           WHERE  A.OPER_UNT_ID    = :DK-OPER-UNT-ID              05150000
001420             AND  A.PO_NBR         = :DK-PO-NBR                   05160000
001421             AND  A.RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR             05170000
001422             AND  A.PO_LNE_NBR     = :DK-PO-LNE-NBR               05180000
001423             AND  NOT EXISTS                                      05190000
001424                 (SELECT B.BRCDE_NBR                              05200000
001425                    FROM SUT_CART_DIRV_TRKG B                     05210000
001426              WHERE B.DIRV_RSN_CDE IN ('RLC', 'RLO', 'RLR','RFD') 05220004
001427                     AND B.OPER_UNT_ID    = :DK-OPER-UNT-ID       05230000
001428                     AND B.PO_NBR         = :DK-PO-NBR            05240000
001429                     AND B.RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR      05250000
001430                     AND B.PO_LNE_NBR     = :DK-PO-LNE-NBR        05260000
001431                     AND A.BRCDE_NBR      =  B.BRCDE_NBR          05270000
001432                 )                                                05280000
001433     END-EXEC.                                                    05290000
001434                                                                  05300000
001435******************************************************************05310000
001436* COBOL CURSOR DECLARATION TO LIST ALL CARTONS FOR A             *05320000
001437* DC-PO-RECEIVER-PREPACK                                         *05330000
001438* THAT HAVE NOT ALREADY BEEN RELEASED                            *05340000
001439* THE SUBSELECT CONTAINS THE RELEASED CARTONS.                   *05350000
001440******************************************************************05360000
001441     EXEC SQL                                                     05370000
001442         DECLARE PO_RCVR_PREPK_CART_LST CURSOR FOR                05380000
001443          SELECT DISTINCT A.BRCDE_NBR                             05390000
001444                         ,A.SHIPT_UNT_ID                          05400000
001445            FROM SUT_CART_DIRV_TRKG A                             05410000
001446           WHERE  A.OPER_UNT_ID    = :DK-OPER-UNT-ID              05420000
001447             AND  A.PO_NBR         = :DK-PO-NBR                   05430000
001448             AND  A.RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR             05440000
001449             AND  A.PREPK_ID       = :DK-PREPK-ID                 05450000
001450             AND  NOT EXISTS                                      05460000
001451                 (SELECT B.BRCDE_NBR                              05470000
001452                    FROM SUT_CART_DIRV_TRKG B                     05480000
001453              WHERE B.DIRV_RSN_CDE IN ('RLC', 'RLO', 'RLR','RFD') 05490004
001454                     AND B.OPER_UNT_ID    = :DK-OPER-UNT-ID       05500000
001455                     AND B.PO_NBR         = :DK-PO-NBR            05510000
001456                     AND B.RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR      05520000
001457                     AND B.PREPK_ID       = :DK-PREPK-ID          05530000
001458                     AND A.BRCDE_NBR      =  B.BRCDE_NBR          05540000
001459                 )                                                05550000
001460     END-EXEC.                                                    05560000
001461                                                                  05570000
001462****************************************************************  05580000
001463**                                                            **  05590000
001464**     M Q   S E R I E S    W O R K I N G   S T O R A G E     **  05600000
001465**                                                            **  05610000
001466**                  M  Q    C O P Y B O O K S                 **  05620000
001467**                                                            **  05630000
001468****************************************************************  05640000
001469 01  MQM-OBJECT-DESCRIPTOR.                                       05650000
001470     COPY CMQODV.                                                 05660000
001471                                                                  05670000
001472 01  MQM-MESSAGE-DESCRIPTOR.                                      05680000
001473     COPY CMQMDV.                                                 05690000
001474                                                                  05700000
001475 01  MQM-PUT-MESSAGE-OPTIONS.                                     05710000
001476     COPY CMQPMOV.                                                05720000
001477                                                                  05730000
001478 01  MQM-GET-MESSAGE-OPTIONS.                                     05740000
001479     COPY CMQGMOV.                                                05750000
001480                                                                  05760000
001490 01  MQM-CONSTANTS.                                               05770000
001491     COPY CMQV.                                                   05780000
001492                                                                  05790000
001493****************************************************************  05800000
001494** CONTROL CARDS FOR QUEUE MANAGER AND QUEUE NAME                 05810000
001495****************************************************************  05820000
001496 01  CC-CONTROL-CARD-1.                                           05830000
001497     05  CC-QMGR-NAME-REMOTE         PIC X(50).                   05840000
001498                                                                  05850000
001499 01  CC-CONTROL-CARD-2.                                           05860000
001500     05  CC-TRANS-QUEUE-NAME         PIC X(50).                   05870000
001510                                                                  05880000
001520 01  CC-CONTROL-CARD-3.                                           05890000
001530     05  CC-DC-NBR                   PIC S9(9) COMP.              05900000
001540                                                                  05910000
001550 01  CC-CONTROL-CARD-4.                                           05920000
001560     05  CC-QMGR-NAME                PIC X(50).                   05930000
001570                                                                  05940000
1023RM****************************************************************  05950027
1023RM** CONTROL CARDS FOR DIRECTIVE QUEUE MANAGER AND QUEUE NAME       05960027
1023RM****************************************************************  05970027
1023RM 01  CC-DRTV-CONTROL-CARD-1.                                      05980027
1023RM     05  CC-DRTV-QMGR-NAME-REMOTE         PIC X(50).              05990027
1023RM                                                                  06000027
1023RM 01  CC-DRTV-CONTROL-CARD-2.                                      06010027
1023RM     05  CC-DRTV-TRANS-QUEUE-NAME         PIC X(50).              06020027
1023RM                                                                  06030027
1023RM 01  CC-DRTV-CONTROL-CARD-3.                                      06040027
1023RM     05  CC-DRTV-DC-NBR                   PIC S9(9) COMP.         06050027
1023RM                                                                  06060027
1023RM 01  CC-DRTV-CONTROL-CARD-4.                                      06070027
1023RM     05  CC-DRTV-QMGR-NAME                PIC X(50).              06080027
001570                                                                  06090027
001580****************************************************************  06100000
001590** MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS GET AND    **  06110000
001591*  OPEN, CONNECT, DISCONNECT.                                     06120000
001592****************************************************************  06130000
001593 01  MQ-WORKING-STORAGE.                                          06140000
001594     05  PC-MQCONN-BATCH             PIC X(08) VALUE 'CSQBCONN'.  06150000
001595     05  PC-MQOPEN-BATCH             PIC X(08) VALUE 'CSQBOPEN'.  06160000
001596     05  PC-MQPUT-BATCH              PIC X(08) VALUE 'CSQBPUT'.   06170000
001597     05  PC-MQCMIT-BATCH             PIC X(08) VALUE 'CSQBCOMM'.  06180000
001598     05  PC-MQBACK-BATCH             PIC X(08) VALUE 'CSQBBACK'.  06190000
001599     05  PC-MQCLOSE-BATCH            PIC X(08) VALUE 'CSQBCLOS'.  06200000
001600     05  PC-MQDISC-BATCH             PIC X(08) VALUE 'CSQBDISC'.  06210000
001610     05  PC-MQCONN-ONLINE            PIC X(08) VALUE 'CSQCCONN'.  06220000
001620     05  PC-MQOPEN-ONLINE            PIC X(08) VALUE 'CSQCOPEN'.  06230000
001630     05  PC-MQPUT-ONLINE             PIC X(08) VALUE 'CSQCPUT'.   06240000
001640     05  PC-MQCMIT-ONLINE            PIC X(08) VALUE 'CSQCCOMM'.  06250000
001650     05  PC-MQBACK-ONLINE            PIC X(08) VALUE 'CSQCBACK'.  06260000
001660     05  PC-MQCLOSE-ONLINE           PIC X(08) VALUE 'CSQCCLOS'.  06270000
001670     05  PC-MQDISC-ONLINE            PIC X(08) VALUE 'CSQCDISC'.  06280000
001680     05  PC-QMGR-NAME                PIC X(04) VALUE SPACES.      06290000
001690         88  PC-PROD-QMGR-NAME                 VALUE 'QKSP'.      06300000
001691         88  PC-ACCEPT-QMGR-NAME               VALUE 'QKSQ'.      06310000
001692         88  PC-TEST-QMGR-NAME                 VALUE 'QKST'.      06320000
001693     05  PC-TRANS-QNAME              PIC X(48) VALUE SPACES.      06330000
1023RM     05  PC-TRANS-DRCTV-QNAME        PIC X(48) VALUE SPACES.      06340028
001694                                                                  06350000
001695****************************************************************  06360000
001696** QUEUE MANAGER HANDLE                                           06370000
001697*  QUEUE HANDLE                                                   06380000
001698****************************************************************  06390000
001699 01 PV-MQ-PROGRAM-HANDLES.                                        06400000
001700     05  PV-QM-NAME                  PIC X(48).                   06410000
1023RM     05  PV-DRTV-QM-NAME             PIC X(48).                   06420027
001710     05  PV-QM-NAME-REMOTE           PIC X(48).                   06430000
1023RM     05  PV-DRTV-QM-NAME-REMOTE      PIC X(48).                   06440028
001720     05  PV-HCONN                    PIC S9(9) BINARY VALUE 0.    06450000
001730     05  PV-PQ-HANDLE                PIC S9(9) BINARY VALUE 0.    06460000
1023RM     05  PV-DRTV-HANDLE              PIC S9(9) BINARY VALUE 0.    06470028
001740                                                                  06480000
001750****************************************************************  06490000
001760* ERROR PROCESSING VARIABLES                                      06500000
001770* CODES FROM CALLS ARE STORED HERE                                06510000
001780****************************************************************  06520000
001790 01 PV-MQ-PROGRAM-VARIABLES.                                      06530000
001791     05  PV-COMPLETION-CODE          PIC S9(9) BINARY.            06540000
001792     05  PV-REASON                   PIC S9(9) BINARY.            06550000
001793     05  PV-CON-REASON               PIC S9(9) BINARY.            06560000
001794     05  PV-MQCHECK                  PIC X(08) VALUE 'MQR2C'.     06570000
001795     05  PV-ERROR-MESSAGE            PIC X(48) VALUE SPACES.      06580000
001796     05  PV-OPEN-OPTIONS             PIC S9(9) BINARY.            06590000
001797     05  PV-MQCONN                   PIC X(08) VALUE SPACES.      06600000
001798     05  PV-MQOPEN                   PIC X(08) VALUE SPACES.      06610000
001799     05  PV-MQPUT                    PIC X(08) VALUE SPACES.      06620000
001800     05  PV-MQCMIT                   PIC X(08) VALUE SPACES.      06630000
001810     05  PV-MQBACK                   PIC X(08) VALUE SPACES.      06640000
001820     05  PV-MQCLOSE                  PIC X(08) VALUE SPACES.      06650000
001830     05  PV-MQDISC                   PIC X(08) VALUE SPACES.      06660000
001840     05  PV-MQ-REASON-TEXT           PIC X(30) VALUE SPACES.      06670000
001850     05  PV-MQ-OUTPUT-RECORD         PIC X(999999) VALUE SPACES.  06680000
001860                                                                  06690000
001870****************************************************************  06700000
001871* RETURN CODES ARE EVALUATED AND THIS SWITCH IS USED TO           06710000
001872* INDICATE ANY ERRORS (FROM WHAT I'VE SEEN THIS SWITCH IS         06720000
001873* USELESS SINCE THE PROGRAM ABENDS BEFORE IT IS USED ANYWHERE) *  06730000
001874****************************************************************  06740000
001875 01 PV-MQ-PROGRAM-SWITCHES.                                       06750000
001876     05  PS-MQ-ERROR-SW              PIC X(01) VALUE 'N'.         06760000
001877         88  PS-NO-MQ-ERROR                    VALUE 'N'.         06770000
001878         88  PS-MQ-ERROR                       VALUE 'Y'.         06780000
001879****************************************************************  06790000
001880**                     E N D   O F   M Q                      **  06800000
001890****************************************************************  06810000
001891                                                                  06820000
001892 LINKAGE SECTION.                                                 06830000
001893     COPY SUWS090.                                                06840000
001894/                                                                 06850000
001895***************************************************************   06860000
001896 PROCEDURE DIVISION USING SU090-DG-REQUEST-COMMAREA.              06870000
001897***************************************************************   06880000
001898 0000-MAINLINE.                                                   06890000
001920                                                                  06900000
**TEMP     DISPLAY 'SUKUT129 START '.                                   06910034
001974     SET SU090-SUCCESS TO TRUE.                                   06920000
001975     PERFORM 1000-INITIALIZE.                                     06930000
001976                                                                  06940000
001977     IF  SU090-SUCCESS                                            06950000
001978         EVALUATE TRUE                                            06960000
001980           WHEN SU090-CARTON-DIRECTIVE                            06970000
001990             PERFORM 2000-CARTON-DIRECTIVE                        06980000
002000           WHEN SU090-AUDIT-GROUP-DIRECTIVE                       06990000
002001             PERFORM 3000-AUDIT-GROUP-DIRECTIVE                   07000000
002002           WHEN SU090-PO-RCVR-DIRECTIVE                           07010000
002003             PERFORM 3500-PO-RCVR-DIRECTIVE                       07020000
002004           WHEN SU090-PO-RCVR-LINE-DIRECTIVE                      07030000
002005             PERFORM 4000-PO-RCVR-LINE-DIRECTIVE                  07040000
002006           WHEN SU090-PO-RCVR-PACK-DIRECTIVE                      07050000
002007             PERFORM 4500-PO-RCVR-PACK-DIRECTIVE                  07060000
002008         END-EVALUATE                                             07070000
002009     END-IF.                                                      07080000
002010                                                                  07090000
002011*COMMIT DB2 DATA AND MQ DATA.                                     07100000
002012**** IF  SU090-SUCCESS                                            07110000
002013****     PERFORM 2200-DB2-COMMIT                                  07120000
002014****     PERFORM 2300-MQ-COMMIT                                   07130000
002015**** END-IF.                                                      07140000
002016                                                                  07150000
002017*CLOSE THE TRANSACTION QUEUE.                                     07160000
002018     IF PS-MQOPEN-SUCCESSFUL                                      07170028
002019         PERFORM 1700-MQ-QUEUE-CLOSE                              07180028
002020     END-IF.                                                      07190000
002021                                                                  07200000
1023RM     IF  SU090-SUCCESS                                            07210032
1023RM         IF PS-ADDL-DRTVMSGQ-YES                                  07220032
1023RM             PERFORM 1750-CLOSE-DRCTV-QUEUE                       07230032
002020         END-IF                                                   07240032
002020     END-IF.                                                      07250032
002022*DISCONNECT FROM THE QMGR.                                        07260000
002023     IF  PS-MQCONN-SUCCESSFUL                                     07270000
002024         IF SU090-QMNGR-CONNECTED-YES                             07280000
002025            CONTINUE                                              07290000
002026         ELSE                                                     07300000
002027             PERFORM 1800-DISCONNECT-QMGR                         07310000
002028         END-IF                                                   07320000
002029     END-IF.                                                      07330000
002033* END OF JOB ROUTINE.                                             07340003
002037                                                                  07350003
002038     GOBACK.                                                      07360003
002039                                                                  07370003
002040******************************************************************07380003
002041*                                                                *07390003
002042*           1 0 0 0 - I N I T I A L I Z A T I O N                *07400003
002043*                                                                *07410003
002044******************************************************************07420003
002045 1000-INITIALIZE.                                                 07430003
002046                                                                  07440003
002055     PERFORM 1200-LOGL-LOC-NAME.                                  07450003
                                                                        07460025
      *** ADDIONAL SELECT FOR NEW DIRECTIVE CONVERSION QUEUE            07470028
1023RM     SET PS-ADDL-DRTVMSGQ-NO TO TRUE.                             07480027
1023RM     PERFORM 1250-SELECT-DRCTV-INFO.                              07490028
002056                                                                  07500003
002060*SET MQ CALL VARIABLES BASED ON IF THIS IS CALLED FROM BATCH OR   07510000
002070*CICS.                                                            07520000
002080     IF  SU090-SUCCESS                                            07530000
002090         IF  SU090-BATCH                                          07540000
002100             SET PS-BATCH-CALL      TO TRUE                       07550000
002110             MOVE PC-MQCONN-BATCH   TO PV-MQCONN                  07560000
002120             MOVE PC-MQOPEN-BATCH   TO PV-MQOPEN                  07570000
002130             MOVE PC-MQPUT-BATCH    TO PV-MQPUT                   07580000
002131             MOVE PC-MQCMIT-BATCH   TO PV-MQCMIT                  07590000
002132             MOVE PC-MQBACK-BATCH   TO PV-MQBACK                  07600000
002133             MOVE PC-MQCLOSE-BATCH  TO PV-MQCLOSE                 07610000
002134             MOVE PC-MQDISC-BATCH   TO PV-MQDISC                  07620000
002135         ELSE                                                     07630000
002136             SET PS-ONLINE-CALL     TO TRUE                       07640000
002137             MOVE PC-MQCONN-ONLINE  TO PV-MQCONN                  07650000
002138             MOVE PC-MQOPEN-ONLINE  TO PV-MQOPEN                  07660000
002139             MOVE PC-MQPUT-ONLINE   TO PV-MQPUT                   07670000
002140             MOVE PC-MQCMIT-ONLINE  TO PV-MQCMIT                  07680000
002141             MOVE PC-MQBACK-ONLINE  TO PV-MQBACK                  07690000
002142             MOVE PC-MQCLOSE-ONLINE TO PV-MQCLOSE                 07700000
002143             MOVE PC-MQDISC-ONLINE  TO PV-MQDISC                  07710000
002144         END-IF                                                   07720000
002145     END-IF.                                                      07730000
002146                                                                  07740000
002147*READ MQ CONTROL CARDS.                                           07750000
002148     IF  SU090-SUCCESS                                            07760000
002149         PERFORM 1400-GET-MQ-QUEUE-INFO                           07770000
002150     END-IF.                                                      07780000
                                                                        07790027
1023RM**GET ADDITIONAL DIRECTIVE QUEUE                                  07800027
1023RM     IF  SU090-SUCCESS                                            07810027
1023RM         IF PS-ADDL-DRTVMSGQ-YES                                  07820027
1023RM            PERFORM 1450-GET-ADDL-QUEUE-INFO                      07830028
1023RM         END-IF                                                   07840027
1023RM     END-IF.                                                      07850027
002151                                                                  07860000
002152     INITIALIZE PS-MQCONN-SUCCESSFUL-IND                          07870000
002153                PS-MQOPEN-SUCCESSFUL-IND                          07880027
1023RM                PS-DRCTV-MQOPEN-SUCCESSFUL-IND.                   07890027
002154                                                                  07900000
002155*CONNECT TO QUEUE MANAGER                                         07910000
002156     IF  SU090-SUCCESS                                            07920000
002157         PERFORM 1500-MQ-CONNECT-TO-QMGR                          07930000
002158     END-IF.                                                      07940000
002159                                                                  07950000
002160*OPEN THE QUEUE FOR PUTS                                          07960000
002161     IF  SU090-SUCCESS                                            07970000
002162         PERFORM 1600-MQ-QUEUE-OPEN                               07980000
002163     END-IF.                                                      07990000
                                                                        08000025
002160*OPEN THE DIRECTIVE QUEUE FOR PUTS                                08010032
1023RM     IF  SU090-SUCCESS                                            08020032
1023RM         IF PS-ADDL-DRTVMSGQ-YES                                  08030032
1023RM             PERFORM 1650-OPEN-DRCTV-QUEUE                        08040032
1023RM         END-IF                                                   08050032
1023RM     END-IF.                                                      08060032
002164                                                                  08070000
002693******************************************************************08080000
002694* FETCH LOGICAL LOCATION NAME AND MULTIPLE USE INDICATOR          08090000
002695******************************************************************08100000
002696 1200-LOGL-LOC-NAME.                                              08110000
002697                                                                  08120000
002698     MOVE SU090-DIRV-RSN-CDE TO DK-DIRV-RSN-CDE.                  08130000
002699     MOVE SU090-OPER-UNT-ID  TO DK-OPER-UNT-ID.                   08140000
002700                                                                  08150000
002701     EXEC SQL                                                     08160000
002702         SELECT E.ATTR_ELEM_TXT AS LOGICAL_DEST                   08170000
002703              , I.ATTR_ELEM_TXT AS UNIQUE_IND                     08180000
002704              , INTEGER(L.ATTR_ELEM_NBR) AS PRIORITY_IND          08190000
002705           INTO :PV-LGCL-LOC-NM-HOLD                              08200000
002706              , :PV-MLT-USE-CDE                                   08210000
002707              , :PV-PRIORITY-IND                                  08220000
002708           FROM WST_INTGRTN_TYP A                                 08230000
002709              , WST_ATTR_DEFN   B                                 08240000
002710              , WST_ATTR_ELEM   C                                 08250000
002711              , WST_ATTR_ELEM   D                                 08260000
002712              , WST_ATTR_ELEM   E                                 08270000
002713              , WST_ATTR_ELEM   F                                 08280000
002714              , WST_ATTR_ELEM   G                                 08290000
002715              , WST_ATTR_ELEM   H                                 08300000
002716              , WST_ATTR_ELEM   I                                 08310000
002717              , WST_ATTR_ELEM   J                                 08320000
002718              , WST_ATTR_ELEM   K                                 08330000
002719              , WST_ATTR_ELEM   L                                 08340000
002720          WHERE A.INTGRTN_TYP_CDE    =  'ACAULGDST'               08350000
002721            AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE         08360000
002722            AND A.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE         08370000
002723            AND A.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE         08380000
002724            AND A.INTGRTN_TYP_CDE    =  E.INTGRTN_TYP_CDE         08390000
002725            AND A.INTGRTN_TYP_CDE    =  F.INTGRTN_TYP_CDE         08400000
002726            AND A.INTGRTN_TYP_CDE    =  G.INTGRTN_TYP_CDE         08410000
002727            AND A.INTGRTN_TYP_CDE    =  H.INTGRTN_TYP_CDE         08420000
002728            AND A.INTGRTN_TYP_CDE    =  I.INTGRTN_TYP_CDE         08430000
002729            AND A.INTGRTN_TYP_CDE    =  J.INTGRTN_TYP_CDE         08440000
002730            AND A.INTGRTN_TYP_CDE    =  K.INTGRTN_TYP_CDE         08450000
002731            AND A.INTGRTN_TYP_CDE    =  L.INTGRTN_TYP_CDE         08460000
002732            AND B.ATTR_DEFN_SEQ_NBR  =  1                         08470000
002733            AND C.ATTR_DEFN_SEQ_NBR  =  1                         08480000
002734            AND D.ATTR_DEFN_SEQ_NBR  =  2                         08490000
002735            AND E.ATTR_DEFN_SEQ_NBR  =  3                         08500000
002736            AND F.ATTR_DEFN_SEQ_NBR  =  4                         08510000
002737            AND G.ATTR_DEFN_SEQ_NBR  =  5                         08520000
002738            AND H.ATTR_DEFN_SEQ_NBR  =  6                         08530000
002739            AND I.ATTR_DEFN_SEQ_NBR  =  7                         08540000
002740            AND J.ATTR_DEFN_SEQ_NBR  =  8                         08550000
002741            AND K.ATTR_DEFN_SEQ_NBR  =  9                         08560000
002742            AND L.ATTR_DEFN_SEQ_NBR  =  10                        08570000
002743            AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR       08580000
002744            AND C.ATTR_ELEM_SEQ_NBR  =  E.ATTR_ELEM_SEQ_NBR       08590000
002745            AND C.ATTR_ELEM_SEQ_NBR  =  F.ATTR_ELEM_SEQ_NBR       08600000
002746            AND C.ATTR_ELEM_SEQ_NBR  =  G.ATTR_ELEM_SEQ_NBR       08610000
002747            AND C.ATTR_ELEM_SEQ_NBR  =  H.ATTR_ELEM_SEQ_NBR       08620000
002748            AND C.ATTR_ELEM_SEQ_NBR  =  I.ATTR_ELEM_SEQ_NBR       08630000
002749            AND C.ATTR_ELEM_SEQ_NBR  =  J.ATTR_ELEM_SEQ_NBR       08640000
002750            AND C.ATTR_ELEM_SEQ_NBR  =  K.ATTR_ELEM_SEQ_NBR       08650000
002751            AND C.ATTR_ELEM_SEQ_NBR  =  L.ATTR_ELEM_SEQ_NBR       08660000
002752            AND F.ATTR_ELEM_TXT      =  'Y'                       08670000
002753            AND G.ATTR_ELEM_TMST    <=  CURRENT TIMESTAMP         08680000
002754            AND H.ATTR_ELEM_TMST    >=  CURRENT TIMESTAMP         08690000
002755            AND C.ATTR_ELEM_NBR      =  :DK-OPER-UNT-ID           08700000
002756            AND D.ATTR_ELEM_TXT      =  :DK-DIRV-RSN-CDE          08710000
002757     END-EXEC                                                     08720000
002758                                                                  08730000
002759     EVALUATE TRUE                                                08740000
002760       WHEN SQLCODE = ZERO                                        08750000
002761           CONTINUE                                               08760000
002762                                                                  08770000
002763       WHEN SQLWARN0 NOT EQUAL SPACE                              08780000
002764       WHEN SQLCODE NOT EQUAL ZERO                                08790000
002765           SET SU090-DB2-ERROR       TO TRUE                      08800000
002766           MOVE SQLCODE              TO SU090-SQLCODE             08810000
002767           MOVE SQLCA                TO SU090-SQLCA               08820000
002768           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         08830000
002769           MOVE '1200-LOGL-LOC-NAME' TO PV-ABEND-PARAGRAPH        08840000
002770                                        SU090-ERR-PARAGRAPH       08850000
002771           MOVE 'FETCH LGCL LOC NAME, PRIORITY, AND MULTI USE IND'08860000
002772                                     TO PV-ABEND-OPER-MESSAGE-1   08870000
002773           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          08880000
002774           STRING 'OPER UNT ID: '    DELIMITED BY SIZE            08890000
002775                  PV-OPER-UNT-ID-DISP                             08900000
002776                                     DELIMITED BY SIZE            08910000
002777                  '  DIRV RSN CDE: ' DELIMITED BY SIZE            08920000
002778                  DK-DIRV-RSN-CDE    DELIMITED BY SIZE            08930000
002779                                   INTO PV-ABEND-OPER-MESSAGE-2   08940000
002780           MOVE 'WST_INTGRTN_TYP'    TO PV-ABEND-TABLE-1          08950000
002781           MOVE 'WST_ATTR_DEFN'      TO PV-ABEND-TABLE-2          08960000
002782           MOVE 'WST_ATTR_ELEM'      TO PV-ABEND-TABLE-3          08970000
002783           PERFORM 9900-DB2-ERROR                                 08980000
002784     END-EVALUATE.                                                08990000
002785                                                                  09000000
1023RM****************************************************************  09010027
1023RM**  DETERMINE IF DC HAS AN ADDITIONAL DIRECTIVE QUEUE             09020027
1023RM****************************************************************  09030027
1023RM 1250-SELECT-DRCTV-INFO.                                          09040028
**TEMP*    DISPLAY ' SUKUT129 - 1250- BEGIN'                            09050039
1023RM                                                                  09060027
1023RM     EXEC SQL                                                     09070029
1023RM         SELECT FUNC_TXT                                          09080034
1023RM             INTO :KRPRPM-FUNC-TXT                                09090034
1023RM           FROM TKRPRPM                                           09100029
1023RM         WHERE LOC_ID = :DK-OPER-UNT-ID                           09110029
1023RM           AND INTFC_SYS_CDE = 'KHL'                              09120029
1023RM           AND SYS_PRC_FUNC_CDE = 'DRVMLQ'                        09130029
1023RM           AND FUNC_PRC_STAT_CDE = 'AC'                           09140034
1023RM       END-EXEC                                                   09150029
1023RM                                                                  09160027
1023RM     EVALUATE TRUE                                                09170027
1023RM       WHEN SQLCODE = ZERO                                        09180027
1023RM         IF KRPRPM-FUNC-TXT = 'Y'                                 09190034
**TEMP*         DISPLAY ' SUKUT129 - 1250- DIRECTIVE ON'                09200039
1023RM            SET PS-ADDL-DRTVMSGQ-YES TO TRUE                      09210034
1023RM         END-IF                                                   09220034
1023RM       WHEN SQLCODE = +100                                        09230027
1023RM           CONTINUE                                               09240027
1023RM       WHEN SQLWARN0 NOT EQUAL SPACE                              09250027
1023RM       WHEN SQLCODE NOT EQUAL ZERO                                09260027
1023RM           SET SU090-DB2-ERROR       TO TRUE                      09270027
1023RM           MOVE SQLCODE              TO SU090-SQLCODE             09280027
1023RM           MOVE SQLCA                TO SU090-SQLCA               09290027
1023RM           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         09300027
1023RM           MOVE '1250-SELECT-ADDL-LOC-INFO' TO PV-ABEND-PARAGRAPH 09310027
1023RM                                        SU090-ERR-PARAGRAPH       09320027
1023RM           MOVE 'FETCH TKRPRPM INFO' TO PV-ABEND-OPER-MESSAGE-1   09330027
1023RM           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          09340027
1023RM           STRING 'OPER UNT ID: '    DELIMITED BY SIZE            09350027
1023RM                  PV-OPER-UNT-ID-DISP                             09360027
1023RM                                     DELIMITED BY SIZE            09370027
1023RM                                   INTO PV-ABEND-OPER-MESSAGE-2   09380027
1023RM           MOVE 'TKRPRPM'            TO PV-ABEND-TABLE-1          09390027
1023RM           PERFORM 9900-DB2-ERROR                                 09400027
1023RM     END-EVALUATE.                                                09410027
002786****************************************************************  09420000
002787* GET MQ INFORMATION FROM DB2 TABLES.                             09430000
002788****************************************************************  09440000
002789 1400-GET-MQ-QUEUE-INFO.                                          09450000
002790                                                                  09460000
002791     EXEC SQL                                                     09470000
002792        SELECT A.INTGRTN_TYP_DESC                                 09480000
002793             , A.LCL_QUE_MGR                                      09490000
002794             , A.RMT_QUE_MGR                                      09500000
002795             , A.QUE_NM                                           09510000
002796             , A.DC_NBR                                           09520000
002797          INTO :WSV00005-INTGRTN-TYP-DESC                         09530000
002798             , :WSV00005-LCL-QUE-MGR                              09540000
002799             , :WSV00005-RMT-QUE-MGR                              09550000
002800             , :WSV00005-QUE-NM                                   09560000
002801             , :WSV00005-DC-NBR                                   09570000
002802          FROM WSV_PRVDR_QUE A                                    09580000
002803         WHERE A.APPL_FUNC_DESC    = 'QUEUE'                      09590000
002804           AND A.INTGRTN_TYP_CDE   = 'DRTVMSGQ'                   09600000
002805* JAK ADD DC TO SELECT                                            09610000
002806           AND A.DC_NBR            = :DK-OPER-UNT-ID              09620000
002807     END-EXEC.                                                    09630000
002808                                                                  09640000
002809     EVALUATE TRUE                                                09650000
002810       WHEN SQLCODE = ZERO                                        09660000
002811           MOVE WSV00005-LCL-QUE-MGR-TEXT                         09670000
002812                                     TO CC-QMGR-NAME              09680000
002813           MOVE WSV00005-RMT-QUE-MGR-TEXT                         09690000
002814                                     TO CC-QMGR-NAME-REMOTE       09700000
002815           MOVE WSV00005-QUE-NM-TEXT TO CC-TRANS-QUEUE-NAME       09710000
002816           MOVE WSV00005-DC-NBR      TO CC-DC-NBR                 09720000
002817                                                                  09730000
002818           MOVE CC-DC-NBR TO PV-DC-NBR                            09740000
002819           IF  SU090-BATCH                                        09750000
002820              DISPLAY 'CC1 (REMOTE MANAGER): ' CC-QMGR-NAME-REMOTE09760000
002821              DISPLAY 'CC2 (QUEUE NAME)    : ' CC-TRANS-QUEUE-NAME09770000
002822              DISPLAY 'CC3 (DC NUMBER)     : ' PV-DC-NBR          09780000
002823              DISPLAY 'CC4 (QUEUE MANAGER) : ' CC-QMGR-NAME       09790000
002824           END-IF                                                 09800000
002825                                                                  09810000
002826       WHEN OTHER                                                 09820000
002827           SET SU090-DB2-ERROR          TO TRUE                   09830000
002828           MOVE SQLCODE                 TO SU090-SQLCODE          09840000
002829           MOVE SQLCA                   TO SU090-SQLCA            09850000
002830           MOVE PV-ABEND-PROGRAM        TO SU090-ERR-PROGRAM      09860000
002831           MOVE '1400-GET-MQ-QUEUE-INFO'                          09870000
002832                                        TO PV-ABEND-PARAGRAPH     09880000
002833                                           SU090-ERR-PARAGRAPH    09890000
002834           MOVE 'SELECT MQ INFO'        TO PV-ABEND-OPER-MESSAGE-109900000
002835           STRING 'APPL FUNC DESC: ' DELIMITED BY SIZE            09910000
002836                  'QUEUE'            DELIMITED BY SIZE            09920000
002837                  '  INTGRTN TYP CDE: '                           09930000
002838                                     DELIMITED BY SIZE            09940000
002839                  'DRTVMSGQ'         DELIMITED BY SIZE            09950000
002840                                   INTO PV-ABEND-OPER-MESSAGE-2   09960000
002841           MOVE 'WSV_PRVDR_QUE'      TO PV-ABEND-TABLE-1          09970000
002842           PERFORM 9900-DB2-ERROR                                 09980000
002843     END-EVALUATE.                                                09990000
002844                                                                  10000000
1023RM****************************************************************  10010027
1023RM**  RETRIEVE ADDITIONAL QUEUE INFO FOR DIRECTIVE CONVERSION       10020027
1023RM****************************************************************  10030027
1023RM 1450-GET-ADDL-QUEUE-INFO.                                        10040027
1923RM                                                                  10050027
**TEMP*    DISPLAY 'SUKUT129 - 1450-GET-ADDL-QUEUE-INFO '.              10060039
1023RM     EXEC SQL                                                     10070027
1023RM        SELECT A.INTGRTN_TYP_DESC                                 10080027
1023RM             , A.LCL_QUE_MGR                                      10090027
1023RM             , A.RMT_QUE_MGR                                      10100027
1023RM             , A.QUE_NM                                           10110027
1023RM             , A.DC_NBR                                           10120027
1023RM         INTO  :PV-DRTV-INTGRTN-TYP-DESC                          10130034
1023RM             , :PV-DRTV-LCL-QUE-MGR                               10140031
1023RM             , :PV-DRTV-RMT-QUE-MGR                               10150031
1023RM             , :PV-DRTV-QUE-NM                                    10160031
1023RM             , :PV-DRTV-DC-NBR                                    10170031
1023RM          FROM WSV_PRVDR_QUE A                                    10180027
1023RM         WHERE A.APPL_FUNC_DESC    = 'QUEUE'                      10190027
1923RM           AND A.INTGRTN_TYP_CDE   = 'DRTVMSGQ2'                  10200027
1023RM           AND A.DC_NBR            = :DK-OPER-UNT-ID              10210027
1023RM     END-EXEC.                                                    10220027
1023RM                                                                  10230027
1023RM     EVALUATE TRUE                                                10240027
1023RM       WHEN SQLCODE = ZERO                                        10250027
**TEMP*    DISPLAY 'SUKUT129 - 1450-GET-ADDL-QUEUE SUCCESS'             10260039
1023RM           MOVE PV-DRTV-LCL-QUE-MGR-TEXT                          10270031
1923RM                                     TO CC-DRTV-QMGR-NAME         10280027
1023RM           MOVE PV-DRTV-RMT-QUE-MGR-TEXT                          10290031
1023RM                                     TO CC-DRTV-QMGR-NAME-REMOTE  10300027
1023RM           MOVE PV-DRTV-QUE-NM-TEXT  TO CC-DRTV-TRANS-QUEUE-NAME  10310031
1023RM           MOVE PV-DRTV-DC-NBR       TO CC-DRTV-DC-NBR            10320031
1023RM                                                                  10330027
1023RM*          MOVE CC-DRTV-DC-NBR TO PV-DC-NBR                       10340027
1923RM           IF  SU090-BATCH                                        10350027
1023RM              DISPLAY 'CC1 (REMOTE MGR):' CC-DRTV-QMGR-NAME-REMOTE10360027
1023RM              DISPLAY 'CC2 (QUEUE NAME):' CC-DRTV-TRANS-QUEUE-NAME10370027
1023RM              DISPLAY 'CC3 (DC NUMBER) :' CC-DRTV-DC-NBR          10380027
1023RM              DISPLAY 'CC4 (QUEUE MGR) :' CC-DRTV-QMGR-NAME       10390027
1023RM           END-IF                                                 10400027
1023RM                                                                  10410027
1923RM       WHEN OTHER                                                 10420027
1023RM           SET SU090-DB2-ERROR          TO TRUE                   10430027
1023RM           MOVE SQLCODE                 TO SU090-SQLCODE          10440027
1023RM           MOVE SQLCA                   TO SU090-SQLCA            10450027
1023RM           MOVE PV-ABEND-PROGRAM        TO SU090-ERR-PROGRAM      10460027
1023RM           MOVE '1450-GET-ADDL-QUEUE-INFO '                       10470027
1023RM                                        TO PV-ABEND-PARAGRAPH     10480027
1923RM                                           SU090-ERR-PARAGRAPH    10490027
1023RM           MOVE 'SELECT MQ INFO'        TO PV-ABEND-OPER-MESSAGE-110500027
1023RM           STRING 'APPL FUNC DESC: ' DELIMITED BY SIZE            10510027
1023RM                  'QUEUE'            DELIMITED BY SIZE            10520027
1023RM                  '  INTGRTN TYP CDE: '                           10530027
1923RM                                     DELIMITED BY SIZE            10540027
1023RM                  'DRTVMSGQ'         DELIMITED BY SIZE            10550027
1023RM                                   INTO PV-ABEND-OPER-MESSAGE-2   10560027
1023RM           MOVE 'WSV_PRVDR_QUE'      TO PV-ABEND-TABLE-1          10570027
1023RM           PERFORM 9900-DB2-ERROR                                 10580027
1023RM     END-EVALUATE.                                                10590027
      ****************************************************************  10600027
002846** CONNECT TO THE QUEUE MANAGER                                   10610025
002847** GET THE HANDLE TO THE QUEUE MANAGER - PV-HCONN                 10620025
002848** GB 8/30/12 ADDED NEW SWITCH SU090-QMNGR-CONNECTED-YES          10630025
002849** THE CONDITION IS SUKUT129 IS CALLED FROM A PROGRAM THAT IS     10640025
002850** ALREADY CONNECTED TO THE QUEUE MANAGER READING FROM A SEPERATE 10650025
002851** QUEUE. IN THIS CASE, THE CONNECT WILL ERROR WITH               10660025
002852** MQRC-ALREADY-CONNECTED IF TRYING TO CONNECT AGAIN              10670025
002853****************************************************************  10680025
002854 1500-MQ-CONNECT-TO-QMGR.                                         10690025
002855                                                                  10700025
002856* CONNECT TO THE QUEUE                                            10710025
002857* CONTROL CARD 1 - QMGR NAME                                      10720025
002858     MOVE CC-QMGR-NAME TO PC-QMGR-NAME                            10730025
002859     MOVE PC-QMGR-NAME TO PV-QM-NAME.                             10740025
002860                                                                  10750025
002861     CALL PV-MQCONN USING PV-QM-NAME                              10760025
002862                          PV-HCONN                                10770025
002863                          PV-COMPLETION-CODE                      10780025
002864                          PV-REASON.                              10790025
002865                                                                  10800025
002866*    IF CONNECTION FAILED, DISPLAY ERROR MESSAGE AND EXIT         10810025
002867     MOVE PV-REASON TO PV-CON-REASON.                             10820025
002868     IF (PV-COMPLETION-CODE = MQCC-OK)  OR                        10830025
002869        (PV-REASON  =  MQRC-ALREADY-CONNECTED AND                 10840025
002870         SU090-QMNGR-CONNECTED-YES)                               10850025
002871         SET PS-MQCONN-SUCCESSFUL  TO TRUE                        10860025
002872     ELSE                                                         10870025
002873         CALL PV-MQCHECK USING PV-REASON                          10880025
002874                               PV-MQ-REASON-TEXT                  10890025
002875         SET SU090-MQ-ERROR        TO TRUE                        10900025
002876         MOVE PV-QM-NAME           TO PE-MQ-QMANAGER              10910025
002877         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       10920025
002878                                      SU090-MQ-COND-CODE          10930025
002879         MOVE PV-REASON            TO PE-MQ-REASON-CODE           10940025
002880                                      SU090-MQ-REAS-CODE          10950025
002881         MOVE PV-MQ-REASON-TEXT    TO SU090-MQ-REAS-TXT           10960025
002882         MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM           10970025
002883         MOVE '1500-MQ-CONNECT-TO-QMGR'                           10980025
002884                                   TO PV-ERROR-MESSAGE            10990025
002885                                      SU090-ERR-PARAGRAPH         11000025
002886         PERFORM 9200-MQ-ERROR                                    11010025
002887     END-IF.                                                      11020025
002890                                                                  11030025
002891****************************************************************  11040025
002892** OPEN THE QUEUE FOR 'PUT'                                       11050025
002893*  NOTE !!! IF YOU WANT TO WRITE TO A LOCAL QUEUE FOR TESTING     11060025
002894*  PURPOSES, YOU MUST MOVE THE NAME OF THE LOCAL QUEUE QMGR TO    11070025
002895*  MQOD-OBJECTQMGRNAME IN THIS OPEN CALL (INSTEAD OF MOVING THE   11080025
002896*  NAME OF THE UNIX BOX). THIS SINGLE CHANGE IS THE DIFFERENCE    11090025
002897*  BETWEEN WRITING TO THE LOCAL QUEUE AS OPPOSED TO WRITING OUT   11100025
002898*  TO THE REMOTE QUEUE (REMOTE QUEUE HAS A DIFFERENT QMGR).       11110025
002899****************************************************************  11120025
002900 1600-MQ-QUEUE-OPEN.                                              11130025
002901                                                                  11140025
002902* CONTROL CARD 2 - QUEUE NAME                                     11150025
002903     MOVE CC-TRANS-QUEUE-NAME  TO PC-TRANS-QNAME.                 11160025
002904     COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT                        11170025
002905                             + MQOO-SET-IDENTITY-CONTEXT          11180025
002906                             + MQOO-FAIL-IF-QUIESCING.            11190025
002907     MOVE PC-TRANS-QNAME       TO MQOD-OBJECTNAME.                11200025
002908                                                                  11210025
002909* CONTROL CARD 3 - REMOTE QMGR NAME                               11220025
002910                                                                  11230025
002911*THIS IS THE NAME OF THE UNIX BOX (TO WRITE TO REMOTE QUEUE)      11240025
002912*LEAVE BOTH LINES UNCOMMENTED TO WRITE TO REMOTE QUEUE.           11250025
002913*COMMENT OUT THE LINE BELOW (PV-QM-NAME).                         11260025
002914     MOVE CC-QMGR-NAME-REMOTE  TO PV-QM-NAME-REMOTE.              11270025
002915     MOVE PV-QM-NAME-REMOTE    TO MQOD-OBJECTQMGRNAME.            11280025
002916                                                                  11290025
002917******************************************************************11300025
002918*REPLACE REMOTE QMGR NAME WITH LOCAL QMGR NAME TO WRITE TO LOCAL Q11310025
002919******************************************************************11320025
002920*TO WRITE TO A LOCAL QUEUE, UNCOMMENT THE LINE BELOW,             11330025
002921*AND COMMENT OUT THE ABOVE TWO LINES.                             11340025
002922*    MOVE PV-QM-NAME           TO MQOD-OBJECTQMGRNAME.            11350025
002923                                                                  11360025
002924     CALL PV-MQOPEN USING PV-HCONN                                11370025
002925                          MQM-OBJECT-DESCRIPTOR                   11380025
002926                          PV-OPEN-OPTIONS                         11390025
002927                          PV-PQ-HANDLE                            11400025
002928                          PV-COMPLETION-CODE                      11410025
002929                          PV-REASON.                              11420025
002930                                                                  11430025
002931     IF PV-COMPLETION-CODE = MQCC-OK THEN                         11440025
002932         SET PS-MQOPEN-SUCCESSFUL  TO TRUE                        11450025
002933     ELSE                                                         11460025
002934         CALL PV-MQCHECK USING PV-REASON                          11470025
002935                               PV-MQ-REASON-TEXT                  11480025
002936         SET SU090-MQ-ERROR        TO TRUE                        11490025
002937         MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM           11500025
002938         MOVE PV-QM-NAME-REMOTE    TO PE-MQ-QMANAGER-REMOTE       11510025
002939         MOVE PC-TRANS-QNAME       TO PE-MQ-QNAME                 11520025
002940         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       11530025
002941                                      SU090-MQ-COND-CODE          11540025
002942         MOVE PV-REASON            TO PE-MQ-REASON-CODE           11550025
002943                                      SU090-MQ-REAS-CODE          11560025
002944         MOVE PV-MQ-REASON-TEXT    TO SU090-MQ-REAS-TXT           11570025
002945         MOVE '1600-MQ-QUEUE-OPEN' TO PV-ERROR-MESSAGE            11580025
002946                                      SU090-ERR-PARAGRAPH         11590025
002947         PERFORM 9200-MQ-ERROR                                    11600025
 02948     END-IF.                                                      11610025
 02949                                                                  11620025
1023RM****************************************************************  11630027
1023RM**  OPEN DIRECTIVE QUEUE                                          11640027
1023RM****************************************************************  11650027
1023RM 1650-OPEN-DRCTV-QUEUE.                                           11660027
**TEMP*    DISPLAY 'SUKUT129 - 1650-OPEN-DRCTV-QUEUE'.                  11670039
1023RM* DIRECTIVE QUEUE NAME                                            11680028
1023RM     MOVE CC-DRTV-TRANS-QUEUE-NAME  TO PC-TRANS-DRCTV-QNAME       11690028
1023RM     COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT                        11700027
1023RM                             + MQOO-SET-IDENTITY-CONTEXT          11710027
1023RM                             + MQOO-FAIL-IF-QUIESCING.            11720027
1023RM     MOVE CC-DRTV-TRANS-QUEUE-NAME TO MQOD-OBJECTNAME.            11730027
1023RM                                                                  11740027
1023RM* CONTROL CARD 3 - REMOTE QMGR NAME                               11750027
1023RM                                                                  11760027
1023RM*THIS IS THE NAME OF THE UNIX BOX (TO WRITE TO REMOTE QUEUE)      11770027
1023RM*LEAVE BOTH LINES UNCOMMENTED TO WRITE TO REMOTE QUEUE.           11780027
1023RM*COMMENT OUT THE LINE BELOW (PV-QM-NAME).                         11790027
1023RM     MOVE CC-DRTV-QMGR-NAME-REMOTE  TO PV-DRTV-QM-NAME-REMOTE.    11800027
1023RM     MOVE PV-DRTV-QM-NAME-REMOTE    TO MQOD-OBJECTQMGRNAME.       11810027
1023RM                                                                  11820027
1023RM******************************************************************11830027
1023RM*REPLACE REMOTE QMGR NAME WITH LOCAL QMGR NAME TO WRITE TO LOCAL Q11840027
1023RM******************************************************************11850027
1023RM*TO WRITE TO A LOCAL QUEUE, UNCOMMENT THE LINE BELOW,             11860027
1023RM*AND COMMENT OUT THE ABOVE TWO LINES.                             11870027
1023RM*    MOVE PV-QM-NAME           TO MQOD-OBJECTQMGRNAME.            11880027
1023RM                                                                  11890027
1023RM     CALL PV-MQOPEN USING PV-HCONN                                11900027
1023RM                          MQM-OBJECT-DESCRIPTOR                   11910027
1023RM                          PV-OPEN-OPTIONS                         11920027
1023RM                          PV-DRTV-HANDLE                          11930028
1023RM                          PV-COMPLETION-CODE                      11940027
1023RM                          PV-REASON.                              11950027
1023RM                                                                  11960027
1023RM     IF PV-COMPLETION-CODE = MQCC-OK THEN                         11970027
1023RM         SET PS-DRCTV-MQOPEN-SUCCESSFUL  TO TRUE                  11980027
**TEMP*    DISPLAY 'SUKUT129 - QUEUE OPEN SUCCESSFUL'                   11990039
1023RM     ELSE                                                         12000027
1023RM         CALL PV-MQCHECK USING PV-REASON                          12010027
1023RM                               PV-MQ-REASON-TEXT                  12020027
1023RM         SET SU090-MQ-ERROR        TO TRUE                        12030027
1023RM         MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM           12040027
1023RM         MOVE PV-DRTV-QM-NAME-REMOTE TO PE-MQ-QMANAGER-REMOTE     12050027
1023RM         MOVE PC-TRANS-DRCTV-QNAME TO PE-MQ-QNAME                 12060028
1023RM         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       12070027
1023RM                                      SU090-MQ-COND-CODE          12080027
1023RM         MOVE PV-REASON            TO PE-MQ-REASON-CODE           12090027
1023RM                                      SU090-MQ-REAS-CODE          12100027
1023RM         MOVE PV-MQ-REASON-TEXT    TO SU090-MQ-REAS-TXT           12110027
1023RM         MOVE '1650-OPEN-DRCTV-QUEUE' TO PV-ERROR-MESSAGE         12120027
1023RM                                      SU090-ERR-PARAGRAPH         12130027
1023RM         PERFORM 9200-MQ-ERROR                                    12140027
1023RM     END-IF.                                                      12150027
1023RM                                                                  12160027
002950****************************************************************  12170025
002960** CLOSES THE MQ QUEUE.                                           12180000
002970****************************************************************  12190000
002980 1700-MQ-QUEUE-CLOSE.                                             12200000
002981                                                                  12210000
002982     CALL PV-MQCLOSE USING PV-HCONN                               12220000
002983                           PV-PQ-HANDLE                           12230000
002984                           MQCO-NONE                              12240000
002985                           PV-COMPLETION-CODE                     12250000
002986                           PV-REASON.                             12260000
002987                                                                  12270000
002988     IF PV-COMPLETION-CODE = MQCC-OK                              12280000
002989         CONTINUE                                                 12290000
002990     ELSE                                                         12300000
003000         CALL PV-MQCHECK USING PV-REASON                          12310000
003010                               PV-MQ-REASON-TEXT                  12320000
003020         SET SU090-MQ-ERROR        TO TRUE                        12330000
003030         MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM           12340000
003040         MOVE '1700-MQ-QUEUE-CLOSE'                               12350000
003050                                   TO SU090-ERR-PARAGRAPH         12360000
003060         MOVE PV-QM-NAME           TO PE-MQ-QMANAGER              12370000
003070         MOVE PC-TRANS-QNAME       TO PE-MQ-QNAME                 12380000
003080         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       12390000
003081                                      SU090-MQ-COND-CODE          12400000
003082         MOVE PV-REASON            TO PE-MQ-REASON-CODE           12410000
003083                                      SU090-MQ-REAS-CODE          12420000
003084         MOVE PV-MQ-REASON-TEXT    TO SU090-MQ-REAS-TXT           12430000
003085         MOVE 'PE-MQ-CLOSE'        TO PV-ERROR-MESSAGE            12440000
003086         PERFORM 9200-MQ-ERROR                                    12450000
003087     END-IF.                                                      12460000
003088                                                                  12470000
1023RM****************************************************************  12480027
1023RM**  CLOSE ADDITIONAL DIRECTIVE QUEUE                              12490028
1023RM****************************************************************  12500027
1023RM 1750-CLOSE-DRCTV-QUEUE.                                          12510027
**TEMP*    DISPLAY 'SUKUT129 - 1750-CLOSE-DRCTV-QUEUE'.                 12520039
1023RM     CALL PV-MQCLOSE USING PV-HCONN                               12530027
1023RM                           PV-DRTV-HANDLE                         12540028
1023RM                           MQCO-NONE                              12550027
1023RM                           PV-COMPLETION-CODE                     12560027
1023RM                           PV-REASON.                             12570027
1023RM                                                                  12580027
1023RM     IF PV-COMPLETION-CODE = MQCC-OK                              12590027
1023RM         CONTINUE                                                 12600039
1023RM     ELSE                                                         12620027
1023RM         CALL PV-MQCHECK USING PV-REASON                          12630027
1023RM                               PV-MQ-REASON-TEXT                  12640027
1023RM         SET SU090-MQ-ERROR        TO TRUE                        12650027
1023RM         MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM           12660027
1023RM         MOVE '1750-CLOSE-DRCTV-QUEUE'                            12670027
1023RM                                   TO SU090-ERR-PARAGRAPH         12680027
1023RM         MOVE PV-QM-NAME           TO PE-MQ-QMANAGER              12690027
1023RM         MOVE PC-TRANS-DRCTV-QNAME TO PE-MQ-QNAME                 12700028
1023RM         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       12710027
1023RM                                      SU090-MQ-COND-CODE          12720027
1023RM         MOVE PV-REASON            TO PE-MQ-REASON-CODE           12730027
1023RM                                      SU090-MQ-REAS-CODE          12740027
1023RM         MOVE PV-MQ-REASON-TEXT    TO SU090-MQ-REAS-TXT           12750027
1023RM         MOVE 'PE-MQ-CLOSE'        TO PV-ERROR-MESSAGE            12760027
1023RM         PERFORM 9200-MQ-ERROR                                    12770027
1023RM     END-IF.                                                      12780027
1023RM                                                                  12790027
003089****************************************************************  12800000
003090** DISCONNECT FROM THE QUEUE MANAGER                              12810000
003100****************************************************************  12820000
003101 1800-DISCONNECT-QMGR.                                            12830000
003102                                                                  12840000
003103     CALL PV-MQDISC USING PV-HCONN                                12850000
003104                          PV-COMPLETION-CODE                      12860000
003105                          PV-REASON                               12870000
003106                                                                  12880000
003107     IF PV-COMPLETION-CODE = MQCC-OK                              12890000
003108        CONTINUE                                                  12900000
003109     ELSE                                                         12910000
003110        CALL PV-MQCHECK USING PV-REASON                           12920000
003120                              PV-MQ-REASON-TEXT                   12930000
003130        SET SU090-MQ-ERROR          TO TRUE                       12940000
003140        MOVE PV-ABEND-PROGRAM       TO SU090-ERR-PROGRAM          12950000
003150        MOVE PV-QM-NAME             TO PE-MQ-QMANAGER             12960000
003160        MOVE PC-TRANS-QNAME         TO PE-MQ-QNAME                12970000
003170        MOVE PV-COMPLETION-CODE     TO PE-MQ-COMPLETION-CODE      12980000
003180                                       SU090-MQ-COND-CODE         12990000
003190        MOVE PV-REASON              TO PE-MQ-REASON-CODE          13000000
003191                                       SU090-MQ-REAS-CODE         13010000
003192        MOVE PV-MQ-REASON-TEXT      TO SU090-MQ-REAS-TXT          13020000
003193        MOVE '1800-DISCONNECT-QMGR' TO PV-ERROR-MESSAGE           13030000
003194                                       SU090-ERR-PARAGRAPH        13040000
003195        PERFORM 9200-MQ-ERROR                                     13050000
003196     END-IF.                                                      13060000
003197                                                                  13070000
003198******************************************************************13080000
003199* BUILD CONTAINER LEVEL DIRECTIVES MESSAGES, WRITE THEM TO THE   *13090000
003200* MQ SERIES QUEUE, AND INSERT A HISTORY ROW INTO THE             *13100000
003201* SUT_CART_DIRV_TRKG TABLE.                                      *13110000
003202*                                                                *13120000
003203* 03/19/2009 -- WHEN ADD ACTION REQUESTED FOR A CONTAINER, IF    *13130000
003204* A PRIOR DIRECTIVE EXISTS, ONLY SEND THE DELETE DIRECTIVE PRIOR *13140000
003205* TO SENDING THE ADD DIRECTIVE IF THE MOST RECENT DIRECTIVE FOR  *13150000
003206* THE SPECIFIED CONTAINER IS NOT A DELETE DIRECTIVE.  IF THE     *13160000
003207* MOST RECENT DIRECTIVE FOR THE SPECIFIED CONTAINER WAS A DELETE *13170000
003208* DIRECTIVE, ONLY SEND THE ADD DIRECTIVE.   (DANH)               *13180000
003209*                                                                *13190000
003210* 10/27/2009 -- WHEN DELETE ACTION REQUESTED FOR A CONTAINER, IF *13200000
003211* A PRIOR DIRECTIVE EXISTS, ONLY SEND THE DELETE DIRECTIVE WHEN  *13210000
003212* THE MOST RECENT DIRECTIVE FOR THE SPECIFIED CONTAINER IS NOT A *13220000
003213* DELETE DIRECTIVE.  IF THE MOST RECENT DIRECTIVE FOR THE        *13230000
003214* SPECIFIED CONTAINER WAS A DELETE DIRECTIVE, DO NOT SEND ANY    *13240000
003215* DIRECTIVES.  WRITE A MESSAGE TO 'CEEMSG' IN CICS STATING THAT  *13250000
003216* THE DELETE DIRECTIVE HAD NOT BEEN SENT.    (DANH)              *13260000
003217******************************************************************13270000
003218 2000-CARTON-DIRECTIVE.                                           13280000
003219                                                                  13290000
**TEMP*    DISPLAY '2000-CARTON-DIRECTIVE'                              13300039
003220     EVALUATE TRUE                                                13310000
003221       WHEN SU090-DELETE-ACTION                                   13320000
**TEMP*    DISPLAY ' 2000- DELETE-ACTION'                               13330039
003222         PERFORM 2100-SELECT-ORIG-CASI-CDE                        13340000
003223         IF  SU090-SUCCESS                                        13350000
003224             IF  PS-PRIOR-DIRECTIVE                               13360000
003225                 IF  DK-BRCDE-TYP-CDE = 'S'                       13370000
003226                     PERFORM 2150-CHECK-CURR-BY-SHIP-UNT-ID       13380000
003227                 ELSE                                             13390000
003228                     PERFORM 2160-CHECK-CURR-BY-BRCDE-NBR         13400000
003229                 END-IF                                           13410000
003231                 IF  SUT00102-CNVYR-PRC-ACTN-NM = 'DELETE'        13420000
003232**** ADDED RPK - 08/05/13 - BEGIN                                 13430015
003233                 AND SU090-CALLING-PGM NOT = 'RESEND'             13440019
003234**** ADDED RPK - 08/05/13 - END                                   13450015
003235                     DISPLAY '***********************************'13460000
003236                     DISPLAY '  CALLED PROGRAM NOTICE: SUKUT129  '13470000
003237                     DISPLAY '                                   '13480000
003238                     DISPLAY ' DELETE ACTION REQUESTED FROM DC '  13490000
003239                              SUT00102-OPER-UNT-ID                13500000
003240                     DISPLAY ' FOR THE FOLLOWING CONTAINER:      '13510000
003241                     DISPLAY ' ' SUT00102-BRCDE-NBR               13520000
003242                     DISPLAY '                                   '13530000
003243* JAK MAKE ERROR MESSAGE GENERIC                                  13540000
003244*                    DISPLAY ' DELETE DIRECTIVE WAS NOT SENT TO  '13550000
003245*                    DISPLAY ' DEMATIC FOR THIS CONTAINER BECAUSE'13560000
003246                     DISPLAY ' DELETE DIRECTIVE WAS NOT SENT     '13570000
003247                     DISPLAY ' FOR THIS CONTAINER BECAUSE        '13580000
003248                     DISPLAY ' THE PRIOR DIRECTIVE THAT HAD BEEN '13590000
003249                     DISPLAY ' SENT FOR THIS CONTAINER WAS ALSO A'13600000
003250                     DISPLAY ' DELETE DIRECTIVE.                 '13610000
003251                     DISPLAY '***********************************'13620000
003252                 ELSE                                             13630000
003253******************************************************************13640000
003254* IF DELETE DIRECTIVE AND CURRENT DIRECTIVE IS RLC (RELEASE CARTON13650000
003260* AUDIT) CHECK PREVIOUS DIRECTIVE.                                13660000
003261*  IF PREVIOUS DIRECTIVE IS RLO - BARCODE - ADD  (RELEASE ONLINE) 13670000
003262*  THEN BYPASS RLC DIRECTIVE                                      13680000
003263*                                                                 13690000
003264*  DC IS CLOSING MANUAL AUDITS DAYS AFTER CARTONS HAVE ALREADY    13700000
003265*  BEEN RELEASED.  THEN WE RECEIVE INCIDENTS BECAUSE CARTON       13710000
003266*  "MISSION" CANNOT BE DELETED BECAUSE THEY ARE ALREADY GONE      13720000
003267*                                                                 13730000
003268**** ADDED DMH - 7/29/10 - BEGIN                                  13740000
003269***                                                               13750000
003270******************************************************************13760000
003271                 SET PS-CHECK-DELETE-NO  TO TRUE                  13770000
003272                 IF  SU090-DIRV-RSN-CDE  =  'RLC'                 13780000
003273                     PERFORM 2270-CHECK-DELETE-PARM               13790000
003274                 END-IF                                           13800000
003275                 IF  SU090-DIRV-RSN-CDE         =  'RLC'      AND 13810000
003276                     PS-CHECK-DELETE                          AND 13820000
003277                     SUT00102-CNVYR-PRC-ACTN-NM =  'ADD'      AND 13830000
003278                     SUT00102-LGCL-LOC-NM       =  'BARCODE'  AND 13840000
003279                     SUT00102-DIRV-RSN-CDE      =  'RLO'          13850000
003280                     DISPLAY '***********************************'13860000
003281                     DISPLAY '  CALLED PROGRAM NOTICE: SUKUT129  '13870000
003282                     DISPLAY '                                   '13880000
003283                     DISPLAY ' DELETE ACTION REQUESTED FROM DC '  13890000
003284                              SUT00102-OPER-UNT-ID                13900000
003285                     DISPLAY ' FOR THE FOLLOWING CONTAINER:      '13910000
003286                     DISPLAY ' ' SUT00102-BRCDE-NBR               13920000
003287                     DISPLAY '                                   '13930000
003288* JAK MAKE ERROR MESSAGE GENERIC                                  13940000
003289*                    DISPLAY ' DELETE DIRECTIVE WAS NOT SENT TO  '13950000
003290*                    DISPLAY ' DEMATIC FOR THIS CONTAINER BECAUSE'13960000
003291                     DISPLAY ' DELETE DIRECTIVE WAS NOT SENT     '13970000
003292                     DISPLAY ' FOR THIS CONTAINER BECAUSE        '13980000
003293                     DISPLAY ' THE PRIOR DIRECTIVE WAS SENT TO   '13990000
003294                     DISPLAY ' RELEASE CARTONS THRU ONLINE SCREEN'14000000
003295                     DISPLAY '***********************************'14010000
003296                 ELSE                                             14020000
003297**** ADDED DMH - 7/29/10 - END                                    14030000
003298***                                                               14040000
003299                     SET PS-DELETE-DIRECTIVE                      14050000
003300                                         TO TRUE                  14060000
003301                     MOVE PC-DELETE      TO PV-ACTN-CDE           14070000
003302                                        SUT00102-CNVYR-PRC-ACTN-NM14080000
003303                     IF  SU090-SUCCESS                            14090000
003304                         PERFORM 2230-GET-ACKNL-SEQ-CURR-TMST     14100000
003305                     END-IF                                       14110000
003306**RFDCSI                                                          14120008
003307                     IF  SU090-SUCCESS                            14130000
003308                         PERFORM 2240-SET-VAR-FROM-PRIOR-DIRV     14140000
003309                         PERFORM 2250-SET-REQUIRED-CA-FIELDS      14150000
003310                         PERFORM 2300-BUILD-DIRECTIVE-MSG         14160000
003311                     END-IF                                       14170000
003312                     IF  SU090-SUCCESS                            14180000
003313                         PERFORM 5000-CREATE-MSGS                 14190000
003314                     END-IF                                       14200000
003315                     IF  SU090-SUCCESS                            14210000
003316                         PERFORM 2500-INSERT-HISTORY              14220000
003317                     END-IF                                       14230000
003318                 END-IF                                           14240000
003319                 END-IF                                           14250000
003320             END-IF                                               14260000
003321         END-IF                                                   14270000
003322                                                                  14280000
003323       WHEN SU090-ADD-ACTION                                      14290000
**TEMP*    DISPLAY ' 2000- ADD-ACTION'                                  14300039
003324         PERFORM 2100-SELECT-ORIG-CASI-CDE                        14310000
003325         IF  SU090-SUCCESS                                        14320000
003326             IF  PS-PRIOR-DIRECTIVE                               14330000
003327                 IF  DK-BRCDE-TYP-CDE = 'S'                       14340000
003328                     PERFORM 2150-CHECK-CURR-BY-SHIP-UNT-ID       14350000
003329                 ELSE                                             14360000
003330                     PERFORM 2160-CHECK-CURR-BY-BRCDE-NBR         14370000
003331                 END-IF                                           14380000
003332****             DO NOT SEND THE 'DELETE' DIRECTIVE IF THE PRIOR  14390019
003333****             DIRECTIVE WAS A 'DELETE' DIRECTIVE OR IF THE     14400019
003334****             DIRECTIVE IS BEING RESENT AND THE PRIOR DIRECTIVE14410019
003335****             WAS SENT THROUGH NORMAL PROCESSING AND WAS THE   14420021
003336****             FIRST DIRECTIVE SENT FOR THE CONTAINER           14430021
003337                 IF (SUT00102-CNVYR-PRC-ACTN-NM = 'DELETE') OR    14440021
003338                    (SU090-CALLING-PGM  = 'RESEND' AND            14450021
003339                     SUT00102-CRE-PGM-NM NOT = 'RESEND' AND       14460021
003340                     SUT00102-CRE-TMST = PV-ORIG-CRE-TMST)        14470022
003341                     CONTINUE                                     14480021
003342                 ELSE                                             14490021
003343                     SET PS-DELETE-DIRECTIVE TO TRUE              14500021
003344                     MOVE PC-DELETE          TO PV-ACTN-CDE       14510021
003345                                        SUT00102-CNVYR-PRC-ACTN-NM14520021
003346                     IF  SU090-SUCCESS                            14530021
003347                         PERFORM 2230-GET-ACKNL-SEQ-CURR-TMST     14540021
003348                     END-IF                                       14550021
003349                     IF  SU090-SUCCESS                            14560021
003350                         PERFORM 2240-SET-VAR-FROM-PRIOR-DIRV     14570021
003351                         PERFORM 2250-SET-REQUIRED-CA-FIELDS      14580021
003352                         PERFORM 2300-BUILD-DIRECTIVE-MSG         14590021
003353                     END-IF                                       14600021
003354                     IF  SU090-SUCCESS                            14610021
003355                         PERFORM 5000-CREATE-MSGS                 14620021
003356                     END-IF                                       14630021
003357                     IF  SU090-SUCCESS                            14640021
003358                         PERFORM 2500-INSERT-HISTORY              14650021
003359                     END-IF                                       14660021
003360                 END-IF                                           14670000
003370                 IF  SU090-SUCCESS                                14680000
003380                     SET PS-ADD-DIRECTIVE TO TRUE                 14690000
003390                     MOVE PC-ADD          TO PV-ACTN-CDE          14700000
003400                                        SUT00102-CNVYR-PRC-ACTN-NM14710000
003500                     IF  SU090-CARTON-DIRECTIVE                   14720000
003600                         PERFORM 2200-FETCH-ADD-DIRV-MSG-DATA     14730000
003700                     ELSE                                         14740000
003800                         PERFORM 2240-SET-VAR-FROM-PRIOR-DIRV     14750000
003900                         PERFORM 2250-SET-REQUIRED-CA-FIELDS      14760000
004000                     END-IF                                       14770000
004100                 END-IF                                           14780000
004200                 IF  SU090-SUCCESS                                14790000
004300                     PERFORM 2230-GET-ACKNL-SEQ-CURR-TMST         14800000
004400                 END-IF                                           14810000
004500                 IF  SU090-SUCCESS                                14820000
004600                     PERFORM 2300-BUILD-DIRECTIVE-MSG             14830000
004700                 END-IF                                           14840000
004800                 IF  SU090-SUCCESS                                14850000
004900                     PERFORM 5000-CREATE-MSGS                     14860000
005000                 END-IF                                           14870000
005100                 IF  SU090-SUCCESS                                14880000
005200                     PERFORM 2500-INSERT-HISTORY                  14890000
005300                 END-IF                                           14900000
005400             ELSE                                                 14910000
005500                 SET PS-ADD-DIRECTIVE    TO TRUE                  14920000
005501                 MOVE PC-ADD             TO PV-ACTN-CDE           14930000
005502                                        SUT00102-CNVYR-PRC-ACTN-NM14940000
005503                 IF  SU090-CARTON-DIRECTIVE                       14950000
005504                     PERFORM 2200-FETCH-ADD-DIRV-MSG-DATA         14960000
005505                 ELSE                                             14970000
005506                     PERFORM 2240-SET-VAR-FROM-PRIOR-DIRV         14980000
005507                     PERFORM 2250-SET-REQUIRED-CA-FIELDS          14990000
005508                 END-IF                                           15000000
005509                 IF  SU090-SUCCESS                                15010000
005510                     PERFORM 2230-GET-ACKNL-SEQ-CURR-TMST         15020000
005511                 END-IF                                           15030000
005512                 IF  SU090-SUCCESS                                15040000
005513                     PERFORM 2300-BUILD-DIRECTIVE-MSG             15050000
005514                 END-IF                                           15060000
005515                 IF  SU090-SUCCESS                                15070000
005516                     PERFORM 5000-CREATE-MSGS                     15080000
005517                 END-IF                                           15090000
005518                 IF  SU090-SUCCESS                                15100000
005519                     PERFORM 2500-INSERT-HISTORY                  15110000
005520                 END-IF                                           15120000
005521             END-IF                                               15130000
005522         END-IF                                                   15140000
005523     END-EVALUATE.                                                15150000
005524                                                                  15160000
005525******************************************************************15170000
005526* SELECT THE CASI CODE FROM THE OLDEST DIRECTIVE ROW ON          *15180000
005527* SUT_CART_DIRV_TRKG FOR THE SPECIFIED CONTAINER BARCODE.        *15190000
005528* THIS WILL ALSO DOUBLE AS A CHECK TO SEE IF A PRIOR DIRECTIVE   *15200000
005529* EXISTS.                                                        *15210000
005530******************************************************************15220000
005531 2100-SELECT-ORIG-CASI-CDE.                                       15230000
**TEMP*    DISPLAY '2100-SELECT-ORIG-CASI-CDE'.                         15231039
005532                                                                  15240000
005533     SET PS-NO-PRIOR-DIRECTIVE    TO TRUE.                        15250000
005534     MOVE SU090-OPER-UNT-ID       TO DK-OPER-UNT-ID.              15260000
005535                                                                  15270000
005536     IF  SU090-CARTON-DIRECTIVE                                   15280000
005537***SLH 02/06/09 ADDED 'K' FOR PBS SML                             15290000
005538***DMH 03/16/12 ADDED 'E' FOR ECOMM SML                           15300000
005539         IF  SU090-BRCDE-TYP-CDE = 'S' OR 'K' OR 'E'              15310000
005540             MOVE SU090-SML-BRCDE-NBR                             15320000
005541                                  TO DK-SHIPT-UNT-ID              15330000
005542** SLH          MOVE SU090-BRCDE-TYP-CDE                          15340000
005543             MOVE 'S'             TO DK-BRCDE-TYP-CDE             15350000
005544         ELSE                                                     15360000
005545             IF  SU090-BRCDE-TYP-CDE = 'P'                        15370000
005546                 MOVE SU090-P2L-BRCDE-NBR                         15380000
005547                                  TO DK-BRCDE-NBR                 15390000
005548                 MOVE SU090-BRCDE-TYP-CDE                         15400000
005549                                  TO DK-BRCDE-TYP-CDE             15410000
005550             END-IF                                               15420000
005551         END-IF                                                   15430000
005552     END-IF.                                                      15440000
005553                                                                  15450000
005554     IF  DK-BRCDE-TYP-CDE = 'S'                                   15460000
005555         PERFORM 2110-SELECT-ORIG-BY-SHIP-UNT                     15470000
005556     ELSE                                                         15480000
005557         PERFORM 2120-SELECT-ORIG-BY-BRCDE-NBR                    15490000
005558     END-IF.                                                      15500000
005559                                                                  15510000
005560******************************************************************15520000
005570* SELECT THE CASI CODE FROM THE OLDEST DIRECTIVE ROW ON          *15530000
005571* SUT_CART_DIRV_TRKG USING THE SHIP_UNT_ID VALUE.                *15540000
005572* THIS WILL ALSO DOUBLE AS A CHECK TO SEE IF A PRIOR DIRECTIVE   *15550000
005573* EXISTS.                                                        *15560000
005574******************************************************************15570000
005575 2110-SELECT-ORIG-BY-SHIP-UNT.                                    15580000
**TEMP*    DISPLAY '2110-SELECT-ORIG-BY-SHIP-UNT'.                      15581039
005576                                                                  15590000
005577     EXEC SQL                                                     15600000
005578         SELECT A.CRE_TMST                                        15610020
005579              , A.CASI_CDE                                        15620020
005580           INTO :PV-ORIG-CRE-TMST                                 15630020
005581              , :PV-ORIG-CASI-CDE                                 15640020
005582           FROM SUT_CART_DIRV_TRKG A                              15650020
005583          WHERE A.OPER_UNT_ID  =  :DK-OPER-UNT-ID                 15660020
005584            AND A.SHIPT_UNT_ID =  :DK-SHIPT-UNT-ID                15670020
005585            AND A.CRE_TMST     =                                  15680020
005586                ( SELECT MIN(B.CRE_TMST)                          15690020
005587                    FROM SUT_CART_DIRV_TRKG B                     15700020
005588                   WHERE B.SHIPT_UNT_ID = A.SHIPT_UNT_ID)         15710020
005589     END-EXEC.                                                    15720020
005590                                                                  15730020
005591     EVALUATE TRUE                                                15740020
005592       WHEN SQLCODE = ZERO                                        15750020
005593           SET PS-PRIOR-DIRECTIVE    TO TRUE                      15760020
005594                                                                  15770020
005595       WHEN SQLCODE = +100                                        15780020
005596           SET PS-NO-PRIOR-DIRECTIVE TO TRUE                      15790020
005597           MOVE PC-DEFAULT-TMST      TO PV-ORIG-CRE-TMST          15800020
005598           MOVE SU090-CASI-CDE       TO PV-ORIG-CASI-CDE          15810020
005599                                                                  15820020
005600       WHEN SQLWARN0 NOT EQUAL SPACE                              15830020
005601       WHEN SQLCODE NOT EQUAL ZERO                                15840020
005602           SET SU090-DB2-ERROR       TO TRUE                      15850020
005603           MOVE SQLCODE              TO SU090-SQLCODE             15860020
005604           MOVE SQLCA                TO SU090-SQLCA               15870020
005605           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         15880020
005606           MOVE '2110-SELECT-ORIG-BY-SHIP-UNT'                    15890020
005607                                     TO PV-ABEND-PARAGRAPH        15900020
005608                                        SU090-ERR-PARAGRAPH       15910020
005609           MOVE 'CHECKING FOR ORIGINAL CASI CODE BY SHIP UNT ID'  15920020
005610                                     TO PV-ABEND-OPER-MESSAGE-1   15930020
005611           MOVE DK-SHIPT-UNT-ID      TO PV-SHIPT-UNT-ID-N         15940020
005612           STRING 'SHIPT UNT ID: '   DELIMITED BY SIZE            15950020
005613                  PV-SHIPT-UNT-ID-DISP                            15960020
005614                                     DELIMITED BY SIZE            15970020
005615                                   INTO PV-ABEND-OPER-MESSAGE-2   15980020
005616           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          15990020
005617           PERFORM 9900-DB2-ERROR                                 16000020
005618     END-EVALUATE.                                                16010020
005619                                                                  16020020
005620******************************************************************16030020
005621* SELECT THE CASI CODE FROM THE OLDEST DIRECTIVE ROW ON          *16040020
005622* SUT_CART_DIRV_TRKG USING THE SHIP_UNT_ID VALUE.                *16050020
005623* THIS WILL ALSO DOUBLE AS A CHECK TO SEE IF A PRIOR DIRECTIVE   *16060020
005624* EXISTS.                                                        *16070020
005625******************************************************************16080020
005626 2120-SELECT-ORIG-BY-BRCDE-NBR.                                   16090020
**TEMP*    DISPLAY '2120-SELECT-ORIG-BY-BRCDE-NBR'.                     16091039
005627                                                                  16100020
005628     EXEC SQL                                                     16110020
005629         SELECT A.CRE_TMST                                        16120020
005630              , A.CASI_CDE                                        16130020
005631           INTO :PV-ORIG-CRE-TMST                                 16140020
005632              , :PV-ORIG-CASI-CDE                                 16150020
005636           FROM SUT_CART_DIRV_TRKG A                              16160020
005637          WHERE A.OPER_UNT_ID  =  :DK-OPER-UNT-ID                 16170020
005638            AND A.BRCDE_NBR    =  :DK-BRCDE-NBR                   16180020
005639            AND A.CRE_TMST     =                                  16190020
005640                ( SELECT MIN(B.CRE_TMST)                          16200020
005641                    FROM SUT_CART_DIRV_TRKG B                     16210020
005642                   WHERE B.BRCDE_NBR = A.BRCDE_NBR)               16220020
005643     END-EXEC.                                                    16230020
005644                                                                  16240020
005645     EVALUATE TRUE                                                16250020
005646       WHEN SQLCODE = ZERO                                        16260020
005647           SET PS-PRIOR-DIRECTIVE    TO TRUE                      16270020
005648                                                                  16280020
005649       WHEN SQLCODE = +100                                        16290020
005650           SET PS-NO-PRIOR-DIRECTIVE TO TRUE                      16300020
005651           MOVE PC-DEFAULT-TMST      TO PV-ORIG-CRE-TMST          16310020
005652           MOVE SU090-CASI-CDE       TO PV-ORIG-CASI-CDE          16320020
005653                                                                  16330020
005654       WHEN SQLWARN0 NOT EQUAL SPACE                              16340020
005655       WHEN SQLCODE NOT EQUAL ZERO                                16350020
005656           SET SU090-DB2-ERROR       TO TRUE                      16360020
005657           MOVE SQLCODE              TO SU090-SQLCODE             16370020
005658           MOVE SQLCA                TO SU090-SQLCA               16380020
005659           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         16390020
005660           MOVE '2120-SELECT-ORIG-BY-BRCDE-NBR'                   16400020
005661                                     TO PV-ABEND-PARAGRAPH        16410020
005662                                        SU090-ERR-PARAGRAPH       16420020
005663           MOVE 'CHECKING FOR ORIGINAL CASI CODE BY BRCDE NBR'    16430020
005664                                     TO PV-ABEND-OPER-MESSAGE-1   16440020
005665           STRING ' BRCDE NBR: '     DELIMITED BY SIZE            16450020
005666                  DK-BRCDE-NBR       DELIMITED BY SIZE            16460020
005667                                   INTO PV-ABEND-OPER-MESSAGE-2   16470020
005668           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          16480020
005669           PERFORM 9900-DB2-ERROR                                 16490020
005670     END-EVALUATE.                                                16500020
005671                                                                  16510020
005672******************************************************************16520020
005673* CHECK FOR THE MOST RECENT DIRECTIVE FOR THE SHIPPING UNIT ID.  *16530020
005674* WE WILL BE USING THE VALUES FROM THIS DIRECTIVE FOR THE        *16540020
005675* MESSAGE WRITTEN TO MQ AND FOR THE ROW THAT WILL BE INSERTED    *16550020
005676* INTO SUT_CART_DIRV_TRKG.                                       *16560020
005677******************************************************************16570020
005678 2150-CHECK-CURR-BY-SHIP-UNT-ID.                                  16580020
**TEMP*    DISPLAY '2150-CHECK-CURR-BY-SHIP-UNT-ID'.                    16581039
005679                                                                  16590020
005680     INITIALIZE DCLSUT00102.                                      16600020
005681                                                                  16610020
005682     EXEC SQL                                                     16620020
005683         SELECT A.BRCDE_NBR                                       16630020
005684               ,A.CRE_TMST                                        16640021
005685               ,A.OPER_UNT_ID                                     16650021
005686               ,A.DIRV_RSN_CDE                                    16660021
005687               ,A.LGCL_LOC_NM                                     16670021
005688               ,A.AUD_CNTL_NBR                                    16680021
005689               ,A.SHIPT_UNT_ID                                    16690021
005690               ,A.AUD_STAT_CDE                                    16700021
005691               ,A.PO_NBR                                          16710021
005692               ,A.RCVR_SEQ_NBR                                    16720021
005693               ,A.PO_LNE_NBR                                      16730021
005694               ,A.PREPK_ID                                        16740021
005695               ,A.STR_NBR                                         16750021
005696               ,A.CRE_PGM_NM                                      16760021
005697               ,A.CASI_CDE                                        16770021
005698               ,A.CART_STAT_CDE                                   16780021
005699               ,A.AUD_FALR_RSN_NM                                 16790021
005700               ,A.STR_ZN_ID                                       16800021
005701               ,A.SEASET_YR                                       16810021
005702               ,A.SEASET_SHRT_NM                                  16820021
005703               ,A.CNVYR_PRC_ACTN_NM                               16830021
005704           INTO :SUT00102-BRCDE-NBR                               16840021
005705               ,:SUT00102-CRE-TMST                                16850021
005706               ,:SUT00102-OPER-UNT-ID                             16860021
005707               ,:SUT00102-DIRV-RSN-CDE                            16870021
005708               ,:SUT00102-LGCL-LOC-NM                             16880021
005709               ,:SUT00102-AUD-CNTL-NBR                            16890021
005710               ,:SUT00102-SHIPT-UNT-ID                            16900021
005711               ,:SUT00102-AUD-STAT-CDE                            16910021
005712               ,:SUT00102-PO-NBR                                  16920021
005713               ,:SUT00102-RCVR-SEQ-NBR                            16930021
005714               ,:SUT00102-PO-LNE-NBR                              16940021
005715               ,:SUT00102-PREPK-ID                                16950021
005716               ,:SUT00102-STR-NBR                                 16960021
005717               ,:SUT00102-CRE-PGM-NM                              16970021
005718               ,:SUT00102-CASI-CDE                                16980021
005719               ,:SUT00102-CART-STAT-CDE                           16990021
005720               ,:SUT00102-AUD-FALR-RSN-NM                         17000021
005721               ,:SUT00102-STR-ZN-ID                               17010021
005722               ,:SUT00102-SEASET-YR                               17020021
005723               ,:SUT00102-SEASET-SHRT-NM                          17030021
005724               ,:SUT00102-CNVYR-PRC-ACTN-NM                       17040021
005725           FROM SUT_CART_DIRV_TRKG A                              17050021
005726          WHERE A.OPER_UNT_ID  =  :DK-OPER-UNT-ID                 17060021
005727            AND A.SHIPT_UNT_ID =  :DK-SHIPT-UNT-ID                17070021
005728            AND A.CRE_TMST     =                                  17080021
005729                ( SELECT MAX(B.CRE_TMST)                          17090021
005730                    FROM SUT_CART_DIRV_TRKG B                     17100021
005731                   WHERE B.SHIPT_UNT_ID = A.SHIPT_UNT_ID)         17110021
005732     END-EXEC.                                                    17120021
005733                                                                  17130021
005734     EVALUATE TRUE                                                17140021
005735       WHEN SQLCODE = ZERO                                        17150021
005736       WHEN SQLCODE = +100                                        17160021
005737           CONTINUE                                               17170021
005738                                                                  17180021
005739       WHEN SQLWARN0 NOT EQUAL SPACE                              17190021
005740       WHEN SQLCODE NOT EQUAL ZERO                                17200021
005741           SET SU090-DB2-ERROR       TO TRUE                      17210021
005742           MOVE SQLCODE              TO SU090-SQLCODE             17220021
005743           MOVE SQLCA                TO SU090-SQLCA               17230021
005744           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         17240021
005745           MOVE '2150-CHECK-CURR-BY-SHIP-UNT-ID'                  17250021
005746                                     TO PV-ABEND-PARAGRAPH        17260021
005747                                        SU090-ERR-PARAGRAPH       17270021
005748           MOVE 'CHECK FOR MOST RECENT DIRECTIVE BY SHIP UNT ID'  17280021
005749                                     TO PV-ABEND-OPER-MESSAGE-1   17290021
005750           MOVE DK-SHIPT-UNT-ID      TO PV-SHIPT-UNT-ID-N         17300021
005751           STRING '  SHIPT UNT ID: ' DELIMITED BY SIZE            17310021
005752                  PV-SHIPT-UNT-ID-DISP                            17320021
005753                                     DELIMITED BY SIZE            17330021
005754                                   INTO PV-ABEND-OPER-MESSAGE-2   17340021
005755           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          17350021
005756           PERFORM 9900-DB2-ERROR                                 17360021
005757     END-EVALUATE.                                                17370021
005758                                                                  17380021
005759******************************************************************17390021
005760* CHECK FOR THE MOST RECENT DIRECTIVE FOR THE 22-DIGIT BARCODE.  *17400021
005761* WE WILL BE USING THE VALUES FROM THIS DIRECTIVE FOR THE        *17410021
005762* MESSAGE WRITTEN TO MQ AND FOR THE ROW THAT WILL BE INSERTED    *17420021
005763* INTO SUT_CART_DIRV_TRKG.                                       *17430021
005764******************************************************************17440021
005765 2160-CHECK-CURR-BY-BRCDE-NBR.                                    17450021
**TEMP*    DISPLAY '2160-CHECK-CURR-BY-BRCDE-NBR'.                      17451039
005766                                                                  17460021
005767     INITIALIZE DCLSUT00102.                                      17470021
005768                                                                  17480021
005769     EXEC SQL                                                     17490021
005770         SELECT A.BRCDE_NBR                                       17500021
005771               ,A.CRE_TMST                                        17510021
005773               ,A.OPER_UNT_ID                                     17520021
005774               ,A.DIRV_RSN_CDE                                    17530021
005775               ,A.LGCL_LOC_NM                                     17540021
005776               ,A.AUD_CNTL_NBR                                    17550021
005777               ,A.SHIPT_UNT_ID                                    17560021
005778               ,A.AUD_STAT_CDE                                    17570021
005779               ,A.PO_NBR                                          17580021
005780               ,A.RCVR_SEQ_NBR                                    17590021
005781               ,A.PO_LNE_NBR                                      17600021
005782               ,A.PREPK_ID                                        17610021
005783               ,A.STR_NBR                                         17620021
005784               ,A.CRE_PGM_NM                                      17630021
005785               ,A.CASI_CDE                                        17640021
005786               ,A.CART_STAT_CDE                                   17650021
005787               ,A.AUD_FALR_RSN_NM                                 17660021
005788               ,A.STR_ZN_ID                                       17670021
005789               ,A.SEASET_YR                                       17680021
005790               ,A.SEASET_SHRT_NM                                  17690021
005791               ,A.CNVYR_PRC_ACTN_NM                               17700021
005792           INTO :SUT00102-BRCDE-NBR                               17710021
005793               ,:SUT00102-CRE-TMST                                17720021
005794               ,:SUT00102-OPER-UNT-ID                             17730021
005795               ,:SUT00102-DIRV-RSN-CDE                            17740021
005796               ,:SUT00102-LGCL-LOC-NM                             17750021
005797               ,:SUT00102-AUD-CNTL-NBR                            17760021
005798               ,:SUT00102-SHIPT-UNT-ID                            17770021
005799               ,:SUT00102-AUD-STAT-CDE                            17780021
005800               ,:SUT00102-PO-NBR                                  17790021
005801               ,:SUT00102-RCVR-SEQ-NBR                            17800021
005802               ,:SUT00102-PO-LNE-NBR                              17810021
005803               ,:SUT00102-PREPK-ID                                17820021
005804               ,:SUT00102-STR-NBR                                 17830021
005805               ,:SUT00102-CRE-PGM-NM                              17840021
005806               ,:SUT00102-CASI-CDE                                17850021
005807               ,:SUT00102-CART-STAT-CDE                           17860021
005808               ,:SUT00102-AUD-FALR-RSN-NM                         17870021
005809               ,:SUT00102-STR-ZN-ID                               17880021
005810               ,:SUT00102-SEASET-YR                               17890021
005811               ,:SUT00102-SEASET-SHRT-NM                          17900021
005812               ,:SUT00102-CNVYR-PRC-ACTN-NM                       17910021
005813           FROM SUT_CART_DIRV_TRKG A                              17920021
005814          WHERE A.OPER_UNT_ID  =  :DK-OPER-UNT-ID                 17930021
005815            AND A.BRCDE_NBR    =  :DK-BRCDE-NBR                   17940021
005816            AND A.CRE_TMST     =                                  17950021
005817                ( SELECT MAX(B.CRE_TMST)                          17960021
005818                    FROM SUT_CART_DIRV_TRKG B                     17970021
005819                   WHERE B.BRCDE_NBR = A.BRCDE_NBR)               17980021
005820     END-EXEC.                                                    17990021
005821                                                                  18000021
005822     EVALUATE TRUE                                                18010021
005823       WHEN SQLCODE = ZERO                                        18020021
005824       WHEN SQLCODE = +100                                        18030021
005825           CONTINUE                                               18040021
005826                                                                  18050021
005827       WHEN SQLWARN0 NOT EQUAL SPACE                              18060021
005828       WHEN SQLCODE NOT EQUAL ZERO                                18070021
005829           SET SU090-DB2-ERROR       TO TRUE                      18080021
005830           MOVE SQLCODE              TO SU090-SQLCODE             18090021
005831           MOVE SQLCA                TO SU090-SQLCA               18100021
005832           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         18110021
005833           MOVE '2160-CHECK-CURR-BY-BRCDE-NBR'                    18120021
005834                                     TO PV-ABEND-PARAGRAPH        18130021
005835                                        SU090-ERR-PARAGRAPH       18140021
005836           MOVE 'CHECKING FOR MOST RECENT DIRECTIVE BY BARCODE'   18150021
005837                                     TO PV-ABEND-OPER-MESSAGE-1   18160021
005838           STRING ' BRCDE NBR: '     DELIMITED BY SIZE            18170021
005839                  DK-BRCDE-NBR       DELIMITED BY SIZE            18180021
005840                                   INTO PV-ABEND-OPER-MESSAGE-2   18190021
005841           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          18200021
005842           PERFORM 9900-DB2-ERROR                                 18210021
005843     END-EVALUATE.                                                18220021
005844                                                                  18230021
005845******************************************************************18240021
005846* FETCH DATA THAT WILL BE USED TO BUILD THE DIRECTIVE MESSAGE.   *18250021
005847******************************************************************18260021
005848 2200-FETCH-ADD-DIRV-MSG-DATA.                                    18270021
**TEMP*    DISPLAY '2200-FETCH-ADD-DIRV-MSG-DATA'.                      18271039
005849     IF  SU090-SUCCESS                                            18280021
005850         PERFORM 2210-FETCH-DIRV-ADDR-INFO                        18290021
005851     END-IF.                                                      18300021
005852                                                                  18310021
005853     IF  SU090-SUCCESS                                            18320021
005854         PERFORM 2220-VEND-NAME-AUD-DATE                          18330021
005855     END-IF.                                                      18340021
005856                                                                  18350021
005857     IF  SU090-SUCCESS                                            18360021
005858         EVALUATE TRUE                                            18370021
005859           WHEN SU090-SML-BARCODE                                 18380021
005860             MOVE ZEROS           TO PV-BARCODE-01-02             18390021
005861             MOVE SU090-SML-BRCDE-NBR                             18400021
005862                                  TO PV-BARCODE-03-20             18410021
005863                                     SUT00102-SHIPT-UNT-ID        18420021
005864             MOVE SPACES          TO PV-BARCODE-21-22             18430021
005865             MOVE PV-BARCODE-22   TO SUT00102-BRCDE-NBR           18440021
005866                                                                  18450021
005867           WHEN SU090-P2L-BARCODE                                 18460021
005868             MOVE ZEROS           TO SUT00102-SHIPT-UNT-ID        18470021
005869             MOVE SU090-P2L-BRCDE-NBR                             18480021
005870                                  TO PV-BARCODE-22                18490021
005871                                     SUT00102-BRCDE-NBR           18500021
005872         END-EVALUATE                                             18510021
005873                                                                  18520021
005874         MOVE DK-OPER-UNT-ID      TO SUT00102-OPER-UNT-ID         18530021
005875         MOVE DK-DIRV-RSN-CDE     TO SUT00102-DIRV-RSN-CDE        18540021
005876                                     PV-DIRV-RSN-CDE              18550021
005877         MOVE DK-PO-NBR           TO SUT00102-PO-NBR              18560021
005878                                     PV-PO-NBR                    18570021
005879         MOVE DK-RCVR-SEQ-NBR     TO SUT00102-RCVR-SEQ-NBR        18580021
005880                                     PV-RCVR-SEQ-NBR              18590021
005881         MOVE DK-PO-LNE-NBR       TO SUT00102-PO-LNE-NBR          18600021
005882                                     PV-PO-LNE-NBR                18610021
005883         MOVE DK-PREPK-ID         TO SUT00102-PREPK-ID            18620021
005884                                     PV-PO-PREPK-ID               18630021
005885         MOVE PV-DIRECTIVE-PORT   TO PV-DIRECTIVE-PORT-N          18640021
005886                                                                  18650021
005887         IF  PV-PRIORITY-IND < 2                                  18660021
005888             MOVE PC-50           TO PV-PRIORITY-IND-N            18670021
005889         ELSE                                                     18680021
005890             MOVE PV-PRIORITY-IND TO PV-PRIORITY-IND-N            18690021
005891         END-IF                                                   18700021
005892                                                                  18710021
005893         MOVE PV-LGCL-LOC-NM-HOLD TO SUT00102-LGCL-LOC-NM         18720021
005894                                     PV-LGCL-LOC-NM               18730021
005895         MOVE SU090-AUD-CNTL-NBR  TO SUT00102-AUD-CNTL-NBR        18740021
005896                                     PV-AUD-CNTL-NBR              18750021
005897         MOVE SU090-AUD-STAT-CDE  TO SUT00102-AUD-STAT-CDE        18760021
005898                                     PV-AUD-STAT-CDE              18770021
005899         MOVE SU090-STR-NBR       TO SUT00102-STR-NBR             18780021
005900                                     PV-STR-NBR                   18790021
005901         MOVE SU090-CALLING-PGM   TO SUT00102-CRE-PGM-NM          18800021
005902         MOVE SU090-CART-STAT-CDE TO SUT00102-CART-STAT-CDE       18810021
005903                                     PV-CART-STAT-CDE             18820021
005904         MOVE SU090-DIRV-RSN-CDE  TO PV-DIRV-RSN-CDE              18830021
005905**GB 7/24/13                                                      18840021
005906         IF  SU090-DIRV-RSN-CDE = PC-RLF                          18850021
005907             MOVE SPACE TO SU090-CASI-CDE                         18860021
005908         ELSE                                                     18870021
005909           IF SU090-DIRV-RSN-CDE  = PC-RFD                        18880021
005910              IF SU090-CASI-CDE =  SPACE OR PC-U                  18890021
005911                 PERFORM 2280-CHECK-CASI-DIRECTV                  18900021
005912              END-IF                                              18910021
005913           END-IF                                                 18920021
005914         END-IF                                                   18930021
005915**GB 7/24/13                                                      18940021
005916         MOVE SU090-CASI-CDE      TO PV-CURR-CASI-CDE             18950021
005917                                     SUT00102-CASI-CDE            18960021
005918         MOVE SU090-AUD-FAIL-RSN  TO SUT00102-AUD-FALR-RSN-NM     18970021
005919                                     PV-AUD-FAIL-RSN              18980021
005920         MOVE SU090-STR-ZN        TO SUT00102-STR-ZN-ID           18990021
005921                                     PV-STR-ZN                    19000021
005922         MOVE SU090-SEASET-YR     TO SUT00102-SEASET-YR           19010021
005923         MOVE SU090-SEASET-CDE    TO SUT00102-SEASET-SHRT-NM      19020021
005924                                     PV-SEASET-CDE                19030021
005925                                                                  19040021
005926         EVALUATE TRUE                                            19050021
005927           WHEN PS-ADD-DIRECTIVE                                  19060021
005928             MOVE PC-ADD          TO PV-ACTN-CDE                  19070021
005929                                     SUT00102-CNVYR-PRC-ACTN-NM   19080021
005930           WHEN PS-DELETE-DIRECTIVE                               19090021
005931             MOVE PC-DELETE       TO PV-ACTN-CDE                  19100021
005932                                     SUT00102-CNVYR-PRC-ACTN-NM   19110021
005933         END-EVALUATE                                             19120021
005934                                                                  19130021
005935         EVALUATE TRUE                                            19140021
005936           WHEN PV-UNIQUE                                         19150021
005937             MOVE PC-UNIQUE       TO PV-UNIQUE-IND                19160021
005938           WHEN PV-NONUNIQUE                                      19170021
005939             MOVE PC-NONUNIQUE    TO PV-UNIQUE-IND                19180021
005940         END-EVALUATE                                             19190021
005941                                                                  19200021
005942         MOVE SU090-ASSOC-ID      TO SUT00102-CRE-BY-USR-ID       19210021
005943                                     PV-ASSOC-ID                  19220021
005944     END-IF.                                                      19230021
005945                                                                  19240021
005946******************************************************************19250021
005947* FETCH DATA TO PROPERLY SET UP THE ADDRESS INFORMATION FOR A    *19260021
005948* DIRECTIVE MESSAGE.                                             *19270021
005949******************************************************************19280021
005950 2210-FETCH-DIRV-ADDR-INFO.                                       19290021
**TEMP*    DISPLAY '2210-FETCH-DIRV-ADDR-INFO'.                         19291039
005951                                                                  19300021
005952     MOVE SU090-OPER-UNT-ID TO DK-OPER-UNT-ID.                    19310021
005953                                                                  19320021
005954     EXEC SQL                                                     19330021
005955         SELECT D.ATTR_ELEM_TXT          AS PUBLISHER_LOCATION    19340021
005956              , E.ATTR_ELEM_TXT          AS PUBLISHER_TYPE        19350021
005957              , F.ATTR_ELEM_TXT          AS SUBSCRIBER_LOCATION   19360021
005958              , G.ATTR_ELEM_TXT          AS SUBSCRIBER_TYPE       19370021
005959              , INTEGER(H.ATTR_ELEM_NBR) AS DIRECTIVE_PORT        19380021
005960           INTO :PV-PUBLISHER-LOCATION                            19390021
005961              , :PV-PUBLISHER-TYPE                                19400021
005962              , :PV-SUBSCRIBER-LOCATION                           19410021
005963              , :PV-SUBSCRIBER-TYPE                               19420021
005964              , :PV-DIRECTIVE-PORT                                19430021
005965           FROM WST_INTGRTN_TYP A                                 19440021
005966              , WST_ATTR_DEFN   B                                 19450021
005967              , WST_ATTR_ELEM   C                                 19460021
005968              , WST_ATTR_ELEM   D                                 19470021
005969              , WST_ATTR_ELEM   E                                 19480021
005970              , WST_ATTR_ELEM   F                                 19490021
005971              , WST_ATTR_ELEM   G                                 19500021
005972              , WST_ATTR_ELEM   H                                 19510021
005973              , WST_ATTR_ELEM   I                                 19520021
005974              , WST_ATTR_ELEM   J                                 19530021
005975              , WST_ATTR_ELEM   K                                 19540021
005976          WHERE A.INTGRTN_TYP_CDE    =  'ACDMDIRCT'               19550021
005977            AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE         19560021
005978            AND A.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE         19570021
005979            AND A.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE         19580021
005980            AND A.INTGRTN_TYP_CDE    =  E.INTGRTN_TYP_CDE         19590021
005981            AND A.INTGRTN_TYP_CDE    =  F.INTGRTN_TYP_CDE         19600021
005982            AND A.INTGRTN_TYP_CDE    =  G.INTGRTN_TYP_CDE         19610021
005983            AND A.INTGRTN_TYP_CDE    =  H.INTGRTN_TYP_CDE         19620021
005984            AND A.INTGRTN_TYP_CDE    =  I.INTGRTN_TYP_CDE         19630021
005985            AND A.INTGRTN_TYP_CDE    =  J.INTGRTN_TYP_CDE         19640021
005986            AND A.INTGRTN_TYP_CDE    =  K.INTGRTN_TYP_CDE         19650021
005987            AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR       19660021
005988            AND C.ATTR_ELEM_SEQ_NBR  =  E.ATTR_ELEM_SEQ_NBR       19670021
005989            AND C.ATTR_ELEM_SEQ_NBR  =  F.ATTR_ELEM_SEQ_NBR       19680021
005990            AND C.ATTR_ELEM_SEQ_NBR  =  G.ATTR_ELEM_SEQ_NBR       19690021
005991            AND C.ATTR_ELEM_SEQ_NBR  =  H.ATTR_ELEM_SEQ_NBR       19700021
005992            AND C.ATTR_ELEM_SEQ_NBR  =  I.ATTR_ELEM_SEQ_NBR       19710021
005993            AND C.ATTR_ELEM_SEQ_NBR  =  J.ATTR_ELEM_SEQ_NBR       19720021
005994            AND C.ATTR_ELEM_SEQ_NBR  =  K.ATTR_ELEM_SEQ_NBR       19730021
005995            AND B.ATTR_DEFN_SEQ_NBR  =  1                         19740021
005996            AND C.ATTR_DEFN_SEQ_NBR  =  1                         19750021
005997            AND D.ATTR_DEFN_SEQ_NBR  =  2                         19760021
005998            AND E.ATTR_DEFN_SEQ_NBR  =  3                         19770021
005999            AND F.ATTR_DEFN_SEQ_NBR  =  4                         19780021
006000            AND G.ATTR_DEFN_SEQ_NBR  =  5                         19790021
006001            AND H.ATTR_DEFN_SEQ_NBR  =  6                         19800021
006002            AND I.ATTR_DEFN_SEQ_NBR  =  7                         19810021
006003            AND J.ATTR_DEFN_SEQ_NBR  =  8                         19820021
006004            AND K.ATTR_DEFN_SEQ_NBR  =  9                         19830021
006005            AND C.ATTR_ELEM_NBR      =  :DK-OPER-UNT-ID           19840021
006006            AND I.ATTR_ELEM_TXT      =  'Y'                       19850021
006007            AND J.ATTR_ELEM_TMST    <=  CURRENT TIMESTAMP         19860021
006008            AND K.ATTR_ELEM_TMST    >=  CURRENT TIMESTAMP         19870021
006009     END-EXEC                                                     19880021
006010                                                                  19890021
006011     EVALUATE TRUE                                                19900021
006012       WHEN SQLCODE = ZERO                                        19910021
006013           CONTINUE                                               19920021
006014                                                                  19930021
006015       WHEN SQLWARN0 NOT EQUAL SPACE                              19940021
006016       WHEN SQLCODE NOT EQUAL ZERO                                19950021
006017           SET SU090-DB2-ERROR       TO TRUE                      19960021
006018           MOVE SQLCODE              TO SU090-SQLCODE             19970021
006019           MOVE SQLCA                TO SU090-SQLCA               19980021
006020           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         19990021
006021           MOVE '2210-FETCH-DIRV-ADDR-INFO'                       20000021
006022                                     TO PV-ABEND-PARAGRAPH        20010021
006023                                        SU090-ERR-PARAGRAPH       20020021
006024           MOVE 'FETCH DIRECTIVE ADDRESS INFORMATION'             20030021
006025                                     TO PV-ABEND-OPER-MESSAGE-1   20040021
006026           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          20050021
006027           STRING 'OPER UNT ID: '    DELIMITED BY SIZE            20060021
006028                  PV-OPER-UNT-ID-DISP                             20070021
006029                                     DELIMITED BY SIZE            20080021
006030                                   INTO PV-ABEND-OPER-MESSAGE-2   20090021
006031           MOVE 'WST_INTGRTN_TYP'    TO PV-ABEND-TABLE-1          20100021
006032           MOVE 'WST_ATTR_DEFN'      TO PV-ABEND-TABLE-2          20110021
006033           MOVE 'WST_ATTR_ELEM'      TO PV-ABEND-TABLE-3          20120021
006034           PERFORM 9900-DB2-ERROR                                 20130021
006035     END-EVALUATE.                                                20140021
006036                                                                  20150021
006037******************************************************************20160021
006038* FETCH VENDOR NAME AND AUDIT DATE.  I AM FETCHING IT INTO        20170021
006039* PV-WORK-DATE SO IT CAN BE REFORMATTED TO MM/DD/YYYY AS          20180021
006040* PV-AUD-DATE TO BE WRITTEN IN THE MESSAGE TO MQ.                 20190021
006041******************************************************************20200021
006042 2220-VEND-NAME-AUD-DATE.                                         20210021
006043                                                                  20220021
006044     IF  SU090-CARTON-DIRECTIVE                                   20230021
006045         MOVE SU090-PO-NBR       TO DK-PO-NBR                     20240021
006046         MOVE SU090-RCVR-SEQ-NBR TO DK-RCVR-SEQ-NBR               20250021
006047         MOVE SU090-PO-LNE-NBR   TO DK-PO-LNE-NBR                 20260021
006048         MOVE SU090-PO-PREPK-ID  TO DK-PREPK-ID                   20270021
006049     ELSE                                                         20280021
006050         MOVE SUT00102-PO-NBR    TO DK-PO-NBR                     20290021
006051         MOVE SUT00102-RCVR-SEQ-NBR                               20300021
006052                                 TO DK-RCVR-SEQ-NBR               20310021
006053         MOVE SUT00102-PO-LNE-NBR                                 20320021
006054                                 TO DK-PO-LNE-NBR                 20330021
006055         MOVE SUT00102-PREPK-ID  TO DK-PREPK-ID                   20340021
006056     END-IF.                                                      20350021
006057                                                                  20360021
006058**** GET PROMPTED AUDIT DATE                                      20370021
006059                                                                  20380021
006060     EXEC SQL                                                     20390021
006061         SELECT DATE(CRE_TMST)                                    20400021
006062           INTO :PV-WORK-DATE                                     20410021
006063           FROM SUT_PO_AUD_REQ                                    20420021
006064          WHERE PO_NBR        =  :DK-PO-NBR                       20430021
006065            AND RCVR_SEQ_NBR  =  :DK-RCVR-SEQ-NBR                 20440021
006066            AND PO_LNE_NBR    =  :DK-PO-LNE-NBR                   20450021
006067            AND PO_PREPK_ID   =  :DK-PREPK-ID                     20460021
006068            AND OPER_UNT_ID   =  :DK-OPER-UNT-ID                  20470021
006069     END-EXEC.                                                    20480021
006070                                                                  20490021
006071     EVALUATE TRUE                                                20500021
006072       WHEN SQLCODE = ZERO                                        20510021
006073           MOVE PV-WORK-DATE-MONTH   TO PV-AUD-DATE-MONTH         20520021
006074           MOVE PV-WORK-DATE-DAY     TO PV-AUD-DATE-DAY           20530021
006075           MOVE PV-WORK-DATE-YEAR    TO PV-AUD-DATE-YEAR          20540021
006076           MOVE '/'                  TO PV-AUD-DATE-SL1           20550021
006077                                        PV-AUD-DATE-SL2           20560021
006078                                                                  20570021
006079       WHEN SQLCODE = +100                                        20580021
006080           MOVE SPACES               TO PV-AUD-DATE               20590021
006081                                                                  20600021
006082       WHEN SQLWARN0 NOT EQUAL SPACE                              20610021
006083       WHEN SQLCODE NOT EQUAL ZERO                                20620021
006084           SET SU090-DB2-ERROR       TO TRUE                      20630021
006085           MOVE SQLCODE              TO SU090-SQLCODE             20640021
006086           MOVE SQLCA                TO SU090-SQLCA               20650021
006087           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         20660021
006088           MOVE '2220-VEND-NAME-AUD-DATE'                         20670021
006089                                     TO PV-ABEND-PARAGRAPH        20680021
006090                                        SU090-ERR-PARAGRAPH       20690021
006091           MOVE 'FETCH AUDIT DATE'                                20700021
006092                                     TO PV-ABEND-OPER-MESSAGE-1   20710021
006093           MOVE DK-PO-NBR            TO PV-PO-NBR-N               20720021
006094           MOVE DK-RCVR-SEQ-NBR      TO PV-RCVR-SEQ-NBR-N         20730021
006095           MOVE DK-PO-LNE-NBR        TO PV-PO-LNE-NBR-N           20740021
006096           MOVE DK-PREPK-ID          TO PV-PREPK-ID-N             20750021
006097           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          20760021
006098           STRING 'OPER UNT ID: '    DELIMITED BY SIZE            20770021
006099                  PV-OPER-UNT-ID-DISP                             20780021
006100                                     DELIMITED BY SIZE            20790021
006101                  '   PO NBR: '      DELIMITED BY SIZE            20800021
006102                  PV-PO-NBR-DISP     DELIMITED BY SIZE            20810021
006103                  '   RCVR SEQ NBR: '                             20820021
006104                                     DELIMITED BY SIZE            20830021
006105                  PV-RCVR-SEQ-NBR-DISP                            20840021
006106                                     DELIMITED BY SIZE            20850021
006107                                   INTO PV-ABEND-OPER-MESSAGE-2   20860021
006108           STRING 'PO LNE NBR: '     DELIMITED BY SIZE            20870021
006109                  PV-PO-LNE-NBR-DISP                              20880021
006110                                     DELIMITED BY SIZE            20890021
006111                  '   PREPK ID: '    DELIMITED BY SIZE            20900021
006112                  PV-PREPK-ID-DISP   DELIMITED BY SIZE            20910021
006113                                   INTO PV-ABEND-OPER-MESSAGE-3   20920021
006114           MOVE 'SUT_PO_AUD_REQ'     TO PV-ABEND-TABLE-1          20930021
006115           PERFORM 9900-DB2-ERROR                                 20940021
006116     END-EVALUATE.                                                20950021
006117                                                                  20960021
006118**** GET VENDOR NAME                                              20970021
006119                                                                  20980021
006120     EXEC SQL                                                     20990021
006121         SELECT B.ENT_NAME_DESC                                   21000021
006122           INTO :ENTNME-ENT-NAME-DESC                             21010021
006123           FROM TPURCHS  A                                        21020021
006124              , TENTNME  B                                        21030021
006125          WHERE A.ENT_ID             =  B.ENT_ID                  21040021
006126            AND A.PO_NBR             =  :DK-PO-NBR                21050021
006127            AND A.VER_STATUS_CDE     =  'A'                       21060021
006128            AND B.TYPE_CDE           =  '01'                      21070021
006129     END-EXEC.                                                    21080021
006130                                                                  21090021
006131     EVALUATE TRUE                                                21100021
006132       WHEN SQLCODE = ZERO                                        21110021
006133           CONTINUE                                               21120021
006134                                                                  21130021
006135       WHEN SQLCODE = +100                                        21140021
006136           MOVE 'NOT FOUND'          TO ENTNME-ENT-NAME-DESC      21150021
006137                                                                  21160021
006138       WHEN SQLWARN0 NOT EQUAL SPACE                              21170021
006139       WHEN SQLCODE NOT EQUAL ZERO                                21180021
006140           SET SU090-DB2-ERROR       TO TRUE                      21190021
006141           MOVE SQLCODE              TO SU090-SQLCODE             21200021
006142           MOVE SQLCA                TO SU090-SQLCA               21210021
006143           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         21220021
006144           MOVE '2220-VEND-NAME-AUD-DATE'                         21230021
006145                                     TO PV-ABEND-PARAGRAPH        21240021
006146                                        SU090-ERR-PARAGRAPH       21250021
006147           MOVE 'FETCH VENDOR NAME AND AUDIT DATE'                21260021
006148                                     TO PV-ABEND-OPER-MESSAGE-1   21270021
006149           MOVE DK-PO-NBR            TO PV-PO-NBR-N               21280021
006150           STRING '   PO NBR: '      DELIMITED BY SIZE            21290021
006151                  PV-PO-NBR-DISP     DELIMITED BY SIZE            21300021
006152                                   INTO PV-ABEND-OPER-MESSAGE-2   21310021
006153           MOVE 'TPURCHS'            TO PV-ABEND-TABLE-1          21320021
006154           MOVE 'TENTNME'            TO PV-ABEND-TABLE-2          21330021
006155           PERFORM 9900-DB2-ERROR                                 21340021
006156     END-EVALUATE.                                                21350021
006157                                                                  21360021
006158******************************************************************21370021
006159* FETCH THE ACKNOWLEDGEMENT SEQUENCE NUMBER USING THE            *21380021
006160* DB2 SEQUENCE 'MSGACK' AND DB2 FUNCTION 'NEXTVAL'.              *21390021
006161*                                                                *21400021
006162* FETCH THE CURRENT TIMESTAMP.  WE NEED TO FETCH THE CURRENT     *21410021
006163* TIMESTAMP BEFORE WE WRITE A MESSAGE TO MQ AND INSERT A ROW     *21420021
006164* OF DATA INTO SUT_CART_DIRV_TRKG.  THE TIMESTAMP MUST BE THE    *21430021
006165* SAME BETWEEN THE MQ ROW AND THE DB2 ROW THAT WE WRITE.         *21440021
006166******************************************************************21450021
006167 2230-GET-ACKNL-SEQ-CURR-TMST.                                    21460021
**TEMP*    DISPLAY '2230-GET-ACKNL-SEQ-CURR-TMST'.                      21461039
006168                                                                  21470021
006169     EXEC SQL                                                     21480021
006170         SELECT NEXTVAL FOR SEQUENCE                              21490021
006171               ,CURRENT TIMESTAMP                                 21500021
006172           INTO :PV-ACKNL-SEQ-NBR                                 21510021
006173               ,:PV-CURRENT-TMST                                  21520021
006174           FROM SYSIBM.SYSDUMMY1                                  21530021
006175          WHERE IBMREQD = 'Y'                                     21540021
006176     END-EXEC                                                     21550021
006177                                                                  21560021
006178     EVALUATE TRUE                                                21570021
006179       WHEN SQLCODE = ZERO                                        21580021
006180           MOVE PV-CURRENT-TMST      TO PV-TIMESTAMP              21590021
006181                                        SUT00102-CRE-TMST         21600021
006182           MOVE PV-TIMESTAMP-MONTH   TO PV-SEND-DATE-MONTH        21610021
006183           MOVE PV-TIMESTAMP-DAY     TO PV-SEND-DATE-DAY          21620021
006184           MOVE PV-TIMESTAMP-YEAR    TO PV-SEND-DATE-YEAR         21630021
006185           MOVE PV-TIMESTAMP-HOUR    TO PV-SEND-TIME-HOUR         21640021
006186           MOVE PV-TIMESTAMP-MINUTE  TO PV-SEND-TIME-MINUTE       21650021
006187           MOVE PV-TIMESTAMP-SECOND  TO PV-SEND-TIME-SECOND       21660021
006188           MOVE PV-TIMESTAMP-NANO    TO PV-SEND-TIME-NANO         21670021
006189           MOVE PV-ACKNL-SEQ-NBR     TO PV-ACKNL-SEQ-NBR-N        21680021
006190                                        SUT00102-ACKNL-SEQ-NBR    21690021
006191                                                                  21700021
006192       WHEN SQLWARN0 NOT EQUAL SPACE                              21710021
006193       WHEN SQLCODE NOT EQUAL ZERO                                21720021
006194           SET SU090-DB2-ERROR       TO TRUE                      21730021
006195           MOVE SQLCODE              TO SU090-SQLCODE             21740021
006196           MOVE SQLCA                TO SU090-SQLCA               21750021
006197           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         21760021
006198           MOVE '2230-GET-ACKNL-SEQ-CURR-TMST'                    21770021
006199                                     TO PV-ABEND-PARAGRAPH        21780021
006200                                        SU090-ERR-PARAGRAPH       21790021
006201           MOVE 'FETCH THE ACKNOWLEDGEMENT SEQUENCE NUMBER'       21800021
006202                                     TO PV-ABEND-OPER-MESSAGE-1   21810021
006203           MOVE 'AND THE CURRENT TIMESTAMP'                       21820021
006204                                     TO PV-ABEND-OPER-MESSAGE-2   21830021
006205           PERFORM 9900-DB2-ERROR                                 21840021
006206     END-EVALUATE.                                                21850021
006207                                                                  21860021
006208******************************************************************21870021
006209* SET UP THE VARIABLES FROM THE MOST RECENT DIRECTIVE MESSAGE.   *21880021
006210******************************************************************21890021
006211 2240-SET-VAR-FROM-PRIOR-DIRV.                                    21900021
**TEMP*    DISPLAY '2240-SET-VAR-FROM-PRIOR-DIRV'.                      21901039
006212     IF  SU090-SUCCESS                                            21910021
006213         PERFORM 2210-FETCH-DIRV-ADDR-INFO                        21920021
006214     END-IF.                                                      21930021
006215                                                                  21940021
006216     IF  SU090-SUCCESS                                            21950021
006217         PERFORM 2220-VEND-NAME-AUD-DATE                          21960021
006218     END-IF.                                                      21970021
006219                                                                  21980021
006220     IF  SU090-SUCCESS                                            21990021
006221         MOVE SUT00102-BRCDE-NBR  TO PV-BARCODE-22                22000021
006222         MOVE SUT00102-PO-NBR     TO PV-PO-NBR                    22010021
006223         MOVE SUT00102-RCVR-SEQ-NBR                               22020021
006224                                  TO PV-RCVR-SEQ-NBR              22030021
006225         MOVE SUT00102-PO-LNE-NBR TO PV-PO-LNE-NBR                22040021
006226         MOVE SUT00102-PREPK-ID   TO PV-PO-PREPK-ID               22050021
006227         MOVE SUT00102-DIRV-RSN-CDE                               22060021
006228                                  TO PV-DIRV-RSN-CDE              22070021
006229         MOVE SUT00102-CASI-CDE   TO PV-CURR-CASI-CDE             22080021
006230         MOVE SUT00102-CART-STAT-CDE                              22090021
006231                                  TO PV-CART-STAT-CDE             22100021
006232         MOVE PV-DIRECTIVE-PORT   TO PV-DIRECTIVE-PORT-N          22110021
006233                                                                  22120021
006234         IF  PV-PRIORITY-IND < 2                                  22130021
006235             MOVE PC-50           TO PV-PRIORITY-IND-N            22140021
006236         ELSE                                                     22150021
006237             MOVE PV-PRIORITY-IND TO PV-PRIORITY-IND-N            22160021
006238         END-IF                                                   22170021
006239                                                                  22180021
006240         IF  PS-DELETE-DIRECTIVE                                  22190021
006241             MOVE PC-ALL          TO SUT00102-LGCL-LOC-NM         22200021
006242                                     PV-LGCL-LOC-NM               22210021
006243         ELSE                                                     22220021
006244             MOVE PV-LGCL-LOC-NM-HOLD                             22230021
006245                                  TO SUT00102-LGCL-LOC-NM         22240021
006246                                     PV-LGCL-LOC-NM               22250021
006247         END-IF                                                   22260021
006248                                                                  22270021
006249         MOVE SUT00102-AUD-CNTL-NBR                               22280021
006250                                  TO PV-AUD-CNTL-NBR              22290021
006251         MOVE SUT00102-AUD-STAT-CDE                               22300021
006252                                  TO PV-AUD-STAT-CDE              22310021
006253         MOVE SUT00102-STR-NBR    TO PV-STR-NBR                   22320021
006254         MOVE PC-CURRENT-PROGRAM-NAME                             22330021
006255                                  TO SUT00102-CRE-PGM-NM          22340021
006256         MOVE SU090-ASSOC-ID      TO SUT00102-CRE-BY-USR-ID       22350021
006257                                     PV-ASSOC-ID                  22360021
006258         MOVE SUT00102-AUD-FALR-RSN-NM                            22370021
006259                                  TO PV-AUD-FAIL-RSN              22380021
006260         MOVE SUT00102-STR-ZN-ID  TO PV-STR-ZN                    22390021
006261         MOVE SUT00102-SEASET-SHRT-NM                             22400021
006262                                  TO PV-SEASET-CDE                22410021
006263         EVALUATE TRUE                                            22420021
006264           WHEN PV-UNIQUE                                         22430021
006265             MOVE PC-UNIQUE       TO PV-UNIQUE-IND                22440021
006266           WHEN PV-NONUNIQUE                                      22450021
006267             MOVE PC-NONUNIQUE    TO PV-UNIQUE-IND                22460021
006268         END-EVALUATE                                             22470021
006269     END-IF.                                                      22480021
006270                                                                  22490021
006271******************************************************************22500021
006272* OVERLAY THE DIRECTIVE HISTORY TABLE AND DIRECTIVE MESSAGE      *22510021
006273* FIELDS WITH CERTAIN REQUIRED COMMUNICATION AREA FIELDS.        *22520021
006274*                                                                *22530021
006275* THESE MOVES ARE DONE HERE, THOUGH THEY MAY HAVE BEEN DONE      *22540021
006276* ELSEWHERE, TO ENSURE THESE VALUES ARE PROPERLY PASSED ON THE   *22550021
006277* DIRECTIVE.                                                     *22560021
006278******************************************************************22570021
006279 2250-SET-REQUIRED-CA-FIELDS.                                     22580021
006280                                                                  22590021
006281     MOVE SU090-CALLING-PGM   TO  SUT00102-CRE-PGM-NM.            22600021
006282     MOVE SU090-DIRV-RSN-CDE  TO  PV-DIRV-RSN-CDE                 22610021
006283                                  SUT00102-DIRV-RSN-CDE.          22620021
006284**GB 7/24/13                                                      22630021
006285     IF  SU090-DIRV-RSN-CDE = PC-RLF                              22640021
006286         MOVE SPACE TO SU090-CASI-CDE                             22650021
006287     ELSE                                                         22660021
006288       IF SU090-DIRV-RSN-CDE  = PC-RFD                            22670021
006289          IF SU090-CASI-CDE =  SPACE OR PC-U                      22680021
006290             PERFORM 2280-CHECK-CASI-DIRECTV                      22690021
006291          END-IF                                                  22700021
006292       END-IF                                                     22710021
006293     END-IF                                                       22720021
006294**GB 7/24/13                                                      22730021
006295                                                                  22740021
006296     MOVE SU090-CASI-CDE      TO  PV-CURR-CASI-CDE                22750021
006297                                  SUT00102-CASI-CDE.              22760021
006298     MOVE SU090-AUD-STAT-CDE  TO  PV-AUD-STAT-CDE                 22770021
006299                                  SUT00102-AUD-STAT-CDE.          22780021
006300**SLH 02/10/09  IR 18506                                          22790021
006301**GB  01/22/14 BEG                                                22800021
006302     IF SU090-RFID-AUD-DIR-YES                                    22810021
006303         MOVE SU090-RFID-AUD-CNTL-NBR TO SUT00102-AUD-CNTL-NBR    22820021
006304                                         PV-AUD-CNTL-NBR          22830021
006305     ELSE                                                         22840021
006306         MOVE SU090-AUD-CNTL-NBR  TO  SUT00102-AUD-CNTL-NBR       22850021
006307                                      PV-AUD-CNTL-NBR             22860021
006308     END-IF.                                                      22870021
006309**GB  01/22/14 END                                                22880021
006310**SLH 02/10/09  IR 18506                                          22890021
006311     MOVE SU090-AUD-FAIL-RSN  TO  PV-AUD-FAIL-RSN                 22900021
006312                                  SUT00102-AUD-FALR-RSN-NM.       22910021
006313     MOVE SU090-ASSOC-ID      TO  PV-ASSOC-ID                     22920021
006314                                  SUT00102-CRE-BY-USR-ID.         22930021
006315                                                                  22940021
006316                                                                  22950021
006317******************************************************************22960021
006318* CHECK TO SEE IF WE ARE CHECKING IF THE PREVIOUS MISSION WAS A  *22970021
006319* RLO - RELEASE ONLINE                                          *22980021
006320* ADDED - DMH - 7/29/10                                           22990021
006321******************************************************************23000021
006322 2270-CHECK-DELETE-PARM.                                          23010021
006323                                                                  23020021
006324     EXEC SQL                                                     23030021
006325         SELECT FUNC_TXT                                          23040021
006326           INTO :KRPRPM-FUNC-TXT                                  23050021
006327           FROM TKRPRPM                                           23060021
006328          WHERE LOC_ID               =   90                       23070021
006329            AND INTFC_SYS_CDE        =  'KHL'                     23080021
006330            AND SYS_PRC_FUNC_CDE     =  'ACDRDL'                  23090021
006331            AND FUNC_PRC_STAT_CDE    =  'AC'                      23100021
006332            AND FUNC_BEG_TMST       <=   CURRENT TIMESTAMP        23110021
006333            AND FUNC_END_TMST       >=   CURRENT TIMESTAMP        23120021
006334     END-EXEC.                                                    23130021
006335                                                                  23140021
006336     EVALUATE TRUE                                                23150021
006337       WHEN SQLCODE = ZERO                                        23160021
006338            MOVE  KRPRPM-FUNC-TXT  TO PS-CHECK-DELETE-SW          23170021
006339       WHEN SQLCODE = +100                                        23180021
006340            SET  PS-CHECK-DELETE-NO  TO  TRUE                     23190021
006341                                                                  23200021
006342       WHEN SQLWARN0 NOT EQUAL SPACE                              23210021
006343       WHEN SQLCODE NOT EQUAL ZERO                                23220021
006344           SET SU090-DB2-ERROR       TO TRUE                      23230021
006345           MOVE SQLCODE              TO SU090-SQLCODE             23240021
006346           MOVE SQLCA                TO SU090-SQLCA               23250021
006347           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         23260021
006348           MOVE '2270-CHECK-DELETE-PARM '                         23270021
006349                                     TO PV-ABEND-PARAGRAPH        23280021
006350                                        SU090-ERR-PARAGRAPH       23290021
006351           MOVE 'SELECT TKRPRPM - ACDRDL         '                23300021
006352                                     TO PV-ABEND-OPER-MESSAGE-1   23310021
006353           MOVE 'TKRPRPM'            TO PV-ABEND-TABLE-1          23320021
006354           PERFORM 9900-DB2-ERROR                                 23330021
006355     END-EVALUATE.                                                23340021
006356                                                                  23350021
006357                                                                  23360021
006358******************************************************************23370021
006359* CHECK TO SEE IF WE ARE CHECKING IF THE PREVIOUS MISSION WAS A  *23380021
006360* RLO - RELEASE ONLINE                                          *23390021
006361* ADDED - DMH - 7/29/10                                           23400021
006362******************************************************************23410021
006363 2280-CHECK-CASI-DIRECTV.                                         23420021
006364                                                                  23430021
006365     EXEC SQL                                                     23440021
006366         SELECT FUNC_TXT                                          23450021
006367           INTO :PV-CASI-TXT                                      23460021
006368           FROM TKRPRPM                                           23470021
006369          WHERE LOC_ID               =   :DK-OPER-UNT-ID          23480021
006370            AND INTFC_SYS_CDE        =  'KHL'                     23490021
006371            AND SYS_PRC_FUNC_CDE     =  'RFDCSI'                  23500021
006372            AND FUNC_PRC_STAT_CDE    =  'AC'                      23510021
006373            AND FUNC_BEG_TMST       <=   CURRENT TIMESTAMP        23520021
006374            AND FUNC_END_TMST       >=   CURRENT TIMESTAMP        23530021
006375     END-EXEC.                                                    23540021
006376                                                                  23550021
006377     EVALUATE TRUE                                                23560021
006378       WHEN SQLCODE = ZERO                                        23570021
006379            MOVE  PV-CASI-TXT      TO SU090-CASI-CDE              23580021
006380       WHEN SQLCODE = +100                                        23590021
006381            CONTINUE                                              23600021
006382                                                                  23610021
006383       WHEN SQLWARN0 NOT EQUAL SPACE                              23620021
006384       WHEN SQLCODE NOT EQUAL ZERO                                23630021
006385           SET SU090-DB2-ERROR       TO TRUE                      23640021
006386           MOVE SQLCODE              TO SU090-SQLCODE             23650021
006387           MOVE SQLCA                TO SU090-SQLCA               23660021
006388           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         23670021
006389           MOVE '2280-CHECK-CASI-DIRECTV'                         23680021
006390                                     TO PV-ABEND-PARAGRAPH        23690021
006391                                        SU090-ERR-PARAGRAPH       23700021
006392           MOVE 'SELECT TKRPRPM - ACDRDL         '                23710021
006393                                     TO PV-ABEND-OPER-MESSAGE-1   23720021
006394           MOVE 'TKRPRPM'            TO PV-ABEND-TABLE-1          23730021
006395           PERFORM 9900-DB2-ERROR                                 23740021
006396     END-EVALUATE.                                                23750021
006397                                                                  23760021
006398                                                                  23770021
006399******************************************************************23780021
006400* FETCH DATA THAT WILL BE USED TO BUILD THE DIRECTIVE MESSAGE.   *23790021
006401******************************************************************23800021
006402 2300-BUILD-DIRECTIVE-MSG.                                        23810021
**TEMP*    DISPLAY '2300-BUILD-DIRECTIVE-MSG'.                          23811039
006403     PERFORM 2310-REMOVE-SPACES-AND-ZEROS.                        23820021
006404                                                                  23830021
006405     MOVE SPACES TO PV-CARET-TRIMMED-RECORD.                      23840021
006406     MOVE 1      TO PV-POINTER.                                   23850021
006407                                                                  23860021
006408     STRING PC-START-OF-TEXT                                      23870021
006409            PV-PUBLISHER-LOCATION (1:PV-PUB-LOC-LGTH)     PC-CARET23880021
006410            PV-PUBLISHER-TYPE (1:PV-PUB-TYP-LGTH)         PC-CARET23890021
006411            PV-SUBSCRIBER-LOCATION (1:PV-SUB-LOC-LGTH)    PC-COLON23900021
006412            PV-DIRECTIVE-PORT-X (PV-DIRECTIVE-PORT-STRT:          23910021
006413                                 PV-DIRECTIVE-PORT-LGTH)          23920021
006414                                                          PC-CARET23930021
006415            PV-SUBSCRIBER-TYPE (1:PV-SUB-TYP-LGTH)        PC-CARET23940021
006416            PC-MARRIAGEMISSION                            PC-CARET23950021
006417            PV-ACKNL-SEQ-NBR-X (PV-ACKNL-SEQ-NBR-STRT:            23960021
006418                                PV-ACKNL-SEQ-NBR-LGTH)            23970021
006419                                                          PC-CARET23980021
006420            PC-MARRIAGEMISSION                            PC-CARET23990021
006421            PV-ACTN-CDE (1:PV-ACTN-CDE-LGTH)              PC-CARET24000021
006422            PV-BARCODE-22 (1:PV-BRCDE-NBR-LGTH)           PC-CARET24010021
006423                                                          PC-CARET24020021
006424            PV-PO-NBR-X (PV-PO-NBR-STRT:PV-PO-NBR-LGTH)           24030021
006425                                                          PC-CARET24040021
006426            PV-RCVR-SEQ-NBR-X (PV-RCVR-SEQ-NBR-STRT:              24050021
006427                               PV-RCVR-SEQ-NBR-LGTH)              24060021
006428                                                          PC-CARET24070021
006429                                                          PC-CARET24080021
006430                                                          PC-CARET24090021
006431                                                          PC-CARET24100021
006432                                                          PC-CARET24110021
006433                                                          PC-CARET24120021
006434                                                          PC-CARET24130021
006435            PV-PRIORITY-IND-X (PV-PRIORITY-IND-STRT:              24140021
006436                               PV-PRIORITY-IND-LGTH)              24150021
006437                                                          PC-CARET24160021
006438            PV-UNIQUE-IND (1:PV-UNIQUE-IND-LGTH)          PC-CARET24170021
006439            PV-DIRV-RSN-CDE (1:PV-DIRV-RSN-LGTH)          PC-CARET24180021
006440            PV-ORIG-CASI-CDE                              PC-CARET24190021
006441            PV-CURR-CASI-CDE                              PC-CARET24200021
006442            PV-CART-STAT-CDE                              PC-CARET24210021
006443            PV-AUD-CNTL-NBR-X (PV-AUD-CNTL-NBR-STRT:              24220021
006444                               PV-AUD-CNTL-NBR-LGTH)              24230021
006445                                                          PC-CARET24240021
006446            PV-AUD-STAT-CDE                               PC-CARET24250021
006447            PV-AUD-FAIL-RSN (1:PV-AUD-RSN-LGTH)           PC-CARET24260021
006448            PV-AUD-DATE                                   PC-CARET24270021
006449            PV-PO-LNE-NBR-X (PV-PO-LNE-NBR-STRT:                  24280021
006450                             PV-PO-LNE-NBR-LGTH)                  24290021
006451                                                          PC-CARET24300021
006452            PV-PO-PREPK-ID-X (PV-PO-PREPK-ID-STRT:                24310021
006453                              PV-PO-PREPK-ID-LGTH)                24320021
006454                                                          PC-CARET24330021
006455            PV-STR-ZN (1:PV-STR-ZN-LGTH)                  PC-CARET24340021
006456            ENTNME-ENT-NAME-DESC (1:PV-ENT-NME-LGTH)      PC-CARET24350021
006457            PV-SEASET-CDE (1:PV-SEASET-LGTH)              PC-CARET24360021
006458            PV-STR-NBR-X (PV-STR-NBR-STRT:PV-STR-NBR-LGTH)        24370021
006459                                                          PC-CARET24380021
006460            PV-ASSOC-ID (1:PV-ASSOC-ID-LGTH)              PC-CARET24390021
006461            PV-SEND-DATE                                  PC-CARET24400021
006462            PV-SEND-TIME                                  PC-CARET24410021
006463            PC-1                                          PC-CARET24420021
006464            PV-LGCL-LOC-NM (1:PV-LGCL-LOC-NM-LGTH)                24430021
006465            PC-END-OF-TEXT                                        24440021
006466            DELIMITED BY SIZE                                     24450021
006467            INTO PV-CARET-TRIMMED-RECORD                          24460021
006468              WITH POINTER PV-POINTER.                            24470021
006469                                                                  24480021
006470     COMPUTE PV-CARET-TRIMMED-REC-LGTH = PV-POINTER - 1.          24490021
006471                                                                  24500021
006472****************************************************************  24510021
006473*    THIS CODE WILL SET UP THE VARIBLES NEEDED TO CALL THE     *  24520021
006474*    PARAGRAPH THAT ACTUALLY REMOVES SPACES FROM THE END OF    *  24530021
006475*    THE CHARACTER FIELD.  THIS CODE WILL ALSO SET UP THE      *  24540021
006476*    VARIABLES NEEDED TO CALL THE PARAGRAPH THAT REMOVES THE   *  24550021
006477*    LEADING ZEROS FROM THE BEGINNING OF NUMERIC FIELDS.       *  24560021
006478****************************************************************  24570021
006479 2310-REMOVE-SPACES-AND-ZEROS.                                    24580021
006480                                                                  24590021
006481**THIS SECTION OF CODE IS FOR REMOVING TRAILING SPACES            24600021
006482**                                                                24610021
006483     MOVE LENGTH OF PV-PUBLISHER-LOCATION  TO PV-FIELD-LGTH.      24620021
006484     MOVE PV-PUBLISHER-LOCATION            TO PV-WORK-FIELD.      24630021
006485     PERFORM 2320-TRIM-FIELDS.                                    24640021
006486     MOVE PV-POSITION                      TO PV-PUB-LOC-LGTH.    24650021
006487                                                                  24660021
006488     MOVE LENGTH OF PV-PUBLISHER-TYPE      TO PV-FIELD-LGTH.      24670021
006489     MOVE PV-PUBLISHER-TYPE                TO PV-WORK-FIELD.      24680021
006490     PERFORM 2320-TRIM-FIELDS.                                    24690021
006491     MOVE PV-POSITION                      TO PV-PUB-TYP-LGTH.    24700021
006492                                                                  24710021
006493     MOVE LENGTH OF PV-SUBSCRIBER-LOCATION TO PV-FIELD-LGTH.      24720021
006494     MOVE PV-SUBSCRIBER-LOCATION           TO PV-WORK-FIELD.      24730021
006495     PERFORM 2320-TRIM-FIELDS.                                    24740021
006496     MOVE PV-POSITION                      TO PV-SUB-LOC-LGTH.    24750021
006497                                                                  24760021
006498     MOVE LENGTH OF PV-SUBSCRIBER-TYPE     TO PV-FIELD-LGTH.      24770021
006499     MOVE PV-SUBSCRIBER-TYPE               TO PV-WORK-FIELD.      24780021
006500     PERFORM 2320-TRIM-FIELDS.                                    24790021
006501     MOVE PV-POSITION                      TO PV-SUB-TYP-LGTH.    24800021
006502                                                                  24810021
006503     MOVE LENGTH OF PV-ACTN-CDE            TO PV-FIELD-LGTH.      24820021
006504     MOVE PV-ACTN-CDE                      TO PV-WORK-FIELD.      24830021
006505     PERFORM 2320-TRIM-FIELDS.                                    24840021
006506     MOVE PV-POSITION                      TO PV-ACTN-CDE-LGTH.   24850021
006507                                                                  24860021
006508     MOVE LENGTH OF PV-BARCODE-22          TO PV-FIELD-LGTH.      24870021
006509     MOVE PV-BARCODE-22                    TO PV-WORK-FIELD.      24880021
006510     PERFORM 2320-TRIM-FIELDS.                                    24890021
006511     MOVE PV-POSITION                      TO PV-BRCDE-NBR-LGTH.  24900021
006512                                                                  24910021
006513     MOVE LENGTH OF PV-UNIQUE-IND          TO PV-FIELD-LGTH.      24920021
006514     MOVE PV-UNIQUE-IND                    TO PV-WORK-FIELD.      24930021
006515     PERFORM 2320-TRIM-FIELDS.                                    24940021
006516     MOVE PV-POSITION                      TO PV-UNIQUE-IND-LGTH. 24950021
006517                                                                  24960021
006518     MOVE LENGTH OF PV-DIRV-RSN-CDE        TO PV-FIELD-LGTH.      24970021
006519     MOVE PV-DIRV-RSN-CDE                  TO PV-WORK-FIELD.      24980021
006520     PERFORM 2320-TRIM-FIELDS.                                    24990021
006521     MOVE PV-POSITION                      TO PV-DIRV-RSN-LGTH.   25000021
006522                                                                  25010021
006523     MOVE LENGTH OF PV-AUD-FAIL-RSN        TO PV-FIELD-LGTH.      25020021
006524     MOVE PV-AUD-FAIL-RSN                  TO PV-WORK-FIELD.      25030021
006525     PERFORM 2320-TRIM-FIELDS.                                    25040021
006526     MOVE PV-POSITION                      TO PV-AUD-RSN-LGTH.    25050021
006527                                                                  25060021
006528     MOVE LENGTH OF PV-STR-ZN              TO PV-FIELD-LGTH.      25070021
006529     MOVE PV-STR-ZN                        TO PV-WORK-FIELD.      25080021
006530     PERFORM 2320-TRIM-FIELDS.                                    25090021
006531     MOVE PV-POSITION                      TO PV-STR-ZN-LGTH.     25100021
006532                                                                  25110021
006533     PERFORM 2321-SCRUB-VENDOR-NAME.                              25120021
006534     MOVE LENGTH OF ENTNME-ENT-NAME-DESC   TO PV-FIELD-LGTH.      25130021
006535     MOVE ENTNME-ENT-NAME-DESC             TO PV-WORK-FIELD.      25140021
006536     PERFORM 2320-TRIM-FIELDS.                                    25150021
006537     MOVE PV-POSITION                      TO PV-ENT-NME-LGTH.    25160021
006538                                                                  25170021
006539     MOVE LENGTH OF PV-SEASET-CDE          TO PV-FIELD-LGTH.      25180021
006540     MOVE PV-SEASET-CDE                    TO PV-WORK-FIELD.      25190021
006541     PERFORM 2320-TRIM-FIELDS.                                    25200021
006542     MOVE PV-POSITION                      TO PV-SEASET-LGTH.     25210021
006543                                                                  25220021
006544     MOVE LENGTH OF PV-ASSOC-ID            TO PV-FIELD-LGTH.      25230021
006545     MOVE PV-ASSOC-ID                      TO PV-WORK-FIELD.      25240021
006546     PERFORM 2320-TRIM-FIELDS.                                    25250021
006547     MOVE PV-POSITION                      TO PV-ASSOC-ID-LGTH.   25260021
006548                                                                  25270021
006549     MOVE LENGTH OF PV-LGCL-LOC-NM         TO PV-FIELD-LGTH.      25280021
006550     MOVE PV-LGCL-LOC-NM                   TO PV-WORK-FIELD.      25290021
006551     PERFORM 2320-TRIM-FIELDS.                                    25300021
006552     MOVE PV-POSITION                      TO PV-LGCL-LOC-NM-LGTH.25310021
006553                                                                  25320021
006554**THIS SECTION OF CODE IS FOR REMOVING LEADING ZEROS              25330021
006555**                                                                25340021
006556     MOVE LENGTH OF PV-ACKNL-SEQ-NBR-X     TO PV-FIELD-LGTH.      25350021
006557     MOVE PV-ACKNL-SEQ-NBR-X               TO PV-WORK-FIELD.      25360021
006558     PERFORM 2330-REMOVE-LEADING-ZEROS.                           25370021
006559     MOVE PV-POSITION                    TO PV-ACKNL-SEQ-NBR-STRT.25380021
006560     IF  PV-FIELD-LGTH = PV-ACKNL-SEQ-NBR-STRT                    25390021
006561         MOVE 1                          TO PV-ACKNL-SEQ-NBR-LGTH 25400021
006562     ELSE                                                         25410021
006563         COMPUTE PV-ACKNL-SEQ-NBR-LGTH =                          25420021
006564                                       (PV-FIELD-LGTH -           25430021
006565                                        PV-ACKNL-SEQ-NBR-STRT) + 125440021
006566     END-IF.                                                      25450021
006567                                                                  25460021
006568     MOVE LENGTH OF PV-DIRECTIVE-PORT-X    TO PV-FIELD-LGTH.      25470021
006569     MOVE PV-DIRECTIVE-PORT-X              TO PV-WORK-FIELD.      25480021
006570     PERFORM 2330-REMOVE-LEADING-ZEROS.                           25490021
006571     MOVE PV-POSITION                   TO PV-DIRECTIVE-PORT-STRT.25500021
006572     IF  PV-FIELD-LGTH = PV-DIRECTIVE-PORT-STRT                   25510021
006573         MOVE 1                         TO PV-DIRECTIVE-PORT-LGTH 25520021
006574     ELSE                                                         25530021
006575         COMPUTE PV-DIRECTIVE-PORT-LGTH =                         25540021
006576                                      (PV-FIELD-LGTH -            25550021
006577                                       PV-DIRECTIVE-PORT-STRT) + 125560021
006578     END-IF.                                                      25570021
006579                                                                  25580021
006580     MOVE LENGTH OF PV-PO-NBR-X            TO PV-FIELD-LGTH.      25590021
006581     MOVE PV-PO-NBR-X                      TO PV-WORK-FIELD.      25600021
006582     PERFORM 2330-REMOVE-LEADING-ZEROS.                           25610021
006583     MOVE PV-POSITION                      TO PV-PO-NBR-STRT.     25620021
006584     IF  PV-FIELD-LGTH = PV-PO-NBR-STRT                           25630021
006585         MOVE 1                            TO PV-PO-NBR-LGTH      25640021
006586     ELSE                                                         25650021
006587         COMPUTE PV-PO-NBR-LGTH = (PV-FIELD-LGTH -                25660021
006588                                       PV-PO-NBR-STRT) + 1        25670021
006589     END-IF.                                                      25680021
006590                                                                  25690021
006591     MOVE LENGTH OF PV-RCVR-SEQ-NBR-X      TO PV-FIELD-LGTH.      25700021
006592     MOVE PV-RCVR-SEQ-NBR-X                TO PV-WORK-FIELD.      25710021
006593     PERFORM 2330-REMOVE-LEADING-ZEROS.                           25720021
006594     MOVE PV-POSITION                      TO PV-RCVR-SEQ-NBR-STRT25730021
006595     IF  PV-FIELD-LGTH = PV-RCVR-SEQ-NBR-STRT                     25740021
006596         MOVE 1                            TO PV-RCVR-SEQ-NBR-LGTH25750021
006597     ELSE                                                         25760021
006598         COMPUTE PV-RCVR-SEQ-NBR-LGTH = (PV-FIELD-LGTH -          25770021
006599                                         PV-RCVR-SEQ-NBR-STRT) + 125780021
006600     END-IF.                                                      25790021
006601                                                                  25800021
006602     MOVE LENGTH OF PV-AUD-CNTL-NBR-X      TO PV-FIELD-LGTH.      25810021
006603     MOVE PV-AUD-CNTL-NBR-X                TO PV-WORK-FIELD.      25820021
006604     PERFORM 2330-REMOVE-LEADING-ZEROS.                           25830021
006605     MOVE PV-POSITION                      TO PV-AUD-CNTL-NBR-STRT25840021
006606     IF  PV-FIELD-LGTH = PV-AUD-CNTL-NBR-STRT                     25850021
006607         MOVE 1                            TO PV-AUD-CNTL-NBR-LGTH25860021
006608     ELSE                                                         25870021
006609         COMPUTE PV-AUD-CNTL-NBR-LGTH = (PV-FIELD-LGTH -          25880021
006610                                         PV-AUD-CNTL-NBR-STRT) + 125890021
006611     END-IF.                                                      25900021
006612                                                                  25910021
006613     MOVE LENGTH OF PV-PO-LNE-NBR-X        TO PV-FIELD-LGTH.      25920021
006614     MOVE PV-PO-LNE-NBR-X                  TO PV-WORK-FIELD.      25930021
006615     PERFORM 2330-REMOVE-LEADING-ZEROS.                           25940021
006616     MOVE PV-POSITION                      TO PV-PO-LNE-NBR-STRT. 25950021
006617     IF  PV-FIELD-LGTH = PV-PO-LNE-NBR-STRT                       25960021
006618         MOVE 1                            TO PV-PO-LNE-NBR-LGTH  25970021
006619     ELSE                                                         25980021
006620         COMPUTE PV-PO-LNE-NBR-LGTH = (PV-FIELD-LGTH -            25990021
006621                                         PV-PO-LNE-NBR-STRT) + 1  26000021
006622     END-IF.                                                      26010021
006623                                                                  26020021
006624     MOVE LENGTH OF PV-PO-PREPK-ID-X       TO PV-FIELD-LGTH.      26030021
006625     MOVE PV-PO-PREPK-ID-X                 TO PV-WORK-FIELD.      26040021
006626     PERFORM 2330-REMOVE-LEADING-ZEROS.                           26050021
006627     MOVE PV-POSITION                      TO PV-PO-PREPK-ID-STRT.26060021
006628     IF  PV-FIELD-LGTH = PV-PO-PREPK-ID-STRT                      26070021
006629         MOVE 1                            TO PV-PO-PREPK-ID-LGTH 26080021
006630     ELSE                                                         26090021
006631         COMPUTE PV-PO-PREPK-ID-LGTH = (PV-FIELD-LGTH -           26100021
006632                                        PV-PO-PREPK-ID-STRT) + 1  26110021
006633     END-IF.                                                      26120021
006634                                                                  26130021
006635     MOVE LENGTH OF PV-STR-NBR-X           TO PV-FIELD-LGTH.      26140021
006636     MOVE PV-STR-NBR-X                     TO PV-WORK-FIELD.      26150021
006637     PERFORM 2330-REMOVE-LEADING-ZEROS.                           26160021
006638     MOVE PV-POSITION                      TO PV-STR-NBR-STRT.    26170021
006639     IF  PV-FIELD-LGTH = PV-STR-NBR-STRT                          26180021
006640         MOVE 1                            TO PV-STR-NBR-LGTH     26190021
006641     ELSE                                                         26200021
006642         COMPUTE PV-STR-NBR-LGTH = (PV-FIELD-LGTH -               26210021
006643                                         PV-STR-NBR-STRT) + 1     26220021
006644     END-IF.                                                      26230021
006645                                                                  26240021
006646     MOVE LENGTH OF PV-PRIORITY-IND-X      TO PV-FIELD-LGTH.      26250021
006647     MOVE PV-PRIORITY-IND-X                TO PV-WORK-FIELD.      26260021
006648     PERFORM 2330-REMOVE-LEADING-ZEROS.                           26270021
006649     MOVE PV-POSITION                      TO PV-PRIORITY-IND-STRT26280021
006650     IF  PV-FIELD-LGTH = PV-PRIORITY-IND-STRT                     26290021
006651         MOVE 1                            TO PV-PRIORITY-IND-LGTH26300021
006652     ELSE                                                         26310021
006653         COMPUTE PV-PRIORITY-IND-LGTH = (PV-FIELD-LGTH -          26320021
006654                                         PV-PRIORITY-IND-STRT) + 126330021
006655     END-IF.                                                      26340021
006656/                                                                 26350021
006657****************************************************************  26360021
006658* THIS CODE WILL REMOVE SPACES FROM THE END OF A CHARACTER     *  26370021
006659* FIELD.                                                       *  26380021
006660****************************************************************  26390021
006661 2320-TRIM-FIELDS.                                                26400021
006662                                                                  26410021
006663     PERFORM VARYING PV-POSITION                                  26420021
006664                FROM PV-FIELD-LGTH                                26430021
006665                  BY -1                                           26440021
006666               UNTIL PV-WORK-FIELD (PV-POSITION : 1) NOT = SPACE  26450021
006667                  OR PV-POSITION = 1                              26460021
006668                                                                  26470021
006669     END-PERFORM.                                                 26480021
006670/                                                                 26490021
006671****************************************************************  26500021
006672* THIS CODE WILL REMOVE SPECIAL CHARACTERS FROM THE VENDOR     *  26510021
006673* NAME                                                         *  26520021
006674****************************************************************  26530021
006675 2321-SCRUB-VENDOR-NAME.                                          26540021
006676                                                                  26550021
006677     INSPECT ENTNME-ENT-NAME-DESC                                 26560021
006678         REPLACING ALL PC-APOSTROPHE BY PC-SPACE.                 26570021
006679     INSPECT ENTNME-ENT-NAME-DESC                                 26580021
006680         REPLACING ALL PC-CARAT BY PC-SPACE.                      26590021
006681/                                                                 26600021
006682****************************************************************  26610021
006683* THIS CODE WILL REMOVE ZEROS FROM THE BEGINNING OF A NUMERIC  *  26620021
006684* FIELD.                                                       *  26630021
006685****************************************************************  26640021
006686 2330-REMOVE-LEADING-ZEROS.                                       26650021
006687                                                                  26660021
006688     PERFORM VARYING PV-POSITION                                  26670021
006689                FROM 1                                            26680021
006690                  BY 1                                            26690021
006691               UNTIL (PV-WORK-FIELD (PV-POSITION : 1) NOT = SPACE 26700021
006692                 AND  PV-WORK-FIELD (PV-POSITION : 1) NOT = ZERO) 26710021
006693                  OR  PV-POSITION = PV-FIELD-LGTH                 26720021
006694                                                                  26730021
006695     END-PERFORM.                                                 26740021
006696                                                                  26750021
006697****************************************************************  26760021
006698* THIS CODE WILL INSERT A HISTORY RECORD INTO THE              *  26770021
006699* SUT_CART_DIRV_TRKG TABLE.                                    *  26780021
006700****************************************************************  26790021
006701 2500-INSERT-HISTORY.                                             26800021
006702                                                                  26810021
006703     EXEC SQL                                                     26820021
006704         INSERT INTO SUT_CART_DIRV_TRKG                           26830021
006705                (BRCDE_NBR                                        26840021
006706                ,CRE_TMST                                         26850021
006707                ,OPER_UNT_ID                                      26860021
006708                ,DIRV_RSN_CDE                                     26870021
006709                ,LGCL_LOC_NM                                      26880021
006710                ,AUD_CNTL_NBR                                     26890021
006711                ,SHIPT_UNT_ID                                     26900021
006712                ,AUD_STAT_CDE                                     26910021
006713                ,PO_NBR                                           26920021
006714                ,RCVR_SEQ_NBR                                     26930021
006715                ,PO_LNE_NBR                                       26940021
006716                ,PREPK_ID                                         26950021
006717                ,STR_NBR                                          26960021
006718                ,CRE_PGM_NM                                       26970021
006719                ,ACKNL_SEQ_NBR                                    26980021
006720                ,CASI_CDE                                         26990021
006721                ,CART_STAT_CDE                                    27000021
006722                ,AUD_FALR_RSN_NM                                  27010021
006723                ,STR_ZN_ID                                        27020021
006724                ,SEASET_YR                                        27030021
006725                ,SEASET_SHRT_NM                                   27040021
006726                ,CNVYR_PRC_ACTN_NM                                27050021
006727                ,CRE_BY_USR_ID                                    27060021
006728                )                                                 27070021
006729         VALUES (:SUT00102-BRCDE-NBR                              27080021
006730                ,:SUT00102-CRE-TMST                               27090021
006731                ,:SUT00102-OPER-UNT-ID                            27100021
006732                ,:SUT00102-DIRV-RSN-CDE                           27110021
006733                ,:SUT00102-LGCL-LOC-NM                            27120021
006734                ,:SUT00102-AUD-CNTL-NBR                           27130021
006735                ,:SUT00102-SHIPT-UNT-ID                           27140021
006736                ,:SUT00102-AUD-STAT-CDE                           27150021
006737                ,:SUT00102-PO-NBR                                 27160021
006738                ,:SUT00102-RCVR-SEQ-NBR                           27170021
006739                ,:SUT00102-PO-LNE-NBR                             27180021
006740                ,:SUT00102-PREPK-ID                               27190021
006741                ,:SUT00102-STR-NBR                                27200021
006742                ,:SUT00102-CRE-PGM-NM                             27210021
006743                ,:SUT00102-ACKNL-SEQ-NBR                          27220021
006744                ,:SUT00102-CASI-CDE                               27230021
006745                ,:SUT00102-CART-STAT-CDE                          27240021
006746                ,:SUT00102-AUD-FALR-RSN-NM                        27250021
006747                ,:SUT00102-STR-ZN-ID                              27260021
006748                ,:SUT00102-SEASET-YR                              27270021
006749                ,:SUT00102-SEASET-SHRT-NM                         27280021
006750                ,:SUT00102-CNVYR-PRC-ACTN-NM                      27290021
006751                ,:SUT00102-CRE-BY-USR-ID                          27300021
006752                )                                                 27310021
006753     END-EXEC.                                                    27320021
006754                                                                  27330021
006755     EVALUATE TRUE                                                27340021
006756       WHEN SQLCODE = ZERO                                        27350021
006757           CONTINUE                                               27360021
006758                                                                  27370021
006759       WHEN SQLWARN0 NOT EQUAL SPACE                              27380021
006760       WHEN SQLCODE NOT EQUAL ZERO                                27390021
006761           SET SU090-DB2-ERROR       TO TRUE                      27400021
006762           MOVE SQLCODE              TO SU090-SQLCODE             27410021
006763           MOVE SQLCA                TO SU090-SQLCA               27420021
006764           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         27430021
006765           MOVE '2500-INSERT-HISTORY'                             27440021
006766                                     TO PV-ABEND-PARAGRAPH        27450021
006767                                        SU090-ERR-PARAGRAPH       27460021
006768           MOVE 'INSERT HISTORY TO CONTAINER DIVERT TRACKING TBL' 27470021
006769                                     TO PV-ABEND-OPER-MESSAGE-1   27480021
006770           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          27490021
006771           PERFORM 9900-DB2-ERROR                                 27500021
006772           PERFORM 5200-BACK-OUT-MQ                               27510021
006773     END-EVALUATE.                                                27520021
006774                                                                  27530021
006775******************************************************************27540021
006776******************************************************************27550021
006777**** 2200-DB2-COMMIT.                                             27560021
006778****                                                              27570021
006779**** EXEC SQL                                                     27580021
006780****     COMMIT                                                   27590021
006781**** END-EXEC.                                                    27600021
006782****                                                              27610021
006783**** EVALUATE TRUE                                                27620021
006784****   WHEN SQLCODE = ZERO                                        27630021
006785****       CONTINUE                                               27640021
006786****                                                              27650021
006787****   WHEN OTHER                                                 27660021
006788****       SET SU090-DB2-ERROR       TO TRUE                      27670021
006789****       MOVE SQLCODE              TO SU090-SQLCODE             27680021
006790****       MOVE SQLCA                TO SU090-SQLCA               27690021
006791****       MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         27700021
006792****       MOVE '2200-DB2-COMMIT'    TO PV-ABEND-PARAGRAPH        27710021
006793****                                    SU090-ERR-PARAGRAPH       27720021
006794****       MOVE 'COMMIT SUT_CART_DIRV_TRKG TABLE INSERT'          27730021
006795****                                 TO PV-ABEND-OPER-MESSAGE-1   27740021
006796****       MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          27750021
006797****       PERFORM 9900-DB2-ERROR                                 27760021
006798**** END-EVALUATE.                                                27770021
006799****                                                              27780021
006800******************************************************************27790021
006801*  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT        27800021
006802******************************************************************27810021
006803*** 2300-MQ-COMMIT.                                               27820021
006804***                                                               27830021
006805***  CALL PV-MQCMIT USING PV-HCONN                                27840021
006806***                       PV-COMPLETION-CODE                      27850021
006807***                       PV-REASON.                              27860021
006808***                                                               27870021
006809***  IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        27880021
006810***     CALL PV-MQCHECK USING PV-REASON                           27890021
006811***                           PV-MQ-REASON-TEXT                   27900021
006812***     SET SU090-MQ-ERROR      TO TRUE                           27910021
006813***     MOVE PV-ABEND-PROGRAM   TO SU090-ERR-PROGRAM              27920021
006814***     MOVE '2300-COMMIT-MQ'   TO SU090-ERR-PARAGRAPH            27930021
006815***     MOVE 'MQCMIT ERROR'     TO PV-ERROR-MESSAGE               27940021
006816***     MOVE PV-COMPLETION-CODE TO PV-HOLD-COMPLETION-CODE        27950021
006817***                                PE-MQ-COMPLETION-CODE          27960021
006818***                                SU090-MQCODE                   27970021
006819***     MOVE PV-REASON          TO PV-HOLD-REASON                 27980021
006820***                                PE-MQ-REASON-CODE              27990021
006821***     PERFORM 5200-BACK-OUT-MQ                                  28000021
006822***     MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE        28010021
006823***     MOVE PV-HOLD-REASON          TO PV-REASON                 28020021
006824***     PERFORM 9200-MQ-ERROR                                     28030021
006825***  END-IF.                                                      28040021
006826***                                                               28050021
006827******************************************************************28060021
006828* PROCESS THE CURSOR THAT BRINGS BACK A LIST OF BARCODES FOR      28070021
006829* CARTONS IN AN AUDIT CONTROL GROUP WHICH HAD DIRECTIVES SENT,    28080021
006830* BUT NOT RELEASED.                                               28090021
006831******************************************************************28100021
006832 3000-AUDIT-GROUP-DIRECTIVE.                                      28110021
006833                                                                  28120021
006834     SET PS-NOT-END-OF-CURSOR TO TRUE.                            28130021
006835     MOVE +0                  TO PV-CURSOR-COUNT.                 28140021
006836     PERFORM 3100-OPEN-AUD-CNTL-CURSOR.                           28150021
006837     PERFORM 3200-FETCH-AUD-CNTL-CURSOR.                          28160021
006838     PERFORM 3300-PROCESS-AUD-CNTL-CURSOR                         28170021
006839         UNTIL PS-END-OF-CURSOR OR                                28180021
006840               SU090-DB2-ERROR.                                   28190021
006841     IF  SU090-SUCCESS                                            28200021
006842         PERFORM 3400-CLOSE-AUD-CNTL-CURSOR                       28210021
006843     END-IF.                                                      28220021
006844                                                                  28230021
006845******************************************************************28240021
006846* OPEN THE AUDIT CONTROL GROUP CURSOR                             28250021
006847******************************************************************28260021
006848 3100-OPEN-AUD-CNTL-CURSOR.                                       28270021
006849                                                                  28280021
006850     MOVE SU090-OPER-UNT-ID  TO DK-OPER-UNT-ID.                   28290021
006851     MOVE SU090-AUD-CNTL-NBR TO DK-AUD-CNTL-NBR.                  28300021
006852                                                                  28310021
006853     PERFORM                                                      28320021
006854         WITH TEST AFTER                                          28330021
006855         VARYING PV-RETRY-COUNT                                   28340021
006856         FROM 1 BY 1                                              28350021
006857         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 28360021
006858                   OR (SQLCODE = ZERO))                           28370021
006859         EXEC SQL                                                 28380021
006860              OPEN AUD_CNTL_CART_LST                              28390021
006861         END-EXEC                                                 28400021
006862                                                                  28410021
006863         EVALUATE TRUE                                            28420021
006864             WHEN SQLCODE = +0                                    28430021
006865             WHEN SQLCODE = -904                                  28440021
006866             WHEN SQLCODE = -911                                  28450021
006867             WHEN SQLCODE = -913                                  28460021
006868                 CONTINUE                                         28470021
006869             WHEN SQLWARN0 NOT EQUAL SPACE                        28480021
006870             WHEN SQLCODE NOT EQUAL ZERO                          28490021
006871                 SET SU090-DB2-ERROR  TO TRUE                     28500021
006872                 MOVE SQLCODE         TO SU090-SQLCODE            28510021
006873                 MOVE SQLCA           TO SU090-SQLCA              28520021
006874                 MOVE PV-ABEND-PROGRAM                            28530021
006875                                      TO SU090-ERR-PROGRAM        28540021
006876                 MOVE '3100-OPEN-AUD-CNTL-CURSOR'                 28550021
006877                                      TO PV-ABEND-PARAGRAPH       28560021
006878                                         SU090-ERR-PARAGRAPH      28570021
006879                 MOVE 'ERROR OPENING AUDIT CNTL GROUP CURSOR'     28580021
006880                                      TO PV-ABEND-OPER-MESSAGE-1  28590021
006881                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         28600021
006882                 MOVE DK-AUD-CNTL-NBR TO PV-AUD-CNTL-NBR-N        28610021
006883                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        28620021
006884                         PV-OPER-UNT-ID-DISP                      28630021
006885                                         DELIMITED BY SIZE        28640021
006886                        '   AUD CNTL NBR: '                       28650021
006887                                         DELIMITED BY SIZE        28660021
006888                         PV-AUD-CNTL-NBR-DISP                     28670021
006889                                         DELIMITED BY SIZE        28680021
006890                                   INTO PV-ABEND-OPER-MESSAGE-2   28690021
006891                 MOVE 'SUT_CART_DIRV_TRKG'                        28700021
006892                                      TO PV-ABEND-TABLE-1         28710021
006893                 PERFORM 9900-DB2-ERROR                           28720021
006894         END-EVALUATE                                             28730021
006895     END-PERFORM.                                                 28740021
006896                                                                  28750021
006897     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          28760021
006898         SET SU090-DB2-ERROR          TO TRUE                     28770021
006899         MOVE SQLCODE                 TO SU090-SQLCODE            28780021
006900         MOVE SQLCA                   TO SU090-SQLCA              28790021
006901         MOVE PV-ABEND-PROGRAM        TO SU090-ERR-PROGRAM        28800021
006902         MOVE '3100-OPEN-AUD-CNTL-CURSOR'                         28810021
006903                                      TO PV-ABEND-PARAGRAPH       28820021
006904                                         SU090-ERR-PARAGRAPH      28830021
006905         MOVE 'MAX RETRIES ERROR OPENING AUDIT CNTL GROUP CURSOR' 28840021
006906                                      TO PV-ABEND-OPER-MESSAGE-1  28850021
006907         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         28860021
006908         MOVE DK-AUD-CNTL-NBR         TO PV-AUD-CNTL-NBR-N        28870021
006909         STRING 'OPER UNT ID: '  DELIMITED BY SIZE                28880021
006910                 PV-OPER-UNT-ID-DISP                              28890021
006911                                 DELIMITED BY SIZE                28900021
006912                '   AUD CNTL NBR: '                               28910021
006913                                 DELIMITED BY SIZE                28920021
006914                 PV-AUD-CNTL-NBR-DISP                             28930021
006915                                 DELIMITED BY SIZE                28940021
006916                                    INTO PV-ABEND-OPER-MESSAGE-2  28950021
006917         MOVE 'SUT_CART_DIRV_TRKG'    TO PV-ABEND-TABLE-1         28960021
006918         PERFORM 9900-DB2-ERROR                                   28970021
006919     END-IF.                                                      28980021
006920                                                                  28990021
006921                                                                  29000021
006922******************************************************************29010021
006923* FETCH A ROW FROM THE AUDIT CONTROL GROUP CURSOR.               *29020021
006924******************************************************************29030021
006925 3200-FETCH-AUD-CNTL-CURSOR.                                      29040021
006926                                                                  29050021
006927     EXEC SQL                                                     29060021
006928          FETCH AUD_CNTL_CART_LST                                 29070021
006929           INTO :SUT00102-BRCDE-NBR                               29080021
006930               ,:SUT00102-SHIPT-UNT-ID                            29090021
006931     END-EXEC.                                                    29100021
006932                                                                  29110021
006933     EVALUATE TRUE                                                29120021
006934       WHEN SQLCODE = ZERO                                        29130021
006935           ADD +1                    TO PV-CURSOR-COUNT           29140021
006936           MOVE SUT00102-BRCDE-NBR   TO DK-BRCDE-NBR              29150021
006937           MOVE SUT00102-SHIPT-UNT-ID                             29160021
006938                                     TO DK-SHIPT-UNT-ID           29170021
006939           IF  SUT00102-SHIPT-UNT-ID > 0                          29180021
006940               MOVE PC-S             TO DK-BRCDE-TYP-CDE          29190021
006941           ELSE                                                   29200021
006942               MOVE PC-P             TO DK-BRCDE-TYP-CDE          29210021
006943           END-IF                                                 29220021
006944       WHEN SQLCODE = +100                                        29230021
006945           SET PS-END-OF-CURSOR  TO TRUE                          29240021
006946       WHEN SQLWARN0 NOT EQUAL SPACE                              29250021
006947       WHEN SQLCODE NOT EQUAL ZERO                                29260021
006948           SET SU090-DB2-ERROR       TO TRUE                      29270021
006949           MOVE SQLCODE              TO SU090-SQLCODE             29280021
006950           MOVE SQLCA                TO SU090-SQLCA               29290021
006951           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         29300021
006952           MOVE '3200-FETCH-AUD-CNTL-CURSOR'                      29310021
006953                                     TO PV-ABEND-PARAGRAPH        29320021
006954                                        SU090-ERR-PARAGRAPH       29330021
006955           MOVE 'FETCH AUD GROUP CONTROL CURSOR ROW'              29340021
006956                                     TO PV-ABEND-OPER-MESSAGE-1   29350021
006957           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          29360021
006958           MOVE DK-AUD-CNTL-NBR      TO PV-AUD-CNTL-NBR-N         29370021
006959           STRING 'OPER UNT ID: '  DELIMITED BY SIZE              29380021
006960                   PV-OPER-UNT-ID-DISP                            29390021
006961                                   DELIMITED BY SIZE              29400021
006962                  '   AUD CNTL NBR: '                             29410021
006963                                   DELIMITED BY SIZE              29420021
006964                   PV-AUD-CNTL-NBR-DISP                           29430021
006965                                   DELIMITED BY SIZE              29440021
006966                                   INTO PV-ABEND-OPER-MESSAGE-2   29450021
006967           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          29460021
006968           PERFORM 9900-DB2-ERROR                                 29470021
006969     END-EVALUATE.                                                29480021
006970                                                                  29490021
006971                                                                  29500021
006972******************************************************************29510021
006973* WRITE A DIRECTIVE MESSAGE TO MQ AND WRITE A HISTORY RECORD FOR  29520021
006974* EACH BARCODE FOUND IN THE CURSOR.                               29530021
006975******************************************************************29540021
006976 3300-PROCESS-AUD-CNTL-CURSOR.                                    29550021
006977                                                                  29560021
006978     PERFORM 2000-CARTON-DIRECTIVE.                               29570021
006979                                                                  29580021
006980     IF  SU090-SUCCESS                                            29590021
006981         PERFORM 3200-FETCH-AUD-CNTL-CURSOR                       29600021
006982     END-IF.                                                      29610021
006983                                                                  29620021
006984******************************************************************29630021
006985* CLOSE THE AUDIT CONTROL GROUP CURSOR                            29640021
006986******************************************************************29650021
006987 3400-CLOSE-AUD-CNTL-CURSOR.                                      29660021
006988                                                                  29670021
006989     PERFORM                                                      29680021
006990         WITH TEST AFTER                                          29690021
006991         VARYING PV-RETRY-COUNT                                   29700021
006992         FROM 1 BY 1                                              29710021
006993         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 29720021
006994                   OR (SQLCODE = ZERO))                           29730021
006995         EXEC SQL                                                 29740021
006996             CLOSE AUD_CNTL_CART_LST                              29750021
006997         END-EXEC                                                 29760021
006998                                                                  29770021
006999         EVALUATE TRUE                                            29780021
007000             WHEN SQLCODE = +0                                    29790021
007001             WHEN SQLCODE = -904                                  29800021
007002             WHEN SQLCODE = -911                                  29810021
007003             WHEN SQLCODE = -913                                  29820021
007004                 CONTINUE                                         29830021
007005             WHEN SQLWARN0 NOT EQUAL SPACE                        29840021
007006             WHEN SQLCODE NOT EQUAL ZERO                          29850021
007007                 SET SU090-DB2-ERROR  TO TRUE                     29860021
007008                 MOVE SQLCODE         TO SU090-SQLCODE            29870021
007009                 MOVE SQLCA           TO SU090-SQLCA              29880021
007010                 MOVE PV-ABEND-PROGRAM                            29890021
007011                                      TO SU090-ERR-PROGRAM        29900021
007012                 MOVE '3400-CLOSE-AUD-CNTL-CURSOR'                29910021
007013                                      TO PV-ABEND-PARAGRAPH       29920021
007014                                         SU090-ERR-PARAGRAPH      29930021
007015                 MOVE 'ERROR CLOSING AUDIT CONTROL GROUP CURSOR'  29940021
007016                                      TO PV-ABEND-OPER-MESSAGE-1  29950021
007017                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         29960021
007018                 MOVE DK-AUD-CNTL-NBR TO PV-AUD-CNTL-NBR-N        29970021
007019                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        29980021
007020                         PV-OPER-UNT-ID-DISP                      29990021
007021                                         DELIMITED BY SIZE        30000021
007022                        '   AUD CNTL NBR: '                       30010021
007023                                         DELIMITED BY SIZE        30020021
007024                         PV-AUD-CNTL-NBR-DISP                     30030021
007025                                         DELIMITED BY SIZE        30040021
007026                                    INTO PV-ABEND-OPER-MESSAGE-2  30050021
007027                 MOVE 'SUT_CART_DIRV_TRKG'                        30060021
007028                                      TO PV-ABEND-TABLE-1         30070021
007029                 PERFORM 9900-DB2-ERROR                           30080021
007030         END-EVALUATE                                             30090021
007031     END-PERFORM.                                                 30100021
007032                                                                  30110021
007033     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          30120021
007034         SET SU090-DB2-ERROR          TO TRUE                     30130021
007035         MOVE SQLCODE                 TO SU090-SQLCODE            30140021
007036         MOVE SQLCA                   TO SU090-SQLCA              30150021
007037         MOVE PV-ABEND-PROGRAM        TO SU090-ERR-PROGRAM        30160021
007038         MOVE '3400-CLOSE-AUD-CNTL-CURSOR'                        30170021
007039                                      TO PV-ABEND-PARAGRAPH       30180021
007040                                         SU090-ERR-PARAGRAPH      30190021
007041         MOVE 'MAX RETRIES ERROR CLOSING AUDIT CNTL GROUP CURSOR' 30200021
007042                                      TO PV-ABEND-OPER-MESSAGE-1  30210021
007043         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         30220021
007044         MOVE DK-AUD-CNTL-NBR         TO PV-AUD-CNTL-NBR-N        30230021
007045         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        30240021
007046                 PV-OPER-UNT-ID-DISP                              30250021
007047                                         DELIMITED BY SIZE        30260021
007048                '   AUD CNTL NBR: '                               30270021
007049                                         DELIMITED BY SIZE        30280021
007050                 PV-AUD-CNTL-NBR-DISP                             30290021
007051                                         DELIMITED BY SIZE        30300021
007052                                    INTO PV-ABEND-OPER-MESSAGE-2  30310021
007053         MOVE 'SUT_CART_DIRV_TRKG'    TO PV-ABEND-TABLE-1         30320021
007054         PERFORM 9900-DB2-ERROR                                   30330021
007055     END-IF.                                                      30340021
007056                                                                  30350021
007057                                                                  30360021
007058******************************************************************30370021
007059* PROCESS THE CURSOR THAT BRINGS BACK A LIST OF BARCODES FOR      30380021
007060* CARTONS FOR A PO/RECEIVER WHICH HAD DIRECTIVES SENT, BUT NOT    30390021
007061* RELEASED.                                                       30400021
007062******************************************************************30410021
007063 3500-PO-RCVR-DIRECTIVE.                                          30420021
007064                                                                  30430021
007065     SET PS-NOT-END-OF-CURSOR TO TRUE.                            30440021
007066     MOVE +0                  TO PV-CURSOR-COUNT.                 30450021
007067     PERFORM 3600-OPEN-PO-RCVR-CURSOR.                            30460021
007068     PERFORM 3700-FETCH-PO-RCVR-CURSOR.                           30470021
007069     PERFORM 3800-PROCESS-PO-RCVR-CURSOR                          30480021
007070         UNTIL PS-END-OF-CURSOR OR                                30490021
007071               SU090-DB2-ERROR.                                   30500021
007072                                                                  30510021
007073     IF  SU090-SUCCESS                                            30520021
007074         PERFORM 3900-CLOSE-PO-RCVR-CURSOR                        30530021
007075     END-IF.                                                      30540021
007076                                                                  30550021
007077******************************************************************30560021
007078* OPEN THE PO / RECEIVER CARTON LIST CURSOR                       30570021
007079******************************************************************30580021
007080 3600-OPEN-PO-RCVR-CURSOR.                                        30590021
007081                                                                  30600021
007082     MOVE SU090-OPER-UNT-ID  TO DK-OPER-UNT-ID.                   30610021
007083     MOVE SU090-PO-NBR       TO DK-PO-NBR.                        30620021
007084     MOVE SU090-RCVR-SEQ-NBR TO DK-RCVR-SEQ-NBR.                  30630021
007085                                                                  30640021
007086     PERFORM                                                      30650021
007087         WITH TEST AFTER                                          30660021
007088         VARYING PV-RETRY-COUNT                                   30670021
007089         FROM 1 BY 1                                              30680021
007090         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 30690021
007091                   OR (SQLCODE = ZERO))                           30700021
007092         EXEC SQL                                                 30710021
007093              OPEN PO_RCVR_CART_LST                               30720021
007094         END-EXEC                                                 30730021
007095                                                                  30740021
007096         EVALUATE TRUE                                            30750021
007097             WHEN SQLCODE = +0                                    30760021
007098             WHEN SQLCODE = -904                                  30770021
007099             WHEN SQLCODE = -911                                  30780021
007100             WHEN SQLCODE = -913                                  30790021
007101                 CONTINUE                                         30800021
007102             WHEN SQLWARN0 NOT EQUAL SPACE                        30810021
007103             WHEN SQLCODE NOT EQUAL ZERO                          30820021
007104                 SET SU090-DB2-ERROR  TO TRUE                     30830021
007105                 MOVE SQLCODE         TO SU090-SQLCODE            30840021
007106                 MOVE SQLCA           TO SU090-SQLCA              30850021
007107                 MOVE PV-ABEND-PROGRAM                            30860021
007108                                      TO SU090-ERR-PROGRAM        30870021
007109                 MOVE '3600-OPEN-PO-RCVR-CURSOR'                  30880021
007110                                      TO PV-ABEND-PARAGRAPH       30890021
007111                                         SU090-ERR-PARAGRAPH      30900021
007112                 MOVE 'ERROR OPENING PO/RCVR CARTON LIST CSR'     30910021
007113                                      TO PV-ABEND-OPER-MESSAGE-1  30920021
007114                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         30930021
007115                 MOVE DK-PO-NBR       TO PV-PO-NBR-N              30940021
007116                 MOVE DK-RCVR-SEQ-NBR TO PV-RCVR-SEQ-NBR-N        30950021
007117                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        30960021
007118                         PV-OPER-UNT-ID-DISP                      30970021
007119                                         DELIMITED BY SIZE        30980021
007120                        '   PO NBR: '                             30990021
007121                                         DELIMITED BY SIZE        31000021
007122                         PV-PO-NBR-DISP                           31010021
007123                                         DELIMITED BY SIZE        31020021
007124                        '   RCVR SEQ NBR: '                       31030021
007125                                         DELIMITED BY SIZE        31040021
007126                         PV-RCVR-SEQ-NBR                          31050021
007127                                         DELIMITED BY SIZE        31060021
007128                                    INTO PV-ABEND-OPER-MESSAGE-2  31070021
007129                 MOVE 'SUT_CART_DIRV_TRKG'                        31080021
007130                                      TO PV-ABEND-TABLE-1         31090021
007131                 PERFORM 9900-DB2-ERROR                           31100021
007132         END-EVALUATE                                             31110021
007133     END-PERFORM.                                                 31120021
007134                                                                  31130021
007135     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          31140021
007136         SET SU090-DB2-ERROR          TO TRUE                     31150021
007137         MOVE SQLCODE                 TO SU090-SQLCODE            31160021
007138         MOVE SQLCA                   TO SU090-SQLCA              31170021
007139         MOVE PV-ABEND-PROGRAM        TO SU090-ERR-PROGRAM        31180021
007140         MOVE '3600-OPEN-PO-RCVR-CURSOR'                          31190021
007141                                      TO PV-ABEND-PARAGRAPH       31200021
007142                                         SU090-ERR-PARAGRAPH      31210021
007143         MOVE 'MAX RETRIES OPENING PO/RCVR CARTON LIST CSR'       31220021
007144                                      TO PV-ABEND-OPER-MESSAGE-1  31230021
007145         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         31240021
007146         MOVE DK-PO-NBR               TO PV-PO-NBR-N              31250021
007147         MOVE DK-RCVR-SEQ-NBR         TO PV-RCVR-SEQ-NBR-N        31260021
007148         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        31270021
007149                   PV-OPER-UNT-ID-DISP                            31280021
007150                                         DELIMITED BY SIZE        31290021
007151                  '   PO NBR: '                                   31300021
007152                                         DELIMITED BY SIZE        31310021
007153                   PV-PO-NBR-DISP                                 31320021
007154                                         DELIMITED BY SIZE        31330021
007155                  '   RCVR SEQ NBR: '                             31340021
007156                                         DELIMITED BY SIZE        31350021
007157                   PV-RCVR-SEQ-NBR                                31360021
007158                                         DELIMITED BY SIZE        31370021
007159                                    INTO PV-ABEND-OPER-MESSAGE-2  31380021
007160         MOVE 'SUT_CART_DIRV_TRKG'    TO PV-ABEND-TABLE-1         31390021
007161         PERFORM 9900-DB2-ERROR                                   31400021
007162     END-IF.                                                      31410021
007163                                                                  31420021
007164                                                                  31430021
007165******************************************************************31440021
007166* FETCH A ROW FROM THE PO/RECEIVER CARTON LIST CURSOR.           *31450021
007167******************************************************************31460021
007168 3700-FETCH-PO-RCVR-CURSOR.                                       31470021
**TEMP*    DISPLAY '3700-FETCH-PO-RCVR-CURSOR'.                         31471039
007169                                                                  31480021
007170     EXEC SQL                                                     31490021
007171          FETCH PO_RCVR_CART_LST                                  31500021
007172           INTO :SUT00102-BRCDE-NBR                               31510021
007173               ,:SUT00102-SHIPT-UNT-ID                            31520021
007174     END-EXEC.                                                    31530021
007175                                                                  31540021
007176     EVALUATE TRUE                                                31550021
007177       WHEN SQLCODE = ZERO                                        31560021
007178           ADD +1                    TO PV-CURSOR-COUNT           31570021
007179           MOVE SUT00102-BRCDE-NBR   TO DK-BRCDE-NBR              31580021
007180           MOVE SUT00102-SHIPT-UNT-ID                             31590021
007181                                     TO DK-SHIPT-UNT-ID           31600021
007182           IF  SUT00102-SHIPT-UNT-ID > 0                          31610021
007183               MOVE PC-S             TO DK-BRCDE-TYP-CDE          31620021
007184           ELSE                                                   31630021
007185               MOVE PC-P             TO DK-BRCDE-TYP-CDE          31640021
007186           END-IF                                                 31650021
007187       WHEN SQLCODE = +100                                        31660021
007188           SET PS-END-OF-CURSOR  TO TRUE                          31670021
007190                                                                  31680008
007200       WHEN SQLWARN0 NOT EQUAL SPACE                              31690000
007210       WHEN SQLCODE NOT EQUAL ZERO                                31700000
007220           SET SU090-DB2-ERROR       TO TRUE                      31710000
007221           MOVE SQLCODE              TO SU090-SQLCODE             31720000
007222           MOVE SQLCA                TO SU090-SQLCA               31730000
007223           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         31740000
007224           MOVE '3700-FETCH-PO-RCVR-CURSOR'                       31750000
007225                                     TO PV-ABEND-PARAGRAPH        31760000
007226                                        SU090-ERR-PARAGRAPH       31770000
007227           MOVE 'FETCH PO/RCVR CARTON LIST CURSOR ROW'            31780000
007228                                     TO PV-ABEND-OPER-MESSAGE-1   31790000
007229           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          31800000
007230           MOVE DK-PO-NBR            TO PV-PO-NBR-N               31810000
007240           MOVE DK-RCVR-SEQ-NBR      TO PV-RCVR-SEQ-NBR-N         31820000
007250           STRING 'OPER UNT ID: '       DELIMITED BY SIZE         31830000
007251                   PV-OPER-UNT-ID-DISP                            31840000
007252                                        DELIMITED BY SIZE         31850000
007253                  '   PO NBR: '                                   31860000
007254                                        DELIMITED BY SIZE         31870000
007255                   PV-PO-NBR-DISP                                 31880000
007256                                        DELIMITED BY SIZE         31890000
007257                  '   RCVR SEQ NBR: '                             31900000
007258                                        DELIMITED BY SIZE         31910000
007259                   PV-RCVR-SEQ-NBR                                31920000
007260                                        DELIMITED BY SIZE         31930000
007261                                   INTO PV-ABEND-OPER-MESSAGE-2   31940000
007262           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          31950000
007263           PERFORM 9900-DB2-ERROR                                 31960000
007264     END-EVALUATE.                                                31970000
007265                                                                  31980000
007266                                                                  31990000
007267******************************************************************32000000
007268* WRITE A DIRECTIVE MESSAGE TO MQ AND WRITE A HISTORY RECORD FOR  32010000
007269* EACH BARCODE FOUND IN THE CURSOR.                               32020000
007270******************************************************************32030000
007271 3800-PROCESS-PO-RCVR-CURSOR.                                     32040000
**TEMP*    DISPLAY '3800-PROCESS-PO-RCVR-CURSOR'.                       32041039
007272                                                                  32050000
007273     PERFORM 2000-CARTON-DIRECTIVE.                               32060000
007274                                                                  32070000
007275     IF  SU090-SUCCESS                                            32080000
007276         PERFORM 3700-FETCH-PO-RCVR-CURSOR                        32090000
007277     END-IF.                                                      32100000
007278                                                                  32110000
007279******************************************************************32120000
007280* CLOSE THE PO/RECEIVER CARTON LIST CURSOR                        32130000
007290******************************************************************32140000
007300 3900-CLOSE-PO-RCVR-CURSOR.                                       32150000
007301                                                                  32160000
007302     PERFORM                                                      32170000
007303         WITH TEST AFTER                                          32180000
007304         VARYING PV-RETRY-COUNT                                   32190000
007305         FROM 1 BY 1                                              32200000
007306         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 32210000
007307                   OR (SQLCODE = ZERO))                           32220000
007308         EXEC SQL                                                 32230000
007309             CLOSE PO_RCVR_CART_LST                               32240000
007310         END-EXEC                                                 32250000
007311                                                                  32260000
007312         EVALUATE TRUE                                            32270000
007313             WHEN SQLCODE = +0                                    32280000
007314             WHEN SQLCODE = -904                                  32290000
007315             WHEN SQLCODE = -911                                  32300000
007316             WHEN SQLCODE = -913                                  32310000
007317                 CONTINUE                                         32320000
007318             WHEN SQLWARN0 NOT EQUAL SPACE                        32330000
007319             WHEN SQLCODE NOT EQUAL ZERO                          32340000
007320                 SET SU090-DB2-ERROR  TO TRUE                     32350000
007321                 MOVE SQLCODE         TO SU090-SQLCODE            32360000
007322                 MOVE SQLCA           TO SU090-SQLCA              32370000
007323                 MOVE PV-ABEND-PROGRAM                            32380000
007324                                      TO SU090-ERR-PROGRAM        32390000
007325                 MOVE '3900-CLOSE-PO-RCVR-CURSOR'                 32400000
007326                                      TO PV-ABEND-PARAGRAPH       32410000
007327                                         SU090-ERR-PARAGRAPH      32420000
007328                 MOVE 'ERROR CLOSING PO/RCVR CARTON LIST CURSOR'  32430000
007329                                      TO PV-ABEND-OPER-MESSAGE-1  32440000
007330                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         32450000
007331                 MOVE DK-PO-NBR       TO PV-PO-NBR-N              32460000
007332                 MOVE DK-RCVR-SEQ-NBR TO PV-RCVR-SEQ-NBR-N        32470000
007333                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        32480000
007334                         PV-OPER-UNT-ID-DISP                      32490000
007335                                         DELIMITED BY SIZE        32500000
007336                        '   PO NBR: '                             32510000
007337                                         DELIMITED BY SIZE        32520000
007338                         PV-PO-NBR-DISP                           32530000
007339                                         DELIMITED BY SIZE        32540000
007340                        '   RCVR SEQ NBR: '                       32550000
007341                                         DELIMITED BY SIZE        32560000
007342                         PV-RCVR-SEQ-NBR                          32570000
007343                                         DELIMITED BY SIZE        32580000
007344                                    INTO PV-ABEND-OPER-MESSAGE-2  32590000
007345                 MOVE 'SUT_CART_DIRV_TRKG'                        32600000
007346                                      TO PV-ABEND-TABLE-1         32610000
007347                 PERFORM 9900-DB2-ERROR                           32620000
007348         END-EVALUATE                                             32630000
007349     END-PERFORM.                                                 32640000
007350                                                                  32650000
007351     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          32660000
007352         SET SU090-DB2-ERROR          TO TRUE                     32670000
007353         MOVE SQLCODE                 TO SU090-SQLCODE            32680000
007354         MOVE SQLCA                   TO SU090-SQLCA              32690000
007355         MOVE PV-ABEND-PROGRAM        TO SU090-ERR-PROGRAM        32700000
007356         MOVE '3900-CLOSE-PO-RCVR-CURSOR'                         32710000
007357                                      TO PV-ABEND-PARAGRAPH       32720000
007358                                         SU090-ERR-PARAGRAPH      32730000
007359         MOVE 'MAX RETRIES ERROR CLOSING PO/RCVR CARTON LIST CSR' 32740000
007360                                      TO PV-ABEND-OPER-MESSAGE-1  32750000
007370         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         32760000
007371         MOVE DK-PO-NBR               TO PV-PO-NBR-N              32770000
007372         MOVE DK-RCVR-SEQ-NBR         TO PV-RCVR-SEQ-NBR-N        32780000
007373         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        32790000
007374                 PV-OPER-UNT-ID-DISP                              32800000
007375                                         DELIMITED BY SIZE        32810000
007376                '   PO NBR: '                                     32820000
007377                                         DELIMITED BY SIZE        32830000
007378                 PV-PO-NBR-DISP                                   32840000
007379                                         DELIMITED BY SIZE        32850000
007380                '   RCVR SEQ NBR: '                               32860000
007381                                         DELIMITED BY SIZE        32870000
007382                 PV-RCVR-SEQ-NBR                                  32880000
007383                                         DELIMITED BY SIZE        32890000
007384                                    INTO PV-ABEND-OPER-MESSAGE-2  32900000
007385         MOVE 'SUT_CART_DIRV_TRKG'    TO PV-ABEND-TABLE-1         32910000
007386         PERFORM 9900-DB2-ERROR                                   32920000
007387     END-IF.                                                      32930000
007388                                                                  32940000
007389                                                                  32950000
007390******************************************************************32960000
007391* PROCESS THE CURSOR THAT BRINGS BACK A LIST OF BARCODES FOR      32970000
007392* CARTONS FOR A PO/RCVR/LINE WHICH HAD DIRECTIVES SENT, BUT NOT   32980000
007393* RELEASED.                                                       32990000
007394******************************************************************33000000
007395 4000-PO-RCVR-LINE-DIRECTIVE.                                     33010000
007396                                                                  33020000
007397     SET PS-NOT-END-OF-CURSOR TO TRUE.                            33030000
007398     MOVE +0                  TO PV-CURSOR-COUNT.                 33040000
007399     PERFORM 4100-OPEN-PO-RCVR-LINE-CURSOR.                       33050000
007400     PERFORM 4200-FETCH-PO-RCVR-LINE-CURSOR.                      33060000
007401     PERFORM 4300-PROCESS-PO-RCVR-LINE-CSR                        33070000
007402         UNTIL PS-END-OF-CURSOR OR                                33080000
007403               SU090-DB2-ERROR.                                   33090000
007404     IF  SU090-SUCCESS                                            33100000
007405         PERFORM 4400-CLOSE-PO-RCVR-LINE-CURSOR                   33110000
007406     END-IF.                                                      33120000
007407                                                                  33130000
007408******************************************************************33140000
007409* OPEN THE PO/RECEIVER/LINE CARTON LIST CURSOR                    33150000
007410******************************************************************33160000
007411 4100-OPEN-PO-RCVR-LINE-CURSOR.                                   33170000
007412                                                                  33180000
007413     MOVE SU090-OPER-UNT-ID  TO DK-OPER-UNT-ID.                   33190000
007414     MOVE SU090-PO-NBR       TO DK-PO-NBR.                        33200000
007415     MOVE SU090-RCVR-SEQ-NBR TO DK-RCVR-SEQ-NBR.                  33210000
007416     MOVE SU090-PO-LNE-NBR   TO DK-PO-LNE-NBR.                    33220000
007417                                                                  33230000
007418     PERFORM                                                      33240000
007419         WITH TEST AFTER                                          33250000
007420         VARYING PV-RETRY-COUNT                                   33260000
007421         FROM 1 BY 1                                              33270000
007422         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 33280000
007423                   OR (SQLCODE = ZERO))                           33290000
007424         EXEC SQL                                                 33300000
007425              OPEN PO_RCVR_LNE_CART_LST                           33310000
007426         END-EXEC                                                 33320000
007427                                                                  33330000
007428         EVALUATE TRUE                                            33340000
007429             WHEN SQLCODE = +0                                    33350000
007430             WHEN SQLCODE = -904                                  33360000
007431             WHEN SQLCODE = -911                                  33370000
007432             WHEN SQLCODE = -913                                  33380000
007433                 CONTINUE                                         33390000
007434             WHEN SQLWARN0 NOT EQUAL SPACE                        33400000
007435             WHEN SQLCODE NOT EQUAL ZERO                          33410000
007436                 SET SU090-DB2-ERROR  TO TRUE                     33420000
007437                 MOVE SQLCODE         TO SU090-SQLCODE            33430000
007438                 MOVE SQLCA           TO SU090-SQLCA              33440000
007439                 MOVE PV-ABEND-PROGRAM                            33450000
007440                                      TO SU090-ERR-PROGRAM        33460000
007441                 MOVE '4100-OPEN-PO-RCVR-LINE-CURSOR'             33470000
007442                                      TO PV-ABEND-PARAGRAPH       33480000
007443                                         SU090-ERR-PARAGRAPH      33490000
007444                 MOVE 'ERROR OPENING PO/RCVR/LINE CARTON LIST CSR'33500000
007445                                      TO PV-ABEND-OPER-MESSAGE-1  33510000
007446                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         33520000
007447                 MOVE DK-PO-NBR       TO PV-PO-NBR-N              33530000
007448                 MOVE DK-RCVR-SEQ-NBR TO PV-RCVR-SEQ-NBR-N        33540000
007449                 MOVE DK-PO-LNE-NBR   TO PV-PO-LNE-NBR-N          33550000
007450                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        33560000
007451                         PV-OPER-UNT-ID-DISP                      33570000
007452                                         DELIMITED BY SIZE        33580000
007453                        '   PO NBR: '                             33590000
007454                                         DELIMITED BY SIZE        33600000
007455                         PV-PO-NBR-DISP                           33610000
007456                                         DELIMITED BY SIZE        33620000
007457                        '   RCVR SEQ NBR: '                       33630000
007458                                         DELIMITED BY SIZE        33640000
007459                         PV-RCVR-SEQ-NBR                          33650000
007460                                         DELIMITED BY SIZE        33660000
007461                                    INTO PV-ABEND-OPER-MESSAGE-2  33670000
007462                 STRING 'PO LINE NBR: '  DELIMITED BY SIZE        33680000
007463                         PV-PO-LNE-NBR-DISP                       33690000
007464                                         DELIMITED BY SIZE        33700000
007465                                    INTO PV-ABEND-OPER-MESSAGE-3  33710000
007466                 MOVE 'SUT_CART_DIRV_TRKG'                        33720000
007467                                      TO PV-ABEND-TABLE-1         33730000
007468                 PERFORM 9900-DB2-ERROR                           33740000
007469         END-EVALUATE                                             33750000
007470     END-PERFORM.                                                 33760000
007480                                                                  33770000
007490     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          33780000
007491         SET SU090-DB2-ERROR          TO TRUE                     33790000
007492         MOVE SQLCODE                 TO SU090-SQLCODE            33800000
007493         MOVE SQLCA                   TO SU090-SQLCA              33810000
007494         MOVE PV-ABEND-PROGRAM        TO SU090-ERR-PROGRAM        33820000
007495         MOVE '4100-OPEN-PO-RCVR-LINE-CURSOR'                     33830000
007496                                      TO PV-ABEND-PARAGRAPH       33840000
007497                                         SU090-ERR-PARAGRAPH      33850000
007498         MOVE 'MAX RETRIES OPENING PO/RCVR/LINE CARTON LIST CSR'  33860000
007499                                      TO PV-ABEND-OPER-MESSAGE-1  33870000
007500         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         33880000
007501         MOVE DK-PO-NBR               TO PV-PO-NBR-N              33890000
007502         MOVE DK-RCVR-SEQ-NBR         TO PV-RCVR-SEQ-NBR-N        33900000
007503         MOVE DK-PO-LNE-NBR           TO PV-PO-LNE-NBR-N          33910000
007504         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        33920000
007505                 PV-OPER-UNT-ID-DISP                              33930000
007506                                         DELIMITED BY SIZE        33940000
007507                '   PO NBR: '                                     33950000
007508                                         DELIMITED BY SIZE        33960000
007509                 PV-PO-NBR-DISP                                   33970000
007510                                         DELIMITED BY SIZE        33980000
007511                '   RCVR SEQ NBR: '                               33990000
007512                                         DELIMITED BY SIZE        34000000
007513                 PV-RCVR-SEQ-NBR                                  34010000
007514                                         DELIMITED BY SIZE        34020000
007515                                    INTO PV-ABEND-OPER-MESSAGE-2  34030000
007516         STRING 'PO LINE NBR: '          DELIMITED BY SIZE        34040000
007517                PV-PO-LNE-NBR-DISP                                34050000
007518                                         DELIMITED BY SIZE        34060000
007519                                    INTO PV-ABEND-OPER-MESSAGE-3  34070000
007520         MOVE 'SUT_CART_DIRV_TRKG'    TO PV-ABEND-TABLE-1         34080000
007521         PERFORM 9900-DB2-ERROR                                   34090000
007522     END-IF.                                                      34100000
007523                                                                  34110000
007524                                                                  34120000
007525******************************************************************34130000
007526* FETCH A ROW FROM THE PO/RECEIVER/LINE CARTON LIST CURSOR.      *34140000
007527******************************************************************34150000
007528 4200-FETCH-PO-RCVR-LINE-CURSOR.                                  34160000
007529                                                                  34170000
007530     EXEC SQL                                                     34180000
007531          FETCH PO_RCVR_LNE_CART_LST                              34190000
007532           INTO :SUT00102-BRCDE-NBR                               34200000
007533               ,:SUT00102-SHIPT-UNT-ID                            34210000
007534     END-EXEC.                                                    34220000
007535                                                                  34230000
007536     EVALUATE TRUE                                                34240000
007537       WHEN SQLCODE = ZERO                                        34250000
007538           ADD +1                    TO PV-CURSOR-COUNT           34260000
007539           MOVE SUT00102-BRCDE-NBR   TO DK-BRCDE-NBR              34270000
007540           MOVE SUT00102-SHIPT-UNT-ID                             34280000
007541                                     TO DK-SHIPT-UNT-ID           34290000
007542           IF  SUT00102-SHIPT-UNT-ID > 0                          34300000
007543               MOVE PC-S             TO DK-BRCDE-TYP-CDE          34310000
007544           ELSE                                                   34320000
007545               MOVE PC-P             TO DK-BRCDE-TYP-CDE          34330000
007546           END-IF                                                 34340000
007547                                                                  34350000
007548       WHEN SQLCODE = +100                                        34360000
007549           SET PS-END-OF-CURSOR  TO TRUE                          34370000
007550                                                                  34380000
007560       WHEN SQLWARN0 NOT EQUAL SPACE                              34390000
007570       WHEN SQLCODE NOT EQUAL ZERO                                34400000
007580           SET SU090-DB2-ERROR       TO TRUE                      34410000
007590           MOVE SQLCODE              TO SU090-SQLCODE             34420000
007591           MOVE SQLCA                TO SU090-SQLCA               34430000
007592           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         34440000
007593           MOVE '4200-FETCH-PO-RCVR-LINE-CURSOR'                  34450000
007594                                     TO PV-ABEND-PARAGRAPH        34460000
007595                                        SU090-ERR-PARAGRAPH       34470000
007596           MOVE 'FETCH PO/RCVR/LINE CARTON LIST CURSOR ROW'       34480000
007597                                     TO PV-ABEND-OPER-MESSAGE-1   34490000
007598           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          34500000
007599           MOVE DK-PO-NBR            TO PV-PO-NBR-N               34510000
007600           MOVE DK-RCVR-SEQ-NBR      TO PV-RCVR-SEQ-NBR-N         34520000
007601           MOVE DK-PO-LNE-NBR        TO PV-PO-LNE-NBR-N           34530000
007602           STRING 'OPER UNT ID: '       DELIMITED BY SIZE         34540000
007603                   PV-OPER-UNT-ID-DISP                            34550000
007604                                        DELIMITED BY SIZE         34560000
007605                  '   PO NBR: '                                   34570000
007606                                        DELIMITED BY SIZE         34580000
007607                   PV-PO-NBR-DISP                                 34590000
007608                                        DELIMITED BY SIZE         34600000
007609                  '   RCVR SEQ NBR: '                             34610000
007610                                        DELIMITED BY SIZE         34620000
007611                   PV-RCVR-SEQ-NBR                                34630000
007612                                        DELIMITED BY SIZE         34640000
007613                                   INTO PV-ABEND-OPER-MESSAGE-2   34650000
007614           STRING 'PO LINE NBR: '       DELIMITED BY SIZE         34660000
007615                   PV-PO-LNE-NBR-DISP   DELIMITED BY SIZE         34670000
007616                                   INTO PV-ABEND-OPER-MESSAGE-3   34680000
007617           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          34690000
007618           PERFORM 9900-DB2-ERROR                                 34700000
007619     END-EVALUATE.                                                34710000
007620                                                                  34720000
007630                                                                  34730000
007631******************************************************************34740000
007632* WRITE A DIRECTIVE MESSAGE TO MQ AND WRITE A HISTORY RECORD FOR  34750000
007633* EACH BARCODE FOUND IN THE CURSOR.                               34760000
007634******************************************************************34770000
007635 4300-PROCESS-PO-RCVR-LINE-CSR.                                   34780000
007636                                                                  34790000
007637     PERFORM 2000-CARTON-DIRECTIVE.                               34800000
007638                                                                  34810000
007639     IF  SU090-SUCCESS                                            34820000
007640         PERFORM 4200-FETCH-PO-RCVR-LINE-CURSOR                   34830000
007641     END-IF.                                                      34840000
007642                                                                  34850000
007643******************************************************************34860000
007644* CLOSE THE PO/RECEIVER CARTON LIST CURSOR                        34870000
007645******************************************************************34880000
007646 4400-CLOSE-PO-RCVR-LINE-CURSOR.                                  34890000
007647                                                                  34900000
007648     PERFORM                                                      34910000
007649         WITH TEST AFTER                                          34920000
007650         VARYING PV-RETRY-COUNT                                   34930000
007651         FROM 1 BY 1                                              34940000
007652         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 34950000
007653                   OR (SQLCODE = ZERO))                           34960000
007654         EXEC SQL                                                 34970000
007655             CLOSE PO_RCVR_LNE_CART_LST                           34980000
007656         END-EXEC                                                 34990000
007657                                                                  35000000
007658         EVALUATE TRUE                                            35010000
007659             WHEN SQLCODE = +0                                    35020000
007660             WHEN SQLCODE = -904                                  35030000
007661             WHEN SQLCODE = -911                                  35040000
007662             WHEN SQLCODE = -913                                  35050000
007663                 CONTINUE                                         35060000
007664             WHEN SQLWARN0 NOT EQUAL SPACE                        35070000
007665             WHEN SQLCODE NOT EQUAL ZERO                          35080000
007666                 SET SU090-DB2-ERROR  TO TRUE                     35090000
007667                 MOVE SQLCODE         TO SU090-SQLCODE            35100000
007668                 MOVE SQLCA           TO SU090-SQLCA              35110000
007669                 MOVE PV-ABEND-PROGRAM                            35120000
007670                                      TO SU090-ERR-PROGRAM        35130000
007671                 MOVE '4400-CLOSE-PO-RCVR-LINE-CURSOR'            35140000
007672                                      TO PV-ABEND-PARAGRAPH       35150000
007673                                         SU090-ERR-PARAGRAPH      35160000
007674                 MOVE 'ERROR CLOSING PO/RCVR/LINE CARTON LIST CSR'35170000
007675                                      TO PV-ABEND-OPER-MESSAGE-1  35180000
007676                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         35190000
007677                 MOVE DK-PO-NBR       TO PV-PO-NBR-N              35200000
007678                 MOVE DK-RCVR-SEQ-NBR TO PV-RCVR-SEQ-NBR-N        35210000
007679                 MOVE DK-PO-LNE-NBR   TO PV-PO-LNE-NBR-N          35220000
007680                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        35230000
007681                         PV-OPER-UNT-ID-DISP                      35240000
007682                                         DELIMITED BY SIZE        35250000
007683                        '   PO NBR: '                             35260000
007684                                         DELIMITED BY SIZE        35270000
007685                         PV-PO-NBR-DISP                           35280000
007686                                         DELIMITED BY SIZE        35290000
007687                        '   RCVR SEQ NBR: '                       35300000
007688                                         DELIMITED BY SIZE        35310000
007689                         PV-RCVR-SEQ-NBR                          35320000
007690                                         DELIMITED BY SIZE        35330000
007691                                    INTO PV-ABEND-OPER-MESSAGE-2  35340000
007692                 STRING 'PO LINE NBR: '  DELIMITED BY SIZE        35350000
007693                         PV-PO-LNE-NBR-DISP                       35360000
007694                                         DELIMITED BY SIZE        35370000
007695                                    INTO PV-ABEND-OPER-MESSAGE-3  35380000
007696                 MOVE 'SUT_CART_DIRV_TRKG'                        35390000
007697                                      TO PV-ABEND-TABLE-1         35400000
007698                 PERFORM 9900-DB2-ERROR                           35410000
007699         END-EVALUATE                                             35420000
007700     END-PERFORM.                                                 35430000
007710                                                                  35440000
007720     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          35450000
007721         SET SU090-DB2-ERROR          TO TRUE                     35460000
007722         MOVE SQLCODE                 TO SU090-SQLCODE            35470000
007723         MOVE SQLCA                   TO SU090-SQLCA              35480000
007724         MOVE PV-ABEND-PROGRAM        TO SU090-ERR-PROGRAM        35490000
007725         MOVE '4400-CLOSE-PO-RCVR-LINE-CURSOR'                    35500000
007726                                      TO PV-ABEND-PARAGRAPH       35510000
007727                                         SU090-ERR-PARAGRAPH      35520000
007728         MOVE 'MAX RETRIES CLOSING PO/RCVR/LINE CARTON LIST CSR'  35530000
007729                                      TO PV-ABEND-OPER-MESSAGE-1  35540000
007730         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         35550000
007731         MOVE DK-PO-NBR               TO PV-PO-NBR-N              35560000
007732         MOVE DK-RCVR-SEQ-NBR         TO PV-RCVR-SEQ-NBR-N        35570000
007733         MOVE DK-PO-LNE-NBR           TO PV-PO-LNE-NBR-N          35580000
007734         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        35590000
007735                 PV-OPER-UNT-ID-DISP                              35600000
007736                                         DELIMITED BY SIZE        35610000
007737                '   PO NBR: '                                     35620000
007738                                         DELIMITED BY SIZE        35630000
007739                 PV-PO-NBR-DISP                                   35640000
007740                                         DELIMITED BY SIZE        35650000
007741                '   RCVR SEQ NBR: '                               35660000
007742                                         DELIMITED BY SIZE        35670000
007743                 PV-RCVR-SEQ-NBR                                  35680000
007744                                         DELIMITED BY SIZE        35690000
007745                                    INTO PV-ABEND-OPER-MESSAGE-2  35700000
007746         STRING 'PO LINE NBR: '          DELIMITED BY SIZE        35710000
007747                PV-PO-LNE-NBR-DISP                                35720000
007748                                         DELIMITED BY SIZE        35730000
007749                                    INTO PV-ABEND-OPER-MESSAGE-3  35740000
007750         MOVE 'SUT_CART_DIRV_TRKG'    TO PV-ABEND-TABLE-1         35750000
007751         PERFORM 9900-DB2-ERROR                                   35760000
007752     END-IF.                                                      35770000
007753                                                                  35780000
007754                                                                  35790000
007755******************************************************************35800000
007756* PROCESS THE CURSOR THAT BRINGS BACK A LIST OF BARCODES FOR      35810000
007757* CARTONS FOR A PO/RCVR/PACK WHICH HAD DIRECTIVES SENT, BUT NOT   35820000
007758* RELEASED.                                                       35830000
007759******************************************************************35840000
007760 4500-PO-RCVR-PACK-DIRECTIVE.                                     35850000
007761                                                                  35860000
007762     SET PS-NOT-END-OF-CURSOR TO TRUE.                            35870000
007763     MOVE +0                  TO PV-CURSOR-COUNT.                 35880000
007764     PERFORM 4600-OPEN-PO-RCVR-PACK-CURSOR.                       35890000
007765     PERFORM 4700-FETCH-PO-RCVR-PACK-CURSOR.                      35900000
007766     PERFORM 4800-PROCESS-PO-RCVR-PACK-CSR                        35910000
007767         UNTIL PS-END-OF-CURSOR OR                                35920000
007768               SU090-DB2-ERROR.                                   35930000
007769     IF  SU090-SUCCESS                                            35940000
007770         PERFORM 4900-CLOSE-PO-RCVR-PACK-CURSOR                   35950000
007771     END-IF.                                                      35960000
007772                                                                  35970000
007773******************************************************************35980000
007774* OPEN THE PO/RECEIVER/PACK CARTON LIST CURSOR                    35990000
007775******************************************************************36000000
007776 4600-OPEN-PO-RCVR-PACK-CURSOR.                                   36010000
007777                                                                  36020000
007778     MOVE SU090-OPER-UNT-ID  TO DK-OPER-UNT-ID.                   36030000
007779     MOVE SU090-PO-NBR       TO DK-PO-NBR.                        36040000
007780     MOVE SU090-RCVR-SEQ-NBR TO DK-RCVR-SEQ-NBR.                  36050000
007781     MOVE SU090-PO-PREPK-ID  TO DK-PREPK-ID.                      36060000
007782                                                                  36070000
007783     PERFORM                                                      36080000
007784         WITH TEST AFTER                                          36090000
007785         VARYING PV-RETRY-COUNT                                   36100000
007786         FROM 1 BY 1                                              36110000
007787         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 36120000
007788                   OR (SQLCODE = ZERO))                           36130000
007789         EXEC SQL                                                 36140000
007790              OPEN PO_RCVR_PREPK_CART_LST                         36150000
007791         END-EXEC                                                 36160000
007792                                                                  36170000
007793         EVALUATE TRUE                                            36180000
007794             WHEN SQLCODE = +0                                    36190000
007795             WHEN SQLCODE = -904                                  36200000
007796             WHEN SQLCODE = -911                                  36210000
007797             WHEN SQLCODE = -913                                  36220000
007798                 CONTINUE                                         36230000
007799             WHEN SQLWARN0 NOT EQUAL SPACE                        36240000
007800             WHEN SQLCODE NOT EQUAL ZERO                          36250000
007801                 SET SU090-DB2-ERROR  TO TRUE                     36260000
007802                 MOVE SQLCODE         TO SU090-SQLCODE            36270000
007803                 MOVE SQLCA           TO SU090-SQLCA              36280000
007804                 MOVE PV-ABEND-PROGRAM                            36290000
007805                                      TO SU090-ERR-PROGRAM        36300000
007806                 MOVE '4600-OPEN-PO-RCVR-PACK-CURSOR'             36310000
007807                                      TO PV-ABEND-PARAGRAPH       36320000
007808                                         SU090-ERR-PARAGRAPH      36330000
007809                 MOVE 'ERROR OPENING PO/RCVR/PACK CARTON LIST CSR'36340000
007810                                      TO PV-ABEND-OPER-MESSAGE-1  36350000
007811                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         36360000
007812                 MOVE DK-PO-NBR       TO PV-PO-NBR-N              36370000
007813                 MOVE DK-RCVR-SEQ-NBR TO PV-RCVR-SEQ-NBR-N        36380000
007814                 MOVE DK-PREPK-ID     TO PV-PREPK-ID-N            36390000
007815                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        36400000
007816                         PV-OPER-UNT-ID-DISP                      36410000
007817                                         DELIMITED BY SIZE        36420000
007818                        '   PO NBR: '    DELIMITED BY SIZE        36430000
007819                         PV-PO-NBR-DISP                           36440000
007820                                         DELIMITED BY SIZE        36450000
007821                        '   RCVR SEQ NBR: '                       36460000
007822                                         DELIMITED BY SIZE        36470000
007823                         PV-RCVR-SEQ-NBR DELIMITED BY SIZE        36480000
007824                                    INTO PV-ABEND-OPER-MESSAGE-2  36490000
007825                 STRING 'PREPACK ID: '   DELIMITED BY SIZE        36500000
007826                         PV-PREPK-ID-DISP                         36510000
007827                                         DELIMITED BY SIZE        36520000
007828                                    INTO PV-ABEND-OPER-MESSAGE-3  36530000
007829                 MOVE 'SUT_CART_DIRV_TRKG'                        36540000
007830                                      TO PV-ABEND-TABLE-1         36550000
007840                 PERFORM 9900-DB2-ERROR                           36560000
007850         END-EVALUATE                                             36570000
007860     END-PERFORM.                                                 36580000
007861                                                                  36590000
007862     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          36600000
007863         SET SU090-DB2-ERROR          TO TRUE                     36610000
007864         MOVE SQLCODE                 TO SU090-SQLCODE            36620000
007865         MOVE SQLCA                   TO SU090-SQLCA              36630000
007866         MOVE PV-ABEND-PROGRAM        TO SU090-ERR-PROGRAM        36640000
007867         MOVE '4600-OPEN-PO-RCVR-PACK-CURSOR'                     36650000
007868                                      TO PV-ABEND-PARAGRAPH       36660000
007869                                         SU090-ERR-PARAGRAPH      36670000
007870         MOVE 'MAX RETRIES OPENING PO/RCVR/PACK CARTON LIST CSR'  36680000
007871                                      TO PV-ABEND-OPER-MESSAGE-1  36690000
007872         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         36700000
007873         MOVE DK-PO-NBR               TO PV-PO-NBR-N              36710000
007874         MOVE DK-RCVR-SEQ-NBR         TO PV-RCVR-SEQ-NBR-N        36720000
007875         MOVE DK-PREPK-ID             TO PV-PREPK-ID-N            36730000
007876         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        36740000
007877                 PV-OPER-UNT-ID-DISP     DELIMITED BY SIZE        36750000
007878                '   PO NBR: '            DELIMITED BY SIZE        36760000
007879                 PV-PO-NBR-DISP          DELIMITED BY SIZE        36770000
007880                '   RCVR SEQ NBR: '      DELIMITED BY SIZE        36780000
007890                 PV-RCVR-SEQ-NBR         DELIMITED BY SIZE        36790000
007891                                    INTO PV-ABEND-OPER-MESSAGE-2  36800000
007892         STRING 'PREPACK ID: '           DELIMITED BY SIZE        36810000
007893                 PV-PREPK-ID-DISP        DELIMITED BY SIZE        36820000
007894                                    INTO PV-ABEND-OPER-MESSAGE-3  36830000
007895         MOVE 'SUT_CART_DIRV_TRKG'    TO PV-ABEND-TABLE-1         36840000
007896         PERFORM 9900-DB2-ERROR                                   36850000
007897     END-IF.                                                      36860000
007898                                                                  36870000
007899                                                                  36880000
007900******************************************************************36890000
007901* FETCH A ROW FROM THE PO/RECEIVER/PACK CARTON LIST CURSOR.      *36900000
007902******************************************************************36910000
007903 4700-FETCH-PO-RCVR-PACK-CURSOR.                                  36920000
007904                                                                  36930000
007905     EXEC SQL                                                     36940000
007906          FETCH PO_RCVR_PREPK_CART_LST                            36950000
007907           INTO :SUT00102-BRCDE-NBR                               36960000
007908               ,:SUT00102-SHIPT-UNT-ID                            36970000
007909     END-EXEC.                                                    36980000
007910                                                                  36990000
007911     EVALUATE TRUE                                                37000000
007912       WHEN SQLCODE = ZERO                                        37010000
007913           ADD +1                    TO PV-CURSOR-COUNT           37020000
007914           MOVE SUT00102-BRCDE-NBR   TO DK-BRCDE-NBR              37030000
007915           MOVE SUT00102-SHIPT-UNT-ID                             37040000
007916                                     TO DK-SHIPT-UNT-ID           37050000
007917           IF  SUT00102-SHIPT-UNT-ID > 0                          37060000
007918               MOVE PC-S             TO DK-BRCDE-TYP-CDE          37070000
007919           ELSE                                                   37080000
007920               MOVE PC-P             TO DK-BRCDE-TYP-CDE          37090000
007921           END-IF                                                 37100000
007922                                                                  37110000
007923       WHEN SQLCODE = +100                                        37120000
007924           SET PS-END-OF-CURSOR  TO TRUE                          37130000
007925                                                                  37140000
007926       WHEN SQLWARN0 NOT EQUAL SPACE                              37150000
007927       WHEN SQLCODE NOT EQUAL ZERO                                37160000
007928           SET SU090-DB2-ERROR       TO TRUE                      37170000
007929           MOVE SQLCODE              TO SU090-SQLCODE             37180000
007930           MOVE SQLCA                TO SU090-SQLCA               37190000
007940           MOVE PV-ABEND-PROGRAM     TO SU090-ERR-PROGRAM         37200000
007950           MOVE '4700-FETCH-PO-RCVR-PACK-CURSOR'                  37210000
007960                                     TO PV-ABEND-PARAGRAPH        37220000
007970                                        SU090-ERR-PARAGRAPH       37230000
007971           MOVE 'FETCH PO/RCVR/PACK CARTON LIST CURSOR ROW'       37240000
007972                                     TO PV-ABEND-OPER-MESSAGE-1   37250000
007973           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          37260000
007974           MOVE DK-PO-NBR            TO PV-PO-NBR-N               37270000
007975           MOVE DK-RCVR-SEQ-NBR      TO PV-RCVR-SEQ-NBR-N         37280000
007976           MOVE DK-PREPK-ID          TO PV-PREPK-ID-N             37290000
007977           STRING 'OPER UNT ID: '       DELIMITED BY SIZE         37300000
007978                   PV-OPER-UNT-ID-DISP                            37310000
007979                                        DELIMITED BY SIZE         37320000
007980                   '   PO NBR: '                                  37330000
007981                                        DELIMITED BY SIZE         37340000
007982                   PV-PO-NBR-DISP                                 37350000
007983                                        DELIMITED BY SIZE         37360000
007984                   '   RCVR SEQ NBR: '                            37370000
007985                                        DELIMITED BY SIZE         37380000
007986                   PV-RCVR-SEQ-NBR                                37390000
007987                                        DELIMITED BY SIZE         37400000
007988                                   INTO PV-ABEND-OPER-MESSAGE-2   37410000
007989           STRING 'PREPACK ID: '        DELIMITED BY SIZE         37420000
007990                   PV-PREPK-ID-DISP     DELIMITED BY SIZE         37430000
007991                                   INTO PV-ABEND-OPER-MESSAGE-3   37440000
007992           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          37450000
007993           PERFORM 9900-DB2-ERROR                                 37460000
007994     END-EVALUATE.                                                37470000
007995                                                                  37480000
007996                                                                  37490000
007997******************************************************************37500000
007998* WRITE A DIRECTIVE MESSAGE TO MQ AND WRITE A HISTORY RECORD FOR  37510000
007999* EACH BARCODE FOUND IN THE CURSOR.                               37520000
008000******************************************************************37530000
008001 4800-PROCESS-PO-RCVR-PACK-CSR.                                   37540000
**TEMP*    DISPLAY '4800-PROCESS-PO-RCVR-PACK-CSR'.                     37541039
008002                                                                  37550000
008003     PERFORM 2000-CARTON-DIRECTIVE.                               37560000
008004                                                                  37570000
008005     IF  SU090-SUCCESS                                            37580000
008006         PERFORM 4700-FETCH-PO-RCVR-PACK-CURSOR                   37590000
008007     END-IF.                                                      37600000
008008                                                                  37610000
008009******************************************************************37620000
008010* CLOSE THE PO/RECEIVER CARTON LIST CURSOR                        37630000
008011******************************************************************37640000
008012 4900-CLOSE-PO-RCVR-PACK-CURSOR.                                  37650000
008013                                                                  37660000
008014     PERFORM                                                      37670000
008015         WITH TEST AFTER                                          37680000
008016         VARYING PV-RETRY-COUNT                                   37690000
008017         FROM 1 BY 1                                              37700000
008018         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 37710000
008019                   OR (SQLCODE = ZERO))                           37720000
008020         EXEC SQL                                                 37730000
008021             CLOSE PO_RCVR_PREPK_CART_LST                         37740000
008022         END-EXEC                                                 37750000
008023                                                                  37760000
008024         EVALUATE TRUE                                            37770000
008025             WHEN SQLCODE = +0                                    37780000
008026             WHEN SQLCODE = -904                                  37790000
008027             WHEN SQLCODE = -911                                  37800000
008028             WHEN SQLCODE = -913                                  37810000
008029                 CONTINUE                                         37820000
008030             WHEN SQLWARN0 NOT EQUAL SPACE                        37830000
008031             WHEN SQLCODE NOT EQUAL ZERO                          37840000
008032                 SET SU090-DB2-ERROR  TO TRUE                     37850000
008033                 MOVE SQLCODE         TO SU090-SQLCODE            37860000
008034                 MOVE SQLCA           TO SU090-SQLCA              37870000
008035                 MOVE PV-ABEND-PROGRAM                            37880000
008036                                      TO SU090-ERR-PROGRAM        37890000
008037                 MOVE '4900-CLOSE-PO-RCVR-PACK-CURSOR'            37900000
008038                                      TO PV-ABEND-PARAGRAPH       37910000
008039                                         SU090-ERR-PARAGRAPH      37920000
008040                 MOVE 'ERROR CLOSING PO/RCVR/PACK CARTON LIST CSR'37930000
008041                                      TO PV-ABEND-OPER-MESSAGE-1  37940000
008042                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         37950000
008043                 MOVE DK-PO-NBR       TO PV-PO-NBR-N              37960000
008044                 MOVE DK-RCVR-SEQ-NBR TO PV-RCVR-SEQ-NBR-N        37970000
008045                 MOVE DK-PREPK-ID     TO PV-PREPK-ID-N            37980000
008046                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        37990000
008047                         PV-OPER-UNT-ID-DISP                      38000000
008048                                         DELIMITED BY SIZE        38010000
008049                        '   PO NBR: '                             38020000
008050                                         DELIMITED BY SIZE        38030000
008051                         PV-PO-NBR-DISP                           38040000
008052                                         DELIMITED BY SIZE        38050000
008053                        '   RCVR SEQ NBR: '                       38060000
008054                                         DELIMITED BY SIZE        38070000
008055                         PV-RCVR-SEQ-NBR                          38080000
008056                                         DELIMITED BY SIZE        38090000
008057                                    INTO PV-ABEND-OPER-MESSAGE-2  38100000
008058                 STRING 'PREPACK ID: '   DELIMITED BY SIZE        38110000
008059                         PV-PREPK-ID-DISP                         38120000
008060                                         DELIMITED BY SIZE        38130000
008061                                    INTO PV-ABEND-OPER-MESSAGE-3  38140000
008062                 MOVE 'SUT_CART_DIRV_TRKG'                        38150000
008063                                      TO PV-ABEND-TABLE-1         38160000
008064                 PERFORM 9900-DB2-ERROR                           38170000
008065         END-EVALUATE                                             38180000
008066     END-PERFORM.                                                 38190000
008067                                                                  38200000
008068     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          38210000
008069         SET SU090-DB2-ERROR          TO TRUE                     38220000
008070         MOVE SQLCODE                 TO SU090-SQLCODE            38230000
008080         MOVE SQLCA                   TO SU090-SQLCA              38240000
008090         MOVE PV-ABEND-PROGRAM        TO SU090-ERR-PROGRAM        38250000
008100         MOVE '4900-CLOSE-PO-RCVR-PACK-CURSOR'                    38260000
008101                                      TO PV-ABEND-PARAGRAPH       38270000
008102                                         SU090-ERR-PARAGRAPH      38280000
008103         MOVE 'MAX RETRIES CLOSING PO/RCVR/PACK CARTON LIST CSR'  38290000
008104                                      TO PV-ABEND-OPER-MESSAGE-1  38300000
008105         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         38310000
008106         MOVE DK-PO-NBR               TO PV-PO-NBR-N              38320000
008107         MOVE DK-RCVR-SEQ-NBR         TO PV-RCVR-SEQ-NBR-N        38330000
008108         MOVE DK-PREPK-ID             TO PV-PREPK-ID-N            38340000
008109         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        38350000
008110                 PV-OPER-UNT-ID-DISP                              38360000
008111                                         DELIMITED BY SIZE        38370000
008112                '   PO NBR: '                                     38380000
008113                                         DELIMITED BY SIZE        38390000
008114                 PV-PO-NBR-DISP                                   38400000
008115                                         DELIMITED BY SIZE        38410000
008116                '   RCVR SEQ NBR: '                               38420000
008117                                         DELIMITED BY SIZE        38430000
008118                 PV-RCVR-SEQ-NBR                                  38440000
008119                                         DELIMITED BY SIZE        38450000
008120                                    INTO PV-ABEND-OPER-MESSAGE-2  38460000
008121         STRING 'PREPACK ID: '           DELIMITED BY SIZE        38470000
008122                 PV-PREPK-ID-DISP        DELIMITED BY SIZE        38480000
008123                                    INTO PV-ABEND-OPER-MESSAGE-3  38490000
008124         MOVE 'SUT_CART_DIRV_TRKG'    TO PV-ABEND-TABLE-1         38500000
008125         PERFORM 9900-DB2-ERROR                                   38510000
008126     END-IF.                                                      38520000
008127                                                                  38530000
008128                                                                  38540000
008129******************************************************************38550000
008130 5000-CREATE-MSGS.                                                38560000
008131                                                                  38570000
008132     MOVE PV-CARET-TRIMMED-REC-LGTH  TO PV-MSG-LENGTH.            38580000
008133     MOVE PV-CARET-TRIMMED-RECORD (1:PV-CARET-TRIMMED-REC-LGTH)   38590000
008134                                     TO PV-MQ-OUTPUT-RECORD.      38600000
008135     MOVE PV-MSG-LENGTH              TO PV-MSG-LENGTH-DISPLAY.    38610000
008136     MOVE PC-DIRVGENSUKUT129         TO MQMD-APPLIDENTITYDATA.    38620000
008137                                                                  38630000
008140     MOVE SPACE TO PS-MQPUT-SUCCESSFUL-IND.                       38640023
008141     MOVE ZERO  TO PC-MQPUT-RETRY-COUNTER.                        38650023
008142                                                                  38660023
008143* PUT TO QUEUE.                                                   38670000
008144     PERFORM 5100-MQ-PUT-TO-QUEUE                                 38680000
008145       UNTIL PS-MQPUT-SUCCESSFUL                                  38690023
008146          OR PS-MQPUT-SUCCESSFUL-NO.                              38700023
008147                                                                  38710023
1023RM     IF PS-MQPUT-SUCCESSFUL                                       38720027
**TEMP*    DISPLAY 'SUKUT129 5000- SUCCESSFUL MQ-PUT'                   38730039
1023RM         IF PS-ADDL-DRTVMSGQ-YES                                  38740027
1023RM             MOVE SPACE TO PS-DRCTV-MQPUT-SUCCESSFUL-IND          38750035
1023RM             PERFORM 5150-MQ-PUT-DRCTV-QUEUE                      38760028
1023RM               UNTIL PS-DRCTV-MQPUT-SUCCESSFUL                    38770035
1023RM                  OR PS-DRCTV-MQPUT-SUCCESSFUL-NO                 38780035
1023RM         END-IF                                                   38790027
1023RM     END-IF.                                                      38800027
008148***************************************************************   38810023
008149******************************************************************38820023
008150*                                                                *38830023
008151*             5 1 0 0 - P U T   M Q   M E S S A G E              *38840023
008152*                                                                *38850023
008153******************************************************************38860023
008154 5100-MQ-PUT-TO-QUEUE.                                            38870023
008155                                                                  38880023
008156     MOVE MQMI-NONE    TO MQMD-MSGID.                             38890023
008157     MOVE MQCI-NONE    TO MQMD-CORRELID.                          38900023
008158     MOVE MQFMT-STRING TO MQMD-FORMAT.                            38910023
008159                                                                  38920023
008160     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   38930023
008161     COMPUTE MQPMO-OPTIONS  = MQPMO-SYNCPOINT                     38940023
008162                            + MQPMO-SET-IDENTITY-CONTEXT.         38950023
008163     PERFORM 5110-LOW-VALUES.                                     38960023
008164                                                                  38970023
008165     CALL PV-MQPUT USING PV-HCONN                                 38980023
008166                         PV-PQ-HANDLE                             38990023
008167                         MQM-MESSAGE-DESCRIPTOR                   39000023
008168                         MQM-PUT-MESSAGE-OPTIONS                  39010023
008169                         PV-MSG-LENGTH                            39020023
008170                         PV-MQ-OUTPUT-RECORD                      39030023
008171                         PV-COMPLETION-CODE                       39040023
008172                         PV-REASON.                               39050023
008173                                                                  39060023
008174*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         39070023
008175     IF  PV-COMPLETION-CODE NOT = MQCC-OK                         39080024
008179         CALL PV-MQCHECK USING PV-REASON                          39090024
008180                               PV-MQ-REASON-TEXT                  39100024
008181         SET SU090-MQ-ERROR      TO TRUE                          39110024
008182         MOVE PV-ABEND-PROGRAM   TO SU090-ERR-PROGRAM             39120024
008183         DISPLAY 'MQ MESSAGE = '                                  39130024
008184                 PV-CARET-TRIMMED-RECORD                          39140024
008185                 (1:PV-CARET-TRIMMED-REC-LGTH)                    39150024
008186         MOVE '5100-MQ-PUT-TO-QUEUE'  TO SU090-ERR-PARAGRAPH      39160024
008187         MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE         39170024
008188         MOVE PV-COMPLETION-CODE  TO PV-HOLD-COMPLETION-CODE      39180024
008189                                     PE-MQ-COMPLETION-CODE        39190024
008190                                     SU090-MQ-COND-CODE           39200024
008191         MOVE PV-REASON           TO PV-HOLD-REASON               39210024
008192                                     PE-MQ-REASON-CODE            39220024
008193                                     SU090-MQ-REAS-CODE           39230024
008194         MOVE PV-MQ-REASON-TEXT   TO SU090-MQ-REAS-TXT            39240024
008200         PERFORM 9200-MQ-ERROR                                    39250024
008210         SET PS-MQPUT-SUCCESSFUL-NO TO TRUE                       39260024
008703     ELSE                                                         39270000
008704         ADD 1 TO PA-TOTAL-MQ-MSGS-SENT                           39280000
008705         SET PS-MQPUT-SUCCESSFUL TO TRUE                          39290000
008706     END-IF.                                                      39300000
008707                                                                  39310000
008708******************************************************************39320000
008709 5110-LOW-VALUES.                                                 39330000
008710                                                                  39340000
008711     MOVE PV-MQ-OUTPUT-RECORD       TO PV-HOLD-MQ-OUTPUT-RECORD.  39350000
008712                                                                  39360000
008713     PERFORM                                                      39370000
008714       VARYING PV-CHAR-POSN FROM 1 BY 1                           39380000
008715         UNTIL PV-CHAR-POSN > PV-MSG-LENGTH                       39390000
008716                                                                  39400000
008717         IF PV-MQ-OUTPUT-CHAR (PV-CHAR-POSN) = LOW-VALUES         39410000
008718             MOVE SPACES TO PV-MQ-OUTPUT-CHAR (PV-CHAR-POSN)      39420000
008719         END-IF                                                   39430000
008720                                                                  39440000
008721     END-PERFORM.                                                 39450000
008722                                                                  39460000
008723     MOVE PV-HOLD-MQ-OUTPUT-RECORD  TO PV-MQ-OUTPUT-RECORD.       39470000
008724                                                                  39480000
008149******************************************************************39490028
008151*  PUT MESSAGE TO DIRECTIVE QUEUE                                 39500028
008153******************************************************************39510028
1023RM 5150-MQ-PUT-DRCTV-QUEUE.                                         39520028
**TEMP*    DISPLAY 'SUKUT129 5150-MQPUT-DRCTV QUEUE'                    39530039
1023RM     MOVE MQMI-NONE    TO MQMD-MSGID.                             39540027
1023RM     MOVE MQCI-NONE    TO MQMD-CORRELID.                          39550027
1023RM     MOVE MQFMT-STRING TO MQMD-FORMAT.                            39560027
1023RM                                                                  39570027
1023RM     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   39580027
1023RM     COMPUTE MQPMO-OPTIONS  = MQPMO-SYNCPOINT                     39590027
1023RM                            + MQPMO-SET-IDENTITY-CONTEXT.         39600027
1023RM     PERFORM 5110-LOW-VALUES.                                     39610027
1023RM                                                                  39620027
1023RM     CALL PV-MQPUT USING PV-HCONN                                 39630027
1023RM                         PV-DRTV-HANDLE                           39640028
1023RM                         MQM-MESSAGE-DESCRIPTOR                   39650027
1023RM                         MQM-PUT-MESSAGE-OPTIONS                  39660027
1023RM                         PV-MSG-LENGTH                            39670027
1023RM                         PV-MQ-OUTPUT-RECORD                      39680027
1023RM                         PV-COMPLETION-CODE                       39690027
1023RM                         PV-REASON.                               39700027
1023RM                                                                  39710027
1023RM*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         39720027
1023RM     IF  PV-COMPLETION-CODE NOT = MQCC-OK                         39730027
1023RM         CALL PV-MQCHECK USING PV-REASON                          39740027
1023RM                               PV-MQ-REASON-TEXT                  39750027
1023RM         SET SU090-MQ-ERROR      TO TRUE                          39760027
1023RM         MOVE PV-ABEND-PROGRAM   TO SU090-ERR-PROGRAM             39770027
1023RM         DISPLAY 'MQ MESSAGE = '                                  39780027
1023RM                 PV-CARET-TRIMMED-RECORD                          39790027
1023RM                 (1:PV-CARET-TRIMMED-REC-LGTH)                    39800027
1023RM         MOVE '5150-MQ-PUT-DRCTV-QUEUE' TO SU090-ERR-PARAGRAPH    39810030
1023RM         MOVE 'MQPUT FAILED'            TO PV-ERROR-MESSAGE       39820030
1023RM         MOVE PV-COMPLETION-CODE  TO PV-HOLD-COMPLETION-CODE      39830027
1023RM                                     PE-MQ-COMPLETION-CODE        39840027
1023RM                                     SU090-MQ-COND-CODE           39850027
1023RM         MOVE PV-REASON           TO PV-HOLD-REASON               39860027
1023RM                                     PE-MQ-REASON-CODE            39870027
1023RM                                     SU090-MQ-REAS-CODE           39880027
1023RM         MOVE PV-MQ-REASON-TEXT   TO SU090-MQ-REAS-TXT            39890027
1023RM         PERFORM 9200-MQ-ERROR                                    39900027
1023RM         SET PS-DRCTV-MQPUT-SUCCESSFUL-NO TO TRUE                 39910037
**TEMP*    DISPLAY 'SUKUT129 5250-MQPUT FAILED ' PV-REASON              39920039
1023RM     ELSE                                                         39930027
1023RM         ADD 1 TO PA-TOTAL-MQ-MSGS-SENT                           39940027
**TEMP*    DISPLAY 'SUKUT129 5250-MQPUT-SUCCESSFUL'                     39950039
1023RM         SET PS-DRCTV-MQPUT-SUCCESSFUL TO TRUE                    39960035
1023RM     END-IF.                                                      39970027
      ******************************************************************39980027
008726* BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       39990000
008727******************************************************************40000000
008728 5200-BACK-OUT-MQ.                                                40010000
008729                                                                  40020000
008730     CALL PV-MQBACK USING PV-HCONN                                40030000
008731                          PV-COMPLETION-CODE                      40040000
008732                          PV-REASON.                              40050000
008733                                                                  40060000
008734     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        40070000
008735        CALL PV-MQCHECK USING PV-REASON                           40080000
008736                              PV-MQ-REASON-TEXT                   40090000
008737        SET SU090-MQ-ERROR      TO TRUE                           40100000
008738        MOVE PV-ABEND-PROGRAM   TO SU090-ERR-PROGRAM              40110000
008739        MOVE '5200-BACK-OUT-MQ' TO SU090-ERR-PARAGRAPH            40120000
008740        MOVE PV-COMPLETION-CODE TO SU090-MQ-COND-CODE             40130000
008750        MOVE PV-REASON          TO SU090-MQ-REAS-CODE             40140000
008760        MOVE PV-MQ-REASON-TEXT  TO SU090-MQ-REAS-TXT              40150000
008770        MOVE 'MQBACK ERROR'     TO PV-ERROR-MESSAGE               40160000
008780        PERFORM 9200-MQ-ERROR                                     40170000
008790     END-IF.                                                      40180000
008791                                                                  40190000
008792****************************************************************  40200000
008793** PERFORM MQ-SERIES ERROR MESSAGE DISPLAY PROCESSING             40210000
008794****************************************************************  40220000
008795 9200-MQ-ERROR.                                                   40230000
008796                                                                  40240000
008797     DISPLAY '****************** A B E N D ******************'.   40250000
008798     DISPLAY '** MQSERIES ERROR **'.                              40260000
008799     DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.          40270000
008800     DISPLAY '** PARAGRAPH:  ', SU090-ERR-PARAGRAPH.              40280000
008801     DISPLAY '** MESSAGE:    ', PV-ERROR-MESSAGE.                 40290000
008802     DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.            40300000
008803     DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                40310000
008804     DISPLAY '** RSN TEXT:   ', PV-MQ-REASON-TEXT.                40320000
008805     DISPLAY '***********************************************'.   40330000
008806                                                                  40340000
008807******************************************************************40350000
008808* 9900-DB2-ERROR - PERFORMS THE DISPLAY OF THE FORMATTED DB2      40360000
008809* MESSAGE IN THE EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.  40370000
008810******************************************************************40380000
008811 9900-DB2-ERROR.                                                  40390000
008812                                                                  40400000
008813     MOVE SQLCODE    TO PV-SQLCODE.                               40410000
008814     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       40420000
008815     DISPLAY '******* START OF SUKUT129 ERROR DISPLAY *******'    40430000
008816     DISPLAY '*** DB2 ERROR ***'.                                 40440000
008817     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               40450000
008818     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 40460000
008819     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               40470000
008820     DISPLAY '*** OPERATION = ' PV-ABEND-OPER-MESSAGE-1.          40480000
008830     DISPLAY '***           = ' PV-ABEND-OPER-MESSAGE-2.          40490000
008840     DISPLAY '***           = ' PV-ABEND-OPER-MESSAGE-3.          40500000
008850     DISPLAY '***           = ' PV-ABEND-OPER-MESSAGE-4.          40510000
008860                                                                  40520000
008870     DISPLAY '***           = ' PV-ABEND-TABLE-2.                 40530000
008871     DISPLAY '***           = ' PV-ABEND-TABLE-3.                 40540000
008872     DISPLAY '***           = ' PV-ABEND-TABLE-4.                 40550000
008873                                                                  40560000
008874     DISPLAY '***'.                                               40570000
008875     DISPLAY '*** COMMUNICATION AREA ***'.                        40580000
008876     DISPLAY '*** CALLING-PGM       = ' SU090-CALLING-PGM.        40590000
008877     DISPLAY '*** BATCH-ONLINE-IND  = ' SU090-BATCH-ONLINE-IND.   40600000
008878     DISPLAY '*** OPER-UNT-ID-X     = ' SU090-OPER-UNT-ID-X.      40610000
008879     DISPLAY '*** ACTN-CDE          = ' SU090-ACTN-CDE.           40620000
008880     DISPLAY '*** DIRECTIVE-LVL-CDE = ' SU090-DIRECTIVE-LVL-CDE.  40630000
008890     DISPLAY '*** DIRV-RSN-CDE      = ' SU090-DIRV-RSN-CDE.       40640000
008900     DISPLAY '*** BRCDE-TYP-CDE     = ' SU090-BRCDE-TYP-CDE.      40650000
009000     DISPLAY '*** SML-BRCDE-NBR-X   = ' SU090-SML-BRCDE-NBR-X.    40660000
009100     DISPLAY '*** P2L-BRCDE-NBR     = ' SU090-P2L-BRCDE-NBR.      40670000
009110     DISPLAY '*** PO-NBR-X          = ' SU090-PO-NBR-X.           40680000
009120     DISPLAY '*** PO-LNE-NBR-X      = ' SU090-PO-LNE-NBR-X.       40690000
009121     DISPLAY '*** PO-PREPK-ID-X     = ' SU090-PO-PREPK-ID-X.      40700000
009122     DISPLAY '*** RCVR-SEQ-NBR-X    = ' SU090-RCVR-SEQ-NBR-X.     40710000
009123     DISPLAY '*** CASI-CDE          = ' SU090-CASI-CDE.           40720000
009124     DISPLAY '*** CART-STAT-CDE     = ' SU090-CART-STAT-CDE.      40730000
009125     DISPLAY '*** AUD-CNTL-NBR-X    = ' SU090-AUD-CNTL-NBR-X.     40740000
009126     DISPLAY '*** AUD-STAT-CDE      = ' SU090-AUD-STAT-CDE.       40750000
009127     DISPLAY '*** AUD-FAIL-RSN      = ' SU090-AUD-FAIL-RSN.       40760000
009128     DISPLAY '*** STR-ZN            = ' SU090-STR-ZN.             40770000
009129     DISPLAY '*** SEASET-YR         = ' SU090-SEASET-YR.          40780000
009130     DISPLAY '*** SEASET-CDE        = ' SU090-SEASET-CDE.         40790000
009140     DISPLAY '*** STR-NBR-X         = ' SU090-STR-NBR-X.          40800000
009150     DISPLAY '*** ASSOC-ID          = ' SU090-ASSOC-ID.           40810000
009160                                                                  40820000
009170     DISPLAY '***'.                                               40830000
009180     DISPLAY '*** INSERT VARIABLES ***'.                          40840000
009190     DISPLAY '*** BRCDE_NBR         = ' SUT00102-BRCDE-NBR.       40850000
009200     DISPLAY '*** CRE_TMST          = ' SUT00102-CRE-TMST.        40860000
009210     DISPLAY '*** OPER_UNT_ID       = ' SUT00102-OPER-UNT-ID.     40870000
009220     DISPLAY '*** DIRV_RSN_CDE      = ' SUT00102-DIRV-RSN-CDE.    40880000
009230     DISPLAY '*** LGCL_LOC_NM       = ' SUT00102-LGCL-LOC-NM.     40890000
009231     DISPLAY '*** AUD_CNTL_NBR      = ' SUT00102-AUD-CNTL-NBR.    40900000
009232     DISPLAY '*** SHIPT_UNT_ID      = ' SUT00102-SHIPT-UNT-ID.    40910000
009233     DISPLAY '*** AUD_STAT_CDE      = ' SUT00102-AUD-STAT-CDE.    40920000
009234     DISPLAY '*** PO_NBR            = ' SUT00102-PO-NBR.          40930000
009235     DISPLAY '*** RCVR_SEQ_NBR      = ' SUT00102-RCVR-SEQ-NBR.    40940000
009236     DISPLAY '*** PO_LNE_NBR        = ' SUT00102-PO-LNE-NBR.      40950000
009237     DISPLAY '*** PREPK_ID          = ' SUT00102-PREPK-ID.        40960000
009238     DISPLAY '*** STR_NBR           = ' SUT00102-STR-NBR.         40970000
009239     DISPLAY '*** CRE_PGM_NM        = ' SUT00102-CRE-PGM-NM.      40980000
009240     DISPLAY '*** ACKNL_SEQ_NBR     = ' SUT00102-ACKNL-SEQ-NBR.   40990000
009241     DISPLAY '*** CASI_CDE          = ' SUT00102-CASI-CDE.        41000000
009242     DISPLAY '*** CART_STAT_CDE     = ' SUT00102-CART-STAT-CDE.   41010000
009243     DISPLAY '*** AUD_FALR_RSN_NM   = ' SUT00102-AUD-FALR-RSN-NM. 41020000
009244     DISPLAY '*** STR_ZN_ID         = ' SUT00102-STR-ZN-ID.       41030000
009245     DISPLAY '*** SEASET_YR         = ' SUT00102-SEASET-YR.       41040000
009246     DISPLAY '*** SEASET_SHRT_NM    = ' SUT00102-SEASET-SHRT-NM.  41050000
009247     DISPLAY '*** CNVYR_PRC_ACTN_NM = '                           41060000
009248                                     SUT00102-CNVYR-PRC-ACTN-NM.  41070000
009249     DISPLAY '*** CRE_BY_USR_ID     = ' SUT00102-CRE-BY-USR-ID.   41080000
009250                                                                  41090000
009251******************************************************************41100000
009252* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    41110000
009253* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         41120000
009254* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     41130000
009255* FORMAT.                                                         41140000
009256******************************************************************41150000
009257     COPY DPPD004.                                                41160000
009258                                                                  41170000
