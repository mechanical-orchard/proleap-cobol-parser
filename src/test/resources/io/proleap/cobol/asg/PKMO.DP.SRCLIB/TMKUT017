000100 IDENTIFICATION DIVISION.                                         02/15/96
000200 TITLE 'OPEN TO RECEIVE CALCULATION MODULE'.                      TMKUT017
001300                                                                          
      * * THIS WAS COPIED FROM DPKCS276 FOR BATCH PURPOSES                      
      * * THIS IS CALLED FROM TMKUP508                                          
      *    IF EITHER THIS PROGRAM OR DPKCS276 CHANGE, THE OTHER SHOULD          
      *    BE CHECKED TO SEE IF THE SAME CHANGE SHOULD BE MADE                  
000300 PROGRAM-ID.    TMKUT017.                                            LV004
000400 AUTHOR.        DENNIS STEFFEN - OMNI RESOURCES.                  TMKUT017
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          TMKUT017
000600 DATE-WRITTEN.  DECEMBER 1995.                                    TMKUT017
000700 DATE-COMPILED.                                                   TMKUT017
001500***************************************************************** 00150000
002600* Change History                                                *         
001300*    CHANGES                                                    *         
001300*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)              *         
001300*     DATE:    10/15/2014                                       *         
001300*                                                               *         
001300*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO# *         
001300*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/15/2014    *         
001600***************************************************************** 00160000
000800 ENVIRONMENT DIVISION.                                            TMKUT017
000900 CONFIGURATION SECTION.                                           TMKUT017
001000 SOURCE-COMPUTER.        IBM-3090.                                TMKUT017
001100 OBJECT-COMPUTER.        IBM-3090.                                TMKUT017
001200 DATA DIVISION.                                                   TMKUT017
001300 WORKING-STORAGE SECTION.                                         TMKUT017
001400                                                                  TMKUT017
001500 01  COUNTERS-AND-STUFF.                                          TMKUT017
001600     10  PV-APP-LINE-NBR         PIC S9(9) COMP VALUE ZERO.          CL**2
001700     10  PV-RECEIVED-QTY         PIC S9(9) COMP VALUE ZERO.       TMKUT017
001800     10  PV-SUM-QTY              PIC S9(9) COMP VALUE ZERO.       TMKUT017
001900*PS 10/15/2014 CHANGE STARTS                                      TMKUT017
001900     10  PV-DISP-PO-NBR          PIC 9(8).                        TMKUT017
001900*PS 10/15/2014 CHANGE ENDS                                        TMKUT017
002000     10  PV-DISP-REC-SEQ-NBR     PIC 9(4).                        TMKUT017
002100     10  PV-DISP-PO-LNE-NBR      PIC 9(3).                        TMKUT017
002200     10  PV-DISP-OPER-UNT-ID     PIC 9(4).                        TMKUT017
002300     10  PV-DISP-FCLTY-ID        PIC 9(4).                        TMKUT017
002400     10  PV-DISP-STR-NBR         PIC 9(4).                        TMKUT017
002500     10  PV-RETURN-MSG           PIC X(40).                       TMKUT017
00038      10  PV-MESSAGE-TEXT         PIC X(79).                          CL*20
002600     10  PV-SQLCODE               PIC S9(9) COMP-4.               TMKUT017
002700     10  PV-DISPLAY-SQLCODE       PIC -Z(8)9.                     TMKUT017
002800     10  PV-DISPLAY-QTY           PIC Z(4)9.                      TMKUT017
002900                                                                  TMKUT017
003000 01  PROGRAM-SWITCHES.                                            TMKUT017
003100     05  PS-ERRORS-SW                 PIC  X    VALUE 'N'.        TMKUT017
003200         88  PS-NO-ERRORS                       VALUE 'N'.        TMKUT017
003300         88  PS-YES-ERRORS                      VALUE 'Y'.        TMKUT017
003400     05  PS-EOF-PLAN-CSR-SW           PIC  X    VALUE 'N'.        TMKUT017
003500         88  PS-EOF-PLAN-CSR                    VALUE 'Y'.        TMKUT017
003600     05  PS-EOF-BASE-CSR-SW           PIC  X    VALUE 'N'.        TMKUT017
003700         88  PS-EOF-BASE-CSR                    VALUE 'Y'.        TMKUT017
003800     05  PS-EOF-PRIOR-CURSOR-SW       PIC  X    VALUE 'N'.        TMKUT017
003900         88  PS-START-PRIOR-CURSOR              VALUE 'N'.        TMKUT017
004000         88  PS-EOF-PRIOR-CURSOR                VALUE 'Y'.        TMKUT017
004100     05  PS-CURSOR-OPEN-SW            PIC  X    VALUE 'N'.        TMKUT017
004200         88  PS-CURSOR-CLOSED                   VALUE 'N'.        TMKUT017
004300         88  PS-CURSOR-OPEN                     VALUE 'Y'.        TMKUT017
004400     05  PS-LINE-DISTRO-SW            PIC  X    VALUE 'Y'.        TMKUT017
004500         88  PS-LINE-HAS-DISTRO                 VALUE 'Y'.        TMKUT017
004600         88  PS-LINE-HAS-NO-DISTRO              VALUE 'N'.        TMKUT017
004700                                                                  TMKUT017
004800 01  PROGRAM-KEYS.                                                TMKUT017
004900     05  DK-PO-NBR               PIC S9(9) COMP VALUE ZERO.       TMKUT017
005000     05  DK-LINE-NBR             PIC S9(9) COMP VALUE ZERO.       TMKUT017
005100     05  DK-STAT-CDE-AP          PIC  X(02)  VALUE 'AP'.          TMKUT017
005200     05  DK-STAT-CDE-AC          PIC  X(02)  VALUE 'AC'.          TMKUT017
005300     05  DK-STAT-CDE-CM          PIC  X(02)  VALUE 'CM'.          TMKUT017
005300     05  DK-STAT-CDE-RV          PIC  X(02)  VALUE 'RV'.          TMKUT017
005400                                                                  TMKUT017
005500 01  PROGRAM-LITERALS.                                            TMKUT017
005600     05  PC-CURRENT-PROGRAM-NAME PIC X(8)  VALUE 'TMKUT017'.      TMKUT017
005700     05  PC-A                    PIC X     VALUE 'A'.             TMKUT017
005800     05  PC-Y                    PIC X     VALUE 'Y'.             TMKUT017
005900     05  PC-AC                   PIC X(2)  VALUE 'AC'.            TMKUT017
006000     05  PC-IP                   PIC X(2)  VALUE 'IP'.            TMKUT017
006100     05  PC-CM                   PIC X(2)  VALUE 'CM'.            TMKUT017
006200     05  PC-VE                   PIC X(2)  VALUE 'VE'.            TMKUT017
006300     05  PC-SHORT-ONE            PIC S9(4) COMP VALUE +1.         TMKUT017
      *    MAX OCCURRENCES ARE SET TO THIS VALUE TO KEEP UNDER THE 32K          
      *    LIMIT FOR CICS LINK                                                  
006400     05  PC-MAX-OCCURENCES       PIC S9(5) VALUE +1450            TMKUT017
006500                                                COMP-3.           TMKUT017
006600     05  PC-NULL-TMST            PIC X(26) VALUE                  TMKUT017
006700                       '0001-01-01-00.00.00.000000'.              TMKUT017
006800     05  PC-TSYMSG-00551         PIC  9(05)  VALUE 00551.         TMKUT017
006900     05  PC-TSYMSG-01096         PIC  9(05)  VALUE 01096.         TMKUT017
007000/                                                                 TMKUT017
007100     COPY DPWS276.                                                TMKUT017
007500/                                                                 TMKUT017
      * ERROR DATA PASSED BACK UPSTREAM.                                        
022000     COPY TMRD007.                                                        
007500/                                                                 TMKUT017
007600******************************************************************TMKUT017
007700*    DB2 SQL COMMUNICATION AREA                                   TMKUT017
007800******************************************************************TMKUT017
007900     EXEC SQL                                                     TMKUT017
008000          INCLUDE SQLCA                                           TMKUT017
008100     END-EXEC.                                                    TMKUT017
008200/                                                                 TMKUT017
008300******************************************************************TMKUT017
008400*    DB2 DCLGEN FOR MERCHANDISE STORE ALLOCATION PLAN TABLE       TMKUT017
008500******************************************************************TMKUT017
008600     EXEC SQL                                                     TMKUT017
008700          INCLUDE TALLPLN                                         TMKUT017
008800     END-EXEC.                                                    TMKUT017
008900/                                                                 TMKUT017
009000******************************************************************TMKUT017
009100*    DB2 DCLGEN FOR MERCHANDISE STORE DISTRIBUTION PLAN TABLE     TMKUT017
009200******************************************************************TMKUT017
009300     EXEC SQL                                                     TMKUT017
009400          INCLUDE TMESTDS                                         TMKUT017
009500     END-EXEC.                                                    TMKUT017
009600/                                                                 TMKUT017
009700******************************************************************TMKUT017
009800*    DB2 DCLGEN FOR PO PURCHASE ITEM TABLE (PO LINE ITEMS)        TMKUT017
009900******************************************************************TMKUT017
010000     EXEC SQL                                                     TMKUT017
010100          INCLUDE TPURITM                                         TMKUT017
010200     END-EXEC.                                                    TMKUT017
010300/                                                                 TMKUT017
010400******************************************************************TMKUT017
010500*    DB2 DCLGEN FOR RECEIVER TABLE                                TMKUT017
010600******************************************************************TMKUT017
010700     EXEC SQL                                                     TMKUT017
010800          INCLUDE TRECEIV                                         TMKUT017
010900     END-EXEC.                                                    TMKUT017
011000/                                                                 TMKUT017
011100******************************************************************TMKUT017
011200*    DB2 DCLGEN FOR RECEIPT DISTRIBUTION TABLE                    TMKUT017
011300******************************************************************TMKUT017
011400     EXEC SQL                                                     TMKUT017
011500          INCLUDE TRECDIS                                         TMKUT017
011600     END-EXEC.                                                    TMKUT017
011700/                                                                 TMKUT017
011800******************************************************************TMKUT017
011900*    DB2 DCLGEN FOR RECEIVER ITEM                                 TMKUT017
012000******************************************************************TMKUT017
012100     EXEC SQL                                                     TMKUT017
012200          INCLUDE TRECITM                                         TMKUT017
012300     END-EXEC.                                                    TMKUT017
012400/                                                                 TMKUT017
012500******************************************************************TMKUT017
012600******************************************************************TMKUT017
012700*                   BASE NUMBER CURSORS                           TMKUT017
012800*                 ************************                        TMKUT017
012900*    THESE CURSORS ARE USED TO POPULATE                           TMKUT017
013000*    DP276-STORE-NBR OR DP276-LINE-NBR AND                        TMKUT017
013100*    DP276-STR-DISTRO-QTY FOR EACH STORE OR LINE.                 TMKUT017
013200*    SUBTRACTING ALL RECEIPTS FROM THIS WILL GIVE THE OTR.        TMKUT017
013300******************************************************************TMKUT017
013400******************************************************************TMKUT017
013500*    BASE-STORE NUMBER CURSOR                                     TMKUT017
013600*    A LIST OF STORES AND THEIR QTYS FOR A PO, LINE, AND PLAN     TMKUT017
013700*    THIS IS THE BASIS FOR DP276-OTR-TABLE                        TMKUT017
013800******************************************************************TMKUT017
013900     EXEC SQL                                                     TMKUT017
014000          DECLARE BASE-STORE-CSR CURSOR FOR                       TMKUT017
014100          SELECT STR_NBR                                          TMKUT017
014200               , STR_DISTRO_QTY                                   TMKUT017
014300            FROM TMESTDS                                          TMKUT017
014400           WHERE PO_NBR     = :DP276-PO-NBR                       TMKUT017
014500             AND PO_LNE_NBR = :DP276-PO-LNE-NBR                   TMKUT017
014600             AND PLAN_NBR   = :ALLPLN-PLAN-NBR                    TMKUT017
014700     END-EXEC.                                                    TMKUT017
014800                                                                  TMKUT017
014900*  THIS CURSOR IS THE BASIS FOR DP276-OTR-TABLE                   TMKUT017
015000                                                                  TMKUT017
015100     EXEC SQL                                                     TMKUT017
015200         DECLARE PLAN-CSR CURSOR FOR                              TMKUT017
015300         SELECT A.PO_LNE_NBR                                      TMKUT017
015400              , A.APP_PO_LNE_NBR                                  TMKUT017
015500           FROM TPURITM A                                         TMKUT017
015600          WHERE  A.PO_NBR        = :DP276-PO-NBR                  TMKUT017
015700             AND  (STATUS_CDE    = :DK-STAT-CDE-AP                TMKUT017
015800              OR   STATUS_CDE    = :DK-STAT-CDE-CM                TMKUT017
015900              OR   STATUS_CDE    = :DK-STAT-CDE-AC                TMKUT017
015900              OR   STATUS_CDE    = :DK-STAT-CDE-RV)               TMKUT017
016000             AND  VER_STATUS_CDE = :PC-A                          TMKUT017
016100     END-EXEC.                                                    TMKUT017
016200                                                                  TMKUT017
016300/                                                                 TMKUT017
016400******************************************************************TMKUT017
016500******************************************************************TMKUT017
016600*                     RECEIPT CURSORS                             TMKUT017
016700*                 ************************                        TMKUT017
016800*    THESE CURSORS ARE USED RETRIEVE THE PRIOR RECEIPTS TO BE     TMKUT017
016900*    SUBTRACTED FROM DP276-OTR-QTY.                               TMKUT017
017000*    RECEIVER-LEVEL PRIOR RECEIPTS ARE DEFINED AS ANY 'VE'        TMKUT017
017100*    RECEIPT OR 'IP'/'CM' RECEIPT CREATED PRIOR TO THE GIVEN      TMKUT017
017200*    RECEIVER.                                                    TMKUT017
017300*                                                                 TMKUT017
017400*    PO-LEVEL PRIOR RECEIPTS INCLUDE ALL RECEIPTS INCLUDING       TMKUT017
017500*    THE GIVEN RECEIVER.                                          TMKUT017
017600*                                                                 TMKUT017
017700******************************************************************TMKUT017
017800******************************************************************TMKUT017
017900                                                                  TMKUT017
018000******************************************************************TMKUT017
018100*    RECEIVER LEVEL VE CURSOR                                     TMKUT017
018200*    THIS IS A LIST OF RECEIVERS FOR A PO, LINE, AND DC THAT      TMKUT017
018300*    ARE EITHER VERIFIED OR HAD BEEN CREATED PRIOR TO THE         TMKUT017
018400*    CURRENT DATE AND TIME.                                       TMKUT017
018500*    USED IN PARAGRAPH 1300-                                      TMKUT017
018600******************************************************************TMKUT017
018700     EXEC SQL                                                     TMKUT017
018800          DECLARE REC-LVL-VE-CSR CURSOR FOR                       TMKUT017
018900          SELECT  REC_SEQ_NBR                                     TMKUT017
019000                , STATUS_CDE                                              
019100            FROM TRECITM                                          TMKUT017
019200           WHERE ORD_NBR         = :DP276-PO-NBR                  TMKUT017
019300             AND ORD_LNE_NBR     = :DK-LINE-NBR                   TMKUT017
019400             AND OPER_UNT_ID     = :DP276-OPER-UNT-ID             TMKUT017
019500             AND REC_SEQ_NBR    ^= :DP276-REC-SEQ-NBR             TMKUT017
019600             AND VER_STATUS_CDE  = :PC-A                          TMKUT017
019700             AND (CRE_TMST       < :RECITM-CRE-TMST OR            TMKUT017
019800                  STATUS_CDE     = :PC-VE)                        TMKUT017
019900           ORDER BY 1                                                     
020000     END-EXEC.                                                    TMKUT017
020100                                                                  TMKUT017
020200******************************************************************TMKUT017
020300*    PO LEVEL IP CURSOR                                           TMKUT017
020400*    THIS IS A LIST OF RECEIVERS AND THEIR STATUSES FOR A         TMKUT017
020500*    PO, LINE AND DC REGARDLESS OF CREATION TIME.                 TMKUT017
020600******************************************************************TMKUT017
020700     EXEC SQL                                                     TMKUT017
020800          DECLARE PO-LVL-IP-CSR CURSOR FOR                        TMKUT017
020900          SELECT REC_SEQ_NBR                                      TMKUT017
021000               , STATUS_CDE                                       TMKUT017
021100            FROM TRECITM                                          TMKUT017
021200           WHERE ORD_NBR         = :DP276-PO-NBR                  TMKUT017
021300             AND ORD_LNE_NBR     = :DK-LINE-NBR                   TMKUT017
021400             AND OPER_UNT_ID     = :DP276-OPER-UNT-ID             TMKUT017
021500             AND VER_STATUS_CDE  = :PC-A                          TMKUT017
021600             AND STATUS_CDE     IN (:PC-IP, :PC-CM, :PC-VE)       TMKUT017
021700           ORDER BY 1                                                     
021800     END-EXEC.                                                    TMKUT017
021900/                                                                 TMKUT017
022000 LINKAGE SECTION.                                                 TMKUT017
022100                                                                  TMKUT017
022200 01  LINK-COMMAREA                    PIC X(3200).                TMKUT017
022600 01  LINK-TM007-COMMAREA              PIC X(800).                 TMKUT017
022700/                                                                 TMKUT017
022800 PROCEDURE DIVISION USING LINK-COMMAREA                           TMKUT017
                                LINK-TM007-COMMAREA.                            
022900                                                                  TMKUT017
023000     PERFORM 0001-HOUSEKEEPING.                                   TMKUT017
023100                                                                  TMKUT017
023200     EVALUATE TRUE                                                TMKUT017
023300     WHEN DP276-STORE-LEVEL-OTR OR DP276-PACK-BY-STORE            TMKUT017
023400         PERFORM 1000-STORE-LEVEL-OTR                             TMKUT017
023500     WHEN DP276-LINE-LEVEL-OTR                                    TMKUT017
023600         PERFORM 2000-LINE-LEVEL-OTR                              TMKUT017
023700     WHEN OTHER                                                   TMKUT017
023800         STRING ' INVALID OTR TYPE (' DP276-OTR-TYPE ')'          TMKUT017
023900                 DELIMITED BY SIZE                                TMKUT017
024000                                 INTO PV-RETURN-MSG               TMKUT017
024100         MOVE 1                  TO DP276-RETURN-CODE             TMKUT017
024300     END-EVALUATE.                                                TMKUT017
024400                                                                  TMKUT017
024500     IF DP276-PACK-BY-STORE                                               
024600         CONTINUE                                                 TMKUT017
024700     ELSE                                                                 
024800         PERFORM VARYING DP276-IDX FROM 1 BY 1                    TMKUT017
024900             UNTIL DP276-STORE-NBR(DP276-IDX) = ZERO OR           TMKUT017
025000                   DP276-IDX > PC-MAX-OCCURENCES                  TMKUT017
025100             IF DP276-OTR-QTY (DP276-IDX) < ZERO                  TMKUT017
025200                 MOVE ZERO TO DP276-OTR-QTY (DP276-IDX)           TMKUT017
025300             END-IF                                               TMKUT017
025400         END-PERFORM                                              TMKUT017
025500     END-IF.                                                              
025600                                                                  TMKUT017
025700     MOVE DP276-COMMAREA         TO LINK-COMMAREA.                TMKUT017
           MOVE TM007-COMMUNICATIONS-AREA TO LINK-TM007-COMMAREA.               
                                                                                
025800     GOBACK.                                                      TMKUT017
025900                                                                  TMKUT017
026000 0001-HOUSEKEEPING.                                               TMKUT017
026100     MOVE LINK-COMMAREA          TO DP276-COMMAREA.               TMKUT017
           MOVE LINK-TM007-COMMAREA    TO TM007-COMMUNICATIONS-AREA.            
                                                                                
026200     INITIALIZE DP276-OTR-TABLE                                   TMKUT017
026300                DP276-RETURN-DATA.                                TMKUT017
           MOVE 'TMKUT017'             TO DP276-PGM-NAME                        
                                          TM007-CALLED-MODULE.                  
026400/                                                                 TMKUT017
026500 1000-STORE-LEVEL-OTR.                                            TMKUT017
           MOVE '1000-STORE-LEVEL-QTR' TO TM007-RETURNED-PARA.                  
                                                                                
026600     MOVE DP276-PO-NBR           TO DK-PO-NBR                     TMKUT017
026700     MOVE DP276-PO-LNE-NBR       TO DK-LINE-NBR                   TMKUT017
026800     PERFORM 1100-GET-TALLPLN.                                    TMKUT017
026900                                                                  TMKUT017
027000     IF PS-NO-ERRORS                                              TMKUT017
027100         PERFORM 1200-FILL-BASE-NUMBERS                           TMKUT017
027200     END-IF.                                                      TMKUT017
027300                                                                  TMKUT017
027400     IF PS-NO-ERRORS AND PS-LINE-HAS-DISTRO                       TMKUT017
027500         PERFORM 1110-GET-APP-LINE-NBR                               CL**2
027600         EVALUATE TRUE                                            TMKUT017
027700             WHEN DP276-RECEIVER-OTR                              TMKUT017
027800                 PERFORM 1300-RCVR-OTR                            TMKUT017
027900             WHEN DP276-PO-OTR                                    TMKUT017
028000                 PERFORM 1400-PO-OTR                              TMKUT017
028100             WHEN OTHER                                           TMKUT017
028200                 STRING ' INVALID OTR SCOPE FLAG ('               TMKUT017
028300                         DP276-OTR-SCOPE                          TMKUT017
028400                         ')'                                      TMKUT017
028500                     DELIMITED BY SIZE                            TMKUT017
028600                                   INTO PV-RETURN-MSG             TMKUT017
                       MOVE PV-RETURN-MSG TO TM007-RETURN-MSG                   
                       MOVE '02'       TO TM007-RETURN-CODE                     
028700                 MOVE 2          TO DP276-RETURN-CODE             TMKUT017
028900         END-EVALUATE                                             TMKUT017
029000     END-IF.                                                      TMKUT017
029100/                                                                 TMKUT017
029200 1100-GET-TALLPLN.                                                TMKUT017
           MOVE '1100-GET-TALLPLN'        TO TM007-RETURNED-PARA.               
                                                                                
029300     EXEC SQL                                                     TMKUT017
029400         SELECT PLAN_NBR                                          TMKUT017
029500              , CURR_SPLIT_QTY                                    TMKUT017
029600             INTO :ALLPLN-PLAN-NBR                                TMKUT017
029700                 , :ALLPLN-CURR-SPLIT-QTY                         TMKUT017
029800             FROM TALLPLN                                         TMKUT017
029900             WHERE PO_NBR     = :DK-PO-NBR                        TMKUT017
030000               AND PO_LNE_NBR = :DK-LINE-NBR                      TMKUT017
030100               AND DEST_NBR   = :DP276-OPER-UNT-ID                TMKUT017
030100*              AND DC_SPLIT_QTY > 0                               TMKUT017
030200         END-EXEC                                                 TMKUT017
030300                                                                  TMKUT017
030400         EVALUATE TRUE                                            TMKUT017
030500             WHEN SQLCODE = ZERO                                  TMKUT017
030600                 SET PS-LINE-HAS-DISTRO                           TMKUT017
030700                                 TO TRUE                          TMKUT017
030800             WHEN SQLCODE = +100                                  TMKUT017
030900                 SET PS-LINE-HAS-NO-DISTRO                        TMKUT017
031000                                 TO TRUE                          TMKUT017
                       MOVE SQLCODE    TO TM007-SQLCODE                         
                       MOVE SQLCA      TO TM007-SQLCA                           
                       MOVE '03'       TO TM007-RETURN-CODE                     
031100                 MOVE 3          TO DP276-RETURN-CODE             TMKUT017
031200                 PERFORM 9000-NO-DISTRO-ERROR                     TMKUT017
031300             WHEN SQLCODE = -904                                  TMKUT017
031400             WHEN SQLCODE = -911                                  TMKUT017
031410             WHEN SQLCODE = -913                                  TMKUT017
                       MOVE SQLCODE    TO TM007-SQLCODE                         
                       MOVE SQLCA      TO TM007-SQLCA                           
                       MOVE '04'       TO TM007-RETURN-CODE                     
031500                 MOVE 4          TO DP276-RETURN-CODE             TMKUT017
031600                 PERFORM 9900-SOFT-ABORT                          TMKUT017
031700             WHEN OTHER                                           TMKUT017
                       MOVE SQLCODE    TO TM007-SQLCODE                         
                       MOVE SQLCA      TO TM007-SQLCA                           
                       MOVE '05'       TO TM007-RETURN-CODE                     
031800                 MOVE 5          TO DP276-RETURN-CODE             TMKUT017
031900                 PERFORM 9800-CROAK                               TMKUT017
032000         END-EVALUATE.                                            TMKUT017
032100/                                                                 TMKUT017
032200 1110-GET-APP-LINE-NBR.                                              CL**2
           MOVE '1110-GET-APP-LINE-NBR'   TO TM007-RETURNED-PARA.               
                                                                                
032300*  THE APP LINE NUMBER MAY NOT BE THE SAME AS THE KEY LINE           CL**3
032400*  NUMBER DUE TO PO LINES BEING DELETED.  THE RECEIVING SYSTEM       CL**3
032500*  IS KEYED BY THE APPROVED LINE NUMBER.  THE PO SYSTEM IS KEYED     CL**3
032600*  BY THE LINE NUMBER IN THE KEY.                                    CL**3
032700                                                                     CL**2
032800     EXEC SQL                                                        CL**2
032900         SELECT A.APP_PO_LNE_NBR                                     CL**2
033000             INTO :PV-APP-LINE-NBR                                   CL**2
033100             FROM TPURITM A                                          CL**2
033200             WHERE A.PO_NBR         = :DP276-PO-NBR                  CL**2
033300               AND A.PO_LNE_NBR     = :DK-LINE-NBR                   CL**2
033400               AND A.VER_STATUS_CDE = :PC-A                          CL**2
033500         END-EXEC                                                    CL**2
033600                                                                     CL**2
033700         EVALUATE TRUE                                               CL**2
033800             WHEN SQLCODE = ZERO                                     CL**2
033900                 CONTINUE                                            CL**2
034000             WHEN SQLCODE = -904                                     CL**2
034100             WHEN SQLCODE = -911                                     CL**2
034110             WHEN SQLCODE = -913                                     CL**2
                       MOVE SQLCODE    TO TM007-SQLCODE                         
                       MOVE SQLCA      TO TM007-SQLCA                           
                       MOVE '35'       TO TM007-RETURN-CODE                     
034200                 MOVE 35         TO DP276-RETURN-CODE                CL**2
034300                 PERFORM 9900-SOFT-ABORT                             CL**2
034400             WHEN OTHER                                              CL**2
                       MOVE SQLCODE    TO TM007-SQLCODE                         
                       MOVE SQLCA      TO TM007-SQLCA                           
                       MOVE '36'       TO TM007-RETURN-CODE                     
034500                 MOVE 36         TO DP276-RETURN-CODE                CL**2
034600                 PERFORM 9800-CROAK                                  CL**2
034700         END-EVALUATE.                                               CL**2
034800/                                                                    CL**2
034900 1200-FILL-BASE-NUMBERS.                                          TMKUT017
035000                                                                  TMKUT017
035100     PERFORM 1210-OPEN-BASE-STORE-CSR                             TMKUT017
035200                                                                  TMKUT017
035300     IF PS-NO-ERRORS AND PS-LINE-HAS-DISTRO                       TMKUT017
035400         PERFORM 1220-FETCH-BASE-STORE-CSR                        TMKUT017
035500         IF PS-EOF-BASE-CSR                                       TMKUT017
035600             SET PS-YES-ERRORS                                    TMKUT017
035700                 PS-LINE-HAS-NO-DISTRO                            TMKUT017
035800                                 TO TRUE                          TMKUT017
                   MOVE '06'           TO TM007-RETURN-CODE                     
035900             MOVE 6              TO DP276-RETURN-CODE             TMKUT017
036000             PERFORM 9000-NO-DISTRO-ERROR                         TMKUT017
036100         END-IF                                                   TMKUT017
036200     END-IF.                                                      TMKUT017
036300                                                                  TMKUT017
036400     IF PS-NO-ERRORS AND PS-LINE-HAS-DISTRO                       TMKUT017
036500         PERFORM 1230-LOAD-TO-TABLE VARYING DP276-IDX             TMKUT017
036600                   FROM 1 BY 1 UNTIL PS-EOF-BASE-CSR OR           TMKUT017
036700                   PS-YES-ERRORS                                  TMKUT017
036800                   OR DP276-IDX > PC-MAX-OCCURENCES               TMKUT017
036900     END-IF.                                                      TMKUT017
037000                                                                  TMKUT017
037100     IF PS-CURSOR-OPEN                                            TMKUT017
037200         PERFORM 1240-CLOSE-BASE-STORE-CSR                        TMKUT017
037300     END-IF.                                                      TMKUT017
037400/                                                                 TMKUT017
037500 1210-OPEN-BASE-STORE-CSR.                                        TMKUT017
           MOVE '1210-OPEN-BASE-STORE-CSR'  TO TM007-RETURNED-PARA.             
                                                                                
037600     EXEC SQL                                                     TMKUT017
037700          OPEN BASE-STORE-CSR                                     TMKUT017
037800     END-EXEC.                                                    TMKUT017
037900                                                                  TMKUT017
038000     EVALUATE TRUE                                                TMKUT017
038100         WHEN SQLCODE = ZERO                                      TMKUT017
038200             SET PS-CURSOR-OPEN  TO TRUE                          TMKUT017
038300         WHEN SQLCODE = -904                                      TMKUT017
038400         WHEN SQLCODE = -911                                      TMKUT017
038410         WHEN SQLCODE = -913                                      TMKUT017
038500             SET PS-CURSOR-CLOSED                                 TMKUT017
038600                                 TO TRUE                          TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '07'           TO TM007-RETURN-CODE                     
038700             MOVE 7              TO DP276-RETURN-CODE             TMKUT017
038800             PERFORM 9900-SOFT-ABORT                              TMKUT017
038900         WHEN OTHER                                               TMKUT017
039000             SET PS-CURSOR-CLOSED                                 TMKUT017
039100                                 TO TRUE                          TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '08'           TO TM007-RETURN-CODE                     
039200             MOVE 8              TO DP276-RETURN-CODE             TMKUT017
039300             SET PS-LINE-HAS-NO-DISTRO                            TMKUT017
039400                                 TO TRUE                          TMKUT017
039500             PERFORM 9000-NO-DISTRO-ERROR                         TMKUT017
039600         END-EVALUATE.                                            TMKUT017
039700/                                                                 TMKUT017
039800 1220-FETCH-BASE-STORE-CSR.                                       TMKUT017
           MOVE '1220-FETCH-BASE-STORE-CSR'  TO TM007-RETURNED-PARA.            
                                                                                
039900     EXEC SQL                                                     TMKUT017
040000          FETCH BASE-STORE-CSR                                    TMKUT017
040100          INTO :MESTDS-STR-NBR                                    TMKUT017
040200             , :MESTDS-STR-DISTRO-QTY                             TMKUT017
040300     END-EXEC.                                                    TMKUT017
040400                                                                  TMKUT017
040500     EVALUATE TRUE                                                TMKUT017
040600         WHEN SQLCODE = ZERO                                      TMKUT017
040700              CONTINUE                                            TMKUT017
040800         WHEN SQLCODE = +100                                      TMKUT017
040900             SET PS-EOF-BASE-CSR TO TRUE                          TMKUT017
041000         WHEN OTHER                                               TMKUT017
                    MOVE SQLCODE       TO TM007-SQLCODE                         
                    MOVE SQLCA         TO TM007-SQLCA                           
                    MOVE '09'          TO TM007-RETURN-CODE                     
041100              MOVE 9             TO DP276-RETURN-CODE             TMKUT017
041200             PERFORM 9000-NO-DISTRO-ERROR                         TMKUT017
041300     END-EVALUATE.                                                TMKUT017
041400/                                                                 TMKUT017
041500 1230-LOAD-TO-TABLE.                                              TMKUT017
041600     MOVE MESTDS-STR-NBR         TO DP276-STORE-NBR(DP276-IDX)    TMKUT017
041700                                                                  TMKUT017
041800     IF PS-LINE-HAS-NO-DISTRO                                     TMKUT017
041900         MOVE ALL '*'            TO DP276-OTR-QTY-X               TMKUT017
042000                                        (DP276-IDX)               TMKUT017
042100         MOVE ZERO               TO PV-DISPLAY-QTY                TMKUT017
042200         MOVE PV-DISPLAY-QTY     TO DP276-STR-DISTRO-QTY-X        TMKUT017
042300                                    (DP276-IDX)                   TMKUT017
042400         MOVE ZERO               TO DP276-STR-DISTRO-QTY          TMKUT017
042500                                    (DP276-IDX)                   TMKUT017
042600                                    DP276-OTR-QTY                 TMKUT017
042700                                    (DP276-IDX)                   TMKUT017
042800     ELSE                                                         TMKUT017
042900         MOVE MESTDS-STR-DISTRO-QTY                               TMKUT017
043000                                 TO DP276-STR-DISTRO-QTY          TMKUT017
043100                                    (DP276-IDX)                   TMKUT017
043200                                    DP276-OTR-QTY (DP276-IDX)     TMKUT017
043300                                    PV-DISPLAY-QTY                TMKUT017
043400         MOVE PV-DISPLAY-QTY     TO DP276-STR-DISTRO-QTY-X        TMKUT017
043500                                    (DP276-IDX)                   TMKUT017
043600                                    DP276-OTR-QTY-X               TMKUT017
043700                                    (DP276-IDX)                   TMKUT017
043800     END-IF.                                                      TMKUT017
043900                                                                  TMKUT017
044000     PERFORM 1220-FETCH-BASE-STORE-CSR.                           TMKUT017
044100/                                                                 TMKUT017
044200 1240-CLOSE-BASE-STORE-CSR.                                       TMKUT017
           MOVE '1240-CLOSE-BASE-STORE-CSR' TO TM007-RETURNED-PARA.             
                                                                                
044300     EXEC SQL                                                     TMKUT017
044400          CLOSE BASE-STORE-CSR                                    TMKUT017
044500     END-EXEC.                                                    TMKUT017
044600                                                                  TMKUT017
044700     EVALUATE TRUE                                                TMKUT017
044800         WHEN SQLCODE = ZERO                                      TMKUT017
044900             SET PS-CURSOR-CLOSED                                 TMKUT017
045000                                 TO TRUE                          TMKUT017
045100         WHEN OTHER                                               TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '10'           TO TM007-RETURN-CODE                     
045200             MOVE 10             TO DP276-RETURN-CODE             TMKUT017
045300             PERFORM 9000-NO-DISTRO-ERROR                         TMKUT017
045400     END-EVALUATE.                                                TMKUT017
045500/                                                                 TMKUT017
045600 1300-RCVR-OTR.                                                   TMKUT017
045700* RECEIVER OTR AT THE STORE LEVEL                                 TMKUT017
045800                                                                  TMKUT017
045900     MOVE PV-APP-LINE-NBR        TO DK-LINE-NBR                      CL**2
046000     PERFORM 7000-GET-RECITM-TMST.                                TMKUT017
046100                                                                  TMKUT017
046200     IF PS-NO-ERRORS                                              TMKUT017
046300         PERFORM 7100-OPEN-RECITM-CURSOR                          TMKUT017
046400     END-IF.                                                      TMKUT017
046500                                                                  TMKUT017
046600     IF PS-NO-ERRORS                                              TMKUT017
046700         PERFORM 7110-FETCH-RECITM-CURSOR                         TMKUT017
046800     END-IF.                                                      TMKUT017
046900                                                                  TMKUT017
047000     IF PS-EOF-PRIOR-CURSOR                                       TMKUT017
047100        SET PS-YES-ERRORS        TO TRUE                          TMKUT017
047200     END-IF.                                                      TMKUT017
047300                                                                  TMKUT017
047400     IF PS-NO-ERRORS                                              TMKUT017
047500         PERFORM 4000-PROCESS-RECITM-CURSOR UNTIL                 TMKUT017
047600                        PS-EOF-PRIOR-CURSOR                       TMKUT017
047700                     OR PS-YES-ERRORS                             TMKUT017
047800     END-IF.                                                      TMKUT017
047900                                                                  TMKUT017
048000     IF PS-CURSOR-OPEN                                            TMKUT017
048100         PERFORM 7120-CLOSE-RECITM-CURSOR                         TMKUT017
048200     END-IF.                                                      TMKUT017
048300/                                                                 TMKUT017
048400 1400-PO-OTR.                                                     TMKUT017
048500* PO OTR AT THE STORE LEVEL                                       TMKUT017
048600                                                                  TMKUT017
048700     IF PS-NO-ERRORS                                              TMKUT017
048800         MOVE PV-APP-LINE-NBR   TO DK-LINE-NBR                       CL**2
048900         PERFORM 7200-OPEN-RECITM-CURSOR                          TMKUT017
049000     END-IF.                                                      TMKUT017
049100                                                                  TMKUT017
049200     IF PS-NO-ERRORS                                              TMKUT017
049300         PERFORM 7210-FETCH-RECITM-CURSOR                         TMKUT017
049400     END-IF.                                                      TMKUT017
049500                                                                  TMKUT017
049600     IF PS-NO-ERRORS                                              TMKUT017
049700         PERFORM 4000-PROCESS-RECITM-CURSOR UNTIL                 TMKUT017
049800                        PS-EOF-PRIOR-CURSOR                       TMKUT017
049900                     OR PS-YES-ERRORS                             TMKUT017
050000     END-IF.                                                      TMKUT017
050100                                                                  TMKUT017
050200     IF PS-CURSOR-OPEN                                            TMKUT017
050300         PERFORM 7220-CLOSE-RECITM-CURSOR                         TMKUT017
050400     END-IF.                                                      TMKUT017
050500/                                                                 TMKUT017
050600 2000-LINE-LEVEL-OTR.                                             TMKUT017
           MOVE '2000-LINE-LEVEL-ORT'    TO TM007-RETURNED-PARA.                
                                                                                
050700                                                                  TMKUT017
050800     IF PS-NO-ERRORS                                              TMKUT017
050900         PERFORM 2100-FILL-BASE-NUMBERS                           TMKUT017
051000     END-IF.                                                      TMKUT017
051100                                                                  TMKUT017
051600     IF PS-NO-ERRORS                                              TMKUT017
051700     EVALUATE TRUE                                                TMKUT017
051800         WHEN DP276-RECEIVER-OTR                                  TMKUT017
051900             PERFORM 2200-PROCESS-RCVR-OTR-RCPTS                  TMKUT017
052000                 VARYING DP276-IDX FROM 1 BY 1                    TMKUT017
052100                 UNTIL DP276-LINE-NBR(DP276-IDX) = ZERO           TMKUT017
                       OR DP276-IDX > PC-MAX-OCCURENCES                         
052200                 OR DP276-FATAL-ERROR                             TMKUT017
052300         WHEN DP276-PO-OTR                                        TMKUT017
052400             PERFORM 2300-PROCESS-PO-OTR-RCPTS                    TMKUT017
052500                 VARYING DP276-IDX FROM 1 BY 1                    TMKUT017
052600                 UNTIL DP276-LINE-NBR(DP276-IDX) = ZERO           TMKUT017
                       OR DP276-IDX > PC-MAX-OCCURENCES                         
052700                 OR DP276-FATAL-ERROR                             TMKUT017
052800         WHEN OTHER                                               TMKUT017
052900             MOVE 'INVALID OTR SCOPE FLAG'                        TMKUT017
053000                                 TO PV-RETURN-MSG                 TMKUT017
                                          TM007-RETURN-MSG                      
                   MOVE '11'           TO TM007-RETURN-CODE                     
053100             MOVE 11             TO DP276-RETURN-CODE             TMKUT017
053200     END-EVALUATE                                                 TMKUT017
053300     END-IF.                                                      TMKUT017
053400                                                                  TMKUT017
053500 2100-FILL-BASE-NUMBERS.                                          TMKUT017
053600                                                                  TMKUT017
053700     PERFORM 2110-OPEN-PLAN-CURSOR.                               TMKUT017
053800                                                                  TMKUT017
053900     IF PS-NO-ERRORS                                              TMKUT017
054000         PERFORM 2120-FETCH-PLAN-CURSOR                           TMKUT017
054100     END-IF.                                                      TMKUT017
054200                                                                  TMKUT017
054300     IF PS-EOF-PLAN-CSR                                           TMKUT017
054400         SET PS-YES-ERRORS       TO TRUE                          TMKUT017
054500     END-IF.                                                      TMKUT017
054600                                                                  TMKUT017
054700     IF PS-NO-ERRORS                                              TMKUT017
054800         PERFORM 2130-LOAD-PLANS VARYING DP276-IDX                TMKUT017
054900                   FROM 1 BY 1 UNTIL PS-EOF-PLAN-CSR              TMKUT017
055000                   OR DP276-SOFT-ABORT                            TMKUT017
055100                   OR DP276-IDX > PC-MAX-OCCURENCES               TMKUT017
055200     END-IF.                                                      TMKUT017
055300                                                                  TMKUT017
055400     IF PS-CURSOR-OPEN                                            TMKUT017
055500         PERFORM 2140-CLOSE-PLAN-CURSOR                           TMKUT017
055600     END-IF.                                                      TMKUT017
055700/                                                                 TMKUT017
055800 2110-OPEN-PLAN-CURSOR.                                           TMKUT017
           MOVE '2110-OPEN-PLAN-CURSOR'   TO TM007-RETURNED-PARA.               
                                                                                
055900     EXEC SQL                                                     TMKUT017
056000          OPEN PLAN-CSR                                           TMKUT017
056100     END-EXEC.                                                    TMKUT017
056200                                                                  TMKUT017
056300     EVALUATE TRUE                                                TMKUT017
056400         WHEN SQLCODE = ZERO                                      TMKUT017
056500             SET PS-CURSOR-OPEN     TO TRUE                       TMKUT017
056600         WHEN SQLCODE = -904                                      TMKUT017
056700         WHEN SQLCODE = -911                                      TMKUT017
056710         WHEN SQLCODE = -913                                      TMKUT017
056800             SET PS-CURSOR-CLOSED                                 TMKUT017
056900                                 TO TRUE                          TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '12'           TO TM007-RETURN-CODE                     
157000             MOVE 12             TO DP276-RETURN-CODE             TMKUT017
057100             PERFORM 9900-SOFT-ABORT                              TMKUT017
057200         WHEN OTHER                                               TMKUT017
057300             SET PS-CURSOR-CLOSED                                 TMKUT017
057400                                 TO TRUE                          TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '13'           TO TM007-RETURN-CODE                     
057500             MOVE 13             TO DP276-RETURN-CODE             TMKUT017
057600             PERFORM 9800-CROAK                                   TMKUT017
057700     END-EVALUATE.                                                TMKUT017
057800                                                                  TMKUT017
057900 2120-FETCH-PLAN-CURSOR.                                          TMKUT017
           MOVE '2120-FETCH-PLAN-CURSOR'  TO TM007-RETURNED-PARA.               
                                                                                
058000     EXEC SQL                                                     TMKUT017
058100         FETCH PLAN-CSR                                           TMKUT017
058200         INTO :PURITM-PO-LNE-NBR                                  TMKUT017
058300            , :PURITM-APP-PO-LNE-NBR                              TMKUT017
058400     END-EXEC                                                     TMKUT017
058500                                                                  TMKUT017
058600     EVALUATE TRUE                                                TMKUT017
058700         WHEN SQLCODE = ZERO                                      TMKUT017
058800              CONTINUE                                            TMKUT017
058900         WHEN SQLCODE = +100                                      TMKUT017
059000             SET PS-EOF-PLAN-CSR TO TRUE                          TMKUT017
059100         WHEN OTHER                                               TMKUT017
                   MOVE SQLCODE         TO TM007-SQLCODE                        
                   MOVE SQLCA           TO TM007-SQLCA                          
                   MOVE '14'            TO TM007-RETURN-CODE                    
059200             MOVE 14              TO DP276-RETURN-CODE            TMKUT017
059300             PERFORM 9800-CROAK                                   TMKUT017
059400     END-EVALUATE.                                                TMKUT017
059500                                                                  TMKUT017
059600 2130-LOAD-PLANS.                                                 TMKUT017
059700     MOVE PURITM-APP-PO-LNE-NBR  TO DP276-LINE-NBR (DP276-IDX)    TMKUT017
059800     MOVE PURITM-PO-LNE-NBR      TO DK-LINE-NBR                   TMKUT017
059900     MOVE DP276-PO-NBR           TO DK-PO-NBR                     TMKUT017
060000     PERFORM 1100-GET-TALLPLN.                                    TMKUT017
060100     IF SQLCODE = ZERO                                            TMKUT017
060200         PERFORM 2150-SUM-ALL-STORES                              TMKUT017
060300         EVALUATE TRUE                                            TMKUT017
060400         WHEN SQLCODE = ZERO OR +100 OR -305                      TMKUT017
060500             MOVE MESTDS-STR-DISTRO-QTY                           TMKUT017
060600                                 TO DP276-STR-DISTRO-QTY          TMKUT017
060700                                       (DP276-IDX)                TMKUT017
060800                                    DP276-OTR-QTY(DP276-IDX)      TMKUT017
060900                                    PV-DISPLAY-QTY                TMKUT017
061000             MOVE PV-DISPLAY-QTY TO DP276-STR-DISTRO-QTY-X        TMKUT017
061100                                       (DP276-IDX)                TMKUT017
061200                                    DP276-OTR-QTY-X               TMKUT017
061300                                       (DP276-IDX)                TMKUT017
061400         WHEN PS-LINE-HAS-NO-DISTRO                               TMKUT017
061500             MOVE ALL '*'        TO DP276-OTR-QTY-X (DP276-IDX)   TMKUT017
061600             MOVE ZERO           TO PV-DISPLAY-QTY                TMKUT017
061700                                    DP276-OTR-QTY (DP276-IDX)     TMKUT017
061800                                    DP276-STR-DISTRO-QTY          TMKUT017
061900                                        (DP276-IDX)               TMKUT017
062000             MOVE PV-DISPLAY-QTY TO DP276-STR-DISTRO-QTY-X        TMKUT017
062100                                        (DP276-IDX)               TMKUT017
062200         WHEN OTHER                                               TMKUT017
062300             MOVE ZERO           TO DP276-STR-DISTRO-QTY          TMKUT017
062400                                       (DP276-IDX)                TMKUT017
062500                                    DP276-OTR-QTY(DP276-IDX)      TMKUT017
062600             MOVE SPACES         TO DP276-OTR-QTY-X(DP276-IDX)    TMKUT017
062700                                    DP276-STR-DISTRO-QTY-X        TMKUT017
062800                                       (DP276-IDX)                TMKUT017
062900         END-EVALUATE                                             TMKUT017
063000     END-IF.                                                      TMKUT017
063100                                                                  TMKUT017
063200     IF PS-NO-ERRORS AND NOT DP276-SOFT-ABORT                     TMKUT017
063300         PERFORM 2120-FETCH-PLAN-CURSOR                           TMKUT017
063400     END-IF.                                                      TMKUT017
063500                                                                  TMKUT017
063600 2140-CLOSE-PLAN-CURSOR.                                          TMKUT017
           MOVE '2140-CLOSE-PLAN-CURSOR'  TO TM007-RETURNED-PARA.               
                                                                                
063700     EXEC SQL                                                     TMKUT017
063800         CLOSE PLAN-CSR                                           TMKUT017
063900     END-EXEC.                                                    TMKUT017
064000     EVALUATE TRUE                                                TMKUT017
064100         WHEN SQLCODE = ZERO                                      TMKUT017
064200             SET PS-CURSOR-CLOSED                                 TMKUT017
064300                                 TO TRUE                          TMKUT017
064400         WHEN OTHER                                               TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '15'           TO TM007-RETURN-CODE                     
064500             MOVE 15             TO DP276-RETURN-CODE             TMKUT017
064600             PERFORM 9800-CROAK                                   TMKUT017
064700     END-EVALUATE.                                                TMKUT017
064800                                                                  TMKUT017
064900 2150-SUM-ALL-STORES.                                             TMKUT017
           MOVE '2150-SUM-ALL-STORES'     TO TM007-RETURNED-PARA.               
                                                                                
065000                                                                  TMKUT017
065100     MOVE ZERO                   TO MESTDS-STR-DISTRO-QTY         TMKUT017
065200     IF DP276-STR-NBR = ZERO                                      TMKUT017
065300         EXEC SQL                                                 TMKUT017
065400             SELECT SUM(A.STR_DISTRO_QTY)                         TMKUT017
065500               INTO :MESTDS-STR-DISTRO-QTY                        TMKUT017
065600               FROM TMESTDS A                                     TMKUT017
065700              WHERE  A.PO_NBR         = :DK-PO-NBR                TMKUT017
065800                 AND A.PO_LNE_NBR     = :DK-LINE-NBR              TMKUT017
065900                 AND A.PLAN_NBR       = :ALLPLN-PLAN-NBR          TMKUT017
066000         END-EXEC                                                 TMKUT017
066100     ELSE                                                         TMKUT017
066200         EXEC SQL                                                 TMKUT017
066300             SELECT A.STR_DISTRO_QTY                              TMKUT017
066400               INTO :MESTDS-STR-DISTRO-QTY                        TMKUT017
066500               FROM TMESTDS A                                     TMKUT017
066600              WHERE  A.PO_NBR         = :DK-PO-NBR                TMKUT017
066700                 AND A.PO_LNE_NBR     = :DK-LINE-NBR              TMKUT017
066800                 AND A.PLAN_NBR       = :ALLPLN-PLAN-NBR          TMKUT017
066900                 AND A.STR_NBR        = :DP276-STR-NBR            TMKUT017
067000         END-EXEC                                                 TMKUT017
067100     END-IF.                                                      TMKUT017
067200                                                                  TMKUT017
067300     EVALUATE TRUE                                                TMKUT017
067400         WHEN SQLCODE = ZERO                                      TMKUT017
067500             IF DP276-STR-NBR = ZERO                              TMKUT017
067600                 IF MESTDS-STR-DISTRO-QTY                         TMKUT017
067700                              NOT = ALLPLN-CURR-SPLIT-QTY         TMKUT017
067800                     MOVE ALLPLN-CURR-SPLIT-QTY                   TMKUT017
067900                                 TO  MESTDS-STR-DISTRO-QTY        TMKUT017
068000                 END-IF                                           TMKUT017
068100             END-IF                                               TMKUT017
068200         WHEN SQLCODE = +100 OR -305                              TMKUT017
068300             IF DP276-STR-NBR = ZERO                              TMKUT017
068400                 MOVE ALLPLN-CURR-SPLIT-QTY                       TMKUT017
068500                                 TO  MESTDS-STR-DISTRO-QTY        TMKUT017
068600             ELSE                                                 TMKUT017
                       MOVE SQLCODE    TO TM007-SQLCODE                         
                       MOVE SQLCA      TO TM007-SQLCA                           
                       MOVE '16'       TO TM007-RETURN-CODE                     
068700                 MOVE 16         TO DP276-RETURN-CODE             TMKUT017
068800                 SET PS-LINE-HAS-NO-DISTRO                        TMKUT017
068900                                 TO TRUE                          TMKUT017
069000                 PERFORM 9000-NO-DISTRO-ERROR                     TMKUT017
069100             END-IF                                               TMKUT017
069200         WHEN SQLCODE = -904                                      TMKUT017
069300         WHEN SQLCODE = -911                                      TMKUT017
069310         WHEN SQLCODE = -913                                      TMKUT017
                   MOVE SQLCODE    TO TM007-SQLCODE                             
                   MOVE SQLCA      TO TM007-SQLCA                               
                   MOVE '17'       TO TM007-RETURN-CODE                         
069400             MOVE 17             TO DP276-RETURN-CODE             TMKUT017
069500             PERFORM 9900-SOFT-ABORT                              TMKUT017
069600         WHEN OTHER                                               TMKUT017
                   MOVE SQLCODE    TO TM007-SQLCODE                             
                   MOVE SQLCA      TO TM007-SQLCA                               
                   MOVE '18'       TO TM007-RETURN-CODE                         
069700             MOVE 18             TO DP276-RETURN-CODE             TMKUT017
069800             SET PS-LINE-HAS-NO-DISTRO                            TMKUT017
069900                                 TO TRUE                          TMKUT017
070000             PERFORM 9000-NO-DISTRO-ERROR                         TMKUT017
070100     END-EVALUATE.                                                TMKUT017
070200                                                                  TMKUT017
070300/                                                                 TMKUT017
070400 2200-PROCESS-RCVR-OTR-RCPTS.                                     TMKUT017
070500                                                                  TMKUT017
070600     IF DP276-OTR-QTY-X (DP276-IDX) = ALL '*'                     TMKUT017
070700         SET PS-YES-ERRORS       TO TRUE                          TMKUT017
070800     ELSE                                                         TMKUT017
070900         SET PS-NO-ERRORS                                         TMKUT017
071000             PS-START-PRIOR-CURSOR                                TMKUT017
071100                                 TO TRUE                          TMKUT017
071200         MOVE DP276-LINE-NBR(DP276-IDX)                           TMKUT017
071300                                 TO DK-LINE-NBR                   TMKUT017
071320         PERFORM 7000-GET-RECITM-TMST                             TMKUT017
071400     END-IF                                                       TMKUT017
071500                                                                  TMKUT017
071600     IF PS-NO-ERRORS AND NOT DP276-FATAL-ERROR                    TMKUT017
071700         PERFORM 7100-OPEN-RECITM-CURSOR                          TMKUT017
071800     END-IF.                                                      TMKUT017
071900                                                                  TMKUT017
072000     IF PS-NO-ERRORS AND NOT DP276-FATAL-ERROR                    TMKUT017
072100         PERFORM 7110-FETCH-RECITM-CURSOR                         TMKUT017
072200     END-IF.                                                      TMKUT017
072300                                                                  TMKUT017
072400     IF PS-EOF-PRIOR-CURSOR                                       TMKUT017
072500        SET PS-YES-ERRORS        TO TRUE                          TMKUT017
072600     END-IF.                                                      TMKUT017
072700                                                                  TMKUT017
072800     IF PS-NO-ERRORS                                              TMKUT017
072900         PERFORM 6000-PROCESS-RECITM-CURSOR UNTIL                 TMKUT017
073000                        PS-EOF-PRIOR-CURSOR                       TMKUT017
073100                     OR PS-YES-ERRORS OR DP276-FATAL-ERROR        TMKUT017
073200     END-IF.                                                      TMKUT017
073300                                                                  TMKUT017
073400     IF PS-CURSOR-OPEN                                            TMKUT017
073500         PERFORM 7120-CLOSE-RECITM-CURSOR                         TMKUT017
073600     END-IF.                                                      TMKUT017
073700/                                                                 TMKUT017
073800 2300-PROCESS-PO-OTR-RCPTS.                                       TMKUT017
073900* PO OTR AT THE LINE LEVEL                                        TMKUT017
074000                                                                  TMKUT017
074100* ALL '*' INDICATES A 'NO DISTRO' ERROR FOR THE LINE              TMKUT017
074200     IF DP276-OTR-QTY-X (DP276-IDX) = ALL '*'                     TMKUT017
074300         SET PS-YES-ERRORS       TO TRUE                          TMKUT017
074400     ELSE                                                         TMKUT017
074500         SET PS-NO-ERRORS        TO TRUE                          TMKUT017
074600         MOVE DP276-LINE-NBR(DP276-IDX)                           TMKUT017
074700                                 TO DK-LINE-NBR                   TMKUT017
074800         PERFORM 7200-OPEN-RECITM-CURSOR                          TMKUT017
074900     END-IF.                                                      TMKUT017
075000                                                                  TMKUT017
075100     IF PS-NO-ERRORS                                              TMKUT017
075200         SET PS-START-PRIOR-CURSOR                                TMKUT017
075300                                 TO TRUE                          TMKUT017
075400         PERFORM 7210-FETCH-RECITM-CURSOR                         TMKUT017
075500     END-IF.                                                      TMKUT017
075600                                                                  TMKUT017
075700     IF PS-NO-ERRORS                                              TMKUT017
075800         PERFORM 6000-PROCESS-RECITM-CURSOR                       TMKUT017
075900                      UNTIL PS-EOF-PRIOR-CURSOR                   TMKUT017
076000                     OR PS-YES-ERRORS OR DP276-FATAL-ERROR        TMKUT017
076100     END-IF.                                                      TMKUT017
076200                                                                  TMKUT017
076300     IF PS-CURSOR-OPEN                                            TMKUT017
076400         PERFORM 7220-CLOSE-RECITM-CURSOR                         TMKUT017
076500     END-IF.                                                      TMKUT017
076600/                                                                 TMKUT017
076700 4000-PROCESS-RECITM-CURSOR.                                      TMKUT017
076800     PERFORM 4100-APPLY-PRIOR-RECEIPTS VARYING DP276-IDX          TMKUT017
076900                   FROM 1 BY 1 UNTIL                              TMKUT017
077000                   DP276-STORE-NBR(DP276-IDX) = ZERO OR           TMKUT017
077100                   DP276-IDX > PC-MAX-OCCURENCES                  TMKUT017
077200                                                                  TMKUT017
077300     IF PS-NO-ERRORS                                              TMKUT017
077400         IF DP276-RECEIVER-OTR                                    TMKUT017
077500             PERFORM 7110-FETCH-RECITM-CURSOR                     TMKUT017
077600         ELSE                                                     TMKUT017
077700             PERFORM 7210-FETCH-RECITM-CURSOR                     TMKUT017
077800         END-IF                                                   TMKUT017
077900     END-IF.                                                      TMKUT017
078000                                                                  TMKUT017
078100******************************************************************TMKUT017
078200*    THIS PARAGRAPH RETRIEVES THE RECDIS RECORD FOR A GIVEN STORE.TMKUT017
078300*    IT THEN ADDS INTO THE STORE ARRAY THE CORRECT STORE RECEIPTS TMKUT017
078400*    DEPENDING UPON THE STATUS CODE OF THE RECITM.                TMKUT017
078500******************************************************************TMKUT017
078600 4100-APPLY-PRIOR-RECEIPTS.                                       TMKUT017
           MOVE '4100-APPLY-PRIOR-RECEIPTS' TO TM007-RETURNED-PARA.             
                                                                                
078700     MOVE DP276-STORE-NBR(DP276-IDX)                              TMKUT017
078800                                 TO RECDIS-STR-NBR.               TMKUT017
078900                                                                  TMKUT017
079000     IF RECITM-STATUS-CDE = PC-VE                                 TMKUT017
079100         EXEC SQL                                                 TMKUT017
079200              SELECT AP_VERIFY_ITM_QTY                            TMKUT017
079300                INTO :PV-RECEIVED-QTY                             TMKUT017
079400                FROM TRECDIS                                      TMKUT017
079500               WHERE ORD_NBR        = :DP276-PO-NBR               TMKUT017
079600                 AND ORD_LNE_NBR    = :DK-LINE-NBR                   CL**2
079700                 AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR         TMKUT017
079800                 AND OPER_UNT_ID    = :DP276-OPER-UNT-ID          TMKUT017
080000                 AND STR_NBR        = :RECDIS-STR-NBR             TMKUT017
080100                 AND STR_FCLTY_ID   = :PC-SHORT-ONE               TMKUT017
080200         END-EXEC                                                 TMKUT017
080300     ELSE                                                         TMKUT017
080400         EXEC SQL                                                 TMKUT017
080500              SELECT EXPTED_ITM_QTY                               TMKUT017
080600                INTO :PV-RECEIVED-QTY                             TMKUT017
080700                FROM TRECDIS                                      TMKUT017
080800               WHERE ORD_NBR        = :DP276-PO-NBR               TMKUT017
080900                 AND ORD_LNE_NBR    = :DK-LINE-NBR                   CL**2
081000                 AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR         TMKUT017
081100                 AND OPER_UNT_ID    = :DP276-OPER-UNT-ID          TMKUT017
081300                 AND STR_NBR        = :RECDIS-STR-NBR             TMKUT017
081400                 AND STR_FCLTY_ID   = :PC-SHORT-ONE               TMKUT017
081500         END-EXEC                                                 TMKUT017
081600     END-IF                                                       TMKUT017
081700                                                                  TMKUT017
081800     EVALUATE TRUE                                                TMKUT017
081900         WHEN SQLCODE = ZERO                                      TMKUT017
082000             SUBTRACT PV-RECEIVED-QTY                             TMKUT017
082100                               FROM DP276-OTR-QTY (DP276-IDX)     TMKUT017
082200             IF DP276-OTR-QTY (DP276-IDX) > ZERO                  TMKUT017
082300                 MOVE DP276-OTR-QTY (DP276-IDX)                   TMKUT017
082400                                 TO PV-DISPLAY-QTY                TMKUT017
082500             ELSE                                                 TMKUT017
082600                 MOVE ZERO       TO PV-DISPLAY-QTY                TMKUT017
082700             END-IF                                               TMKUT017
082800             MOVE PV-DISPLAY-QTY TO DP276-OTR-QTY-X (DP276-IDX)   TMKUT017
082900         WHEN SQLCODE = +100                                      TMKUT017
083000             CONTINUE                                             TMKUT017
083100         WHEN SQLCODE = -904                                      TMKUT017
083200         WHEN SQLCODE = -911                                      TMKUT017
083210         WHEN SQLCODE = -913                                      TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '19'           TO TM007-RETURN-CODE                     
083300             MOVE 19             TO DP276-RETURN-CODE             TMKUT017
083400             PERFORM 9900-SOFT-ABORT                              TMKUT017
083500         WHEN OTHER                                               TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '20'           TO TM007-RETURN-CODE                     
083600             MOVE 20             TO DP276-RETURN-CODE             TMKUT017
083700             PERFORM 9800-CROAK                                   TMKUT017
083800     END-EVALUATE.                                                TMKUT017
083900/                                                                 TMKUT017
084000 6000-PROCESS-RECITM-CURSOR.                                      TMKUT017
084100     PERFORM 6100-APPLY-PRIOR-RECEIPTS                            TMKUT017
084200                                                                  TMKUT017
084300     IF PS-NO-ERRORS                                              TMKUT017
084400         IF DP276-RECEIVER-OTR                                    TMKUT017
084500             PERFORM 7110-FETCH-RECITM-CURSOR                     TMKUT017
084600         ELSE                                                     TMKUT017
084700             PERFORM 7210-FETCH-RECITM-CURSOR                     TMKUT017
084800     END-IF.                                                      TMKUT017
084900                                                                  TMKUT017
085000 6100-APPLY-PRIOR-RECEIPTS.                                       TMKUT017
           MOVE '6100-APPLY-PRIOR-RECEIPTS'  TO TM007-RETURNED-PARA.            
                                                                                
085100     MOVE DP276-LINE-NBR(DP276-IDX)                               TMKUT017
085200                                 TO RECDIS-ORD-LNE-NBR.           TMKUT017
085300                                                                  TMKUT017
085400     EVALUATE RECITM-STATUS-CDE                                   TMKUT017
085500     WHEN PC-VE                                                   TMKUT017
085600         IF DP276-STR-NBR = ZERO                                  TMKUT017
085700             EXEC SQL                                             TMKUT017
085800                  SELECT SUM(AP_VERIFY_ITM_QTY)                   TMKUT017
085900                    INTO :PV-RECEIVED-QTY                         TMKUT017
086000                    FROM TRECDIS                                  TMKUT017
086100                   WHERE ORD_NBR    = :DP276-PO-NBR               TMKUT017
086200                     AND ORD_LNE_NBR = :RECDIS-ORD-LNE-NBR        TMKUT017
086300                     AND REC_SEQ_NBR = :RECITM-REC-SEQ-NBR        TMKUT017
086400                     AND OPER_UNT_ID = :DP276-OPER-UNT-ID         TMKUT017
086600                     AND STR_FCLTY_ID = :PC-SHORT-ONE             TMKUT017
086700             END-EXEC                                             TMKUT017
086800         ELSE                                                     TMKUT017
086900             EXEC SQL                                             TMKUT017
087000                  SELECT AP_VERIFY_ITM_QTY                        TMKUT017
087100                    INTO :PV-RECEIVED-QTY                         TMKUT017
087200                    FROM TRECDIS                                  TMKUT017
087300                   WHERE ORD_NBR     = :DP276-PO-NBR              TMKUT017
087400                     AND ORD_LNE_NBR = :RECDIS-ORD-LNE-NBR        TMKUT017
087500                     AND REC_SEQ_NBR = :RECITM-REC-SEQ-NBR        TMKUT017
087600                     AND OPER_UNT_ID = :DP276-OPER-UNT-ID         TMKUT017
087700                     AND FCLTY_ID    = :DP276-FCLTY-ID            TMKUT017
087800                     AND STR_NBR     = :DP276-STR-NBR             TMKUT017
087900                     AND STR_FCLTY_ID = :PC-SHORT-ONE             TMKUT017
088100             END-EXEC                                             TMKUT017
088200         END-IF                                                   TMKUT017
088300     WHEN PC-IP                                                   TMKUT017
088400     WHEN PC-CM                                                   TMKUT017
088500     IF DP276-STR-NBR = ZERO                                      TMKUT017
088600         EXEC SQL                                                 TMKUT017
088700              SELECT SUM(EXPTED_ITM_QTY)                          TMKUT017
088800                INTO :PV-RECEIVED-QTY                             TMKUT017
088900                FROM TRECDIS                                      TMKUT017
089000               WHERE ORD_NBR        = :DP276-PO-NBR               TMKUT017
089100                 AND ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR         TMKUT017
089200                 AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR         TMKUT017
089300                 AND OPER_UNT_ID    = :DP276-OPER-UNT-ID          TMKUT017
089400                 AND FCLTY_ID       = :DP276-FCLTY-ID             TMKUT017
089600                 AND STR_FCLTY_ID   = :PC-SHORT-ONE               TMKUT017
089700         END-EXEC                                                 TMKUT017
089800     ELSE                                                         TMKUT017
089900         EXEC SQL                                                 TMKUT017
090000              SELECT EXPTED_ITM_QTY                               TMKUT017
090100                INTO :PV-RECEIVED-QTY                             TMKUT017
090200                FROM TRECDIS                                      TMKUT017
090300               WHERE ORD_NBR        = :DP276-PO-NBR               TMKUT017
090400                 AND ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR         TMKUT017
090500                 AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR         TMKUT017
090600                 AND OPER_UNT_ID    = :DP276-OPER-UNT-ID          TMKUT017
090700                 AND FCLTY_ID       = :DP276-FCLTY-ID             TMKUT017
090800                 AND STR_NBR        = :DP276-STR-NBR              TMKUT017
091000                 AND STR_FCLTY_ID   = :PC-SHORT-ONE               TMKUT017
091100         END-EXEC                                                 TMKUT017
091200     END-IF                                                       TMKUT017
091300     END-EVALUATE.                                                TMKUT017
091400                                                                  TMKUT017
091500     EVALUATE TRUE                                                TMKUT017
091600         WHEN SQLCODE = ZERO                                      TMKUT017
091700             SUBTRACT PV-RECEIVED-QTY                             TMKUT017
091800                               FROM DP276-OTR-QTY (DP276-IDX)     TMKUT017
091900             IF DP276-OTR-QTY (DP276-IDX) > ZERO                  TMKUT017
092000                 MOVE DP276-OTR-QTY (DP276-IDX)                   TMKUT017
092100                                 TO PV-DISPLAY-QTY                TMKUT017
092200             ELSE                                                 TMKUT017
092300                 MOVE ZERO       TO PV-DISPLAY-QTY                TMKUT017
092400             END-IF                                               TMKUT017
092500             MOVE PV-DISPLAY-QTY TO DP276-OTR-QTY-X (DP276-IDX)   TMKUT017
092600         WHEN SQLCODE = +100                                      TMKUT017
092700         WHEN SQLCODE = -305                                      TMKUT017
092800             CONTINUE                                             TMKUT017
092900         WHEN SQLCODE = -904                                      TMKUT017
093000         WHEN SQLCODE = -911                                      TMKUT017
093010         WHEN SQLCODE = -913                                      TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '21'           TO TM007-RETURN-CODE                     
093100             MOVE 21             TO DP276-RETURN-CODE             TMKUT017
093200             PERFORM 9900-SOFT-ABORT                              TMKUT017
093300         WHEN OTHER                                               TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '22'           TO TM007-RETURN-CODE                     
093400             MOVE 22             TO DP276-RETURN-CODE             TMKUT017
093500             PERFORM 9800-CROAK                                   TMKUT017
093600     END-EVALUATE.                                                TMKUT017
093700/                                                                 TMKUT017
093800 7000-GET-RECITM-TMST.                                            TMKUT017
093900******************************************************************TMKUT017
094000*    THIS PARAGRAPH RETRIEVES THE EARLIEST TIMESTAMP FOR A PO     TMKUT017
094100*    AND RECEIVER  WITHIN A DC.                                   TMKUT017
094200******************************************************************TMKUT017
           MOVE '7000-GET-RECITM-TMST'    TO TM007-RETURNED-PARA.               
                                                                                
094300                                                                  TMKUT017
094400     EXEC SQL                                                     TMKUT017
094500         SELECT CRE_TMST                                          TMKUT017
094600             INTO :RECITM-CRE-TMST                                TMKUT017
094700             FROM TRECITM                                         TMKUT017
094800             WHERE ORD_NBR          = :DP276-PO-NBR               TMKUT017
094900                 AND REC_SEQ_NBR    = :DP276-REC-SEQ-NBR          TMKUT017
095000                 AND ORD_LNE_NBR    = :DK-LINE-NBR                TMKUT017
095100                 AND OPER_UNT_ID    = :DP276-OPER-UNT-ID          TMKUT017
095200     END-EXEC                                                     TMKUT017
095300                                                                  TMKUT017
095400     EVALUATE TRUE                                                TMKUT017
095500         WHEN SQLCODE = ZERO                                      TMKUT017
095600             CONTINUE                                             TMKUT017
095700         WHEN SQLCODE = +100                                      TMKUT017
095800             EXEC SQL                                             TMKUT017
095900                 SET :RECITM-CRE-TMST = CURRENT TIMESTAMP         TMKUT017
096000             END-EXEC                                             TMKUT017
096100         WHEN SQLCODE = -904                                      TMKUT017
096200         WHEN SQLCODE = -911                                      TMKUT017
096210         WHEN SQLCODE = -913                                      TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '23'           TO TM007-RETURN-CODE                     
096300             MOVE 23             TO DP276-RETURN-CODE             TMKUT017
096400             PERFORM 9900-SOFT-ABORT                              TMKUT017
096500         WHEN OTHER                                               TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '24'           TO TM007-RETURN-CODE                     
096600             MOVE 24             TO DP276-RETURN-CODE             TMKUT017
096700             PERFORM 9800-CROAK                                   TMKUT017
096800     END-EVALUATE.                                                TMKUT017
096900                                                                  TMKUT017
097000/                                                                 TMKUT017
097100 7100-OPEN-RECITM-CURSOR.                                         TMKUT017
           MOVE '7100-OPEN-RECITM-CURSOR'  TO TM007-RETURNED-PARA.              
                                                                                
097200     EXEC SQL                                                     TMKUT017
097300         OPEN REC-LVL-VE-CSR                                      TMKUT017
097400     END-EXEC.                                                    TMKUT017
097500                                                                  TMKUT017
097600     EVALUATE TRUE                                                TMKUT017
097700         WHEN SQLCODE = ZERO                                      TMKUT017
097800             SET PS-CURSOR-OPEN  TO TRUE                          TMKUT017
097900         WHEN SQLCODE = -904                                      TMKUT017
098000         WHEN SQLCODE = -911                                      TMKUT017
098010         WHEN SQLCODE = -913                                      TMKUT017
098100             SET PS-CURSOR-CLOSED                                 TMKUT017
098200                                 TO TRUE                          TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '27'           TO TM007-RETURN-CODE                     
098300             MOVE 27             TO DP276-RETURN-CODE             TMKUT017
098400             PERFORM 9900-SOFT-ABORT                              TMKUT017
098500         WHEN OTHER                                               TMKUT017
098600             SET PS-CURSOR-CLOSED                                 TMKUT017
098700                                 TO TRUE                          TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '28'           TO TM007-RETURN-CODE                     
098800             MOVE 28             TO DP276-RETURN-CODE             TMKUT017
098900             PERFORM 9800-CROAK                                   TMKUT017
099000     END-EVALUATE.                                                TMKUT017
099100                                                                  TMKUT017
099200 7110-FETCH-RECITM-CURSOR.                                        TMKUT017
           MOVE '7110-FETCH-RECITM-CURSOR'   TO TM007-RETURNED-PARA.            
                                                                                
099300     EXEC SQL                                                     TMKUT017
099400         FETCH REC-LVL-VE-CSR                                     TMKUT017
099500         INTO   :RECITM-REC-SEQ-NBR                               TMKUT017
099600              , :RECITM-STATUS-CDE                                TMKUT017
099700     END-EXEC.                                                    TMKUT017
099800                                                                  TMKUT017
099900     EVALUATE TRUE                                                TMKUT017
100000         WHEN SQLCODE = ZERO                                      TMKUT017
100100             CONTINUE                                             TMKUT017
100200         WHEN SQLCODE = +100                                      TMKUT017
100300             SET PS-EOF-PRIOR-CURSOR TO TRUE                      TMKUT017
100400         WHEN OTHER                                               TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '29'           TO TM007-RETURN-CODE                     
100500             MOVE 29             TO DP276-RETURN-CODE             TMKUT017
100600             PERFORM 9800-CROAK                                   TMKUT017
100700     END-EVALUATE.                                                TMKUT017
100800                                                                  TMKUT017
100900/                                                                 TMKUT017
101000 7120-CLOSE-RECITM-CURSOR.                                        TMKUT017
           MOVE '7120-CLOSE-RECITM-CURSOR'  TO TM007-RETURNED-PARA.             
                                                                                
101100     EXEC SQL                                                     TMKUT017
101200         CLOSE REC-LVL-VE-CSR                                     TMKUT017
101300     END-EXEC.                                                    TMKUT017
101400                                                                  TMKUT017
101500     EVALUATE TRUE                                                TMKUT017
101600         WHEN SQLCODE = ZERO                                      TMKUT017
101700             SET PS-CURSOR-CLOSED TO TRUE                         TMKUT017
101800         WHEN OTHER                                               TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '30'           TO TM007-RETURN-CODE                     
101900             MOVE 30             TO DP276-RETURN-CODE             TMKUT017
102000             PERFORM 9800-CROAK                                   TMKUT017
102100     END-EVALUATE.                                                TMKUT017
102200/                                                                 TMKUT017
102300 7200-OPEN-RECITM-CURSOR.                                         TMKUT017
           MOVE '7200-OPEN-RECITM-CURSOR'  TO TM007-RETURNED-PARA.              
                                                                                
102400     EXEC SQL                                                     TMKUT017
102500         OPEN PO-LVL-IP-CSR                                       TMKUT017
102600     END-EXEC.                                                    TMKUT017
102700                                                                  TMKUT017
102800     EVALUATE TRUE                                                TMKUT017
102900         WHEN SQLCODE = ZERO                                      TMKUT017
103000             SET PS-CURSOR-OPEN  TO TRUE                          TMKUT017
103100         WHEN SQLCODE = -904                                      TMKUT017
103200         WHEN SQLCODE = -911                                      TMKUT017
103210         WHEN SQLCODE = -913                                      TMKUT017
103300             SET PS-CURSOR-CLOSED                                 TMKUT017
103400                                 TO TRUE                          TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '31'           TO TM007-RETURN-CODE                     
103500             MOVE 31             TO DP276-RETURN-CODE             TMKUT017
103600             PERFORM 9900-SOFT-ABORT                              TMKUT017
103700         WHEN OTHER                                               TMKUT017
103800             SET PS-CURSOR-CLOSED                                 TMKUT017
103900                                 TO TRUE                          TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '32'           TO TM007-RETURN-CODE                     
104000             MOVE 32             TO DP276-RETURN-CODE             TMKUT017
104100             PERFORM 9800-CROAK                                   TMKUT017
104200     END-EVALUATE.                                                TMKUT017
104300                                                                  TMKUT017
104400 7210-FETCH-RECITM-CURSOR.                                        TMKUT017
           MOVE '7210-FETCH-RECITM-CURSOR'  TO TM007-RETURNED-PARA.             
                                                                                
104500     EXEC SQL                                                     TMKUT017
104600         FETCH PO-LVL-IP-CSR                                      TMKUT017
104700         INTO   :RECITM-REC-SEQ-NBR                               TMKUT017
104800              , :RECITM-STATUS-CDE                                TMKUT017
104900     END-EXEC.                                                    TMKUT017
105000                                                                  TMKUT017
105100     EVALUATE TRUE                                                TMKUT017
105200         WHEN SQLCODE = ZERO                                      TMKUT017
105300             CONTINUE                                             TMKUT017
105400         WHEN SQLCODE = +100                                      TMKUT017
105500             SET PS-EOF-PRIOR-CURSOR TO TRUE                      TMKUT017
105600         WHEN OTHER                                               TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '33'           TO TM007-RETURN-CODE                     
105700             MOVE 33             TO DP276-RETURN-CODE             TMKUT017
105800             PERFORM 9800-CROAK                                   TMKUT017
105900     END-EVALUATE.                                                TMKUT017
106000                                                                  TMKUT017
106100 7220-CLOSE-RECITM-CURSOR.                                        TMKUT017
           MOVE '7220-CLOSE-RECITM-CURSOR'  TO TM007-RETURNED-PARA.             
                                                                                
106200     EXEC SQL                                                     TMKUT017
106300         CLOSE PO-LVL-IP-CSR                                      TMKUT017
106400     END-EXEC.                                                    TMKUT017
106500                                                                  TMKUT017
106600     EVALUATE TRUE                                                TMKUT017
106700         WHEN SQLCODE = ZERO                                      TMKUT017
106800             SET PS-CURSOR-CLOSED                                 TMKUT017
106900                                 TO TRUE                          TMKUT017
107000         WHEN OTHER                                               TMKUT017
                   MOVE SQLCODE        TO TM007-SQLCODE                         
                   MOVE SQLCA          TO TM007-SQLCA                           
                   MOVE '34'           TO TM007-RETURN-CODE                     
107100             MOVE 34             TO DP276-RETURN-CODE             TMKUT017
107200             PERFORM 9800-CROAK                                   TMKUT017
107300     END-EVALUATE.                                                TMKUT017
107400/                                                                 TMKUT017
107500 9000-NO-DISTRO-ERROR.                                            TMKUT017
107600                                                                  TMKUT017
107700     SET DP276-NO-DISTRO                                          TMKUT017
107800         DP276-WARNING-ERROR     TO TRUE.                         TMKUT017
107900     IF DP276-STORE-LEVEL-OTR                                     TMKUT017
108000         PERFORM VARYING DP276-IDX FROM 1 BY 1                    TMKUT017
108100            UNTIL DP276-IDX > 999                                 TMKUT017
108200             MOVE ALL '*'        TO DP276-OTR-QTY-X (DP276-IDX)   TMKUT017
108300         END-PERFORM                                              TMKUT017
108400     ELSE                                                         TMKUT017
108500         MOVE ALL '*'            TO DP276-OTR-QTY-X (DP276-IDX)   TMKUT017
108600     END-IF.                                                      TMKUT017
108700/                                                                 TMKUT017
108800*----------------------------------------------------------------*TMKUT017
108900*    WHEN A FATAL ERROR OCCURS PASS THE ERROR SWITCHES BACK TO    TMKUT017
109000*    THE HOST PROGRAM AND DISPLAY MESSAGES                        TMKUT017
109100*----------------------------------------------------------------*TMKUT017
109200 9800-CROAK.                                                      TMKUT017
109300                                                                  TMKUT017
109400     PERFORM VARYING DP276-ERR-IDX FROM 1 BY 1 UNTIL              TMKUT017
109500             DP276-ERR-IDX > 999                                  TMKUT017
109600         MOVE SPACES             TO DP276-OTR-QTY-X               TMKUT017
109700                                    (DP276-ERR-IDX)               TMKUT017
109800                                    DP276-STR-DISTRO-QTY-X        TMKUT017
109900                                    (DP276-ERR-IDX)               TMKUT017
110000         MOVE ZEROES             TO DP276-OTR-QTY                 TMKUT017
110100                                    (DP276-ERR-IDX)               TMKUT017
110200                                    DP276-STR-DISTRO-QTY          TMKUT017
110300                                    (DP276-ERR-IDX)               TMKUT017
110400     END-PERFORM.                                                 TMKUT017
110500                                                                  TMKUT017
110600     SET PS-YES-ERRORS           TO TRUE                          TMKUT017
110700                                                                  TMKUT017
110800     SET DP276-FATAL-ERROR                                        TMKUT017
110900         DP276-CROAK             TO TRUE                          TMKUT017
111000     MOVE SQLCODE                TO PV-SQLCODE                    TMKUT017
111100                                                                  TMKUT017
111200     PERFORM 9950-FORMAT-ERROR-MSG.                               TMKUT017
111300                                                                  TMKUT017
111700                                                                  TMKUT017
111800*----------------------------------------------------------------*TMKUT017
111900*    THE DB2 RESOURCE IS NOT AVAILABLE, PASS THE ERROR SWITCHES  *TMKUT017
112000*    BACK TO THE HOST PROGRAM AND DISPLAY MESSAGES                TMKUT017
112100*----------------------------------------------------------------*TMKUT017
112200 9900-SOFT-ABORT.                                                 TMKUT017
112300     SET PS-YES-ERRORS                                            TMKUT017
112400         DP276-FATAL-ERROR                                        TMKUT017
112500         DP276-SOFT-ABORT        TO TRUE.                         TMKUT017
112600                                                                  TMKUT017
112700     PERFORM 9950-FORMAT-ERROR-MSG.                               TMKUT017
112800                                                                  TMKUT017
113100                                                                  TMKUT017
113400 9950-FORMAT-ERROR-MSG.                                           TMKUT017
113500                                                                  TMKUT017
113600     MOVE SQLCODE                TO PV-SQLCODE                    TMKUT017
113700                                    PV-DISPLAY-SQLCODE.           TMKUT017
113800                                                                  TMKUT017
113900     MOVE DP276-PO-NBR           TO PV-DISP-PO-NBR                TMKUT017
                                          TM007-PO-NBR                          
114000     IF DP276-PO-LNE-NBR = ZERO                                   TMKUT017
114100         MOVE DK-LINE-NBR        TO PV-DISP-PO-LNE-NBR            TMKUT017
114200     ELSE                                                         TMKUT017
114300         MOVE DP276-PO-LNE-NBR   TO PV-DISP-PO-LNE-NBR            TMKUT017
114400     END-IF                                                       TMKUT017
114500     MOVE DP276-REC-SEQ-NBR      TO PV-DISP-REC-SEQ-NBR           TMKUT017
                                          TM007-REC-SEQ-NBR                     
114600     MOVE DP276-OPER-UNT-ID      TO PV-DISP-OPER-UNT-ID           TMKUT017
                                          TM007-OPER-UNT-ID                     
114700     MOVE DP276-FCLTY-ID         TO PV-DISP-FCLTY-ID              TMKUT017
114800     MOVE DP276-STR-NBR          TO PV-DISP-STR-NBR.              TMKUT017
114900                                                                  TMKUT017
115000     STRING '** TMKUT017 ** ERROR; '                              TMKUT017
115100         PV-RETURN-MSG DELIMITED BY SIZE                          TMKUT017
115200                                 INTO PV-MESSAGE-TEXT             TMKUT017
           DISPLAY PV-MESSAGE-TEXT                                              
115300                                                                  TMKUT017
115400     STRING  ' DP276-RC = ' DP276-RETURN-CODE                     TMKUT017
115500             '; SQLCODE = ' PV-DISPLAY-SQLCODE                    TMKUT017
115600                                  DELIMITED BY SIZE               TMKUT017
115700                                 INTO PV-MESSAGE-TEXT             TMKUT017
           DISPLAY PV-MESSAGE-TEXT                                              
115800                                                                  TMKUT017
115900     MOVE '  PO    REC  LNE OPER FCLTY STR'                       TMKUT017
116000                                   TO PV-MESSAGE-TEXT             TMKUT017
           DISPLAY PV-MESSAGE-TEXT                                              
116100                                                                  TMKUT017
116200     STRING                                                       TMKUT017
116300         PV-DISP-PO-NBR '-'                                       TMKUT017
116400         PV-DISP-REC-SEQ-NBR '-'                                  TMKUT017
116500         PV-DISP-PO-LNE-NBR '-'                                   TMKUT017
116600         PV-DISP-OPER-UNT-ID '-'                                  TMKUT017
116700         PV-DISP-FCLTY-ID '-'                                     TMKUT017
116800         PV-DISP-STR-NBR                                          TMKUT017
116900         DELIMITED BY SIZE INTO PV-MESSAGE-TEXT                   TMKUT017
           MOVE PV-MESSAGE-TEXT  TO TM007-RETURN-MSG                            
           DISPLAY PV-MESSAGE-TEXT.                                             
