000100 IDENTIFICATION DIVISION.                                         00010099
000200***************************************************************** 00020099
000300                                                                  00030099
000400 PROGRAM-ID.             RCKRP020.                                00040099
000500 AUTHOR.                 RIP EDMUNDSON - ADTEC/RON KRIER.         00050099
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060099
000700 DATE-WRITTEN            DECEMBER 1997.                           00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000***************************************************************** 00100099
001100*                                                               * 00110099
001200* THIS PROGRAM WILL TAKE IN A MERGED FILE CREATED FROM RCKUT055 * 00120099
001300* (RCRD034) WHICH CONTAINS PO/RECEIVER/LINES WHERE STORES COULD * 00130099
001400* NOT BE ADJUSTED BECAUSE OF A PHYSICAL INVENTORY TIMING BUT AN * 00140099
001500* ATTEMPT TO ADJUST THEM WAS DONE THROUGH THE ONLINE ADJUSTMENT * 00150099
001600* APPLICATION.                                                  * 00160099
001700*                                                               * 00170099
001800* THIS REPORT WILL LIST THE LINES WHERE AN ADJUSTMENT WAS       * 00180099
001900* ATTEMPTED, WILL LIST THE STORES THAT WERE CHANGED AND LIST    * 00190099
002000* THE STORES THAT COULD NOT BE CHANGED.                         * 00200099
002100*                                                               * 00210099
002200***************************************************************** 00220099
002300*                                                               * 00230099
002400***************************************************************** 00240099
002500 ENVIRONMENT DIVISION.                                            00250099
002600***************************************************************** 00260099
002700                                                                  00270099
002800 CONFIGURATION SECTION.                                           00280099
002900                                                                  00290099
003000 SOURCE-COMPUTER.        IBM-3090.                                00300099
003100 OBJECT-COMPUTER.        IBM-3090.                                00310099
003200                                                                  00320099
003300 INPUT-OUTPUT SECTION.                                            00330099
003400                                                                  00340099
003500 FILE-CONTROL.                                                    00350099
003600                                                                  00360099
003700     SELECT MERGE-FILE                                            00370099
003800         ASSIGN TO INP01.                                         00380099
003900                                                                  00390099
004000     SELECT RECV-REPORT-FILE                                      00400099
004100         ASSIGN TO RPT01.                                         00410099
004200                                                                  00420099
004300                                                                  00430099
004400******************************************************************00440099
004500 DATA DIVISION.                                                   00450099
004600******************************************************************00460099
004700                                                                  00470099
004800 FILE SECTION.                                                    00480099
004900                                                                  00490099
005000 FD  MERGE-FILE                                                   00500099
005100     RECORDING MODE IS F                                          00510099
005200     LABEL RECORDS ARE STANDARD                                   00520099
005300     BLOCK CONTAINS 0 RECORDS.                                    00530099
005400                                                                  00540099
005500 01  MERGE-FILE-RECORD        PIC X(125).                         00550099
005600                                                                  00560099
005700 FD  RECV-REPORT-FILE                                             00570099
005800     RECORDING MODE IS F                                          00580099
005900     BLOCK CONTAINS 0  RECORDS.                                   00590099
006000 01  RECV-REPORT-RECORD              PIC  X(132).                 00600099
006100                                                                  00610099
006200 WORKING-STORAGE SECTION.                                         00620099
006300                                                                  00630099
006400 01  FILLER.                                                      00640099
006500     05  FILLER                      PIC  X(36)    VALUE          00650099
006600         ' ***** WORKING STORAGE PGM=RCKRP020 '.                  00660099
006700     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00670099
006800     05  FILLER                      PIC  X(10)    VALUE          00680099
006900         ' LOCATION='.                                            00690099
007000     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   00700099
007100     05  FILLER                      PIC  X(06)    VALUE          00710099
007200         ' *****'.                                                00720099
007300 EJECT                                                            00730099
007400 01  PROGRAM-SWITCHES.                                            00740099
007500     05  PS-EOF-MERGE-SW             PIC  X(01)    VALUE 'N'.     00750099
007600         88  PS-EOF-MERGE                          VALUE 'Y'.     00760099
007700         88  PS-MORE-MERGE                         VALUE 'N'.     00770099
007800     05  PS-FIRST-RECORD-SW          PIC  X(01)    VALUE 'Y'.     00780099
007900         88  PS-FIRST-RECORD                       VALUE 'Y'.     00790099
008000         88  PS-NOT-FIRST-RECORD                   VALUE 'N'.     00800099
008100     05  PS-STORE-LIST-SW            PIC  X(01)    VALUE 'N'.     00810099
008200         88  PS-STORE-LIST-INCOMPLETE              VALUE 'N'.     00820099
008300         88  PS-STORE-LIST-COMPLETE                VALUE 'Y'.     00830099
008400     05  PS-DC-FOUND-SW              PIC  X(01)    VALUE 'N'.     00840099
008500         88  PS-DC-NOT-FOUND                       VALUE 'N'.     00850099
008600         88  PS-DC-FOUND                           VALUE 'Y'.     00860099
008700     05  PS-STORE-LIST-SHORT-SW      PIC  X(01)    VALUE 'N'.     00870099
008800         88  PS-STORE-LIST-SHORT-NOT-DONE          VALUE 'N'.     00880099
008900         88  PS-STORE-LIST-SHORT-DONE              VALUE 'Y'.     00890099
009000*----------------------------------------------------------------*00900099
009100*  INCLUDED PROGRAM SWITCHES FOR XLKUT001       **   WR # 21361  *00910099
009200*----------------------------------------------------------------*00920099
009300     05  PS-CALL-API-SW              PIC  X        VALUE 'N'.     00930099
009400         88  PS-CALL-API-NO                        VALUE 'N'.     00940099
009500         88  PS-CALL-API-YES                       VALUE 'Y'.     00950099
009600*----------------------------------------------------------------*00960099
009700* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *00970099
009800*----------------------------------------------------------------*00980099
009900                                                                  00990099
010000 01  PC-CONSTANTS.                                                01000099
010100     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +60.     01010099
010200     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01020099
010300                                                   'RCKRP020'.    01030099
010400     05  PC-REPORT-NBR-1             PIC  9(01)    VALUE 1.       01040099
010500     05  PC-DPKUT500                 PIC  X(10)    VALUE          01050099
010600         'DPKUT500  '.                                            01060099
010700     05  PC-TABLE-MAX                 PIC S9(04) COMP VALUE 50.   01070099
010800*----------------------------------------------------------------*01080099
010900* INCLUDED NEW CONSTANTS PC-000 AND PC-999.          WR # 21361  *01090099
011000*----------------------------------------------------------------*01100099
011100     05  PC-000                      PIC X(03)     VALUE '000'.   01110099
011200     05  PC-999                      PIC X(03)     VALUE '999'.   01120099
011300*----------------------------------------------------------------*01130099
011400* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *01140099
011500*----------------------------------------------------------------*01150099
011600 EJECT                                                            01160099
011700                                                                  01170099
011800 01  PV-ACCUMULATOR-FIELDS.                                       01180099
011900     05  PV-PAGE-CNT             PIC S9(04)    VALUE ZERO         01190099
012000                                                   COMP-3.        01200099
012100     05  PV-LINE-CNT             PIC S9(04)    VALUE ZERO         01210099
012200                                                   COMP SYNC.     01220099
012300     05  PV-STORE-COUNT          PIC S9(05)  VALUE ZERO           01230099
012400                                                     COMP-3.      01240099
012500     05  PV-TABLE-STORE-COUNT    PIC S9(05)  VALUE ZERO           01250099
012600                                                     COMP-3.      01260099
012700                                                                  01270099
012800 01  PV-PROGRAM-VARIABLES.                                        01280099
012900     05  PV-CURR-MERGE-KEY.                                       01290099
013000         10  PV-CURR-MERGE-PO        PIC S9(09)    COMP           01300099
013100                                                   VALUE ZERO.    01310099
013200         10  PV-CURR-MERGE-REC       PIC S9(09)    COMP           01320099
013300                                                   VALUE ZERO.    01330099
013400         10  PV-CURR-MERGE-LINE      PIC S9(09)    COMP           01340099
013500                                                   VALUE ZERO.    01350099
013600     05  PV-PREV-MERGE-KEY.                                       01360099
013700         10  PV-PREV-MERGE-PO        PIC S9(09)    COMP           01370099
013800                                                   VALUE ZERO.    01380099
013900         10  PV-PREV-MERGE-REC       PIC S9(09)    COMP           01390099
014000                                                   VALUE ZERO.    01400099
014100         10  PV-PREV-MERGE-LINE      PIC S9(09)    COMP           01410099
014200                                                   VALUE ZERO.    01420099
014300                                                                  01430099
014400     05  PV-PREV-STR-NBR             PIC S9(04)    COMP           01440099
014500                                                   VALUE ZERO.    01450099
014600     05  PV-PREV-REC-TYPE-CDE        PIC  X(01)    VALUE SPACE.   01460099
014700                                                                  01470099
014800     05  PV-HOLD-REC-LOC             PIC  X(03)    VALUE SPACE.   01480099
014900                                                                  01490099
015000     05  PV-CNVRT-OPER-UNT-ID        PIC 9(3).                    01500099
015100     05  PV-CNVRT-PO-NBR             PIC 9(8).                    01510099
015200     05  PV-CNVRT-PO-LNE-NBR         PIC 9(4).                    01520099
015300     05  PV-CNVRT-REC-SEQ-NBR        PIC 9(3).                    01530099
015400     05  PV-CNVRT-FCLTY-ID           PIC 9(8).                    01540099
015500     05  PV-CNVRT-STORE-NBR          PIC 9(4).                    01550099
015600                                                                  01560099
015700     05  PV-DISP-PO-NBR              PIC 9(8).                    01570099
015800     05  PV-DISP-PO-LNE-NBR          PIC 9(4).                    01580099
015900     05  PV-DISP-REC-SEQ-NBR         PIC 9(3).                    01590099
016000                                                                  01600099
016100     05  PV-SAVE-REC-LOC-CODE    PIC X(04).                       01610099
016200     05  PV-SAVE-REC-LOC-CODE-N REDEFINES                         01620099
016300         PV-SAVE-REC-LOC-CODE    PIC 9(04).                       01630099
016400     05  PV-SAVE-TIMESTAMP.                                       01640099
016500         10  PV-SAVE-YYYY        PIC 9(04).                       01650099
016600         10  FILLER              PIC X.                           01660099
016700         10  PV-SAVE-MM          PIC 9(02).                       01670099
016800         10  FILLER              PIC X.                           01680099
016900         10  PV-SAVE-DD          PIC 9(02).                       01690099
017000         10  FILLER              PIC X(16).                       01700099
017100*----------------------------------------------------------------*01710099
017200*                                              ** WR # 21361     *01720099
017300* ADDED NEW VARIABLES - PV-ABEND-21361 AND PV-TEMP-SEQ-NBR.      *01730099
017400*----------------------------------------------------------------*01740099
017500 01  PV-MISC-FIELDS.                                              01750099
017600     05  ABEND-CODE              PIC S9(04) VALUE ZERO            01760099
017700                                                   COMP SYNC.     01770099
017800                                                                  01780099
017900     05  PV-PARAGRAPH-NAME       PIC X(30) VALUE SPACE.           01790099
018000     05  PV-DB2-OPERATION-ATTEMPTED                               01800099
018100                                 PIC X(30) VALUE SPACE.           01810099
018200     05  PV-ABEND-21361.                                          01820099
018300         10  PV-ABEND-MESSAGE-TEXT   PIC  X(30)    VALUE SPACES.  01830099
018400         10  PV-SQLCODE              PIC  S9(9)    VALUE ZEROES.  01840099
018500         10  PV-DB2-VIEW-NAME        PIC  X(10)    VALUE SPACES.  01850099
018600     05  PV-TEMP-SEQ-NBR             PIC  9(8).                   01860099
018700*----------------------------------------------------------------*01870099
018800* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *01880099
018900*----------------------------------------------------------------*01890099
019000                                                                  01900099
019100     05  PV-HOLD-UPD-TMST.                                        01910099
019200         10  PV-HOLD-UPD-TMST-CC     PIC X(02).                   01920099
019300         10  PV-HOLD-UPD-TMST-YY     PIC X(02).                   01930099
019400         10  FILLER                  PIC X(01).                   01940099
019500         10  PV-HOLD-UPD-TMST-MM     PIC X(02).                   01950099
019600         10  FILLER                  PIC X(01).                   01960099
019700         10  PV-HOLD-UPD-TMST-DD     PIC X(02).                   01970099
019800         10  FILLER                  PIC X(16).                   01980099
019900                                                                  01990099
020000     05  PV-HOLD-FORMAT-MMDDYY.                                   02000099
020100         10  PV-HOLD-FORMAT-MM       PIC X(02).                   02010099
020200         10  PV-HOLD-FORMAT-DD       PIC X(02).                   02020099
020300         10  PV-HOLD-FORMAT-YY       PIC X(02).                   02030099
020400                                                                  02040099
020500     05  PV-CURR-DATE-YYMMDD.                                     02050099
020600         10  PV-CURR-DATE-YY     PIC 9(02) VALUE ZERO.            02060099
020700         10  PV-CURR-DATE-MM     PIC 9(02) VALUE ZERO.            02070099
020800         10  PV-CURR-DATE-DD     PIC 9(02) VALUE ZERO.            02080099
020900                                                                  02090099
021000     05  PV-CURR-TIME.                                            02100099
021100         10  PV-CURR-TIME-HH     PIC 9(02)    VALUE ZERO.         02110099
021200         10  PV-CURR-TIME-MM     PIC 9(02)    VALUE ZERO.         02120099
021300         10  PV-CURR-TIME-SSHH   PIC 9(04)    VALUE ZERO.         02130099
021400                                                                  02140099
021500     05  PV-HOLD-CURR-DATE-MMDDYY    PIC  9(06)    VALUE ZERO.    02150099
021600     05  PV-HOLD-CURR-DATE-MMDDYY-X  REDEFINES                    02160099
021700         PV-HOLD-CURR-DATE-MMDDYY.                                02170099
021800         10  PV-HOLD-CURR-DATE-MM    PIC  9(02).                  02180099
021900         10  PV-HOLD-CURR-DATE-DD    PIC  9(02).                  02190099
022000         10  PV-HOLD-CURR-DATE-YY    PIC  9(02).                  02200099
022100                                                                  02210099
022200 01  SD-SYSTEM-DATE.                                              02220099
022300     05  SD-SYSTEM-YEAR                  PIC  9(02)  VALUE ZEROS. 02230099
022400     05  SD-SYSTEM-MONTH                 PIC  9(02)  VALUE ZEROS. 02240099
022500     05  SD-SYSTEM-DAY                   PIC  9(02)  VALUE ZEROS. 02250099
022600                                                                  02260099
022700*******                                                           02270099
022800*     WORK AREA FOR FISCAL CALENDAR ROUTINE.                      02280099
022900*******                                                           02290099
023000     COPY DPWS500.                                                02300099
023100 EJECT                                                            02310099
023200     COPY DPWS004.                                                02320099
023300******************************************************************02330099
023400*  WORK FIELDS FOR PRINTING A 132 CHARACTER REPORT.               02340099
023500******************************************************************02350099
023600     COPY DPWS132O.                                               02360099
023700                                                                  02370099
023800 01  HEADING-LINES.                                               02380099
023900     05  HEADING-LINE-0.                                          02390099
024000         10  FILLER                  PIC  X(44)    VALUE SPACES.  02400099
024100         10  FILLER                  PIC  X(44)    VALUE          02410099
024200             '      POSTED VERIFY RECEIPT ADJUSTMENT      '.      02420099
024300         10  FILLER                  PIC  X(44)    VALUE SPACES.  02430099
024400                                                                  02440099
024500     05  HEADING-LINE-1.                                          02450099
024600         10  FILLER                  PIC  X(23)    VALUE SPACES.  02460099
024700         10  FILLER                  PIC  X(43)    VALUE          02470099
024800             'RECEIPT ADJUSTMENTS TO RECEIVERS HAVING STO'.       02480099
024900         10  FILLER                  PIC  X(43)    VALUE          02490099
025000             'RES WITH PHYSICAL INVENTORY DC CUTOFF DATES'.       02500099
025100         10  FILLER                  PIC  X(23)    VALUE SPACES.  02510099
025200                                                                  02520099
025300     05  HEADING-LINE-2.                                          02530099
025400         10  FILLER                  PIC  X(52)    VALUE SPACES.  02540099
025500         10  FILLER                  PIC  X(18)    VALUE          02550099
025600             'ADJUSTMENT DATE:  '.                                02560099
025700         10 HL3-WEEK-END-DATE        PIC  X(10)  VALUE SPACE.     02570099
025800         10  FILLER                  PIC  X(52)    VALUE SPACES.  02580099
025900                                                                  02590099
026000*----------------------------------------------------------------*02600099
026100*                                       ** WR # 21361.           *02610099
026200* CHANGED THE REPORT LAYOUT OF HEADING-LINE-3 AND HEADING-LINE-4 *02620099
026300*----------------------------------------------------------------*02630099
026400     05  HEADING-LINE-3.                                          02640099
026500         10  FILLER                  PIC  X(40)    VALUE          02650099
026600             '                RCV   RCPT/VERIFY       '.          02660099
026700         10  FILLER                  PIC  X(40)    VALUE          02670099
026800             '                           UNITS B4    U'.          02680099
026900         10  FILLER                  PIC  X(40)    VALUE          02690099
027000             'NITS AFT   NET UNITS      COST VALUE    '.          02700099
027100         10  FILLER                  PIC  X(12)    VALUE          02710099
027200             'RETAIL VALUE'.                                      02720099
027300                                                                  02730099
027400     05  HEADING-LINE-4.                                          02740099
027500         10  FILLER                  PIC  X(40)    VALUE          02750099
027600             '  PO/RECEIVER   LOC       DATE     LINE '.          02760099
027700         10  FILLER                  PIC  X(40)    VALUE          02770099
027800             '  DPT CL   SKU     STORE   ADJUSTMENT  A'.          02780099
027900         10  FILLER                  PIC  X(40)    VALUE          02790099
028000             'DJUSTMENT  ADJUSTED       ADJUSTMENT    '.          02800099
028100         10  FILLER                  PIC  X(12)    VALUE          02810099
028200             '  ADJUSTMENT'.                                      02820099
028300*----------------------------------------------------------------*02830099
028400* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *02840099
028500*----------------------------------------------------------------*02850099
028600*                                                                 02860099
028700*----------------------------------------------------------------*02870099
028800* CHANGED THE STRUCTURE OF DTL-SKU.            ** WR # 21361     *02880099
028900* CHANGED THE REPORT LAYOUT OF DETAIL-LINE-1.                    *02890099
029000*----------------------------------------------------------------*02900099
029100     05  DETAIL-LINE-1.                                           02910099
029200         10  FILLER                  PIC X(02)     VALUE SPACES.  02920099
029300         10  DTL-PO                  PIC X(08)     VALUE SPACES.  02930099
029400         10  DTL-DASH-1              PIC X(01)     VALUE '-'.     02940099
029500         10  DTL-RCVR-SEQ            PIC X(03)     VALUE SPACES.  02950099
029600         10  FILLER                  PIC X(02)     VALUE SPACES.  02960099
029700         10  DTL-REC-LOC             PIC X(03)     VALUE SPACES.  02970099
029800         10  FILLER                  PIC X(03)     VALUE SPACES.  02980099
029900         10  DTL-ADJ-DATE.                                        02990099
030000             15  DTL-ADJ-MM          PIC X(02).                   03000099
030100             15  DTL-SLASH-1         PIC X(01).                   03010099
030200             15  DTL-ADJ-DD          PIC X(02).                   03020099
030300             15  DTL-SLASH-2         PIC X(01).                   03030099
030400             15  DTL-ADJ-YYY         PIC X(04).                   03040099
030500         10  FILLER                  PIC X(03)     VALUE SPACES.  03050099
030600         10  DTL-LINE                PIC X(04).                   03060099
030700         10  FILLER                  PIC X(03)     VALUE SPACES.  03070099
030800         10  DTL-SKU                 PIC X(15)     VALUE SPACES.  03080099
030900         10  FILLER          REDEFINES DTL-SKU.                   03090099
031000             15  DTL-SKU-DPT         PIC X(03).                   03100099
031100             15  DTL-SKU-SPACE1-1    PIC X(01).                   03110099
031200             15  DTL-SKU-CLN         PIC X(02).                   03120099
031300             15  DTL-SKU-SPACE2-1    PIC X(01).                   03130099
031400             15  DTL-SKU-SEQ         PIC X(08).                   03140099
031500         10  FILLER                  PIC X(03)     VALUE SPACES.  03150099
031600         10  DTL-STORE               PIC X(04).                   03160099
031700         10  FILLER                  PIC X(03)     VALUE SPACES.  03170099
031800         10  DTL-ADJ-UNITS-B4        PIC ZZZ,ZZ9-.                03180099
031900         10  FILLER                  PIC X(04)     VALUE SPACES.  03190099
032000         10  DTL-ADJ-UNITS-AFT       PIC ZZZ,ZZ9-.                03200099
032100         10  FILLER                  PIC X(04)     VALUE SPACES.  03210099
032200         10  DTL-ADJ-UNITS-NET       PIC ZZZ,ZZ9-.                03220099
032300         10  FILLER                  PIC X(04)     VALUE SPACES.  03230099
032400         10  DTL-ADJ-COST            PIC Z,ZZZ,ZZ9.99-.           03240099
032500         10  FILLER                  PIC X(03)     VALUE SPACES.  03250099
032600         10  DTL-ADJ-RETAIL          PIC Z,ZZZ,ZZ9.99-.           03260099
032700*----------------------------------------------------------------*03270099
032800* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *03280099
032900*----------------------------------------------------------------*03290099
033000*                                                                 03300099
033100*----------------------------------------------------------------*03310099
033200* CHANGED THE STRUCTURE OF DTL1A-SKU.          ** WR # 21361     *03320099
033300* CHANGED THE REPORT LAYOUT OF DETAIL-LINE-1A.                   *03330099
033400*----------------------------------------------------------------*03340099
033500     05  DETAIL-LINE-1A.                                          03350099
033600         10  FILLER                  PIC X(02)     VALUE SPACES.  03360099
033700         10  DTL1A-PO                PIC X(08)     VALUE SPACES.  03370099
033800         10  DTL1A-DASH-1            PIC X(01)     VALUE '-'.     03380099
033900         10  DTL1A-RCVR-SEQ          PIC X(03)     VALUE SPACES.  03390099
034000         10  FILLER                  PIC X(02)     VALUE SPACES.  03400099
034100         10  DTL1A-REC-LOC           PIC X(03)     VALUE SPACES.  03410099
034200         10  FILLER                  PIC X(03)     VALUE SPACES.  03420099
034300         10  DTL1A-ADJ-DATE.                                      03430099
034400             15  DTL1A-ADJ-MM        PIC X(02).                   03440099
034500             15  DTL1A-SLASH-1       PIC X(01).                   03450099
034600             15  DTL1A-ADJ-DD        PIC X(02).                   03460099
034700             15  DTL1A-SLASH-2       PIC X(01).                   03470099
034800             15  DTL1A-ADJ-YYY       PIC X(04).                   03480099
034900         10  FILLER                  PIC X(03)     VALUE SPACES.  03490099
035000         10  DTL1A-LINE              PIC X(04).                   03500099
035100         10  FILLER                  PIC X(03)     VALUE SPACES.  03510099
035200         10  DTL1A-SKU               PIC X(15)     VALUE SPACES.  03520099
035300         10  FILLER          REDEFINES DTL1A-SKU.                 03530099
035400             15  DTL1A-SKU-DPT       PIC X(03).                   03540099
035500             15  DTL1A-SKU-SPACE1-1  PIC X(01).                   03550099
035600             15  DTL1A-SKU-CLN       PIC X(02).                   03560099
035700             15  DTL1A-SKU-SPACE2-1  PIC X(01).                   03570099
035800             15  DTL1A-SKU-SEQ       PIC X(08).                   03580099
035900         10  FILLER                  PIC X(03)     VALUE SPACES.  03590099
036000         10  DTL1A-STORE             PIC X(04).                   03600099
036100         10  FILLER                  PIC X(03)     VALUE SPACES.  03610099
036200         10  DTL1A-ADJ-UNITS-B4      PIC ZZZ,ZZZ-.                03620099
036300         10  FILLER                  PIC X(04)     VALUE SPACES.  03630099
036400         10  DTL1A-ADJ-UNITS-AFT     PIC ZZZ,ZZZ-.                03640099
036500         10  FILLER                  PIC X(04)     VALUE SPACES.  03650099
036600         10  DTL1A-ADJ-UNITS-NET     PIC ZZZ,ZZZ-.                03660099
036700         10  FILLER                  PIC X(04)     VALUE SPACES.  03670099
036800         10  DTL1A-ADJ-COST          PIC Z,ZZZ,ZZZ.ZZ-.           03680099
036900         10  FILLER                  PIC X(03)     VALUE SPACES.  03690099
037000         10  DTL1A-ADJ-RETAIL        PIC Z,ZZZ,ZZZ.ZZ-.           03700099
037100*----------------------------------------------------------------*03710099
037200* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *03720099
037300*----------------------------------------------------------------*03730099
037400*                                                                 03740099
037500*----------------------------------------------------------------*03750099
037600* CHANGED THE STRUCTURE OF DTL-SKU2            ** WR # 21361     *03760099
037700* CHANGED THE REPORT LAYOUT OF DETAIL-LINE-2.                    *03770099
037800*----------------------------------------------------------------*03780099
037900     05  DETAIL-LINE-2.                                           03790099
038000         10  FILLER                  PIC X(35)     VALUE SPACES.  03800099
038100         10  DTL-LINE2               PIC X(04).                   03810099
038200         10  FILLER                  PIC X(03)     VALUE SPACES.  03820099
038300         10  DTL-SKU2                PIC X(15)     VALUE SPACES.  03830099
038400         10  FILLER          REDEFINES DTL-SKU2.                  03840099
038500             15  DTL-SKU-DPT2        PIC X(03).                   03850099
038600             15  DTL-SKU-SPACE1-2    PIC X(01).                   03860099
038700             15  DTL-SKU-CLN2        PIC X(02).                   03870099
038800             15  DTL-SKU-SPACE2-2    PIC X(01).                   03880099
038900             15  DTL-SKU-SEQ2        PIC X(08).                   03890099
039000         10  FILLER                  PIC X(03)     VALUE SPACES.  03900099
039100         10  DTL-STORE2              PIC X(04).                   03910099
039200         10  FILLER                  PIC X(03)     VALUE SPACES.  03920099
039300         10  DTL-ADJ-UNITS-B42       PIC ZZZ,ZZ9-.                03930099
039400         10  FILLER                  PIC X(04)     VALUE SPACES.  03940099
039500         10  DTL-ADJ-UNITS-AFT2      PIC ZZZ,ZZ9-.                03950099
039600         10  FILLER                  PIC X(04)     VALUE SPACES.  03960099
039700         10  DTL-ADJ-UNITS-NET2      PIC ZZZ,ZZ9-.                03970099
039800         10  FILLER                  PIC X(04)     VALUE SPACES.  03980099
039900         10  DTL-ADJ-COST2           PIC Z,ZZZ,ZZ9.99-.           03990099
040000         10  FILLER                  PIC X(03)     VALUE SPACES.  04000099
040100         10  DTL-ADJ-RETAIL2         PIC Z,ZZZ,ZZ9.99-.           04010099
040200*----------------------------------------------------------------*04020099
040300* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *04030099
040400*----------------------------------------------------------------*04040099
040500                                                                  04050099
040600     05  DETAIL-LINE-3.                                           04060099
040700         10  FILLER                  PIC X(56)     VALUE SPACES.  04070099
040800         10  DTL-STORE3              PIC X(04).                   04080099
040900         10  FILLER                  PIC X(04)     VALUE SPACES.  04090099
041000         10  DTL-ADJ-UNITS-B43       PIC ZZZ,ZZ9-.                04100099
041100         10  FILLER                  PIC X(04)     VALUE SPACES.  04110099
041200         10  DTL-ADJ-UNITS-AFT3      PIC ZZZ,ZZ9-.                04120099
041300         10  FILLER                  PIC X(04)     VALUE SPACES.  04130099
041400         10  DTL-ADJ-UNITS-NET3      PIC ZZZ,ZZ9-.                04140099
041500         10  FILLER                  PIC X(04)     VALUE SPACES.  04150099
041600         10  DTL-ADJ-COST3           PIC Z,ZZZ,ZZ9.99-.           04160099
041700         10  FILLER                  PIC X(03)     VALUE SPACES.  04170099
041800         10  DTL-ADJ-RETAIL3         PIC Z,ZZZ,ZZ9.99-.           04180099
041900         10  FILLER                  PIC X(03)     VALUE SPACES.  04190099
042000                                                                  04200099
042100     05  DETAIL-COMMENTS-LINE1.                                   04210099
042200         10  FILLER.                                              04220099
042300             15  FILLER              PIC X(16)     VALUE SPACES.  04230099
042400             15  FILLER              PIC X(53)     VALUE          04240099
042500        'STORES NOT ABLE TO ADJUST BECAUSE OF DC CUTOFF DATE: '.  04250099
042600             15  FILLER OCCURS 9 TIMES INDEXED BY CMT1-NDX.       04260099
042700                 20  FILLER          PIC X(01) VALUE SPACES.      04270099
042800                 20  DTL-STR-CMT1    PIC X(04) VALUE SPACES.      04280099
042900                 20  DTL-COMMA1      PIC X(01) VALUE SPACES.      04290099
043000             15  FILLER              PIC X(09)     VALUE SPACES.  04300099
043100     05  DETAIL-COMMENTS-LINE2.                                   04310099
043200         10  FILLER.                                              04320099
043300             15  FILLER              PIC X(15)     VALUE SPACES.  04330099
043400             15  FILLER OCCURS 18 TIMES INDEXED BY CMT2-NDX.      04340099
043500                 20  FILLER          PIC X(01) VALUE SPACES.      04350099
043600                 20  DTL-STR-CMT2    PIC X(04) VALUE SPACES.      04360099
043700                 20  DTL-COMMA2      PIC X(01) VALUE SPACES.      04370099
043800             15  FILLER              PIC X(09)     VALUE SPACES.  04380099
043900                                                                  04390099
044000 01  MISCELLANEOUS-LINES.                                         04400099
044100     05  NODATA-REPORT-LINE.                                      04410099
044200         10  FILLER                  PIC  X(44)    VALUE SPACES.  04420099
044300         10  FILLER                  PIC  X(45)    VALUE          04430099
044400             '******* N O  D A T A  TO  R E P O R T *******'.     04440099
044500         10  FILLER                  PIC  X(43)    VALUE SPACES.  04450099
044600                                                                  04460099
044700     05  END-OF-REPORT-LINE.                                      04470099
044800         10  FILLER                  PIC  X(44)    VALUE SPACES.  04480099
044900         10  FILLER                  PIC  X(45)    VALUE          04490099
045000             '*******   E N D   O F   R E P O R T   *******'.     04500099
045100         10  FILLER                  PIC  X(43)    VALUE SPACES.  04510099
045200                                                                  04520099
045300     05  BLANK-LINE                  PIC X(132)    VALUE SPACES.  04530099
045400                                                                  04540099
045500******************************************************************04550099
045600*    MERGED REPORT FILE                                           04560099
045700******************************************************************04570099
045800     COPY RCRD034.                                                04580099
045900                                                                  04590099
046000*----------------------------------------------------------------*04600099
046100*  COPYBOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE  WR # 21361  *04610099
046200*----------------------------------------------------------------*04620099
046300     COPY XLWS001.                                                04630099
046400*----------------------------------------------------------------*04640099
046500* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *04650099
046600*----------------------------------------------------------------*04660099
046700******************************************************************04670099
046800*  DB2 COMMUNICATION AREA.                                        04680099
046900******************************************************************04690099
047000     EXEC SQL                                                     04700099
047100          INCLUDE SQLCA                                           04710099
047200     END-EXEC.                                                    04720099
047300     EJECT                                                        04730099
047400******************************************************************04740099
047500*  DB2 TABLE DB2PDBA.TRECEIV                                      04750099
047600******************************************************************04760099
047700     EXEC SQL                                                     04770099
047800          INCLUDE TRECEIV                                         04780099
047900     END-EXEC.                                                    04790099
048000     EJECT                                                        04800099
048100******************************************************************04810099
048200*  DB2 TABLE DB2PDBA.TRECITM                                      04820099
048300******************************************************************04830099
048400     EXEC SQL                                                     04840099
048500          INCLUDE TRECITM                                         04850099
048600     END-EXEC.                                                    04860099
048700     EJECT                                                        04870099
048800******************************************************************04880099
048900*  DB2 TABLE DB2PDBA.TPURCHS                                      04890099
049000******************************************************************04900099
049100     EXEC SQL                                                     04910099
049200          INCLUDE TPURCHS                                         04920099
049300     END-EXEC.                                                    04930099
049400     EJECT                                                        04940099
049500******************************************************************04950099
049600*  DB2 TABLE DB2PDBA.TPURITM                                      04960099
049700******************************************************************04970099
049800     EXEC SQL                                                     04980099
049900          INCLUDE TPURITM                                         04990099
050000     END-EXEC.                                                    05000099
050100     EJECT                                                        05010099
050200******************************************************************05020099
050300*  DOMAIN LOCATION TABLE                                          05030099
050400******************************************************************05040099
050500     EXEC SQL                                                     05050099
050600          INCLUDE XLT00010                                        05060099
050700     END-EXEC.                                                    05070099
050800                                                                  05080099
050900     EXEC SQL                                                     05090099
051000         DECLARE STR-NBR-CSR  CURSOR FOR                          05100099
051100             SELECT LOC_NBR                                       05110099
051200                  , LOC_5_ABBR_NM                                 05120099
051300               FROM XLT_LOC                                       05130099
051400              WHERE                                               05140099
051500                 LOC_TYP_CDE = 'DC'                               05150099
051600           ORDER BY LOC_NBR                                       05160099
051700     END-EXEC.                                                    05170099
051800                                                                  05180099
051900 EJECT                                                            05190099
052000 01  ST-STORE-TABLE.                                              05200099
052100     05  ST-STORE-ENTRY          OCCURS 50 TIMES                  05210099
052200                                 INDEXED BY ST-STR-IDX.           05220099
052300         10  ST-STR-NBR                  PIC S9(04)  COMP.        05230099
052400         10  ST-CHAR5-ABBR-NAME          PIC X(5).                05240099
052500 EJECT                                                            05250099
052600***************************************************************** 05260099
052700* PROCEDURE DIVISION.                                           * 05270099
052800***************************************************************** 05280099
052900 PROCEDURE DIVISION.                                              05290099
053000                                                                  05300099
053100 0000-MAINLINE-PROCESSING.                                        05310099
053200                                                                  05320099
053300     PERFORM 1000-INITIALIZATION.                                 05330099
053400                                                                  05340099
053500     PERFORM 2000-PROCESS-MERGE-FILE                              05350099
053600       UNTIL PS-EOF-MERGE.                                        05360099
053700                                                                  05370099
053800     WRITE RECV-REPORT-RECORD                                     05380099
053900       FROM BLANK-LINE                                            05390099
054000         AFTER ADVANCING 1 LINE.                                  05400099
054100     ADD +1 TO PV-LINE-CNT.                                       05410099
054200                                                                  05420099
054300     WRITE RECV-REPORT-RECORD                                     05430099
054400       FROM END-OF-REPORT-LINE                                    05440099
054500         AFTER ADVANCING 1 LINE.                                  05450099
054600     ADD +1 TO PV-LINE-CNT.                                       05460099
054700                                                                  05470099
054800     CLOSE MERGE-FILE                                             05480099
054900           RECV-REPORT-FILE.                                      05490099
055000                                                                  05500099
055100     STOP RUN.                                                    05510099
055200                                                                  05520099
055300 EJECT                                                            05530099
055400******************************************************************05540099
055500** READ THE DB2 CONTROL TABLE AND READ FIRST TRIGGER RECORD      *05550099
055600******************************************************************05560099
055700 1000-INITIALIZATION.                                             05570099
055800                                                                  05580099
055900     OPEN INPUT MERGE-FILE                                        05590099
056000          OUTPUT RECV-REPORT-FILE.                                05600099
056100                                                                  05610099
056200     ACCEPT PV-CURR-DATE-YYMMDD FROM DATE.                        05620099
056300     MOVE PV-CURR-DATE-YY TO PV-HOLD-CURR-DATE-YY                 05630099
056400                             SD-SYSTEM-YEAR                       05640099
056500     MOVE PV-CURR-DATE-MM TO PV-HOLD-CURR-DATE-MM                 05650099
056600                             SD-SYSTEM-MONTH                      05660099
056700     MOVE PV-CURR-DATE-DD TO PV-HOLD-CURR-DATE-DD                 05670099
056800                             SD-SYSTEM-DAY                        05680099
056900                                                                  05690099
057000     ACCEPT PV-CURR-TIME FROM TIME.                               05700099
057100                                                                  05710099
057200     MOVE PV-CURR-DATE-MM        TO DP132O-RUN-MONTH.             05720099
057300     MOVE PV-CURR-DATE-DD        TO DP132O-RUN-DAY.               05730099
057400     MOVE PV-CURR-DATE-YY        TO DP132O-RUN-YEAR.              05740099
057500                                                                  05750099
057600     MOVE PV-CURR-TIME-HH        TO DP132O-RUN-HOUR.              05760099
057700     MOVE PV-CURR-TIME-MM        TO DP132O-RUN-MINUTE.            05770099
057800     MOVE PC-CURRENT-PROGRAM-NAME                                 05780099
057900                                 TO DP132O-PROGRAM-NAME.          05790099
058000                                                                  05800099
058100     PERFORM 7100-READ-MERGE-FILE.                                05810099
058200                                                                  05820099
058300     IF  PS-EOF-MERGE                                             05830099
058400         PERFORM 8000-PRINT-HEADINGS                              05840099
058500         WRITE RECV-REPORT-RECORD                                 05850099
058600           FROM NODATA-REPORT-LINE                                05860099
058700             AFTER ADVANCING 2 LINES                              05870099
058800         WRITE RECV-REPORT-RECORD                                 05880099
058900           FROM BLANK-LINE                                        05890099
059000             AFTER ADVANCING 1 LINE                               05900099
059100         ADD +1 TO PV-LINE-CNT                                    05910099
059200     ELSE                                                         05920099
059300         PERFORM 1110-GET-WEEK-END-DATE                           05930099
059400         PERFORM 8000-PRINT-HEADINGS                              05940099
059500         INITIALIZE ST-STORE-TABLE                                05950099
059600         PERFORM 7000-OPEN-STR-NBR-CSR                            05960099
059700         PERFORM 7010-FETCH-STR-NBR-CSR                           05970099
059800         PERFORM 1200-LOAD-STR-NBR-TBL                            05980099
059900             VARYING ST-STR-IDX FROM 1 BY 1                       05990099
060000             UNTIL SQLCODE = +100                                 06000099
060100             OR ST-STR-IDX > PC-TABLE-MAX                         06010099
060200         IF ST-STR-IDX > PC-TABLE-MAX                             06020099
060300             PERFORM 7020-CLOSE-STR-NBR-CSR                       06030099
060400             MOVE '1200-LOAD-STR-NBR-TBL'                         06040099
060500                                 TO PV-PARAGRAPH-NAME             06050099
060600             MOVE 'WORKING STORAGE TABLE OVERFLOW'                06060099
060700                                 TO PV-DB2-OPERATION-ATTEMPTED    06070099
060800             PERFORM 9100-SQL-ABEND                               06080099
060900         END-IF                                                   06090099
061000         PERFORM 7020-CLOSE-STR-NBR-CSR                           06100099
061100     END-IF.                                                      06110099
061200                                                                  06120099
061300 EJECT                                                            06130099
061400******************************************************************06140099
061500* 1110-GET-WEEK-END-DATE  USES DPKUT500 TO DETERMIN THE WEEK END  06150099
061600*      DATE.  THIS PARAGRAPH WILL BE USED IF THE INPUT FILE HAS   06160099
061700*      DATA.                                                      06170099
061800******************************************************************06180099
061900 1110-GET-WEEK-END-DATE.                                          06190099
062000                                                                  06200099
062100     MOVE SD-SYSTEM-DATE            TO DPG51-SYSTEM-DATE.         06210099
062200     MOVE RC034-UPD-TMST            TO PV-HOLD-UPD-TMST.          06220099
062300     MOVE PV-HOLD-UPD-TMST-MM       TO PV-HOLD-FORMAT-MM.         06230099
062400     MOVE PV-HOLD-UPD-TMST-DD       TO PV-HOLD-FORMAT-DD.         06240099
062500     MOVE PV-HOLD-UPD-TMST-YY       TO PV-HOLD-FORMAT-YY.         06250099
062600     MOVE PV-HOLD-FORMAT-MMDDYY     TO DPG52-LK-DATE-INPUT        06260099
062700                                       DPG53-LK-CMPR-DATE-INPUT.  06270099
062800                                                                  06280099
062900     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      06290099
063000     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     06300099
063100     SET DPG52-LK-DTE-GREG          TO TRUE.                      06310099
063200     SET DPG53-LK-CMPR-DTE-GREG     TO TRUE.                      06320099
063300                                                                  06330099
063400     CALL PC-DPKUT500 USING DPG51 DPG52 DPG53                     06340099
063500                            DPG54 DPG55 DPG56.                    06350099
063600                                                                  06360099
063700     EVALUATE TRUE                                                06370099
063800         WHEN DPG54-NO-ERROR                                      06380099
063900             MOVE  DPG55-LAST-WKDY-GREG-FMT                       06390099
064000                                    TO HL3-WEEK-END-DATE          06400099
064100                                                                  06410099
064200         WHEN DPG54-DATE-INVALID                                  06420099
064300             DISPLAY '** ABEND **'                                06430099
064400             DISPLAY '** PROGRAM = RCKRP020 -- CALLED MODULE '    06440099
064500                     'DPKUT500 **'                                06450099
064600             DISPLAY '** PARAGRAPH = 1110-GET-WEEK-END-DATE **'   06460099
064700             DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '    06470099
064800             DISPLAY DPG54-ERROR-MESSAGE                          06480099
064900             MOVE +4003 TO ABEND-CODE                             06490099
065000             CALL 'ILBOABN0' USING ABEND-CODE                     06500099
065100                                                                  06510099
065200         WHEN DPG54-CMPR-DATE-INVALID                             06520099
065300             DISPLAY '** ABEND **'                                06530099
065400             DISPLAY '** PROGRAM = RCKRP020 -- CALLED MODULE '    06540099
065500                     'DPKUT500 **'                                06550099
065600             DISPLAY '** PARAGRAPH = 1110-GET-WEEK-END-DATE **'   06560099
065700             DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '    06570099
065800             DISPLAY DPG54-ERROR-MESSAGE                          06580099
065900             MOVE +4003 TO ABEND-CODE                             06590099
066000             CALL 'ILBOABN0' USING ABEND-CODE                     06600099
066100                                                                  06610099
066200         WHEN OTHER                                               06620099
066300             DISPLAY DPG54-ERROR-MESSAGE                          06630099
066400                                                                  06640099
066500     END-EVALUATE.                                                06650099
066600                                                                  06660099
066700 EJECT                                                            06670099
066800******************************************************************06680099
066900 1200-LOAD-STR-NBR-TBL.                                           06690099
067000                                                                  06700099
067100     MOVE XLT00010-LOC-NBR       TO ST-STR-NBR (ST-STR-IDX)       06710099
067200     MOVE XLT00010-LOC-5-ABBR-NM                                  06720099
067300                                 TO ST-CHAR5-ABBR-NAME            06730099
067400                                   (ST-STR-IDX)                   06740099
067500                                                                  06750099
067600     ADD +1                      TO PV-TABLE-STORE-COUNT          06760099
067700                                                                  06770099
067800     PERFORM 7010-FETCH-STR-NBR-CSR.                              06780099
067900     EJECT                                                        06790099
068000 2000-PROCESS-MERGE-FILE.                                         06800099
068100******************************************************************06810099
068200*  THIS PARAGRAPH WILL PROCESS THE INPUT FILE TO CREATE THE       06820099
068300*  REPORT.                                                        06830099
068400******************************************************************06840099
068500                                                                  06850099
068600     IF  PV-LINE-CNT > PC-LINE-LIMIT                              06860099
068700         PERFORM 8000-PRINT-HEADINGS                              06870099
068800     END-IF.                                                      06880099
068900                                                                  06890099
069000     IF  RC034-REC-TYPE-STORE-NOADJ                               06900099
069100         MOVE ZEROS TO PV-STORE-COUNT                             06910099
069200                       PV-PREV-STR-NBR                            06920099
069300         SET CMT1-NDX TO 1                                        06930099
069400         SET CMT2-NDX TO 1                                        06940099
069500         SET PS-STORE-LIST-SHORT-NOT-DONE TO TRUE                 06950099
069600         SET PS-STORE-LIST-INCOMPLETE TO TRUE                     06960099
069700         INITIALIZE DETAIL-COMMENTS-LINE1                         06970099
069800                    DETAIL-COMMENTS-LINE2                         06980099
069900         PERFORM 3000-WRITE-STORE-LIST                            06990099
070000             UNTIL PS-EOF-MERGE                                   07000099
070100                OR NOT RC034-REC-TYPE-STORE-NOADJ                 07010099
070200                OR PS-STORE-LIST-COMPLETE                         07020099
070300         MOVE ZEROS TO PV-PREV-MERGE-PO                           07030099
070400                       PV-PREV-MERGE-REC                          07040099
070500                       PV-PREV-MERGE-LINE                         07050099
070600         IF  PV-STORE-COUNT > 0                                   07060099
070700             IF  PS-STORE-LIST-SHORT-DONE                         07070099
070800                 WRITE RECV-REPORT-RECORD                         07080099
070900                  FROM DETAIL-COMMENTS-LINE2                      07090099
071000                  AFTER ADVANCING 1 LINE                          07100099
071100                 ADD +1 TO PV-LINE-CNT                            07110099
071200             ELSE                                                 07120099
071300                 WRITE RECV-REPORT-RECORD                         07130099
071400                  FROM DETAIL-COMMENTS-LINE1                      07140099
071500                  AFTER ADVANCING 2 LINES                         07150099
071600                 ADD +2 TO PV-LINE-CNT                            07160099
071700         ELSE                                                     07170099
071800             CONTINUE                                             07180099
071900     ELSE                                                         07190099
072000         PERFORM 2500-PROCESS-MERGE-RECORD                        07200099
072100         MOVE PV-CURR-MERGE-KEY TO                                07210099
072200              PV-PREV-MERGE-KEY                                   07220099
072300         PERFORM 7100-READ-MERGE-FILE.                            07230099
072400                                                                  07240099
072500 EJECT                                                            07250099
072600 2500-PROCESS-MERGE-RECORD.                                       07260099
072700******************************************************************07270099
072800*  THIS PARAGRAPH WILL CONTROL THE PRINTING OF THE DETAIL LINES  *07280099
072900*  ON THE REPORT.                                                *07290099
073000******************************************************************07300099
073100                                                                  07310099
073200     IF  PV-CURR-MERGE-KEY = PV-PREV-MERGE-KEY                    07320099
073300         IF  RC034-REC-TYPE-TRIG-NOADJ                            07330099
073400             MOVE RC034-REC-TYPE-CDE TO                           07340099
073500                  PV-PREV-REC-TYPE-CDE                            07350099
073600         ELSE                                                     07360099
073700             IF  RC034-REC-TYPE-TRIG-ADJ                          07370099
073800                 IF  PV-PREV-REC-TYPE-CDE = 'B'                   07380099
073900                 OR  PV-PREV-REC-TYPE-CDE = 'C'                   07390099
074000                     MOVE RC034-REC-TYPE-CDE TO                   07400099
074100                          PV-PREV-REC-TYPE-CDE                    07410099
074200                 ELSE                                             07420099
074300                     PERFORM 2600-FORMAT-AND-WRITE                07430099
074400                     MOVE RC034-REC-TYPE-CDE TO                   07440099
074500                          PV-PREV-REC-TYPE-CDE                    07450099
074600             ELSE                                                 07460099
074700                 PERFORM 2600-FORMAT-AND-WRITE                    07470099
074800                 MOVE RC034-REC-TYPE-CDE TO                       07480099
074900                      PV-PREV-REC-TYPE-CDE                        07490099
075000     ELSE                                                         07500099
075100         PERFORM 2600-FORMAT-AND-WRITE.                           07510099
075200                                                                  07520099
075300*----------------------------------------------------------------*07530099
075400*                                               **   WR # 21361  *07540099
075500* ADDED CODE TO CHECK FOR THE DUMMY SKU AND CALL TO XLKUT001     *07550099
075600*----------------------------------------------------------------*07560099
075700 2600-FORMAT-AND-WRITE.                                           07570099
075800                                                                  07580099
075900     IF  PV-CURR-MERGE-KEY = PV-PREV-MERGE-KEY                    07590099
076000         NEXT SENTENCE                                            07600099
076100     ELSE                                                         07610099
076200         IF  RC034-REC-TYPE-TRIG-NOADJ                            07620099
076300             MOVE SPACES TO PURITM-CL-NBR                         07630099
076400                            PURITM-SKU-SEQ-NBR                    07640099
076500             PERFORM 3300-GET-PO-INFO                             07650099
076600         ELSE                                                     07660099
076700             PERFORM 3200-GET-PO-LINE-INFO                        07670099
076800                                                                  07680099
076900             IF PURITM-ITM-NBR < 0                                07690099
077000                MOVE '2600-FORMAT-AND-WRITE'                      07700099
077100                                 TO PV-PARAGRAPH-NAME             07710099
077200                MOVE 'SELECT ROW FROM PURITM'                     07720099
077300                                 TO PV-ABEND-MESSAGE-TEXT         07730099
077400                PERFORM 9200-PROCESS-ABEND                        07740099
077500             END-IF                                               07750099
077600                                                                  07760099
077700             IF PURITM-ITM-NBR = 0                                07770099
077800                IF PURITM-SKU-SEQ-NBR = PC-000                    07780099
077900                   MOVE '00000000'    TO DTL-SKU-SEQ              07790099
078000                                         DTL1A-SKU-SEQ            07800099
078100                ELSE                                              07810099
078200                   IF PURITM-SKU-SEQ-NBR = PC-999                 07820099
078300                      MOVE '99999999' TO DTL-SKU-SEQ              07830099
078400                                         DTL1A-SKU-SEQ            07840099
078500                   ELSE                                           07850099
078600                      MOVE '2600-FORMAT-AND-WRITE'                07860099
078700                                      TO PV-PARAGRAPH-NAME        07870099
078800                      MOVE 'SELECT ROW FROM PURITM'               07880099
078900                                      TO PV-ABEND-MESSAGE-TEXT    07890099
079000                      PERFORM 9200-PROCESS-ABEND                  07900099
079100                   END-IF                                         07910099
079200                END-IF                                            07920099
079300             END-IF                                               07930099
079400                                                                  07940099
079500             IF PURITM-ITM-NBR > 0 AND                            07950099
079600                PS-CALL-API-YES    AND                            07960099
079700                ((PURITM-SKU-SEQ-NBR NOT = PC-000) AND            07970099
079800                 (PURITM-SKU-SEQ-NBR NOT = PC-999))               07980099
079900                  PERFORM 3205-CALL-XLKUT-DOMAIN-PGM              07990099
080000             END-IF                                               08000099
080100         END-IF                                                   08010099
080200     END-IF.                                                      08020099
080300                                                                  08030099
080400     IF  RC034-REC-TYPE-TRIG-NOADJ                                08040099
080500         PERFORM 2700-FORMAT-DETAIL-2                             08050099
080600     ELSE                                                         08060099
080700         PERFORM 2800-FORMAT-DETAIL-1                             08070099
080800     END-IF.                                                      08080099
080900*----------------------------------------------------------------*08090099
081000* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *08100099
081100*----------------------------------------------------------------*08110099
081200 2700-FORMAT-DETAIL-2.                                            08120099
081300                                                                  08130099
081400     INITIALIZE DETAIL-LINE-1A.                                   08140099
081500                                                                  08150099
081600     MOVE RC034-ORD-NBR TO                                        08160099
081700          PV-CNVRT-PO-NBR.                                        08170099
081800     MOVE RC034-REC-SEQ-NBR TO                                    08180099
081900          PV-CNVRT-REC-SEQ-NBR.                                   08190099
082000     MOVE PV-CNVRT-PO-NBR TO                                      08200099
082100          DTL1A-PO.                                               08210099
082200     MOVE PV-CNVRT-REC-SEQ-NBR TO                                 08220099
082300          DTL1A-RCVR-SEQ.                                         08230099
082400     MOVE '-' TO DTL1A-DASH-1.                                    08240099
082500                                                                  08250099
082600     PERFORM 2720-SEARCH-FOR-DC                                   08270099
082700                                                                  08310099
082800     IF PS-DC-FOUND                                               08320099
082900        NEXT SENTENCE                                             08330099
083000     ELSE                                                         08340099
083100        MOVE 'DS ' TO PV-HOLD-REC-LOC                             08350099
083200        MOVE RECEIV-REC-TMST TO                                   08360099
083300             PV-SAVE-TIMESTAMP                                    08370099
083400     END-IF.                                                      08380099
083500                                                                  08390099
083600     MOVE PV-HOLD-REC-LOC         TO DTL1A-REC-LOC.               08400099
083700     MOVE PV-SAVE-YYYY            TO DTL1A-ADJ-YYY.               08410099
083800     MOVE PV-SAVE-MM              TO DTL1A-ADJ-MM.                08420099
083900     MOVE PV-SAVE-DD              TO DTL1A-ADJ-DD.                08430099
084000     MOVE '/'                     TO DTL1A-SLASH-1                08440099
084100                                     DTL1A-SLASH-2.               08450099
084200                                                                  08460099
084300     MOVE 'ALL '  TO DTL1A-LINE.                                  08470099
084400     MOVE 'N/A '  TO DTL1A-STORE.                                 08480099
084500                                                                  08490099
084600     WRITE RECV-REPORT-RECORD                                     08500099
084700       FROM DETAIL-LINE-1A                                        08510099
084800         AFTER ADVANCING 2 LINES.                                 08520099
084900                                                                  08530099
085000     ADD +2 TO PV-LINE-CNT.                                       08540099
085100                                                                  08550099
085200 2720-SEARCH-FOR-DC.                                              08560099
085300                                                                  08570099
085400     SET ST-STR-IDX                   TO 1                        08570199
085500     SEARCH ST-STORE-ENTRY                                        08571099
085600         AT END                                                           
085700             SET PS-DC-NOT-FOUND      TO TRUE                     09610099
085800         WHEN ST-STR-NBR (ST-STR-IDX) = RECEIV-CURR-OPER-UNT-ID   08590099
085900             MOVE RECEIV-CURR-OPER-UNT-ID                         08600099
086000                                      TO PV-CNVRT-OPER-UNT-ID     08610099
086100             MOVE PV-CNVRT-OPER-UNT-ID                            08620099
086200                                      TO PV-HOLD-REC-LOC          08630099
086300             MOVE RECEIV-VERFYD-TMST  TO PV-SAVE-TIMESTAMP        08650099
086400             SET PS-DC-FOUND          TO TRUE                     08660099
086500     END-SEARCH.                                                  08670099
086600                                                                  08680099
086700*----------------------------------------------------------------*08690099
086800*                                                  ** WR # 21361.*08700099
086900* DELETED CODE TO MOVE DASH TO DTL-SKU-DASH1-1.                  *08710099
087000* ADDED   CODE TO MOVE SPACE TO DTL-SKU-SPACE1-1.                *08720099
087100* DELETED CODE TO MOVE DASH TO DTL-SKU-DASH2-1.                  *08730099
087200* ADDED   CODE TO MOVE SPACE TO DTL-SKU-SPACE2-1.                *08740099
087300* REPLACED CODE TO MOVE VALUE OF PURITM-SKU-SEQ-NBR TO           *08750099
087400* DTL-SKU-SEQ WITH A MOVE VALUE OF PV-TEMP-SEQ-NBR TO            *08760099
087500* DTL-SKU-SEQ.                                                   *08770099
087600*                                                                *08780099
087700* DELETED CODE TO MOVE DASH TO DTL1A-SKU-DASH1-1.                *08790099
087800* ADDED   CODE TO MOVE SPACE TO DTL1A-SKU-SPACE1-1.              *08800099
087900* DELETED CODE TO MOVE DASH TO DTL1A-SKU-DASH2-1.                *08810099
088000* ADDED   CODE TO MOVE SPACE TO DTL1A-SKU-SPACE2-1.              *08820099
088100* REPLACED CODE TO MOVE VALUE OF PURITM-SKU-SEQ-NBR TO           *08830099
088200* DTL1A-SKU-SEQ WITH A MOVE VALUE OF PV-TEMP-SEQ-NBR TO          *08840099
088300* DTL1A-SKU-SEQ.                                                 *08850099
088400*----------------------------------------------------------------*08860099
088500                                                                  08870099
088600 2800-FORMAT-DETAIL-1.                                            08880099
088700                                                                  08890099
088800     INITIALIZE DETAIL-LINE-1.                                    08900099
088900                                                                  08910099
089000     IF  PV-CURR-MERGE-KEY = PV-PREV-MERGE-KEY                    08920099
089100         IF  RC034-REC-TYPE-ADJ                                   08930099
089200             MOVE SPACES TO DTL-PO                                08940099
089300                            DTL-DASH-1                            08950099
089400                            DTL-RCVR-SEQ                          08960099
089500                            DTL-REC-LOC                           08970099
089600                            DTL-ADJ-DATE                          08980099
089700                            DTL-LINE                              08990099
089800                            DTL-SKU                               09000099
089900             PERFORM 2850-WRITE-DETAIL-1                          09010099
090000         ELSE                                                     09020099
090100             NEXT SENTENCE                                        09030099
090200     ELSE                                                         09040099
090300         IF  PV-CURR-MERGE-PO = PV-PREV-MERGE-PO                  09050099
090400         AND PV-CURR-MERGE-REC = PV-PREV-MERGE-REC                09060099
090500             IF  RC034-REC-TYPE-ADJ                               09070099
090600                 MOVE SPACES TO DTL-PO                            09080099
090700                                DTL-DASH-1                        09090099
090800                                DTL-RCVR-SEQ                      09100099
090900                                DTL-REC-LOC                       09110099
091000                                DTL-ADJ-DATE                      09120099
091100                 MOVE RC034-ORD-LNE-NBR  TO                       09130099
091200                      PV-CNVRT-PO-LNE-NBR                         09140099
091300                 MOVE PV-CNVRT-PO-LNE-NBR TO                      09150099
091400                      DTL-LINE                                    09160099
091500                 MOVE PURCHS-DEPT-NBR    TO                       09170099
091600                      DTL-SKU-DPT                                 09180099
091700                 MOVE SPACE              TO                       09190099
091800                      DTL-SKU-SPACE1-1                            09200099
091900                 MOVE PURITM-CL-NBR      TO                       09210099
092000                      DTL-SKU-CLN                                 09220099
092100                 MOVE SPACE              TO                       09230099
092200                      DTL-SKU-SPACE2-1                            09240099
092300                 MOVE PV-TEMP-SEQ-NBR    TO                       09250099
092400                      DTL-SKU-SEQ                                 09260099
092500                 PERFORM 2850-WRITE-DETAIL-1                      09270099
092600             ELSE                                                 09280099
092700                 INITIALIZE DETAIL-LINE-1A                        09290099
092800                 MOVE RC034-ORD-LNE-NBR  TO                       09300099
092900                      PV-CNVRT-PO-LNE-NBR                         09310099
093000                 MOVE PV-CNVRT-PO-LNE-NBR TO                      09320099
093100                      DTL1A-LINE                                  09330099
093200                 MOVE PURCHS-DEPT-NBR    TO                       09340099
093300                      DTL1A-SKU-DPT                               09350099
093400                 MOVE SPACE              TO                       09360099
093500                      DTL1A-SKU-SPACE1-1                          09370099
093600                 MOVE PURITM-CL-NBR      TO                       09380099
093700                      DTL1A-SKU-CLN                               09390099
093800                 MOVE SPACE              TO                       09400099
093900                      DTL1A-SKU-SPACE2-1                          09410099
094000                 MOVE PV-TEMP-SEQ-NBR    TO                       09420099
094100                      DTL1A-SKU-SEQ                               09430099
094200                 MOVE 'N/A ' TO                                   09440099
094300                      DTL1A-STORE                                 09450099
094400                 WRITE RECV-REPORT-RECORD                         09460099
094500                   FROM DETAIL-LINE-1A                            09470099
094600                     AFTER ADVANCING 1 LINE                       09480099
094700                 ADD +1 TO PV-LINE-CNT                            09490099
094800         ELSE                                                     09500099
094900             IF  RC034-REC-TYPE-ADJ                               09510099
095000                 MOVE RC034-ORD-NBR TO                            09520099
095100                      PV-CNVRT-PO-NBR                             09530099
095200                 MOVE RC034-REC-SEQ-NBR TO                        09540099
095300                      PV-CNVRT-REC-SEQ-NBR                        09550099
095400                 MOVE PV-CNVRT-PO-NBR TO                          09560099
095500                      DTL-PO                                      09570099
095600                 MOVE PV-CNVRT-REC-SEQ-NBR TO                     09580099
095700                      DTL-RCVR-SEQ                                09590099
095800                 MOVE '-' TO DTL-DASH-1                           09600099
095900                 PERFORM 2720-SEARCH-FOR-DC                       09620099
096000                 IF PS-DC-FOUND                                   09660099
096100                    CONTINUE                                      09670099
096200                 ELSE                                             09680099
096300                    MOVE 'DS ' TO PV-HOLD-REC-LOC                 09690099
096400                    MOVE RECEIV-REC-TMST TO                       09700099
096500                         PV-SAVE-TIMESTAMP                        09710099
096600                 END-IF                                           09720099
096700                 MOVE PV-HOLD-REC-LOC         TO                  09730099
096800                      DTL-REC-LOC                                 09740099
096900                 MOVE PV-SAVE-YYYY            TO                  09750099
097000                      DTL-ADJ-YYY                                 09760099
097100                 MOVE PV-SAVE-MM              TO                  09770099
097200                      DTL-ADJ-MM                                  09780099
097300                 MOVE PV-SAVE-DD              TO                  09790099
097400                      DTL-ADJ-DD                                  09800099
097500                 MOVE '/'                     TO                  09810099
097600                      DTL-SLASH-1                                 09820099
097700                      DTL-SLASH-2                                 09830099
097800                 MOVE RC034-ORD-LNE-NBR  TO                       09840099
097900                      PV-CNVRT-PO-LNE-NBR                         09850099
098000                 MOVE PV-CNVRT-PO-LNE-NBR TO                      09860099
098100                      DTL-LINE                                    09870099
098200                 MOVE PURCHS-DEPT-NBR    TO                       09880099
098300                      DTL-SKU-DPT                                 09890099
098400                 MOVE SPACE              TO                       09900099
098500                      DTL-SKU-SPACE1-1                            09910099
098600                 MOVE PURITM-CL-NBR      TO                       09920099
098700                      DTL-SKU-CLN                                 09930099
098800                 MOVE SPACE              TO                       09940099
098900                      DTL-SKU-SPACE2-1                            09950099
099000                 MOVE PV-TEMP-SEQ-NBR    TO                       09960099
099100                      DTL-SKU-SEQ                                 09970099
099200                 PERFORM 2850-WRITE-DETAIL-1                      09980099
099300             ELSE                                                 09990099
099400                 INITIALIZE DETAIL-LINE-1A                        10000099
099500                 MOVE RC034-ORD-NBR TO                            10010099
099600                      PV-CNVRT-PO-NBR                             10020099
099700                 MOVE RC034-REC-SEQ-NBR TO                        10030099
099800                      PV-CNVRT-REC-SEQ-NBR                        10040099
099900                 MOVE PV-CNVRT-PO-NBR TO                          10050099
100000                      DTL1A-PO                                    10060099
100100                 MOVE PV-CNVRT-REC-SEQ-NBR TO                     10070099
100200                      DTL1A-RCVR-SEQ                              10080099
100300                 MOVE '-' TO DTL1A-DASH-1                         10090099
100400                 PERFORM 2720-SEARCH-FOR-DC                       10110099
100500                 IF PS-DC-FOUND                                   10150099
100600                    CONTINUE                                      10160099
100700                 ELSE                                             10170099
100800                    MOVE 'DS ' TO PV-HOLD-REC-LOC                 10180099
100900                    MOVE RECEIV-REC-TMST TO                       10190099
101000                         PV-SAVE-TIMESTAMP                        10200099
101100                 END-IF                                           10210099
101200                 MOVE PV-HOLD-REC-LOC         TO                  10220099
101300                      DTL1A-REC-LOC                               10230099
101400                 MOVE PV-SAVE-YYYY            TO                  10240099
101500                      DTL1A-ADJ-YYY                               10250099
101600                 MOVE PV-SAVE-MM              TO                  10260099
101700                      DTL1A-ADJ-MM                                10270099
101800                 MOVE PV-SAVE-DD              TO                  10280099
101900                      DTL1A-ADJ-DD                                10290099
102000                 MOVE '/'                     TO                  10300099
102100                      DTL1A-SLASH-1                               10310099
102200                      DTL1A-SLASH-2                               10320099
102300                 MOVE RC034-ORD-LNE-NBR  TO                       10330099
102400                      PV-CNVRT-PO-LNE-NBR                         10340099
102500                 MOVE PV-CNVRT-PO-LNE-NBR TO                      10350099
102600                      DTL1A-LINE                                  10360099
102700                 MOVE PURCHS-DEPT-NBR    TO                       10370099
102800                      DTL1A-SKU-DPT                               10380099
102900                 MOVE SPACE              TO                       10390099
103000                      DTL1A-SKU-SPACE1-1                          10400099
103100                 MOVE PURITM-CL-NBR      TO                       10410099
103200                      DTL1A-SKU-CLN                               10420099
103300                 MOVE SPACE              TO                       10430099
103400                      DTL1A-SKU-SPACE2-1                          10440099
103500                 MOVE PV-TEMP-SEQ-NBR    TO                       10450099
103600                      DTL1A-SKU-SEQ                               10460099
103700                 MOVE 'N/A ' TO                                   10470099
103800                      DTL1A-STORE                                 10480099
103900                 WRITE RECV-REPORT-RECORD                         10490099
104000                   FROM DETAIL-LINE-1A                            10500099
104100                     AFTER ADVANCING 2 LINES                      10510099
104200                 ADD +2 TO PV-LINE-CNT.                           10520099
104300                                                                  10530099
104400*----------------------------------------------------------------*10540099
104500* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *10550099
104600*----------------------------------------------------------------*10560099
104700                                                                  10570099
104800 2850-WRITE-DETAIL-1.                                             10580099
104900                                                                  10590099
105000     MOVE RC034-STR-NBR TO                                        10600099
105100          PV-CNVRT-STORE-NBR.                                     10610099
105200     MOVE PV-CNVRT-STORE-NBR TO                                   10620099
105300          DTL-STORE.                                              10630099
105400     MOVE RC034-ADJ-ITM-QTY       TO                              10640099
105500          DTL-ADJ-UNITS-NET.                                      10650099
105600     MOVE RC034-B4-ITM-QTY        TO                              10660099
105700          DTL-ADJ-UNITS-B4.                                       10670099
105800     MOVE RC034-AFT-ITM-QTY       TO                              10680099
105900          DTL-ADJ-UNITS-AFT.                                      10690099
106000     MOVE RC034-ADJ-COST-EXTN-AMT TO                              10700099
106100          DTL-ADJ-COST.                                           10710099
106200     MOVE RC034-ADJ-RTL-EXTN-AMT  TO                              10720099
106300          DTL-ADJ-RETAIL.                                         10730099
106400                                                                  10740099
106500     IF  DTL-PO EQUAL SPACES                                      10750099
106600         WRITE RECV-REPORT-RECORD                                 10760099
106700           FROM DETAIL-LINE-1                                     10770099
106800             AFTER ADVANCING 1 LINE                               10780099
106900         ADD +1 TO PV-LINE-CNT                                    10790099
107000     ELSE                                                         10800099
107100         WRITE RECV-REPORT-RECORD                                 10810099
107200           FROM DETAIL-LINE-1                                     10820099
107300             AFTER ADVANCING 2 LINES                              10830099
107400         ADD +2 TO PV-LINE-CNT                                    10840099
107500     END-IF.                                                      10850099
107600                                                                  10860099
107700 3000-WRITE-STORE-LIST.                                           10870099
107800                                                                  10880099
107900     IF  RC034-STR-NBR = PV-PREV-STR-NBR                          10890099
108000         NEXT SENTENCE                                            10900099
108100     ELSE                                                         10910099
108200         ADD +1 TO PV-STORE-COUNT                                 10920099
108300         MOVE RC034-STR-NBR TO PV-PREV-STR-NBR                    10930099
108400         IF  PS-STORE-LIST-SHORT-DONE                             10940099
108500             MOVE RC034-STR-NBR TO PV-CNVRT-STORE-NBR             10950099
108600             IF  PV-STORE-COUNT = 1                               10960099
108700                 CONTINUE                                         10970099
108800             ELSE                                                 10980099
108900                 MOVE ',' TO                                      10990099
109000                      DTL-COMMA2 (CMT2-NDX - 1)                   11000099
109100             END-IF                                               11010099
109200             MOVE PV-CNVRT-STORE-NBR TO                           11020099
109300                  DTL-STR-CMT2 (CMT2-NDX)                         11030099
109400             IF  PV-STORE-COUNT = 18                              11040099
109500                 WRITE RECV-REPORT-RECORD                         11050099
109600                  FROM DETAIL-COMMENTS-LINE2                      11060099
109700                  AFTER ADVANCING 1 LINE                          11070099
109800                 ADD +1 TO PV-LINE-CNT                            11080099
109900                 MOVE ZEROS TO PV-STORE-COUNT                     11090099
110000                 SET CMT2-NDX TO 1                                11100099
110100                 INITIALIZE DETAIL-COMMENTS-LINE2                 11110099
110200             ELSE                                                 11120099
110300                 SET CMT2-NDX UP BY 1                             11130099
110400             END-IF                                               11140099
110500         ELSE                                                     11150099
110600             MOVE RC034-STR-NBR TO PV-CNVRT-STORE-NBR             11160099
110700             IF  PV-STORE-COUNT = 1                               11170099
110800                 CONTINUE                                         11180099
110900             ELSE                                                 11190099
111000                 MOVE ',' TO                                      11200099
111100                      DTL-COMMA1 (CMT1-NDX - 1)                   11210099
111200             END-IF                                               11220099
111300             MOVE PV-CNVRT-STORE-NBR TO                           11230099
111400                  DTL-STR-CMT1 (CMT1-NDX)                         11240099
111500             IF  PV-STORE-COUNT = 9                               11250099
111600                 WRITE RECV-REPORT-RECORD                         11260099
111700                  FROM DETAIL-COMMENTS-LINE1                      11270099
111800                  AFTER ADVANCING 2 LINES                         11280099
111900                 ADD +2 TO PV-LINE-CNT                            11290099
112000                 SET PS-STORE-LIST-SHORT-DONE TO TRUE             11300099
112100                 MOVE ZEROS TO PV-STORE-COUNT                     11310099
112200             ELSE                                                 11320099
112300                 SET CMT1-NDX UP BY 1                             11330099
112400             END-IF                                               11340099
112500         END-IF.                                                  11350099
112600                                                                  11360099
112700     PERFORM 7100-READ-MERGE-FILE.                                11370099
112800                                                                  11380099
112900*---------------------------------------------------------------* 11390099
113000*                                              ** WR # 21361    * 11400099
113100* ADDED CODE TO RETRIEVE ITEM NUMBER FROM TPURITM TABLE.        * 11410099
113200*---------------------------------------------------------------* 11420099
113300 3200-GET-PO-LINE-INFO.                                           11430099
113400                                                                  11440099
113500     SET PS-CALL-API-NO TO TRUE                                   11450099
113600                                                                  11460099
113700     EXEC SQL                                                     11470099
113800          SELECT                                                  11480099
113900                 D.CURR_OPER_UNT_ID                               11490099
114000               , D.CURR_FCLTY_ID                                  11500099
114100               , D.REC_TMST                                       11510099
114200               , D.VERFYD_TMST                                    11520099
114300               , A.DEPT_NBR                                       11530099
114400               , B.CL_NBR                                         11540099
114500               , B.SKU_SEQ_NBR                                    11550099
114600               , B.ITM_NBR                                        11560099
114700         INTO                                                     11570099
114800                :RECEIV-CURR-OPER-UNT-ID                          11580099
114900               ,:RECEIV-CURR-FCLTY-ID                             11590099
115000               ,:RECEIV-REC-TMST                                  11600099
115100               ,:RECEIV-VERFYD-TMST                               11610099
115200               ,:PURCHS-DEPT-NBR                                  11620099
115300               ,:PURITM-CL-NBR                                    11630099
115400               ,:PURITM-SKU-SEQ-NBR                               11640099
115500               ,:PURITM-ITM-NBR                                   11650099
115600         FROM   TPURCHS A                                         11660099
115700               ,TPURITM B                                         11670099
115800               ,TRECITM C                                         11680099
115900               ,TRECEIV D                                         11690099
116000           WHERE A.PO_NBR         = :PV-CURR-MERGE-PO             11700099
116100             AND A.VER_STATUS_CDE = 'A'                           11710099
116200             AND A.PO_NBR         = B.PO_NBR                      11720099
116300             AND A.PO_NBR         = C.ORD_NBR                     11730099
116400             AND A.PO_NBR         = D.ORD_NBR                     11740099
116500             AND B.APP_PO_LNE_NBR = :PV-CURR-MERGE-LINE           11750099
116600             AND C.ORD_LNE_NBR    = B.APP_PO_LNE_NBR              11760099
116700             AND C.VER_STATUS_CDE = 'A'                           11770099
116800             AND C.REC_SEQ_NBR    = :PV-CURR-MERGE-REC            11780099
116900             AND C.PO_VER_NBR     = B.VER_NBR                     11790099
117000             AND D.REC_SEQ_NBR    = C.REC_SEQ_NBR                 11800099
117100     END-EXEC.                                                    11810099
117200                                                                  11820099
117300     EVALUATE TRUE                                                11830099
117400         WHEN SQLCODE = +0                                        11840099
117500              SET PS-CALL-API-YES TO TRUE                         11850099
117600              CONTINUE                                            11860099
117700         WHEN SQLCODE = +100                                      11870099
117800              DISPLAY 'INFO NOT FOUND IN 3200'                    11880099
117900              MOVE PV-CURR-MERGE-PO TO                            11890099
118000                   PV-DISP-PO-NBR                                 11900099
118100              MOVE PV-CURR-MERGE-LINE TO                          11910099
118200                   PV-DISP-PO-LNE-NBR                             11920099
118300              MOVE PV-CURR-MERGE-REC TO                           11930099
118400                   PV-DISP-REC-SEQ-NBR                            11940099
118500              DISPLAY 'INFO KEY '                                 11950099
118600                   PV-DISP-PO-NBR                                 11960099
118700                   ' / '                                          11970099
118800                   PV-DISP-PO-LNE-NBR                             11980099
118900                   ' / '                                          11990099
119000                   PV-DISP-REC-SEQ-NBR                            12000099
119100         WHEN SQLWARN0 NOT = SPACES                               12010099
119200         WHEN SQLCODE < +0                                        12020099
119300         WHEN SQLCODE > +0                                        12030099
119400              MOVE '3200-GET-PO-LINE-INFO'                        12040099
119500                                 TO PV-PARAGRAPH-NAME             12050099
119600              MOVE 'UNSUCCESSFUL SELECT ON PO ITEM'               12060099
119700                                 TO PV-DB2-OPERATION-ATTEMPTED    12070099
119800              PERFORM 9100-SQL-ABEND                              12080099
119900     END-EVALUATE.                                                12090099
120000 EJECT                                                            12100099
120100*----------------------------------------------------------------*12110099
120200* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *12120099
120300*----------------------------------------------------------------*12130099
120400*----------------------------------------------------------------*12140099
120500*                                               **   WR # 21361  *12150099
120600* CODE FOR ACCESSING LOGISTICS DOMAIN ITEM ACCESS MODULE         *12160099
120700*----------------------------------------------------------------*12170099
120800 3205-CALL-XLKUT-DOMAIN-PGM.                                      12180099
120900                                                                  12190099
121000     INITIALIZE XL001-ITEM-COMMAREA                               12200099
121100                PV-TEMP-SEQ-NBR.                                  12210099
121200                                                                  12220099
121300     MOVE PURITM-ITM-NBR            TO XL001-KEY-ITM-NBR.         12230099
121400                                                                  12240099
121500     SET  XL001-BY-ITEM                                           12250099
121600          XL001-SELECT-SKU          TO TRUE.                      12260099
121700                                                                  12270099
121800     CALL XL001-VSM-PGM USING  XL001-ITEM-COMMAREA.               12280099
121900                                                                  12290099
122000     EVALUATE TRUE                                                12300099
122100         WHEN XL001-SUCCESSFUL                                    12310099
122200               MOVE XL001-SKU-NBR   TO PV-TEMP-SEQ-NBR            12320099
122300                                                                  12330099
122400         WHEN XL001-SKU-SQLCODE = +100                            12340099
122500               MOVE ZEROES          TO PV-TEMP-SEQ-NBR            12350099
122600                                                                  12360099
122700         WHEN XL001-SKU-CONTENTION                                12370099
122800               MOVE '3205-CALL-XLKUT-DOMAIN-PGM'                  12380099
122900                                    TO PV-PARAGRAPH-NAME          12390099
123000               MOVE 'SKU CONTENTION'                              12400099
123100                                    TO PV-ABEND-MESSAGE-TEXT      12410099
123200               MOVE XL001-SKU-SQLCODE                             12420099
123300                                    TO PV-SQLCODE                 12430099
123400               MOVE 'XLV_SKU'       TO PV-DB2-VIEW-NAME           12440099
123500               MOVE XL001-SQLCA     TO SQLCA                              
123600               PERFORM 9200-PROCESS-ABEND                         12450099
123700                                                                  12460099
123800         WHEN OTHER                                               12470099
123900               MOVE '3205-CALL-XLKUT-DOMAIN-PGM'                  12380099
124000                                    TO PV-PARAGRAPH-NAME          12490099
124100               MOVE 'SELECT ROW FROM XLV_SKU'                     12500099
124200                                    TO PV-ABEND-MESSAGE-TEXT      12510099
124300               MOVE XL001-SKU-SQLCODE                             12520099
124400                                    TO PV-SQLCODE                 12530099
124500               MOVE 'XLV_SKU'       TO PV-DB2-VIEW-NAME           12540099
124600               MOVE XL001-SQLCA     TO SQLCA                              
124700               PERFORM 9200-PROCESS-ABEND                         12550099
124800                                                                  12560099
124900     END-EVALUATE.                                                12570099
125000*----------------------------------------------------------------*12580099
125100* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *12590099
125200*----------------------------------------------------------------*12600099
125300 3300-GET-PO-INFO.                                                12610099
125400                                                                  12620099
125500     EXEC SQL                                                     12630099
125600          SELECT                                                  12640099
125700                 D.CURR_OPER_UNT_ID                               12650099
125800               , D.CURR_FCLTY_ID                                  12660099
125900               , D.REC_TMST                                       12670099
126000               , D.VERFYD_TMST                                    12680099
126100               , A.DEPT_NBR                                       12690099
126200         INTO                                                     12700099
126300                :RECEIV-CURR-OPER-UNT-ID                          12710099
126400               ,:RECEIV-CURR-FCLTY-ID                             12720099
126500               ,:RECEIV-REC-TMST                                  12730099
126600               ,:RECEIV-VERFYD-TMST                               12740099
126700               ,:PURCHS-DEPT-NBR                                  12750099
126800         FROM   TPURCHS A                                         12760099
126900               ,TRECEIV D                                         12770099
127000           WHERE A.PO_NBR         = :PV-CURR-MERGE-PO             12780099
127100             AND A.VER_STATUS_CDE = 'A'                           12790099
127200             AND A.PO_NBR         = D.ORD_NBR                     12800099
127300             AND D.REC_SEQ_NBR    = :PV-CURR-MERGE-REC            12810099
127400             AND D.VER_STATUS_CDE = 'A'                           12820099
127500     END-EXEC.                                                    12830099
127600                                                                  12840099
127700     EVALUATE TRUE                                                12850099
127800         WHEN SQLCODE = +0                                        12860099
127900              CONTINUE                                            12870099
128000         WHEN SQLCODE = +100                                      12880099
128100              DISPLAY 'INFO NOT FOUND IN 3300'                    12890099
128200              MOVE PV-CURR-MERGE-PO TO                            12900099
128300                   PV-DISP-PO-NBR                                 12910099
128400              MOVE PV-CURR-MERGE-LINE TO                          12920099
128500                   PV-DISP-PO-LNE-NBR                             12930099
128600              MOVE PV-CURR-MERGE-REC TO                           12940099
128700                   PV-DISP-REC-SEQ-NBR                            12950099
128800              DISPLAY 'INFO KEY '                                 12960099
128900                   PV-DISP-PO-NBR                                 12970099
129000                   ' / '                                          12980099
129100                   PV-DISP-PO-LNE-NBR                             12990099
129200                   ' / '                                          13000099
129300                   PV-DISP-REC-SEQ-NBR                            13010099
129400         WHEN SQLWARN0 NOT = SPACES                               13020099
129500         WHEN SQLCODE < +0                                        13030099
129600         WHEN SQLCODE > +0                                        13040099
129700              MOVE '3300-GET-PO-INFO'                             13050099
129800                                 TO PV-PARAGRAPH-NAME             13060099
129900              MOVE 'UNSUCCESSFUL SELECT ON PO/RCVR'               13070099
130000                                 TO PV-DB2-OPERATION-ATTEMPTED    13080099
130100              PERFORM 9100-SQL-ABEND                              13090099
130200     END-EVALUATE.                                                13100099
130300 EJECT                                                            13110099
130400******************************************************************13120099
130500 7000-OPEN-STR-NBR-CSR.                                           13130099
130600******************************************************************13140099
130700                                                                  13150099
130800     EXEC SQL                                                     13160099
130900         OPEN STR-NBR-CSR                                         13170099
131000     END-EXEC.                                                    13180099
131100                                                                  13190099
131200     EVALUATE TRUE                                                13200099
131300         WHEN SQLCODE = ZERO                                      13210099
131400             CONTINUE                                             13220099
131500         WHEN SQLWARN0 NOT = SPACE                                13230099
131600         WHEN SQLCODE < ZERO                                      13240099
131700         WHEN SQLCODE > ZERO                                      13250099
131800             MOVE '7000-OPEN-STR-NBR-CSR'                         13260099
131900                                 TO PV-PARAGRAPH-NAME             13270099
132000             MOVE 'ERROR ON OPEN OF STORE-CURSOR'                 13280099
132100                                 TO PV-DB2-OPERATION-ATTEMPTED    13290099
132200             PERFORM 9100-SQL-ABEND                               13300099
132300     END-EVALUATE.                                                13310099
132400*                                                                 13320099
132500 EJECT                                                            13330099
132600******************************************************************13340099
132700 7010-FETCH-STR-NBR-CSR.                                          13350099
132800******************************************************************13360099
132900     INITIALIZE XLT00010-LOC-NBR                                  13370099
133000                XLT00010-LOC-5-ABBR-NM                            13380099
133100                                                                  13390099
133200     EXEC SQL                                                     13400099
133300         FETCH  STR-NBR-CSR                                       13410099
133400          INTO  :XLT00010-LOC-NBR                                 13420099
133500             ,  :XLT00010-LOC-5-ABBR-NM                           13430099
133600     END-EXEC.                                                    13440099
133700                                                                  13450099
133800     EVALUATE TRUE                                                13460099
133900         WHEN SQLCODE = ZERO                                      13470099
134000         WHEN SQLCODE = +100                                      13480099
134100             CONTINUE                                             13490099
134200         WHEN SQLWARN0 NOT = SPACE                                13500099
134300         WHEN SQLCODE < ZERO                                      13510099
134400         WHEN SQLCODE > ZERO                                      13520099
134500             MOVE '7010-FETCH-STR-NBR-CSR'                        13530099
134600                 TO PV-PARAGRAPH-NAME                             13540099
134700             MOVE 'ATTEMPTING TO FETCH A ROW OF THE RESULTS TABLE 13550099
134800-                 'FROM THE STR-NBR-CSR'                          13560099
134900                              TO  PV-DB2-OPERATION-ATTEMPTED      13570099
135000             PERFORM 9100-SQL-ABEND                               13580099
135100     END-EVALUATE.                                                13590099
135200 EJECT                                                            13600099
135300******************************************************************13610099
135400 7020-CLOSE-STR-NBR-CSR.                                          13620099
135500******************************************************************13630099
135600                                                                  13640099
135700     EXEC SQL                                                     13650099
135800         CLOSE STR-NBR-CSR                                        13660099
135900     END-EXEC.                                                    13670099
136000                                                                  13680099
136100     EVALUATE TRUE                                                13690099
136200         WHEN SQLCODE = ZERO                                      13700099
136300             CONTINUE                                             13710099
136400         WHEN SQLWARN0 NOT = SPACE                                13720099
136500         WHEN SQLCODE < ZERO                                      13730099
136600         WHEN SQLCODE > ZERO                                      13740099
136700             MOVE '7020-CLOSE-STR-NBR-CSR'                        13750099
136800                                 TO PV-PARAGRAPH-NAME             13760099
136900             MOVE 'ATTEMPTING TO CLOSE STR-NBR-CSR'               13770099
137000                                 TO PV-DB2-OPERATION-ATTEMPTED    13780099
137100             PERFORM 9100-SQL-ABEND                               13790099
137200     END-EVALUATE.                                                13800099
137300 EJECT                                                            13810099
137400******************************************************************13820099
137500*  READ THE MERGE FILE.                                          *13830099
137600******************************************************************13840099
137700 7100-READ-MERGE-FILE.                                            13850099
137800                                                                  13860099
137900     READ MERGE-FILE INTO RC034-ADJUST-COMBINE-RECORD             13870099
138000         AT END                                                   13880099
138100           SET PS-EOF-MERGE TO TRUE                               13890099
138200         NOT AT END                                               13900099
138300           MOVE RC034-ORD-NBR          TO PV-CURR-MERGE-PO        13910099
138400           MOVE RC034-REC-SEQ-NBR      TO PV-CURR-MERGE-REC       13920099
138500           MOVE RC034-ORD-LNE-NBR      TO PV-CURR-MERGE-LINE      13930099
138600           MOVE RC034-STR-NBR          TO PV-SAVE-REC-LOC-CODE    13940099
138700           MOVE RC034-UPD-TMST         TO PV-SAVE-TIMESTAMP       13950099
138800     END-READ.                                                    13960099
138900 EJECT                                                            13970099
139000******************************************************************13980099
139100 8000-PRINT-HEADINGS.                                             13990099
139200******************************************************************14000099
139300                                                                  14010099
139400     ADD 1                        TO PV-PAGE-CNT.                 14020099
139500                                                                  14030099
139600     MOVE PV-PAGE-CNT             TO DP132O-PAGE-NUMBER.          14040099
139700                                                                  14050099
139800     MOVE PC-REPORT-NBR-1        TO DP132O-REPORT-NUMBER.         14060099
139900                                                                  14070099
140000     WRITE RECV-REPORT-RECORD                                     14080099
140100       FROM DP132O-STANDRD-HEADER-132-COLS                        14090099
140200         AFTER ADVANCING PAGE.                                    14100099
140300                                                                  14110099
140400     WRITE RECV-REPORT-RECORD                                     14120099
140500       FROM HEADING-LINE-0                                        14130099
140600         AFTER ADVANCING 2 LINES.                                 14140099
140700     MOVE 2                       TO PV-LINE-CNT.                 14150099
140800                                                                  14160099
140900     WRITE RECV-REPORT-RECORD                                     14170099
141000       FROM HEADING-LINE-1                                        14180099
141100         AFTER ADVANCING 1 LINE.                                  14190099
141200     ADD +1                       TO PV-LINE-CNT.                 14200099
141300                                                                  14210099
141400     WRITE RECV-REPORT-RECORD                                     14220099
141500       FROM HEADING-LINE-2                                        14230099
141600         AFTER ADVANCING 1 LINES.                                 14240099
141700     ADD +1                       TO PV-LINE-CNT.                 14250099
141800                                                                  14260099
141900     WRITE RECV-REPORT-RECORD                                     14270099
142000       FROM HEADING-LINE-3                                        14280099
142100         AFTER ADVANCING 2 LINES.                                 14290099
142200     ADD +2                       TO PV-LINE-CNT.                 14300099
142300                                                                  14310099
142400     WRITE RECV-REPORT-RECORD                                     14320099
142500       FROM HEADING-LINE-4                                        14330099
142600         AFTER ADVANCING 1 LINES.                                 14340099
142700     ADD +1                       TO PV-LINE-CNT.                 14350099
142800                                                                  14360099
142900     WRITE RECV-REPORT-RECORD                                     14370099
143000       FROM BLANK-LINE                                            14380099
143100         AFTER ADVANCING 1 LINE.                                  14390099
143200     ADD +1 TO PV-LINE-CNT.                                       14400099
143300 EJECT                                                            14410099
143400******************************************************************14420099
143500* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      14430099
143600* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 14440099
143700******************************************************************14450099
143800 9100-SQL-ABEND.                                                  14460099
143900         DISPLAY '9100-SQL-ABEND       STARTING'.                 14470099
144000     DISPLAY '** ABEND     **'.                                   14480099
144100     DISPLAY '** PROGRAM   ** = RCKRP020'.                        14490099
144200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              14500099
144300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     14510099
144400                                                                  14520099
144500******************************************************************14530099
144600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    14540099
144700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         14550099
144800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     14560099
144900* FORMAT.                                                         14570099
145000******************************************************************14580099
145100     COPY DPPD004.                                                14600099
145200                                                                  14610099
145300     MOVE +4013 TO ABEND-CODE.                                    14620099
145400     CALL 'ILBOABN0' USING ABEND-CODE.                            14630099
145500*----------------------------------------------------------------*14640099
145600*                                               ** WR # 21361    *14650099
145700* ADDED CODE TO DISPLAY MESSAGES,WHEN ABEND OCCURS FROM          *14660099
145800* LOGISTICS DOMAIN ITEM ACCESS MODULE.                           *14670099
145900*----------------------------------------------------------------*14680099
146000 9200-PROCESS-ABEND.                                              14690099
146100                                                                  14700099
146200     DISPLAY '** ABEND **       ** = SQLERROR'.                   14710099
146300     DISPLAY '** PROGRAM        ** = RCKRP020'.                   14720099
146400     DISPLAY '** ABEND PARAGRAPH **  ' PV-PARAGRAPH-NAME.         14730099
146500     DISPLAY '** ERROR MESSAGE   **  ' PV-ABEND-MESSAGE-TEXT.     14740099
146600     DISPLAY '** SQLCODE         **  ' PV-SQLCODE.                14750099
146700     DISPLAY '** VIEW  NAME      **  ' PV-DB2-VIEW-NAME.          14760099
146800     COPY DPPD004.                                                        
146900     MOVE +4013 TO ABEND-CODE.                                    14770099
147000     CALL 'ILBOABN0' USING ABEND-CODE.                            14780099
147100*----------------------------------------------------------------*14790099
147200* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *14800099
147300*----------------------------------------------------------------*14810099
