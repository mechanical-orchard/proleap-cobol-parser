000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    APKUT110.                                         00020000
000300 AUTHOR.        KRYSTEN LEARY.                                    00030000
000400 DATE-WRITTEN.  SEPTEMBER 2006.                                   00040001
000500***************************************************************** 00050000
000600* VENDOR POSTAL INFORMATION FOR STATE TAX AUDIT                 * 00060020
000700*---------------------------------------------------------------* 00070000
000800* COBOL WITH SQL                                                * 00080020
000900*---------------------------------------------------------------* 00090000
001000*  PURPOSE: THIS PROGRAM WILL READ IN AN INPUT FILE THAT        * 00100001
001100*  CONTAINS STATE TAX AUDIT INFORMATION.  VENDOR POSTAL         * 00110020
001200*  INFORMATION WILL BE OBTAINED FROM LEGACY TABLES BASED ON THE * 00120020
001300*  VENDOR ID FROM THE INPUT FILE.                               * 00130020
001400*---------------------------------------------------------------* 00140000
001500*  INPUT:                                                       * 00150000
001600*    1. EXTERNAL ENTERPRISE TABLE                  (TEXTENT)    * 00160001
001700*    2. EXTERNAL ENTERPRISE NAME TABLE             (TENTNME)    * 00170001
001800*    3. BUSINESS LOCATION TABLE                    (TBUSLOC)    * 00180001
001900*                                                               * 00190000
002000*  OUTPUT:                                                      * 00200000
002100*    1. STATE TAX AUDIT VENDOR INFORMATION         (APRD110)    * 00210001
002200*---------------------------------------------------------------* 00220000
002300* CHANGES:                                                      * 00230000
002400*                                                               * 00240000
002500*  09/11/2006                                                   * 00250021
002600*      INITIAL IMPLEMENTATION.                                  * 00260000
002700*  MADE BY: KRYSTEN LEARY                   WR#: 31152          * 00270001
002800*                                                               * 00280023
002900*  DATE  01/08/2010                                             * 00290023
003000*      CHANGE MADE: RECOMPLIED TO PICK CHANGE TO APRD216.       * 00300023
003100*      MADE BY: MIKE BESKE              WR/IR #: WR37785        * 00310023
003110*                                                               * 00311027
003120*  DATE  06/14/2013                                             * 00312027
003130*      CHANGE MADE: CHANGED LRECL ON FILE USING APRD216.        * 00313027
003140*      MADE BY: NANCY EILBES            WR/IR #: CH0055677      * 00314027
003200***************************************************************** 00320023
003300                                                                  00330000
003400 ENVIRONMENT DIVISION.                                            00340000
003500 INPUT-OUTPUT SECTION.                                            00350000
003600 FILE-CONTROL.                                                    00360000
003700                                                                  00370000
003800     SELECT STATE-TAX-AUDIT-FILE        ASSIGN TO INP01.          00380001
003900     SELECT VENDOR-INFO-FILE            ASSIGN TO OUT01.          00390001
004000                                                                  00400000
004100 DATA DIVISION.                                                   00410000
004200 FILE SECTION.                                                    00420000
004300                                                                  00430000
004400 FD  STATE-TAX-AUDIT-FILE                                         00440001
004500     LABEL RECORDS ARE OMITTED                                    00450000
004600     RECORDING MODE IS F                                          00460000
004700     RECORD CONTAINS 325 CHARACTERS                               00470026
004800     BLOCK CONTAINS 0 RECORDS.                                    00480000
004900 01  STATE-TAX-AUDIT-RECORD          PIC X(325).                  00490026
005000                                                                  00500000
005100 FD  VENDOR-INFO-FILE                                             00510001
005200     LABEL RECORDS ARE STANDARD                                   00520000
005300     RECORDING MODE IS F                                          00530000
005400     BLOCK CONTAINS 0 RECORDS.                                    00540000
005500 01  VENDOR-INFO-RECORD              PIC X(175).                  00550015
005600                                                                  00560000
005700 WORKING-STORAGE SECTION.                                         00570000
005800*----------------------------------------------------------------*00580000
005900* SQLCA FORMATTED MESSAGE AREA                                   *00590000
006000*----------------------------------------------------------------*00600000
006100     COPY DPWS004.                                                00610000
006200                                                                  00620000
006300*----------------------------------------------------------------*00630000
006400* RECORD LAYOUT FOR OUTPUT VENDOR INFORMATION FILE               *00640001
006500*----------------------------------------------------------------*00650000
006600     COPY APRD110.                                                00660001
006700                                                                  00670000
006800*--------------------------------------------------------------*  00680000
006900*  COMMUNICATIONS AREA2 FOR DB2                                *  00690000
007000*--------------------------------------------------------------*  00700000
007100     COPY SQLCA2.                                                 00710000
007200                                                                  00720000
007300 01  PROGRAM-CONSTANTS.                                           00730000
007400     05  PC-PROGRAM-NAME             PIC X(08) VALUE 'APKUT110'.  00740000
007500                                                                  00750000
007600 01  PC-COUNTERS.                                                 00760000
007700     05  PC-REC-READ-CNT           PIC 9(09)  VALUE ZERO.         00770000
007800     05  PC-REC-WRTTN-CNT          PIC 9(09)  VALUE ZERO.         00780000
007900                                                                  00790000
008000 01  PROGRAM-SWITCHES.                                            00800000
008100     05  INPUT-EOF-SW                PIC X  VALUE 'N'.            00810002
008200         88  INPUT-EOF                      VALUE 'Y'.            00820002
008300         88  INPUT-NOT-EOF                  VALUE 'N'.            00830002
008400     05  VENDOR-FOUND-SW             PIC X  VALUE 'N'.            00840006
008500         88  VENDOR-FOUND                   VALUE 'Y'.            00850006
008600         88  VENDOR-NOT-FOUND               VALUE 'N'.            00860006
008700     05  VENDOR-INFO-FOUND-SW        PIC X  VALUE 'N'.            00870006
008800         88  VENDOR-INFO-FOUND              VALUE 'Y'.            00880006
008900         88  VENDOR-INFO-NOT-FOUND          VALUE 'N'.            00890006
009000                                                                  00900000
009100 01  PROGRAM-VARIABLE-DATES.                                      00910000
009200     05  SYSTEM-DATE                 PIC 9(06)  VALUE ZERO.       00920003
009300     05  SYSTEM-TIME                 PIC 9(08)  VALUE ZERO.       00930001
009400                                                                  00940000
009500 01  PROGRAM-VARIABLES.                                           00950004
009600     05  PV-INPUT-AREA.                                           00960004
009700         10  FILLER                            PIC X(165).        00970026
009800         10  PV-INPUT-VENDOR-NBR               PIC X(09).         00980004
009900         10  PV-INPUT-VENDOR-NAME              PIC X(26).         00990026
012000         10  FILLER                            PIC X(125).        01200026
012100                                                                  01210004
012200*--------------------------------------------------------------*  01220000
012300* DB2 ABEND AREA                                               *  01230000
012400*--------------------------------------------------------------*  01240000
012500 01  ABEND-CODE               PIC S9(04) VALUE ZEROS  COMP SYNC.  01250000
012600     88  AC-DB2-ERROR                    VALUES +4013.            01260000
012700     88  AC-UNSUCCESSFUL-SELECT          VALUES +4015.            01270000
012800                                                                  01280000
012900 01  ABEND-AREAS.                                                 01290000
013000     05  AA-ABEND-LIT                   PIC X(40)  VALUE          01300000
013100             '*****       ABEND'.                                 01310000
013200     05  AA-PROGRAM-LIT                 PIC X(40)  VALUE          01320000
013300             '*****   PROGRAM: APKUT110'.                         01330000
013400     05  AA-PARAGRAPH-LIT.                                        01340000
013500         10  FILLER                     PIC X(17)  VALUE          01350000
013600             '***** PARAGRAPH: '.                                 01360000
013700         10  AA-PARAGRAPH-NAME          PIC X(35)  VALUE SPACES.  01370000
013800     05  AA-MESSAGE-LINE.                                         01380000
013900         10  FILLER                     PIC X(06)  VALUE '*****'. 01390000
014000         10  AA-MESSAGE                 PIC X(127) VALUE SPACES.  01400000
014100     05  AA-DB2-ERROR-LIT               PIC X(40)  VALUE          01410000
014200             '*****    DB2 ERROR'.                                01420000
014300     05  AA-DB2-OPERATION-LIT.                                    01430000
014400         10  FILLER                     PIC X(17)  VALUE          01440000
014500             '***** OPERATION: '.                                 01450000
014600         10  AA-DB2-OPERATION.                                    01460000
014700             15  AA-DB2-OP-1            PIC X(25)  VALUE SPACES.  01470000
014800             15  AA-DB2-OP-2            PIC X(25)  VALUE SPACES.  01480000
014900     05  AA-DB2-TABLE-1                 PIC X(15)  VALUE SPACES.  01490000
015000     05  AA-DB2-TABLE-2                 PIC X(15)  VALUE SPACES.  01500000
015100                                                                  01510000
015200*--------------------------------------------------------------*  01520000
015300* EXTERNAL ENTERPRISE TABLE                                    *  01530001
015400*--------------------------------------------------------------*  01540000
015500     EXEC SQL                                                     01550000
015600         INCLUDE TEXTENT                                          01560001
015700     END-EXEC.                                                    01570000
015800                                                                  01580000
015900*--------------------------------------------------------------*  01590000
016000* EXTERNAL ENTERPRISE NAME TABLE                               *  01600001
016100*--------------------------------------------------------------*  01610000
016200     EXEC SQL                                                     01620000
016300         INCLUDE TENTNME                                          01630001
016400     END-EXEC.                                                    01640000
016500                                                                  01650000
016600*--------------------------------------------------------------*  01660000
016700* BUSINESS LOCATION TABLE                                      *  01670001
016800*--------------------------------------------------------------*  01680000
016900     EXEC SQL                                                     01690000
017000         INCLUDE TBUSLOC                                          01700001
017100     END-EXEC.                                                    01710000
017200                                                                  01720000
017300*--------------------------------------------------------------*  01730000
017400* SQL COMMUNICATIONS AREA DCLGEN                               *  01740000
017500*--------------------------------------------------------------*  01750000
017600     EXEC SQL                                                     01760000
017700         INCLUDE SQLCA                                            01770000
017800     END-EXEC.                                                    01780000
017900                                                                  01790000
018000*----------------------*                                          01800000
018100 PROCEDURE DIVISION.                                              01810000
018200*----------------------*                                          01820000
018300 A100-MAINLINE-ROUTINE.                                           01830000
018400                                                                  01840000
018500     PERFORM B100-INITIALIZATION.                                 01850000
018600     PERFORM B200-PROCESS-AUDIT-FILE                              01860001
018700       UNTIL INPUT-EOF.                                           01870001
018800     PERFORM B300-END-OF-JOB.                                     01880000
018900     GOBACK.                                                      01890000
019000                                                                  01900000
019100*--------------------------------------------------------------*  01910000
019200* INITIALIZATION PROCESSING                                    *  01920000
019300*--------------------------------------------------------------*  01930000
019400 B100-INITIALIZATION.                                             01940000
019500                                                                  01950000
019600     ACCEPT SYSTEM-DATE FROM DATE.                                01960001
019700     ACCEPT SYSTEM-TIME FROM TIME.                                01970001
019800     DISPLAY 'RUN DATE = ' SYSTEM-DATE.                           01980001
019900     DISPLAY 'RUN TIME = ' SYSTEM-TIME.                           01990001
020000                                                                  02000000
020100     OPEN INPUT  STATE-TAX-AUDIT-FILE                             02010001
020200          OUTPUT VENDOR-INFO-FILE.                                02020001
020300                                                                  02030003
020400     INITIALIZE DCLTEXTENT                                        02040003
020500                DCLTENTNME                                        02050003
020600                DCLTBUSLOC                                        02060017
020700                AP110-STATE-AUDIT-RECORD.                         02070017
020800                                                                  02080003
020900     PERFORM R100-READ-INPUT-FILE.                                02090002
021000     IF INPUT-EOF                                                 02100002
021100        DISPLAY '**** THERE IS NO INPUT DATA IN FILE ****'        02110002
021200     ELSE                                                         02120006
021300        PERFORM S100-SELECT-VNDR-NAME                             02130007
021400     END-IF.                                                      02140000
021500                                                                  02150000
021600*--------------------------------------------------------------*  02160000
021700* PRIMARY PROCESSING                                           *  02170000
021800*--------------------------------------------------------------*  02180000
021900 B200-PROCESS-AUDIT-FILE.                                         02190007
022000                                                                  02200000
022100     IF VENDOR-FOUND AND VENDOR-INFO-FOUND                        02210006
022200        MOVE PV-INPUT-VENDOR-NBR           TO AP110-VENDOR-ID     02220006
022300        MOVE ENTNME-ENT-NAME-DESC          TO AP110-VENDOR-NAME   02230006
022400        MOVE BUSLOC-ADDRESS-LINE1-DESC     TO AP110-ADDRESS-LINE1 02240006
022500        MOVE BUSLOC-ADDRESS-LINE2-DESC     TO AP110-ADDRESS-LINE2 02250006
022600        MOVE BUSLOC-CITY-NAME              TO AP110-CITY          02260006
022700        MOVE BUSLOC-STATE-CDE              TO AP110-STATE         02270006
022800        MOVE BUSLOC-ZIP-CDE                TO AP110-ZIP-CDE       02280006
022900        MOVE SPACES                        TO AP110-FILLER1       02290018
023000                                              AP110-FILLER2       02300019
023100                                              AP110-FILLER3       02310019
023200                                              AP110-FILLER4       02320019
023300                                              AP110-FILLER5       02330019
023400                                              AP110-FILLER6       02340019
023500                                              AP110-FILLER7       02350019
023600        PERFORM W100-WRITE-VENDOR-INFO                            02360006
023700     END-IF.                                                      02370006
023800                                                                  02380020
023900     INITIALIZE VENDOR-FOUND-SW                                   02390015
024000                VENDOR-INFO-FOUND-SW.                             02400015
024100     PERFORM R100-READ-INPUT-FILE.                                02410007
024200     PERFORM S100-SELECT-VNDR-NAME.                               02420007
024300                                                                  02430006
024400*---------------------------------------------------------------* 02440000
024500* END OF PROGRAM PROCESSING                                     * 02450000
024600*---------------------------------------------------------------* 02460000
024700 B300-END-OF-JOB.                                                 02470000
024800                                                                  02480000
024900     DISPLAY '**************************************************' 02490000
025000     DISPLAY '****                APKUT110                  ****' 02500000
025100     DISPLAY '**************************************************' 02510000
025200     DISPLAY 'INPUT RECORDS READ = ' PC-REC-READ-CNT.             02520002
025300     DISPLAY 'OUTPUT RECORDS WRITTEN = ' PC-REC-WRTTN-CNT.        02530002
025400     DISPLAY '**************************************************' 02540000
025500                                                                  02550000
025600     CLOSE STATE-TAX-AUDIT-FILE                                   02560002
025700           VENDOR-INFO-FILE.                                      02570002
025800                                                                  02580000
025900*--------------------------------------------------------------*  02590000
026000* READ THE STATE TAX AUDIT INPUT FILE                          *  02600003
026100*--------------------------------------------------------------*  02610000
026200 R100-READ-INPUT-FILE.                                            02620003
026300                                                                  02630000
026400     INITIALIZE PV-INPUT-AREA.                                    02640004
026500     READ STATE-TAX-AUDIT-FILE INTO PV-INPUT-AREA                 02650004
026600       AT END                                                     02660000
026700          SET INPUT-EOF          TO TRUE                          02670003
026800       NOT AT END                                                 02680000
026900          ADD 1                  TO PC-REC-READ-CNT               02690000
027000     END-READ.                                                    02700000
027100                                                                  02710000
027200*--------------------------------------------------------------*  02720000
027300* RETURNS THE VENDOR NAME                                      *  02730020
027400*--------------------------------------------------------------*  02740000
027500 S100-SELECT-VNDR-NAME.                                           02750004
027600                                                                  02760000
027700     EXEC SQL                                                     02770000
027800         SELECT A.ENT_NAME_DESC                                   02780004
027900              , A.ENT_ID                                          02790004
028000           INTO :ENTNME-ENT-NAME-DESC                             02800004
028100              , :ENTNME-ENT-ID                                    02810004
028200           FROM TENTNME A                                         02820004
028300              , TEXTENT B                                         02830004
028400          WHERE A.ENT_ID = B.ENT_ID                               02840004
028500            AND A.TYPE_CDE = '01'                                 02850004
028600            AND B.DUN_NBR = :PV-INPUT-VENDOR-NBR                  02860004
028700     END-EXEC.                                                    02870000
028800                                                                  02880000
028900     EVALUATE TRUE                                                02890000
029000       WHEN SQLCODE = ZERO                                        02900000
029100         PERFORM S200-SELECT-VNDR-INFO                            02910014
029200         SET VENDOR-FOUND              TO TRUE                    02920006
029300       WHEN SQLCODE = +100                                        02930000
029400         SET VENDOR-NOT-FOUND          TO TRUE                    02940006
029500       WHEN OTHER                                                 02950000
029600         DISPLAY 'VENDOR: '            PV-INPUT-VENDOR-NBR        02960016
029700         MOVE 'S100-SELECT-VNDR-NAME'  TO AA-PARAGRAPH-NAME       02970012
029800         MOVE 'UNSUCCESSFUL SELECT'    TO AA-DB2-OPERATION        02980004
029900         MOVE 'TENTNME'                TO AA-DB2-TABLE-1          02990004
030000         MOVE 'TEXTENT'                TO AA-DB2-TABLE-2          03000004
030100         PERFORM Z998-DB2-ABEND                                   03010000
030200     END-EVALUATE.                                                03020000
030300                                                                  03030000
030400*--------------------------------------------------------------*  03040000
030500* RETURNS THE VENDOR POSTAL INFORMATION                        *  03050004
030600*--------------------------------------------------------------*  03060000
030700 S200-SELECT-VNDR-INFO.                                           03070004
030800                                                                  03080000
030900     EXEC SQL                                                     03090000
031000         SELECT ADDRESS_LINE1_DESC                                03100004
031100              , ADDRESS_LINE2_DESC                                03110004
031200              , CITY_NAME                                         03120004
031300              , STATE_CDE                                         03130004
031400              , ZIP_CDE                                           03140004
031500          INTO  :BUSLOC-ADDRESS-LINE1-DESC                        03150004
031600              , :BUSLOC-ADDRESS-LINE2-DESC                        03160004
031700              , :BUSLOC-CITY-NAME                                 03170004
031800              , :BUSLOC-STATE-CDE                                 03180004
031900              , :BUSLOC-ZIP-CDE                                   03190004
032000           FROM TBUSLOC                                           03200004
032100          WHERE ENT_ID = :ENTNME-ENT-ID                           03210004
032200            AND FUNCTION_ID = +9                                  03220004
032300            AND SEQ_NBR = (SELECT MAX(SEQ_NBR)                    03230013
032400                             FROM TBUSLOC                         03240012
032500                            WHERE ENT_ID = :ENTNME-ENT-ID         03250013
032600                              AND FUNCTION_ID = +9)               03260012
032700     END-EXEC.                                                    03270000
032800                                                                  03280000
032900     EVALUATE TRUE                                                03290000
033000       WHEN SQLCODE = ZERO                                        03300000
033100         SET VENDOR-INFO-FOUND           TO TRUE                  03310006
033200       WHEN SQLCODE = +100                                        03320006
033300         SET VENDOR-INFO-NOT-FOUND       TO TRUE                  03330006
033400       WHEN OTHER                                                 03340000
033500         DISPLAY 'VENDOR: '              PV-INPUT-VENDOR-NBR      03350016
033600         MOVE 'S200-SELECT-VNDR-INFO'    TO AA-PARAGRAPH-NAME     03360005
033700         MOVE 'UNSUCCESSFUL SELECT'      TO AA-DB2-OPERATION      03370000
033800         MOVE 'TBUSLOC'                  TO AA-DB2-TABLE-1        03380005
033900         MOVE SPACES                     TO AA-DB2-TABLE-2        03390000
034000         PERFORM Z998-DB2-ABEND                                   03400000
034100     END-EVALUATE.                                                03410000
034200                                                                  03420000
034300*--------------------------------------------------------------*  03430000
034400* WRITES THE OUTPUT FILE                                       *  03440000
034500*--------------------------------------------------------------*  03450000
034600 W100-WRITE-VENDOR-INFO.                                          03460006
034700                                                                  03470000
034800     WRITE VENDOR-INFO-RECORD   FROM AP110-STATE-AUDIT-RECORD.    03480006
034900     ADD 1                      TO PC-REC-WRTTN-CNT.              03490006
035000     INITIALIZE AP110-STATE-AUDIT-RECORD.                         03500017
035100                                                                  03510000
035200*--------------------------------------------------------------*  03520000
035300* DB2 ABEND ROUTINE                                            *  03530000
035400*--------------------------------------------------------------*  03540000
035500 Z998-DB2-ABEND.                                                  03550000
035600                                                                  03560000
035700     DISPLAY AA-ABEND-LIT.                                        03570000
035800     DISPLAY AA-DB2-ERROR-LIT.                                    03580000
035900     DISPLAY AA-PROGRAM-LIT.                                      03590000
036000     DISPLAY AA-PARAGRAPH-LIT.                                    03600000
036100     DISPLAY AA-DB2-OPERATION-LIT.                                03610000
036200     DISPLAY AA-DB2-TABLE-1.                                      03620000
036300     DISPLAY AA-DB2-TABLE-2.                                      03630000
036400     SET AC-DB2-ERROR TO TRUE.                                    03640000
036500                                                                  03650000
036600     COPY DPPD004.                                                03660000
036700     CALL 'ILBOABN0' USING ABEND-CODE.                            03670000
036800                                                                  03680000
