000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             CEKRP001.                                00050000
000600 AUTHOR.                 LYNN MCADAMS.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            JUNE, 2000.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000***************************************************************** 00100000
001100*                                                                 00110000
001200***************************************************************** 00120000
001300*                                                               * 00130000
001400*  THIS PROGRAM WILL TAKE AN ERROR FILE OF MANIFEST DATA FROM   * 00140000
001500*  RDM (CREATED FROM CEKUP001) AND CREATE A REPORT LISTING THE  * 00150000
001600*  ERRORS ENCOUNTERED WHILE PROCESSING THE DATA.                * 00160000
001700*                                                               * 00170000
001800*  THE REPORT WILL GROUP BY PULL NUMBER AND LINE NUMBER.        * 00180000
001900*  WHEN THE DC LOCATION CHANGES THERE WILL BE A PAGE BREAK.     * 00190000
002000*                                                               * 00200000
000500*                                                                 00201001
000500* CHANGES:                                                        00202001
000500* 05/15/2020  JEAN KURK  RENAME FROM WMKRP001 TO CEKRP001         00203001
002100***************************************************************** 00210000
002200*                                                                 00220000
002300***************************************************************** 00230000
002400 ENVIRONMENT DIVISION.                                            00240000
002500***************************************************************** 00250000
002600                                                                  00260000
002700 CONFIGURATION SECTION.                                           00270000
002800                                                                  00280000
002900 SOURCE-COMPUTER.        IBM-3090.                                00290000
003000 OBJECT-COMPUTER.        IBM-3090.                                00300000
003100                                                                  00310000
003200 INPUT-OUTPUT SECTION.                                            00320000
003300                                                                  00330000
003400 FILE-CONTROL.                                                    00340000
003500*                                                                 00350000
003600     SELECT CE-FILE                                               00360000
003700         ASSIGN TO INP01.                                         00370000
003800                                                                  00380000
003900     SELECT CE-REPORT-FILE                                        00390000
004000         ASSIGN TO RPT01.                                         00400000
004100                                                                  00410000
004200*                                                                 00420000
004300***************************************************************** 00430000
004400 DATA DIVISION.                                                   00440000
004500***************************************************************** 00450000
004600*                                                                 00460000
004700 FILE SECTION.                                                    00470000
004800*                                                                 00480000
004900 FD  CE-FILE                                                      00490000
005000     RECORDING MODE IS F                                          00500000
005100     BLOCK CONTAINS 0 RECORDS                                     00510000
005200     RECORD CONTAINS 150 CHARACTERS                               00520000
005300     LABEL RECORDS ARE STANDARD                                   00530000
005400     DATA RECORD IS CE-RECORD.                                    00540000
005500 01  CE-RECORD                       PIC X(150).                  00550000
005600                                                                  00560000
005700 FD  CE-REPORT-FILE                                               00570000
005800     RECORDING MODE IS F                                          00580000
005900     BLOCK CONTAINS 0  RECORDS                                    00590000
006000     RECORD CONTAINS 132 CHARACTERS                               00600000
006100     LABEL RECORDS ARE OMITTED                                    00610000
006200     DATA RECORD IS CE-REPORT-RECORD.                             00620000
006300 01  CE-REPORT-RECORD                PIC X(132).                  00630000
006400*                                                                 00640000
006500*                                                                 00650000
006600 WORKING-STORAGE SECTION.                                         00660000
006700*                                                                 00670000
006800 01 WS-CALC-FIELDS.                                               00680000
006900    05  WS-RECORDS-READ-QTY          PIC S9(07)    COMP-3         00690000
007000                                                   VALUE ZEROS.   00700000
007100    05  WS-RECORDS-WRITE-QTY         PIC S9(07)    COMP-3         00710000
007200                                                   VALUE ZEROS.   00720000
007300*                                                                 00730000
007400 01  PROGRAM-SWITCHES.                                            00740000
007500     05  PS-PAGE-SW                  PIC X(01) VALUE 'N'.         00750000
007600         88  PS-NEW-PAGE                       VALUE 'Y'.         00760000
007700         88  PS-SAME-PAGE                      VALUE 'N'.         00770000
007800     05  PS-END-OF-FILE-SW           PIC X(03) VALUE 'N'.         00780000
007900         88  PS-END-OF-FILE                    VALUE 'Y'.         00790000
008000     05  PS-FIRST-TIME-SW            PIC X(01) VALUE 'N'.         00800000
008100         88  PS-FIRST-TIME-YES                 VALUE 'Y'.         00810000
008200         88  PS-FIRST-TIME-NO                  VALUE 'N'.         00820000
008300     05  PS-END-OF-CURSOR-SW         PIC X(03) VALUE 'N'.         00830000
008400         88 PS-END-OF-CURSOR                   VALUE 'Y'.         00840000
008500         88 PS-NOT-END-OF-CURSOR               VALUE 'N'.         00850000
008600     05  PS-END-OF-TABLE-SW          PIC X(03) VALUE 'N'.         00860000
008700         88 PS-END-OF-TABLE                    VALUE 'Y'.         00870000
008800         88 PS-NOT-END-OF-TABLE                VALUE 'N'.         00880000
008600     05  PS-SEND-EMAIL-SW            PIC X(03) VALUE 'N'.         00881000
008700         88 PS-SEND-EMAIL-YES                  VALUE 'Y'.         00882000
008800         88 PS-SEND-EMAIL-NO                   VALUE 'N'.         00883000
008900*                                                                 00884000
009000 01  ERROR-MESSAGES.                                              00885000
009100     05  PV-ERROR-MSG-1              PIC X(18)                    00886000
009200                                     VALUE 'PULL NBR NOT FOUND'.  00887000
009300     05  PV-ERROR-MSG-2              PIC X(14)                    00888000
009400                                     VALUE 'PULL CANCELLED'.      00889000
009500     05  PV-ERROR-MSG-3              PIC X(11)                    00890000
009600                                     VALUE 'PULL POSTED'.         00900000
009700     05  PV-ERROR-MSG-4              PIC X(18)                    00910000
009800                                     VALUE 'LINE NBR NOT FOUND'.  00920000
009900     05  PV-ERROR-MSG-5              PIC X(14)                    00930000
010000                                     VALUE 'LINE CANCELLED'.      00940000
010100     05  PV-ERROR-MSG-6              PIC X(11)                    00950000
010200                                     VALUE 'LINE POSTED'.         00960000
010300     05  PV-ERROR-MSG-7              PIC X(17)                    00970000
010400                                     VALUE 'STORE NOT ON LINE'.   00980000
010500*                                                                 00990000
010600 01  PC-CONSTANTS.                                                01000000
010700     05  PC-10                       PIC S9(03)    VALUE +10      01010000
010800                                                   COMP-3.        01020000
010900     05  PC-PROGRAM-NAME             PIC  X(08)    VALUE          01030000
011000         'CEKRP001'.                                              01040000
011100     05  PC-REPORT-NBR               PIC X(02) VALUE '-1'.        01050000
011200     05  PC-MAX-LINE-COUNT           PIC S9(3) VALUE +60          01060000
011300                                               COMP-3.            01070000
011400*                                                                 01080000
011500 01 PC-PROGRAM-VARIABLES.                                         01090000
011600     05  PV-LINE-COUNT               PIC S9(03)    VALUE ZERO     01100000
011700                                                   COMP-3.        01110000
011800     05  PV-PAGE-CNT                 PIC S9(04)    VALUE ZERO     01120000
011900                                                   COMP-3.        01130000
012000     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01140000
012100                                                   COMP SYNC.     01150000
012200     05  PV-ABEND-PARA-NAME          PIC X(30)     VALUE SPACES.  01160000
012300     05  PV-DB2-OPERATION-MSG-1      PIC X(40)     VALUE SPACES.  01170000
012400     05  PV-DB2-OPERATION-MSG-2      PIC X(40)     VALUE SPACES.  01180000
012500     05  PV-DB2-TABLE-NAME           PIC X(12)     VALUE SPACES.  01190000
012600     05  PV-SQLCODE                  PIC Z(8)9-.                  01200000
012700                                                                  01210000
012800     05  PV-BREAK-FIELDS.                                         01220000
012900         10  PV-CURR-DC              PIC 9(04)     VALUE ZEROS.   01230000
013000         10  PV-CURR-PULL-NBR        PIC 9(08)     VALUE ZEROS.   01240000
013100         10  PV-CURR-PULL-LNE-NBR    PIC 9(04)     VALUE ZEROS.   01250000
013200                                                                  01260000
013300     05  PV-REPORT-FIELDS.                                        01270000
013400         10  PV-STORE-NMBR           PIC 9(04)     VALUE ZEROS.   01280000
013500         10  PV-DC-STORE-NAME        PIC X(25)     VALUE SPACES.  01290000
013600*                                                                 01300000
013700     05  PV-DATE-DDMMYY.                                          01310000
013800         10  PV-DATE-DD              PIC  X(02).                  01320000
013900         10  PV-DATE-SLASH-1         PIC  X(01).                  01330000
014000         10  PV-DATE-MM              PIC  X(02).                  01340000
014100         10  PV-DATE-SLASH-2         PIC  X(01).                  01350000
014200         10  PV-DATE-YY              PIC  X(04).                  01360000
014300     05  PV-TODAYS-DATE.                                          01370000
014400         10  PV-TODAYS-DATE-YY       PIC  9(02)    VALUE ZEROS.   01380000
014500         10  PV-TODAYS-DATE-MM       PIC  9(02)    VALUE ZEROS.   01390000
014600         10  PV-TODAYS-DATE-DD       PIC  9(02)    VALUE ZEROS.   01400000
014700     05  PV-TODAYS-TIME.                                          01410000
014800         10  PV-TODAYS-TIME-HH       PIC  9(02)    VALUE ZEROS.   01420000
014900         10  PV-TODAYS-TIME-MM       PIC  9(02)    VALUE ZEROS.   01430000
015000         10  PV-TODAYS-TIME-SS       PIC  9(02)    VALUE ZEROS.   01440000
015100         10  FILLER                  PIC  9(02)    VALUE ZEROS.   01450000
015200     05  PV-FORMAT-DATE.                                          01460000
015300         10  PV-FORMAT-DATE-MM       PIC  X(02)    VALUE SPACES.  01470000
015400         10  FILLER                  PIC  X(01)    VALUE '/'.     01480000
015500         10  PV-FORMAT-DATE-DD       PIC  X(02)    VALUE SPACES.  01490000
015600         10  FILLER                  PIC  X(01)    VALUE '/'.     01500000
015700         10  PV-FORMAT-DATE-YYYY     PIC  X(04)    VALUE SPACES.  01510000
015800                                                                  01520000
015900*RECORD LAYOUT FOR INPUT FILE                                     01530000
016000     COPY CERD026.                                                01540000
016100                                                                  01550000
016200 EJECT                                                            01560000
016300*                                                                 01570000
016400*-----------------------------------------------------------------01580000
016500* COMMAREA FOR XLKUT071 - LOCATION MODULE                         01590000
016600*-----------------------------------------------------------------01600000
016700     COPY XLWS071.                                                01610000
016800                                                                  01620000
016900******************************************************************01630000
017000*  WORK FIELDS FOR PRINTING A 132 CHARACTER REPORT.               01640000
017100******************************************************************01650000
017200     COPY DPWS132O.                                               01660000
017300*                                                                 01670000
017400 01  WS-BATCH-PROC-DATE.                                          01680000
017500     05  WS-BATCH-PROC-CC            PIC X(02)     VALUE SPACES.  01690000
017600     05  WS-BATCH-PROC-YY            PIC X(02)     VALUE SPACES.  01700000
017700     05  FILLER                      PIC X(01)     VALUE SPACES.  01710000
017800     05  WS-BATCH-PROC-MM            PIC X(02)     VALUE SPACES.  01720000
017900     05  FILLER                      PIC X(01)     VALUE SPACES.  01730000
018000     05  WS-BATCH-PROC-DD            PIC X(02)     VALUE SPACES.  01740000
018100*                                                                 01750000
018200*                                                                 01760000
018300 01  HEADING-LINE1.                                               01770000
018400     05  FILLER                  PIC  X(40)    VALUE SPACES.      01780000
018500     05  FILLER                  PIC  X(60)    VALUE              01790000
018600         'UNIT POSTING ERROR REPORT FOR CENTRAL STOCK PROCESSING'.01800000
018800     05  FILLER                  PIC  X(37)    VALUE SPACES.      01810000
018900*                                                                 01820000
019000 01  HEADING-LINE2.                                               01830000
019100     05  FILLER                  PIC  X(02)    VALUE SPACES.      01840000
019200     05  FILLER                  PIC  X(05)    VALUE 'DC:  '.     01850000
019300     05  HL2-DC-STORE-NBR        PIC  9(04)    VALUE ZEROS.       01860000
019400     05  FILLER                  PIC  X(03)    VALUE ' - '.       01870000
019500     05  HL2-DC-STORE-NAME       PIC  X(25)    VALUE SPACES.      01880000
019600     05  FILLER                  PIC  X(93)    VALUE SPACES.      01890000
019700*                                                                 01900000
019800 01  HEADING-LINE3.                                               01910000
019900     05  FILLER                  PIC  X(05)    VALUE SPACES.      01920000
020000     05  FILLER                  PIC  X(04)    VALUE              01930000
020100         'PULL'.                                                  01940000
020200     05  FILLER                  PIC  X(06)    VALUE SPACES.      01950000
020300     05  FILLER                  PIC  X(04)    VALUE              01960000
020400         'LINE'.                                                  01970000
020500     05  FILLER                  PIC  X(06)    VALUE SPACES.      01980000
020600     05  FILLER                  PIC  X(04)    VALUE              01990000
020700         'ITEM'.                                                  02000000
020800     05  FILLER                  PIC  X(06)    VALUE SPACES.      02010000
020900     05  FILLER                  PIC  X(05)    VALUE              02020000
021000         'STORE'.                                                 02030000
021100     05  FILLER                  PIC  X(03)    VALUE SPACES.      02040000
021200     05  FILLER                  PIC  X(08)    VALUE              02050000
021300         'MANIFEST'.                                              02060000
021400     05  FILLER                  PIC  X(03)    VALUE SPACES.      02070000
021500     05  FILLER                  PIC  X(08)    VALUE              02080000
021600         'MANIFEST'.                                              02090000
021700     05  FILLER                  PIC  X(36)    VALUE SPACES.      02100000
021800     05  FILLER                  PIC  X(09)    VALUE              02110000
021900         'RDM BATCH'.                                             02120000
022000     05  FILLER                  PIC  X(25)    VALUE SPACES.      02130000
022100                                                                  02140000
022200 01  HEADING-LINE4.                                               02150000
022300     05  FILLER                  PIC  X(04)    VALUE SPACES.      02160000
022400     05  FILLER                  PIC  X(06)    VALUE 'NUMBER'.    02170000
022500     05  FILLER                  PIC  X(04)    VALUE SPACES.      02180000
022600     05  FILLER                  PIC  X(06)    VALUE 'NUMBER'.    02190000
022700     05  FILLER                  PIC  X(04)    VALUE SPACES.      02200000
022800     05  FILLER                  PIC  X(06)    VALUE 'NUMBER'.    02210000
022900     05  FILLER                  PIC  X(05)    VALUE SPACES.      02220000
023000     05  FILLER                  PIC  X(06)    VALUE 'NUMBER'.    02230000
023100     05  FILLER                  PIC  X(02)    VALUE SPACES.      02240000
023200     05  FILLER                  PIC  X(08)    VALUE 'QUANTITY'.  02250000
023300     05  FILLER                  PIC  X(05)    VALUE SPACES.      02260000
023400     05  FILLER                  PIC  X(04)    VALUE 'DATE'.      02270000
023500     05  FILLER                  PIC  X(06)    VALUE SPACES.      02280000
023600     05  FILLER                  PIC  X(21)    VALUE              02290000
023700         'BILL OF LADING NUMBER'.                                 02300000
023800     05  FILLER                  PIC  X(12)    VALUE SPACES.      02310000
023900     05  FILLER                  PIC  X(06)    VALUE 'NUMBER'.    02320000
024000     05  FILLER                  PIC  X(05)    VALUE SPACES.      02330000
024100     05  FILLER                  PIC  X(13)    VALUE              02340000
024200         'ERROR MESSAGE'.                                         02350000
024300     05  FILLER                  PIC  X(09)    VALUE SPACES.      02360000
024400*                                                                 02370000
024500 01  REPORT-DETAIL-LINE.                                          02380000
024600     05  FILLER                  PIC  X(03)    VALUE SPACES.      02390000
024700     05  DL1-PULL-NBR            PIC  Z(08)    VALUE ZEROS.       02400000
024800     05  FILLER                  PIC  X(04)    VALUE SPACES.      02410000
024900     05  DL1-PULL-LNE-NBR        PIC  Z(04)    VALUE ZEROS.       02420000
025000     05  FILLER                  PIC  X(04)    VALUE SPACES.      02430000
025100     05  DL1-RDM-ITEM-ID         PIC  X(08)    VALUE SPACES.      02440000
025200     05  FILLER                  PIC  X(04)    VALUE SPACES.      02450000
025300     05  DL1-RECV-STORE-NBR      PIC  Z(05)    VALUE ZEROS.       02460000
025400     05  FILLER                  PIC  X(04)    VALUE SPACES.      02470000
025500     05  DL1-MANIFEST-QTY        PIC  Z(05)    VALUE ZEROS.       02480000
025600     05  FILLER                  PIC  X(04)    VALUE SPACES.      02490000
025700     05  DL1-MNFST-DATE-MM       PIC  9(02)    VALUE ZEROS.       02500000
025800     05  FILLER                  PIC  X(01)    VALUE              02510000
025900         '/'.                                                     02520000
026000     05  DL1-MNFST-DATE-DD       PIC  9(02)    VALUE ZEROS.       02530000
026100     05  FILLER                  PIC  X(01)    VALUE              02540000
026200         '/'.                                                     02550000
026300     05  DL1-MNFST-DATE-YY       PIC  9(02)    VALUE ZEROS.       02560000
026400     05  FILLER                  PIC  X(04)    VALUE SPACES.      02570000
026500     05  DL1-BOL-NBR             PIC  X(30)    VALUE SPACES.      02580000
026600     05  FILLER                  PIC  X(03)    VALUE SPACES.      02590000
026700     05  DL1-RDM-BATCH-NBR       PIC  Z(07)    VALUE ZEROS.       02600000
026800     05  FILLER                  PIC  X(04)    VALUE SPACES.      02610000
026900     05  DL1-ERROR-MSG           PIC  X(20)    VALUE SPACES.      02620000
027000     05  FILLER                  PIC  X(01)    VALUE SPACES.      02630000
027100*                                                                 02640000
027200 01  BL-BLANK-LINE               PIC X(132)    VALUE SPACES.      02650000
027300*                                                                 02660000
027400 01  MISCELLANEOUS-LINES.                                         02670000
027500     05  END-OF-REPORT-LINE.                                      02680000
027600         10  FILLER                  PIC  X(44)    VALUE SPACES.  02690000
027700         10  FILLER                  PIC  X(45)    VALUE          02700000
027800             '*******   E N D   O F   R E P O R T   *******'.     02710000
027900         10  FILLER                  PIC  X(43)    VALUE SPACES.  02720000
028000     05  NO-DATA-TO-REPORT-LINE.                                  02730000
028100         10  FILLER                  PIC  X(40)    VALUE SPACES.  02740000
028200         10  FILLER                  PIC  X(52)    VALUE          02750000
028300         '*******  NO MANIFESTING ERRORS ENCOUNTERED   *******'.  02760000
028400         10  FILLER                  PIC  X(40)    VALUE SPACES.  02770000
028500*                                                                 02780000
028600******************************************************************02790000
028700*  DB2 AREA FOR XLT_LOC - LOGISTICS LOCATION TABLE                02800000
028800******************************************************************02810000
028900*  XLT_LOC                                                        02820000
029000     EXEC SQL                                                     02830000
029100          INCLUDE XLT00010                                        02840000
029200     END-EXEC.                                                    02850000
029300                                                                  02860000
029400*** DB2 MESSAGE AREAS ****                                        02870000
029500*    DB2 AREA FOR COMMUNICATIONS AREA2                            02880000
029600     COPY DPWS004.                                                02890000
029700                                                                  02900000
029800*    DB2 AREA FOR COMMUNICATIONS                                  02910000
029900     EXEC SQL                                                     02920000
030000          INCLUDE SQLCA                                           02930000
030100     END-EXEC.                                                    02940000
030200                                                                  02950000
030300     COPY SQLCA2.                                                 02960000
030400*                                                                 02970000
030500*                                                                 02980000
030600******************************************************************02990000
030700 PROCEDURE DIVISION.                                              03000000
030800******************************************************************03010000
030900*                                                                 03020000
031000******************************************************************03030000
031100**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      03040000
031200******************************************************************03050000
031300 0000-MAINLINE-PROCESSING.                                        03060000
031400     PERFORM 1000-INITIALIZE.                                     03070000
031500*                                                                 03080000
031600     IF  PS-END-OF-FILE                                           03090000
031700         NEXT SENTENCE                                            03100000
031800     ELSE                                                         03110000
031900         SET PS-FIRST-TIME-NO TO TRUE                             03120000
032000         PERFORM 2000-PROCESS-EXTRACT                             03130000
032100           UNTIL  PS-END-OF-FILE                                  03140000
032200     END-IF.                                                      03150000
032300*                                                                 03160000
032400     PERFORM 9000-END-PROCESS.                                    03170000
032500*                                                                 03180000
032600     DISPLAY 'NUMBER OF RECORDS READ IS:     '                    03190000
032700         WS-RECORDS-READ-QTY.                                     03200000
032800     DISPLAY 'NUMBER OF RECORDS WRITTEN IS:  '                    03210000
032900         WS-RECORDS-WRITE-QTY.                                    03220000
033000*                                                                 03230000
           IF PS-SEND-EMAIL-YES                                         03240000
               MOVE 4095 TO RETURN-CODE                                 03250000
           END-IF.                                                      03260000
033000*                                                                 03270000
033100     STOP RUN.                                                    03280000
033200*                                                                 03290000
033300*                                                                 03300000
033400***************************************************************** 03310000
033500**  READ INPUT FILE.                                              03320000
033600***************************************************************** 03330000
033700 0100-READ-EXTRACT.                                               03340000
033800     READ CE-FILE INTO CE026-CS-STR-MANIFEST-RECORD               03350000
033900        AT END                                                    03360000
034000           SET PS-END-OF-FILE TO TRUE                             03370000
034100     END-READ.                                                    03380000
034200*                                                                 03390000
034300*                                                                 03400000
034400******************************************************************03410000
034500**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               03420000
034600******************************************************************03430000
034700 1000-INITIALIZE.                                                 03440000
034800     OPEN INPUT  CE-FILE                                          03450000
034900          OUTPUT CE-REPORT-FILE.                                  03460000
035000                                                                  03470000
035100     ACCEPT PV-TODAYS-DATE FROM DATE.                             03480000
035200     ACCEPT PV-TODAYS-TIME FROM TIME.                             03490000
035300*                                                                 03500000
035400     PERFORM 1100-INITIALIZE-HEADINGS.                            03510000
035500                                                                  03520000
035600*READ FIRST INPUT RECORD.                                         03530000
035700     PERFORM 0100-READ-EXTRACT.                                   03540000
035800     SET PS-FIRST-TIME-YES TO TRUE.                               03550000
035900*                                                                 03560000
036000*                                                                 03570000
036100******************************************************************03580000
036200**  INITIALIZE REPORT HEADINGS.                                   03590000
036300******************************************************************03600000
036400 1100-INITIALIZE-HEADINGS.                                        03610000
036500     MOVE PV-TODAYS-DATE-YY      TO DP132O-RUN-YEAR.              03620000
036600     MOVE PV-TODAYS-DATE-MM      TO DP132O-RUN-MONTH.             03630000
036700     MOVE PV-TODAYS-DATE-DD      TO DP132O-RUN-DAY.               03640000
036800     MOVE PV-TODAYS-TIME-HH      TO DP132O-RUN-HOUR.              03650000
036900     MOVE PV-TODAYS-TIME-MM      TO DP132O-RUN-MINUTE.            03660000
037000     MOVE PC-PROGRAM-NAME        TO DP132O-PROGRAM-NAME.          03670000
037100     MOVE PC-REPORT-NBR          TO DP132O-REPORT-NUMBER.         03680000
037200*                                                                 03690000
037300*                                                                 03700000
037400******************************************************************03710000
037500** PRINTS REPORT HEADINGS.                                        03720000
037600******************************************************************03730000
037700 1200-PRINT-HEADINGS.                                             03740000
037800                                                                  03750000
037900     PERFORM 3000-CALL-LOCATION-MODULE.                           03760000
038000                                                                  03770000
038100     MOVE 1                       TO PV-PAGE-CNT.                 03780000
038200     MOVE PV-PAGE-CNT             TO DP132O-PAGE-NUMBER.          03790000
038300*                                                                 03800000
038400     WRITE CE-REPORT-RECORD                                       03810000
038500       FROM DP132O-STANDRD-HEADER-132-COLS                        03820000
038600         AFTER ADVANCING PAGE.                                    03830000
038700                                                                  03840000
038800     MOVE +1 TO PV-LINE-COUNT.                                    03850000
038900*                                                                 03860000
039000     WRITE CE-REPORT-RECORD                                       03870000
039100       FROM BL-BLANK-LINE                                         03880000
039200         AFTER ADVANCING 1 LINE.                                  03890000
039300                                                                  03900000
039400     WRITE CE-REPORT-RECORD                                       03910000
039500       FROM HEADING-LINE1                                         03920000
039600         AFTER ADVANCING 2 LINES.                                 03930000
039700*                                                                 03940000
039800     MOVE PV-CURR-DC              TO HL2-DC-STORE-NBR.            03950000
039900     MOVE CE026-DC-STORE-NBR      TO HL2-DC-STORE-NBR.            03960000
040000     MOVE PV-DC-STORE-NAME        TO HL2-DC-STORE-NAME.           03970000
040100*                                                                 03980000
040200     WRITE CE-REPORT-RECORD                                       03990000
040300       FROM HEADING-LINE2                                         04000000
040400         AFTER ADVANCING 1 LINE.                                  04010000
040500*                                                                 04020000
040600     WRITE CE-REPORT-RECORD                                       04030000
040700       FROM BL-BLANK-LINE                                         04040000
040800         AFTER ADVANCING 1 LINE.                                  04050000
040900*                                                                 04060000
041000     WRITE CE-REPORT-RECORD                                       04070000
041100       FROM HEADING-LINE3                                         04080000
041200         AFTER ADVANCING 1 LINE.                                  04090000
041300*                                                                 04100000
041400     WRITE CE-REPORT-RECORD                                       04110000
041500       FROM HEADING-LINE4                                         04120000
041600         AFTER ADVANCING 1 LINE.                                  04130000
041700*                                                                 04140000
041800     MOVE SPACES TO CE-REPORT-RECORD.                             04150000
041900     WRITE CE-REPORT-RECORD                                       04160000
042000         AFTER ADVANCING 1 LINE.                                  04170000
042100*                                                                 04180000
042200     MOVE PC-10           TO PV-LINE-COUNT.                       04190000
042300*                                                                 04200000
042400*                                                                 04210000
042500******************************************************************04220000
042600** PRINTS NO DETAIL LINE IF EMPTY INPUT FILE.                     04230000
042700******************************************************************04240000
042800 1300-NO-DETAIL-LINE.                                             04250000
042900*                                                                 04260000
043000     MOVE 1                       TO PV-PAGE-CNT.                 04270000
043100     MOVE PV-PAGE-CNT             TO DP132O-PAGE-NUMBER.          04280000
043200*                                                                 04290000
043300     WRITE CE-REPORT-RECORD                                       04300000
043400       FROM DP132O-STANDRD-HEADER-132-COLS                        04310000
043500*        AFTER ADVANCING PAGE.                                    04320000
043600                                                                  04330000
043700     WRITE CE-REPORT-RECORD                                       04340000
043800       FROM BL-BLANK-LINE                                         04350000
043900         AFTER ADVANCING 1 LINE.                                  04360000
044000                                                                  04370000
044100     WRITE CE-REPORT-RECORD                                       04380000
044200       FROM HEADING-LINE1                                         04390000
044300         AFTER ADVANCING 2 LINES.                                 04400000
044400                                                                  04410000
044500     WRITE CE-REPORT-RECORD                                       04420000
044600       FROM NO-DATA-TO-REPORT-LINE                                04430000
044700         AFTER ADVANCING 3 LINES.                                 04440000
044800*                                                                 04450000
044900     WRITE CE-REPORT-RECORD                                       04460000
045000       FROM BL-BLANK-LINE                                         04470000
045100         AFTER ADVANCING 1 LINE.                                  04480000
045200*                                                                 04490000
045300*                                                                 04500000
045400******************************************************************04510000
045500**  THIS IS THE MAIN CONTROLLING PARAGRAPH FOR PROCESSING THE     04520000
045600**  COMPLETED CENTRAL STOCK PULL ITEM REQUESTS REPORT.            04530000
045700******************************************************************04540000
045800 2000-PROCESS-EXTRACT.                                            04550000
045900                                                                  04560000
046000      IF PV-CURR-DC = CE026-DC-STORE-NBR                          04570000
046100         CONTINUE                                                 04580000
046200      ELSE                                                        04590000
046300         MOVE PV-CURR-DC TO DL1-RECV-STORE-NBR                    04600000
046400         MOVE 1                       TO PV-PAGE-CNT              04610000
046500         MOVE PV-PAGE-CNT             TO DP132O-PAGE-NUMBER       04620000
046600         MOVE CE026-DC-STORE-NBR      TO PV-CURR-DC               04630000
046700         PERFORM 1200-PRINT-HEADINGS                              04640000
046800      END-IF.                                                     04650000
046900                                                                  04660000
047000     PERFORM 2100-PRINT-DETAIL.                                   04670000
047100     SET PS-FIRST-TIME-NO TO TRUE.                                04680000
047200                                                                  04690000
047300*READ NEXT INPUT RECORD.                                          04700000
047400     ADD  +1                    TO WS-RECORDS-WRITE-QTY.          04710000
047500     PERFORM 0100-READ-EXTRACT.                                   04720000
047600     ADD  +1                    TO WS-RECORDS-READ-QTY.           04730000
047700*                                                                 04740000
047800*                                                                 04750000
047900***************************************************************** 04760000
048000**  GROUPS BY PULL NUMBER, LINE NUMBER AND PRINTS DETAIL LINES.   04770000
048100***************************************************************** 04780000
048200 2100-PRINT-DETAIL.                                               04790000
048300                                                                  04800000
048400*FILL PULL NUMBER.                                                04810000
048500     IF (CE026-PULL-NBR = PV-CURR-PULL-NBR)                       04820000
048600            MOVE ZEROS TO DL1-PULL-NBR                            04830000
048700     ELSE                                                         04840000
048800            MOVE CE026-PULL-NBR       TO DL1-PULL-NBR             04850000
048900                                         PV-CURR-PULL-NBR         04860000
049000            WRITE CE-REPORT-RECORD                                04870000
049100              FROM BL-BLANK-LINE                                  04880000
049200                AFTER ADVANCING 1 LINE                            04890000
049300     END-IF.                                                      04900000
049400                                                                  04910000
049500*FILL LINE NUMBER & ITEM NUMBER.                                  04920000
049600     IF (CE026-PULL-LNE-NBR = PV-CURR-PULL-LNE-NBR)               04930000
049700          MOVE ZEROS                  TO DL1-PULL-LNE-NBR         04940000
049800     ELSE                                                         04950000
049900          MOVE CE026-PULL-LNE-NBR     TO DL1-PULL-LNE-NBR         04960000
050000                                         PV-CURR-PULL-LNE-NBR     04970000
050100          MOVE CE026-RDM-ITEM-ID      TO DL1-RDM-ITEM-ID          04980000
050200     END-IF.                                                      04990000
050300                                                                  05000000
050400*FILL STORE NUMBER.                                               05010000
050500     MOVE CE026-RECV-STORE-NBR   TO DL1-RECV-STORE-NBR            05020000
050600                                                                  05030000
050700*FILL MANIFEST QUANTITY.                                          05040000
050800     MOVE CE026-MANIFEST-QTY     TO DL1-MANIFEST-QTY.             05050000
050900                                                                  05060000
051000*FILL MANIFEST DATE.                                              05070000
051100     MOVE CE026-MANIFEST-DATE-MM                                  05080000
051200                     TO DL1-MNFST-DATE-MM.                        05090000
051300     MOVE CE026-MANIFEST-DATE-DD                                  05100000
051400                     TO DL1-MNFST-DATE-DD.                        05110000
051500     MOVE CE026-MANIFEST-DATE-YY                                  05120000
051600                     TO DL1-MNFST-DATE-YY.                        05130000
051700                                                                  05140000
051800*FILL BILL OF LADING NUMBER.                                      05150000
051900     MOVE CE026-BOL-NBR          TO DL1-BOL-NBR.                  05160000
052000                                                                  05170000
052100*FILL RDM BATCH NUMBER.                                           05180000
052200     MOVE CE026-RDM-BATCH-NBR    TO DL1-RDM-BATCH-NBR.            05190000
052300                                                                  05200000
052400*FILL ERROR MESSAGE.                                              05210000
052500     EVALUATE TRUE                                                05220000
052600         WHEN CE026-PULL-NBR-NOT-FOUND                            05230000
052700            MOVE PV-ERROR-MSG-1    TO DL1-ERROR-MSG               05240000
052800         WHEN CE026-CANCEL-PULL-NBR                               05250000
052900            MOVE PV-ERROR-MSG-2    TO DL1-ERROR-MSG               05260000
053000         WHEN CE026-POSTED-PULL-NBR                               05270000
053100            MOVE PV-ERROR-MSG-3    TO DL1-ERROR-MSG               05280000
053200         WHEN CE026-LINE-NBR-NOT-FOUND                            05290000
053300            MOVE PV-ERROR-MSG-4    TO DL1-ERROR-MSG               05300000
053400         WHEN CE026-CANCEL-LINE-NBR                               05310000
053500            MOVE PV-ERROR-MSG-5    TO DL1-ERROR-MSG               05320000
053600         WHEN CE026-POSTED-LINE-NBR                               05330000
053700            MOVE PV-ERROR-MSG-6    TO DL1-ERROR-MSG               05340000
053800         WHEN CE026-STR-NOT-ON-PULL                               05350000
053900            MOVE PV-ERROR-MSG-7    TO DL1-ERROR-MSG               05360000
054000     END-EVALUATE.                                                05370000
054100*                                                                 05380000
054200*CHECK FOR PAGE OVERFLOW                                          05390000
054300         ADD 1 TO PV-LINE-COUNT.                                  05400000
054400         IF  PV-LINE-COUNT > PC-MAX-LINE-COUNT                    05410000
054500             SET PS-NEW-PAGE TO TRUE                              05420000
054600             PERFORM 1200-PRINT-HEADINGS                          05430000
054700         END-IF.                                                  05440000
054800*                                                                 05450000
054900*IF NEW PAGE, DISPLAY PULL NUMBER, LINE NUMBER, AND STORE NUMBER  05460000
055000*ON FIRST LINE.                                                   05470000
055100     IF PS-NEW-PAGE                                               05480000
055200        MOVE CE026-PULL-NBR           TO DL1-PULL-NBR             05490000
055300        MOVE CE026-PULL-LNE-NBR       TO DL1-PULL-LNE-NBR         05500000
055400        MOVE CE026-RECV-STORE-NBR     TO DL1-RECV-STORE-NBR       05510000
055500        SET PS-SAME-PAGE              TO TRUE                     05520000
055600      END-IF.                                                     05530000
055700                                                                  05540000
055800*WRITE DETAIL LINE.                                               05550000
055900         WRITE CE-REPORT-RECORD                                   05560000
056000           FROM REPORT-DETAIL-LINE                                05570000
056100             AFTER ADVANCING 1 LINE                               05580000
056200         INITIALIZE REPORT-DETAIL-LINE.                           05590000
056300*                                                                 05600000
056400*                                                                 05610000
056500***************************************************************** 05620000
056600* CALL XLKUT071 MODULE TO GET DC LOCATION DESCRIPTION             05630000
056700***************************************************************** 05640000
056800 3000-CALL-LOCATION-MODULE.                                       05650000
056900     MOVE CE026-DC-STORE-NBR      TO PV-STORE-NMBR.               05660000
057000                                                                  05670000
057100* HIERARCY DOMAIN TABLE XLT00010                                  05680000
057200                                                                  05690000
057300     INITIALIZE XL071-COMMAREA-REC.                               05700000
057400     MOVE PV-STORE-NMBR              TO XL071-LOCATION-NUMBER.    05710000
057500                                                                  05720000
057600     CALL XL071-LOCATION-MODULE USING XL071-COMMAREA-REC.         05730000
057700*                                                                 05740000
057800     EVALUATE TRUE                                                05750000
057900         WHEN XL071-NO-ERRORS                                     05760000
058000            MOVE XL071-LOC-NM           TO PV-DC-STORE-NAME       05770000
058100         WHEN XL071-LOC-NOT-FOUND                                 05780000
058200         WHEN XL071-DC-ASGMT-NOT-FND                              05790000
058300            MOVE 'UNKNOWN'              TO PV-DC-STORE-NAME       05800000
058400         WHEN OTHER                                               05810000
058500            MOVE XL071-SQLCA         TO SQLCA                     05820000
058600            MOVE '3000-CALL-LOCATION-MODULE' TO PV-ABEND-PARA-NAME05830000
058700            DISPLAY '** ABEND **         ** = ' 'XLKUT071'        05840000
058800            DISPLAY '** PROGRAM   ** = ' 'CEKRP001'               05850000
058900            DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARA-NAME       05860000
059000            DISPLAY '** OPERATION ** = ' ' SELECT XLT_LOC'        05870000
059100            DISPLAY '** SQLCODE FROM MOD ** = ' SQLCODE           05880000
059200            DISPLAY '** XLT_LOC  ** = '  XL071-LOCATION-NUMBER    05890000
059300            DISPLAY '** TABLE IN ERROR   ** = ' XL071-DB2-TABLE   05900000
059400            DISPLAY '** XLKUT071 RETURN  ** = ' XL071-RETURN-CODE 05910000
059500            PERFORM 9998-SQL-ABEND                                05920000
059600     END-EVALUATE.                                                05930000
059700*                                                                 05940000
059800******************************************************************05950000
059900**    CLOSE FILES.                                                05960000
060000******************************************************************05970000
060100 9000-END-PROCESS.                                                05980000
060200*                                                                 05990000
060300     WRITE CE-REPORT-RECORD                                       06000000
060400       FROM BL-BLANK-LINE                                         06010000
060500         AFTER ADVANCING 2 LINES.                                 06020000
060600*                                                                 06030000
060700     IF PS-END-OF-FILE AND                                        06040000
060800        PS-FIRST-TIME-YES                                         06050000
060900           PERFORM 1300-NO-DETAIL-LINE                            06060000
           ELSE                                                         06070000
               SET PS-SEND-EMAIL-YES TO TRUE                            06080000
061000     END-IF.                                                      06090000
061100                                                                  06100000
061200     WRITE CE-REPORT-RECORD                                       06110000
061300       FROM END-OF-REPORT-LINE                                    06120000
061400         AFTER ADVANCING 3 LINES.                                 06130000
061500                                                                  06140000
061600     WRITE CE-REPORT-RECORD                                       06150000
061700       FROM BL-BLANK-LINE                                         06160000
061800         AFTER ADVANCING 2 LINES.                                 06170000
061900                                                                  06180000
062000     CLOSE CE-FILE                                                06190000
062100           CE-REPORT-FILE.                                        06200000
062200*                                                                 06210000
062300*                                                                 06220000
062400******************************************************************06230000
062500**    SQL ERROR PROCESSING.                                       06240000
062600******************************************************************06250000
062700 9998-SQL-ABEND.                                                  06260000
062800     MOVE SQLCODE     TO PV-SQLCODE.                              06270000
062900     DISPLAY '** ABEND           ** = SQLABEND'.                  06280000
063000     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          06290000
063100     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME        06300000
063200     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        06310000
063300     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   06320000
063400     DISPLAY '**                 ** = ' PV-DB2-OPERATION-MSG-2.   06330000
063500     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               06340000
063600     COPY DPPD004.                                                06350000
063700                                                                  06360000
063800     MOVE +4013                  TO PV-ABEND-CODE.                06370000
063900     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       06380000
064000*                                                                 06390000
064100*                                                                 06400000
