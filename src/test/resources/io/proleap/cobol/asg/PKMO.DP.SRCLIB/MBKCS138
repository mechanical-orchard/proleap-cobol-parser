00001 *                                                                 06/04/92
00002 *                                                                 MBKCS138
00003 *                                                                    LV002
00004  IDENTIFICATION DIVISION.                                            CL**2
00005                                                                      CL**2
00006  PROGRAM-ID.    MBKCS138.                                            CL**2
00007  AUTHOR.        JO ANN  M. SCHMIDT.                                  CL**2
00008  INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**2
00009  DATE-WRITTEN.  03-25-92.                                            CL**2
00010  DATE-COMPILED.                                                      CL**2
00011                                                                      CL**2
00012 *****************************************************************    CL**2
00013 *    WORKER MAINTENANCE MODULE                                       CL**2
00014 *                                                                    CL**2
00015 *    THIS PROGRAM ALLOWS THE USER TO PERFORM MAINTENANCE             CL**2
00016 *    FUNCTIONS FOR THE WORKER DATABASE. THE PROGRAM IS ACCESSED      CL**2
00017 *    FROM THE WORKER SELECTION SCREEN OR THE WORKER LIST SCREEN.     CL**2
00018 *    SPECIFIC DETAILS WILL BE RECEIVED FROM THE INTER APPLICATION.   CL**2
00019 *                                                                    CL**2
00020 *                                                                    CL**2
00021 *    1. ACCESSED FROM THE SELECTION CRITERIA SCREEN                  CL**2
00022 *                                                                    CL**2
00023 *       COMMAREA IS 'MBWS007'                                        CL**2
00024 *                                                                    CL**2
00025 *          MBAWORKR - 'WORKER ADD'  OR                               CL**2
00026 *          MBDWORKR - 'WORKER DELETE'                                CL**2
00027 *             - WILL NOT CONTAIN A LAST NAME                         CL**2
00028 *               (EITHER ASTERISKS OR BLANKS)                         CL**2
00029 *             - THE USER ID MAY BE PASSED                            CL**2
00030 *               (EITHER BLANKS, OR CHARACTERS)                       CL**2
00031 *                                                                    CL**2
00032 *          MBUWORKR - WORKER UPDATE                                  CL**2
00033 *             - MAY CONTAIN A LAST NAME, PARTIAL LAST NAME           CL**2
00034 *               WITH TRAILING '*', ASTERISKS OR BLANKS               CL**2
00035 *             - THE USER ID MAY BE PASSED AS EITHER BLANKS,          CL**2
00036 *               CHARACTERS, OR A PARTIAL USER ID WITH A '*'          CL**2
00037 *                                                                    CL**2
00038 *    2. ACCESSED FROM THE WORKER LIST SCREEN                         CL**2
00039 *                                                                    CL**2
00040 *****************************************************************    CL**2
00041  EJECT                                                               CL**2
00042 *                                                                    CL**2
00043 *                                                                    CL**2
00044  ENVIRONMENT DIVISION.                                               CL**2
00045 *                                                                    CL**2
00046 *                                                                    CL**2
00047  DATA DIVISION.                                                      CL**2
00048 *                                                                    CL**2
00049 *                                                                    CL**2
00050  WORKING-STORAGE SECTION.                                            CL**2
00051                                                                      CL**2
00052  01  PC-PROGRAM-CONSTANTS.                                           CL**2
00053      05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.   CL**2
00054      05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072     CL**2
00055                                                      COMP SYNC.      CL**2
00056      05  PC-MAX-RETRIES                 PIC S9(05)   VALUE +5.       CL**2
00057      05  PC-MAX-ITEMS-PER-BLOCK         PIC S9(04)   VALUE +12       CL**2
00058                                                      COMP SYNC.      CL**2
00059      05  PC-CURRENT-MAP-NAME            PIC X(08)                    CL**2
00060                                             VALUE 'MB138A  '.        CL**2
00061      05  PC-CURRENT-MAPSET-NAME         PIC X(08)                    CL**2
00062                                             VALUE 'MBKM138 '.        CL**2
00063      05  PC-CURRENT-PROGRAM-NAME        PIC X(08)                    CL**2
00064                                             VALUE 'MBKCS138'.        CL**2
00065      05  PC-WORKER-LIST-MNEMONIC        PIC X(08)                    CL**2
00066                                             VALUE 'MBLWORKR'.        CL**2
00067      05  PC-WORKER-UPDT-MNEMONIC        PIC X(08)                    CL**2
00068                                             VALUE 'MBUWORKR'.        CL**2
00069      05  PC-WORKER-ADD-MNEMONIC         PIC X(08)                    CL**2
00070                                             VALUE 'MBAWORKR'.        CL**2
00071      05  PC-WORKER-DEL-MNEMONIC         PIC X(08)                    CL**2
00072                                             VALUE 'MBDWORKR'.        CL**2
00073      05  PC-TSYMSG-NUMBERS.                                          CL**2
00074          10  PC-TSYMSG-00004           PIC 9(05)    VALUE 00004.     CL**2
00075 *            ** CONFIRM REQUEST **                                   CL**2
00076          10  PC-TSYMSG-00005           PIC 9(05)    VALUE 00005.     CL**2
00077          10  PC-TSYMSG-00034           PIC 9(05)    VALUE 00034.     CL**2
00078 *            ** ADD SUCCESSFUL **                                    CL**2
00079          10  PC-TSYMSG-00045           PIC 9(05)    VALUE 00045.     CL**2
00080 *            ** INVALID PF KEY **                                    CL**2
00081          10  PC-TSYMSG-00059           PIC 9(05)    VALUE 00059.     CL**2
00082 *            ** UPDATE SUCCESSFUL **                                 CL**2
00083          10  PC-TSYMSG-00069           PIC 9(05)    VALUE 00069.     CL**2
00084 *            ** TOP OF LIST REACHED **                               CL**2
00085          10  PC-TSYMSG-00070           PIC 9(05)    VALUE 00070.     CL**2
00086 *            ** BOTTOM OF LIST REACHED **                            CL**2
00087          10  PC-TSYMSG-00082           PIC 9(05)    VALUE 00082.     CL**2
00088 *            ** SPECIFIC VALUES IN ALL FIELDS REQUIRED **            CL**2
00089          10  PC-TSYMSG-00115           PIC 9(05)    VALUE 00115.     CL**2
00090 *            ** SUCCESSFUL DELETE **                                 CL**2
00091          10  PC-TSYMSG-00116           PIC 9(05)    VALUE 00116.     CL**2
00092 *            ** CANNOT DELETE, RECORD DOES NOT EXIST **              CL**2
00093          10  PC-TSYMSG-00117           PIC 9(05)    VALUE 00117.     CL**2
00094 *            ** CANNOT ADD, RECORD ALREADY EXISTS **                 CL**2
00095          10  PC-TSYMSG-00118           PIC 9(05)    VALUE 00118.     CL**2
00096 *            ** DELETE MUST BE REQUESTED BEFORE CONFIRM **           CL**2
00097          10  PC-TSYMSG-00134           PIC 9(05)    VALUE 00134.     CL**2
00098 *            ** NO DETAIL EXISTS **                                  CL**2
00099          10  PC-TSYMSG-00137           PIC 9(05)    VALUE 00137.     CL**2
00100 *            ** ASTERISK NOT VALID FOR SELECTED FUNCTION **          CL**2
00101          10  PC-TSYMSG-00158           PIC 9(05)    VALUE 00158.     CL**2
00102 *            ** CANNOT UPDATE, RECORD DOES NOT EXIST **              CL**2
00103          10  PC-TSYMSG-00231           PIC 9(05)    VALUE 00231.     CL**2
00104 *            ** UPDATE RESULTED IN A DUPLICATE **                    CL**2
00105          10  PC-TSYMSG-00232           PIC 9(05)    VALUE 00232.     CL**2
00106 *            ** RELATED INFO. EXISTS, ITEM DELETE NOT ALLOWED **     CL**2
00107          10  PC-TSYMSG-99901           PIC 9(05)    VALUE 99901.     CL**2
00108 *            ** INVALID INTER APPL COMMAREA **                       CL**2
00109                                                                      CL**2
00110  01  PM-PROGRAM-MESSAGES.                                            CL**2
00111      05  PM-PROGRAM-MESSAGE-1           PIC X(78)    VALUE           CL**2
00112          'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.               CL**2
00113      05  PM-PROGRAM-MESSAGE-2.                                       CL**2
00114          10  FILLER                     PIC X(39)    VALUE           CL**2
00115               'ERROR READING TWORKER TABLE; SQLCODE = '.             CL**2
00116          10  PM-SQLCODE-2               PIC Z(08)9-.                 CL**2
00117          10  FILLER                     PIC X(30)    VALUE SPACES.   CL**2
00118      05  PM-PROGRAM-MESSAGE-3.                                       CL**2
00119          10  FILLER                     PIC X(28)    VALUE           CL**2
00120               'INTER APPLICATION DATA ERROR'.                        CL**2
00121          10  FILLER                     PIC X(50)    VALUE SPACES.   CL**2
00122      05  PM-PROGRAM-MESSAGE-5.                                       CL**2
00123          10  FILLER                     PIC X(28)    VALUE           CL**2
00124               'ERROR DURING DELETE ATTEMPT '.                        CL**2
00125          10  FILLER                     PIC X(50)    VALUE SPACES.   CL**2
00126      05  PM-PROGRAM-MESSAGE-6.                                       CL**2
00127          10  FILLER                     PIC X(28)    VALUE           CL**2
00128               'ERROR DURING UPDATE ATTEMPT '.                        CL**2
00129          10  FILLER                     PIC X(50)    VALUE SPACES.   CL**2
00130      05  PM-PROGRAM-MESSAGE-7.                                       CL**2
00131          10  FILLER                     PIC X(36)    VALUE           CL**2
00132               'ERROR ATTEMPTING WORKER ADD FUNCTION'.                CL**2
00133          10  FILLER                     PIC X(42)    VALUE SPACES.   CL**2
00134      05  PM-PROGRAM-MESSAGE-22.                                      CL**2
00135          10  FILLER                     PIC X(39)    VALUE           CL**2
00136               'ERROR READING CICS TEMP STORAGE DATA = '.             CL**2
00137          10  PM-RESP-22                 PIC Z(08)9-.                 CL**2
00138          10  FILLER                     PIC X(30)    VALUE SPACES.   CL**2
00139      05  PM-PROGRAM-MESSAGE-23.                                      CL**2
00140          10  FILLER                     PIC X(40)    VALUE           CL**2
00141               'ERROR UPDATING CICS TEMP STORAGE DATA = '.            CL**2
00142          10  PM-RESP-23                 PIC Z(08)9-.                 CL**2
00143          10  FILLER                     PIC X(39)    VALUE SPACES.   CL**2
00144                                                                      CL**2
00145  01  PS-PROGRAM-SWITCHES.                                            CL**2
00146                                                                      CL**2
00147      05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.      CL**2
00148          88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.      CL**2
00149          88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.      CL**2
00150          88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.      CL**2
00151          88  PS-SEND-DATA-ONLY                       VALUE '4'.      CL**2
00152          88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.      CL**2
00153          88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.      CL**2
00154                                                                      CL**2
00155      05  PS-SAVE-DATA-SW                PIC X(01)    VALUE 'N'.      CL**2
00156          88  PS-SAVE-DATA                            VALUE 'Y'.      CL**2
00157          88  PS-DATA-NOT-SAVED                       VALUE 'N'.      CL**2
00158                                                                      CL**2
00159      05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.      CL**2
00160          88  PS-ERROR                                VALUE 'Y'.      CL**2
00161          88  PS-NO-ERROR                             VALUE 'N'.      CL**2
00162                                                                      CL**2
00163      05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.      CL**2
00164          88  PS-INTER-APPL-VALID                     VALUE 'Y'.      CL**2
00165          88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.      CL**2
00166                                                                      CL**2
00167      05  PS-CANNOT-EDIT-FIELDS-SW       PIC X(01)    VALUE 'Y'.      CL**2
00168          88  PS-CAN-EDIT-FIELDS                      VALUE 'Y'.      CL**2
00169          88  PS-CANNOT-EDIT-FIELDS                   VALUE 'N'.      CL**2
00170                                                                      CL**2
00171      05  PS-DELETE-ALLOWED-SW           PIC X(01)    VALUE 'N'.      CL**2
00172          88  PS-DELETE-NOT-ALLOWED                   VALUE 'N'.      CL**2
00173          88  PS-DELETE-ALLOWED                       VALUE 'Y'.      CL**2
00174                                                                      CL**2
00175      05  PS-ITEM-SELECTED-SW            PIC X(01)    VALUE 'N'.      CL**2
00176          88  PS-ITEM-SELECTED                        VALUE 'Y'.      CL**2
00177          88  PS-NO-ITEM-SELECTED                     VALUE 'N'.      CL**2
00178                                                                      CL**2
00179      05  PS-PATH-SW                     PIC X(01)    VALUE 'N'.      CL**2
00180          88  PS-NO-PATH                              VALUE 'N'.      CL**2
00181          88  PS-FWD-PATH                             VALUE 'F'.      CL**2
00182          88  PS-BKWD-PATH                            VALUE 'B'.      CL**2
00183                                                                      CL**2
00184      05  PS-NEW-BLOCK-SW                PIC X(01)    VALUE 'N'.      CL**2
00185          88  PS-NEW-BLOCK                            VALUE 'Y'.      CL**2
00186          88  PS-NOT-NEW-BLOCK                        VALUE 'N'.      CL**2
00187                                                                      CL**2
00188  01  PV-PROGRAM-VARIABLES.                                           CL**2
00189      05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0        CL**2
00190                                                      COMP SYNC.      CL**2
00191      05  PV-MSG-NUMBER-X                PIC X(05)    VALUE SPACES.   CL**2
00192      05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.   CL**2
00193                                                                      CL**2
00194      05  PV-SQL-WKR-SUB                 PIC S9(05)   VALUE +0.       CL**2
00195                                                                      CL**2
00196      05  PV-USERID                      PIC X(08)    VALUE           CL**2
00197                                                        LOW-VALUES.   CL**2
00198      05  PV-TWORKER-WKR-NBR             PIC S9(6)                    CL**2
00199                                             COMP-3   VALUE ZEROS.    CL**2
00200                                                                      CL**2
00201      05  PV-TERMINATE-SW                PIC X(01)    VALUE 'N'.      CL**2
00202          88  PV-TERMINATE-EDIT                       VALUE 'Y'.      CL**2
00203                                                                      CL**2
00204      05  PV-MAX-ENTRIES                 PIC S9(06)                   CL**2
00205                                             COMP-3   VALUE ZEROS.    CL**2
00206                                                                      CL**2
00207      05  PV-INSPECT-CTR                 PIC S9(03)   VALUE +0.       CL**2
00208                                                                      CL**2
00209      05  PV-INSPECT-FLD-LGTH            PIC S9(03)                   CL**2
00210                                         COMP-3       VALUE +0.       CL**2
00211      05  PV-INSPECT-FIELD.                                           CL**2
00212          10  PV-INSPECT-FIELD-BYTE      OCCURS 1 TO 99 TIMES         CL**2
00213                                         DEPENDING ON                 CL**2
00214                                         PV-INSPECT-FLD-LGTH.         CL**2
00215              15  FILLER                 PIC X(01).                   CL**2
00216                                                                      CL**2
00217                                                                      CL**2
00218  EJECT                                                               CL**2
00219 *****************************************************************    CL**2
00220 *    STANDARD COMMAREA.                                              CL**2
00221 *****************************************************************    CL**2
00222                                                                      CL**2
00223      COPY DPWS020.                                                   CL*24
00224      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**2
00225                                                                      CL**2
00226  EJECT                                                               CL**2
00227 *****************************************************************    CL**2
00228 *    INTER-APPLICATION COMMAREA.                                     CL**2
00229 *     ( FOR MODULES MBKCS138 THRU MBKCS138 )                         CL**2
00230 *****************************************************************    CL**2
00231                                                                      CL**2
00232          10  INTER-APPL-COMM-AREA           PIC X(200).              CL**2
00233      COPY MBWS007.                                                   CL*23
00234                                                                      CL**2
00235  EJECT                                                               CL**2
00236 *****************************************************************    CL**2
00237 *    SPECIFIC COMMMAREA FOR MBKCS138.                                CL**2
00238 *    MAX LENGTH:  2865 BYTES   USED: 881                             CL**2
00239 *****************************************************************    CL**2
00240                                                                      CL**2
00241          10  APPLICATION-SPECIFIC-COMMAREA.                          CL**2
00242                                                                      CL**2
00243              15  MB138-APPL-CURSOR-POSITION      PIC S9(04)          CL**2
00244                                                       COMP.          CL**2
00245              15  MB138-BLOCK-NUMBER              PIC S9(04)          CL**2
00246                                                       COMP.          CL**2
00247              15  MB138-LIST-ITEM                 PIC S9(04)          CL**2
00248                                                       COMP.          CL**2
00249              15  MB138-HOLD-TSQ-IDX              PIC S9(04)          CL**2
00250                                                       COMP.          CL**2
00251              15  MB138-HOLD-TSQ-BLK-NBR          PIC S9(04)          CL**2
00252                                                       COMP.          CL**2
00253                                                                      CL**2
00254 *            15  MB138-ACTION                    PIC X(01).          CL**2
00255                                                                      CL**2
00256              15  MB138-TS-QUEUE.                                     CL**2
00257                  20  MB138-TEMP-QUEUE-NAME.                          CL**2
00258                      25  MB138-TERM-ID           PIC X(04).          CL**2
00259                      25  MB138-TAST-NUMBER       PIC S9(07)          CL**2
00260                                                       COMP-3.        CL**2
00261                                                                      CL**2
00262              15  MB138-ITEM-PROCESSED-SW         PIC X(01).          CL**2
00263                  88  MB138-ITEM-PROCESSED              VALUE 'Y'.    CL**2
00264                  88  MB138-ITEM-NOT-PROCESSED          VALUE 'N'.    CL**2
00265                                                                      CL**2
00266              15  MB138-LIST-ITEM-SW              PIC X(01).          CL**2
00267                  88 MB138-RESET-LIST-ITEM              VALUE 'N'.    CL**2
00268                  88 MB138-1ST-LIST-ITEM                VALUE 'F'.    CL**2
00269                  88 MB138-LAST-LIST-ITEM               VALUE 'L'.    CL**2
00270                                                                      CL**2
00271              15  MB138-SAVE-INTER-APPL-COMMAREA.                     CL**2
00272                  20  FILLER                      PIC X(018).         CL**2
00273                  20  MB138-NBR-SELECTED-ITEMS    PIC S9(09)          CL**2
00274                                                  COMP-3.             CL**2
00275                  20  FILLER                      PIC X(176).         CL*16
00276                                                                      CL**2
00277                  20  MB138-NO-FIELD-EDIT-SW      PIC X(01).          CL*16
00278                      88  MB138-NO-FIELD-EDIT     VALUE ' '.          CL*16
00279                      88  MB138-FIELD-EDIT        VALUE 'E'.          CL*16
00280                                                                      CL*16
00281              15  MB138-TSQ-LIST-AREA.                                CL*16
00282 ******************************************************************   CL**2
00283 *                                                                *   CL**2
00284 *   THIS IS LSIT TS QUEUE RECORD LAYOUT USED IN MBKCS137 AND     *   CL**2
00285 *   PASSED TO MBKCS138, THE WORKER MAINTENANCE MODULE.           *   CL**2
00286 *                                                                *   CL**2
00287 *   NOTE!  THERE IS NO 01 LEVEL DEFINED HERE.                    *   CL**2
00288 *                                                                *   CL**2
00289 *   SIZE: 661  BYTES = 55 X 12 ITEMS + 1                         *   CL**2
00290 ******************************************************************   CL**2
00291                18  MB007Q-TSQ-LIST.                                  CL**2
00292                                                                      CL**2
00293                  20  MB007Q-BLOCK-MODIFIED-SW        PIC X(01).      CL**2
00294                      88  MB007Q-BLOCK-NOT-MODIFIED   VALUE 'N'.      CL**2
00295                      88  MB007Q-BLOCK-MODIFIED       VALUE 'Y'.      CL**2
00296                  20  MB007Q-ITEM-ARRAY.                              CL**2
00297                      25  MB007Q-ITEM-ENTRIES OCCURS 12 TIMES         CL**2
00298                                            INDEXED BY MB007Q-IDX.    CL**2
00299                          30  MB007Q-LIST-ITEM-NBR    PIC S9(09)      CL**2
00300                                                          COMP-3.     CL**2
00301                          30  MB007Q-SELECTED-SW      PIC X(01).      CL**2
00302                              88  MB007Q-NO-SELECT    VALUE ' '.      CL**2
00303                              88  MB007Q-SELECT       VALUE 'S'.      CL**2
00304                              88  MB007Q-BEGIN        VALUE 'B'.      CL**2
00305                              88  MB007Q-END          VALUE 'E'.      CL**2
00306                              88  MB007Q-MAINTAINED                   CL**2
00307                                    VALUES 'D' 'I' 'U'.               CL**2
00308                          30  MB007Q-REC-ACTION       PIC X(03).      CL**2
00309                          30  MB007Q-WKR-OPERCO       PIC X(02).      CL**2
00310                          30  MB007Q-WKR-NBR          PIC X(06).      CL**2
00311                          30  MB007Q-WKR-UID-NBR      PIC X(08).      CL**2
00312                          30  MB007Q-WKR-LNAME        PIC X(18).      CL**2
00313                          30  MB007Q-WKR-FNAME        PIC X(12).      CL**2
00314                                                                      CL**2
00315  EJECT                                                               CL**2
00316 *****************************************************************    CL**2
00317 *    MAP LAYOUT                                                      CL**2
00318 *****************************************************************    CL**2
00319                                                                      CL**2
00320      COPY MBKM138.                                                   CL**2
00321                                                                      CL**2
00322  01  MD-MAP-DATA-AREA REDEFINES MB138AO.                             CL**2
00323      05  FILLER                         PIC X(449).                  CL**2
00324                                                                      CL**2
00325  EJECT                                                               CL**2
00326 *****************************************************************    CL**2
00327 *    STANDARD ATTENTION IDENTIFIER LIST                              CL**2
00328 *****************************************************************    CL**2
00329                                                                      CL**2
00330      COPY DFHAID.                                                    CL**2
00331                                                                      CL**2
00332  EJECT                                                               CL**2
00333 *****************************************************************    CL**2
00334 *    TOGGLE FUNCTION KEY LINES COPYBOOK.                             CL**2
00335 *****************************************************************    CL**2
00336                                                                      CL**2
00337      COPY DPWS009.                                                   CL**2
00338                                                                      CL**2
00339  EJECT                                                            MBKCS101
      *****************************************************************         
      *    SYSTEM MESSAGE FIELDS                                                
      *****************************************************************         
                                                                                
           COPY DPWS006.                                                        
                                                                                
       EJECT                                                               CL**2
00340 *****************************************************************    CL**2
00341 *    FUNCTION KEYS COPYBOOK.                                         CL**2
00342 *****************************************************************    CL**2
00343                                                                      CL**2
00344      COPY DPWS016.                                                   CL**2
00345                                                                      CL**2
00346  EJECT                                                               CL**2
00347 *****************************************************************    CL**2
00348 * ?? STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST           CL**2
00349 *****************************************************************    CL**2
00350                                                                      CL**2
00351      COPY DFHBMSCA.                                                  CL**2
00352                                                                      CL**2
00353  EJECT                                                               CL**2
00354 *****************************************************************    CL**2
00355 *    ATTRIBUTE SETTINGS COPYBOOK.                                    CL**2
00356 *****************************************************************    CL**2
00357                                                                      CL**2
00358      COPY DPWS015.                                                   CL**2
00359                                                                      CL**2
00360  EJECT                                                               CL**2
00361 *****************************************************************    CL**2
00362 *    CURRENT DATE AND TIME COPYBOOK.                                 CL**2
00363 *****************************************************************    CL**2
00364                                                                      CL**2
00365      COPY DPWS017.                                                   CL**2
00366                                                                      CL**2
00367  EJECT                                                               CL**2
00368 *****************************************************************    CL**2
00369 *    NUMERIC DATE EDIT ROUTINE WORKING STORAGE                       CL**2
00370 *****************************************************************    CL**2
00371                                                                      CL**2
00372      COPY DPWS010I.                                                  CL**2
00373                                                                      CL**2
00374  EJECT                                                               CL**2
00375 *****************************************************************    CL**2
00376 *    ALPHA NUMERIC FIELD EDIT ROUTINE WORKING STORAGE                CL**2
00377 *****************************************************************    CL**2
00378                                                                      CL**2
00379      COPY DPWS025.                                                   CL**2
00380                                                                      CL**2
00381  EJECT                                                               CL**2
00382 *****************************************************************    CL**2
00383 *    DPKUT045 COPYBOOK.                                              CL**2
00384 *    IT IS USED TO CONVERT EIBAID CHARACTERS RECEIVED FROM A         CL**2
00385 *    TERMINAL TO AN INTEGER VALUE OF 1 THRU 29. THIS VALUE IS        CL**2
00386 *    STORED IN 'DP020-SRC-AID' AND IS USED TO INTEROGATE THE         CL**2
00387 *    'DP020-FUNCTION-KEY-ARRAY' TABLE OF THE STANDARD COMMAREA.      CL**2
00388 *    THIS DETERMINES WHAT IS TO BE DONE NEXT.                        CL**2
00389 *****************************************************************    CL**2
00390                                                                      CL**2
00391      COPY DPWS045.                                                   CL**2
00392                                                                      CL**2
00393  EJECT                                                               CL**2
00394 *****************************************************************    CL**2
00395 *    SYSTEM MESSAGES RECORD LAYOUT                                   CL**2
00396 *****************************************************************    CL**2
00397                                                                      CL**2
00398      COPY DPRD507I.                                                  CL**2
00399                                                                      CL**2
00400  EJECT                                                               CL**2
00401 *****************************************************************    CL**2
00402 *    ABEND PROCESSING COPYBOOK.                                      CL**2
00403 *****************************************************************    CL**2
00404                                                                      CL**2
00405      COPY DPWS013.                                                   CL**2
00406                                                                      CL**2
00407  EJECT                                                               CL**2
00408 *****************************************************************    CL**2
00409 *    DB2 COMMUNICATIONS AREA                                         CL**2
00410 *****************************************************************    CL**2
00411                                                                      CL**2
00412      EXEC SQL                                                        CL**2
00413          INCLUDE SQLCA                                               CL**2
00414      END-EXEC.                                                       CL**2
00415                                                                      CL**2
00416  EJECT                                                               CL**2
00417 *****************************************************************    CL**2
00418 *    DB2 WORKER TABLE                                                CL**2
00419 *****************************************************************    CL**2
00420                                                                      CL**2
00421      EXEC SQL                                                        CL**2
00422          INCLUDE TWORKER                                             CL**2
00423      END-EXEC.                                                       CL**2
00424                                                                      CL**2
00425  EJECT                                                               CL**2
00426 *****************************************************************    CL**2
00427 *    DB2 CURSOR DECLARATION                                          CL**2
00428 *****************************************************************    CL**2
00429                                                                      CL**2
00430      EXEC SQL                                                        CL**2
00431          DECLARE WORKER-RECS CURSOR                                  CL**2
00432          FOR SELECT                                                  CL**2
00433                     OPERCO_NBR                                       CL**2
00434                   , WORKER_NBR                                       CL**2
00435                   , UID_NBR                                          CL**2
00436                   , LAST_NAME                                        CL**2
00437                   , FIR_NAME                                         CL**2
00438          FROM                                                        CL**2
00439                   TWORKER                                            CL**2
00440          WHERE                                                       CL**2
00441                     UID_NBR  LIKE :PV-USERID                         CL**3
00442          ORDER BY                                                    CL**2
00443                     LAST_NAME                                        CL**2
00444      END-EXEC.                                                       CL**2
00445                                                                      CL**2
00446  EJECT                                                               CL**2
00447 *****************************************************************    CL**2
00448 *    DB2 RESPONSABILITY TABLE                                        CL**2
00449 *****************************************************************    CL**2
00450                                                                      CL**2
00451      EXEC SQL                                                        CL**2
00452          INCLUDE TRSPBAR                                             CL**2
00453      END-EXEC.                                                       CL**2
00454                                                                      CL**2
00455  EJECT                                                               CL**2
00456 *****************************************************************    CL**2
00457 *    LINKAGE SECTION                                                 CL**2
00458 *****************************************************************    CL**2
00459 *                                                                    CL**2
00460  LINKAGE SECTION.                                                    CL**2
00461                                                                      CL**2
00462  01  DFHCOMMAREA.                                                    CL**2
00463      05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**2
00464                                         DEPENDING ON EIBCALEN.       CL**2
00465          10  FILLER                     PIC X.                       CL**2
00466                                                                      CL**2
00467  EJECT                                                               CL**2
00468 *                                                                    CL**2
00469 *                                                                    CL**2
00470 *                                                                    CL**2
00471  PROCEDURE DIVISION.                                                 CL**2
00472                                                                      CL**2
00473  A0000-MAIN-MODULE.                                                  CL**2
00474 ******************************************************************   CL**2
00475 *    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.              CL**2
00476 *                                                                    CL**2
00477 *    'DP020-SRC-RETURN-W-TRAN-ID'                                    CL**2
00478 *    WILL BE SET TO A VALUE OF TRUE IF THIS PROGRAM WAS SENT         CL**2
00479 *    A STANDARD COMMAREA. IF IT IS NOT SET TRUE (MEANING OTHER       CL**2
00480 *    THAN A STANDARD COMMAREA WAS SENT TO THIS PROGRAM) THIS         CL**2
00481 *    PROGRAM WILL RETURN TO CICS.                                    CL**2
00482 ******************************************************************   CL**2
00483                                                                      CL**2
00484      PERFORM DP015-0000-CHECK-COMMAREA.                              CL**2
00485                                                                      CL**2
00486      IF DP020-SRC-RETURN-W-TRAN-ID                                   CL**2
00487          PERFORM B1000-CONTROL-PROCESSING                            CL**2
00488      END-IF.                                                         CL**2
00489                                                                      CL**2
00490      PERFORM DP003-0000-RETURN-TO-CICS.                              CL**2
00491                                                                      CL**2
00492  EJECT                                                               CL**2
00493                                                                      CL**2
00494  B1000-CONTROL-PROCESSING.                                           CL**2
00495 ******************************************************************   CL**2
00496 *    EVAULATE THE ACTION TO BE TAKEN WITHIN THIS MODULE.             CL**2
00497 *                                                                    CL**2
00498 *    PERFORM THE APPROPRIATE PARAGRAPH BASED ON WHAT THE NEXT        CL**2
00499 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                       CL**2
00500 ******************************************************************   CL**2
00501                                                                      CL**2
00502      EVALUATE TRUE                                                   CL**2
00503                                                                      CL**2
00504          WHEN DP020-NEXT-ACT-INITIAL                                 CL**2
00505              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL**2
00506                                                                      CL**2
00507              SET PS-INTER-APPL-NOT-VALID TO TRUE                     CL**2
00508              IF DP020-MB-WORKER-LIST                                 CL**2
00509                  IF MB007-NUMBER-OF-SELECTED-ITEMS > +0              CL**2
00510                      SET PS-INTER-APPL-VALID TO TRUE                 CL**2
00511                  END-IF                                              CL**2
00512              END-IF                                                  CL**2
00513              IF DP020-MB-WORKER-SELECT                               CL**2
00514                  IF DP020-SRC-AID = LOW-VALUES                       CL**2
00515 *                   (ENTER KEY WAS HIT TO GET HERE,                  CL**2
00516 *                    RATHER THAN ONE OF THE FUNCTION KEYS)           CL**2
00517                      SET PS-INTER-APPL-NOT-VALID TO TRUE             CL**2
00518                  ELSE                                                CL**2
00519                      SET PS-INTER-APPL-VALID TO TRUE                 CL**2
00520                  END-IF                                              CL**2
00521              END-IF                                                  CL**2
00522                                                                      CL**2
00523              IF PS-INTER-APPL-VALID                                  CL**2
00524                  MOVE MB007-INTER-APPL-COMMAREA                      CL**2
00525                    TO MB138-SAVE-INTER-APPL-COMMAREA                 CL**2
00526                  PERFORM D2000-BUILD-INITIAL-PANEL                   CL**2
00527              ELSE                                                    CL**2
00528                  SET DP020-MSG-FATAL          TO TRUE                CL**2
00529                  MOVE PC-TSYMSG-99901         TO DP020-MSG-NUMBER    CL**2
00530                  PERFORM S4000-SETUP-INTER-APPL                      CL**2
00531                  PERFORM S9000-RETURN-TO-PREV-TRAN                   CL**2
00532              END-IF                                                  CL**2
00533                                                                      CL**2
00534          WHEN DP020-NEXT-ACT-READ-MAP                                CL**2
00535              SET PS-SEND-DATA-ONLY-FRSET TO TRUE                     CL**2
00536              PERFORM C1000-PROCESS-PANEL                             CL**2
00537                                                                      CL**2
00538          WHEN DP020-NEXT-ACT-RETURN                                  CL**2
00539              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL**2
00540                                                                      CL**2
00541              IF MB007-ADD-SUCCESSFUL                                 CL**2
00542                  SET DP020-MSG-INFORMATIONAL TO TRUE                 CL**2
00543                  MOVE PC-TSYMSG-00034 TO DP020-MSG-NUMBER            CL**2
00544                  PERFORM S9000-RETURN-TO-PREV-TRAN                   CL**2
00545              END-IF                                                  CL**2
00546              IF MB007-DELETE-SUCCESSFUL                              CL**2
00547                  SET DP020-MSG-INFORMATIONAL TO TRUE                 CL**2
00548                  MOVE PC-TSYMSG-00115 TO DP020-MSG-NUMBER            CL**2
00549                  PERFORM S9000-RETURN-TO-PREV-TRAN                   CL**2
00550              END-IF                                                  CL**2
00551              IF MB007-UPDATE-SUCCESSFUL                              CL**2
00552                 SET DP020-MSG-INFORMATIONAL TO TRUE                  CL**2
00553                 MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER             CL**2
00554                 PERFORM S9000-RETURN-TO-PREV-TRAN                    CL**2
00555              END-IF                                                  CL**2
00556                                                                      CL**2
00557              MOVE MB138-SAVE-INTER-APPL-COMMAREA                     CL**2
00558                TO MB007-INTER-APPL-COMMAREA                          CL**2
00559                                                                      CL**2
00560              IF MB007-DELETE-REQUESTED                               CL**2
00561                  CONTINUE                                            CL**2
00562              ELSE                                                    CL**2
00563                  PERFORM E1000-EDIT-DATA-IN-COMMAREA                 CL**2
00564              END-IF                                                  CL**2
00565                                                                      CL**2
00566              PERFORM S5000-DISPLAY-PANEL                             CL**2
00567                                                                      CL**2
00568          WHEN DP020-NEXT-ACT-ERROR                                   CL**2
00569 ******************************************************************   CL**2
00570 *    THE FOLLOWING CODE HAS BEEN INSERTED IN ORDER TO PRESERVE       CL**2
00571 *    THE ERROR MESSAGE BEING RETURNED FROM THE NAVIGATOR. SINCE      CL**2
00572 *    THE ERROR BEING RETURNED WILL TYPICALLY BE A SECURITY           CL**2
00573 *    VIOLATION OR THE UNAVAILABILITY OF THE REQUESTED TRANSACTION    CL**2
00574 *    THIS CODE ALSO CHECKS TO SEE HOW THE NAVIGATION REQUEST WAS     CL**2
00575 *    INVOKED. IF 'DP020-NAV-MNEMONIC' FIELD IN THE STANDARD          CL**2
00576 *    COMMAREA IS SPACES, THE NAVIGATION REQUEST WAS VIA A FUNCTION   CL**2
00577 *    KEY. IF NOT, IT WAS VIA A COMMAND ENTERED IN THE COMMAND LINE   CL**2
00578 *    COMMAND FIELD AND THIS LOGIC SETS THE ATTRIBUTE FOR THIS FIEL   CL**2
00579 *    TO RED, REVERSE VIDEO.                                          CL**2
00580 ******************************************************************   CL**2
00581              MOVE DP020-MSG-NUMBER-X  TO PV-MSG-NUMBER-X             CL**2
00582              MOVE DP020-MSG-MESSAGE   TO PV-MESSAGE                  CL**2
00583                                                                      CL**2
00584              IF DP020-NAV-MNEMONIC = SPACES                          CL**2
00585                  MOVE SPACES              TO ANAVCMDO                CL**2
00586                  MOVE DP015-GREEN         TO ANAVCMDC                CL**2
00587                  MOVE DP015-UNDERLINE     TO ANAVCMDH                CL**2
00588              ELSE                                                    CL**2
00589                  MOVE DP015-RED           TO ANAVCMDC                CL**2
00590                  MOVE DP015-REVERSE       TO ANAVCMDH                CL**2
00591              END-IF                                                  CL**2
00592                                                                      CL**2
00593              SET PS-SEND-DATA-ONLY-FRSET  TO TRUE                    CL**2
00594                                                                      CL**2
00595              MOVE PV-MESSAGE TO DP020-MSG-MESSAGE                    CL**2
00596              MOVE -1                      TO ANAVCMDL                CL**2
00597                                                                      CL**2
00598              PERFORM S5000-DISPLAY-PANEL                             CL**2
00599                                                                      CL**2
00600          WHEN OTHER                                                  CL**2
00601              SET DP013-LOGIC-ABEND        TO TRUE                    CL**2
00602              SET DP013-NO-ROLLBACK        TO TRUE                    CL**2
00603                                                                      CL**2
00604              MOVE 'B1000-CONTROL-PROCESSING' TO                      CL**2
00605                   DP013-PARAGRAPH                                    CL**2
00606                                                                      CL**2
00607              MOVE PM-PROGRAM-MESSAGE-1      TO                       CL**2
00608                   DP013-MESSAGE-TEXT(1)                              CL**2
00609                                                                      CL**2
00610              PERFORM DP013-0000-PROCESS-ABEND                        CL**2
00611                                                                      CL**2
00612      END-EVALUATE.                                                   CL**2
00613                                                                      CL**2
00614  EJECT                                                               CL**2
00615                                                                      CL**2
00616  C1000-PROCESS-PANEL.                                                CL**2
00617 ******************************************************************   CL**2
00618 *    RECEIVE THE MAP.                                                CL**2
00619 *    FOR ALL FUNCTION KEYS (OTHER THAN CLEAR OR REFRESH)             CL**2
00620 *       MOVE THE SCREEN FIELDS TO THE COMMAREA.                      CL**2
00621 *    PERFORM APPROPRIATE PARAGRAPH BASED ON THE                      CL**2
00622 *       FUNCTION KEY SELECTED.                                       CL**2
00623 ******************************************************************   CL**2
00624                                                                      CL**2
00625      SET MB007Q-IDX TO MB138-HOLD-TSQ-IDX.                           CL**2
00626      MOVE MB138-HOLD-TSQ-BLK-NBR TO MB138-BLOCK-NUMBER.              CL**2
00627                                                                      CL**2
00628      PERFORM DP007-0000-GET-PANEL.                                   CL**2
00629                                                                      CL**2
00630      IF (DP020-SRC-AID NOT = DP016-PF5)  AND                         CL**2
00631         (DP020-SRC-AID NOT = DP016-CLEAR)                            CL**2
00632          PERFORM D1000-MOVE-SCREEN-TO-COMMAREA                       CL**2
00633      END-IF.                                                         CL**2
00634                                                                      CL**2
00635      IF NOT DP020-FK-CONFIRM(DP020-SRC-AID)                          CL**2
00636          SET MB007-DEL-NOT-REQUESTED TO TRUE                         CL**2
00637      END-IF.                                                         CL**2
00638                                                                      CL**2
00639      EVALUATE TRUE                                                   CL**2
00640                                                                      CL**2
00641          WHEN DP020-SRC-AID = DP016-CLEAR                            CL**2
00642              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL**2
00643              PERFORM E1000-EDIT-DATA-IN-COMMAREA                     CL**2
00644              PERFORM S5000-DISPLAY-PANEL                             CL**2
00645                                                                      CL**2
00646          WHEN DP020-FK-REFRESH(DP020-SRC-AID)                        CL**2
00647              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL**2
00648              SET PS-NO-ERROR TO TRUE                                 CL*10
00649              INITIALIZE ANAVCMDO ANAVKEYO                            CL**2
00650              MOVE SPACES TO DP020-NAV-KEY-DATA                       CL**2
00651              IF (DP020-SRC-MNEMONIC = PC-WORKER-ADD-MNEMONIC)        CL**2
00652                  MOVE SPACES TO MB007-LAST-NAME                      CL**2
00653                  MOVE SPACES TO MB007-FIR-NAME                       CL**2
00654                  MOVE SPACES TO MB007-USERID                         CL**2
00655              ELSE                                                    CL**4
00656                  PERFORM E2000-FORMAT-WORKER-RECORD                  CL**4
00657                  PERFORM F1000-RETRIEVE-RECORD                       CL**4
00658              END-IF                                                  CL**4
00659              PERFORM S5000-DISPLAY-PANEL                             CL**2
00660                                                                      CL**2
00661          WHEN DP020-SRC-AID = DP016-PA2                              CL**2
00662              SET PS-SEND-DATA-ONLY TO TRUE                           CL**2
00663              PERFORM DP009-0000-LOAD-FK-LINES                        CL**2
00664              PERFORM DP017-0000-GET-CURR-DATE-TIME                   CL**2
00665              MOVE -1               TO ANAVCMDL                       CL**2
00666              PERFORM DP008-0000-WRITE-PANEL                          CL**2
00667                                                                      CL**2
00668          WHEN DP020-SRC-AID = DP016-ENTER                            CL**2
00669              IF (DP020-NAV-MNEMONIC = SPACES)     OR                 CL**2
00670                 (DP020-NAV-MNEMONIC = LOW-VALUES)                    CL**2
00671                                                                      CL**2
00672                  PERFORM E1000-EDIT-DATA-IN-COMMAREA                 CL**2
00673                                                                      CL**2
00674                  IF PS-ERROR                                         CL**3
00675                      CONTINUE                                        CL**3
00676                  ELSE                                                CL**3
00677                      IF (DP020-SRC-MNEMONIC =                        CL**6
00678                           PC-WORKER-ADD-MNEMONIC)                    CL**6
00679                          PERFORM E2000-FORMAT-WORKER-RECORD          CL**3
00680                          PERFORM F1000-RETRIEVE-RECORD               CL**3
00681                      ELSE                                            CL*14
00682                          PERFORM S1000-SELECT-TWORKER-NBR            CL*14
00683                          IF SQLCODE = +100                           CL*14
00684                              SET PS-CANNOT-EDIT-FIELDS TO TRUE       CL*14
00685                              SET DP020-MSG-FATAL       TO TRUE       CL*14
00686                              SET PS-ERROR              TO TRUE       CL*14
00687                              IF (DP020-SRC-MNEMONIC =                CL*14
00688                                  PC-WORKER-DEL-MNEMONIC)             CL*14
00689 *                               ** ROW NOT FOUND FOR DEL **          CL*14
00690                                 MOVE PC-TSYMSG-00116 TO              CL*14
00691                                               DP020-MSG-NUMBER       CL*14
00692                              END-IF                                  CL*14
00693                              IF (DP020-SRC-MNEMONIC =                CL*14
00694                                  PC-WORKER-UPDT-MNEMONIC)            CL*14
00695 *                               ** ROW NOT FOUND FOR UPDATE **       CL*14
00696                                 MOVE PC-TSYMSG-00158 TO              CL*14
00697                                               DP020-MSG-NUMBER       CL*14
00698                              END-IF                                  CL*14
00699                          END-IF                                      CL*14
00700                      END-IF                                          CL*14
00701                  END-IF                                              CL**3
00702                                                                      CL**2
00703                  IF MB007-LIST                                       CL**2
00704                      IF NOT ( DP020-SRC-MNEMONIC =                   CL**8
00705                               PC-WORKER-UPDT-MNEMONIC )              CL**8
00706                          PERFORM K4000-REBUILD-SCREEN                CL**6
00707                      END-IF                                          CL**6
00708                  END-IF                                              CL**6
00709                                                                      CL**2
00710                  PERFORM S5000-DISPLAY-PANEL                         CL**2
00711                                                                      CL**2
00712              ELSE                                                    CL**2
00713                  PERFORM S3000-NAVIGATE                              CL**2
00714              END-IF                                                  CL**2
00715                                                                      CL**2
00716          WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID) OR                  CL**2
00717               DP020-FK-RETURN(DP020-SRC-AID)                         CL**2
00718              PERFORM S4000-SETUP-INTER-APPL                          CL**2
00719              PERFORM DP015-1000-START-NAVIGATOR                      CL**2
00720                                                                      CL**2
00721          WHEN DP020-SRC-AID = DP016-PF13                             CL**2
00722 *            ** WORKER ADD (PF13) **                                 CL**2
00723                                                                      CL**2
00724              IF (DP020-SRC-MNEMONIC = PC-WORKER-ADD-MNEMONIC)        CL**2
00725                                                                      CL**2
00726                  IF MB007-ADD                                        CL**2
00727                                                                      CL**2
00728                      PERFORM D3000-PROCESS-ADD                       CL**2
00729                  ELSE                                                CL**2
00730 *                   ** ADD FUNCTION KEY (PF13) NOT VALID   **        CL**2
00731 *                   ** IF ACTION CODE PASSED WAS NOT ADD   **        CL**2
00732 *                   ** RETURN SCREEN WITH AN ERROR MESSAGE **        CL**2
00733                      PERFORM D6000-FUNCTION-ERROR                    CL**2
00734                  END-IF                                              CL**2
00735              ELSE                                                    CL**2
00736                  PERFORM D6000-FUNCTION-ERROR                        CL**2
00737              END-IF                                                  CL**2
00738                                                                      CL**2
00739              PERFORM S5000-DISPLAY-PANEL                             CL**2
00740                                                                      CL**2
00741          WHEN DP020-SRC-AID = DP016-PF15                             CL**2
00742 *            ** WORKER UPDATE (PF15) **                              CL**2
00743                                                                      CL**2
00744              IF (DP020-SRC-MNEMONIC = PC-WORKER-UPDT-MNEMONIC)       CL**2
00745                                                                      CL**2
00746                  IF MB007-LIST OR                                    CL**2
00747                     MB007-UPDATE                                     CL**2
00748                                                                      CL**2
00749                      PERFORM D4000-PROCESS-UPDATES                   CL**2
00750                  ELSE                                                CL**2
00751 *                   ** UPDATE FUNCTION KEY (PF15) NOT VALID **       CL**2
00752 *                   ** IF ACTION CODE PASSED WAS NOT UPDATE **       CL**2
00753 *                   ** RETURN SCREEN WITH AN ERROR MESSAGE  **       CL**2
00754                      PERFORM D6000-FUNCTION-ERROR                    CL**2
00755                  END-IF                                              CL**2
00756              ELSE                                                    CL**2
00757                  PERFORM D6000-FUNCTION-ERROR                        CL**2
00758              END-IF                                                  CL**2
00759                                                                      CL**2
00760              PERFORM S5000-DISPLAY-PANEL                             CL**2
00761                                                                      CL**2
00762          WHEN DP020-SRC-AID = DP016-PF16                             CL**2
00763 *            ** WORKER DELETE (PF16) **                              CL**2
00764                                                                      CL**2
00765              IF (DP020-SRC-MNEMONIC = PC-WORKER-DEL-MNEMONIC)        CL**2
00766                                                                      CL**2
00767                  IF MB007-DELETE OR                                  CL**2
00768                     MB007-LIST                                       CL**2
00769                                                                      CL**2
00770                      PERFORM E1000-EDIT-DATA-IN-COMMAREA             CL**2
00771                                                                      CL**2
00772                      IF PS-ERROR                                     CL**2
00773                          CONTINUE                                    CL**2
00774                      ELSE                                            CL**2
00775                          PERFORM E2000-FORMAT-WORKER-RECORD          CL**2
00776                          PERFORM F1000-RETRIEVE-RECORD               CL**2
00777                      END-IF                                          CL**2
00778                                                                      CL**2
00779                      IF PS-ERROR                                     CL**2
00780                          CONTINUE                                    CL**2
00781                      ELSE                                            CL**2
00782                          SET MB007-DELETE-REQUESTED  TO TRUE         CL**2
00783                          SET DP020-MSG-INFORMATIONAL TO TRUE         CL**2
00784 *                        ** SET CONFIRM REQUEST MESSAGE **           CL**2
00785                          MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER    CL**2
00786 *                        ** SINCE A DELETE IS REQUESTED, ALL  **     CL**2
00787 *                        ** ATTRIBUTES WILL BE SET TO NOT     **     CL**2
00788 *                        ** ALLOW EDITING IN PARA S5000.      **     CL**2
00789                      END-IF                                          CL**2
00790                                                                      CL**2
00791                  ELSE                                                CL**2
00792 *                  ** THE DELETE FUNCTION KEY (PF16) NOT VALID **    CL**2
00793 *                  ** IF ACTION CODE PASSED WAS NOT DELETE     **    CL**2
00794 *                  ** RETURN THE SCREEN WITH AN ERROR MESSAGE  **    CL**2
00795                      PERFORM D6000-FUNCTION-ERROR                    CL**2
00796                  END-IF                                              CL**2
00797              ELSE                                                    CL**2
00798                  PERFORM D6000-FUNCTION-ERROR                        CL**2
00799              END-IF                                                  CL**2
00800                                                                      CL**2
00801              PERFORM S5000-DISPLAY-PANEL                             CL**2
00802                                                                      CL**2
00803          WHEN DP020-FK-CONFIRM(DP020-SRC-AID)                        CL**2
00804                                                                      CL**2
00805              IF MB007-DELETE-REQUESTED                               CL**2
00806                  PERFORM D5000-PROCESS-DELETE                        CL**2
00807                                                                      CL**2
00808                  IF MB007-DELETE-SUCCESSFUL                          CL**2
00809                     CONTINUE                                         CL**2
00810                  ELSE                                                CL**2
00811                     SET MB007-DEL-NOT-REQUESTED TO TRUE              CL**2
00812                  END-IF                                              CL**2
00813                                                                      CL**2
00814              ELSE                                                    CL**2
00815                  MOVE PC-TSYMSG-00118 TO DP020-MSG-NUMBER            CL**2
00816                  PERFORM D6000-FUNCTION-ERROR                        CL**2
00817                                                                      CL**2
00818              END-IF                                                  CL**2
00819                                                                      CL**2
00820              PERFORM S5000-DISPLAY-PANEL                             CL**2
00821 *                                                                    CL**2
00822          WHEN DP020-FK-PREV-SELECTION(DP020-SRC-AID)                 CL**2
00823 *                                                                    CL**2
00824              IF MB007-LIST                                           CL**2
00825                  IF MB138-1ST-LIST-ITEM                              CL**2
00826                      PERFORM D7000-TEST-LIST-ITEM                    CL**2
00827                  ELSE                                                CL**2
00828 *                   * READ AND DISPLAY THE PREV SELECTED ITEM *      CL**2
00829                      SET MB138-ITEM-PROCESSED TO TRUE                CL**2
00830                      PERFORM K1500-REVERSE-LIST-QUEUE                CL**2
00831                      IF MB138-1ST-LIST-ITEM                          CL**2
00832                          PERFORM D7000-TEST-LIST-ITEM                CL**2
00833                      END-IF                                          CL**2
00834                  END-IF                                              CL**2
00835                  PERFORM K4000-REBUILD-SCREEN                        CL**2
00836              ELSE                                                    CL**2
00837                  PERFORM D6000-FUNCTION-ERROR                        CL**2
00838              END-IF                                                  CL**2
00839                                                                      CL**2
00840              PERFORM S5000-DISPLAY-PANEL                             CL**2
00841 *                                                                    CL**2
00842          WHEN DP020-FK-NEXT-SELECTION(DP020-SRC-AID)                 CL**5
00843 *                                                                    CL**2
00844              IF MB007-LIST                                           CL**2
00845                  IF MB138-LAST-LIST-ITEM                             CL**2
00846                      PERFORM D7000-TEST-LIST-ITEM                    CL**2
00847                  ELSE                                                CL**2
00848 *                   * READ AND DISPLAY THE NEXT SELECTED ITEM *      CL**2
00849                      SET MB138-ITEM-PROCESSED TO TRUE                CL**2
00850                      PERFORM K1000-READ-LIST-QUEUE                   CL**2
00851 *                    ** SET ITEM AS INQUIRED UPON **                 CL**2
00852                      PERFORM K2000-UPDATE-LIST-QUEUE                 CL**2
00853                      IF MB138-LAST-LIST-ITEM                         CL**2
00854                          PERFORM D7000-TEST-LIST-ITEM                CL**2
00855                      END-IF                                          CL**2
00856                  END-IF                                              CL**2
00857                  PERFORM K4000-REBUILD-SCREEN                        CL**2
00858              ELSE                                                    CL**2
00859                  PERFORM D6000-FUNCTION-ERROR                        CL**2
00860              END-IF                                                  CL**2
00861                                                                      CL**2
00862              PERFORM S5000-DISPLAY-PANEL                             CL**2
00863 *                                                                    CL**2
00864          WHEN OTHER                                                  CL**2
00865              PERFORM D6000-FUNCTION-ERROR                            CL**2
00866                                                                      CL*16
00867              IF PS-CANNOT-EDIT-FIELDS                                CL*16
00868                  SET MB138-FIELD-EDIT TO TRUE                        CL*16
00869              END-IF                                                  CL*16
00870                                                                      CL*16
00871              PERFORM DP015-1000-START-NAVIGATOR                      CL**2
00872                                                                      CL*16
00873              IF MB138-FIELD-EDIT                                     CL*16
00874                 SET PS-CANNOT-EDIT-FIELDS TO TRUE                    CL*17
00875              END-IF                                                  CL*16
00876              SET MB138-NO-FIELD-EDIT TO TRUE                         CL*16
00877                                                                      CL**2
00878      END-EVALUATE.                                                   CL**2
00879                                                                      CL**2
00880  EJECT                                                               CL**2
00881                                                                      CL**2
00882  D1000-MOVE-SCREEN-TO-COMMAREA.                                      CL**2
00883 ******************************************************************   CL**2
00884 *    SET THE APPLICATION COMMAREA WITH EITHER                        CL**2
00885 *    THE MAP FIELD (IF DATA ENTERED AT SCREEN)                       CL**2
00886 *    OR SPACES                                                       CL**2
00887 ******************************************************************   CL**2
00888                                                                      CL**2
00889      IF ALNAMEL > 0                                                  CL**2
00890         MOVE ALNAMEI             TO MB007-LAST-NAME                  CL**2
00891      ELSE                                                            CL**2
00892         IF ALNAMEF = DP015-ERASE-EOF                                 CL**2
00893            MOVE SPACES           TO MB007-LAST-NAME                  CL**2
00894         END-IF                                                       CL**2
00895      END-IF.                                                         CL**2
00896                                                                      CL**2
00897      IF AFNAMEL > 0                                                  CL**2
00898         MOVE AFNAMEI             TO MB007-FIR-NAME                   CL**2
00899      ELSE                                                            CL**2
00900         IF AFNAMEF = DP015-ERASE-EOF                                 CL**2
00901            MOVE SPACES           TO MB007-FIR-NAME                   CL**2
00902         END-IF                                                       CL**2
00903      END-IF.                                                         CL**2
00904                                                                      CL**2
00905      IF AUSERIDL   > 0                                               CL**2
00906         MOVE AUSERIDI            TO MB007-USERID                     CL**2
00907      ELSE                                                            CL**2
00908         IF AUSERIDF = DP015-ERASE-EOF                                CL**2
00909            MOVE SPACES           TO MB007-USERID                     CL**2
00910         END-IF                                                       CL**2
00911      END-IF.                                                         CL**2
00912                                                                      CL**2
00913  EJECT                                                               CL**2
00914                                                                      CL**2
00915  D2000-BUILD-INITIAL-PANEL.                                          CL**2
00916 ******************************************************************   CL**2
00917 *    DETERMINE IF THE INTIAL PANEL SHOULD BE BUILT WITH              CL**2
00918 *    DATA FROM THE 'TWORKER' DB2 TABLE, FROM A LIST SCREEN           CL**2
00919 *    TEMP STORAGE QUEUE, OR WITH INITIAL BLANKS                      CL**2
00920 ******************************************************************   CL**2
00921                                                                      CL**2
00922      IF DP020-MB-WORKER-LIST                                         CL**2
00923          PERFORM D2100-READ-TS-QUEUE                                 CL**2
00924          PERFORM K4000-REBUILD-SCREEN                                CL**2
00925      ELSE                                                            CL**2
00926          IF DP020-MB-WORKER-SELECT                                   CL**2
00927              PERFORM D2200-USE-MB137-COMMAREA                        CL**2
00928          END-IF                                                      CL**2
00929      END-IF.                                                         CL**2
00930                                                                      CL**2
00931      SET DP020-MB-WORKER-MAINT TO TRUE                               CL**2
00932      PERFORM S5000-DISPLAY-PANEL.                                    CL**2
00933                                                                      CL**2
00934  EJECT                                                               CL**2
00935                                                                      CL**2
00936  D2100-READ-TS-QUEUE.                                                CL**2
00937 ******************************************************************   CL**2
00938 *    BUILD THE INTIAL PANEL FROM THE LIST SCREEN TEMP STORAGE.       CL**2
00939 ******************************************************************   CL**2
00940                                                                      CL**2
00941      IF MB007-LIST-QUEUE-NAME > SPACES                               CL**2
00942                                                                      CL**2
00943          MOVE 1 TO MB138-BLOCK-NUMBER                                CL**2
00944                    MB138-HOLD-TSQ-BLK-NBR                            CL**2
00945          MOVE 0 TO MB138-LIST-ITEM                                   CL**2
00946          SET MB007Q-IDX TO +1                                        CL**2
00947          SET MB138-ITEM-NOT-PROCESSED TO TRUE                        CL**2
00948                                                                      CL**2
00949          PERFORM K1000-READ-LIST-QUEUE                               CL**2
00950 *        ** SET ITEM AS INQUIRED UPON **                             CL**2
00951          PERFORM K2000-UPDATE-LIST-QUEUE                             CL**2
00952                                                                      CL**2
00953          IF PS-ITEM-SELECTED AND                                     CL**2
00954             (NOT MB138-LAST-LIST-ITEM)                               CL**2
00955              SET MB138-1ST-LIST-ITEM TO TRUE                         CL**2
00956          END-IF                                                      CL**2
00957                                                                      CL**2
00958      ELSE                                                            CL**2
00959 *       ** QUEUE NAME ERROR COMMING FROM THE LIST SCREEN **          CL**2
00960          MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER                    CL**2
00961          MOVE -1              TO ANAVCMDL                            CL**2
00962          SET DP020-MSG-FATAL  TO TRUE                                CL**2
00963          SET PS-ERROR         TO TRUE                                CL**2
00964                                                                      CL**2
00965      END-IF.                                                         CL**2
00966                                                                      CL**2
00967  EJECT                                                               CL**2
00968                                                                      CL**2
00969  D2200-USE-MB137-COMMAREA.                                           CL**2
00970 ******************************************************************   CL**2
00971 *    BUILD THE INTIAL PANEL FROM THE MB137 COMMON COMMAREA.          CL**2
00972 ******************************************************************   CL**2
00973                                                                      CL**2
00974      IF MB007-LAST-NAME = SPACES AND                                 CL**2
00975         MB007-FIR-NAME = SPACES AND                                  CL**2
00976         MB007-USERID = SPACES                                        CL**2
00977                                                                      CL**2
00978          MOVE SPACES TO WORKER-LAST-NAME                             CL**2
00979          MOVE SPACES TO WORKER-FIR-NAME                              CL**2
00980          MOVE SPACES TO WORKER-UID-NBR                               CL**2
00981          SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**2
00982          MOVE PC-TSYMSG-00082 TO DP020-MSG-NUMBER                    CL**2
00983                                                                      CL**2
00984      ELSE                                                            CL**2
00985                                                                      CL**2
00986          PERFORM E2000-FORMAT-WORKER-RECORD                          CL**2
00987          PERFORM F1000-RETRIEVE-RECORD                               CL**2
00988                                                                      CL**2
00989      END-IF.                                                         CL**2
00990                                                                      CL**2
00991  EJECT                                                               CL**2
00992                                                                      CL**2
00993  D3000-PROCESS-ADD.                                                  CL**2
00994 ******************************************************************   CL**2
00995 *    THIS ROUTINE IS CALLED WHEN THE ADD ACTION WAS PASSED           CL**2
00996 *    AND THE USER PRESSED THE ADD FUNCTION KEY (PF13 - MBAWORKR)     CL**2
00997 *                                                                    CL**2
00998 *    -  NO LAST NAME IS SENT TO THIS MODULE FOR THE ADD FUNCTION     CL**2
00999 *    -  USER ID IS OPTIONAL FOR THIS FUNCTION                        CL**2
01000 *                                                                    CL**2
01001 *    1) EDIT THE COMMAREA RECEIVED                                   CL**2
01002 *    2) FORMAT THE WORKER RECORD TO BE ADDED                         CL**2
01003 *    3) ADD THE WORKER RECORD TO THE DB2 TWORKR DATA BASE            CL**2
01004 *    4) IF THE ADD WAS SUCCESSFULLY PROCESSED:                       CL**2
01005 *         SET THE ACTION CODE TO 'C' SO THE USER                     CL**2
01006 *         WILL NOW BE ABLE TO MAKE UPDATES                           CL**2
01007 *                                                                    CL**2
01008 ******************************************************************   CL**2
01009                                                                      CL**2
01010      PERFORM E1000-EDIT-DATA-IN-COMMAREA.                            CL**2
01011                                                                      CL**2
01012      IF MB007-USERID = SPACES                                        CL**2
01013          CONTINUE                                                    CL**2
01014      ELSE                                                            CL**2
01015          PERFORM E2000-FORMAT-WORKER-RECORD                          CL**2
01016          PERFORM F1000-RETRIEVE-RECORD                               CL**2
01017      END-IF.                                                         CL**2
01018                                                                      CL**2
01019      IF PS-NO-ERROR                                                  CL**2
01020                                                                      CL**2
01021          SET MB007-ADD-FAILED TO TRUE                                CL**2
01022          PERFORM E3000-ADD-WORKER-DB2-RECORD                         CL**2
01023                                                                      CL**2
01024          EVALUATE TRUE                                               CL**2
01025                                                                      CL**2
01026          WHEN MB007-ADD-SUCCESSFUL                                   CL**2
01027              SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**2
01028              MOVE PC-TSYMSG-00034        TO DP020-MSG-NUMBER         CL**2
01029              MOVE -1                     TO ANAVCMDL                 CL**2
01030                                                                      CL**2
01031          WHEN MB007-DUP-ADD-REC                                      CL**2
01032 *           ** RESET WORKER DB2 RECORD TO INITIAL VALUES **          CL**2
01033              INITIALIZE DCLTWORKER                                   CL**2
01034              SET DP020-MSG-FATAL         TO TRUE                     CL**2
01035              SET PS-ERROR                TO TRUE                     CL**2
01036              MOVE PC-TSYMSG-00117        TO DP020-MSG-NUMBER         CL**2
01037                                                                      CL**2
01038          WHEN OTHER                                                  CL**2
01039 *           ** RESET WORKER DB2 RECORD TO INITIAL VALUES **          CL**2
01040              INITIALIZE DCLTWORKER                                   CL**2
01041              SET DP020-MSG-FATAL         TO TRUE                     CL**2
01042              SET PS-ERROR                TO TRUE                     CL**2
01043              MOVE -1                     TO ANAVCMDL                 CL**2
01044                                                                      CL**2
01045              END-EVALUATE                                            CL**2
01046                                                                      CL**2
01047      ELSE                                                            CL**2
01048          SET DP020-MSG-FATAL     TO TRUE                             CL**2
01049                                                                      CL**2
01050      END-IF.                                                         CL**2
01051                                                                      CL**2
01052      EJECT                                                           CL**2
01053                                                                      CL**2
01054  D4000-PROCESS-UPDATES.                                              CL**2
01055 ******************************************************************   CL**2
01056 *    THIS ROUTINE IS CALLED WHEN THE UPDATE ACTION WAS PASSED &      CL**2
01057 *    THE USER PRESSED THE UPDATE FUNCTION KEY (PF15 - MBUWORKR)      CL**2
01058 *                                                                    CL**2
01059 *    -  LAST NAME IS OPTIONAL FOR THE UPDATE FUNCTION                CL**2
01060 *    -  USER ID IS OPTIONAL FOR THIS FUNCTION                        CL**2
01061 *                                                                    CL**2
01062 *    1) EDIT THE COMMAREA RECEIVED                                   CL**2
01063 *    2) FORMAT THE WORKER RECORD TO BE UPDATED                       CL**2
01064 *    3) DELETE THE ORIGINAL WORKER FROM THE DATA BASE                CL**2
01065 *    4) ADD THE UPDATED RECORD TO THE DB2 TWORKR DATA BASE           CL**2
01066 *    5) IF THE UPDATE WAS SUCCESSFULLY PROCESSED:                    CL**2
01067 *         LEAVE THE ACTION CODE A 'C' SO THE USER                    CL**2
01068 *         COULD CONTINUE TO MAKE UPDATES                             CL**2
01069 *                                                                    CL**2
01070 ******************************************************************   CL**2
01071                                                                      CL**2
01072      PERFORM E1000-EDIT-DATA-IN-COMMAREA.                            CL**2
01073                                                                      CL**2
01074      IF PS-NO-ERROR                                                  CL**2
01075                                                                      CL**2
01076          PERFORM E2000-FORMAT-WORKER-RECORD                          CL**2
01077          PERFORM E4000-UPDATE-WORKER-DB2-RECORD                      CL**2
01078                                                                      CL**2
01079          EVALUATE TRUE                                               CL**2
01080                                                                      CL**2
01081          WHEN MB007-UPDATE-SUCCESSFUL                                CL**2
01082              SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**2
01083              MOVE PC-TSYMSG-00059        TO DP020-MSG-NUMBER         CL**2
01084              MOVE -1                     TO ANAVCMDL                 CL**2
01085                                                                      CL**2
01086              IF MB007-LIST                                           CL**2
01087                 PERFORM K1000-READ-LIST-QUEUE                        CL**2
01088                 PERFORM K2000-UPDATE-LIST-QUEUE                      CL**2
01089              END-IF                                                  CL**2
01090                                                                      CL**2
01091          WHEN OTHER                                                  CL**2
01092              INITIALIZE DCLTWORKER                                   CL**2
01093 *            ** RESET THE WORKER DB2 RECORD TO INITIAL VALUES **     CL**2
01094              SET DP020-MSG-FATAL         TO TRUE                     CL**2
01095              SET PS-ERROR                TO TRUE                     CL**2
01096              MOVE -1                     TO ANAVCMDL                 CL**2
01097                                                                      CL**2
01098          END-EVALUATE                                                CL**2
01099                                                                      CL**2
01100      ELSE                                                            CL**2
01101          SET DP020-MSG-FATAL        TO TRUE                          CL**2
01102                                                                      CL**2
01103      END-IF.                                                         CL**2
01104 *                                                                    CL**2
01105      EJECT                                                           CL**2
01106                                                                      CL**2
01107  D5000-PROCESS-DELETE.                                               CL**2
01108 ******************************************************************   CL**2
01109 *    THIS ROUTINE IS CALLED WHEN THE DELETE ACTION WAS PASSED &      CL**2
01110 *    THE USER PRESSED THE DELETE FUNCTION KEY (PF16 - MBDWORKR)      CL**2
01111 *                                                                    CL**2
01112 *    -  NO LAST NAME IS SENT TO THIS MODULE FOR THE ADD FUNCTION     CL**2
01113 *    -  USER ID IS OPTIONAL FOR THIS FUNCTION                        CL**2
01114 *                                                                    CL**2
01115 ******************************************************************   CL**2
01116                                                                      CL**2
01117      PERFORM E1000-EDIT-DATA-IN-COMMAREA.                            CL**2
01118                                                                      CL**2
01119      IF PS-NO-ERROR                                                  CL**2
01120          SET MB007-DELETE-FAILED TO TRUE                             CL**2
01121                                                                      CL**2
01122          PERFORM E2000-FORMAT-WORKER-RECORD                          CL**2
01123          PERFORM E5000-DELETE-WORKER-DB2-RECORD                      CL**2
01124                                                                      CL**2
01125          EVALUATE TRUE                                               CL**2
01126                                                                      CL**2
01127          WHEN MB007-DELETE-SUCCESSFUL                                CL**2
01128              SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**2
01129              MOVE PC-TSYMSG-00115        TO DP020-MSG-NUMBER         CL**2
01130              MOVE -1                     TO ANAVCMDL                 CL**2
01131                                                                      CL**2
01132              IF MB007-LIST                                           CL**2
01133                 PERFORM K1000-READ-LIST-QUEUE                        CL**2
01134                 PERFORM K2000-UPDATE-LIST-QUEUE                      CL**2
01135              END-IF                                                  CL**2
01136 *                                                                    CL**2
01137          WHEN OTHER                                                  CL**2
01138              INITIALIZE DCLTWORKER                                   CL**2
01139 *            ** RESET THE WORKER DB2 RECORD TO INITIAL VALUES **     CL**2
01140              SET DP020-MSG-FATAL         TO TRUE                     CL**2
01141              SET PS-ERROR                TO TRUE                     CL**2
01142              MOVE -1                     TO ANAVCMDL                 CL**2
01143                                                                      CL**2
01144          END-EVALUATE                                                CL**2
01145                                                                      CL**2
01146      ELSE                                                            CL**2
01147          SET DP020-MSG-FATAL        TO TRUE                          CL**2
01148                                                                      CL**2
01149      END-IF.                                                         CL**2
01150 *                                                                    CL**2
01151      EJECT                                                           CL**2
01152                                                                      CL**2
01153  D6000-FUNCTION-ERROR.                                               CL**2
01154 ******************************************************************   CL**2
01155 *    RETRIEVE THE WORKER RECORD WHEN A FUNCTION KEY ERROR IS     *   CL**2
01156 *    ENCOUNTERED AND DETERMINE IF THE FIELDS ARE TO BE EDITABLE. *   CL**2
01157 ******************************************************************   CL**2
01158 *                                                                    CL**2
01159      PERFORM E1000-EDIT-DATA-IN-COMMAREA.                            CL**2
01160                                                                      CL**2
01161      IF MB007-USERID = SPACES                                        CL**2
01162          CONTINUE                                                    CL**2
01163                                                                      CL**2
01164      ELSE                                                            CL**2
01165          IF PS-ERROR                                                 CL**2
01166              CONTINUE                                                CL**2
01167          ELSE                                                        CL**2
01168              PERFORM E2000-FORMAT-WORKER-RECORD                      CL**2
01169              PERFORM F1000-RETRIEVE-RECORD                           CL**2
01170          END-IF                                                      CL**2
01171                                                                      CL**2
01172      END-IF.                                                         CL**2
01173                                                                      CL**2
01174      IF (DP020-SRC-MNEMONIC = PC-WORKER-ADD-MNEMONIC)                CL**5
01175          CONTINUE                                                    CL**9
01176      ELSE                                                            CL**5
01177          IF DP020-FK-PREV-SELECTION(DP020-SRC-AID)                   CL**5
01178 *           ** TOP LIST ITEM ASSUMED **                              CL**5
01179              MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                CL**5
01180          END-IF                                                      CL**5
01181          IF DP020-FK-NEXT-SELECTION(DP020-SRC-AID)                   CL**5
01182 *           ** BOTTOM LIST ITEM ASSUMED **                           CL**5
01183              MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                CL**5
01184          END-IF                                                      CL**5
01185      END-IF.                                                         CL**5
01186                                                                      CL**5
01187      IF PS-ERROR                                                     CL**9
01188          CONTINUE                                                    CL**9
01189      ELSE                                                            CL**9
01190          SET PS-ERROR TO TRUE                                        CL**9
01191          IF (DP020-SRC-MNEMONIC = PC-WORKER-DEL-MNEMONIC)            CL**9
01192              MOVE -1 TO ANAVCMDL                                     CL**9
01193          ELSE                                                        CL**9
01194              MOVE -1 TO ALNAMEL                                      CL**9
01195          END-IF                                                      CL**9
01196          IF DP020-MSG-NUMBER = ZEROS                                 CL**9
01197              MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER                CL**9
01198          END-IF                                                      CL**9
01199      END-IF.                                                         CL**9
01200                                                                      CL**2
01201      SET DP020-MSG-FATAL TO TRUE.                                    CL**2
01202 *                                                                    CL**2
01203  EJECT                                                               CL**2
01204                                                                      CL**2
01205  D7000-TEST-LIST-ITEM.                                               CL**2
01206 ******************************************************************   CL**2
01207 *    RESET THE TEMP STORAGE QUEUE T OCONTAIN THE                     CL**2
01208 *    CORRECT BLOCK CONTAINING THE CURRENT RECORD.                    CL**2
01209 ******************************************************************   CL**2
01210                                                                      CL**2
01211      IF MB138-1ST-LIST-ITEM                                          CL**2
01212 *        ** TOP LIST ITEM CURRENTLY DISPLAYED **                     CL**2
01213          MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                    CL**2
01214          MOVE -1              TO ANAVCMDL                            CL**5
01215      END-IF.                                                         CL**2
01216                                                                      CL**2
01217      IF MB138-LAST-LIST-ITEM                                         CL**2
01218 *        ** BOTTOM LIST ITEM CURRENTLY DISPLAYED **                  CL**2
01219          MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                    CL**2
01220          MOVE -1              TO ANAVCMDL                            CL**4
01221      END-IF.                                                         CL**2
01222                                                                      CL**2
01223      SET DP020-MSG-FATAL TO TRUE.                                    CL**2
01224                                                                      CL**2
01225      IF PS-NO-ITEM-SELECTED                                          CL**2
01226          MOVE MB138-HOLD-TSQ-BLK-NBR                                 CL**2
01227                         TO MB138-BLOCK-NUMBER                        CL**2
01228          PERFORM K3000-RESTORE-PREVIOUS-BLOCK                        CL**2
01229          SET MB007Q-IDX TO MB138-HOLD-TSQ-IDX                        CL**2
01230      END-IF.                                                         CL**2
01231 *                                                                    CL**2
01232      EJECT                                                           CL**2
01233                                                                      CL**2
01234  E1000-EDIT-DATA-IN-COMMAREA.                                        CL**2
01235 ******************************************************************   CL**2
01236 *    THIS ROUTINE IS CALLED WHENEVER A USER PRESSES THE              CL**2
01237 *                                                                    CL**2
01238 *    ENTER KEY                                                       CL**2
01239 *                                                                    CL**2
01240 *    THE ADD FKEY    (PF13 - MBAWORKR)  FROM ADD MAINTENANCE         CL**2
01241 *    THE UPDATE FKEY (PF15 - MBUWORKR)  FROM UPDATE MAINTENANCE      CL**2
01242 *    THE DELETE FKEY (PF16 - MBDWORKR)  FROM DELETE MAINTENANCE      CL**2
01243 *                                                                    CL**2
01244 *    LIST FKEY (PF20 - MBLWORKR)                                     CL**2
01245 *    ( NOTE: THE INQUIRE FUNCTION, PF14, NOT CURRENTLY AVAILABLE)    CL**2
01246 *                                                                    CL**2
01247 *    THIS PARAGRAPH WILL USE THE ALPHA NUMERIC EDIT ROUTINE          CL**2
01248 *    DPPD019 TO VALIDATE THE ENTRIES ON THE SCREEN THAT HAVE         CL**2
01249 *    NOT PREVIOUSLY BEEN VALIDATED BY THE SELECTION SCREEN:          CL**2
01250 *                                                                    CL**2
01251 *      ** THE INITIAL LAST NAME AND USERID FIELDS WERE               CL**2
01252 *         PRE-EDITED BY THE SELECTION MODULE (MBKCS136), OR          CL**2
01253 *         ORIGINATED FROM AN INITIAL LIST SELECTION.                 CL**2
01254 *                                                                    CL**2
01255 *      VALIDATE THE WORKER FIRST NAME ENTERED                        CL**2
01256 *           1 TO 12 CHARACTER STRING WITH NO IMBEDDED SPECIAL        CL**2
01257 *              CHARACTERS OTHER THAN A HYPHEN, A QUOTE, A            CL**2
01258 *              PERIOD, A COMMA, OR SINGLE SPACE                      CL**2
01259 *      VALIDATE THE WORKER LAST NAME (MODIFIED ENTRIES)              CL**2
01260 *           1 TO 18 CHARACTER STRING WITH NO IMBEDDED SPECIAL        CL**2
01261 *              CHARACTERS OTHER THAN A HYPHEN, A QUOTE, A            CL**2
01262 *              PERIOD, A COMMA, OR SINGLE SPACE                      CL**2
01263 *      VALIDATE THE WORKER USER ID (MODIFIED ENTRIES)                CL**2
01264 *           'XXXXXXX ' A 7 OR 8 CHARACTER STRING WITH NO IMBEDDED    CL**2
01265 *                 SPACES OR *, YET CONTAINING LETTERS OR NUMBERS     CL**2
01266 *                                                                    CL**2
01267 ******************************************************************   CL**2
01268                                                                      CL**2
01269      IF NOT DP020-NEXT-ACT-ERROR                                     CL**2
01270         SET PS-NO-ERROR TO TRUE                                      CL**2
01271         MOVE DP015-GREEN     TO ANAVCMDC                             CL**2
01272                                 ANAVKEYC                             CL**2
01273         MOVE DP015-UNDERLINE TO ANAVCMDH                             CL**2
01274                                 ANAVKEYH                             CL**2
01275      END-IF.                                                         CL**2
01276                                                                      CL**2
01277 *    ***********************************************************     CL**2
01278 *    * INITIALIZE THE ENTERABLE FIELDS TO GREEN AND UNDERLINED *     CL**2
01279 *    ***********************************************************     CL**2
01280                                                                      CL**2
01281      MOVE DP015-GREEN     TO ALNAMEC                                 CL**2
01282                              AFNAMEC                                 CL**2
01283                              AUSERIDC.                               CL**2
01284                                                                      CL**2
01285      MOVE DP015-UNDERLINE TO ALNAMEH                                 CL**2
01286                              AFNAMEH                                 CL**2
01287                              AUSERIDH.                               CL**2
01288                                                                      CL**2
01289                                                                      CL**2
01290      MOVE 'N' TO MB007-LNAME-ERROR-SW                                CL**2
01291                  MB007-FNAME-ERROR-SW                                CL**2
01292                  MB007-USERID-ERROR-SW.                              CL**2
01293                                                                      CL**2
01294      MOVE 'N' TO  PV-TERMINATE-SW.                                   CL**2
01295                                                                      CL**2
01296      IF MB007-LAST-NAME = SPACES AND                                 CL**2
01297         MB007-FIR-NAME = SPACES AND                                  CL**2
01298         MB007-USERID = SPACES                                        CL**2
01299                                                                      CL**2
01300           IF DP020-SRC-AID = DP016-ENTER OR                          CL**2
01301              DP020-SRC-AID = DP016-CLEAR OR                          CL**2
01302              DP020-SRC-AID = DP016-PF13 OR                           CL**2
01303 *              ** WORKER ADD                                         CL**2
01304              DP020-SRC-AID = DP016-PF15 OR                           CL**2
01305 *              ** WORKER UPDATE                                      CL**2
01306              DP020-SRC-AID = DP016-PF16                              CL**2
01307 *              ** WORKER DELETE                                      CL**2
01308                                                                      CL**2
01309               MOVE PC-TSYMSG-00082 TO DP020-MSG-NUMBER               CL**2
01310               SET MB007-USERID-ERROR TO TRUE                         CL**2
01311               SET MB007-FNAME-ERROR TO TRUE                          CL**2
01312               SET MB007-LNAME-ERROR TO TRUE                          CL**2
01313               SET PV-TERMINATE-EDIT TO TRUE                          CL**2
01314                                                                      CL**2
01315           ELSE                                                       CL**2
01316               SET PV-TERMINATE-EDIT TO TRUE                          CL**2
01317                                                                      CL**2
01318           END-IF                                                     CL**2
01319                                                                      CL**2
01320      END-IF.                                                         CL**2
01321                                                                      CL**2
01322      IF PV-TERMINATE-EDIT                                            CL**2
01323          CONTINUE                                                    CL**2
01324                                                                      CL*17
01325      ELSE                                                            CL**2
01326                                                                      CL*18
01327          PERFORM E1300-EDIT-USERID                                   CL**2
01328                                                                      CL**2
01329          IF MB007-USERID-ERROR                                       CL**2
01330              CONTINUE                                                CL**2
01331          ELSE                                                        CL**2
01332              IF MB007-USERID = SPACES                                CL**2
01333                  IF DP020-MB-WORKER-SELECT                           CL**2
01334 *                ** FIELD OPTIONAL FOR INITIAL EXECUTION **          CL**2
01335                      CONTINUE                                        CL**2
01336                  END-IF                                              CL**2
01337                  IF DP020-MB-WORKER-LIST                             CL**2
01338 *                ** FIELD WOULD NEVER BE BLANK FROM THE LIST **      CL**2
01339                      MOVE 'Y' TO MB007-USERID-ERROR-SW               CL**2
01340                  END-IF                                              CL**2
01341                  IF DP020-MB-WORKER-MAINT                            CL**2
01342 *                ** FIELD SHOULD NEVER BE BLANK **                   CL**2
01343                      MOVE 'Y' TO MB007-USERID-ERROR-SW               CL**2
01344                  END-IF                                              CL**2
01345              ELSE                                                    CL**2
01346                  MOVE +8               TO PV-INSPECT-FLD-LGTH        CL**2
01347                  MOVE MB007-USERID     TO PV-INSPECT-FIELD           CL**2
01348                  PERFORM E1400-INSPECT-FIELD                         CL**2
01349                  IF PS-ERROR                                         CL**2
01350                      SET PS-NO-ERROR TO TRUE                         CL*18
01351                      MOVE 'Y' TO MB007-USERID-ERROR-SW               CL**2
01352                  END-IF                                              CL**2
01353                  MOVE PV-INSPECT-FIELD TO MB007-USERID               CL**2
01354              END-IF                                                  CL**2
01355          END-IF                                                      CL**2
01356                                                                      CL**2
01357          PERFORM E1200-EDIT-FIRST-NAME                               CL*17
01358                                                                      CL*17
01359          IF MB007-FNAME-ERROR                                        CL*17
01360              CONTINUE                                                CL*17
01361          ELSE                                                        CL*17
01362              IF MB007-FIR-NAME = SPACES                              CL*17
01363                  IF DP020-MB-WORKER-SELECT                           CL*17
01364 *                ** FIELD NOT ENTERABLE FROM SELECTION SCREEN **     CL*17
01365                      CONTINUE                                        CL*17
01366                  END-IF                                              CL*17
01367                  IF DP020-MB-WORKER-LIST                             CL*17
01368 *                ** FIELD WOULD NEVER BE BLANK FROM THE LIST **      CL*17
01369                      MOVE 'Y' TO MB007-FNAME-ERROR-SW                CL*17
01370                  END-IF                                              CL*17
01371                  IF DP020-MB-WORKER-MAINT                            CL*17
01372 *                ** FIELD SHOULD NEVER BE BLANK **                   CL*17
01373                      MOVE 'Y' TO MB007-FNAME-ERROR-SW                CL*17
01374                  END-IF                                              CL*17
01375              ELSE                                                    CL*17
01376                  MOVE +12              TO PV-INSPECT-FLD-LGTH        CL*17
01377                  MOVE MB007-FIR-NAME   TO PV-INSPECT-FIELD           CL*17
01378                  PERFORM E1400-INSPECT-FIELD                         CL*17
01379                  IF PS-ERROR                                         CL*17
01380                      SET PS-NO-ERROR TO TRUE                         CL*18
01381                      MOVE 'Y' TO MB007-FNAME-ERROR-SW                CL*17
01382                  END-IF                                              CL*17
01383                  MOVE PV-INSPECT-FIELD   TO MB007-FIR-NAME           CL*17
01384              END-IF                                                  CL*17
01385          END-IF                                                      CL*17
01386                                                                      CL*17
01387          PERFORM E1100-EDIT-LAST-NAME                                CL*17
01388                                                                      CL*17
01389          IF MB007-LNAME-ERROR                                        CL*17
01390              CONTINUE                                                CL*17
01391          ELSE                                                        CL*17
01392              IF MB007-LAST-NAME = SPACES                             CL*17
01393                  IF DP020-MB-WORKER-SELECT                           CL*17
01394 *                ** FIELD MUST BE BLANK UPON INITIAL RECEIPT **      CL*17
01395                      CONTINUE                                        CL*17
01396                  END-IF                                              CL*17
01397                  IF DP020-MB-WORKER-LIST                             CL*17
01398 *                ** FIELD WOULD NEVER BE BLANK FROM THE LIST **      CL*17
01399                      MOVE 'Y' TO MB007-LNAME-ERROR-SW                CL*17
01400                  END-IF                                              CL*17
01401                  IF DP020-MB-WORKER-MAINT                            CL*17
01402 *                ** FIELD SHOULD NEVER BE BLANK **                   CL*17
01403                      MOVE 'Y' TO MB007-LNAME-ERROR-SW                CL*17
01404                  END-IF                                              CL*17
01405              ELSE                                                    CL*17
01406                  MOVE +18              TO PV-INSPECT-FLD-LGTH        CL*17
01407                  MOVE MB007-LAST-NAME  TO PV-INSPECT-FIELD           CL*17
01408                  PERFORM E1400-INSPECT-FIELD                         CL*17
01409                  IF PS-ERROR                                         CL*17
01410                      SET PS-NO-ERROR TO TRUE                         CL*18
01411                      MOVE 'Y' TO MB007-LNAME-ERROR-SW                CL*17
01412                  END-IF                                              CL*17
01413                  MOVE PV-INSPECT-FIELD   TO MB007-LAST-NAME          CL*17
01414              END-IF                                                  CL*17
01415          END-IF                                                      CL*17
01416                                                                      CL*17
01417      END-IF.                                                         CL**2
01418                                                                      CL**2
01419      PERFORM E1500-EVAULATE-ERRORS.                                  CL**2
01420 *                                                                    CL**2
01421  EJECT                                                               CL**2
01422                                                                      CL**2
01423  E1100-EDIT-LAST-NAME.                                               CL**2
01424 ******************************************************************   CL**2
01425 *      EDIT LAST NAME FOR SPACES, ASTERISKS, ETC.              *     CL**2
01426 ******************************************************************   CL**2
01427                                                                      CL**2
01428      MOVE  +18             TO DP019-FLD-LENGTH.                      CL**2
01429      MOVE  MB007-LAST-NAME TO DP019-IN-FLD.                          CL**2
01430      PERFORM DP019-ALPHA-NUMERIC-EDIT.                               CL**2
01431      MOVE  SPACES          TO MB007-LAST-NAME.                       CL**2
01432      MOVE  DP019-OUT-FLD   TO MB007-LAST-NAME.                       CL**2
01433                                                                      CL**2
01434      IF DP019-ERROR                                                  CL**2
01435 *        ** INVALID WORKER LAST NAME ENTERED **                      CL**2
01436          MOVE 'Y' TO MB007-LNAME-ERROR-SW                            CL**2
01437      END-IF.                                                         CL**2
01438 *                                                                    CL**2
01439  EJECT                                                               CL**2
01440                                                                      CL**2
01441  E1200-EDIT-FIRST-NAME.                                              CL**2
01442 ******************************************************************   CL**2
01443 *      EDIT FIRST NAME FOR SPACES, ASTERISKS, ETC.             *     CL**2
01444 ******************************************************************   CL**2
01445                                                                      CL**2
01446      MOVE  +12             TO DP019-FLD-LENGTH.                      CL**2
01447      MOVE  MB007-FIR-NAME  TO DP019-IN-FLD.                          CL**2
01448      PERFORM DP019-ALPHA-NUMERIC-EDIT.                               CL**2
01449      MOVE  SPACES          TO MB007-FIR-NAME.                        CL**2
01450      MOVE  DP019-OUT-FLD   TO MB007-FIR-NAME.                        CL**2
01451                                                                      CL**2
01452      IF DP019-ERROR                                                  CL**2
01453 *        ** INVALID WORKER FIRST NAME ENTERED **                     CL**2
01454          MOVE 'Y' TO MB007-FNAME-ERROR-SW                            CL**2
01455      END-IF.                                                         CL**2
01456 *                                                                    CL**2
01457  EJECT                                                               CL**2
01458                                                                      CL**2
01459  E1300-EDIT-USERID.                                                  CL**2
01460 ******************************************************************   CL**2
01461 *      EDIT USER-ID FOR SPACES, ASTERISKS, ETC.                *     CL**2
01462 ******************************************************************   CL**2
01463                                                                      CL**2
01464      MOVE  +8              TO DP019-FLD-LENGTH.                      CL**2
01465      MOVE  MB007-USERID    TO DP019-IN-FLD.                          CL**2
01466      PERFORM DP019-ALPHA-NUMERIC-EDIT.                               CL**2
01467      MOVE  SPACES          TO MB007-USERID.                          CL**2
01468      MOVE  DP019-OUT-FLD   TO MB007-USERID.                          CL**2
01469                                                                      CL**2
01470      IF DP019-ERROR                                                  CL**2
01471 *        ** INVALID WORKER USERID ENTERED **                         CL**2
01472          MOVE 'Y' TO MB007-USERID-ERROR-SW                           CL**2
01473      END-IF.                                                         CL**2
01474 *                                                                    CL**2
01475  EJECT                                                               CL**2
01476                                                                      CL**2
01477  E1400-INSPECT-FIELD.                                                CL**2
01478 ******************************************************************   CL**2
01479 *      CHANGE ALL '%' TO SPACES                                *     CL**2
01480 *      INSPECT FIELDS FOR INVALID '*'                          *     CL**2
01481 ******************************************************************   CL**2
01482                                                                      CL**2
01483      INSPECT PV-INSPECT-FIELD                                        CL**2
01484          REPLACING ALL '%' BY SPACE.                                 CL**2
01485                                                                      CL**2
01486      MOVE +0 TO PV-INSPECT-CTR.                                      CL**2
01487                                                                      CL**2
01488      INSPECT PV-INSPECT-FIELD                                        CL**2
01489          TALLYING PV-INSPECT-CTR FOR ALL '*'.                        CL**2
01490                                                                      CL**2
01491      IF PV-INSPECT-CTR > 0                                           CL**2
01492 *        ** WILD CARD '*' IS INVALID FOR REQUESTED FUNCTION **       CL*19
01493          SET PS-ERROR            TO TRUE.                            CL*19
01494 *                                                                    CL**2
01495  EJECT                                                               CL**2
01496                                                                      CL**2
01497  E1500-EVAULATE-ERRORS.                                              CL**2
01498 ******************************************************************   CL**2
01499 *    EVALUATE ALL FIELDS FOR ERRORS                                  CL**2
01500 ******************************************************************   CL**2
01501                                                                      CL**2
01502      IF MB007-USERID-ERROR                                           CL**2
01503          MOVE DP015-RED             TO AUSERIDC                      CL**2
01504          MOVE DP015-REVERSE         TO AUSERIDH                      CL**2
01505          MOVE -1                    TO AUSERIDL                      CL**2
01506      END-IF.                                                         CL**2
01507                                                                      CL**2
01508      IF MB007-FNAME-ERROR                                            CL**2
01509          MOVE DP015-RED             TO AFNAMEC                       CL**2
01510          MOVE DP015-REVERSE         TO AFNAMEH                       CL**2
01511          MOVE -1                    TO AFNAMEL                       CL**2
01512      END-IF.                                                         CL**2
01513                                                                      CL**2
01514      IF MB007-LNAME-ERROR                                            CL**2
01515          MOVE DP015-RED             TO ALNAMEC                       CL**2
01516          MOVE DP015-REVERSE         TO ALNAMEH                       CL**2
01517          MOVE -1                    TO ALNAMEL                       CL**2
01518      END-IF.                                                         CL**2
01519                                                                      CL**2
01520                                                                      CL**2
01521      IF MB007-USERID-ERROR OR                                        CL**2
01522         MB007-FNAME-ERROR OR                                         CL**2
01523         MB007-LNAME-ERROR                                            CL**2
01524                                                                      CL**2
01525          MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER                  CL*22
01526                                                                      CL**2
01527          SET DP020-MSG-FATAL        TO TRUE                          CL**2
01528          SET PS-ERROR               TO TRUE                          CL**2
01529                                                                      CL**2
01530      END-IF.                                                         CL**2
01531 *                                                                    CL**2
01532  EJECT                                                               CL**2
01533                                                                      CL**2
01534  E2000-FORMAT-WORKER-RECORD.                                         CL**2
01535 ******************************************************************   CL**2
01536 *    FORMAT THE COBOL DCLGEN FIELDS FOR THE TWORKER TABLE            CL**2
01537 ******************************************************************   CL**2
01538                                                                      CL**2
01539      MOVE '03'                TO WORKER-OPERCO-NBR.                  CL**2
01540                                                                      CL**2
01541                                                                      CL**2
01542      IF MB007-USERID = SPACES OR                                     CL**2
01543         MB007-USERID-1ST = '*'                                       CL**2
01544          MOVE '%%%%%%%%'      TO WORKER-UID-NBR                      CL**2
01545      ELSE                                                            CL**2
01546          MOVE MB007-USERID    TO WORKER-UID-NBR                      CL**2
01547      END-IF.                                                         CL**2
01548                                                                      CL**2
01549                                                                      CL**2
01550      IF MB007-LAST-NAME = SPACES OR                                  CL**5
01551         MB007-LNAME-1ST = '*'                                        CL**5
01552          MOVE '%%%%%%%%%%%%%%%%%%' TO WORKER-LAST-NAME               CL**5
01553      ELSE                                                            CL**5
01554          MOVE MB007-LAST-NAME TO WORKER-LAST-NAME                    CL**5
01555      END-IF.                                                         CL**5
01556                                                                      CL**5
01557                                                                      CL**5
01558      IF MB007-FIR-NAME = SPACES OR                                   CL**5
01559         MB007-FNAME-1ST = '*'                                        CL**5
01560          MOVE '%%%%%%%%%%%%'  TO WORKER-FIR-NAME                     CL**5
01561      ELSE                                                            CL**5
01562          MOVE MB007-FIR-NAME  TO WORKER-FIR-NAME                     CL**5
01563      END-IF.                                                         CL**5
01564 *                                                                    CL**2
01565      EJECT                                                           CL**2
01566                                                                      CL**2
01567  E3000-ADD-WORKER-DB2-RECORD.                                        CL**2
01568 ******************************************************************   CL**2
01569 *    PERFORM A DB2 INSERT OF A ROW TO THE 'TWORKER' TABLE            CL**2
01570 ******************************************************************   CL**2
01571 *                                                                    CL**2
01572      PERFORM                                                         CL**2
01573          WITH TEST AFTER                                             CL**2
01574          VARYING PV-SQL-WKR-SUB                                      CL**2
01575          FROM 1 BY 1                                                 CL**2
01576          UNTIL ( PV-SQL-WKR-SUB > PC-MAX-RETRIES                     CL**2
01577                  OR SQLCODE = 0                                      CL**2
01578                  OR SQLCODE = +100 )                                 CL**2
01579                                                                      CL**2
01580 *        DETERMINE IF THE RECORD TO BE ADDED, WOULD RESULT IN        CL**2
01581 *        A DUPLICATE ROW BASED ON USER ID COLUMN VALUE.              CL**2
01582                                                                      CL**2
01583          PERFORM S1000-SELECT-TWORKER-NBR                            CL**2
01584                                                                      CL**2
01585          IF SQLCODE = +100                                           CL**2
01586 *           ** NO ROW FOUND FOR USER ID **                           CL**2
01587                                                                      CL**2
01588              EXEC SQL                                                CL**2
01589                  SELECT MAX(WORKER_NBR)                              CL**2
01590                    INTO :PV-MAX-ENTRIES                              CL**2
01591                    FROM TWORKER                                      CL**2
01592              END-EXEC                                                CL**2
01593                                                                      CL**2
01594              COMPUTE WORKER-NBR = (PV-MAX-ENTRIES + 1)               CL**2
01595                                                                      CL**2
01596              EXEC SQL                                                CL**2
01597                  INSERT INTO TWORKER                                 CL**2
01598                              (  OPERCO_NBR                           CL**2
01599                               , WORKER_NBR                           CL**2
01600                               , UID_NBR                              CL**2
01601                               , LAST_NAME                            CL**2
01602                               , FIR_NAME )                           CL**2
01603                  VALUES                                              CL**2
01604                              (  :WORKER-OPERCO-NBR                   CL**2
01605                               , :WORKER-NBR                          CL**2
01606                               , :WORKER-UID-NBR                      CL**2
01607                               , :WORKER-LAST-NAME                    CL**2
01608                               , :WORKER-FIR-NAME )                   CL**2
01609              END-EXEC                                                CL**2
01610                                                                      CL**2
01611          ELSE                                                        CL**2
01612                                                                      CL**2
01613              IF SQLCODE = 0                                          CL**2
01614 *               ** ONE ROW FOUND FOR USER ID **                      CL**2
01615                  SET MB007-DUP-ADD-REC TO TRUE                       CL**2
01616              END-IF                                                  CL**2
01617                                                                      CL**2
01618          END-IF                                                      CL**2
01619                                                                      CL**2
01620          IF MB007-DUP-ADD-REC                                        CL**2
01621              CONTINUE                                                CL**2
01622          ELSE                                                        CL**2
01623                                                                      CL**2
01624              EVALUATE TRUE                                           CL**2
01625                                                                      CL**2
01626                  WHEN SQLCODE = -803                                 CL**2
01627 *                  ** INSERT WOULD RESULT IN A DUPLICATE **          CL**2
01628                      SET MB007-DUP-ADD-REC     TO TRUE               CL**2
01629                                                                      CL**2
01630                  WHEN SQLCODE = -811                                 CL**2
01631 *                  ** MULTIPLE USER ID'S ALREADY EXIST **            CL**2
01632                      SET MB007-DUP-ADD-REC     TO TRUE               CL**2
01633                                                                      CL**2
01634                  WHEN SQLCODE = -904                                 CL**2
01635 *                  ** UNAVAILABLE RESOURCE **                        CL**2
01636                  WHEN SQLCODE = -911                                 CL**2
01637 *                  ** ROLLBACK OCCURED DUE TO DEADLOCK/TIME **       CL**2
01638                      CONTINUE                                        CL**2
01639                                                                      CL**2
01640                  WHEN SQLCODE = 0                                    CL**2
01641 *                  ** ADD SUCCESSFUL **                              CL**2
01642                      SET MB007-ADD-SUCCESSFUL TO TRUE                CL**2
01643                                                                      CL**2
01644                  WHEN SQLWARN NOT = SPACES                           CL**2
01645                  WHEN SQLCODE NOT = ZERO                             CL**2
01646 *                    ** PERFORM ABEND **                             CL**2
01647                      SET DP013-LOGIC-ABEND TO TRUE                   CL**2
01648                      SET DP013-NO-ROLLBACK TO TRUE                   CL**2
01649                      MOVE 'E3000-ADD-WORKER-DB2-RECORD' TO           CL**2
01650                           DP013-PARAGRAPH                            CL**2
01651                      MOVE PM-PROGRAM-MESSAGE-7 TO                    CL**2
01652                           DP013-MESSAGE-TEXT(1)                      CL**2
01653                      PERFORM DP013-0000-PROCESS-ABEND                CL**2
01654                                                                      CL**2
01655              END-EVALUATE                                            CL**2
01656                                                                      CL**2
01657          END-IF                                                      CL**2
01658                                                                      CL**2
01659      END-PERFORM.                                                    CL**2
01660                                                                      CL**2
01661      IF PV-SQL-WKR-SUB > PC-MAX-RETRIES                              CL**2
01662 *       ** MAX RETRIES EXCEEDED, PERFORM ABEND **                    CL**2
01663           SET DP013-LOGIC-ABEND TO TRUE                              CL**2
01664           SET DP013-NO-ROLLBACK TO TRUE                              CL**2
01665           MOVE 'E3000-ADD-WORKER-DB2-RECORD' TO                      CL**2
01666                 DP013-PARAGRAPH                                      CL**2
01667           MOVE PM-PROGRAM-MESSAGE-7 TO                               CL**2
01668                 DP013-MESSAGE-TEXT(1)                                CL**2
01669           PERFORM DP013-0000-PROCESS-ABEND                           CL**2
01670      END-IF.                                                         CL**2
01671 *                                                                    CL**2
01672      EJECT                                                           CL**2
01673                                                                      CL**2
01674  E4000-UPDATE-WORKER-DB2-RECORD.                                     CL**2
01675 ******************************************************************   CL**2
01676 *    PERFORM AN UPDATE OF A ROW ON THE 'TWORKER' DB2 TABLE           CL**2
01677 ******************************************************************   CL**2
01678 *                                                                    CL**2
01679      SET MB007-UPDATE-FAILED TO TRUE.                                CL**2
01680                                                                      CL**2
01681      MOVE SPACES TO   RSPBAR-WORKER-FIR-NAME                         CL**2
01682                       RSPBAR-WORKER-LAST-NAME.                       CL**2
01683                                                                      CL**2
01684 *    THE VALUE IN 'PV-USERID' IS RETAINED FROM THE INITIAL           CL**2
01685 *    RETRIEVAL OF THE DATABASE RECORD, OR IF BLANK, IT IS            CL**2
01686 *    THE NEWLY ENTERED USERID.                                       CL**2
01687                                                                      CL**2
01688      IF PV-USERID = SPACES OR LOW-VALUES                             CL**2
01689          MOVE MB007-USERID TO PV-USERID                              CL**2
01690      END-IF.                                                         CL**2
01691                                                                      CL**2
01692      PERFORM                                                         CL**2
01693          WITH TEST AFTER                                             CL**2
01694          VARYING PV-SQL-WKR-SUB                                      CL**2
01695          FROM 1 BY 1                                                 CL**2
01696          UNTIL ( PV-SQL-WKR-SUB > PC-MAX-RETRIES                     CL**2
01697                  OR SQLCODE = 0                                      CL**2
01698                  OR SQLCODE = +100 )                                 CL**2
01699                                                                      CL**2
01700          PERFORM S1000-SELECT-TWORKER-NBR                            CL**2
01701                                                                      CL**2
01702          IF SQLCODE = 0                                              CL**2
01703              EXEC SQL                                                CL**2
01704                  UPDATE TWORKER                                      CL**2
01705                     SET   FIR_NAME   =  :WORKER-FIR-NAME             CL**2
01706                         , LAST_NAME  =  :WORKER-LAST-NAME            CL**2
01707                         , UID_NBR    =  :WORKER-UID-NBR              CL**2
01708                  WHERE  UID_NBR = :PV-USERID                         CL**2
01709              END-EXEC                                                CL**2
01710          END-IF                                                      CL**2
01711                                                                      CL**2
01712          EVALUATE TRUE                                               CL**2
01713                                                                      CL**2
01714              WHEN SQLCODE = -803                                     CL**2
01715 *              ** UPDATE RESULTED IN A DUPLICATE **                  CL**2
01716 *              ** MUST ASSIGN NEW MGS NBR TO ERR **                  CL**2
01717                  MOVE PC-TSYMSG-00231 TO DP020-MSG-NUMBER            CL**2
01718                  SET DP020-MSG-FATAL  TO TRUE                        CL**2
01719                                                                      CL**2
01720              WHEN SQLCODE = -904                                     CL**2
01721 *              ** UNAVAILABLE RESOURCE **                            CL**2
01722              WHEN SQLCODE = -911                                     CL**2
01723 *              ** ROLLBACK OCCURED DUE TO DEADLOCK OR TIME **        CL**2
01724                                                                      CL**2
01725              WHEN SQLCODE = +100                                     CL**2
01726 *              ** ROW NOT FOUND FOR UPDATE **                        CL**2
01727                  SET PS-CANNOT-EDIT-FIELDS TO TRUE                   CL*14
01728                  MOVE PC-TSYMSG-00158 TO DP020-MSG-NUMBER            CL**2
01729                  SET DP020-MSG-FATAL  TO TRUE                        CL**2
01730                  IF MB007-LIST                                       CL*14
01731                      PERFORM K4000-REBUILD-SCREEN                    CL*14
01732                  ELSE                                                CL*14
01733                      PERFORM S4000-SETUP-INTER-APPL                  CL*14
01734                      PERFORM S9000-RETURN-TO-PREV-TRAN               CL*14
01735                  END-IF                                              CL*14
01736                                                                      CL**2
01737              WHEN SQLCODE = 0                                        CL**2
01738 *              ** UPDATE SUCCESSFUL **                               CL**2
01739                  SET MB007-UPDATE-SUCCESSFUL TO TRUE                 CL**2
01740                                                                      CL**2
01741              WHEN SQLWARN NOT = SPACES                               CL**2
01742              WHEN SQLCODE NOT = ZERO                                 CL**2
01743 *              ** PERFORM ABEND **                                   CL**2
01744                  SET DP013-LOGIC-ABEND TO TRUE                       CL**2
01745                  SET DP013-NO-ROLLBACK TO TRUE                       CL**2
01746                  MOVE 'E4000-UPDATE-WORKER-DB2-RECORD' TO            CL**2
01747                       DP013-PARAGRAPH                                CL**2
01748                  MOVE PM-PROGRAM-MESSAGE-6 TO                        CL**2
01749                       DP013-MESSAGE-TEXT(1)                          CL**2
01750                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
01751                                                                      CL**2
01752          END-EVALUATE                                                CL**2
01753                                                                      CL**2
01754          IF MB007-UPDATE-SUCCESSFUL                                  CL**2
01755              MOVE WORKER-LAST-NAME  TO  RSPBAR-WORKER-LAST-NAME      CL**2
01756              MOVE WORKER-FIR-NAME   TO  RSPBAR-WORKER-FIR-NAME       CL**2
01757              PERFORM E4100-UPDATE-TRSPBAR                            CL**2
01758          END-IF                                                      CL**2
01759                                                                      CL**2
01760      END-PERFORM.                                                    CL**2
01761                                                                      CL**2
01762      IF PV-SQL-WKR-SUB > PC-MAX-RETRIES                              CL**2
01763 *       ** MAX RETRIES EXCEEDED, PERFORM ABEND **                    CL**2
01764           SET DP013-LOGIC-ABEND TO TRUE                              CL**2
01765           SET DP013-NO-ROLLBACK TO TRUE                              CL**2
01766           MOVE 'E4000-UPDATE-WORKER-DB2-RECORD' TO                   CL**2
01767                 DP013-PARAGRAPH                                      CL**2
01768           MOVE PM-PROGRAM-MESSAGE-6 TO                               CL**2
01769                 DP013-MESSAGE-TEXT(1)                                CL**2
01770           PERFORM DP013-0000-PROCESS-ABEND                           CL**2
01771      END-IF.                                                         CL**2
01772 *                                                                    CL**2
01773      EJECT                                                           CL**2
01774                                                                      CL**2
01775  E4100-UPDATE-TRSPBAR.                                               CL**2
01776 ******************************************************************   CL**2
01777 *    UPDATE THE CORRESPONDING ROW ON TRSPBAR TABLE, IF IT EXISTS     CL**2
01778 ******************************************************************   CL**2
01779 *                                                                    CL**2
01780      PERFORM                                                         CL**2
01781          WITH TEST AFTER                                             CL**2
01782          VARYING PV-SQL-WKR-SUB                                      CL**2
01783          FROM 1 BY 1                                                 CL**2
01784          UNTIL ( PV-SQL-WKR-SUB > PC-MAX-RETRIES                     CL**2
01785                  OR SQLCODE = 0                                      CL**2
01786                  OR SQLCODE = +100 )                                 CL**2
01787                                                                      CL**2
01788          EXEC SQL                                                    CL**2
01789              UPDATE TRSPBAR                                          CL**2
01790                 SET  WORKER_FIR_NAME  = :RSPBAR-WORKER-FIR-NAME      CL**2
01791                    , WORKER_LAST_NAME = :RSPBAR-WORKER-LAST-NAME     CL**2
01792               WHERE                                                  CL**2
01793                      WORKER_NBR = :PV-TWORKER-WKR-NBR                CL**2
01794                                                                      CL**2
01795          END-EXEC                                                    CL**2
01796                                                                      CL**2
01797          EVALUATE TRUE                                               CL**2
01798                                                                      CL**2
01799              WHEN SQLCODE = -904                                     CL**2
01800 *              ** UNAVAILABLE RESOURCE **                            CL**2
01801              WHEN SQLCODE = -911                                     CL**2
01802 *              ** ROLLBACK HAS OCCURED DUE TO DEADLOCK OR TIME **    CL**2
01803                                                                      CL**2
01804              WHEN SQLCODE = +100                                     CL**2
01805 *              ** ROW NOT FOUND FOR UPDATE **                        CL**2
01806              WHEN SQLCODE = 0                                        CL**2
01807 *              ** UPDATED TSPBAR TABLE ROW **                        CL**2
01808                  CONTINUE                                            CL**2
01809                                                                      CL**2
01810              WHEN SQLWARN NOT = SPACES                               CL**2
01811              WHEN SQLCODE NOT = ZERO                                 CL**2
01812 *                ** PERFORM ABEND **                                 CL**2
01813                  SET DP013-LOGIC-ABEND TO TRUE                       CL**2
01814                  SET DP013-NO-ROLLBACK TO TRUE                       CL**2
01815                  MOVE 'E4200-UPDATE-TRSPBAR' TO                      CL**2
01816                       DP013-PARAGRAPH                                CL**2
01817                  MOVE PM-PROGRAM-MESSAGE-6 TO                        CL**2
01818                       DP013-MESSAGE-TEXT(1)                          CL**2
01819                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
01820                                                                      CL**2
01821          END-EVALUATE                                                CL**2
01822                                                                      CL**2
01823      END-PERFORM.                                                    CL**2
01824                                                                      CL**2
01825      IF PV-SQL-WKR-SUB > PC-MAX-RETRIES                              CL**2
01826 *       ** MAX RETRIES EXCEEDED, PERFORM ABEND **                    CL**2
01827           SET DP013-LOGIC-ABEND TO TRUE                              CL**2
01828           SET DP013-NO-ROLLBACK TO TRUE                              CL**2
01829           MOVE 'E4200-UPDATE-TRSPBAR' TO                             CL**2
01830                 DP013-PARAGRAPH                                      CL**2
01831           MOVE PM-PROGRAM-MESSAGE-6 TO                               CL**2
01832                 DP013-MESSAGE-TEXT(1)                                CL**2
01833           PERFORM DP013-0000-PROCESS-ABEND                           CL**2
01834      END-IF.                                                         CL**2
01835 *                                                                    CL**2
01836      EJECT                                                           CL**2
01837                                                                      CL**2
01838  E5000-DELETE-WORKER-DB2-RECORD.                                     CL**2
01839 ******************************************************************   CL**2
01840 *    DELETE A SPECIFIC ROW ON THE 'TWORKER' DB2 TABLE                CL**2
01841 ******************************************************************   CL**2
01842 *                                                                    CL**2
01843      PERFORM E5100-CHECK-TSPBAR-TABLE.                               CL**2
01844                                                                      CL**2
01845      IF PS-DELETE-ALLOWED                                            CL**2
01846                                                                      CL**2
01847          EXEC SQL                                                    CL**2
01848              DELETE FROM TWORKER                                     CL**2
01849              WHERE  ( FIR_NAME = :WORKER-FIR-NAME                    CL**2
01850                       AND  LAST_NAME = :WORKER-LAST-NAME             CL**2
01851                       AND  UID_NBR  = :WORKER-UID-NBR )              CL**2
01852          END-EXEC                                                    CL**2
01853                                                                      CL**2
01854          EVALUATE TRUE                                               CL**2
01855                                                                      CL**2
01856              WHEN SQLCODE = -904                                     CL**2
01857 *              ** UNAVAILABLE RESOURCE **                            CL**2
01858              WHEN SQLCODE = -911                                     CL**2
01859 *              ** ROLLBACK HAS OCCURED DUE TO DEADLOCK OR TIME **    CL**2
01860                                                                      CL**2
01861              WHEN SQLCODE = +100                                     CL**2
01862                  IF MB007-DELETE-REQUESTED OR                        CL**2
01863                     DP020-FK-CONFIRM(DP020-SRC-AID)                  CL**2
01864 *                   ** ROW NOT FOUND FOR DELETE **                   CL**2
01865                      MOVE PC-TSYMSG-00116 TO DP020-MSG-NUMBER        CL**2
01866                      SET DP020-MSG-FATAL  TO TRUE                    CL**2
01867                      IF MB007-LIST                                   CL**2
01868                          PERFORM K4000-REBUILD-SCREEN                CL**2
01869                      ELSE                                            CL**2
01870                          PERFORM S4000-SETUP-INTER-APPL              CL**2
01871                          PERFORM S9000-RETURN-TO-PREV-TRAN           CL**2
01872                      END-IF                                          CL**2
01873                  END-IF                                              CL**2
01874                                                                      CL**2
01875              WHEN SQLCODE = 0                                        CL**2
01876 *              ** DELETE SUCCESSFUL **                               CL**2
01877                  SET MB007-DELETE-SUCCESSFUL TO TRUE                 CL**2
01878                                                                      CL**2
01879              WHEN SQLWARN NOT = SPACES                               CL**2
01880              WHEN SQLCODE NOT = ZERO                                 CL**2
01881 *                ** PERFORM ABEND **                                 CL**2
01882                  SET DP013-LOGIC-ABEND TO TRUE                       CL**2
01883                  SET DP013-NO-ROLLBACK TO TRUE                       CL**2
01884                  MOVE 'E5000-DELETE-WORKER-DB2-RECORD' TO            CL**2
01885                       DP013-PARAGRAPH                                CL**2
01886                  MOVE PM-PROGRAM-MESSAGE-5 TO                        CL**2
01887                       DP013-MESSAGE-TEXT(1)                          CL**2
01888                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
01889                                                                      CL**2
01890          END-EVALUATE                                                CL**2
01891                                                                      CL**2
01892          IF PV-SQL-WKR-SUB > PC-MAX-RETRIES                          CL**2
01893 *           ** MAX RETRIES EXCEEDED, PERFORM ABEND **                CL**2
01894               SET DP013-LOGIC-ABEND TO TRUE                          CL**2
01895               SET DP013-NO-ROLLBACK TO TRUE                          CL**2
01896               MOVE 'E5000-DELETE-WORKER-DB2-RECORD' TO               CL**2
01897                     DP013-PARAGRAPH                                  CL**2
01898               MOVE PM-PROGRAM-MESSAGE-5 TO                           CL**2
01899                     DP013-MESSAGE-TEXT(1)                            CL**2
01900               PERFORM DP013-0000-PROCESS-ABEND                       CL**2
01901          END-IF                                                      CL**2
01902                                                                      CL**2
01903      ELSE                                                            CL**2
01904 *        ** RELATED INFO. EXISTS, ITEM DELETE NOT ALLOWED **         CL**2
01905          MOVE PC-TSYMSG-00232 TO DP020-MSG-NUMBER                    CL**2
01906          SET DP020-MSG-FATAL  TO TRUE                                CL**2
01907          SET PS-ERROR         TO TRUE                                CL**2
01908      END-IF.                                                         CL**2
01909 *                                                                    CL**2
01910      EJECT                                                           CL**2
01911                                                                      CL**2
01912  E5100-CHECK-TSPBAR-TABLE.                                           CL**2
01913 ******************************************************************   CL**2
01914 *    DETERMINE IF A ROW FOR THIS WORKER EXISTS ON TRSPBAR TABLE      CL**2
01915 ******************************************************************   CL**2
01916 *                                                                    CL**2
01917      SET PS-DELETE-NOT-ALLOWED TO TRUE.                              CL**2
01918                                                                      CL**2
01919      PERFORM                                                         CL**2
01920          WITH TEST AFTER                                             CL**2
01921          VARYING PV-SQL-WKR-SUB                                      CL**2
01922          FROM 1 BY 1                                                 CL**2
01923          UNTIL ( PV-SQL-WKR-SUB > PC-MAX-RETRIES                     CL**2
01924                  OR SQLCODE = -811                                   CL**2
01925 *                   ** MULTIPLE ROWS ON TRSPBAR TABLE **             CL**2
01926                  OR SQLCODE = 0                                      CL**2
01927                  OR SQLCODE = +100 )                                 CL**2
01928                                                                      CL**2
01929          PERFORM S1000-SELECT-TWORKER-NBR                            CL**2
01930                                                                      CL**2
01931          IF SQLCODE = 0                                              CL**2
01932                                                                      CL**2
01933              EXEC SQL                                                CL**2
01934                  SELECT WORKER_NBR                                   CL**2
01935                  INTO  :RSPBAR-WORKER-NBR                            CL**2
01936                  FROM   TRSPBAR                                      CL**2
01937                  WHERE  WORKER_NBR = :PV-TWORKER-WKR-NBR             CL**2
01938              END-EXEC                                                CL**2
01939                                                                      CL**2
01940              EVALUATE TRUE                                           CL**2
01941                                                                      CL**2
01942                  WHEN SQLCODE = -811                                 CL**2
01943 *                  ** MORE THAN 1 ROW FOUND, CANNOT DELETE WORKER    CL**2
01944                        SET PS-DELETE-NOT-ALLOWED TO TRUE             CL**2
01945                                                                      CL**2
01946                  WHEN SQLCODE = -904                                 CL**2
01947 *                  ** UNAVAILABLE RESOURCE **                        CL**2
01948                  WHEN SQLCODE = -911                                 CL**2
01949 *                  ** ROLLBACK HAS OCCURED DUE TO DEADLOCK OR TIME   CL**2
01950                                                                      CL**2
01951                  WHEN SQLCODE = +100                                 CL**2
01952 *                  ** ROW NOT FOUND, OK TO DELETE WORKER **          CL**2
01953                        SET PS-DELETE-ALLOWED TO TRUE                 CL**2
01954                  WHEN SQLCODE = 0                                    CL**2
01955 *                  ** ROW FOUND, CANNOT DELETE WORKER **             CL**2
01956                        SET PS-DELETE-NOT-ALLOWED TO TRUE             CL**2
01957                                                                      CL**2
01958                  WHEN SQLWARN NOT = SPACES                           CL**2
01959                  WHEN SQLCODE NOT = ZERO                             CL**2
01960 *                    ** PERFORM ABEND **                             CL**2
01961                      SET DP013-LOGIC-ABEND TO TRUE                   CL**2
01962                      SET DP013-NO-ROLLBACK TO TRUE                   CL**2
01963                      MOVE 'E5100-CHECK-TSPBAR-TABLE' TO              CL**2
01964                           DP013-PARAGRAPH                            CL**2
01965                      MOVE PM-PROGRAM-MESSAGE-6 TO                    CL**2
01966                           DP013-MESSAGE-TEXT(1)                      CL**2
01967                      PERFORM DP013-0000-PROCESS-ABEND                CL**2
01968                                                                      CL**2
01969              END-EVALUATE                                            CL**2
01970                                                                      CL**2
01971          ELSE                                                        CL**2
01972                                                                      CL**2
01973              EVALUATE TRUE                                           CL**2
01974                                                                      CL**2
01975                  WHEN SQLCODE = -811                                 CL**2
01976 *                  ** WORKER USERID IS NOT UNIQUE **                 CL**2
01977                                                                      CL**2
01978                  WHEN SQLCODE = -904                                 CL**2
01979 *                  ** UNAVAILABLE RESOURCE **                        CL**2
01980                  WHEN SQLCODE = -911                                 CL**2
01981 *                  ** ROLLBACK HAS OCCURED DUE TO DEADLOCK OR TIME   CL**2
01982                    CONTINUE                                          CL**2
01983                                                                      CL**2
01984 *                ** SQL 100, NOT FOUND, SHOULD NOT OCCUR **          CL**2
01985 *                ** INITIAL FETCH WOULD HAVE DETERMINED **           CL**2
01986 *                ** WHETHER OR NOT THE WORKER EXISTED   **           CL**2
01987                                                                      CL**2
01988                  WHEN SQLWARN NOT = SPACES                           CL**2
01989                  WHEN SQLCODE NOT = ZERO                             CL**2
01990 *                    ** PERFORM ABEND **                             CL**2
01991                                                                      CL**2
01992                      SET DP013-LOGIC-ABEND TO TRUE                   CL**2
01993                      SET DP013-NO-ROLLBACK TO TRUE                   CL**2
01994                      MOVE 'E5100 - TWORKER ERROR' TO                 CL**2
01995                           DP013-PARAGRAPH                            CL**2
01996                      MOVE PM-PROGRAM-MESSAGE-6 TO                    CL**2
01997                           DP013-MESSAGE-TEXT(1)                      CL**2
01998                      PERFORM DP013-0000-PROCESS-ABEND                CL**2
01999                                                                      CL**2
02000              END-EVALUATE                                            CL**2
02001                                                                      CL**2
02002          END-IF                                                      CL**2
02003                                                                      CL**2
02004      END-PERFORM.                                                    CL**2
02005                                                                      CL**2
02006      IF PV-SQL-WKR-SUB > PC-MAX-RETRIES                              CL**2
02007 *       ** MAX RETRIES EXCEEDED, PERFORM ABEND **                    CL**2
02008           SET DP013-LOGIC-ABEND TO TRUE                              CL**2
02009           SET DP013-NO-ROLLBACK TO TRUE                              CL**2
02010           MOVE 'E5100-CHECK-TSPBAR-TABLE' TO                         CL**2
02011                 DP013-PARAGRAPH                                      CL**2
02012           MOVE PM-PROGRAM-MESSAGE-6 TO                               CL**2
02013                 DP013-MESSAGE-TEXT(1)                                CL**2
02014           PERFORM DP013-0000-PROCESS-ABEND                           CL**2
02015      END-IF.                                                         CL**2
02016 *                                                                    CL**2
02017      EJECT                                                           CL**2
02018                                                                      CL**2
02019  F1000-RETRIEVE-RECORD.                                              CL**2
02020 ******************************************************************   CL**2
02021 *    EXECUTE THE WORKER TABLE SELECTION CURSOR                   *   CL**2
02022 *    (ONCE FOR EACH RECORD TO BE RETRIEVED)                      *   CL**2
02023 *                                                                *   CL**2
02024 *    USING THE VALUES IN THE PV-WORKER-... FIELDS                *   CL**2
02025 ******************************************************************   CL**2
02026 *                                                                    CL**2
02027      MOVE SPACES             TO MB007-ADD-RESULTS.                   CL**2
02028                                                                      CL**2
02029      MOVE WORKER-UID-NBR     TO PV-USERID.                           CL**2
02030                                                                      CL**2
02031      PERFORM G1000-OPEN-WKR-CURSOR.                                  CL**2
02032                                                                      CL**2
02033      PERFORM                                                         CL**2
02034          WITH TEST AFTER                                             CL**2
02035          VARYING PV-SQL-WKR-SUB                                      CL**2
02036          FROM 1 BY 1                                                 CL**2
02037          UNTIL ( PV-SQL-WKR-SUB > PC-MAX-RETRIES                     CL**2
02038                  OR SQLCODE = 0                                      CL**2
02039                  OR SQLCODE = +100 )                                 CL**2
02040                                                                      CL**2
02041          EXEC SQL                                                    CL**2
02042              FETCH   WORKER-RECS                                     CL**2
02043               INTO                                                   CL**2
02044                      :WORKER-OPERCO-NBR                              CL**2
02045                    , :WORKER-NBR                                     CL**2
02046                    , :WORKER-UID-NBR                                 CL**2
02047                    , :WORKER-LAST-NAME                               CL**2
02048                    , :WORKER-FIR-NAME                                CL**2
02049          END-EXEC                                                    CL**2
02050                                                                      CL**2
02051          EVALUATE TRUE                                               CL**2
02052                                                                      CL**2
02053              WHEN SQLCODE = +100                                     CL**2
02054 *              ** ROW NOT FOUND FOR FETCH, UPDATE, DELETE **         CL**2
02055                                                                      CL*14
02056                IF WORKER-LAST-NAME = '%%%%%%%%%%%%%%%%%%'            CL**2
02057                    MOVE SPACES          TO WORKER-LAST-NAME          CL**2
02058                END-IF                                                CL**2
02059                IF WORKER-FIR-NAME =  '%%%%%%%%%%%%'                  CL**2
02060                    MOVE SPACES          TO WORKER-FIR-NAME           CL**2
02061                END-IF                                                CL**2
02062                IF WORKER-UID-NBR  =  '%%%%%%%%'                      CL**2
02063                    MOVE SPACES          TO WORKER-UID-NBR            CL**2
02064                END-IF                                                CL**2
02065                                                                      CL**2
02066                IF (DP020-SRC-MNEMONIC =                              CL**6
02067                      PC-WORKER-ADD-MNEMONIC)                         CL**6
02068 *                  ** RESULTS ARE AS EXPECTED **                     CL**7
02069                    CONTINUE                                          CL**3
02070                                                                      CL**2
02071                ELSE                                                  CL*14
02072                                                                      CL*14
02073                   IF (DP020-SRC-MNEMONIC =                           CL*12
02074                                  PC-WORKER-DEL-MNEMONIC)             CL*14
02075 *                     ** ROW NOT FOUND FOR DELETE **                 CL*14
02076                       MOVE PC-TSYMSG-00116 TO DP020-MSG-NUMBER       CL*14
02077                   END-IF                                             CL*14
02078                   IF (DP020-SRC-MNEMONIC =                           CL*14
02079                                  PC-WORKER-UPDT-MNEMONIC)            CL*14
02080 *                     ** ROW NOT FOUND FOR UPDATE **                 CL*14
02081                       MOVE PC-TSYMSG-00158 TO DP020-MSG-NUMBER       CL*14
02082                   END-IF                                             CL*14
02083                                                                      CL*14
02084                   IF MB007-LIST                                      CL*14
02085                       SET PS-CANNOT-EDIT-FIELDS TO TRUE              CL*14
02086                       SET DP020-MSG-FATAL       TO TRUE              CL*14
02087                       SET PS-ERROR              TO TRUE              CL*14
02088                       PERFORM K4000-REBUILD-SCREEN                   CL*14
02089                   ELSE                                               CL*14
02090                       PERFORM S4000-SETUP-INTER-APPL                 CL*14
02091                       PERFORM S9000-RETURN-TO-PREV-TRAN              CL*14
02092                   END-IF                                             CL*14
02093                                                                      CL*14
02094                END-IF                                                CL*14
02095                                                                      CL**2
02096              WHEN SQLCODE = 0                                        CL**2
02097                IF MB007-ADD                                          CL**3
02098 *                 ** USER ID EXISTS ALREADY **                       CL**3
02099                    SET MB007-DUP-ADD-REC TO TRUE                     CL**2
02100                    MOVE PC-TSYMSG-00117 TO DP020-MSG-NUMBER          CL**2
02101                    SET DP020-MSG-FATAL  TO TRUE                      CL**2
02102                    SET PS-ERROR         TO TRUE                      CL**2
02103                END-IF                                                CL**2
02104                                                                      CL**2
02105              WHEN SQLCODE = -811                                     CL**2
02106 *              ** SELECT RESULTED IN MULTIPLE ROWS **                CL**2
02107                IF MB007-DELETE                                       CL**2
02108                    MOVE PC-TSYMSG-00116 TO DP020-MSG-NUMBER          CL**2
02109                    SET DP020-MSG-FATAL  TO TRUE                      CL**2
02110                END-IF                                                CL**2
02111                IF MB007-UPDATE                                       CL**2
02112 *                  ** ROW NOT FOUND FOR UPDATE **                    CL**2
02113                    SET PS-CANNOT-EDIT-FIELDS TO TRUE                 CL**2
02114                    MOVE PC-TSYMSG-00158 TO DP020-MSG-NUMBER          CL**2
02115                    SET DP020-MSG-FATAL  TO TRUE                      CL**2
02116                END-IF                                                CL**2
02117                                                                      CL**2
02118              WHEN SQLCODE = -904                                     CL**2
02119 *              ** UNAVAILABLE RESOURCE **                            CL**2
02120              WHEN SQLCODE = -911                                     CL**2
02121 *              ** ROLLBACK HAS OCCURED DUE TO DEADLOCK OR TIME **    CL**2
02122              WHEN SQLWARN NOT = SPACES                               CL**2
02123              WHEN SQLCODE NOT = ZERO                                 CL**2
02124 *              ** PERFORM ABEND **                                   CL**2
02125                  SET DP013-LOGIC-ABEND TO TRUE                       CL**2
02126                  SET DP013-NO-ROLLBACK TO TRUE                       CL**2
02127                  MOVE 'F1000-RETRIEVE-RECORD' TO                     CL**2
02128                       DP013-PARAGRAPH                                CL**2
02129                  MOVE SQLCODE TO PM-SQLCODE-2                        CL**2
02130                  MOVE PM-PROGRAM-MESSAGE-2 TO                        CL**2
02131                       DP013-MESSAGE-TEXT(1)                          CL**2
02132                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
02133                                                                      CL**2
02134          END-EVALUATE                                                CL**2
02135                                                                      CL**2
02136      END-PERFORM.                                                    CL**2
02137                                                                      CL**2
02138      IF DP020-MSG-FATAL                                              CL**2
02139         SET PS-ERROR     TO TRUE                                     CL**2
02140         MOVE -1          TO ANAVCMDL                                 CL**2
02141      END-IF.                                                         CL**2
02142                                                                      CL**2
02143      IF PV-SQL-WKR-SUB > PC-MAX-RETRIES                              CL**2
02144 *       ** MAX RETRIES EXCEEDED, PERFORM ABEND **                    CL**2
02145           SET DP013-LOGIC-ABEND TO TRUE                              CL**2
02146           SET DP013-NO-ROLLBACK TO TRUE                              CL**2
02147           MOVE 'F1000-RETRIEVE-RECORD' TO                            CL**2
02148                 DP013-PARAGRAPH                                      CL**2
02149           MOVE SQLCODE TO PM-SQLCODE-2                               CL**2
02150           MOVE PM-PROGRAM-MESSAGE-2 TO                               CL**2
02151                 DP013-MESSAGE-TEXT(1)                                CL**2
02152           PERFORM DP013-0000-PROCESS-ABEND                           CL**2
02153      ELSE                                                            CL**2
02154          MOVE WORKER-LAST-NAME  TO MB007-LAST-NAME                   CL**2
02155          MOVE WORKER-FIR-NAME   TO MB007-FIR-NAME                    CL**2
02156          MOVE WORKER-UID-NBR    TO MB007-USERID                      CL**2
02157      END-IF.                                                         CL**2
02158                                                                      CL**2
02159      PERFORM G2000-CLOSE-WKR-CURSOR.                                 CL**2
02160 *                                                                    CL**2
02161  EJECT                                                               CL**2
02162                                                                      CL**2
02163  G1000-OPEN-WKR-CURSOR.                                              CL**2
02164 ******************************************************************   CL**2
02165 *   OPEN THE WORKER TABLE CURSOR                                     CL**2
02166 ******************************************************************   CL**2
02167 *                                                                    CL**2
02168      PERFORM                                                         CL**2
02169          WITH TEST AFTER                                             CL**2
02170          VARYING PV-SQL-WKR-SUB                                      CL**2
02171          FROM 1 BY 1                                                 CL**2
02172          UNTIL ( PV-SQL-WKR-SUB > PC-MAX-RETRIES                     CL**2
02173                  OR SQLCODE = 0 )                                    CL**2
02174                                                                      CL**2
02175          EXEC SQL                                                    CL**2
02176              OPEN WORKER-RECS                                        CL**2
02177          END-EXEC                                                    CL**2
02178                                                                      CL**2
02179          EVALUATE TRUE                                               CL**2
02180                                                                      CL**2
02181              WHEN SQLCODE = 0                                        CL**2
02182 *              ** SUCCESSFULLY OPENED **                             CL**2
02183              WHEN SQLCODE = -904                                     CL**2
02184 *              ** UNAVAILABLE RESOURCE **                            CL**2
02185              WHEN SQLCODE = -911                                     CL**2
02186 *              ** ROLLBACK HAS OCCURED DUE TO DEADLOCK OR TIME **    CL**2
02187                                                                      CL**2
02188                    CONTINUE                                          CL**2
02189                                                                      CL**2
02190              WHEN SQLWARN NOT = SPACES                               CL**2
02191              WHEN SQLCODE NOT = ZERO                                 CL**2
02192                                                                      CL**2
02193 *              ** PERFORM ABEND **                                   CL**2
02194                  SET DP013-LOGIC-ABEND TO TRUE                       CL**2
02195                  SET DP013-NO-ROLLBACK TO TRUE                       CL**2
02196                  MOVE 'G1000-OPEN-WKR-CURSOR' TO                     CL**2
02197                       DP013-PARAGRAPH                                CL**2
02198                  MOVE SQLCODE TO PM-SQLCODE-2                        CL**2
02199                  MOVE PM-PROGRAM-MESSAGE-2 TO                        CL**2
02200                       DP013-MESSAGE-TEXT(1)                          CL**2
02201                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
02202                                                                      CL**2
02203          END-EVALUATE                                                CL**2
02204                                                                      CL**2
02205      END-PERFORM.                                                    CL**2
02206                                                                      CL**2
02207      IF PV-SQL-WKR-SUB > PC-MAX-RETRIES                              CL**2
02208 *       ** MAX RETRIES EXCEEDED, PERFORM ABEND **                    CL**2
02209           SET DP013-LOGIC-ABEND TO TRUE                              CL**2
02210           SET DP013-NO-ROLLBACK TO TRUE                              CL**2
02211           MOVE 'G1000-OPEN-WKR-CURSOR' TO                            CL**2
02212                 DP013-PARAGRAPH                                      CL**2
02213           MOVE SQLCODE TO PM-SQLCODE-2                               CL**2
02214           MOVE PM-PROGRAM-MESSAGE-2 TO                               CL**2
02215                 DP013-MESSAGE-TEXT(1)                                CL**2
02216           PERFORM DP013-0000-PROCESS-ABEND                           CL**2
02217      END-IF.                                                         CL**2
02218 *                                                                    CL**2
02219  EJECT                                                               CL**2
02220                                                                      CL**2
02221  G2000-CLOSE-WKR-CURSOR.                                             CL**2
02222 ******************************************************************   CL**2
02223 *   CLOSE THE WORKER TABLE CURSOR                                    CL**2
02224 ******************************************************************   CL**2
02225 *                                                                    CL**2
02226      PERFORM                                                         CL**2
02227          WITH TEST AFTER                                             CL**2
02228          VARYING PV-SQL-WKR-SUB                                      CL**2
02229          FROM 1 BY 1                                                 CL**2
02230          UNTIL ( PV-SQL-WKR-SUB > PC-MAX-RETRIES                     CL**2
02231                  OR SQLCODE = 0 )                                    CL**2
02232                                                                      CL**2
02233          EXEC SQL                                                    CL**2
02234              CLOSE WORKER-RECS                                       CL**2
02235          END-EXEC                                                    CL**2
02236                                                                      CL**2
02237          EVALUATE TRUE                                               CL**2
02238                                                                      CL**2
02239              WHEN SQLCODE = 0                                        CL**2
02240 *              ** SUCCESSFULLY CLOSED **                             CL**2
02241              WHEN SQLCODE = -904                                     CL**2
02242 *              ** UNAVAILABLE RESOURCE **                            CL**2
02243              WHEN SQLCODE = -911                                     CL**2
02244 *              ** ROLLBACK HAS OCCURED DUE TO DEADLOCK OR TIME **    CL**2
02245                                                                      CL**2
02246                    CONTINUE                                          CL**2
02247                                                                      CL**2
02248              WHEN SQLWARN NOT = SPACES                               CL**2
02249              WHEN SQLCODE NOT = ZERO                                 CL**2
02250                                                                      CL**2
02251 *              ** PERFORM ABEND **                                   CL**2
02252                  SET DP013-LOGIC-ABEND TO TRUE                       CL**2
02253                  SET DP013-NO-ROLLBACK TO TRUE                       CL**2
02254                  MOVE 'G2000-CLOSE-WKR-CURSOR' TO                    CL**2
02255                       DP013-PARAGRAPH                                CL**2
02256                  MOVE SQLCODE TO PM-SQLCODE-2                        CL**2
02257                  MOVE PM-PROGRAM-MESSAGE-2 TO                        CL**2
02258                       DP013-MESSAGE-TEXT(1)                          CL**2
02259                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
02260                                                                      CL**2
02261          END-EVALUATE                                                CL**2
02262                                                                      CL**2
02263      END-PERFORM.                                                    CL**2
02264                                                                      CL**2
02265      IF PV-SQL-WKR-SUB > PC-MAX-RETRIES                              CL**2
02266 *       ** MAX RETRIES EXCEEDED, PERFORM ABEND **                    CL**2
02267           SET DP013-LOGIC-ABEND TO TRUE                              CL**2
02268           SET DP013-NO-ROLLBACK TO TRUE                              CL**2
02269           MOVE 'G2000-CLOSE-WKR-CURSOR' TO                           CL**2
02270                 DP013-PARAGRAPH                                      CL**2
02271           MOVE SQLCODE TO PM-SQLCODE-2                               CL**2
02272           MOVE PM-PROGRAM-MESSAGE-2 TO                               CL**2
02273                 DP013-MESSAGE-TEXT(1)                                CL**2
02274           PERFORM DP013-0000-PROCESS-ABEND                           CL**2
02275      END-IF.                                                         CL**2
02276 *                                                                    CL**2
02277  EJECT                                                               CL**2
02278                                                                      CL**2
02279  K1000-READ-LIST-QUEUE.                                              CL**2
02280 ******************************************************************   CL**2
02281 *    ** DETERMINE WHERE IN THE LIST THAT THE FIRST OR NEXT           CL**2
02282 *    ** SELECTED ITEM APPEARS THAT WILL BE MAINTAINED.               CL**2
02283 ******************************************************************   CL**2
02284 *                                                                    CL**2
02285      SET PS-FWD-PATH TO TRUE.                                        CL**2
02286 *                                                                    CL**2
02287      SET PS-NO-ITEM-SELECTED TO TRUE.                                CL**2
02288      SET MB138-RESET-LIST-ITEM TO TRUE.                              CL**2
02289                                                                      CL**2
02290      PERFORM                                                         CL**2
02291          WITH TEST AFTER                                             CL**2
02292          UNTIL ( PS-ITEM-SELECTED OR                                 CL**2
02293                  MB138-LAST-LIST-ITEM )                              CL**2
02294                                                                      CL**2
02295              SET PS-NOT-NEW-BLOCK TO TRUE                            CL**2
02296              IF MB007Q-IDX = PC-MAX-ITEMS-PER-BLOCK                  CL**2
02297                  ADD 1 TO MB138-BLOCK-NUMBER                         CL**2
02298                  SET MB007Q-IDX TO +1                                CL**2
02299                  SET PS-NEW-BLOCK TO TRUE                            CL**2
02300              END-IF                                                  CL**2
02301                                                                      CL**2
02302              EXEC CICS                                               CL**2
02303                  READQ TS                                            CL**2
02304                  QUEUE(MB007-LIST-QUEUE-NAME)                        CL**2
02305                  INTO(MB007Q-TSQ-LIST)                               CL**2
02306                  LENGTH(MB007-LIST-QUEUE-LENGTH)                     CL**2
02307                  ITEM(MB138-BLOCK-NUMBER)                            CL**2
02308                  RESP(PV-CICS-RESPONSE)                              CL**2
02309              END-EXEC                                                CL**2
02310                                                                      CL**2
02311              IF PV-CICS-RESPONSE = +0                                CL**2
02312                                                                      CL**2
02313                 IF MB138-ITEM-PROCESSED                              CL**2
02314                                                                      CL**2
02315                     IF MB007Q-LIST-ITEM-NBR (MB007Q-IDX) <           CL**2
02316                        MB007-NUMBER-PROCESSED-ITEMS                  CL**2
02317                                                                      CL**2
02318 *                        ** PREVENT PROCESSING A RECORD TWICE **     CL**2
02319                           SET MB138-ITEM-NOT-PROCESSED TO TRUE       CL**2
02320                           IF PS-NEW-BLOCK                            CL**2
02321                               CONTINUE                               CL**2
02322                           ELSE                                       CL**2
02323                               SET MB007Q-IDX UP BY 1                 CL**2
02324                           END-IF                                     CL**2
02325                                                                      CL**2
02326                     END-IF                                           CL**2
02327                 END-IF                                               CL**2
02328                 SET PS-NOT-NEW-BLOCK TO TRUE                         CL**2
02329                                                                      CL**2
02330                 PERFORM                                              CL**2
02331                    WITH TEST AFTER                                   CL**2
02332                    VARYING MB007Q-IDX                                CL**2
02333                    FROM MB007Q-IDX BY 1                              CL**2
02334                    UNTIL ( PS-ITEM-SELECTED OR                       CL**2
02335                            MB138-LAST-LIST-ITEM OR                   CL**2
02336                            MB007Q-IDX = PC-MAX-ITEMS-PER-BLOCK)      CL**2
02337                                                                      CL**2
02338                      IF MB007Q-LIST-ITEM-NBR (MB007Q-IDX)            CL**2
02339                                       =  MB138-LIST-ITEM             CL**2
02340                          PERFORM L1000-TEST-SELECT-SW                CL**2
02341                      END-IF                                          CL**2
02342                                                                      CL**2
02343                      IF MB007Q-LIST-ITEM-NBR (MB007Q-IDX)            CL**2
02344                                       >  MB138-LIST-ITEM             CL**2
02345                          PERFORM L1000-TEST-SELECT-SW                CL**2
02346                      END-IF                                          CL**2
02347                                                                      CL**2
02348                      IF MB007Q-LIST-ITEM-NBR (MB007Q-IDX)            CL**2
02349                                       <  MB138-LIST-ITEM             CL**2
02350 *                       ** ITEM ALREADY PROCESSED **                 CL**2
02351                          CONTINUE                                    CL**2
02352                      END-IF                                          CL**2
02353                                                                      CL**2
02354                      IF (MB007Q-LIST-ITEM-NBR (MB007Q-IDX) =         CL**2
02355                            MB007-NUMBER-PROCESSED-ITEMS)             CL**2
02356 *                        ** END OF ITEM BLOCKS REACHED **            CL**2
02357                              PERFORM L1000-TEST-SELECT-SW            CL**2
02358                              SET MB138-LAST-LIST-ITEM TO TRUE        CL**2
02359                      END-IF                                          CL**2
02360                                                                      CL**2
02361                 END-PERFORM                                          CL**2
02362                                                                      CL**2
02363              ELSE                                                    CL**2
02364                  MOVE PV-CICS-RESPONSE TO PM-RESP-22                 CL**2
02365                  SET DP013-LOGIC-ABEND TO TRUE                       CL**2
02366                  SET DP013-NO-ROLLBACK TO TRUE                       CL**2
02367                  MOVE 'K1000-READ-LIST-QUEUE' TO                     CL**2
02368                       DP013-PARAGRAPH                                CL**2
02369                  MOVE PM-PROGRAM-MESSAGE-22 TO                       CL**2
02370                       DP013-MESSAGE-TEXT(1)                          CL**2
02371                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
02372              END-IF                                                  CL**2
02373                                                                      CL**2
02374      END-PERFORM.                                                    CL**2
02375 *                                                                    CL**2
02376      SET PS-NO-PATH TO TRUE.                                         CL**2
02377 *                                                                    CL**2
02378  EJECT                                                               CL**2
02379                                                                      CL**2
02380  K1500-REVERSE-LIST-QUEUE.                                           CL**2
02381 ******************************************************************   CL**2
02382 *    ** DETERMINE WHERE IN THE LIST THE PREVIOUS SELECTED ITEM       CL**2
02383 *    ** APPEARED THAT WAS TO BE MAINTAINED.                          CL**2
02384 ******************************************************************   CL**2
02385 *                                                                    CL**2
02386      SET PS-BKWD-PATH TO TRUE.                                       CL**2
02387 *                                                                    CL**2
02388      SET PS-NO-ITEM-SELECTED TO TRUE.                                CL**2
02389      SET MB138-RESET-LIST-ITEM TO TRUE.                              CL**2
02390                                                                      CL**2
02391      PERFORM                                                         CL**2
02392          WITH TEST AFTER                                             CL**2
02393          UNTIL ( PS-ITEM-SELECTED OR                                 CL**2
02394                  MB138-1ST-LIST-ITEM )                               CL**2
02395                                                                      CL**2
02396              SET PS-NOT-NEW-BLOCK TO TRUE                            CL**2
02397              IF MB007Q-IDX < +2                                      CL**2
02398                  SET PS-NEW-BLOCK TO TRUE                            CL**2
02399                  IF MB138-BLOCK-NUMBER > +1                          CL**2
02400                      SUBTRACT 1 FROM MB138-BLOCK-NUMBER              CL**2
02401                      SET MB007Q-IDX TO PC-MAX-ITEMS-PER-BLOCK        CL**2
02402                  ELSE                                                CL**2
02403 *                   ** BEGINNING OF ITEMS REACHED **                 CL**2
02404                      MOVE 1 TO MB138-BLOCK-NUMBER                    CL**2
02405                      SET MB007Q-IDX TO +1                            CL**2
02406                      SET MB138-1ST-LIST-ITEM TO TRUE                 CL**2
02407                  END-IF                                              CL**2
02408              END-IF                                                  CL**2
02409                                                                      CL**2
02410              EXEC CICS                                               CL**2
02411                  READQ TS                                            CL**2
02412                  QUEUE(MB007-LIST-QUEUE-NAME)                        CL**2
02413                  INTO(MB007Q-TSQ-LIST)                               CL**2
02414                  LENGTH(MB007-LIST-QUEUE-LENGTH)                     CL**2
02415                  ITEM(MB138-BLOCK-NUMBER)                            CL**2
02416                  RESP(PV-CICS-RESPONSE)                              CL**2
02417              END-EXEC                                                CL**2
02418                                                                      CL**2
02419              IF PV-CICS-RESPONSE = +0                                CL**2
02420                                                                      CL**2
02421                 IF MB138-ITEM-PROCESSED                              CL**2
02422                     SET MB138-ITEM-NOT-PROCESSED TO TRUE             CL**2
02423                     IF PS-NEW-BLOCK                                  CL**2
02424                         CONTINUE                                     CL**2
02425                     ELSE                                             CL**2
02426 *                      ** PREVENT PROCESSING A RECORD TWICE **       CL**2
02427                         SET MB007Q-IDX DOWN BY 1                     CL**2
02428                     END-IF                                           CL**2
02429                 END-IF                                               CL**2
02430                 SET PS-NOT-NEW-BLOCK TO TRUE                         CL**2
02431                                                                      CL**2
02432                 PERFORM                                              CL**2
02433                    WITH TEST AFTER                                   CL**2
02434                    VARYING MB007Q-IDX                                CL**2
02435                    FROM MB007Q-IDX BY -1                             CL**2
02436                    UNTIL ( PS-ITEM-SELECTED OR                       CL**2
02437                            MB138-1ST-LIST-ITEM OR                    CL**2
02438                            MB007Q-IDX < +1 )                         CL**2
02439                                                                      CL**2
02440                    IF MB007Q-IDX < +1                                CL**2
02441                        CONTINUE                                      CL**2
02442                    ELSE                                              CL**2
02443                                                                      CL**2
02444                        IF MB007Q-LIST-ITEM-NBR (MB007Q-IDX) = +0     CL**2
02445                            CONTINUE                                  CL**2
02446                        ELSE                                          CL**2
02447                                                                      CL**2
02448                            IF MB007Q-LIST-ITEM-NBR (MB007Q-IDX)      CL**2
02449                                         =  MB138-LIST-ITEM           CL**2
02450                                PERFORM L1000-TEST-SELECT-SW          CL**2
02451                            END-IF                                    CL**2
02452                                                                      CL**2
02453                            IF MB007Q-LIST-ITEM-NBR (MB007Q-IDX)      CL**2
02454                                         <  MB138-LIST-ITEM           CL**2
02455                                PERFORM L1000-TEST-SELECT-SW          CL**2
02456                            END-IF                                    CL**2
02457                                                                      CL**2
02458                            IF MB007Q-LIST-ITEM-NBR (MB007Q-IDX)      CL**2
02459                                         >  MB138-LIST-ITEM           CL**2
02460 *                             ** ITEM ALREADY PROCESSED **           CL**2
02461                                CONTINUE                              CL**2
02462                            END-IF                                    CL**2
02463                                                                      CL**2
02464                            IF MB138-LIST-ITEM = +1                   CL**2
02465                                PERFORM L1000-TEST-SELECT-SW          CL**2
02466                                SET MB138-1ST-LIST-ITEM TO TRUE       CL**2
02467                            END-IF                                    CL**2
02468                                                                      CL**2
02469                        END-IF                                        CL**2
02470                    END-IF                                            CL**2
02471                                                                      CL**2
02472                 END-PERFORM                                          CL**2
02473                                                                      CL**2
02474              ELSE                                                    CL**2
02475                  MOVE PV-CICS-RESPONSE TO PM-RESP-22                 CL**2
02476                  SET DP013-LOGIC-ABEND TO TRUE                       CL**2
02477                  SET DP013-NO-ROLLBACK TO TRUE                       CL**2
02478                  MOVE 'K1500-REVERSE-LIST-QUEUE' TO                  CL**2
02479                       DP013-PARAGRAPH                                CL**2
02480                  MOVE PM-PROGRAM-MESSAGE-22 TO                       CL**2
02481                       DP013-MESSAGE-TEXT(1)                          CL**2
02482                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
02483              END-IF                                                  CL**2
02484                                                                      CL**2
02485      END-PERFORM.                                                    CL**2
02486 *                                                                    CL**2
02487      SET PS-NO-PATH TO TRUE.                                         CL**2
02488 *                                                                    CL**2
02489  EJECT                                                               CL**2
02490                                                                      CL**2
02491  K2000-UPDATE-LIST-QUEUE.                                            CL**2
02492 ******************************************************************   CL**2
02493 *    DETERMINE WHERE IN THE LIST BLOCK (IN COMMAREA) THE FIRST       CL**2
02494 *    SELECTED ITEM APPEARS THAT WILL BE MAINTAINED. THEN,            CL**2
02495 *    UPDATE THE LIST QUEUE WITH THE DATA BASE CHANGE MADE.           CL**2
02496 *    THIS WILL ALLOW IT TO BE PROPERLY REFLECTED IN THE LIST.        CL**2
02497 ******************************************************************   CL**2
02498 *                                                                    CL**2
02499      IF MB007Q-LIST-ITEM-NBR (MB007Q-IDX) = MB138-LIST-ITEM          CL**2
02500 *                                                                    CL**2
02501          IF DP020-FK-CONFIRM(DP020-SRC-AID)                          CL**2
02502 *           ** WORKER DELETE (PF16) / CONFIRMED **                   CL**2
02503              MOVE 'DEL'   TO MB007Q-REC-ACTION(MB007Q-IDX)           CL**2
02504              MOVE 'D'     TO MB007Q-SELECTED-SW(MB007Q-IDX)          CL**2
02505          END-IF                                                      CL**2
02506                                                                      CL**2
02507          IF DP020-SRC-AID = DP016-PF15                               CL**2
02508 *           ** WORKER UPDATE (PF15) **                               CL**2
02509              MOVE 'UPD'   TO MB007Q-REC-ACTION(MB007Q-IDX)           CL**2
02510              MOVE 'U'     TO MB007Q-SELECTED-SW(MB007Q-IDX)          CL**2
02511              MOVE WORKER-FIR-NAME                                    CL**2
02512                           TO  MB007Q-WKR-FNAME(MB007Q-IDX)           CL**2
02513              MOVE WORKER-LAST-NAME                                   CL**2
02514                           TO  MB007Q-WKR-LNAME(MB007Q-IDX)           CL**2
02515              MOVE WORKER-UID-NBR                                     CL**2
02516                           TO  MB007Q-WKR-UID-NBR(MB007Q-IDX)         CL**2
02517          END-IF                                                      CL**2
02518 *                                                                    CL**2
02519          EXEC CICS                                                   CL**2
02520               WRITEQ TS REWRITE                                      CL**2
02521               QUEUE(MB007-LIST-QUEUE-NAME)                           CL**2
02522               FROM(MB007Q-TSQ-LIST)                                  CL**2
02523               LENGTH(MB007-LIST-QUEUE-LENGTH)                        CL**2
02524               ITEM(MB138-BLOCK-NUMBER)                               CL**2
02525               RESP(PV-CICS-RESPONSE)                                 CL**2
02526          END-EXEC                                                    CL**2
02527                                                                      CL**2
02528          IF PV-CICS-RESPONSE = +0                                    CL**2
02529              CONTINUE                                                CL**2
02530 *                                                                    CL**2
02531          ELSE                                                        CL**2
02532 *            ?? ROLLBACK ??                                          CL**2
02533               MOVE PV-CICS-RESPONSE TO PM-RESP-23                    CL**2
02534               SET DP013-LOGIC-ABEND TO TRUE                          CL**2
02535               SET DP013-NO-ROLLBACK TO TRUE                          CL**2
02536               MOVE 'K2100-REWRITE-LIST-QUEUE' TO                     CL**2
02537                    DP013-PARAGRAPH                                   CL**2
02538               MOVE PM-PROGRAM-MESSAGE-23 TO                          CL**2
02539                    DP013-MESSAGE-TEXT(1)                             CL**2
02540               PERFORM DP013-0000-PROCESS-ABEND                       CL**2
02541           END-IF                                                     CL**2
02542 *                                                                    CL**2
02543 *    ELSE                                                            CL**2
02544 *         ** ERROR, UPDATE ITEM NOT FOUND IN BLOCK **                CL**2
02545 *         ** THIS SHOULD NEVER HAPPEN              **                CL**2
02546                                                                      CL**2
02547      END-IF.                                                         CL**2
02548 *                                                                    CL**2
02549      EJECT                                                           CL**2
02550                                                                      CL**2
02551  K3000-RESTORE-PREVIOUS-BLOCK.                                       CL**2
02552 ******************************************************************   CL**2
02553 *    RESTORE THE PREVIOUS BLOCK PROCESSED, CONTAINING                CL**2
02554 *    EITHER THE FIRST SELECTED ITEM OR THE LAST LIST ITEM,           CL**2
02555 *    DEPENDING ON WHETHER THE USER IS PAGING FWD OR BKWD.            CL**2
02556 ******************************************************************   CL**2
02557 *                                                                    CL**2
02558      EXEC CICS                                                       CL**2
02559          READQ TS                                                    CL**2
02560          QUEUE(MB007-LIST-QUEUE-NAME)                                CL**2
02561          INTO(MB007Q-TSQ-LIST)                                       CL**2
02562          LENGTH(MB007-LIST-QUEUE-LENGTH)                             CL**2
02563          ITEM(MB138-BLOCK-NUMBER)                                    CL**2
02564          RESP(PV-CICS-RESPONSE)                                      CL**2
02565      END-EXEC.                                                       CL**2
02566                                                                      CL**2
02567      IF PV-CICS-RESPONSE = +0                                        CL**2
02568          CONTINUE                                                    CL**2
02569      ELSE                                                            CL**2
02570          MOVE PV-CICS-RESPONSE TO PM-RESP-22                         CL**2
02571          SET DP013-LOGIC-ABEND TO TRUE                               CL**2
02572          SET DP013-NO-ROLLBACK TO TRUE                               CL**2
02573          MOVE 'K3000-RESTORE-PREVIOUS-BLOCK' TO                      CL**2
02574               DP013-PARAGRAPH                                        CL**2
02575          MOVE PM-PROGRAM-MESSAGE-22 TO                               CL**2
02576               DP013-MESSAGE-TEXT(1)                                  CL**2
02577          PERFORM DP013-0000-PROCESS-ABEND                            CL**2
02578      END-IF.                                                         CL**2
02579 *                                                                    CL**2
02580      EJECT                                                           CL**2
02581                                                                      CL**2
02582  K4000-REBUILD-SCREEN.                                               CL**2
02583 ******************************************************************   CL**2
02584 *    BUILD THE SCREEN PANEL FROM THE LIST SCREEN TEMP STORAGE.       CL**2
02585 ******************************************************************   CL**2
02586 *                                                                    CL**2
02587      IF (MB007Q-REC-ACTION (MB007Q-IDX) = 'DEL') OR                  CL**2
02588         (MB007Q-SELECTED-SW(MB007Q-IDX) = 'D' )                      CL**2
02589          SET PS-ERROR         TO TRUE                                CL**2
02590      END-IF.                                                         CL**2
02591                                                                      CL**2
02592      IF PS-ERROR                                                     CL**2
02593          CONTINUE                                                    CL**2
02594      ELSE                                                            CL**2
02595          INITIALIZE DCLTWORKER                                       CL**2
02596          SET PS-SAVE-DATA TO TRUE                                    CL**2
02597                                                                      CL**2
02598          IF PS-ITEM-SELECTED                                         CL**2
02599              MOVE MB007Q-WKR-LNAME (MB007Q-IDX)                      CL**2
02600                               TO  MB007-LAST-NAME                    CL**2
02601              MOVE MB007Q-WKR-FNAME (MB007Q-IDX)                      CL**2
02602                               TO  MB007-FIR-NAME                     CL**2
02603              MOVE MB007Q-WKR-UID-NBR (MB007Q-IDX)                    CL**2
02604                               TO  MB007-USERID                       CL**2
02605          END-IF                                                      CL**2
02606                                                                      CL**2
02607          PERFORM E1000-EDIT-DATA-IN-COMMAREA                         CL**2
02608                                                                      CL**2
02609          IF PS-ERROR                                                 CL**2
02610              CONTINUE                                                CL**2
02611          ELSE                                                        CL**2
02612 *           ** READ THE DB2 RECORD FOR THE 1ST USERID RECEIVED **    CL**2
02613              PERFORM E2000-FORMAT-WORKER-RECORD                      CL**2
02614              PERFORM F1000-RETRIEVE-RECORD                           CL**2
02615          END-IF                                                      CL**2
02616                                                                      CL**2
02617      END-IF.                                                         CL**2
02618                                                                      CL**2
02619      IF (MB007Q-REC-ACTION (MB007Q-IDX) = 'DEL') OR                  CL**2
02620         (MB007Q-SELECTED-SW(MB007Q-IDX) = 'D' )                      CL**2
02621                                                                      CL**2
02622          MOVE MB007Q-WKR-LNAME (MB007Q-IDX)                          CL**2
02623                           TO  MB007-LAST-NAME                        CL**2
02624          MOVE MB007Q-WKR-FNAME (MB007Q-IDX)                          CL**2
02625                           TO  MB007-FIR-NAME                         CL**2
02626          MOVE MB007Q-WKR-UID-NBR (MB007Q-IDX)                        CL**2
02627                           TO  MB007-USERID                           CL**2
02628                                                                      CL**2
02629          IF DP020-MSG-NUMBER = PC-TSYMSG-00069 OR                    CL**2
02630             DP020-MSG-NUMBER = PC-TSYMSG-00070                       CL**2
02631              CONTINUE                                                CL**4
02632          ELSE                                                        CL**2
02633              IF (DP020-SRC-MNEMONIC = PC-WORKER-UPDT-MNEMONIC)       CL*11
02634 *               ** ROW NOT FOUND FOR UPDATE **                       CL**2
02635                  MOVE PC-TSYMSG-00158 TO DP020-MSG-NUMBER            CL**2
02636              ELSE                                                    CL**2
02637 *               ** ROW NOT FOUND FOR DELETE **                       CL**2
02638                  MOVE PC-TSYMSG-00116 TO DP020-MSG-NUMBER            CL**2
02639              END-IF                                                  CL**2
02640              SET PS-CANNOT-EDIT-FIELDS TO TRUE                       CL**2
02641          END-IF                                                      CL**2
02642                                                                      CL**2
02643          SET DP020-MSG-FATAL  TO TRUE                                CL**2
02644          SET PS-ERROR         TO TRUE                                CL**2
02645                                                                      CL**2
02646      END-IF.                                                         CL**2
02647 *                                                                    CL**2
02648  EJECT                                                               CL**2
02649                                                                      CL**2
02650  L1000-TEST-SELECT-SW.                                               CL**2
02651 ******************************************************************   CL**2
02652 *    DETERMINE IF THE LIST ROW IS SELECTED FOR MAINTENANCE       *   CL**2
02653 ******************************************************************   CL**2
02654 *                                                                    CL**2
02655      IF (MB007Q-SELECT (MB007Q-IDX)) OR                              CL**2
02656         (MB007Q-MAINTAINED (MB007Q-IDX))                             CL**2
02657                                                                      CL**2
02658          SET PS-ITEM-SELECTED TO TRUE                                CL**2
02659                                                                      CL**2
02660          IF MB007Q-LIST-ITEM-NBR (MB007Q-IDX) = MB138-LIST-ITEM      CL**2
02661 *           ** PREVENT PROCESSING AGAIN **                           CL**2
02662              SET MB138-ITEM-PROCESSED TO TRUE                        CL**2
02663          END-IF                                                      CL**2
02664                                                                      CL**2
02665          IF PS-FWD-PATH                                              CL**2
02666 *           ** INDICATE ITEM REVIEWED (WILL BE MODIFIED              CL**2
02667 *           ** LATER IF THE ITEM WAS ACTUALLY MAINTAINED)            CL**2
02668                                                                      CL**2
02669              IF (MB007Q-REC-ACTION(MB007Q-IDX) = 'DEL' )             CL**2
02670                  MOVE 'D' TO MB007Q-SELECTED-SW(MB007Q-IDX)          CL**2
02671              ELSE                                                    CL**2
02672                  MOVE 'I' TO MB007Q-SELECTED-SW(MB007Q-IDX)          CL**2
02673                  MOVE 'INQ' TO MB007Q-REC-ACTION(MB007Q-IDX)         CL**2
02674              END-IF                                                  CL**2
02675          END-IF                                                      CL**2
02676                                                                      CL**2
02677          MOVE MB138-BLOCK-NUMBER                                     CL**2
02678                TO MB138-HOLD-TSQ-BLK-NBR                             CL**2
02679                                                                      CL**2
02680      ELSE                                                            CL**2
02681                                                                      CL**2
02682 *       ** QUEUE LIST ITEM WAS NOT SELECTED **                       CL**2
02683          SET PS-NO-ITEM-SELECTED TO TRUE                             CL**2
02684                                                                      CL**2
02685      END-IF.                                                         CL**2
02686                                                                      CL**2
02687      MOVE MB007Q-LIST-ITEM-NBR (MB007Q-IDX)                          CL**2
02688                TO MB138-LIST-ITEM.                                   CL**2
02689 *                                                                    CL**2
02690  EJECT                                                               CL**2
02691                                                                      CL**2
02692  S1000-SELECT-TWORKER-NBR.                                           CL**2
02693 ******************************************************************   CL**2
02694 *    RETRIEVE THE WORKER NUMBER OF THE WORKER RECORD TO BE       *   CL**2
02695 *    MAINTAINED, FROM THE TWORKER TABLE.                         *   CL**2
02696 ******************************************************************   CL**2
02697 *                                                                    CL**2
02698      IF PV-USERID = SPACES OR LOW-VALUES                             CL**2
02699          MOVE MB007-USERID TO PV-USERID                              CL**2
02700      END-IF.                                                         CL**2
02701                                                                      CL**2
02702      MOVE ZEROES TO WORKER-NBR.                                      CL**2
02703                                                                      CL**2
02704      EXEC SQL                                                        CL**2
02705          SELECT WORKER_NBR                                           CL**2
02706          INTO   :WORKER-NBR                                          CL**2
02707          FROM   TWORKER                                              CL**2
02708          WHERE  UID_NBR = :PV-USERID                                 CL**2
02709      END-EXEC.                                                       CL**2
02710                                                                      CL**2
02711      IF WORKER-NBR > 0                                               CL**2
02712          MOVE WORKER-NBR TO PV-TWORKER-WKR-NBR                       CL**2
02713      ELSE                                                            CL**2
02714          MOVE ZEROES     TO PV-TWORKER-WKR-NBR                       CL**2
02715      END-IF.                                                         CL**2
02716 *                                                                    CL**2
02717  EJECT                                                               CL**2
02718                                                                      CL**2
02719  S3000-NAVIGATE.                                                     CL**2
02720 ******************************************************************   CL**2
02721 ******************************************************************   CL**2
02722                                                                      CL**2
02723       MOVE MB007-INTER-APPL-COMMAREA                                 CL**2
02724         TO MB138-SAVE-INTER-APPL-COMMAREA.                           CL**2
02725                                                                      CL**2
02726       PERFORM DP015-1000-START-NAVIGATOR.                            CL**2
02727                                                                      CL**2
02728  S4000-SETUP-INTER-APPL.                                             CL**2
02729 ******************************************************************   CL**2
02730 *    RESET THE INTER APPLICATION ACKNOWLEDGEMENT CODE            *   CL**2
02731 ******************************************************************   CL**2
02732 *                                                                    CL**2
02733       MOVE MB138-SAVE-INTER-APPL-COMMAREA                            CL**2
02734         TO MB007-INTER-APPL-COMMAREA.                                CL**2
02735                                                                      CL**2
02736       SET DP020-MB-WORKER-MAINT TO TRUE.                             CL**2
02737                                                                      CL**2
02738       MOVE DP020-INTER-APPL-FORMAT-CODE                              CL**2
02739         TO DP020-INTER-APPL-ACKNLG-CODE.                             CL**2
02740 *                                                                    CL**2
02741  EJECT                                                               CL**2
02742                                                                      CL**2
02743  S5000-DISPLAY-PANEL.                                                CL**2
02744 ******************************************************************   CL**2
02745 *    THE MAP FIELDS SHOULD CONTAIN THE RELEVANT COMMAREA INFORMATI   CL**2
02746 ******************************************************************   CL**2
02747 *                                                                    CL**2
02748      SET MB138-HOLD-TSQ-IDX TO MB007Q-IDX.                           CL**2
02749                                                                      CL**2
02750      PERFORM DP017-0000-GET-CURR-DATE-TIME.                          CL**2
02751      MOVE DP017-EDITED-TIME-HMS  TO  ATIMEO.                         CL**2
02752                                                                      CL**2
02753      IF PS-SEND-MAP-N-DATA-FRSET                                     CL**2
02754 *        ** ALL TITLE LINE FIELDS ARE FORMATED BY DPPD002 **         CL**2
02755          PERFORM DP002-0000-FORMAT-TITLE-LINES                       CL**2
02756          PERFORM DP009-0000-LOAD-FK-LINES                            CL**2
02757      END-IF.                                                         CL**2
02758                                                                      CL**2
02759      PERFORM S6000-MOVE-COMMAREA-TO-SCREEN.                          CL**2
02760                                                                      CL**2
02761      PERFORM DP005-0000-FORMAT-MSG-LINES.                            CL**2
02762                                                                      CL**2
02763      IF (DP020-SRC-MNEMONIC = PC-WORKER-DEL-MNEMONIC)                CL**2
02764          SET PS-CANNOT-EDIT-FIELDS TO TRUE                           CL**2
02765      END-IF.                                                         CL**2
02766                                                                      CL**2
02767      IF PS-CANNOT-EDIT-FIELDS                                        CL**2
02768          MOVE ZERO TO ALNAMEL                                        CL**2
02769          MOVE DP015-ASK-BRT-OFF TO ALNAMEA                           CL**2
02770                                    AFNAMEA                           CL**2
02771                                    AUSERIDA                          CL**2
02772          MOVE DP015-HL-OFF      TO ALNAMEH                           CL**2
02773                                    AFNAMEH                           CL**2
02774                                    AUSERIDH                          CL**2
02775          MOVE DP015-BLUE        TO ALNAMEC                           CL**2
02776                                    AFNAMEC                           CL**2
02777                                    AUSERIDC                          CL**2
02778          MOVE SPACES            TO ANAVCMDO                          CL**2
02779                                    ANAVKEYO                          CL**2
02780          MOVE DP015-GREEN       TO ANAVCMDC                          CL**2
02781                                    ANAVKEYC                          CL**2
02782          MOVE DP015-UNDERLINE   TO ANAVCMDH                          CL**2
02783                                    ANAVKEYH                          CL**2
02784          MOVE -1 TO ANAVCMDL                                         CL**2
02785      ELSE                                                            CL**2
02786                                                                      CL**2
02787          IF PS-ERROR                                                 CL**2
02788              IF AUSERIDL = -1   OR  MB007-ADD                        CL**9
02789                  CONTINUE                                            CL**4
02790              ELSE                                                    CL**4
02791 *               ** NO USER ID ERROR **                               CL**4
02792                 MOVE DP015-BLUE        TO AUSERIDC                   CL**4
02793                 MOVE DP015-ASK-BRT-OFF TO AUSERIDA                   CL**4
02794                 MOVE DP015-HL-OFF      TO AUSERIDH                   CL**4
02795              END-IF                                                  CL**4
02796          ELSE                                                        CL**2
02797                                                                      CL**2
02798              MOVE -1                    TO ALNAMEL                   CL**2
02799                                                                      CL**2
02800              MOVE DP015-GREEN           TO ALNAMEC                   CL**2
02801                                            AFNAMEC                   CL**2
02802              MOVE DP015-UNP-ALP-BRT-MDT TO ALNAMEA                   CL**2
02803                                            AFNAMEA                   CL**2
02804              MOVE DP015-UNDERLINE       TO ALNAMEH                   CL**2
02805                                            AFNAMEH                   CL**2
02806                                                                      CL**2
02807              IF (DP020-SRC-MNEMONIC = PC-WORKER-ADD-MNEMONIC)        CL**2
02808                  MOVE DP015-GREEN       TO AUSERIDC                  CL**2
02809                  MOVE DP015-UNP-ALP-BRT-MDT                          CL**2
02810                                         TO AUSERIDA                  CL**2
02811                  MOVE DP015-UNDERLINE   TO AUSERIDH                  CL**2
02812              ELSE                                                    CL**2
02813                  MOVE DP015-BLUE        TO AUSERIDC                  CL**2
02814                  MOVE DP015-ASK-BRT-OFF TO AUSERIDA                  CL**2
02815                  MOVE DP015-HL-OFF      TO AUSERIDH                  CL**2
02816              END-IF                                                  CL**2
02817                                                                      CL**2
02818          END-IF                                                      CL**2
02819      END-IF.                                                         CL**2
02820                                                                      CL**2
02821      IF MB007-DUP-ADD-REC                                            CL**2
02822                                                                      CL**2
02823          MOVE -1                        TO AUSERIDL                  CL**2
02824                                                                      CL**2
02825          MOVE DP015-GREEN               TO ALNAMEC                   CL**2
02826                                            AFNAMEC                   CL**2
02827          MOVE DP015-UNP-ALP-BRT-MDT     TO ALNAMEA                   CL**2
02828                                            AFNAMEA                   CL**2
02829                                            AUSERIDA                  CL**2
02830          MOVE DP015-UNDERLINE           TO ALNAMEH                   CL**2
02831                                            AFNAMEH                   CL**2
02832          MOVE DP015-RED                 TO AUSERIDC                  CL**2
02833          MOVE DP015-REVERSE             TO AUSERIDH                  CL**2
02834                                                                      CL**2
02835      END-IF.                                                         CL**2
02836                                                                      CL**2
02837      IF DP020-SRC-AID = DP016-PF3                                    CL**2
02838          CONTINUE                                                    CL**2
02839      ELSE                                                            CL**2
02840          PERFORM DP008-0000-WRITE-PANEL                              CL**2
02841      END-IF.                                                         CL**2
02842 *                                                                    CL**2
02843  EJECT                                                               CL**2
02844                                                                      CL**2
02845  S6000-MOVE-COMMAREA-TO-SCREEN.                                      CL**2
02846 ******************************************************************   CL**2
02847 *    MOVE THE FIELDS FROM THE COMMAREA TO THE SCREEN.                CL**2
02848 ******************************************************************   CL**2
02849 *                                                                    CL**2
02850      MOVE '03'                 TO AOPERCOO.                          CL**2
02851      MOVE DP015-BLUE           TO AOPERCOC.                          CL**2
02852                                                                      CL**2
02853      MOVE MB007-FIR-NAME    TO AFNAMEO.                              CL**2
02854      MOVE MB007-LAST-NAME   TO ALNAMEO.                              CL**2
02855      MOVE MB007-USERID      TO AUSERIDO.                             CL**2
02856 *                                                                    CL**2
02857  EJECT                                                               CL**2
02858                                                                      CL**2
02859  S9000-RETURN-TO-PREV-TRAN.                                          CL**2
02860 ******************************************************************   CL**2
02861 *    RETURN TO THE PREVIOUS TRANSACTION BY MAKING THE                CL**2
02862 *    NAVIGATOR THINK THE PF3 KEY WAS PRESSED.                        CL**2
02863 ******************************************************************   CL**2
02864 *                                                                    CL**2
02865      MOVE DP016-PF3      TO DP020-SRC-AID.                           CL**2
02866                                                                      CL**2
02867      PERFORM DP015-1000-START-NAVIGATOR.                             CL**2
02868                                                                      CL**2
02869  EJECT                                                               CL**2
02870 ******************************************************************   CL**2
02871 *    SCREEN HEADER PROCESSING MODULE                                 CL**2
02872 ******************************************************************   CL**2
02873                                                                      CL**2
02874      COPY DPPD002.                                                   CL**2
02875  EJECT                                                               CL**2
02876 ******************************************************************   CL**2
02877 *    RETURN TO CICS MODULE                                           CL**2
02878 ******************************************************************   CL**2
02879                                                                      CL**2
02880      COPY DPPD003.                                                   CL**2
02881  EJECT                                                               CL**2
02882 ******************************************************************   CL**2
02883 *    FORMAT MESSAGE LINES MODULE                                     CL**2
02884 ******************************************************************   CL**2
02885                                                                      CL**2
02886      COPY DPPD005.                                                   CL**2
02887  EJECT                                                               CL**2
02888 ******************************************************************   CL**2
02889 *    GET PANEL MODULE                                                CL**2
02890 ******************************************************************   CL**2
02891                                                                      CL**2
02892      COPY DPPD007.                                                   CL**2
02893  EJECT                                                               CL**2
02894 ******************************************************************   CL**2
02895 *    WRITE PANEL MODULE                                              CL**2
02896 ******************************************************************   CL**2
02897                                                                      CL**2
02898      COPY DPPD008.                                                   CL**2
02899  EJECT                                                               CL**2
02900 ******************************************************************   CL**2
02901 *    TOGGLE THE FUNCTION KEY LINE MODULE                             CL**2
02902 ******************************************************************   CL**2
02903                                                                      CL**2
02904      COPY DPPD009.                                                   CL**2
02905  EJECT                                                               CL**2
02906 ******************************************************************   CL**2
02907 *    ABEND PROCESSOR MODULE                                          CL**2
02908 ******************************************************************   CL**2
02909                                                                      CL**2
02910      COPY DPPD013.                                                   CL**2
02911  EJECT                                                               CL**2
02912 ******************************************************************   CL**2
02913 *    CHECK COMMUNICATION AREA MODULE                                 CL**2
02914 ******************************************************************   CL**2
02915                                                                      CL**2
02916      COPY DPPD015.                                                   CL**2
02917  EJECT                                                               CL**2
02918 ******************************************************************   CL**2
02919 *    UPDATE TIME AND DATE MODULE                                     CL**2
02920 ******************************************************************   CL**2
02921                                                                      CL**2
02922      COPY DPPD017.                                                   CL**2
02923  EJECT                                                               CL**2
02924 *****************************************************************    CL**2
02925 *    ALPHA NUMERIC FIELD EDIT ROUTINE                                CL**2
02926 *****************************************************************    CL**2
02927                                                                      CL**2
02928      COPY DPPD019.                                                   CL*23
02929  EJECT                                                               CL**2
