      ***************************************************************** 00010000
       IDENTIFICATION DIVISION.                                         00020000
      ***************************************************************** 00030000
                                                                        00040000
       PROGRAM-ID.             TCKUT002.                                00050000
       AUTHOR.                 J MYERS.                                 00060000
       INSTALLATION.           KOHLS.                                   00070000
       DATE-WRITTEN            02/2002.                                 00080000
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ***************************************************************** 00110000
      *  PURPOSE:                                                       00120000
      *  CREATE A FLAT FILE OF DAILY DEBIT INFORMATION FROM COSA TABLES 00130000
      *  TO BE USED LATER TO MATCH THE RAW DATA FILE FOR CREATING A     00140000
      *  REPORT OF DIFFERENCES.                                         00150000
      ***************************************************************** 00160000
      *  CHANGED 10/10/05 CAROLE MCCAMMON                               00170000
      *   WR# 29309 ADD CONDITION TO ELIMINATE ALL KOHL'S DEBITS FROM   00180000
      *             DAILY DEBIT TRANSACTIONS - COSA TABLES.             00190000
      ***************************************************************** 00200000
W3540C******************************************************************00201014
W3540C* MODIFICATION LOG                                               *00202014
W3540C* ------------ ---                                               *00203014
W3540C*                                                                *00204014
W3540C*   REQUIREMENT  : PAYMENT RELATED CHANGES FOR FSH PROJECT       *00205014
W3540C*                  DEBIT SETTLEMENT PROCESS                      *00205114
W3540C*   PROJECT ID   : W3540C                                        *00206014
W3540C*   AUTHOR       : COGNIZANT                                     *00207014
W3540C*   DATE CHANGED : 18-OCT-2012                                   *00208037
W3540C*   CHANGES MADE :                                               *00209014
W3540C*                  THE CC-CONTROL-CARD FORMAT IS CHANGED AS PER  *00209120
W3540C*                  NEW REQUIREMENT. ALSO CHANGES ARE DONE TO THE *00209215
W3540C*                  EXTRACT-CURSOR TO CHECK PRT.SLS_DTE AND       *00209319
W3540C*                  DKEY.PRCG_DTE FOR THE DATES RECEIVED FROM     *00209419
W3540C*                  THE CONTROL CARD.                             *00209519
W3540C*                  CHANGES ARE MADE IN 1300-PROCESS-DATE-CARD    *00209619
W3540C*                  PARAGRAPH TO VALIDATE BOTH DATES FROM CONTROL *00209719
W3540C*                  CARD.                                         *00209833
W3540C*                                                                *00210119
W3540C*                FORMAT :  CCYYMMDD            CCYYMMDD          *00210219
W3540C*                FIELDS :  CURR. PROCS. DATE   PREV. PROCS. DATE *00210319
W3540C*               EXAMPLE :  20120706            20120705          *00210419
      *                                                                 00210546
      *  DATE  09/11/2015                                               00210646
      *  CHANGE MADE: CHANGED TO INCLUDE PAYMENT TRANSACTIONS MADE      00210746
      *  WITH A DEBIT CARD WHEN ASSIGNING A SALE TYPE                   00210846
      *  MADE BY: MADHURA PETHE           WR/IR #: CHG0121080           00210946
      *                                                                 00211146
      ******************************************************************00211246
       ENVIRONMENT DIVISION.                                            00212000
      ***************************************************************** 00220000
                                                                        00230000
       CONFIGURATION SECTION.                                           00240000
                                                                        00250000
       SOURCE-COMPUTER.        IBM-3090.                                00260000
                                                                        00270000
       OBJECT-COMPUTER.        IBM-3090.                                00280000
                                                                        00290000
       INPUT-OUTPUT SECTION.                                            00300000
                                                                        00310000
       FILE-CONTROL.                                                    00320000
                                                                        00330000
           SELECT DATE-CARD-FILE                                        00340000
               ASSIGN TO INP01.                                         00350000
                                                                        00360000
           SELECT COSA-EXTRACT-FILE                                     00370000
               ASSIGN TO OUT01.                                         00380000
                                                                        00390000
       EJECT                                                            00400000
      ******************************************************************00410000
       DATA DIVISION.                                                   00420000
      ******************************************************************00430000
                                                                        00440000
       FILE SECTION.                                                    00450000
                                                                        00460000
       FD  DATE-CARD-FILE                                               00470000
           RECORDING MODE IS F                                          00480000
           BLOCK CONTAINS 0 RECORDS                                     00490000
           LABEL RECORDS ARE STANDARD.                                  00500000
                                                                        00510000
       01  DATE-CARD-RECORD            PIC X(80).                       00520000
                                                                        00530000
       FD  COSA-EXTRACT-FILE                                            00540000
           RECORDING MODE IS F                                          00550000
           LABEL RECORDS ARE STANDARD                                   00560000
           BLOCK CONTAINS 0 RECORDS                                     00570000
           RECORD CONTAINS  69 CHARACTERS.                              00580036
                                                                        00590000
       01  COSA-EXTRACT-RECORD           PIC X(69).                     00600036
                                                                        00610000
       EJECT                                                            00620000
      ******************************************************************00630000
       WORKING-STORAGE SECTION.                                         00640000
      ******************************************************************00650000
       01  FILLER                            PIC X(50)  VALUE           00660000
           ' *** WORKING STORAGE STARTS HERE FOR TCKUT002 *** '.        00670000
                                                                        00680000
W3540C******************************************************************00780114
W3540C* NEW CONTROL CARD IS INTRODUCED TO SUPPORT THE NEW FORMAT.      *00780214
W3540C******************************************************************00780314
W3540C******************************************************************00780414
W3540C*    CR-CONTROL RECORD   DATE IN CCYYMMDD FORMAT                 *00780514
W3540C******************************************************************00780614
W3540C 01  CC-CONTROL-CARD.                                             00781012
W3540C     05  CR-CONTROL-CURR-DATE.                                    00781112
W3540C         10  CR-CURR-CC               PIC  X(02)    VALUE SPACES. 00781212
W3540C         10  CR-CURR-YY               PIC  X(02)    VALUE SPACES. 00781312
W3540C         10  CR-CURR-MM               PIC  X(02)    VALUE SPACES. 00781412
W3540C         10  CR-CURR-DD               PIC  X(02)    VALUE SPACES. 00781512
W3540C     05  FILLER                       PIC  X(01)    VALUE SPACES. 00781612
W3540C     05  CR-CONTROL-PREV-DATE.                                    00781712
W3540C         10  CR-PREV-CC               PIC  X(02)    VALUE SPACES. 00781812
W3540C         10  CR-PREV-YY               PIC  X(02)    VALUE SPACES. 00781912
W3540C         10  CR-PREV-MM               PIC  X(02)    VALUE SPACES. 00782012
W3540C         10  CR-PREV-DD               PIC  X(02)    VALUE SPACES. 00782112
W3540C     05  FILLER                       PIC  X(63)    VALUE SPACES. 00782212
                                                                        00790000
      ******************************************************************00800000
      *  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)            *00810000
      ******************************************************************00820000
           COPY DPWS500.                                                00830000
                                                                        00840000
       01  AC-ABEND-CODE                      PIC S9(04) VALUE ZERO     00850000
                                                        COMP SYNC.      00860000
           88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    00870000
           88  AC-DB2-ERROR                             VALUE +4013.    00880000
           88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    00890000
                                                                        00900000
        01  PS-PROGRAM-SWITCHES.                                        00910000
           05  PS-END-OF-EXTRACT-SW          PIC X(01)  VALUE 'N'.      00920000
               88  PS-NOT-END-OF-EXTRACT                VALUE 'N'.      00930000
               88  PS-END-OF-EXTRACT                    VALUE 'Y'.      00940000
           05  PS-END-OF-DATE-FILE-SW        PIC X(01)  VALUE 'N'.      00950000
               88  PS-END-OF-DATE-FILE                  VALUE 'Y'.      00960000
                                                                        00970000
       01  PC-CONSTANTS.                                                00980000
           05  PC-LINE-LIMIT                 PIC S9(04) VALUE +60.      00990000
           05  PC-ROW-NOT-FOUND              PIC S9(04) VALUE +100      01000000
                                                        COMP SYNC.      01010000
           05  PC-CURRENT-PROGRAM-NAME       PIC  X(08) VALUE           01020000
                                                       'TCKUT002'.      01030000
       01  WS-TEMP-FIELDS.                                              01040000
           05  WS-TEMP-DATE.                                            01050000
               10  WS-TEMP-CCYY              PIC 9(04).                 01060000
               10  WS-TEMP-DASH1             PIC X(01).                 01070000
               10  WS-TEMP-MM                PIC 9(02).                 01080000
               10  WS-TEMP-DASH2             PIC X(01).                 01090000
               10  WS-TEMP-DD                PIC 9(02).                 01100000
           05  WS-FMT-DATE.                                             01110000
               10  WS-FMTD-CCYY               PIC 9(04).                01120000
               10  WS-FMTD-MM                 PIC 9(02).                01130000
               10  WS-FMTD-DD                 PIC 9(02).                01140000
           05  WS-TEMP-TIME.                                            01150000
               10  WS-TEMP-HH                PIC 9(02).                 01160000
               10  WS-TEMP-PRD1              PIC X(01).                 01170000
               10  WS-TEMP-MIN               PIC 9(02).                 01180000
               10  WS-TEMP-PRD2              PIC X(01).                 01190000
               10  WS-TEMP-SS                PIC 9(02).                 01200000
           05  WS-FMT-TIME.                                             01210000
               10  WS-FMTT-HH                 PIC 9(02).                01220000
               10  WS-FMTT-MM                 PIC 9(02).                01230000
               10  WS-FMTT-SS                 PIC 9(02).                01240000
       01  PV-PROGRAM-VARIABLES.                                        01250000
           05  PV-MISC-COUNT-FIELDS                         COMP-3.     01260000
                10  PV-PAGE-CNT1             PIC S9(05) VALUE ZERO.     01270000
                10  PV-PAGE-CNT2             PIC S9(05) VALUE ZERO.     01280000
                                                                        01290000
           05  PV-PARAGRAPH-NAME             PIC  X(30) VALUE SPACE.    01300000
           05  PV-OPERATION-MSG-1            PIC  X(40) VALUE SPACE.    01310000
           05  PV-OPERATION-MSG-2            PIC  X(40) VALUE SPACE.    01320000
           05  PV-DB2-OPERATION              PIC  X(30) VALUE SPACE.    01330000
W3540C     05  PV-CURR-CCYYMMDD              PIC  X(10).                01340013
W3540C     05  PV-PREV-CCYYMMDD              PIC  X(10).                01341013
      ***************************************************************** 01350000
      *  COSA EXTRACT FLAT FILE LAYOUT                                  01360000
      ******************************************************************01370000
           COPY TCWS002.                                                01380000
      ***************************************************************** 01390000
      *  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            01400000
      ******************************************************************01410000
           COPY DPWS004.                                                01420000
      ******************************************************************01430000
      *  DB2 COMMUNICATION AREA.                                        01440000
      ******************************************************************01450000
           EXEC SQL                                                     01460000
                INCLUDE SQLCA                                           01470000
           END-EXEC.                                                    01480000
      ******************************************************************01490000
      *  DB2 TABLE DB2PDBA.TEPPART - PARTITION CONTROL TABLE            01500000
      ******************************************************************01510000
           EXEC SQL                                                     01520000
                INCLUDE TEPPART                                         01530000
           END-EXEC.                                                    01540000
      ******************************************************************01550000
      *  DB2 TABLE DB2PDBA.EPT_DR_CRD_TNDR CREDIT CARD TENDER TABLE     01560000
      ******************************************************************01570000
           EXEC SQL                                                     01580000
                INCLUDE EPT00002                                        01590000
           END-EXEC.                                                    01600000
      ******************************************************************01610000
      *  DB2 TABLE DB2PDBA.TEPDKEY         PROCESING DAY KEY TABLE      01620000
      ******************************************************************01630000
           EXEC SQL                                                     01640000
                INCLUDE TEPDKEY                                         01650000
           END-EXEC.                                                    01660000
      ******************************************************************01670000
      *  DB2 TABLE DB2PDBA.TEPCRD  - CREDIT CARD TABLE                  01680000
      ******************************************************************01690000
           EXEC SQL                                                     01700000
                INCLUDE TEPCRD                                          01710000
           END-EXEC.                                                    01720000
      ******************************************************************01730000
      *  DB2 TABLE DB2TDBA.TEPTND - TENDER TABLE                        01740000
      ******************************************************************01750000
           EXEC SQL                                                     01760000
                INCLUDE TEPTND                                          01770000
           END-EXEC.                                                    01780000
      ******************************************************************01790000
      *  DB2 TABLE DB2TDBA.TEPTRN - TRANSACTION TABLE                   01800000
      ******************************************************************01810000
           EXEC SQL                                                     01820000
                INCLUDE TEPTRN                                          01830000
           END-EXEC.                                                    01840000
      ******************************************************************01850000
      *  CREATE CURSOR FOR EXTRACT                                      01860000
      ******************************************************************01920000
           EXEC SQL                                                     01930000
               DECLARE EXTRACT-CURSOR  CURSOR                           01940000
               FOR SELECT TND.PARTN_NBR                                 01950000
                        , TND.TNDR_AMT                                  01960000
                        , TND.STR_NBR                                   01970000
                        , TND.RGST_ID                                   01980000
                        , TND.TRN_NBR                                   01990000
                        , TND.STRT_TM                                   02000000
                        , TND.TNDR_ID                                   02010000
                        , TND.TNDR_VOID_IND                             02020000
                        , TND.SLS_CORR_SEQ_NBR                          02030000
                        , PRT.SLS_DTE                                   02040000
                        , TRN.TRN_STAT_CDE                              02050000
                        , TRN.TRN_TYP_CDE                               02060000
                        , TRN.VOID_ABRT_CDE                             02070000
                        , TND.TNDR_SEQ_NBR                              02071000
                     FROM TEPPART            PRT                        02080000
                        , EPT_DR_CRD_TNDR    DR                         02090000
                        , TEPTND             TND                        02100000
                        , TEPCRD             CRD                        02110000
                        , TEPTRN             TRN                        02120000
W3540C               WHERE PRT.SLS_DTE          > :PV-PREV-CCYYMMDD     02131015
W3540C                 AND PRT.SLS_DTE         <= :PV-CURR-CCYYMMDD     02132015
                       AND DR.PARTN_NBR         = PRT.PARTN_NBR         02140000
                       AND TND.PARTN_NBR        = DR.PARTN_NBR          02150000
                       AND TND.STR_NBR          = DR.STR_NBR            02160000
                       AND TND.RGST_ID          = DR.RGST_ID            02170000
                       AND TND.TRN_NBR          = DR.TRN_NBR            02180000
                       AND TND.STRT_TM          = DR.STRT_TM            02190000
                       AND TND.SLS_CORR_SEQ_NBR = DR.SLS_CORR_SEQ_NBR   02200000
                       AND TND.TNDR_SEQ_NBR     = DR.TNDR_SEQ_NBR       02210000
                       AND TND.TNDR_TYP_CDE     = '19'                  02220000
                       AND TND.TNDR_VOID_IND    = 'N'                   02230000
                       AND DR.CRD_TYP_CDE      <> 'K'                   02240000
                       AND CRD.PARTN_NBR        = DR.PARTN_NBR          02250000
                       AND CRD.STR_NBR          = DR.STR_NBR            02260000
                       AND CRD.RGST_ID          = DR.RGST_ID            02270000
                       AND CRD.TRN_NBR          = DR.TRN_NBR            02280000
                       AND CRD.STRT_TM          = DR.STRT_TM            02290000
                       AND CRD.SLS_CORR_SEQ_NBR = DR.SLS_CORR_SEQ_NBR   02300000
                       AND CRD.TNDR_SEQ_NBR     = DR.TNDR_SEQ_NBR       02310000
                       AND CRD.STTLMNT_PRCD_CDE = 'U'                   02321011
                       AND TRN.PARTN_NBR        = DR.PARTN_NBR          02330000
                       AND TRN.STR_NBR          = DR.STR_NBR            02340000
                       AND TRN.RGST_ID          = DR.RGST_ID            02350000
                       AND TRN.TRN_NBR          = DR.TRN_NBR            02360000
                       AND TRN.STRT_TM          = DR.STRT_TM            02370000
                       AND TRN.SLS_CORR_SEQ_NBR = DR.SLS_CORR_SEQ_NBR   02380000
                   UNION ALL                                            02390000
                     SELECT PRT.PARTN_NBR                               02400000
                        , TND.TNDR_AMT                                  02410000
                        , TND.STR_NBR                                   02420000
                        , TND.RGST_ID                                   02430000
                        , TND.TRN_NBR                                   02440000
                        , TND.STRT_TM                                   02450000
                        , TND.TNDR_ID                                   02460000
                        , TND.TNDR_VOID_IND                             02470000
                        , TND.SLS_CORR_SEQ_NBR                          02480000
                        , PRT.SLS_DTE                                   02490000
                        , TRN.TRN_STAT_CDE                              02500000
                        , TRN.TRN_TYP_CDE                               02510000
                        , TRN.VOID_ABRT_CDE                             02520000
                        , TND.TNDR_SEQ_NBR                              02521000
                     FROM TEPDKEY             DKEY                      02530000
                        , TEPPART             PRT                       02540000
                        , EPT_DR_CRD_TNDR     DR                        02550000
                        , TEPTND              TND                       02560000
                        , TEPCRD              CRD                       02570000
                        , TEPTRN              TRN                       02580000
W3540C               WHERE DKEY.PRCG_DTE        > :PV-PREV-CCYYMMDD     02591015
W3540C                 AND DKEY.PRCG_DTE       <= :PV-CURR-CCYYMMDD     02592015
                       AND PRT.SLS_DTE          = DKEY.SLS_DTE          02600000
                       AND DR.PARTN_NBR         = PRT.PARTN_NBR         02610000
                       AND TND.PARTN_NBR        = DR.PARTN_NBR          02620000
                       AND DR.STR_NBR           = DKEY.STR_NBR          02630000
                       AND DR.RGST_ID           = DKEY.RGST_ID          02640000
                       AND DR.TRN_NBR           = DKEY.TRN_NBR          02650000
                       AND DR.STRT_TM           = DKEY.STRT_TM          02660000
                       AND DR.SLS_CORR_SEQ_NBR  = DKEY.SLS_CORR_SEQ_NBR 02670000
                       AND TND.STR_NBR          = DR.STR_NBR            02680000
                       AND TND.RGST_ID          = DR.RGST_ID            02690000
                       AND TND.TRN_NBR          = DR.TRN_NBR            02700000
                       AND TND.STRT_TM          = DR.STRT_TM            02710000
                       AND TND.SLS_CORR_SEQ_NBR = DR.SLS_CORR_SEQ_NBR   02720000
                       AND TND.TNDR_SEQ_NBR     = DR.TNDR_SEQ_NBR       02730000
                       AND TND.TNDR_TYP_CDE     = '19'                  02740000
                       AND TND.TNDR_VOID_IND    = 'N'                   02750000
                       AND DR.CRD_TYP_CDE      <> 'K'                   02760000
                       AND CRD.PARTN_NBR        = DR.PARTN_NBR          02770000
                       AND CRD.STR_NBR          = DR.STR_NBR            02780000
                       AND CRD.RGST_ID          = DR.RGST_ID            02790000
                       AND CRD.TRN_NBR          = DR.TRN_NBR            02800000
                       AND CRD.STRT_TM          = DR.STRT_TM            02810000
                       AND CRD.SLS_CORR_SEQ_NBR = DR.SLS_CORR_SEQ_NBR   02820000
                       AND CRD.TNDR_SEQ_NBR     = DR.TNDR_SEQ_NBR       02830000
                       AND CRD.STTLMNT_PRCD_CDE = 'U'                   02840011
                       AND TRN.PARTN_NBR        = DR.PARTN_NBR          02850000
                       AND TRN.STR_NBR          = DR.STR_NBR            02860000
                       AND TRN.RGST_ID          = DR.RGST_ID            02870000
                       AND TRN.TRN_NBR          = DR.TRN_NBR            02880000
                       AND TRN.STRT_TM          = DR.STRT_TM            02890000
                       AND TRN.SLS_CORR_SEQ_NBR = DR.SLS_CORR_SEQ_NBR   02900000
                WITH UR                                                 02910000
           END-EXEC.                                                    02920000
                                                                        02930000
       PROCEDURE DIVISION.                                              02940000
                                                                        02950000
       0000-MAINLINE-PARAGRAPH.                                         02960000
                                                                        02970000
           PERFORM 1000-INITIALIZE-PROGRAM.                             02980000
           PERFORM 2000-OPEN-EXTRACT-CURSOR.                            02990000
                                                                        03000000
           PERFORM 2100-FETCH-EXTRACT-CURSOR.                           03010000
                                                                        03020000
           PERFORM 3000-PROCESS                                         03030000
                 UNTIL PS-END-OF-EXTRACT.                               03040000
                                                                        03050000
           PERFORM 2300-CLOSE-EXTRACT-CURSOR.                           03060000
                                                                        03070000
           CLOSE DATE-CARD-FILE                                         03080000
                 COSA-EXTRACT-FILE.                                     03090000
                                                                        03100000
           GOBACK.                                                      03110000
                                                                        03120000
      ******************************************************************03130000
      * 1000-INITIALIZE-PROGRAM                                         03140000
      *     OPEN FILES, PROCESS CONTROL CARD                            03150000
      ******************************************************************03160000
       1000-INITIALIZE-PROGRAM.                                         03170000
                                                                        03180000
           OPEN INPUT  DATE-CARD-FILE                                   03190000
                OUTPUT COSA-EXTRACT-FILE.                               03200000
                                                                        03210000
           PERFORM 1300-PROCESS-DATE-CARD.                              03220000
                                                                        03230000
           SET PS-NOT-END-OF-EXTRACT              TO TRUE.              03240000
                                                                        03250000
      ******************************************************************03260000
      * 1300-PROCESS-DATE-CARD                                          03270000
      ******************************************************************03280000
       1300-PROCESS-DATE-CARD.                                          03290000
                                                                        03300000
           READ DATE-CARD-FILE INTO CC-CONTROL-CARD                     03310000
               AT END                                                   03320000
                   SET PS-END-OF-DATE-FILE TO TRUE.                     03330000
                                                                        03340000
           IF PS-END-OF-DATE-FILE                                       03350000
               MOVE '1300-PROCESS-DATE-CARD'  TO PV-PARAGRAPH-NAME      03360000
               MOVE 'DATE CARD MISSING      ' TO PV-OPERATION-MSG-1     03370000
               SET AC-CONTROL-CARD-ERROR TO TRUE                        03380000
               PERFORM 9999-ABEND                                       03390000
W3540C     ELSE                                                         03391038
W3540C         DISPLAY "CURRENT  DATE IN CC: " CR-CONTROL-CURR-DATE     03392038
W3540C         DISPLAY "PREVIOUS DATE IN CC: " CR-CONTROL-PREV-DATE     03393038
           END-IF.                                                      03400000
                                                                        03410000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03420000
                                                                        03430000
           SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   03440000
           SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   03450000
W3540C     SET  DPG52-LK-DTE-ISO             TO TRUE.                   03461012
W3540C     MOVE CR-CONTROL-CURR-DATE         TO DPG52-LK-DATE-INPUT.    03471012
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03480000
                                                   DPG54 DPG55 DPG56.   03490000
           EVALUATE TRUE                                                03500000
               WHEN DPG54-SEVERE-ERROR                                  03510000
               WHEN DPG54-DATE-INVALID                                  03520000
                   MOVE '1300-PROCESS-DATE-CARD'                        03530000
                                                 TO PV-PARAGRAPH-NAME   03540000
                   MOVE 'ERROR CONVERTING INPUT CARD DATE'              03550000
                                                 TO PV-OPERATION-MSG-1  03560000
                   SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                03570000
                   MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  03580000
                   PERFORM 9999-ABEND                                   03590000
           END-EVALUATE.                                                03600000
                                                                        03610000
W3540C     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-CURR-CCYYMMDD.       03621013
W3540C                                                                  03621322
W3540C     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03621422
W3540C                                                                  03621522
W3540C     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   03621622
W3540C     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   03621722
W3540C     SET  DPG52-LK-DTE-ISO             TO TRUE.                   03621822
W3540C     MOVE CR-CONTROL-PREV-DATE         TO DPG52-LK-DATE-INPUT.    03621913
W3540C     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03622012
W3540C                                             DPG54 DPG55 DPG56.   03622112
W3540C     EVALUATE TRUE                                                03622212
W3540C         WHEN DPG54-SEVERE-ERROR                                  03622312
W3540C         WHEN DPG54-DATE-INVALID                                  03622412
W3540C             MOVE '1300-PROCESS-DATE-CARD'                        03622512
W3540C                                           TO PV-PARAGRAPH-NAME   03622612
W3540C             MOVE 'ERROR CONVERTING INPUT CARD PREVIOUS DATE'     03622728
W3540C                                           TO PV-OPERATION-MSG-1  03622812
W3540C             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                03622912
W3540C             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  03623012
W3540C             PERFORM 9999-ABEND                                   03623112
W3540C     END-EVALUATE.                                                03623212
W3540C                                                                  03623312
W3540C     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-PREV-CCYYMMDD.       03623513
                                                                        03630000
      ******************************************************************03640000
      * 2000-OPEN-EXTRACT-CURSOR.                                       03650000
      *     OPEN EXTRACT CURSOR                                         03660000
      ******************************************************************03670000
       2000-OPEN-EXTRACT-CURSOR.                                        03680000
                                                                        03690000
           EXEC SQL                                                     03700000
                OPEN EXTRACT-CURSOR                                     03710000
           END-EXEC.                                                    03720000
                                                                        03730000
           EVALUATE TRUE                                                03740000
               WHEN SQLCODE = ZERO                                      03750000
                    CONTINUE                                            03760000
               WHEN SQLWARN0 NOT EQUAL SPACE                            03770000
               WHEN SQLCODE NOT EQUAL ZERO                              03780000
                   MOVE '2000-OPEN-EXTRACT-CURSOR'                      03790000
                                                  TO PV-PARAGRAPH-NAME  03800000
                   MOVE 'ERROR ON OPEN OF EXTRACT-CURSOR'               03810000
                                                  TO PV-DB2-OPERATION   03820000
                   PERFORM 9100-SQL-ABEND                               03830000
           END-EVALUATE.                                                03840000
                                                                        03850000
      ******************************************************************03860000
      * 2100-FETCH-EXTRACT-CURSOR                                       03870000
      ******************************************************************03880000
       2100-FETCH-EXTRACT-CURSOR.                                       03890000
                                                                        03900000
           EXEC SQL                                                     03910000
                FETCH EXTRACT-CURSOR                                    03920000
                 INTO :EPTND-PARTN-NBR                                  03930000
                     ,:EPTND-TNDR-AMT                                   03940000
                     ,:EPTND-STR-NBR                                    03950000
                     ,:EPTND-RGST-ID                                    03960000
                     ,:EPTND-TRN-NBR                                    03970000
                     ,:EPTND-STRT-TM                                    03980000
                     ,:EPTND-TNDR-ID                                    03990000
                     ,:EPTND-TNDR-VOID-IND                              04000000
                     ,:EPTND-SLS-CORR-SEQ-NBR                           04010000
                     ,:EPPART-SLS-DTE                                   04020000
                     ,:EPTRN-TRN-STAT-CDE                               04030000
                     ,:EPTRN-TRN-TYP-CDE                                04040000
                     ,:EPTRN-VOID-ABRT-CDE                              04050000
                     ,:EPTND-TNDR-SEQ-NBR                               04051000
           END-EXEC.                                                    04060000
                                                                        04070000
           EVALUATE TRUE                                                04080000
               WHEN SQLCODE = ZERO                                      04090000
                    CONTINUE                                            04100000
                                                                        04110000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          04120000
                   SET PS-END-OF-EXTRACT          TO TRUE               04130000
               WHEN SQLWARN0 NOT EQUAL SPACE                            04140000
               WHEN SQLCODE NOT EQUAL ZERO                              04150000
                   MOVE '2100-FETCH-EXTRACT-CURSOR'                     04160000
                                                  TO PV-PARAGRAPH-NAME  04170000
                   MOVE 'ERROR ON FETCH OF EXTRACT-CURSOR'              04180000
                                                  TO PV-DB2-OPERATION   04190000
                   PERFORM 9100-SQL-ABEND                               04200000
           END-EVALUATE.                                                04210000
                                                                        04220000
      ***************************************************************** 04230000
      * 2300-CLOSE-EXTRACT-CURSOR                                       04240000
      *      CLOSE CURSOR                                               04250000
      ***************************************************************** 04260000
       2300-CLOSE-EXTRACT-CURSOR.                                       04270000
                                                                        04280000
           EXEC SQL                                                     04290000
                CLOSE EXTRACT-CURSOR                                    04300000
           END-EXEC.                                                    04310000
                                                                        04320000
           EVALUATE TRUE                                                04330000
               WHEN SQLCODE = ZERO                                      04340000
                    CONTINUE                                            04350000
               WHEN SQLWARN0 NOT EQUAL SPACE                            04360000
               WHEN SQLCODE NOT EQUAL ZERO                              04370000
                   MOVE '2300-CLOSE-EXTRACT-CURSOR'                     04380000
                                                  TO PV-PARAGRAPH-NAME  04390000
                   MOVE 'ERROR ON CLOSE OF EXTRACT-CURSOR'              04400000
                                                  TO PV-DB2-OPERATION   04410000
                   PERFORM 9100-SQL-ABEND                               04420000
           END-EVALUATE.                                                04430000
                                                                        04440000
      ***************************************************************** 04450000
      * 3000-PROCESS                                                    04460000
      *      PROCESS THE CURSOR TO BUILD THE EXTRACT RECORD             04470000
      ***************************************************************** 04480000
        3000-PROCESS.                                                   04490000
                                                                        04500000
           INITIALIZE TC002-DATA.                                       04510000
                                                                        04520000
           EVALUATE EPTRN-TRN-STAT-CDE                                  04530000
               WHEN  'V'                                                04540000
                   IF (EPTRN-TRN-TYP-CDE = '11' OR '12' OR '24' OR '25' 04550047
                   OR (EPTRN-TRN-TYP-CDE = '30' AND EPTND-TNDR-AMT < 0))04551040
                       MOVE 'X'       TO TC002-SALE-TYPE                04560000
                   ELSE                                                 04570000
                       MOVE 'C'       TO TC002-SALE-TYPE                04580000
                   END-IF                                               04590000
               WHEN  'L'                                                04600000
                   IF (EPTRN-TRN-TYP-CDE = '11' OR '12' OR '24' OR '25' 04610047
                   OR (EPTRN-TRN-TYP-CDE = '30' AND EPTND-TNDR-AMT < 0))04611040
                       MOVE 'X'       TO TC002-SALE-TYPE                04620000
                   ELSE                                                 04630000
                       MOVE 'L'       TO TC002-SALE-TYPE                04640000
                   END-IF                                               04650000
               WHEN  'R'                                                04660000
                   MOVE 'R'           TO TC002-SALE-TYPE                04670000
               WHEN OTHER                                               04680000
                   IF (EPTRN-TRN-TYP-CDE = '11' OR '12' OR '24' OR '25' 04690047
                   OR (EPTRN-TRN-TYP-CDE = '30' AND EPTND-TNDR-AMT < 0))04691040
                       MOVE 'X'       TO TC002-SALE-TYPE                04700000
                   ELSE                                                 04710000
                       MOVE 'S'       TO TC002-SALE-TYPE                04720000
                   END-IF                                               04730000
           END-EVALUATE.                                                04740000
                                                                        04750000
           IF EPTRN-VOID-ABRT-CDE     = 'V' OR                          04760000
              EPTRN-VOID-ABRT-CDE     = 'I' OR                          04770010
              EPTRN-VOID-ABRT-CDE     = 'A'                             04771010
               MOVE 'V'               TO TC002-SALE-TYPE                04780000
           END-IF.                                                      04790000
                                                                        04800000
           MOVE EPTND-PARTN-NBR        TO TC002-PARTN-NBR.              04810000
           MOVE EPTND-STR-NBR          TO TC002-STR-NBR.                04820000
           MOVE EPPART-SLS-DTE         TO WS-TEMP-DATE.                 04830000
           MOVE WS-TEMP-CCYY           TO WS-FMTD-CCYY                  04840000
           MOVE WS-TEMP-MM             TO WS-FMTD-MM                    04850000
           MOVE WS-TEMP-DD             TO WS-FMTD-DD                    04860000
           MOVE WS-FMT-DATE            TO TC002-SLS-DTE.                04870000
           MOVE EPTND-STRT-TM          TO WS-TEMP-TIME.                 04880000
           MOVE WS-TEMP-HH             TO WS-FMTT-HH                    04890000
           MOVE WS-TEMP-MIN            TO WS-FMTT-MM                    04900000
           MOVE WS-TEMP-SS             TO WS-FMTT-SS                    04910000
           MOVE WS-FMT-TIME            TO TC002-STRT-TIME               04920000
           MOVE EPTND-RGST-ID          TO TC002-RGST-ID.                04930000
           MOVE EPTND-TRN-NBR          TO TC002-TRN-NBR.                04940000
           MOVE EPTND-SLS-CORR-SEQ-NBR                                  04950000
                                       TO TC002-SLS-CORR-SEQ-NBR.       04960000
           MOVE EPTND-TNDR-ID          TO TC002-CARD-NBR.               04970000
           MOVE EPTND-TNDR-SEQ-NBR     TO TC002-TNDR-SEQ-NBR.           04971000
           MOVE EPTND-TNDR-AMT         TO TC002-TNDR-AMT.               04980000
           MOVE 'N'                    TO TC002-MATCH-CDE.              04990000
           MOVE 'N'                    TO TC002-REC-IND.                05000000
                                                                        05010000
           PERFORM 4000-WRITE-EXTRACT-FILE.                             05020000
                                                                        05030000
           PERFORM 2100-FETCH-EXTRACT-CURSOR.                           05040000
                                                                        05050000
      ******************************************************************05060000
      * 4000-WRITE-EXTRACT-FILE                                         05070000
      *     WRITE THE EXTRACT FILE FROM COPYBOOK TCWS002                05080000
      ******************************************************************05090000
       4000-WRITE-EXTRACT-FILE.                                         05100000
                                                                        05110000
           WRITE COSA-EXTRACT-RECORD  FROM TC002-DATA.                  05120000
                                                                        05130000
      ******************************************************************05140000
      * 9100-SQL-ABEND                                                  05150000
      *     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.05160000
      ******************************************************************05170000
       9100-SQL-ABEND.                                                  05180000
           DISPLAY '** ABEND     **'.                                   05190000
           DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05200000
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05210000
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               05220000
                                                                        05230000
      ******************************************************************05240000
      * COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     05250000
      * TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      05260000
      ******************************************************************05270000
           COPY DPPD004.                                                05280000
                                                                        05290000
           SET AC-DB2-ERROR TO TRUE.                                    05300000
           CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05310000
                                                                        05320000
      ******************************************************************05330000
      * 9999-ABEND                                                      05340000
      *     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  05350000
      ******************************************************************05360000
       9999-ABEND.                                                      05370000
                                                                        05380000
           DISPLAY '** ABEND           **'.                             05390000
           DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  05400000
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        05410000
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       05420000
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       05430000
           CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05440000
