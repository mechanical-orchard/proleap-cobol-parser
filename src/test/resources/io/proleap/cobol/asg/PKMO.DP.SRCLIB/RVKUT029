000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 TITLE 'UTILITY FILE PREP FOR INVENTORY DETAIL REPORT'.           00040086
000500 PROGRAM-ID.             RVKUT029.                                00050065
000600 AUTHOR.                 THERESE RAMSEYER.                        00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            JUNE 2007.                               00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM READS AN INPUT FILE OF PHYSICAL INVENTORY DETAILS 00120086
001300*  AND PRODUCES AN OUTPUT FILE OF SUMMED VALUES ON DTL, BL,       00130086
001400*  DEPT, BUYER & GRAND TOTAL LEVELS.                              00140086
001500*                                                                 00150086
001600*  EACH INPUT RECORD HAS A QUANTITY OF 1. THE PROGRAM WILL SUM AND00160086
001700*  BREAK ON THE FOLLOWING LEVELS IN SORT ORDER:                   00170086
001800*                                                                 00180086
001900*  SORT FIELDS=(166,3,CH,A,                * BUYER NUMBER         00190086
002000*                1,38,CH,A,                * BL NUMBER            00200086
002100*                48,3,ZD,A,                * DEPT                 00210086
002200*                40,8,ZD,A,                * SKU                  00220086
002300*                54,11,ZD,A,               * UNIT COST            00230086
002400*                65,11,ZD,A,               * RETL COST            00240086
002500*                85,8,CH,A)                * SCAN DATE            00250086
002600*                                                                 00260086
002700* !NOTE! :  THE MAIN LOGIC IN 2000- IS WRITTEN SPECIFICALLY       00270086
002800*           TO ADDRESS THIS SORT ORDER, SO ALTERING THIS IN       00280086
002900*           ANY WAY W/O MAKING APPROPRIATE AND CORESPONDING       00290086
003000*           CHANGES IN THE PROGRAM MAY PRODUCE UNRELIABLE         00300086
003100*           AND UNEXPECTED RESULTS IN THE REPORT THAT             00310086
003200*           EVENTUALLY GETS PRODUCED FROM THIS PREP FILE.         00320086
003300*                                                                 00330086
003400*  THE FIELDS THAT GET SUMMED ARE:                                00340086
003500*  QTY, COST, EXTENDED COST, RETAIL AND EXTENDED RETAIL.          00350086
003600*                                                                 00360086
003700*  AN EXAMPLE OF THESE ON A REPORT:                               00370086
003800*                                                                 00380086
003900*  QTY     COST     EXTENDED COST     RETAIL     EXTENDED RETAIL  00390086
004000*  ____   ______   ______________   _________   ________________  00400086
004100*                                                                 00410086
004200*  1       15.00        15.00         22.99           22.99       00420086
004300*                                                                 00430086
004400*  2       12.00        24.00         19.99           39.98       00440086
004500*  ---------------------------------------------------------      00450086
004600*  3       27.00        39.00         42.98           62.97       00460086
004700*                                                                 00470086
004800*  (ONLY EXTENDED VALUES ARE MULTIPLIED BY THE SUMMED QTY)        00480086
004900*                                                                 00490086
005000*  THE RECORDS ARE WRITTEN TO THE OUTPUT FILE WHOSE FIRST         00500086
005100*  BYTE DESIGNATES A RECORD TYPE OF : 1=DTL, 2=BL, 3=DEPT,        00510086
005200*  4=BUYER & 5=GRAND.                                             00520086
005300*                                                                 00530086
005400*  THIS PREP FILE IS USED BY A SUBSEQUENT REPORT PROGRAM. THE     00540086
005500*  INTENTION WAS TO REDUCE COMPLEXITY OF THIS PROCESS BY SPLITTING00550086
005600*  THE SUMMING/BREAKING AND REPORT CREATION INTO 2 PROCESSES.     00560086
005700*                                                                 00570086
005800*  AS INPUT RECORDS ARE READ AND ADDED TO THE APPROPRIATE BUCKETS,00580086
005900*  AN INTERNAL TABLE IS BUILT TO HOUSE THE SAME TOTALS BY         00590086
006000*  DEPARTMENT - SO THAT DEPARTMENT TOTALS CAN BE DISPLAYED IN     00600086
006100*  NUMERIC  ORDER AT THE TIME OF A BUYER BREAK.                   00610086
006200*                                                                 00620086
006300*  EACH OUTPUT RECORD HAS THE ORIGINAL INPUT FIELDS PLUS A        00630087
006400*  CORRESPONDING SET OF FIELDS TO HOLD THE SUMMED VALUES          00640087
006500*  FOR THE 5 FIELDS (QTY, COST, EXT COST, RETL, EXT RETL)         00650087
006600*  DEPENDING UPON WHICH REC TYPE (DTL, BL, DEPT, BUYER OR GRAND). 00660087
006700*  IF THE REC TYPE IS '3' MEANING DEPT LEVEL SUM OUTPUT REC,      00670087
006800*  THEN THE PERTINENT INFORMATION WILL BE IN THE RV027-DEPT-TOTALS00680087
006900*  WHICH INCLUDE RV027-DEPT-UNT-QTY                               00690087
007000*                RV027-DEPT-UNT-COST-AMT                          00700087
007100*                RV027-DEPT-EXT-UNT-COST-AMT                      00710087
007200*                RV027-DEPT-RTL-COST-AMT                          00720087
007300*                RV027-DEPT-EXT-RTL-COST-AMT                      00730087
007400*                                                                 00740086
007410*  IMPORTANT NOTE:                                                00741092
007500*  THE DATA IN THE FIRST PORTION OF EACH OUTREC (SIMILAR TO THE   00750087
007600*  INPUT) IS FROM THE LAST RECORD READ BEFORE THE BREAK, AND IS   00760087
007700*  MEANT TO JUST PASS ALONG THE INPUT FIELDS THAT ARE NEEDED FOR  00770087
007800*  REPORTING.  THE INTENTION WAS TO CLEAN UP THIS SITUATION BY    00780092
007900*  MOVING SPACES TO SOME SPECIFIC FIELDS IN THE UPPER PORTION     00790092
007910*  OF THE COPYBOOK (NON-TOTAL FIELDS), WHILE PASSING THE          00791092
007920*  APPROPRIATE TOTAL FIELDS FOR WHAT EVER LEVEL MAY BE GETTING    00792092
007930*  WRITTEN AT THE TIME, BL, DEPT, BUYER, GRAND. TIME FOR THIS     00793092
007940*  RAN OUT AS THE EMPHASIS WAS ON PRODUCING THE REPORTS FOR       00794092
007950*  THE USER AND THEN THE AUTHOR WAS RE-DIRECTED TO MORE PRESSING  00795092
007960*  ISSUES ON ANOTHER PROJECT.                                     00796092
007980*                                                                 00798092
008000******************************************************************00800000
008100                                                                  00810000
008200******************************************************************00820000
008300 ENVIRONMENT DIVISION.                                            00830000
008400******************************************************************00840000
008500                                                                  00850000
008600 CONFIGURATION SECTION.                                           00860000
008700                                                                  00870000
008800 SOURCE-COMPUTER.        IBM-3090.                                00880000
008900 OBJECT-COMPUTER.        IBM-3090.                                00890000
009000                                                                  00900000
009100 INPUT-OUTPUT SECTION.                                            00910000
009200                                                                  00920000
009300 FILE-CONTROL.                                                    00930000
009400                                                                  00940000
009500     SELECT INPUT-FILE                  ASSIGN TO INP01.          00950001
009600                                                                  00960000
009700     SELECT OUTPUT-FILE                 ASSIGN TO OUT01.          00970001
009800                                                                  00980000
009900******************************************************************00990000
010000 DATA DIVISION.                                                   01000000
010100******************************************************************01010000
010200                                                                  01020000
010300 FILE SECTION.                                                    01030000
010400                                                                  01040000
010500 FD  INPUT-FILE                                                   01050001
010600     RECORDING MODE IS F                                          01060000
010700     LABEL RECORDS ARE STANDARD                                   01070000
010800     BLOCK CONTAINS 0 RECORDS.                                    01080000
010900                                                                  01090000
011000 01  INPUT-RECORD                        PIC  X(200).             01100001
011100                                                                  01110000
011200 FD  OUTPUT-FILE                                                  01120001
011300     RECORDING MODE IS F                                          01130000
011400     LABEL RECORDS ARE STANDARD                                   01140000
011500     BLOCK CONTAINS 0 RECORDS.                                    01150000
011600                                                                  01160000
011700 01  OUTPUT-RECORD                       PIC  X(610).             01170032
011800                                                                  01180000
011900******************************************************************01190000
012000 WORKING-STORAGE SECTION.                                         01200000
012100******************************************************************01210000
012200                                                                  01220000
012300 01  ABEND-CODE                          PIC S9(04) VALUE +0      01230000
012400                                                     COMP SYNC.   01240000
012500*                                                                 01250000
012600*  WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'                      01260000
012700*                                                                 01270000
012800     COPY DPWS004.                                                01280000
012900                                                                  01290000
013000*                                                                 01300000
013100*  COPYBOOK FOR INPUT INVENTORY FILE.                             01310000
013200*                                                                 01320000
013300     COPY RVRD023.                                                01330000
013400*                                                                 01340001
013500*  COPYBOOK FOR OUTPUT REPORT PREP FILE                           01350001
013600*                                                                 01360001
013700     COPY RVRD027.                                                01370001
013800                                                                  01380001
013900 01  PROGRAM-ACCUMULATORS.                                        01390004
014000     05  PA-TOTAL-STATS.                                          01400001
014100         10  PA-TOT-RECS-READ              PIC S9(07)  VALUE +0   01410001
014200                                                       COMP-3.    01420001
014300         10  PA-TOT-RECS-WRIT              PIC S9(07)  VALUE +0   01430001
014400                                                       COMP-3.    01440001
014500         10  PA-TOT-DTL-RECS-WRIT          PIC S9(07)  VALUE +0   01450001
014600                                                       COMP-3.    01460001
014700         10  PA-TOT-BL-TOTAL-RECS-WRIT     PIC S9(07)  VALUE +0   01470001
014800                                                       COMP-3.    01480001
014900         10  PA-TOT-DEPT-TOTAL-RECS-WRIT   PIC S9(07)  VALUE +0   01490001
015000                                                       COMP-3.    01500001
015100         10  PA-TOT-BUYER-TOTAL-RECS-WRIT  PIC S9(07)  VALUE +0   01510001
015200                                                       COMP-3.    01520001
015300         10  PA-TOT-GRAND-TOTAL-RECS-WRIT  PIC S9(07)  VALUE +0   01530001
015400                                                       COMP-3.    01540001
015500     05  PA-DTL-DOLLARS.                                          01550018
015600         10  PA-DTL-COST                   PIC S9(09)V99          01560018
015700                                               VALUE +0 COMP-3.   01570001
015800         10  PA-DTL-EXT-COST               PIC S9(09)V99          01580018
015900                                               VALUE +0 COMP-3.   01590001
016000         10  PA-DTL-RETL                   PIC S9(09)V99          01600018
016100                                               VALUE +0 COMP-3.   01610001
016200         10  PA-DTL-EXT-RETL               PIC S9(09)V99          01620018
016300                                               VALUE +0 COMP-3.   01630001
016400     05  PA-DTL-QTY                        PIC S9(07)  VALUE +0   01640018
016500                                                        COMP-3.   01650001
016600     05  PA-BL-DOLLARS.                                           01660018
016700         10  PA-BL-COST                    PIC S9(09)V99          01670018
016800                                               VALUE +0 COMP-3.   01680018
016900         10  PA-BL-EXT-COST                PIC S9(09)V99          01690018
017000                                               VALUE +0 COMP-3.   01700018
017100         10  PA-BL-RETL                    PIC S9(09)V99          01710018
017200                                               VALUE +0 COMP-3.   01720018
017300         10  PA-BL-EXT-RETL                PIC S9(09)V99          01730018
017400                                               VALUE +0 COMP-3.   01740018
017500     05  PA-BL-QTY                         PIC S9(07)  VALUE +0   01750018
017600                                                        COMP-3.   01760018
017700     05  PA-DEPT-DOLLARS.                                         01770018
017800         10  PA-DEPT-COST                  PIC S9(09)V99          01780018
017900                                               VALUE +0 COMP-3.   01790018
018000         10  PA-DEPT-EXT-COST              PIC S9(09)V99          01800018
018100                                               VALUE +0 COMP-3.   01810018
018200         10  PA-DEPT-RETL                  PIC S9(09)V99          01820018
018300                                               VALUE +0 COMP-3.   01830018
018400         10  PA-DEPT-EXT-RETL              PIC S9(09)V99          01840018
018500                                               VALUE +0 COMP-3.   01850018
018600     05  PA-DEPT-QTY                       PIC S9(07)  VALUE +0   01860018
018700                                                        COMP-3.   01870018
018800     05  PA-BUYER-DOLLARS.                                        01880018
018900         10  PA-BUYER-COST                 PIC S9(09)V99          01890018
019000                                               VALUE +0 COMP-3.   01900018
019100         10  PA-BUYER-EXT-COST             PIC S9(09)V99          01910018
019200                                               VALUE +0 COMP-3.   01920018
019300         10  PA-BUYER-RETL                 PIC S9(09)V99          01930018
019400                                               VALUE +0 COMP-3.   01940018
019500         10  PA-BUYER-EXT-RETL             PIC S9(09)V99          01950018
019600                                               VALUE +0 COMP-3.   01960018
019700     05  PA-BUYER-QTY                      PIC S9(07)  VALUE +0   01970018
019800                                                        COMP-3.   01980018
019900                                                                  01990018
020000     05  PA-GRAND-DOLLARS.                                        02000018
020100         10  PA-GRAND-COST                 PIC S9(09)V99          02010018
020200                                               VALUE +0 COMP-3.   02020018
020300         10  PA-GRAND-EXT-COST             PIC S9(09)V99          02030018
020400                                               VALUE +0 COMP-3.   02040018
020500         10  PA-GRAND-RETL                 PIC S9(09)V99          02050018
020600                                               VALUE +0 COMP-3.   02060018
020700         10  PA-GRAND-EXT-RETL             PIC S9(09)V99          02070018
020800                                               VALUE +0 COMP-3.   02080018
020900     05  PA-GRAND-QTY                      PIC S9(07)  VALUE +0   02090018
021000                                                        COMP-3.   02100018
021100                                                                  02110018
021200 01  PC-CONSTANTS.                                                02120000
021300     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        02130000
021400         'RVKUT029'.                                              02140065
021500     05  PC-DTL-IND                      PIC  9(01)  VALUE 1.     02150001
021600     05  PC-BL-TOT-IND                   PIC  9(01)  VALUE 2.     02160029
021700     05  PC-DEPT-TOT-IND                 PIC  9(01)  VALUE 3.     02170029
021800     05  PC-BUYER-TOT-IND                PIC  9(01)  VALUE 4.     02180020
021900     05  PC-GRAND-TOT-IND                PIC  9(01)  VALUE 5.     02190020
022000                                                                  02200001
022100 01  PS-PROGRAM-SWITCHES.                                         02210000
022200     05  PS-END-OF-FILE-SWITCH        PIC  X(01) VALUE 'N'.       02220000
022300         88  PS-EOF                              VALUE 'Y'.       02230000
022400         88  PS-NOT-EOF                          VALUE 'N'.       02240000
022500     05  PS-FIRST-PASS-SWITCH         PIC  X(01) VALUE 'N'.       02250012
022600         88  PS-FIRST-PASS-YES                   VALUE 'Y'.       02260012
022700         88  PS-FIRST-PASS-NO                    VALUE 'N'.       02270012
022800     05  PS-DEPT-PRINT-CONTROL        PIC  X(01) VALUE 'S'.       02280052
022900         88  PS-DEPT-PRINT-START                 VALUE 'S'.       02290052
023000         88  PS-DEPT-PRINT-END                   VALUE 'E'.       02300052
023100     05  PS-DEPT-PRINT-IND            PIC  X(01) VALUE 'N'.       02310052
023200         88  PS-NO-DEPT-PRINTED                  VALUE 'N'.       02320052
023300         88  PS-DEPT-PRINTED                     VALUE 'Y'.       02330052
023400                                                                  02340000
023500 01  PROGRAM-VARIABLES.                                           02350001
023600     05  PV-CURRENT-TMST                 PIC  X(26)  VALUE SPACES.02360009
023700     05  PV-FIELD-NAME                   PIC  X(30)  VALUE SPACES.02370008
023800     05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACE. 02380034
023900     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 02390034
024000     05  PV-CURR-DEPT                    PIC  X(03)  VALUE SPACES.02400052
024100     05  PV-PREV-DEPT                    PIC  X(03)  VALUE SPACES.02410052
024200     05  PV-ACCUM-DEPT-NBR               PIC  X(03) VALUE SPACE.  02420058
024300                                                                  02430001
024400 01  PROGRAM-HOLD-VARIABLES.                                      02440001
024500     05  PV-HOLD-BL-NBR                  PIC  X(38) VALUE SPACE.  02450039
024600     05  PV-HOLD-BL-STATUS               PIC  X(01) VALUE SPACE.  02460034
024700     05  PV-HOLD-SKU                     PIC  X(08) VALUE SPACE.  02470034
024800     05  PV-HOLD-DEPT-NBR                PIC  X(03) VALUE SPACE.  02480034
024900     05  PV-HOLD-SUB-CL-NBR              PIC  9(02) VALUE 0.      02490034
025000     05  PV-HOLD-RETURN-TYPE             PIC  X(01) VALUE SPACE.  02500034
025100     05  PV-HOLD-COST                    PIC  9(07)V99 VALUE 0.   02510034
025200     05  PV-HOLD-RETL                    PIC  9(07)V99 VALUE 0.   02520034
025300     05  PV-HOLD-UNT-QTY                 PIC S9(09) VALUE +0.     02530035
025400     05  PV-HOLD-SCAN-DTE                PIC  X(08) VALUE SPACE.  02540034
025500     05  PV-HOLD-LOC-ID                  PIC  X(50) VALUE SPACE.  02550034
025600     05  PV-HOLD-DISP                    PIC  X(01) VALUE SPACE.  02560034
025700     05  PV-HOLD-PUT-AWAY-DATE           PIC  X(08) VALUE SPACE.  02570034
025800     05  PV-HOLD-TRNS-NBR-STR            PIC  9(04) VALUE 0.      02580034
025900     05  PV-HOLD-TRNS-NBR                PIC  9(06) VALUE 0.      02590034
026000     05  PV-HOLD-RTV-LOC                 PIC  X(04) VALUE SPACE.  02600034
026100     05  PV-HOLD-BUYER-NBR               PIC  X(03) VALUE SPACE.  02610034
026200     05  PV-HOLD-BUYER-NAME              PIC  X(32) VALUE SPACE.  02620034
026300                                                                  02630034
026400                                                                  02640000
026500 01  DT-DEPARTMENT-TOTALS.                                        02650000
026600     05  DT-MAX-DEPTS                    PIC S9(3) VALUE +25      02660000
026700                                                     COMP-3.      02670000
026800     05  DT-HOLD-DEPT-NBR                PIC X(03) VALUE SPACE.   02680000
026900                                                                  02690000
027000 01  DT-DEPT-TOTAL-TABLE.                                         02700000
027100     05  DT-DEPT-TOTAL-ENTRIES           OCCURS 25 TIMES          02710000
027200                                         INDEXED BY DT-IDX.       02720000
027300         10  DT-DEPT-NBR                 PIC  X(03)  VALUE SPACES.02730000
027400         10  DT-QTY-DEPT-TOTAL           PIC S9(05)  VALUE +0     02740000
027500                                                     COMP-3.      02750000
027600         10  DT-UNIT-COST-DEPT-TOTAL     PIC S9(07)V99            02760000
027700                                                     VALUE +0     02770000
027800                                                     COMP-3.      02780000
027900         10  DT-UNIT-EXT-COST-DEPT-TOTAL PIC S9(07)V99            02790000
028000                                                     VALUE +0     02800000
028100                                                     COMP-3.      02810000
028200         10  DT-RETL-COST-DEPT-TOTAL     PIC S9(07)V99            02820000
028300                                                     VALUE +0     02830000
028400                                                     COMP-3.      02840000
028500         10  DT-RETL-EXT-COST-DEPT-TOTAL PIC S9(07)V99            02850000
028600                                                     VALUE +0     02860000
028700                                                     COMP-3.      02870000
028800******************************************************************02880000
028900*  DB2 COMMUNICATION AREA.                                        02890000
029000******************************************************************02900000
029100     EXEC SQL                                                     02910000
029200          INCLUDE SQLCA                                           02920000
029300     END-EXEC.                                                    02930000
029400                                                                  02940000
029500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02950000
029600 PROCEDURE DIVISION.                                              02960000
029700* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02970000
029800                                                                  02980000
029900******************************************************************02990000
030000*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    03000000
030100******************************************************************03010000
030200 0000-PROGRAM-MAINLINE.                                           03020000
030300     DISPLAY '************ START OF RVKUT029 ***************'     03030001
030400     PERFORM 1000-INITIALIZE.                                     03040001
030500                                                                  03050001
030600     IF PS-NOT-EOF                                                03060001
030700        PERFORM 1100-CONTINUE-PROCESSING                          03070001
030800     ELSE                                                         03080001
030900        DISPLAY ' '                                               03090001
031000        DISPLAY '******  EMPTY INPUT FILE  ********'              03100001
031100        DISPLAY ' '                                               03110001
031200        CLOSE INPUT-FILE                                          03120001
031300              OUTPUT-FILE                                         03130001
031400     END-IF.                                                      03140001
031500                                                                  03150001
031600     DISPLAY '************  END OF RVKUT029  ***************'     03160001
031700     STOP RUN.                                                    03170001
031800                                                                  03180001
031900******************************************************************03190000
032000*  INIT VARIABLES                                                 03200001
032100*  OPEN FILES                                                     03210001
032200*  DO A PRIME READ                                                03220001
032300******************************************************************03230000
032400 1000-INITIALIZE.                                                 03240000
032500                                                                  03250000
032600     EXEC SQL                                                     03260011
032700          SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                03270011
032800     END-EXEC.                                                    03280011
032900                                                                  03290006
033000     OPEN INPUT  INPUT-FILE                                       03300023
033100          OUTPUT OUTPUT-FILE.                                     03310023
033200                                                                  03320023
033300     INITIALIZE PROGRAM-VARIABLES                                 03330001
033400                PROGRAM-HOLD-VARIABLES                            03340001
033500                PROGRAM-ACCUMULATORS                              03350004
033600                RV023-INVENTORY-RECORD                            03360024
033700                RV027-INV-DTL-RPT-PREP-REC.                       03370001
033800                                                                  03380001
033900     MOVE +0    TO RV027-DTL-TOTALS                               03390026
034000                   RV027-BL-TOTALS                                03400018
034100                   RV027-DEPT-TOTALS                              03410018
034200                   RV027-BUYER-TOTALS                             03420018
034300                   RV027-GRAND-TOTALS.                            03430018
034400                                                                  03440001
034500     SET PS-FIRST-PASS-YES TO TRUE.                               03450012
034600                                                                  03460000
034700*ZERO OUT ALL BUCKETS                                             03470040
034800     PERFORM 6800-ZERO-OUT-ALL-BUCKETS.                           03480040
034900                                                                  03490040
035000*PRIME READ OF INPUT                                              03500001
035100     PERFORM 7000-READ-INPUT.                                     03510000
035200                                                                  03520003
035300*MOVE THE CURR REC DEPT NBR TO THE HOLD FIELD FOR THE INTERNAL    03530058
035400*DEPT TABLE USED TO ACCUMULATE DEPT TOTALS BY BUYER               03540058
035500     MOVE RV023-DEPT-NBR    TO PV-ACCUM-DEPT-NBR.                 03550058
035600                                                                  03560058
035700******************************************************************03570001
035800* MAIN PROCESSING AND WRAP UP                                     03580089
035900******************************************************************03590001
036000 1100-CONTINUE-PROCESSING.                                        03600001
036100                                                                  03610001
036200     PERFORM 2000-PROCESS UNTIL PS-EOF.                           03620001
036300                                                                  03630001
036400     PERFORM 8000-EOJ-ROUTINE.                                    03640029
036500                                                                  03650001
036600******************************************************************03660000
036700* THE EVALUATE STATEMENT WILL DETERMINE WHEN A BREAK IS REQUIRED. 03670089
036800* IF THE ORDER MUST BE CHANGED OR ALTERED - DO SO CAREFULLY AS THE03680089
036900* ORDER OF THE 'WHEN' STATEMENTS CONTROLS THE BREAK LEVEL.        03690089
037000*                                                                 03700089
037100*                                                                 03710089
037200*                                                                 03720089
037300*                                                                 03730089
037400******************************************************************03740000
037500 2000-PROCESS.                                                    03750000
037600                                                                  03760002
037700     EVALUATE TRUE                                                03770002
037800***MULT DTLS                                                      03780003
037900        WHEN RV023-BUYER-NBR      EQUAL PV-HOLD-BUYER-NBR         03790018
038000         AND RV023-BL-NBR         EQUAL PV-HOLD-BL-NBR            03800039
038100         AND RV023-DEPT-NBR       EQUAL PV-HOLD-DEPT-NBR          03810003
038200         AND RV023-SKU            EQUAL PV-HOLD-SKU               03820003
038300         AND RV023-UNT-COST-AMT   EQUAL PV-HOLD-COST              03830003
038400         AND RV023-RTL-AMT        EQUAL PV-HOLD-RETL              03840003
038500         AND RV023-SCN-DATE       EQUAL PV-HOLD-SCAN-DTE          03850016
038600               PERFORM 5000-MULT-DTL                              03860004
038700                                                                  03870002
038800***NEW SCAN DATE                                                  03880002
038900        WHEN RV023-BUYER-NBR      EQUAL PV-HOLD-BUYER-NBR         03890015
039000         AND RV023-BL-NBR         EQUAL PV-HOLD-BL-NBR            03900039
039100         AND RV023-DEPT-NBR       EQUAL PV-HOLD-DEPT-NBR          03910003
039200         AND RV023-SKU            EQUAL PV-HOLD-SKU               03920003
039300         AND RV023-UNT-COST-AMT   EQUAL PV-HOLD-COST              03930003
039400         AND RV023-RTL-AMT        EQUAL PV-HOLD-RETL              03940003
039500         AND RV023-SCN-DATE       NOT EQUAL PV-HOLD-SCAN-DTE      03950019
039600               PERFORM 5100-SCAN-BREAK                            03960003
039700                                                                  03970002
039800***NEW RETAIL AMOUNT                                              03980017
039900        WHEN RV023-BUYER-NBR      EQUAL PV-HOLD-BUYER-NBR         03990017
040000         AND RV023-BL-NBR         EQUAL PV-HOLD-BL-NBR            04000039
040100         AND RV023-DEPT-NBR       EQUAL PV-HOLD-DEPT-NBR          04010017
040200         AND RV023-SKU            EQUAL PV-HOLD-SKU               04020017
040300         AND RV023-UNT-COST-AMT   EQUAL PV-HOLD-COST              04030017
040400         AND RV023-RTL-AMT        NOT EQUAL PV-HOLD-RETL          04040019
040500               PERFORM 5200-RETL-BREAK                            04050017
040600                                                                  04060017
040700***NEW COST AMOUNT                                                04070017
040800        WHEN RV023-BUYER-NBR      EQUAL PV-HOLD-BUYER-NBR         04080017
040900         AND RV023-BL-NBR         EQUAL PV-HOLD-BL-NBR            04090039
041000         AND RV023-DEPT-NBR       EQUAL PV-HOLD-DEPT-NBR          04100017
041100         AND RV023-SKU            EQUAL PV-HOLD-SKU               04110017
041200         AND RV023-UNT-COST-AMT   NOT EQUAL PV-HOLD-COST          04120017
041300               PERFORM 5300-COST-BREAK                            04130017
041400                                                                  04140017
041500***NEW SKU                                                        04150017
041600        WHEN RV023-BUYER-NBR      EQUAL PV-HOLD-BUYER-NBR         04160017
041700         AND RV023-BL-NBR         EQUAL PV-HOLD-BL-NBR            04170039
041800         AND RV023-DEPT-NBR       EQUAL PV-HOLD-DEPT-NBR          04180017
041900         AND RV023-SKU            NOT EQUAL PV-HOLD-SKU           04190017
042000               PERFORM 5400-SKU-BREAK                             04200017
042100                                                                  04210017
042200***NEW DEPT                                                       04220017
042300        WHEN RV023-BUYER-NBR      EQUAL PV-HOLD-BUYER-NBR         04230017
042400         AND RV023-BL-NBR         EQUAL PV-HOLD-BL-NBR            04240039
042500         AND RV023-DEPT-NBR       NOT EQUAL PV-HOLD-DEPT-NBR      04250017
042600               PERFORM 5500-DEPT-BREAK                            04260017
042700                                                                  04270017
042800***NEW BL                                                         04280017
042900        WHEN RV023-BUYER-NBR      EQUAL PV-HOLD-BUYER-NBR         04290017
043000         AND RV023-BL-NBR         NOT EQUAL PV-HOLD-BL-NBR        04300039
043100               PERFORM 5600-BL-BREAK                              04310017
043200                                                                  04320017
043300***NEW BUYER NBR                                                  04330017
043400        WHEN RV023-BUYER-NBR      NOT EQUAL PV-HOLD-BUYER-NBR     04340017
043500         AND PS-FIRST-PASS-NO                                     04350025
043600               PERFORM 5700-BUYER-BREAK                           04360018
043700                                                                  04370017
043800***FIRST TIME THROUGH (FIRST REC)                                 04380030
043900        WHEN RV023-BUYER-NBR      NOT EQUAL PV-HOLD-BUYER-NBR     04390030
044000         AND RV023-BL-NBR         NOT EQUAL PV-HOLD-BL-NBR        04400039
044100         AND RV023-DEPT-NBR       NOT EQUAL PV-HOLD-DEPT-NBR      04410017
044200         AND RV023-SKU            NOT EQUAL PV-HOLD-SKU           04420017
044300         AND RV023-UNT-COST-AMT   NOT EQUAL PV-HOLD-COST          04430017
044400         AND RV023-RTL-AMT        NOT EQUAL PV-HOLD-RETL          04440017
044500         AND RV023-SCN-DATE       NOT EQUAL PV-HOLD-SCAN-DTE      04450017
044600         AND PS-FIRST-PASS-YES                                    04460017
044700               PERFORM 4900-ACCUM-DTL                             04470017
044800     END-EVALUATE.                                                04480017
044900                                                                  04490002
045000** THIS ACCUMULATES THE DEPT TOTALS BY BUYER INTO AN INTERNAL TBL 04500089
045100     PERFORM 6300-ACCUM-DEPT-TOTALS.                              04510057
045200                                                                  04520000
045300** BEFORE THE NEXT READ, MOVE THE CURR INPUT TO HOLD FIELDS       04530089
045400** FOR COMPARISON IN THE ABOVE EVALUATE STATEMENT.                04540089
045500     PERFORM 7100-MOVE-TO-HOLD.                                   04550077
045600                                                                  04560012
045700     PERFORM 7000-READ-INPUT.                                     04570000
045800                                                                  04580059
045900** PV-ACCUM-DEPT-NBR IS USED IN THE LOADING OF THE INTERNAL       04590089
046000** TABLE IN 6300-                                                 04600089
046100     MOVE RV023-DEPT-NBR  TO PV-ACCUM-DEPT-NBR.                   04610059
046200                                                                  04620000
046300******************************************************************04630001
046400* THIS IS A FIRST TIME THROUGH, SO DOLLAR FIELDS SHOULD BE INIT 0 04640018
046500******************************************************************04650001
046600 4900-ACCUM-DTL.                                                  04660012
046700                                                                  04670001
046800     SET PS-FIRST-PASS-NO TO TRUE.                                04680077
046900                                                                  04690012
047000*LOAD "DTL" REC TYP FOR OUTREC                                    04700018
047100     MOVE PC-DTL-IND  TO RV027-REC-TYP.                           04710018
047200                                                                  04720018
047300*LOAD QTY & DOLLAR FIELDS FOR DTL BUCKETS                         04730018
047400     ADD   RV023-UNT-QTY        TO PA-DTL-QTY.                    04740018
047500     ADD   RV023-UNT-COST-AMT   TO PA-DTL-COST                    04750018
047600                                   PA-DTL-EXT-COST.               04760018
047700     ADD   RV023-RTL-AMT        TO PA-DTL-RETL                    04770018
047800                                   PA-DTL-EXT-RETL.               04780018
047900                                                                  04790018
048000*LOAD QTY & DOLLAR FIELDS FOR BL BUCKETS                          04800018
048100     ADD   RV023-UNT-QTY        TO PA-BL-QTY.                     04810018
048200     ADD   RV023-UNT-COST-AMT   TO PA-BL-COST                     04820018
048300                                   PA-BL-EXT-COST.                04830018
048400     ADD   RV023-RTL-AMT        TO PA-BL-RETL                     04840018
048500                                   PA-BL-EXT-RETL.                04850018
048600                                                                  04860018
048700*LOAD QTY & DOLLAR FIELDS FOR DEPT BUCKETS                        04870018
048800     ADD   RV023-UNT-QTY        TO PA-DEPT-QTY.                   04880018
048900     ADD   RV023-UNT-COST-AMT   TO PA-DEPT-COST                   04890018
049000                                   PA-DEPT-EXT-COST.              04900018
049100     ADD   RV023-RTL-AMT        TO PA-DEPT-RETL                   04910018
049200                                   PA-DEPT-EXT-RETL.              04920018
049300                                                                  04930018
049400*LOAD QTY & DOLLAR FIELDS FOR BUYER BUCKETS                       04940018
049500     ADD   RV023-UNT-QTY        TO PA-BUYER-QTY.                  04950018
049600     ADD   RV023-UNT-COST-AMT   TO PA-BUYER-COST                  04960018
049700                                   PA-BUYER-EXT-COST.             04970018
049800     ADD   RV023-RTL-AMT        TO PA-BUYER-RETL                  04980018
049900                                   PA-BUYER-EXT-RETL.             04990018
050000                                                                  05000018
050100*LOAD QTY & DOLLAR FIELDS FOR GRAND BUCKETS                       05010018
050200     ADD   RV023-UNT-QTY        TO PA-GRAND-QTY.                  05020018
050300     ADD   RV023-UNT-COST-AMT   TO PA-GRAND-COST                  05030018
050400                                   PA-GRAND-EXT-COST.             05040018
050500     ADD   RV023-RTL-AMT        TO PA-GRAND-RETL                  05050018
050600                                   PA-GRAND-EXT-RETL.             05060018
050700                                                                  05070018
050800*LOAD THE CURR REC RV023 INTO THE OUTREC (NON BUCKET FIELDS)      05080089
050900     PERFORM 6500-PREP-OUTREC.                                    05090018
051000                                                                  05100012
051100******************************************************************05110012
051200* THIS PARAGRAPH IS ONLY EXECUTED WHEN THERE ARE CONSECUTIVE      05120089
051300* INPUT RECORDS THAT ARE IDENTICAL ON THE BREAKING FIELDS:        05130089
051400* BUYER NBR, BL NBR, DEPT, SKU, UNIT COST, RETL COST, SCAN DATE.  05140089
051500* BECAUSE THE QTY IS SUPPOSED TO ALWAYS BE 1, THESE IDENTICAL     05150089
051600* RECORDS NEED TO BE SUMMED. THE EXTENDED COST IS THE UNIT COST   05160089
051700* MULTIPLIED BY THE QTY, AND THE EXTENDED RETL IS THE RETL COST   05170089
051800* MULTIPLIED BY THE QTY. WHEN THE INPUT RECORDS ARE THE SAME      05180089
051900* WE ONLY WANT TO ADD THE CURRENT REC VALUES TO THE QTY,          05190089
052000* EXTENDED COST & EXTENDED RETL. IF THE INPUT VALUES ARE ADDED TO 05200089
052100* THE NON EXT COST AND RETL VALUES, ALL THE VALUES WILL BE THE    05210089
052200* SAME - THIS IS KEY TO GETTING THE TOTALS CORRECT ON THE REPORT. 05220089
052300* THIS OTHER PARAGRAPHS WHERE VALUES ARE BEING ADDED TO BUCKETS,  05230089
052400* WILL ADD TO ALL 5 FIELDS INSTEAD OF THE 3 HERE.                 05240089
052500******************************************************************05250012
052600 5000-MULT-DTL.                                                   05260012
052700                                                                  05270012
052800*NOTE !!!!                                                        05280018
052900*ONLY ADD TO THE EXTENDED BUCKETS - BECAUSE THE NON-EXTENDED      05290018
053000*COST & RETAIL DOLLAR VALUES WILL BE THE SAME FOR THE DETAIL LINE 05300018
053100                                                                  05310018
053200*LOAD QTY & DOLLAR FIELDS FOR DTL BUCKETS                         05320018
053300     ADD   RV023-UNT-QTY         TO PA-DTL-QTY.                   05330018
053400                                                                  05340018
053500     ADD RV023-UNT-COST-AMT      TO PA-DTL-EXT-COST.              05350018
053600     ADD RV023-RTL-AMT           TO PA-DTL-EXT-RETL.              05360018
053700                                                                  05370018
053800*LOAD QTY & DOLLAR FIELDS FOR BL BUCKETS                          05380018
053900     ADD   RV023-UNT-QTY        TO PA-BL-QTY.                     05390018
054000                                                                  05400018
054100     ADD   RV023-UNT-COST-AMT   TO PA-BL-EXT-COST.                05410018
054200     ADD   RV023-RTL-AMT        TO PA-BL-EXT-RETL.                05420018
054300                                                                  05430018
054400*LOAD QTY & DOLLAR FIELDS FOR DEPT BUCKETS                        05440018
054500     ADD   RV023-UNT-QTY        TO PA-DEPT-QTY.                   05450018
054600                                                                  05460018
054700     ADD   RV023-UNT-COST-AMT   TO PA-DEPT-EXT-COST.              05470018
054800     ADD   RV023-RTL-AMT        TO PA-DEPT-EXT-RETL.              05480018
054900                                                                  05490018
055000*LOAD QTY & DOLLAR FIELDS FOR BUYER BUCKETS                       05500018
055100     ADD   RV023-UNT-QTY        TO PA-BUYER-QTY.                  05510018
055200                                                                  05520018
055300     ADD   RV023-UNT-COST-AMT   TO PA-BUYER-EXT-COST.             05530018
055400     ADD   RV023-RTL-AMT        TO PA-BUYER-EXT-RETL.             05540018
055500                                                                  05550018
055600*LOAD QTY & DOLLAR FIELDS FOR GRAND BUCKETS                       05560018
055700     ADD   RV023-UNT-QTY        TO PA-GRAND-QTY.                  05570018
055800                                                                  05580018
055900     ADD   RV023-UNT-COST-AMT   TO PA-GRAND-EXT-COST.             05590018
056000     ADD   RV023-RTL-AMT        TO PA-GRAND-EXT-RETL.             05600018
056100                                                                  05610018
056200******************************************************************05620018
056300* THIS IS PERFORMED WHEN THE SCAN DATES DIFFER BETWEEN THE INPUT  05630090
056400* AND THE PREVIOUS REC (HOLD FIELDS).                             05640090
056500******************************************************************05650018
056600 5100-SCAN-BREAK.                                                 05660003
056700                                                                  05670003
056800*LOAD THE SUMMED DTL VALUES TO THE OUTPUT DOLLAR FIELDS           05680089
056900     PERFORM 6510-PREP-OUTREC-DTL-DLRS.                           05690018
057000                                                                  05700018
057100*WRITE DETAIL                                                     05710010
057200     PERFORM 6600-WRITE-OUTREC.                                   05720010
057300                                                                  05730010
057400*INIT THE OUTREC                                                  05740018
057500     INITIALIZE RV027-INV-DTL-RPT-PREP-REC.                       05750018
057600                                                                  05760018
057700*A SCAN BREAK MEANS THIS IS STILL A 'DTL' REC TYP - SO MOVE TO OUT05770089
057800     MOVE PC-DTL-IND  TO RV027-REC-TYP.                           05780018
057900                                                                  05790018
058000*ZERO OUT THE DTL BUCKETS THAT WERE JUST WRITTEN                  05800018
058100     MOVE +0 TO PA-DTL-QTY                                        05810027
058200                PA-DTL-COST                                       05820027
058300                PA-DTL-EXT-COST                                   05830027
058400                PA-DTL-RETL                                       05840027
058500                PA-DTL-EXT-RETL.                                  05850027
058600                                                                  05860089
058700*LOAD THE CURR REC RV023 INTO THE OUTREC (NON BUCKET FIELDS)      05870081
058800     PERFORM 6500-PREP-OUTREC.                                    05880081
058900                                                                  05890018
059000*LOAD QTY & DOLLAR FIELDS FOR DTL BUCKETS                         05900018
059100     ADD   RV023-UNT-QTY        TO PA-DTL-QTY.                    05910018
059200     ADD   RV023-UNT-COST-AMT   TO PA-DTL-COST                    05920018
059300                                   PA-DTL-EXT-COST.               05930018
059400     ADD   RV023-RTL-AMT        TO PA-DTL-RETL                    05940018
059500                                   PA-DTL-EXT-RETL.               05950018
059600                                                                  05960018
059700*LOAD QTY & DOLLAR FIELDS FOR BL BUCKETS                          05970018
059800     ADD   RV023-UNT-QTY        TO PA-BL-QTY.                     05980018
059900     ADD   RV023-UNT-COST-AMT   TO PA-BL-COST                     05990018
060000                                   PA-BL-EXT-COST.                06000018
060100     ADD   RV023-RTL-AMT        TO PA-BL-RETL                     06010018
060200                                   PA-BL-EXT-RETL.                06020018
060300                                                                  06030018
060400*LOAD QTY & DOLLAR FIELDS FOR DEPT BUCKETS                        06040018
060500     ADD   RV023-UNT-QTY        TO PA-DEPT-QTY.                   06050018
060600     ADD   RV023-UNT-COST-AMT   TO PA-DEPT-COST                   06060018
060700                                   PA-DEPT-EXT-COST.              06070018
060800     ADD   RV023-RTL-AMT        TO PA-DEPT-RETL                   06080018
060900                                   PA-DEPT-EXT-RETL.              06090018
061000                                                                  06100018
061100*LOAD QTY & DOLLAR FIELDS FOR BUYER BUCKETS                       06110018
061200     ADD   RV023-UNT-QTY        TO PA-BUYER-QTY.                  06120018
061300     ADD   RV023-UNT-COST-AMT   TO PA-BUYER-COST                  06130018
061400                                   PA-BUYER-EXT-COST.             06140018
061500     ADD   RV023-RTL-AMT        TO PA-BUYER-RETL                  06150018
061600                                   PA-BUYER-EXT-RETL.             06160018
061700                                                                  06170018
061800*LOAD QTY & DOLLAR FIELDS FOR GRAND BUCKETS                       06180018
061900     ADD   RV023-UNT-QTY        TO PA-GRAND-QTY.                  06190018
062000     ADD   RV023-UNT-COST-AMT   TO PA-GRAND-COST                  06200018
062100                                   PA-GRAND-EXT-COST.             06210018
062200     ADD   RV023-RTL-AMT        TO PA-GRAND-RETL                  06220018
062300                                   PA-GRAND-EXT-RETL.             06230018
062400                                                                  06240018
062500******************************************************************06250018
062600* THIS IS PERFORMED WHEN THE RETL COST DIFFERS BETWEEN THE INPUT  06260090
062700* AND THE PREVIOUS REC (HOLD FIELDS).                             06270090
062800******************************************************************06280018
062900 5200-RETL-BREAK.                                                 06290018
063000                                                                  06300018
063100*LOAD THE SUMMED DTL VALUES TO THE OUTPUT DOLLAR FIELDS           06310089
063200     PERFORM 6510-PREP-OUTREC-DTL-DLRS.                           06320018
063300                                                                  06330018
063400*WRITE DETAIL                                                     06340018
063500     PERFORM 6600-WRITE-OUTREC.                                   06350018
063600                                                                  06360018
063700*INIT THE OUTREC                                                  06370018
063800     INITIALIZE RV027-INV-DTL-RPT-PREP-REC.                       06380018
063900                                                                  06390018
064000*A RETL BREAK MEANS THIS IS STILL A 'DTL' REC TYP - SO MOVE TO OUT06400089
064100     MOVE PC-DTL-IND  TO RV027-REC-TYP.                           06410018
064200                                                                  06420018
064300*ZERO OUT THE DTL BUCKETS THAT WERE JUST WRITTEN                  06430018
064400     MOVE +0 TO PA-DTL-QTY                                        06440026
064500                PA-DTL-COST                                       06450027
064600                PA-DTL-EXT-COST                                   06460027
064700                PA-DTL-RETL                                       06470027
064800                PA-DTL-EXT-RETL.                                  06480027
064900                                                                  06490089
065000*LOAD THE CURR RV023 INTO THE OUTREC (NON BUCKET FIELDS)          06500081
065100     PERFORM 6500-PREP-OUTREC.                                    06510081
065200                                                                  06520018
065300*LOAD QTY & DOLLAR FIELDS FOR DTL BUCKETS                         06530018
065400     ADD   RV023-UNT-QTY        TO PA-DTL-QTY.                    06540018
065500     ADD   RV023-UNT-COST-AMT   TO PA-DTL-COST                    06550018
065600                                   PA-DTL-EXT-COST.               06560018
065700     ADD   RV023-RTL-AMT        TO PA-DTL-RETL                    06570018
065800                                   PA-DTL-EXT-RETL.               06580018
065900                                                                  06590018
066000*LOAD QTY & DOLLAR FIELDS FOR BL BUCKETS                          06600018
066100     ADD   RV023-UNT-QTY        TO PA-BL-QTY.                     06610018
066200     ADD   RV023-UNT-COST-AMT   TO PA-BL-COST                     06620018
066300                                   PA-BL-EXT-COST.                06630018
066400     ADD   RV023-RTL-AMT        TO PA-BL-RETL                     06640018
066500                                   PA-BL-EXT-RETL.                06650018
066600                                                                  06660018
066700*LOAD QTY & DOLLAR FIELDS FOR DEPT BUCKETS                        06670018
066800     ADD   RV023-UNT-QTY        TO PA-DEPT-QTY.                   06680018
066900     ADD   RV023-UNT-COST-AMT   TO PA-DEPT-COST                   06690018
067000                                   PA-DEPT-EXT-COST.              06700018
067100     ADD   RV023-RTL-AMT        TO PA-DEPT-RETL                   06710018
067200                                   PA-DEPT-EXT-RETL.              06720018
067300                                                                  06730018
067400*LOAD QTY & DOLLAR FIELDS FOR BUYER BUCKETS                       06740018
067500     ADD   RV023-UNT-QTY        TO PA-BUYER-QTY.                  06750018
067600     ADD   RV023-UNT-COST-AMT   TO PA-BUYER-COST                  06760018
067700                                   PA-BUYER-EXT-COST.             06770018
067800     ADD   RV023-RTL-AMT        TO PA-BUYER-RETL                  06780018
067900                                   PA-BUYER-EXT-RETL.             06790018
068000                                                                  06800018
068100*LOAD QTY & DOLLAR FIELDS FOR GRAND BUCKETS                       06810018
068200     ADD   RV023-UNT-QTY        TO PA-GRAND-QTY.                  06820018
068300     ADD   RV023-UNT-COST-AMT   TO PA-GRAND-COST                  06830018
068400                                   PA-GRAND-EXT-COST.             06840018
068500     ADD   RV023-RTL-AMT        TO PA-GRAND-RETL                  06850018
068600                                   PA-GRAND-EXT-RETL.             06860018
068700                                                                  06870018
068800******************************************************************06880018
068900* THIS IS PERFORMED WHEN THE UNIT COST DIFFERS BETWEEN THE INPUT  06890090
069000* AND THE PREVIOUS REC (HOLD FIELDS).                             06900090
069100******************************************************************06910018
069200 5300-COST-BREAK.                                                 06920018
069300                                                                  06930018
069400*LOAD THE SUMMED DTL VALUES TO THE OUTPUT DOLLAR FIELDS           06940089
069500     PERFORM 6510-PREP-OUTREC-DTL-DLRS.                           06950018
069600                                                                  06960018
069700*WRITE DETAIL                                                     06970018
069800     PERFORM 6600-WRITE-OUTREC.                                   06980018
069900                                                                  06990018
070000*INIT THE OUTREC                                                  07000018
070100     INITIALIZE RV027-INV-DTL-RPT-PREP-REC.                       07010018
070200                                                                  07020018
070300*A COST BREAK MEANS THIS IS STILL A 'DTL' REC TYP - SO MOVE TO OUT07030089
070400     MOVE PC-DTL-IND  TO RV027-REC-TYP.                           07040018
070500                                                                  07050018
070600*ZERO OUT THE DTL BUCKETS THAT WERE JUST WRITTEN                  07060018
070700     MOVE +0 TO PA-DTL-QTY                                        07070026
070800                PA-DTL-COST                                       07080027
070900                PA-DTL-EXT-COST                                   07090027
071000                PA-DTL-RETL                                       07100027
071100                PA-DTL-EXT-RETL.                                  07110027
071200                                                                  07120027
071300*LOAD THE CURR REC RV023 INTO THE OUTREC (NON BUCKET FIELDS)      07130050
071400     PERFORM 6500-PREP-OUTREC.                                    07140050
071500                                                                  07150018
071600*LOAD QTY & DOLLAR FIELDS FOR DTL BUCKETS                         07160018
071700     ADD   RV023-UNT-QTY        TO PA-DTL-QTY.                    07170018
071800     ADD   RV023-UNT-COST-AMT   TO PA-DTL-COST                    07180018
071900                                   PA-DTL-EXT-COST.               07190018
072000     ADD   RV023-RTL-AMT        TO PA-DTL-RETL                    07200018
072100                                   PA-DTL-EXT-RETL.               07210018
072200                                                                  07220018
072300*LOAD QTY & DOLLAR FIELDS FOR BL BUCKETS                          07230018
072400     ADD   RV023-UNT-QTY        TO PA-BL-QTY.                     07240018
072500     ADD   RV023-UNT-COST-AMT   TO PA-BL-COST                     07250018
072600                                   PA-BL-EXT-COST.                07260018
072700     ADD   RV023-RTL-AMT        TO PA-BL-RETL                     07270018
072800                                   PA-BL-EXT-RETL.                07280018
072900                                                                  07290018
073000*LOAD QTY & DOLLAR FIELDS FOR DEPT BUCKETS                        07300018
073100     ADD   RV023-UNT-QTY        TO PA-DEPT-QTY.                   07310018
073200     ADD   RV023-UNT-COST-AMT   TO PA-DEPT-COST                   07320018
073300                                   PA-DEPT-EXT-COST.              07330018
073400     ADD   RV023-RTL-AMT        TO PA-DEPT-RETL                   07340018
073500                                   PA-DEPT-EXT-RETL.              07350018
073600                                                                  07360018
073700*LOAD QTY & DOLLAR FIELDS FOR BUYER BUCKETS                       07370018
073800     ADD   RV023-UNT-QTY        TO PA-BUYER-QTY.                  07380018
073900     ADD   RV023-UNT-COST-AMT   TO PA-BUYER-COST                  07390018
074000                                   PA-BUYER-EXT-COST.             07400018
074100     ADD   RV023-RTL-AMT        TO PA-BUYER-RETL                  07410018
074200                                   PA-BUYER-EXT-RETL.             07420018
074300                                                                  07430018
074400*LOAD QTY & DOLLAR FIELDS FOR GRAND BUCKETS                       07440018
074500     ADD   RV023-UNT-QTY        TO PA-GRAND-QTY.                  07450018
074600     ADD   RV023-UNT-COST-AMT   TO PA-GRAND-COST                  07460018
074700                                   PA-GRAND-EXT-COST.             07470018
074800     ADD   RV023-RTL-AMT        TO PA-GRAND-RETL                  07480018
074900                                   PA-GRAND-EXT-RETL.             07490018
075000                                                                  07500018
075100******************************************************************07510018
075200* THIS IS PERFORMED WHEN THE SKU DIFFERS BETWEEN THE INPUT        07520090
075300* AND THE PREVIOUS REC (HOLD FIELDS).                             07530090
075400******************************************************************07540018
075500 5400-SKU-BREAK.                                                  07550018
075600                                                                  07560018
075700*LOAD THE SUMMED DTL VALUES TO THE REPORT DOLLAR FIELDS           07570018
075800     PERFORM 6510-PREP-OUTREC-DTL-DLRS.                           07580018
075900                                                                  07590018
076000*WRITE DETAIL                                                     07600018
076100     PERFORM 6600-WRITE-OUTREC.                                   07610018
076200                                                                  07620018
076300*INIT THE OUTREC                                                  07630018
076400     INITIALIZE RV027-INV-DTL-RPT-PREP-REC.                       07640018
076500                                                                  07650018
076600*A SKU BREAK MEANS THIS IS STILL A 'DTL' REC TYP                  07660018
076700     MOVE PC-DTL-IND  TO RV027-REC-TYP.                           07670018
076800                                                                  07680018
076900*ZERO OUT THE DTL BUCKETS THAT WERE JUST WRITTEN                  07690018
077000     MOVE +0 TO PA-DTL-QTY                                        07700026
077100                PA-DTL-COST                                       07710027
077200                PA-DTL-EXT-COST                                   07720027
077300                PA-DTL-RETL                                       07730027
077400                PA-DTL-EXT-RETL.                                  07740027
077500                                                                  07750090
077600*LOAD THE CURR REC RV023 INTO THE OUTREC (NON BUCKET FIELDS)      07760079
077700     PERFORM 6500-PREP-OUTREC.                                    07770078
077800                                                                  07780018
077900*LOAD QTY & DOLLAR FIELDS FOR DTL BUCKETS                         07790018
078000     ADD   RV023-UNT-QTY        TO PA-DTL-QTY.                    07800018
078100     ADD   RV023-UNT-COST-AMT   TO PA-DTL-COST                    07810018
078200                                   PA-DTL-EXT-COST.               07820018
078300     ADD   RV023-RTL-AMT        TO PA-DTL-RETL                    07830018
078400                                   PA-DTL-EXT-RETL.               07840018
078500                                                                  07850018
078600*LOAD QTY & DOLLAR FIELDS FOR BL BUCKETS                          07860018
078700     ADD   RV023-UNT-QTY        TO PA-BL-QTY.                     07870018
078800     ADD   RV023-UNT-COST-AMT   TO PA-BL-COST                     07880018
078900                                   PA-BL-EXT-COST.                07890018
079000     ADD   RV023-RTL-AMT        TO PA-BL-RETL                     07900018
079100                                   PA-BL-EXT-RETL.                07910018
079200                                                                  07920018
079300*LOAD QTY & DOLLAR FIELDS FOR DEPT BUCKETS                        07930018
079400     ADD   RV023-UNT-QTY        TO PA-DEPT-QTY.                   07940018
079500     ADD   RV023-UNT-COST-AMT   TO PA-DEPT-COST                   07950018
079600                                   PA-DEPT-EXT-COST.              07960018
079700     ADD   RV023-RTL-AMT        TO PA-DEPT-RETL                   07970018
079800                                   PA-DEPT-EXT-RETL.              07980018
079900                                                                  07990018
080000*LOAD QTY & DOLLAR FIELDS FOR BUYER BUCKETS                       08000018
080100     ADD   RV023-UNT-QTY        TO PA-BUYER-QTY.                  08010018
080200     ADD   RV023-UNT-COST-AMT   TO PA-BUYER-COST                  08020018
080300                                   PA-BUYER-EXT-COST.             08030018
080400     ADD   RV023-RTL-AMT        TO PA-BUYER-RETL                  08040018
080500                                   PA-BUYER-EXT-RETL.             08050018
080600                                                                  08060018
080700*LOAD QTY & DOLLAR FIELDS FOR GRAND BUCKETS                       08070018
080800     ADD   RV023-UNT-QTY        TO PA-GRAND-QTY.                  08080018
080900     ADD   RV023-UNT-COST-AMT   TO PA-GRAND-COST                  08090018
081000                                   PA-GRAND-EXT-COST.             08100018
081100     ADD   RV023-RTL-AMT        TO PA-GRAND-RETL                  08110018
081200                                   PA-GRAND-EXT-RETL.             08120018
081300******************************************************************08130018
081400* THIS IS PERFORMED WHEN THE DEPT DIFFERS BETWEEN THE INPUT       08140090
081500* AND THE PREVIOUS REC (HOLD FIELDS).                             08150090
081600******************************************************************08160018
081700 5500-DEPT-BREAK.                                                 08170018
081800                                                                  08180034
081900*ZERO OUT THE OUTPUT DOLLAR FIELDS                                08190040
082000     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        08200040
082100                                                                  08210040
082200*LOAD THE SUMMED DTL VALUES TO THE REPORT DOLLAR FIELDS           08220018
082300     PERFORM 6510-PREP-OUTREC-DTL-DLRS.                           08230018
082400                                                                  08240018
082500*WRITE DETAIL                                                     08250018
082600     PERFORM 6600-WRITE-OUTREC.                                   08260018
082700                                                                  08270070
082800*INIT THE OUTREC                                                  08280018
082900     INITIALIZE RV027-INV-DTL-RPT-PREP-REC.                       08290018
083000                                                                  08300018
083100*AFTER A DEPT WRITE, SET UP FOR ANOTHER 'DTL' REC TYP             08310018
083200     MOVE PC-DTL-IND  TO RV027-REC-TYP.                           08320018
083300                                                                  08330018
083400*ZERO OUT THE DTL BUCKETS THAT WERE JUST WRITTEN                  08340018
083500     MOVE +0 TO PA-DTL-QTY                                        08350026
083600                PA-DTL-COST                                       08360027
083700                PA-DTL-EXT-COST                                   08370027
083800                PA-DTL-RETL                                       08380027
083900                PA-DTL-EXT-RETL.                                  08390027
084000                                                                  08400027
084100     MOVE +0 TO PA-DEPT-QTY                                       08410027
084200                PA-DEPT-COST                                      08420027
084300                PA-DEPT-EXT-COST                                  08430027
084400                PA-DEPT-RETL                                      08440027
084500                PA-DEPT-EXT-RETL.                                 08450027
084600                                                                  08460090
084700*LOAD THE CURR REC RV023 INTO THE OUTREC (NON BUCKET FIELDS)      08470079
084800     PERFORM 6500-PREP-OUTREC.                                    08480079
084900                                                                  08490018
085000*LOAD QTY & DOLLAR FIELDS FOR DTL BUCKETS                         08500018
085100     ADD   RV023-UNT-QTY        TO PA-DTL-QTY.                    08510018
085200     ADD   RV023-UNT-COST-AMT   TO PA-DTL-COST                    08520018
085300                                   PA-DTL-EXT-COST.               08530018
085400     ADD   RV023-RTL-AMT        TO PA-DTL-RETL                    08540018
085500                                   PA-DTL-EXT-RETL.               08550018
085600                                                                  08560018
085700*LOAD QTY & DOLLAR FIELDS FOR BL BUCKETS                          08570018
085800     ADD   RV023-UNT-QTY        TO PA-BL-QTY.                     08580018
085900     ADD   RV023-UNT-COST-AMT   TO PA-BL-COST                     08590018
086000                                   PA-BL-EXT-COST.                08600018
086100     ADD   RV023-RTL-AMT        TO PA-BL-RETL                     08610018
086200                                   PA-BL-EXT-RETL.                08620018
086300                                                                  08630018
086400*LOAD QTY & DOLLAR FIELDS FOR DEPT BUCKETS                        08640018
086500     ADD   RV023-UNT-QTY        TO PA-DEPT-QTY.                   08650018
086600     ADD   RV023-UNT-COST-AMT   TO PA-DEPT-COST                   08660018
086700                                   PA-DEPT-EXT-COST.              08670018
086800     ADD   RV023-RTL-AMT        TO PA-DEPT-RETL                   08680018
086900                                   PA-DEPT-EXT-RETL.              08690018
087000                                                                  08700018
087100*LOAD QTY & DOLLAR FIELDS FOR BUYER BUCKETS                       08710018
087200     ADD   RV023-UNT-QTY        TO PA-BUYER-QTY.                  08720018
087300     ADD   RV023-UNT-COST-AMT   TO PA-BUYER-COST                  08730018
087400                                   PA-BUYER-EXT-COST.             08740018
087500     ADD   RV023-RTL-AMT        TO PA-BUYER-RETL                  08750018
087600                                   PA-BUYER-EXT-RETL.             08760018
087700                                                                  08770018
087800*LOAD QTY & DOLLAR FIELDS FOR GRAND BUCKETS                       08780018
087900     ADD   RV023-UNT-QTY        TO PA-GRAND-QTY.                  08790018
088000     ADD   RV023-UNT-COST-AMT   TO PA-GRAND-COST                  08800018
088100                                   PA-GRAND-EXT-COST.             08810018
088200     ADD   RV023-RTL-AMT        TO PA-GRAND-RETL                  08820018
088300                                   PA-GRAND-EXT-RETL.             08830018
088400                                                                  08840018
088500******************************************************************08850018
088600* THIS IS PERFORMED WHEN THE BL DIFFERS BETWEEN THE INPUT         08860090
088700* AND THE PREVIOUS REC (HOLD FIELDS).                             08870090
088800******************************************************************08880018
088900 5600-BL-BREAK.                                                   08890018
089000                                                                  08900018
089100*ZERO OUT THE OUTPUT DOLLAR FIELDS                                08910040
089200     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        08920040
089300                                                                  08930040
089400*LOAD THE SUMMED DTL VALUES TO THE REPORT DOLLAR FIELDS           08940018
089500     PERFORM 6510-PREP-OUTREC-DTL-DLRS.                           08950018
089600                                                                  08960018
089700*WRITE DETAIL                                                     08970018
089800     PERFORM 6600-WRITE-OUTREC.                                   08980018
089900                                                                  08990018
090000*ZERO OUT ALL OUTPUT DOLLAR FIELDS                                09000045
090100     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        09010045
090200                                                                  09020045
090300*LOAD THE SUMMED BL VALUES TO THE REPORT DOLLAR FIELDS            09030018
090400     PERFORM 6520-PREP-OUTREC-BL-DLRS.                            09040018
090500                                                                  09050018
090600*LOAD THE "BL" REC TYP                                            09060018
090700     MOVE PC-BL-TOT-IND    TO RV027-REC-TYP.                      09070020
090800                                                                  09080018
090900*WRITE BL TOTAL LINE                                              09090048
091000     PERFORM 6600-WRITE-OUTREC.                                   09100018
091100                                                                  09110018
091200*INIT THE OUTREC                                                  09120018
091300     INITIALIZE RV027-INV-DTL-RPT-PREP-REC.                       09130018
091400                                                                  09140018
091500*AFTER A BL WRITE, SET UP FOR ANOTHER 'DTL' REC TYP               09150018
091600     MOVE PC-DTL-IND  TO RV027-REC-TYP.                           09160018
091700                                                                  09170018
091800*ZERO OUT THE BUCKETS THAT WERE JUST WRITTEN                      09180018
091900     MOVE +0 TO PA-DTL-QTY                                        09190026
092000                PA-DTL-COST                                       09200027
092100                PA-DTL-EXT-COST                                   09210027
092200                PA-DTL-RETL                                       09220027
092300                PA-DTL-EXT-RETL.                                  09230027
092400                                                                  09240027
092500     MOVE +0 TO PA-DEPT-QTY                                       09250026
092600                PA-DEPT-COST                                      09260027
092700                PA-DEPT-EXT-COST                                  09270027
092800                PA-DEPT-RETL                                      09280027
092900                PA-DEPT-EXT-RETL.                                 09290027
093000                                                                  09300027
093100     MOVE +0 TO PA-BL-QTY                                         09310027
093200                PA-BL-COST                                        09320027
093300                PA-BL-EXT-COST                                    09330027
093400                PA-BL-RETL                                        09340027
093500                PA-BL-EXT-RETL.                                   09350027
093600                                                                  09360027
093700*LOAD THE CURR REC RV023 INTO THE OUTREC (NON BUCKET FIELDS)      09370049
093800     PERFORM 6500-PREP-OUTREC.                                    09380049
093900                                                                  09390018
094000*LOAD QTY & DOLLAR FIELDS FOR DTL BUCKETS                         09400018
094100     ADD   RV023-UNT-QTY        TO PA-DTL-QTY.                    09410018
094200     ADD   RV023-UNT-COST-AMT   TO PA-DTL-COST                    09420018
094300                                   PA-DTL-EXT-COST.               09430018
094400     ADD   RV023-RTL-AMT        TO PA-DTL-RETL                    09440018
094500                                   PA-DTL-EXT-RETL.               09450018
094600                                                                  09460018
094700*LOAD QTY & DOLLAR FIELDS FOR BL BUCKETS                          09470018
094800     ADD   RV023-UNT-QTY        TO PA-BL-QTY.                     09480018
094900     ADD   RV023-UNT-COST-AMT   TO PA-BL-COST                     09490018
095000                                   PA-BL-EXT-COST.                09500018
095100     ADD   RV023-RTL-AMT        TO PA-BL-RETL                     09510018
095200                                   PA-BL-EXT-RETL.                09520018
095300                                                                  09530018
095400*LOAD QTY & DOLLAR FIELDS FOR DEPT BUCKETS                        09540018
095500     ADD   RV023-UNT-QTY        TO PA-DEPT-QTY.                   09550018
095600     ADD   RV023-UNT-COST-AMT   TO PA-DEPT-COST                   09560018
095700                                   PA-DEPT-EXT-COST.              09570018
095800     ADD   RV023-RTL-AMT        TO PA-DEPT-RETL                   09580018
095900                                   PA-DEPT-EXT-RETL.              09590018
096000                                                                  09600018
096100*LOAD QTY & DOLLAR FIELDS FOR BUYER BUCKETS                       09610018
096200     ADD   RV023-UNT-QTY        TO PA-BUYER-QTY.                  09620018
096300     ADD   RV023-UNT-COST-AMT   TO PA-BUYER-COST                  09630018
096400                                   PA-BUYER-EXT-COST.             09640018
096500     ADD   RV023-RTL-AMT        TO PA-BUYER-RETL                  09650018
096600                                   PA-BUYER-EXT-RETL.             09660018
096700                                                                  09670018
096800*LOAD QTY & DOLLAR FIELDS FOR GRAND BUCKETS                       09680018
096900     ADD   RV023-UNT-QTY        TO PA-GRAND-QTY.                  09690018
097000     ADD   RV023-UNT-COST-AMT   TO PA-GRAND-COST                  09700018
097100                                   PA-GRAND-EXT-COST.             09710018
097200     ADD   RV023-RTL-AMT        TO PA-GRAND-RETL                  09720018
097300                                   PA-GRAND-EXT-RETL.             09730018
097400                                                                  09740018
097500******************************************************************09750018
097600* THIS IS PERFORMED WHEN THE BUYER DIFFERS BETWEEN THE INPUT      09760090
097700* AND THE PREVIOUS REC (HOLD FIELDS).                             09770090
097800******************************************************************09780001
097900 5700-BUYER-BREAK.                                                09790001
098000                                                                  09800001
098100*ZERO OUT THE OUTPUT DOLLAR FIELDS                                09810040
098200     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        09820040
098300                                                                  09830040
098400*LOAD THE SUMMED DTL VALUES TO THE OUTPUT DOLLAR FIELDS           09840083
098500     PERFORM 6510-PREP-OUTREC-DTL-DLRS.                           09850018
098600                                                                  09860018
098700*WRITE DTL OUTREC                                                 09870083
098800     PERFORM 6600-WRITE-OUTREC.                                   09880018
098900                                                                  09890018
099000*ZERO OUT ALL OUTPUT DOLLAR FIELDS                                09900045
099100     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        09910045
099200                                                                  09920045
099300*LOAD THE SUMMED BL VALUES TO THE OUTPUT DOLLAR FIELDS            09930083
099400     PERFORM 6520-PREP-OUTREC-BL-DLRS.                            09940033
099500                                                                  09950033
099600*LOAD THE "BL" REC TYP                                            09960033
099700     MOVE PC-BL-TOT-IND    TO RV027-REC-TYP.                      09970033
099800                                                                  09980033
099900*WRITE BL OUTREC                                                  09990064
100000     PERFORM 6600-WRITE-OUTREC.                                   10000033
100100                                                                  10010033
100200*ZERO OUT ALL OUTPUT DOLLAR FIELDS                                10020047
100300     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        10030047
100400                                                                  10040082
100500*LOAD THE SUMMED DEPT VALUES TO THE REPORT DOLLAR FIELDS          10050047
100600     PERFORM 6530-PREP-OUTREC-DEPT-DLRS.                          10060047
100700                                                                  10070047
100800*LOAD THE "DEPT" REC TYP                                          10080047
100900     MOVE PC-DEPT-TOT-IND  TO RV027-REC-TYP.                      10090047
101000                                                                  10100047
101100*WRITE DEPT TOTAL LINE                                            10110052
101200     PERFORM 7500-PRINT-DEPT-TOTALS.                              10120052
101300                                                                  10130047
101400*ZERO OUT ALL OUTPUT DOLLAR FIELDS                                10140045
101500     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        10150045
101600                                                                  10160045
101700*LOAD THE SUMMED BUYER VALUES TO THE REPORT DOLLAR FIELDS         10170018
101800     PERFORM 6540-PREP-OUTREC-BUYER-DLRS.                         10180018
101900                                                                  10190018
102000*LOAD THE "BUYER" REC TYP                                         10200018
102100     MOVE PC-BUYER-TOT-IND    TO RV027-REC-TYP.                   10210020
102200                                                                  10220018
102300*WRITE BUYER OUTREC                                               10230064
102400     PERFORM 6600-WRITE-OUTREC.                                   10240018
102500                                                                  10250018
102600*INIT THE OUTREC                                                  10260018
102700     INITIALIZE RV027-INV-DTL-RPT-PREP-REC.                       10270018
102800                                                                  10280018
102900*AFTER A BUYER WRITE, SET UP FOR ANOTHER 'DTL' REC TYP            10290018
103000     MOVE PC-DTL-IND  TO RV027-REC-TYP.                           10300018
103100                                                                  10310018
103200*ZERO OUT THE BUCKETS THAT WERE JUST WRITTEN                      10320018
103300     MOVE +0 TO PA-DTL-QTY                                        10330026
103400                PA-DTL-COST                                       10340027
103500                PA-DTL-EXT-COST                                   10350027
103600                PA-DTL-RETL                                       10360027
103700                PA-DTL-EXT-RETL.                                  10370027
103800                                                                  10380018
103900     MOVE +0 TO PA-DEPT-QTY                                       10390026
104000                PA-DEPT-COST                                      10400027
104100                PA-DEPT-EXT-COST                                  10410027
104200                PA-DEPT-RETL                                      10420027
104300                PA-DEPT-EXT-RETL.                                 10430027
104400                                                                  10440027
104500     MOVE +0 TO PA-BL-QTY                                         10450026
104600                PA-BL-COST                                        10460027
104700                PA-BL-EXT-COST                                    10470027
104800                PA-BL-RETL                                        10480027
104900                PA-BL-EXT-RETL.                                   10490027
105000                                                                  10500027
105100     MOVE +0 TO PA-BUYER-QTY                                      10510026
105200                PA-BUYER-COST                                     10520027
105300                PA-BUYER-EXT-COST                                 10530027
105400                PA-BUYER-RETL                                     10540027
105500                PA-BUYER-EXT-RETL.                                10550027
105600                                                                  10560027
105700*LOAD THE CURR REC RV023 INTO THE OUTREC (NON BUCKET FIELDS)      10570046
105800     PERFORM 6500-PREP-OUTREC.                                    10580046
105900                                                                  10590018
106000*LOAD QTY & DOLLAR FIELDS FOR DTL BUCKETS                         10600018
106100     ADD   RV023-UNT-QTY        TO PA-DTL-QTY.                    10610018
106200     ADD   RV023-UNT-COST-AMT   TO PA-DTL-COST                    10620018
106300                                   PA-DTL-EXT-COST.               10630018
106400     ADD   RV023-RTL-AMT        TO PA-DTL-RETL                    10640018
106500                                   PA-DTL-EXT-RETL.               10650018
106600                                                                  10660018
106700*LOAD QTY & DOLLAR FIELDS FOR BL BUCKETS                          10670018
106800     ADD   RV023-UNT-QTY        TO PA-BL-QTY.                     10680018
106900     ADD   RV023-UNT-COST-AMT   TO PA-BL-COST                     10690018
107000                                   PA-BL-EXT-COST.                10700018
107100     ADD   RV023-RTL-AMT        TO PA-BL-RETL                     10710018
107200                                   PA-BL-EXT-RETL.                10720018
107300                                                                  10730018
107400*LOAD QTY & DOLLAR FIELDS FOR DEPT BUCKETS                        10740018
107500     ADD   RV023-UNT-QTY        TO PA-DEPT-QTY.                   10750018
107600     ADD   RV023-UNT-COST-AMT   TO PA-DEPT-COST                   10760018
107700                                   PA-DEPT-EXT-COST.              10770018
107800     ADD   RV023-RTL-AMT        TO PA-DEPT-RETL                   10780018
107900                                   PA-DEPT-EXT-RETL.              10790018
108000                                                                  10800018
108100*LOAD QTY & DOLLAR FIELDS FOR BUYER BUCKETS                       10810018
108200     ADD   RV023-UNT-QTY        TO PA-BUYER-QTY.                  10820018
108300     ADD   RV023-UNT-COST-AMT   TO PA-BUYER-COST                  10830018
108400                                   PA-BUYER-EXT-COST.             10840018
108500     ADD   RV023-RTL-AMT        TO PA-BUYER-RETL                  10850018
108600                                   PA-BUYER-EXT-RETL.             10860018
108700                                                                  10870018
108800*LOAD QTY & DOLLAR FIELDS FOR GRAND BUCKETS                       10880018
108900     ADD   RV023-UNT-QTY        TO PA-GRAND-QTY.                  10890018
109000     ADD   RV023-UNT-COST-AMT   TO PA-GRAND-COST                  10900018
109100                                   PA-GRAND-EXT-COST.             10910018
109200     ADD   RV023-RTL-AMT        TO PA-GRAND-RETL                  10920018
109300                                   PA-GRAND-EXT-RETL.             10930018
109400                                                                  10940018
109500******************************************************************10950000
109600*  THIS PARAGRAPH IS PERFORMED FOR EVERY INPUT RECORD READ. IT    10960090
109700*  ACCUMULATES TOTALS FOR EACH DEPARTMENT ENCOUNTERED FOR EACH    10970090
109800*  BUYER. AFTER A BUYER BREAK, THE DEPARTMENT LINES ARE           10980091
109900*  WRITTEN TO THE OUTPUT REC AND THE TABLE IS INITIALIZED.        10990090
110000******************************************************************11000000
110100 6300-ACCUM-DEPT-TOTALS.                                          11010004
110200                                                                  11020056
110300** MULTIPLE RECS FOR THE SAME DEPT                                11030090
110400      IF PV-ACCUM-DEPT-NBR = DT-DEPT-NBR(DT-IDX)                  11040059
110500         IF PA-DTL-QTY > 1                                        11050053
110600            CONTINUE                                              11060051
110700         ELSE                                                     11070051
110800            ADD RV023-UNT-COST-AMT  TO DT-UNIT-COST-DEPT-TOTAL    11080051
110900                                          (DT-IDX)                11090051
111000            ADD RV023-RTL-AMT       TO DT-RETL-COST-DEPT-TOTAL    11100051
111100                                          (DT-IDX)                11110051
111200         END-IF                                                   11120051
111300          ADD RV023-UNT-COST-AMT   TO DT-UNIT-EXT-COST-DEPT-TOTAL 11130051
111400                                          (DT-IDX)                11140051
111500          ADD RV023-RTL-AMT        TO DT-RETL-EXT-COST-DEPT-TOTAL 11150051
111600                                          (DT-IDX)                11160051
111700          ADD +1                       TO DT-QTY-DEPT-TOTAL       11170051
111800                                          (DT-IDX)                11180051
111900      ELSE                                                        11190051
112000*** IF IDX IS NOT ALREADY ON THE DEPT...                          11200001
112100          SET DT-IDX                   TO +1                      11210051
112200          PERFORM UNTIL                                           11220051
112300              ( DT-DEPT-NBR(DT-IDX) = PV-ACCUM-DEPT-NBR )         11230059
112400           OR ( DT-DEPT-NBR(DT-IDX) = '   '            )          11240051
112500           OR ( DT-IDX > DT-MAX-DEPTS                  )          11250051
112600              SET DT-IDX               UP BY +1                   11260051
112700          END-PERFORM                                             11270051
112800                                                                  11280051
112900          IF PV-ACCUM-DEPT-NBR = DT-DEPT-NBR(DT-IDX)              11290059
113000             IF PA-DTL-QTY > 1                                    11300053
113100                CONTINUE                                          11310051
113200             ELSE                                                 11320051
113300                ADD RV023-UNT-COST-AMT  TO DT-UNIT-COST-DEPT-TOTAL11330051
113400                                              (DT-IDX)            11340051
113500                ADD RV023-RTL-AMT       TO DT-RETL-COST-DEPT-TOTAL11350051
113600                                              (DT-IDX)            11360051
113700             END-IF                                               11370051
113800             ADD RV023-UNT-COST-AMT TO DT-UNIT-EXT-COST-DEPT-TOTAL11380051
113900                                           (DT-IDX)               11390051
114000             ADD RV023-RTL-AMT      TO DT-RETL-EXT-COST-DEPT-TOTAL11400051
114100                                          (DT-IDX)                11410051
114200             ADD +1                    TO DT-QTY-DEPT-TOTAL       11420051
114300                                          (DT-IDX)                11430051
114400          ELSE                                                    11440051
114500             IF DT-DEPT-NBR(DT-IDX) = '   '                       11450051
114600                                                                  11460051
114700                 MOVE PV-ACCUM-DEPT-NBR TO DT-DEPT-NBR(DT-IDX)    11470059
114800                 MOVE RV023-UNT-COST-AMT                          11480051
114900                                       TO DT-UNIT-COST-DEPT-TOTAL 11490051
115000                                          (DT-IDX)                11500051
115100                                   DT-UNIT-EXT-COST-DEPT-TOTAL    11510051
115200                                       (DT-IDX)                   11520051
115300                 MOVE RV023-RTL-AMT TO DT-RETL-COST-DEPT-TOTAL    11530051
115400                                          (DT-IDX)                11540051
115500                                    DT-RETL-EXT-COST-DEPT-TOTAL   11550051
115600                                        (DT-IDX)                  11560051
115700                 MOVE +1               TO DT-QTY-DEPT-TOTAL       11570051
115800                                          (DT-IDX)                11580051
115900             ELSE                                                 11590051
116000                IF DT-IDX > DT-MAX-DEPTS                          11600051
116100                   DISPLAY '** ABEND **'                          11610051
116200                   DISPLAY '** PROGRAM = RVKUT029 **'             11620065
116300                   DISPLAY                                        11630051
116400                   '** PARAGRAPH = 6300-ACCUM-DEPT-TOTALS     **' 11640051
116500                   DISPLAY                                        11650051
116600                   '** TABLE OVERFLOW ERROR SEARCHING DEPT TOTALS'11660051
116700                   DISPLAY '** DEPARTMENT NUMBER = '              11670051
116800                           PV-ACCUM-DEPT-NBR ' **'                11680059
116900                   MOVE +4004 TO ABEND-CODE                       11690051
117000                   CALL 'ILBOABN0' USING ABEND-CODE               11700051
117100                END-IF                                            11710051
117200             END-IF                                               11720051
117300          END-IF                                                  11730051
117400      END-IF.                                                     11740051
117500                                                                  11750051
117600******************************************************************11760001
117700*                                                                 11770001
117800******************************************************************11780001
117900 6500-PREP-OUTREC.                                                11790001
118000                                                                  11800001
118100     MOVE RV023-BL-NBR           TO RV027-BL-NBR.                 11810001
118200     MOVE RV023-BL-STATUS        TO RV027-BL-STATUS.              11820001
118300     MOVE RV023-SKU              TO RV027-SKU.                    11830001
118400     MOVE RV023-DEPT-NBR         TO RV027-DEPT-NBR.               11840001
118500     MOVE RV023-SUB-CL-NBR       TO RV027-SUB-CL-NBR.             11850001
118600     MOVE RV023-RETURN-TYPE      TO RV027-RETURN-TYPE.            11860001
118700     MOVE RV023-UNT-COST-AMT     TO RV027-UNT-COST-AMT.           11870001
118800     MOVE RV023-RTL-AMT          TO RV027-RTL-AMT.                11880001
118900     MOVE RV023-UNT-QTY          TO RV027-UNT-QTY.                11890001
119000     MOVE RV023-SCN-DATE         TO RV027-SCN-DATE.               11900001
119100     MOVE RV023-LOC-ID           TO RV027-LOC-ID.                 11910001
119200     MOVE RV023-DISP             TO RV027-DISP.                   11920001
119300     MOVE RV023-PUT-AWAY-DATE    TO RV027-PUT-AWAY-DATE.          11930001
119400     MOVE RV023-TRNS-NBR-STR     TO RV027-TRNS-NBR-STR.           11940001
119500     MOVE RV023-TRNS-NBR         TO RV027-TRNS-NBR.               11950001
119600     MOVE RV023-RTV-LOC          TO RV027-RTV-LOC.                11960001
119700     MOVE RV023-BUYER-NBR        TO RV027-BUYER-NBR.              11970001
119800     MOVE RV023-BUYER-NAME       TO RV027-BUYER-NAME.             11980001
119900                                                                  11990001
120000******************************************************************12000034
120100* LOAD THE ACCUM BUCKETS TO THE OUTPUT COPYBOOK FIELDS THAT       12010089
120200* WILL HOLD THE DETAIL VALUES: RV027-DTL-TOTALS.                  12020089
120300******************************************************************12030018
120400 6510-PREP-OUTREC-DTL-DLRS.                                       12040018
120500                                                                  12050018
120600     MOVE PA-DTL-QTY             TO RV027-DTL-UNT-QTY.            12060018
120700     MOVE PA-DTL-COST            TO RV027-DTL-UNT-COST-AMT.       12070018
120800     MOVE PA-DTL-EXT-COST        TO RV027-DTL-EXT-UNT-COST-AMT.   12080018
120900     MOVE PA-DTL-RETL            TO RV027-DTL-RTL-COST-AMT.       12090018
121000     MOVE PA-DTL-EXT-RETL        TO RV027-DTL-EXT-RTL-COST-AMT.   12100018
121100                                                                  12110018
121200******************************************************************12120018
121300* LOAD THE ACCUM BUCKETS TO THE OUTPUT COPYBOOK FIELDS THAT       12130089
121400* WILL HOLD THE BL VALUES: RV027-BL-TOTALS.                       12140089
121500******************************************************************12150018
121600 6520-PREP-OUTREC-BL-DLRS.                                        12160018
121700                                                                  12170018
121800     MOVE PA-BL-QTY              TO RV027-BL-UNT-QTY.             12180018
121900     MOVE PA-BL-COST             TO RV027-BL-UNT-COST-AMT.        12190018
122000     MOVE PA-BL-EXT-COST         TO RV027-BL-EXT-UNT-COST-AMT.    12200018
122100     MOVE PA-BL-RETL             TO RV027-BL-RTL-COST-AMT.        12210018
122200     MOVE PA-BL-EXT-RETL         TO RV027-BL-EXT-RTL-COST-AMT.    12220018
122300                                                                  12230018
122400******************************************************************12240018
122500* LOAD THE ACCUM BUCKETS TO THE OUTPUT COPYBOOK FIELDS THAT       12250089
122600* WILL HOLD THE DEPT VALUES: RV027-DEPT-TOTALS.                   12260089
122700******************************************************************12270018
122800 6530-PREP-OUTREC-DEPT-DLRS.                                      12280018
122900                                                                  12290018
123000     MOVE PA-DEPT-QTY            TO RV027-DEPT-UNT-QTY.           12300018
123100     MOVE PA-DEPT-COST           TO RV027-DEPT-UNT-COST-AMT.      12310018
123200     MOVE PA-DEPT-EXT-COST       TO RV027-DEPT-EXT-UNT-COST-AMT.  12320018
123300     MOVE PA-DEPT-RETL           TO RV027-DEPT-RTL-COST-AMT.      12330018
123400     MOVE PA-DEPT-EXT-RETL       TO RV027-DEPT-EXT-RTL-COST-AMT.  12340018
123500                                                                  12350018
123600******************************************************************12360018
123700* LOAD THE ACCUM BUCKETS TO THE OUTPUT COPYBOOK FIELDS THAT       12370089
123800* WILL HOLD THE BUYER VALUES: RV027-BUYER-TOTALS.                 12380089
123900******************************************************************12390018
124000 6540-PREP-OUTREC-BUYER-DLRS.                                     12400018
124100                                                                  12410018
124200     MOVE PA-BUYER-QTY           TO RV027-BUYER-UNT-QTY.          12420018
124300     MOVE PA-BUYER-COST          TO RV027-BUYER-UNT-COST-AMT.     12430018
124400     MOVE PA-BUYER-EXT-COST      TO RV027-BUYER-EXT-UNT-COST-AMT. 12440018
124500     MOVE PA-BUYER-RETL          TO RV027-BUYER-RTL-COST-AMT.     12450018
124600     MOVE PA-BUYER-EXT-RETL      TO RV027-BUYER-EXT-RTL-COST-AMT. 12460018
124700                                                                  12470018
124800******************************************************************12480018
124900* LOAD THE ACCUM BUCKETS TO THE OUTPUT COPYBOOK FIELDS THAT       12490089
125000* WILL HOLD THE GRAND VALUES: RV027-GRAND-TOTALS.                 12500089
125100******************************************************************12510018
125200 6550-PREP-OUTREC-GRAND-DLRS.                                     12520018
125300                                                                  12530018
125400     MOVE PA-GRAND-QTY           TO RV027-GRAND-UNT-QTY.          12540018
125500     MOVE PA-GRAND-COST          TO RV027-GRAND-UNT-COST-AMT.     12550018
125600     MOVE PA-GRAND-EXT-COST      TO RV027-GRAND-EXT-UNT-COST-AMT. 12560018
125700     MOVE PA-GRAND-RETL          TO RV027-GRAND-RTL-COST-AMT.     12570018
125800     MOVE PA-GRAND-EXT-RETL      TO RV027-GRAND-EXT-RTL-COST-AMT. 12580018
125900                                                                  12590018
126000******************************************************************12600018
126100*                                                                 12610001
126200******************************************************************12620001
126300 6600-WRITE-OUTREC.                                               12630001
126400                                                                  12640001
126500     WRITE OUTPUT-RECORD                                          12650001
126600      FROM RV027-INV-DTL-RPT-PREP-REC.                            12660001
126700                                                                  12670001
126800     ADD 1 TO PA-TOT-RECS-WRIT.                                   12680001
126900                                                                  12690001
127000     EVALUATE RV027-REC-TYP                                       12700001
127100        WHEN PC-DTL-IND                                           12710001
127200             ADD 1 TO PA-TOT-DTL-RECS-WRIT                        12720001
127300        WHEN PC-BL-TOT-IND                                        12730001
127400             ADD 1 TO PA-TOT-BL-TOTAL-RECS-WRIT                   12740001
127500        WHEN PC-DEPT-TOT-IND                                      12750001
127600             ADD 1 TO PA-TOT-DEPT-TOTAL-RECS-WRIT                 12760001
127700        WHEN PC-BUYER-TOT-IND                                     12770001
127800             ADD 1 TO PA-TOT-BUYER-TOTAL-RECS-WRIT                12780001
127900        WHEN PC-GRAND-TOT-IND                                     12790001
128000             ADD 1 TO PA-TOT-GRAND-TOTAL-RECS-WRIT                12800001
128100     END-EVALUATE.                                                12810001
128200                                                                  12820001
128300                                                                  12830001
128400******************************************************************12840034
128500*ZERO ALL THE BUCKETS - EXCEPT GRAND TOTAL BUCKETS                12850034
128600******************************************************************12860034
128700 6800-ZERO-OUT-ALL-BUCKETS.                                       12870034
128800                                                                  12880034
128900     MOVE +0 TO PA-DTL-QTY                                        12890034
129000                PA-DTL-COST                                       12900034
129100                PA-DTL-EXT-COST                                   12910034
129200                PA-DTL-RETL                                       12920034
129300                PA-DTL-EXT-RETL.                                  12930034
129400                                                                  12940034
129500     MOVE +0 TO PA-DEPT-QTY                                       12950034
129600                PA-DEPT-COST                                      12960034
129700                PA-DEPT-EXT-COST                                  12970034
129800                PA-DEPT-RETL                                      12980034
129900                PA-DEPT-EXT-RETL.                                 12990034
130000                                                                  13000034
130100     MOVE +0 TO PA-BL-QTY                                         13010034
130200                PA-BL-COST                                        13020034
130300                PA-BL-EXT-COST                                    13030034
130400                PA-BL-RETL                                        13040034
130500                PA-BL-EXT-RETL.                                   13050034
130600                                                                  13060034
130700     MOVE +0 TO PA-BUYER-QTY                                      13070034
130800                PA-BUYER-COST                                     13080034
130900                PA-BUYER-EXT-COST                                 13090034
131000                PA-BUYER-RETL                                     13100034
131100                PA-BUYER-EXT-RETL.                                13110034
131200                                                                  13120040
131300******************************************************************13130040
131400*ZERO ALL THE OUTPUT DOLLAR FIELDS                                13140040
131500******************************************************************13150040
131600 6900-ZERO-OUT-ALL-DLR-FIELDS.                                    13160040
131700                                                                  13170040
131800                                                                  13180040
131900     MOVE +0 TO RV027-DTL-UNT-QTY                                 13190041
132000                RV027-DTL-UNT-COST-AMT                            13200041
132100                RV027-DTL-EXT-UNT-COST-AMT                        13210041
132200                RV027-DTL-RTL-COST-AMT                            13220041
132300                RV027-DTL-EXT-RTL-COST-AMT                        13230041
132400                RV027-BL-UNT-QTY                                  13240041
132500                RV027-BL-UNT-COST-AMT                             13250041
132600                RV027-BL-EXT-UNT-COST-AMT                         13260041
132700                RV027-BL-RTL-COST-AMT                             13270041
132800                RV027-BL-EXT-RTL-COST-AMT                         13280041
132900                RV027-DEPT-UNT-QTY                                13290041
133000                RV027-DEPT-UNT-COST-AMT                           13300041
133100                RV027-DEPT-EXT-UNT-COST-AMT                       13310041
133200                RV027-DEPT-RTL-COST-AMT                           13320041
133300                RV027-DEPT-EXT-RTL-COST-AMT                       13330041
133400                RV027-BUYER-UNT-QTY                               13340041
133500                RV027-BUYER-UNT-COST-AMT                          13350041
133600                RV027-BUYER-EXT-UNT-COST-AMT                      13360041
133700                RV027-BUYER-RTL-COST-AMT                          13370041
133800                RV027-BUYER-EXT-RTL-COST-AMT.                     13380040
133900                                                                  13390040
134000                                                                  13400040
134100******************************************************************13410001
134200*                                                                 13420018
134300******************************************************************13430000
134400 7000-READ-INPUT.                                                 13440000
134500                                                                  13450001
134600     READ INPUT-FILE INTO RV023-INVENTORY-RECORD                  13460001
134700          AT END SET PS-EOF TO TRUE                               13470000
134800          NOT AT END ADD 1 TO PA-TOT-RECS-READ                    13480001
134900     END-READ.                                                    13490000
135000                                                                  13500000
135100*THE HDR INFO FOR RV027 IS LOADED FROM THE PREV (HOLD), FOR       13510034
135200*ALL RECS WRITTEN OUT EXCEPT THE LAST WHICH WOULD USE THE CURRENT 13520034
135300*REC SO THIS IS TO BE SURE THE LAST RECORD GETS THE RIGHT INFO    13530034
135400     IF PS-EOF                                                    13540034
135500        PERFORM 7100-MOVE-TO-HOLD                                 13550034
135600     END-IF.                                                      13560034
135700                                                                  13570034
135800******************************************************************13580003
135900*                                                                 13590018
136000******************************************************************13600003
136100 7100-MOVE-TO-HOLD.                                               13610003
136200                                                                  13620003
136300     MOVE RV023-BL-NBR            TO PV-HOLD-BL-NBR.              13630039
136400     MOVE RV023-BL-STATUS         TO PV-HOLD-BL-STATUS.           13640034
136500     MOVE RV023-SKU               TO PV-HOLD-SKU.                 13650034
136600     MOVE RV023-DEPT-NBR          TO PV-HOLD-DEPT-NBR.            13660034
136700     MOVE RV023-SUB-CL-NBR        TO PV-HOLD-SUB-CL-NBR.          13670034
136800     MOVE RV023-RETURN-TYPE       TO PV-HOLD-RETURN-TYPE.         13680034
136900     MOVE RV023-UNT-COST-AMT      TO PV-HOLD-COST.                13690034
137000     MOVE RV023-RTL-AMT           TO PV-HOLD-RETL.                13700034
137100     MOVE RV023-UNT-QTY           TO PV-HOLD-UNT-QTY.             13710036
137200     MOVE RV023-SCN-DATE          TO PV-HOLD-SCAN-DTE.            13720034
137300     MOVE RV023-LOC-ID            TO PV-HOLD-LOC-ID.              13730034
137400     MOVE RV023-DISP              TO PV-HOLD-DISP.                13740034
137500     MOVE RV023-PUT-AWAY-DATE     TO PV-HOLD-PUT-AWAY-DATE.       13750034
137600     MOVE RV023-TRNS-NBR-STR      TO PV-HOLD-TRNS-NBR-STR.        13760034
137700     MOVE RV023-TRNS-NBR          TO PV-HOLD-TRNS-NBR.            13770034
137800     MOVE RV023-RTV-LOC           TO PV-HOLD-RTV-LOC.             13780034
137900     MOVE RV023-BUYER-NBR         TO PV-HOLD-BUYER-NBR.           13790034
138000     MOVE RV023-BUYER-NAME        TO PV-HOLD-BUYER-NAME.          13800034
138100                                                                  13810034
138200******************************************************************13820052
138300* 7500-PRINT-DEPT-TOTALS.                                         13830052
138400* PROCESS:  THIS PARAGRAPH WILL PRINT THE DEPARTMENT TOTALS FROM  13840052
138500*  THE DEPARTMENT TOTALS WORKING STORAGE TABLE.  IT GOES THROUGH  13850052
138600*  TWO "PERFORMS" SO THAT THE TOTALS WILL BE PRINTED IN DEPARTMENT13860052
138700*  ORDER.  THE IF STATMENT WILL CHECK IF THE DEPT IS LESS THAN    13870052
138800* PV-CURR-DEPT (THE CURRENT "HIGH" DEPT) AND GREATER THAN         13880060
138900* PV-PREV-DEPT (THE PREVIOUS DEPT PRINTED).  THAT WILL SELECT     13890052
139000* THE NEXT DEPT TO PRINT.                                         13900052
139100******************************************************************13910052
139200 7500-PRINT-DEPT-TOTALS.                                          13920052
139300     SET PS-DEPT-PRINT-START          TO TRUE.                    13930052
139400                                                                  13940052
139500     MOVE '999'                       TO PV-CURR-DEPT.            13950060
139600     MOVE '   '                       TO PV-PREV-DEPT.            13960052
139700                                                                  13970052
139800     PERFORM UNTIL PS-DEPT-PRINT-END                              13980052
139900         SET PS-NO-DEPT-PRINTED       TO TRUE                     13990052
140000         PERFORM                                                  14000052
140100         VARYING DT-IDX FROM 1 BY 1                               14010052
140200         UNTIL DT-IDX > DT-MAX-DEPTS                              14020052
140300         OR    DT-DEPT-NBR(DT-IDX) = '   '                        14030052
140400                                                                  14040052
140500             IF  DT-DEPT-NBR(DT-IDX) < PV-CURR-DEPT               14050060
140600             AND DT-DEPT-NBR(DT-IDX) > PV-PREV-DEPT               14060052
140700                 MOVE DT-DEPT-NBR (DT-IDX)                        14070052
140800                                      TO PV-CURR-DEPT             14080060
140900                                         RV027-DEPT-NBR           14090062
141000                 MOVE DT-UNIT-COST-DEPT-TOTAL(DT-IDX)             14100052
141100                                  TO RV027-DEPT-UNT-COST-AMT      14110052
141200                                                                  14120052
141300                 MOVE DT-UNIT-EXT-COST-DEPT-TOTAL(DT-IDX)         14130052
141400                                  TO RV027-DEPT-EXT-UNT-COST-AMT  14140052
141500                                                                  14150052
141600                 MOVE DT-RETL-COST-DEPT-TOTAL(DT-IDX)             14160052
141700                                  TO RV027-DEPT-RTL-COST-AMT      14170052
141800                                                                  14180052
141900                 MOVE DT-RETL-EXT-COST-DEPT-TOTAL(DT-IDX)         14190052
142000                                  TO RV027-DEPT-EXT-RTL-COST-AMT  14200054
142100                                                                  14210052
142200                 MOVE DT-QTY-DEPT-TOTAL(DT-IDX)                   14220052
142300                                      TO RV027-DEPT-UNT-QTY       14230052
142400                                                                  14240052
142500                 SET PS-DEPT-PRINTED  TO TRUE                     14250052
142600             END-IF                                               14260052
142700         END-PERFORM                                              14270052
142800                                                                  14280052
142900         IF PS-DEPT-PRINTED                                       14290052
143000                                                                  14300061
143100             PERFORM 6600-WRITE-OUTREC                            14310053
143200                                                                  14320052
143300             MOVE PV-CURR-DEPT        TO PV-PREV-DEPT             14330060
143400             MOVE '999'               TO PV-CURR-DEPT             14340060
143500         ELSE                                                     14350052
143600             SET PS-DEPT-PRINT-END    TO TRUE                     14360052
143700         END-IF                                                   14370052
143800                                                                  14380052
143900     END-PERFORM.                                                 14390052
144000                                                                  14400052
144100     INITIALIZE DT-DEPT-TOTAL-TABLE.                              14410052
144200                                                                  14420052
144300******************************************************************14430000
144400*                                                                 14440018
144500*                                                                 14450018
144600******************************************************************14460000
144700 8000-EOJ-ROUTINE.                                                14470029
144800                                                                  14480031
144900*EOF, SO WRITE LAST BL, DEPT, BUYER & GRAND TOTAL LINES           14490031
145000     PERFORM 8500-WRITE-LAST-RECS.                                14500031
145100                                                                  14510003
145200     DISPLAY '*******************************************'.       14520020
145300     DISPLAY '**       RVKUT029 SUMMARY STATISTICS      *'.       14530020
145400     DISPLAY '*******************************************'.       14540020
145500     DISPLAY 'TOT RECS READ...........:' PA-TOT-RECS-READ.        14550020
145600     DISPLAY 'TOT DTL RECS WRITTEN....:' PA-TOT-DTL-RECS-WRIT.    14560084
145700     DISPLAY 'TOT BL RECS WRITTEN.....:'                          14570084
145800                                     PA-TOT-BL-TOTAL-RECS-WRIT.   14580020
145900     DISPLAY 'TOT DEPT RECS WRITTEN...:'                          14590084
146000                                     PA-TOT-DEPT-TOTAL-RECS-WRIT. 14600020
146100     DISPLAY 'TOT BUYER RECS WRITTEN..:'                          14610084
146200                                     PA-TOT-BUYER-TOTAL-RECS-WRIT.14620020
146300     DISPLAY 'TOT GRAND RECS WRITTEN..:'                          14630084
146400                                     PA-TOT-GRAND-TOTAL-RECS-WRIT.14640020
146500     DISPLAY 'TOT RECS WRITTEN........:' PA-TOT-RECS-WRIT.        14650084
146600     DISPLAY '*******************************************'.       14660020
146700                                                                  14670020
146800     CLOSE INPUT-FILE                                             14680003
146900           OUTPUT-FILE.                                           14690003
147000                                                                  14700000
147100******************************************************************14710030
147200*                                                                 14720030
147300******************************************************************14730030
147400 8500-WRITE-LAST-RECS.                                            14740030
147500                                                                  14750030
147600*ZERO OUT ALL OUTPUT DOLLAR FIELDS                                14760042
147700     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        14770042
147800                                                                  14780042
147900*LOAD THE SUMMED DTL VALUES TO THE REPORT DOLLAR FIELDS           14790030
148000     PERFORM 6510-PREP-OUTREC-DTL-DLRS.                           14800030
148100                                                                  14810030
148200*WRITE DETAIL                                                     14820030
148300     PERFORM 6600-WRITE-OUTREC.                                   14830030
148400                                                                  14840030
148500*ZERO OUT ALL OUTPUT DOLLAR FIELDS                                14850044
148600     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        14860044
148700                                                                  14870044
148800*LOAD THE SUMMED BL VALUES TO THE REPORT DOLLAR FIELDS            14880030
148900     PERFORM 6520-PREP-OUTREC-BL-DLRS.                            14890030
149000                                                                  14900030
149100*LOAD THE "BL" REC TYP                                            14910030
149200     MOVE PC-BL-TOT-IND    TO RV027-REC-TYP.                      14920030
149300                                                                  14930030
149400*WRITE DEPT TOTAL LINE                                            14940030
149500     PERFORM 6600-WRITE-OUTREC.                                   14950030
149600                                                                  14960030
149700*ZERO OUT ALL OUTPUT DOLLAR FIELDS                                14970044
149800     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        14980044
149900                                                                  14990044
150000*WRITE DEPT TOTAL LINE                                            15000052
150100     PERFORM 7500-PRINT-DEPT-TOTALS.                              15010052
150200                                                                  15020030
150300*ZERO OUT ALL OUTPUT DOLLAR FIELDS                                15030044
150400     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        15040044
150500                                                                  15050044
150600*LOAD THE SUMMED BUYER VALUES TO THE REPORT DOLLAR FIELDS         15060030
150700     PERFORM 6540-PREP-OUTREC-BUYER-DLRS.                         15070030
150800                                                                  15080030
150900*LOAD THE "BUYER" REC TYP                                         15090030
151000     MOVE PC-BUYER-TOT-IND    TO RV027-REC-TYP.                   15100030
151100                                                                  15110030
151200*WRITE DEPT TOTAL LINE                                            15120030
151300     PERFORM 6600-WRITE-OUTREC.                                   15130030
151400                                                                  15140030
151500*ZERO OUT ALL OUTPUT DOLLAR FIELDS                                15150044
151600     PERFORM 6900-ZERO-OUT-ALL-DLR-FIELDS.                        15160044
151700                                                                  15170044
151800*LOAD THE SUMMED GRAND TOTAL VALUES TO THE REPORT DOLLAR FIELDS   15180030
151900     PERFORM 6550-PREP-OUTREC-GRAND-DLRS.                         15190030
152000                                                                  15200030
152100*LOAD THE "GRAND" REC TYP                                         15210030
152200     MOVE PC-GRAND-TOT-IND    TO RV027-REC-TYP.                   15220030
152300                                                                  15230030
152400*WRITE DEPT TOTAL LINE                                            15240030
152500     PERFORM 6600-WRITE-OUTREC.                                   15250030
152600                                                                  15260030
152700*INIT THE OUTREC                                                  15270030
152800     INITIALIZE RV027-INV-DTL-RPT-PREP-REC.                       15280030
152900                                                                  15290030
153000******************************************************************15300000
153100* 9100-FIELD-OVERFLOW-ERROR - IF ON OF THE ACCUMULATOR FIELDS    *15310000
153200* ROLLS OVER (IE THE NUMBER IS TOO BIG TO FIT) THIS PARAGRAPH    *15320000
153300* WILL ABEND THE PROGRAM                                         *15330000
153400******************************************************************15340000
153500 9100-FIELD-OVERFLOW-ERROR.                                       15350000
153600     DISPLAY '** ABEND     **'.                                   15360000
153700     DISPLAY '** PROGRAM   ** = RVKUT029'.                        15370065
153800     DISPLAY '** PROGRAM ACCUMULATOR OVERFLOW ERROR **'.          15380000
153900     DISPLAY '** THE DATA CREATES A TOTALS VALUE LARGER THAN '.   15390000
154000     DISPLAY '** THE FIELD SET-UP TO HANDLE IT.  INCREASE THE'.   15400000
154100     DISPLAY '** FOLLOWING FIELD WHICH WAS TOO SMALL: '.          15410000
154200     DISPLAY PV-FIELD-NAME.                                       15420000
154300                                                                  15430000
154400     MOVE +4004 TO ABEND-CODE.                                    15440000
154500     CALL 'ILBOABN0' USING ABEND-CODE.                            15450000
154600                                                                  15460000
154700******************************************************************15470000
154800* 9999-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE *    15480000
154900* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS. *               15490000
155000******************************************************************15500000
155100 9999-SQL-ABEND.                                                  15510000
155200     DISPLAY '** ABEND     **'.                                   15520000
155300     DISPLAY '** PROGRAM   ** = RVKUT029'.                        15530065
155400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              15540000
155500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     15550000
155600                                                                  15560000
155700******************************************************************15570000
155800* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *15580000
155900* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *15590000
156000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *15600000
156100* FORMAT.                                                        *15610000
156200******************************************************************15620000
156300     COPY DPPD004.                                                15630000
156400                                                                  15640000
156500     MOVE +4013 TO ABEND-CODE.                                    15650000
156600     CALL 'ILBOABN0' USING ABEND-CODE.                            15660000
156700****************************  END OF RVKUT029 ********************15670065
