      ******************************************************************00010060
      *   CHECK TO SEE IF THIS TRANSACTION WAS TRIGGERED BY THE MQ      00020060
      *   LISTENER.  IF SO, WRITE MESSAGE TO REMOTE QUEUE INSTEAD OF    00030060
      *   TEMPORARY STORAGE QUEUE.                                      00040049
      ******************************************************************00050060
       IDENTIFICATION DIVISION.                                         00060060
      ******************************************************************00070060
                                                                        00080060
       PROGRAM-ID.       TFKCS412.                                      00090060
       AUTHOR.           WILLIAM B. BURT.                               00100060
       INSTALLATION.     KOHLS.                                         00110060
       DATE-WRITTEN      AUGUST, 1996.                                  00120060
       DATE-COMPILED.                                                   00130060
                                                                        00140060
      ******************************************************************00150060
      * THIS PROGRAM RECEIVES FROM AND SENDS DATA STREAMS TO A TELXON   00160060
      * PORTABLE TELE-TRANSACTION COMPUTER (PTC).  THE RECEIVED DATA    00170060
      * IS A REQUEST FOR INFORMATION REGARDING A TRANSFER ITEM.  THE    00180060
      * TRANSMIT DATA IS THE RESPONSE TO THAT REQUEST.                  00190060
      ******************************************************************00200060
      *  DATE 01/15/01                                                  00210060
      *  ADD CODE FOR 2ND LISTNER                                       00220060
      *  MADE BY: STEVEN NOWAK            WR/IR #:                      00230060
      ******************************************************************00240060
      *  1/20/2003 - RAY GRAF                                           00241060
      *   PROCESS NONINTELLIGENT SKU.                                   00242060
      ******************************************************************00243060
      * 11/28/2003 - DAVE WELLER          WR/IR #: 25501                00244064
      *   MOS AND RTV DEF/DAMAGE TRANSFERS                              00245064
      ******************************************************************00246064
102704* 10/27/2004 - DAVE WELLER          WR/IR #: 72349                00247064
102704*   STORE EXPANSION                                               00248064
102704******************************************************************00249064
PB5756*  DATE:10/13/2010 CHANGED BY: COGNIZANT     PBI5756              00249176
PB5756*  MODIFIED PROGRAM TO HANDLE ROW NOT FOUND (SQLCODE = 100)       00249276
PB5756*  CONDITION IN SQL OPERATIONS WITHOUT ABENDING.                  00249376
      ******************************************************************00260060
SR3403*  DATE:03/06/2012 JALAJ KUMAR               WR#SR3403            00262083
SR3403*  RECOMPILED THE PROGRAM FOR CHANGES DONE IN TFRD020 COPYBOOK    00263083
SR3403*  AS A PART OF LARGE RETAIL PROJECT                              00264083
      ******************************************************************00265083
      *  DATE:02/14/2023 JEAN KURK                 CHG0281369           00266084
      *  REMOVED THE COPYBOOK FOR THE UPC CHECK DIGIT ROUTINE           00267084
      ******************************************************************00269084
       ENVIRONMENT DIVISION.                                            00270060
      ******************************************************************00280060
                                                                        00290060
      ******************************************************************00300060
       DATA DIVISION.                                                   00310060
      ******************************************************************00320060
                                                                        00330060
      ******************************************************************00340060
       WORKING-STORAGE SECTION.                                         00350060
      ******************************************************************00360060
                                                                        00370060
      *                                                                 00380060
      *  LISTENER QUEUE NAMES                                           00390060
      *                                                                 00400060
           COPY RFWS001.                                                00410060
                                                                        00420060
      *                                                                 00430060
      *  RECORD LAYOUT BEING TRANSMITTED FROM THE PTC                   00440060
      *                                                                 00450060
           COPY TFRD019.                                                00460060
                                                                        00470060
      *                                                                 00480060
      *  RECORD LAYOUT BEING TRANSMITTED TO THE PTC                     00490060
      *                                                                 00500060
           COPY TFRD020.                                                00510060
                                                                        00511060
      *                                                                 00512060
      *  NISKU WORK AREA                                                00513060
      *                                                                 00514060
           COPY ISWS006.                                                00515060
                                                                        00516060
      *                                                                 00530060
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00540060
      *                                                                 00550060
           COPY DPWS013.                                                00560060
                                                                        00570060
      *                                                                 00580060
      *  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  00590060
      *                                                                 00600060
           COPY DPRD507I.                                               00610060
                                                                        00620060
      *                                                                 00630060
      *  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     00640060
      *                                                                 00650060
           COPY DPWS011.                                                00660060
                                                                        00670060
      *                                                                 00730060
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM TABLE00740060
      *                                                                 00750060
           EXEC SQL                                                     00760060
               INCLUDE TTFITEM                                          00770060
           END-EXEC.                                                    00780060
                                                                        00790060
      *                                                                 00800060
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE MERCHANDISE AREA   00810060
      *  TABLE                                                          00820060
      *                                                                 00830060
102704*    EXEC SQL                                                     00840064
102704*        INCLUDE TMDSEAR                                          00850064
102704*    END-EXEC.                                                    00860064
                                                                        00870060
      *                                                                 00880060
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC TABLE          00890060
      *                                                                 00900060
102704*    EXEC SQL                                                     00910064
102704*        INCLUDE TUPC                                             00920064
102704*    END-EXEC.                                                    00930064
                                                                        00940060
      *                                                                 00950060
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE ENTERPRISE NAME    00960060
      *  TABLE                                                          00970060
      *                                                                 00980060
102704*    EXEC SQL                                                     00990064
102704*        INCLUDE TENTNME                                          01000064
102704*    END-EXEC.                                                    01010064
                                                                        01020060
      *                                                                 01030060
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE COLOR TABLE        01040060
      *                                                                 01050060
102704*    EXEC SQL                                                     01060064
102704*        INCLUDE TCOLOR                                           01070064
102704*    END-EXEC.                                                    01080064
                                                                        01090060
      *                                                                 01100060
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SIZE TABLE         01110060
      *                                                                 01120060
102704*    EXEC SQL                                                     01130064
102704*        INCLUDE TSIZE                                            01140064
102704*    END-EXEC.                                                    01150064
                                                                        01160060
      *                                                                 01170060
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE VENDOR STYLE TABLE 01180060
      *                                                                 01190060
102704*    EXEC SQL                                                     01200064
102704*        INCLUDE TVNDSTL                                          01210064
102704*    END-EXEC.                                                    01220064
                                                                        01230060
      *                                                                 01240060
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SKU TABLE          01250060
      *                                                                 01260060
102704*    EXEC SQL                                                     01270064
102704*        INCLUDE TSK                                              01280064
102704*    END-EXEC.                                                    01290064
                                                                        01300060
      *                                                                 01310060
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC TO SKU         01320060
      *  RELATIONSHIP TABLE                                             01330060
      *                                                                 01340060
102704*    EXEC SQL                                                     01350064
102704*        INCLUDE TUPCSKU                                          01360064
102704*    END-EXEC.                                                    01370064
                                                                        01380060
      *                                                                 01390060
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC PHYSICAL       01400060
      *  LOCATION TABLE                                                 01410060
      *                                                                 01420060
102704*    EXEC SQL                                                     01430064
102704*        INCLUDE TUPCPLS                                          01440064
102704*    END-EXEC.                                                    01450064
                                                                        01451060
      *                                                                 01452060
      *  SKU CROSS REFERENCE TABLE                                      01453060
      *                                                                 01454060
           EXEC SQL                                                     01455060
               INCLUDE TSKXREF                                          01456060
           END-EXEC.                                                    01457060
      *                                                                 01458064
      *  XS DOMAIN TABLES                                               01459064
      *                                                                 01459164
           EXEC SQL                                                     01459264
               INCLUDE XST00008                                         01459364
           END-EXEC.                                                    01459464
           EXEC SQL                                                     01459564
               INCLUDE XST00010                                         01459664
           END-EXEC.                                                    01459764
           EXEC SQL                                                     01459864
               INCLUDE XST00012                                         01459964
           END-EXEC.                                                    01460064
           EXEC SQL                                                     01460164
               INCLUDE XST00013                                         01460264
           END-EXEC.                                                    01460364
           EXEC SQL                                                     01460464
               INCLUDE XST00018                                         01460564
           END-EXEC.                                                    01460664
                                                                        01461064
      *                                                                 01470060
      *  COMMUNICATIONS AREA FOR DB2                                    01480060
      *                                                                 01490060
           EXEC SQL                                                     01500060
               INCLUDE SQLCA                                            01510060
           END-EXEC.                                                    01520060
                                                                        01530049
       01  WS-MQCONN               PIC X(8)  VALUE 'CSQCCONN'.          01540060
       01  WS-MQOPEN               PIC X(8)  VALUE 'CSQCOPEN'.          01550060
       01  WS-MQINQ                PIC X(8)  VALUE 'CSQCINQ'.           01560060
       01  WS-MQGET                PIC X(8)  VALUE 'CSQCGET'.           01570060
       01  WS-MQPUT1               PIC X(8)  VALUE 'CSQCPUT1'.          01580060
       01  WS-MQPUT                PIC X(8)  VALUE 'CSQCPUT'.           01590060
       01  WS-MQBACK               PIC X(8)  VALUE 'CSQCBACK'.          01600060
       01  WS-MQCMIT               PIC X(8)  VALUE 'CSQCCOMM'.          01610060
       01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQCCLOS'.          01620060
       01  WS-MQDISC               PIC X(8)  VALUE 'CSQCDISC'.          01630060
                                                                        01640060
      *    API CONTROL BLOCKS                                           01650060
                                                                        01660060
       01  MQM-OBJECT-DESCRIPTOR.                                       01670060
           COPY CMQODV.                                                 01680060
       01  MQM-MESSAGE-DESCRIPTOR.                                      01690060
           COPY CMQMDV.                                                 01700060
       01  MQM-GET-MESSAGE-OPTIONS.                                     01710060
           COPY CMQGMOV.                                                01720060
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01730060
           COPY CMQPMOV.                                                01740060
                                                                        01750060
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01760060
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01770060
                                                                        01780060
       01  MQM-CONSTANTS.                                               01790060
           COPY CMQV.                                                   01800060
      *                                                                 01810060
      **---------------------------------------------------------------*01820060
      **  VARIABLES REQUIRED FOR THE USE OF THE LOG MESSAGE ROUTINE    *01830060
      **  (EPPD000)                                                    *01840060
      **---------------------------------------------------------------*01850060
                                                                        01860060
           COPY EPWS000.                                                01870060
                                                                        01880060
      *                                                                 01890060
       01  DK-DB2-KEYS.                                                 01900060
           05  DK-UPC-NBR                      PIC S9(15)  VALUE ZEROS  01910060
                                                           COMP-3.      01920060
           05  DK-XFER-DKEY-ID                 PIC S9(09)  VALUE ZEROS  01930060
                                                           COMP SYNC.   01940060
           05  DK-STR-NBR                      PIC S9(04)  VALUE ZEROS  01950060
                                                           COMP.        01960060
      *                                                                 01970060
       01  PC-PROGRAM-CONSTANTS.                                        01980060
           05  PC-SCL                          PIC  X(03)  VALUE 'SCL'. 01990060
           05  PC-KOHLS-OPERATING-COMPANY      PIC  X(02)  VALUE '03'.  02000060
           05  PC-PRIMARY-NAME                 PIC  X(02)  VALUE '01'.  02010060
           05  PC-NO                           PIC  X(01)  VALUE 'N'.   02020060
           05  PC-YES                          PIC  X(01)  VALUE 'Y'.   02030060
           05  PC-VENDOR-UPC                   PIC  X(01)  VALUE 'V'.   02040060
           05  PC-KOHLS-INTERNAL-UPC           PIC  X(01)  VALUE 'I'.   02050060
           05  PC-RENUMBERED-UPC               PIC  X(01)  VALUE 'R'.   02060060
           05  PC-DEFECTIVE-DAMAGE-SORT1       PIC  X(02)  VALUE '00'.  02071064
           05  PC-DEFECTIVE-DAMAGE-SORT2       PIC  X(02)  VALUE '01'.  02072064
           05  PC-CALLBACK                     PIC  X(02)  VALUE '02'.  02080060
           05  PC-STOCK-BALANCE-CORPORATE      PIC  X(02)  VALUE '03'.  02090060
           05  PC-STOCK-BALANCE-STORE          PIC  X(02)  VALUE '04'.  02100060
           05  PC-CUSTOMER                     PIC  X(02)  VALUE '05'.  02110060
           05  PC-CLEARANCE                    PIC  9(02)  VALUE 30.    02120060
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        02130060
               'TFKCS412'.                                              02140060
           05  PC-DUMMY-UPC                    PIC  X(03)  VALUE '000'. 02140160
           05  PC-DUMMY-UPC-MSG                PIC  X(43)               02141060
               VALUE 'MUST RECEIVE TRANSFER WITH DUMMY UPC ON CRT'.     02142056
           05  PC-ERROR-CODE                   PIC  X(01)  VALUE 'E'.   02143060
                                                                        02150060
           05  PC-TSYMSG-NUMBERS.                                       02160060
      *  SKU DOES NOT EXIST                                             02170060
               10  PC-TSYMSG-00073             PIC  9(05)  VALUE  00073.02180060
      *  UPC DOES NOT EXIST                                             02190060
               10  PC-TSYMSG-00100             PIC  9(05)  VALUE  00100.02200082
      *  DEPARTMENT/CLASS DOES NOT EXIST                                02210060
               10  PC-TSYMSG-00110             PIC  9(05)  VALUE  00110.02220060
      *  UPC NOT ASSOCIATED WITH A SKU - CONTACT DP                     02230060
               10  PC-TSYMSG-00412             PIC  9(05)  VALUE  00412.02240060
      *  RESOURCE IS UNAVAILABLE; PLEASE TRY AGAIN LATER                02250060
               10  PC-TSYMSG-01063             PIC  9(05)  VALUE  01063.02260060
      *  DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK           02270060
               10  PC-TSYMSG-01064             PIC  9(05)  VALUE  01064.02280060
                                                                        02290049
       01  PH-PROGRAM-HOLD-VARIABLES.                                   02300060
           05  PH-COMPLETION-CODE          PIC  S9(09) BINARY.          02310060
           05  PH-REASON                   PIC  S9(09) BINARY.          02320060
      *                                                                 02330060
       01  PS-PROGRAM-SWITCHES.                                         02340060
           05  PS-ITEM-FOUND-IND               PIC  X(01)  VALUE 'N'.   02500060
               88  PS-ITEM-NOT-FOUND                       VALUE 'N'.   02510060
               88  PS-ITEM-FOUND                           VALUE 'Y'.   02520060
               88  PS-MULTIPLE-ITEMS-FOUND                 VALUE 'M'.   02530060
           05  PS-MQPUT-SUCCESSFUL-IND         PIC  X(01)  VALUE 'N'.   02630060
               88 PS-MQPUT-SUCCESSFUL                      VALUE 'Y'.   02640060
      *                                                                 02650060
       01  PV-PROGRAM-VARIABLES.                                        02660060
           05  PV-QMGR-NAME            PIC X(04) VALUE SPACES.          02670060
               88  PV-PROD-QMGR-NAME             VALUE 'QKSP'.          02680060
               88  PV-TEST-QMGR-NAME             VALUE 'QKST'.          02690060
               88  PV-QA-QMGR-NAME               VALUE 'QKSQ'.          02700060
           05  PV-QM-NAME              PIC X(48).                       02710060
           05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        02720060
           05  PV-OPEN-OPTIONS         PIC S9(9) BINARY VALUE 0.        02730060
           05  PV-COMPLETION-CODE      PIC S9(9) BINARY VALUE 0.        02740060
           05  PV-REASON               PIC S9(9) BINARY VALUE 0.        02750060
           05  PV-CON-REASON           PIC S9(9) BINARY VALUE 0.        02760060
           05  PV-PQ-HANDLE            PIC S9(9) BINARY VALUE 0.        02770060
           05  PV-FMT-OPEN-OUTPUT-HNDL PIC S9(9) BINARY VALUE 0.        02780060
           05  PV-ERROR-MESSAGE        PIC X(48)  VALUE SPACES.         02790060
           05  PV-DATA-LENGTH          PIC S9(9) BINARY.                02800060
           05  PV-MSGBUFFER            PIC X(1000000) VALUE SPACES.     02810060
                                                                        02820049
           05  PV-DISPLAY-UPC-NBR              PIC  9(13)  VALUE ZEROS. 02960060
           05  PV-DISPLAY-ITM-NBR              PIC  9(15)  VALUE ZEROS. 02970060
           05  PV-DISPLAY-XFER-DKEY-ID         PIC  9(09)  VALUE ZEROS. 02980060
           05  PV-DISPLAY-INTR-UPC-ID          PIC  9(09)  VALUE ZEROS. 02990060
           05  PV-DISPLAY-UPC-VS-ID            PIC  9(09)  VALUE ZEROS. 03000060
           05  PV-DISPLAY-ENT-ID               PIC  9(09)  VALUE ZEROS. 03010060
           05  PV-DISPLAY-KOHLS-SIZE-CDE       PIC  9(09)  VALUE ZEROS. 03020060
           05  PV-ITEM-NBR                     PIC S9(04)  VALUE ZEROS  03180060
                                                           COMP SYNC.   03190060
           05  PV-TSQ-LENGTH                   PIC S9(04)  VALUE ZEROS  03200060
                                                           COMP SYNC.   03210060
           05  PV-TSQ-NAME                     PIC  X(08)  VALUE SPACES.03220060
                                                                        03230060
           05  PV-TCPIPPRQ-RECORD1.                                     03240060
               10  PV-NEXT-RECORD              PIC  9(08)  VALUE ZEROS. 03250060
               10  PV-TOTAL-RECORDS            PIC  9(08)  VALUE ZEROS. 03260060
               10  FILLER                      PIC X(4104) VALUE SPACE. 03270060
           05  PV-TCPIPPRQ-RECORD2.                                     03280060
               10  PV-CURRENT-RECORD           PIC  9(08)  VALUE ZEROS. 03290060
               10  FILLER                      PIC X(4112) VALUE SPACE. 03300060
           05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  03310060
                                                           COMP SYNC.   03320060
           05  PV-CUR-RTL-AMT                  PIC S9(7)V9(2) COMP-3.   03330060
           05  PV-HOLD-UPC-NBR.                                         03331060
               10  FILLER                      PIC X(02).               03332056
               10  PV-KOHLS-UPC-DIGITS         PIC X(04).               03333056
               10  PV-KOHLS-DEPT               PIC X(03).               03334056
               10  PV-KOHLS-CL.                                         03335056
                   15  PV-KOHLS-CL-1           PIC X(01).               03336056
                   15  PV-KOHLS-CL-2           PIC X(01).               03337056
               10  PV-KOHLS-CL-9 REDEFINES PV-KOHLS-CL                  03338056
                                               PIC 9(02).               03339056
               10  PV-KOHLS-DUMMY-UPC          PIC X(03).               03339156
               10  PV-KOHLS-CHECKDIGIT         PIC X(01).               03339256
           05  PV-HOLD-UPC-NBR-9 REDEFINES PV-HOLD-UPC-NBR              03339356
                                               PIC 9(15).               03339456
      *                                                                 03340060
      ******************************************************************03350060
       PROCEDURE DIVISION.                                              03360060
      ******************************************************************03370060
       0000-PROGRAM-MAINLINE.                                           03380060
           INITIALIZE TF020-XFER-TO-PTC-RECORD.                         03390060
                                                                        03400060
           PERFORM 1000-RETRIEVE-TEXT.                                  03410060
                                                                        03420060
           PERFORM 2000-PROCESS-PTC-REQUEST.                            03430060
                                                                        03440060
           GOBACK.                                                      03450060
      *                                                                 03460060
       1000-RETRIEVE-TEXT.                                              03470060
           EXEC CICS                                                    03480060
               RETRIEVE                                                 03490060
                   INTO  (TF019-XFER-FROM-PTC-RECORD)                   03500060
                   RESP  (PV-CICS-RESPONSE)                             03510060
           END-EXEC.                                                    03520060
                                                                        03530060
           EVALUATE TRUE                                                03540060
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03550060
                   CONTINUE                                             03560060
               WHEN OTHER                                               03570060
                   MOVE '1000-RETRIEVE-TEXT'                            03580066
                                   TO DP013-PARAGRAPH                   03581066
                   MOVE 'UNABLE TO RECEIVE TEXT'                        03590060
                                   TO DP013-MESSAGE-TEXT (1)            03600066
                   MOVE  TF019-XFER-FROM-PTC-RECORD                     03610060
                                   TO DP013-MESSAGE-TEXT (2)            03620066
                   SET DP013-CICS-ABEND                                 03630060
                       DP013-NO-ROLLBACK                                03640066
                                   TO TRUE                              03641066
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      03650060
                   SET  DP011-MSG-FATAL                                 03660066
                                   TO TRUE                              03661066
                   MOVE PC-TSYMSG-01064                                 03670066
                                   TO DP011-MSG-NUMBER                  03671066
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03680060
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   03690060
           END-EVALUATE.                                                03700060
                                                                        03710060
                                                                        03720060
           MOVE TF019-LISTENER-CODE                                     03730066
                                   TO PV-QUEUE-PARM.                    03731066
                                                                        03740060
           IF  PV-VALID-PARM                                            03750060
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      03760066
                                   TO PV-TSQ-NAME                       03761066
                                                                        03770060
           ELSE                                                         03780060
               MOVE '1000-RETRIEVE-TEXT'                                03790066
                                   TO DP013-PARAGRAPH                   03791066
               MOVE 'INVALID PARM VALUE'                                03800066
                                   TO DP013-MESSAGE-TEXT (1)            03801066
               MOVE 'PARM VALUE = '                                     03810066
                                   TO DP013-MESSAGE-TEXT (2)            03811066
               MOVE TF019-LISTENER-CODE                                 03820066
                                   TO DP013-MESSAGE-TEXT (3)            03821066
                                                                        03830060
               SET DP013-LOGIC-ABEND                                    03840060
                   DP013-NO-ROLLBACK                                    03850066
                                   TO TRUE                              03851066
                                                                        03860060
               PERFORM 9999-WRITE-CICS-LOG-MSG                          03870060
                                                                        03880060
               SET  DP011-MSG-FATAL                                     03890066
                                   TO TRUE                              03891066
                                                                        03900060
               MOVE PC-TSYMSG-01064                                     03910066
                                   TO DP011-MSG-NUMBER                  03911066
                                                                        03920060
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          03930060
               PERFORM 8000-SEND-DATA-TO-LISTENER                       03940060
           END-IF.                                                      03950060
                                                                        03960060
                                                                        03970060
      ******************************************************************03980060
      *    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 03990060
      ******************************************************************04000060
       2000-PROCESS-PTC-REQUEST.                                        04010060
                                                                        04020060
           MOVE TF019-UPC-NBR      TO  DK-UPC-NBR.                      04130066
           PERFORM 2500-CHECK-FOR-DUMMY-UPC.                            04131060
           PERFORM 2100-PROCESS-XFER-ITEM.                              04140060
                                                                        04160060
           PERFORM 8000-SEND-DATA-TO-LISTENER.                          04170060
      *                                                                 04180060
       2100-PROCESS-XFER-ITEM.                                          04190060
102704     PERFORM 7000-SELECT-UPC.                                     04201064
102704     PERFORM 3000-FILL-PTC-REC.                                   04210067
           IF XST00010-REGN-PRIC-IND = PC-YES                           04220064
               PERFORM 7800-CHECK-REGN-PRC                              04230064
           END-IF.                                                      04260060
      *                                                                 04261060
       2500-CHECK-FOR-DUMMY-UPC.                                        04262060
           MOVE TF019-UPC-NBR      TO PV-HOLD-UPC-NBR-9.                04263066
           IF (PV-KOHLS-UPC-DIGITS = '0400')  AND                       04264056
              (PV-KOHLS-DUMMY-UPC = PC-DUMMY-UPC)                       04265056
               MOVE PC-ERROR-CODE  TO  TF020-ERR-TYP-IND                04266066
               MOVE PC-DUMMY-UPC-MSG                                    04267066
                                   TO  TF020-ERR-MSG                    04267166
               PERFORM 8000-SEND-DATA-TO-LISTENER                       04268056
           END-IF.                                                      04269056
      *                                                                 04270060
       3000-FILL-PTC-REC.                                               04280067
           EVALUATE XST00012-UPC-TYP-CDE                                04290065
               WHEN PC-VENDOR-UPC                                       04300065
               WHEN PC-RENUMBERED-UPC                                   04310065
                   PERFORM 5000-GENERATE-INTRNL-UPC-CODE                04320064
                   MOVE XST00012-UPC-NBR                                04340066
                                   TO TF020-KOHLS-INTERNAL-UPC-NBR      04341066
                                      DK-UPC-NBR                        04350066
               WHEN PC-KOHLS-INTERNAL-UPC                               04360065
                   MOVE DK-UPC-NBR TO TF020-KOHLS-INTERNAL-UPC-NBR      04381066
           END-EVALUATE.                                                04390060
                                                                        04400060
           MOVE XST00013-VS-NBR    TO TF020-VENDOR-STYLE.               04470066
                                                                        04490060
           MOVE XST00018-ENT-NM-DESC                                    04520066
                                   TO TF020-VENDOR.                     04530066
                                                                        04540060
           MOVE XST00010-NRF-CLOR-DESC                                  04570066
                                   TO TF020-COLOR.                      04580066
                                                                        04590060
           MOVE XST00010-SIZE-DESC TO TF020-SIZE.                       04620066
                                                                        04640060
           MOVE XST00013-DEPT-NBR  TO TF020-DEPT.                       04671067
           MOVE XST00013-MAJ-CL-NBR                                     04672067
                                   TO TF020-CLASS.                      04672167
           MOVE XST00013-SUB-CL-NBR                                     04673067
                                   TO TF020-SUBCLASS.                   04674067
                                                                        04680060
           COMPUTE TF020-CUR-UNT-RTL-AMT  =                             04690060
               (PV-CUR-RTL-AMT  *  100).                                04700060
           MOVE XST00010-SKU-DESC  TO  TF020-SKU-DESC.                  04711066
                                                                        04720060
      *  IS ALWAYS SET TO NO, BECAUSE THE SKU/UPC BEING DISPLAYED ON    04730060
      *  THE SKU/UPC RECAP ON THE PTC, IS WHAT THE USER ENTERED/SCANNED,04740060
      *  NOT THE RENUMBERED VALUE.                                      04750060
                                                                        04760060
           SET TF020-SKU-NOT-RENUMBERED                                 04770066
                                   TO  TRUE.                            04771066
                                                                        04780060
           PERFORM 3200-FIND-XFER-ITEM.                                 04790060
      *                                                                 05420060
       3200-FIND-XFER-ITEM.                                             05430060
           PERFORM 7400-SELECT-XFER-ITEM-BY-UPC.                        05440060
                                                                        05450060
           IF (PS-MULTIPLE-ITEMS-FOUND                                  05460060
                     OR                                                 05470060
               PS-ITEM-NOT-FOUND)                                       05480060
               MOVE ZEROS          TO  TF020-TKT-PRICE                  05490066
               MOVE PC-NO          TO  TF020-GP-PRICE-ITM-IND           05500066
           END-IF.                                                      05510060
           IF PS-ITEM-FOUND                                             05520060
               COMPUTE TF020-TKT-PRICE  =                               05530060
                   (TFITEM-XFER-PRIC-AMT  *  100)                       05540060
               MOVE TFITEM-KOHLS-UPC-NBR                                05550060
                                   TO TF020-KOHLS-INTERNAL-UPC-NBR      05560066
               MOVE TFITEM-ITM-PRIC-MLT-IND                             05570060
                                   TO TF020-GP-PRICE-ITM-IND            05580066
           END-IF.                                                      05590060
      *                                                                 05600060
       5000-GENERATE-INTRNL-UPC-CODE.                                   05640060
                                                                        05773064
102704     EXEC SQL                                                     05774064
102704         SELECT  UPC_NBR                                          05775064
102704           INTO  :XST00012-UPC-NBR                                05776064
102704           FROM  XST_UPC                                          05777064
102704          WHERE  INTR_UPC_ID     =  :XST00012-INTR-UPC-ID         05779064
102704            AND  UPC_TYP_CDE     =  'I'                           05779264
102704            AND  LAST_ACTN_CDE   IN ('A', 'U')                    05779364
102704     END-EXEC.                                                    05779464
                                                                        05779564
           EVALUATE SQLCODE                                             05780064
               WHEN ZERO                                                05781064
                   MOVE XST00012-UPC-NBR                                05782064
                                   TO DK-UPC-NBR                        05782164
                                      TF020-KOHLS-INTERNAL-UPC-NBR      05783064
               WHEN -904                                                05790064
               WHEN -913                                                05800064
                   SET  DP011-MSG-FATAL                                 05810064
                                   TO TRUE                              05810164
                   SET  DP011-MSG-FATAL                                 05811066
                                   TO TRUE                              05812066
                   MOVE PC-TSYMSG-01063                                 05820066
                                   TO DP011-MSG-NUMBER                  05821066
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05830060
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05840060
               WHEN OTHER                                               05850064
                   MOVE '5000-GENERATE-INTRNL-UPC-CODE'                 05880060
                                   TO DP013-PARAGRAPH                   05890066
                   MOVE 'GENERATE INTERNAL UPC NUMBER'                  05900060
                                   TO DP013-MESSAGE-TEXT (1)            05910066
                   MOVE XST00012-INTR-UPC-ID                            05911066
                                   TO PV-DISPLAY-INTR-UPC-ID            05911166
                   MOVE PV-DISPLAY-INTR-UPC-ID                          05912066
                                   TO DP013-MESSAGE-TEXT (2)            05912166
                   MOVE SQLCA      TO DP013-SQLCA                       05913066
                   MOVE 'XST_UPC'  TO DP013-DB2-TABLE-NAME (1)          05914066
                   SET DP013-DB2-ABEND                                  05916060
                       DP013-NO-ROLLBACK                                05917066
                                   TO TRUE                              05917166
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      05918060
                   SET  DP011-MSG-FATAL                                 05919066
                                   TO TRUE                              05919166
                   MOVE PC-TSYMSG-01064                                 05919266
                                   TO DP011-MSG-NUMBER                  05919366
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05919466
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05919566
           END-EVALUATE.                                                05919760
      *                                                                 06401064
102704 7000-SELECT-UPC.                                                 06402064
           INITIALIZE DCLXST00008.                                      06403064
           INITIALIZE DCLXST00010.                                      06403164
           INITIALIZE DCLXST00012.                                      06403264
           INITIALIZE DCLXST00013.                                      06403364
           INITIALIZE DCLXST00018.                                      06403464
           INITIALIZE DCLTSKXREF.                                       06403565
                                                                        06404064
           EXEC SQL                                                     06405064
               SELECT  C.VS_ID                                          06406065
                     , A.INTR_UPC_ID                                    06407064
                     , A.UPC_TYP_CDE                                    06408064
                     , B.SIZE_DESC                                      06409064
                     , B.NRF_CLOR_DESC                                  06409164
                     , C.VS_NBR                                         06409264
                     , D.ENT_NM_DESC                                    06409364
                     , C.DEPT_NBR                                       06409464
                     , C.MAJ_CL_NBR                                     06409564
                     , C.SUB_CL_NBR                                     06409664
                     , B.SKU_DESC                                       06410064
                     , B.REGN_PRIC_IND                                  06410864
                     , E.LOC_SKU_STAT_CDE                               06411064
                     , E.UNT_RTL_AMT                                    06411164
                     , X.ITM_NBR                                        06411264
                 INTO  :XST00013-VS-ID                                  06411364
                     , :XST00012-INTR-UPC-ID                            06411464
                     , :XST00012-UPC-TYP-CDE                            06411564
                     , :XST00010-SIZE-DESC                              06411664
                     , :XST00010-NRF-CLOR-DESC                          06411764
                     , :XST00013-VS-NBR                                 06411864
                     , :XST00018-ENT-NM-DESC                            06411964
                     , :XST00013-DEPT-NBR                               06412064
                     , :XST00013-MAJ-CL-NBR                             06412164
                     , :XST00013-SUB-CL-NBR                             06412264
                     , :XST00010-SKU-DESC                               06412364
                     , :XST00010-REGN-PRIC-IND                          06412464
                     , :XST00008-LOC-SKU-STAT-CDE                       06412564
                     , :PV-CUR-RTL-AMT                                  06412667
                     , :SKXREF-ITM-NBR                                  06412764
                 FROM  XST_UPC        A                                 06412864
                     , XST_SKU        B                                 06412964
                     , XST_VND_STYL   C                                 06413064
                     , XST_VND        D                                 06413164
                     , XST_SKU_LOC    E                                 06413264
                     , TSKXREF        X                                 06413364
                WHERE  A.UPC_NBR       =  :DK-UPC-NBR                   06413464
                  AND  A.LAST_ACTN_CDE IN ('A', 'U')                    06413564
                  AND  B.INTR_UPC_ID   =  A.INTR_UPC_ID                 06413664
                  AND  C.STYL_ID       =  B.STYL_ID                     06413764
                  AND  D.ENT_ID        =  C.ENT_ID                      06413864
                  AND  E.INTR_UPC_ID   =  A.INTR_UPC_ID                 06413964
                  AND  E.LOC_NBR       =  +0                            06414064
                  AND  E.BEG_TMST      <= CURRENT TIMESTAMP             06414164
                  AND  (E.END_TMST     >  CURRENT TIMESTAMP             06414264
                   OR  E.END_TMST      IS NULL)                         06414364
                  AND  X.INTR_UPC_ID   =  A.INTR_UPC_ID                 06414464
                  AND  X.SKU_STAT_CDE  <> '98'                          06414564
           END-EXEC.                                                    06414664
                                                                        06414764
           EVALUATE SQLCODE                                             06414864
               WHEN ZERO                                                06414964
                   CONTINUE                                             06415064
PB5756         WHEN +100                                                06415176
PB5756             SET  DP011-MSG-FATAL                                 06415276
PB5756                             TO TRUE                              06415376
PB5756             MOVE PC-TSYMSG-00100                                 06415476
PB5756                             TO DP011-MSG-NUMBER                  06415576
PB5756             PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06415676
PB5756             PERFORM 8000-SEND-DATA-TO-LISTENER                   06415776
               WHEN -904                                                06415864
               WHEN -913                                                06415964
                   SET  DP011-MSG-FATAL                                 06416066
                                   TO TRUE                              06416166
                   MOVE PC-TSYMSG-01063                                 06416266
                                   TO DP011-MSG-NUMBER                  06416366
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06416466
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06416566
               WHEN OTHER                                               06416666
                   MOVE '7000-SELECT-UPC-FROM-TUPC'                     06416766
                                   TO DP013-PARAGRAPH                   06416866
                   MOVE 'SELECT UPC_NBR: '                              06416966
                                   TO DP013-MESSAGE-TEXT (1)            06417066
                   MOVE DK-UPC-NBR TO PV-DISPLAY-UPC-NBR                06417166
                   MOVE PV-DISPLAY-UPC-NBR                              06417266
                                   TO DP013-MESSAGE-TEXT (2)            06417366
                   MOVE SQLCA      TO DP013-SQLCA                       06417466
                   MOVE 'XST_UPC'  TO DP013-DB2-TABLE-NAME (1)          06417566
                   MOVE 'XST_SKU'  TO DP013-DB2-TABLE-NAME (2)          06417666
                   MOVE 'XST_VND_STYL'                                  06417766
                                   TO DP013-DB2-TABLE-NAME (3)          06417866
                   SET DP013-DB2-ABEND                                  06417966
                       DP013-NO-ROLLBACK                                06418066
                                   TO TRUE                              06418166
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06418266
                   SET  DP011-MSG-FATAL                                 06418366
                                   TO TRUE                              06418466
                   MOVE PC-TSYMSG-01064                                 06418566
                                   TO DP011-MSG-NUMBER                  06418666
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06418766
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06418866
           END-EVALUATE.                                                06419066
      *                                                                 08400060
      *                                                                 09670060
       7400-SELECT-XFER-ITEM-BY-UPC.                                    09680060
           INITIALIZE DCLTTFITEM.                                       09690060
           MOVE TF019-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 09700066
                                                                        09710060
           EXEC SQL                                                     09720060
               SELECT  CPLD_RTL_PRIC_AMT,                               09760060
                       KOHLS_UPC_NBR,                                   09770060
                       XFER_PRIC_AMT,                                   09780060
                       XFER_QTY,                                        09790060
                       RNBR_SKU_IND,                                    09800060
                       ITM_PRIC_MLT_IND                                 09810060
                 INTO  :TFITEM-CPLD-RTL-PRIC-AMT,                       09850060
                       :TFITEM-KOHLS-UPC-NBR,                           09860060
                       :TFITEM-XFER-PRIC-AMT,                           09870060
                       :TFITEM-XFER-QTY,                                09880060
                       :TFITEM-RNBR-SKU-IND,                            09890060
                       :TFITEM-ITM-PRIC-MLT-IND                         09900060
                 FROM  TTFITEM                                          09910060
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID               09920060
                  AND   ITM_NBR       =  :SKXREF-ITM-NBR)               09930064
           END-EXEC.                                                    09940060
                                                                        09950060
           EVALUATE SQLCODE                                             09960064
               WHEN ZERO                                                09961064
                   SET PS-ITEM-FOUND                                    09962066
                                   TO TRUE                              09963066
               WHEN -904                                                09970064
               WHEN -913                                                09980064
                   SET  DP011-MSG-FATAL                                 09990066
                                   TO TRUE                              09991066
                   MOVE PC-TSYMSG-01063                                 10000066
                                   TO DP011-MSG-NUMBER                  10001066
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      10010060
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   10020060
               WHEN -811                                                10030064
                   SET PS-MULTIPLE-ITEMS-FOUND                          10040066
                                   TO  TRUE                             10041066
               WHEN +100                                                10050064
                   SET PS-ITEM-NOT-FOUND                                10060066
                                   TO TRUE                              10061066
               WHEN OTHER                                               10070064
                   MOVE '7400-SELECT-XFER-ITEM-BY-UPC'                  10100060
                                   TO DP013-PARAGRAPH                   10110066
                   MOVE 'SELECT DATA FOR XFER_DKEY_ID/ITM_NBR: '        10120060
                                   TO DP013-MESSAGE-TEXT (1)            10130066
                   MOVE DK-XFER-DKEY-ID                                 10140066
                                   TO PV-DISPLAY-XFER-DKEY-ID           10141066
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         10150060
                                   TO DP013-MESSAGE-TEXT (2)            10160066
                   MOVE SKXREF-ITM-NBR                                  10170066
                                   TO PV-DISPLAY-ITM-NBR                10171066
                   MOVE PV-DISPLAY-ITM-NBR                              10180066
                                   TO DP013-MESSAGE-TEXT (3)            10181066
                   MOVE SQLCA      TO DP013-SQLCA                       10190066
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          10200066
                   SET DP013-DB2-ABEND                                  10210060
                       DP013-NO-ROLLBACK                                10220066
                                   TO TRUE                              10221066
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10230060
                   SET  DP011-MSG-FATAL                                 10240066
                                   TO TRUE                              10241066
                   MOVE PC-TSYMSG-01064                                 10250066
                                   TO DP011-MSG-NUMBER                  10251066
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      10260060
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   10270060
           END-EVALUATE.                                                10300060
      *                                                                 10310060
       7800-CHECK-REGN-PRC.                                             11880060
                                                                        12020060
           EXEC SQL                                                     12022064
               SELECT  LOC_SKU_STAT_CDE,                                12023064
                       UNT_RTL_AMT                                      12024064
                 INTO :XST00008-LOC-SKU-STAT-CDE,                       12025064
                      :XST00008-UNT-RTL-AMT                             12026064
                 FROM  XST_SKU_LOC                                      12027064
                WHERE  INTR_UPC_ID   =  :XST00012-INTR-UPC-ID           12028064
                  AND  LOC_NBR       =  :DK-STR-NBR                     12028164
                  AND  BEG_TMST      <= CURRENT TIMESTAMP               12029164
                  AND  (END_TMST     >  CURRENT TIMESTAMP               12029264
                   OR  END_TMST      IS NULL)                           12029364
           END-EXEC.                                                    12029464
                                                                        12029564
           EVALUATE SQLCODE                                             12030064
               WHEN ZERO                                                12031064
                   IF XST00008-LOC-SKU-STAT-CDE = PC-CLEARANCE          12032064
                       MOVE XST00008-UNT-RTL-AMT                        12033066
                                   TO PV-CUR-RTL-AMT                    12033166
                   END-IF                                               12034064
               WHEN +100                                                12040064
                   CONTINUE                                             12050060
               WHEN OTHER                                               12060064
                   MOVE '7800-CHECK-REGN-PRC'                           12090060
                                   TO DP013-PARAGRAPH                   12100066
                   MOVE 'SELECT DATA FROM TUPCPLS'                      12110060
                                   TO DP013-MESSAGE-TEXT (1)            12120066
                   MOVE SQLCA      TO DP013-SQLCA                       12130066
                   MOVE 'XST_SKU_LOC'                                   12140066
                                   TO DP013-DB2-TABLE-NAME (1)          12141066
                   SET DP013-DB2-ABEND                                  12150060
                       DP013-ROLLBACK                                   12160066
                                   TO TRUE                              12161066
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      12170060
                   SET  DP011-MSG-FATAL                                 12180066
                                   TO TRUE                              12181066
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              12190060
                       MOVE PC-TSYMSG-01063                             12200066
                                   TO DP011-MSG-NUMBER                  12201066
                   ELSE                                                 12210060
                       MOVE PC-TSYMSG-01064                             12220066
                                   TO DP011-MSG-NUMBER                  12221066
                   END-IF                                               12230060
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      12240060
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   12250060
           END-EVALUATE.                                                12300060
      *                                                                 12310060
      ******************************************************************12320060
      *  CONNECT TO SOCKET WHICH WAS GIVEN TO US BY THE AL/SYSTEMS PTC  12330060
      *  PROGRAM.  CONNECT THE PATH (SOCKET).                           12340060
      ******************************************************************12350060
       8000-SEND-DATA-TO-LISTENER.                                      12360060
           IF TF019-MQ-INDICATOR-Y                                      12370049
               PERFORM 8500-MQ-SETUP                                    12380060
               PERFORM 8510-MQ-SETUP-REMOTE                             12390060
               PERFORM 8520-PUT-QUEUE                                   12400060
               PERFORM 8600-CLOSE-PUT-Q                                 12410060
               PERFORM 8610-DISCONNECT-QMGR                             12420060
               PERFORM 9100-EXEC-CICS-RETURN                            12430060
           ELSE                                                         12440049
               PERFORM 8110-ENQ-TCPIPPRQ                                12450060
               PERFORM 8120-READQ-TCPIPPRQ-RECORD1                      12460060
               PERFORM 8130-READQ-TCPIPPRQ-RECORD2                      12470060
                                                                        12480060
      *MUST BE HERE                                                     12490060
               PERFORM 8140-REWRITE-TCPIPPRQ-NEXT-REC                   12500060
      *MUST BE HERE                                                     12510060
               ADD 1               TO PV-NEXT-RECORD                    12520066
                                                                        12530060
               IF PV-NEXT-RECORD > PV-TOTAL-RECORDS                     12540060
                   MOVE 3          TO PV-NEXT-RECORD                    12550066
               END-IF                                                   12560060
                                                                        12570060
               PERFORM 8150-REWRITE-TCPIPPRQ-RECORD1                    12580060
               PERFORM 8160-DEQ-TCPIPPRQ                                12590060
                                                                        12600060
               PERFORM 9100-EXEC-CICS-RETURN                            12610060
           END-IF.                                                      12620049
      *                                                                 12630060
      ******************************************************************12640060
       8110-ENQ-TCPIPPRQ.                                               12650060
           EXEC CICS                                                    12660060
               ENQ                                                      12670060
                   RESOURCE  (PV-TSQ-NAME)                              12680060
                   RESP      (PV-CICS-RESPONSE)                         12690060
           END-EXEC.                                                    12700060
                                                                        12710060
           EVALUATE TRUE                                                12720060
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 12730060
                   CONTINUE                                             12740060
               WHEN OTHER                                               12750060
                   MOVE '8110-ENQ-TCPIPPRQ'                             12760066
                                   TO DP013-PARAGRAPH                   12761066
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q12770060
      -                 'UEUE: '                                        12780060
                                   TO DP013-MESSAGE-TEXT (1)            12790066
                   MOVE PV-TSQ-NAME                                     12800066
                                   TO DP013-MESSAGE-TEXT (2)            12801066
                   SET DP013-CICS-ABEND                                 12810060
                       DP013-NO-ROLLBACK                                12820066
                                   TO TRUE                              12821066
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      12830060
                   PERFORM 9100-EXEC-CICS-RETURN                        12840060
           END-EVALUATE.                                                12850060
      *                                                                 12860060
      ******************************************************************12870060
       8120-READQ-TCPIPPRQ-RECORD1.                                     12880060
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           12890066
                                   TO PV-TSQ-LENGTH.                    12891066
                                                                        12900060
           EXEC CICS                                                    12910060
               READQ TS                                                 12920060
                   QUEUE   (PV-TSQ-NAME)                                12930060
                   INTO    (PV-TCPIPPRQ-RECORD1)                        12940060
                   LENGTH  (PV-TSQ-LENGTH)                              12950060
                   ITEM    (1)                                          12960060
                   RESP    (PV-CICS-RESPONSE)                           12970060
           END-EXEC.                                                    12980060
                                                                        12990060
           EVALUATE TRUE                                                13000060
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13010060
                   CONTINUE                                             13020060
               WHEN OTHER                                               13030060
                   MOVE '8120-READQ-TCPIPPRQ-RECORD1'                   13040060
                                   TO DP013-PARAGRAPH                   13050066
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 13060060
      -                 'QUEUE: '                                       13070060
                                   TO DP013-MESSAGE-TEXT (1)            13080066
                   MOVE PV-TSQ-NAME                                     13090066
                                   TO DP013-MESSAGE-TEXT (2)            13091066
                   SET DP013-CICS-ABEND                                 13100060
                       DP013-NO-ROLLBACK                                13110066
                                   TO TRUE                              13111066
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      13120060
                   PERFORM 9100-EXEC-CICS-RETURN                        13130060
           END-EVALUATE.                                                13140060
      *                                                                 13150060
      ******************************************************************13160060
       8130-READQ-TCPIPPRQ-RECORD2.                                     13170060
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD2                           13180066
                                   TO PV-TSQ-LENGTH.                    13181066
                                                                        13190060
           EXEC CICS                                                    13200060
               READQ TS                                                 13210060
                   QUEUE   (PV-TSQ-NAME)                                13220060
                   INTO    (PV-TCPIPPRQ-RECORD2)                        13230060
                   LENGTH  (PV-TSQ-LENGTH)                              13240060
                   ITEM    (2)                                          13250060
                   RESP    (PV-CICS-RESPONSE)                           13260060
           END-EXEC.                                                    13270060
                                                                        13280060
           EVALUATE TRUE                                                13290060
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13300060
                   CONTINUE                                             13310060
               WHEN OTHER                                               13320060
                   MOVE '8130-READQ-TCPIPPRQ-RECORD2'                   13330060
                                   TO DP013-PARAGRAPH                   13340066
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 13350060
      -                 'QUEUE: '                                       13360060
                                   TO DP013-MESSAGE-TEXT (1)            13370066
                   MOVE PV-TSQ-NAME                                     13380066
                                   TO DP013-MESSAGE-TEXT (2)            13381066
                   SET DP013-CICS-ABEND                                 13390060
                       DP013-NO-ROLLBACK                                13400066
                                   TO TRUE                              13401066
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      13410060
                   PERFORM 9100-EXEC-CICS-RETURN                        13420060
           END-EVALUATE.                                                13430060
      *                                                                 13440060
      ******************************************************************13450060
       8140-REWRITE-TCPIPPRQ-NEXT-REC.                                  13460060
           MOVE LENGTH OF TF020-XFER-TO-PTC-RECORD                      13470060
                                   TO  TF020-TOT-REC-LENGTH.            13480066
                                                                        13490060
           MOVE TF019-MATCHING-NBR-FIELD                                13500066
                                   TO  TF020-MATCHING-NBR-FIELD.        13501066
           MOVE PV-NEXT-RECORD     TO  PV-ITEM-NBR.                     13510066
                                                                        13520060
           EXEC CICS                                                    13530060
               WRITEQ TS                                                13540060
                   QUEUE   (PV-TSQ-NAME)                                13550060
                   FROM    (TF020-XFER-TO-PTC-RECORD)                   13560060
                   LENGTH  (PV-TSQ-LENGTH)                              13570060
                   ITEM    (PV-ITEM-NBR)                                13580060
                       REWRITE                                          13590060
                   RESP    (PV-CICS-RESPONSE)                           13600060
           END-EXEC.                                                    13610060
                                                                        13620060
           EVALUATE TRUE                                                13630060
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13640060
                   CONTINUE                                             13650060
               WHEN OTHER                                               13660060
                   MOVE '8140-REWRITE-TCPIPPRQ-NEXT-REC'                13670060
                                   TO DP013-PARAGRAPH                   13680066
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA13690060
      -                 'STORAGE QUEUE: '                               13700060
                                   TO DP013-MESSAGE-TEXT (1)            13710066
                   MOVE PV-TSQ-NAME                                     13720066
                                   TO DP013-MESSAGE-TEXT (2)            13721066
                   SET DP013-CICS-ABEND                                 13730060
                       DP013-NO-ROLLBACK                                13740066
                                   TO TRUE                              13741066
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      13750060
                   PERFORM 9100-EXEC-CICS-RETURN                        13760060
           END-EVALUATE.                                                13770060
      *                                                                 13780060
      ******************************************************************13790060
       8150-REWRITE-TCPIPPRQ-RECORD1.                                   13800060
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           13810066
                                   TO PV-TSQ-LENGTH.                    13811066
           MOVE +1                 TO PV-ITEM-NBR.                      13820066
                                                                        13830060
           EXEC CICS                                                    13840060
               WRITEQ TS                                                13850060
                   QUEUE   (PV-TSQ-NAME)                                13860060
                   FROM    (PV-TCPIPPRQ-RECORD1)                        13870060
                   LENGTH  (PV-TSQ-LENGTH)                              13880060
                   ITEM    (PV-ITEM-NBR)                                13890060
                       REWRITE                                          13900060
                   RESP    (PV-CICS-RESPONSE)                           13910060
           END-EXEC.                                                    13920060
                                                                        13930060
           EVALUATE TRUE                                                13940060
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13950060
                   CONTINUE                                             13960060
               WHEN OTHER                                               13970060
                   MOVE '8150-REWRITE-TCPIPPRQ-RECORD1'                 13980060
                                   TO DP013-PARAGRAPH                   13990066
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   14000060
                                   TO DP013-MESSAGE-TEXT (1)            14010066
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     14020060
                                   TO DP013-MESSAGE-TEXT (2)            14030066
                   MOVE PV-TSQ-NAME                                     14040066
                                   TO DP013-MESSAGE-TEXT (3)            14041066
                   MOVE PV-TCPIPPRQ-RECORD1                             14050066
                                   TO DP013-MESSAGE-TEXT (4)            14051066
                   SET DP013-CICS-ABEND                                 14060060
                       DP013-NO-ROLLBACK                                14070066
                                   TO TRUE                              14071066
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      14080060
                   PERFORM 9100-EXEC-CICS-RETURN                        14090060
           END-EVALUATE.                                                14100060
      *                                                                 14110060
      ******************************************************************14120060
       8160-DEQ-TCPIPPRQ.                                               14130060
           EXEC CICS                                                    14140060
               DEQ                                                      14150060
                   RESOURCE  (PV-TSQ-NAME)                              14160060
                   RESP      (PV-CICS-RESPONSE)                         14170060
           END-EXEC.                                                    14180060
                                                                        14190060
           EVALUATE TRUE                                                14200060
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 14210060
                   CONTINUE                                             14220060
               WHEN OTHER                                               14230060
                   MOVE '8160-DEQ-TCPIPPRQ'                             14240066
                                   TO DP013-PARAGRAPH                   14241066
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q14250060
      -                 'UEUE: '                                        14260060
                                   TO DP013-MESSAGE-TEXT (1)            14270066
                   MOVE PV-TSQ-NAME                                     14280066
                                   TO DP013-MESSAGE-TEXT (2)            14281066
                   SET DP013-CICS-ABEND                                 14290060
                       DP013-NO-ROLLBACK                                14300066
                                   TO TRUE                              14301066
                 PERFORM 9999-WRITE-CICS-LOG-MSG                        14310060
                 PERFORM 9100-EXEC-CICS-RETURN                          14320060
           END-EVALUATE.                                                14330060
                                                                        14340049
       8500-MQ-SETUP.                                                   14350049
                                                                        14360051
      * DETERMINE THE SYSTEM                                            14370060
                                                                        14380060
           PERFORM EP000-0000-INITIALIZE.                               14390060
           IF EP000-PV-KOHLS-PROD-SYSTEM                                14400060
               SET PV-PROD-QMGR-NAME                                    14410066
                                   TO TRUE                              14411066
           ELSE                                                         14420060
               IF EP000-PV-KOHLS-QA-SYSTEM                              14430066
                   SET PV-QA-QMGR-NAME                                  14440066
                                   TO TRUE                              14441066
               ELSE                                                     14450066
                   SET PV-TEST-QMGR-NAME                                14460066
                                   TO TRUE                              14470066
               END-IF                                                   14480066
           END-IF.                                                      14490060
                                                                        14500060
      ***************************************************************   14510049
      *    CONNECT TO THE QUEUE MANAGER                                 14520060
      ***************************************************************   14530049
                                                                        14540060
           MOVE PV-QMGR-NAME       TO PV-QM-NAME.                       14550066
           CALL WS-MQCONN USING PV-QM-NAME                              14560060
                                PV-HCONN                                14570060
                                PV-COMPLETION-CODE                      14580060
                                PV-REASON.                              14590060
                                                                        14600060
      ***************************************************************   14610049
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              14620060
      *    AND EXIT                                                     14630060
      ***************************************************************   14640049
                                                                        14650060
           MOVE PV-REASON          TO PV-CON-REASON.                    14660066
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   14670060
               MOVE 'MQCONN ERROR' TO PV-ERROR-MESSAGE                  14680066
               MOVE '8500-MQ-SETUP'                                     14690066
                                   TO DP013-PARAGRAPH                   14691066
               MOVE  PV-ERROR-MESSAGE                                   14700066
                                   TO DP013-MESSAGE-TEXT (1)            14701066
               MOVE  PV-COMPLETION-CODE                                 14710066
                                   TO DP013-MESSAGE-TEXT (2)            14711066
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            14720066
               SET DP013-CICS-ABEND                                     14730060
                   DP013-NO-ROLLBACK                                    14740066
                                   TO TRUE                              14741066
               PERFORM 9999-WRITE-CICS-LOG-MSG                          14750060
               PERFORM 9100-EXEC-CICS-RETURN                            14760060
           END-IF.                                                      14770060
                                                                        14780060
                                                                        14790049
       8510-MQ-SETUP-REMOTE.                                            14800049
      ***************************************************************   14810049
      *    OPEN THE RF.RESPONSE.Q QUEUE FOR OUTPUT.                     14820060
      *    THIS IS A REMOTE QUEUE.                                      14830060
      ***************************************************************   14840049
                                                                        14850060
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      14860060
                                     MQOO-FAIL-IF-QUIESCING.            14870060
                                                                        14880060
           MOVE TF019-REPLYTOQ     TO MQOD-OBJECTNAME.                  14890066
           MOVE TF019-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              14900066
                                                                        14910049
           CALL WS-MQOPEN USING PV-HCONN                                14920060
                                MQM-OBJECT-DESCRIPTOR                   14930060
                                PV-OPEN-OPTIONS                         14940060
                                PV-PQ-HANDLE                            14950060
                                PV-COMPLETION-CODE                      14960060
                                PV-REASON.                              14970060
                                                                        14980060
      ********************************************************          14990049
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    15000060
      *    AND EXIT.                                                    15010060
      ********************************************************          15020049
      *                                                                 15030060
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   15040060
               PERFORM 8600-CLOSE-PUT-Q                                 15050060
               PERFORM 8610-DISCONNECT-QMGR                             15060060
               MOVE 'MQOPEN WRITE Q'                                    15070066
                                   TO PV-ERROR-MESSAGE                  15071066
               MOVE '8510-MQ-SETUP-REMOTE'                              15080066
                                   TO DP013-PARAGRAPH                   15081066
               MOVE  PV-ERROR-MESSAGE                                   15090066
                                   TO DP013-MESSAGE-TEXT (1)            15091066
               MOVE  PV-COMPLETION-CODE                                 15100066
                                   TO DP013-MESSAGE-TEXT (2)            15101066
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            15110066
               SET DP013-CICS-ABEND                                     15120060
                   DP013-NO-ROLLBACK                                    15130066
                                   TO TRUE                              15131066
               PERFORM 9999-WRITE-CICS-LOG-MSG                          15140060
               PERFORM 9100-EXEC-CICS-RETURN                            15150060
           END-IF.                                                      15160060
           MOVE PV-PQ-HANDLE       TO PV-FMT-OPEN-OUTPUT-HNDL.          15170066
      *                                                                 15180060
      ******************************************************************15190060
       8520-PUT-QUEUE.                                                  15200060
           MOVE TF019-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              15210066
           MOVE TF019-REPLYTOQ     TO MQOD-OBJECTNAME.                  15220066
           MOVE TF019-MSGID        TO MQMD-CORRELID.                    15230066
           MOVE MQMI-NONE          TO MQMD-MSGID.                       15240066
           MOVE MQFMT-STRING       TO MQMD-FORMAT.                      15250066
           MOVE 5000               TO MQMD-EXPIRY.                      15260066
           MOVE LENGTH OF TF020-XFER-TO-PTC-RECORD                      15270060
                                   TO PV-DATA-LENGTH.                   15280066
           MOVE TF020-XFER-TO-PTC-RECORD                                15290066
                                   TO PV-MSGBUFFER.                     15291066
           MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 15300066
                                                                        15310060
           COMPUTE MQPMO-CONTEXT  =  PV-PQ-HANDLE.                      15320060
                                                                        15330049
                                                                        15340049
                                                                        15350060
           CALL WS-MQPUT USING PV-HCONN                                 15360060
                               PV-FMT-OPEN-OUTPUT-HNDL                  15370060
                               MQM-MESSAGE-DESCRIPTOR                   15380060
                               MQM-PUT-MESSAGE-OPTIONS                  15390060
                               PV-DATA-LENGTH                           15400060
                               PV-MSGBUFFER                             15410060
                               PV-COMPLETION-CODE                       15420060
                               PV-REASON.                               15430060
                                                                        15440060
      ***********************************************************       15450049
      *        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 15460060
      *        AND BREAK OUT OF LOOP                                    15470060
      ***********************************************************       15480049
                                                                        15490060
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   15500060
               MOVE PV-COMPLETION-CODE                                  15510066
                                   TO PH-COMPLETION-CODE                15511066
               MOVE PV-REASON      TO PH-REASON                         15520066
               PERFORM 8600-CLOSE-PUT-Q                                 15530066
               PERFORM 8610-DISCONNECT-QMGR                             15540066
               MOVE 'MQPUT ERR'    TO PV-ERROR-MESSAGE                  15550066
               MOVE '8520-PUT-QUEUE'                                    15560066
                                   TO DP013-PARAGRAPH                   15561066
               MOVE PV-ERROR-MESSAGE                                    15570066
                                   TO DP013-MESSAGE-TEXT (1)            15571066
               MOVE PH-COMPLETION-CODE                                  15580066
                                   TO DP013-MESSAGE-TEXT (2)            15581066
               MOVE PH-REASON      TO DP013-MESSAGE-TEXT (3)            15590066
               SET DP013-CICS-ABEND                                     15600066
                   DP013-NO-ROLLBACK                                    15610066
                                   TO TRUE                              15611066
               PERFORM 9999-WRITE-CICS-LOG-MSG                          15620066
               PERFORM 9100-EXEC-CICS-RETURN                            15630066
           ELSE                                                         15640060
               SET PS-MQPUT-SUCCESSFUL                                  15650066
                                   TO TRUE                              15651066
           END-IF.                                                      15660060
      *                                                                 15670060
      ******************************************************************15680060
       8600-CLOSE-PUT-Q.                                                15690060
           CALL WS-MQCLOSE USING PV-HCONN                               15700060
                                 PV-PQ-HANDLE                           15710060
                                 MQCO-NONE                              15720060
                                 PV-COMPLETION-CODE                     15730060
                                 PV-REASON.                             15740060
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   15750060
               MOVE 'MQCLOSE PQ HANDLE'                                 15760066
                                   TO PV-ERROR-MESSAGE                  15761066
               MOVE '8600-CLOSE-PUT-Q'                                  15770066
                                   TO DP013-PARAGRAPH                   15771066
               MOVE  PV-ERROR-MESSAGE                                   15780066
                                   TO DP013-MESSAGE-TEXT (1)            15781066
               MOVE  PV-COMPLETION-CODE                                 15790066
                                   TO DP013-MESSAGE-TEXT (2)            15791066
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            15800066
               SET DP013-CICS-ABEND                                     15810060
                   DP013-NO-ROLLBACK                                    15820066
                                   TO TRUE                              15821066
               PERFORM 9999-WRITE-CICS-LOG-MSG                          15830060
               PERFORM 9100-EXEC-CICS-RETURN                            15840060
           END-IF.                                                      15850060
      *                                                                 15860060
      ******************************************************************15870060
       8610-DISCONNECT-QMGR.                                            15880060
                                                                        15890060
           IF PV-CON-REASON IS NOT EQUAL                                15900066
                                   TO MQRC-ALREADY-CONNECTED            15901066
              CALL WS-MQDISC USING PV-HCONN                             15910060
                                   PV-COMPLETION-CODE                   15920060
                                   PV-REASON                            15930060
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                15940060
                  MOVE 'MQDISC'    TO PV-ERROR-MESSAGE                  15950066
                  MOVE '8610-DISCONNECT'                                15960066
                                   TO DP013-PARAGRAPH                   15961066
                  MOVE PV-ERROR-MESSAGE                                 15970066
                                   TO DP013-MESSAGE-TEXT (1)            15971066
                  MOVE PV-COMPLETION-CODE                               15980066
                                   TO DP013-MESSAGE-TEXT (2)            15981066
                  MOVE PV-REASON   TO DP013-MESSAGE-TEXT (3)            15990066
                  SET DP013-CICS-ABEND                                  16000060
                      DP013-NO-ROLLBACK                                 16010066
                                   TO TRUE                              16011066
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       16020060
                  PERFORM 9100-EXEC-CICS-RETURN                         16030060
              END-IF                                                    16040060
           END-IF.                                                      16050060
                                                                        16060060
      *                                                                 16070060
      ******************************************************************16080060
      *    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          16090060
      *    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   16100060
      *    STREAM BEING SENT BACK TO THE PTC.                           16110060
      ******************************************************************16120060
       9000-FMT-ERR-MSG-TO-PTC.                                         16130060
           PERFORM DP011-0000-FORMAT-MSG-LINES.                         16140060
           MOVE DP011-MSG-LEVEL    TO  TF020-ERR-TYP-IND.               16150066
           MOVE DP011-MSG-TEXT     TO  TF020-ERR-MSG.                   16160066
      *                                                                 16170060
       9100-EXEC-CICS-RETURN.                                           16180060
           EXEC CICS                                                    16190060
               RETURN                                                   16200060
           END-EXEC.                                                    16210060
      *                                                                 16220060
       9999-WRITE-CICS-LOG-MSG.                                         16230060
           MOVE PC-CURRENT-PROGRAM-NAME                                 16240066
                                   TO  DP013-PROGRAM.                   16241066
           MOVE DFHEIBLK           TO  DP013-DFHEIBLK.                  16250066
                                                                        16260060
           INITIALIZE DP013-SRC-TASK-NUMBER                             16270060
                      DP013-STACK.                                      16280060
                                                                        16290060
           SET DP013-LINK-RETURN   TO  TRUE.                            16300066
                                                                        16310060
           EXEC CICS                                                    16320060
               LINK                                                     16330060
                   PROGRAM   (DP013-NAME)                               16340060
                   COMMAREA  (DP013-PARAMETERS)                         16350060
                   LENGTH    (DP013-LENGTH)                             16360060
           END-EXEC.                                                    16370060
                                                                        16380060
      *                                                                 16390060
      *    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           16400060
      *                                                                 16410060
                                                                        16420060
           COPY DPPD011.                                                16430060
      *                                                                 16440060
      *    NON-CICS ARCHITECTURE ABEND ROUTINE CALL                     16450060
      *                                                                 16460060
                                                                        16470060
           COPY DPPD014.                                                16480060
                                                                        16490051
           COPY EPPD000.                                                16500060
