000010 TITLE 'WRITE MESSAGES TO XLT_PK FROM PACK ITEM'.                 00010000
000020 IDENTIFICATION DIVISION.                                         00020000
000030 PROGRAM-ID.    XLKUP019.                                         00030000
000040 AUTHOR.        DEANNA BRANTNER.                                  00040000
000050 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000060 DATE-WRITTEN.  APRIL 2003.                                       00060000
000070 DATE-COMPILED.                                                   00070000
000100******************************************************************00080000
001000* THIS PGM IS PART OF THE INTERFACING BETWEEN RMS PO & LEGACY PO. 00090000
001100******************************************************************00100000
001200* THIS DB2 PROGRAM IS CALLED TO PROCESS CERTAIN TYPES OF PO DATA  00110000
001300* PASSED FROM RMS.  THE PROGRAM UPDATES, DELETES, AND INSERTS     00120000
001400* XLT_PK TABLE.                                                   00130000
001400***************************************************************** 00131005
001400* GB 9/5/14 NEW PARAGRAPH 2100-UPDATE-TPOPRPK  TO UPDATE          00132005
001400* THE PACK SKU DESCRIPTION. RMS13 DOES NOT SEND AN UPDATE         00133005
001400* MESSAGE WHEN THE PO PREPK IS UPDATING, SO IT WILL BE UPDATED    00133105
001400* HERE THROUGH XLITEM                                             00133205
001400* GB 9/5/14 END                                                   00133305
001400* XLT_PK TABLE.                                                   00134005
001400* XLT_PK TABLE.                                                   00135005
001500******************************************************************00140000
001600 ENVIRONMENT DIVISION.                                            00150000
001700 CONFIGURATION SECTION.                                           00160000
001800 SOURCE-COMPUTER.  IBM-3090.                                      00170000
001900 OBJECT-COMPUTER.  IBM-3090.                                      00180000
002000 DATA DIVISION.                                                   00190000
002100                                                                  00200000
002200 WORKING-STORAGE SECTION.                                         00210000
002300                                                                  00220000
002300 01  PS-PROGRAM-STUFF.                                            00230000
002400     05  PS-EXISTENCE-PO              PIC S9 COMP-3 VALUE ZERO.   00240000
002500         88  PS-SKU-EXISTS-YES                      VALUE 1.      00250000
002600         88  PS-SKU-EXISTS-NO                       VALUE ZERO.   00260000
022000     05  PS-NULL-IND                  PIC S9(04)    VALUE +0 COMP.00270000
002300                                                                  00280000
007100 01  PV-ABEND-FIELDS.                                             00290000
007200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00300000
007300                                                 COMP SYNC.       00310000
006700     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.        00320000
006800     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00330000
007400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUP019'.00340000
007500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00350000
007600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00360000
007700     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00370000
007900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00380000
008000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00390000
002400**** XLT_PK TABLE                                                 00400000
002500     EXEC SQL                                                     00410000
002600         INCLUDE XLT00007                                         00420000
002700     END-EXEC.                                                    00430000
002800                                                                  00440000
008900***********************************************************       00450000
002400**** TPOPRPK                                                      00451004
002500     EXEC SQL                                                     00452004
002600         INCLUDE TPOPRPK                                          00453004
002700     END-EXEC.                                                    00454004
002800                                                                  00455004
008900***********************************************************       00456004
009000*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00460000
009100***********************************************************       00470000
009200     COPY DPWS004.                                                00480000
009300                                                                  00490000
002900     EXEC SQL                                                     00500000
003000          INCLUDE SQLCA                                           00510000
003100     END-EXEC.                                                    00520000
003200                                                                  00530000
003300     COPY SQLCA2.                                                 00540000
003400                                                                  00550000
003300     COPY IMRD075.                                                00560000
003400                                                                  00570000
007200 LINKAGE SECTION.                                                 00580000
007300******************************************************************00590000
007400**LINKAGE VARIABLES                                               00600000
007500******************************************************************00610000
007600 01  LV-LINKAGE-VARIABLES.                                        00620000
007700     05  LV-IMRD075-RECORD               PIC X(137).              00630000
007800     05  LV-RETURN-CODE                  PIC X(04).               00640000
007900                                                                  00650000
008000 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00660000
008100******************************************************************00670000
004200     INITIALIZE DCLXLT00007.                                      00680000
004200     INITIALIZE IMRD075-RECORD.                                   00690000
004200     MOVE LV-IMRD075-RECORD  TO IMRD075-RECORD.                   00700000
                                                                        00710000
004200     IF IM075-ACTION-UPDATE                                       00720000
004200         PERFORM 2000-UPDATE-XLTPK                                00730000
               IF LV-RETURN-CODE = 0000                                 00730102
004200            PERFORM 2100-UPDATE-TPOPRPK                           00731002
               END-IF                                                   00732002
004200     ELSE                                                         00740000
004200         IF IM075-ACTION-INSERT                                   00750000
004200             PERFORM 3000-INSERT-XLTPK                            00760000
004200         ELSE                                                     00770000
004200             IF IM075-ACTION-DELETE                               00780000
004200                 PERFORM 4000-DELETE-XLTPK                        00790000
004200             END-IF                                               00800000
004200         END-IF                                                   00801000
004200     END-IF.                                                      00802000
004300                                                                  00803000
004600     GOBACK.                                                      00804000
004700                                                                  00805000
      ******************************************************************00806000
       2000-UPDATE-XLTPK.                                               00807000
                                                                        00808000
           MOVE IM075-PACK-PK-SKU-NBR      TO XLT00007-PK-SKU-NBR.      00809000
           MOVE IM075-PACK-PK-DESC         TO XLT00007-PK-DESC.         00810000
           MOVE IM075-PACK-DEPT-NBR        TO XLT00007-DEPT-NBR.        00820000
           MOVE IM075-PACK-MAJ-CL-NBR      TO XLT00007-MAJ-CL-NBR.      00830000
           MOVE IM075-PACK-SUB-CL-NBR      TO XLT00007-SUB-CL-NBR.      00840000
                                                                        00841000
**GB  *    MOVE IM075-PACK-DC-ORD-MULT-QTY TO XLT00007-DC-ORD-MULT-QTY. 00850001
**GB  *IN RMS13 DC-ORD-MULT-QTY CANNOT BE UPDATED                       00860001
**GB  *8/27/14 -                                                        00861001
           EXEC SQL                                                     00870000
               UPDATE XLT_PK                                            00880000
                 SET                                                    00890000
                    PK_DESC          = :XLT00007-PK-DESC                00900000
                   ,DEPT_NBR         = :XLT00007-DEPT-NBR               00910000
                   ,MAJ_CL_NBR       = :XLT00007-MAJ-CL-NBR             00920000
                   ,SUB_CL_NBR       = :XLT00007-SUB-CL-NBR             00930000
**GB  *8/27/14     ,DC_ORD_MULT_QTY  = :XLT00007-DC-ORD-MULT-QTY        00940001
                   ,LAST_UPD_TMST    = CURRENT TIMESTAMP                00941000
              WHERE PK_SKU_NBR       = :XLT00007-PK-SKU-NBR             00950000
          END-EXEC                                                      00960000
                                                                        00970000
           EVALUATE TRUE                                                00980000
               WHEN SQLCODE = ZERO                                      00990000
               WHEN SQLCODE = +100                                      01000000
                   MOVE '0000'  TO  LV-RETURN-CODE                      01010000
               WHEN OTHER                                               01020000
                   MOVE '0014'  TO  LV-RETURN-CODE                      01030000
024600             MOVE '2000-UPDATE-XLTPK'                             01040000
024700                                     TO PV-ABEND-PARAGRAPH        01050000
024800             MOVE 'UPDATE XLT_PK'                                 01060000
024810                                     TO PV-ABEND-OPERATION        01070000
025500             STRING 'SKU NBR: '           DELIMITED BY SIZE       01080000
025600                     IM075-PACK-PK-SKU-NBR DELIMITED BY SIZE      01090000
026700                                   INTO PV-DB2-OPERATION-MESSAGE-101100000
026800                                                                  01110000
026900             MOVE 'XLT_PK'           TO PV-ABEND-TABLE            01120000
027000             PERFORM Z999-SQL-ABEND                               01130000
           END-EVALUATE.                                                01140000
                                                                        01150000
      ******************************************************************01160000
       2100-UPDATE-TPOPRPK.                                             01161002
                                                                        01162002
           MOVE IM075-PACK-PK-SKU-NBR      TO XLT00007-PK-SKU-NBR.      01163002
           MOVE IM075-PACK-PK-DESC         TO XLT00007-PK-DESC.         01164002
                                                                        01168002
           EXEC SQL                                                     01169302
               UPDATE TPOPRPK                                           01169402
                 SET                                                    01169502
                    PREPK_DESC             = :XLT00007-PK-DESC          01169602
              WHERE PK_SKU_NBR             = :XLT00007-PK-SKU-NBR       01170202
                AND PREPK_STAT_CDE         = 'A'                        01170302
          END-EXEC                                                      01170402
                                                                        01170502
           EVALUATE TRUE                                                01170602
               WHEN SQLCODE = ZERO                                      01170702
               WHEN SQLCODE = +100                                      01170802
                   MOVE '0000'  TO  LV-RETURN-CODE                      01170902
               WHEN OTHER                                               01171002
                   MOVE '0024'  TO  LV-RETURN-CODE                      01171102
024600             MOVE '2100-UPDATE-TPOPRPK '                          01171203
024700                                     TO PV-ABEND-PARAGRAPH        01171302
024800             MOVE 'UPDATE TPOPRPK '                               01171403
024810                                     TO PV-ABEND-OPERATION        01171502
025500             STRING 'SKU NBR: '           DELIMITED BY SIZE       01171602
025600                     IM075-PACK-PK-SKU-NBR DELIMITED BY SIZE      01171702
026700                                   INTO PV-DB2-OPERATION-MESSAGE-101171802
026800                                                                  01171902
026900             MOVE 'TPOPRPK '         TO PV-ABEND-TABLE            01172003
027000             PERFORM Z999-SQL-ABEND                               01172102
           END-EVALUATE.                                                01172202
                                                                        01172302
      ******************************************************************01172402
       3000-INSERT-XLTPK.                                               01173002
                                                                        01180000
           MOVE IM075-PACK-PK-SKU-NBR      TO XLT00007-PK-SKU-NBR.      01190000
           MOVE IM075-PACK-PK-DESC         TO XLT00007-PK-DESC.         01200000
           MOVE IM075-PACK-DEPT-NBR        TO XLT00007-DEPT-NBR.        01210000
           MOVE IM075-PACK-MAJ-CL-NBR      TO XLT00007-MAJ-CL-NBR.      01220000
           MOVE IM075-PACK-SUB-CL-NBR      TO XLT00007-SUB-CL-NBR.      01230000
           MOVE IM075-PACK-DC-ORD-MULT-QTY TO XLT00007-DC-ORD-MULT-QTY. 01240000
                                                                        01250000
           EXEC SQL                                                     01260000
               INSERT INTO XLT_PK                                       01270000
                 (PK_DESC                                               01280000
                 ,PK_SKU_NBR                                            01290000
                 ,DEPT_NBR                                              01300000
                 ,MAJ_CL_NBR                                            01310000
                 ,SUB_CL_NBR                                            01320000
                 ,DC_ORD_MULT_QTY                                       01330000
                 ,LAST_UPD_TMST)                                        01331000
              VALUES (:XLT00007-PK-DESC                                 01340000
                     ,:XLT00007-PK-SKU-NBR                              01350000
                     ,:XLT00007-DEPT-NBR                                01360000
                     ,:XLT00007-MAJ-CL-NBR                              01370000
                     ,:XLT00007-SUB-CL-NBR                              01380000
                     ,:XLT00007-DC-ORD-MULT-QTY                         01390000
                     ,CURRENT TIMESTAMP)                                01391000
          END-EXEC                                                      01400000
                                                                        01410000
           EVALUATE TRUE                                                01420000
               WHEN SQLCODE = ZERO                                      01430000
               WHEN SQLCODE = -803                                      01440000
                   MOVE '0000'  TO  LV-RETURN-CODE                      01450000
               WHEN OTHER                                               01460000
                   MOVE '0012'  TO  LV-RETURN-CODE                      01470000
024600             MOVE '3000-INSERT-XLTPK'                             01480000
024700                                     TO PV-ABEND-PARAGRAPH        01490000
024800             MOVE 'INSERT XLT_PK'                                 01500000
024810                                     TO PV-ABEND-OPERATION        01501000
025500             STRING 'SKU NBR: '           DELIMITED BY SIZE       01501100
025600                     IM075-PACK-PK-SKU-NBR DELIMITED BY SIZE      01501200
026700                                   INTO PV-DB2-OPERATION-MESSAGE-101501300
026800                                                                  01501400
026900             MOVE 'XLT_PK'           TO PV-ABEND-TABLE            01501500
027000             PERFORM Z999-SQL-ABEND                               01501600
           END-EVALUATE.                                                01501700
                                                                        01501800
      ******************************************************************01501900
       4000-DELETE-XLTPK.                                               01502000
                                                                        01502100
           MOVE IM075-PACK-PK-SKU-NBR      TO XLT00007-PK-SKU-NBR.      01502200
                                                                        01502300
           EXEC SQL                                                     01502400
               DELETE                                                   01502500
                 FROM XLT_PK                                            01502600
               WHERE PK_SKU_NBR  =  :XLT00007-PK-SKU-NBR                01502700
          END-EXEC                                                      01502800
                                                                        01502900
           EVALUATE TRUE                                                01503000
               WHEN SQLCODE = ZERO                                      01503100
               WHEN SQLCODE = +100                                      01503200
                   MOVE '0000'  TO  LV-RETURN-CODE                      01503300
               WHEN OTHER                                               01503400
                   MOVE '0013'  TO  LV-RETURN-CODE                      01503500
024600             MOVE '4000-DELETE-XLTPK'                             01503600
024700                                     TO PV-ABEND-PARAGRAPH        01503700
024800             MOVE 'DELETE XLT_PK'                                 01503800
024810                                     TO PV-ABEND-OPERATION        01503900
025500             STRING 'SKU NBR: '           DELIMITED BY SIZE       01504000
025600                     IM075-PACK-PK-SKU-NBR DELIMITED BY SIZE      01504100
026700                                   INTO PV-DB2-OPERATION-MESSAGE-101504200
026800                                                                  01504300
026900             MOVE 'XLT_PK'           TO PV-ABEND-TABLE            01504400
027000             PERFORM Z999-SQL-ABEND                               01504500
           END-EVALUATE.                                                01504600
                                                                        01504700
028700 Z999-SQL-ABEND.                                                  01504800
028800                                                                  01504900
028900     MOVE SQLCODE            TO PV-SQLCODE.                       01505000
029000     MOVE PV-SQLCODE         TO PV-DISP-SQLCODE.                  01505100
029100     DISPLAY '*** DB2 ERROR '.                                    01505200
029200     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  01505300
029300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 01505400
029400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               01505500
029500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               01505600
029600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       01505700
029700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       01505800
029900     DISPLAY '*** TABLE     = ' PV-ABEND-TABLE.                   01505900
030000                                                                  01506000
