000100*-----------------------*                                         00010049
000200 IDENTIFICATION DIVISION.                                         00020049
000300*-----------------------*                                         00030049
000400 PROGRAM-ID.    VNKCS032.                                         00040049
000500 AUTHOR.        JACK KRAMER.                                      00050049
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060049
000700 DATE-WRITTEN.  JANUARY 2005.                                     00070049
000800*---------------------------------------------------------------* 00080049
000900*    V032 - VENDOR RELATIONSHIP INQUIRY PROGRAM.                * 00090049
001000*                                                               * 00100049
001100*    THIS PROGRAM DISPLAYS RELATIONSHIP DATA FOR A VENDOR. THE  * 00110049
001200*    USER CAN PAGE FORWARD OR BACKWARD FOR THE HISTORY OF THE   * 00120049
001300*    RELATIONSHIP BEING DISPLAYED.                              * 00130049
001400*                                                               * 00140049
001400*    CHANGE LOG:                                                * 00140154
001400*    DATE:  01/05/2023                                          * 00140254
001420*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00141054
001450*      MADE BY: JEAN KURK               WR/IR #: CHG0277999     * 00142054
001500*---------------------------------------------------------------* 00150049
001600 ENVIRONMENT DIVISION.                                            00160049
001700 DATA DIVISION.                                                   00170049
001800                                                                  00180049
001900 WORKING-STORAGE SECTION.                                         00190049
002000                                                                  00200049
002100 01  PC-PROGRAM-CONSTANTS.                                        00210049
002200     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00220049
002300                                                    'VN032A  '.   00230049
002400     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00240049
002500                                                    'VNKM032 '.   00250049
002600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00260049
002700                                                    'VNKCS032'.   00270049
002800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00280049
002900     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00290049
003000     05  PC-INTER-APPL-CODES.                                     00300049
003100         10 PC-INTER-APPL-LIST          PIC  X(01)  VALUE '1'.    00310049
003200         10 PC-INTER-APPL-DETAIL        PIC  X(01)  VALUE '2'.    00320049
003300     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +01     00330049
003400                                                    COMP SYNC.    00340049
003500     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00350049
003600                                                    COMP SYNC.    00360049
003700     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00370049
003800                                                    +1000000      00380049
003900                                                    COMP-3.       00390049
004000     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00400049
004100                                                    COMP SYNC.    00410049
004200     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00420049
004300                                                    COMP-3.       00430049
004400     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00440049
004500     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00450049
004600     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00460049
004700     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00470049
004800     05  PC-MAX-DATE                    PIC  X(10)  VALUE         00480049
004900                                                    '9999-12-31'. 00490049
005000                                                                  00500049
005100     05  PC-TSYMSG-NUMBERS.                                       00510049
005200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00520049
005300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00530049
005400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00540049
005500         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00550049
005600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00560049
005700         10  PC-TSYMSG-03375            PIC  9(05)  VALUE 03375.  00570049
005800         10  PC-TSYMSG-03630            PIC  9(05)  VALUE 03630.  00580051
005900         10  PC-TSYMSG-03632            PIC  9(05)  VALUE 03632.  00590051
006000         10  PC-TSYMSG-03634            PIC  9(05)  VALUE 03634.  00600051
006100         10  PC-TSYMSG-03635            PIC  9(05)  VALUE 03635.  00610051
006200         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00620049
006300                                                                  00630049
006400 01  PS-PROGRAM-SWITCHES.                                         00640049
006500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00650049
006600         88  PS-NO-ERROR                            VALUE 'Y'.    00660049
006700         88  PS-ERROR                               VALUE 'N'.    00670049
006800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00680049
006900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00690049
007000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00700049
007100                                                                  00710049
007200 01  PV-PROGRAM-VARIABLES.                                        00720049
007300     05  PV-ONE                         PIC X       VALUE SPACE.  00730051
007400     05  PV-SUB                         PIC S9(04)  VALUE +0      00740049
007500                                                    COMP SYNC.    00750049
007600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00760049
007700                                                    COMP SYNC.    00770049
007800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00780049
007900                                                    COMP-3.       00790049
008000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00800049
008100                                                    COMP-3.       00810049
008200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00820049
008300                                                    COMP-3.       00830049
008400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00840049
008500                                                    COMP-3.       00850049
008600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00860049
008700                                                    COMP-3.       00870049
008800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00880049
008900                                                    COMP-3.       00890049
009000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00900049
009100                                                    COMP SYNC.    00910049
009200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00920049
009300                                                    COMP SYNC.    00930049
009400     05  PV-ITEM                        PIC S9(04)  VALUE +0      00940049
009500                                                    COMP SYNC.    00950049
009600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      00960049
009700                                                    COMP SYNC.    00970049
009800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      00980049
009900                                                    COMP SYNC.    00990049
010000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01000049
010100                                                    COMP SYNC.    01010049
010200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01020049
010300                                                    COMP SYNC.    01030049
010400     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01040049
010500                                                    COMP SYNC.    01050049
010600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01060049
010700                                                    COMP SYNC.    01070049
010800     05  PV-WORK-DATE.                                            01080049
010900         10  PV-WORK-MM                 PIC XX      VALUE SPACES. 01090049
011000         10  PV-SLASH1                  PIC X       VALUE '/'.    01100049
011100         10  PV-WORK-DD                 PIC XX      VALUE SPACES. 01110049
011200         10  PV-SLASH2                  PIC X       VALUE '/'.    01120049
011300         10  PV-WORK-YYYY               PIC XXXX    VALUE SPACES. 01130049
011400                                                                  01140049
011500*---------------------------------------------------------------* 01150049
011600*  RECORD LAYOUT FOR THE VENDOR RELATIONSHIPS TEMP STORAGE QUEUE* 01160049
011700*---------------------------------------------------------------* 01170049
011800     COPY VNWS021.                                                01180049
011900                                                                  01190049
012000*---------------------------------------------------------------* 01200049
012100*    MAP LAYOUT                                                 * 01210049
012200*---------------------------------------------------------------* 01220049
012300     COPY VNKM032.                                                01230049
012400                                                                  01240049
012500*---------------------------------------------------------------* 01250049
012600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01260049
012700*---------------------------------------------------------------* 01270049
012800     COPY DPWS015.                                                01280049
012900                                                                  01290049
013000*---------------------------------------------------------------* 01300049
013100*    FUNCTION KEYS COPYBOOK.                                    * 01310049
013200*---------------------------------------------------------------* 01320049
013300     COPY DPWS016.                                                01330049
013400                                                                  01340049
013500*---------------------------------------------------------------* 01350049
013600*    NUMERIC EDIT LAYOUT.                                       * 01360049
013700*---------------------------------------------------------------* 01370049
013800     COPY DPWS010I.                                               01380049
013900                                                                  01390049
014000*---------------------------------------------------------------* 01400049
014100*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 01410054
014200*---------------------------------------------------------------* 01420049
014300     COPY DPWS030.                                                01430049
014300     COPY DPWS930.                                                01431054
014400                                                                  01440049
014500*---------------------------------------------------------------* 01450049
014600*    STANDARD COMMAREA.                                         * 01460049
014700*---------------------------------------------------------------* 01470049
014800     COPY DPWS020.                                                01480049
014900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01490049
015000*---------------------------------------------------------------* 01500049
015100* INTER-APPLICATION COMMAREA.                                   * 01510049
015200*   VNWS020 - IS THE INPUT LAYOUT FROM THE LIST PROGRAM AND THE * 01520049
015300*             OUTPUT LAYOUT FOR A LOCAL-GO FUNCTION.            * 01530049
015400*---------------------------------------------------------------* 01540049
015500         10  INTER-APPL-COMM-AREA       PIC X(200).               01550049
015600     COPY VNWS020.                                                01560049
015700         10  ASC-SPECIFIC-COMMAREA.                               01570049
015800             15  ASC-KEYS.                                        01580049
015900                 20  ASC-KEY-ENT-ID                  PIC S9(09)   01590049
016000                                                     COMP.        01600049
016100                 20  ASC-KEY-RLTNSHP-CDE             PIC  X(03).  01610049
016200                 20  ASC-KEY-RLTNSHP-NAME            PIC  X(30).  01620049
016300                 20  ASC-KEY-VENDOR-NAME             PIC  X(30).  01630049
016400                 20  ASC-KEY-VENDOR-ID               PIC  X(09).  01640049
016500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                01650049
016600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  01660049
016700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   01670049
016800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   01680049
016900                                                                  01690049
017000                 20  ASC-ITEM-ARRAY.                              01700049
017100                     25  ASC-ITEM-ENTRIES OCCURS 1 TIMES.         01710049
017200                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   01720049
017300                                                     COMP-3.      01730049
017400                         30  ASC-RLTD-ENT-ID         PIC  9(09).  01740053
017500                         30  ASC-RLTD-VEND-ID        PIC  9(09).  01750049
017600                         30  ASC-RLTD-VEND-NAME      PIC  X(30).  01760049
017700                         30  ASC-EFF-DATE            PIC  X(10).  01770049
017800                         30  ASC-EXP-DATE            PIC  X(10).  01780049
017900                         30  ASC-DATE-ADDED          PIC  X(10).  01790049
018000                         30  ASC-LAST-UPD-ID         PIC  X(08).  01800049
018100                         30  ASC-LAST-UPD-DATE       PIC  X(10).  01810049
018200                                                                  01820049
018300             15  ASC-BLK-SUB                         PIC S9(04)   01830049
018400                                                          COMP    01840049
018500                                                          SYNC.   01850049
018600             15  ASC-ITEM-SUB                        PIC S9(04)   01860049
018700                                                          COMP    01870049
018800                                                          SYNC.   01880049
018900             15  ASC-SEL-SUB                         PIC S9(04)   01890049
019000                                                          COMP.   01900049
019100             15  ASC-SEL-ITEM                        PIC S9(04)   01910049
019200                                                          COMP.   01920049
019300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   01930049
019400                                                          COMP-3. 01940049
019500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   01950049
019600                                                          COMP-3. 01960049
019700             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   01970049
019800                                                          COMP-3. 01980049
019900             15  ASC-NUMBER-OF-RLTNSHPS              PIC S9(09)   01990049
020000                                                          COMP-3. 02000049
020100             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02010049
020200                                                          COMP-3. 02020049
020300             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02030049
020400                                                          COMP-3. 02040049
020500             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02050049
020600                                                          COMP-3. 02060049
020700             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02070049
020800                                                          COMP    02080049
020900                                                          SYNC.   02090049
021000             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02100049
021100                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   02110049
021200                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   02120049
021300             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  02130049
021400                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   02140049
021500                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   02150049
021600             15  ASC-LONGNAME-FOUND-SW               PIC  X(01).  02160051
021700                 88  ASC-LONGNAME-FOUND              VALUE 'Y'.   02170051
021800                 88  ASC-LONGNAME-NOT-FOUND          VALUE 'N'.   02180051
021900             15  ASC-LIST-QUEUE-NAME.                             02190049
022000                 20  ASC-LIST-TERM-ID                PIC  X(04).  02200049
022100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   02210049
022200                                                          COMP-3. 02220049
022300                 20  ASC-LIST-SEQ                    PIC  9(01).  02230049
022400             15  ASC-SEL-QUEUE-NAME-IN               PIC  X(08).  02240049
022500             15  ASC-SEL-QUEUE-NAME-OUT.                          02250049
022600                 20  ASC-SEL-TERM-ID-OUT             PIC  X(04).  02260049
022700                 20  ASC-SEL-TASK-NUMBER-OUT         PIC S9(05)   02270049
022800                                                          COMP-3. 02280049
022900                 20  ASC-SEL-SEQ-OUT                 PIC  9(01).  02290049
023000                                                                  02300049
023100             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  02310049
023200                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   02320049
023300             15  ASC-DISPLAY-ENT-ID                  PIC  9(09).  02330052
023400                                                                  02340049
023500*---------------------------------------------------------------* 02350049
023600*    ABEND PROCESSING COPYBOOK.                                 * 02360049
023700*---------------------------------------------------------------* 02370049
023800     COPY DPWS013.                                                02380049
023900                                                                  02390049
024000*---------------------------------------------------------------* 02400049
024100*    DB2 AREA FOR TENTNME                                       * 02410049
024200*---------------------------------------------------------------* 02420049
024300     EXEC SQL                                                     02430049
024400          INCLUDE TENTNME                                         02440049
024500     END-EXEC.                                                    02450049
024600                                                                  02460049
024700*---------------------------------------------------------------* 02470049
024800*    DB2 AREA FOR TEXTENT                                       * 02480049
024900*---------------------------------------------------------------* 02490049
025000     EXEC SQL                                                     02500049
025100          INCLUDE TEXTENT                                         02510049
025200     END-EXEC.                                                    02520049
025300                                                                  02530049
025400*---------------------------------------------------------------* 02540049
025500*    DB2 AREA FOR VNT_VND_RLTNSHP                               * 02550049
025600*---------------------------------------------------------------* 02560049
025700     EXEC SQL                                                     02570049
025800          INCLUDE VNT00000                                        02580049
025900     END-EXEC.                                                    02590049
026000                                                                  02600049
026100*--------------------------------------------------------------*  02610051
026200* TABLE USED FOR EXISTENCE CHECKING                            *  02620051
026300*--------------------------------------------------------------*  02630051
026400     EXEC SQL                                                     02640051
026500          INCLUDE SYSDUMMY                                        02650051
026600     END-EXEC.                                                    02660051
026700                                                                  02670051
026800*---------------------------------------------------------------* 02680049
026900*    DB2 AREA FOR COMMUNICATIONS                                * 02690049
027000*---------------------------------------------------------------* 02700049
027100     EXEC SQL                                                     02710049
027200          INCLUDE SQLCA                                           02720049
027300     END-EXEC.                                                    02730049
027400                                                                  02740049
027500*---------------------------------------------------------------* 02750049
027600*   CURSOR TO SELECT VENDOR RELATIONSHIPS                       * 02760049
027700*---------------------------------------------------------------* 02770049
027800                                                                  02780049
027900     EXEC SQL                                                     02790049
028000             DECLARE RELATIONSHIP-CSR CURSOR FOR                  02800049
028100          SELECT  V.RLTD_ENT_ID                                   02810049
028200                 ,V.EFF_BEG_DTE                                   02820049
028300                 ,V.EFF_END_DTE                                   02830049
028400                 ,V.CRE_DTE                                       02840049
028500                 ,V.LAST_UPD_TMST                                 02850049
028600                 ,V.LAST_UPD_BY_USR_ID                            02860049
028700                 ,A.ENT_NAME_DESC                                 02870049
028800                 ,B.DUN_NBR                                       02880049
028900          FROM VNT_VND_RLTNSHP V                                  02890049
029000              ,TENTNME A                                          02900049
029100              ,TEXTENT B                                          02910049
029200           WHERE V.ENT_ID        = :ASC-KEY-ENT-ID                02920049
029300             AND VND_RLTNSHP_CDE = :ASC-KEY-RLTNSHP-CDE           02930049
029400             AND V.EFF_END_DTE   = :PC-MAX-DATE                   02940049
029500             AND A.ENT_ID   = V.RLTD_ENT_ID                       02950049
029600             AND A.ENT_ID   = B.ENT_ID                            02960049
029700             AND A.TYPE_CDE = '01'                                02970049
029800             ORDER BY A.ENT_NAME_DESC                             02980049
029900     END-EXEC.                                                    02990049
030000                                                                  03000049
030100 LINKAGE SECTION.                                                 03010049
030200                                                                  03020049
030300 01  DFHCOMMAREA.                                                 03030049
030400     05  FILLER  OCCURS 1 TO 4072 TIMES                           03040049
030500                 DEPENDING ON EIBCALEN.                           03050049
030600         10  FILLER  PIC X.                                       03060049
030700                                                                  03070049
030800 PROCEDURE DIVISION.                                              03080049
030900***************************************************************** 03090049
031000**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 03100049
031100**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 03110049
031200**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 03120049
031300***************************************************************** 03130049
031400 0000-MAIN-MODULE.                                                03140049
031500                                                                  03150049
031600     INITIALIZE DP030-CICS-API-FIELDS.                            03160049
031700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03170049
031800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03180049
031900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03190049
032000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03200049
032100     MOVE LENGTH OF VN032AI        TO DP030-MAP-LENGTH (1).       03210049
032200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03220049
032300     PERFORM 0001-CALL-CICS-ARCH-API.                             03230049
032400                                                                  03240049
032500     PERFORM 1000-CONTROL-PROCESSING                              03250049
032600                                                                  03260049
032700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03270049
032800     PERFORM 0001-CALL-CICS-ARCH-API.                             03280049
032900                                                                  03290049
033000***************************************************************** 03300049
033100**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 03310049
033200**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 03320049
033300***************************************************************** 03330049
033400 0001-CALL-CICS-ARCH-API.                                         03340049
033500                                                                  03350049
033600*    CALL 'DPKCS030' USING DFHEIBLK                               03360054
033600     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03361054
033700                           DFHCOMMAREA                            03370049
033800                           DP030-CICS-API-FIELDS                  03380049
033900                           DP020-STANDARD-COMMAREA                03390049
034000                           VN032AI.                               03400049
034100                                                                  03410049
034200     IF  DP030-RC-CALL-SUCCESSFUL                                 03420049
034300         CONTINUE                                                 03430049
034400     ELSE                                                         03440049
034500         SET DP013-NO-ROLLBACK                                    03450049
034600             DP013-XCTL-DISPLAY-RESTART                           03460049
034700             DP013-CICS-ABEND      TO TRUE                        03470049
034800         MOVE '0001-CALL-CICS-ARCH-API'                           03480049
034900                                   TO DP013-PARAGRAPH             03490049
035000*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX03500054
035100*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      03510054
035000         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03511054
035100-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03512054
035200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03520049
035300         PERFORM DP013-0000-PROCESS-ABEND                         03530049
035400     END-IF.                                                      03540049
035500                                                                  03550049
035600*----------------------------------------------------------------*03560049
035700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03570049
035800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *03580049
035900*                                                                *03590049
036000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *03600049
036100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *03610049
036200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *03620049
036300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *03630049
036400*----------------------------------------------------------------*03640049
036500 1000-CONTROL-PROCESSING.                                         03650049
036600                                                                  03660049
036700     EVALUATE TRUE                                                03670049
036800         WHEN DP020-NEXT-ACT-INITIAL                              03680049
036900             INITIALIZE ASC-SPECIFIC-COMMAREA                     03690049
037000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            03700049
037100                                      ASC-SEL-TERM-ID-OUT         03710049
037200             MOVE DP020-SRC-TASK-NUMBER                           03720049
037300                                   TO ASC-LIST-TASK-NUMBER        03730049
037400                                      ASC-SEL-TASK-NUMBER-OUT     03740049
037500             MOVE PC-LIST-QUEUE-SEQ                               03750049
037600                                   TO ASC-LIST-SEQ                03760049
037700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             03770049
037800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 03780049
037900             IF  PS-COMMAREA-NOT-VALID                            03790049
038000                 SET DP020-MSG-FATAL                              03800049
038100                     DP020-NEXT-ACT-APPL-ERROR                    03810049
038200                                   TO TRUE                        03820049
038300             ELSE                                                 03830049
038400                 PERFORM 4000-BUILD-INITIAL-PANEL                 03840049
038500             END-IF                                               03850049
038600                                                                  03860049
038700         WHEN DP020-NEXT-ACT-READ-MAP                             03870049
038800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        03880049
038900                                   TO PV-TOP-ITEM                 03890049
039000             PERFORM 2000-PROCESS-PANEL                           03900049
039100                                                                  03910049
039200         WHEN DP020-NEXT-ACT-RETURN                               03920049
039300             PERFORM 2050-DELETE-LIST-QUEUE                       03930049
039400             PERFORM 4000-BUILD-INITIAL-PANEL                     03940049
039500                                                                  03950049
039600         WHEN OTHER                                               03960049
039700             SET DP013-LOGIC-ABEND TO TRUE                        03970049
039800             SET DP013-NO-ROLLBACK TO TRUE                        03980049
039900             MOVE '1000-CONTROL-PROCESSING'                       03990049
040000                                   TO DP013-PARAGRAPH             04000049
040100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04010049
040200                                   TO DP013-MESSAGE-TEXT(1)       04020049
040300             PERFORM DP013-0000-PROCESS-ABEND                     04030049
040400     END-EVALUATE.                                                04040049
040500                                                                  04050049
040600*----------------------------------------------------------------*04060049
040700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04070049
040800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *04080049
040900*----------------------------------------------------------------*04090049
041000 1100-PROCESS-INTER-APPL-COMM.                                    04100049
041100                                                                  04110049
041200     EVALUATE DP020-INT-APPL-FORMAT-IND                           04120049
041300         WHEN PC-INTER-APPL-LIST                                  04130049
041400              SET PS-COMMAREA-VALID                               04140049
041500                  ASC-USE-SELECTION-QUEUE                         04150049
041600                                   TO TRUE                        04160049
041700              MOVE VN020-ENT-ID TO ASC-KEY-ENT-ID                 04170049
041800                                   ASC-DISPLAY-ENT-ID             04180049
041900              MOVE VN020-VENDOR-NAME  TO ASC-KEY-VENDOR-NAME      04190049
042000              MOVE VN020-VENDOR-ID    TO ASC-KEY-VENDOR-ID        04200049
042100              MOVE VN020-NUMBER-OF-SELECTED-ITEMS                 04210049
042200                                   TO ASC-NUMBER-OF-SELECTED-ITEMS04220049
042300              MOVE VN020-NUMBER-OF-TS-ITEMS                       04230049
042400                                   TO ASC-NUMBER-OF-TS-ITEMS      04240049
042500              MOVE VN020-SEL-QUEUE-NAME                           04250049
042600                                   TO ASC-SEL-QUEUE-NAME-IN       04260049
042700              PERFORM 1120-PREPARE-LIST-ENTRY                     04270049
042800                                                                  04280049
042900         WHEN PC-INTER-APPL-DETAIL                                04290049
043000              SET PS-COMMAREA-VALID   TO TRUE                     04300049
043100              MOVE VN020-ENT-ID       TO ASC-KEY-ENT-ID           04310049
043200                                         ASC-DISPLAY-ENT-ID       04320049
043300              MOVE VN020-VENDOR-NAME  TO ASC-KEY-VENDOR-NAME      04330049
043400              MOVE VN020-VENDOR-ID    TO ASC-KEY-VENDOR-ID        04340049
043500              MOVE VN020-RLTNSHP-CDE  TO ASC-KEY-RLTNSHP-CDE      04350049
043600              MOVE VN020-RLTNSHP-NAME TO ASC-KEY-RLTNSHP-NAME     04360049
043700                                                                  04370049
043800         WHEN OTHER                                               04380049
043900                 MOVE PC-TSYMSG-00148                             04390049
044000                                   TO DP020-MSG-NUMBER            04400049
044100                 SET PS-COMMAREA-NOT-VALID                        04410049
044200                                   TO TRUE                        04420049
044300     END-EVALUATE.                                                04430049
044400                                                                  04440049
044500*----------------------------------------------------------------*04450049
044600*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *04460049
044700*  QUEUE PASSED FROM THE LIST.                                   *04470049
044800*                                                                *04480049
044900*----------------------------------------------------------------*04490049
045000 1120-PREPARE-LIST-ENTRY.                                         04500049
045100                                                                  04510049
045200      MOVE VN021-MAX-ITEMS TO ASC-SEL-SUB.                        04520049
045300      MOVE ZERO            TO ASC-SEL-ITEM.                       04530049
045400                                                                  04540049
045500      PERFORM 2300-GET-NEXT-MESSAGE.                              04550049
045600                                                                  04560049
045700                                                                  04570049
045800*----------------------------------------------------------------*04580049
045900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04590049
046000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04600049
046100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04610049
046200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04620049
046300* FUNCTION KEYS CAN GET THIS FAR.                                *04630049
046400*----------------------------------------------------------------*04640049
046500 2000-PROCESS-PANEL.                                              04650049
046600                                                                  04660049
046700     EVALUATE TRUE                                                04670049
046800         WHEN DP020-SRC-AID = DP016-CLEAR                         04680049
046900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04690049
047000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04700049
047100                                                                  04710049
047200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04720049
047300             PERFORM 2050-DELETE-LIST-QUEUE                       04730049
047400             PERFORM 4000-BUILD-INITIAL-PANEL                     04740049
047500                                                                  04750049
047600         WHEN DP020-FK-LOCAL-FUNC-06(DP020-SRC-AID)               04760049
047700             IF ASC-USE-SELECTION-QUEUE                           04770049
047800                 PERFORM 6200-DEL-LIST-QUEUE                      04780049
047900                 PERFORM 2300-GET-NEXT-MESSAGE                    04790049
048000                 PERFORM 4000-BUILD-INITIAL-PANEL                 04800049
048100             ELSE                                                 04810049
048200*                --- BOTTOM OF LIST ---                           04820049
048300                 MOVE PC-TSYMSG-00070                             04830049
048400                                   TO DP020-MSG-NUMBER            04840049
048500                 SET DP020-MSG-INFORMATIONAL                      04850049
048600                                   TO TRUE                        04860049
048700             END-IF                                               04870049
048800                                                                  04880049
048900         WHEN DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)               04890049
049000             IF ASC-USE-SELECTION-QUEUE                           04900049
049100                 PERFORM 6200-DEL-LIST-QUEUE                      04910049
049200                 PERFORM 2310-GET-PREV-MESSAGE                    04920049
049300                 PERFORM 4000-BUILD-INITIAL-PANEL                 04930049
049400             ELSE                                                 04940049
049500*                --- TOP OF LIST ---                              04950049
049600                 MOVE PC-TSYMSG-00069                             04960049
049700                                   TO DP020-MSG-NUMBER            04970049
049800                 SET DP020-MSG-INFORMATIONAL                      04980049
049900                                   TO TRUE                        04990049
050000             END-IF                                               05000049
050100                                                                  05010049
050200         WHEN OTHER                                               05020049
050300             SET DP030-CONTINUE-GO TO TRUE                        05030049
050400             PERFORM 2100-CHECK-FUNCTION-KEY                      05040049
050500     END-EVALUATE.                                                05050049
050600                                                                  05060049
050700*----------------------------------------------------------------*05070049
050800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05080049
050900*----------------------------------------------------------------*05090049
051000 2050-DELETE-LIST-QUEUE.                                          05100049
051100                                                                  05110049
051200     EXEC CICS                                                    05120049
051300         DELETEQ TS                                               05130049
051400             QUEUE (ASC-LIST-QUEUE-NAME)                          05140049
051500             RESP  (PV-CICS-RESP)                                 05150049
051600     END-EXEC.                                                    05160049
051700                                                                  05170049
051800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05180049
051900        (PV-CICS-RESP = DFHRESP(QIDERR))                          05190049
052000         CONTINUE                                                 05200049
052100     ELSE                                                         05210049
052200         SET DP013-CICS-ABEND      TO TRUE                        05220049
052300         SET DP013-NO-ROLLBACK     TO TRUE                        05230049
052400                                                                  05240049
052500         MOVE '2050-DELETE-LIST-QUEUE'                            05250049
052600                                   TO DP013-PARAGRAPH             05260049
052700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05270049
052800                                   TO DP013-MESSAGE-TEXT (1)      05280049
052900         PERFORM DP013-0000-PROCESS-ABEND                         05290049
053000     END-IF.                                                      05300049
053100                                                                  05310049
053200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05320049
053300                                                                  05330049
053400*----------------------------------------------------------------*05340049
053500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05350049
053600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05360049
053700* CICS ARCHITECTURE API.                                         *05370049
053800*----------------------------------------------------------------*05380049
053900 2100-CHECK-FUNCTION-KEY.                                         05390049
054000                                                                  05400049
054100     EVALUATE TRUE                                                05410049
054200         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               05420049
054300             INITIALIZE VN020-INTER-APPL-COMMAREA                 05430049
054400             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    05440049
054500                            TO VN020-NUMBER-OF-SELECTED-ITEMS     05450049
054600             MOVE ASC-KEY-ENT-ID                                  05460049
054700                            TO VN020-ENT-ID                       05470049
054800             MOVE ASC-KEY-VENDOR-NAME  TO VN020-VENDOR-NAME       05480049
054900             MOVE ASC-KEY-VENDOR-ID    TO VN020-VENDOR-ID         05490049
055000             MOVE ASC-KEY-RLTNSHP-CDE  TO VN020-RLTNSHP-CDE       05500049
055100             MOVE ASC-KEY-RLTNSHP-NAME TO VN020-RLTNSHP-NAME      05510049
055200             PERFORM 2500-CHECK-PARTNER-STATS                     05520051
055300                                                                  05530049
055400         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               05540049
055500             IF  ASC-NUMBER-OF-RLTNSHPS = ZERO                    05550049
055600                 SET DP020-MSG-FATAL                              05560049
055700                     DP030-OVERRIDE-GO TO  TRUE                   05570049
055800                 MOVE PC-TSYMSG-03375  TO  DP020-MSG-NUMBER       05580049
055900             ELSE                                                 05590049
056000                 INITIALIZE VN020-INTER-APPL-COMMAREA             05600049
056100                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05610049
056200                            TO VN020-NUMBER-OF-SELECTED-ITEMS     05620049
056300                 MOVE ASC-KEY-ENT-ID                              05630049
056400                            TO VN020-ENT-ID                       05640049
056500                 MOVE ASC-KEY-VENDOR-NAME  TO VN020-VENDOR-NAME   05650049
056600                 MOVE ASC-KEY-VENDOR-ID    TO VN020-VENDOR-ID     05660049
056700                 MOVE ASC-KEY-RLTNSHP-CDE  TO VN020-RLTNSHP-CDE   05670049
056800                 MOVE ASC-KEY-RLTNSHP-NAME TO VN020-RLTNSHP-NAME  05680049
056900                 MOVE ASC-RLTD-ENT-ID (ASC-BLK-SUB ASC-ITEM-SUB)  05690049
057000                                       TO VN020-RLTD-ENT-ID       05700049
057100                 MOVE ASC-RLTD-VEND-ID (ASC-BLK-SUB ASC-ITEM-SUB) 05710049
057200                                       TO VN020-RLTD-VENDOR-ID    05720049
057300                 MOVE ASC-RLTD-VEND-NAME(ASC-BLK-SUB ASC-ITEM-SUB)05730049
057400                                       TO VN020-RLTD-VENDOR-NAME  05740049
057500                 PERFORM 2500-CHECK-PARTNER-STATS                 05750051
057600             END-IF                                               05760049
057700                                                                  05770049
057800         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               05780049
057900             PERFORM 2110-BROWSE-BACKWARD                         05790049
058000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05800049
058100                                                                  05810049
058200         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               05820049
058300             PERFORM 2120-BROWSE-FORWARD                          05830049
058400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05840049
058500                                                                  05850049
058600         WHEN DP020-SRC-AID = DP016-ENTER                         05860049
058700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05870049
058800                                                                  05880049
058900         WHEN OTHER                                               05890049
059000             SET DP013-NO-ROLLBACK                                05900049
059100                 DP013-XCTL-DISPLAY-RESTART                       05910049
059200                 DP013-CICS-ABEND  TO TRUE                        05920049
059300             MOVE '2100-CHECK-FUNCTION-KEY'                       05930049
059400                                   TO DP013-PARAGRAPH             05940049
059500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05950049
059600                                   TO DP013-MESSAGE-TEXT (1)      05960049
059700             PERFORM DP013-0000-PROCESS-ABEND                     05970049
059800     END-EVALUATE.                                                05980049
059900                                                                  05990049
060000*----------------------------------------------------------------*06000049
060100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06010049
060200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06020049
060300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06030049
060400*    MESSAGE.                                                    *06040049
060500*----------------------------------------------------------------*06050049
060600 2110-BROWSE-BACKWARD.                                            06060049
060700                                                                  06070049
060800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06080049
060900         GIVING PV-TOP-ITEM.                                      06090049
061000                                                                  06100049
061100     IF  ((PV-TOP-ITEM < +1)                                      06110049
061200       OR (PV-TOP-ITEM = +1))                                     06120049
061300         MOVE +1                   TO PV-TOP-ITEM                 06130049
061400*        -- TOP OF LIST --                                        06140049
061500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06150049
061600         SET DP020-MSG-INFORMATIONAL TO TRUE                      06160049
061700     END-IF.                                                      06170049
061800                                                                  06180049
061900*----------------------------------------------------------------*06190049
062000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06200049
062100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06210049
062200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06220049
062300*----------------------------------------------------------------*06230049
062400 2120-BROWSE-FORWARD.                                             06240049
062500                                                                  06250049
062600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06260049
062700         GIVING PV-TOP-ITEM.                                      06270049
062800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06280049
062900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06290049
063000                                   TO PV-TOP-ITEM                 06300049
063100*        -- BOTTOM OF LIST --                                     06310049
063200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06320049
063300         SET DP020-MSG-INFORMATIONAL                              06330049
063400                                   TO TRUE                        06340049
063500     ELSE                                                         06350049
063600         COMPUTE PV-BOTTOM-ITEM =                                 06360049
063700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06370049
063800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06380049
063900*            -- BOTTOM OF LIST --                                 06390049
064000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06400049
064100             SET DP020-MSG-INFORMATIONAL                          06410049
064200                                   TO TRUE                        06420049
064300         END-IF                                                   06430049
064400     END-IF.                                                      06440049
064500                                                                  06450049
064600******************************************************************06460049
064700* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *06470049
064800* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *06480049
064900******************************************************************06490049
065000 2300-GET-NEXT-MESSAGE.                                           06500049
065100                                                                  06510049
065200     ADD +1                        TO ASC-SEL-SUB.                06520049
065300     IF ASC-SEL-SUB > VN021-MAX-ITEMS                             06530049
065400         ADD +1                    TO ASC-SEL-ITEM                06540049
065500         MOVE +1                   TO ASC-SEL-SUB                 06550049
065600     END-IF.                                                      06560049
065700     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 06570049
065800         PERFORM 9100-READ-SEL-QUEUE                              06580049
065900         IF VN021-ITEM (ASC-SEL-SUB) > ZERO                       06590049
066000             MOVE VN021-RLTNSHP-CDE (ASC-SEL-SUB)                 06600049
066100                                   TO ASC-KEY-RLTNSHP-CDE         06610049
066200             MOVE VN021-RLTNSHP-NAME (ASC-SEL-SUB)                06620049
066300                                   TO ASC-KEY-RLTNSHP-NAME        06630049
066400             SET VN021-INQ (ASC-SEL-SUB)                          06640049
066500                                   TO TRUE                        06650049
066600             PERFORM 9200-REWRITE-LIST-QUEUE                      06660049
066700         ELSE                                                     06670049
066800             SUBTRACT +1 FROM ASC-SEL-SUB                         06680049
066900*            --- BOTTOM OF LIST ---                               06690049
067000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06700049
067100             SET DP020-MSG-INFORMATIONAL                          06710049
067200                                   TO TRUE                        06720049
067300         END-IF                                                   06730049
067400     ELSE                                                         06740049
067500         SUBTRACT +1 FROM ASC-SEL-ITEM                            06750049
067600         MOVE VN021-MAX-ITEMS      TO ASC-SEL-SUB                 06760049
067700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06770049
067800         SET DP020-MSG-INFORMATIONAL                              06780049
067900                                   TO TRUE                        06790049
068000     END-IF.                                                      06800049
068100                                                                  06810049
068200******************************************************************06820049
068300* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *06830049
068400* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *06840049
068500******************************************************************06850049
068600 2310-GET-PREV-MESSAGE.                                           06860049
068700                                                                  06870049
068800     SUBTRACT +1 FROM ASC-SEL-SUB.                                06880049
068900     IF ASC-SEL-SUB < +1                                          06890049
069000         SUBTRACT +1 FROM ASC-SEL-ITEM                            06900049
069100         MOVE VN021-MAX-ITEMS      TO ASC-SEL-SUB                 06910049
069200     END-IF.                                                      06920049
069300                                                                  06930049
069400     IF ASC-SEL-ITEM > ZERO                                       06940049
069500         PERFORM 9100-READ-SEL-QUEUE                              06950049
069600         MOVE VN021-RLTNSHP-CDE (ASC-SEL-SUB)                     06960049
069700                                   TO ASC-KEY-RLTNSHP-CDE         06970049
069800         MOVE VN021-RLTNSHP-NAME (ASC-SEL-SUB)                    06980049
069900                                   TO ASC-KEY-RLTNSHP-NAME        06990049
070000     ELSE                                                         07000049
070100         MOVE +1                   TO ASC-SEL-ITEM                07010049
070200                                      ASC-SEL-SUB                 07020049
070300*        --- TOP OF LIST ---                                      07030049
070400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07040049
070500         SET DP020-MSG-INFORMATIONAL                              07050049
070600                                   TO TRUE                        07060049
070700     END-IF.                                                      07070049
070800                                                                  07080049
070900*----------------------------------------------------------------*07090051
071000* CHECK IF ENT-ID BEING PROCESSED IS A PARTNER TYPE OF IMPORT    *07100051
071100* PARENT (S2) OR FACTORY (FA) THAT IS IN RMS PO AND HAS A LONG   *07110051
071200* NAME.  THE ADD OR UPDATE OF A RELATIONSHIP WILL BE BLOCKED     *07120051
071300* UNTIL THE PARTNER (S2, FA) HAS A LONGNAME AND IS IN RMS PO.    *07130051
071400*----------------------------------------------------------------*07140051
071500 2500-CHECK-PARTNER-STATS.                                        07150051
071600     MOVE SPACE TO ASC-LONGNAME-FOUND-SW.                         07160051
071700                                                                  07170051
071800     PERFORM 3320-GET-VENDOR-INFO.                                07180051
071900                                                                  07190051
072000     IF EXTENT-PRTNR-IND = 'Y'                                    07200051
072100        IF EXTENT-PRTNR-TYP-CDE = 'S2' OR 'FA'                    07210051
072200           IF EXTENT-VND-IN-RMS-IND = 'Y'                         07220051
072300              PERFORM 3330-CHECK-LONGNAME-EXISTENCE               07230051
072400              IF ASC-LONGNAME-NOT-FOUND                           07240051
072500                 SET PS-ERROR          TO TRUE                    07250051
072600                 SET DP030-OVERRIDE-GO                            07260051
072700                     DP030-SET-CURSOR-APPL-1                      07270051
072800                     DP020-MSG-FATAL  TO TRUE                     07280051
072900*                MOVE -1  TO MR-SELECTL (1)                       07290051
073000                 IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)        07300051
073100***      --- CANNOT ADD A RELATIONSHIP UNTIL A LONG NAME          07310051
073200***      --- HAS BEEN ADDED                                       07320051
073300                    MOVE PC-TSYMSG-03630  TO DP020-MSG-NUMBER     07330051
073400                 END-IF                                           07340051
073500                 IF DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)        07350051
073600***      --- CANNOT UPDATE A RELATIONSHIP UNTIL A LONG NAME       07360051
073700***      --- HAS BEEN ADDED                                       07370051
073800                    MOVE PC-TSYMSG-03634  TO DP020-MSG-NUMBER     07380051
073900                 END-IF                                           07390051
074000              END-IF                                              07400051
074100           ELSE                                                   07410051
074200              SET PS-ERROR          TO TRUE                       07420051
074300              SET DP030-OVERRIDE-GO                               07430051
074400                  DP030-SET-CURSOR-APPL-1                         07440051
074500                  DP020-MSG-FATAL  TO TRUE                        07450051
074600*             MOVE -1  TO MR-SELECTL (1)                          07460051
074700              IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)           07470051
074800***      --- CANNOT ADD A RELATIONSHIP BECAUSE PARTNER (S2, FA)   07480051
074900***      --- IS NOT IN RMS PO                                     07490051
075000                 MOVE PC-TSYMSG-03632  TO DP020-MSG-NUMBER        07500051
075100              END-IF                                              07510051
075200              IF DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)           07520051
075300***      --- CANNOT UPDATE A RELATIONSHIP BECAUSE PARTNER         07530051
075400***      --- (S2, FA) IS NOT IN RMS PO                            07540051
075500                 MOVE PC-TSYMSG-03635  TO DP020-MSG-NUMBER        07550051
075600              END-IF                                              07560051
075700           END-IF                                                 07570051
075800        END-IF                                                    07580051
075900     END-IF.                                                      07590051
076000                                                                  07600051
076100*----------------------------------------------------------------*07610051
076200* SELECT THE VENDOR INFO FOR THE ENTID BEING PROCESSED.          *07620051
076300*----------------------------------------------------------------*07630051
076400 3320-GET-VENDOR-INFO.                                            07640051
076500     PERFORM                                                      07650051
076600         WITH TEST AFTER                                          07660051
076700         VARYING PV-RETRY-COUNTER                                 07670051
076800         FROM 1 BY 1                                              07680051
076900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07690051
077000                   OR (SQLCODE = ZERO))                           07700051
077100                                                                  07710051
077200         EXEC SQL                                                 07720051
077300             SELECT PRTNR_IND                                     07730051
077400                   ,VND_IN_RMS_IND                                07740051
077500                   ,PRTNR_TYP_CDE                                 07750051
077600              INTO  :EXTENT-PRTNR-IND                             07760051
077700                   ,:EXTENT-VND-IN-RMS-IND                        07770051
077800                   ,:EXTENT-PRTNR-TYP-CDE                         07780051
077900              FROM  TEXTENT                                       07790051
078000             WHERE  ENT_ID   = :ASC-KEY-ENT-ID                    07800051
078100         END-EXEC                                                 07810051
078200                                                                  07820051
078300         EVALUATE TRUE                                            07830051
078400             WHEN SQLCODE = ZERO                                  07840051
078500             WHEN SQLCODE = -904                                  07850051
078600             WHEN SQLCODE = -913                                  07860051
078700                 CONTINUE                                         07870051
078800             WHEN SQLWARN0 NOT = SPACES                           07880051
078900             WHEN SQLCODE < ZERO                                  07890051
079000             WHEN SQLCODE > ZERO                                  07900051
079100                 MOVE '3320-GET-VENDOR-INFO     '                 07910051
079200                                   TO DP013-PARAGRAPH             07920051
079300                 MOVE 'SELECT VENDOR NUMBER'                      07930051
079400                                   TO DP013-MESSAGE-TEXT (1)      07940051
079500                 MOVE SQLCA        TO DP013-SQLCA                 07950051
079600                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    07960051
079700                 SET DP013-DB2-ABEND                              07970051
079800                     DP013-XCTL-DISPLAY-RESTART                   07980051
079900                                   TO TRUE                        07990051
080000                 PERFORM DP013-0000-PROCESS-ABEND                 08000051
080100         END-EVALUATE                                             08010051
080200     END-PERFORM.                                                 08020051
080300*                                                                 08030051
080400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08040051
080500         MOVE '3320-GET-VENDOR-INFO     '                         08050051
080600                                   TO DP013-PARAGRAPH             08060051
080700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     08070051
080800                                   TO DP013-MESSAGE-TEXT (1)      08080051
080900         MOVE 'VENDOR NUMBER'      TO DP013-MESSAGE-TEXT (2)      08090051
081000         MOVE SQLCA                TO DP013-SQLCA                 08100051
081100         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    08110051
081200         SET DP013-DB2-ABEND                                      08120051
081300             DP013-XCTL-DISPLAY-RESTART                           08130051
081400                                   TO TRUE                        08140051
081500         PERFORM DP013-0000-PROCESS-ABEND                         08150051
081600     END-IF.                                                      08160051
081700                                                                  08170051
081800*----------------------------------------------------------------*08180051
081900*  CHECK FOR IF TYPE CODE FOR LONG NAME EXISTS ON TENTNME FOR THE 08190051
082000*  VENDOR BEING PROCESSED.                                        08200051
082100*----------------------------------------------------------------*08210051
082200 3330-CHECK-LONGNAME-EXISTENCE.                                   08220051
082300     PERFORM                                                      08230051
082400         WITH TEST AFTER                                          08240051
082500         VARYING PV-RETRY-COUNTER                                 08250051
082600         FROM 1 BY 1                                              08260051
082700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08270051
082800                   OR (SQLCODE = ZERO)                            08280051
082900                   OR (SQLCODE = +100)                            08290051
083000                   OR (SQLCODE = -811))                           08300051
083100                                                                  08310051
083200         EXEC SQL                                                 08320051
083300           SELECT '1'                                             08330051
083400            INTO  :PV-ONE                                         08340051
083500             FROM SYSIBM.SYSDUMMY1 X                              08350051
083600            WHERE EXISTS (SELECT 1                                08360051
083700                            FROM TENTNME                          08370051
083800                           WHERE ENT_ID = :ASC-KEY-ENT-ID         08380051
083900                             AND TYPE_CDE = '05'                  08390051
084000                             AND X.IBMREQD = X.IBMREQD)           08400051
084100         END-EXEC                                                 08410051
084200                                                                  08420051
084300         EVALUATE TRUE                                            08430051
084400             WHEN SQLCODE = ZERO                                  08440051
084500             WHEN SQLCODE = -811                                  08450051
084600                 SET ASC-LONGNAME-FOUND TO TRUE                   08460051
084700             WHEN SQLCODE = +100                                  08470051
084800                 SET ASC-LONGNAME-NOT-FOUND TO TRUE               08480051
084900             WHEN SQLCODE = -904                                  08490051
085000             WHEN SQLCODE = -913                                  08500051
085100                 CONTINUE                                         08510051
085200             WHEN SQLWARN0 NOT = SPACES                           08520051
085300             WHEN SQLCODE < ZERO                                  08530051
085400             WHEN SQLCODE > ZERO                                  08540051
085500                 MOVE '3330-CHECK-LONGNAME-EXISTENCE'             08550051
085600                                   TO DP013-PARAGRAPH             08560051
085700                 MOVE 'CHECK IF LONG NAME ALREADY EXISTS'         08570051
085800                                   TO DP013-MESSAGE-TEXT (1)      08580051
085900                 MOVE SPACE        TO DP013-MESSAGE-TEXT (2)      08590051
086000                 MOVE SQLCA        TO DP013-SQLCA                 08600051
086100                 MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)    08610051
086200                 SET DP013-DB2-ABEND                              08620051
086300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08630051
086400                 PERFORM DP013-0000-PROCESS-ABEND                 08640051
086500         END-EVALUATE                                             08650051
086600     END-PERFORM.                                                 08660051
086700                                                                  08670051
086800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08680051
086900         MOVE '3330-CHECK-LONGNAME-EXISTENCE'                     08690051
087000                                   TO DP013-PARAGRAPH             08700051
087100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO CHECK '     08710051
087200                                   TO DP013-MESSAGE-TEXT (1)      08720051
087300         MOVE 'FOR LONG NAME EXISTENCE '                          08730051
087400                                   TO DP013-MESSAGE-TEXT (2)      08740051
087500         MOVE SPACE                TO DP013-MESSAGE-TEXT (3)      08750051
087600         MOVE SQLCA                TO DP013-SQLCA                 08760051
087700         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    08770051
087800         SET DP013-DB2-ABEND                                      08780051
087900             DP013-XCTL-DISPLAY-RESTART                           08790051
088000                                   TO TRUE                        08800051
088100         PERFORM DP013-0000-PROCESS-ABEND                         08810051
088200     END-IF.                                                      08820051
088300                                                                  08830051
088400*----------------------------------------------------------------*08840049
088500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08850049
088600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08860049
088700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08870049
088800*    DISPLAY THE PANEL TO USER.                                  *08880049
088900*----------------------------------------------------------------*08890049
089000 4000-BUILD-INITIAL-PANEL.                                        08900049
089100                                                                  08910049
089200     INITIALIZE ASC-BLOCK-ENTRIES (1)                             08920049
089300                ASC-BLOCK-ENTRIES (2).                            08930049
089400     MOVE +1 TO ASC-BLK-SUB.                                      08940049
089500     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            08950049
089600     MOVE ZERO TO ASC-ITEM-SUB                                    08960049
089700                  ASC-NUMBER-OF-ITEMS-READ                        08970049
089800                  ASC-NUMBER-OF-SELECTED-ITEMS                    08980049
089900                  ASC-HIGHEST-BLOCK-WRITTEN                       08990049
090000                  ASC-ITEM-AT-TOP-OF-PANEL.                       09000049
090100                                                                  09010049
090200     PERFORM 4010-OPEN-CURSOR.                                    09020049
090300                                                                  09030049
090400     PERFORM 4300-READ-ITEMS-FROM-DB.                             09040049
090500                                                                  09050049
090600     PERFORM 4020-CLOSE-CURSOR.                                   09060049
090700                                                                  09070049
090800     IF  ASC-NUMBER-OF-RLTNSHPS = ZERO                            09080049
090900         SET DP020-MSG-WARNING TO  TRUE                           09090049
091000         MOVE PC-TSYMSG-03375  TO  DP020-MSG-NUMBER               09100049
091100     END-IF.                                                      09110049
091200     MOVE +1               TO PV-TOP-ITEM.                        09120049
091300     SET DP030-SET-CURSOR-TRAILER TO TRUE.                        09130049
091400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09140049
091500                                                                  09150049
091600 4010-OPEN-CURSOR.                                                09160049
091700                                                                  09170049
091800     PERFORM                                                      09180049
091900         WITH TEST AFTER                                          09190049
092000         VARYING PV-RETRY-COUNTER                                 09200049
092100         FROM 1 BY 1                                              09210049
092200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09220049
092300                   OR (SQLCODE = ZERO))                           09230049
092400                                                                  09240049
092500         EXEC SQL                                                 09250049
092600             OPEN RELATIONSHIP-CSR                                09260049
092700         END-EXEC                                                 09270049
092800                                                                  09280049
092900         EVALUATE TRUE                                            09290049
093000             WHEN SQLCODE = ZERO                                  09300049
093100             WHEN SQLCODE = -904                                  09310049
093200             WHEN SQLCODE = -913                                  09320049
093300                 CONTINUE                                         09330049
093400                                                                  09340049
093500             WHEN SQLWARN0 NOT = SPACES                           09350049
093600             WHEN SQLCODE < ZERO                                  09360049
093700             WHEN SQLCODE > ZERO                                  09370049
093800                 MOVE '4010-OPEN-CURSOR'                          09380049
093900                                   TO DP013-PARAGRAPH             09390049
094000                 MOVE 'OPEN VENDOR RELATIONSHIP CURSOR - '        09400049
094100                                   TO DP013-MESSAGE-TEXT (1)      09410049
094200                 MOVE SQLCA        TO DP013-SQLCA                 09420049
094300                 MOVE 'VNT_RLTNSHP_CDE'                           09430049
094400                                   TO DP013-DB2-TABLE-NAME (1)    09440049
094500                 SET DP013-DB2-ABEND                              09450049
094600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09460049
094700                 PERFORM DP013-0000-PROCESS-ABEND                 09470049
094800         END-EVALUATE                                             09480049
094900     END-PERFORM.                                                 09490049
095000                                                                  09500049
095100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09510049
095200         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             09520049
095300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09530049
095400                                   TO DP013-MESSAGE-TEXT (1)      09540049
095500         MOVE SQLCA                TO DP013-SQLCA                 09550049
095600         MOVE 'VNT_RLTNSHP_CDE' TO DP013-DB2-TABLE-NAME (1)       09560049
095700         SET DP013-DB2-ABEND                                      09570049
095800             DP013-XCTL-DISPLAY-RESTART                           09580049
095900                                   TO TRUE                        09590049
096000         PERFORM DP013-0000-PROCESS-ABEND                         09600049
096100     END-IF.                                                      09610049
096200                                                                  09620049
096300 4020-CLOSE-CURSOR.                                               09630049
096400                                                                  09640049
096500     EXEC SQL                                                     09650049
096600         CLOSE RELATIONSHIP-CSR                                   09660049
096700     END-EXEC                                                     09670049
096800                                                                  09680049
096900     EVALUATE TRUE                                                09690049
097000         WHEN SQLCODE = ZERO                                      09700049
097100             CONTINUE                                             09710049
097200                                                                  09720049
097300         WHEN SQLWARN0 NOT = SPACES                               09730049
097400         WHEN SQLCODE < ZERO                                      09740049
097500         WHEN SQLCODE > ZERO                                      09750049
097600             MOVE '4020-CLOSE-CURSOR'                             09760049
097700                               TO DP013-PARAGRAPH                 09770049
097800             MOVE 'CLOSE VENDOR DEPARTMENT CURSOR '               09780049
097900                               TO DP013-MESSAGE-TEXT (1)          09790049
098000             MOVE SQLCA        TO DP013-SQLCA                     09800049
098100             MOVE 'VNT_RLTNSHP_CDE' TO DP013-DB2-TABLE-NAME (1)   09810049
098200             SET DP013-DB2-ABEND                                  09820049
098300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09830049
098400             PERFORM DP013-0000-PROCESS-ABEND                     09840049
098500     END-EVALUATE.                                                09850049
098600                                                                  09860049
098700*---------------------------------------------------------------* 09870049
098800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE   * 09880049
098900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,    * 09890049
099000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND * 09900049
099100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE    * 09910049
099200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                  * 09920049
099300*---------------------------------------------------------------* 09930049
099400                                                                  09940049
099500 4300-READ-ITEMS-FROM-DB.                                         09950049
099600                                                                  09960049
099700     PERFORM                                                      09970049
099800         VARYING PV-READ-COUNT                                    09980049
099900         FROM 1 BY 1                                              09990049
100000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10000049
100100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         10010049
100200                                                                  10020049
100300         PERFORM 4310-FETCH                                       10030049
100400                                                                  10040049
100500         IF  ASC-ITEMS-LEFT-ON-DB                                 10050049
100600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                10060049
100700                 ADD +1            TO ASC-ITEM-SUB                10070049
100800             ELSE                                                 10080049
100900                 ADD +1            TO ASC-BLK-SUB                 10090049
101000                 MOVE +1           TO ASC-ITEM-SUB                10100049
101100                                                                  10110049
101200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         10120049
101300                     MOVE +1       TO ASC-BLK-SUB                 10130049
101400                     SET ASC-BLOCK-MODIFIED (1)                   10140049
101500                                   TO TRUE                        10150049
101600                     PERFORM 5100-WRITE-TEMP-STORAGE              10160049
101700                     MOVE ASC-BLOCK-ENTRIES                       10170049
101800                               (PC-MAX-BLOCKS-IN-ARRAY)           10180049
101900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 10190049
102000                     ADD +1        TO ASC-BLK-SUB                 10200049
102100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   10210049
102200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      10220049
102300                                   TO TRUE                        10230049
102400                 END-IF                                           10240049
102500             END-IF                                               10250049
102600             ADD +1                   TO ASC-NUMBER-OF-ITEMS-READ 10260049
102700             MOVE ASC-NUMBER-OF-ITEMS-READ                        10270049
102800                                      TO ASC-LIST-ITEM-NUMBER     10280049
102900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10290049
103000             MOVE ENTNME-ENT-NAME-DESC                            10300049
103100                                      TO ASC-RLTD-VEND-NAME       10310049
103200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10320049
103300             MOVE EXTENT-DUN-NBR      TO ASC-RLTD-VEND-ID         10330049
103400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10340049
103500             MOVE VNT00000-RLTD-ENT-ID                            10350049
103600                                      TO ASC-RLTD-ENT-ID          10360049
103700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10370049
103800             MOVE VNT00000-EFF-BEG-DTE(6:2)                       10380049
103900                                      TO PV-WORK-MM               10390049
104000             MOVE VNT00000-EFF-BEG-DTE(9:2)                       10400049
104100                                      TO PV-WORK-DD               10410049
104200             MOVE VNT00000-EFF-BEG-DTE(1:4)                       10420049
104300                                      TO PV-WORK-YYYY             10430049
104400             MOVE PV-WORK-DATE        TO ASC-EFF-DATE             10440049
104500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10450049
104600             MOVE VNT00000-EFF-END-DTE(6:2)                       10460049
104700                                      TO PV-WORK-MM               10470049
104800             MOVE VNT00000-EFF-END-DTE(9:2)                       10480049
104900                                      TO PV-WORK-DD               10490049
105000             MOVE VNT00000-EFF-END-DTE(1:4)                       10500049
105100                                      TO PV-WORK-YYYY             10510049
105200             MOVE PV-WORK-DATE        TO ASC-EXP-DATE             10520049
105300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10530049
105400             MOVE VNT00000-LAST-UPD-TMST(6:2)                     10540049
105500                                      TO PV-WORK-MM               10550049
105600             MOVE VNT00000-LAST-UPD-TMST(9:2)                     10560049
105700                                      TO PV-WORK-DD               10570049
105800             MOVE VNT00000-LAST-UPD-TMST(1:4)                     10580049
105900                                      TO PV-WORK-YYYY             10590049
106000             MOVE PV-WORK-DATE        TO ASC-LAST-UPD-DATE        10600049
106100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10610049
106200             MOVE VNT00000-LAST-UPD-BY-USR-ID                     10620049
106300                                      TO ASC-LAST-UPD-ID          10630049
106400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10640049
106500             MOVE VNT00000-CRE-DTE(6:2)                           10650049
106600                                      TO PV-WORK-MM               10660049
106700             MOVE VNT00000-CRE-DTE(9:2)                           10670049
106800                                      TO PV-WORK-DD               10680049
106900             MOVE VNT00000-CRE-DTE(1:4)                           10690049
107000                                      TO PV-WORK-YYYY             10700049
107100             MOVE PV-WORK-DATE        TO ASC-DATE-ADDED           10710049
107200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10720049
107300         END-IF                                                   10730049
107400     END-PERFORM.                                                 10740049
107500                                                                  10750049
107600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-NUMBER-OF-RLTNSHPS      10760049
107700     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           10770049
107800         MOVE +1 TO ASC-BLK-SUB                                   10780049
107900                                                                  10790049
108000         PERFORM 5100-WRITE-TEMP-STORAGE                          10800049
108100                                                                  10810049
108200         ADD  +1 TO ASC-BLK-SUB                                   10820049
108300                                                                  10830049
108400         PERFORM 5100-WRITE-TEMP-STORAGE                          10840049
108500                                                                  10850049
108600         MOVE 1 TO ASC-BLK-SUB                                    10860049
108700                   PV-BLOCK-NUMBER                                10870049
108800                                                                  10880049
108900         PERFORM 4410-READ-TEMP-STORAGE                           10890049
109000                                                                  10900049
109100         IF ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1              10910049
109200             MOVE 2 TO ASC-BLK-SUB                                10920049
109300                       PV-BLOCK-NUMBER                            10930049
109400                                                                  10940049
109500             PERFORM 4410-READ-TEMP-STORAGE                       10950049
109600         END-IF                                                   10960049
109700         ELSE                                                     10970049
109800                 MOVE +1           TO ASC-BLK-SUB                 10980049
109900                                      ASC-ITEM-SUB                10990049
110000                 MOVE SPACES          TO ASC-RLTD-VEND-NAME       11000049
110100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11010049
110200                                         ASC-EFF-DATE             11020049
110300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11030049
110400                                         ASC-EXP-DATE             11040049
110500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11050049
110600                                         ASC-LAST-UPD-DATE        11060049
110700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11070049
110800                                         ASC-LAST-UPD-ID          11080049
110900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11090049
111000                                         ASC-DATE-ADDED           11100049
111100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11110049
111200                 MOVE ZEROES          TO ASC-RLTD-ENT-ID          11120049
111300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11130049
111400                                         ASC-RLTD-VEND-ID         11140049
111500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11150049
111600                 SET ASC-BLOCK-MODIFIED (1)                       11160049
111700                                   TO TRUE                        11170049
111800             ADD +1                   TO ASC-NUMBER-OF-ITEMS-READ 11180049
111900             MOVE ASC-NUMBER-OF-ITEMS-READ                        11190049
112000                                      TO ASC-LIST-ITEM-NUMBER     11200049
112100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11210049
112200                 PERFORM 5100-WRITE-TEMP-STORAGE                  11220049
112300                 MOVE ASC-BLOCK-ENTRIES                           11230049
112400                               (PC-MAX-BLOCKS-IN-ARRAY)           11240049
112500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 11250049
112600                 ADD +1        TO ASC-BLK-SUB                     11260049
112700                 INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)       11270049
112800                 SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)          11280049
112900                                   TO TRUE                        11290049
113000                 MOVE 1 TO ASC-BLK-SUB                            11300049
113100                           PV-BLOCK-NUMBER                        11310049
113200                                                                  11320049
113300                 PERFORM 4410-READ-TEMP-STORAGE                   11330049
113400     END-IF.                                                      11340049
113500*----------------------------------------------------------------*11350049
113600*----------------------------------------------------------------*11360049
113700                                                                  11370049
113800 4310-FETCH.                                                      11380049
113900                                                                  11390049
114000     EXEC SQL                                                     11400049
114100             FETCH RELATIONSHIP-CSR                               11410049
114200              INTO :VNT00000-RLTD-ENT-ID                          11420049
114300                  ,:VNT00000-EFF-BEG-DTE                          11430049
114400                  ,:VNT00000-EFF-END-DTE                          11440049
114500                  ,:VNT00000-CRE-DTE                              11450049
114600                  ,:VNT00000-LAST-UPD-TMST                        11460049
114700                  ,:VNT00000-LAST-UPD-BY-USR-ID                   11470049
114800                  ,:ENTNME-ENT-NAME-DESC                          11480049
114900                  ,:EXTENT-DUN-NBR                                11490049
115000     END-EXEC                                                     11500049
115100                                                                  11510049
115200     EVALUATE TRUE                                                11520049
115300         WHEN SQLCODE = ZERO                                      11530049
115400         WHEN SQLCODE = +100                                      11540049
115500              CONTINUE                                            11550049
115600                                                                  11560049
115700         WHEN SQLWARN0 NOT = SPACE                                11570049
115800         WHEN SQLCODE NOT = ZERO                                  11580049
115900              MOVE '4310-FETCH-CURSOR'                            11590049
116000                               TO DP013-PARAGRAPH                 11600049
116100              MOVE 'FETCH VENDOR DEPARTMENT CURSOR'               11610049
116200                               TO DP013-MESSAGE-TEXT (1)          11620049
116300              MOVE SQLCA       TO DP013-SQLCA                     11630049
116400              SET DP013-DB2-ABEND                                 11640049
116500                               TO TRUE                            11650049
116600              PERFORM DP013-0000-PROCESS-ABEND                    11660049
116700     END-EVALUATE.                                                11670049
116800                                                                  11680049
116900     IF SQLCODE = +100                                            11690049
117000         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE.                     11700049
117100                                                                  11710049
117200*----------------------------------------------------------------*11720049
117300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *11730049
117400*----------------------------------------------------------------*11740049
117500 4400-MOVE-COMMAREA-TO-SCREEN.                                    11750049
117600                                                                  11760049
117700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             11770049
117800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          11780049
117900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          11790049
118000             MOVE +1    TO ASC-BLK-SUB                            11800049
118100             PERFORM 5100-WRITE-TEMP-STORAGE                      11810049
118200             ADD +1     TO ASC-BLK-SUB                            11820049
118300             PERFORM 5100-WRITE-TEMP-STORAGE                      11830049
118400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             11840049
118500                 GIVING PV-BLOCK-NUMBER                           11850049
118600                 REMAINDER PV-REMAINDER                           11860049
118700             IF  PV-REMAINDER > ZERO                              11870049
118800                 ADD +1 TO PV-BLOCK-NUMBER                        11880049
118900             END-IF                                               11890049
119000             MOVE +1    TO ASC-BLK-SUB                            11900049
119100             PERFORM 4410-READ-TEMP-STORAGE                       11910049
119200             ADD +1     TO ASC-BLK-SUB                            11920049
119300                           PV-BLOCK-NUMBER                        11930049
119400             PERFORM 4410-READ-TEMP-STORAGE                       11940049
119500     END-IF.                                                      11950049
119600     MOVE +1            TO ASC-BLK-SUB.                           11960049
119700     COMPUTE ASC-ITEM-SUB =                                       11970049
119800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              11980049
119900         + PC-ITEMS-PER-PANEL).                                   11990049
120000                                                                  12000049
120100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12010049
120200         ADD +1         TO ASC-BLK-SUB                            12020049
120300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12030049
120400     END-IF.                                                      12040049
120500                                                                  12050049
120600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           12060049
120700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                12070049
120800                                                                  12080049
120900     COMPUTE ASC-ITEMS-DISPLAYED =                                12090049
121000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          12100049
121100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   12110049
121200     MOVE ASC-KEY-VENDOR-NAME      TO AVENDO.                     12120049
121300     MOVE ASC-KEY-VENDOR-ID        TO AVNDIDO.                    12130049
121400     MOVE ASC-DISPLAY-ENT-ID       TO AENTIDO.                    12140049
121500     MOVE ASC-KEY-RLTNSHP-NAME     TO ARELATNO.                   12150049
121600     MOVE ASC-EFF-DATE (ASC-BLK-SUB ASC-ITEM-SUB) TO AEFFDTO.     12160049
121700     MOVE ASC-EXP-DATE (ASC-BLK-SUB ASC-ITEM-SUB) TO AEXPDTO.     12170049
121800     MOVE ASC-DATE-ADDED (ASC-BLK-SUB ASC-ITEM-SUB) TO AADDDTO.   12180049
121900     MOVE ASC-LAST-UPD-ID (ASC-BLK-SUB ASC-ITEM-SUB) TO AUPDBYO.  12190049
122000     MOVE ASC-LAST-UPD-DATE (ASC-BLK-SUB ASC-ITEM-SUB) TO AUPDDTO.12200049
122100     IF ASC-RLTD-ENT-ID (ASC-BLK-SUB ASC-ITEM-SUB) = 0            12210049
122200         MOVE SPACES                             TO ARENTIDO      12220049
122300     ELSE                                                         12230049
122400         MOVE ASC-RLTD-ENT-ID (ASC-BLK-SUB ASC-ITEM-SUB)          12240049
122500                                                 TO ARENTIDO      12250049
122600     END-IF.                                                      12260049
122700     IF ASC-RLTD-VEND-ID (ASC-BLK-SUB ASC-ITEM-SUB) = 0           12270049
122800         MOVE SPACES                             TO ARVNDIDO      12280049
122900     ELSE                                                         12290049
123000         MOVE ASC-RLTD-VEND-ID (ASC-BLK-SUB ASC-ITEM-SUB)         12300049
123100                                                 TO ARVNDIDO      12310049
123200     END-IF.                                                      12320049
123300     MOVE ASC-RLTD-VEND-NAME (ASC-BLK-SUB ASC-ITEM-SUB)           12330049
123400                                                 TO ARVNDNMO.     12340049
123500     IF  DP020-MSG-NUMBER-X = SPACE                               12350049
123600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  12360049
123700*            --- MORE ITEMS TO DISPLAY ----                       12370049
123800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            12380049
123900             SET DP020-MSG-INFORMATIONAL TO TRUE                  12390049
124000         END-IF                                                   12400049
124100     END-IF.                                                      12410049
124200                                                                  12420049
124300*----------------------------------------------------------------*12430049
124400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *12440049
124500*----------------------------------------------------------------*12450049
124600 4410-READ-TEMP-STORAGE.                                          12460049
124700                                                                  12470049
124800     EXEC CICS                                                    12480049
124900         READQ TS                                                 12490049
125000             QUEUE (ASC-LIST-QUEUE-NAME)                          12500049
125100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               12510049
125200             ITEM  (PV-BLOCK-NUMBER)                              12520049
125300             RESP  (PV-CICS-RESP)                                 12530049
125400     END-EXEC.                                                    12540049
125500                                                                  12550049
125600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       12560049
125700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     12570049
125800         CONTINUE                                                 12580049
125900     ELSE                                                         12590049
126000         SET DP013-CICS-ABEND     TO TRUE                         12600049
126100         SET DP013-NO-ROLLBACK    TO TRUE                         12610049
126200         MOVE '4410-READ-TEMP-STORAGE'                            12620049
126300                                  TO DP013-PARAGRAPH              12630049
126400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      12640049
126500                                  TO DP013-MESSAGE-TEXT(1)        12650049
126600         PERFORM DP013-0000-PROCESS-ABEND                         12660049
126700     END-IF.                                                      12670049
126800                                                                  12680049
126900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             12690049
127000                                                                  12700049
127100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         12710049
127200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               12720049
127300     END-IF.                                                      12730049
127400                                                                  12740049
127500                                                                  12750049
127600*----------------------------------------------------------------*12760049
127700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *12770049
127800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *12780049
127900*----------------------------------------------------------------*12790049
128000 5100-WRITE-TEMP-STORAGE.                                         12800049
128100                                                                  12810049
128200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     12820049
128300                                   TO PV-LIST-ITEM-NUMBER.        12830049
128400     COMPUTE PV-BLOCK-NUMBER =                                    12840049
128500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12850049
128600                                                                  12860049
128700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             12870049
128800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             12880049
128900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      12890049
129000             PERFORM 5105-REWRITE-ASC-LISTQ                       12900049
129100         END-IF                                                   12910049
129200     ELSE                                                         12920049
129300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       12930049
129400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            12940049
129500         PERFORM 5110-WRITE-ASC-LISTQ                             12950049
129600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   12960049
129700     END-IF.                                                      12970049
129800                                                                  12980049
129900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             12990049
130000                                                                  13000049
130100***************************************************************** 13010049
130200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    * 13020049
130300** SPECIFIC COMMAREA.                                           * 13030049
130400***************************************************************** 13040049
130500 5105-REWRITE-ASC-LISTQ.                                          13050049
130600                                                                  13060049
130700     EXEC CICS                                                    13070049
130800         WRITEQ TS                                                13080049
130900             QUEUE (ASC-LIST-QUEUE-NAME)                          13090049
131000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               13100049
131100             ITEM  (PV-BLOCK-NUMBER)                              13110049
131200             REWRITE                                              13120049
131300             RESP  (PV-CICS-RESP)                                 13130049
131400     END-EXEC.                                                    13140049
131500                                                                  13150049
131600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           13160049
131700         CONTINUE                                                 13170049
131800     ELSE                                                         13180049
131900         SET DP013-CICS-ABEND            TO TRUE                  13190049
132000         SET DP013-NO-ROLLBACK           TO TRUE                  13200049
132100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       13210049
132200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     13220049
132300                                         TO DP013-MESSAGE-TEXT(1) 13230049
132400         PERFORM DP013-0000-PROCESS-ABEND                         13240049
132500     END-IF.                                                      13250049
132600                                                                  13260049
132700***************************************************************** 13270049
132800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      * 13280049
132900** SPECIFIC COMMAREA.                                           * 13290049
133000***************************************************************** 13300049
133100 5110-WRITE-ASC-LISTQ.                                            13310049
133200                                                                  13320049
133300     EXEC CICS                                                    13330049
133400         WRITEQ TS                                                13340049
133500             QUEUE (ASC-LIST-QUEUE-NAME)                          13350049
133600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               13360049
133700             ITEM  (PV-BLOCK-NUMBER)                              13370049
133800             RESP  (PV-CICS-RESP)                                 13380049
133900     END-EXEC.                                                    13390049
134000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      13400049
134100         SET DP013-CICS-ABEND      TO TRUE                        13410049
134200         SET DP013-NO-ROLLBACK     TO TRUE                        13420049
134300         MOVE '5110-WRITE-ASC-LISTQ'                              13430049
134400                                   TO DP013-PARAGRAPH             13440049
134500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           13450049
134600                                   TO DP013-MESSAGE-TEXT(1)       13460049
134700         PERFORM DP013-0000-PROCESS-ABEND                         13470049
134800     END-IF.                                                      13480049
134900                                                                  13490049
135000******************************************************************13500049
135100* DELETE THE LIST QUEUE                                          *13510049
135200******************************************************************13520049
135300 6200-DEL-LIST-QUEUE.                                             13530049
135400                                                                  13540049
135500     EXEC CICS                                                    13550049
135600         DELETEQ TS                                               13560049
135700             QUEUE (ASC-LIST-QUEUE-NAME)                          13570049
135800             RESP  (PV-CICS-RESP)                                 13580049
135900     END-EXEC.                                                    13590049
136000                                                                  13600049
136100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      13610049
136200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         13620049
136300         CONTINUE                                                 13630049
136400     ELSE                                                         13640049
136500        SET DP013-CICS-ABEND       TO TRUE                        13650049
136600        SET DP013-NO-ROLLBACK      TO TRUE                        13660049
136700        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             13670049
136800        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               13680049
136900                                   TO DP013-MESSAGE-TEXT (1)      13690049
137000        PERFORM DP013-0000-PROCESS-ABEND                          13700049
137100     END-IF.                                                      13710049
137200                                                                  13720049
137300******************************************************************13730049
137400* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *13740049
137500******************************************************************13750049
137600 9100-READ-SEL-QUEUE.                                             13760049
137700                                                                  13770049
137800     EXEC CICS                                                    13780049
137900         READQ TS                                                 13790049
138000             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        13800049
138100             INTO  (VN021-RELATIONSHIP-REC)                       13810049
138200             ITEM  (ASC-SEL-ITEM)                                 13820049
138300             RESP  (PV-CICS-RESP)                                 13830049
138400     END-EXEC.                                                    13840049
138500                                                                  13850049
138600     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        13860049
138700         CONTINUE                                                 13870049
138800     ELSE                                                         13880049
138900         SET DP013-LOGIC-ABEND                                    13890049
139000             DP013-NO-ROLLBACK     TO TRUE                        13900049
139100         MOVE '9100-READ-SEL-QUEUE'                               13910049
139200                                   TO DP013-PARAGRAPH             13920049
139300         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    13930049
139400                                   TO DP013-MESSAGE-TEXT (1)      13940049
139500         PERFORM DP013-0000-PROCESS-ABEND                         13950049
139600     END-IF.                                                      13960049
139700                                                                  13970049
139800******************************************************************13980049
139900* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *13990049
140000******************************************************************14000049
140100 9200-REWRITE-LIST-QUEUE.                                         14010049
140200                                                                  14020049
140300     EXEC CICS                                                    14030049
140400          WRITEQ TS                                               14040049
140500              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     14050049
140600              FROM    (VN021-RELATIONSHIP-REC)                    14060049
140700              ITEM    (ASC-SEL-ITEM)                              14070049
140800              RESP    (PV-CICS-RESP)                              14080049
140900              REWRITE                                             14090049
141000     END-EXEC.                                                    14100049
141100                                                                  14110049
141200     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    14120049
141300         SET DP013-CICS-ABEND                                     14130049
141400             DP013-NO-ROLLBACK     TO TRUE                        14140049
141500         MOVE '9200-REWRITE-LIST-QUEUE'                           14150049
141600                                   TO DP013-PARAGRAPH             14160049
141700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   14170049
141800                                   TO DP013-MESSAGE-TEXT (1)      14180049
141900         PERFORM DP013-0000-PROCESS-ABEND                         14190049
142000     END-IF.                                                      14200049
142100                                                                  14210049
142200*---------------------------------------------------------------- 14220049
142300*    ABEND PROCESSOR MODULE                                       14230049
142400*---------------------------------------------------------------- 14240049
142500     COPY DPPD013.                                                14250049
142600*---------------------------------------------------------------- 14260049
