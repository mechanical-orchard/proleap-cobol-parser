      ******************************************************************00010000
      *   CHECK TO SEE IF THIS TRANSACTION WAS TRIGGERED BY THE MQ      00020000
      *   LISTENER.  IF SO, WRITE MESSAGE TO REMOTE QUEUE INSTEAD OF    00030000
      *   TEMPORARY STORAGE QUEUE.                                      00040000
      ******************************************************************00050000
       IDENTIFICATION DIVISION.                                         00060000
      ******************************************************************00070000
                                                                        00080000
       PROGRAM-ID.       TFKCS417.                                      00090000
       AUTHOR.           DAVID R WELLER.                                00100000
       INSTALLATION.     KOHLS.                                         00110000
       DATE-WRITTEN      OCTOBER, 2004.                                 00120000
       DATE-COMPILED.                                                   00130000
                                                                        00140000
      ******************************************************************00150000
      * THIS PROGRAM RECEIVES FROM AND SENDS DATA STREAMS TO A TELXON   00160000
      * PORTABLE TELE-TRANSACTION COMPUTER (PTC).  THE RECEIVED DATA    00170000
      * IS A REQUEST TO UPDATE CONTAINER/TRAILER SEAL DATA FOR A GIVEN  00180000
      * TRANSFER.  THE REQUEST MAY WILL ALSO CANCEL OR COMPLETE THE     00190000
      * TRANSFER.  THE TRANSMIT DATA IS THE RESPONSE TO THAT REQUEST.   00191000
      ******************************************************************00192000
      *  AT THIS TIME, THE PROGRAM WAS NAMED TFKCS406.                  00192100
      *  DATE 01/15/01                                                  00192200
      *  ADD CODE FOR 2ND LISTNER                                       00192300
      *  MADE BY: STEVEN NOWAK            WR/IR #:                      00192400
      ******************************************************************00192500
      **DATE:03/23/2004 CHANGED BY: RAY GRAF                            00192600
      **     CHANGE PRINTER DESTINATION TO NEW 8 CHARACTER FORMAT       00192700
      ***************************************************************** 00192800
      ** AT THIS POINT, THE PROGRAM WAS RENAMED TO TFKCS417 BECAUSE OF  00192900
      ** CHANGES TO THE XFER-DOC-NBR PASSED TO THE RF GUNS.             00193000
      **DATE:10/07/2004 CHANGED BY: DAVE WELLER                         00194000
      **     STORE EXPANSION                                            00195000
      ***************************************************************** 00196000
      **DATE:02/15/2005 CHANGED BY: RAY GRAF                            00197000
      **     RECOMPILE - CHECK DIGIT NOT ON DOC                         00198000
      ***************************************************************** 00199000
021605**DATE:02/16/2005 CHANGED BY: DAVID WELLER  WR27349               00200000
021605**     STANDARDIZE USAGE OF TFWS007                               00210000
021605***************************************************************** 00220000
051705*  DATE 05/17/05 RAY GRAF                                         00221000
051705*  REMOVE PHYSICAL INVENTORY LOGIC                                00222000
051705******************************************************************00223000
PB5753**DATE:02/07/2011 CHANGED BY: COGNIZANT     PBI5753               00224000
PB5753*  MODIFIED THE CODE IN 7100-SELECT-XFER-TYPE TO HANDLE SQLCODE   00225000
PB5753*  100 AND NOT TO ABEND THE TRANSACTION IN CICS.NOW THE PROGRAM   00226000
PB5753*  WILL SEND THE MESSAGE TO RF DEVICE WITH PC-TSYMSG-01442 MSG    00227000
PB5753*  CODE WITHOUT ABENDING THE TRANSACTION IN CICS.                 00228000
      ***************************************************************** 00228105
022912* DATE 02/29/12 CHERI PARMLEY            PRJ#3403                 00228205
022912* ADD TEST PRINTER LOGIC                                          00228305
022912******************************************************************00228405
      ******************************************************************00229000
       ENVIRONMENT DIVISION.                                            00230000
      ******************************************************************00240000
                                                                        00250000
      ******************************************************************00260000
       DATA DIVISION.                                                   00270000
      ******************************************************************00280000
                                                                        00290000
      ******************************************************************00300000
       WORKING-STORAGE SECTION.                                         00310000
      ******************************************************************00320000
                                                                        00330000
      *                                                                 00340000
      *  LISTENER QUEUE NAMES                                           00350000
      *                                                                 00360000
           COPY RFWS001.                                                00370000
                                                                        00380000
      *                                                                 00390000
      *  RECORD LAYOUT BEING TRANSMITTED FROM THE PTC                   00400000
      *                                                                 00410000
           COPY TFRD049.                                                00420000
                                                                        00430000
      *                                                                 00440000
      *  RECORD LAYOUT BEING TRANSMITTED TO THE PTC                     00450000
      *                                                                 00460000
           COPY TFRD046.                                                00470000
                                                                        00480000
      *                                                                 00490000
      *  LAYOUT FOR THE PRINT TRANSFER COMMUNICATIONS AREA              00500000
      *                                                                 00510000
           COPY TFWS005.                                                00520000
                                                                        00530000
      *                                                                 00540000
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00550000
      *                                                                 00560000
           COPY DPWS013.                                                00570000
                                                                        00580000
      *                                                                 00590000
      *  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  00600000
      *                                                                 00610000
           COPY DPRD507I.                                               00620000
                                                                        00630000
      *                                                                 00640000
      *  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     00650000
      *                                                                 00660000
           COPY DPWS011.                                                00670000
                                                                        00680000
      *                                                                 00690000
      *  RF COPYBOOK TO FORMAT PRINTER DESTINATION                      00700000
      *                                                                 00710000
           COPY RFWS009.                                                00711000
                                                                        00712000
      *                                                                 00713000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER TABLE     00714000
      *                                                                 00715000
           EXEC SQL                                                     00716000
               INCLUDE TTFMSTR                                          00717000
           END-EXEC.                                                    00718000
                                                                        00719000
      *                                                                 00720000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER STATUS    00730000
      *  CODE TABLE                                                     00740000
      *                                                                 00750000
           EXEC SQL                                                     00760000
               INCLUDE TTFSTAT                                          00770000
           END-EXEC.                                                    00780000
                                                                        00790000
      *                                                                 00800000
      *  COMMUNICATIONS AREA FOR DB2                                    00810000
      *                                                                 00820000
           EXEC SQL                                                     00830000
               INCLUDE SQLCA                                            00840000
           END-EXEC.                                                    00850000
                                                                        00860000
       01  WS-MQCONN               PIC X(8)  VALUE 'CSQCCONN'.          00870000
       01  WS-MQOPEN               PIC X(8)  VALUE 'CSQCOPEN'.          00880000
       01  WS-MQINQ                PIC X(8)  VALUE 'CSQCINQ'.           00890000
       01  WS-MQGET                PIC X(8)  VALUE 'CSQCGET'.           00900000
       01  WS-MQPUT1               PIC X(8)  VALUE 'CSQCPUT1'.          00910000
       01  WS-MQPUT                PIC X(8)  VALUE 'CSQCPUT'.           00920000
       01  WS-MQBACK               PIC X(8)  VALUE 'CSQCBACK'.          00930000
       01  WS-MQCMIT               PIC X(8)  VALUE 'CSQCCOMM'.          00940000
       01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQCCLOS'.          00950000
       01  WS-MQDISC               PIC X(8)  VALUE 'CSQCDISC'.          00960000
                                                                        00970000
      *    API CONTROL BLOCKS                                           00980000
                                                                        00990000
       01  MQM-OBJECT-DESCRIPTOR.                                       01000000
           COPY CMQODV.                                                 01010000
       01  MQM-MESSAGE-DESCRIPTOR.                                      01020000
           COPY CMQMDV.                                                 01030000
       01  MQM-GET-MESSAGE-OPTIONS.                                     01040000
           COPY CMQGMOV.                                                01050000
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01060000
           COPY CMQPMOV.                                                01070000
                                                                        01080000
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01090000
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01100000
                                                                        01110000
       01  MQM-CONSTANTS.                                               01120000
           COPY CMQV.                                                   01130000
      *                                                                 01140000
      **---------------------------------------------------------------*01150000
      **  VARIABLES REQUIRED FOR THE USE OF THE LOG MESSAGE ROUTINE    *01160000
      **  (EPPD000)                                                    *01170000
      **---------------------------------------------------------------*01180000
                                                                        01190000
           COPY EPWS000.                                                01200000
021605     COPY TFWS007.                                                01210000
                                                                        01220000
      *                                                                 01230000
       01  DK-DB2-KEYS.                                                 01240000
           05  DK-XFER-DKEY-ID                 PIC S9(09)  VALUE ZEROS  01250000
                                                           COMP SYNC.   01260000
           05  DK-FR-STR-NBR                   PIC S9(04)  VALUE ZEROS  01270000
                                                           COMP SYNC.   01280000
       01  PC-PROGRAM-CONSTANTS.                                        01290000
           05  PC-MENOMONEE-FALLS-DC           PIC  9(05)  VALUE 85.    01300000
           05  PC-FINDLAY-DC                   PIC  9(05)  VALUE 810.   01310000
           05  PC-CORPORATE-PLANOGRAM          PIC  9(05)  VALUE 803.   01320000
           05  PC-COMPLETED                    PIC  X(02)  VALUE 'CM'.  01330000
           05  PC-PRINT-XFER-PGM               PIC  X(04)  VALUE 'P418'.01340000
           05  PC-PRINT-LABL-PGM               PIC  X(04)  VALUE 'P424'.01350000
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01360000
               'TFKCS417'.                                              01370000
           05  PC-811                          PIC  9(05)  VALUE 811.   01380000
           05  PC-801                          PIC  9(05)  VALUE 801.   01390000
           05  PC-YES                          PIC  X(01)  VALUE 'Y'.   01400000
           05  PC-RF-USERID                PIC X(08) VALUE 'RF GUN'.    01410000
                                                                        01420000
           05  PC-TSYMSG-NUMBERS.                                       01430000
      *  RESOURCE IS UNAVAILABLE; PLEASE TRY AGAIN LATER                01440000
               10  PC-TSYMSG-01063             PIC  9(05)  VALUE  01063.01450000
      *  DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK           01460000
               10  PC-TSYMSG-01064             PIC  9(05)  VALUE  01064.01470000
PB5753*  TRANSFER NOT FOUND                                             01480000
PB5753         10  PC-TSYMSG-01442             PIC  9(05)  VALUE  01442.01490000
                                                                        01500000
                                                                        01510000
       01  PH-PROGRAM-HOLD-VARIABLES.                                   01520000
           05  PH-COMPLETION-CODE          PIC  S9(09) BINARY.          01530000
           05  PH-REASON                   PIC  S9(09) BINARY.          01540000
      *                                                                 01550000
       01  PS-PROGRAM-SWITCHES.                                         01560000
           05  PS-XFER-COMPLETED-IND           PIC  X(01)  VALUE 'N'.   01570000
               88  PS-XFER-NOT-COMPLETED                   VALUE 'N'.   01580000
               88  PS-XFER-COMPLETED                       VALUE 'Y'.   01590000
           05  PS-NEW-SEQ-NBR-CREATED-IND      PIC  X(01)  VALUE 'N'.   01600000
               88  PS-DUP-SEQ-NBR-CREATED                  VALUE 'N'.   01610000
               88  PS-NEW-SEQ-NBR-CREATED                  VALUE 'Y'.   01620000
           05  PS-LOCATION-IND                 PIC  X(01)  VALUE 'N'.   01630000
               88  PS-STR-LOCATION                         VALUE 'N'.   01640000
               88  PS-DC-LOCATION                          VALUE 'Y'.   01650000
           05  PS-MQPUT-SUCCESSFUL-IND         PIC  X(01)  VALUE 'N'.   01660000
               88 PS-MQPUT-SUCCESSFUL                      VALUE 'Y'.   01670000
      *                                                                 01680000
       01  PV-PROGRAM-VARIABLES.                                        01690000
           05  PV-QMGR-NAME            PIC X(04) VALUE SPACES.          01700000
               88  PV-PROD-QMGR-NAME             VALUE 'QKSP'.          01710000
               88  PV-TEST-QMGR-NAME             VALUE 'QKST'.          01720000
               88  PV-QA-QMGR-NAME               VALUE 'QKSQ'.          01730000
           05  PV-QM-NAME              PIC X(48).                       01740000
           05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        01750000
           05  PV-OPEN-OPTIONS         PIC S9(9) BINARY VALUE 0.        01760000
           05  PV-COMPLETION-CODE      PIC S9(9) BINARY VALUE 0.        01770000
           05  PV-REASON               PIC S9(9) BINARY VALUE 0.        01780000
           05  PV-CON-REASON           PIC S9(9) BINARY VALUE 0.        01790000
           05  PV-PQ-HANDLE            PIC S9(9) BINARY VALUE 0.        01800000
           05  PV-FMT-OPEN-OUTPUT-HNDL PIC S9(9) BINARY VALUE 0.        01810000
           05  PV-ERROR-MESSAGE        PIC X(48)  VALUE SPACES.         01820000
           05  PV-DATA-LENGTH          PIC S9(9) BINARY.                01830000
           05  PV-MSGBUFFER            PIC X(1000000) VALUE SPACES.     01840000
                                                                        01850000
           05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZEROS  01860000
                                                           COMP SYNC.   01870000
           05  PV-DB2-NULL-IND                 PIC S9(04)  VALUE ZEROS  01880000
                                                           COMP SYNC.   01890000
           05  PV-DISPLAY-FR-STR-NBR           PIC  9(05)  VALUE ZEROS. 01900000
           05  PV-DISPLAY-XFER-DKEY-ID         PIC  9(09)  VALUE ZEROS. 01910000
           05  PV-XFER-SEQ-NBR                 PIC  9(06)  VALUE ZEROS. 01920000
           05  PV-XFER-DOC-NBR                 PIC  9(11)  VALUE ZEROS. 01930000
           05  FILLER  REDEFINES  PV-XFER-DOC-NBR.                      01940000
               10  PV-XFER-FROM-STR-NBR-X      PIC  X(05).              01950000
               10  PV-XFER-FROM-STR-NBR REDEFINES PV-XFER-FROM-STR-NBR-X01960000
                                               PIC  9(05).              01970000
               10  PV-XFER-STR-SEQ-NBR         PIC  9(06).              01980000
           05  PV-ITEM-NBR                     PIC S9(04)  VALUE ZEROS  01990000
                                                           COMP SYNC.   02000000
           05  PV-TSQ-LENGTH                   PIC S9(04)  VALUE ZEROS  02010000
                                                           COMP SYNC.   02020000
           05  PV-TSQ-NAME                     PIC  X(08)  VALUE SPACES.02030000
                                                                        02040000
           05  PV-TCPIPPRQ-RECORD1.                                     02050000
               10  PV-NEXT-RECORD              PIC  9(08)  VALUE ZEROS. 02060000
               10  PV-TOTAL-RECORDS            PIC  9(08)  VALUE ZEROS. 02070000
               10  FILLER                      PIC X(4104) VALUE SPACE. 02080000
           05  PV-TCPIPPRQ-RECORD2.                                     02090000
               10  PV-CURRENT-RECORD           PIC  9(08)  VALUE ZEROS. 02100000
               10  FILLER                      PIC X(4112) VALUE SPACE. 02110000
           05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02120000
                                                           COMP SYNC.   02130000
022912     05  PV-CICS-APPL-ID.                                         02131005
022912         10  FILLER                         PIC X(04).            02132005
022912         10  PV-CICS-REGION-ENVIRONMENT     PIC X(01).            02133005
022912             88  PV-CR-PRODUCTION          VALUE 'P'.             02134005
022912         10  PV-FILLER                      PIC X(03).            02135005
      *                                                                 02140000
      ******************************************************************02150000
       PROCEDURE DIVISION.                                              02160000
      ******************************************************************02170000
       0000-PROGRAM-MAINLINE.                                           02180000
           INITIALIZE TF046-XFER-TO-PTC-RECORD.                         02190000
                                                                        02200000
           PERFORM 1000-RETRIEVE-TEXT.                                  02210000
                                                                        02220000
           PERFORM 2000-PROCESS-PTC-REQUEST.                            02230000
                                                                        02240000
           GOBACK.                                                      02250000
      *                                                                 02260000
       1000-RETRIEVE-TEXT.                                              02270000
           EXEC CICS                                                    02280000
               RETRIEVE                                                 02290000
                   INTO  (TF049-XFER-FROM-PTC-RECORD)                   02300000
                   RESP  (PV-CICS-RESPONSE)                             02310000
           END-EXEC.                                                    02320000
                                                                        02330000
           EVALUATE TRUE                                                02340000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02350000
                   CONTINUE                                             02360000
               WHEN OTHER                                               02370000
                   MOVE '1000-RETRIEVE-TEXT'                            02380000
                                   TO DP013-PARAGRAPH                   02390000
                   MOVE 'UNABLE TO RECEIVE TEXT'                        02400000
                                   TO DP013-MESSAGE-TEXT (1)            02410000
                   MOVE TF049-XFER-FROM-PTC-RECORD                      02420000
                                   TO DP013-MESSAGE-TEXT (2)            02430000
                   SET DP013-CICS-ABEND                                 02440000
                       DP013-NO-ROLLBACK                                02450000
                                   TO TRUE                              02460000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      02470000
                   SET  DP011-MSG-FATAL                                 02480000
                                   TO TRUE                              02490000
                   MOVE PC-TSYMSG-01064                                 02500000
                                   TO DP011-MSG-NUMBER                  02510000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      02520000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   02530000
           END-EVALUATE.                                                02540000
                                                                        02550000
                                                                        02560000
           MOVE TF049-LISTENER-CODE                                     02570000
                                   TO PV-QUEUE-PARM.                    02580000
                                                                        02590000
           IF  PV-VALID-PARM                                            02600000
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      02610000
                                   TO PV-TSQ-NAME                       02620000
                                                                        02630000
           ELSE                                                         02640000
               MOVE '1000-RETRIEVE-TEXT'                                02650000
                                   TO DP013-PARAGRAPH                   02660000
               MOVE 'INVALID PARM VALUE'                                02670000
                                   TO DP013-MESSAGE-TEXT (1)            02680000
               MOVE 'PARM VALUE = '                                     02690000
                                   TO DP013-MESSAGE-TEXT (2)            02700000
               MOVE TF049-LISTENER-CODE                                 02710000
                                   TO DP013-MESSAGE-TEXT (3)            02720000
                                                                        02730000
               SET DP013-LOGIC-ABEND                                    02740000
                   DP013-NO-ROLLBACK                                    02750000
                                   TO TRUE                              02760000
                                                                        02770000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          02780000
                                                                        02790000
               SET  DP011-MSG-FATAL                                     02800000
                                   TO TRUE                              02810000
                                                                        02820000
               MOVE PC-TSYMSG-01064                                     02830000
                                   TO DP011-MSG-NUMBER                  02840000
                                                                        02850000
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          02860000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       02870000
           END-IF.                                                      02880000
                                                                        02890000
                                                                        02900000
      ******************************************************************02910000
      *    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 02920000
      ******************************************************************02930000
       2000-PROCESS-PTC-REQUEST.                                        02940000
                                                                        02950000
           IF TF049-COMPLETE-XFER                                       02960000
               PERFORM 7000-SELECT-COMPLETED-XFER                       02970000
               IF PS-XFER-NOT-COMPLETED                                 02980000
                   PERFORM 2100-COMPLETE-XFER                           02990000
                       UNTIL PS-NEW-SEQ-NBR-CREATED                     03000000
                   PERFORM 2200-START-PRINT-XFER-PGM                    03010000
               END-IF                                                   03020000
           END-IF.                                                      03030000
                                                                        03040000
           PERFORM 8000-SEND-DATA-TO-LISTENER.                          03050000
      *                                                                 03060000
       2100-COMPLETE-XFER.                                              03070000
           PERFORM 7100-SELECT-XFER-TYPE.                               03080000
                                                                        03090000
           IF TF049-FROM-STR-NBR  =  PC-MENOMONEE-FALLS-DC              03100000
               MOVE RFWS009-PRINTER-DEST-801                            03110000
                                   TO  TF005-PRINTER-DEST               03120000
021605         IF TFMSTR-XFER-TYP-CDE  =  TF007-STOCK-BALANCE-STORE     03130000
                   MOVE PC-801     TO  TF049-FROM-STR-NBR               03140000
               END-IF                                                   03150000
               SET PS-DC-LOCATION  TO  TRUE                             03160000
           ELSE                                                         03170000
               IF TF049-FROM-STR-NBR  =  PC-FINDLAY-DC                  03180000
                   MOVE RFWS009-PRINTER-DEST-811                        03190000
                                   TO TF005-PRINTER-DEST                03200000
021605             IF TFMSTR-XFER-TYP-CDE  =  TF007-STOCK-BALANCE-STORE 03210000
                       MOVE PC-811 TO  TF049-FROM-STR-NBR               03220000
                   END-IF                                               03230000
                   SET PS-DC-LOCATION                                   03240000
                                   TO  TRUE                             03250000
               ELSE                                                     03260000
                   IF TF049-FROM-STR-NBR  =  PC-CORPORATE-PLANOGRAM     03270000
                       MOVE RFWS009-PRINTER-DEST-803                    03280000
                                   TO TF005-PRINTER-DEST                03290000
                       SET PS-DC-LOCATION                               03300000
                                   TO  TRUE                             03310000
                   END-IF                                               03320000
               END-IF                                                   03330000
           END-IF.                                                      03340000
                                                                        03350000
           PERFORM 7200-SELECT-MAX-XFER-SEQ-NBR.                        03353000
                                                                        03354000
           COMPUTE PV-XFER-SEQ-NBR =                                    03355000
               TFMSTR-XFER-SEQ-NBR + 1.                                 03356000
           MOVE PV-XFER-SEQ-NBR    TO  TFMSTR-XFER-SEQ-NBR.             03357000
                                                                        03358000
           MOVE TF049-FROM-STR-NBR-X                                    03359000
                                   TO  PV-XFER-FROM-STR-NBR-X           03360000
           MOVE PV-XFER-FROM-STR-NBR                                    03370000
                                   TO  RFWS009-STORE-NBR.               03380000
           MOVE PV-XFER-SEQ-NBR    TO  PV-XFER-STR-SEQ-NBR.             03390000
           MOVE PV-XFER-DOC-NBR    TO  TF046-XFER-DOC-NBR               03400000
                                       TF005-XFER-DOC-NBR.              03410000
           MOVE PC-RF-USERID       TO  TF005-USER-ID.                   03420000
           IF PS-STR-LOCATION                                           03430000
               MOVE RFWS009-STORE-PRINTER-DEST                          03440000
                                   TO  TF005-PRINTER-DEST               03450000
           END-IF.                                                      03460000
                                                                        03480000
022912     PERFORM 2105-FILL-PRINTER-DEST.                              03481005
                                                                        03482005
           PERFORM 7300-UPDATE-XFER-SEALS.                              03490000
                                                                        03500000
           IF PS-NEW-SEQ-NBR-CREATED                                    03510000
               PERFORM 7400-SELECT-UPD-TMST                             03520000
               PERFORM 7500-INSERT-STAT-COMP-XFER                       03530000
           END-IF.                                                      03540000
      *                                                                 03550000
022912******************************************************************03551005
022912*    DETERMINE WHAT REGION IF TEST USE TEST PRINTER               03552005
022912******************************************************************03553005
022912 2105-FILL-PRINTER-DEST.                                          03554005
022912                                                                  03555005
022912     EXEC CICS                                                    03556005
022912       ASSIGN                                                     03557005
022912       APPLID (PV-CICS-APPL-ID)                                   03558005
022912     END-EXEC.                                                    03559005
022912                                                                  03559105
022912     EVALUATE TRUE                                                03559205
022912       WHEN PV-CR-PRODUCTION                                      03559305
022912           CONTINUE                                               03559405
022912       WHEN OTHER                                                 03559605
022912           MOVE 'U4106' TO  TF005-PRINTER-DEST                    03559705
022912     END-EVALUATE.                                                03559805
                                                                        03559905
       2200-START-PRINT-XFER-PGM.                                       03560000
           MOVE LENGTH OF TF005-COMMAREA                                03570000
                                   TO  PV-COMMAREA-LENGTH.              03580000
                                                                        03590000
           EXEC CICS                                                    03600000
               START                                                    03610000
                   TRANSID  (PC-PRINT-XFER-PGM)                         03620000
                   FROM     (TF005-COMMAREA)                            03630000
                   LENGTH   (PV-COMMAREA-LENGTH)                        03640000
           END-EXEC.                                                    03650000
      *                                                                 03660000
       7000-SELECT-COMPLETED-XFER.                                      03670000
           MOVE TF049-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 03680000
                                                                        03690000
           EXEC SQL                                                     03700000
               SELECT  XFER_DKEY_ID                                     03710000
                 INTO  :TFSTAT-XFER-DKEY-ID                             03720000
                 FROM  TTFSTAT                                          03730000
                WHERE  (XFER_DKEY_ID   =  :DK-XFER-DKEY-ID              03740000
                  AND   XFER_STAT_CDE  =  :PC-COMPLETED)                03750000
                WITH UR                                                 03760000
           END-EXEC.                                                    03770000
                                                                        03780000
           EVALUATE SQLCODE                                             03790000
               WHEN ZERO                                                03800000
                   SET PS-XFER-COMPLETED                                03810000
                                   TO TRUE                              03820000
               WHEN +100                                                03830000
                   SET PS-XFER-NOT-COMPLETED                            03840000
                                   TO TRUE                              03850000
               WHEN -904                                                03860000
               WHEN -913                                                03870000
                   SET  DP011-MSG-FATAL                                 03880000
                                   TO TRUE                              03890000
                   MOVE PC-TSYMSG-01063                                 03900000
                                   TO DP011-MSG-NUMBER                  03910000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03920000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   03930000
               WHEN OTHER                                               03940000
                   MOVE '7000-SELECT-COMPLETED-XFER'                    03950000
                                   TO DP013-PARAGRAPH                   03960000
                   MOVE 'CHECK IF TRANSFER HAS A COMPLETED STATUS FOR XF03970000
      -                 'ER_DKEY_ID: '                                  03980000
                                   TO DP013-MESSAGE-TEXT (1)            03990000
                   MOVE DK-XFER-DKEY-ID                                 04000000
                                   TO PV-DISPLAY-XFER-DKEY-ID           04010000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         04020000
                                   TO DP013-MESSAGE-TEXT (2)            04030000
                   MOVE SQLCA      TO DP013-SQLCA                       04040000
                   MOVE 'TTFSTAT'  TO DP013-DB2-TABLE-NAME (1)          04050000
                   SET DP013-DB2-ABEND                                  04060000
                       DP013-NO-ROLLBACK                                04070000
                                   TO TRUE                              04080000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      04090000
                   SET  DP011-MSG-FATAL                                 04100000
                                   TO TRUE                              04110000
                   MOVE PC-TSYMSG-01064                                 04120000
                                   TO DP011-MSG-NUMBER                  04130000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04140000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04150000
           END-EVALUATE.                                                04160000
      *                                                                 04170000
       7100-SELECT-XFER-TYPE.                                           04180000
           EXEC SQL                                                     04190000
               SELECT  XFER_TYP_CDE                                     04200000
                 INTO  :TFMSTR-XFER-TYP-CDE                             04210000
                 FROM  TTFMSTR                                          04220000
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)              04230000
                WITH UR                                                 04240000
           END-EXEC.                                                    04250000
                                                                        04260000
           EVALUATE SQLCODE                                             04270000
               WHEN ZERO                                                04280000
                   CONTINUE                                             04290000
PB5753         WHEN +100                                                04300000
PB5753             SET  DP011-MSG-FATAL                                 04310000
PB5753                             TO TRUE                              04320000
PB5753             MOVE PC-TSYMSG-01442                                 04330000
PB5753                             TO DP011-MSG-NUMBER                  04340000
PB5753             PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04350000
PB5753             PERFORM 8000-SEND-DATA-TO-LISTENER                   04360000
               WHEN -904                                                04370000
               WHEN -913                                                04380000
                   SET  DP011-MSG-FATAL                                 04390000
                                   TO TRUE                              04400000
                   MOVE PC-TSYMSG-01063                                 04410000
                                   TO DP011-MSG-NUMBER                  04420000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04430000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04440000
               WHEN OTHER                                               04450000
                   MOVE '7100-SELECT-XFER-TYPE'                         04460000
                                   TO DP013-PARAGRAPH                   04470000
                   MOVE 'SELECT TRANSFER TYPE CODE FOR XFER_DKEY_ID: '  04480000
                                   TO DP013-MESSAGE-TEXT (1)            04490000
                   MOVE DK-XFER-DKEY-ID                                 04500000
                                   TO PV-DISPLAY-XFER-DKEY-ID           04510000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         04520000
                                   TO DP013-MESSAGE-TEXT (2)            04530000
                   MOVE SQLCA      TO DP013-SQLCA                       04540000
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          04550000
                   SET DP013-DB2-ABEND                                  04560000
                       DP013-NO-ROLLBACK                                04570000
                                   TO TRUE                              04580000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      04590000
                   SET  DP011-MSG-FATAL                                 04600000
                                   TO TRUE                              04610000
                   MOVE PC-TSYMSG-01064                                 04620000
                                   TO DP011-MSG-NUMBER                  04630000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04640000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04650000
           END-EVALUATE.                                                04660000
      *                                                                 04670000
       7200-SELECT-MAX-XFER-SEQ-NBR.                                    04680000
      *  DO NOT REMOVE THE INITIALIZATION CLAUSE, BECAUSE THE           04690000
      *  TFMSTR-XFER-SEQ-NBR IS BEING USED IN A COMPUTE STATEMENT.      04700000
           INITIALIZE DCLTTFMSTR.                                       04710000
           MOVE TF049-FROM-STR-NBR TO  DK-FR-STR-NBR.                   04720000
                                                                        04730000
      *  THE CLAUSE THAT CHECKS XFER_SEQ_NBR IS NOT NULL, IS THERE TO   04740000
      *  ELIMINATE AN SQL WARNING MESSAGE.  AN SQL WARNING MESSAGE WOULD04750000
      *  OCCUR, IF MULTIPLE NULL ROWS EXISTED FOR FR_STR_NBR.           04760000
           EXEC SQL                                                     04770000
               SELECT  MAX(XFER_SEQ_NBR)                                04780000
                 INTO  :TFMSTR-XFER-SEQ-NBR                             04790000
                           :PV-DB2-NULL-IND                             04800000
                 FROM  TTFMSTR                                          04810000
                WHERE  (FR_STR_NBR    =  :DK-FR-STR-NBR                 04820000
                  AND   XFER_SEQ_NBR  IS NOT NULL)                      04830000
                WITH UR                                                 04840000
           END-EXEC.                                                    04850000
                                                                        04860000
           EVALUATE SQLCODE                                             04870000
               WHEN ZERO                                                04880000
                   CONTINUE                                             04890000
               WHEN -904                                                04900000
               WHEN -913                                                04910000
                   SET  DP011-MSG-FATAL                                 04920000
                                   TO TRUE                              04930000
                   MOVE PC-TSYMSG-01063                                 04940000
                                   TO DP011-MSG-NUMBER                  04950000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04960000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04970000
               WHEN OTHER                                               04980000
                   MOVE '7200-SELECT-MAX-XFER-SEQ-NBR'                  04990000
                                   TO DP013-PARAGRAPH                   05000000
                   MOVE 'SELECT MAX XFER SEQ NBR FOR FROM STR NBR: '    05010000
                                   TO DP013-MESSAGE-TEXT (1)            05020000
                   MOVE DK-FR-STR-NBR                                   05030000
                                   TO PV-DISPLAY-FR-STR-NBR             05040000
                   MOVE PV-DISPLAY-FR-STR-NBR                           05050000
                                   TO DP013-MESSAGE-TEXT (2)            05060000
                   MOVE SQLCA      TO DP013-SQLCA                       05070000
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          05080000
                   SET DP013-DB2-ABEND                                  05090000
                       DP013-NO-ROLLBACK                                05100000
                                   TO TRUE                              05110000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      05120000
                   SET  DP011-MSG-FATAL                                 05130000
                                   TO TRUE                              05140000
                   MOVE PC-TSYMSG-01064                                 05150000
                                   TO DP011-MSG-NUMBER                  05160000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05170000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05180000
           END-EVALUATE.                                                05190000
      *                                                                 05200000
       7300-UPDATE-XFER-SEALS.                                          05210000
           MOVE TF049-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 05220000
                                                                        05230000
           EXEC SQL                                                     05240000
               UPDATE  TTFMSTR                                          05250000
                  SET  XFER_SEQ_NBR        =  :TFMSTR-XFER-SEQ-NBR,     05260000
                       CMPT_XFER_END_TMST  =  CURRENT TIMESTAMP,        05270000
                       LG_TTE_1ST_SEAL_ID  =  :TF049-LG-TOTE-SEAL-1,    05280000
                       LG_TTE_2ND_SEAL_ID  =  :TF049-LG-TOTE-SEAL-2,    05290000
                       SM_TTE_BAG_SEAL_ID  =  :TF049-SM-TOTE-BAG-SEAL,  05300000
                       TRLR_NBR            =  :TF049-TRAILER-NBR,       05310000
                       TRLR_SEAL_ID        =  :TF049-TRAILER-SEAL-NBR   05320000
                WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID)         05330000
           END-EXEC.                                                    05340000
                                                                        05350000
           EVALUATE SQLCODE                                             05360000
               WHEN ZERO                                                05370000
                   SET PS-NEW-SEQ-NBR-CREATED                           05380000
                                   TO TRUE                              05390000
               WHEN -904                                                05400000
               WHEN -913                                                05410000
                   SET  DP011-MSG-FATAL                                 05420000
                                   TO TRUE                              05430000
                   MOVE PC-TSYMSG-01063                                 05440000
                                   TO DP011-MSG-NUMBER                  05450000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05460000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05470000
               WHEN -803                                                05480000
                   SET PS-DUP-SEQ-NBR-CREATED                           05490000
                                   TO TRUE                              05500000
               WHEN OTHER                                               05510000
                   MOVE '7300-UPDATE-XFER-SEALS'                        05520000
                                   TO DP013-PARAGRAPH                   05530000
                   MOVE 'UPDATE TRANSFER WITH SEAL DATA.  XFER KEY: '   05540000
                                   TO DP013-MESSAGE-TEXT (1)            05550000
                   MOVE DK-XFER-DKEY-ID                                 05560000
                                   TO PV-DISPLAY-XFER-DKEY-ID           05570000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         05580000
                                   TO DP013-MESSAGE-TEXT (2)            05590000
                   MOVE SQLCA      TO DP013-SQLCA                       05600000
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          05610000
                   SET DP013-DB2-ABEND                                  05620000
                       DP013-NO-ROLLBACK                                05630000
                                   TO TRUE                              05640000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      05650000
                   SET  DP011-MSG-FATAL                                 05660000
                                   TO TRUE                              05670000
                   MOVE PC-TSYMSG-01064                                 05680000
                                   TO DP011-MSG-NUMBER                  05690000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05700000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05710000
           END-EVALUATE.                                                05720000
      *                                                                 05730000
       7400-SELECT-UPD-TMST.                                            05740000
           INITIALIZE DCLTTFMSTR.                                       05750000
                                                                        05760000
           EXEC SQL                                                     05770000
               SELECT  CMPT_XFER_END_TMST,                              05780000
                       XFER_TYP_CDE,                                    05790000
                       CONTNR_TYP_CDE                                   05800000
                 INTO  :TFMSTR-CMPT-XFER-END-TMST,                      05810000
                       :TFMSTR-XFER-TYP-CDE,                            05820000
                       :TFMSTR-CONTNR-TYP-CDE                           05830000
                 FROM  TTFMSTR                                          05840000
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)              05850000
                WITH UR                                                 05860000
           END-EXEC.                                                    05870000
                                                                        05880000
           EVALUATE SQLCODE                                             05890000
               WHEN ZERO                                                05900000
                   CONTINUE                                             05910000
               WHEN OTHER                                               05920000
                   MOVE '7400-SELECT-UPD-TMST'                          05930000
                                   TO DP013-PARAGRAPH                   05940000
                   MOVE 'SELECT TRANSFER COMPLETED TIMESTAMP FOR DATALES05950000
      -                 'S KEY VALUE: '                                 05960000
                                   TO DP013-MESSAGE-TEXT (1)            05970000
                   MOVE DK-XFER-DKEY-ID                                 05980000
                                   TO PV-DISPLAY-XFER-DKEY-ID           05990000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         06000000
                                   TO DP013-MESSAGE-TEXT (2)            06010000
                   MOVE SQLCA      TO DP013-SQLCA                       06020000
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          06030000
                   SET DP013-DB2-ABEND                                  06040000
                       DP013-ROLLBACK                                   06050000
                                   TO TRUE                              06060000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06070000
                   SET  DP011-MSG-FATAL                                 06080000
                                   TO TRUE                              06090000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              06100000
                       MOVE PC-TSYMSG-01063                             06110000
                                   TO DP011-MSG-NUMBER                  06120000
                   ELSE                                                 06130000
                       MOVE PC-TSYMSG-01064                             06140000
                                   TO DP011-MSG-NUMBER                  06150000
                   END-IF                                               06160000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06170000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06180000
           END-EVALUATE.                                                06190000
      *                                                                 06200000
       7500-INSERT-STAT-COMP-XFER.                                      06210000
           MOVE DK-XFER-DKEY-ID    TO  TFSTAT-XFER-DKEY-ID.             06220000
                                                                        06230000
           EXEC SQL                                                     06240000
               INSERT INTO TTFSTAT                                      06250000
                   (XFER_DKEY_ID,                                       06260000
                    XFER_STAT_TMST,                                     06270000
                    XFER_STAT_CDE)                                      06280000
               VALUES                                                   06290000
                   (:TFSTAT-XFER-DKEY-ID,                               06300000
                    :TFMSTR-CMPT-XFER-END-TMST,                         06310000
                    'CM')                                               06320000
           END-EXEC.                                                    06330000
                                                                        06340000
           EVALUATE SQLCODE                                             06350000
               WHEN ZERO                                                06360000
                   CONTINUE                                             06370000
               WHEN OTHER                                               06380000
                   MOVE '7500-INSERT-STAT-COMP-XFER'                    06390000
                                   TO DP013-PARAGRAPH                   06400000
                   MOVE 'INSERT A COMPLETED TRANSFER STATUS ROW FOR'    06410000
                                   TO DP013-MESSAGE-TEXT (1)            06420000
                   MOVE 'DATALESS KEY VALUE: '                          06430000
                                   TO DP013-MESSAGE-TEXT (2)            06440000
                   MOVE DK-XFER-DKEY-ID                                 06450000
                                   TO PV-DISPLAY-XFER-DKEY-ID           06460000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         06470000
                                   TO DP013-MESSAGE-TEXT (3)            06480000
                   MOVE SQLCA      TO DP013-SQLCA                       06490000
                   MOVE 'TTFSTAT'  TO DP013-DB2-TABLE-NAME (1)          06500000
                   SET DP013-DB2-ABEND                                  06510000
                       DP013-ROLLBACK                                   06520000
                                   TO TRUE                              06530000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06540000
                   SET  DP011-MSG-FATAL                                 06550000
                                   TO TRUE                              06560000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              06570000
                       MOVE PC-TSYMSG-01063                             06580000
                                   TO DP011-MSG-NUMBER                  06590000
                   ELSE                                                 06600000
                       MOVE PC-TSYMSG-01064                             06610000
                                   TO DP011-MSG-NUMBER                  06620000
                   END-IF                                               06630000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06640000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06650000
           END-EVALUATE.                                                06660000
      *                                                                 06670000
      ******************************************************************06680000
      *  CONNECT TO SOCKET WHICH WAS GIVEN TO US BY THE AL/SYSTEMS PTC  06690000
      *  PROGRAM.  CONNECT THE PATH (SOCKET).                           06700000
      ******************************************************************06710000
       8000-SEND-DATA-TO-LISTENER.                                      06720000
           IF TF049-MQ-INDICATOR-Y                                      06730000
               PERFORM 8500-MQ-SETUP                                    06740000
               PERFORM 8510-MQ-SETUP-REMOTE                             06750000
               PERFORM 8520-PUT-QUEUE                                   06760000
               PERFORM 8600-CLOSE-PUT-Q                                 06770000
               PERFORM 8610-DISCONNECT-QMGR                             06780000
               PERFORM 9100-EXEC-CICS-RETURN                            06790000
           ELSE                                                         06800000
               PERFORM 8110-ENQ-TCPIPPRQ                                06810000
               PERFORM 8120-READQ-TCPIPPRQ-RECORD1                      06820000
               PERFORM 8130-READQ-TCPIPPRQ-RECORD2                      06830000
                                                                        06840000
               PERFORM 8140-REWRITE-TCPIPPRQ-NEXT-REC                   06850000
               ADD 1               TO PV-NEXT-RECORD                    06860000
                                                                        06870000
               IF PV-NEXT-RECORD > PV-TOTAL-RECORDS                     06880000
                   MOVE 3          TO PV-NEXT-RECORD                    06890000
               END-IF                                                   06900000
                                                                        06910000
               PERFORM 8150-REWRITE-TCPIPPRQ-RECORD1                    06920000
               PERFORM 8160-DEQ-TCPIPPRQ                                06930000
                                                                        06940000
               PERFORM 9100-EXEC-CICS-RETURN                            06950000
           END-IF.                                                      06960000
      *                                                                 06970000
      ******************************************************************06980000
       8110-ENQ-TCPIPPRQ.                                               06990000
           EXEC CICS                                                    07000000
               ENQ                                                      07010000
                   RESOURCE  (PV-TSQ-NAME)                              07020000
                   RESP      (PV-CICS-RESPONSE)                         07030000
           END-EXEC.                                                    07040000
                                                                        07050000
           EVALUATE TRUE                                                07060000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07070000
                   CONTINUE                                             07080000
               WHEN OTHER                                               07090000
                   MOVE '8110-ENQ-TCPIPPRQ'                             07100000
                                   TO DP013-PARAGRAPH                   07110000
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q07120000
      -                 'UEUE: '                                        07130000
                                   TO DP013-MESSAGE-TEXT (1)            07140000
                   MOVE PV-TSQ-NAME                                     07150000
                                   TO DP013-MESSAGE-TEXT (2)            07160000
                   SET DP013-CICS-ABEND                                 07170000
                       DP013-NO-ROLLBACK                                07180000
                                   TO TRUE                              07190000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07200000
                   PERFORM 9100-EXEC-CICS-RETURN                        07210000
           END-EVALUATE.                                                07220000
      *                                                                 07230000
      ******************************************************************07240000
       8120-READQ-TCPIPPRQ-RECORD1.                                     07250000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           07260000
                                   TO PV-TSQ-LENGTH.                    07270000
                                                                        07280000
           EXEC CICS                                                    07290000
               READQ TS                                                 07300000
                   QUEUE   (PV-TSQ-NAME)                                07310000
                   INTO    (PV-TCPIPPRQ-RECORD1)                        07320000
                   LENGTH  (PV-TSQ-LENGTH)                              07330000
                   ITEM    (1)                                          07340000
                   RESP    (PV-CICS-RESPONSE)                           07350000
           END-EXEC.                                                    07360000
                                                                        07370000
           EVALUATE TRUE                                                07380000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07390000
                   CONTINUE                                             07400000
               WHEN OTHER                                               07410000
                   MOVE '8120-READQ-TCPIPPRQ-RECORD1'                   07420000
                                   TO DP013-PARAGRAPH                   07430000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 07440000
      -                 'QUEUE: '                                       07450000
                                   TO DP013-MESSAGE-TEXT (1)            07460000
                   MOVE PV-TSQ-NAME                                     07470000
                                   TO DP013-MESSAGE-TEXT (2)            07480000
                   SET DP013-CICS-ABEND                                 07490000
                       DP013-NO-ROLLBACK                                07500000
                                   TO TRUE                              07510000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07520000
                   PERFORM 9100-EXEC-CICS-RETURN                        07530000
           END-EVALUATE.                                                07540000
      *                                                                 07550000
      ******************************************************************07560000
       8130-READQ-TCPIPPRQ-RECORD2.                                     07570000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD2                           07580000
                                   TO PV-TSQ-LENGTH.                    07590000
                                                                        07600000
           EXEC CICS                                                    07610000
               READQ TS                                                 07620000
                   QUEUE   (PV-TSQ-NAME)                                07630000
                   INTO    (PV-TCPIPPRQ-RECORD2)                        07640000
                   LENGTH  (PV-TSQ-LENGTH)                              07650000
                   ITEM    (2)                                          07660000
                   RESP    (PV-CICS-RESPONSE)                           07670000
           END-EXEC.                                                    07680000
                                                                        07690000
           EVALUATE TRUE                                                07700000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07710000
                   CONTINUE                                             07720000
               WHEN OTHER                                               07730000
                   MOVE '8130-READQ-TCPIPPRQ-RECORD2'                   07740000
                                   TO DP013-PARAGRAPH                   07750000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 07760000
      -                 'QUEUE: '                                       07770000
                                   TO DP013-MESSAGE-TEXT (1)            07780000
                   MOVE PV-TSQ-NAME                                     07790000
                                   TO DP013-MESSAGE-TEXT (2)            07800000
                   SET DP013-CICS-ABEND                                 07810000
                       DP013-NO-ROLLBACK                                07820000
                                   TO TRUE                              07830000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07840000
                   PERFORM 9100-EXEC-CICS-RETURN                        07850000
           END-EVALUATE.                                                07860000
      *                                                                 07870000
      ******************************************************************07880000
       8140-REWRITE-TCPIPPRQ-NEXT-REC.                                  07890000
           MOVE LENGTH OF TF046-XFER-TO-PTC-RECORD                      07900000
                                   TO  TF046-TOT-REC-LENGTH.            07910000
                                                                        07920000
           MOVE TF049-MATCHING-NBR-FIELD                                07930000
                                   TO  TF046-MATCHING-NBR-FIELD.        07940000
           MOVE PV-NEXT-RECORD     TO  PV-ITEM-NBR.                     07950000
                                                                        07960000
           EXEC CICS                                                    07970000
               WRITEQ TS                                                07980000
                   QUEUE   (PV-TSQ-NAME)                                07990000
                   FROM    (TF046-XFER-TO-PTC-RECORD)                   08000000
                   LENGTH  (PV-TSQ-LENGTH)                              08010000
                   ITEM    (PV-ITEM-NBR)                                08020000
                       REWRITE                                          08030000
                   RESP    (PV-CICS-RESPONSE)                           08040000
           END-EXEC.                                                    08050000
                                                                        08060000
           EVALUATE TRUE                                                08070000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08080000
                   CONTINUE                                             08090000
               WHEN OTHER                                               08100000
                   MOVE '8140-REWRITE-TCPIPPRQ-NEXT-REC'                08110000
                                   TO DP013-PARAGRAPH                   08120000
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA08130000
      -                 'STORAGE QUEUE: '                               08140000
                                   TO DP013-MESSAGE-TEXT (1)            08150000
                   MOVE PV-TSQ-NAME                                     08160000
                                   TO DP013-MESSAGE-TEXT (2)            08170000
                   SET DP013-CICS-ABEND                                 08180000
                       DP013-NO-ROLLBACK                                08190000
                                   TO TRUE                              08200000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08210000
                   PERFORM 9100-EXEC-CICS-RETURN                        08220000
           END-EVALUATE.                                                08230000
      *                                                                 08240000
      ******************************************************************08250000
       8150-REWRITE-TCPIPPRQ-RECORD1.                                   08260000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           08270000
                                   TO PV-TSQ-LENGTH.                    08280000
           MOVE +1                 TO PV-ITEM-NBR.                      08290000
                                                                        08300000
           EXEC CICS                                                    08310000
               WRITEQ TS                                                08320000
                   QUEUE   (PV-TSQ-NAME)                                08330000
                   FROM    (PV-TCPIPPRQ-RECORD1)                        08340000
                   LENGTH  (PV-TSQ-LENGTH)                              08350000
                   ITEM    (PV-ITEM-NBR)                                08360000
                       REWRITE                                          08370000
                   RESP    (PV-CICS-RESPONSE)                           08380000
           END-EXEC.                                                    08390000
                                                                        08400000
           EVALUATE TRUE                                                08410000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08420000
                   CONTINUE                                             08430000
               WHEN OTHER                                               08440000
                   MOVE '8150-REWRITE-TCPIPPRQ-RECORD1'                 08450000
                                   TO DP013-PARAGRAPH                   08460000
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   08470000
                                   TO DP013-MESSAGE-TEXT (1)            08480000
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     08490000
                                   TO DP013-MESSAGE-TEXT (2)            08500000
                   MOVE PV-TSQ-NAME                                     08510000
                                   TO DP013-MESSAGE-TEXT (3)            08520000
                   MOVE PV-TCPIPPRQ-RECORD1                             08530000
                                   TO DP013-MESSAGE-TEXT (4)            08540000
                   SET DP013-CICS-ABEND                                 08550000
                       DP013-NO-ROLLBACK                                08560000
                                   TO TRUE                              08570000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08580000
                   PERFORM 9100-EXEC-CICS-RETURN                        08590000
           END-EVALUATE.                                                08600000
      *                                                                 08610000
      ******************************************************************08620000
       8160-DEQ-TCPIPPRQ.                                               08630000
           EXEC CICS                                                    08640000
               DEQ                                                      08650000
                   RESOURCE  (PV-TSQ-NAME)                              08660000
                   RESP      (PV-CICS-RESPONSE)                         08670000
           END-EXEC.                                                    08680000
                                                                        08690000
           EVALUATE TRUE                                                08700000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08710000
                   CONTINUE                                             08720000
               WHEN OTHER                                               08730000
                   MOVE '8160-DEQ-TCPIPPRQ'                             08740000
                                   TO DP013-PARAGRAPH                   08750000
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q08760000
      -                 'UEUE: '                                        08770000
                                   TO DP013-MESSAGE-TEXT (1)            08780000
                   MOVE PV-TSQ-NAME                                     08790000
                                   TO DP013-MESSAGE-TEXT (2)            08800000
                   SET DP013-CICS-ABEND                                 08810000
                       DP013-NO-ROLLBACK                                08820000
                                   TO TRUE                              08830000
                 PERFORM 9999-WRITE-CICS-LOG-MSG                        08840000
                 PERFORM 9100-EXEC-CICS-RETURN                          08850000
           END-EVALUATE.                                                08860000
                                                                        08870000
       8500-MQ-SETUP.                                                   08880000
                                                                        08890000
      * DETERMINE THE SYSTEM                                            08900000
                                                                        08910000
           PERFORM EP000-0000-INITIALIZE.                               08920000
           IF EP000-PV-KOHLS-PROD-SYSTEM                                08930000
               SET PV-PROD-QMGR-NAME                                    08940000
                                   TO TRUE                              08950000
           ELSE                                                         08960000
               IF EP000-PV-KOHLS-QA-SYSTEM                              08970000
                   SET PV-QA-QMGR-NAME                                  08980000
                                   TO TRUE                              08990000
               ELSE                                                     09000000
                   SET PV-TEST-QMGR-NAME                                09010000
                                   TO TRUE                              09020000
               END-IF                                                   09030000
           END-IF.                                                      09040000
                                                                        09050000
      ***************************************************************   09060000
      *    CONNECT TO THE QUEUE MANAGER                                 09070000
      ***************************************************************   09080000
                                                                        09090000
           MOVE PV-QMGR-NAME       TO PV-QM-NAME.                       09100000
           CALL WS-MQCONN USING PV-QM-NAME                              09110000
                                PV-HCONN                                09120000
                                PV-COMPLETION-CODE                      09130000
                                PV-REASON.                              09140000
                                                                        09150000
      ***************************************************************   09160000
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              09170000
      *    AND EXIT                                                     09180000
      ***************************************************************   09190000
                                                                        09200000
           MOVE PV-REASON          TO PV-CON-REASON.                    09210000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   09220000
               MOVE 'MQCONN ERROR' TO PV-ERROR-MESSAGE                  09230000
               MOVE '8500-MQ-SETUP'                                     09240000
                                   TO DP013-PARAGRAPH                   09250000
               MOVE  PV-ERROR-MESSAGE                                   09260000
                                   TO DP013-MESSAGE-TEXT (1)            09270000
               MOVE  PV-COMPLETION-CODE                                 09280000
                                   TO DP013-MESSAGE-TEXT (2)            09290000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            09300000
               SET DP013-CICS-ABEND                                     09310000
                   DP013-NO-ROLLBACK                                    09320000
                                   TO TRUE                              09330000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          09340000
               PERFORM 9100-EXEC-CICS-RETURN                            09350000
           END-IF.                                                      09360000
                                                                        09370000
                                                                        09380000
       8510-MQ-SETUP-REMOTE.                                            09390000
      ***************************************************************   09400000
      *    OPEN THE RF.RESPONSE.Q QUEUE FOR OUTPUT.                     09410000
      *    THIS IS A REMOTE QUEUE.                                      09420000
      ***************************************************************   09430000
                                                                        09440000
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      09450000
                                     MQOO-FAIL-IF-QUIESCING.            09460000
                                                                        09470000
           MOVE TF049-REPLYTOQ     TO MQOD-OBJECTNAME.                  09480000
           MOVE TF049-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              09490000
                                                                        09500000
           CALL WS-MQOPEN USING PV-HCONN                                09510000
                                MQM-OBJECT-DESCRIPTOR                   09520000
                                PV-OPEN-OPTIONS                         09530000
                                PV-PQ-HANDLE                            09540000
                                PV-COMPLETION-CODE                      09550000
                                PV-REASON.                              09560000
                                                                        09570000
      ********************************************************          09580000
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    09590000
      *    AND EXIT.                                                    09600000
      ********************************************************          09610000
      *                                                                 09620000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   09630000
               PERFORM 8600-CLOSE-PUT-Q                                 09640000
               PERFORM 8610-DISCONNECT-QMGR                             09650000
               MOVE 'MQOPEN WRITE Q'                                    09660000
                                   TO PV-ERROR-MESSAGE                  09670000
               MOVE '8510-MQ-SETUP-REMOTE'                              09680000
                                   TO DP013-PARAGRAPH                   09690000
               MOVE  PV-ERROR-MESSAGE                                   09700000
                                   TO DP013-MESSAGE-TEXT (1)            09710000
               MOVE  PV-COMPLETION-CODE                                 09720000
                                   TO DP013-MESSAGE-TEXT (2)            09730000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            09740000
               SET DP013-CICS-ABEND                                     09750000
                   DP013-NO-ROLLBACK                                    09760000
                                   TO TRUE                              09770000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          09780000
               PERFORM 9100-EXEC-CICS-RETURN                            09790000
           END-IF.                                                      09800000
           MOVE PV-PQ-HANDLE       TO PV-FMT-OPEN-OUTPUT-HNDL.          09810000
      *                                                                 09820000
      ******************************************************************09830000
       8520-PUT-QUEUE.                                                  09840000
           MOVE TF049-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              09850000
           MOVE TF049-REPLYTOQ     TO MQOD-OBJECTNAME.                  09860000
           MOVE TF049-MSGID        TO MQMD-CORRELID.                    09870000
           MOVE MQMI-NONE          TO MQMD-MSGID.                       09880000
           MOVE MQFMT-STRING       TO MQMD-FORMAT.                      09890000
           MOVE 5000               TO MQMD-EXPIRY.                      09900000
           MOVE LENGTH OF TF046-XFER-TO-PTC-RECORD                      09910000
                                   TO PV-DATA-LENGTH.                   09920000
           MOVE TF046-XFER-TO-PTC-RECORD                                09930000
                                   TO PV-MSGBUFFER.                     09940000
           MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 09950000
                                                                        09960000
           COMPUTE MQPMO-CONTEXT  =  PV-PQ-HANDLE.                      09970000
                                                                        09980000
                                                                        09990000
                                                                        10000000
           CALL WS-MQPUT USING PV-HCONN                                 10010000
                               PV-FMT-OPEN-OUTPUT-HNDL                  10020000
                               MQM-MESSAGE-DESCRIPTOR                   10030000
                               MQM-PUT-MESSAGE-OPTIONS                  10040000
                               PV-DATA-LENGTH                           10050000
                               PV-MSGBUFFER                             10060000
                               PV-COMPLETION-CODE                       10070000
                               PV-REASON.                               10080000
                                                                        10090000
      ***********************************************************       10100000
      *        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 10110000
      *        AND BREAK OUT OF LOOP                                    10120000
      ***********************************************************       10130000
                                                                        10140000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   10150000
               MOVE PV-COMPLETION-CODE                                  10160000
                                   TO PH-COMPLETION-CODE                10170000
               MOVE PV-REASON      TO PH-REASON                         10180000
               PERFORM 8600-CLOSE-PUT-Q                                 10190000
               PERFORM 8610-DISCONNECT-QMGR                             10200000
               MOVE 'MQPUT ERR'    TO PV-ERROR-MESSAGE                  10210000
               MOVE '8520-PUT-QUEUE'                                    10220000
                                   TO DP013-PARAGRAPH                   10230000
               MOVE PV-ERROR-MESSAGE                                    10240000
                                   TO DP013-MESSAGE-TEXT (1)            10250000
               MOVE PH-COMPLETION-CODE                                  10260000
                                   TO DP013-MESSAGE-TEXT (2)            10270000
               MOVE PH-REASON      TO DP013-MESSAGE-TEXT (3)            10280000
               SET DP013-CICS-ABEND                                     10290000
                   DP013-NO-ROLLBACK                                    10300000
                                   TO TRUE                              10310000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          10320000
               PERFORM 9100-EXEC-CICS-RETURN                            10330000
           ELSE                                                         10340000
               SET PS-MQPUT-SUCCESSFUL                                  10350000
                                   TO TRUE                              10360000
           END-IF.                                                      10370000
      *                                                                 10380000
      ******************************************************************10390000
       8600-CLOSE-PUT-Q.                                                10400000
           CALL WS-MQCLOSE USING PV-HCONN                               10410000
                                 PV-PQ-HANDLE                           10420000
                                 MQCO-NONE                              10430000
                                 PV-COMPLETION-CODE                     10440000
                                 PV-REASON.                             10450000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   10460000
               MOVE 'MQCLOSE PQ HANDLE'                                 10470000
                                   TO PV-ERROR-MESSAGE                  10480000
               MOVE '8600-CLOSE-PUT-Q'                                  10490000
                                   TO DP013-PARAGRAPH                   10500000
               MOVE  PV-ERROR-MESSAGE                                   10510000
                                   TO DP013-MESSAGE-TEXT (1)            10520000
               MOVE  PV-COMPLETION-CODE                                 10530000
                                   TO DP013-MESSAGE-TEXT (2)            10540000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            10550000
               SET DP013-CICS-ABEND                                     10560000
                   DP013-NO-ROLLBACK                                    10570000
                                   TO TRUE                              10580000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          10590000
               PERFORM 9100-EXEC-CICS-RETURN                            10600000
           END-IF.                                                      10610000
      *                                                                 10620000
      ******************************************************************10630000
       8610-DISCONNECT-QMGR.                                            10640000
                                                                        10650000
           IF PV-CON-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED      10660000
              CALL WS-MQDISC USING PV-HCONN                             10670000
                                   PV-COMPLETION-CODE                   10680000
                                   PV-REASON                            10690000
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                10700000
                  MOVE 'MQDISC'    TO PV-ERROR-MESSAGE                  10710000
                  MOVE '8610-DISCONNECT'                                10720000
                                   TO DP013-PARAGRAPH                   10730000
                  MOVE PV-ERROR-MESSAGE                                 10740000
                                   TO DP013-MESSAGE-TEXT (1)            10750000
                  MOVE PV-COMPLETION-CODE                               10760000
                                   TO DP013-MESSAGE-TEXT (2)            10770000
                  MOVE PV-REASON   TO DP013-MESSAGE-TEXT (3)            10780000
                  SET DP013-CICS-ABEND                                  10790000
                      DP013-NO-ROLLBACK                                 10800000
                                   TO TRUE                              10810000
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       10820000
                  PERFORM 9100-EXEC-CICS-RETURN                         10830000
              END-IF                                                    10840000
           END-IF.                                                      10850000
                                                                        10860000
      *                                                                 10870000
      ******************************************************************10880000
      *    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          10890000
      *    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   10900000
      *    STREAM BEING SENT BACK TO THE PTC.                           10910000
      ******************************************************************10920000
       9000-FMT-ERR-MSG-TO-PTC.                                         10930000
           PERFORM DP011-0000-FORMAT-MSG-LINES.                         10940000
           MOVE DP011-MSG-LEVEL    TO  TF046-ERR-TYP-IND.               10950000
           MOVE DP011-MSG-TEXT     TO  TF046-ERR-MSG.                   10960000
      *                                                                 10970000
       9100-EXEC-CICS-RETURN.                                           10980000
           EXEC CICS                                                    10990000
               RETURN                                                   11000000
           END-EXEC.                                                    11010000
      *                                                                 11020000
       9999-WRITE-CICS-LOG-MSG.                                         11030000
           MOVE PC-CURRENT-PROGRAM-NAME                                 11040000
                                   TO  DP013-PROGRAM.                   11050000
           MOVE DFHEIBLK           TO  DP013-DFHEIBLK.                  11060000
                                                                        11070000
           INITIALIZE DP013-SRC-TASK-NUMBER                             11080000
                      DP013-STACK.                                      11090000
                                                                        11100000
           SET DP013-LINK-RETURN   TO  TRUE.                            11110000
                                                                        11120000
           EXEC CICS                                                    11130000
               LINK                                                     11140000
                   PROGRAM   (DP013-NAME)                               11150000
                   COMMAREA  (DP013-PARAMETERS)                         11160000
                   LENGTH    (DP013-LENGTH)                             11170000
           END-EXEC.                                                    11180000
                                                                        11190000
      *                                                                 11200000
      *    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           11210000
      *                                                                 11220000
                                                                        11230000
           COPY DPPD011.                                                11240000
      *                                                                 11250000
      *    NON-CICS ARCHITECTURE ABEND ROUTINE CALL                     11260000
      *                                                                 11270000
                                                                        11280000
           COPY DPPD014.                                                11290000
                                                                        11300000
           COPY EPPD000.                                                11310000
