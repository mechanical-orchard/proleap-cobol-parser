000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    DLKUT035.                                         00040000
000500 AUTHOR.        GERMAN BANDA.                                     00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   MAY 2015.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000* THIS PROGRAM READ IN A FILE CONTAINING MULITPLE RECORDS FOR THE 00100000
001100* SAME TK NUMBER AND WRITE A NEW FILE WITH EACH TK APPEARING      00110000
001110* ONLY ONCE.                                                      00111000
001200***************************************************************** 00120000
001300                                                                  00130000
001400***************************************************************** 00140000
001500 ENVIRONMENT DIVISION.                                            00150000
001600***************************************************************** 00160000
001700 INPUT-OUTPUT SECTION.                                            00170000
001800                                                                  00180000
001900 FILE-CONTROL.                                                    00190000
002000     SELECT EXPORT-CLOCK-IN-FILE-IN                               00200000
002100         ASSIGN TO INP01.                                         00210000
002200     SELECT EXPORT-CLOCK-IN-FILE-OUT                              00220000
002300         ASSIGN TO OUT01.                                         00230000
002400                                                                  00240000
002500***************************************************************** 00250000
002600 DATA DIVISION.                                                   00260000
002700***************************************************************** 00270000
002800 FILE SECTION.                                                    00280000
002900*                                                                 00290000
003000 FD  EXPORT-CLOCK-IN-FILE-IN                                      00300000
003100     RECORDING MODE IS F                                          00310000
003200     LABEL RECORDS ARE STANDARD                                   00320000
003300     BLOCK CONTAINS 0 RECORDS.                                    00330000
003400 01  EXPORT-CLOCK-IN-RECORD-IN         PIC X(100).                00340000
003500*                                                                 00350000
003600 FD  EXPORT-CLOCK-IN-FILE-OUT                                     00360000
003700     RECORDING MODE IS F                                          00370000
003800     LABEL RECORDS ARE STANDARD                                   00380000
003900     BLOCK CONTAINS 0 RECORDS.                                    00390000
004000 01  EXPORT-CLOCK-IN-RECORD-OUT        PIC X(100).                00400000
004100*                                                                 00410000
004200***************************************************************** 00420000
004300 WORKING-STORAGE SECTION.                                         00430000
004400                                                                  00440000
004500 01  PS-PROGRAM-SWITCHES.                                         00450000
004510     05  PS-EOF-EXTRACT-SW            PIC X(01)  VALUE 'N'.       00451000
004520         88  PS-EOF-EXTRACT                      VALUE 'Y'.       00452000
004530         88  PS-NOT-EOF-CHECKIN                  VALUE 'N'.       00453000
004540     05  PS-VALID-RECORD-SW           PIC X(01)  VALUE 'N'.       00454000
004550         88  PS-VALID-RECORD                     VALUE 'Y'.       00455000
004560         88  PS-NOT-VALID-RECORD                 VALUE 'N'.       00456000
004570*                                                                 00457000
004580 01  PV-PROGRAM-VARIABLES.                                        00458000
004590                                                                  00459000
004700     05  PV-PO-NBR                    PIC S9(09).                 00470000
004800     05  PV-SCAC-CDE                  PIC X(04).                  00480000
004900     05  PV-PREV-USER-ID              PIC X(08).                  00490000
005200                                                                  00520000
005300     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      00530000
005400                                                                  00540000
005500     05  PV-TOTAL-INPUT-READ          PIC S9(09) VALUE ZERO       00550000
005600                                                  COMP SYNC.      00560000
005700     05  PV-RECS-WRITTEN              PIC S9(09) VALUE ZERO       00570000
005800                                                  COMP SYNC.      00580000
005900                                                                  00590000
006000 01 PC-PROGRAM-CONSTANTS.                                         00600000
006100     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'DLKUT035'. 00610000
006200     05  PC-DEFAULT-CC-DATE          PIC X(10) VALUE '9999-09-09'.00620000
006300                                                                  00630000
006400 01  PV-ABEND-FIELDS.                                             00640000
006500     05  ABEND-CODE                   PIC S9(04) VALUE +0         00650000
006600                                                 COMP SYNC.       00660000
006700     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'DLKUT035'.00670000
006800     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00680000
006900     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    00690000
007000******************************************************************00700000
007100*  USED FOR DB2 ERROR MESSAGE BUILDING                            00710000
007200******************************************************************00720000
007300     COPY DPWS004.                                                00730000
007400                                                                  00740000
007500***********************************************************       00750000
007600*  COPYBOOK USED IN CREATING EXTRACT FILE.                *       00760000
007700***********************************************************       00770000
007800     COPY DLRD017.                                                00780000
007900                                                                  00790000
008000 EJECT                                                            00800000
008100***********************************************************       00810000
008200 PROCEDURE DIVISION.                                              00820000
008300***********************************************************       00830000
008400 0000-PROGRAM-MAINLINE.                                           00840000
008500*                                                                 00850000
008600     PERFORM 1000-INITIALIZATION.                                 00860000
008700*                                                                 00870000
008800     PERFORM 2000-PROCESS-CLOCK-IN-FILE                           00880000
008900         UNTIL PS-EOF-EXTRACT.                                    00890000
009000*                                                                 00900000
009100     PERFORM 9000-EOJ-ROUTINE.                                    00910000
009200*                                                                 00920000
009300     GOBACK.                                                      00930000
009400*                                                                 00940000
009500******************************************************************00950000
009600*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    00960000
009700******************************************************************00970000
009800 1000-INITIALIZATION.                                             00980000
009900                                                                  00990000
010000     OPEN INPUT  EXPORT-CLOCK-IN-FILE-IN.                         01000000
010100     OPEN OUTPUT EXPORT-CLOCK-IN-FILE-OUT.                        01010000
010200                                                                  01020000
010300     PERFORM 8000-READ-CLOCK-IN-FILE.                             01030000
010400     MOVE SPACE TO PV-PREV-USER-ID.                               01040000
010500     IF  PS-EOF-EXTRACT                                           01050000
010600        DISPLAY 'CLOCK-IN FILE INP01 IS EMPTY'                    01060000
011000     END-IF.                                                      01100000
011100*                                                                 01110000
011200***************************************************************** 01120000
011300 2000-PROCESS-CLOCK-IN-FILE.                                      01130000
011400***************************************************************** 01140000
011500*                                                                 01150000
011600     IF DL017-CRE-BY-USR-ID = PV-PREV-USER-ID                     01160000
011610         CONTINUE                                                 01161000
011800     ELSE                                                         01180000
012000         PERFORM 8100-WRITE-UPDATE-RECORD                         01200000
012100         MOVE DL017-CRE-BY-USR-ID  TO PV-PREV-USER-ID             01210000
012500     END-IF.                                                      01250000
012600                                                                  01260000
012700     PERFORM 8000-READ-CLOCK-IN-FILE.                             01270000
012800*                                                                 01280000
013800***************************************************************** 01380000
013900 8000-READ-CLOCK-IN-FILE.                                         01390000
014000***************************************************************** 01400000
014100*                                                                 01410000
014200     READ EXPORT-CLOCK-IN-FILE-IN                                 01420001
014300          INTO DL017-ASSOC-STRT-REC-LAYOUT                        01430000
014400     AT END                                                       01440000
014500         SET PS-EOF-EXTRACT           TO TRUE                     01450000
015200     END-READ.                                                    01520000
015210     ADD +1 TO PV-TOTAL-INPUT-READ.                               01521002
015300*                                                                 01530000
015400***************************************************************** 01540000
015500 8100-WRITE-UPDATE-RECORD.                                        01550000
015600***************************************************************** 01560000
015700*                                                                 01570000
015800     WRITE EXPORT-CLOCK-IN-RECORD-OUT                             01580000
015900         FROM DL017-ASSOC-STRT-REC-LAYOUT                         01590000
016000     ADD 1                            TO PV-RECS-WRITTEN.         01600000
016100*                                                                 01610000
016200***************************************************************** 01620000
016300 9000-EOJ-ROUTINE.                                                01630000
016400***************************************************************** 01640000
016500*                                                                 01650000
016600     CLOSE EXPORT-CLOCK-IN-FILE-IN                                01660000
016700           EXPORT-CLOCK-IN-FILE-OUT.                              01670000
016800                                                                  01680000
016900     DISPLAY '**********************************'.                01690000
017000     DISPLAY '** DLKUT035 SUMMARY **'.                            01700000
017100     DISPLAY 'TOTAL INPUT RECS       = ' PV-TOTAL-INPUT-READ.     01710000
017200     DISPLAY 'TOTAL RECS WRITTEN     = ' PV-RECS-WRITTEN.         01720000
017300     DISPLAY '**********************************'.                01730000
017400                                                                  01740000
017500*                                                                 01750000
