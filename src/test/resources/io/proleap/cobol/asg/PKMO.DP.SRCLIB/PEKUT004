000100***************************************************************** 00010063
000200 IDENTIFICATION DIVISION.                                         00020063
000300***************************************************************** 00030063
000400 PROGRAM-ID.    PEKUT004.                                         00040099
000500 AUTHOR.        PRITHIVIRAJ SUBRAMANIAN.                          00050063
000600 INSTALLATION.  KOHLS.                                            00060063
000700 DATE-WRITTEN   FEBRUARY, 2014.                                   00070099
000800 DATE-COMPILED.                                                   00080063
000900***************************************************************** 00090063
001000*  THIS PROGRAM COMPARES THE PERM SUM FILE WITH MUC TABLE         00100099
001100*  EXTRACT  FILE , IF THE PRICE CHANGE ID IN BOTH THE FILE        00110099
001200*  MATCHES AND IF THE PRICE CHANGE TYPE CODE OF SUM FILE IS    MDA00120099
001300*  THEN CHANGE TYPE CODE TO MUC AND WRITE IT TO THE OUTPUT FILE IF00130099
001400*  IF IT DOESN'T MATCH THEN WRITE THE RECORD DIRECTLY TO THE      00140093
001500*  OUTPUT FILE.                                                   00150099
001600* ****************************************************************00160063
001700* CHANGE DESCRIPTION                                              00170063
001800* ****************************************************************00180063
001900* DATE  02/11/2014                                                00190099
002000*  CHANGE MADE: INITIAL VERSION.                                  00200063
002100* MADE BY: PRITHIVIRAJ S (COGNIZANT)    TKID: TKMAJC7             00210063
002100* CR NO : CHG0081217                                              00211099
002200***************************************************************** 00220063
002300 ENVIRONMENT DIVISION.                                            00230063
002310 CONFIGURATION SECTION.                                           00231099
002320 SOURCE-COMPUTER.        IBM-3090.                                00232099
002330 OBJECT-COMPUTER.        IBM-3090.                                00233099
002400 INPUT-OUTPUT SECTION.                                            00240063
002500*                                                                 00250063
002600 FILE-CONTROL.                                                    00260063
002700*                                                                 00270063
002800     SELECT INPUT-PERM-SUM                                        00280099
002900         ASSIGN TO INP01.                                         00290063
003000*                                                                 00300063
003100     SELECT  INPUT-MUC-FILE                                       00310099
003200         ASSIGN TO INP02.                                         00320063
003300*                                                                 00330063
003400     SELECT COMP-OUT-FILE                                         00340099
003500         ASSIGN TO OUT01.                                         00350063
003600*                                                                 00360063
003700***************************************************************** 00370063
003800 DATA DIVISION.                                                   00380063
003900***************************************************************** 00390063
004000 FILE SECTION.                                                    00400063
004100*                                                                 00410063
004200 FD  INPUT-PERM-SUM                                               00420099
004300     RECORDING MODE IS F                                          00430063
004400     BLOCK CONTAINS 0 RECORDS                                     00440063
004500     LABEL RECORDS ARE STANDARD.                                  00450063
004600*                                                                 00460063
004700 01  PERM-SUM-REC                   PIC X(40).                    00470099
004800*                                                                 00480063
004900 FD  INPUT-MUC-FILE                                               00490099
005000     RECORDING MODE IS F                                          00500063
005100     BLOCK CONTAINS 0 RECORDS                                     00510063
005200     LABEL RECORDS ARE STANDARD.                                  00520063
005300*                                                                 00530063
005400 01  MUC-DATA-REC                    PIC X(11).                   00540099
005500*                                                                 00550063
005600 FD  COMP-OUT-FILE                                                00560099
005700     RECORDING MODE IS F                                          00570063
005800     BLOCK CONTAINS 0 RECORDS                                     00580063
005900     LABEL RECORDS ARE STANDARD.                                  00590063
006000*                                                                 00600063
006100 01  COMP-OUT-REC                    PIC X(30).                   00610099
006200*                                                                 00620063
006300***************************************************************** 00630063
006400 WORKING-STORAGE SECTION.                                         00640063
006500*                                                                 00650063
006600 01  PS-PROGRAM-SWITCHES.                                         00660063
006700     05  PS-EOF-MUC-SW                PIC X(01)  VALUE 'N'.       00670063
006800         88  PS-EOF-MUC-YES                      VALUE 'Y'.       00680063
006900         88  PS-EOF-MUC-NO                       VALUE 'N'.       00690063
007000     05  PS-EOF-SUM-SW                PIC X(01)  VALUE 'N'.       00700099
007100         88  PS-EOF-SUM-YES                      VALUE 'Y'.       00710099
007200         88  PS-EOF-SUM-NO                       VALUE 'N'.       00720099
007300     05  PS-MATCH-SW                  PIC X(01)  VALUE 'N'.       00730099
007400         88  PS-MATCH-YES                        VALUE 'Y'.       00740099
007500         88  PS-MATCH-NO                         VALUE 'N'.       00750099
007900*                                                                 00790063
008000 01  PC-PROGRAM-CONSTANTS.                                        00800063
008100     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'PEKUT004'.00810099
008400*                                                                 00840063
008500 01  PV-PROGRAM-VARIABLES.                                        00850063
008600     05  PV-RECS-READ-SUM             PIC  9(09) VALUE  0.        00860099
008700     05  PV-RECS-READ-MUC             PIC  9(09) VALUE  0.        00870063
008800     05  PV-RECS-WRITE-SUM            PIC  9(09) VALUE  0.        00880099
008900     05  PV-RECS-WRITE-MUC            PIC  9(09) VALUE  0.        00890063
009800*                                                                 00980063
009900 01  PV-ABEND-FIELDS.                                             00990063
010000     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PEKUT004'.01000099
010100     05  FILLER                       PIC  X(01) VALUE SPACES.    01010063
010200     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01020063
010300     05  FILLER                       PIC  X(01) VALUE SPACES.    01030063
010400     05  PV-ABEND-MESSAGE             PIC  X(50) VALUE SPACES.    01040099
010500     05  FILLER                       PIC  X(01) VALUE SPACES.    01050078
010510     05  PV-ABEND-MESSAGE1            PIC  X(50) VALUE SPACES.    01051099
010520     05  FILLER                       PIC  X(01) VALUE SPACES.    01052099
010530     05  PV-ABEND-MESSAGE2            PIC  X(50) VALUE SPACES.    01053099
010540     05  FILLER                       PIC  X(01) VALUE SPACES.    01054099
010600     05  PV-OPERATION-ATTEMPTED       PIC  X(50) VALUE SPACE.     01060078
010700     05  FILLER                       PIC  X(01) VALUE SPACES.    01070063
010800     05  PV-ABEND-CODE                PIC  S9(04) VALUE +0  COMP. 01080078
010900*                                                                 01090077
011000 01  PV-TABLE.                                                    01100099
011100     05 PV-MUC                        OCCURS 99999 TIMES INDEXED  01110099
011200                                      BY PV-INX.                  01120099
011300        10 PV-MUC-PRCHG-ID               PIC  9(10) VALUE ZEROES. 01130099
011400        10 FILLER                        PIC  X(01) VALUE SPACES. 01140099
013410***************************************************************** 01341099
013420*  INPUT LAYOUT FOR SUM FILE                                    * 01342099
013430***************************************************************** 01343099
013500 01  WS-PROCESS-INPUT-PE.                                         01350099
013510     05  PE-PRCHG-ID                  PIC 9(10)  VALUE ZEROES.    01351099
013520     05  PE-PRCHG-TYP-CDE             PIC X(03)  VALUE SPACES.    01352099
013530     05  PE-TOT-ACT-OH-QTY            PIC X(10)  VALUE SPACES.    01353099
013540     05  PE-TOT-ACT-PRCH-AMT          PIC X(12)  VALUE SPACES.    01354099
013541*    05  PE-TOT-ACT-PRCH-AMT          PIC +9(09)V99  VALUE ZEROES.01354199
013550     05  FILLER                       PIC X(5)      VALUE SPACES. 01355099
013560*                                                                 01356099
013561***************************************************************** 01356199
013562*  INPUT LAYOUT FOR MUC FILE                                    * 01356299
013563***************************************************************** 01356399
013564 01  WS-MUC-REC.                                                  01356499
013565     05 WS-MUC-PRCHG-ID               PIC  9(10) VALUE ZEROES.    01356599
013566     05 FILLER                        PIC  X(01) VALUE SPACES.    01356699
013567*                                                                 01356799
013570***************************************************************** 01357099
013580*  INPUT LAYOUT FOR SUM FILE                                    * 01358099
013590***************************************************************** 01359099
013591 01  WS-PROCESS-OUTPUT-PE.                                        01359199
013593     05  PE-PRCHG-TYP-CDE-O           PIC X(03)  VALUE SPACES.    01359399
013594     05  PE-TOT-ACT-OH-QTY-O          PIC X(10)  VALUE SPACES.    01359499
013595     05  PE-TOT-ACT-PRCH-AMT-O        PIC X(12)  VALUE SPACES.    01359599
013597     05  FILLER                       PIC X(5)      VALUE SPACES. 01359799
013600*                                                                 01360099
017100***************************************************************** 01710063
017200 PROCEDURE DIVISION.                                              01720063
017300***************************************************************** 01730063
017400     DISPLAY '**** BEGINNING PEKUT004 ****'.                      01740099
017500     DISPLAY ' '.                                                 01750063
017600*                                                                 01760063
017700 0000-MAIN-PARA.                                                  01770063
017800     PERFORM 1000-INITIALIZATION.                                 01780063
017900     PERFORM 2000-MAIN-PROCESS.                                   01790063
018000     PERFORM 9000-EOJ.                                            01800064
018100*                                                                 01810065
018200        STOP RUN.                                                 01820067
018300*                                                                 01830063
018400***************************************************************** 01840063
018500*  INITIALIZE PARA                                                01850063
018600***************************************************************** 01860063
018700 1000-INITIALIZATION.                                             01870063
018800*                                                                 01880084
018900     MOVE '1000-INITIALIZATION ' TO PV-ABEND-PARAGRAPH.           01890063
019000*                                                                 01900063
019300     OPEN INPUT  INPUT-PERM-SUM                                   01930099
019400                 INPUT-MUC-FILE                                   01940099
019500          OUTPUT COMP-OUT-FILE.                                   01950099
019600*                                                                 01960063
019700     INITIALIZE PV-PROGRAM-VARIABLES.                             01970063
019800     INITIALIZE MUC-DATA-REC.                                     01980099
019900     INITIALIZE WS-PROCESS-INPUT-PE.                              01990099
020000     INITIALIZE WS-PROCESS-OUTPUT-PE.                             02000099
020100*                                                                 02010063
020200***************************************************************** 02020063
020300*  MAIN PROCESS PARA                                              02030063
020400***************************************************************** 02040063
020500 2000-MAIN-PROCESS.                                               02050063
020600*                                                                 02060063
020700     MOVE '2000-MAIN-PROCESS ' TO PV-ABEND-PARAGRAPH.             02070063
020800*                                                                 02080063
020900      PERFORM 2150-READ-MUC-FILE                                  02090099
021000        UNTIL PS-EOF-MUC-YES                                      02100099
021010*                                                                 02101099
021100      PERFORM UNTIL PS-EOF-SUM-YES                                02110099
021200        PERFORM 2100-READ-PERM-SUM-FILE                           02120099
021210        IF PV-RECS-READ-SUM = 0 AND                               02121099
021220           PV-RECS-READ-MUC > 0                                   02122099
021230         MOVE 'PERM SUM FILE IS EMPTY'                            02123099
021240                      TO    PV-ABEND-MESSAGE                      02124099
021250         MOVE 'PLEASE CHECK THE STATUS OF PRICE CHANGE'           02125099
021260                      TO    PV-ABEND-MESSAGE1                     02126099
021270         MOVE '       IN PERM/XMTABLE AND CORRECT AS NEEDED'      02127099
021280                      TO    PV-ABEND-MESSAGE2                     02128099
021290       PERFORM 9999-ABEND                                         02129099
021291      END-IF                                                      02129199
021300         IF PE-PRCHG-ID IS NOT NUMERIC                            02130099
021310           MOVE 'PRICE CHANGE ID IS NOT NUMERIC'  TO              02131099
021320                                      PV-ABEND-MESSAGE            02132099
021321           PERFORM 9999-ABEND                                     02132199
021330         END-IF                                                   02133099
021400            IF PE-PRCHG-TYP-CDE = 'MDA' AND                       02140099
021500               PS-EOF-SUM-NO                                      02150099
021501              SET PS-MATCH-NO           TO TRUE                   02150199
021510              PERFORM 2200-CHECK-MUC-FILE                         02151099
021600            ELSE                                                  02160099
021610             IF  PS-EOF-SUM-NO                                    02161099
021620               MOVE PE-PRCHG-TYP-CDE    TO PE-PRCHG-TYP-CDE-O     02162099
021630               MOVE PE-TOT-ACT-OH-QTY   TO PE-TOT-ACT-OH-QTY-O    02163099
021640               MOVE PE-TOT-ACT-PRCH-AMT TO PE-TOT-ACT-PRCH-AMT-O  02164099
021700               WRITE COMP-OUT-REC FROM WS-PROCESS-OUTPUT-PE       02170099
021800               ADD 1               TO PV-RECS-WRITE-SUM           02180099
021900             END-IF                                               02190099
021910            END-IF                                                02191099
022000      END-PERFORM.                                                02200077
022100*                                                                 02210063
027600***************************************************************** 02760063
027700*  READ PERM SUM EXTRACT FILE                                   * 02770099
027800***************************************************************** 02780063
027900 2100-READ-PERM-SUM-FILE.                                         02790099
028000*                                                                 02800063
028100     MOVE '2100-READ-PERM-SUM-FILE ' TO PV-ABEND-PARAGRAPH.       02810099
028200*                                                                 02820063
028300       READ INPUT-PERM-SUM                                        02830099
028400          INTO WS-PROCESS-INPUT-PE                                02840099
028500       AT END                                                     02850063
028600          SET PS-EOF-SUM-YES         TO TRUE                      02860099
028700       END-READ.                                                  02870063
028800*                                                                 02880063
028900       IF PS-EOF-SUM-NO                                           02890099
029000            ADD 1                   TO PV-RECS-READ-SUM           02900099
029100       END-IF.                                                    02910063
029200*                                                                 02920063
029210***************************************************************** 02921099
029220*  READ MUC EXTRACT FILE                                        * 02922099
029230***************************************************************** 02923099
029240 2150-READ-MUC-FILE.                                              02924099
029250*                                                                 02925099
029260     MOVE '2150-READ-MUC-FILE '     TO PV-ABEND-PARAGRAPH.        02926099
029270*                                                                 02927099
029280       READ INPUT-MUC-FILE                                        02928099
029290          INTO WS-MUC-REC                                         02929099
029291       AT END                                                     02929199
029292          SET PS-EOF-MUC-YES        TO TRUE                       02929299
029293       NOT AT END                                                 02929399
029294         IF WS-MUC-PRCHG-ID IS NOT NUMERIC                        02929499
029295           MOVE 'PRICE CHANGE ID IS NOT NUMERIC'  TO              02929599
029296                                   PV-ABEND-MESSAGE               02929699
029297           PERFORM 9999-ABEND                                     02929799
029298         END-IF                                                   02929899
029299         IF PS-EOF-MUC-NO                                         02929999
029300            ADD 1                   TO PV-RECS-READ-MUC           02930099
029301         END-IF                                                   02930199
029302         PERFORM 2151-MOVE-FILE                                   02930299
029303       END-READ.                                                  02930399
029304*                                                                 02930499
029307***************************************************************** 02930799
029308* MOVE FILE VARIABLES TO TEMP TABLE                               02930899
029309***************************************************************** 02930999
029310 2151-MOVE-FILE.                                                  02931099
029311*                                                                 02931199
029312     MOVE '2151-MOVE-FILE ' TO PV-ABEND-PARAGRAPH.                02931299
029313*                                                                 02931399
029314     IF PV-RECS-READ-MUC > 99999                                  02931499
029315       MOVE 'INTERNAL TABLE OVERFLOW'                             02931599
029316                      TO    PV-ABEND-MESSAGE                      02931699
029317       MOVE 'INCREASE THE INTERNAL TABLE SIZE GREATER THAN 99999' 02931799
029318                      TO    PV-ABEND-MESSAGE1                     02931899
029319       PERFORM 9999-ABEND                                         02931999
029320     END-IF                                                       02932099
029321     MOVE WS-MUC-REC TO PV-MUC(PV-INX)                            02932199
029322     SET PV-INX UP BY 1.                                          02932299
029323*                                                                 02932399
029330***************************************************************** 02933063
029400* CHECK MUC FILEE AND CHANGE MDA TO MUC FOR MATCHING RECS         02940099
029500***************************************************************** 02950063
029600 2200-CHECK-MUC-FILE.                                             02960099
029700*                                                                 02970063
029800     MOVE '2200-CHECK-MUC-FILE ' TO PV-ABEND-PARAGRAPH.           02980099
029810*                                                                 02981086
029820     SET PV-INX TO 1                                              02982099
029830       SEARCH PV-MUC                                              02983099
029850        WHEN PV-MUC-PRCHG-ID(PV-INX) = PE-PRCHG-ID                02985099
029860        SET PS-MATCH-YES          TO TRUE                         02986099
029870       END-SEARCH.                                                02987099
029880*                                                                 02988099
029950     IF PS-MATCH-YES                                              02995099
029960*                                                                 02996097
032400         MOVE 'MUC'               TO PE-PRCHG-TYP-CDE             03240099
032410         MOVE PE-PRCHG-TYP-CDE    TO PE-PRCHG-TYP-CDE-O           03241099
032420         MOVE PE-TOT-ACT-OH-QTY   TO PE-TOT-ACT-OH-QTY-O          03242099
032430         MOVE PE-TOT-ACT-PRCH-AMT TO PE-TOT-ACT-PRCH-AMT-O        03243099
032440*                                                                 03244099
032500         WRITE COMP-OUT-REC       FROM WS-PROCESS-OUTPUT-PE       03250099
032510         SET PS-MATCH-NO          TO TRUE                         03251099
032600         ADD 1                    TO PV-RECS-WRITE-MUC            03260099
032700     ELSE                                                         03270099
032800*                                                                 03280099
032810         MOVE PE-PRCHG-TYP-CDE    TO PE-PRCHG-TYP-CDE-O           03281099
032820         MOVE PE-TOT-ACT-OH-QTY   TO PE-TOT-ACT-OH-QTY-O          03282099
032830         MOVE PE-TOT-ACT-PRCH-AMT TO PE-TOT-ACT-PRCH-AMT-O        03283099
032840*                                                                 03284099
032900         WRITE COMP-OUT-REC FROM WS-PROCESS-OUTPUT-PE             03290099
033000         ADD 1                     TO PV-RECS-WRITE-SUM           03300099
033100*                                                                 03310099
034407     END-IF.                                                      03440786
034500*                                                                 03450063
039700***************************************************************** 03970071
039800*  END OF JOB OPERATIONS                                        * 03980063
039900***************************************************************** 03990063
040000 9000-EOJ.                                                        04000063
040100*                                                                 04010063
040200     MOVE '9000-EOJ ' TO PV-ABEND-PARAGRAPH.                      04020063
040300*                                                                 04030063
040400     CLOSE INPUT-PERM-SUM                                         04040099
040500           INPUT-MUC-FILE                                         04050099
040600           COMP-OUT-FILE.                                         04060099
040700*                                                                 04070063
041114*                                                                 04111490
041200      DISPLAY 'SUM REC READ COUNT      : ' PV-RECS-READ-SUM.      04120099
041210      DISPLAY 'MUC REC READ COUNT      : ' PV-RECS-READ-MUC.      04121099
041300      DISPLAY 'SUM REC WRITE COUNT     : ' PV-RECS-WRITE-SUM.     04130099
041310      DISPLAY 'MUC RECORD WRITE COUNT  : ' PV-RECS-WRITE-MUC.     04131099
041700*                                                                 04170063
044400******************************************************************04440098
044500*  THIS ROUTINE FORCES AN ABEND                                   04450098
044600******************************************************************04460098
044700 9999-ABEND.                                                      04470098
044800                                                                  04480098
044900     MOVE +4013 TO PV-ABEND-CODE.                                 04490098
044910     DISPLAY 'PARA : ' PV-ABEND-PARAGRAPH.                        04491099
044920     DISPLAY 'CODE : ' PV-ABEND-CODE.                             04492099
044930     DISPLAY 'ERROR: ' PV-ABEND-MESSAGE.                          04493099
044940     DISPLAY 'MSG  : ' PV-ABEND-MESSAGE1.                         04494099
044950     DISPLAY PV-ABEND-MESSAGE2.                                   04495099
045000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04500099
