000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    SUKCS581.                                         00040000
000500 AUTHOR.        LARRY SCHLEICHER.                                 00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  DEC, 2001.                                        00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    S581 - UPDATE VENDOR RANKING                                *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER TO UPDATE THE VENDOR RANKING.  *00120000
001300*    THE ENT ID AND VENDOR NAME ARE PROTECTED FIELD.             *00130000
001400*----------------------------------------------------------------*00140000
001500*    CHANGES                                                     *00141000
      *    MADE BY: CHERI PARMLEY        PR#5148D                      *00142000
      *    DATE:    10/01/2013                                         *00143000
      *                                                                *00144000
      *    NEW RANKING 'RFID' WAS ADDED TO THE SCREEN.                 *00145000
      *    CHANGES CAN BE FOUND WITH *CLP 10/01/13                     *00146000
      *                                                                *00147000
001600*----------------------------------------------------------------*00148000
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00148201
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00148301
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00148401
001130*                                                                 00148502
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00148602
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00148702
263968*---------------------------------------------------------------* 00148801
001500                                                                  00149000
001600                                                                  00150000
001700                                                                  00160000
001800 ENVIRONMENT DIVISION.                                            00170000
001900                                                                  00180000
002000                                                                  00190000
002100                                                                  00200000
002200 DATA DIVISION.                                                   00210000
002300                                                                  00220000
002400                                                                  00230000
002500 WORKING-STORAGE SECTION.                                         00240000
002600                                                                  00250000
002700 01  DK-DB2-KEYS.                                                 00260000
002800     05  DK-VENDOR-RANKING-CDE          PIC  X(06)  VALUE SPACE.  00270000
002900     05  DK-VENDOR-TYPE-CDE             PIC  X(02)  VALUE SPACE.  00280000
003000     05  DK-ENT-ID                      PIC S9(09)  COMP          00290000
003100                                                    VALUE ZERO.   00300000
003200     05  DK-PKGNG-TYP-CDE               PIC  X(02)  VALUE SPACE.  00310000
003300*                                                                 00320000
003400 01  PC-PROGRAM-CONSTANTS.                                        00330000
003500     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'SUKCS581'.  00340000
003600     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'SU581A  '.  00350000
003700     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'SUKM581 '.  00360000
003800     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00370000
003900                                              COMP.               00380000
004000     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00390000
004100                                              COMP.               00400000
004200     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1           00410000
004300                                              COMP.               00420000
004400     05  PC-UPD-VSAM              PIC  X(01)  VALUE 'Y'.          00430000
004500     05  PC-INTER-APPL-CODES.                                     00440000
004600         10  PC-INTER-APPL-CRIT-SPEC                              00450000
004700                                  PIC  X(01)  VALUE '1'.          00460000
004800         10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '2'.          00470000
004900     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       00480000
005000                                                                  00490000
005100     05  PC-TSYMSG-NUMBERS.                                       00500000
005200         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00510000
005300         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00520000
005400         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00530000
005500         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00540000
005600         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       00550000
005700         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00560000
005800         10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       00570000
005900         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       00580000
006000         10  PC-TSYMSG-02844      PIC  9(05)  VALUE  02844.       00590000
006100         10  PC-TSYMSG-02846      PIC  9(05)  VALUE  02846.       00600000
006200         10  PC-TSYMSG-02847      PIC  9(05)  VALUE  02847.       00610000
006300         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       00620000
006400*                                                                 00630000
006500 01  PS-PROGRAM-SWITCHES.                                         00640000
006600     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00650000
006700         88  PS-ERROR                         VALUE  'Y'.         00660000
006800         88  PS-NO-ERROR                      VALUE  'N'.         00670000
006900     05  PS-RANKING-FOUND-SW      PIC  X(01)  VALUE  'Y'.         00680000
007000         88  PS-RANKING-FOUND                 VALUE  'Y'.         00690000
007100         88  PS-RANKING-NOT-FOUND             VALUE  'N'.         00700000
007200     05  PS-END-OF-RANKINGS-SW    PIC  X(01)  VALUE  'N'.         00710000
007300         88  PS-END-OF-RANKINGS               VALUE  'Y'.         00720000
007400         88  PS-NOT-END-OF-RANKINGS           VALUE  'N'.         00730000
007500     05  PS-ACCESS-SW             PIC  X(01)  VALUE  'N'.         00740000
007600         88  PS-ACCESS-ALLOWED                VALUE  'Y'.         00750000
007700         88  PS-ACCESS-NOT-ALLOWED            VALUE  'N'.         00760000
007800*                                                                 00770000
007900 01  PV-PROGRAM-VARIABLES.                                        00780000
008000     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00790000
008100                                              COMP SYNC.          00800000
008200     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00810000
008300                                              COMP SYNC.          00820000
008400     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            00830000
008500                                              COMP SYNC.          00840000
008600     05  PV-BULK-VND-RNKG-CDE     PIC  X(06).                     00850000
008700     05  PV-PREPACK-VND-RNKG-CDE  PIC  X(06).                     00860000
008800     05  PV-PBS-VND-RNKG-CDE      PIC  X(06).                     00870000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   00880000
008800     05  PV-RFID-VND-RNKG-CDE     PIC  X(06).                     00881000
      *CLP 10/01/13 END   - PR# 5148D                                   00882000
008900     05  PV-BULK-VND-RNKG-DESC    PIC  X(30).                     00883000
009000     05  PV-PREPACK-VND-RNKG-DESC PIC  X(30).                     00884000
009100     05  PV-PBS-VND-RNKG-DESC     PIC  X(30).                     00885000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   00886000
009100     05  PV-RFID-VND-RNKG-DESC    PIC  X(30).                     00887000
      *CLP 10/01/13 END   - PR# 5148D                                   00888000
009200                                                                  00889000
009300     EJECT                                                        00890000
009400**--------------------------------------------------------------**00900000
009500** THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **00910000
009600** SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.         **00920000
009700**--------------------------------------------------------------**00930000
009800     COPY SUWS019.                                                00940000
009900 EJECT                                                            00950000
010000                                                                  00960000
010100*----------------------------------------------------------------*00970000
010200**  SECURITY SUBROUTINE PARAMETERS                                00980000
010300*----------------------------------------------------------------*00990000
010400     COPY DPWS008.                                                01000000
010500*----------------------------------------------------------------*01010000
010600*    MAP LAYOUT                                                  *01020000
010700*----------------------------------------------------------------*01030000
010800                                                                  01040000
010900     COPY SUKM581.                                                01050000
011000                                                                  01060000
011100 EJECT                                                            01070000
011200*----------------------------------------------------------------*01080000
011300*    ATTRIBUTE SETTINGS COPYBOOK.                                *01090000
011400*----------------------------------------------------------------*01100000
011500                                                                  01110000
011600     COPY DPWS015.                                                01120000
011700                                                                  01130000
011800*----------------------------------------------------------------*01140000
011900*    FUNCTION KEYS COPYBOOK                                      *01150000
012000*----------------------------------------------------------------*01160000
012100                                                                  01170000
012200     COPY DPWS016.                                                01180000
012300                                                                  01190000
012400 EJECT                                                            01200000
012500**--------------------------------------------------------------**01210000
012600** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01220000
012700** SUB-ROUTINE (DPKUT100).                                      **01230000
012800**--------------------------------------------------------------**01240000
012900     COPY DPWS010I.                                               01250000
013000 EJECT                                                            01260000
013100**--------------------------------------------------------------**01270000
013300** PARAMETERS FOR CALLING CICS ARCHITECTURE API                 **01290002
013400**--------------------------------------------------------------**01300000
013500     COPY DPWS030.                                                01310000
013500     COPY DPWS930.                                                01311002
013600 EJECT                                                            01320000
013700**--------------------------------------------------------------**01330000
013800*    STANDARD COMMAREA.                                           01340000
013900**--------------------------------------------------------------**01350000
014000                                                                  01360000
014100     COPY DPWS020.                                                01370000
014200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01380000
014300                                                                  01390000
014400***************************************************************** 01400000
014500*    INTER-APPLICATION COMMAREA.                                  01410000
014600***************************************************************** 01420000
014700                                                                  01430000
014800         10  INTER-APPL-COMM-AREA PIC X(200).                     01440000
014900     COPY SUWS017.                                                01450000
015000     COPY SUWS018.                                                01460000
015100***************************************************************** 01470000
015200*    SPECIFIC COMMMAREA FOR SUKCS581.                             01480000
015300***************************************************************** 01490000
015400         10  ASC-SPECIFIC-COMMAREA.                               01500000
015500             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            01510000
015600             15  ASC-ENT-ID.                                      01520000
015700                 20  ASC-ENT-ID-N          PIC  9(09).            01530000
015800             15  ASC-VENDOR-DESC           PIC  X(30).            01540000
015900             15  ASC-HOLD-BULK-RANKING     PIC  X(06).            01550000
016000             15  ASC-HOLD-PRE-PACK-RANKING PIC  X(06).            01560000
016100             15  ASC-HOLD-PBS-RANKING      PIC  X(06).            01570000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   01580000
016100             15  ASC-HOLD-RFID-RANKING     PIC  X(06).            01590000
      *CLP 10/01/13 END   - PR# 5148D                                   01600000
016200             15  ASC-BULK-RANKING          PIC  X(06).            01610000
016300             15  ASC-BULK-RANKING-DESC     PIC  X(30).            01620000
016400             15  ASC-PRE-PACK-RANKING      PIC  X(06).            01630000
016500             15  ASC-PRE-PACK-RANKING-DESC PIC  X(30).            01640000
016600             15  ASC-PBS-RANKING           PIC  X(06).            01650000
016700             15  ASC-PBS-RANKING-DESC      PIC  X(30).            01660000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   01670000
016600             15  ASC-RFID-RANKING          PIC  X(06).            01671000
016700             15  ASC-RFID-RANKING-DESC     PIC  X(30).            01672000
      *CLP 10/01/13 END   - PR# 5148D                                   01673000
016800             15  ASC-USE-SELECTION-QUEUE-IND                      01674000
016900                                           PIC  X(01).            01675000
017000                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 01676000
017100             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            01677000
017200             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    01678000
017300             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01679000
017400                                           PIC S9(09)  COMP-3.    01680000
017500             15  ASC-SEL-SUB               PIC S9(04)  COMP.      01690000
017600             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      01700000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   01710000
017700         10  FILLER                        PIC  X(2636).          01720000
      *CLP 10/01/13 END   - PR# 5148D                                   01730000
017800     EJECT                                                        01740000
017900*----------------------------------------------------------------*01750000
018000*    ABEND PROCESSING COPYBOOK.                                  *01760000
018100*----------------------------------------------------------------*01770000
018200                                                                  01780000
018300     COPY DPWS013.                                                01790000
018400                                                                  01800000
018500 EJECT                                                            01810000
018600                                                                  01820000
018700*----------------------------------------------------------------*01830000
018800*    DB2 DCLGEN FOR THE VENDOR RANKING CODES                      01840000
018900*    (SUT_VND_RNKG_CDE)                                           01850000
019000*----------------------------------------------------------------*01860000
019100     EXEC SQL                                                     01870000
019200          INCLUDE SUT00016                                        01880000
019300     END-EXEC.                                                    01890000
019400*----------------------------------------------------------------*01900000
019500*    DB2 DCLGEN FOR THE AUDIT PARM TABLE                          01910000
019600*    (SUT_PO_AUD_PARM)                                            01920000
019700*----------------------------------------------------------------*01930000
019800     EXEC SQL                                                     01940000
019900          INCLUDE SUT00017                                        01950000
020000     END-EXEC.                                                    01960000
020100*----------------------------------------------------------------*01970000
020200*    DB2 DCLGEN FOR THE VENDOR RANKING TABLE (SUT_VND_RNKG)       01980000
020300*----------------------------------------------------------------*01990000
020400     EXEC SQL                                                     02000000
020500          INCLUDE SUT00019                                        02010000
020600     END-EXEC.                                                    02020000
020700                                                                  02030000
020800*----------------------------------------------------------------*02040000
020900*    DB2 DCLGEN FOR THE VENDOR RANKING TABLE (SUT_VND_PKGNG_ASSN) 02050000
021000*----------------------------------------------------------------*02060000
021100     EXEC SQL                                                     02070000
021200          INCLUDE SUT00020                                        02080000
021300     END-EXEC.                                                    02090000
021400                                                                  02100000
021500*    DB2 AREA FOR COMMUNICATIONS                                  02110000
021600                                                                  02120000
021700     EXEC SQL                                                     02130000
021800          INCLUDE SQLCA                                           02140000
021900     END-EXEC.                                                    02150000
022000                                                                  02160000
022100*---------------------------------------------------------------* 02170000
022200*    CURSOR FOR ALL THE RANKINGS FOR VENDOR                       02180000
022300*---------------------------------------------------------------* 02190000
022400     EXEC SQL                                                     02200000
022500          DECLARE RANKINGS-CSR CURSOR                             02210000
022600          FOR SELECT                                              02220000
022700                B.VND_RNKG_CDE                                    02230000
022800             ,  B.PKGNG_TYP_CDE                                   02240000
022900             ,  C.VND_RNKG_DESC                                   02250000
023000          FROM                                                    02260000
023100                SUT_VND_RNKG A                                    02270000
023200             ,  SUT_PO_AUD_PARM B                                 02280000
023300             ,  SUT_VND_RNKG_CDE C                                02290000
023400          WHERE                                                   02300000
023500                A.ENT_ID         = :DK-ENT-ID                     02310000
023600            AND A.VND_RNKG_CDE   = B.VND_RNKG_CDE                 02320000
023700            AND A.PKGNG_TYP_CDE  = B.PKGNG_TYP_CDE                02330000
023800            AND B.VND_RNKG_CDE   = C.VND_RNKG_CDE                 02340000
023900            AND B.EFF_BEG_TMST IN                                 02350000
024000            (SELECT MAX(C.EFF_BEG_TMST)                           02360000
024100              FROM SUT_PO_AUD_PARM C                              02370000
024200              WHERE C.VND_RNKG_CDE  = B.VND_RNKG_CDE              02380000
024300                AND C.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE)            02390000
024400     END-EXEC.                                                    02400000
024500                                                                  02410000
024600 EJECT                                                            02420000
024700 LINKAGE SECTION.                                                 02430000
024800                                                                  02440000
024900 01  DFHCOMMAREA.                                                 02450000
025000     05  FILLER                         OCCURS  1 TO 4072 TIMES   02460000
025100                                        DEPENDING ON EIBCALEN.    02470000
025200         10  FILLER                     PIC X.                    02480000
025300                                                                  02490000
025400                                                                  02500000
025500 PROCEDURE DIVISION.                                              02510000
025600***************************************************************** 02520000
025700** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02530000
025800** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02540000
025900** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02550000
026000**                                                             ** 02560000
026100** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02570000
026200** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02580000
026300***************************************************************** 02590000
026400 0000-MAIN-MODULE.                                                02600000
026500     INITIALIZE DP030-CICS-API-FIELDS.                            02610000
026600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02620000
026700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02630000
026800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02640000
026900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02650000
027000     MOVE LENGTH OF SU581AI        TO DP030-MAP-LENGTH (1).       02660000
027100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02670000
027200     PERFORM 0001-CALL-CICS-ARCH-API.                             02680000
027300*                                                                 02690000
027400     PERFORM 1000-CONTROL-PROCESSING                              02700000
027500*                                                                 02710000
027600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02720000
027700     PERFORM 0001-CALL-CICS-ARCH-API.                             02730000
027800                                                                  02740000
027900 0001-CALL-CICS-ARCH-API.                                         02750000
028000*    CALL 'DPKCS030' USING DFHEIBLK                               02760002
028000     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02761002
028100                           DFHCOMMAREA                            02770000
028200                           DP030-CICS-API-FIELDS                  02780000
028300                           DP020-STANDARD-COMMAREA                02790000
028400                           SU581AI.                               02800000
028500*                                                                 02810000
028600     IF  DP030-RC-CALL-SUCCESSFUL                                 02820000
028700         CONTINUE                                                 02830000
028800     ELSE                                                         02840000
028900         SET DP013-NO-ROLLBACK                                    02850000
029000             DP013-XCTL-DISPLAY-RESTART                           02860000
029100             DP013-CICS-ABEND      TO TRUE                        02870000
029200         MOVE 'BEFORE 0000-MAIN-MODULE'                           02880000
029300                                   TO DP013-PARAGRAPH             02890000
029400*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX02900002
029500*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      02910002
029400         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL. RETURN-CODE O02911002
029500-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02912002
029600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02920000
029700         PERFORM DP013-0000-PROCESS-ABEND                         02930000
029800     END-IF.                                                      02940000
029900 EJECT                                                            02950000
030000*----------------------------------------------------------------*02960000
030100*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02970000
030200*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02980000
030300*----------------------------------------------------------------*02990000
030400                                                                  03000000
030500 1000-CONTROL-PROCESSING.                                         03010000
030600                                                                  03020000
030700     EVALUATE TRUE                                                03030000
030800         WHEN DP020-NEXT-ACT-INITIAL                              03040000
030900              PERFORM 1100-FIND-OBJECT-KEYS                       03050000
031000              IF  PS-ERROR                                        03060000
031100                  CONTINUE                                        03070000
031200              ELSE                                                03080000
031300                  PERFORM 4000-BUILD-INITIAL-PANEL                03090000
031400                  IF  SQLCODE = +100                              03100000
031500                      SET DP020-NEXT-ACT-APPL-ERROR TO TRUE       03110000
031600                      MOVE PC-TSYMSG-00148                        03120000
031700                                   TO DP020-MSG-NUMBER            03130000
031800                      SET DP020-MSG-INFORMATIONAL TO TRUE         03140000
031900                  END-IF                                          03150000
032000              END-IF                                              03160000
032100                                                                  03170000
032200         WHEN DP020-NEXT-ACT-READ-MAP                             03180000
032300             PERFORM 2000-PROCESS-PANEL                           03190000
032400                                                                  03200000
032500         WHEN DP020-NEXT-ACT-RETURN                               03210000
032600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03220000
032700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03230000
032800                                                                  03240000
032900         WHEN OTHER                                               03250000
033000             SET DP013-LOGIC-ABEND TO TRUE                        03260000
033100             SET DP013-NO-ROLLBACK TO TRUE                        03270000
033200             MOVE '1000-CONTROL-PROCESSING'                       03280000
033300                                   TO DP013-PARAGRAPH             03290000
033400             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03300000
033500                                   TO DP013-MESSAGE-TEXT(1)       03310000
033600             MOVE DP020-NEXT-APPL-ACTIVITY                        03320000
033700                                   TO DP013-MESSAGE-TEXT(2)       03330000
033800             PERFORM DP013-0000-PROCESS-ABEND                     03340000
033900     END-EVALUATE.                                                03350000
034000******************************************************************03360000
034100** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **03370000
034200** INTER-APPLICATION FORMAT CODE.                               **03380000
034300******************************************************************03390000
034400 1100-FIND-OBJECT-KEYS.                                           03400000
034500     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03410000
034600     MOVE DP020-INT-APPL-FORMAT-IND                               03420000
034700                                   TO ASC-INT-APPL-FORMAT-IND.    03430000
034800     EVALUATE DP020-INT-APPL-FORMAT-IND                           03440000
034900         WHEN PC-INTER-APPL-CRIT-SPEC                             03450000
035000             IF  SU017-ENT-ID > ZERO                              03460000
035100                 MOVE SU017-ENT-ID TO ASC-ENT-ID-N                03470000
035200                 MOVE SU017-VENDOR-DESC                           03480000
035300                                   TO ASC-VENDOR-DESC             03490000
035400             ELSE                                                 03500000
035500                 MOVE PC-TSYMSG-00148                             03510000
035600                                   TO DP020-MSG-NUMBER            03520000
035700                 SET DP020-MSG-FATAL                              03530000
035800                     DP020-NEXT-ACT-APPL-ERROR                    03540000
035900                                   TO TRUE                        03550000
036000             END-IF                                               03560000
036100                                                                  03570000
036200         WHEN PC-INTER-APPL-LIST                                  03580000
036300             SET ASC-USE-SELECTION-QUEUE TO TRUE                  03590000
036400             MOVE SU018-NUMBER-OF-SELECTED-ITEMS                  03600000
036500                                   TO ASC-NUMBER-OF-SELECTED-ITEMS03610000
036600             MOVE SU018-NUMBER-OF-TS-ITEMS                        03620000
036700                                   TO ASC-NUMBER-OF-TS-ITEMS      03630000
036800             MOVE SU018-SEL-QUEUE-NAME                            03640000
036900                                   TO ASC-SEL-QUEUE-NAME          03650000
037000             PERFORM 1120-PREPARE-LIST-ENTRY                      03660000
037100                                                                  03670000
037200         WHEN OTHER                                               03680000
037300             IF  DP020-NAV-KEY-DATA > SPACE                       03690000
037400                 PERFORM 1110-EDIT-NAV-KEY                        03700000
037500             ELSE                                                 03710000
037600                 MOVE PC-TSYMSG-00148                             03720000
037700                                   TO DP020-MSG-NUMBER            03730000
037800                 SET DP020-MSG-FATAL                              03740000
037900                     DP020-NEXT-ACT-APPL-ERROR                    03750000
038000                                   TO TRUE                        03760000
038100             END-IF                                               03770000
038200     END-EVALUATE.                                                03780000
038300******************************************************************03790000
038400** EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE   **03800000
038500** COMMAND LINE.  A VALID MESSAGE NUMBER IS THE ONLY KEY        **03810000
038600** ACCEPTED.                                                    **03820000
038700******************************************************************03830000
038800 1110-EDIT-NAV-KEY.                                               03840000
038900     IF  ASC-ENT-ID > SPACE                                       03850000
039000         MOVE DP020-NAV-KEY-DATA   TO DP010I-UNEDITED-FIELD       03860000
039100         MOVE LENGTH OF ASC-ENT-ID                                03870000
039200                                   TO DP010I-MAXIMUM-DIGITS       03880000
039300         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     03890000
039400         SET DP010I-NEGATIVE-NOT-ALLOWED                          03900000
039500                                   TO TRUE                        03910000
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         03921001
263968              USING DP010I-NUMERIC-EDIT-AREA                      03922001
039700         IF  DP010I-ERROR-DETECTED                                03930000
039800             SET PS-ERROR                                         03940000
039900                 DP020-MSG-FATAL   TO TRUE                        03950000
040000*            -- INVALID DATA IN KEY FIELD ---                     03960000
040100             MOVE PC-TSYMSG-00302  TO DP020-MSG-NUMBER            03970000
040200             SET DP020-NEXT-ACT-APPL-ERROR                        03980000
040300                                   TO TRUE                        03990000
040400         ELSE                                                     04000000
040500             MOVE DP010I-NUMERIC-FIELD                            04010000
040600                                   TO ASC-ENT-ID-N                04020000
040700         END-IF                                                   04030000
040800     END-IF.                                                      04040000
040900*----------------------------------------------------------------*04050000
041000* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *04060000
041100* STORAGE QUEUE PASSED FROM THE LIST.                            *04070000
041200*----------------------------------------------------------------*04080000
041300 1120-PREPARE-LIST-ENTRY.                                         04090000
041400     MOVE SU019-MAX-ITEMS          TO ASC-SEL-SUB.                04100000
041500     MOVE ZERO                     TO ASC-SEL-ITEM.               04110000
041600     PERFORM 2110-GET-NEXT-MESSAGE.                               04120000
041700*----------------------------------------------------------------*04130000
041800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04140000
041900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04150000
042000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04160000
042100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04170000
042200* FUNCTION KEYS CAN GET THIS FAR.                                *04180000
042300*----------------------------------------------------------------*04190000
042400                                                                  04200000
042500 2000-PROCESS-PANEL.                                              04210000
042600                                                                  04220000
042700     EVALUATE TRUE                                                04230000
042800                                                                  04240000
042900         WHEN DP020-SRC-AID = DP016-CLEAR                         04250000
043000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04260000
043100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04270000
043200                                                                  04280000
043300         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04290000
043400             SET DP030-DONT-ERASE                                 04300000
043500                 DP030-SEND-DATAONLY (PC-APPL-MAP)                04310000
043600                                   TO TRUE                        04320000
043700             PERFORM 4000-BUILD-INITIAL-PANEL                     04330000
043800             PERFORM 3200-RESET-ATTRIBUTES                        04340000
043900                                                                  04350000
044000         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04360000
044100             IF  ASC-USE-SELECTION-QUEUE                          04370000
044200                 PERFORM 2110-GET-NEXT-MESSAGE                    04380000
044300                 PERFORM 4000-BUILD-INITIAL-PANEL                 04390000
044400                 PERFORM 3200-RESET-ATTRIBUTES                    04400000
044500             ELSE                                                 04410000
044600*                --- BOTTOM OF LIST ---                           04420000
044700                 MOVE PC-TSYMSG-00070                             04430000
044800                                   TO DP020-MSG-NUMBER            04440000
044900                 SET DP020-MSG-INFORMATIONAL                      04450000
045000                                   TO TRUE                        04460000
045100             END-IF                                               04470000
045200                                                                  04480000
045300         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             04490000
045400             IF  ASC-USE-SELECTION-QUEUE                          04500000
045500                 PERFORM 2120-GET-PREV-MESSAGE                    04510000
045600                 PERFORM 4000-BUILD-INITIAL-PANEL                 04520000
045700                 PERFORM 3200-RESET-ATTRIBUTES                    04530000
045800             ELSE                                                 04540000
045900*                --- TOP OF LIST ---                              04550000
046000                 MOVE PC-TSYMSG-00069                             04560000
046100                                   TO DP020-MSG-NUMBER            04570000
046200                 SET DP020-MSG-INFORMATIONAL                      04580000
046300                                   TO TRUE                        04590000
046400             END-IF                                               04600000
046500                                                                  04610000
046600         WHEN OTHER                                               04620000
046700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04630000
046800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04640000
046900             IF  PS-NO-ERROR                                      04650000
047000                 SET DP030-CONTINUE-GO                            04660000
047100                                   TO TRUE                        04670000
047200                 PERFORM 2100-CHECK-FUNCTION-KEY                  04680000
047300             ELSE                                                 04690000
047400                 SET DP030-OVERRIDE-GO                            04700000
047500                                   TO TRUE                        04710000
047600             END-IF                                               04720000
047700     END-EVALUATE.                                                04730000
047800*----------------------------------------------------------------*04740000
047900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04750000
048000* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04760000
048100* FROM THE CICS ARCHITECTURE API.                                *04770000
048200*----------------------------------------------------------------*04780000
048300                                                                  04790000
048400 2100-CHECK-FUNCTION-KEY.                                         04800000
048500     EVALUATE TRUE                                                04810000
048600         WHEN DP020-SRC-AID = DP016-ENTER                         04820000
048700             CONTINUE                                             04830000
048800                                                                  04840000
048900* F15 - UPDATE VENDOR RANK   (LOCAL-FUNC-01)                      04850000
049000*                                                                 04860000
049100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04870000
049200             MOVE 'SUVNDRKU' TO DP008-FUNCTION-NAME               04880000
049300             PERFORM 2105-RACF-ACCESS                             04890000
049400             IF  PS-ACCESS-NOT-ALLOWED                            04900000
049500                 SET  PS-ERROR                                    04910000
049600                      DP020-MSG-FATAL TO TRUE                     04920000
049700                 MOVE PC-TSYMSG-02844 TO DP020-MSG-NUMBER         04930000
049800                 MOVE -1              TO ABULKCPL                 04940000
049900                 SET  DP030-SET-CURSOR-APPL-1 TO TRUE             04950000
050000                 SET DP030-OVERRIDE-GO        TO TRUE             04960000
050100             END-IF                                               04970000
050200             IF PS-NO-ERROR                                       04980000
050300                 SET DP030-CONTINUE-GO TO TRUE                    04990000
050400                 MOVE PC-TSYMSG-02847                             05000000
050500                               TO DP020-MSG-NUMBER                05010000
050600                 SET DP020-MSG-INFORMATIONAL                      05020000
050700                               TO TRUE                            05030000
050800             END-IF                                               05040000
050900                                                                  05050000
051000* F2  - CONFIRM UPDATE                                            05060000
051100*                                                                 05070000
051200         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    05080000
051300             MOVE 'SUVNDRKU' TO DP008-FUNCTION-NAME               05090000
051400             PERFORM 2105-RACF-ACCESS                             05100000
051500             IF  PS-ACCESS-NOT-ALLOWED                            05110000
051600                 SET  PS-ERROR                                    05120000
051700                      DP020-MSG-FATAL TO TRUE                     05130000
051800                 MOVE PC-TSYMSG-02844 TO DP020-MSG-NUMBER         05140000
051900                 MOVE -1              TO ABULKCPL                 05150000
052000                 SET  DP030-SET-CURSOR-APPL-1 TO TRUE             05160000
052100                 SET DP030-OVERRIDE-GO        TO TRUE             05170000
052200             END-IF                                               05180000
052300             IF PS-NO-ERROR                                       05190000
052400                 PERFORM 5000-UPDATE-VENDOR-RANKINGS              05200000
052500*            --- UPDATES SUCCESSFUL ---                           05210000
052600                 MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER        05220000
052700                 SET DP020-MSG-INFORMATIONAL                      05230000
052800                                       TO TRUE                    05240000
052900             END-IF                                               05250000
053000                                                                  05260000
053100* F23 - DEPARTMENT LIST (LOCAL-FUNC-02)                           05270000
053200*                                                                 05280000
053300         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              05290000
053400             PERFORM 2130-PREPARE-INTER-APPL-COMM                 05300000
053500                                                                  05310000
053600         WHEN OTHER                                               05320000
053700             SET DP013-NO-ROLLBACK                                05330000
053800                 DP013-XCTL-DISPLAY-RESTART                       05340000
053900                 DP013-CICS-ABEND  TO TRUE                        05350000
054000             MOVE '2000-PROCESS-PANEL'                            05360000
054100                                   TO DP013-PARAGRAPH             05370000
054200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05380000
054300                                   TO DP013-MESSAGE-TEXT (1)      05390000
054400             PERFORM DP013-0000-PROCESS-ABEND                     05400000
054500     END-EVALUATE.                                                05410000
054600                                                                  05420000
054700*----------------------------------------------------------------*05430000
054800* CHECK TO SEE IF USER HAS RACF AUTHORIZATION                     05440000
054900*----------------------------------------------------------------*05450000
055000 2105-RACF-ACCESS.                                                05460000
055100                                                                  05470000
055200      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  05480000
055300      SET DP008-ACCESS-TYPE-USE          TO TRUE                  05490000
055400                                                                  05500000
055500      EXEC CICS                                                   05510000
055600         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 05520000
055700              COMMAREA (DP008-SECURITY-COMMAREA)                  05530000
055800              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             05540000
055900      END-EXEC                                                    05550000
056000                                                                  05560000
056100      IF DP008-CALL-SUCCESSFUL                                    05570000
056200         IF DP008-ACCESS-ALLOWED                                  05580000
056300             SET PS-ACCESS-ALLOWED TO TRUE                        05590000
056400         ELSE                                                     05600000
056500             SET PS-ACCESS-NOT-ALLOWED TO TRUE                    05610000
056600         END-IF                                                   05620000
056700     ELSE                                                         05630000
056800         MOVE '2105-RACF-ACCESS'                                  05640000
056900                               TO DP013-PARAGRAPH                 05650000
057000          MOVE 'UNABLE TO ACCESS CICS'                            05660000
057100                               TO DP013-MESSAGE-TEXT (1)          05670000
057200          MOVE SQLCA                 TO DP013-SQLCA               05680000
057300          SET DP013-DB2-ABEND                                     05690000
057400              DP013-XCTL-DISPLAY-RESTART                          05700000
057500                               TO TRUE                            05710000
057600          PERFORM DP013-0000-PROCESS-ABEND                        05720000
057700      END-IF.                                                     05730000
057800                                                                  05740000
057900 2110-GET-NEXT-MESSAGE.                                           05750000
058000     ADD +1                        TO ASC-SEL-SUB.                05760000
058100     IF  ASC-SEL-SUB > SU019-MAX-ITEMS                            05770000
058200         ADD +1                    TO ASC-SEL-ITEM                05780000
058300         MOVE +1                   TO ASC-SEL-SUB                 05790000
058400     END-IF.                                                      05800000
058500     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                05810000
058600         PERFORM 9100-READ-SEL-QUEUE                              05820000
058700         IF  SU019-ITEM (ASC-SEL-SUB) > ZERO                      05830000
058800             MOVE SU019-ENT-ID      (ASC-SEL-SUB)                 05840000
058900                                   TO ASC-ENT-ID-N                05850000
059000             MOVE SU019-VENDOR-DESC (ASC-SEL-SUB)                 05860000
059100                                   TO ASC-VENDOR-DESC             05870000
059200             SET SU019-INQ (ASC-SEL-SUB)                          05880000
059300                                   TO TRUE                        05890000
059400             PERFORM 9200-REWRITE-LIST-QUEUE                      05900000
059500         ELSE                                                     05910000
059600             SUBTRACT +1 FROM ASC-SEL-SUB                         05920000
059700*            --- BOTTOM OF LIST ---                               05930000
059800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            05940000
059900             SET DP020-MSG-INFORMATIONAL                          05950000
060000                                   TO TRUE                        05960000
060100         END-IF                                                   05970000
060200     ELSE                                                         05980000
060300         SUBTRACT +1 FROM ASC-SEL-ITEM                            05990000
060400         MOVE SU019-MAX-ITEMS      TO ASC-SEL-SUB                 06000000
060500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06010000
060600         SET DP020-MSG-INFORMATIONAL                              06020000
060700                                   TO TRUE                        06030000
060800     END-IF.                                                      06040000
060900******************************************************************06050000
061000** GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED        **06060000
061100** OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.          **06070000
061200******************************************************************06080000
061300 2120-GET-PREV-MESSAGE.                                           06090000
061400     SUBTRACT +1 FROM ASC-SEL-SUB.                                06100000
061500     IF  ASC-SEL-SUB < +1                                         06110000
061600         SUBTRACT +1 FROM ASC-SEL-ITEM                            06120000
061700         MOVE SU019-MAX-ITEMS      TO ASC-SEL-SUB                 06130000
061800     END-IF.                                                      06140000
061900*                                                                 06150000
062000     IF  ASC-SEL-ITEM > ZERO                                      06160000
062100         PERFORM 9100-READ-SEL-QUEUE                              06170000
062200         MOVE SU019-ENT-ID      (ASC-SEL-SUB)                     06180000
062300                                   TO ASC-ENT-ID-N                06190000
062400         MOVE SU019-VENDOR-DESC (ASC-SEL-SUB)                     06200000
062500                                   TO ASC-VENDOR-DESC             06210000
062600     ELSE                                                         06220000
062700         MOVE +1                   TO ASC-SEL-ITEM                06230000
062800                                      ASC-SEL-SUB                 06240000
062900*        --- TOP OF LIST ---                                      06250000
063000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06260000
063100         SET DP020-MSG-INFORMATIONAL                              06270000
063200                                   TO TRUE                        06280000
063300     END-IF.                                                      06290000
063400******************************************************************06300000
063500** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **06310000
063600** INTER-APPLICATION COMMAREA.                                  **06320000
063700******************************************************************06330000
063800 2130-PREPARE-INTER-APPL-COMM.                                    06340000
063900     INITIALIZE SU017-INTER-APPL-COMMAREA.                        06350000
064000     MOVE ASC-ENT-ID-N             TO SU017-ENT-ID.               06360000
064100     MOVE ASC-VENDOR-DESC          TO SU017-VENDOR-DESC.          06370000
064200 EJECT                                                            06380000
064300*----------------------------------------------------------------*06390000
064400* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *06400000
064500* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *06410000
064600* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *06420000
064700*----------------------------------------------------------------*06430000
064800                                                                  06440000
064900 2200-MOVE-SCREEN-TO-COMMAREA.                                    06450000
065000     IF  ABULKCPL > ZERO                                          06460000
065100         MOVE ABULKCPI             TO ASC-BULK-RANKING            06470000
065200     ELSE                                                         06480000
065300         IF  ABULKCPF = DP015-ERASE-EOF                           06490000
065400             MOVE SPACE            TO ASC-BULK-RANKING            06500000
065500         END-IF                                                   06510000
065600     END-IF.                                                      06520000
065700                                                                  06530000
065800     IF  APREPAKL > ZERO                                          06540000
065900         MOVE APREPAKI             TO ASC-PRE-PACK-RANKING        06550000
066000     ELSE                                                         06560000
066100         IF  APREPAKF = DP015-ERASE-EOF                           06570000
066200             MOVE SPACE            TO ASC-PRE-PACK-RANKING        06580000
066300         END-IF                                                   06590000
066400     END-IF.                                                      06600000
066500                                                                  06610000
066600     IF  APACKBSL > ZERO                                          06620000
066700         MOVE APACKBSI             TO ASC-PBS-RANKING             06630000
066800     ELSE                                                         06640000
066900         IF  APACKBSF = DP015-ERASE-EOF                           06650000
067000             MOVE SPACE            TO ASC-PBS-RANKING             06660000
067100         END-IF                                                   06670000
067200     END-IF.                                                      06680000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   06690000
066600     IF  ARFIDBSL > ZERO                                          06700000
066700         MOVE ARFIDBSI             TO ASC-RFID-RANKING            06710000
066800     ELSE                                                         06720000
066900         IF  ARFIDBSF = DP015-ERASE-EOF                           06721000
067000             MOVE SPACE            TO ASC-RFID-RANKING            06722000
067100         END-IF                                                   06723000
067200     END-IF.                                                      06724000
      *CLP 10/01/13 END   - PR# 5148D                                   06725000
067300 EJECT                                                            06726000
067400*----------------------------------------------------------------*06727000
067500* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *06728000
067600* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *06729000
067700* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *06730000
067800*----------------------------------------------------------------*06740000
067900                                                                  06750000
068000 3000-EDIT-DATA-IN-COMMAREA.                                      06760000
068100     PERFORM 3200-RESET-ATTRIBUTES.                               06770000
068200     IF ASC-BULK-RANKING NOT = SPACE AND                          06780000
068300        ASC-BULK-RANKING NOT = ASC-HOLD-BULK-RANKING AND          06790000
068400        (NOT DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID))              06800000
068500         MOVE ASC-BULK-RANKING TO DK-VENDOR-RANKING-CDE           06810000
068600         MOVE 'BC'             TO DK-VENDOR-TYPE-CDE              06820000
068700         SET PS-RANKING-FOUND TO TRUE                             06830000
068800         PERFORM 3100-SELECT-VEND-RANKING                         06840000
068900         IF PS-RANKING-NOT-FOUND                                  06850000
069000             SET PS-ERROR                                         06860000
069100                 DP020-MSG-FATAL   TO TRUE                        06870000
069200             MOVE PC-TSYMSG-02846  TO DP020-MSG-NUMBER            06880000
069300             MOVE DP015-UNP-ALP-BRT-OFF                           06890000
069400                                   TO ABULKCPA                    06900000
069500             MOVE DP015-RED        TO ABULKCPC                    06910000
069600             MOVE DP015-REVERSE    TO ABULKCPH                    06920000
069700             MOVE -1               TO ABULKCPL                    06930000
069800             SET DP030-SET-CURSOR-APPL-1                          06940000
069900                                   TO TRUE                        06950000
070000         ELSE                                                     06960000
070100             IF ASC-BULK-RANKING = 'DEFALT'                       06970000
070200                 MOVE SPACES       TO ASC-BULK-RANKING-DESC       06980000
070300                                      ABKCPDSO                    06990000
070400             ELSE                                                 07000000
070500                 MOVE SUT00016-VND-RNKG-DESC                      07010000
070600                                   TO ASC-BULK-RANKING-DESC       07020000
070700                                      ABKCPDSO                    07030000
070800             END-IF                                               07040000
070900         END-IF                                                   07050000
071000     ELSE                                                         07060000
071100         IF ASC-BULK-RANKING = SPACE AND                          07070000
071200            ASC-BULK-RANKING NOT = ASC-HOLD-BULK-RANKING          07080000
071300             MOVE 'DEFALT'         TO ASC-BULK-RANKING            07090000
071400                                      ABULKCPO                    07100000
071500             MOVE SPACES           TO ASC-BULK-RANKING-DESC       07110000
071600                                      ABKCPDSO                    07120000
071700     END-IF.                                                      07130000
071800                                                                  07140000
071900     IF ASC-PRE-PACK-RANKING NOT = SPACE AND                      07150000
072000        ASC-PRE-PACK-RANKING NOT = ASC-HOLD-PRE-PACK-RANKING AND  07160000
072100        (NOT DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID))              07170000
072200         MOVE ASC-PRE-PACK-RANKING TO DK-VENDOR-RANKING-CDE       07180000
072300         MOVE 'PP'             TO DK-VENDOR-TYPE-CDE              07190000
072400         SET PS-RANKING-FOUND TO TRUE                             07200000
072500         PERFORM 3100-SELECT-VEND-RANKING                         07210000
072600         IF PS-RANKING-NOT-FOUND                                  07220000
072700             SET PS-ERROR                                         07230000
072800                 DP020-MSG-FATAL   TO TRUE                        07240000
072900             MOVE PC-TSYMSG-02846  TO DP020-MSG-NUMBER            07250000
073000             MOVE DP015-UNP-ALP-BRT-OFF                           07260000
073100                                   TO APREPAKA                    07270000
073200             MOVE DP015-RED        TO APREPAKC                    07280000
073300             MOVE DP015-REVERSE    TO APREPAKH                    07290000
073400             MOVE -1               TO APREPAKL                    07300000
073500             SET DP030-SET-CURSOR-APPL-1                          07310000
073600                                   TO TRUE                        07320000
073700         ELSE                                                     07330000
073800             IF ASC-PRE-PACK-RANKING = 'DEFALT'                   07340000
073900                 MOVE SPACES       TO ASC-PRE-PACK-RANKING-DESC   07350000
074000                                      APREPDSO                    07360000
074100             ELSE                                                 07370000
074200                 MOVE SUT00016-VND-RNKG-DESC                      07380000
074300                                   TO ASC-PRE-PACK-RANKING-DESC   07390000
074400                                      APREPDSO                    07400000
074500             END-IF                                               07410000
074600         END-IF                                                   07420000
074700     ELSE                                                         07430000
074800         IF ASC-PRE-PACK-RANKING = SPACE AND                      07440000
074900            ASC-PRE-PACK-RANKING NOT = ASC-HOLD-PRE-PACK-RANKING  07450000
075000             MOVE 'DEFALT'         TO ASC-PRE-PACK-RANKING        07460000
075100                                      APREPAKO                    07470000
075200             MOVE SPACES           TO ASC-PRE-PACK-RANKING-DESC   07480000
075300                                      APREPDSO                    07490000
075400     END-IF.                                                      07500000
075500                                                                  07510000
075600     IF ASC-PBS-RANKING NOT = SPACE AND                           07520000
075700        ASC-PBS-RANKING NOT = ASC-HOLD-PBS-RANKING AND            07530000
075800        (NOT DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID))              07540000
075900         MOVE ASC-PBS-RANKING TO DK-VENDOR-RANKING-CDE            07550000
076000         MOVE 'PS'             TO DK-VENDOR-TYPE-CDE              07560000
076100         SET PS-RANKING-FOUND TO TRUE                             07570000
076200         PERFORM 3100-SELECT-VEND-RANKING                         07580000
076300         IF PS-RANKING-NOT-FOUND                                  07590000
076400             SET PS-ERROR                                         07600000
076500                 DP020-MSG-FATAL   TO TRUE                        07610000
076600             MOVE PC-TSYMSG-02846  TO DP020-MSG-NUMBER            07620000
076700             MOVE DP015-UNP-ALP-BRT-OFF                           07630000
076800                                   TO APACKBSA                    07640000
076900             MOVE DP015-RED        TO APACKBSC                    07650000
077000             MOVE DP015-REVERSE    TO APACKBSH                    07660000
077100             MOVE -1               TO APACKBSL                    07670000
077200             SET DP030-SET-CURSOR-APPL-1                          07680000
077300                                   TO TRUE                        07690000
077400         ELSE                                                     07700000
077500             IF ASC-PBS-RANKING = 'DEFALT'                        07710000
077600                 MOVE SPACES       TO ASC-PBS-RANKING-DESC        07720000
077700                                      APKBSDSO                    07730000
077800             ELSE                                                 07740000
077900                 MOVE SUT00016-VND-RNKG-DESC                      07750000
078000                                   TO ASC-PBS-RANKING-DESC        07760000
078100                                      APKBSDSO                    07770000
078200             END-IF                                               07780000
078300         END-IF                                                   07790000
078400     ELSE                                                         07800000
078500         IF ASC-PBS-RANKING = SPACE AND                           07810000
078600            ASC-PBS-RANKING NOT = ASC-HOLD-PBS-RANKING            07820000
078700             MOVE 'DEFALT'         TO ASC-PBS-RANKING             07830000
078800                                      APACKBSO                    07840000
078900             MOVE SPACES           TO ASC-PBS-RANKING-DESC        07850000
079000                                      APKBSDSO                    07860000
079100     END-IF.                                                      07870000
079200                                                                  07880000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   07890000
075600     IF ASC-RFID-RANKING NOT = SPACE AND                          07900000
075700        ASC-RFID-RANKING NOT = ASC-HOLD-RFID-RANKING AND          07910000
075800        (NOT DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID))              07920000
075900         MOVE ASC-RFID-RANKING TO DK-VENDOR-RANKING-CDE           07921000
076000         MOVE 'RF'             TO DK-VENDOR-TYPE-CDE              07922000
076100         SET PS-RANKING-FOUND TO TRUE                             07923000
076200         PERFORM 3100-SELECT-VEND-RANKING                         07924000
076300         IF PS-RANKING-NOT-FOUND                                  07925000
076400             SET PS-ERROR                                         07926000
076500                 DP020-MSG-FATAL   TO TRUE                        07927000
076600             MOVE PC-TSYMSG-02846  TO DP020-MSG-NUMBER            07928000
076700             MOVE DP015-UNP-ALP-BRT-OFF                           07929000
076800                                   TO ARFIDBSA                    07929100
076900             MOVE DP015-RED        TO ARFIDBSC                    07929200
077000             MOVE DP015-REVERSE    TO ARFIDBSH                    07929300
077100             MOVE -1               TO ARFIDBSL                    07929400
077200             SET DP030-SET-CURSOR-APPL-1                          07929500
077300                                   TO TRUE                        07929600
077400         ELSE                                                     07929700
077500             IF ASC-RFID-RANKING = 'DEFALT'                       07929800
077600                 MOVE SPACES       TO ASC-RFID-RANKING-DESC       07929900
077700                                      ARFIDDSO                    07930000
077800             ELSE                                                 07930100
077900                 MOVE SUT00016-VND-RNKG-DESC                      07930200
078000                                   TO ASC-RFID-RANKING-DESC       07930300
078100                                      ARFIDDSO                    07930400
078200             END-IF                                               07930500
078300         END-IF                                                   07930600
078400     ELSE                                                         07930700
078500         IF ASC-RFID-RANKING = SPACE AND                          07930800
078600            ASC-RFID-RANKING NOT = ASC-HOLD-RFID-RANKING          07930900
078700             MOVE 'DEFALT'         TO ASC-RFID-RANKING            07931000
078800                                      ARFIDBSO                    07931100
078900             MOVE SPACES           TO ASC-PBS-RANKING-DESC        07931200
079000                                      ARFIDDSO                    07931300
079100     END-IF.                                                      07931400
      *CLP 10/01/13 END   - PR# 5148D                                   07931500
079200                                                                  07931600
079300*                                                                 07931700
079400     IF  PS-NO-ERROR                                              07931800
079500         MOVE -1                   TO ABULKCPL                    07931900
079600         SET DP030-SET-CURSOR-APPL-1                              07932000
079700                                   TO TRUE                        07933000
079800     END-IF.                                                      07934000
079900 3100-SELECT-VEND-RANKING.                                        07935000
080000     PERFORM                                                      07936000
080100         WITH TEST AFTER                                          07937000
080200         VARYING PV-RETRY-COUNTER                                 07938000
080300         FROM 1 BY 1                                              07939000
080400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07940000
080500                   OR (SQLCODE = ZERO)                            07950000
080600                   OR (SQLCODE = +100))                           07960000
080700*                                                                 07970000
080800         EXEC SQL                                                 07980000
080900             SELECT                                               07990000
081000                 B.VND_RNKG_DESC                                  08000000
081100             INTO                                                 08010000
081200                 :SUT00016-VND-RNKG-DESC                          08020000
081300             FROM SUT_VND_PKGNG_ASSN A                            08030000
081400               ,  SUT_VND_RNKG_CDE   B                            08040000
081500             WHERE A.VND_RNKG_CDE  = :DK-VENDOR-RANKING-CDE       08050000
081600               AND A.PKGNG_TYP_CDE = :DK-VENDOR-TYPE-CDE          08060000
081700               AND A.VND_RNKG_CDE  = B.VND_RNKG_CDE               08070000
081800         END-EXEC                                                 08080000
081900                                                                  08090000
082000         EVALUATE TRUE                                            08100000
082100             WHEN SQLCODE = ZERO                                  08110000
082200             WHEN SQLCODE = -904                                  08120000
082300             WHEN SQLCODE = -913                                  08130000
082400                 CONTINUE                                         08140000
082500             WHEN SQLCODE = +100                                  08150000
082600                  SET PS-RANKING-NOT-FOUND TO TRUE                08160000
082700             WHEN SQLWARN0 NOT = SPACES                           08170000
082800             WHEN SQLCODE < ZERO                                  08180000
082900             WHEN SQLCODE > ZERO                                  08190000
083000                 MOVE '3100-SELECT-VEND-RANKING'                  08200000
083100                                   TO DP013-PARAGRAPH             08210000
083200                 MOVE 'SELECT VENDOR RANKING CODE'                08220000
083300                                   TO DP013-MESSAGE-TEXT (1)      08230000
083400                 MOVE DK-VENDOR-RANKING-CDE                       08240000
083500                                   TO DP013-MESSAGE-TEXT (2)      08250000
083600                 MOVE SQLCA        TO DP013-SQLCA                 08260000
083700                 MOVE 'SUT00016'   TO DP013-DB2-TABLE-NAME (1)    08270000
083800                 SET DP013-DB2-ABEND                              08280000
083900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08290000
084000                 PERFORM DP013-0000-PROCESS-ABEND                 08300000
084100         END-EVALUATE                                             08310000
084200     END-PERFORM.                                                 08320000
084300*                                                                 08330000
084400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08340000
084500         MOVE '3100-SELECT-VEND-RANKING'                          08350000
084600                                   TO DP013-PARAGRAPH             08360000
084700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     08370000
084800                                   TO DP013-MESSAGE-TEXT (1)      08380000
084900         MOVE 'SELECT VENDOR RANKING CODE'                        08390000
085000                                   TO DP013-MESSAGE-TEXT (2)      08400000
085100         MOVE DK-VENDOR-RANKING-CDE                               08410000
085200                                   TO DP013-MESSAGE-TEXT (3)      08420000
085300         MOVE SQLCA                TO DP013-SQLCA                 08430000
085400         MOVE 'SUT00016'           TO DP013-DB2-TABLE-NAME (1)    08440000
085500         SET DP013-DB2-ABEND                                      08450000
085600             DP013-XCTL-DISPLAY-RESTART                           08460000
085700                                   TO TRUE                        08470000
085800         PERFORM DP013-0000-PROCESS-ABEND                         08480000
085900     END-IF.                                                      08490000
086000 EJECT                                                            08500000
086100*                                                                 08510000
086200*----------------------------------------------------------------*08520000
086300* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *08530000
086400* MAP.                                                           *08540000
086500*----------------------------------------------------------------*08550000
086600 3200-RESET-ATTRIBUTES.                                           08560000
086700     MOVE DP015-UNP-ALP-NOR-OFF    TO ABULKCPA                    08570000
086800                                      APREPAKA                    08580000
086900                                      APACKBSA                    08590000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   08600000
086900                                      ARFIDBSA.                   08610000
      *CLP 10/01/13 END   - PR# 5148D                                   08620000
087000     MOVE DP015-GREEN              TO ABULKCPC                    08630000
087100                                      APREPAKC                    08640000
087200                                      APACKBSC                    08650000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   08660000
087200                                      ARFIDBSC.                   08670000
      *CLP 10/01/13 END   - PR# 5148D                                   08680000
087300     MOVE DP015-UNDERLINE          TO ABULKCPH                    08690000
087400                                      APREPAKH                    08700000
087500                                      APACKBSH                    08710000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   08720000
087500                                      ARFIDBSH.                   08730000
      *CLP 10/01/13 END   - PR# 5148D                                   08740000
087600*                                                                 08750000
087700*                                                                 08760000
087800*----------------------------------------------------------------*08770000
087900*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *08780000
088000*    ENTRY.                                                      *08790000
088100*----------------------------------------------------------------*08800000
088200                                                                  08810000
088300 4000-BUILD-INITIAL-PANEL.                                        08820000
088400     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        08830000
088500     MOVE -1                       TO AVENNML.                    08840000
088600     MOVE ASC-ENT-ID-N             TO DK-ENT-ID.                  08850000
088700     PERFORM 4100-PROCESS-RANKINGS-CURSOR.                        08860000
088800     IF  SQLCODE = ZERO                                           08870000
088900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     08880000
089000     END-IF.                                                      08890000
089100                                                                  08900000
089200 4100-PROCESS-RANKINGS-CURSOR.                                    08910000
089300     MOVE 'DEFALT'  TO PV-BULK-VND-RNKG-CDE                       08920000
089400                       PV-PREPACK-VND-RNKG-CDE                    08930000
089500                       PV-PBS-VND-RNKG-CDE                        08940000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   08950000
089500                       PV-RFID-VND-RNKG-CDE.                      08951000
      *CLP 10/01/13 END   - PR# 5148D                                   08952000
089600     MOVE SPACES    TO PV-BULK-VND-RNKG-DESC                      08953000
089700                       PV-PREPACK-VND-RNKG-DESC                   08954000
089800                       PV-PBS-VND-RNKG-DESC                       08955000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   08956000
089800                       PV-RFID-VND-RNKG-DESC.                     08957000
      *CLP 10/01/13 END   - PR# 5148D                                   08958000
089900     SET PS-NOT-END-OF-RANKINGS TO TRUE.                          08959000
090000     PERFORM 4200-OPEN-RANKINGS-CSR.                              08960000
090100     PERFORM 4250-FETCH-RANKINGS-CSR                              08970000
090200         UNTIL PS-END-OF-RANKINGS.                                08980000
090300     PERFORM 4300-CLOSE-RANKINGS-CSR.                             08990000
090400     MOVE PV-BULK-VND-RNKG-CDE      TO ASC-BULK-RANKING           09000000
090500                                       ASC-HOLD-BULK-RANKING.     09010000
090600     MOVE PV-PREPACK-VND-RNKG-CDE   TO ASC-PRE-PACK-RANKING       09020000
090700                                       ASC-HOLD-PRE-PACK-RANKING. 09030000
090800     MOVE PV-PBS-VND-RNKG-CDE       TO ASC-PBS-RANKING            09040000
090900                                       ASC-HOLD-PBS-RANKING.      09050000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   09060000
090800     MOVE PV-RFID-VND-RNKG-CDE      TO ASC-RFID-RANKING           09070000
090900                                       ASC-HOLD-RFID-RANKING.     09080000
      *CLP 10/01/13 END   - PR# 5148D                                   09090000
091000     MOVE PV-BULK-VND-RNKG-DESC     TO ASC-BULK-RANKING-DESC.     09100000
091100     MOVE PV-PREPACK-VND-RNKG-DESC  TO ASC-PRE-PACK-RANKING-DESC. 09110000
091200     MOVE PV-PBS-VND-RNKG-DESC      TO ASC-PBS-RANKING-DESC.      09120000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   09120100
091200     MOVE PV-RFID-VND-RNKG-DESC     TO ASC-RFID-RANKING-DESC.     09120200
      *CLP 10/01/13 END   - PR# 5148D                                   09120300
091300                                                                  09120400
091400 4200-OPEN-RANKINGS-CSR.                                          09120500
091500     PERFORM                                                      09120600
091600         WITH TEST AFTER                                          09120700
091700         VARYING PV-RETRY-COUNTER                                 09120800
091800         FROM 1 BY 1                                              09120900
091900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09121000
092000                   OR (SQLCODE = ZERO))                           09122000
092100                 MOVE 'CURSOR:  ALL-VENDOR-CSR'                   09123000
092200                                   TO DP013-MESSAGE-TEXT (2)      09124000
092300             EXEC SQL                                             09125000
092400                  OPEN RANKINGS-CSR                               09126000
092500             END-EXEC                                             09127000
092600                                                                  09128000
092700                                                                  09129000
092800         EVALUATE TRUE                                            09130000
092900             WHEN SQLCODE = ZERO                                  09140000
093000             WHEN SQLCODE = -904                                  09150000
093100             WHEN SQLCODE = -913                                  09160000
093200                 CONTINUE                                         09170000
093300             WHEN SQLWARN0 NOT = SPACES                           09180000
093400             WHEN SQLCODE < ZERO                                  09190000
093500             WHEN SQLCODE > ZERO                                  09200000
093600                 MOVE '4200-OPEN-RANKINGS-CSR'                    09210000
093700                                   TO DP013-PARAGRAPH             09220000
093800                 MOVE 'OPEN THE RANKINGS CURSOR - '               09230000
093900                                   TO DP013-MESSAGE-TEXT (1)      09240000
094000                 MOVE SQLCA        TO DP013-SQLCA                 09250000
094100                 MOVE 'SUT00017'   TO DP013-DB2-TABLE-NAME (1)    09260000
094200                 SET DP013-DB2-ABEND                              09270000
094300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09280000
094400                 PERFORM DP013-0000-PROCESS-ABEND                 09290000
094500         END-EVALUATE                                             09300000
094600     END-PERFORM.                                                 09310000
094700*                                                                 09320000
094800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09330000
094900         MOVE '4200-OPEN-RANKINGS-CSR'                            09340000
095000                                   TO DP013-PARAGRAPH             09350000
095100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09360000
095200                                   TO DP013-MESSAGE-TEXT (1)      09370000
095300         MOVE SQLCA                TO DP013-SQLCA                 09380000
095400         MOVE 'SUT00017'           TO DP013-DB2-TABLE-NAME (1)    09390000
095500         SET DP013-DB2-ABEND                                      09400000
095600             DP013-XCTL-DISPLAY-RESTART                           09410000
095700                                   TO TRUE                        09420000
095800         PERFORM DP013-0000-PROCESS-ABEND                         09430000
095900     END-IF.                                                      09440000
096000                                                                  09450000
096100 EJECT                                                            09460000
096200 4250-FETCH-RANKINGS-CSR.                                         09470000
096300                                                                  09480000
096400     EXEC SQL                                                     09490000
096500          FETCH RANKINGS-CSR                                      09500000
096600          INTO  :SUT00017-VND-RNKG-CDE                            09510000
096700             ,  :SUT00017-PKGNG-TYP-CDE                           09520000
096800             ,  :SUT00016-VND-RNKG-DESC                           09530000
096900     END-EXEC.                                                    09540000
097000                                                                  09550000
097100     EVALUATE TRUE                                                09560000
097200         WHEN SQLCODE = ZERO                                      09570000
097300             IF SUT00017-PKGNG-TYP-CDE = 'BC'                     09580000
097400                 MOVE SUT00017-VND-RNKG-CDE                       09590000
097500                              TO PV-BULK-VND-RNKG-CDE             09600000
097600                 MOVE SUT00016-VND-RNKG-DESC                      09610000
097700                              TO PV-BULK-VND-RNKG-DESC            09620000
097800             ELSE                                                 09630000
097900                 IF SUT00017-PKGNG-TYP-CDE = 'PP'                 09640000
098000                     MOVE SUT00017-VND-RNKG-CDE                   09650000
098100                                  TO PV-PREPACK-VND-RNKG-CDE      09660000
098200                     MOVE SUT00016-VND-RNKG-DESC                  09670000
098300                              TO PV-PREPACK-VND-RNKG-DESC         09680000
098400                 ELSE                                             09690000
098500                     IF SUT00017-PKGNG-TYP-CDE = 'PS'             09700000
098600                         MOVE SUT00017-VND-RNKG-CDE               09710000
098700                                      TO PV-PBS-VND-RNKG-CDE      09720000
098800                         MOVE SUT00016-VND-RNKG-DESC              09730000
098900                              TO PV-PBS-VND-RNKG-DESC             09740000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   09750000
                           ELSE                                         09760000
098500                         IF SUT00017-PKGNG-TYP-CDE = 'RF'         09770000
098600                             MOVE SUT00017-VND-RNKG-CDE           09780000
098700                                          TO PV-RFID-VND-RNKG-CDE 09790000
098800                             MOVE SUT00016-VND-RNKG-DESC          09800000
098900                                  TO PV-RFID-VND-RNKG-DESC        09810000
099000                         END-IF                                   09820000
                           END-IF                                       09830000
      *CLP 10/01/13 END   - PR# 5148D                                   09840000
099100                 END-IF                                           09850000
099200             END-IF                                               09860000
099300         WHEN SQLCODE = +100                                      09870000
099400             SET PS-END-OF-RANKINGS TO TRUE                       09880000
099500         WHEN SQLWARN0 NOT = SPACE                                09890000
099600         WHEN SQLCODE NOT = ZERO                                  09900000
099700              MOVE '4250-FETCH-RANKINGS-CSR'                      09910000
099800                               TO DP013-PARAGRAPH                 09920000
099900              MOVE 'FETCH RANKINGS CURSOR'                        09930000
100000                               TO DP013-MESSAGE-TEXT (1)          09940000
100100              MOVE SQLCA       TO DP013-SQLCA                     09950000
100200              SET DP013-DB2-ABEND                                 09960000
100300                               TO TRUE                            09970000
100400              PERFORM DP013-0000-PROCESS-ABEND                    09980000
100500     END-EVALUATE.                                                09990000
100600                                                                  10000000
100700                                                                  10010000
100800*----------------------------------------------------------------*10020000
100900* CLOSE THE RANKINGS CURSOR                                      *10030000
101000*----------------------------------------------------------------*10040000
101100                                                                  10050000
101200 4300-CLOSE-RANKINGS-CSR.                                         10060000
101300     EXEC SQL                                                     10070000
101400         CLOSE RANKINGS-CSR                                       10080000
101500     END-EXEC.                                                    10090000
101600                                                                  10100000
101700*                                                                 10110000
101800     EVALUATE TRUE                                                10120000
101900         WHEN SQLCODE = ZERO                                      10130000
102000             CONTINUE                                             10140000
102100         WHEN SQLWARN0 NOT = SPACES                               10150000
102200         WHEN SQLCODE < ZERO                                      10160000
102300         WHEN SQLCODE > ZERO                                      10170000
102400             MOVE '4300-CLOSE-RANKINGS-CSR'                       10180000
102500                               TO DP013-PARAGRAPH                 10190000
102600             MOVE 'CLOSE THE RANKINGS CURSOR '                    10200000
102700                               TO DP013-MESSAGE-TEXT (1)          10210000
102800             MOVE SQLCA        TO DP013-SQLCA                     10220000
102900             MOVE 'SUT00017'   TO DP013-DB2-TABLE-NAME (1)        10230000
103000             SET DP013-DB2-ABEND                                  10240000
103100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10250000
103200             PERFORM DP013-0000-PROCESS-ABEND                     10260000
103300     END-EVALUATE.                                                10270000
103400                                                                  10280000
103500*----------------------------------------------------------------*10290000
103600*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *10300000
103700*----------------------------------------------------------------*10310000
103800                                                                  10320000
103900 4400-MOVE-COMMAREA-TO-SCREEN.                                    10330000
104000     MOVE ASC-ENT-ID                 TO AENTIDO.                  10340000
104100     MOVE ASC-VENDOR-DESC            TO AVENNMO.                  10350000
104200     MOVE ASC-BULK-RANKING           TO ABULKCPO.                 10360000
104300     MOVE ASC-PRE-PACK-RANKING       TO APREPAKO.                 10370000
104400     MOVE ASC-PBS-RANKING            TO APACKBSO.                 10380000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   10390000
104400     MOVE ASC-RFID-RANKING           TO ARFIDBSO.                 10400000
      *CLP 10/01/13 END   - PR# 5148D                                   10410000
104500     MOVE ASC-BULK-RANKING-DESC      TO ABKCPDSO.                 10420000
104600     MOVE ASC-PRE-PACK-RANKING-DESC  TO APREPDSO.                 10430000
104700     MOVE ASC-PBS-RANKING-DESC       TO APKBSDSO.                 10440000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   10450000
104700     MOVE ASC-RFID-RANKING-DESC      TO ARFIDDSO.                 10460000
      *CLP 10/01/13 END   - PR# 5148D                                   10470000
104800                                                                  10480000
104900 EJECT                                                            10490000
105000*----------------------------------------------------------------*10500000
105100* APPLY THE CHANGES TO THE MESSAGE TO THE DB2 TABLE.             *10510000
105200*----------------------------------------------------------------*10520000
105300 5000-UPDATE-VENDOR-RANKINGS.                                     10530000
105400     MOVE ASC-ENT-ID-N             TO DK-ENT-ID.                  10540000
105500     IF ASC-HOLD-BULK-RANKING NOT = ASC-BULK-RANKING              10550000
105600         MOVE ASC-BULK-RANKING     TO DK-VENDOR-RANKING-CDE       10560000
105700         MOVE 'BC'                 TO DK-PKGNG-TYP-CDE            10570000
105800         IF ASC-BULK-RANKING = 'DEFALT'                           10580000
105900             MOVE ASC-HOLD-BULK-RANKING                           10590000
106000                                       TO DK-VENDOR-RANKING-CDE   10600000
106100             PERFORM 5150-DELETE-RANKING                          10610000
106200             MOVE 'DEFALT'             TO ASC-BULK-RANKING        10620000
106300             MOVE SPACES               TO ASC-BULK-RANKING-DESC   10630000
106400         ELSE                                                     10640000
106500             IF ASC-HOLD-BULK-RANKING = 'DEFALT'                  10650000
106600                 PERFORM 5050-ADD-RANKING                         10660000
106700             ELSE                                                 10670000
106800                 PERFORM 5100-UPDATE-RANKING                      10680000
106900             END-IF                                               10690000
107000         END-IF                                                   10700000
107100         MOVE ASC-BULK-RANKING     TO ASC-HOLD-BULK-RANKING       10710000
107200     END-IF.                                                      10720000
107300                                                                  10730000
107400     IF ASC-HOLD-PRE-PACK-RANKING NOT = ASC-PRE-PACK-RANKING      10740000
107500         MOVE ASC-PRE-PACK-RANKING TO DK-VENDOR-RANKING-CDE       10750000
107600         MOVE 'PP'                 TO DK-PKGNG-TYP-CDE            10760000
107700         IF ASC-PRE-PACK-RANKING = 'DEFALT'                       10770000
107800             MOVE ASC-HOLD-PRE-PACK-RANKING                       10780000
107900                                       TO DK-VENDOR-RANKING-CDE   10790000
108000             PERFORM 5150-DELETE-RANKING                          10800000
108100             MOVE 'DEFALT'             TO ASC-PRE-PACK-RANKING    10810000
108200             MOVE SPACES             TO ASC-PRE-PACK-RANKING-DESC 10820000
108300         ELSE                                                     10830000
108400             IF ASC-HOLD-PRE-PACK-RANKING = 'DEFALT'              10840000
108500                 PERFORM 5050-ADD-RANKING                         10850000
108600             ELSE                                                 10860000
108700                 PERFORM 5100-UPDATE-RANKING                      10870000
108800             END-IF                                               10880000
108900         END-IF                                                   10890000
109000         MOVE ASC-PRE-PACK-RANKING TO ASC-HOLD-PRE-PACK-RANKING   10900000
109100     END-IF.                                                      10910000
109200                                                                  10920000
109300     IF ASC-HOLD-PBS-RANKING NOT = ASC-PBS-RANKING                10930000
109400         MOVE ASC-PBS-RANKING      TO DK-VENDOR-RANKING-CDE       10940000
109500         MOVE 'PS'                 TO DK-PKGNG-TYP-CDE            10950000
109600         IF ASC-PBS-RANKING = 'DEFALT'                            10960000
109700             MOVE ASC-HOLD-PBS-RANKING TO DK-VENDOR-RANKING-CDE   10970000
109800             PERFORM 5150-DELETE-RANKING                          10980000
109900             MOVE 'DEFALT'             TO ASC-PBS-RANKING         10990000
110000             MOVE SPACES               TO ASC-PBS-RANKING-DESC    11000000
110100         ELSE                                                     11010000
110200             IF ASC-HOLD-PBS-RANKING = 'DEFALT'                   11020000
110300                 PERFORM 5050-ADD-RANKING                         11030000
110400             ELSE                                                 11040000
110500                 PERFORM 5100-UPDATE-RANKING                      11050000
110600             END-IF                                               11060000
110700         END-IF                                                   11070000
110800         MOVE ASC-PBS-RANKING      TO ASC-HOLD-PBS-RANKING        11080000
110900     END-IF.                                                      11090000
111000                                                                  11100000
      *CLP 10/01/13 BEGIN - PR# 5148D                                   11100100
109300     IF ASC-HOLD-RFID-RANKING NOT = ASC-RFID-RANKING              11100200
109400         MOVE ASC-RFID-RANKING     TO DK-VENDOR-RANKING-CDE       11100300
109500         MOVE 'RF'                 TO DK-PKGNG-TYP-CDE            11100400
109600         IF ASC-RFID-RANKING = 'DEFALT'                           11100500
109700             MOVE ASC-HOLD-RFID-RANKING TO DK-VENDOR-RANKING-CDE  11100600
109800             PERFORM 5150-DELETE-RANKING                          11100700
109900             MOVE 'DEFALT'             TO ASC-RFID-RANKING        11100800
110000             MOVE SPACES               TO ASC-RFID-RANKING-DESC   11100900
110100         ELSE                                                     11101000
110200             IF ASC-HOLD-RFID-RANKING = 'DEFALT'                  11102000
110300                 PERFORM 5050-ADD-RANKING                         11103000
110400             ELSE                                                 11104000
110500                 PERFORM 5100-UPDATE-RANKING                      11105000
110600             END-IF                                               11106000
110700         END-IF                                                   11107000
110800         MOVE ASC-RFID-RANKING      TO ASC-HOLD-RFID-RANKING      11108000
110900     END-IF.                                                      11109000
      *CLP 10/01/13 END   - PR# 5148D                                   11110000
111100     IF  ASC-USE-SELECTION-QUEUE                                  11111000
111200         PERFORM 5200-UPDATE-SELECTION-QUEUE                      11112000
111300     END-IF.                                                      11113000
111400******************************************************************11114000
111500** ADD THE ROW ON THE DB2 TABLE.                                **11115000
111600******************************************************************11116000
111700 5050-ADD-RANKING.                                                11117000
111800     PERFORM                                                      11118000
111900         WITH TEST AFTER                                          11119000
112000         VARYING PV-RETRY-COUNTER                                 11120000
112100         FROM 1 BY 1                                              11130000
112200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11140000
112300                   OR (SQLCODE = ZERO))                           11150000
112400         EXEC SQL                                                 11160000
112500             INSERT INTO SUT_VND_RNKG                             11170000
112600               ( ENT_ID                                           11180000
112700              ,  VND_RNKG_CDE                                     11190000
112800              ,  PKGNG_TYP_CDE)                                   11200000
112900              VALUES                                              11210000
113000               ( :DK-ENT-ID                                       11220000
113100               , :DK-VENDOR-RANKING-CDE                           11230000
113200               , :DK-PKGNG-TYP-CDE)                               11240000
113300         END-EXEC                                                 11250000
113400                                                                  11260000
113500         EVALUATE TRUE                                            11270000
113600             WHEN SQLCODE = ZERO                                  11280000
113700             WHEN SQLCODE = -904                                  11290000
113800             WHEN SQLCODE = -913                                  11300000
113900                 CONTINUE                                         11310000
114000             WHEN SQLWARN0 NOT = SPACES                           11320000
114100             WHEN SQLCODE < ZERO                                  11330000
114200             WHEN SQLCODE > ZERO                                  11340000
114300                 MOVE '5050-ADD-RANKING'                          11350000
114400                                   TO DP013-PARAGRAPH             11360000
114500                 MOVE 'ADD A ROW ON THE VENDOR RANKING TABLE'     11370000
114600                                   TO DP013-MESSAGE-TEXT(1)       11380000
114700                 MOVE SQLCA        TO DP013-SQLCA                 11390000
114800                 MOVE 'SUT00019'   TO DP013-DB2-TABLE-NAME (1)    11400000
114900                 SET DP013-DB2-ABEND                              11410000
115000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11420000
115100                 PERFORM DP013-0000-PROCESS-ABEND                 11430000
115200         END-EVALUATE                                             11440000
115300     END-PERFORM.                                                 11450000
115400*                                                                 11460000
115500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11470000
115600         MOVE '5050-ADD-RANKING'                                  11480000
115700                                   TO DP013-PARAGRAPH             11490000
115800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A SYS11500000
115900-             'TEM MESSAGE'        TO DP013-MESSAGE-TEXT (1)      11510000
116000         MOVE SQLCA                TO DP013-SQLCA                 11520000
116100         MOVE 'SUT00019'           TO DP013-DB2-TABLE-NAME (1)    11530000
116200         SET DP013-DB2-ABEND                                      11540000
116300             DP013-XCTL-DISPLAY-RESTART                           11550000
116400                                   TO TRUE                        11560000
116500         PERFORM DP013-0000-PROCESS-ABEND                         11570000
116600     END-IF.                                                      11580000
116700******************************************************************11590000
116800** UPDATE THE ROW ON THE DB2 TABLE.                             **11600000
116900******************************************************************11610000
117000 5100-UPDATE-RANKING.                                             11620000
117100     PERFORM                                                      11630000
117200         WITH TEST AFTER                                          11640000
117300         VARYING PV-RETRY-COUNTER                                 11650000
117400         FROM 1 BY 1                                              11660000
117500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11670000
117600                   OR (SQLCODE = ZERO))                           11680000
117700         EXEC SQL                                                 11690000
117800             UPDATE SUT_VND_RNKG                                  11700000
117900                 SET VND_RNKG_CDE  = :DK-VENDOR-RANKING-CDE       11710000
118000             WHERE ENT_ID          = :DK-ENT-ID                   11720000
118100               AND PKGNG_TYP_CDE   = :DK-PKGNG-TYP-CDE            11730000
118200         END-EXEC                                                 11740000
118300                                                                  11750000
118400         EVALUATE TRUE                                            11760000
118500             WHEN SQLCODE = ZERO                                  11770000
118600             WHEN SQLCODE = -904                                  11780000
118700             WHEN SQLCODE = -913                                  11790000
118800                 CONTINUE                                         11800000
118900             WHEN SQLWARN0 NOT = SPACES                           11810000
119000             WHEN SQLCODE < ZERO                                  11820000
119100             WHEN SQLCODE > ZERO                                  11830000
119200                 MOVE '5100-UPDATE-RANKING'                       11840000
119300                                   TO DP013-PARAGRAPH             11850000
119400                 MOVE 'UPDATE A ROW ON THE VENDOR RANKING TABLE'  11860000
119500                                   TO DP013-MESSAGE-TEXT(1)       11870000
119600                 MOVE SQLCA        TO DP013-SQLCA                 11880000
119700                 MOVE 'SUT00019'   TO DP013-DB2-TABLE-NAME (1)    11890000
119800                 SET DP013-DB2-ABEND                              11900000
119900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11910000
120000                 PERFORM DP013-0000-PROCESS-ABEND                 11920000
120100         END-EVALUATE                                             11930000
120200     END-PERFORM.                                                 11940000
120300*                                                                 11950000
120400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11960000
120500         MOVE '5100-UPDATE-RANKING'                               11970000
120600                                   TO DP013-PARAGRAPH             11980000
120700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A SYS11990000
120800-             'TEM MESSAGE'        TO DP013-MESSAGE-TEXT (1)      12000000
120900         MOVE SQLCA                TO DP013-SQLCA                 12010000
121000         MOVE 'SUT00019'           TO DP013-DB2-TABLE-NAME (1)    12020000
121100         SET DP013-DB2-ABEND                                      12030000
121200             DP013-XCTL-DISPLAY-RESTART                           12040000
121300                                   TO TRUE                        12050000
121400         PERFORM DP013-0000-PROCESS-ABEND                         12060000
121500     END-IF.                                                      12070000
121600******************************************************************12080000
121700** UPDATE THE ROW ON THE DB2 TABLE.                             **12090000
121800******************************************************************12100000
121900 5150-DELETE-RANKING.                                             12110000
122000     PERFORM                                                      12120000
122100         WITH TEST AFTER                                          12130000
122200         VARYING PV-RETRY-COUNTER                                 12140000
122300         FROM 1 BY 1                                              12150000
122400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12160000
122500                   OR (SQLCODE = ZERO))                           12170000
122600         EXEC SQL                                                 12180000
122700             DELETE FROM SUT_VND_RNKG                             12190000
122800             WHERE ENT_ID          = :DK-ENT-ID                   12200000
122900               AND VND_RNKG_CDE    = :DK-VENDOR-RANKING-CDE       12210000
123000               AND PKGNG_TYP_CDE   = :DK-PKGNG-TYP-CDE            12220000
123100         END-EXEC                                                 12230000
123200                                                                  12240000
123300         EVALUATE TRUE                                            12250000
123400             WHEN SQLCODE = ZERO                                  12260000
123500             WHEN SQLCODE = -904                                  12270000
123600             WHEN SQLCODE = -913                                  12280000
123700                 CONTINUE                                         12290000
123800             WHEN SQLWARN0 NOT = SPACES                           12300000
123900             WHEN SQLCODE < ZERO                                  12310000
124000             WHEN SQLCODE > ZERO                                  12320000
124100                 MOVE '5150-DELETE-RANKING'                       12330000
124200                                   TO DP013-PARAGRAPH             12340000
124300                 MOVE 'DELETE A ROW ON THE VENDOR RANKING TABLE'  12350000
124400                                   TO DP013-MESSAGE-TEXT(1)       12360000
124500                 MOVE SQLCA        TO DP013-SQLCA                 12370000
124600                 MOVE 'SUT00019'   TO DP013-DB2-TABLE-NAME (1)    12380000
124700                 SET DP013-DB2-ABEND                              12390000
124800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12400000
124900                 PERFORM DP013-0000-PROCESS-ABEND                 12410000
125000         END-EVALUATE                                             12420000
125100     END-PERFORM.                                                 12430000
125200*                                                                 12440000
125300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12450000
125400         MOVE '5150-DELETE-RANKING'                               12460000
125500                                   TO DP013-PARAGRAPH             12470000
125600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A SYS12480000
125700-             'TEM MESSAGE'        TO DP013-MESSAGE-TEXT (1)      12490000
125800         MOVE SQLCA                TO DP013-SQLCA                 12500000
125900         MOVE 'SUT00019'           TO DP013-DB2-TABLE-NAME (1)    12510000
126000         SET DP013-DB2-ABEND                                      12520000
126100             DP013-XCTL-DISPLAY-RESTART                           12530000
126200                                   TO TRUE                        12540000
126300         PERFORM DP013-0000-PROCESS-ABEND                         12550000
126400     END-IF.                                                      12560000
126500 EJECT                                                            12570000
126600*----------------------------------------------------------------*12580000
126700* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *12590000
126800* OBJECT WAS UDPATED.                                            *12600000
126900*----------------------------------------------------------------*12610000
127000 5200-UPDATE-SELECTION-QUEUE.                                     12620000
127100     PERFORM 9100-READ-SEL-QUEUE.                                 12630000
127200     SET SU019-UPD (ASC-SEL-SUB) TO TRUE.                         12640000
127300     PERFORM 9200-REWRITE-LIST-QUEUE.                             12650000
127400 EJECT                                                            12660000
127500*----------------------------------------------------------------*12670000
127600* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *12680000
127700*----------------------------------------------------------------*12690000
127800                                                                  12700000
127900 9100-READ-SEL-QUEUE.                                             12710000
128000     EXEC CICS                                                    12720000
128100         READQ TS                                                 12730000
128200             QUEUE (ASC-SEL-QUEUE-NAME)                           12740000
128300             INTO  (SU019-SELECT-RECORD)                          12750000
128400             ITEM  (ASC-SEL-ITEM)                                 12760000
128500             RESP  (PV-CICS-RESPONSE)                             12770000
128600     END-EXEC.                                                    12780000
128700                                                                  12790000
128800     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   12800000
128900         CONTINUE                                                 12810000
129000     ELSE                                                         12820000
129100         SET DP013-LOGIC-ABEND                                    12830000
129200             DP013-NO-ROLLBACK     TO TRUE                        12840000
129300         MOVE '9100-READ-SEL-QUEUE'                               12850000
129400                                   TO DP013-PARAGRAPH             12860000
129500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   12870000
129600                                   TO DP013-MESSAGE-TEXT (1)      12880000
129700         PERFORM DP013-0000-PROCESS-ABEND                         12890000
129800     END-IF.                                                      12900000
129900*----------------------------------------------------------------*12910000
130000* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *12920000
130100*----------------------------------------------------------------*12930000
130200 9200-REWRITE-LIST-QUEUE.                                         12940000
130300     EXEC CICS                                                    12950000
130400          WRITEQ TS                                               12960000
130500              QUEUE  (ASC-SEL-QUEUE-NAME)                         12970000
130600              FROM   (SU019-SELECT-RECORD)                        12980000
130700              ITEM   (ASC-SEL-ITEM)                               12990000
130800              RESP   (PV-CICS-RESPONSE)                           13000000
130900              REWRITE                                             13010000
131000     END-EXEC.                                                    13020000
131100                                                                  13030000
131200     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               13040000
131300         SET DP013-CICS-ABEND                                     13050000
131400             DP013-NO-ROLLBACK     TO TRUE                        13060000
131500         MOVE '9200-REWRITE-LIST-QUEUE'                           13070000
131600                                   TO DP013-PARAGRAPH             13080000
131700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   13090000
131800                                   TO DP013-MESSAGE-TEXT (1)      13100000
131900         PERFORM DP013-0000-PROCESS-ABEND                         13110000
132000     END-IF.                                                      13120000
132100                                                                  13130000
132200 EJECT                                                            13140000
132300*----------------------------------------------------------------*13150000
132400*    ABEND PROCESSOR MODULE                                      *13160000
132500*----------------------------------------------------------------*13170000
132600                                                                  13180000
132700     COPY DPPD013.                                                13190000
