       IDENTIFICATION DIVISION.                                         00010001
                                                                        00020001
       PROGRAM-ID.             HMKRP001.                                00030001
       AUTHOR.                 JON FIEDLER.                             00040001
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050001
       DATE-WRITTEN.           JUNE 4, 2001.                            00060022
       DATE-COMPILED.                                                   00070001
                                                                        00080001
      ***************************************************************** 00090001
      * HMKRP001 - MERCHANDISE HIERARCHY DATA INTEGRITY REPORT          00100022
      ***************************************************************** 00131001
                                                                        00132001
       ENVIRONMENT DIVISION.                                            00133001
                                                                        00134001
       CONFIGURATION SECTION.                                           00135001
                                                                        00136001
       SOURCE-COMPUTER.                        IBM-3090.                00137001
       OBJECT-COMPUTER.                        IBM-3090.                00138001
                                                                        00139001
       INPUT-OUTPUT SECTION.                                            00140001
                                                                        00150001
       FILE-CONTROL.                                                    00160001
                                                                        00170001
           SELECT  INPUT-FILE                                           00180001
               ASSIGN TO INP01.                                         00190001
                                                                        00200001
           SELECT  REPORT-FILE                                          00210001
               ASSIGN RPT01.                                            00220001
                                                                        00230001
       DATA DIVISION.                                                   00240001
                                                                        00250001
       FILE SECTION.                                                    00260001
                                                                        00270001
       FD  INPUT-FILE                                                   00280001
           LABEL RECORDS ARE STANDARD                                   00290001
           RECORDING MODE IS F                                          00300001
           BLOCK CONTAINS 0 RECORDS.                                    00310001
       01  INPUT-FILE-REC                PIC X(36).                     00320004
                                                                        00330001
       FD  REPORT-FILE                                                  00340001
           RECORDING MODE F                                             00350001
           LABEL RECORDS OMITTED                                        00360001
           BLOCK CONTAINS  0 RECORDS.                                   00370001
       01  REPORT-RECORD.                                               00380001
           05  REPORT-LINE                PIC X(150).                   00390005
                                                                        00400001
       WORKING-STORAGE SECTION.                                         00410001
                                                                        00420001
                                                                        00430001
       01  PA-PROGRAM-ACCUMULATORS.                                     00440001
           05  PA-LINE-COUNT              PIC S9(03) COMP-3 VALUE 0.    00450001
           05  PA-LINE-NO                 PIC S9(03) COMP-3 VALUE 0.    00460001
           05  PA-PAGE-COUNT              PIC S9(05) COMP-3 VALUE 0.    00470001
           05  PA-TOTAL-READ              PIC S9(09) COMP-3 VALUE 0.    00480001
                                                                        00490001
       01  PC-CONSTANTS.                                                00500001
           05  PC-CALENDAR-ROUTINE        PIC  X(8)  VALUE 'DPKUT500'.  00510001
           05  PC-HMKRP001-PGM            PIC  X(08) VALUE 'HMKRP001'.  00520001
           05  PC-NO-INPUT-MSG            PIC  X(80) VALUE              00530001
               '          =====> NO INPUT <====                      '. 00540017
           05  PC-MAX-LINES               PIC S9(03) VALUE 60.          00550001
                                                                        00560001
       01  PS-SWITCHES.                                                 00570001
           05  PS-EOF-EXTRACT-SWITCH      PIC  X(01) VALUE 'N'.         00580001
               88  PS-EOF-EXTRACT                    VALUE 'Y'.         00590001
                                                                        00600001
       01  PV-VARIABLES.                                                00610001
           05  PV-DISP-NUMBER             PIC 9(08).                    00620001
           05  PV-SPACE-LINE.                                           00630001
                10 FILLER                 PIC X(80) VALUE SPACES.       00640021
                                                                        00700001
      ***************************************************************** 00710001
      *  KOHL'S STANDARD FIRST HEADING LINE                             00720001
      ***************************************************************** 00730001
           COPY DPWS132O.                                               00740001
                                                                        00750001
       01  H2-HEADING2.                                                 00760001
           05  FILLER                PIC X(45) VALUE SPACES.            00770015
           05  FILLER                PIC X(43) VALUE                    00780001
           'MERCHANDISE HIERARCHY DATA INTEGRITY REPORT'.               00790001
                                                                        00800001
                                                                        00810001
       01  H4-HEADING4.                                                 00820001
           05  FILLER                PIC X(01) VALUE SPACES.            00830001
           05  FILLER                PIC X(04) VALUE                    00870001
                                               'HIER'.                  00880001
           05  FILLER                PIC X(03) VALUE SPACES.            00890001
           05  FILLER                PIC X(03) VALUE                    00900001
                                               'GMA'.                   00910001
           05  FILLER                PIC X(03) VALUE SPACES.            00920001
           05  FILLER                PIC X(03) VALUE                    00930001
                                               'DMA'.                   00940001
           05  FILLER                PIC X(03) VALUE SPACES.            00941001
           05  FILLER                PIC X(04) VALUE                    00942001
                                               'DEPT'.                  00943001
           05  FILLER                PIC X(03) VALUE SPACES.            00944001
           05  FILLER                PIC X(06) VALUE                    00945001
                                               'MAJ CL'.                00946001
           05  FILLER                PIC X(03) VALUE SPACES.            00947001
           05  FILLER                PIC X(06) VALUE                    00948001
                                               'SUB CL'.                00949001
           05  FILLER                PIC X(05) VALUE SPACES.            00949101
           05  FILLER                PIC X(04) VALUE                    00949201
                                               'DKEY'.                  00949301
           05  FILLER                PIC X(03) VALUE SPACES.            00949419
           05  FILLER                PIC X(06) VALUE                    00949518
                                               'SYSTEM'.                00949618
           05  FILLER                PIC X(15) VALUE SPACES.            00949701
           05  FILLER                PIC X(07) VALUE                    00949801
                                               'MESSAGE'.               00949901
                                                                        00950001
       01  H5-HEADING5.                                                 00960001
           05  FILLER                PIC X(02) VALUE SPACES.            00970019
           05  FILLER                PIC X(03) VALUE                    00980001
                                               'LVL'.                   00990001
           05  FILLER                PIC X(03) VALUE SPACES.            01000001
           05  FILLER                PIC X(03) VALUE                    01010001
                                               'NBR'.                   01020001
           05  FILLER                PIC X(03) VALUE SPACES.            01030001
           05  FILLER                PIC X(03) VALUE                    01040001
                                               'NBR'.                   01050001
           05  FILLER                PIC X(04) VALUE SPACES.            01060001
           05  FILLER                PIC X(03) VALUE                    01070001
                                               'NBR'.                   01080001
           05  FILLER                PIC X(04) VALUE SPACES.            01081007
           05  FILLER                PIC X(03) VALUE                    01082001
                                               'NBR'.                   01083001
           05  FILLER                PIC X(06) VALUE SPACES.            01084007
           05  FILLER                PIC X(03) VALUE                    01085007
                                               'NBR'.                   01086007
                                                                        01090001
       01  DL1-DETAIL-LINE-1.                                           01100001
           05  FILLER                PIC X(02) VALUE SPACES.            01110001
           05  DL1-HIER-LVL          PIC X(03).                         01140001
           05  FILLER                PIC X(02) VALUE SPACES.            01150009
           05  DL1-GMA-NBR           PIC ZZZ9.                          01160018
           05  FILLER                PIC X(02) VALUE SPACES.            01170006
           05  DL1-DMA-NBR           PIC ZZZ9.                          01180019
           05  FILLER                PIC X(03) VALUE SPACES.            01181006
           05  DL1-DEPT-NBR          PIC ZZZ9.                          01182019
           05  FILLER                PIC X(04) VALUE SPACES.            01183009
           05  DL1-MCLS-NBR          PIC ZZZ9.                          01184019
           05  FILLER                PIC X(05) VALUE SPACES.            01185009
           05  DL1-SCLS-NBR          PIC ZZZ9.                          01186019
           05  FILLER                PIC X(04) VALUE SPACES.            01187008
           05  DL1-DKEY              PIC X(06).                         01188018
           05  FILLER                PIC X(05) VALUE SPACES.            01189020
           05  DL1-SYSTEM            PIC X(03).                         01189118
           05  FILLER                PIC X(06) VALUE SPACES.            01189220
           05  DL1-MESSAGE           PIC X(75).                         01189306
                                                                        01190001
      ******************************************************************01200001
      * HMRD004 ERROR REPORTING COPYBOOK                                01210002
      ******************************************************************01220001
           COPY HMRD004.                                                01230001
                                                                        01240001
      ******************************************************************01240102
      * HMRD005 MERCH HIER DATA INTEGRITY ERROR MESSAGE TABLE COPYBOOK  01240202
      ******************************************************************01240302
           COPY HMRD005.                                                01240402
                                                                        01240502
      ***************************************************************   01241001
      *    CALENDAR ROUTINE WORK AREA.                                  01242001
      ***************************************************************   01243001
           COPY DPWS500.                                                01244001
                                                                        01245001
       PROCEDURE DIVISION.                                              01250001
      ******************************************************************01260001
      *  MAIN PROCEDURE                                                 01270001
      ******************************************************************01280001
       0000-HMKRP001.                                                   01290001
                                                                        01300001
           PERFORM 1000-INITIALIZE                                      01310001
                                                                        01320001
           PERFORM 2000-PROCESS-EXTRACT                                 01330001
               UNTIL PS-EOF-EXTRACT.                                    01340001
                                                                        01350001
           PERFORM 9000-EOJ.                                            01360001
                                                                        01370001
           GOBACK.                                                      01380001
                                                                        01390001
      ***************************************************************** 01400001
      * FILL REPORT HEADING & PERFORM INITIAL READS                     01410001
      ***************************************************************** 01420001
       1000-INITIALIZE.                                                 01430001
                                                                        01440001
           OPEN INPUT  INPUT-FILE                                       01450001
           OPEN OUTPUT REPORT-FILE.                                     01460001
                                                                        01470001
           PERFORM 8000-READ-EXTRACT.                                   01480001
                                                                        01490001
           MOVE FUNCTION CURRENT-DATE (3:2)  TO DP132O-RUN-YEAR.        01500001
           MOVE FUNCTION CURRENT-DATE (5:2)  TO DP132O-RUN-MONTH.       01510001
           MOVE FUNCTION CURRENT-DATE (7:2)  TO DP132O-RUN-DAY.         01520001
           MOVE FUNCTION CURRENT-DATE (9:2)  TO DP132O-RUN-HOUR.        01530001
           MOVE FUNCTION CURRENT-DATE (11:2) TO DP132O-RUN-MINUTE.      01540001
           MOVE PC-HMKRP001-PGM              TO DP132O-PROGRAM-NAME.    01550001
           MOVE 1                            TO DP132O-REPORT-NUMBER.   01560001
                                                                        01570001
           PERFORM 4000-WRITE-REPORT-HEADING.                           01580001
                                                                        01581025
           IF PS-EOF-EXTRACT                                            01590001
               DISPLAY 'NO INPUT -- REPORT WILL BE EMPTY'               01600001
           ELSE                                                         01601025
               MOVE +4095 TO RETURN-CODE                                01602025
           END-IF.                                                      01610001
                                                                        01620001
      ****************************************************************  01630001
      * THIS PROCEDURE DOES THE MAIN PROCESSING OF THE REPORT.          01640001
      ****************************************************************  01650001
       2000-PROCESS-EXTRACT.                                            01660001
                                                                        01670001
           PERFORM 5000-WRITE-REPORT-LINE.                              01680001
           PERFORM 8000-READ-EXTRACT.                                   01690001
                                                                        01700001
      ******************************************************************01710001
      *  THIS PROCEDURE PRINTS THE HEADING LINES.                       01720001
      ******************************************************************01730001
       4000-WRITE-REPORT-HEADING.                                       01740001
                                                                        01750001
           MOVE 0                               TO PA-LINE-COUNT        01760001
           ADD 1                                TO PA-PAGE-COUNT.       01770001
           MOVE PA-PAGE-COUNT                   TO DP132O-PAGE-NUMBER.  01780001
                                                                        01794011
           MOVE DP132O-STANDRD-HEADER-132-COLS  TO REPORT-RECORD.       01795011
           WRITE REPORT-RECORD                                          01800001
                   AFTER ADVANCING PAGE.                                01810001
                                                                        01811010
           MOVE PV-SPACE-LINE TO REPORT-RECORD.                         01812010
           WRITE REPORT-RECORD                                          01813010
               AFTER ADVANCING 1 LINE.                                  01814010
                                                                        01820001
           MOVE H2-HEADING2  TO REPORT-RECORD.                          01830001
           WRITE REPORT-RECORD                                          01840001
               AFTER ADVANCING 1 LINE.                                  01850001
                                                                        01860001
           MOVE PV-SPACE-LINE TO REPORT-RECORD.                         01870001
           WRITE REPORT-RECORD                                          01880001
               AFTER ADVANCING 1 LINE.                                  01890001
                                                                        01900001
           MOVE H4-HEADING4    TO REPORT-RECORD.                        01910001
           WRITE REPORT-RECORD                                          01920001
               AFTER ADVANCING 3 LINES.                                 01930001
                                                                        01940001
           MOVE H5-HEADING5    TO REPORT-RECORD.                        01950001
           WRITE REPORT-RECORD                                          01960001
               AFTER ADVANCING 1 LINES.                                 01970001
                                                                        01970119
           MOVE PV-SPACE-LINE TO REPORT-RECORD.                         01971019
           WRITE REPORT-RECORD                                          01972019
               AFTER ADVANCING 1 LINE.                                  01973019
                                                                        01974019
           MOVE 8                              TO PA-LINE-NO.           01990019
                                                                        02000001
                                                                        02010001
      ******************************************************************02020001
      * THIS PROCEDURE WRITES THE DETAIL LINE                           02030001
      ******************************************************************02050001
       5000-WRITE-REPORT-LINE.                                          02060001
                                                                        02070001
           IF PA-LINE-NO > PC-MAX-LINES                                 02080001
               PERFORM 4000-WRITE-REPORT-HEADING                        02090001
           END-IF.                                                      02100001
                                                                        02110001
           MOVE HM004-SYSTEM         TO DL1-SYSTEM.                     02120002
           MOVE HM004-HIER-LVL       TO DL1-HIER-LVL.                   02130002
           MOVE HM004-GMA-NBR        TO DL1-GMA-NBR.                    02140002
           MOVE HM004-DMA-NBR        TO DL1-DMA-NBR.                    02150002
           MOVE HM004-DEPT-NBR       TO DL1-DEPT-NBR.                   02151002
           MOVE HM004-MAJ-CL-NBR     TO DL1-MCLS-NBR.                   02152002
           MOVE HM004-SUB-CL-NBR     TO DL1-SCLS-NBR.                   02153002
                                                                        02153118
           IF HM004-DKEY = 0                                            02153218
              MOVE SPACES TO DL1-DKEY                                   02153318
           ELSE                                                         02153418
              MOVE HM004-DKEY TO DL1-DKEY.                              02154022
                                                                        02154118
           SET  EM-IDX               TO HM004-MSG-NBR.                  02154203
           MOVE EM-MSG-TEXT (EM-IDX) TO DL1-MESSAGE.                    02154302
                                                                        02160001
           WRITE REPORT-RECORD FROM DL1-DETAIL-LINE-1                   02170001
                  AFTER ADVANCING 1 LINES.                              02180001
           ADD 1 TO PA-LINE-NO.                                         02190001
                                                                        02200001
                                                                        02210001
      ***************************************************************** 02220003
      * THIS PROCEDURE READS A LINE FROM THE EXTRACT FILE.              02230001
      ******************************************************************02240001
       8000-READ-EXTRACT.                                               02250001
           READ INPUT-FILE INTO HM004-MBS-RMS-INTG-REC                  02260001
             AT END                                                     02270001
               SET PS-EOF-EXTRACT           TO TRUE                     02280001
             NOT AT END                                                 02290001
               ADD 1                        TO PA-TOTAL-READ            02300001
           END-READ.                                                    02310001
                                                                        02320001
      *************************************************************     02330001
      * THIS PROCEDURE PERFORMS THE END OF JOB TASKS.                   02340001
      *************************************************************     02350001
       9000-EOJ.                                                        02360001
                                                                        02370001
           IF PA-TOTAL-READ = ZERO                                      02380001
              WRITE REPORT-RECORD FROM PC-NO-INPUT-MSG                  02390001
                    AFTER ADVANCING 5 LINES                             02400001
           END-IF.                                                      02410001
                                                                        02420001
           CLOSE INPUT-FILE                                             02430001
                 REPORT-FILE.                                           02440001
                                                                        02450001
           DISPLAY SPACES.                                              02460001
           MOVE PA-TOTAL-READ        TO PV-DISP-NUMBER.                 02470001
           DISPLAY 'RECS READ    =    ' PV-DISP-NUMBER.                 02480001
                                                                        02490001
