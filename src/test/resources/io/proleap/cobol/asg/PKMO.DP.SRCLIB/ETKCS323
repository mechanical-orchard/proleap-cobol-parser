000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    ETKCS323.                                         00040099
000500 AUTHOR.        SUE PARI.                                         00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  03-22-2000.                                       00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    Z036 - MESSAGE LIST PROGRAM.                               * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES A LIST OF SYSTEM MESSAGES.  THE     * 00130099
001400*    ASSOCIATED SYSTEM ID, MESSAGE NUMBER, REVIEW INDICATOR     * 00140099
001500*    AND SHORT MESSAGE TEXT (55 OF 70 BYTES) IS DISPLAYED.  THE * 00150099
001600*    APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR SELECTS   * 00160099
001700*    ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.  NO SELECTION* 00170099
001800*    IS NECESSARY TO ADD A NEW MESSAGE.                         * 00180099
001900*                                                               * 00190099
002000*---------------------------------------------------------------* 00200099
002010* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00201099
002020*            - CHANGE CALL OF DPKUT100 TO                       * 00202099
002030*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00203099
002040*              MAKING THE CALL DYNAMIC VS STATIC                * 00204099
002050*                                                               * 00205099
002060*---------------------------------------------------------------* 00206099
002010* 08/05/2022 JIM HUNTER                      WR/IR #: CHG0272945* 00207099
002020*            - CHANGED 2ND CALL OF DPKUT100 TO                  * 00208099
002030*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00209099
002040*              MAKING THE CALL DYNAMIC VS STATIC                * 00209199
002050*                                                               * 00209299
002060*---------------------------------------------------------------* 00209399
CICS  *  CHANGED 10/25/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00209499
CICS  *                                                               * 00209599
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00209699
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00209799
002050*                                                               * 00209899
002060*---------------------------------------------------------------* 00209999
002100 EJECT                                                            00210099
002200 ENVIRONMENT DIVISION.                                            00220099
002300                                                                  00230099
002400 DATA DIVISION.                                                   00240099
002500                                                                  00250099
002600 WORKING-STORAGE SECTION.                                         00260099
002700                                                                  00270099
002800 01  DK-DB2-KEYS.                                                 00280099
002900     15  DK-INT-CONTROL-NUMBER          PIC S9(09)  VALUE ZERO    00290099
003000                                                    COMP.         00300099
003100     15  DK-VENDOR-NAME                 PIC  X(30)  VALUE SPACE.  00310099
003200     15  DK-TP-DKEY                     PIC S9(09)  VALUE ZERO    00320099
003300                                                    COMP.         00330099
003400     15  DK-TP-DKEY-TMST                PIC  X(26)  VALUE SPACE.  00340099
003500                                                                  00350099
003600 01  PC-PROGRAM-CONSTANTS.                                        00360099
003700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00370099
003800                                                    'ET323A  '.   00380099
003900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00390099
004000                                                    'ETKM323 '.   00400099
004100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00410099
004200                                                    'ETKCS323'.   00420099
004300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00430099
004400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00440099
004500     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00450099
004600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00460099
004700                                                    COMP SYNC.    00470099
004800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00480099
004900                                                    COMP SYNC.    00490099
005000     05  PC-MAX-GROUPS                  PIC S9(09)  VALUE +1      00500099
005100                                                    COMP SYNC.    00510099
005200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE +99999  00520099
005300                                                    COMP-3.       00530099
005400     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00540099
005500                                                    COMP-3.       00550099
005600     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00560099
005700     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00570099
005800     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00580099
005900     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00590099
006000*                                                                 00600099
006100     05  PC-TSYMSG-NUMBERS.                                       00610099
006200         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00620099
006300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00630099
006400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00640099
006500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00650099
006600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00660099
006700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00670099
006800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00680099
006900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00690099
007000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00700099
007100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00710099
007200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00720099
007300         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00730099
007400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00740099
007500         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00750099
007600*                                                                 00760099
007700 01  PS-PROGRAM-SWITCHES.                                         00770099
007800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00780099
007900         88  PS-NO-ERROR                            VALUE 'Y'.    00790099
008000         88  PS-ERROR                               VALUE 'N'.    00800099
008100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00810099
008200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00820099
008300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00830099
008400     05  PS-LIST-END-SW            PIC X       VALUE 'N'.         00840099
008500         88  PS-LIST-END                       VALUE 'Y'.         00850099
008600         88  PS-NO-LIST-END                    VALUE 'N'.         00860099
008700     05  PS-PO-FOUND-SW                 PIC  X(01)  VALUE 'Y'.    00870099
008800         88  PS-PO-FOUND                            VALUE 'Y'.    00880099
008900         88  PS-PO-NOT-FOUND                        VALUE 'N'.    00890099
009000                                                                  00900099
009100 01  PV-PROGRAM-VARIABLES.                                        00910099
009200     05  PV-NULL-DATE-IND               PIC S9(04) VALUE +0 COMP. 00920099
009300*                                                                 00930099
009400 01  PV-PROGRAM-VARIABLES.                                        00940099
009500     05  PV-SUB                         PIC S9(04)  VALUE +0      00950099
009600                                                    COMP SYNC.    00960099
009700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00970099
009800                                                    COMP SYNC.    00980099
009900     05  PV-TEMP-NUM                    PIC S9(09)  VALUE +0      00990099
010000                                                    COMP SYNC.    01000099
010100     05  PV-GROUPS-TO-READ              PIC S9(09)  VALUE +0      01010099
010200                                                    COMP SYNC.    01020099
010300     05  PV-MAX-ITEMS                   PIC S9(09)  VALUE +0      01030099
010400                                                    COMP SYNC.    01040099
010500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01050099
010600                                                    COMP-3.       01060099
010700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01070099
010800                                                    COMP-3.       01080099
010900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01090099
011000                                                    COMP-3.       01100099
011100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01110099
011200                                                    COMP-3.       01120099
011300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01130099
011400                                                    COMP-3.       01140099
011500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01150099
011600                                                    COMP-3.       01160099
011700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01170099
011800                                                    COMP-3.       01180099
011900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01190099
012000                                                    COMP SYNC.    01200099
012100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01210099
012200                                                    COMP SYNC.    01220099
012300     05  PV-ITEM                        PIC S9(04)  VALUE +0      01230099
012400                                                    COMP SYNC.    01240099
012500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01250099
012600                                                    COMP SYNC.    01260099
012700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01270099
012800                                                    COMP SYNC.    01280099
012900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01290099
013000                                                    COMP SYNC.    01300099
013100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01310099
013200                                                    COMP SYNC.    01320099
013300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01330099
013400                                                    COMP SYNC.    01340099
013500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01350099
013600                                                    COMP SYNC.    01360099
013700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01370099
013800                                                    COMP SYNC.    01380099
013900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01390099
014000                                                    COMP SYNC.    01400099
014100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01410099
014200                                                    COMP SYNC.    01420099
014300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01430099
014400                                                    COMP SYNC.    01440099
014500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01450099
014600                                                    COMP SYNC.    01460099
014700     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01470099
014800                                                    COMP SYNC.    01480099
014900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01490099
015000                                                    COMP SYNC.    01500099
015100     05  PV-PO-NBR                      PIC S9(09)  VALUE +0      01510099
015200                                                    COMP.         01520099
015300******************************************************************01530099
015400**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01540099
015500**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01550099
015600**  APPLICATION-SPECIFIC COMMAREA.                              **01560099
015700******************************************************************01570099
015800 01  LQW-LIST-QUEUE-WORK-AREA.                                    01580099
015900     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01590099
016000     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           01600099
016100                                        INDEXED BY LQW-IDX.       01610099
016200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01620099
016300         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01630099
016400         10  LQW-SELECTED-SW            PIC  X(01).               01640099
016500             88  LQW-SELECT                         VALUE 'S'.    01650099
016600             88  LQW-DESELECT                       VALUE ' '.    01660099
016700         10  LQW-ACTION                 PIC  X(03).               01670099
016800         10  LQW-FG-CNTL                PIC  X(09).               01680099
016900         10  LQW-TS-CNTL                PIC  X(09).               01690099
017000         10  LQW-TRAN-SET               PIC  X(03).               01700099
017100         10  LQW-DETAIL                 PIC  X(15).               01710099
017200         10  LQW-SHIP-DTE               PIC  X(10).               01720099
017300         10  LQW-CANCEL-DTE             PIC  X(10).               01730099
017400         10  LQW-STATUS                 PIC  X(03).               01740099
017500         10  LQW-TRN-RLSE-TMST          PIC  X(26).               01750099
017600         10  LQW-FUNC-CDE-SEQ-NBR       PIC S9(09) COMP.          01760099
017700         10  LQW-TRN-SET-SEQ-NBR        PIC S9(09) COMP.          01770099
017800         10  LQW-TRANSL-ERR-IND         PIC  X(01).               01780099
017900                                                                  01790099
018000     EJECT                                                        01800099
018100*---------------------------------------------------------------* 01810099
018200*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 01820099
018300*---------------------------------------------------------------* 01830099
018400                                                                  01840099
018500     COPY ETWS308.                                                01850099
018600     COPY ETWS309.                                                01860099
018700                                                                  01870099
018800     EJECT                                                        01880099
018900*---------------------------------------------------------------* 01890099
019000*    MAP LAYOUT                                                 * 01900099
019100*---------------------------------------------------------------* 01910099
019200                                                                  01920099
019300     COPY ETKM323.                                                01930099
019400*                                                                 01940099
019500 01  MR-OCCURS-LAYOUT                   REDEFINES  ET323AO.       01950099
019600     05  FILLER                         PIC X(76).                01960099
019700     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          01970099
019800         10  MR-SELECTL                 PIC S9(04) COMP.          01980099
019900         10  MR-SELECTA                 PIC  X(01).               01990099
020000         10  MR-SELECTC                 PIC  X(01).               02000099
020100         10  MR-SELECTH                 PIC  X(01).               02010099
020200         10  MR-SELECTI                 PIC  X(01).               02020099
020300                                                                  02030099
020400         10  MR-ACTIONL                 PIC S9(04) COMP.          02040099
020500         10  MR-ACTIONA                 PIC  X(01).               02050099
020600         10  MR-ACTIONC                 PIC  X(01).               02060099
020700         10  MR-ACTIONH                 PIC  X(01).               02070099
020800         10  MR-ACTION                  PIC  X(04).               02080099
020900                                                                  02090099
021000         10  MR-FG-CNTL-NUML            PIC S9(04) COMP.          02100099
021100         10  MR-FG-CNTL-NUMA            PIC  X(01).               02110099
021200         10  MR-FG-CNTL-NUMC            PIC  X(01).               02120099
021300         10  MR-FG-CNTL-NUMH            PIC  X(01).               02130099
021400         10  MR-FG-CNTL-NUM             PIC  X(09).               02140099
021500                                                                  02150099
021600         10  MR-TS-CNTL-NUML            PIC S9(04) COMP.          02160099
021700         10  MR-TS-CNTL-NUMA            PIC  X(01).               02170099
021800         10  MR-TS-CNTL-NUMC            PIC  X(01).               02180099
021900         10  MR-TS-CNTL-NUMH            PIC  X(01).               02190099
022000         10  MR-TS-CNTL-NUM             PIC  X(09).               02200099
022100                                                                  02210099
022200         10  MR-TRAN-SETL               PIC S9(04) COMP.          02220099
022300         10  MR-TRAN-SETA               PIC  X(01).               02230099
022400         10  MR-TRAN-SETC               PIC  X(01).               02240099
022500         10  MR-TRAN-SETH               PIC  X(01).               02250099
022600         10  MR-TRAN-SET                PIC  X(03).               02260099
022700                                                                  02270099
022800         10  MR-DETAILL                 PIC S9(04) COMP.          02280099
022900         10  MR-DETAILA                 PIC  X(01).               02290099
023000         10  MR-DETAILC                 PIC  X(01).               02300099
023100         10  MR-DETAILH                 PIC  X(01).               02310099
023200         10  MR-DETAIL                  PIC  X(15).               02320099
023300                                                                  02330099
023400         10  MR-SHIP-DTEL               PIC S9(04) COMP.          02340099
023500         10  MR-SHIP-DTEA               PIC  X(01).               02350099
023600         10  MR-SHIP-DTEC               PIC  X(01).               02360099
023700         10  MR-SHIP-DTEH               PIC  X(01).               02370099
023800         10  MR-SHIP-DTE                PIC  X(10).               02380099
023900                                                                  02390099
024000         10  MR-CANCEL-DTEL             PIC S9(04) COMP.          02400099
024100         10  MR-CANCEL-DTEA             PIC  X(01).               02410099
024200         10  MR-CANCEL-DTEC             PIC  X(01).               02420099
024300         10  MR-CANCEL-DTEH             PIC  X(01).               02430099
024400         10  MR-CANCEL-DTE              PIC  X(10).               02440099
024500                                                                  02450099
024600         10  MR-STATUSL                 PIC S9(04) COMP.          02460099
024700         10  MR-STATUSA                 PIC  X(01).               02470099
024800         10  MR-STATUSC                 PIC  X(01).               02480099
024900         10  MR-STATUSH                 PIC  X(01).               02490099
025000         10  MR-STATUS                  PIC  X(03).               02500099
025100     EJECT                                                        02510099
025200*---------------------------------------------------------------* 02520099
025300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02530099
025400*---------------------------------------------------------------* 02540099
025500                                                                  02550099
025600     COPY DPWS015.                                                02560099
025700                                                                  02570099
025800*---------------------------------------------------------------* 02580099
025900*    FUNCTION KEYS COPYBOOK.                                    * 02590099
026000*---------------------------------------------------------------* 02600099
026100                                                                  02610099
026200     COPY DPWS016.                                                02620099
026300                                                                  02630099
026400*---------------------------------------------------------------* 02640099
026500*    NUMERIC EDIT LAYOUT.                                       * 02650099
026600*---------------------------------------------------------------* 02660099
026700                                                                  02670099
026800     COPY DPWS010I.                                               02680099
026900 EJECT                                                            02690099
027000*---------------------------------------------------------------* 02700099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02710099
027200*---------------------------------------------------------------* 02720099
027300                                                                  02730099
027400     COPY DPWS030.                                                02740099
CICS       COPY DPWS930.                                                02741099
027500 EJECT                                                            02750099
027600*---------------------------------------------------------------* 02760099
027700*    STANDARD COMMAREA.                                         * 02770099
027800*---------------------------------------------------------------* 02780099
027900                                                                  02790099
028000     COPY DPWS020.                                                02800099
028100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02810099
028200                                                                  02820099
028300*---------------------------------------------------------------* 02830099
028400* INTER-APPLICATION COMMAREA.                                   * 02840099
028500*   ETWS307 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02850099
028600*             SPEC SCREEN.                                      * 02860099
028700*---------------------------------------------------------------* 02870099
028800                                                                  02880099
028900         10  INTER-APPL-COMM-AREA       PIC X(200).               02890099
029000     COPY ETWS307.                                                02900099
029100*---------------------------------------------------------------* 02910099
029200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02920099
029300*---------------------------------------------------------------* 02930099
029400         10  ASC-SPECIFIC-COMMAREA.                               02940099
029500             15  ASC-LIST-KEYS.                                   02950099
029600                 20  ASC-INT-CONTROL-NUMBER          PIC S9(09)   02960099
029700                                                     COMP.        02970099
029800                 20  ASC-VENDOR-NAME                 PIC  X(30).  02980099
029900                 20  ASC-TP-DKEY                     PIC S9(09)   02990099
030000                                                     COMP.        03000099
030100                 20  ASC-TP-DKEY-TMST                PIC  X(26).  03010099
030200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03020099
030300                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03030099
030400                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03040099
030500                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03050099
030600                                                                  03060099
030700                 20  ASC-ITEM-ARRAY.                              03070099
030800                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        03080099
030900                         30  ASC-LIST-ITEM-NUMBER                 03090099
031000                                                     PIC S9(09)   03100099
031100                                                     COMP-3.      03110099
031200                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03120099
031300                             88  ASC-VALID-SELECT    VALUE ' '    03130099
031400                                                           'S'    03140099
031500                                                           'B'    03150099
031600                                                           'E'.   03160099
031700                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03170099
031800                             88  ASC-TEMP-SELECT     VALUE 'S'.   03180099
031900                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03190099
032000                             88  ASC-TEMP-END        VALUE 'E'.   03200099
032100                         30  ASC-SELECTED-SW         PIC  X(01).  03210099
032200                             88  ASC-NO-SELECT       VALUE ' '.   03220099
032300                             88  ASC-SELECT          VALUE 'S'.   03230099
032400                             88  ASC-BEGIN           VALUE 'B'.   03240099
032500                             88  ASC-END             VALUE 'E'.   03250099
032600                         30  ASC-ACTION              PIC  X(03).  03260099
032700                         30  ASC-FG-CNTL             PIC  X(09).  03270099
032800                         30  ASC-TS-CNTL             PIC  X(09).  03280099
032900                         30  ASC-TRAN-SET            PIC  X(03).  03290099
033000                         30  ASC-DETAIL              PIC  X(15).  03300099
033100                         30  ASC-SHIP-DTE            PIC  X(10).  03310099
033200                         30  ASC-CANCEL-DTE          PIC  X(10).  03320099
033300                         30  ASC-STATUS              PIC  X(03).  03330099
033400                         30  ASC-TRN-RLSE-TMST       PIC  X(26).  03340099
033500                         30  ASC-FUNC-CDE-SEQ-NBR    PIC S9(09)   03350099
033600                                                          COMP.   03360099
033700                         30  ASC-TRN-SET-SEQ-NBR     PIC S9(09)   03370099
033800                                                          COMP.   03380099
033900                         30  ASC-TRANSL-ERR-IND      PIC  X(01).  03390099
034000                                                                  03400099
034100             15  ASC-BLK-SUB                         PIC S9(04)   03410099
034200                                                          COMP    03420099
034300                                                          SYNC.   03430099
034400             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(05) COMP-3.   03440099
034500             15  ASC-SEL-SUB                 PIC S9(04) COMP.     03450099
034600             15  ASC-SEL-ITEM                PIC S9(04) COMP.     03460099
034700             15  ASC-ITEM-SUB                        PIC S9(04)   03470099
034800                                                          COMP    03480099
034900                                                          SYNC.   03490099
035000             15  ASC-LAST-MSG-READ                   PIC S9(05)   03500099
035100                                                          COMP-3. 03510099
035200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03520099
035300                                                          COMP-3. 03530099
035400             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03540099
035500                                                          COMP-3. 03550099
035600             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03560099
035700                                                          COMP-3. 03570099
035800             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03580099
035900                                                          COMP-3. 03590099
036000             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03600099
036100                                                          COMP-3. 03610099
036200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03620099
036300                                                          COMP    03630099
036400                                                          SYNC.   03640099
036500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03650099
036600                                                          COMP-3. 03660099
036700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03670099
036800                                                          COMP-3. 03680099
036900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03690099
037000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03700099
037100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03710099
037200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03720099
037300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03730099
037400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03740099
037500             15  ASC-LIST-QUEUE-NAME.                             03750099
037600                 20  ASC-LIST-TERM-ID                PIC  X(04).  03760099
037700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03770099
037800                                                          COMP-3. 03780099
037900                 20  ASC-LIST-SEQ                    PIC  9(01).  03790099
038000             15  ASC-SEL-QUEUE-NAME.                              03800099
038100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03810099
038200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03820099
038300                                                          COMP-3. 03830099
038400                 20  ASC-SEL-SEQ                     PIC  9(01).  03840099
038500                                                                  03850099
038600             15  ASC-TSQB-NAME.                                   03860099
038700                 20  ASC-TSQB-TERM-ID                PIC  X(04).  03870099
038800                 20  ASC-TSQB-TASK-NUMBER            PIC S9(05)   03880099
038900                                                          COMP-3. 03890099
039000                 20  ASC-TSQB-SEQ                    PIC  9(01).  03900099
039100                                                                  03910099
039200             15  ASC-START-ITEM-REQUEST.                          03920099
039300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03930099
039400     EJECT                                                        03940099
039500*---------------------------------------------------------------* 03950099
039600*    ABEND PROCESSING COPYBOOK.                                 * 03960099
039700*---------------------------------------------------------------* 03970099
039800                                                                  03980099
039900     COPY DPWS013.                                                03990099
040000                                                                  04000099
040100 EJECT                                                            04010099
040200*---------------------------------------------------------------* 04020099
040300*    DB2 AREA FOR EDI FUNCTIONAL GROUP TABLE                    * 04030099
040400*---------------------------------------------------------------* 04040099
040500     EXEC SQL                                                     04050099
040600          INCLUDE TFGTRST                                         04060099
040700     END-EXEC.                                                    04070099
040800*---------------------------------------------------------------* 04080099
040900*    DB2 AREA FOR SHIP AND CANCEL DATE TABLE                    * 04090099
041000*---------------------------------------------------------------* 04100099
041100     EXEC SQL                                                     04110099
041200          INCLUDE TPLNSHP                                         04120099
041300     END-EXEC.                                                    04130099
041400*---------------------------------------------------------------* 04140099
041500*    DB2 AREA FOR EDI TRANSACTION SET TABLE                     * 04150099
041600*---------------------------------------------------------------* 04160099
041700     EXEC SQL                                                     04170099
041800          INCLUDE TTRNSET                                         04180099
041900     END-EXEC.                                                    04190099
042000*---------------------------------------------------------------* 04200099
042100*    DB2 AREA FOR EDI TRANSACTION STATUS CODE TABLE             * 04210099
042200*---------------------------------------------------------------* 04220099
042300     EXEC SQL                                                     04230099
042400          INCLUDE TTNSTLC                                         04240099
042500     END-EXEC.                                                    04250099
042600*---------------------------------------------------------------* 04260099
042700*    DB2 AREA FOR EDI INTERCHANGE TRANSMISSION TABLE            * 04270099
042800*---------------------------------------------------------------* 04280099
042900     EXEC SQL                                                     04290099
043000          INCLUDE TINTTRN                                         04300099
043100     END-EXEC.                                                    04310099
043200*---------------------------------------------------------------* 04320099
043300*    DB2 AREA FOR COMMUNICATIONS                                * 04330099
043400*---------------------------------------------------------------* 04340099
043500     EXEC SQL                                                     04350099
043600          INCLUDE SQLCA                                           04360099
043700     END-EXEC.                                                    04370099
043800                                                                  04380099
043900     EXEC SQL                                                     04390099
044000         DECLARE  CURSOR_ONE   CURSOR FOR                         04400099
044100         SELECT   FUNC_CDE_SEQ_NBR,                               04410099
044200                  TRN_SET_SEQ_NBR,                                04420099
044300                  FUNC_CDE_CNTL_NBR,                              04430099
044400                  TRN_SET_CNTL_NBR,                               04440099
044500                  B.TRAN_SET_CDE,                                 04450099
044600                  TRN_DTL_TXT,                                    04460099
044700                  TRN_RLSE_TMST,                                  04470099
044800                  TRANSL_ERR_IND                                  04480099
044900         FROM     TFGTRST A,                                      04490099
045000                  TTRNSET B                                       04500099
045100         WHERE  (TP_DKEY   = :ASC-TP-DKEY)              AND       04510099
045200                (TP_DKEY_TMST = :ASC-TP-DKEY-TMST)      AND       04520099
045300                (A.TRN_SET_CDE = B.TRAN_SET_CDE)                  04530099
045400         ORDER BY FUNC_CDE_CNTL_NBR , TRN_SET_CNTL_NBR            04540099
045500     END-EXEC.                                                    04550099
045600                                                                  04560099
045700     EXEC SQL                                                     04570099
045800         DECLARE STATUS_CURSOR CURSOR FOR                         04580099
045900         SELECT  TRN_STAT_CDE                                     04590099
046000         FROM    TTNSTLC                                          04600099
046100         WHERE   TP_DKEY =:ASC-TP-DKEY                            04610099
046200           AND   TP_DKEY_TMST = :ASC-TP-DKEY-TMST                 04620099
046300           AND   FUNC_CDE_SEQ_NBR =:FGTRST-FUNC-CDE-SEQ-NBR       04630099
046400           AND   TRN_SET_SEQ_NBR =:FGTRST-TRN-SET-SEQ-NBR         04640099
046500         ORDER BY TRN_AUD_TMST DESC                               04650099
046600     END-EXEC.                                                    04660099
046700                                                                  04670099
046800 EJECT                                                            04680099
046900 LINKAGE SECTION.                                                 04690099
047000                                                                  04700099
047100 01  DFHCOMMAREA.                                                 04710099
047200     05  FILLER                         OCCURS  1 TO 4072 TIMES   04720099
047300                                        DEPENDING ON EIBCALEN.    04730099
047400         10  FILLER                     PIC X.                    04740099
047500                                                                  04750099
047600 EJECT                                                            04760099
047700 PROCEDURE DIVISION.                                              04770099
047800******************************************************************04780099
047900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04790099
048000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04800099
048100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04810099
048200******************************************************************04820099
048300 0000-MAIN-MODULE.                                                04830099
048400     INITIALIZE DP030-CICS-API-FIELDS.                            04840099
048500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04850099
048600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04860099
048700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04870099
048800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04880099
048900     MOVE LENGTH OF ET323AI        TO DP030-MAP-LENGTH (1).       04890099
049000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04900099
049100     PERFORM 0001-CALL-CICS-ARCH-API.                             04910099
049200*                                                                 04920099
049300     PERFORM 1000-CONTROL-PROCESSING                              04930099
049400*                                                                 04940099
049500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04950099
049600     PERFORM 0001-CALL-CICS-ARCH-API.                             04960099
049700                                                                  04970099
049800******************************************************************04980099
049900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04990099
050000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05000099
050100******************************************************************05010099
050200 0001-CALL-CICS-ARCH-API.                                         05020099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05030099
050400                                    DFHCOMMAREA                   05040099
050500                                    DP030-CICS-API-FIELDS         05050099
050600                                    DP020-STANDARD-COMMAREA       05060099
050700                                    ET323AI.                      05070099
050800*                                                                 05080099
050900     IF  DP030-RC-CALL-SUCCESSFUL                                 05090099
051000         CONTINUE                                                 05100099
051100     ELSE                                                         05110099
051200         SET DP013-NO-ROLLBACK                                    05120099
051300             DP013-XCTL-DISPLAY-RESTART                           05130099
051400             DP013-CICS-ABEND      TO TRUE                        05140099
051500         MOVE '0001-CALL-CICS-ARCH-API'                           05150099
051600                                   TO DP013-PARAGRAPH             05160099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05170099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05180099
051900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05190099
052000         PERFORM DP013-0000-PROCESS-ABEND                         05200099
052100     END-IF.                                                      05210099
052200*----------------------------------------------------------------*05220099
052300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05230099
052400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05240099
052500*                                                                *05250099
052600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05260099
052700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05270099
052800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05280099
052900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05290099
053000*----------------------------------------------------------------*05300099
053100                                                                  05310099
053200 1000-CONTROL-PROCESSING.                                         05320099
053300                                                                  05330099
053400     EVALUATE TRUE                                                05340099
053500         WHEN DP020-NEXT-ACT-INITIAL                              05350099
053600             INITIALIZE ASC-SPECIFIC-COMMAREA                     05360099
053700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05370099
053800                                      ASC-SEL-TERM-ID             05380099
053900             MOVE DP020-SRC-TASK-NUMBER                           05390099
054000                                   TO ASC-LIST-TASK-NUMBER        05400099
054100                                      ASC-SEL-TASK-NUMBER         05410099
054200             MOVE PC-LIST-QUEUE-SEQ                               05420099
054300                                   TO ASC-LIST-SEQ                05430099
054400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05440099
054500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05450099
054600***-----$TEMPLATE NOTE$-------------------------------------------05460099
054700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05470099
054800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05480099
054900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05490099
055000***---------------------------------------------------------------05500099
055100             IF  PS-COMMAREA-NOT-VALID                            05510099
055200***              MOVE PC-TSYMSG-99901                             05520099
055300***                                TO DP020-MSG-NUMBER            05530099
055400***              SET DP020-MSG-FATAL                              05540099
055500***                                TO TRUE                        05550099
055600                 SET DP020-NEXT-ACT-APPL-ERROR                    05560099
055700                                   TO TRUE                        05570099
055800             ELSE                                                 05580099
055900                 PERFORM 4000-BUILD-INITIAL-PANEL                 05590099
056000             END-IF                                               05600099
056100                                                                  05610099
056200         WHEN DP020-NEXT-ACT-READ-MAP                             05620099
056300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05630099
056400                                   TO PV-TOP-ITEM                 05640099
056500             PERFORM 2000-PROCESS-PANEL                           05650099
056600                                                                  05660099
056700         WHEN DP020-NEXT-ACT-RETURN                               05670099
056800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05680099
056900                                   TO PV-TOP-ITEM                 05690099
057000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05700099
057100             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05710099
057200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05720099
057300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05730099
057400                                                                  05740099
057500         WHEN OTHER                                               05750099
057600             SET DP013-LOGIC-ABEND TO TRUE                        05760099
057700             SET DP013-NO-ROLLBACK TO TRUE                        05770099
057800             MOVE '1000-CONTROL-PROCESSING'                       05780099
057900                                   TO DP013-PARAGRAPH             05790099
058000             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05800099
058100                                   TO DP013-MESSAGE-TEXT(1)       05810099
058200             PERFORM DP013-0000-PROCESS-ABEND                     05820099
058300     END-EVALUATE.                                                05830099
058400                                                                  05840099
058500 EJECT                                                            05850099
058600*----------------------------------------------------------------*05860099
058700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05870099
058800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05880099
058900*----------------------------------------------------------------*05890099
059000                                                                  05900099
059100 1100-PROCESS-INTER-APPL-COMM.                                    05910099
059200                                                                  05920099
059300     SET PS-COMMAREA-VALID         TO TRUE.                       05930099
059400     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05940099
059500     MOVE ET307-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS      05950099
059600     MOVE ET307-SEL-QUEUE-NAME     TO ASC-TSQB-NAME               05960099
059700     MOVE ET308-MAX-ITEMS TO ASC-SEL-SUB                          05970099
059800     MOVE ZERO TO ASC-SEL-ITEM.                                   05980099
059900     PERFORM 2135-GET-NEXT-ITEM.                                  05990099
060000                                                                  06000099
060100 EJECT                                                            06010099
060200*----------------------------------------------------------------*06020099
060300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06030099
060400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06040099
060500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06050099
060600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06060099
060700* FUNCTION KEYS CAN GET THIS FAR.                                *06070099
060800*----------------------------------------------------------------*06080099
060900                                                                  06090099
061000 2000-PROCESS-PANEL.                                              06100099
061100     EVALUATE TRUE                                                06110099
061200         WHEN DP020-SRC-AID = DP016-CLEAR                         06120099
061300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06130099
061400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06140099
061500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06150099
061600                                                                  06160099
061700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06170099
061800             MOVE ASC-INT-CONTROL-NUMBER                          06180099
061900                                   TO DK-INT-CONTROL-NUMBER       06190099
062000             MOVE ASC-VENDOR-NAME  TO DK-VENDOR-NAME              06200099
062100             MOVE ASC-TP-DKEY      TO DK-TP-DKEY                  06210099
062200             MOVE ASC-TP-DKEY-TMST TO DK-TP-DKEY-TMST             06220099
062300             PERFORM 2050-DELETE-LIST-QUEUE                       06230099
062400             PERFORM 4000-BUILD-INITIAL-PANEL                     06240099
062500                                                                  06250099
062600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06260099
062700             PERFORM 3200-RESET-ATTRIBUTES                        06270099
062800             PERFORM 2140-DESELECT-ALL-ITEMS                      06280099
062900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06290099
063000                                                                  06300099
063100         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06310099
063200             PERFORM 3200-RESET-ATTRIBUTES                        06320099
063300             PERFORM 2150-SELECT-ALL-ITEMS                        06330099
063400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06340099
063500                                                                  06350099
063600         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             06360099
063700                 PERFORM 2050-DELETE-LIST-QUEUE                   06370099
063800                 PERFORM 2135-GET-NEXT-ITEM                       06380099
063900                 IF PS-LIST-END                                   06390099
064000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06400099
064100                     SET PS-NO-LIST-END TO TRUE                   06410099
064200                 ELSE                                             06420099
064300                     PERFORM 4000-BUILD-INITIAL-PANEL             06430099
064400                 END-IF                                           06440099
064500                                                                  06450099
064600         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06460099
064700                 PERFORM 2050-DELETE-LIST-QUEUE                   06470099
064800                 PERFORM 2136-GET-PREV-ITEM                       06480099
064900                 IF PS-LIST-END                                   06490099
065000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06500099
065100                     SET PS-NO-LIST-END TO TRUE                   06510099
065200                 ELSE                                             06520099
065300                     PERFORM 4000-BUILD-INITIAL-PANEL             06530099
065400                 END-IF                                           06540099
065500                                                                  06550099
065600         WHEN OTHER                                               06560099
065700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06570099
065800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06580099
065900             IF  PS-NO-ERROR                                      06590099
066000                 SET DP030-CONTINUE-GO                            06600099
066100                                 TO TRUE                          06610099
066200                 PERFORM 2100-CHECK-FUNCTION-KEY                  06620099
066300             ELSE                                                 06630099
066400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06640099
066500                 SET DP030-OVERRIDE-GO                            06650099
066600                                 TO TRUE                          06660099
066700             END-IF                                               06670099
066800     END-EVALUATE.                                                06680099
066900 EJECT                                                            06690099
067000*----------------------------------------------------------------*06700099
067100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06710099
067200*----------------------------------------------------------------*06720099
067300 2050-DELETE-LIST-QUEUE.                                          06730099
067400                                                                  06740099
067500     EXEC CICS                                                    06750099
067600         DELETEQ TS                                               06760099
067700             QUEUE (ASC-LIST-QUEUE-NAME)                          06770099
067800             RESP  (PV-CICS-RESP)                                 06780099
067900     END-EXEC.                                                    06790099
068000                                                                  06800099
068100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06810099
068200        (PV-CICS-RESP = DFHRESP(QIDERR))                          06820099
068300         CONTINUE                                                 06830099
068400     ELSE                                                         06840099
068500         SET DP013-CICS-ABEND      TO TRUE                        06850099
068600         SET DP013-NO-ROLLBACK     TO TRUE                        06860099
068700                                                                  06870099
068800         MOVE '2050-DELETE-LIST-QUEUE'                            06880099
068900                                   TO DP013-PARAGRAPH             06890099
069000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06900099
069100                                   TO DP013-MESSAGE-TEXT (1)      06910099
069200         PERFORM DP013-0000-PROCESS-ABEND                         06920099
069300     END-IF.                                                      06930099
069400                                                                  06940099
069500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06950099
069600 EJECT                                                            06960099
069700*----------------------------------------------------------------*06970099
069800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06980099
069900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06990099
070000* CICS ARCHITECTURE API.                                         *07000099
070100*----------------------------------------------------------------*07010099
070200 2100-CHECK-FUNCTION-KEY.                                         07020099
070300     EVALUATE TRUE                                                07030099
070400         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               07040099
070500             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07050099
070600                 INITIALIZE ET307-INTER-APPL-COMMAREA             07060099
070700                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07070099
070800                                TO ET307-NUMBER-OF-SELECTED-ITEMS 07080099
070900                 PERFORM 5000-PREPARE-SEL-QUEUE                   07090099
071000             ELSE                                                 07100099
071100                 SET DP030-OVERRIDE-GO                            07110099
071200                                   TO TRUE                        07120099
071300                 MOVE PC-TSYMSG-00057                             07130099
071400                                   TO DP020-MSG-NUMBER            07140099
071500                 SET DP020-MSG-WARNING                            07150099
071600                                   TO TRUE                        07160099
071700             END-IF                                               07170099
071800                                                                  07180099
071900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07190099
072000             MOVE +1               TO PV-TOP-ITEM                 07200099
072100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07210099
072200                                                                  07220099
072300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07230099
072400             PERFORM 2110-BROWSE-BACKWARD                         07240099
072500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07250099
072600                                                                  07260099
072700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07270099
072800             PERFORM 2120-BROWSE-FORWARD                          07280099
072900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07290099
073000                                                                  07300099
073100         WHEN DP020-SRC-AID = DP016-ENTER                         07310099
073200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07320099
073300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07330099
073400                                                                  07340099
073500         WHEN OTHER                                               07350099
073600             SET DP013-NO-ROLLBACK                                07360099
073700                 DP013-XCTL-DISPLAY-RESTART                       07370099
073800                 DP013-CICS-ABEND  TO TRUE                        07380099
073900             MOVE '2100-CHECK-FUNCTION-KEY'                       07390099
074000                                   TO DP013-PARAGRAPH             07400099
074100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07410099
074200                                   TO DP013-MESSAGE-TEXT (1)      07420099
074300             PERFORM DP013-0000-PROCESS-ABEND                     07430099
074400     END-EVALUATE.                                                07440099
074500*                                                                 07450099
074600*----------------------------------------------------------------*07460099
074700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07470099
074800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07480099
074900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07490099
075000*    MESSAGE.                                                    *07500099
075100*----------------------------------------------------------------*07510099
075200                                                                  07520099
075300 2110-BROWSE-BACKWARD.                                            07530099
075400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07540099
075500         GIVING PV-TOP-ITEM.                                      07550099
075600*                                                                 07560099
075700     IF  ((PV-TOP-ITEM < +1)                                      07570099
075800       OR (PV-TOP-ITEM = +1))                                     07580099
075900         MOVE +1                   TO PV-TOP-ITEM                 07590099
076000*        -- TOP OF LIST --                                        07600099
076100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07610099
076200         SET DP020-MSG-INFORMATIONAL TO TRUE                      07620099
076300     END-IF.                                                      07630099
076400                                                                  07640099
076500 EJECT                                                            07650099
076600*----------------------------------------------------------------*07660099
076700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07670099
076800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07680099
076900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07690099
077000*----------------------------------------------------------------*07700099
077100                                                                  07710099
077200 2120-BROWSE-FORWARD.                                             07720099
077300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07730099
077400         GIVING PV-TOP-ITEM.                                      07740099
077500     COMPUTE PV-BOTTOM-ITEM =                                     07750099
077600         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1.                    07760099
077700*                                                                 07770099
077800     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ                07780099
077900       AND ASC-ITEMS-LEFT-ON-DB                                   07790099
078000         ADD PC-ITEMS-PER-PANEL  1                                07800099
078100             GIVING ASC-ITEM-SUB                                  07810099
078200         ADD PC-MAX-BLOCKS-IN-ARRAY 1                             07820099
078300             GIVING ASC-BLK-SUB                                   07830099
078400         MOVE PC-MAX-GROUPS      TO PV-GROUPS-TO-READ             07840099
078500         PERFORM 4005-BUILD-ADDITIONAL-PANELS                     07850099
078600     END-IF.                                                      07860099
078700                                                                  07870099
078800*                                                                 07880099
078900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07890099
079000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07900099
079100                                   TO PV-TOP-ITEM                 07910099
079200*        -- BOTTOM OF LIST --                                     07920099
079300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07930099
079400         SET DP020-MSG-INFORMATIONAL                              07940099
079500                                   TO TRUE                        07950099
079600     ELSE                                                         07960099
079700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07970099
079800*            -- BOTTOM OF LIST --                                 07980099
079900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07990099
080000             SET DP020-MSG-INFORMATIONAL                          08000099
080100                                   TO TRUE                        08010099
080200         END-IF                                                   08020099
080300     END-IF.                                                      08030099
080400 EJECT                                                            08040099
080500*----------------------------------------------------------------*08050099
080600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08060099
080700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08070099
080800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08080099
080900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08090099
081000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08100099
081100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08110099
081200*----------------------------------------------------------------*08120099
081300                                                                  08130099
081400 2130-CHECK-FOR-JUMP-BROWSE.                                      08140099
081500     SET PS-NO-ERROR               TO TRUE.                       08150099
081600     IF (ASC-START-ITEM-REQUEST = SPACE)                          08160099
081700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08170099
081800                                   TO PV-TOP-ITEM                 08180099
081900     ELSE                                                         08190099
082000         MOVE ASC-START-ITEM-REQUEST                              08200099
082100                                   TO DP010I-UNEDITED-FIELD       08210099
082200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08220099
082300         SET DP010I-NEGATIVE-NOT-ALLOWED                          08230099
082400                                   TO TRUE                        08240099
082510         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08251099
082520                         USING DP010I-NUMERIC-EDIT-AREA           08252099
082600                                                                  08260099
082700         IF  NOT DP010I-ERROR-DETECTED                            08270099
082800             MOVE DP010I-NUMERIC-FIELD                            08280099
082900                                   TO  ASC-START-ITEM-REQUEST-N   08290099
083000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08300099
083100                 PERFORM 2131-GET-MORE-PANELS                     08310099
083200                 IF  ASC-START-ITEM-REQUEST-N >                   08320099
083300                                          ASC-NUMBER-OF-ITEMS-READ08330099
083400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08340099
083500                     COMPUTE PV-TOP-ITEM =                        08350099
083600                             ASC-NUMBER-OF-ITEMS-READ             08360099
083700                             - PC-ITEMS-PER-PANEL + 1             08370099
083800                     IF  PV-TOP-ITEM < +1                         08380099
083900                         MOVE +1   TO PV-TOP-ITEM                 08390099
084000                         MOVE PC-TSYMSG-00070                     08400099
084100                                   TO DP020-MSG-NUMBER            08410099
084200                         SET DP020-MSG-INFORMATIONAL              08420099
084300                                   TO TRUE                        08430099
084400                     END-IF                                       08440099
084500                 ELSE                                             08450099
084600                     MOVE ASC-START-ITEM-REQUEST-N                08460099
084700                                   TO PV-TOP-ITEM                 08470099
084800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08480099
084900                     COMPUTE PV-BOTTOM-ITEM =                     08490099
085000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08500099
085100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08510099
085200*                        -- BOTTOM OF LIST --                     08520099
085300                         MOVE PC-TSYMSG-00070                     08530099
085400                                   TO DP020-MSG-NUMBER            08540099
085500                         SET DP020-MSG-INFORMATIONAL              08550099
085600                                   TO TRUE                        08560099
085700                     END-IF                                       08570099
085800                 END-IF                                           08580099
085900             ELSE                                                 08590099
086000*                --- VALUE OUT OF RANGE ----                      08600099
086100                 MOVE PC-TSYMSG-00101                             08610099
086200                                   TO DP020-MSG-NUMBER            08620099
086300                 MOVE -1           TO ASTRTITL                    08630099
086400                 SET DP030-SET-CURSOR-APPL-1                      08640099
086500                                   TO TRUE                        08650099
086600                 MOVE DP015-REVERSE                               08660099
086700                                   TO ASTRTITH                    08670099
086800                 MOVE DP015-RED    TO ASTRTITC                    08680099
086900                 MOVE DP015-UNP-NUM-BRT-MDT                       08690099
087000                                   TO ASTRTITA                    08700099
087100                 SET DP020-MSG-FATAL                              08710099
087200                                   TO TRUE                        08720099
087300                 SET PS-ERROR      TO TRUE                        08730099
087400             END-IF                                               08740099
087500                                                                  08750099
087600         ELSE                                                     08760099
087700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08770099
087800             MOVE -1               TO ASTRTITL                    08780099
087900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08790099
088000             MOVE DP015-REVERSE    TO ASTRTITH                    08800099
088100             MOVE DP015-RED        TO ASTRTITC                    08810099
088200             MOVE DP015-UNP-NUM-BRT-MDT                           08820099
088300                                   TO ASTRTITA                    08830099
088400             SET DP020-MSG-FATAL   TO TRUE                        08840099
088500             SET PS-ERROR          TO TRUE                        08850099
088600         END-IF                                                   08860099
088700     END-IF.                                                      08870099
088800*----------------------------------------------------------------*08880099
088900* SEE IF THERE IS A NEED TO READ ADDITIONAL PANELS OF INFO FROM  *08890099
089000* DATABASE BASED ON THE JUMP-BROWSE REQUEST.  IF THERE IS        *08900099
089100* CALCULATE THE NUMBER TO READ AND READ THEM.                    *08910099
089200*----------------------------------------------------------------*08920099
089300 2131-GET-MORE-PANELS.                                            08930099
089400     IF  ASC-START-ITEM-REQUEST-N >                               08940099
089500                              ASC-NUMBER-OF-ITEMS-READ            08950099
089600         IF  ASC-ITEMS-LEFT-ON-DB                                 08960099
089700             ADD PC-ITEMS-PER-PANEL  1                            08970099
089800                 GIVING ASC-ITEM-SUB                              08980099
089900             COMPUTE PV-GROUPS-TO-READ ROUNDED =                  08990099
090000                 (((ASC-START-ITEM-REQUEST-N                      09000099
090100                 - ASC-NUMBER-OF-ITEMS-READ)                      09010099
090200                 / (PC-MAX-BLOCKS-IN-ARRAY * PC-ITEMS-PER-PANEL)) 09020099
090300                 + 1)                                             09030099
090400             PERFORM 4005-BUILD-ADDITIONAL-PANELS                 09040099
090500         END-IF                                                   09050099
090600     END-IF.                                                      09060099
090700 EJECT                                                            09070099
090800*                                                                 09080099
090900******************************************************************09090099
091000** GET THE NEXT TP DKEY FROM THE LIST QUEUE.                      09100099
091100******************************************************************09110099
091200 2135-GET-NEXT-ITEM.                                              09120099
091300     ADD +1                       TO ASC-SEL-SUB.                 09130099
091400     IF  ASC-SEL-SUB > ET308-MAX-ITEMS                            09140099
091500         ADD +1                   TO ASC-SEL-ITEM                 09150099
091600         MOVE +1                  TO ASC-SEL-SUB                  09160099
091700     END-IF.                                                      09170099
091800     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 09180099
091900         PERFORM 9100-READ-TSQB-QUEUE                             09190099
092000         IF  ET308-ITEM (ASC-SEL-SUB) > ZERO                      09200099
092100             MOVE ET308-INT-CONTROL-NUMBER (ASC-SEL-SUB)          09210099
092200                                   TO ASC-INT-CONTROL-NUMBER      09220099
092300             MOVE ET308-VENDOR-NAME (1)                           09230099
092400                                   TO ASC-VENDOR-NAME             09240099
092500             MOVE ET308-TP-DKEY     (ASC-SEL-SUB)                 09250099
092600                                   TO ASC-TP-DKEY                 09260099
092700             MOVE ET308-TP-DKEY-TMST (ASC-SEL-SUB)                09270099
092800                                   TO ASC-TP-DKEY-TMST            09280099
092900             SET ET308-INQ (ASC-SEL-SUB) TO TRUE                  09290099
093000             PERFORM 9200-REWRITE-TSQB-QUEUE                      09300099
093100         ELSE                                                     09310099
093200             SUBTRACT +1 FROM ASC-SEL-SUB                         09320099
093300*            ---- BOTTOM OF LIST ----                             09330099
093400             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             09340099
093500             SET DP020-MSG-INFORMATIONAL TO TRUE                  09350099
093600             SET PS-LIST-END             TO TRUE                  09360099
093700         END-IF                                                   09370099
093800     ELSE                                                         09380099
093900         SUBTRACT +1 FROM ASC-SEL-ITEM                            09390099
094000         MOVE ET308-MAX-ITEMS     TO ASC-SEL-SUB                  09400099
094100*        ---- BOTTOM OF LIST ----                                 09410099
094200         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             09420099
094300         SET DP020-MSG-INFORMATIONAL TO TRUE                      09430099
094400         SET PS-LIST-END             TO TRUE                      09440099
094500     END-IF.                                                      09450099
094600                                                                  09460099
094700******************************************************************09470099
094800** GET THE PREVIOUS VENDOR FROM THE LIST QUEUE.                   09480099
094900******************************************************************09490099
095000 2136-GET-PREV-ITEM.                                              09500099
095100                                                                  09510099
095200     SUBTRACT +1 FROM ASC-SEL-SUB.                                09520099
095300     IF  ASC-SEL-SUB < +1                                         09530099
095400         SUBTRACT +1 FROM ASC-SEL-ITEM                            09540099
095500         MOVE ET308-MAX-ITEMS     TO ASC-SEL-SUB                  09550099
095600     END-IF.                                                      09560099
095700                                                                  09570099
095800     IF  ASC-SEL-ITEM > ZERO                                      09580099
095900         PERFORM 9100-READ-TSQB-QUEUE                             09590099
096000             MOVE ET308-INT-CONTROL-NUMBER (ASC-SEL-SUB)          09600099
096100                                   TO ASC-INT-CONTROL-NUMBER      09610099
096200             MOVE ET308-TP-DKEY     (ASC-SEL-SUB)                 09620099
096300                                   TO ASC-TP-DKEY                 09630099
096400             MOVE ET308-TP-DKEY-TMST (ASC-SEL-SUB)                09640099
096500                                   TO ASC-TP-DKEY-TMST            09650099
096600                                                                  09660099
096700     ELSE                                                         09670099
096800         MOVE +1                  TO ASC-SEL-ITEM                 09680099
096900                                     ASC-SEL-SUB                  09690099
097000*        ---- TOP OF LIST ----                                    09700099
097100         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             09710099
097200         SET DP020-MSG-INFORMATIONAL TO TRUE                      09720099
097300         SET PS-LIST-END             TO TRUE                      09730099
097400     END-IF.                                                      09740099
097500*----------------------------------------------------------------*09750099
097600*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09760099
097700*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09770099
097800*----------------------------------------------------------------*09780099
097900 2140-DESELECT-ALL-ITEMS.                                         09790099
098000     MOVE +1                       TO ASC-BLK-SUB.                09800099
098100                                                                  09810099
098200     PERFORM 2141-CLEAR-SELECTED-INDS                             09820099
098300         VARYING ASC-ITEM-SUB                                     09830099
098400         FROM 1 BY 1                                              09840099
098500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09850099
098600                                                                  09860099
098700     ADD +1                        TO ASC-BLK-SUB.                09870099
098800                                                                  09880099
098900     PERFORM 2141-CLEAR-SELECTED-INDS                             09890099
099000         VARYING ASC-ITEM-SUB                                     09900099
099100         FROM 1 BY 1                                              09910099
099200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09920099
099300                                                                  09930099
099400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09940099
099500                                   TO PV-LIST-ITEM-NUMBER.        09950099
099600                                                                  09960099
099700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09970099
099800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09980099
099900                                                                  09990099
100000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10000099
100100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10010099
100200         MOVE +1                   TO ASC-BLK-SUB                 10020099
100300                                                                  10030099
100400         PERFORM 5100-WRITE-TEMP-STORAGE                          10040099
100500                                                                  10050099
100600         MOVE +1                   TO PV-BLOCK-NUMBER             10060099
100700                                                                  10070099
100800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10080099
100900             PV-FIRST-BLOCK-IN-ARRAY - 1                          10090099
101000                                                                  10100099
101100         PERFORM                                                  10110099
101200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10120099
101300                                                                  10130099
101400             PERFORM 4410-READ-TEMP-STORAGE                       10140099
101500                                                                  10150099
101600             PERFORM 2141-CLEAR-SELECTED-INDS                     10160099
101700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10170099
101800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10180099
101900                                                                  10190099
102000             PERFORM 5100-WRITE-TEMP-STORAGE                      10200099
102100                                                                  10210099
102200             ADD +1                TO PV-BLOCK-NUMBER             10220099
102300                                                                  10230099
102400         END-PERFORM                                              10240099
102500                                                                  10250099
102600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10260099
102700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10270099
102800                                                                  10280099
102900         PERFORM                                                  10290099
103000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10300099
103100                   ASC-HIGHEST-BLOCK-WRITTEN                      10310099
103200                                                                  10320099
103300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10330099
103400                                   TO PV-BLOCK-NUMBER             10340099
103500                                                                  10350099
103600             PERFORM 4410-READ-TEMP-STORAGE                       10360099
103700                                                                  10370099
103800             PERFORM 2141-CLEAR-SELECTED-INDS                     10380099
103900                 VARYING ASC-ITEM-SUB                             10390099
104000                 FROM 1 BY 1                                      10400099
104100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10410099
104200                                                                  10420099
104300             PERFORM 5100-WRITE-TEMP-STORAGE                      10430099
104400                                                                  10440099
104500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10450099
104600                                                                  10460099
104700         END-PERFORM                                              10470099
104800                                                                  10480099
104900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10490099
105000                                   TO PV-BLOCK-NUMBER             10500099
105100                                                                  10510099
105200         PERFORM 4410-READ-TEMP-STORAGE                           10520099
105300     END-IF.                                                      10530099
105400                                                                  10540099
105500                                                                  10550099
105600     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS10560099
105700                                      ASC-START-OF-SELECTED-RANGE 10570099
105800                                      ASC-END-OF-SELECTED-RANGE.  10580099
105900                                                                  10590099
106000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10600099
106100                                                                  10610099
106200 EJECT                                                            10620099
106300*----------------------------------------------------------------*10630099
106400*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10640099
106500*----------------------------------------------------------------*10650099
106600                                                                  10660099
106700 2141-CLEAR-SELECTED-INDS.                                        10670099
106800                                                                  10680099
106900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10690099
107000             NOT EQUAL ZERO                                       10700099
107100         IF  (ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10710099
107200           AND ASC-TEMP-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB))      10720099
107300             CONTINUE                                             10730099
107400         ELSE                                                     10740099
107500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10750099
107600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10760099
107700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10770099
107800                                   TO TRUE                        10780099
107900         END-IF                                                   10790099
108000     END-IF.                                                      10800099
108100                                                                  10810099
108200 EJECT                                                            10820099
108300*----------------------------------------------------------------*10830099
108400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10840099
108500*  FOR ALL ITEMS.                                                *10850099
108600*----------------------------------------------------------------*10860099
108700                                                                  10870099
108800 2150-SELECT-ALL-ITEMS.                                           10880099
108900                                                                  10890099
109000                                                                  10900099
109100*  SELECT ALL ITEMS IN THE CURRENT 'FIRST' BLOCK.                 10910099
109200     MOVE +1                       TO ASC-BLK-SUB.                10920099
109300     PERFORM 2151-SET-SELECTED-INDS                               10930099
109400         VARYING ASC-ITEM-SUB                                     10940099
109500         FROM 1 BY 1                                              10950099
109600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10960099
109700                                                                  10970099
109800*  SELECT ALL ITEMS IN THE CURRENT 'SECOND' BLOCK.                10980099
109900     ADD +1                        TO ASC-BLK-SUB.                10990099
110000     PERFORM 2151-SET-SELECTED-INDS                               11000099
110100         VARYING ASC-ITEM-SUB                                     11010099
110200         FROM 1 BY 1                                              11020099
110300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11030099
110400                                                                  11040099
110500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11050099
110600                                   TO PV-LIST-ITEM-NUMBER.        11060099
110700                                                                  11070099
110800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11080099
110900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11090099
111000                                                                  11100099
111100     IF ((PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                    11110099
111200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY) OR 11120099
111300        (ASC-ITEMS-LEFT-ON-DB))                                   11130099
111400         MOVE +1                   TO ASC-BLK-SUB                 11140099
111500         PERFORM 5100-WRITE-TEMP-STORAGE                          11150099
111600         ADD +1                    TO ASC-BLK-SUB                 11160099
111700         PERFORM 5100-WRITE-TEMP-STORAGE                          11170099
111800         MOVE +1                   TO ASC-BLK-SUB                 11180099
111900                                                                  11190099
112000*  SELECT EVERYTHING 'BEFORE' THE CURRENT BLOCKS                  11200099
112100         MOVE +1                   TO PV-BLOCK-NUMBER             11210099
112200                                                                  11220099
112300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11230099
112400             PV-FIRST-BLOCK-IN-ARRAY - 1                          11240099
112500                                                                  11250099
112600         PERFORM                                                  11260099
112700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11270099
112800                                                                  11280099
112900             PERFORM 4410-READ-TEMP-STORAGE                       11290099
113000                                                                  11300099
113100             PERFORM 2151-SET-SELECTED-INDS                       11310099
113200                 VARYING ASC-ITEM-SUB                             11320099
113300                 FROM 1 BY 1                                      11330099
113400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11340099
113500                                                                  11350099
113600             PERFORM 5100-WRITE-TEMP-STORAGE                      11360099
113700                                                                  11370099
113800             ADD +1                TO PV-BLOCK-NUMBER             11380099
113900                                                                  11390099
114000         END-PERFORM                                              11400099
114100                                                                  11410099
114200* IF NOT ALL DATA HAS BEEN READ, READ EVERYTHING, AND PUT IT      11420099
114300* INTO TEMP STORAGE.                                              11430099
114400     IF  ASC-ITEMS-LEFT-ON-DB                                     11440099
114500         COMPUTE PV-GROUPS-TO-READ =                              11450099
114600             (((PC-MAX-ITEMS - ASC-NUMBER-OF-ITEMS-READ)          11460099
114700             / (PC-MAX-BLOCKS-IN-ARRAY * PC-ITEMS-PER-PANEL)) + 1)11470099
114800         PERFORM 4005-BUILD-ADDITIONAL-PANELS                     11480099
114900     END-IF                                                       11490099
115000                                                                  11500099
115100* SELECT EVERYTHING AFTER THE CURRENT BLOCKS                      11510099
115200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11520099
115300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11530099
115400                                                                  11540099
115500         PERFORM                                                  11550099
115600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11560099
115700                   ASC-HIGHEST-BLOCK-WRITTEN                      11570099
115800                                                                  11580099
115900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11590099
116000                                   TO PV-BLOCK-NUMBER             11600099
116100                                                                  11610099
116200             PERFORM 4410-READ-TEMP-STORAGE                       11620099
116300                                                                  11630099
116400             PERFORM 2151-SET-SELECTED-INDS                       11640099
116500                 VARYING ASC-ITEM-SUB                             11650099
116600                 FROM 1 BY 1                                      11660099
116700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11670099
116800                                                                  11680099
116900             PERFORM 5100-WRITE-TEMP-STORAGE                      11690099
117000                                                                  11700099
117100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11710099
117200                                                                  11720099
117300         END-PERFORM                                              11730099
117400                                                                  11740099
117500*  REPOSITION TO CURRENT BLOCKS                                   11750099
117600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11760099
117700                                   TO PV-BLOCK-NUMBER             11770099
117800                                                                  11780099
117900         PERFORM 4410-READ-TEMP-STORAGE                           11790099
118000     END-IF.                                                      11800099
118100                                                                  11810099
118200                                                                  11820099
118300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11830099
118400                       ASC-NUMBER-OF-SELECTED-ITEMS.              11840099
118500                                                                  11850099
118600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11860099
118700                                                                  11870099
118800 EJECT                                                            11880099
118900*----------------------------------------------------------------*11890099
119000*    MARK EACH ITEM AS BEING SELECTED.                           *11900099
119100*----------------------------------------------------------------*11910099
119200                                                                  11920099
119300 2151-SET-SELECTED-INDS.                                          11930099
119400                                                                  11940099
119500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11950099
119600             NOT EQUAL ZERO                                       11960099
119700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11970099
119800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11980099
119900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11990099
120000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12000099
120100                               TO  TRUE                           12010099
120200         END-IF                                                   12020099
120300     END-IF.                                                      12030099
120400******************************************************************12040099
120500** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12050099
120600** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12060099
120700******************************************************************12070099
120800 2200-MOVE-SCREEN-TO-COMMAREA.                                    12080099
120900                                                                  12090099
121000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12100099
121100     MOVE +1                       TO PV-SUB.                     12110099
121200*                                                                 12120099
121300     PERFORM 3100-SET-SUBSCRIPTS.                                 12130099
121400     IF  ASTRTITL > ZERO                                          12140099
121500         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12150099
121600     ELSE                                                         12160099
121700         IF  ASTRTITF = DP015-ERASE-EOF                           12170099
121800             INITIALIZE ASC-START-ITEM-REQUEST                    12180099
121900         END-IF                                                   12190099
122000     END-IF.                                                      12200099
122100     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12210099
122200         VARYING PV-SUB                                           12220099
122300         FROM 1 BY 1                                              12230099
122400         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12240099
122500******************************************************************12250099
122600** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12260099
122700******************************************************************12270099
122800 2210-MOVE-LINES-TO-COMMAREA.                                     12280099
122900     IF  MR-SELECTL (PV-SUB) > ZERO                               12290099
123000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12300099
123100         MOVE MR-SELECTI (PV-SUB)                                 12310099
123200                                   TO ASC-TEMP-SELECTED-SW        12320099
123300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12330099
123400     ELSE                                                         12340099
123500         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12350099
123600                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12360099
123700                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12370099
123800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12380099
123900         END-IF                                                   12390099
124000     END-IF.                                                      12400099
124100     ADD +1                        TO ASC-ITEM-SUB.               12410099
124200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12420099
124300         ADD +1                    TO ASC-BLK-SUB                 12430099
124400         MOVE +1                   TO ASC-ITEM-SUB                12440099
124500     END-IF.                                                      12450099
124600******************************************************************12460099
124700** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12470099
124800** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12480099
124900******************************************************************12490099
125000 3000-EDIT-DATA-IN-COMMAREA.                                      12500099
125100     SET PS-NO-ERROR               TO TRUE.                       12510099
125200     PERFORM 3200-RESET-ATTRIBUTES.                               12520099
125300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12530099
125400**                                                                12540099
125500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12550099
125600* EDITTING IS DONE FROM THE BOTTOM UP.                            12560099
125700**                                                                12570099
125800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12580099
125900         ASC-ITEMS-DISPLAYED - 1.                                 12590099
126000     PERFORM 3100-SET-SUBSCRIPTS.                                 12600099
126100     PERFORM 3300-EDIT-SELECTIONS                                 12610099
126200         VARYING PV-SUB                                           12620099
126300         FROM PV-SUB BY -1                                        12630099
126400         UNTIL PV-SUB < +1                                        12640099
126500*                                                                 12650099
126600     IF  PS-NO-ERROR                                              12660099
126700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12670099
126800     END-IF.                                                      12680099
126900*                                                                 12690099
127000     IF  ((PS-NO-ERROR)                                           12700099
127100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12710099
127200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12720099
127300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12730099
127400     END-IF.                                                      12740099
127500 EJECT                                                            12750099
127600*----------------------------------------------------------------*12760099
127700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12770099
127800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12780099
127900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12790099
128000*                                                                *12800099
128100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12810099
128200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12820099
128300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12830099
128400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12840099
128500*----------------------------------------------------------------*12850099
128600                                                                  12860099
128700 3100-SET-SUBSCRIPTS.                                             12870099
128800                                                                  12880099
128900     COMPUTE ASC-ITEM-SUB =                                       12890099
129000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12900099
129100                                                                  12910099
129200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12920099
129300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12930099
129400                                                                  12940099
129500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12950099
129600     ELSE                                                         12960099
129700         MOVE +1                     TO ASC-BLK-SUB               12970099
129800     END-IF.                                                      12980099
129900******************************************************************12990099
130000** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13000099
130100******************************************************************13010099
130200                                                                  13020099
130300 3200-RESET-ATTRIBUTES.                                           13030099
130400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13040099
130500     MOVE DP015-GREEN              TO ASTRTITC.                   13050099
130600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13060099
130700*                                                                 13070099
130800     PERFORM                                                      13080099
130900         VARYING PV-SUB                                           13090099
131000         FROM 1 BY 1                                              13100099
131100         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13110099
131200         MOVE DP015-UNP-ALP-NOR-OFF                               13120099
131300                                   TO MR-SELECTA (PV-SUB)         13130099
131400         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         13140099
131500         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         13150099
131600     END-PERFORM.                                                 13160099
131700******************************************************************13170099
131800** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **13180099
131900** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **13190099
132000** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **13200099
132100** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **13210099
132200******************************************************************13220099
132300 3300-EDIT-SELECTIONS.                                            13230099
132400     EVALUATE TRUE                                                13240099
132500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13250099
132600             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13260099
132700                 CONTINUE                                         13270099
132800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13280099
132900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13290099
133000                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13300099
133100                 MOVE ASC-TEMP-SELECTED-SW                        13310099
133200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13320099
133300                                TO ASC-SELECTED-SW                13330099
133400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13340099
133500             END-IF                                               13350099
133600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13360099
133700                 = SPACE                                          13370099
133800             EVALUATE TRUE                                        13380099
133900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13390099
134000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13400099
134100                     MOVE SPACE TO ASC-SELECTED-SW                13410099
134200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13420099
134300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13430099
134400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13440099
134500                     MOVE SPACE TO ASC-SELECTED-SW                13450099
134600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13460099
134700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13470099
134800                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13480099
134900                     MOVE SPACE TO ASC-SELECTED-SW                13490099
135000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13500099
135100             END-EVALUATE                                         13510099
135200         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13520099
135300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13530099
135400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13540099
135500             END-IF                                               13550099
135600             PERFORM 3310-EDIT-RANGE                              13560099
135700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13570099
135800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13580099
135900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13590099
136000             END-IF                                               13600099
136100             PERFORM 3310-EDIT-RANGE                              13610099
136200         WHEN OTHER                                               13620099
136300             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13630099
136400             SET DP020-MSG-FATAL    TO TRUE                       13640099
136500             MOVE -1                TO MR-SELECTL (PV-SUB)        13650099
136600             SET DP030-SET-CURSOR-APPL-1                          13660099
136700                                    TO TRUE                       13670099
136800             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13680099
136900             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13690099
137000             SET PS-ERROR TO TRUE                                 13700099
137100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13710099
137200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13720099
137300                 MOVE SPACE         TO ASC-SELECTED-SW            13730099
137400                                        (ASC-BLK-SUB ASC-ITEM-SUB)13740099
137500             END-IF                                               13750099
137600     END-EVALUATE.                                                13760099
137700                                                                  13770099
137800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13780099
137900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13790099
138000     IF  ASC-ITEM-SUB < 1                                         13800099
138100         SUBTRACT +1 FROM ASC-BLK-SUB                             13810099
138200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13820099
138300     END-IF.                                                      13830099
138400******************************************************************13840099
138500** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **13850099
138600** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **13860099
138700** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**13870099
138800** THE ENDING.                                                  **13880099
138900******************************************************************13890099
139000 3310-EDIT-RANGE.                                                 13900099
139100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13910099
139200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13920099
139300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13930099
139400                                   TO ASC-SELECTED-SW             13940099
139500                                        (ASC-BLK-SUB ASC-ITEM-SUB)13950099
139600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13960099
139700         ELSE                                                     13970099
139800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13980099
139900                 CONTINUE                                         13990099
140000             ELSE                                                 14000099
140100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14010099
140200                 MOVE PC-TSYMSG-00054                             14020099
140300                                   TO DP020-MSG-NUMBER            14030099
140400                 SET DP020-MSG-FATAL                              14040099
140500                                   TO TRUE                        14050099
140600                 MOVE -1           TO MR-SELECTL (PV-SUB)         14060099
140700                 SET DP030-SET-CURSOR-APPL-1                      14070099
140800                                   TO TRUE                        14080099
140900                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14090099
141000                 MOVE DP015-UNDERLINE                             14100099
141100                                   TO MR-SELECTH (PV-SUB)         14110099
141200                 SET PS-ERROR      TO TRUE                        14120099
141300             END-IF                                               14130099
141400         END-IF                                                   14140099
141500     ELSE                                                         14150099
141600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14160099
141700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14170099
141800                                   TO ASC-SELECTED-SW             14180099
141900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14190099
142000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14200099
142100         ELSE                                                     14210099
142200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14220099
142300                 CONTINUE                                         14230099
142400             ELSE                                                 14240099
142500*                -- ONLY ONE END-OF-RANGE ALLOWED --              14250099
142600                 MOVE PC-TSYMSG-00055                             14260099
142700                                   TO DP020-MSG-NUMBER            14270099
142800                 SET DP020-MSG-FATAL                              14280099
142900                                   TO TRUE                        14290099
143000                 MOVE -1           TO MR-SELECTL (PV-SUB)         14300099
143100                 SET DP030-SET-CURSOR-APPL-1                      14310099
143200                                   TO TRUE                        14320099
143300                 SET PS-ERROR      TO TRUE                        14330099
143400             END-IF                                               14340099
143500         END-IF                                                   14350099
143600     END-IF.                                                      14360099
143700*                                                                 14370099
143800******************************************************************14380099
143900** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **14390099
144000** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **14400099
144100******************************************************************14410099
144200 3400-CHECK-RANGE-SEQUENCE.                                       14420099
144300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14430099
144400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14440099
144500       AND  ASC-START-OF-SELECTED-RANGE >                         14450099
144600                                         ASC-END-OF-SELECTED-RANGE14460099
144700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14470099
144800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14480099
144900         SET DP020-MSG-FATAL TO TRUE                              14490099
145000         SET PS-ERROR TO TRUE                                     14500099
145100         PERFORM 3410-POSITION-AT-ERROR                           14510099
145200     END-IF.                                                      14520099
145300******************************************************************14530099
145400** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **14540099
145500** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **14550099
145600** SHOULD BE POSITIONED ON A RANGE ERROR.                       **14560099
145700******************************************************************14570099
145800 3410-POSITION-AT-ERROR.                                          14580099
145900     SET DP030-SET-CURSOR-APPL-1                                  14590099
146000                                   TO TRUE.                       14600099
146100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14610099
146200                    - PV-TOP-ITEM + 1.                            14620099
146300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14630099
146400         CONTINUE                                                 14640099
146500     ELSE                                                         14650099
146600         MOVE -1                   TO MR-SELECTL (PV-SUB)         14660099
146700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14670099
146800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14680099
146900     END-IF.                                                      14690099
147000*                                                                 14700099
147100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14710099
147200                    - PV-TOP-ITEM + 1.                            14720099
147300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14730099
147400         CONTINUE                                                 14740099
147500     ELSE                                                         14750099
147600         MOVE -1                   TO MR-SELECTL (PV-SUB)         14760099
147700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14770099
147800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14780099
147900     END-IF.                                                      14790099
148000 EJECT                                                            14800099
148100*----------------------------------------------------------------*14810099
148200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14820099
148300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14830099
148400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14840099
148500*----------------------------------------------------------------*14850099
148600                                                                  14860099
148700 3500-MARK-RANGE-AS-SELECTED.                                     14870099
148800     MOVE +1                       TO  ASC-BLK-SUB.               14880099
148900     PERFORM 3510-MARK-SELECTED-INDS                              14890099
149000         VARYING ASC-ITEM-SUB                                     14900099
149100         FROM 1 BY 1                                              14910099
149200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14920099
149300                                                                  14930099
149400     ADD +1                        TO ASC-BLK-SUB.                14940099
149500     PERFORM 3510-MARK-SELECTED-INDS                              14950099
149600         VARYING ASC-ITEM-SUB                                     14960099
149700         FROM 1 BY 1                                              14970099
149800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14980099
149900                                                                  14990099
150000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15000099
150100                                   TO  PV-LIST-ITEM-NUMBER.       15010099
150200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15020099
150300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15030099
150400               PC-ITEMS-PER-PANEL).                               15040099
150500                                                                  15050099
150600     MOVE ASC-START-OF-SELECTED-RANGE                             15060099
150700                                   TO PV-START-OF-SELECTED-RANGE. 15070099
150800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15080099
150900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15090099
151000               PC-ITEMS-PER-PANEL).                               15100099
151100                                                                  15110099
151200     MOVE ASC-END-OF-SELECTED-RANGE                               15120099
151300                                   TO  PV-END-OF-SELECTED-RANGE.  15130099
151400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15140099
151500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15150099
151600               PC-ITEMS-PER-PANEL).                               15160099
151700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15170099
151800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15180099
151900                                                                  15190099
152000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15200099
152100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15210099
152200         MOVE +1                   TO ASC-BLK-SUB                 15220099
152300         PERFORM 5100-WRITE-TEMP-STORAGE                          15230099
152400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15240099
152500             PV-FIRST-BLOCK-IN-ARRAY - 1                          15250099
152600                                                                  15260099
152700         PERFORM                                                  15270099
152800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15280099
152900                   PV-PREV-BLOCK-IN-ARRAY                         15290099
153000             MOVE PV-FIRST-BLOCK-IN-RANGE                         15300099
153100                                   TO PV-BLOCK-NUMBER             15310099
153200             PERFORM 4410-READ-TEMP-STORAGE                       15320099
153300             PERFORM 3510-MARK-SELECTED-INDS                      15330099
153400                 VARYING ASC-ITEM-SUB                             15340099
153500                 FROM 1 BY 1                                      15350099
153600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15360099
153700             PERFORM 5100-WRITE-TEMP-STORAGE                      15370099
153800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15380099
153900         END-PERFORM                                              15390099
154000                                                                  15400099
154100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15410099
154200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15420099
154300         PERFORM                                                  15430099
154400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15440099
154500                   PV-LAST-BLOCK-IN-RANGE                         15450099
154600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15460099
154700                                   TO PV-BLOCK-NUMBER             15470099
154800             PERFORM 4410-READ-TEMP-STORAGE                       15480099
154900             PERFORM 3510-MARK-SELECTED-INDS                      15490099
155000                 VARYING ASC-ITEM-SUB                             15500099
155100                 FROM 1 BY 1                                      15510099
155200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15520099
155300             PERFORM 5100-WRITE-TEMP-STORAGE                      15530099
155400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15540099
155500         END-PERFORM                                              15550099
155600                                                                  15560099
155700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15570099
155800                                   TO PV-BLOCK-NUMBER             15580099
155900         PERFORM 4410-READ-TEMP-STORAGE                           15590099
156000     END-IF.                                                      15600099
156100                                                                  15610099
156200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15620099
156300                                      ASC-END-OF-SELECTED-RANGE.  15630099
156400                                                                  15640099
156500 EJECT                                                            15650099
156600*----------------------------------------------------------------*15660099
156700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15670099
156800*----------------------------------------------------------------*15680099
156900                                                                  15690099
157000 3510-MARK-SELECTED-INDS.                                         15700099
157100                                                                  15710099
157200     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15720099
157300                                ASC-ITEM-SUB) >                   15730099
157400         ASC-START-OF-SELECTED-RANGE)                             15740099
157500     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15750099
157600                                ASC-ITEM-SUB) =                   15760099
157700         ASC-START-OF-SELECTED-RANGE)                             15770099
157800                                                                  15780099
157900         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15790099
158000                                    ASC-ITEM-SUB) <               15800099
158100             ASC-END-OF-SELECTED-RANGE)                           15810099
158200         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15820099
158300                                    ASC-ITEM-SUB) =               15830099
158400             ASC-END-OF-SELECTED-RANGE)                           15840099
158500                                                                  15850099
158600             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15860099
158700                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15870099
158800                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15880099
158900                               TO TRUE                            15890099
159000                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15900099
159100                               TO TRUE                            15910099
159200                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    15920099
159300             END-IF                                               15930099
159400         END-IF                                                   15940099
159500     END-IF.                                                      15950099
159600                                                                  15960099
159700 EJECT                                                            15970099
159800*----------------------------------------------------------------*15980099
159900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15990099
160000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16000099
160100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16010099
160200*    DISPLAY THE PANEL TO USER.                                  *16020099
160300*----------------------------------------------------------------*16030099
160400                                                                  16040099
160500 4000-BUILD-INITIAL-PANEL.                                        16050099
160600                                                                  16060099
160700     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             16070099
160800                                ASC-BLOCK-ENTRIES (2).            16080099
160900     MOVE +1                 TO ASC-BLK-SUB.                      16090099
161000     SET ASC-ITEMS-LEFT-ON-DB                                     16100099
161100                             TO TRUE.                             16110099
161200     MOVE PC-MAX-GROUPS      TO PV-GROUPS-TO-READ.                16120099
161300                                                                  16130099
161400     MOVE +0                 TO ASC-ITEM-SUB                      16140099
161500                                ASC-NUMBER-OF-ITEMS-READ          16150099
161600                                ASC-NUMBER-OF-SELECTED-ITEMS      16160099
161700                                ASC-HIGHEST-BLOCK-WRITTEN         16170099
161800                                ASC-START-OF-SELECTED-RANGE       16180099
161900                                ASC-END-OF-SELECTED-RANGE         16190099
162000                                ASC-ITEM-AT-TOP-OF-PANEL          16200099
162100                                ASC-LAST-MSG-READ.                16210099
162200     PERFORM 4005-BUILD-ADDITIONAL-PANELS                         16220099
162300                                                                  16230099
162400     MOVE +1                   TO  PV-TOP-ITEM.                   16240099
162500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16250099
162600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    16260099
162700         SET DP020-MSG-FATAL   TO  TRUE                           16270099
162800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               16280099
162900     ELSE                                                         16290099
163000         MOVE 1                TO ASC-BLK-SUB                     16300099
163100                                  PV-BLOCK-NUMBER                 16310099
163200         PERFORM 4410-READ-TEMP-STORAGE                           16320099
163300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             16330099
163400             MOVE 2            TO ASC-BLK-SUB                     16340099
163500                                  PV-BLOCK-NUMBER                 16350099
163600             PERFORM 4410-READ-TEMP-STORAGE                       16360099
163700         END-IF                                                   16370099
163800         MOVE -1               TO MR-SELECTL (1)                  16380099
163900         SET DP030-SET-CURSOR-APPL-1                              16390099
164000                               TO TRUE                            16400099
164100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16410099
164200     END-IF.                                                      16420099
164300 EJECT                                                            16430099
164400*----------------------------------------------------------------*16440099
164500*    THE LOGIC IN THIS PARAGRAPH IS VERY SIMILAR TO THAT IN THE  *16450099
164600*    'BUILD INITIAL PANEL' PARAGRAPH, EXCEPT THAT THE VARIABLES  *16460099
164700*    ARE NOT INITIALIZED.                                        *16470099
164800*----------------------------------------------------------------*16480099
164900                                                                  16490099
165000 4005-BUILD-ADDITIONAL-PANELS.                                    16500099
165100                                                                  16510099
165200     PERFORM 4100-PREPARE-CURSOR                                  16520099
165300                                                                  16530099
165400     PERFORM 4010-OPEN-CURSOR.                                    16540099
165500                                                                  16550099
165600     PERFORM 4300-READ-ITEMS-FROM-DB                              16560099
165700         VARYING PV-TEMP-NUM                                      16570099
165800         FROM 1 BY 1                                              16580099
165900         UNTIL PV-TEMP-NUM > PV-GROUPS-TO-READ                    16590099
166000            OR ASC-NO-ITEMS-LEFT-ON-DB.                           16600099
166100                                                                  16610099
166200     PERFORM 4020-CLOSE-CURSOR.                                   16620099
166300                                                                  16630099
166400 EJECT                                                            16640099
166500*----------------------------------------------------------------*16650099
166600* OPEN THE TMESSAGE CURSOR.                                      *16660099
166700*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *16670099
166800*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *16680099
166900*   USER.                                                        *16690099
167000*----------------------------------------------------------------*16700099
167100                                                                  16710099
167200 4010-OPEN-CURSOR.                                                16720099
167300     PERFORM                                                      16730099
167400         WITH TEST AFTER                                          16740099
167500         VARYING PV-RETRY-COUNTER                                 16750099
167600         FROM 1 BY 1                                              16760099
167700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16770099
167800                   OR (SQLCODE = ZERO))                           16780099
167900           MOVE 'CURSOR 1' TO DP013-MESSAGE-TEXT(2)               16790099
168000           EXEC SQL                                               16800099
168100                OPEN CURSOR_ONE                                   16810099
168200           END-EXEC                                               16820099
168300                                                                  16830099
168400         EVALUATE TRUE                                            16840099
168500             WHEN SQLCODE = ZERO                                  16850099
168600             WHEN SQLCODE = -904                                  16860099
168700             WHEN SQLCODE = -913                                  16870099
168800                 CONTINUE                                         16880099
168900             WHEN SQLWARN0 NOT = SPACES                           16890099
169000             WHEN SQLCODE < ZERO                                  16900099
169100             WHEN SQLCODE > ZERO                                  16910099
169200                 MOVE '4010-OPEN-CURSOR'                          16920099
169300                                   TO DP013-PARAGRAPH             16930099
169400                 MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             16940099
169500                                   TO DP013-MESSAGE-TEXT (1)      16950099
169600                 MOVE SQLCA        TO DP013-SQLCA                 16960099
169700                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    16970099
169800                 SET DP013-DB2-ABEND                              16980099
169900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16990099
170000                 PERFORM DP013-0000-PROCESS-ABEND                 17000099
170100         END-EVALUATE                                             17010099
170200     END-PERFORM.                                                 17020099
170300*                                                                 17030099
170400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17040099
170500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             17050099
170600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   17060099
170700                                   TO DP013-MESSAGE-TEXT (1)      17070099
170800         MOVE SQLCA                TO DP013-SQLCA                 17080099
170900         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    17090099
171000         SET DP013-DB2-ABEND                                      17100099
171100             DP013-XCTL-DISPLAY-RESTART                           17110099
171200                                   TO TRUE                        17120099
171300         PERFORM DP013-0000-PROCESS-ABEND                         17130099
171400     END-IF.                                                      17140099
171500                                                                  17150099
171600 EJECT                                                            17160099
171700*----------------------------------------------------------------*17170099
171800* CLOSE THE TMESSAGE CURSOR.                                     *17180099
171900*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *17190099
172000*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *17200099
172100*   USER.                                                        *17210099
172200*----------------------------------------------------------------*17220099
172300                                                                  17230099
172400 4020-CLOSE-CURSOR.                                               17240099
172500                                                                  17250099
172600     EXEC SQL                                                     17260099
172700          CLOSE CURSOR_ONE                                        17270099
172800     END-EXEC.                                                    17280099
172900*                                                                 17290099
173000     EVALUATE TRUE                                                17300099
173100         WHEN SQLCODE = ZERO                                      17310099
173200             CONTINUE                                             17320099
173300         WHEN SQLWARN0 NOT = SPACES                               17330099
173400         WHEN SQLCODE < ZERO                                      17340099
173500         WHEN SQLCODE > ZERO                                      17350099
173600             MOVE '4020-CLOSE-CURSOR'                             17360099
173700                               TO DP013-PARAGRAPH                 17370099
173800             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  17380099
173900                               TO DP013-MESSAGE-TEXT (1)          17390099
174000             MOVE SQLCA        TO DP013-SQLCA                     17400099
174100             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        17410099
174200             SET DP013-DB2-ABEND                                  17420099
174300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17430099
174400             PERFORM DP013-0000-PROCESS-ABEND                     17440099
174500     END-EVALUATE.                                                17450099
174600                                                                  17460099
174700 EJECT                                                            17470099
174800*----------------------------------------------------------------*17480099
174900*    SET UP THE HOST VARIABLES.                                  *17490099
175000*----------------------------------------------------------------*17500099
175100                                                                  17510099
175200 4100-PREPARE-CURSOR.                                             17520099
175300                                                                  17530099
175400     MOVE ASC-INT-CONTROL-NUMBER TO DK-INT-CONTROL-NUMBER.        17540099
175500     MOVE ASC-VENDOR-NAME        TO DK-VENDOR-NAME.               17550099
175600     MOVE ASC-TP-DKEY            TO DK-TP-DKEY.                   17560099
175700     MOVE ASC-TP-DKEY-TMST       TO DK-TP-DKEY-TMST.              17570099
175800                                                                  17580099
175900 EJECT                                                            17590099
176000*----------------------------------------------------------------*17600099
176100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17610099
176200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17620099
176300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17630099
176400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17640099
176500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17650099
176600*                                                                *17660099
176700*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17670099
176800*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17680099
176900*    UPON INITIALIZATION.                                        *17690099
177000*----------------------------------------------------------------*17700099
177100                                                                  17710099
177200 4300-READ-ITEMS-FROM-DB.                                         17720099
177300     COMPUTE PV-MAX-ITEMS =                                       17730099
177400             ((PC-MAX-GROUPS * PC-ITEMS-PER-PANEL)                17740099
177500             * PC-MAX-BLOCKS-IN-ARRAY).                           17750099
177600                                                                  17760099
177700     PERFORM                                                      17770099
177800         VARYING PV-READ-COUNT                                    17780099
177900         FROM 1 BY 1                                              17790099
178000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17800099
178100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17810099
178200                                                                  17820099
178300         PERFORM 4310-FETCH                                       17830099
178400         PERFORM 4500-PROCESS-PO                                  17840099
178500                                                                  17850099
178600         IF  ASC-ITEMS-LEFT-ON-DB                                 17860099
178700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17870099
178800                 ADD +1            TO ASC-ITEM-SUB                17880099
178900             ELSE                                                 17890099
179000                 ADD +1            TO ASC-BLK-SUB                 17900099
179100                 MOVE +1           TO ASC-ITEM-SUB                17910099
179200                                                                  17920099
179300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         17930099
179400                     MOVE +1       TO ASC-BLK-SUB                 17940099
179500                     SET ASC-BLOCK-MODIFIED (1)                   17950099
179600                                   TO TRUE                        17960099
179700                     PERFORM 5100-WRITE-TEMP-STORAGE              17970099
179800                     MOVE ASC-BLOCK-ENTRIES                       17980099
179900                               (PC-MAX-BLOCKS-IN-ARRAY)           17990099
180000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18000099
180100                     ADD +1        TO ASC-BLK-SUB                 18010099
180200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18020099
180300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18030099
180400                                   TO TRUE                        18040099
180500                 END-IF                                           18050099
180600             END-IF                                               18060099
180700             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18070099
180800             MOVE ASC-NUMBER-OF-ITEMS-READ                        18080099
180900                                   TO ASC-LIST-ITEM-NUMBER        18090099
181000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18100099
181100             MOVE FGTRST-FUNC-CDE-CNTL-NBR TO                     18110099
181200                  ASC-FG-CNTL (ASC-BLK-SUB ASC-ITEM-SUB)          18120099
181300             MOVE FGTRST-TRN-SET-CNTL-NBR TO                      18130099
181400                  ASC-TS-CNTL (ASC-BLK-SUB ASC-ITEM-SUB)          18140099
181500             MOVE TRNSET-TRAN-SET-CDE TO                          18150099
181600                  ASC-TRAN-SET (ASC-BLK-SUB ASC-ITEM-SUB)         18160099
181700             MOVE FGTRST-TRN-DTL-TXT TO                           18170099
181800                  ASC-DETAIL (ASC-BLK-SUB ASC-ITEM-SUB)           18180099
181900             MOVE PLNSHP-DONT-SHIP-BEF-DTE TO                     18190099
182000                  ASC-SHIP-DTE (ASC-BLK-SUB ASC-ITEM-SUB)         18200099
182100             MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO                    18210099
182200                  ASC-CANCEL-DTE (ASC-BLK-SUB ASC-ITEM-SUB)       18220099
182300             IF PV-NULL-DATE-IND < 0                              18230099
182400                PERFORM 4305-FIND-STATUS                          18240099
182500             ELSE                                                 18250099
182600                MOVE 'APP' TO                                     18260099
182700                  ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           18270099
182800             END-IF                                               18280099
182900             IF PV-NULL-DATE-IND < 0                              18290099
183000                  MOVE SPACES TO                                  18300099
183100                  ASC-TRN-RLSE-TMST (ASC-BLK-SUB ASC-ITEM-SUB)    18310099
183200             ELSE                                                 18320099
183300                  MOVE FGTRST-TRN-RLSE-TMST TO                    18330099
183400                  ASC-TRN-RLSE-TMST (ASC-BLK-SUB ASC-ITEM-SUB)    18340099
183500             END-IF                                               18350099
183600             MOVE FGTRST-FUNC-CDE-SEQ-NBR TO                      18360099
183700                  ASC-FUNC-CDE-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB) 18370099
183800             MOVE FGTRST-TRN-SET-SEQ-NBR TO                       18380099
183900                  ASC-TRN-SET-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)  18390099
184000             MOVE FGTRST-TRANSL-ERR-IND TO                        18400099
184100                  ASC-TRANSL-ERR-IND (ASC-BLK-SUB ASC-ITEM-SUB)   18410099
184200         END-IF                                                   18420099
184300     END-PERFORM.                                                 18430099
184400                                                                  18440099
184500*                                                                 18450099
184600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          18460099
184700         MOVE +1               TO ASC-BLK-SUB                     18470099
184800         PERFORM 5100-WRITE-TEMP-STORAGE                          18480099
184900         ADD +1                TO ASC-BLK-SUB                     18490099
185000         PERFORM 5100-WRITE-TEMP-STORAGE                          18500099
185100                                                                  18510099
185200     END-IF.                                                      18520099
185300 EJECT                                                            18530099
185400*----------------------------------------------------------------*18540099
185500*    FIND THE MOST RECENT STATUS CODE.                           *18550099
185600*----------------------------------------------------------------*18560099
185700                                                                  18570099
185800 4305-FIND-STATUS.                                                18580099
185900                                                                  18590099
186000     EXEC SQL                                                     18600099
186100          OPEN STATUS_CURSOR                                      18610099
186200     END-EXEC.                                                    18620099
186300                                                                  18630099
186400     EXEC SQL                                                     18640099
186500          FETCH STATUS_CURSOR                                     18650099
186600          INTO  :TNSTLC-TRN-STAT-CDE                              18660099
186700     END-EXEC.                                                    18670099
186800                                                                  18680099
186900     EVALUATE TRUE                                                18690099
187000        WHEN SQLCODE = ZERO                                       18700099
187100             EVALUATE TNSTLC-TRN-STAT-CDE                         18710099
187200                WHEN 1                                            18720099
187300                   MOVE 'RCY' TO                                  18730099
187400                      ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)       18740099
187500                WHEN 2                                            18750099
187600                   MOVE 'DRP' TO                                  18760099
187700                      ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)       18770099
187800                WHEN 3                                            18780099
187900                   MOVE 'BYP' TO                                  18790099
188000                      ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)       18800099
188100                WHEN 4                                            18810099
188200                   MOVE 'HLD' TO                                  18820099
188300                      ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)       18830099
188400                WHEN 5                                            18840099
188500                   MOVE 'DLT' TO                                  18850099
188600                      ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)       18860099
188700                WHEN 6                                            18870099
188800                   MOVE 'INV' TO                                  18880099
188900                      ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)       18890099
189000             END-EVALUATE                                         18900099
189100        WHEN SQLCODE = +100                                       18910099
189200             PERFORM 4307-GET-DIR-IND                             18920099
189300             IF INTTRN-DIR-IND = 'S'                              18930099
189400                MOVE 'SNT' TO                                     18940099
189500                   ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)          18950099
189600             ELSE                                                 18960099
189700                MOVE 'RCV' TO                                     18970099
189800                   ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)          18980099
189900             END-IF                                               18990099
190000        WHEN SQLCODE NOT EQUAL ZERO                               19000099
190100             MOVE '4305-FIND-STATUS' TO DP013-PARAGRAPH           19010099
190200             MOVE 'FETCH STATUS CURSOR'                           19020099
190300                               TO DP013-MESSAGE-TEXT (1)          19030099
190400             MOVE SQLCA        TO DP013-SQLCA                     19040099
190500             SET DP013-DB2-ABEND TO TRUE                          19050099
190600             PERFORM DP013-0000-PROCESS-ABEND                     19060099
190700     END-EVALUATE.                                                19070099
190800                                                                  19080099
190900     EXEC SQL                                                     19090099
191000          CLOSE STATUS_CURSOR                                     19100099
191100     END-EXEC.                                                    19110099
191200                                                                  19120099
191300*----------------------------------------------------------------*19130099
191400*    GET THE DIRECTION INDICATOR.                                *19140099
191500*----------------------------------------------------------------*19150099
191600 4307-GET-DIR-IND.                                                19160099
191700                                                                  19170099
191800      EXEC SQL                                                    19180099
191900           SELECT DIR_IND                                         19190099
192000           INTO  :INTTRN-DIR-IND                                  19200099
192100           FROM   TINTTRN                                         19210099
192200           WHERE  TP_DKEY =:ASC-TP-DKEY                           19220099
192300             AND  TP_DKEY_TMST =:ASC-TP-DKEY-TMST                 19230099
192400      END-EXEC.                                                   19240099
192500                                                                  19250099
192600      EVALUATE TRUE                                               19260099
192700         WHEN SQLCODE = ZERO                                      19270099
192800              CONTINUE                                            19280099
192900         WHEN SQLWARN0 NOT = SPACES                               19290099
193000         WHEN SQLCODE  NOT = ZERO                                 19300099
193100              MOVE '4307-GET-DIR-IND'                             19310099
193200                                TO DP013-PARAGRAPH                19320099
193300              MOVE 'READING TPLNSHP'                              19330099
193400                                TO DP013-MESSAGE-TEXT (1)         19340099
193500              MOVE SQLCA        TO DP013-SQLCA                    19350099
193600              SET DP013-DB2-ABEND                                 19360099
193700                  DP013-XCTL-DISPLAY-RESTART TO TRUE              19370099
193800              PERFORM DP013-0000-PROCESS-ABEND                    19380099
193900         END-EVALUATE.                                            19390099
194000                                                                  19400099
194100*----------------------------------------------------------------*19410099
194200*    FETCH THE MESSAGE CURSOR.                                   *19420099
194300*----------------------------------------------------------------*19430099
194400                                                                  19440099
194500 4310-FETCH.                                                      19450099
194600                                                                  19460099
194700     EXEC SQL                                                     19470099
194800          FETCH CURSOR_ONE                                        19480099
194900          INTO  :FGTRST-FUNC-CDE-SEQ-NBR                          19490099
195000              , :FGTRST-TRN-SET-SEQ-NBR                           19500099
195100              , :FGTRST-FUNC-CDE-CNTL-NBR                         19510099
195200              , :FGTRST-TRN-SET-CNTL-NBR                          19520099
195300              , :TRNSET-TRAN-SET-CDE                              19530099
195400              , :FGTRST-TRN-DTL-TXT                               19540099
195500              , :FGTRST-TRN-RLSE-TMST :PV-NULL-DATE-IND           19550099
195600              , :FGTRST-TRANSL-ERR-IND                            19560099
195700     END-EXEC.                                                    19570099
195800                                                                  19580099
195900     EVALUATE TRUE                                                19590099
196000         WHEN SQLCODE = ZERO                                      19600099
196100         WHEN SQLCODE = +100                                      19610099
196200              CONTINUE                                            19620099
196300         WHEN SQLWARN0 NOT = SPACE                                19630099
196400         WHEN SQLCODE NOT = ZERO                                  19640099
196500              MOVE '4310-FETCH-CURSOR'                            19650099
196600                               TO DP013-PARAGRAPH                 19660099
196700              MOVE 'FETCH MESSAGE CURSOR'                         19670099
196800                               TO DP013-MESSAGE-TEXT (1)          19680099
196900              MOVE SQLCA       TO DP013-SQLCA                     19690099
197000              SET DP013-DB2-ABEND                                 19700099
197100                               TO TRUE                            19710099
197200              PERFORM DP013-0000-PROCESS-ABEND                    19720099
197300     END-EVALUATE.                                                19730099
197400                                                                  19740099
197500     IF  SQLCODE EQUAL +100                                       19750099
197600         SET ASC-NO-ITEMS-LEFT-ON-DB                              19760099
197700                                   TO TRUE                        19770099
197800     END-IF.                                                      19780099
197900                                                                  19790099
198000 EJECT                                                            19800099
198100*----------------------------------------------------------------*19810099
198200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *19820099
198300*----------------------------------------------------------------*19830099
198400                                                                  19840099
198500 4400-MOVE-COMMAREA-TO-SCREEN.                                    19850099
198600                                                                  19860099
198700     MOVE ASC-VENDOR-NAME TO AVEND01O.                            19870099
198800                                                                  19880099
198900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             19890099
199000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          19900099
199100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          19910099
199200             MOVE +1    TO ASC-BLK-SUB                            19920099
199300             PERFORM 5100-WRITE-TEMP-STORAGE                      19930099
199400             ADD +1     TO ASC-BLK-SUB                            19940099
199500             PERFORM 5100-WRITE-TEMP-STORAGE                      19950099
199600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             19960099
199700                 GIVING PV-BLOCK-NUMBER                           19970099
199800                 REMAINDER PV-REMAINDER                           19980099
199900             IF  PV-REMAINDER > ZERO                              19990099
200000                 ADD +1 TO PV-BLOCK-NUMBER                        20000099
200100             END-IF                                               20010099
200200             MOVE +1    TO ASC-BLK-SUB                            20020099
200300             PERFORM 4410-READ-TEMP-STORAGE                       20030099
200400             ADD +1     TO ASC-BLK-SUB                            20040099
200500                           PV-BLOCK-NUMBER                        20050099
200600             PERFORM 4410-READ-TEMP-STORAGE                       20060099
200700     END-IF.                                                      20070099
200800     MOVE +1            TO ASC-BLK-SUB.                           20080099
200900     COMPUTE ASC-ITEM-SUB =                                       20090099
201000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              20100099
201100         + PC-ITEMS-PER-PANEL).                                   20110099
201200*                                                                 20120099
201300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        20130099
201400         ADD +1         TO ASC-BLK-SUB                            20140099
201500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            20150099
201600     END-IF.                                                      20160099
201700*                                                                 20170099
201800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           20180099
201900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                20190099
202000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        20200099
202100     PERFORM 4420-FORMAT-LIST-LINES                               20210099
202200         VARYING PV-SUB                                           20220099
202300         FROM PC-ITEMS-PER-PANEL BY -1                            20230099
202400         UNTIL PV-SUB < +1.                                       20240099
202500*                                                                 20250099
202600     COMPUTE ASC-ITEMS-DISPLAYED =                                20260099
202700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          20270099
202800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    20280099
202900                                      ASTRTITO.                   20290099
203000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    20300099
203100     IF  ASC-NO-ITEMS-LEFT-ON-DB                                  20310099
203200         MOVE ASC-NUMBER-OF-ITEMS-READ                            20320099
203300                                   TO ATOTITO                     20330099
203400     END-IF.                                                      20340099
203500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20350099
203600                                   TO ASELITO.                    20360099
203700*                                                                 20370099
203800     IF  DP020-MSG-NUMBER-X = SPACE                               20380099
203900         IF  (ASC-ITEMS-LEFT-ON-DB)                               20390099
204000           OR  (ASC-ITEM-AT-BOT-OF-PANEL                          20400099
204100                              < ASC-NUMBER-OF-ITEMS-READ)         20410099
204200*            --- MORE ITEMS TO DISPLAY ----                       20420099
204300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            20430099
204400             SET DP020-MSG-INFORMATIONAL TO TRUE                  20440099
204500         ELSE                                                     20450099
204600             IF  ASC-ITEM-AT-BOT-OF-PANEL =                       20460099
204700                                        ASC-NUMBER-OF-ITEMS-READ  20470099
204800*                --- BOTTOM OF LIST ----                          20480099
204900                 MOVE PC-TSYMSG-00070                             20490099
205000                                   TO DP020-MSG-NUMBER            20500099
205100                 SET DP020-MSG-INFORMATIONAL TO TRUE              20510099
205200             END-IF                                               20520099
205300         END-IF                                                   20530099
205400     END-IF.                                                      20540099
205500*----------------------------------------------------------------*20550099
205600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *20560099
205700*----------------------------------------------------------------*20570099
205800                                                                  20580099
205900 4410-READ-TEMP-STORAGE.                                          20590099
206000                                                                  20600099
206100     EXEC CICS                                                    20610099
206200         READQ TS                                                 20620099
206300             QUEUE (ASC-LIST-QUEUE-NAME)                          20630099
206400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20640099
206500             ITEM  (PV-BLOCK-NUMBER)                              20650099
206600             RESP  (PV-CICS-RESP)                                 20660099
206700     END-EXEC.                                                    20670099
206800                                                                  20680099
206900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       20690099
207000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20700099
207100         CONTINUE                                                 20710099
207200     ELSE                                                         20720099
207300         SET DP013-CICS-ABEND     TO TRUE                         20730099
207400         SET DP013-NO-ROLLBACK    TO TRUE                         20740099
207500         MOVE '4410-READ-TEMP-STORAGE'                            20750099
207600                                  TO DP013-PARAGRAPH              20760099
207700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20770099
207800                                  TO DP013-MESSAGE-TEXT(1)        20780099
207900         PERFORM DP013-0000-PROCESS-ABEND                         20790099
208000     END-IF.                                                      20800099
208100                                                                  20810099
208200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20820099
208300*                                                                 20830099
208400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20840099
208500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20850099
208600     END-IF.                                                      20860099
208700 EJECT                                                            20870099
208800*----------------------------------------------------------------*20880099
208900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *20890099
209000*----------------------------------------------------------------*20900099
209100                                                                  20910099
209200 4420-FORMAT-LIST-LINES.                                          20920099
209300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      20930099
209400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20940099
209500         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           20950099
209600         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           20960099
209700         MOVE SPACE              TO MR-SELECTI (PV-SUB)           20970099
209800                                    MR-ACTION (PV-SUB)            20980099
209900                                    MR-FG-CNTL-NUM (PV-SUB)       20990099
210000                                    MR-TS-CNTL-NUM (PV-SUB)       21000099
210100                                    MR-TRAN-SET (PV-SUB)          21010099
210200                                    MR-DETAIL (PV-SUB)            21020099
210300                                    MR-SHIP-DTE (PV-SUB)          21030099
210400                                    MR-CANCEL-DTE (PV-SUB)        21040099
210500                                    MR-STATUS (PV-SUB)            21050099
210600     ELSE                                                         21060099
210700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21070099
210800                                                   > SPACE        21080099
210900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21090099
211000                                 TO MR-SELECTI (PV-SUB)           21100099
211100         ELSE                                                     21110099
211200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21120099
211300                                 TO MR-SELECTI (PV-SUB)           21130099
211400         END-IF                                                   21140099
211500*                                                                 21150099
211600         IF  DP030-SET-CURSOR-TRAILER                             21160099
211700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)21170099
211800                 > SPACE)                                         21180099
211900               OR (PV-SUB = 1))                                   21190099
212000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               21200099
212100                MOVE -1          TO MR-SELECTL (PV-SUB)           21210099
212200             END-IF                                               21220099
212300         END-IF                                                   21230099
212400*                                                                 21240099
212500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           21250099
212600             STRING ' '                                           21260099
212700                  ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           21270099
212800                               DELIMITED BY SIZE                  21280099
212900                               INTO MR-ACTION (PV-SUB)            21290099
213000             MOVE ASC-FG-CNTL (ASC-BLK-SUB ASC-ITEM-SUB)          21300099
213100                  TO MR-FG-CNTL-NUM (PV-SUB)                      21310099
213200             MOVE ASC-TS-CNTL (ASC-BLK-SUB ASC-ITEM-SUB)          21320099
213300                  TO MR-TS-CNTL-NUM (PV-SUB)                      21330099
213400             MOVE ASC-TRAN-SET (ASC-BLK-SUB ASC-ITEM-SUB)         21340099
213500                  TO MR-TRAN-SET (PV-SUB)                         21350099
213600             MOVE ASC-DETAIL (ASC-BLK-SUB ASC-ITEM-SUB)           21360099
213700                  TO MR-DETAIL (PV-SUB)                           21370099
213800             MOVE ASC-SHIP-DTE (ASC-BLK-SUB ASC-ITEM-SUB)         21380099
213900                  TO MR-SHIP-DTE (PV-SUB)                         21390099
214000             MOVE ASC-CANCEL-DTE (ASC-BLK-SUB ASC-ITEM-SUB)       21400099
214100                  TO MR-CANCEL-DTE (PV-SUB)                       21410099
214200             MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           21420099
214300                  TO MR-STATUS (PV-SUB)                           21430099
214400         END-IF                                                   21440099
214500     END-IF.                                                      21450099
214600     SUBTRACT +1 FROM ASC-ITEM-SUB                                21460099
214700     IF  ASC-ITEM-SUB < + 1                                       21470099
214800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  21480099
214900         MOVE +1                 TO ASC-BLK-SUB                   21490099
215000     END-IF.                                                      21500099
215100******************************************************************21510099
215200** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **21520099
215300** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **21530099
215400** ISSUE A WARNING.                                             **21540099
215500******************************************************************21550099
215600 4430-CHECK-FOR-BEGIN-AND-END.                                    21560099
215700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21570099
215800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21580099
215900*            -- NO END-OF-RANGE SPECFIED ---                      21590099
216000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21600099
216100             SET DP020-MSG-WARNING TO TRUE                        21610099
216200             PERFORM 4431-POSITION-AT-WARNING                     21620099
216300         END-IF                                                   21630099
216400     ELSE                                                         21640099
216500         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21650099
216600*            -- NO BEGINNING-OF-RANGE SPECFIED ---                21660099
216700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21670099
216800             SET DP020-MSG-WARNING TO TRUE                        21680099
216900             PERFORM 4431-POSITION-AT-WARNING                     21690099
217000         END-IF                                                   21700099
217100     END-IF.                                                      21710099
217200******************************************************************21720099
217300** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **21730099
217400** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **21740099
217500** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **21750099
217600** POSITION THE CURSOR THERE.                                   **21760099
217700******************************************************************21770099
217800 4431-POSITION-AT-WARNING.                                        21780099
217900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 21790099
218000                    - PV-TOP-ITEM + 1.                            21800099
218100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21810099
218200         CONTINUE                                                 21820099
218300     ELSE                                                         21830099
218400         SET DP030-SET-CURSOR-APPL-1                              21840099
218500                                   TO TRUE                        21850099
218600         MOVE -1                   TO MR-SELECTL (PV-SUB)         21860099
218700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21870099
218800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21880099
218900     END-IF.                                                      21890099
219000*                                                                 21900099
219100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21910099
219200                    - PV-TOP-ITEM + 1.                            21920099
219300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21930099
219400         CONTINUE                                                 21940099
219500     ELSE                                                         21950099
219600         SET DP030-SET-CURSOR-APPL-1                              21960099
219700                                   TO TRUE                        21970099
219800         MOVE -1                   TO MR-SELECTL (PV-SUB)         21980099
219900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21990099
220000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22000099
220100     END-IF.                                                      22010099
220200 EJECT                                                            22020099
220300                                                                  22030099
220400 4500-PROCESS-PO.                                                 22040099
220500******************************************************************22050099
220600*  CONVERT THE PO FROM CHARACTER TO INT TO ALLOW FOR COMPARE      22060099
220700*  AGAINST TPLNSHP TABLE                                          22070099
220800******************************************************************22080099
220900       MOVE FGTRST-TRN-DTL-TXT (1:15) TO DP010I-UNEDITED-FIELD.   22090099
221000       MOVE +15                       TO DP010I-MAXIMUM-DIGITS.   22100099
221100       MOVE +0                        TO DP010I-MAXIMUM-DECIMALS. 22110099
221200                                                                  22120099
221300       SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                   22130099
221400                                                                  22140099
082510       CALL DP010I-NUMERIC-EDIT-ROUTINE                           22151099
082520                       USING DP010I-NUMERIC-EDIT-AREA.            22152099
221600                                                                  22160099
221700       IF DP010I-ERROR-DETECTED                                   22170099
221800           MOVE +0 TO PV-PO-NBR                                   22180099
221900       ELSE                                                       22190099
222000           MOVE DP010I-NUM-FIELD-15-DIG-2-DEC TO PV-PO-NBR        22200099
222100       END-IF.                                                    22210099
222200       IF TRNSET-TRAN-SET-CDE = '850'                             22220099
222300          PERFORM 4510-SELECT-SHIP-CANCEL.                        22230099
222400                                                                  22240099
222500 4510-SELECT-SHIP-CANCEL.                                         22250099
222600******************************************************************22260099
222700*  RETRIEVE THE SHIP AND CANCEL DATES FROM THE TPLNSHP TABLE      22270099
222800******************************************************************22280099
222900                                                                  22290099
223000     SET PS-PO-FOUND TO TRUE.                                     22300099
223100                                                                  22310099
223200     PERFORM 4520-SELECT-SHIP-CANCEL-DKEY.                        22320099
223300                                                                  22330099
223400                                                                  22340099
223500 4520-SELECT-SHIP-CANCEL-DKEY.                                    22350099
223600                                                                  22360099
223700         EXEC SQL                                                 22370099
223800               SELECT DONT_SHIP_BEF_DTE                           22380099
223900                     ,CAN_IFNOT_SHIP_DTE                          22390099
224000                 INTO :PLNSHP-DONT-SHIP-BEF-DTE                   22400099
224100                     ,:PLNSHP-CAN-IFNOT-SHIP-DTE                  22410099
224200                 FROM TPLNSHP                                     22420099
224300                WHERE PO_NBR         = :PV-PO-NBR AND             22430099
224400                      VER_STATUS_CDE = 'A'                        22440099
224500         END-EXEC                                                 22450099
224600                                                                  22460099
224700         EVALUATE TRUE                                            22470099
224800             WHEN SQLCODE = ZERO                                  22480099
224900                 CONTINUE                                         22490099
225000             WHEN SQLCODE = +100                                  22500099
225100                 MOVE SPACES TO PLNSHP-DONT-SHIP-BEF-DTE          22510099
225200                 MOVE SPACES TO PLNSHP-CAN-IFNOT-SHIP-DTE         22520099
225300                 CONTINUE                                         22530099
225400             WHEN SQLWARN0 NOT = SPACES                           22540099
225500             WHEN SQLCODE  NOT = ZERO                             22550099
225600                 MOVE '4520-SELECT-SHIP-CANCEL-DKEY'              22560099
225700                                   TO DP013-PARAGRAPH             22570099
225800                 MOVE 'READING TPLNSHP'                           22580099
225900                                   TO DP013-MESSAGE-TEXT (1)      22590099
226000                 MOVE SQLCA        TO DP013-SQLCA                 22600099
226100                 SET DP013-DB2-ABEND                              22610099
226200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           22620099
226300                 PERFORM DP013-0000-PROCESS-ABEND                 22630099
226400         END-EVALUATE.                                            22640099
226500                                                                  22650099
226600*----------------------------------------------------------------*22660099
226700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *22670099
226800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *22680099
226900* FOR THE SELECTED ITEMS QUEUE.                                  *22690099
227000*                                                                *22700099
227100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *22710099
227200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *22720099
227300* THE ARRAY IS FULL.                                             *22730099
227400*----------------------------------------------------------------*22740099
227500                                                                  22750099
227600 5000-PREPARE-SEL-QUEUE.                                          22760099
227700                                                                  22770099
227800     MOVE +1                   TO  ASC-BLK-SUB.                   22780099
227900     PERFORM 5100-WRITE-TEMP-STORAGE.                             22790099
228000     ADD +1                    TO  ASC-BLK-SUB.                   22800099
228100     PERFORM 5100-WRITE-TEMP-STORAGE.                             22810099
228200                                                                  22820099
228300     MOVE ASC-SEL-QUEUE-NAME   TO  ET307-SEL-QUEUE-NAME.          22830099
228400     PERFORM 6010-DELETE-SEL-QUEUE.                               22840099
228500                                                                  22850099
228600     SET ASC-UPDATE-TSQ        TO  TRUE.                          22860099
228700                                                                  22870099
228800     SET ET309-IDX TO 1.                                          22880099
228900     MOVE ZERO                 TO ET307-NUMBER-OF-TS-ITEMS.       22890099
229000     INITIALIZE ET309-SELECTED-ITEM-ARRAY.                        22900099
229100                                                                  22910099
229200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           22920099
229300             VARYING PV-ITEM                                      22930099
229400             FROM 1 BY 1                                          22940099
229500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     22950099
229600                                                                  22960099
229700     IF  ET309-IDX > 1                                            22970099
229800         PERFORM 5205-WRITE-SEL-QUEUE                             22980099
229900         ADD +1                TO ET307-NUMBER-OF-TS-ITEMS        22990099
230000     END-IF.                                                      23000099
230100 EJECT                                                            23010099
230200*----------------------------------------------------------------*23020099
230300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23030099
230400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23040099
230500*----------------------------------------------------------------*23050099
230600                                                                  23060099
230700 5100-WRITE-TEMP-STORAGE.                                         23070099
230800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23080099
230900                                   TO PV-LIST-ITEM-NUMBER.        23090099
231000     COMPUTE PV-BLOCK-NUMBER =                                    23100099
231100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23110099
231200                                                                  23120099
231300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23130099
231400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23140099
231500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23150099
231600             PERFORM 5105-REWRITE-ASC-LISTQ                       23160099
231700         END-IF                                                   23170099
231800     ELSE                                                         23180099
231900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23190099
232000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23200099
232100         PERFORM 5110-WRITE-ASC-LISTQ                             23210099
232200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23220099
232300     END-IF.                                                      23230099
232400                                                                  23240099
232500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23250099
232600******************************************************************23260099
232700** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **23270099
232800** SPECIFIC COMMAREA.                                           **23280099
232900******************************************************************23290099
233000 5105-REWRITE-ASC-LISTQ.                                          23300099
233100     EXEC CICS                                                    23310099
233200         WRITEQ TS                                                23320099
233300             QUEUE (ASC-LIST-QUEUE-NAME)                          23330099
233400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23340099
233500             ITEM  (PV-BLOCK-NUMBER)                              23350099
233600             REWRITE                                              23360099
233700             RESP  (PV-CICS-RESP)                                 23370099
233800     END-EXEC.                                                    23380099
233900                                                                  23390099
234000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           23400099
234100         CONTINUE                                                 23410099
234200     ELSE                                                         23420099
234300         SET DP013-CICS-ABEND            TO TRUE                  23430099
234400         SET DP013-NO-ROLLBACK           TO TRUE                  23440099
234500         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       23450099
234600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     23460099
234700                                         TO DP013-MESSAGE-TEXT(1) 23470099
234800         PERFORM DP013-0000-PROCESS-ABEND                         23480099
234900     END-IF.                                                      23490099
235000                                                                  23500099
235100******************************************************************23510099
235200** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **23520099
235300** SPECIFIC COMMAREA.                                           **23530099
235400******************************************************************23540099
235500 5110-WRITE-ASC-LISTQ.                                            23550099
235600     EXEC CICS                                                    23560099
235700         WRITEQ TS                                                23570099
235800             QUEUE (ASC-LIST-QUEUE-NAME)                          23580099
235900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23590099
236000             ITEM  (PV-BLOCK-NUMBER)                              23600099
236100             RESP  (PV-CICS-RESP)                                 23610099
236200     END-EXEC.                                                    23620099
236300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      23630099
236400         SET DP013-CICS-ABEND      TO TRUE                        23640099
236500         SET DP013-NO-ROLLBACK     TO TRUE                        23650099
236600         MOVE '5110-WRITE-ASC-LISTQ'                              23660099
236700                                   TO DP013-PARAGRAPH             23670099
236800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           23680099
236900                                   TO DP013-MESSAGE-TEXT(1)       23690099
237000         PERFORM DP013-0000-PROCESS-ABEND                         23700099
237100     END-IF.                                                      23710099
237200 EJECT                                                            23720099
237300*----------------------------------------------------------------*23730099
237400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *23740099
237500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *23750099
237600*----------------------------------------------------------------*23760099
237700                                                                  23770099
237800 5200-FILL-SEL-QUEUE-RECORD.                                      23780099
237900                                                                  23790099
238000     PERFORM 6112-READ-LIST-QUEUE.                                23800099
238100                                                                  23810099
238200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       23820099
238300         PERFORM                                                  23830099
238400         VARYING LQW-IDX                                          23840099
238500         FROM 1 BY 1                                              23850099
238600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            23860099
238700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          23870099
238800                                                                  23880099
238900             IF  LQW-SELECT (LQW-IDX)                             23890099
239000                 MOVE ASC-VENDOR-NAME TO                          23900099
239100                      ET309-VENDOR-NAME                           23910099
239200                 MOVE LQW-FG-CNTL (LQW-IDX) TO                    23920099
239300                      ET309-FG-CONTROL-NUMBER (ET309-IDX)         23930099
239400                 MOVE LQW-TS-CNTL (LQW-IDX) TO                    23940099
239500                      ET309-TS-CONTROL-NUMBER (ET309-IDX)         23950099
239600                 MOVE LQW-TRAN-SET (LQW-IDX) TO                   23960099
239700                      ET309-TRAN-SET (ET309-IDX)                  23970099
239800                 MOVE LQW-DETAIL (LQW-IDX) TO                     23980099
239900                      ET309-DETAIL (ET309-IDX)                    23990099
240000                 MOVE LQW-TRN-RLSE-TMST (LQW-IDX) TO              24000099
240100                      ET309-TRN-RLSE-TMST (ET309-IDX)             24010099
240200                 MOVE ASC-TP-DKEY TO                              24020099
240300                      ET309-TP-DKEY (ET309-IDX)                   24030099
240400                 MOVE ASC-TP-DKEY-TMST TO                         24040099
240500                      ET309-TP-DKEY-TMST (ET309-IDX)              24050099
240600                 MOVE LQW-FUNC-CDE-SEQ-NBR (LQW-IDX) TO           24060099
240700                      ET309-FUNC-CDE-SEQ-NBR (ET309-IDX)          24070099
240800                 MOVE LQW-TRN-SET-SEQ-NBR (LQW-IDX) TO            24080099
240900                      ET309-TRN-SET-SEQ-NBR (ET309-IDX)           24090099
241000                 MOVE LQW-TRANSL-ERR-IND (LQW-IDX) TO             24100099
241100                      ET309-TRANSL-ERR-IND (ET309-IDX)            24110099
241200                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              24120099
241300                                   TO ET309-ITEM (ET309-IDX)      24130099
241400                 MOVE SPACE        TO ET309-ACTION-SW (ET309-IDX) 24140099
241500                 SET ET309-IDX UP BY 1                            24150099
241600                 IF  ET309-IDX > ET309-MAX-ITEMS                  24160099
241700                     PERFORM 5205-WRITE-SEL-QUEUE                 24170099
241800                     ADD +1        TO ET307-NUMBER-OF-TS-ITEMS    24180099
241900                     INITIALIZE ET309-SELECTED-ITEM-ARRAY         24190099
242000                     SET ET309-IDX TO 1                           24200099
242100                 END-IF                                           24210099
242200             END-IF                                               24220099
242300         END-PERFORM                                              24230099
242400     END-IF.                                                      24240099
242500                                                                  24250099
242600*----------------------------------------------------------------*24260099
242700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *24270099
242800*----------------------------------------------------------------*24280099
242900                                                                  24290099
243000 5205-WRITE-SEL-QUEUE.                                            24300099
243100                                                                  24310099
243200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24320099
243300                                   TO ET309-SELECTED-ITEMS.       24330099
243400                                                                  24340099
243500     EXEC CICS                                                    24350099
243600          WRITEQ TS                                               24360099
243700              QUEUE (ASC-SEL-QUEUE-NAME)                          24370099
243800              FROM  (ET309-INTER-APPL-COMMAREA)                   24380099
243900              ITEM  (PV-SEL-QUEUE-ITEM)                           24390099
244000              RESP  (PV-CICS-RESP)                                24400099
244100     END-EXEC.                                                    24410099
244200                                                                  24420099
244300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24430099
244400         CONTINUE                                                 24440099
244500     ELSE                                                         24450099
244600         SET DP013-CICS-ABEND      TO TRUE                        24460099
244700         SET DP013-NO-ROLLBACK     TO TRUE                        24470099
244800         MOVE '5205-WRITE-SEL-QUEUE'                              24480099
244900                                   TO DP013-PARAGRAPH             24490099
245000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          24500099
245100                                   TO DP013-MESSAGE-TEXT(1)       24510099
245200         PERFORM DP013-0000-PROCESS-ABEND                         24520099
245300     END-IF.                                                      24530099
245400 EJECT                                                            24540099
245500******************************************************************24550099
245600** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **24560099
245700** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **24570099
245800** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **24580099
245900** THE USER.                                                    **24590099
246000******************************************************************24600099
246100 6000-REFRESH-PANEL-FROM-TEMP.                                    24610099
246200     IF  ASC-UPDATE-TSQ                                           24620099
246300         SET ASC-NO-TSQ-UPDATE TO TRUE                            24630099
246400         MOVE ZERO                 TO PV-SAVE-ITEM                24640099
246500                                      PV-SEL-QUEUE-ITEM           24650099
246600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        24660099
246700                                   TO PV-HOLD-SELECTED-ITEMS      24670099
246800         MOVE +1                   TO PV-ITEMS-PROCESSED          24680099
246900         PERFORM 6100-UPDATE-TSQ                                  24690099
247000             UNTIL PV-ITEMS-PROCESSED >                           24700099
247100                                     PV-HOLD-SELECTED-ITEMS       24710099
247200         PERFORM 6010-DELETE-SEL-QUEUE                            24720099
247300     END-IF.                                                      24730099
247400                                                                  24740099
247500*----------------------------------------------------------------*24750099
247600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *24760099
247700*----------------------------------------------------------------*24770099
247800 6010-DELETE-SEL-QUEUE.                                           24780099
247900                                                                  24790099
248000     EXEC CICS                                                    24800099
248100         DELETEQ TS                                               24810099
248200             QUEUE (ASC-SEL-QUEUE-NAME)                           24820099
248300             RESP  (PV-CICS-RESP)                                 24830099
248400     END-EXEC.                                                    24840099
248500*                                                                 24850099
248600     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      24860099
248700        (PV-CICS-RESP = DFHRESP(QIDERR)))                         24870099
248800         CONTINUE                                                 24880099
248900     ELSE                                                         24890099
249000         SET DP013-CICS-ABEND TO TRUE                             24900099
249100         SET DP013-NO-ROLLBACK TO TRUE                            24910099
249200         MOVE '6010-DELETE-SEL-QUEUE'                             24920099
249300                        TO DP013-PARAGRAPH                        24930099
249400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         24940099
249500                        TO DP013-MESSAGE-TEXT (1)                 24950099
249600         PERFORM DP013-0000-PROCESS-ABEND                         24960099
249700     END-IF.                                                      24970099
249800                                                                  24980099
249900*----------------------------------------------------------------*24990099
250000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *25000099
250100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *25010099
250200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *25020099
250300*    THE TEMP QUEUE.                                             *25030099
250400*----------------------------------------------------------------*25040099
250500                                                                  25050099
250600 6100-UPDATE-TSQ.                                                 25060099
250700                                                                  25070099
250800     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             25080099
250900     PERFORM 6105-READ-SEL-QUEUE.                                 25090099
251000     PERFORM                                                      25100099
251100         VARYING ET309-IDX                                        25110099
251200         FROM 1 BY 1                                              25120099
251300         UNTIL ((PV-ITEMS-PROCESSED >                             25130099
251400                              PV-HOLD-SELECTED-ITEMS)             25140099
251500         OR (ET309-IDX GREATER THAN ET309-MAX-ITEMS))             25150099
251600         IF  ET309-ACTION-SW (ET309-IDX) > SPACE                  25160099
251700             PERFORM 6110-PROCESS-ITEMS                           25170099
251800         END-IF                                                   25180099
251900         ADD +1                TO PV-ITEMS-PROCESSED              25190099
252000     END-PERFORM.                                                 25200099
252100     PERFORM 6111-WRITE-LIST-QUEUE.                               25210099
252200*----------------------------------------------------------------*25220099
252300*    READ THE LIST QUEUE RECORD.                                 *25230099
252400*----------------------------------------------------------------*25240099
252500                                                                  25250099
252600 6105-READ-SEL-QUEUE.                                             25260099
252700                                                                  25270099
252800     EXEC CICS                                                    25280099
252900          READQ TS                                                25290099
253000              QUEUE (ASC-SEL-QUEUE-NAME)                          25300099
253100              INTO  (ET309-INTER-APPL-COMMAREA)                   25310099
253200              ITEM  (PV-SEL-QUEUE-ITEM)                           25320099
253300              RESP  (PV-CICS-RESP)                                25330099
253400     END-EXEC.                                                    25340099
253500                                                                  25350099
253600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25360099
253700         CONTINUE                                                 25370099
253800     ELSE                                                         25380099
253900         SET DP013-CICS-ABEND      TO  TRUE                       25390099
254000         SET DP013-NO-ROLLBACK     TO  TRUE                       25400099
254100         MOVE '6105-READ-SEL-QUEUE'                               25410099
254200                                   TO  DP013-PARAGRAPH            25420099
254300         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           25430099
254400                                   TO  DP013-MESSAGE-TEXT(1)      25440099
254500         PERFORM DP013-0000-PROCESS-ABEND                         25450099
254600     END-IF.                                                      25460099
254700 EJECT                                                            25470099
254800*----------------------------------------------------------------*25480099
254900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*25490099
255000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*25500099
255100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *25510099
255200*----------------------------------------------------------------*25520099
255300                                                                  25530099
255400 6110-PROCESS-ITEMS.                                              25540099
255500                                                                  25550099
255600     COMPUTE PV-ITEM = 1 + ((ET309-ITEM (ET309-IDX) - 1)          25560099
255700                     / PC-ITEMS-PER-PANEL).                       25570099
255800                                                                  25580099
255900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           25590099
256000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          25600099
256100             PERFORM 6111-WRITE-LIST-QUEUE                        25610099
256200         END-IF                                                   25620099
256300         MOVE PV-ITEM          TO PV-SAVE-ITEM                    25630099
256400                                                                  25640099
256500         PERFORM 6112-READ-LIST-QUEUE                             25650099
256600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               25660099
256700             CONTINUE                                             25670099
256800         END-IF                                                   25680099
256900     END-IF.                                                      25690099
257000                                                                  25700099
257100     COMPUTE PV-SUB = (ET309-ITEM (ET309-IDX)                     25710099
257200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              25720099
257300     SET LQW-DESELECT (PV-SUB) TO    TRUE                         25730099
257400     MOVE LQW-SELECTED-SW (PV-SUB)                                25740099
257500                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  25750099
257600     EVALUATE TRUE                                                25760099
257700         WHEN ET309-INQ (ET309-IDX)                               25770099
257800              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             25780099
257900                                                                  25790099
258000         WHEN ET309-UPD (ET309-IDX)                               25800099
258100              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             25810099
258200                                                                  25820099
258300         WHEN ET309-DEL (ET309-IDX)                               25830099
258400              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             25840099
258500                                                                  25850099
258600         WHEN ET309-ERR (ET309-IDX)                               25860099
258700              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             25870099
258800     END-EVALUATE.                                                25880099
258900                                                                  25890099
259000     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                25900099
259100                                                                  25910099
259200*----------------------------------------------------------------*25920099
259300*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *25930099
259400*----------------------------------------------------------------*25940099
259500                                                                  25950099
259600 6111-WRITE-LIST-QUEUE.                                           25960099
259700                                                                  25970099
259800     EXEC CICS                                                    25980099
259900         WRITEQ TS                                                25990099
260000             QUEUE (ASC-LIST-QUEUE-NAME)                          26000099
260100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     26010099
260200             ITEM  (PV-SAVE-ITEM)                                 26020099
260300             REWRITE                                              26030099
260400             RESP  (PV-CICS-RESP)                                 26040099
260500     END-EXEC.                                                    26050099
260600*                                                                 26060099
260700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26070099
260800         CONTINUE                                                 26080099
260900     ELSE                                                         26090099
261000         SET DP013-CICS-ABEND  TO  TRUE                           26100099
261100         SET DP013-NO-ROLLBACK TO  TRUE                           26110099
261200         MOVE '6111-WRITE-LIST-QUEUE'                             26120099
261300                               TO  DP013-PARAGRAPH                26130099
261400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  26140099
261500                               TO  DP013-MESSAGE-TEXT(1)          26150099
261600         PERFORM DP013-0000-PROCESS-ABEND                         26160099
261700     END-IF.                                                      26170099
261800                                                                  26180099
261900     IF LQW-LIST-ITEM-NUMBER (1) = ASC-LIST-ITEM-NUMBER (1 1)     26190099
262000         MOVE LQW-LIST-QUEUE-WORK-AREA TO ASC-BLOCK-ENTRIES (1)   26200099
262100     ELSE                                                         26210099
262200         MOVE LQW-LIST-QUEUE-WORK-AREA TO ASC-BLOCK-ENTRIES (2)   26220099
262300     END-IF.                                                      26230099
262400 EJECT                                                            26240099
262500*----------------------------------------------------------------*26250099
262600*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*26260099
262700*----------------------------------------------------------------*26270099
262800                                                                  26280099
262900 6112-READ-LIST-QUEUE.                                            26290099
263000                                                                  26300099
263100     EXEC CICS                                                    26310099
263200         READQ TS                                                 26320099
263300             QUEUE (ASC-LIST-QUEUE-NAME)                          26330099
263400             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     26340099
263500             ITEM  (PV-ITEM)                                      26350099
263600             RESP  (PV-CICS-RESP)                                 26360099
263700     END-EXEC.                                                    26370099
263800*                                                                 26380099
263900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26390099
264000         CONTINUE                                                 26400099
264100     ELSE                                                         26410099
264200         SET DP013-CICS-ABEND        TO TRUE                      26420099
264300         SET DP013-NO-ROLLBACK       TO TRUE                      26430099
264400         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           26440099
264500         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    26450099
264600                                     TO DP013-MESSAGE-TEXT(1)     26460099
264700         PERFORM DP013-0000-PROCESS-ABEND                         26470099
264800     END-IF.                                                      26480099
264900                                                                  26490099
265000 9100-READ-TSQB-QUEUE.                                            26500099
265100     EXEC CICS                                                    26510099
265200         READQ TS                                                 26520099
265300             QUEUE (ASC-TSQB-NAME)                                26530099
265400             INTO  (ET308-SELECTED-VNDRS)                         26540099
265500             ITEM  (ASC-SEL-ITEM)                                 26550099
265600             RESP  (PV-CICS-RESP)                                 26560099
265700     END-EXEC.                                                    26570099
265800                                                                  26580099
265900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26590099
266000         CONTINUE                                                 26600099
266100     ELSE                                                         26610099
266200         SET DP013-LOGIC-ABEND                                    26620099
266300             DP013-NO-ROLLBACK     TO TRUE                        26630099
266400         MOVE '9100-READ-TSQB-QUEUE'                              26640099
266500                                   TO DP013-PARAGRAPH             26650099
266600         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   26660099
266700                                   TO DP013-MESSAGE-TEXT (1)      26670099
266800         PERFORM DP013-0000-PROCESS-ABEND                         26680099
266900     END-IF.                                                      26690099
267000*                                                                 26700099
267100******************************************************************26710099
267200* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *26720099
267300******************************************************************26730099
267400 9200-REWRITE-TSQB-QUEUE.                                         26740099
267500     EXEC CICS                                                    26750099
267600          WRITEQ TS                                               26760099
267700              QUEUE  (ASC-TSQB-NAME)                              26770099
267800              FROM   (ET308-SELECTED-VNDRS)                       26780099
267900              ITEM   (ASC-SEL-ITEM)                               26790099
268000              RESP   (PV-CICS-RESP)                               26800099
268100              REWRITE                                             26810099
268200     END-EXEC.                                                    26820099
268300                                                                  26830099
268400     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   26840099
268500         SET DP013-CICS-ABEND                                     26850099
268600             DP013-NO-ROLLBACK     TO TRUE                        26860099
268700         MOVE '9200-REWRITE-TSQB-QUEUE'                           26870099
268800                                   TO DP013-PARAGRAPH             26880099
268900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   26890099
269000                                   TO DP013-MESSAGE-TEXT (1)      26900099
269100         PERFORM DP013-0000-PROCESS-ABEND                         26910099
269200     END-IF.                                                      26920099
269300                                                                  26930099
269400 EJECT                                                            26940099
269500*----------------------------------------------------------------*26950099
269600*    ABEND PROCESSOR MODULE                                      *26960099
269700*----------------------------------------------------------------*26970099
269800                                                                  26980099
269900     COPY DPPD013.                                                26990099
