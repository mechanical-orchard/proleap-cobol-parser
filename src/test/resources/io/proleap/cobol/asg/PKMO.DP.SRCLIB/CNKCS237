000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*-----------------------*                                         00030002
000400 PROGRAM-ID.    CNKCS237.                                         00040002
000500 AUTHOR.        DENISE HAHN.                                      00050002
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060002
000700 DATE-WRITTEN.  AUGUST, 2012.                                     00070046
000800 DATE-COMPILED.                                                   00080002
000900                                                                  00090002
001000*---------------------------------------------------------------* 00100002
001100*    Y237 - TKRPRPM - CODE LIST                                 * 00110002
001200*---------------------------------------------------------------* 00120002
263455* CHANGED 11/03/2021    BY JIM HUNTER      WR: CHG0263455         00121083
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00122083
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00123083
263455*----------------------------------------------------------------*00124083
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00125084
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00126084
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00127084
CICS  *-----------------------------------------------------------------00128084
001300 ENVIRONMENT DIVISION.                                            00130002
001400 DATA DIVISION.                                                   00140002
001500                                                                  00150002
001600 WORKING-STORAGE SECTION.                                         00160002
001700*                                                                 00170002
001800 01  DK-DB2-KEYS.                                                 00180002
001900     05  DK-OPER-UNT-ID            PIC S9(04)     COMP            00190002
001901                                                  VALUE ZEROES.   00190102
001910     05  DK-CODE-PARM              PIC  X(06)     VALUE SPACES.   00191002
002000                                                                  00200002
002100 01  PC-PROGRAM-CONSTANTS.                                        00210002
002200     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CNK237  '.  00220002
002300     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CNKM237 '.  00230002
002400     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CNKCS237'.  00240002
002500     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00250002
002600     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00260002
002700     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00270002
002710     05  PC-LIST-FORMAT            PIC  X(01)  VALUE '2'.         00271031
002800     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +10          00280069
002900                                               COMP SYNC.         00290002
003000     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00300002
003100                                               COMP SYNC.         00310002
003200     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00320002
003300                                               COMP-3.            00330002
003400     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00340002
003500                                               COMP SYNC.         00350002
003600     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00360002
003700                                               COMP-3.            00370002
003800     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00380002
003900     05  PC-ADD                    PIC  X(03)  VALUE 'ADD'.       00390002
004000     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00400002
004100     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00410002
004200     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00420002
004300     05  PC-AP                     PIC  X(02)  VALUE 'AP'.        00430078
004400                                                                  00440002
004500*----------------------------------------------------------------*00450002
004600*  SYSTEM MESSAGES                                               *00460002
004700*----------------------------------------------------------------*00470002
004800*   00005 = INVALID VALUE                                        *00480002
004900*   00008 = MUST BE NUMERIC                                      *00490002
005000*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00500002
005100*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00510002
005200*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00520002
005300*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00530002
005400*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00540002
005500*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00550002
005600*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00560002
005700*   00069 - TOP OF LIST                                          *00570002
005800*   00070 - BOTTOM OF LIST                                       *00580002
005900*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00590002
006000*   00279 - MORE ITEMS TO DISPLAY                                *00600002
006100*----------------------------------------------------------------*00610002
006200     05  PC-TSYMSG-NUMBERS.                                       00620002
006300         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00630002
006400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00640002
006500         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00650002
006600         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00660002
006700         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00670002
006800         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00680002
006900         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00690002
007000         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00700002
007100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00710002
007200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00720002
007300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00730002
007400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00740002
007500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00750002
007600                                                                  00760002
007700 01  PS-PROGRAM-SWITCHES.                                         00770002
007800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00780002
007900         88  PS-NO-ERROR                            VALUE 'Y'.    00790002
008000         88  PS-ERROR                               VALUE 'N'.    00800002
008100     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00810002
008200         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00820002
008300         88  PS-BLOCK-ERROR                         VALUE 'N'.    00830002
008400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00840002
008500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00850002
008600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00860002
008610     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   00861034
008620         88  PS-LIST-END                            VALUE  'Y'.   00862034
008630         88  PS-NO-LIST-END                         VALUE  'N'.   00863034
008700                                                                  00870002
008800 01  PV-PROGRAM-VARIABLES.                                        00880002
009100                                                                  00910002
009200     15  PV-DISPLAY-PERCENT             PIC  9.9999.              00920008
009201     15  PV-DISPLAY-QUANTITY            PIC  Z(6)9-.              00920182
009210     15  PV-WORK-YEAR-CHAR              PIC  X(04).               00921008
009300     15  PV-RECORD-TYPE                 PIC  X(01).               00930002
009400                                                                  00940002
009500     05  PV-SUB                         PIC S9(04)  VALUE +0      00950002
009600                                                    COMP SYNC.    00960002
009700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00970002
009800                                                    COMP SYNC.    00980002
009900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00990002
010000                                                    COMP-3.       01000002
010100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01010002
010200                                                    COMP-3.       01020002
010300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01030002
010400                                                    COMP-3.       01040002
010500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01050002
010600                                                    COMP-3.       01060002
010700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01070002
010800                                                    COMP-3.       01080002
010900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01090002
011000                                                    COMP-3.       01100002
011100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01110002
011200                                                    COMP-3.       01120002
011300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01130002
011400                                                    COMP SYNC.    01140002
011500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01150002
011600                                                    COMP SYNC.    01160002
011700     05  PV-ITEM                        PIC S9(04)  VALUE +0      01170002
011800                                                    COMP SYNC.    01180002
011900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01190002
012000                                                    COMP SYNC.    01200002
012100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01210002
012200                                                    COMP SYNC.    01220002
012300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01230002
012400                                                    COMP SYNC.    01240002
012500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01250002
012600                                                    COMP SYNC.    01260002
012700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01270002
012800                                                    COMP SYNC.    01280002
012900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01290002
013000                                                    COMP SYNC.    01300002
013100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01310002
013200                                                    COMP SYNC.    01320002
013300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01330002
013400                                                    COMP SYNC.    01340002
013500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01350002
013600                                                    COMP SYNC.    01360002
013700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01370002
013800                                                    COMP SYNC.    01380002
013900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01390002
014000                                                    COMP SYNC.    01400002
014100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01410002
014200                                                    COMP SYNC.    01420002
014300                                                                  01430002
014400     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01440002
014500                                                     COMP SYNC.   01450002
014600     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01460002
014700     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01470002
014800                                                                  01480002
014801     05  PV-NULL-BEG-TMST               PIC S9(04)  VALUE ZEROS   01480124
014802                                                    COMP SYNC.    01480222
014803     05  PV-NULL-END-TMST               PIC S9(04)  VALUE ZEROS   01480325
014804                                                    COMP SYNC.    01480424
014805     05  PV-NULL-FUNC-QTY               PIC S9(04)  VALUE ZEROS   01480524
014806                                                    COMP SYNC.    01480624
014807     05  PV-NULL-FUNC-PCT               PIC S9(04)  VALUE ZEROS   01480722
014808                                                    COMP SYNC.    01480822
014809     05  PV-NULL-FUNC-TXT               PIC S9(04)  VALUE ZEROS   01480922
014810                                                    COMP SYNC.    01481022
014822                                                                  01482222
014830                                                                  01483022
014900******************************************************************01490002
015000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01500002
015100**  THIS MUST BE THE EXACT SAME FORMAT AS BLOCK IN THE          **01510002
015200**  APPLICATION-SPECIFIC COMMAREA.                              **01520002
015300******************************************************************01530002
015400 01  LQW-LIST-QUEUE-WORK-AREA.                                    01540002
015500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01550002
015600     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           01560069
015700                                        INDEXED BY LQW-IDX.       01570002
015800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01580002
015900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01590002
016000         10  LQW-SELECTED-SW            PIC  X(01).               01600002
016100             88  LQW-SELECT                         VALUE 'S'.    01610002
016200             88  LQW-DESELECT                       VALUE ' '.    01620002
016300         10  LQW-ACTION                 PIC  X(03).               01630002
016400             88  LQW-ADD                            VALUE 'ADD'.  01640002
016500             88  LQW-INQ                            VALUE 'INQ'.  01650002
016600             88  LQW-UPD                            VALUE 'UPD'.  01660002
016700             88  LQW-ERR                            VALUE 'ERR'.  01670002
016800         10  LQW-OPER-UNIT              PIC  9(04).               01680002
016900         10  LQW-SYS-INTRFC-CDE         PIC  X(03).               01690002
017000         10  LQW-STATUS                 PIC  X(02).               01700002
017100         10  LQW-FROM-TMST              PIC  X(26).               01710053
017101         10  LQW-FROM-TMST-NULL         PIC  X(01).               01710174
017110         10  LQW-TO-TMST                PIC  X(26).               01711053
017111         10  LQW-TO-TMST-NULL           PIC  X(01).               01711174
017120         10  LQW-FUNC-QTY               PIC S9(09) COMP.          01712057
017121         10  LQW-FUNC-QTY-NULL          PIC  X(01).               01712174
017130         10  LQW-FUNC-PCNT              PIC S9(1)V9(4) COMP-3.    01713060
017131         10  LQW-FUNC-PCNT-NULL         PIC  X(01).               01713174
017140         10  LQW-FUNC-TEXT              PIC  X(25).               01714059
017141         10  LQW-FUNC-TEXT-NULL         PIC  X(01).               01714174
017150         10  LQW-FUNC-WD                PIC S9(5)V9(4)            01715003
017160                                             COMP-3.              01716003
017170         10  LQW-FUNC-DPTH              PIC S9(5)V9(4)            01717003
017180                                             COMP-3.              01718003
017190         10  LQW-FUNC-HT                PIC S9(5)V9(4)            01719003
017191                                             COMP-3.              01719103
017192         10  LQW-FUNC-WT                PIC S9(5)V9(4)            01719203
017193                                             COMP-3.              01719303
017194         10  FILLER                     PIC  X(05).               01719471
017300                                                                  01730002
017400*---------------------------------------------------------------* 01740002
017500* SELECTION QUEUE LAYOUT  -  FROM CODE LIST (CNKCS236)          * 01750002
017600*---------------------------------------------------------------* 01760002
017700     COPY CNWS019.                                                01770002
017800                                                                  01780002
017810*---------------------------------------------------------------* 01781002
017820* SELECTION QUEUE LAYOUT                                        * 01782002
017830*---------------------------------------------------------------* 01783002
017840     COPY CNWS021.                                                01784002
017850                                                                  01785002
017900*---------------------------------------------------------------* 01790002
018000*    MAP LAYOUT                                                 * 01800002
018100*---------------------------------------------------------------* 01810002
018200     COPY CNKM237.                                                01820002
018300*                                                                 01830002
018400 01  MR-OCCURS-LAYOUT                   REDEFINES  CNK237O.       01840002
018500     05  FILLER                         PIC X(115).               01850045
018600     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          01860019
018700         10  MR-SELECTL                 PIC S9(04) COMP.          01870002
018800         10  MR-SELECTA                 PIC  X(01).               01880002
018900         10  MR-SELECTC                 PIC  X(01).               01890002
019000         10  MR-SELECTH                 PIC  X(01).               01900002
019100         10  MR-SELECTI                 PIC  X(01).               01910002
019200                                                                  01920002
019300         10  MR-ACTIONL                 PIC S9(04) COMP.          01930002
019400         10  MR-ACTIONA                 PIC  X(01).               01940002
019500         10  MR-ACTIONC                 PIC  X(01).               01950002
019600         10  MR-ACTIONH                 PIC  X(01).               01960002
019700         10  MR-ACTION                  PIC  X(01).               01970021
019800                                                                  01980002
019900         10  MR-LOCL                   PIC S9(04) COMP.           01990009
020000         10  MR-LOCA                   PIC  X(01).                02000009
020100         10  MR-LOCC                   PIC  X(01).                02010009
020200         10  MR-LOCH                   PIC  X(01).                02020009
020300         10  MR-LOC                    PIC  Z(04).                02030009
020400                                                                  02040002
020500         10  MR-SYSTEML                PIC S9(04) COMP.           02050010
020600         10  MR-SYSTEMA                PIC  X(01).                02060010
020700         10  MR-SYSTEMC                PIC  X(01).                02070010
020800         10  MR-SYSTEMH                PIC  X(01).                02080010
020900         10  MR-SYSTEM                 PIC  X(03).                02090010
021000                                                                  02100002
021010         10  MR-STATUSL                PIC S9(04) COMP.           02101010
021020         10  MR-STATUSA                PIC  X(01).                02102010
021030         10  MR-STATUSC                PIC  X(01).                02103010
021040         10  MR-STATUSH                PIC  X(01).                02104010
021050         10  MR-STATUS                 PIC  X(02).                02105010
021060                                                                  02106010
021100         10  MR-FROML                  PIC S9(04) COMP.           02110009
021200         10  MR-FROMA                  PIC  X(01).                02120009
021300         10  MR-FROMC                  PIC  X(01).                02130009
021400         10  MR-FROMH                  PIC  X(01).                02140009
021500         10  MR-FROM                   PIC  X(10).                02150009
021600                                                                  02160002
021700         10  MR-TOL                    PIC S9(04) COMP.           02170009
021800         10  MR-TOA                    PIC  X(01).                02180009
021900         10  MR-TOC                    PIC  X(01).                02190009
022000         10  MR-TOH                    PIC  X(01).                02200009
022100         10  MR-TO                     PIC  X(10).                02210009
022200                                                                  02220002
022210         10  MR-QTYL                   PIC S9(04) COMP.           02221009
022220         10  MR-QTYA                   PIC  X(01).                02222009
022230         10  MR-QTYC                   PIC  X(01).                02223009
022240         10  MR-QTYH                   PIC  X(01).                02224009
022250         10  MR-QTY                    PIC  X(08).                02225042
022260                                                                  02226009
022270         10  MR-PCTL                   PIC S9(04) COMP.           02227009
022280         10  MR-PCTA                   PIC  X(01).                02228009
022290         10  MR-PCTC                   PIC  X(01).                02229009
022291         10  MR-PCTH                   PIC  X(01).                02229109
022292         10  MR-PCT                    PIC  X(06).                02229242
022293                                                                  02229309
022294         10  MR-TEXTL                  PIC S9(04) COMP.           02229409
022295         10  MR-TEXTA                  PIC  X(01).                02229509
022296         10  MR-TEXTC                  PIC  X(01).                02229609
022297         10  MR-TEXTH                  PIC  X(01).                02229709
022298         10  MR-TEXT                   PIC  X(24).                02229809
022299                                                                  02229909
022300     05  FILLER                         PIC  X(12).               02230002
022400                                                                  02240002
022500*----------------------------------------------------------------*02250002
022600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02260002
022700*---------------------------------------------------------------* 02270002
022800     COPY DPWS015.                                                02280002
022900                                                                  02290002
023000*---------------------------------------------------------------* 02300002
023100*    FUNCTION KEYS COPYBOOK.                                    * 02310002
023200*---------------------------------------------------------------* 02320002
023300     COPY DPWS016.                                                02330002
023400                                                                  02340002
023500*---------------------------------------------------------------* 02350002
023600*    NUMERIC EDIT LAYOUT.                                       * 02360002
023700*---------------------------------------------------------------* 02370002
023800     COPY DPWS010I.                                               02380002
023900                                                                  02390002
024000*---------------------------------------------------------------* 02400002
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02410084
024200*---------------------------------------------------------------* 02420002
024300     COPY DPWS030.                                                02430002
CICS       COPY DPWS930.                                                02431084
024400                                                                  02440002
024500*---------------------------------------------------------------* 02450002
024600*    STANDARD COMMAREA.                                         * 02460002
024700*---------------------------------------------------------------* 02470002
024800     COPY DPWS020.                                                02480002
024900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02490002
025000                                                                  02500002
025100*---------------------------------------------------------------* 02510002
025200* INTER-APPLICATION COMMAREA.                                   * 02520002
025300*   CNWS014 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02530002
025400*             SPEC SCREEN.  (CNKCS233)                          * 02540002
025500*   CNWS018 - IS THE INPUT LAYOUT WHEN COMIING FROM THE CODE    * 02550002
025600*             LIST SCREEN.  (CNKCS236)                          * 02560002
025610*   CNWS020 - IS THE OUTPUT LAYOUT WHEN NAVIGATING TO THE       * 02561002
025620*             ADD/UPDATE PARM SCREEN (CNKCS235)                 * 02562002
025700*---------------------------------------------------------------* 02570002
025800         10  INTER-APPL-COMM-AREA       PIC X(200).               02580002
025900     COPY CNWS014.                                                02590002
026000     COPY CNWS018.                                                02600002
026010     COPY CNWS020.                                                02601002
026100                                                                  02610002
026200*---------------------------------------------------------------* 02620002
026300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02630002
026400*---------------------------------------------------------------* 02640002
026500                                                                  02650002
026600         10  ASC-SPECIFIC-COMMAREA.                               02660002
026700             15  ASC-FUNCTION                 PIC  X(02).         02670002
026800                 88  ASC-FUNCTION-NONE             VALUE ' '.     02680002
026900                 88  ASC-ADD-CODE                  VALUE 'AC'.    02690002
027000                 88  ASC-UPD-CODE                  VALUE 'UC'.    02700002
027100                 88  ASC-ADD-PARM                  VALUE 'AP'.    02710002
027200                 88  ASC-UPD-PARM                  VALUE 'UP'.    02720002
027300             15  ASC-OPER-UNT-ID              PIC  9(04).         02730006
027400             15  ASC-OPER-UNT-NAME            PIC  X(26).         02740006
027500             15  ASC-PARM-NAME                PIC  X(06).         02750002
027600             15  ASC-PARM-DESC                PIC  X(40).         02760002
027700             15  ASC-PARM-TYPE                PIC  X(02).         02770002
027800                 88  ASC-VALID-TYPE                VALUE 'DT',    02780002
027900                                                         'PC',    02790002
028000                                                         'QT',    02800002
028100                                                         'TX'.    02810002
028200                 88  ASC-TYPE-DATE                 VALUE 'DT'.    02820002
028300                 88  ASC-TYPE-PCNT                 VALUE 'PC'.    02830002
028400                 88  ASC-TYPE-QTY                  VALUE 'QT'.    02840002
028500                 88  ASC-TYPE-TEXT                 VALUE 'TX'.    02850002
028510             15  ASC-PARM-COUNT               PIC  9(04).         02851030
028600                                                                  02860002
028700             15  ASC-BLK-SUB                  PIC S9(04) COMP     02870002
028800                                                         SYNC.    02880002
028900             15  ASC-ITEM-SUB                 PIC S9(04) COMP     02890002
029000                                                         SYNC.    02900002
029100             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  02910002
029200             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  02920002
029300             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  02930002
029400             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  02940002
029500             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  02950002
029600             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     02960002
029700                                                         SYNC.    02970002
029800             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  02980002
029900             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  02990002
030000             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03000002
030100                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03010002
030200                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03020002
030300             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03030002
030400                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03040002
030500                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03050002
030600             15  ASC-LIST-QUEUE-NAME.                             03060002
030700                 20  ASC-LIST-TERM-ID         PIC  X(04).         03070002
030800                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03080002
030900                 20  ASC-LIST-SEQ             PIC  9(01).         03090002
031000                                                                  03100002
031100             15  ASC-START-ITEM-REQUEST.                          03110002
031200                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03120002
031300                                                                  03130002
031400             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03140002
031500             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03150002
032000                                                                  03200002
032100             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03210002
032200                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03220002
032300             15  ASC-SEL-QUEUE-NAME.                              03230002
032400                 20  ASC-SEL-TERM-ID          PIC  X(04).         03240002
032500                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03250002
032600                 20  ASC-SEL-SEQ              PIC  9(01).         03260002
032700                                                                  03270002
032710             15  ASC-SEL-QUEUE-NAME-2.                            03271080
032720                 20  ASC-SEL-TERM-ID-2        PIC  X(04).         03272080
032730                 20  ASC-SEL-TASK-NUMBER-2    PIC S9(05) COMP-3.  03273080
032740                 20  ASC-SEL-SEQ-2            PIC  9(01).         03274080
032750                                                                  03275080
032800             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03280002
032900                                                                  03290002
033000******       15  FILLER                              PIC X(100).  03300070
033100                                                                  03310002
033200*-----------------------------------------------------------------03320002
033300             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03330002
033400                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03340002
033500                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03350002
033600                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03360002
033700                                                                  03370002
033800                 20  ASC-ITEM-ARRAY.                              03380002
033900                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        03390069
034000                         30  ASC-LIST-ITEM-NUMBER                 03400002
034100                                                     PIC S9(09)   03410002
034200                                                     COMP-3.      03420002
034300                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03430002
034400                             88  ASC-VALID-SELECT    VALUE ' '    03440002
034500                                                           'S'    03450002
034600                                                           'B'    03460002
034700                                                           'E'.   03470002
034800                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03480002
034900                             88  ASC-TEMP-SELECT     VALUE 'S'.   03490002
035000                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03500002
035100                             88  ASC-TEMP-END        VALUE 'E'.   03510002
035200                         30  ASC-SELECTED-SW         PIC  X(01).  03520002
035300                             88  ASC-NO-SELECT       VALUE ' '.   03530002
035400                             88  ASC-SELECT          VALUE 'S'.   03540002
035500                             88  ASC-BEGIN           VALUE 'B'.   03550002
035600                             88  ASC-END             VALUE 'E'.   03560002
035700                         30  ASC-ACTION              PIC  X(03).  03570002
035710                         30  ASC-OPER-UNIT           PIC  9(04).  03571003
035720                         30  ASC-SYS-INTRFC-CDE      PIC  X(03).  03572003
035730                         30  ASC-STATUS              PIC  X(02).  03573003
035740                         30  ASC-FROM-TMST           PIC  X(26).  03574051
035741                         30  ASC-FROM-TMST-NULL      PIC  X(01).  03574174
035750                         30  ASC-TO-TMST             PIC  X(26).  03575051
035751                         30  ASC-TO-TMST-NULL        PIC  X(01).  03575174
035760                         30  ASC-FUNC-QTY        PIC S9(09)       03576008
035761                                                     COMP.        03576108
035762                         30  ASC-FUNC-QTY-NULL   PIC  X(01).      03576275
035770                         30  ASC-FUNC-PCNT       PIC S9(1)V9(4)   03577008
035771                                                     COMP-3.      03577108
035772                         30  ASC-FUNC-PCNT-NULL  PIC  X(01).      03577274
035780                         30  ASC-FUNC-TEXT           PIC  X(25).  03578059
035781                         30  ASC-FUNC-TEXT-NULL      PIC  X(01).  03578174
035790                         30  ASC-FUNC-WD         PIC S9(5)V9(4)   03579003
035791                                                     COMP-3.      03579103
035800                         30  ASC-FUNC-DPTH       PIC S9(5)V9(4)   03580003
035810                                                     COMP-3.      03581003
035900                         30  ASC-FUNC-HT         PIC S9(5)V9(4)   03590003
035910                                                     COMP-3.      03591003
036000                         30  ASC-FUNC-WT         PIC S9(5)V9(4)   03600003
036100                                                     COMP-3.      03610003
036200                         30  FILLER              PIC  X(05).      03620071
036500                                                                  03650002
036600*---------------------------------------------------------------* 03660002
036700*    ABEND PROCESSING COPYBOOK.                                 * 03670002
036800*---------------------------------------------------------------* 03680002
036900     COPY DPWS013.                                                03690002
037000                                                                  03700002
037100*----------------------------------------------------------------*03710002
037200*    DB2 TABLE FOR TKRPRCD   APPLICATION CODE TABLE               03720002
037300*----------------------------------------------------------------*03730002
037400     EXEC SQL                                                     03740002
037500          INCLUDE TKRPRCD                                         03750002
037600     END-EXEC.                                                    03760002
037700                                                                  03770002
037800                                                                  03780002
037900*----------------------------------------------------------------*03790002
038000*    DB2 TABLE FOR TKRPRPM   APPLICATION PARM TABLE               03800002
038100*----------------------------------------------------------------*03810002
038200     EXEC SQL                                                     03820002
038300          INCLUDE TKRPRPM                                         03830002
038400     END-EXEC.                                                    03840002
038500                                                                  03850002
038600                                                                  03860002
038700*---------------------------------------------------------------* 03870002
038800* TKRPRPM CURSOR  - FOR A SPECIFIC CODE                         * 03880003
038900*---------------------------------------------------------------* 03890002
039000     EXEC SQL                                                     03900002
039100        DECLARE PARM-CSR CURSOR FOR                               03910003
039210         SELECT LOC_ID                                            03921003
039220              , INTFC_SYS_CDE                                     03922003
039230              , SYS_PRC_FUNC_CDE                                  03923003
039240              , FUNC_PRC_STAT_CDE                                 03924003
039250              , FUNC_BEG_TMST                                     03925003
039260              , FUNC_END_TMST                                     03926003
039270              , FUNC_QTY                                          03927003
039280              , FUNC_PCT                                          03928003
039290              , FUNC_TXT                                          03929003
039291              , FUNC_WD_QTY                                       03929103
039292              , FUNC_DPTH_QTY                                     03929203
039293              , FUNC_HT_QTY                                       03929303
039294              , FUNC_WT_QTY                                       03929403
039296           FROM TKRPRPM                                           03929603
039297          WHERE SYS_PRC_FUNC_CDE  =  :DK-CODE-PARM                03929727
039800          ORDER BY LOC_ID                                         03980003
039801                 , FUNC_BEG_TMST                                  03980103
039802                 , FUNC_END_TMST                                  03980203
039803                 , FUNC_TXT                                       03980303
039900     END-EXEC.                                                    03990002
040000                                                                  04000002
041500*---------------------------------------------------------------* 04150002
041600*    DB2 AREA FOR COMMUNICATIONS                                * 04160002
041700*---------------------------------------------------------------* 04170002
041800     EXEC SQL                                                     04180002
041900          INCLUDE SQLCA                                           04190002
042000     END-EXEC.                                                    04200002
042100                                                                  04210002
042200***************************************************************** 04220002
042300 LINKAGE SECTION.                                                 04230002
042400                                                                  04240002
042500 01  DFHCOMMAREA.                                                 04250002
042600     05  FILLER                         OCCURS  1 TO 4072 TIMES   04260002
042700                                        DEPENDING ON EIBCALEN.    04270002
042800         10  FILLER                     PIC X.                    04280002
042900                                                                  04290002
043000                                                                  04300002
043100 PROCEDURE DIVISION.                                              04310002
043200******************************************************************04320002
043300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04330002
043400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04340002
043500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04350002
043600******************************************************************04360002
043700                                                                  04370002
043800 0000-MAIN-MODULE.                                                04380002
043900     INITIALIZE DP030-CICS-API-FIELDS.                            04390002
044000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04400002
044100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04410002
044200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04420002
044300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04430002
044400     MOVE LENGTH OF CNK237I        TO DP030-MAP-LENGTH (1).       04440002
044500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04450002
044600     PERFORM 0001-CALL-CICS-ARCH-API.                             04460002
044700                                                                  04470002
044800     PERFORM 1000-CONTROL-PROCESSING                              04480002
044900                                                                  04490002
045000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04500002
045100     PERFORM 0001-CALL-CICS-ARCH-API.                             04510002
045200                                                                  04520002
045300******************************************************************04530002
045400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04540002
045500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04550002
045600******************************************************************04560002
045700 0001-CALL-CICS-ARCH-API.                                         04570002
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04580084
045900                                    DFHCOMMAREA                   04590084
046000                                    DP030-CICS-API-FIELDS         04600084
046100                                    DP020-STANDARD-COMMAREA       04610084
046200                                    CNK237I.                      04620084
046300                                                                  04630002
046400     IF  DP030-RC-CALL-SUCCESSFUL                                 04640002
046500         CONTINUE                                                 04650002
046600     ELSE                                                         04660002
046700         SET DP013-NO-ROLLBACK                                    04670002
046800             DP013-XCTL-DISPLAY-RESTART                           04680002
046900             DP013-CICS-ABEND      TO TRUE                        04690002
047000         MOVE '0001-CALL-CICS-ARCH-API'                           04700002
047100                                   TO DP013-PARAGRAPH             04710002
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04711084
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04712084
047400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04740002
047500         PERFORM DP013-0000-PROCESS-ABEND                         04750002
047600     END-IF.                                                      04760002
047700                                                                  04770002
047800*----------------------------------------------------------------*04780002
047900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04790002
048000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04800002
048100*                                                                *04810002
048200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04820002
048300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04830002
048400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04840002
048500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04850002
048600*----------------------------------------------------------------*04860002
048700 1000-CONTROL-PROCESSING.                                         04870002
048800     EVALUATE TRUE                                                04880002
048900         WHEN DP020-NEXT-ACT-INITIAL                              04890002
049000             INITIALIZE ASC-SPECIFIC-COMMAREA                     04900002
049100             MOVE EIBTRMID    TO ASC-LIST-TERM-ID                 04910002
049200                                 ASC-SEL-TERM-ID                  04920002
049210                                 ASC-SEL-TERM-ID-2                04921080
049300             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   04930002
049400                                           ASC-SEL-TASK-NUMBER    04940002
049410                                           ASC-SEL-TASK-NUMBER-2  04941080
049500             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               04950002
049600             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                04960002
049610                                       ASC-SEL-SEQ-2              04961080
049700             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04970002
049800             PERFORM 4000-BUILD-INITIAL-PANEL                     04980002
049900                                                                  04990002
050000         WHEN DP020-NEXT-ACT-READ-MAP                             05000002
050100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05010002
050200             PERFORM 2000-PROCESS-PANEL                           05020002
050300                                                                  05030002
050400         WHEN DP020-NEXT-ACT-RETURN                               05040002
050500             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05050002
050600             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               05060002
050700             IF CN014-FUNCTION = PC-AP                            05070078
050800                                                                  05080004
051200                 MOVE CN014-PARM-NAME   TO DK-CODE-PARM           05120004
051300                                                                  05130004
051400                 PERFORM 2050-DELETE-LIST-QUEUE                   05140002
051410                 PERFORM 3200-RESET-ATTRIBUTES                    05141079
051500                 PERFORM 4000-BUILD-INITIAL-PANEL                 05150002
051700             ELSE                                                 05170002
051800                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP             05180002
051900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05190002
052000             END-IF                                               05200002
052100                                                                  05210002
052200         WHEN OTHER                                               05220002
052300             SET DP013-LOGIC-ABEND TO TRUE                        05230002
052400             SET DP013-NO-ROLLBACK TO TRUE                        05240002
052500             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    05250002
052600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05260002
052700                                   TO DP013-MESSAGE-TEXT(1)       05270002
052800             PERFORM DP013-0000-PROCESS-ABEND                     05280002
052900     END-EVALUATE.                                                05290002
053000                                                                  05300002
053100*----------------------------------------------------------------*05310002
053200* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05320002
053300* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05330002
053400*----------------------------------------------------------------*05340002
053500 1100-PROCESS-INTER-APPL-COMM.                                    05350002
053600                                                                  05360002
053700     SET PS-COMMAREA-VALID         TO TRUE.                       05370002
053800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05380002
053900                                                                  05390002
054000     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          05400002
054100         MOVE CN014-FUNCTION           TO ASC-FUNCTION            05410002
054200         MOVE CN014-OPER-UNT-ID        TO ASC-OPER-UNT-ID         05420002
054300         MOVE CN014-OPER-UNT-NAME      TO ASC-OPER-UNT-NAME       05430002
054400         MOVE CN014-PARM-NAME          TO ASC-PARM-NAME           05440002
054500         MOVE CN014-PARM-DESC          TO ASC-PARM-DESC           05450002
054600         MOVE CN014-PARM-TYPE          TO ASC-PARM-TYPE           05460002
055400     END-IF.                                                      05540002
055401                                                                  05540130
055410     IF  DP020-INT-APPL-FORMAT-IND =  PC-LIST-FORMAT              05541030
055420       IF CN018-NUMBER-OF-SELECTED-ITEMS > 0                      05542030
055430         SET ASC-USE-SELECTION-QUEUE   TO TRUE                    05543035
055440             MOVE CN018-NUMBER-OF-TS-ITEMS                        05544035
055441                                       TO ASC-NUMBER-OF-TS-ITEMS  05544135
055450             MOVE CN018-SEL-QUEUE-NAME                            05545035
055460                                       TO ASC-SEL-QUEUE-NAME      05546035
055499         PERFORM 1120-PREPARE-LIST-ENTRY                          05549930
055500       ELSE                                                       05550030
055501         MOVE PC-TSYMSG-00057       TO DP020-MSG-NUMBER           05550130
055502         SET  PS-COMMAREA-NOT-VALID TO TRUE                       05550230
055503       END-IF                                                     05550330
055504     END-IF.                                                      05550430
055505                                                                  05550530
055510                                                                  05551002
055520*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*05552030
055530 1120-PREPARE-LIST-ENTRY.                                         05553030
055540                                                                  05554030
055550     MOVE CN019-MAX-ITEMS          TO ASC-SEL-SUB.                05555072
055560     MOVE ZERO                     TO ASC-SEL-ITEM.               05556030
055570     PERFORM 1130-GET-NEXT-RECORD.                                05557030
055580                                                                  05558030
055590*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*05559030
055591*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*05559130
055592*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*05559230
055593 1130-GET-NEXT-RECORD.                                            05559330
055594                                                                  05559430
055595     ADD +1                       TO ASC-SEL-SUB.                 05559530
055596                                                                  05559630
055597     IF  ASC-SEL-SUB > CN019-MAX-ITEMS                            05559772
055598         ADD +1                   TO ASC-SEL-ITEM                 05559830
055599         MOVE +1                  TO ASC-SEL-SUB                  05559930
055600     END-IF.                                                      05560030
055601                                                                  05560130
055602     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                05560230
055603         PERFORM 9100-READ-SEL-QUEUE                              05560330
055604         IF  CN019-ITEM (ASC-SEL-SUB) > ZERO                      05560448
055605             MOVE CN019-FUNC-CODE   (ASC-SEL-SUB)                 05560548
055606                                  TO ASC-PARM-NAME                05560630
055608             MOVE CN019-FUNC-DESC  (ASC-SEL-SUB)                  05560848
055609                                  TO ASC-PARM-DESC                05560930
055611             MOVE CN019-FUNC-TYPE   (ASC-SEL-SUB)                 05561149
055612                                  TO ASC-PARM-TYPE                05561230
055613             MOVE CN019-PARM-COUNT  (ASC-SEL-SUB)                 05561348
055614                                  TO ASC-PARM-COUNT               05561430
055637                                                                  05563730
055638             SET CN019-INQ (ASC-SEL-SUB)                          05563848
055639                                  TO TRUE                         05563930
055640             PERFORM 9200-REWRITE-SEL-QUEUE                       05564030
055641         ELSE                                                     05564130
055642             SUBTRACT +1 FROM ASC-SEL-SUB                         05564230
055643             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             05564330
055644             SET DP020-MSG-INFORMATIONAL                          05564430
055645                 PS-LIST-END             TO TRUE                  05564530
055646         END-IF                                                   05564630
055647     ELSE                                                         05564730
055648         SUBTRACT +1 FROM ASC-SEL-ITEM                            05564830
055649         MOVE CN019-MAX-ITEMS     TO ASC-SEL-SUB                  05564972
055650         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             05565030
055651         SET DP020-MSG-INFORMATIONAL                              05565130
055652             PS-LIST-END             TO TRUE                      05565230
055653     END-IF.                                                      05565330
055654                                                                  05565430
055655/                                                                 05565530
055656*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*05565630
055657*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *05565730
055658*    PROCESSED.                                                  *05565830
055659*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*05565930
055660                                                                  05566030
055661 1140-GET-PREV-RECORD.                                            05566130
055662                                                                  05566230
055663     SUBTRACT +1 FROM ASC-SEL-SUB.                                05566330
055664                                                                  05566430
055665     IF  ASC-SEL-SUB < +1                                         05566530
055666         SUBTRACT +1 FROM ASC-SEL-ITEM                            05566630
055667         MOVE CN019-MAX-ITEMS     TO ASC-SEL-SUB                  05566772
055668     END-IF.                                                      05566830
055669                                                                  05566930
055670     IF  ASC-SEL-ITEM > ZERO                                      05567030
055671         PERFORM 9100-READ-SEL-QUEUE                              05567130
055672         IF  CN019-ITEM (ASC-SEL-SUB) > ZERO                      05567250
055673             MOVE CN019-FUNC-CODE   (ASC-SEL-SUB)                 05567350
055674                                  TO ASC-PARM-NAME                05567450
055675             MOVE CN019-FUNC-DESC  (ASC-SEL-SUB)                  05567550
055676                                  TO ASC-PARM-DESC                05567650
055677             MOVE CN019-FUNC-TYPE   (ASC-SEL-SUB)                 05567750
055678                                  TO ASC-PARM-TYPE                05567850
055679             MOVE CN019-PARM-COUNT  (ASC-SEL-SUB)                 05567950
055680                                  TO ASC-PARM-COUNT               05568050
055689                                                                  05568930
055690             SET CN019-INQ (ASC-SEL-SUB)                          05569072
055700                                  TO TRUE                         05570030
055718         PERFORM 9200-REWRITE-SEL-QUEUE                           05571830
055719     ELSE                                                         05571930
055720         MOVE +1                  TO ASC-SEL-ITEM                 05572030
055721                                     ASC-SEL-SUB                  05572130
055722         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             05572230
055723         SET DP020-MSG-INFORMATIONAL                              05572330
055724             PS-LIST-END             TO TRUE                      05572430
055725     END-IF.                                                      05572530
055726                                                                  05572630
055727                                                                  05572730
055728                                                                  05572830
055729                                                                  05572930
055730*----------------------------------------------------------------*05573002
055740* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05574002
055800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05580002
055900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05590002
056000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05600002
056100* FUNCTION KEYS CAN GET THIS FAR.                                *05610002
056200*----------------------------------------------------------------*05620002
056300 2000-PROCESS-PANEL.                                              05630002
056400     EVALUATE TRUE                                                05640002
056500         WHEN DP020-SRC-AID = DP016-CLEAR                         05650002
056600             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                05660002
056700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05670002
056800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05680002
056900                                                                  05690002
057000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05700079
057100             PERFORM 2050-DELETE-LIST-QUEUE                       05710002
057200             SET CN014-FUNCTION-NONE  TO TRUE                     05720002
057300                                                                  05730005
057700             MOVE ASC-PARM-NAME       TO  DK-CODE-PARM            05770005
057800                                                                  05780005
057900             PERFORM 4000-BUILD-INITIAL-PANEL                     05790002
058000                                                                  05800002
058100         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   05810002
058200             PERFORM 2140-DESELECT-ALL-ITEMS                      05820002
058300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05830002
058400                                                                  05840002
058500         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05850002
058600             PERFORM 2150-SELECT-ALL-ITEMS                        05860002
058700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05870002
058800         WHEN OTHER                                               05880002
058900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05890002
059000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05900002
059100             IF  PS-NO-ERROR                                      05910002
059200                 SET DP030-CONTINUE-GO TO TRUE                    05920002
059300                 PERFORM 2100-CHECK-FUNCTION-KEY                  05930002
059400             ELSE                                                 05940002
059500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05950002
059600                 SET DP030-OVERRIDE-GO TO TRUE                    05960002
059700             END-IF                                               05970002
059800     END-EVALUATE.                                                05980002
059900                                                                  05990002
060000*----------------------------------------------------------------*06000002
060100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06010002
060200*----------------------------------------------------------------*06020002
060300 2050-DELETE-LIST-QUEUE.                                          06030002
060400                                                                  06040002
060500     EXEC CICS                                                    06050002
060600         DELETEQ TS                                               06060002
060700             QUEUE (ASC-LIST-QUEUE-NAME)                          06070002
060800             RESP  (PV-CICS-RESP)                                 06080002
060900     END-EXEC.                                                    06090002
061000                                                                  06100002
061100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06110002
061200        (PV-CICS-RESP = DFHRESP(QIDERR))                          06120002
061300         CONTINUE                                                 06130002
061400     ELSE                                                         06140002
061500         SET DP013-CICS-ABEND      TO TRUE                        06150002
061600         SET DP013-NO-ROLLBACK     TO TRUE                        06160002
061700                                                                  06170002
061800         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         06180002
061900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06190002
062000                                   TO DP013-MESSAGE-TEXT (1)      06200002
062100         PERFORM DP013-0000-PROCESS-ABEND                         06210002
062200     END-IF.                                                      06220002
062300                                                                  06230002
062400     MOVE +0  TO ASC-HIGHEST-BLOCK-WRITTEN.                       06240002
062500                                                                  06250002
062600*----------------------------------------------------------------*06260002
062700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06270002
062800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06280002
062900* CICS ARCHITECTURE API.                                         *06290002
063000*----------------------------------------------------------------*06300002
063100 2100-CHECK-FUNCTION-KEY.                                         06310002
063200                                                                  06320002
063300     EVALUATE TRUE                                                06330002
065300                                                                  06530002
065310* F17 - ADD PARM            (LOCAL-FUNC-01)                       06531054
065320         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06532054
065330                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 0              06533054
065340                     SET ASC-USE-SELECTION-QUEUE TO TRUE          06534054
065350                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            06535054
065360                                TO CN020-NUMBER-OF-SELECTED-ITEMS 06536054
065370                     MOVE ASC-NUMBER-OF-TS-ITEMS                  06537054
065380                                      TO CN020-NUMBER-OF-TS-ITEMS 06538054
065390                     MOVE ASC-SEL-QUEUE-NAME                      06539054
065391                                         TO  CN020-SEL-QUEUE-NAME 06539156
065392                     SET CN020-ADD-TKRPRPM TO TRUE                06539254
065393                     MOVE ASC-PARM-NAME    TO  CN020-FUNC-CODE    06539362
065394                     MOVE ASC-PARM-DESC    TO  CN020-FUNC-DESC    06539462
065395                     MOVE ASC-PARM-TYPE    TO  CN020-TYPE-CODE    06539562
065396                     PERFORM 5000-PREPARE-SEL-QUEUE               06539654
065397                 ELSE                                             06539754
065398                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06539854
065399                     SET DP030-OVERRIDE-GO TO TRUE                06539954
065400                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    06540054
065401                     SET DP020-MSG-FATAL   TO TRUE                06540154
065402                 END-IF                                           06540254
065403                                                                  06540354
065404* F18 - UPDATE PARM         (LOCAL-FUNC-02)                       06540455
065405         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              06540555
065406                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 0              06540655
065407                     SET ASC-USE-SELECTION-QUEUE TO TRUE          06540755
065408                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            06540855
065409                                TO CN020-NUMBER-OF-SELECTED-ITEMS 06540955
065410                     MOVE ASC-NUMBER-OF-TS-ITEMS                  06541055
065411                                      TO CN020-NUMBER-OF-TS-ITEMS 06541155
065412                     MOVE ASC-SEL-QUEUE-NAME                      06541255
065413                                         TO  CN020-SEL-QUEUE-NAME 06541356
065414                     SET CN020-UPD-TKRPRPM TO TRUE                06541455
065415                     MOVE ASC-PARM-NAME    TO  CN020-FUNC-CODE    06541561
065416                     MOVE ASC-PARM-DESC    TO  CN020-FUNC-DESC    06541661
065417                     MOVE ASC-PARM-TYPE    TO  CN020-TYPE-CODE    06541761
065418                     PERFORM 5000-PREPARE-SEL-QUEUE               06541855
065419                 ELSE                                             06541955
065420                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06542055
065421                     SET DP030-OVERRIDE-GO TO TRUE                06542155
065422                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    06542255
065423                     SET DP020-MSG-FATAL   TO TRUE                06542355
065424                 END-IF                                           06542455
065430                                                                  06543002
065500* F6 - FIRST PAGE                                                 06550002
065600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06560002
065700             PERFORM 3200-RESET-ATTRIBUTES                        06570002
065800             MOVE +1               TO PV-TOP-ITEM                 06580002
065900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06590002
066000                                                                  06600002
066100* F7 - PREVIOUS PAGE                                              06610002
066200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06620002
066300             PERFORM 3200-RESET-ATTRIBUTES                        06630002
066400             PERFORM 2110-BROWSE-BACKWARD                         06640002
066500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06650002
066600                                                                  06660002
066700* F8 - NEXT PAGE                                                  06670002
066800         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06680002
066900             PERFORM 3200-RESET-ATTRIBUTES                        06690002
067000             PERFORM 2120-BROWSE-FORWARD                          06700002
067100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06710002
067200                                                                  06720002
067300* ENTER KEY                                                       06730002
067400         WHEN DP020-SRC-AID = DP016-ENTER                         06740002
067500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06750002
067600             IF  PS-ERROR                                         06760002
067700                 CONTINUE                                         06770002
067800             ELSE                                                 06780002
067900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06790002
068000             END-IF                                               06800002
068100                                                                  06810002
068200         WHEN OTHER                                               06820002
068300             SET DP013-NO-ROLLBACK                                06830002
068400                 DP013-XCTL-DISPLAY-RESTART                       06840002
068500                 DP013-CICS-ABEND  TO TRUE                        06850002
068600             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    06860002
068700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06870002
068800                                   TO DP013-MESSAGE-TEXT (1)      06880002
068900             PERFORM DP013-0000-PROCESS-ABEND                     06890002
069000     END-EVALUATE.                                                06900002
069100                                                                  06910002
069200******************************************************************06920002
069300** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **06930002
069400** INTER-APPLICATION COMMAREA.                                  **06940002
069500******************************************************************06950002
069600 2110-PREPARE-INTER-APPL-COMM.                                    06960002
069700                                                                  06970002
069800     INITIALIZE CN014-INTER-APPL-COMMAREA.                        06980002
069900                                                                  06990002
070000     MOVE ASC-FUNCTION             TO CN014-FUNCTION.             07000002
070100                                                                  07010002
070200*----------------------------------------------------------------*07020002
070300*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07030002
070400*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07040002
070500*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07050002
070600*    MESSAGE.                                                    *07060002
070700*----------------------------------------------------------------*07070002
070800 2110-BROWSE-BACKWARD.                                            07080002
070900     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07090002
071000         GIVING PV-TOP-ITEM.                                      07100002
071100                                                                  07110002
071200     IF  ((PV-TOP-ITEM < +1)                                      07120002
071300       OR (PV-TOP-ITEM = +1))                                     07130002
071400         MOVE +1                   TO PV-TOP-ITEM                 07140002
071500*        -- TOP OF LIST --                                        07150002
071600         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07160002
071700         SET DP020-MSG-INFORMATIONAL TO TRUE                      07170002
071800     END-IF.                                                      07180002
071900                                                                  07190002
072000*----------------------------------------------------------------*07200002
072100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07210002
072200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07220002
072300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07230002
072400*----------------------------------------------------------------*07240002
072500 2120-BROWSE-FORWARD.                                             07250002
072600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07260002
072700         GIVING PV-TOP-ITEM.                                      07270002
072800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07280002
072900         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             07290002
073000*        -- BOTTOM OF LIST --                                     07300002
073100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07310002
073200         SET DP020-MSG-INFORMATIONAL TO TRUE                      07320002
073300     ELSE                                                         07330002
073400         COMPUTE PV-BOTTOM-ITEM =                                 07340002
073500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07350002
073600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07360002
073700*            -- BOTTOM OF LIST --                                 07370002
073800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07380002
073900             SET DP020-MSG-INFORMATIONAL TO TRUE                  07390002
074000         END-IF                                                   07400002
074100     END-IF.                                                      07410002
074200                                                                  07420002
074300*----------------------------------------------------------------*07430002
074400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07440002
074500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07450002
074600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07460002
074700*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07470002
074800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07480002
074900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07490002
075000*----------------------------------------------------------------*07500002
075100 2130-CHECK-FOR-JUMP-BROWSE.                                      07510002
075200     SET PS-NO-ERROR               TO TRUE.                       07520002
075300     IF (ASC-START-ITEM-REQUEST = SPACE)                          07530002
075400         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             07540002
075500     ELSE                                                         07550002
075600         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     07560002
075700         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07570002
075800         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07580002
075900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07590002
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07601083
263455              USING DP010I-NUMERIC-EDIT-AREA                      07603083
076100                                                                  07610002
076200         IF  NOT DP010I-ERROR-DETECTED                            07620002
076300             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N07630002
076400             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07640002
076500                 IF  ASC-START-ITEM-REQUEST-N >                   07650002
076600                                          ASC-NUMBER-OF-ITEMS-READ07660002
076700                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07670002
076800                     COMPUTE PV-TOP-ITEM =                        07680002
076900                             ASC-NUMBER-OF-ITEMS-READ             07690002
077000                             - PC-ITEMS-PER-PANEL + 1             07700002
077100                     IF  PV-TOP-ITEM < +1                         07710002
077200                         MOVE +1   TO PV-TOP-ITEM                 07720002
077300                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 07730002
077400                         SET DP020-MSG-INFORMATIONAL TO TRUE      07740002
077500                     END-IF                                       07750002
077600                 ELSE                                             07760002
077700                     MOVE ASC-START-ITEM-REQUEST-N                07770002
077800                                   TO PV-TOP-ITEM                 07780002
077900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07790002
078000                     COMPUTE PV-BOTTOM-ITEM =                     07800002
078100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07810002
078200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07820002
078300*                        -- BOTTOM OF LIST --                     07830002
078400                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 07840002
078500                         SET DP020-MSG-INFORMATIONAL TO TRUE      07850002
078600                     END-IF                                       07860002
078700                 END-IF                                           07870002
078800             ELSE                                                 07880002
078900*                --- VALUE OUT OF RANGE ----                      07890002
079000                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         07900002
079100                 MOVE -1              TO ASTRTITL                 07910002
079200                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07920002
079300                 MOVE DP015-REVERSE   TO ASTRTITH                 07930002
079400                 MOVE DP015-RED       TO ASTRTITC                 07940002
079500                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           07950002
079600                 SET DP020-MSG-FATAL  TO TRUE                     07960002
079700                 SET PS-ERROR         TO TRUE                     07970002
079800             END-IF                                               07980002
079900         ELSE                                                     07990002
080000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08000002
080100             MOVE -1               TO ASTRTITL                    08010002
080200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08020002
080300             MOVE DP015-REVERSE    TO ASTRTITH                    08030002
080400             MOVE DP015-RED        TO ASTRTITC                    08040002
080500             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               08050002
080600             SET DP020-MSG-FATAL   TO TRUE                        08060002
080700             SET PS-ERROR          TO TRUE                        08070002
080800         END-IF                                                   08080002
080900     END-IF.                                                      08090002
081000                                                                  08100002
081100*----------------------------------------------------------------*08110002
081200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08120002
081300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08130002
081400*----------------------------------------------------------------*08140002
081500 2140-DESELECT-ALL-ITEMS.                                         08150002
081600     MOVE +1                       TO ASC-BLK-SUB.                08160002
081700                                                                  08170002
081800     PERFORM 2141-CLEAR-SELECTED-INDS                             08180002
081900         VARYING ASC-ITEM-SUB                                     08190002
082000         FROM 1 BY 1                                              08200002
082100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08210002
082200                                                                  08220002
082300     ADD +1                        TO ASC-BLK-SUB.                08230002
082400                                                                  08240002
082500     PERFORM 2141-CLEAR-SELECTED-INDS                             08250002
082600         VARYING ASC-ITEM-SUB                                     08260002
082700         FROM 1 BY 1                                              08270002
082800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08280002
082900                                                                  08290002
083000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08300002
083100                                   TO PV-LIST-ITEM-NUMBER.        08310002
083200                                                                  08320002
083300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08330002
083400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08340002
083500                                                                  08350002
083600     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            08360002
083700         MOVE +1                   TO ASC-BLK-SUB                 08370002
083800                                                                  08380002
083900         PERFORM 5100-WRITE-TEMP-STORAGE                          08390002
084000         MOVE +2                   TO ASC-BLK-SUB                 08400002
084100         PERFORM 5100-WRITE-TEMP-STORAGE                          08410002
084200         MOVE +1                   TO ASC-BLK-SUB                 08420002
084300         MOVE +1                   TO PV-BLOCK-NUMBER             08430002
084400     END-IF.                                                      08440002
084500                                                                  08450002
084600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08460002
084700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08470002
084800         MOVE +1                   TO ASC-BLK-SUB                 08480002
084900                                                                  08490002
085000         PERFORM 5100-WRITE-TEMP-STORAGE                          08500002
085100         MOVE +2  TO ASC-BLK-SUB                                  08510002
085200         PERFORM 5100-WRITE-TEMP-STORAGE                          08520002
085300         MOVE +1  TO ASC-BLK-SUB                                  08530002
085400         MOVE +1  TO PV-BLOCK-NUMBER                              08540002
085500                                                                  08550002
085600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08560002
085700             PV-FIRST-BLOCK-IN-ARRAY - 1                          08570002
085800                                                                  08580002
085900         PERFORM                                                  08590002
086000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08600002
086100                                                                  08610002
086200             PERFORM 4410-READ-TEMP-STORAGE                       08620002
086300                                                                  08630002
086400             PERFORM 2141-CLEAR-SELECTED-INDS                     08640002
086500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08650002
086600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08660002
086700                                                                  08670002
086800             PERFORM 5100-WRITE-TEMP-STORAGE                      08680002
086900                                                                  08690002
087000             ADD +1                TO PV-BLOCK-NUMBER             08700002
087100                                                                  08710002
087200         END-PERFORM                                              08720002
087300                                                                  08730002
087400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08740002
087500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08750002
087600                                                                  08760002
087700         PERFORM                                                  08770002
087800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08780002
087900                   ASC-HIGHEST-BLOCK-WRITTEN                      08790002
088000                                                                  08800002
088100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08810002
088200                                   TO PV-BLOCK-NUMBER             08820002
088300                                                                  08830002
088400             PERFORM 4410-READ-TEMP-STORAGE                       08840002
088500                                                                  08850002
088600             PERFORM 2141-CLEAR-SELECTED-INDS                     08860002
088700                 VARYING ASC-ITEM-SUB                             08870002
088800                 FROM 1 BY 1                                      08880002
088900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08890002
089000                                                                  08900002
089100             PERFORM 5100-WRITE-TEMP-STORAGE                      08910002
089200                                                                  08920002
089300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08930002
089400                                                                  08940002
089500         END-PERFORM                                              08950002
089600                                                                  08960002
089700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             08970002
089800                                   TO PV-BLOCK-NUMBER             08980002
089900                                                                  08990002
090000         PERFORM 4410-READ-TEMP-STORAGE                           09000002
090100     END-IF.                                                      09010002
090200                                                                  09020002
090300                                                                  09030002
090400     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 09040002
090500     MOVE +0                     TO ASC-START-OF-SELECTED-RANGE.  09050002
090600     MOVE +0                     TO ASC-END-OF-SELECTED-RANGE.    09060002
090700                                                                  09070002
090800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09080002
090900                                                                  09090002
091000*----------------------------------------------------------------*09100002
091100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09110002
091200*----------------------------------------------------------------*09120002
091300 2141-CLEAR-SELECTED-INDS.                                        09130002
091400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09140002
091500             NOT EQUAL ZERO                                       09150002
091600         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09160002
091700             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09170002
091800                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09180002
091900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          09190002
092000         END-IF                                                   09200002
092100     END-IF.                                                      09210002
092200                                                                  09220002
092300*----------------------------------------------------------------*09230002
092400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *09240002
092500*  FOR ALL ITEMS.                                                *09250002
092600*----------------------------------------------------------------*09260002
092700 2150-SELECT-ALL-ITEMS.                                           09270002
092710                                                                  09271066
092800     MOVE +1                       TO ASC-BLK-SUB.                09280002
092900                                                                  09290002
093000     PERFORM 2151-SET-SELECTED-INDS                               09300002
093100         VARYING ASC-ITEM-SUB                                     09310002
093200         FROM 1 BY 1                                              09320002
093300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09330002
093400                                                                  09340002
093500     ADD +1                        TO ASC-BLK-SUB.                09350002
093600                                                                  09360002
093700     PERFORM 2151-SET-SELECTED-INDS                               09370002
093800         VARYING ASC-ITEM-SUB                                     09380002
093900         FROM 1 BY 1                                              09390002
094000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09400002
094100                                                                  09410002
094200     MOVE ASC-LIST-ITEM-NUMBER(1 1)  TO PV-LIST-ITEM-NUMBER.      09420002
094300                                                                  09430002
094400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09440002
094500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09450002
094600                                                                  09460002
094700     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            09470002
094800         MOVE +1                   TO ASC-BLK-SUB                 09480002
094900                                                                  09490002
095000         PERFORM 5100-WRITE-TEMP-STORAGE                          09500002
095100         MOVE +2                   TO ASC-BLK-SUB                 09510002
095200         PERFORM 5100-WRITE-TEMP-STORAGE                          09520002
095300         MOVE +1                   TO ASC-BLK-SUB                 09530002
095400         MOVE +1                   TO PV-BLOCK-NUMBER             09540002
095500     END-IF.                                                      09550002
095600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09560002
095700        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09570002
095800         MOVE +1                   TO ASC-BLK-SUB                 09580002
095900                                                                  09590002
096000         PERFORM 5100-WRITE-TEMP-STORAGE                          09600002
096010         MOVE +2                   TO ASC-BLK-SUB                 09601066
096020         PERFORM 5100-WRITE-TEMP-STORAGE                          09602066
096030         MOVE +1                   TO ASC-BLK-SUB                 09603066
096040         MOVE +1                   TO PV-BLOCK-NUMBER             09604066
096100                                                                  09610002
096400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09640002
096500             PV-FIRST-BLOCK-IN-ARRAY - 1                          09650002
096600                                                                  09660002
096700         PERFORM                                                  09670002
096800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09680002
096900                                                                  09690002
097000             PERFORM 4410-READ-TEMP-STORAGE                       09700002
097100                                                                  09710002
097200             PERFORM 2151-SET-SELECTED-INDS                       09720002
097300                 VARYING ASC-ITEM-SUB                             09730002
097400                 FROM 1 BY 1                                      09740002
097500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09750002
097600                                                                  09760002
097700             PERFORM 5100-WRITE-TEMP-STORAGE                      09770002
097800                                                                  09780002
097900             ADD +1                TO PV-BLOCK-NUMBER             09790002
098000                                                                  09800002
098100         END-PERFORM                                              09810002
098200                                                                  09820002
098300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09830002
098400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09840002
098500                                                                  09850002
098600         PERFORM                                                  09860002
098700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09870002
098800                   ASC-HIGHEST-BLOCK-WRITTEN                      09880002
098900                                                                  09890002
099000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09900002
099100                                   TO PV-BLOCK-NUMBER             09910002
099200                                                                  09920002
099300             PERFORM 4410-READ-TEMP-STORAGE                       09930002
099400                                                                  09940002
099500             PERFORM 2151-SET-SELECTED-INDS                       09950002
099600                 VARYING ASC-ITEM-SUB                             09960002
099700                 FROM 1 BY 1                                      09970002
099800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09980002
099900                                                                  09990002
100000             PERFORM 5100-WRITE-TEMP-STORAGE                      10000002
100100                                                                  10010002
100200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10020002
100300                                                                  10030002
100400         END-PERFORM                                              10040002
100500                                                                  10050002
100600         MOVE PV-FIRST-BLOCK-IN-ARRAY  TO PV-BLOCK-NUMBER         10060002
100700                                                                  10070002
100800         PERFORM 4410-READ-TEMP-STORAGE                           10080002
100900     END-IF.                                                      10090002
101000                                                                  10100002
101100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10110002
101200                       ASC-NUMBER-OF-SELECTED-ITEMS.              10120002
101300                                                                  10130002
101400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10140002
101500                                                                  10150002
101600*----------------------------------------------------------------*10160002
101700*    MARK EACH ITEM AS BEING SELECTED.                           *10170002
101800*----------------------------------------------------------------*10180002
101900 2151-SET-SELECTED-INDS.                                          10190002
102000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10200002
102100             NOT EQUAL ZERO                                       10210002
102200         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10220002
102300             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10230002
102400                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10240002
102500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10250002
102600                               TO  TRUE                           10260002
102700         END-IF                                                   10270002
102800     END-IF.                                                      10280002
102900                                                                  10290002
103000******************************************************************10300002
103100** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10310002
103200** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10320002
103300******************************************************************10330002
103400 2200-MOVE-SCREEN-TO-COMMAREA.                                    10340002
103500                                                                  10350002
103600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10360002
103700     MOVE +1                       TO PV-SUB.                     10370002
103800                                                                  10380002
103900     PERFORM 3100-SET-SUBSCRIPTS.                                 10390002
104000                                                                  10400002
104100     IF  ASTRTITL > ZERO                                          10410002
104200         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10420002
104300     ELSE                                                         10430002
104400         IF  ASTRTITF = DP015-ERASE-EOF                           10440002
104500             INITIALIZE ASC-START-ITEM-REQUEST                    10450002
104600         END-IF                                                   10460002
104700     END-IF.                                                      10470002
104800                                                                  10480002
104900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10490002
105000         VARYING PV-SUB FROM 1 BY 1                               10500002
105100         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10510002
105200                                                                  10520002
105300******************************************************************10530002
105400** MOVE THE ENTERABLE FIELDS OF EACH LIST LINE INTO THE COMMAREA**10540002
105500******************************************************************10550002
105600 2210-MOVE-LINES-TO-COMMAREA.                                     10560002
105700     IF  MR-SELECTL (PV-SUB) > ZERO                               10570002
105800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10580002
105900         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        10590002
106000                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 10600002
106100     ELSE                                                         10610002
106200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10620002
106300                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10630002
106400                 MOVE SPACE  TO ASC-TEMP-SELECTED-SW              10640002
106500                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 10650002
106600         END-IF                                                   10660002
106700     END-IF.                                                      10670002
106800                                                                  10680002
106900     ADD +1                        TO ASC-ITEM-SUB.               10690002
107000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10700002
107100         ADD +1                    TO ASC-BLK-SUB                 10710002
107200         MOVE +1                   TO ASC-ITEM-SUB                10720002
107300     END-IF.                                                      10730002
107400                                                                  10740002
107500******************************************************************10750002
107600** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10760002
107700** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10770002
107800******************************************************************10780002
107900 3000-EDIT-DATA-IN-COMMAREA.                                      10790002
108000     PERFORM 3200-RESET-ATTRIBUTES.                               10800002
108100     SET PS-NO-ERROR               TO TRUE.                       10810002
108200     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10820002
108300                                                                  10830002
108400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10840002
108500* EDITTING IS DONE FROM THE BOTTOM UP.                            10850002
108600                                                                  10860002
108700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10870002
108800         ASC-ITEMS-DISPLAYED - 1.                                 10880002
108900     PERFORM 3100-SET-SUBSCRIPTS.                                 10890002
109000                                                                  10900002
109100      IF  PS-NO-ERROR                                             10910002
109200          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       10920002
109300      END-IF.                                                     10930002
109400                                                                  10940002
109500     IF  PS-NO-ERROR                                              10950002
109600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        10960002
109700     END-IF.                                                      10970002
109800                                                                  10980002
109900     IF  ((PS-NO-ERROR)                                           10990002
110000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11000002
110100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11010002
110200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11020002
110300     END-IF.                                                      11030002
110400                                                                  11040002
110500*----------------------------------------------------------------*11050002
110600* 3005-EDIT-COMMAREA-BLOCKS                                      *11060002
110700*----------------------------------------------------------------*11070002
110800 3005-EDIT-COMMAREA-BLOCKS.                                       11080002
110900     MOVE +1                       TO PV-BLOCK-NUMBER.            11090002
111000     MOVE +1                       TO ASC-BLK-SUB.                11100002
111100     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               11110002
111200                                                                  11120002
111300     COMPUTE PV-BLOCK-NUMBER  =                                   11130002
111400             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            11140002
111500             PC-ITEMS-PER-PANEL.                                  11150002
111600                                                                  11160002
111700     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          11170002
111800                                                                  11180002
111900     PERFORM                                                      11190002
112000        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         11200002
112100           OR PS-ERROR                                            11210002
112200           OR PS-BLOCK-ERROR                                      11220002
112300                                                                  11230002
112400              COMPUTE PV-ITEMS-HOLD  =                            11240002
112500                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       11250002
112600                      PC-ITEMS-PER-PANEL - 1                      11260002
112700                                                                  11270002
112800               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     11280002
112900                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             11290002
113000                       FROM  PV-ITEMS-HOLD                        11300002
113100                     GIVING  PV-ITEMS-DIFF                        11310002
113200                   SUBTRACT  PV-ITEMS-DIFF                        11320002
113300                       FROM  PC-ITEMS-PER-PANEL                   11330002
113400                     GIVING  PV-ITEMS-HOLD                        11340002
113500                       MOVE  PV-ITEMS-HOLD TO PV-SUB              11350002
113600                                              ASC-ITEM-SUB        11360002
113700                                              ASC-ITEMS-DISPLAYED 11370002
113800               ELSE                                               11380002
113900                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            11390002
114000                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      11400002
114100               END-IF                                             11410002
114200                                                                  11420002
114300               PERFORM 3300-EDIT-SELECTIONS                       11430002
114400                       VARYING PV-SUB                             11440002
114500                          FROM PV-SUB BY -1                       11450002
114600                          UNTIL PV-SUB < +1                       11460002
114700                                                                  11470002
114800               MOVE +1               TO ASC-BLK-SUB               11480002
114900                                                                  11490002
115000               PERFORM 5105-REWRITE-ASC-LISTQ                     11500002
115100                                                                  11510002
115200               MOVE +1                TO ASC-BLK-SUB              11520002
115300                                                                  11530002
115400               IF  PS-BLOCK-ERROR                                 11540002
115500                   SET  PS-ERROR     TO TRUE                      11550002
115600                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      11560002
115700                                     TO PV-TOP-ITEM               11570002
115800               ELSE                                               11580002
115900                   ADD  +1           TO PV-BLOCK-NUMBER           11590002
116000                   IF  PV-BLOCK-NUMBER >                          11600002
116100                       ASC-HIGHEST-BLOCK-WRITTEN                  11610002
116200                       MOVE +2       TO ASC-BLK-SUB               11620002
116300                       PERFORM 4410-READ-TEMP-STORAGE             11630002
116400                       MOVE +1       TO ASC-BLK-SUB               11640002
116500                   ELSE                                           11650002
116600                       PERFORM 4410-READ-TEMP-STORAGE             11660002
116700                       ADD  +1        TO PV-BLOCK-NUMBER          11670002
116800                       MOVE +2        TO ASC-BLK-SUB              11680002
116900                       PERFORM 4410-READ-TEMP-STORAGE             11690002
117000                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          11700002
117100                       MOVE +1        TO ASC-BLK-SUB              11710002
117200               END-IF                                             11720002
117300           END-IF                                                 11730002
117400     END-PERFORM.                                                 11740002
117500                                                                  11750002
117600     IF  (PV-ORIGINAL-BLOCK  = +1   AND                           11760002
117700          ASC-LIST-ITEM-NUMBER (1 1) = 1)  OR                     11770002
117800         PS-ERROR                   OR                            11780002
117900         PS-BLOCK-ERROR                                           11790002
118000             CONTINUE                                             11800002
118100     ELSE                                                         11810002
118200         MOVE +1                 TO PV-BLOCK-NUMBER               11820002
118300         MOVE +1                 TO ASC-BLK-SUB                   11830002
118400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  11840002
118500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           11850002
118600         PERFORM 4410-READ-TEMP-STORAGE                           11860002
118700                                                                  11870002
118800         PERFORM                                                  11880002
118900            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             11890002
119000               OR PS-ERROR                                        11900002
119100               OR PS-BLOCK-ERROR                                  11910002
119200                                                                  11920002
119300                  COMPUTE PV-ITEMS-HOLD  =                        11930002
119400                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   11940002
119500                          PC-ITEMS-PER-PANEL - 1                  11950002
119600                                                                  11960002
119700                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    11970002
119800                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          11980002
119900                          FROM  PV-ITEMS-HOLD                     11990002
120000                        GIVING  PV-ITEMS-DIFF                     12000002
120100                      SUBTRACT  PV-ITEMS-DIFF                     12010002
120200                          FROM  PC-ITEMS-PER-PANEL                12020002
120300                        GIVING  PV-ITEMS-HOLD                     12030002
120400                          MOVE  PV-ITEMS-HOLD TO PV-SUB           12040002
120500                                                 ASC-ITEM-SUB     12050002
120600                                              ASC-ITEMS-DISPLAYED 12060002
120700                  ELSE                                            12070002
120800                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         12080002
120900                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   12090002
121000                  END-IF                                          12100002
121100                                                                  12110002
121200                  PERFORM 3300-EDIT-SELECTIONS                    12120002
121300                          VARYING PV-SUB                          12130002
121400                             FROM PV-SUB BY -1                    12140002
121500                            UNTIL PV-SUB < +1                     12150002
121600                                                                  12160002
121700                  MOVE +1               TO ASC-BLK-SUB            12170002
121800                                                                  12180002
121900                  PERFORM 5105-REWRITE-ASC-LISTQ                  12190002
122000                                                                  12200002
122100                  MOVE +1                TO ASC-BLK-SUB           12210002
122200                                                                  12220002
122300                  IF  PS-BLOCK-ERROR                              12230002
122400                      SET  PS-ERROR     TO TRUE                   12240002
122500                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   12250002
122600                                        TO PV-TOP-ITEM            12260002
122700                  ELSE                                            12270002
122800                      ADD  +1            TO PV-BLOCK-NUMBER       12280002
122900                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     12290002
123000                          MOVE +2        TO ASC-BLK-SUB           12300002
123100                          PERFORM 4410-READ-TEMP-STORAGE          12310002
123200                          MOVE +1        TO ASC-BLK-SUB           12320002
123300                      ELSE                                        12330002
123400                          PERFORM 4410-READ-TEMP-STORAGE          12340002
123500                          ADD  +1        TO PV-BLOCK-NUMBER       12350002
123600                          MOVE +2        TO ASC-BLK-SUB           12360002
123700                          PERFORM 4410-READ-TEMP-STORAGE          12370002
123800                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       12380002
123900                          MOVE +1        TO ASC-BLK-SUB           12390002
124000                      END-IF                                      12400002
124100                  END-IF                                          12410002
124200     END-PERFORM.                                                 12420002
124300     MOVE +0 TO PV-ITEMS-HOLD.                                    12430002
124400                                                                  12440002
124500*----------------------------------------------------------------*12450002
124600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12460002
124700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12470002
124800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12480002
124900*                                                                *12490002
125000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12500002
125100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12510002
125200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12520002
125300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12530002
125400*----------------------------------------------------------------*12540002
125500 3100-SET-SUBSCRIPTS.                                             12550002
125600     COMPUTE ASC-ITEM-SUB =                                       12560002
125700         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12570002
125800                                                                  12580002
125900     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12590002
126000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12600002
126100         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12610002
126200     ELSE                                                         12620002
126300         MOVE +1                     TO ASC-BLK-SUB               12630002
126400     END-IF.                                                      12640002
126500                                                                  12650002
126600******************************************************************12660002
126700** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **12670002
126800******************************************************************12680002
126900 3200-RESET-ATTRIBUTES.                                           12690002
127000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12700002
127100     MOVE DP015-GREEN              TO ASTRTITC.                   12710002
127200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12720002
127300                                                                  12730002
127400     PERFORM                                                      12740002
127500         VARYING PV-SUB                                           12750002
127600         FROM 1 BY 1                                              12760002
127700         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        12770002
127800         MOVE DP015-UNP-ALP-NOR-OFF                               12780002
127900                                   TO MR-SELECTA   (PV-SUB)       12790002
128000         MOVE DP015-GREEN          TO MR-SELECTC   (PV-SUB)       12800002
128100         MOVE DP015-UNDERLINE      TO MR-SELECTH   (PV-SUB)       12810002
128200     END-PERFORM.                                                 12820002
128300                                                                  12830002
128400******************************************************************12840002
128500** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **12850002
128600** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **12860002
128700** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **12870002
128800** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **12880002
128900******************************************************************12890002
129000 3300-EDIT-SELECTIONS.                                            12900002
129100     EVALUATE TRUE                                                12910002
129200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12920002
129300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12930002
129400                 CONTINUE                                         12940002
129500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12950002
129600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12960002
129700                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12970002
129800                 MOVE ASC-TEMP-SELECTED-SW                        12980002
129900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12990002
130000                                TO ASC-SELECTED-SW                13000002
130100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13010002
130200             END-IF                                               13020002
130300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13030002
130400                 = SPACE                                          13040002
130500             EVALUATE TRUE                                        13050002
130600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13060002
130700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13070002
130800                     MOVE SPACE TO ASC-SELECTED-SW                13080002
130900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13090002
131000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13100002
131100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13110002
131200                     MOVE SPACE TO ASC-SELECTED-SW                13120002
131300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13130002
131400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13140002
131500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13150002
131600                     MOVE SPACE TO ASC-SELECTED-SW                13160002
131700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13170002
131800             END-EVALUATE                                         13180002
131900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13190002
132000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13200002
132100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13210002
132200             END-IF                                               13220002
132300             PERFORM 3310-EDIT-RANGE                              13230002
132400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13240002
132500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13250002
132600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13260002
132700             END-IF                                               13270002
132800             PERFORM 3310-EDIT-RANGE                              13280002
132900         WHEN OTHER                                               13290002
133000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13300002
133100             SET DP020-MSG-FATAL    TO TRUE                       13310002
133200             MOVE -1                TO ASTRTITL                   13320002
133300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13330002
133400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13340002
133500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13350002
133600             SET PS-ERROR TO TRUE                                 13360002
133700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13370002
133800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13380002
133900                 MOVE SPACE         TO ASC-SELECTED-SW            13390002
134000                                        (ASC-BLK-SUB ASC-ITEM-SUB)13400002
134100             END-IF                                               13410002
134200     END-EVALUATE.                                                13420002
134300                                                                  13430002
134400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13440002
134500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13450002
134600     IF  ASC-ITEM-SUB < 1                                         13460002
134700         SUBTRACT +1 FROM ASC-BLK-SUB                             13470002
134800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13480002
134900     END-IF.                                                      13490002
135000                                                                  13500002
135100******************************************************************13510002
135200** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **13520002
135300** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **13530002
135400** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**13540002
135500** THE ENDING.                                                  **13550002
135600******************************************************************13560002
135700 3310-EDIT-RANGE.                                                 13570002
135800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13580002
135900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13590002
136000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13600002
136100                                   TO ASC-SELECTED-SW             13610002
136200                                        (ASC-BLK-SUB ASC-ITEM-SUB)13620002
136300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13630002
136400         ELSE                                                     13640002
136500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13650002
136600                 CONTINUE                                         13660002
136700             ELSE                                                 13670002
136800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13680002
136900                 MOVE PC-TSYMSG-00054                             13690002
137000                                   TO DP020-MSG-NUMBER            13700002
137100                 SET DP020-MSG-FATAL                              13710002
137200                                   TO TRUE                        13720002
137300                 MOVE -1           TO ASTRTITL                    13730002
137400                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              13740002
137500                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         13750002
137600                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      13760002
137700                 SET PS-ERROR      TO TRUE                        13770002
137800             END-IF                                               13780002
137900         END-IF                                                   13790002
138000     ELSE                                                         13800002
138100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13810002
138200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13820002
138300                                   TO ASC-SELECTED-SW             13830002
138400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13840002
138500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13850002
138600         ELSE                                                     13860002
138700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13870002
138800                 CONTINUE                                         13880002
138900             ELSE                                                 13890002
139000*                -- ONLY ONE END-OF-RANGE ALLOWED --              13900002
139100                 MOVE PC-TSYMSG-00055                             13910002
139200                                   TO DP020-MSG-NUMBER            13920002
139300                 SET DP020-MSG-FATAL                              13930002
139400                                   TO TRUE                        13940002
139500                 MOVE -1           TO ASTRTITL                    13950002
139600                 SET DP030-SET-CURSOR-APPL-1                      13960002
139700                                   TO TRUE                        13970002
139800                 SET PS-ERROR      TO TRUE                        13980002
139900             END-IF                                               13990002
140000         END-IF                                                   14000002
140100     END-IF.                                                      14010002
140200                                                                  14020002
140300******************************************************************14030002
140400** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **14040002
140500** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **14050002
140600******************************************************************14060002
140700 3400-CHECK-RANGE-SEQUENCE.                                       14070002
140800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14080002
140900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14090002
141000       AND  ASC-START-OF-SELECTED-RANGE >                         14100002
141100                                         ASC-END-OF-SELECTED-RANGE14110002
141200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14120002
141300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14130002
141400         SET DP020-MSG-FATAL TO TRUE                              14140002
141500         SET PS-ERROR TO TRUE                                     14150002
141600         PERFORM 3410-POSITION-AT-ERROR                           14160002
141700     END-IF.                                                      14170002
141800                                                                  14180002
141900******************************************************************14190002
142000** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **14200002
142100** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **14210002
142200** SHOULD BE POSITIONED ON A RANGE ERROR.                       **14220002
142300******************************************************************14230002
142400 3410-POSITION-AT-ERROR.                                          14240002
142500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       14250002
142600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14260002
142700                    - PV-TOP-ITEM + 1.                            14270002
142800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14280002
142900         CONTINUE                                                 14290002
143000     ELSE                                                         14300002
143100         MOVE -1                   TO MR-SELECTL (PV-SUB)         14310002
143200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14320002
143300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14330002
143400     END-IF.                                                      14340002
143500                                                                  14350002
143600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14360002
143700                    - PV-TOP-ITEM + 1.                            14370002
143800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14380002
143900         CONTINUE                                                 14390002
144000     ELSE                                                         14400002
144100         MOVE -1                   TO MR-SELECTL (PV-SUB)         14410002
144200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14420002
144300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14430002
144400     END-IF.                                                      14440002
144500                                                                  14450002
144600*----------------------------------------------------------------*14460002
144700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14470002
144800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14480002
144900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14490002
145000*----------------------------------------------------------------*14500002
145100 3500-MARK-RANGE-AS-SELECTED.                                     14510002
145200     MOVE +1                       TO  ASC-BLK-SUB.               14520002
145300     PERFORM 3510-MARK-SELECTED-INDS                              14530002
145400         VARYING ASC-ITEM-SUB                                     14540002
145500         FROM 1 BY 1                                              14550002
145600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14560002
145700                                                                  14570002
145800     ADD +1                        TO ASC-BLK-SUB.                14580002
145900     PERFORM 3510-MARK-SELECTED-INDS                              14590002
146000         VARYING ASC-ITEM-SUB                                     14600002
146100         FROM 1 BY 1                                              14610002
146200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14620002
146300                                                                  14630002
146400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14640002
146500                                   TO  PV-LIST-ITEM-NUMBER.       14650002
146600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14660002
146700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14670002
146800               PC-ITEMS-PER-PANEL).                               14680002
146900                                                                  14690002
147000     MOVE ASC-START-OF-SELECTED-RANGE                             14700002
147100                                   TO PV-START-OF-SELECTED-RANGE. 14710002
147200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14720002
147300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14730002
147400               PC-ITEMS-PER-PANEL).                               14740002
147500                                                                  14750002
147600     MOVE ASC-END-OF-SELECTED-RANGE                               14760002
147700                                   TO  PV-END-OF-SELECTED-RANGE.  14770002
147800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14780002
147900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14790002
148000               PC-ITEMS-PER-PANEL).                               14800002
148100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14810002
148200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14820002
148300                                                                  14830002
148400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14840002
148500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14850002
148600         MOVE +1                   TO ASC-BLK-SUB                 14860002
148700         PERFORM 5100-WRITE-TEMP-STORAGE                          14870002
148800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14880002
148900             PV-FIRST-BLOCK-IN-ARRAY - 1                          14890002
149000                                                                  14900002
149100         PERFORM                                                  14910002
149200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14920002
149300                   PV-PREV-BLOCK-IN-ARRAY                         14930002
149400             MOVE PV-FIRST-BLOCK-IN-RANGE                         14940002
149500                                   TO PV-BLOCK-NUMBER             14950002
149600             PERFORM 4410-READ-TEMP-STORAGE                       14960002
149700             PERFORM 3510-MARK-SELECTED-INDS                      14970002
149800                 VARYING ASC-ITEM-SUB                             14980002
149900                 FROM 1 BY 1                                      14990002
150000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15000002
150100             PERFORM 5100-WRITE-TEMP-STORAGE                      15010002
150200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15020002
150300         END-PERFORM                                              15030002
150400                                                                  15040002
150500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15050002
150600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15060002
150700         PERFORM                                                  15070002
150800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15080002
150900                   PV-LAST-BLOCK-IN-RANGE                         15090002
151000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15100002
151100                                   TO PV-BLOCK-NUMBER             15110002
151200             PERFORM 4410-READ-TEMP-STORAGE                       15120002
151300             PERFORM 3510-MARK-SELECTED-INDS                      15130002
151400                 VARYING ASC-ITEM-SUB                             15140002
151500                 FROM 1 BY 1                                      15150002
151600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15160002
151700             PERFORM 5100-WRITE-TEMP-STORAGE                      15170002
151800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15180002
151900         END-PERFORM                                              15190002
152000                                                                  15200002
152100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15210002
152200                                   TO PV-BLOCK-NUMBER             15220002
152300         PERFORM 4410-READ-TEMP-STORAGE                           15230002
152400     END-IF.                                                      15240002
152500                                                                  15250002
152600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15260002
152700                                      ASC-END-OF-SELECTED-RANGE.  15270002
152800                                                                  15280002
152900*----------------------------------------------------------------*15290002
153000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15300002
153100*----------------------------------------------------------------*15310002
153200 3510-MARK-SELECTED-INDS.                                         15320002
153300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15330002
153400                                ASC-ITEM-SUB) >                   15340002
153500         ASC-START-OF-SELECTED-RANGE)                             15350002
153600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15360002
153700                                ASC-ITEM-SUB) =                   15370002
153800         ASC-START-OF-SELECTED-RANGE)                             15380002
153900                                                                  15390002
154000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15400002
154100                                    ASC-ITEM-SUB) <               15410002
154200             ASC-END-OF-SELECTED-RANGE)                           15420002
154300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15430002
154400                                    ASC-ITEM-SUB) =               15440002
154500             ASC-END-OF-SELECTED-RANGE)                           15450002
154600                                                                  15460002
154700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15470002
154800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15480002
154900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15490002
155000                               TO TRUE                            15500002
155100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15510002
155200                               TO TRUE                            15520002
155300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    15530002
155400             END-IF                                               15540002
155500         END-IF                                                   15550002
155600     END-IF.                                                      15560002
155700                                                                  15570002
155800*----------------------------------------------------------------*15580002
155900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15590002
156000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15600002
156100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15610002
156200*    DISPLAY THE PANEL TO USER.                                  *15620002
156300*----------------------------------------------------------------*15630002
156400 4000-BUILD-INITIAL-PANEL.                                        15640002
156500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            15650002
156600                                 ASC-BLOCK-ENTRIES (2).           15660002
156700     MOVE +1                   TO ASC-BLK-SUB.                    15670002
156800     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           15680002
156900                                                                  15690002
157000     MOVE +0                 TO ASC-ITEM-SUB                      15700002
157100                                ASC-NUMBER-OF-ITEMS-READ          15710002
157200                                ASC-NUMBER-OF-SELECTED-ITEMS      15720002
157300                                ASC-HIGHEST-BLOCK-WRITTEN         15730002
157400                                ASC-START-OF-SELECTED-RANGE       15740002
157500                                ASC-END-OF-SELECTED-RANGE         15750002
157600                                ASC-ITEM-AT-TOP-OF-PANEL.         15760002
157700                                                                  15770002
157800     PERFORM 4100-PREPARE-CURSOR.                                 15780002
157900     PERFORM 4010-OPEN-CURSOR.                                    15790002
158000     PERFORM 4300-READ-ITEMS-FROM-DB.                             15800002
158100     PERFORM 4020-CLOSE-CURSOR.                                   15810002
158200                                                                  15820002
158300     MOVE +1                   TO  PV-TOP-ITEM.                   15830002
158400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          15840002
158500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    15850002
158600         SET DP020-MSG-FATAL   TO  TRUE                           15860002
158700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               15870002
158800     ELSE                                                         15880002
158900         MOVE -1               TO MR-SELECTL (1)                  15890002
159000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      15900002
159100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15910002
159200     END-IF.                                                      15920002
159300                                                                  15930002
159400                                                                  15940002
159500*----------------------------------------------------------------*15950002
159600* OPEN THE CURSOR.                                               *15960002
159700*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *15970002
159800*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *15980002
159900*   ASSOCIATE.                                                   *15990002
160000*----------------------------------------------------------------*16000002
160100 4010-OPEN-CURSOR.                                                16010002
160200     PERFORM                                                      16020002
160300         WITH TEST AFTER                                          16030002
160400         VARYING PV-RETRY-COUNTER                                 16040002
160500         FROM 1 BY 1                                              16050002
160600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16060002
160700                   OR (SQLCODE = ZERO))                           16070002
160800                                                                  16080002
161100              MOVE 'CURSOR:  PARM-CSR        '                    16110003
161200                                        TO DP013-MESSAGE-TEXT (2) 16120002
161300              EXEC SQL                                            16130003
161400                   OPEN PARM-CSR                                  16140003
161500              END-EXEC                                            16150003
161600                                                                  16160002
162600                                                                  16260002
162700         EVALUATE TRUE                                            16270002
162800             WHEN SQLCODE = ZERO                                  16280002
162900             WHEN SQLCODE = -904                                  16290002
163000             WHEN SQLCODE = -913                                  16300002
163100                 CONTINUE                                         16310002
163200             WHEN SQLWARN0 NOT = SPACES                           16320002
163300             WHEN SQLCODE < ZERO                                  16330002
163400             WHEN SQLCODE > ZERO                                  16340002
163500                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       16350002
163600                 MOVE 'UNABLE TO OPEN A CURSOR -'                 16360002
163700                                   TO DP013-MESSAGE-TEXT (1)      16370002
163800                 MOVE SQLCA        TO DP013-SQLCA                 16380002
163900                 MOVE 'TKRPRPM '   TO DP013-DB2-TABLE-NAME (1)    16390003
164000                 SET DP013-DB2-ABEND                              16400002
164100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16410002
164200                 PERFORM DP013-0000-PROCESS-ABEND                 16420002
164300         END-EVALUATE                                             16430002
164400     END-PERFORM.                                                 16440002
164500                                                                  16450002
164600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16460002
164700         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             16470002
164800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   16480002
164900                                   TO DP013-MESSAGE-TEXT (1)      16490002
165000         MOVE SQLCA                TO DP013-SQLCA                 16500002
165100         MOVE 'TKRPRCD '           TO DP013-DB2-TABLE-NAME (1)    16510002
165200         SET DP013-DB2-ABEND                                      16520002
165300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16530002
165400         PERFORM DP013-0000-PROCESS-ABEND                         16540002
165500     END-IF.                                                      16550002
165600                                                                  16560002
165700*----------------------------------------------------------------*16570002
165800* CLOSE THE CURSOR                                               *16580002
165900*----------------------------------------------------------------*16590002
166000 4020-CLOSE-CURSOR.                                               16600002
166300      EXEC SQL                                                    16630003
166400           CLOSE PARM-CSR                                         16640003
166500      END-EXEC                                                    16650003
166600                                                                  16660002
167300                                                                  16730002
167400     EVALUATE TRUE                                                16740002
167500         WHEN SQLCODE = ZERO                                      16750002
167600             CONTINUE                                             16760002
167700         WHEN SQLWARN0 NOT = SPACES                               16770002
167800         WHEN SQLCODE < ZERO                                      16780002
167900         WHEN SQLCODE > ZERO                                      16790002
168000             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          16800002
168100             MOVE 'UNABLE TO CLOSE CURSOR '                       16810002
168200                               TO DP013-MESSAGE-TEXT (1)          16820002
168300             MOVE SQLCA        TO DP013-SQLCA                     16830002
168400             MOVE 'TKRPRPM '   TO DP013-DB2-TABLE-NAME (1)        16840003
168500             SET DP013-DB2-ABEND                                  16850002
168600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16860002
168700             PERFORM DP013-0000-PROCESS-ABEND                     16870002
168800     END-EVALUATE.                                                16880002
168900                                                                  16890002
169000*----------------------------------------------------------------*16900002
169100*    SET UP THE HOST VARIABLES.                                  *16910002
169200*----------------------------------------------------------------*16920002
169300 4100-PREPARE-CURSOR.                                             16930002
169400                                                                  16940002
169500     MOVE ASC-PARM-NAME        TO  DK-CODE-PARM.                  16950002
169600                                                                  16960002
170200                                                                  17020002
170300*----------------------------------------------------------------*17030002
170400*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17040002
170500*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17050002
170600*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17060002
170700*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17070002
170800*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17080002
170900*                                                                *17090002
171000*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17100002
171100*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17110002
171200*    UPON INITIALIZATION.                                        *17120002
171300*----------------------------------------------------------------*17130002
171400 4300-READ-ITEMS-FROM-DB.                                         17140002
171500     PERFORM                                                      17150002
171600         VARYING PV-READ-COUNT                                    17160002
171700         FROM 1 BY 1                                              17170002
171800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17180002
171900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17190002
172000                                                                  17200002
172100        PERFORM 4310-FETCH                                        17210002
172200                                                                  17220002
172300         IF  ASC-ITEMS-LEFT-ON-DB                                 17230002
172400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17240002
172500                 ADD +1            TO ASC-ITEM-SUB                17250002
172600             ELSE                                                 17260002
172700                 ADD +1            TO ASC-BLK-SUB                 17270002
172800                 MOVE +1           TO ASC-ITEM-SUB                17280002
172900                                                                  17290002
173000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         17300002
173100                     MOVE +1       TO ASC-BLK-SUB                 17310002
173200                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           17320002
173300                     PERFORM 5100-WRITE-TEMP-STORAGE              17330002
173400                     MOVE ASC-BLOCK-ENTRIES                       17340002
173500                               (PC-MAX-BLOCKS-IN-ARRAY)           17350002
173600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 17360002
173700                     ADD +1        TO ASC-BLK-SUB                 17370002
173800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   17380002
173900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      17390002
174000                                   TO TRUE                        17400002
174100                 END-IF                                           17410002
174200             END-IF                                               17420002
174300             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    17430002
174400             MOVE ASC-NUMBER-OF-ITEMS-READ                        17440002
174500                                   TO ASC-LIST-ITEM-NUMBER        17450002
174600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17460002
174700             EVALUATE TRUE                                        17470002
174800                 WHEN CN014-FUNCTION-NONE                         17480002
174900                     MOVE SPACES TO ASC-ACTION                    17490002
175000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17500002
175100                 WHEN CN014-UPD-CODE                              17510002
175200                     MOVE PC-UPD TO ASC-ACTION                    17520002
175300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17530002
175400                 WHEN CN018-UPD-TKRPRCD                           17540002
175500                     MOVE PC-UPD TO ASC-ACTION                    17550002
175600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17560002
175700             END-EVALUATE                                         17570002
176510             MOVE  KRPRPM-LOC-ID           TO  ASC-OPER-UNIT      17651003
176511                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17651107
176520             MOVE  KRPRPM-INTFC-SYS-CDE    TO  ASC-SYS-INTRFC-CDE 17652003
176530                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17653007
176540             MOVE  KRPRPM-FUNC-PRC-STAT-CDE TO  ASC-STATUS        17654003
176541                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17654107
176542                                                                  17654274
176543             IF  PV-NULL-BEG-TMST  =  -1                          17654374
176544                 MOVE  SPACES              TO ASC-FROM-TMST       17654474
176545                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17654574
176546                 MOVE  'Y'                 TO ASC-FROM-TMST-NULL  17654674
176547                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17654774
176548             ELSE                                                 17654874
176550                 MOVE  KRPRPM-FUNC-BEG-TMST TO ASC-FROM-TMST      17655074
176551                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17655176
176552             END-IF                                               17655274
176553                                                                  17655374
176554             IF  PV-NULL-END-TMST  =  -1                          17655474
176555                 MOVE  SPACES              TO ASC-TO-TMST         17655574
176556                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17655674
176557                 MOVE  'Y'                 TO ASC-TO-TMST-NULL    17655774
176558                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17655874
176559             ELSE                                                 17655974
176560                 MOVE  KRPRPM-FUNC-END-TMST TO ASC-TO-TMST        17656074
176561                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17656107
176562             END-IF                                               17656274
176572                                                                  17657274
176573             IF  PV-NULL-FUNC-QTY  =  -1                          17657339
176574                 MOVE  ZEROES              TO ASC-FUNC-QTY        17657439
176575                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17657539
176576                 MOVE  'Y'                 TO ASC-FUNC-QTY-NULL   17657674
176577                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17657774
176578             ELSE                                                 17657839
176579                 MOVE  KRPRPM-FUNC-QTY     TO ASC-FUNC-QTY        17657939
176580                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17658039
176581             END-IF                                               17658139
176582                                                                  17658239
176583             IF  PV-NULL-FUNC-PCT  =  -1                          17658339
176584                 MOVE  ZEROES              TO ASC-FUNC-PCNT       17658439
176585                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17658539
176586                 MOVE  'Y'                 TO ASC-FUNC-PCNT-NULL  17658674
176587                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17658774
176588             ELSE                                                 17658839
176589                 MOVE  KRPRPM-FUNC-PCT     TO ASC-FUNC-PCNT       17658939
176590                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17659039
176591             END-IF                                               17659139
176592                                                                  17659239
176593             IF  PV-NULL-FUNC-TXT  =  -1                          17659339
176594                 MOVE  SPACES              TO ASC-FUNC-TEXT       17659439
176595                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17659539
176596                 MOVE  'Y'                 TO ASC-FUNC-TEXT-NULL  17659674
176597                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17659774
176598             ELSE                                                 17659839
176599                 MOVE  KRPRPM-FUNC-TXT     TO ASC-FUNC-TEXT       17659939
176600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17660039
176601             END-IF                                               17660139
176602                                                                  17660239
176603             MOVE  KRPRPM-FUNC-WD-QTY      TO ASC-FUNC-WD         17660303
176604                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17660407
176605             MOVE  KRPRPM-FUNC-DPTH-QTY    TO ASC-FUNC-DPTH       17660503
176606                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17660607
176607             MOVE  KRPRPM-FUNC-HT-QTY      TO ASC-FUNC-HT         17660703
176608                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17660807
176609             MOVE  KRPRPM-FUNC-WT-QTY      TO ASC-FUNC-WT         17660903
176610                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17661007
176630                                                                  17663024
176734         END-IF                                                   17673422
176740     END-PERFORM.                                                 17674002
176800                                                                  17680002
176900     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17690002
177000         MOVE +1               TO ASC-BLK-SUB                     17700002
177100         PERFORM 5100-WRITE-TEMP-STORAGE                          17710002
177200         ADD +1                TO ASC-BLK-SUB                     17720002
177300         PERFORM 5100-WRITE-TEMP-STORAGE                          17730002
177400                                                                  17740002
177500         MOVE 1                TO ASC-BLK-SUB                     17750002
177600                                  PV-BLOCK-NUMBER                 17760002
177700         PERFORM 4410-READ-TEMP-STORAGE                           17770002
177800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17780002
177900             MOVE 2            TO ASC-BLK-SUB                     17790002
178000                                  PV-BLOCK-NUMBER                 17800002
178100             PERFORM 4410-READ-TEMP-STORAGE                       17810002
178200         END-IF                                                   17820002
178300     END-IF.                                                      17830002
178400                                                                  17840002
178500*----------------------------------------------------------------*17850002
178600*    FETCH THE CURSOR                                             17860002
178700*----------------------------------------------------------------*17870002
178800 4310-FETCH.                                                      17880002
179100       EXEC SQL                                                   17910003
179200            FETCH PARM-CSR                                        17920005
179300             INTO                                                 17930003
179600                  :KRPRPM-LOC-ID                                  17960003
179610                , :KRPRPM-INTFC-SYS-CDE                           17961003
179620                , :KRPRPM-SYS-PRC-FUNC-CDE                        17962003
179630                , :KRPRPM-FUNC-PRC-STAT-CDE                       17963003
179640                , :KRPRPM-FUNC-BEG-TMST  :PV-NULL-BEG-TMST        17964024
179650                , :KRPRPM-FUNC-END-TMST  :PV-NULL-END-TMST        17965024
179660                , :KRPRPM-FUNC-QTY       :PV-NULL-FUNC-QTY        17966022
179670                , :KRPRPM-FUNC-PCT       :PV-NULL-FUNC-PCT        17967022
179680                , :KRPRPM-FUNC-TXT       :PV-NULL-FUNC-TXT        17968022
179690                , :KRPRPM-FUNC-WD-QTY                             17969029
179691                , :KRPRPM-FUNC-DPTH-QTY                           17969129
179692                , :KRPRPM-FUNC-HT-QTY                             17969229
179693                , :KRPRPM-FUNC-WT-QTY                             17969329
179700       END-EXEC.                                                  17970003
179800                                                                  17980002
180900                                                                  18090002
181000     EVALUATE TRUE                                                18100002
181100         WHEN SQLCODE = ZERO                                      18110002
181200              CONTINUE                                            18120009
181300                                                                  18130002
181400         WHEN SQLCODE = +100                                      18140002
181500              CONTINUE                                            18150002
181600         WHEN SQLWARN0 NOT = SPACE                                18160002
181700         WHEN SQLCODE NOT = ZERO                                  18170002
181800              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         18180002
181900              MOVE 'COULD NOT FETCH CURSOR'                       18190002
182000                               TO DP013-MESSAGE-TEXT (1)          18200002
182100              MOVE SQLCA       TO DP013-SQLCA                     18210002
182200              SET DP013-DB2-ABEND TO TRUE                         18220002
182300              PERFORM DP013-0000-PROCESS-ABEND                    18230002
182400     END-EVALUATE.                                                18240002
182500                                                                  18250002
182600     IF  SQLCODE EQUAL +100                                       18260002
182700         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      18270002
182800     END-IF.                                                      18280002
182900                                                                  18290002
183000*----------------------------------------------------------------*18300002
183100* COUNT THE NUMBER OF ROWS ON TKRPRPM FOR THIS CODE              *18310002
183200*----------------------------------------------------------------*18320002
183300*4315-COUNT-TKRPRPM.                                              18330004
183400*                                                                 18340004
183500*    EXEC SQL                                                     18350004
183600*         SELECT COUNT(*)                                         18360004
183700*           INTO :PV-TKRPRPM-COUNT                                18370004
183800*           FROM TKRPRPM                                          18380004
183900*          WHERE SYS_PRC_FUNC_CDE   =  :KRPRCD-SYS-PRC-FUNC-CDE   18390004
184000*    END-EXEC.                                                    18400004
184100*                                                                 18410004
184200*    EVALUATE TRUE                                                18420004
184300*        WHEN SQLCODE = ZERO                                      18430004
184400*             CONTINUE                                            18440004
184500*                                                                 18450004
184600*        WHEN SQLCODE = +100                                      18460004
184700*             CONTINUE                                            18470004
184800*        WHEN SQLWARN0 NOT = SPACE                                18480004
184900*        WHEN SQLCODE NOT = ZERO                                  18490004
185000*             MOVE '4315-COUNT-TKRPRPM' TO DP013-PARAGRAPH        18500004
185100*             MOVE 'COULD NOT COUNT TKRPRPM'                      18510004
185200*                              TO DP013-MESSAGE-TEXT (1)          18520004
185300*             MOVE SQLCA       TO DP013-SQLCA                     18530004
185400*             SET DP013-DB2-ABEND TO TRUE                         18540004
185500*             PERFORM DP013-0000-PROCESS-ABEND                    18550004
185600*    END-EVALUATE.                                                18560004
185700                                                                  18570002
185800                                                                  18580002
185900*----------------------------------------------------------------*18590002
186000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18600002
186100*----------------------------------------------------------------*18610002
186200 4400-MOVE-COMMAREA-TO-SCREEN.                                    18620002
186300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18630002
186400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18640002
186500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18650002
186600             MOVE +1    TO ASC-BLK-SUB                            18660002
186700             PERFORM 5100-WRITE-TEMP-STORAGE                      18670002
186800             ADD +1     TO ASC-BLK-SUB                            18680002
186900             PERFORM 5100-WRITE-TEMP-STORAGE                      18690002
187000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18700002
187100                 GIVING PV-BLOCK-NUMBER                           18710002
187200                 REMAINDER PV-REMAINDER                           18720002
187300             IF  PV-REMAINDER > ZERO                              18730002
187400                 ADD +1 TO PV-BLOCK-NUMBER                        18740002
187500             END-IF                                               18750002
187600             MOVE +1    TO ASC-BLK-SUB                            18760002
187700             PERFORM 4410-READ-TEMP-STORAGE                       18770002
187800             ADD +1     TO ASC-BLK-SUB                            18780002
187900                           PV-BLOCK-NUMBER                        18790002
188000             PERFORM 4410-READ-TEMP-STORAGE                       18800002
188100     END-IF.                                                      18810002
188200     MOVE +1            TO ASC-BLK-SUB.                           18820002
188300     COMPUTE ASC-ITEM-SUB =                                       18830002
188400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18840002
188500         + PC-ITEMS-PER-PANEL).                                   18850002
188600                                                                  18860002
188700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18870002
188800         ADD +1         TO ASC-BLK-SUB                            18880002
188900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18890002
189000     END-IF.                                                      18900002
189100                                                                  18910002
189200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18920002
189300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18930002
189400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        18940002
189500     PERFORM 4420-FORMAT-LIST-LINES                               18950002
189600         VARYING PV-SUB                                           18960002
189700         FROM PC-ITEMS-PER-PANEL BY -1                            18970002
189800         UNTIL PV-SUB < +1.                                       18980002
189900                                                                  18990002
190000     COMPUTE ASC-ITEMS-DISPLAYED =                                19000002
190100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19010002
190200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    19020002
190300                                      ASTRTITO.                   19030002
190400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19040002
190500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19050002
190600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19060002
190700                                   TO ASELITO.                    19070002
190800                                                                  19080002
190801     MOVE  ASC-PARM-NAME           TO ACODEO.                     19080140
190802     MOVE  ASC-PARM-DESC           TO ANAMEO.                     19080240
190803     MOVE  ASC-PARM-TYPE           TO ATYPEO.                     19080340
190804                                                                  19080440
190805                                                                  19080540
190810                                                                  19081040
190900     IF  DP020-MSG-NUMBER-X = SPACE                               19090002
191000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19100002
191100*            --- MORE ITEMS TO DISPLAY ----                       19110002
191200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19120002
191300             SET DP020-MSG-INFORMATIONAL TO TRUE                  19130002
191400         END-IF                                                   19140002
191500     END-IF.                                                      19150002
191600                                                                  19160002
191700*----------------------------------------------------------------*19170002
191800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19180002
191900*----------------------------------------------------------------*19190002
192000 4410-READ-TEMP-STORAGE.                                          19200002
192100     EXEC CICS                                                    19210002
192200         READQ TS                                                 19220002
192300             QUEUE (ASC-LIST-QUEUE-NAME)                          19230002
192400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19240002
192500             ITEM  (PV-BLOCK-NUMBER)                              19250002
192600             RESP  (PV-CICS-RESP)                                 19260002
192700     END-EXEC.                                                    19270002
192800                                                                  19280002
192900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       19290002
193000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     19300002
193100         CONTINUE                                                 19310002
193200     ELSE                                                         19320002
193300         SET DP013-CICS-ABEND     TO TRUE                         19330002
193400         SET DP013-NO-ROLLBACK    TO TRUE                         19340002
193500         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         19350002
193600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      19360002
193700                                  TO DP013-MESSAGE-TEXT(1)        19370002
193800         PERFORM DP013-0000-PROCESS-ABEND                         19380002
193900     END-IF.                                                      19390002
194000                                                                  19400002
194100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19410002
194200                                                                  19420002
194300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         19430002
194400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               19440002
194500     END-IF.                                                      19450002
194600                                                                  19460002
194700*----------------------------------------------------------------*19470002
194800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19480002
194900*----------------------------------------------------------------*19490002
195000 4420-FORMAT-LIST-LINES.                                          19500002
195100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19510002
195200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19520002
195300         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           19530002
195400         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           19540002
195500         MOVE SPACES             TO MR-SELECTI      (PV-SUB)      19550002
195600                                    MR-ACTION       (PV-SUB)      19560002
195800                                    MR-SYSTEM       (PV-SUB)      19580010
195810                                    MR-STATUS       (PV-SUB)      19581010
195900                                    MR-FROM         (PV-SUB)      19590010
196000                                    MR-TO           (PV-SUB)      19600010
196030                                    MR-TEXT         (PV-SUB)      19603010
196031                                    MR-QTY          (PV-SUB)      19603144
196032                                    MR-PCT          (PV-SUB)      19603244
196040         MOVE ZEROES             TO MR-LOC          (PV-SUB)      19604011
196100     ELSE                                                         19610002
196200         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19620002
196300                                                   > SPACE        19630002
196400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19640002
196500                                          TO MR-SELECTI (PV-SUB)  19650002
196600         ELSE                                                     19660002
196700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19670002
196800                                           TO MR-SELECTI (PV-SUB) 19680002
196900         END-IF                                                   19690002
197000                                                                  19700002
197100         IF  DP030-SET-CURSOR-TRAILER                             19710002
197200             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)19720002
197300                 > SPACE)                                         19730002
197400               OR (PV-SUB = 1))                                   19740002
197500                SET DP030-SET-CURSOR-APPL-1 TO TRUE               19750002
197600                MOVE -1          TO MR-SELECTL (PV-SUB)           19760002
197700             END-IF                                               19770002
197800         END-IF                                                   19780002
197900*>>>>>>>>                                                         19790002
198000         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               19800002
198100                                          TO MR-ACTION   (PV-SUB) 19810002
198110         MOVE ASC-OPER-UNIT      (ASC-BLK-SUB ASC-ITEM-SUB)       19811010
198111                                          TO MR-LOC      (PV-SUB) 19811110
198120         MOVE ASC-SYS-INTRFC-CDE (ASC-BLK-SUB ASC-ITEM-SUB)       19812010
198121                                          TO MR-SYSTEM   (PV-SUB) 19812110
198130         MOVE ASC-STATUS         (ASC-BLK-SUB ASC-ITEM-SUB)       19813010
198131                                          TO MR-STATUS   (PV-SUB) 19813110
198140         MOVE ASC-FROM-TMST      (ASC-BLK-SUB ASC-ITEM-SUB)       19814053
198141                                          TO MR-FROM     (PV-SUB) 19814110
198150         MOVE ASC-TO-TMST        (ASC-BLK-SUB ASC-ITEM-SUB)       19815053
198151                                          TO MR-TO       (PV-SUB) 19815110
198160         MOVE ASC-FUNC-QTY       (ASC-BLK-SUB ASC-ITEM-SUB)       19816068
198161                                          TO  PV-DISPLAY-QUANTITY 19816113
198162         MOVE PV-DISPLAY-QUANTITY     TO MR-QTY      (PV-SUB)     19816268
198164                                                                  19816438
198184         MOVE ASC-FUNC-PCNT      (ASC-BLK-SUB ASC-ITEM-SUB)       19818468
198185                                          TO  PV-DISPLAY-PERCENT  19818536
198186         MOVE PV-DISPLAY-PERCENT      TO MR-PCT      (PV-SUB)     19818668
198191                                                                  19819142
198192         MOVE ASC-FUNC-TEXT      (ASC-BLK-SUB ASC-ITEM-SUB)       19819210
198300                                          TO MR-TEXT     (PV-SUB) 19830010
199100                                                                  19910002
199200     END-IF.                                                      19920002
199300     SUBTRACT +1 FROM ASC-ITEM-SUB                                19930002
199400     IF  ASC-ITEM-SUB < + 1                                       19940002
199500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  19950002
199600         MOVE +1                 TO ASC-BLK-SUB                   19960002
199700     END-IF.                                                      19970002
199800                                                                  19980002
199900******************************************************************19990002
200000** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **20000002
200100** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **20010002
200200** ISSUE A WARNING.                                             **20020002
200300******************************************************************20030002
200400 4430-CHECK-FOR-BEGIN-AND-END.                                    20040002
200500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20050002
200600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     20060002
200700*            -- NO END-OF-RANGE SPECFIED ---                      20070002
200800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            20080002
200900             SET DP020-MSG-WARNING TO TRUE                        20090002
201000             PERFORM 4431-POSITION-AT-WARNING                     20100002
201100         END-IF                                                   20110002
201200     ELSE                                                         20120002
201300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     20130002
201400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                20140002
201500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            20150002
201600             SET DP020-MSG-WARNING TO TRUE                        20160002
201700             PERFORM 4431-POSITION-AT-WARNING                     20170002
201800         END-IF                                                   20180002
201900     END-IF.                                                      20190002
202000*                                                                 20200002
202100******************************************************************20210002
202200** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **20220002
202300** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **20230002
202400** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **20240002
202500** POSITION THE CURSOR THERE.                                   **20250002
202600******************************************************************20260002
202700 4431-POSITION-AT-WARNING.                                        20270002
202800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20280002
202900                    - PV-TOP-ITEM + 1.                            20290002
203000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20300002
203100         CONTINUE                                                 20310002
203200     ELSE                                                         20320002
203300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      20330002
203400         MOVE -1                     TO MR-SELECTL (PV-SUB)       20340002
203500         MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)       20350002
203600         MOVE DP015-YELLOW           TO MR-SELECTC (PV-SUB)       20360002
203700     END-IF.                                                      20370002
203800                                                                  20380002
203900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20390002
204000                    - PV-TOP-ITEM + 1.                            20400002
204100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20410002
204200         CONTINUE                                                 20420002
204300     ELSE                                                         20430002
204400         SET DP030-SET-CURSOR-APPL-1                              20440002
204500                                   TO TRUE                        20450002
204600         MOVE -1                   TO MR-SELECTL (PV-SUB)         20460002
204700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20470002
204800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20480002
204900     END-IF.                                                      20490002
205000                                                                  20500002
205100*----------------------------------------------------------------*20510002
205200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *20520002
205300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *20530002
205400* FOR THE SELECTED ITEMS QUEUE.                                  *20540002
205500*                                                                *20550002
205600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20560002
205700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20570002
205800* THE ARRAY IS FULL.                                             *20580002
205900*----------------------------------------------------------------*20590002
206000 5000-PREPARE-SEL-QUEUE.                                          20600002
206100     MOVE +1                   TO  ASC-BLK-SUB.                   20610002
206200     PERFORM 5100-WRITE-TEMP-STORAGE.                             20620002
206300     ADD +1                    TO  ASC-BLK-SUB.                   20630002
206400     PERFORM 5100-WRITE-TEMP-STORAGE.                             20640002
206500                                                                  20650002
206600     MOVE ASC-SEL-QUEUE-NAME-2 TO  ASC-SEL-QUEUE-NAME.            20660080
206610     MOVE ASC-SEL-QUEUE-NAME   TO  CN020-SEL-QUEUE-NAME.          20661080
206700     PERFORM 6010-DELETE-SEL-QUEUE.                               20670002
206800                                                                  20680002
206900     SET ASC-UPDATE-TSQ        TO  TRUE.                          20690002
207000                                                                  20700002
207100     SET CN021-IDX             TO  1.                             20710047
207200     MOVE ZERO                 TO CN020-NUMBER-OF-TS-ITEMS.       20720056
207300     INITIALIZE CN021-SELECTED-ITEM-ARRAY.                        20730047
207400                                                                  20740002
207500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           20750002
207600             VARYING PV-ITEM                                      20760002
207700             FROM 1 BY 1                                          20770002
207800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     20780002
207900                                                                  20790002
208000     IF  CN021-IDX > 1                                            20800047
208100         PERFORM 5205-WRITE-SEL-QUEUE                             20810002
208200         ADD +1                TO CN020-NUMBER-OF-TS-ITEMS        20820056
208300     END-IF.                                                      20830002
208400                                                                  20840002
208500*----------------------------------------------------------------*20850002
208600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20860002
208700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *20870002
208800*----------------------------------------------------------------*20880002
208900 5100-WRITE-TEMP-STORAGE.                                         20890002
209000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20900002
209100                                   TO PV-LIST-ITEM-NUMBER.        20910002
209200     COMPUTE PV-BLOCK-NUMBER =                                    20920002
209300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20930002
209400                                                                  20940002
209500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             20950002
209600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             20960002
209700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      20970002
209800             PERFORM 5105-REWRITE-ASC-LISTQ                       20980002
209900         END-IF                                                   20990002
210000     ELSE                                                         21000002
210100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       21010002
210200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            21020002
210300         PERFORM 5110-WRITE-ASC-LISTQ                             21030002
210400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   21040002
210500     END-IF.                                                      21050002
210600                                                                  21060002
210700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21070002
210800                                                                  21080002
210900******************************************************************21090002
211000** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **21100002
211100** SPECIFIC COMMAREA.                                           **21110002
211200******************************************************************21120002
211300 5105-REWRITE-ASC-LISTQ.                                          21130002
211400     EXEC CICS                                                    21140002
211500         WRITEQ TS                                                21150002
211600             QUEUE (ASC-LIST-QUEUE-NAME)                          21160002
211700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21170002
211800             ITEM  (PV-BLOCK-NUMBER)                              21180002
211900             REWRITE                                              21190002
212000             RESP  (PV-CICS-RESP)                                 21200002
212100     END-EXEC.                                                    21210002
212200                                                                  21220002
212300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           21230002
212400         CONTINUE                                                 21240002
212500     ELSE                                                         21250002
212600         SET DP013-CICS-ABEND            TO TRUE                  21260002
212700         SET DP013-NO-ROLLBACK           TO TRUE                  21270002
212800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       21280002
212900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     21290002
213000                                         TO DP013-MESSAGE-TEXT(1) 21300002
213100         PERFORM DP013-0000-PROCESS-ABEND                         21310002
213200     END-IF.                                                      21320002
213300                                                                  21330002
213400******************************************************************21340002
213500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **21350002
213600** SPECIFIC COMMAREA.                                           **21360002
213700******************************************************************21370002
213800 5110-WRITE-ASC-LISTQ.                                            21380002
213900     EXEC CICS                                                    21390002
214000         WRITEQ TS                                                21400002
214100             QUEUE (ASC-LIST-QUEUE-NAME)                          21410002
214200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21420002
214300             ITEM  (PV-BLOCK-NUMBER)                              21430002
214400             RESP  (PV-CICS-RESP)                                 21440002
214500     END-EXEC.                                                    21450002
214600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      21460002
214700         SET DP013-CICS-ABEND      TO TRUE                        21470002
214800         SET DP013-NO-ROLLBACK     TO TRUE                        21480002
214900         MOVE '5110-WRITE-ASC-LISTQ'                              21490002
215000                                   TO DP013-PARAGRAPH             21500002
215100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           21510002
215200                                   TO DP013-MESSAGE-TEXT(1)       21520002
215300         PERFORM DP013-0000-PROCESS-ABEND                         21530002
215400     END-IF.                                                      21540002
215500                                                                  21550002
215600*----------------------------------------------------------------*21560002
215700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *21570002
215800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *21580002
215900*----------------------------------------------------------------*21590002
216000 5200-FILL-SEL-QUEUE-RECORD.                                      21600002
216100     PERFORM 6112-READ-LIST-QUEUE.                                21610002
216200                                                                  21620002
216300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       21630002
216400         PERFORM VARYING LQW-IDX                                  21640002
216500         FROM 1 BY 1                                              21650002
216600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            21660002
216700           OR  LQW-LIST-ITEM-NUMBER(LQW-IDX) = ZERO               21670002
216800                                                                  21680002
216900           IF LQW-SELECT (LQW-IDX)                                21690002
217000                 MOVE LQW-LIST-ITEM-NUMBER(LQW-IDX)               21700002
217100                            TO CN021-ITEM          (CN021-IDX)    21710012
217200                 MOVE LQW-ACTION (LQW-IDX)                        21720002
217300                            TO CN021-ACTION-SW     (CN021-IDX)    21730012
218110                 MOVE LQW-OPER-UNIT       (LQW-IDX)               21811012
218111                            TO CN021-OPER-UNIT     (CN021-IDX)    21811112
218120                 MOVE LQW-SYS-INTRFC-CDE  (LQW-IDX)               21812012
218121                            TO CN021-SYS-INTFC     (CN021-IDX)    21812112
218130                 MOVE LQW-STATUS          (LQW-IDX)               21813012
218131                            TO CN021-STATUS        (CN021-IDX)    21813112
218140                 MOVE LQW-FROM-TMST       (LQW-IDX)               21814051
218141                            TO CN021-FROM-TMST     (CN021-IDX)    21814151
218142                 MOVE LQW-FROM-TMST-NULL  (LQW-IDX)               21814274
218143                            TO CN021-FROM-TMST-NULL(CN021-IDX)    21814374
218150                 MOVE LQW-TO-TMST         (LQW-IDX)               21815051
218151                            TO CN021-TO-TMST       (CN021-IDX)    21815151
218152                 MOVE LQW-TO-TMST-NULL    (LQW-IDX)               21815274
218153                            TO CN021-TO-TMST-NULL  (CN021-IDX)    21815374
218160                 MOVE LQW-FUNC-QTY        (LQW-IDX)               21816012
218161                            TO CN021-FUNC-QTY      (CN021-IDX)    21816112
218162                 MOVE LQW-FUNC-QTY-NULL   (LQW-IDX)               21816274
218163                            TO CN021-FUNC-QTY-NULL (CN021-IDX)    21816374
218170                 MOVE LQW-FUNC-PCNT       (LQW-IDX)               21817012
218171                            TO CN021-FUNC-PCNT     (CN021-IDX)    21817112
218172                 MOVE LQW-FUNC-PCNT-NULL  (LQW-IDX)               21817274
218173                            TO CN021-FUNC-PCNT-NULL(CN021-IDX)    21817374
218180                 MOVE LQW-FUNC-TEXT       (LQW-IDX)               21818012
218181                            TO CN021-FUNC-TEXT     (CN021-IDX)    21818112
218182                 MOVE LQW-FUNC-TEXT-NULL  (LQW-IDX)               21818274
218183                            TO CN021-FUNC-TEXT-NULL(CN021-IDX)    21818374
218190                 MOVE LQW-FUNC-WD         (LQW-IDX)               21819012
218191                            TO CN021-FUNC-WD       (CN021-IDX)    21819115
218193                 MOVE LQW-FUNC-DPTH       (LQW-IDX)               21819312
218194                            TO CN021-FUNC-DPTH     (CN021-IDX)    21819412
218195                 MOVE LQW-FUNC-HT         (LQW-IDX)               21819512
218196                            TO CN021-FUNC-HT       (CN021-IDX)    21819612
218198                 MOVE LQW-FUNC-WT         (LQW-IDX)               21819812
218199                            TO CN021-FUNC-WT       (CN021-IDX)    21819912
218200                                                                  21820002
218300                 SET CN021-IDX UP BY 1                            21830012
218400                 IF  CN021-IDX > CN021-MAX-ITEMS                  21840012
218500                     PERFORM 5205-WRITE-SEL-QUEUE                 21850002
218600                     ADD +1        TO CN020-NUMBER-OF-TS-ITEMS    21860016
218700                     INITIALIZE CN021-SELECTED-ITEM-ARRAY         21870012
218800                     SET CN021-IDX TO  1                          21880047
218900                 END-IF                                           21890002
219000           END-IF                                                 21900002
219100         END-PERFORM                                              21910002
219200     END-IF.                                                      21920002
219300                                                                  21930002
219400*----------------------------------------------------------------*21940002
219500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *21950002
219600*----------------------------------------------------------------*21960002
219700 5205-WRITE-SEL-QUEUE.                                            21970002
219800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO CN021-SELECTED-ITEMS.   21980012
219900                                                                  21990002
220000     EXEC CICS                                                    22000002
220100          WRITEQ TS                                               22010002
220200              QUEUE (ASC-SEL-QUEUE-NAME)                          22020002
220300              FROM  (CN021-SELECT-RECORD)                         22030012
220400              ITEM  (PV-SEL-QUEUE-ITEM)                           22040002
220500              RESP  (PV-CICS-RESP)                                22050002
220600     END-EXEC.                                                    22060002
220700                                                                  22070002
220800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22080002
220900         CONTINUE                                                 22090002
221000     ELSE                                                         22100002
221100         SET DP013-CICS-ABEND      TO TRUE                        22110002
221200         SET DP013-NO-ROLLBACK     TO TRUE                        22120002
221300         MOVE '5205-WRITE-SEL-QUEUE'                              22130002
221400                                   TO DP013-PARAGRAPH             22140002
221500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          22150002
221600                                   TO DP013-MESSAGE-TEXT(1)       22160002
221700         PERFORM DP013-0000-PROCESS-ABEND                         22170002
221800     END-IF.                                                      22180002
221900                                                                  22190002
222000******************************************************************22200002
222100** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **22210002
222200** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **22220002
222300** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **22230002
222400** THE USER.                                                    **22240002
222500******************************************************************22250002
222600 6000-REFRESH-PANEL-FROM-TEMP.                                    22260002
222700     IF  ASC-UPDATE-TSQ                                           22270002
222800         SET ASC-NO-TSQ-UPDATE TO TRUE                            22280002
222900         MOVE ZERO                 TO PV-SAVE-ITEM                22290002
223000                                      PV-SEL-QUEUE-ITEM           22300002
223100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        22310002
223200                                   TO PV-HOLD-SELECTED-ITEMS      22320002
223300         MOVE +1                   TO PV-ITEMS-PROCESSED          22330002
223400         PERFORM 6100-UPDATE-TSQ                                  22340002
223500             UNTIL PV-ITEMS-PROCESSED >                           22350002
223600                                     PV-HOLD-SELECTED-ITEMS       22360002
223700         INITIALIZE ASC-BLOCK-ENTRIES (1)                         22370002
223800                    ASC-BLOCK-ENTRIES (2)                         22380002
223900     END-IF.                                                      22390002
224000                                                                  22400002
224100*----------------------------------------------------------------*22410002
224200*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *22420002
224300*----------------------------------------------------------------*22430002
224400 6010-DELETE-SEL-QUEUE.                                           22440002
224500                                                                  22450002
224600     EXEC CICS                                                    22460002
224700         DELETEQ TS                                               22470002
224800             QUEUE (ASC-SEL-QUEUE-NAME)                           22480002
224900             RESP  (PV-CICS-RESP)                                 22490002
225000     END-EXEC.                                                    22500002
225100                                                                  22510002
225200     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      22520002
225300        (PV-CICS-RESP = DFHRESP(QIDERR)))                         22530002
225400         CONTINUE                                                 22540002
225500     ELSE                                                         22550002
225600         SET DP013-CICS-ABEND TO TRUE                             22560002
225700         SET DP013-NO-ROLLBACK TO TRUE                            22570002
225800         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          22580002
225900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         22590002
226000                                        TO DP013-MESSAGE-TEXT (1) 22600002
226100         PERFORM DP013-0000-PROCESS-ABEND                         22610002
226200     END-IF.                                                      22620002
226300                                                                  22630002
226400*----------------------------------------------------------------*22640002
226500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *22650002
226600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *22660002
226700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *22670002
226800*    THE TEMP QUEUE.                                             *22680002
226900*----------------------------------------------------------------*22690002
227000 6100-UPDATE-TSQ.                                                 22700002
227100                                                                  22710002
227200     ADD 1    TO  PV-SEL-QUEUE-ITEM.                              22720002
227300     PERFORM 6105-READ-SEL-QUEUE.                                 22730002
227400     PERFORM                                                      22740002
227500         VARYING CN021-IDX FROM 1 BY 1                            22750047
227600         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     22760002
227700         OR (CN021-IDX GREATER THAN CN021-MAX-ITEMS))             22770047
227800         IF  CN021-ACTION-SW (CN021-IDX) > SPACE                  22780047
227900             PERFORM 6110-PROCESS-ITEMS                           22790002
228000         END-IF                                                   22800002
228100         ADD +1                TO PV-ITEMS-PROCESSED              22810002
228200     END-PERFORM.                                                 22820002
228300     PERFORM 6111-WRITE-LIST-QUEUE.                               22830002
228400                                                                  22840002
228500*----------------------------------------------------------------*22850002
228600*    READ THE LIST QUEUE RECORD.                                 *22860002
228700*----------------------------------------------------------------*22870002
228800 6105-READ-SEL-QUEUE.                                             22880002
228900                                                                  22890002
229000     EXEC CICS                                                    22900002
229100          READQ TS                                                22910002
229200              QUEUE (ASC-SEL-QUEUE-NAME)                          22920002
229300              INTO  (CN021-SELECT-RECORD)                         22930047
229400              ITEM  (PV-SEL-QUEUE-ITEM)                           22940002
229500              RESP  (PV-CICS-RESP)                                22950002
229600     END-EXEC.                                                    22960002
229700                                                                  22970002
229800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22980002
229900         CONTINUE                                                 22990002
230000     ELSE                                                         23000002
230100         SET DP013-CICS-ABEND      TO  TRUE                       23010002
230200         SET DP013-NO-ROLLBACK     TO  TRUE                       23020002
230300         MOVE '6105-READ-SEL-QUEUE'                               23030002
230400                                   TO  DP013-PARAGRAPH            23040002
230500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           23050002
230600                                   TO  DP013-MESSAGE-TEXT(1)      23060002
230700         PERFORM DP013-0000-PROCESS-ABEND                         23070002
230800     END-IF.                                                      23080002
230900                                                                  23090002
231000*----------------------------------------------------------------*23100002
231100*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*23110002
231200*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*23120002
231300*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *23130002
231400*----------------------------------------------------------------*23140002
231500 6110-PROCESS-ITEMS.                                              23150002
231600                                                                  23160002
231700     COMPUTE PV-ITEM = 1 + ((CN021-ITEM (CN021-IDX) - 1)          23170047
231800                     / PC-ITEMS-PER-PANEL).                       23180002
231900                                                                  23190002
232000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           23200002
232100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          23210002
232200             PERFORM 6111-WRITE-LIST-QUEUE                        23220002
232300         END-IF                                                   23230002
232400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    23240002
232500                                                                  23250002
232600         PERFORM 6112-READ-LIST-QUEUE                             23260002
232700         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               23270002
232800             CONTINUE                                             23280002
232900         END-IF                                                   23290002
233000     END-IF.                                                      23300002
233100                                                                  23310002
233200     COMPUTE PV-SUB = (CN021-ITEM (CN021-IDX)                     23320047
233300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              23330002
233400     SET LQW-DESELECT (PV-SUB) TO    TRUE                         23340002
233500     MOVE LQW-SELECTED-SW (PV-SUB)                                23350002
233600                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  23360002
233700     EVALUATE TRUE                                                23370002
233800         WHEN CN021-INQ (CN021-IDX)                               23380047
233900              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             23390002
234000                                                                  23400002
234100         WHEN CN021-UPD (CN021-IDX)                               23410047
234200              MOVE PC-UPD      TO LQW-ACTION  (PV-SUB)            23420002
234300              MOVE CN021-SYS-INTFC (CN021-IDX)                    23430064
234400                               TO LQW-SYS-INTRFC-CDE (PV-SUB)     23440064
234410              MOVE CN021-STATUS    (CN021-IDX)                    23441064
234500                               TO LQW-STATUS         (PV-SUB)     23450064
234510              MOVE CN021-FROM-TMST (CN021-IDX)                    23451064
234600                               TO LQW-FROM-TMST      (PV-SUB)     23460064
234700              MOVE CN021-TO-TMST   (CN021-IDX)                    23470064
234800                               TO LQW-TO-TMST          (PV-SUB)   23480064
234900              MOVE CN021-FUNC-QTY  (CN021-IDX)                    23490064
235000                               TO LQW-FUNC-QTY         (PV-SUB)   23500064
235010              MOVE CN021-FUNC-PCNT (CN021-IDX)                    23501064
235020                               TO LQW-FUNC-PCNT        (PV-SUB)   23502064
235030              MOVE CN021-FUNC-TEXT (CN021-IDX)                    23503064
235040                               TO LQW-FUNC-TEXT        (PV-SUB)   23504064
235050              MOVE CN021-FUNC-WD   (CN021-IDX)                    23505064
235060                               TO LQW-FUNC-WD          (PV-SUB)   23506064
235070              MOVE CN021-FUNC-DPTH (CN021-IDX)                    23507064
235080                               TO LQW-FUNC-DPTH        (PV-SUB)   23508064
235090              MOVE CN021-FUNC-HT   (CN021-IDX)                    23509064
235091                               TO LQW-FUNC-HT          (PV-SUB)   23509164
235092              MOVE CN021-FUNC-WT   (CN021-IDX)                    23509264
235093                               TO LQW-FUNC-WT          (PV-SUB)   23509364
235110                                                                  23511002
235200         WHEN CN021-DEL (CN021-IDX)                               23520047
235300              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             23530002
235400                                                                  23540002
235500         WHEN CN021-ERR (CN021-IDX)                               23550047
235600              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             23560002
235700                                                                  23570002
235800         WHEN OTHER                                               23580002
235900              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             23590002
236000                                                                  23600002
236100     END-EVALUATE.                                                23610002
236200                                                                  23620002
236300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                23630002
236400                                                                  23640002
236500*----------------------------------------------------------------*23650002
236600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *23660002
236700*----------------------------------------------------------------*23670002
236800 6111-WRITE-LIST-QUEUE.                                           23680002
236900                                                                  23690002
237000     EXEC CICS                                                    23700002
237100         WRITEQ TS                                                23710002
237200             QUEUE (ASC-LIST-QUEUE-NAME)                          23720002
237300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     23730002
237400             ITEM  (PV-SAVE-ITEM)                                 23740002
237500             REWRITE                                              23750002
237600             RESP  (PV-CICS-RESP)                                 23760002
237700     END-EXEC.                                                    23770002
237800                                                                  23780002
237900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23790002
238000         CONTINUE                                                 23800002
238100     ELSE                                                         23810002
238200         SET DP013-CICS-ABEND  TO  TRUE                           23820002
238300         SET DP013-NO-ROLLBACK TO  TRUE                           23830002
238400         MOVE '6111-WRITE-LIST-QUEUE' TO  DP013-PARAGRAPH         23840002
238500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  23850002
238600                               TO  DP013-MESSAGE-TEXT(1)          23860002
238700         PERFORM DP013-0000-PROCESS-ABEND                         23870002
238800     END-IF.                                                      23880002
238900                                                                  23890002
239000*----------------------------------------------------------------*23900002
239100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*23910002
239200*----------------------------------------------------------------*23920002
239300 6112-READ-LIST-QUEUE.                                            23930002
239400     EXEC CICS                                                    23940002
239500         READQ TS                                                 23950002
239600             QUEUE (ASC-LIST-QUEUE-NAME)                          23960002
239700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     23970002
239800             ITEM  (PV-ITEM)                                      23980002
239900             RESP  (PV-CICS-RESP)                                 23990002
240000     END-EXEC.                                                    24000002
240100                                                                  24010002
240200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24020002
240300         CONTINUE                                                 24030002
240400     ELSE                                                         24040002
240500         SET DP013-CICS-ABEND        TO TRUE                      24050002
240600         SET DP013-NO-ROLLBACK       TO TRUE                      24060002
240700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           24070002
240800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    24080002
240900                                     TO DP013-MESSAGE-TEXT(1)     24090002
241000         PERFORM DP013-0000-PROCESS-ABEND                         24100002
241100     END-IF.                                                      24110002
241200                                                                  24120002
241210*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 24121032
241220* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *24122032
241230*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 24123032
241240 9100-READ-SEL-QUEUE.                                             24124032
241250     EXEC CICS                                                    24125032
241260         READQ TS                                                 24126032
241270             QUEUE (ASC-SEL-QUEUE-NAME)                           24127032
241280             INTO  (CN019-SELECT-RECORD)                          24128073
241290             ITEM  (ASC-SEL-ITEM)                                 24129032
241291             RESP  (PV-CICS-RESP)                                 24129132
241292     END-EXEC.                                                    24129232
241293     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        24129332
241294         CONTINUE                                                 24129432
241295     ELSE                                                         24129532
241296         SET DP013-LOGIC-ABEND                                    24129632
241297             DP013-NO-ROLLBACK   TO   TRUE                        24129732
241298         MOVE '9100-READ-SEL-QUEUE'                               24129832
241299                                 TO   DP013-PARAGRAPH             24129932
241300         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   24130032
241301                                 TO   DP013-MESSAGE-TEXT (1)      24130132
241302         PERFORM DP013-0000-PROCESS-ABEND                         24130232
241303     END-IF.                                                      24130332
241304                                                                  24130432
241305                                                                  24130532
241306*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*24130632
241307* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *24130732
241308*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 24130832
241309 9200-REWRITE-SEL-QUEUE.                                          24130932
241310                                                                  24131032
241311     EXEC CICS                                                    24131132
241312          WRITEQ TS                                               24131232
241313              QUEUE  (ASC-SEL-QUEUE-NAME)                         24131332
241314              FROM   (CN019-SELECT-RECORD)                        24131473
241315              ITEM   (ASC-SEL-ITEM)                               24131532
241316              RESP   (PV-CICS-RESP)                               24131632
241317              REWRITE                                             24131732
241318     END-EXEC.                                                    24131832
241319                                                                  24131932
241320     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   24132032
241321         SET DP013-CICS-ABEND                                     24132132
241322             DP013-NO-ROLLBACK     TO TRUE                        24132232
241323         MOVE '9200-REWRITE-SEL-QUEUE'                            24132332
241324                                   TO DP013-PARAGRAPH             24132432
241325         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   24132532
241326                                   TO DP013-MESSAGE-TEXT (1)      24132632
241327         PERFORM DP013-0000-PROCESS-ABEND                         24132732
241328     END-IF.                                                      24132832
241329                                                                  24132932
241330                                                                  24133032
241340*----------------------------------------------------------------*24134002
241400*    ABEND PROCESSOR MODULE                                      *24140002
241500*----------------------------------------------------------------*24150002
241600     COPY DPPD013.                                                24160002
