000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT635.                                         00020000
000300 AUTHOR.        BUDDY BARNES.                                     00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   JUN, 2011.                                        00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900*  AHKUT635.   "ARCHIVE HISTORY" PROJECT. DATA OFFLOAD.          *00090000
001000*                                                                *00100000
001000*                                                                *00101000
001100*  PURPOSE:                                                      *00102000
001200*  THIS PROGRAM TAKES A DRIVER FILE OF ROWS EXTRACTED FROM       *00103000
001300*  TIMCNTK IN ORDER TO CREATE AN ARCHIVE FILE OF TIMCNRL         *00104000
001300*  WHICH WILL THEN BE USED TO DELETE ROWS FROM TIMCNRL           *00105000
001600*                                                                *00106000
001700*  PROCESSING OVERVIEW:                                          *00107000
001800*  THIS PROGRAM ACCESSES TIMCNRL AND USING A DRIVER FILE         *00108000
001900*  OF TIMCNTK ROWS CREATING AN OUTPUT FILE OF RECORDS CONTAINING:*00109000
002100*  1) THE FULL ROW OF DATA FROM TIMCNRL                          *00110000
002200*  THESE RECORDS ARE SORTED FOR EASE                             *00120000
002300*  AND EFFICIENCY OF SUBSEQUENT PROCESSING.                      *00130000
002400*                                                                *00140000
002500*  FOR EACH CONTAINER/PO RETURNED THE FULL ROW OF DATA IS WRITTEN*00150000
002600*  TO THE EXTRACT FILE TO BE USED FOR ARCHIVING AND DELETING.    *00160000
003000******************************************************************00170000
006020******************************************************************00180000
006030 ENVIRONMENT DIVISION.                                            00190000
006040 CONFIGURATION SECTION.                                           00200000
006050 SOURCE-COMPUTER.        IBM-3090.                                00210000
006060 OBJECT-COMPUTER.        IBM-3090.                                00220000
006070                                                                  00230000
006080 INPUT-OUTPUT SECTION.                                            00240000
006090 FILE-CONTROL.                                                    00250000
006100                                                                  00260000
006200     SELECT  IN-DRIVER-FILE               ASSIGN TO INP01.        00270000
006200     SELECT  OUT-ARCHIVE-FILE             ASSIGN TO OUT01.        00280000
006300                                                                  00290000
006400 DATA DIVISION.                                                   00300000
006500 FILE SECTION.                                                    00310000
006600                                                                  00320000
006700 FD  IN-DRIVER-FILE                                               00330000
006800     RECORDING MODE IS F                                          00340000
006900     LABEL RECORDS ARE STANDARD                                   00350000
007000     BLOCK CONTAINS 0 RECORDS.                                    00360000
007100 01  IN-DRIVER-RECORD                PIC  X(672).                 00370000
006600                                                                  00390000
006700 FD  OUT-ARCHIVE-FILE                                             00391000
006800     RECORDING MODE IS F                                          00392000
006900     LABEL RECORDS ARE STANDARD                                   00393000
007000     BLOCK CONTAINS 0 RECORDS.                                    00394000
007100 01  OUT-ARCHIVE-RECORD              PIC  X(119).                 00395001
007200                                                                  00396000
007300 WORKING-STORAGE SECTION.                                         00397000
007400                                                                  00398000
007500 01  PC-PROGRAM-CONSTANTS.                                        00399000
007600     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT635'.  00400000
007700     05  PC-PGM-PROGRESS-DESC.                                    00410000
007800         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00420000
007800         10  PC-CONTINUING           PIC X(10) VALUE 'CONTINUING'.00430000
008500         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00440000
008600         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00450000
008700     05  PC-ABEND-INFO.                                           00460000
008800         10  PC-ABEND                PIC X(11) VALUE              00470000
008900                                               '** ABEND **'.     00480000
009000         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00490000
009100                                               '- PARA       : '. 00500000
009200         10  PC-ABEND-MSG-DISPLAY-PARA                            00510000
009300                                     PIC X(15) VALUE              00520000
009400                                               '  CALLED PARA: '. 00530000
009500         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00540000
009600                                               '  FOR ABEND# : '. 00550000
009700         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00560000
009800                                               '- ERROR IS   : '. 00570000
009900         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00580000
010000         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00590000
010100                                               '- ACTION     : '. 00600000
010200     05  PC-TEST-AND-SET-NULL-IND.                                00610000
010300         10  PC-NOT-NULL             PIC S9(4) COMP               00620000
010400                                               VALUE ZERO.        00630000
010500         10  PC-NULL                 PIC S9(4) COMP               00640000
010600                                               VALUE -1.          00650000
010700         10  PC-NULL-CONV-ERR        PIC S9(4) COMP               00660000
010800                                               VALUE -2.          00670000
010900         10  PC-NULLIF-QUESTION-MARK PIC X(01) VALUE '?'.         00680000
011000                                                                  00690000
011100     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 010000.      00700000
011200                                                                  00710000
011300 01  PS-PROGRAM-SWITCHES.                                         00720000
011400     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00730000
011500         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00740000
011600         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00750000
008900     05  PS-DRIVER-FILE-SW        PIC  X(01)    VALUE 'Y'.        00760000
009000         88  MORE-DRIVER                        VALUE 'Y'.        00770000
009100         88  END-OF-DRIVER                      VALUE 'N'.        00780000
012000                                                                  00790000
012100 01  PV-PROGRAM-VARIABLES.                                        00800000
012400     05  DISPLAY-CNTR-NBR            PIC  X(12) VALUE SPACES.     00810000
012500     05  PV-PRG-TMST                 PIC X(26) VALUE SPACES.      00820000
012600     05  PV-PRG-TMST-DETAIL REDEFINES PV-PRG-TMST.                00830000
012700         10  PV-PRG-DATE             PIC X(10).                   00840000
012800         10  PV-PRG-TIME             PIC X(16).                   00850000
013000     05  PV-TABLE-ROW-FETCHED-CNT    PIC  9(9) VALUE 0.           00860000
013100     05  PV-ARCHIVE-WRITTEN-CNT       PIC  9(9) VALUE 0.          00870000
006800     05  PV-TIMCNTK-INPUT-COUNT   PIC 9(09)     VALUE ZERO        00871000
006900                                                COMP-3.           00872000
013800     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      00873000
013900     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      00874000
014000     05  PV-DB2-TABLE-NAME-1         PIC X(18) VALUE SPACES.      00875000
014100     05  PV-DB2-TABLE-NAME-2         PIC X(18) VALUE SPACES.      00876000
014200     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           00877000
014300     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           00878000
014400     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        00879000
014500                                                                  00880000
014600     05  PV-TMST                     PIC X(26) VALUE SPACES.      00890000
014700     05  PV-TIMESTAMP-DETAIL                                      00900000
014800         REDEFINES                                                00910000
014900         PV-TMST.                                                 00920000
015000         10  PV-TIMESTAMP-19.                                     00930000
015100             15  PV-TMS-DATE.                                     00940000
015200                 20  PV-TMS-YEAR.                                 00941000
015300                     25  PV-TMS-CC   PIC X(02).                   00942000
015400                     25  PV-TMS-YY   PIC X(02).                   00943000
015500                 20  FILLER          PIC X(01).                   00944000
015600                 20  PV-TMS-MONTH    PIC X(02).                   00945000
015700                 20  FILLER          PIC X(01).                   00946000
015800                 20  PV-TMS-DAY      PIC X(02).                   00947000
015900             15  FILLER              PIC X(01).                   00948000
016000             15  PV-TMS-HOUR         PIC X(02).                   00949000
016100             15  FILLER              PIC X(01).                   00949100
016200             15  PV-TMS-MINUTE       PIC X(02).                   00949200
016300             15  FILLER              PIC X(01).                   00949300
016400             15  PV-TMS-SECOND       PIC X(02).                   00949400
016500         10  FILLER                  PIC X(01).                   00949500
016600         10  PV-TMS-MSECOND          PIC X(06).                   00949600
014500                                                                  00949700
018200*---------------------------------------------------------------* 00949800
018300*  RECORD LAYOUT FOR DRIVER FILE.                               * 00949900
018400*---------------------------------------------------------------* 00950000
018500     COPY AHRD007.                                                00960000
018700                                                                  00970000
018200*---------------------------------------------------------------* 00980000
018300*  RECORD LAYOUT FOR ARCHIVE FILE.                              * 00990000
018400*---------------------------------------------------------------* 01000000
018500     COPY AHRD012.                                                01010000
018700                                                                  01020000
018800 01  DM-DISPLAY-MESSAGE.                                          01030000
018900     05  DM-01-10.                                                01040000
019000         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01050000
019100         10  FILLER                  PIC X(02) VALUE ': '.        01060000
019200     05  DM-11-80.                                                01070000
019300         10  FILLER                  PIC X(27) VALUE              01080000
019400                                    'BEGIN DRIVER FILE CREATION.'.01090000
019500         10  FILLER                  PIC X(01) VALUE SPACE.       01100000
019600         10  FILLER                  PIC X(42) VALUE ALL '*'.     01110000
019700     05  DM-81-120.                                               01120000
019800         10  FILLER                  PIC X(40) VALUE ALL '*'.     01130000
019900                                                                  01140000
020000 01  DP-DISPLAY-PROGRESS-MSG.                                     01150000
020100     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01160000
020200     05  FILLER                      PIC X(02) VALUE SPACE.       01170000
020300     05  DP-STATUS-DESCRIPTION       PIC X(13) VALUE SPACE.       01180000
020400     05  FILLER                      PIC X(04) VALUE ' AT '.      01190000
020500     05  DP-TIMESTAMP                PIC X(26) VALUE SPACE.       01200000
020600     05  FILLER                      PIC X(03) VALUE '.  '.       01210000
020700     05  FILLER                      PIC X(09) VALUE 'FETCHES: '. 01220000
020800     05  DP-TABLE-ROW-FETCHED-CNT    PIC ZZZ,ZZZ,ZZ9              01230000
020900                                               VALUE ZERO.        01240000
021000     05  FILLER                      PIC X(02) VALUE ', '.        01250000
021100     05  FILLER                      PIC X(09) VALUE 'WRITTEN: '. 01260000
021200     05  DP-DRIVER-WRITTEN-CNT       PIC ZZZ,ZZZ,ZZ9              01270000
021300                                               VALUE ZERO.        01280000
021400     05  FILLER                      PIC X(01) VALUE '.'.         01290000
021500                                                                  01300000
021600 01  ABEND-CODE                      PIC S9(04)                   01310000
021700                                               VALUE ZEROES       01320000
021800                                               COMP SYNC.         01330000
021900                                                                  01340000
022000*---------------------------------------------------------------* 01350000
022100*  DB2 FORMATTED MESSAGE AREA                                     01360000
022200*---------------------------------------------------------------* 01370000
022300     COPY DPWS004.                                                01380000
022400                                                                  01390000
022500*---------------------------------------------------------------* 01400000
022600*    DB2 AREA FOR TIMCNRL                                       * 01410000
022700*---------------------------------------------------------------* 01420000
022800     EXEC SQL                                                     01430000
022900          INCLUDE TIMCNRL                                         01440000
023000     END-EXEC.                                                    01450000
023100                                                                  01460000
023200*---------------------------------------------------------------* 01470000
023300*    DB2 AREA FOR SYSDUMMY                                      * 01480000
023400*---------------------------------------------------------------* 01490000
023500     EXEC SQL                                                     01500000
023600          INCLUDE SYSDUMMY                                        01510000
023700     END-EXEC.                                                    01520000
023800                                                                  01530000
023900*---------------------------------------------------------------* 01540000
024000*    DB2 AREA FOR COMMUNICATIONS                                * 01550000
024100*---------------------------------------------------------------* 01560000
024200     EXEC SQL                                                     01570000
024300          INCLUDE SQLCA                                           01580000
024400     END-EXEC.                                                    01590000
024500                                                                  01600000
024600*---------------------------------------------------------------* 01610000
024700*    DEFINE CURSOR FOR ACCESSING TIMCNRL                        * 01620000
024800*---------------------------------------------------------------* 01630000
024900     EXEC SQL                                                     01640000
025000         DECLARE TABLE-CURSOR CURSOR FOR                          01650000
025100           SELECT                                                 01660000
025200              CONTNR_ID                                           01670000
025300             ,CONTNR_SEQ_NBR                                      01680000
025400             ,PO_NBR                                              01690000
025500             ,DCONSLR_RLSE_CDE                                    01700000
025600             ,DCONSLR_REQR_DTE                                    01710000
025700             ,DCONSLR_ACTL_DTE                                    01720000
025800             ,DCONSLR_ACTL_TM                                     01730000
025800             ,CRE_TMST                                            01740000
025800             ,CRE_BY_UID                                          01750000
025800             ,LAST_UPD_TMST                                       01760000
025800             ,LAST_UPD_BY_UID                                     01761000
025800             ,DCONSLR_ENT_ID                                      01762000
027900             FROM TIMCNRL                                         01770000
028100            WHERE CONTNR_ID = :AH007-CONTNR-ID                    01780000
028100              AND CONTNR_SEQ_NBR = :AH007-CONTNR-SEQ-NBR          01790000
028500         FOR FETCH ONLY                                           01800000
028600         WITH UR                                                  01810000
028700         OPTIMIZE FOR 1 ROW                                       01820000
028800     END-EXEC.                                                    01830000
029000                                                                  01840000
029100 PROCEDURE DIVISION.                                              01850000
029200                                                                  01860000
029300 0000-PROGRAM-MAINLINE.                                           01870000
029400                                                                  01880000
029500     PERFORM 1000-INITIALIZE.                                     01890000
029600                                                                  01900000
029700     PERFORM 1500-READ-DRIVER-RECORD                              01910000
029800         UNTIL END-OF-DRIVER.                                     01920000
029900                                                                  01930000
030000     PERFORM 6000-EOJ-ROUTINE.                                    01940000
030100     STOP RUN.                                                    01950000
030200                                                                  01960000
030400******************************************************************01970000
030500*  INITIALIZATIONS                                               *01980000
030600******************************************************************01990000
030700 1000-INITIALIZE.                                                 02000000
030800                                                                  02010000
030900     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02020000
031000     DISPLAY DM-DISPLAY-MESSAGE.                                  02030000
031400                                                                  02040000
031500     OPEN INPUT  IN-DRIVER-FILE.                                  02050000
031500     OPEN OUTPUT OUT-ARCHIVE-FILE.                                02060000
031200     MOVE PC-BEGINNING            TO DP-STATUS-DESCRIPTION.       02070000
032500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02080000
033100     INITIALIZE DCLTIMCNRL                                        02090000
033200                AH012-ARCHIVE-RECORD-LAYOUT.                      02100000
033800                                                                  02110000
031200 1500-READ-DRIVER-RECORD.                                         02120000
031400     READ IN-DRIVER-FILE INTO AH007-DRIVER-RECORD-LAYOUT          02130000
031600          AT END SET END-OF-DRIVER  TO TRUE.                      02140000
031700                                                                  02150000
031800     IF MORE-DRIVER                                               02160000
031900         ADD 1 TO PV-TIMCNTK-INPUT-COUNT                          02170000
029600                                                                  02180000
032600         SET PS-TABLE-LOOP-NOT-DONE TO TRUE                       02190000
032700         PERFORM 9100-OPEN-TABLE-CURSOR                           02200000
033000                                                                  02210000
029700         PERFORM 2000-GET-NEXT-FROM-CURSOR                        02220000
029800             UNTIL PS-TABLE-LOOP-DONE                             02230000
                                                                        02240000
032700         PERFORM 9130-CLOSE-TABLE-CURSOR                          02250000
032000     END-IF.                                                      02260000
                                                                        02270000
033900******************************************************************02280000
034000*  FETCH NEXT FROM CURSOR & WRITE OUTPUT DRIVER FILE RECORD.     *02290000
034100******************************************************************02300000
034200 2000-GET-NEXT-FROM-CURSOR.                                       02310000
034300                                                                  02320000
036900     PERFORM 9110-FETCH-TABLE-CURSOR.                             02330000
           IF SQLCODE = 0                                               02340000
034400         MOVE  IMCNRL-CONTNR-ID  TO DISPLAY-CNTR-NBR              02350001
034410*        DISPLAY 'FETCHED CONTAINER = ' DISPLAY-CNTR-NBR          02360000
034610                                                                  02370000
036100         PERFORM 2010-POPULATE-ARCHIVE-RECORD                     02380000
036200         PERFORM 9650-WRITE-ARCHIVE-RECORD                        02390000
036300         PERFORM 2100-CHECK-PGM-PROGRESS                          02400000
036600     END-IF.                                                      02410000
037100******************************************************************02420000
037200*  MOVE COLUMNS FROM TABLES TO FIELDS IN ARCHIVE FILE RECORD.    *02430000
037300******************************************************************02440000
037400 2010-POPULATE-ARCHIVE-RECORD.                                    02450000
037500                                                                  02460000
           MOVE IMCNRL-CONTNR-ID        TO AH012-CONTNR-ID.             02470000
           MOVE IMCNRL-CONTNR-SEQ-NBR   TO AH012-CONTNR-SEQ-NBR.        02480000
           MOVE IMCNRL-PO-NBR           TO AH012-PO-NBR.                02490000
           MOVE IMCNRL-DCONSLR-RLSE-CDE TO AH012-DCONSLR-RLSE-CDE.      02500000
           MOVE IMCNRL-DCONSLR-REQR-DTE TO AH012-DCONSLR-REQR-DTE.      02510000
           MOVE IMCNRL-DCONSLR-ACTL-DTE TO AH012-DCONSLR-ACTL-DTE.      02520000
           MOVE IMCNRL-DCONSLR-ACTL-TM  TO AH012-DCONSLR-ACTL-TM.       02530000
           MOVE IMCNRL-CRE-TMST         TO AH012-CRE-TMST.              02540000
           MOVE IMCNRL-CRE-BY-UID       TO AH012-CRE-BY-UID.            02550000
           MOVE IMCNRL-LAST-UPD-TMST    TO AH012-LAST-UPD-TMST.         02560000
           MOVE IMCNRL-LAST-UPD-BY-UID  TO AH012-LAST-UPD-BY-UID.       02561000
           MOVE IMCNRL-DCONSLR-ENT-ID   TO AH012-DCONSLR-ENT-ID.        02562000
042200                                                                  02570000
040700******************************************************************02580000
040800*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *02590000
040900*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *02600000
041000*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *02610000
041100******************************************************************02620000
041200 2100-CHECK-PGM-PROGRESS.                                         02630000
041300     DIVIDE    PV-ARCHIVE-WRITTEN-CNT                             02640000
041400         BY        PC-HOW-OFTEN-TO-DISPLAY                        02650000
041500         GIVING    PV-DISPLAY-NTH-MULTIPLE                        02660000
041600         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      02670000
041700                                                                  02680000
041800     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           02690000
041900         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      02700000
042000         PERFORM 6200-DISPLAY-PGM-PROGRESS                        02710000
042100     END-IF.                                                      02720000
042200                                                                  02730000
046400******************************************************************02740000
046500*  CLOSE CURSOR & OUTPUT FILE, DISPLAY END OF RUN MESSAGE.       *02750000
046600******************************************************************02760000
046700 6000-EOJ-ROUTINE.                                                02770000
046800                                                                  02780000
047100     CLOSE IN-DRIVER-FILE.                                        02790000
047100     CLOSE OUT-ARCHIVE-FILE.                                      02800000
047200                                                                  02810000
046900     MOVE PC-ENDING  TO  DP-STATUS-DESCRIPTION.                   02820000
047500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02830000
047600                                                                  02840000
047700     DISPLAY 'TOTAL CONTAINER/PO TRACKING PROCESSED = '           02850000
047700                                  PV-ARCHIVE-WRITTEN-CNT.         02860000
047900                                                                  02870000
048000******************************************************************02880000
048100*  DISPLAY PROGRAM PROGRESS.                                     *02890000
048200******************************************************************02900000
048300 6200-DISPLAY-PGM-PROGRESS.                                       02910000
048400                                                                  02920000
048500     EXEC SQL                                                     02930000
048600          SET :PV-TMST = CURRENT TIMESTAMP                        02940000
048700     END-EXEC.                                                    02950000
048800                                                                  02960000
048900     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                02970000
049000     MOVE PV-TMST                   TO DP-TIMESTAMP.              02980000
049100     MOVE PV-TABLE-ROW-FETCHED-CNT  TO DP-TABLE-ROW-FETCHED-CNT.  02990000
049200     MOVE PV-ARCHIVE-WRITTEN-CNT     TO DP-DRIVER-WRITTEN-CNT.    03000000
049300                                                                  03010000
049400     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03020000
049600                                                                  03030000
049700******************************************************************03040000
049800*  OPEN   TABLE CURSOR                                           *03050000
049900******************************************************************03060000
050000 9100-OPEN-TABLE-CURSOR.                                          03070000
050100     EXEC SQL                                                     03080000
050200          OPEN TABLE-CURSOR                                       03090000
050300     END-EXEC.                                                    03100000
050400                                                                  03110000
050500     EVALUATE TRUE                                                03120000
050600         WHEN SQLCODE = ZERO                                      03130000
050700              CONTINUE                                            03140000
050800         WHEN SQLCODE = +100                                      03150000
050900              SET PS-TABLE-LOOP-DONE TO TRUE                      03160000
051000              MOVE '9100-OPEN-TABLE-CURSOR'                       03170000
051100                                 TO PV-PARAGRAPH-NAME             03180000
051200              MOVE 'OPEN TABLE CURSOR - NO ROWS SELECTED'         03190000
051300                                 TO PV-DB2-OPERATION-MSG-1        03200000
051400              MOVE 'TIMCNRL' TO PV-DB2-TABLE-NAME-1               03210000
051500              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03220000
051600              PERFORM 9999-DB2-ABEND                              03230000
051700         WHEN SQLWARN0 NOT EQUAL SPACE                            03240000
051800         WHEN SQLCODE  NOT EQUAL ZERO                             03250000
051900              MOVE '9100-OPEN-TABLE-CURSOR'                       03260000
052000                                 TO PV-PARAGRAPH-NAME             03270000
052100              MOVE 'OPEN TABLE CURSOR'                            03280000
052200                                 TO PV-DB2-OPERATION-MSG-1        03290000
052300              MOVE 'TIMCNRL' TO PV-DB2-TABLE-NAME-1               03300000
052400              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03310000
052500              PERFORM 9999-DB2-ABEND                              03320000
052600     END-EVALUATE.                                                03330000
052700                                                                  03340000
052900******************************************************************03350000
053000*  FETCH TABLE CURSOR                                            *03360000
053100******************************************************************03370000
053200 9110-FETCH-TABLE-CURSOR.                                         03380000
053300     EXEC SQL                                                     03390000
053400         FETCH TABLE-CURSOR                                       03400000
053500          INTO  :IMCNRL-CONTNR-ID                                 03410000
053600               ,:IMCNRL-CONTNR-SEQ-NBR                            03420000
053700               ,:IMCNRL-PO-NBR                                    03430000
053800               ,:IMCNRL-DCONSLR-RLSE-CDE                          03440000
053900               ,:IMCNRL-DCONSLR-REQR-DTE                          03450000
054000               ,:IMCNRL-DCONSLR-ACTL-DTE                          03460000
054100               ,:IMCNRL-DCONSLR-ACTL-TM                           03470000
054100               ,:IMCNRL-CRE-TMST                                  03480000
054100               ,:IMCNRL-CRE-BY-UID                                03490000
054100               ,:IMCNRL-LAST-UPD-TMST                             03500000
054100               ,:IMCNRL-LAST-UPD-BY-UID                           03501000
054100               ,:IMCNRL-DCONSLR-ENT-ID                            03502000
056300     END-EXEC.                                                    03510000
056400                                                                  03520000
056500     EVALUATE TRUE                                                03530000
056600         WHEN SQLCODE = ZERO                                      03540000
056700              ADD +1                 TO PV-TABLE-ROW-FETCHED-CNT  03550000
056800         WHEN SQLCODE = +100                                      03560000
056900              SET PS-TABLE-LOOP-DONE TO TRUE                      03570000
057000         WHEN SQLWARN0 NOT EQUAL SPACE                            03580000
057100         WHEN SQLCODE NOT EQUAL ZERO                              03590000
057200              MOVE '9110-FETCH-TABLE-CURSOR'                      03600000
057300                                 TO PV-PARAGRAPH-NAME             03610000
057400              MOVE 'FETCH TABLE CURSOR'                           03620000
057500                                 TO PV-DB2-OPERATION-MSG-1        03630000
057600              MOVE 'TIMCNRL' TO PV-DB2-TABLE-NAME-1               03640000
057700              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03650000
057800              PERFORM 9999-DB2-ABEND                              03660000
057900     END-EVALUATE.                                                03670000
058100                                                                  03680000
058200******************************************************************03690000
058300*  CLOSE TABLE CURSOR                                            *03700000
058400******************************************************************03710000
058500 9130-CLOSE-TABLE-CURSOR.                                         03720000
058600     EXEC SQL                                                     03730000
058700          CLOSE TABLE-CURSOR                                      03740000
058800     END-EXEC.                                                    03750000
058900                                                                  03760000
059000     EVALUATE TRUE                                                03770000
059100         WHEN SQLCODE = ZERO                                      03780000
059200              CONTINUE                                            03790000
059300         WHEN SQLWARN0 NOT EQUAL SPACE                            03800000
059400         WHEN SQLCODE NOT EQUAL ZERO                              03810000
059500              MOVE '9130-CLOSE-TABLE-CURSOR'                      03820000
059600                                 TO PV-PARAGRAPH-NAME             03830000
059700              MOVE 'CLOSE TABLE CURSOR'                           03840000
059800                                 TO PV-DB2-OPERATION-MSG-1        03850000
059900              MOVE 'TIMCNRL' TO PV-DB2-TABLE-NAME-1               03860000
060000              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03870000
060100              PERFORM 9999-DB2-ABEND                              03880000
060200     END-EVALUATE.                                                03890000
060600                                                                  03900000
060700******************************************************************03910000
060800*  WRITE A RECORD TO THE DRIVER FILE                             *03920000
060900******************************************************************03930000
061000 9650-WRITE-ARCHIVE-RECORD.                                       03940000
061100     WRITE  OUT-ARCHIVE-RECORD  FROM  AH012-ARCHIVE-RECORD-LAYOUT.03950000
061200     ADD +1 TO PV-ARCHIVE-WRITTEN-CNT.                            03960000
061400                                                                  03970000
061700******************************************************************03980000
061800*  DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT  *03990000
061900*  AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN             *04000000
062000*  SQL ERROR OR WARNING CODE OCCURS.                             *04010000
062100******************************************************************04020000
062200 9999-DB2-ABEND.                                                  04030000
062300     DISPLAY PC-CURRENT-PROGRAM-NAME                              04040000
062400             ' 9999-DB2-ABEND'.                                   04050000
062500     DISPLAY PC-CURRENT-PROGRAM-NAME                              04060000
062600             ' ** ABEND           **'.                            04070000
062700     DISPLAY PC-CURRENT-PROGRAM-NAME                              04080000
062800             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       04090000
062900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04100000
063000             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME-1.     04110000
063100     DISPLAY PC-CURRENT-PROGRAM-NAME                              04120000
063200             ' **                 ** = ' PV-DB2-TABLE-NAME-2.     04130000
063300     DISPLAY PC-CURRENT-PROGRAM-NAME                              04140000
063400             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  04150000
063500                                                                  04160000
063600     DISPLAY PC-CURRENT-PROGRAM-NAME                              04170000
063700             ' ** SQLCODE         ** = ' SQLCODE.                 04180000
063800     MOVE SQLCODE TO PV-SQLCODE.                                  04190000
063900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04200000
064000             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          04210000
064100                                                                  04220000
064200     DISPLAY PC-CURRENT-PROGRAM-NAME                              04230000
064300             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            04240000
064400                                                                  04250000
064600*----------------------------------------------------------------*04260000
064700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *04270000
064800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *04280000
064900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *04290000
065000* FORMAT.                                                        *04300000
065100*----------------------------------------------------------------*04310000
065200     COPY DPPD004.                                                04320000
065300                                                                  04330000
065400     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     04340000
065500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           04350000
065700                                                                  04360000
065800*----------------------------------------------------------------*04370000
065900* CALL ABEND                                                     *04380000
066000*----------------------------------------------------------------*04390000
066100     MOVE +4013                  TO ABEND-CODE.                   04400000
066200     CALL 'ILBOABN0' USING ABEND-CODE.                            04410000
