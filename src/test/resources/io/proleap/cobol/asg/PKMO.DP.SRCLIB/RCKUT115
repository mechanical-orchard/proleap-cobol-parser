000100****************************************************************  00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300****************************************************************  00030000
000400 PROGRAM-ID.    RCKUT115.                                         00040000
000500 AUTHOR.        RON KRIER                                         00050000
000600 DATE-WRITTEN.  JANUARY, 2002.                                    00060000
000700                                                                  00070000
000800****************************************************************  00080000
000900*   THIS PROGRAM WILL EXTRACT VERIFIED RECEIVERS FOR A CERTAIN    00090000
001000*   TIME PERIOD.  THE OUTPUT FILE FROM THIS PROGRAM WILL BE       00100000
001100*   PASSED ONTO RCKUT116 TO GET RECITM AND RECDIS INFO.           00110000
001200****************************************************************  00120000
001300                                                                  00130000
001400****************************************************************  00140000
001500 ENVIRONMENT DIVISION.                                            00150000
001600****************************************************************  00160000
001700                                                                  00170000
001800****************************************************************  00180000
001900 INPUT-OUTPUT SECTION.                                            00190000
002000****************************************************************  00200000
002100                                                                  00210000
002200****************************************************************  00220000
002300 FILE-CONTROL.                                                    00230000
002400****************************************************************  00240000
002500     SELECT OUTPUT-FILE                                           00250000
002600         ASSIGN TO OUT01.                                         00260000
002700                                                                  00270000
002800****************************************************************  00280000
002900 DATA DIVISION.                                                   00290000
003000****************************************************************  00300000
003100                                                                  00310000
003200****************************************************************  00320000
003300 FILE SECTION.                                                    00330000
003400****************************************************************  00340000
003500                                                                  00350000
003600 FD  OUTPUT-FILE                                                  00360000
003700     RECORDING MODE IS F                                          00370000
003800     BLOCK CONTAINS 0 RECORDS                                     00380000
003900     DATA RECORD IS OUTPUT-RECORD.                                00390000
004000 01  OUTPUT-RECORD                       PIC  X(60).              00400032
004100                                                                  00410000
004200                                                                  00420000
004300/                                                                 00430000
004400 WORKING-STORAGE SECTION.                                         00440000
004500                                                                  00450000
004600*  TOTAL LENGTH OF 54                                             00460033
004700 01  OR-OUTPUT-RECORD.                                            00470000
004800     05  OR-ORD-NBR                      PIC  S9(9) COMP.         00480000
004900     05  OR-REC-SEQ-NBR                  PIC  S9(9) COMP.         00490000
005000     05  OR-ORD-LNE-NBR                  PIC  S9(9) COMP.         00500015
005100     05  OR-OPER-UNT-ID                  PIC  S9(4) COMP.         00510000
005200     05  OR-CRE-OPER-UNT-ID              PIC  S9(4) COMP.         00520015
005300     05  OR-CURR-OPER-UNT-ID             PIC  S9(4) COMP.         00530015
005400     05  OR-PO-VER-NBR                   PIC  S9(9) COMP.         00540015
005500     05  OR-PACK-BY-ST-IND               PIC   X(1).              00550000
005600     05  OR-PKGNG-CDE                    PIC   X(1).              00560015
005700     05  OR-EXPTED-CART-CNT              PIC  S9(4) COMP.         00570015
005800     05  OR-ACTL-CART-CNT                PIC  S9(4) COMP.         00580015
005900     05  OR-VERFYD-TMST                  PIC   X(26).             00590009
006000                                                                  00600000
006100 01  ABEND-CODE                          PIC S9(04)  VALUE ZERO   00610000
006200                                                     COMP SYNC.   00620000
006300                                                                  00630010
006400 01  PV-PROGRAM-VARIABLES.                                        00640000
006500     05  PV-NUMBER-WRITES                PIC S9(09)  VALUE ZERO   00650000
006600                                                     COMP-3.      00660000
006700     05  PV-NUMBER-WRITES-DISP           PIC S9(09)  VALUE ZERO   00670007
006800                                                     COMP-3.      00680007
006900     05  PV-START-DATE                   PIC  X(10).              00690000
007000     05  PV-END-DATE                     PIC  X(10).              00700000
007100     05  PV-TMST                         PIC  X(26)  VALUE SPACE. 00710000
007200     05  FILLER  REDEFINES  PV-TMST.                              00720000
007300         10  PV-DATE.                                             00730000
007400             15  PV-TMST-DATE.                                    00740000
007500                 20  PV-TMST-DATE-YY     PIC  X(04).              00750000
007600             15  PV-SLASH1               PIC  X(01).              00760000
007700             15  PV-TMST-DATE-MM         PIC  X(02).              00770000
007800             15  PV-SLASH2               PIC  X(01).              00780000
007900             15  PV-TMST-DATE-DD         PIC  X(02).              00790000
008000         10  FILLER                      PIC  X(16).              00800000
008100     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 00810000
008200     05  PV-DISPLAY-FIELD                PIC  9(09)  VALUE ZEROS. 00820000
008300     05  PV-START1.                                               00830005
008400         10  PV-START-DATE1              PIC  X(10).              00840005
008500         10  PV-START-TIME1              PIC  X(16)  VALUE        00850005
008600                   '-00.00.00.000000'.                            00860005
008700     05  PV-START-TMST1 REDEFINES PV-START1 PIC X(26).            00870005
008800                                                                  00880005
008900     05  PV-END1.                                                 00890005
009000         10  PV-END-DATE1                 PIC  X(10).             00900005
009100         10  PV-END-TIME1                 PIC  X(16)  VALUE       00910005
009200                   '-23.59.59.999999'.                            00920005
009300     05  PV-END-TMST1 REDEFINES PV-END1    PIC  X(26).            00930005
009400                                                                  00940005
009500     05  PV-START2.                                               00950005
009600         10  PV-START-DATE2              PIC  X(10).              00960005
009700         10  PV-START-TIME2              PIC  X(16)  VALUE        00970005
009800                   '-00.00.00.000000'.                            00980005
009900     05  PV-START-TMST2 REDEFINES PV-START2 PIC X(26).            00990005
010000                                                                  01000005
010100     05  PV-END2.                                                 01010005
010200         10  PV-END-DATE2                 PIC  X(10).             01020005
010300         10  PV-END-TIME2                 PIC  X(16)  VALUE       01030005
010400                   '-23.59.59.999999'.                            01040005
010500     05  PV-END-TMST2 REDEFINES PV-END2    PIC  X(26).            01050005
010600     05  PV-EXPTED-EXT-RETAIL            PIC  S9(15)V99           01060010
010700                                                     COMP-3.      01070010
010800     05  PV-VERIFY-EXT-RETAIL            PIC  S9(15)V99           01080010
010900                                                     COMP-3.      01090010
011000     05  PV-AP-VERIFY-EXT-RETAIL         PIC  S9(15)V99           01100010
011100                                                     COMP-3.      01110010
011200     05  PV-EXPTED-ITM-QTY               PIC  S9(17) COMP-3.      01120010
011300     05  PV-VERIFY-ITM-QTY               PIC  S9(17) COMP-3.      01130010
011400     05  PV-AP-VERIFY-ITM-QTY            PIC  S9(17) COMP-3.      01140010
011500                                                                  01150000
011600     05  PV-FISCAL-YEAR                  PIC   X(04).             01160029
011700     05  PV-FISCAL-MONTH                 PIC   X(02).             01170029
011800                                                                  01180029
011900 01  PV-ABEND-FIELDS.                                             01190029
012000     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01200029
012100                                                 COMP SYNC.       01210029
012200     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PCKRP014'.01220029
012300     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01230029
012400     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01240029
012500     05  PV-ABEND-STRUCTURE-1         PIC  X(8)  VALUE SPACES.    01250029
012600     05  PV-ABEND-STRUCTURE-2         PIC  X(8)  VALUE SPACES.    01260029
012700     05  PV-ABEND-STRUCTURE-3         PIC  X(8)  VALUE SPACES.    01270029
012800     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01280029
012900     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01290029
013000     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01300029
013100                                                                  01310029
013200 01  CC-CONTROL-CARD.                                             01320000
013300     05  CC-CONSTANT                 PIC  X(07)      VALUE SPACE. 01330022
013400     05  FILLER                      PIC  X(01)      VALUE SPACE. 01340000
013500     05  CC-OVERRIDE-IND             PIC  X(01).                  01350024
013600         88  CC-OVERRIDE-YES                         VALUE 'Y'.   01360023
013700         88  CC-OVERRIDE-NO                          VALUE 'N'.   01370023
013800     05  CC-FISCAL-YY                PIC  X(04).                  01380031
013900     05  CC-FISCAL-MM                PIC  X(02).                  01390031
014000     05  FILLER                      PIC  X(65)      VALUE SPACE. 01400024
014100                                                                  01410000
014200 01  PC-PROGRAM-CONSTANTS.                                        01420000
014300     05  PC-N                            PIC  X(01)  VALUE 'N'.   01430000
014400     05  PC-IP                           PIC  X(02)  VALUE 'IP'.  01440000
014500     05  PC-CM                           PIC  X(02)  VALUE 'CM'.  01450000
014600     05  PC-VE                           PIC  X(02)  VALUE 'VE'.  01460000
014700     05  PC-DC                           PIC  X(02)  VALUE 'DC'.  01470000
014800     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01480000
014900         'RCKUT115'.                                              01490000
015000     05  PC-REPORT-NBR                   PIC  9(01)    VALUE 1.   01500000
015100     05  PC-PGM-DPKUT500                 PIC  X(08)  VALUE        01510000
015200         'DPKUT500'.                                              01520000
015300                                                                  01530000
015400 01  DK-DB2-KEYS.                                                 01540000
015500     05  DK-ORD-NBR                      PIC S9(09)  VALUE ZEROS  01550000
015600                                                     COMP.        01560000
015700     05  DK-REC-SEQ-NBR                  PIC S9(09)  VALUE ZEROS  01570000
015800                                                     COMP.        01580000
015900                                                                  01590000
016000 01  PS-PROGRAM-SWITCHES.                                         01600000
016100     05  PS-END-OF-PO-CSR-SW             PIC  X(01)  VALUE 'N'.   01610000
016200         88  PS-END-OF-PO-CSR                        VALUE 'Y'.   01620000
016300     05  PS-END-OF-DETAIL-CSR-SW         PIC  X(01)  VALUE 'N'.   01630010
016400         88  PS-END-OF-DETAIL-CSR                    VALUE 'Y'.   01640010
016500                                                                  01650000
016600*                                                                 01660000
016700*  COPY BOOK FOR OUTPUT RECORD                                    01670022
016800*                                                                 01680000
016900     COPY RCRD061.                                                01690037
017000                                                                  01700000
017100*                                                                 01710022
017200*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       01720022
017300*                                                                 01730022
017400     COPY DPWS004.                                                01740037
017500                                                                  01750022
017600*                                                                 01760000
017700*                                                                 01770000
017800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE RECEIVER TABLE     01780000
017900*                                                                 01790000
018000     EXEC SQL                                                     01800000
018100          INCLUDE TRECEIV                                         01810000
018200     END-EXEC.                                                    01820000
018300*                                                                 01830011
018400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE RECEIVER           01840011
018500*  DISTRIBUTION TABLE                                             01850011
018600*                                                                 01860011
018700     EXEC SQL                                                     01870011
018800          INCLUDE TRECDIS                                         01880011
018900     END-EXEC.                                                    01890011
019000*                                                                 01900011
019100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE RECEIVER           01910011
019200*  ITEM TABLE                                                     01920011
019300*                                                                 01930011
019400     EXEC SQL                                                     01940011
019500          INCLUDE TRECITM                                         01950011
019600     END-EXEC.                                                    01960011
019700*                                                                 01970011
019800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PURCHASE ORDER     01980011
019900*  ITEM TABLE                                                     01990011
020000*                                                                 02000011
020100     EXEC SQL                                                     02010011
020200          INCLUDE TPURITM                                         02020011
020300     END-EXEC.                                                    02030011
020400*                                                                 02040000
020500*  LOCATION MASTER                                                02050038
020600*                                                                 02060000
020700     EXEC SQL                                                     02070000
020800          INCLUDE XLT00010                                        02080038
020900     END-EXEC.                                                    02090000
021000                                                                  02100000
021100******************************************************************02110026
021200*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE COMPANY CONTROL    02120027
021300*  TABLE                                                          02130027
021400******************************************************************02140026
021500     EXEC SQL                                                     02150026
021600          INCLUDE TCOCNTL                                         02160026
021700     END-EXEC.                                                    02170026
021800*                                                                 02180026
021900******************************************************************02190027
022000*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE DATE ATTRIBUTE     02200027
022100*  TABLE                                                          02210027
022200******************************************************************02220027
022300     EXEC SQL                                                     02230027
022400          INCLUDE TDTATTR                                         02240027
022500     END-EXEC.                                                    02250027
022600*                                                                 02260027
022700******************************************************************02270026
022800                                                                  02280000
022900*                                                                 02290000
023000*  COMMUNICATION AREAS FOR DB2                                    02300000
023100*                                                                 02310000
023200     EXEC SQL                                                     02320000
023300         INCLUDE SQLCA                                            02330000
023400     END-EXEC.                                                    02340000
023500*                                                                 02350030
023600     COPY SQLCA2.                                                 02360030
023700*                                                                 02370000
023800******************************************************************02380000
023900*  TRECEIV CURSOR                                                *02390000
024000******************************************************************02400000
024100     EXEC SQL                                                     02410000
024200          DECLARE PO-CSR CURSOR FOR                               02420004
024300          SELECT A.ORD_NBR,                                       02430015
024400                 A.REC_SEQ_NBR,                                   02440015
024500                 A.OPER_UNT_ID,                                   02450015
024600                 A.PACK_BY_ST_IND,                                02460015
024700                 A.EXPTED_CART_CNT,                               02470015
024800                 A.ACTL_CART_CNT,                                 02480015
024900                 A.VERFYD_TMST,                                   02490015
025000                 A.CRE_OPER_UNT_ID,                               02500015
025100                 A.CURR_OPER_UNT_ID,                              02510015
025200                 A.PKGNG_CDE,                                     02520015
025300                 C.ORD_LNE_NBR,                                   02530019
025400                 C.PO_VER_NBR                                     02540017
025500           FROM  TRECEIV A,                                       02550000
025600                 XLT_LOC B,                                       02560037
025700                 TRECITM C                                        02570015
025800          WHERE (A.STATUS_CDE         =  'VE'                     02580037
025900            AND  A.ML_POST_TMST       >= :PV-START-TMST2          02590016
026000            AND  A.ML_POST_TMST       <= :PV-END-TMST2            02600016
026100            AND  A.VERFYD_TMST        >= :PV-START-TMST1          02610016
026200            AND  A.VERFYD_TMST        <= :PV-END-TMST1            02620016
026300            AND  A.VER_STATUS_CDE     =  'A'                      02630016
026400            AND  A.CURR_OPER_UNT_ID   =  B.LOC_NBR                02640037
026500            AND  B.LOC_TYP_CDE      =  'DC'                       02650037
026600            AND  C.ORD_NBR          =  A.ORD_NBR                  02660016
026700            AND  C.REC_SEQ_NBR      =  A.REC_SEQ_NBR              02670018
026800            AND  C.VER_STATUS_CDE     =  'A'                      02680018
026900            AND  C.STATUS_CDE         = 'VE')                     02690037
027000          WITH UR                                                 02700008
027100     END-EXEC.                                                    02710000
027200*                                                                 02720010
027300******************************************************************02730010
027400*  UNIT AND EXTENDED RETAIL CURSOR                               *02740010
027500******************************************************************02750010
027600                                                                  02760000
027700*    EXEC SQL                                                     02770015
027800*         DECLARE DETAIL-CSR CURSOR FOR                           02780015
027900*         SELECT SUM(A.EXPTED_ITM_QTY)                            02790015
028000*              , SUM(A.VERIFY_ITM_QTY)                            02800015
028100*              , SUM(A.AP_VERIFY_ITM_QTY)                         02810015
028200*              , C.UNT_RTL_PR_AMT                                 02820015
028300*         FROM TRECDIS A                                          02830015
028400*            , TRECITM B                                          02840015
028500*            , TPURITM C                                          02850015
028600*         WHERE A.ORD_NBR = :DK-ORD-NBR                           02860015
028700*           AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR                   02870015
028800*           AND B.ORD_NBR = A.ORD_NBR                             02880015
028900*           AND B.REC_SEQ_NBR = A.REC_SEQ_NBR                     02890015
029000*           AND B.ORD_LNE_NBR = A.ORD_LNE_NBR                     02900015
029100*           AND C.PO_NBR = A.ORD_NBR                              02910015
029200*           AND C.APP_PO_LNE_NBR = A.ORD_LNE_NBR                  02920015
029300*           AND C.VER_NBR = B.PO_VER_NBR                          02930015
029400*         GROUP BY C.UNT_RTL_PR_AMT                               02940015
029500*         WITH UR                                                 02950015
029600*    END-EXEC.                                                    02960015
029700                                                                  02970000
029800******************************************************************02980000
029900 PROCEDURE DIVISION.                                              02990000
030000******************************************************************03000000
030100                                                                  03010000
030200 0000-MAINLINE.                                                   03020000
030300     OPEN OUTPUT OUTPUT-FILE.                                     03030001
030400                                                                  03040000
030500     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           03050000
030600     PERFORM 1100-VALIDATE-CONTROL-CARD.                          03060000
030700                                                                  03070001
030800     PERFORM 2000-OPEN-PO-CSR.                                    03080000
030900                                                                  03090001
031000     PERFORM 2200-PROCESS-CSR                                     03100000
031100       UNTIL  PS-END-OF-PO-CSR.                                   03110000
031200                                                                  03120000
031300     PERFORM 2300-CLOSE-PO-CSR.                                   03130000
031400                                                                  03140001
031500     MOVE PV-NUMBER-WRITES TO                                     03150001
031600          PV-DISPLAY-FIELD.                                       03160001
031700                                                                  03170001
031800     DISPLAY 'NUMBER OF RECORDS WRITTEN:  ' PV-DISPLAY-FIELD.     03180001
031900                                                                  03190000
032000     CLOSE OUTPUT-FILE.                                           03200001
032100                                                                  03210000
032200     GOBACK.                                                      03220000
032300                                                                  03230000
032400******************************************************************03240000
032500*  VALIDATE THE CONTROL CARD.                                     03250000
032600******************************************************************03260000
032700 1100-VALIDATE-CONTROL-CARD.                                      03270000
032800     IF  CC-CONSTANT = 'CONTROL'                                  03280000
032900         CONTINUE                                                 03290000
033000     ELSE                                                         03300000
033100         DISPLAY '** ABEND **'                                    03310000
033200         DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME     03320000
033300         DISPLAY '** PARAGRAPH ** = 1100-VALIDATE-CONTROL-CARD'   03330000
033400         DISPLAY '** CONTROL CONSTANT INVALID'                    03340000
033500         DISPLAY '** CONTROL CONSTANT = ' CC-CONSTANT             03350000
033600         DISPLAY '** CHANGE TO CONTROL'                           03360000
033700         MOVE +4003              TO ABEND-CODE                    03370000
033800         CALL 'ILBOABN0' USING ABEND-CODE                         03380000
033900     END-IF.                                                      03390000
034000                                                                  03400000
034100     IF  CC-OVERRIDE-NO                                           03410028
034200         PERFORM 7200-SELECT-TCOCNTL                              03420028
034300         PERFORM 7300-SELECT-TDTATTR                              03430028
034400     ELSE                                                         03440028
034500         PERFORM 7400-SELECT-TDTATTR                              03450028
034600                                                                  03460028
034700     DISPLAY '** FISCAL YEAR = ' PV-FISCAL-YEAR                   03470028
034800     DISPLAY '** FISCAL MONTH = ' PV-FISCAL-MONTH                 03480028
034900     DISPLAY '** END DATE = ' DTATTR-FSCL-MN-END-DTE.             03490028
035000     DISPLAY '** START DATE = ' DTATTR-FSCL-MN-BEG-DTE.           03500028
035100     DISPLAY '** END DATE = ' DTATTR-FSCL-MN-END-DTE.             03510028
035200     DISPLAY '** CURSOR START DATE = ' PV-START-DATE2.            03520028
035300     DISPLAY '** CURSOR END DATE   = ' PV-END-DATE2.              03530028
035400                                                                  03540005
035500     MOVE DTATTR-FSCL-MN-BEG-DTE TO                               03550027
035600          PV-START-DATE1.                                         03560005
035700     MOVE DTATTR-FSCL-MN-END-DTE TO                               03570028
035800          PV-END-DATE1.                                           03580005
035900*    MOVE CC-START-CURSOR-YYYYMMDD TO                             03590028
036000*         PV-START-DATE2.                                         03600028
036100*    MOVE CC-END-CURSOR-YYYYMMDD TO                               03610028
036200*         PV-END-DATE2.                                           03620028
036300                                                                  03630000
036400 2000-OPEN-PO-CSR.                                                03640000
036500     MOVE '2000-OPEN-PO-CSR'                                      03650000
036600         TO PV-ABEND-PARAGRAPH.                                   03660000
036700     MOVE 'OPEN THE PO_CSR'                                       03670000
036800         TO PV-DB2-OPERATION-ATTEMPTED.                           03680000
036900                                                                  03690000
037000     EXEC SQL                                                     03700000
037100         OPEN PO-CSR                                              03710004
037200     END-EXEC.                                                    03720000
037300                                                                  03730000
037400     EVALUATE TRUE                                                03740000
037500         WHEN SQLWARN0 NOT = SPACE                                03750000
037600         WHEN SQLCODE < ZERO                                      03760000
037700         WHEN SQLCODE > ZERO                                      03770000
037800             PERFORM 9100-SQL-ABEND                               03780000
037900         WHEN SQLCODE = ZERO                                      03790000
038000             CONTINUE                                             03800000
038100     END-EVALUATE.                                                03810000
038200                                                                  03820000
038300 2100-FETCH-PO-CSR.                                               03830019
038400     MOVE '2100-FETCH-PO-CSR'                                     03840000
038500         TO PV-ABEND-PARAGRAPH.                                   03850000
038600     MOVE 'FETCH THE PO_CSR'                                      03860000
038700         TO PV-DB2-OPERATION-ATTEMPTED.                           03870000
038800                                                                  03880000
038900     INITIALIZE DCLTRECEIV.                                       03890000
039000                                                                  03900000
039100     EXEC SQL                                                     03910000
039200         FETCH  PO-CSR                                            03920004
039300          INTO  :RECEIV-ORD-NBR,                                  03930000
039400                :RECEIV-REC-SEQ-NBR,                              03940001
039500                :RECEIV-OPER-UNT-ID,                              03950001
039600                :RECEIV-PACK-BY-ST-IND,                           03960001
039700                :RECEIV-EXPTED-CART-CNT,                          03970001
039800                :RECEIV-ACTL-CART-CNT,                            03980001
039900                :RECEIV-VERFYD-TMST,                              03990001
040000                :RECEIV-CRE-OPER-UNT-ID,                          04000001
040100                :RECEIV-CURR-OPER-UNT-ID,                         04010015
040200                :RECEIV-PKGNG-CDE,                                04020015
040300                :RECITM-ORD-LNE-NBR,                              04030019
040400                :RECITM-PO-VER-NBR                                04040019
040500     END-EXEC.                                                    04050000
040600                                                                  04060000
040700     EVALUATE TRUE                                                04070000
040800         WHEN SQLCODE = +100                                      04080000
040900             SET PS-END-OF-PO-CSR    TO  TRUE                     04090000
041000         WHEN SQLWARN0 NOT = SPACE                                04100000
041100         WHEN SQLCODE < ZERO                                      04110000
041200         WHEN SQLCODE > ZERO                                      04120000
041300             PERFORM 9100-SQL-ABEND                               04130000
041400         WHEN SQLCODE = ZERO                                      04140000
041500             CONTINUE                                             04150000
041600     END-EVALUATE.                                                04160000
041700                                                                  04170000
041800 2200-PROCESS-CSR.                                                04180000
041900                                                                  04190001
042000     PERFORM 2100-FETCH-PO-CSR.                                   04200000
042100                                                                  04210001
042200     IF  PS-END-OF-PO-CSR                                         04220001
042300         CONTINUE                                                 04230001
042400     ELSE                                                         04240001
042500         INITIALIZE OR-OUTPUT-RECORD                              04250001
042600*        MOVE ZEROS                   TO                          04260015
042700*             PV-EXPTED-EXT-RETAIL                                04270015
042800*             PV-VERIFY-EXT-RETAIL                                04280015
042900*             PV-AP-VERIFY-EXT-RETAIL                             04290015
043000*             PV-EXPTED-ITM-QTY                                   04300015
043100*             PV-VERIFY-ITM-QTY                                   04310015
043200*             PV-AP-VERIFY-ITM-QTY                                04320015
043300         MOVE RECEIV-ORD-NBR          TO                          04330001
043400              OR-ORD-NBR                                          04340001
043500*             DK-ORD-NBR                                          04350015
043600         MOVE RECEIV-REC-SEQ-NBR      TO                          04360001
043700              OR-REC-SEQ-NBR                                      04370001
043800*             DK-REC-SEQ-NBR                                      04380015
043900         MOVE RECEIV-OPER-UNT-ID      TO                          04390001
044000              OR-OPER-UNT-ID                                      04400001
044100         MOVE RECEIV-PACK-BY-ST-IND   TO                          04410001
044200              OR-PACK-BY-ST-IND                                   04420001
044300         MOVE RECEIV-EXPTED-CART-CNT  TO                          04430001
044400              OR-EXPTED-CART-CNT                                  04440001
044500         MOVE RECEIV-ACTL-CART-CNT    TO                          04450001
044600              OR-ACTL-CART-CNT                                    04460001
044700         MOVE RECEIV-VERFYD-TMST      TO                          04470001
044800              PV-TMST                                             04480001
044900              OR-VERFYD-TMST                                      04490009
045000*        MOVE PV-TMST-DATE-YY         TO                          04500015
045100*             OR-VERFYD-DATE-YYYY                                 04510015
045200*        MOVE PV-TMST-DATE-MM         TO                          04520015
045300*             OR-VERFYD-DATE-MM                                   04530015
045400*        MOVE PV-TMST-DATE-DD         TO                          04540015
045500*             OR-VERFYD-DATE-DD                                   04550015
045600*        MOVE '-'                     TO                          04560015
045700*             OR-VERFYD-DATE-DASH1                                04570015
045800*             OR-VERFYD-DATE-DASH2                                04580015
045900         MOVE RECEIV-CRE-OPER-UNT-ID  TO                          04590001
046000              OR-CRE-OPER-UNT-ID                                  04600001
046100         MOVE RECEIV-CURR-OPER-UNT-ID TO                          04610001
046200              OR-CURR-OPER-UNT-ID                                 04620001
046300         MOVE RECEIV-PKGNG-CDE TO                                 04630016
046400              OR-PKGNG-CDE                                        04640015
046500         MOVE RECITM-ORD-LNE-NBR      TO                          04650019
046600              OR-ORD-LNE-NBR                                      04660019
046700         MOVE RECITM-PO-VER-NBR       TO                          04670015
046800              OR-PO-VER-NBR                                       04680015
046900*        PERFORM 3000-GET-DETAIL-INFO                             04690015
047000         WRITE OUTPUT-RECORD                                      04700001
047100          FROM OR-OUTPUT-RECORD                                   04710001
047200         ADD +1 TO PV-NUMBER-WRITES                               04720001
047300                   PV-NUMBER-WRITES-DISP                          04730007
047400         IF  PV-NUMBER-WRITES-DISP > 150000                       04740015
047500             MOVE PV-NUMBER-WRITES TO                             04750007
047600                  PV-DISPLAY-FIELD                                04760007
047700             DISPLAY 'NUMBER OF RECORDS WRITTEN:  '               04770007
047800                      PV-DISPLAY-FIELD                            04780007
047900             MOVE ZEROS TO PV-NUMBER-WRITES-DISP                  04790007
048000         END-IF                                                   04800007
048100     END-IF.                                                      04810001
048200                                                                  04820000
048300 2300-CLOSE-PO-CSR.                                               04830000
048400     MOVE '2300-CLOSE-PO-CSR'                                     04840000
048500         TO PV-ABEND-PARAGRAPH.                                   04850000
048600     MOVE 'CLOSE THE PO_CSR'                                      04860000
048700         TO PV-DB2-OPERATION-ATTEMPTED.                           04870000
048800                                                                  04880000
048900     EXEC SQL                                                     04890000
049000         CLOSE PO-CSR                                             04900004
049100     END-EXEC.                                                    04910000
049200                                                                  04920000
049300     EVALUATE TRUE                                                04930000
049400         WHEN SQLWARN0 NOT = SPACE                                04940000
049500         WHEN SQLCODE < ZERO                                      04950000
049600         WHEN SQLCODE > ZERO                                      04960000
049700             PERFORM 9100-SQL-ABEND                               04970000
049800         WHEN SQLCODE = ZERO                                      04980000
049900             CONTINUE                                             04990000
050000     END-EVALUATE.                                                05000000
050100                                                                  05010000
050200******************************************************************05020010
050300*  GETS THE UNITS AND EXTENDED RETAIL VALUE FOR EACH OF THE       05030010
050400*  PO RECEIVERS                                                   05040010
050500******************************************************************05050010
050600*                                                                 05060015
050700*3000-GET-DETAIL-INFO.                                            05070015
050800*                                                                 05080015
050900*    MOVE 'N' TO PS-END-OF-DETAIL-CSR-SW.                         05090015
051000*                                                                 05100015
051100*    PERFORM 3100-OPEN-DETAIL-CSR.                                05110015
051200*                                                                 05120015
051300*    PERFORM 3200-FETCH-DETAIL-CSR                                05130015
051400*      UNTIL  PS-END-OF-DETAIL-CSR.                               05140015
051500*                                                                 05150015
051600*    PERFORM 3300-CLOSE-DETAIL-CSR.                               05160015
051700*                                                                 05170015
051800*3100-OPEN-DETAIL-CSR.                                            05180015
051900*                                                                 05190015
052000*    MOVE '3100-OPEN-DETAIL-CSR'                                  05200015
052100*        TO PV-ABEND-PARAGRAPH.                                   05210015
052200*    MOVE 'OPEN THE DETAIL-CSR'                                   05220015
052300*        TO PV-DB2-OPERATION-ATTEMPTED.                           05230015
052400*                                                                 05240015
052500*    EXEC SQL                                                     05250015
052600*        OPEN DETAIL-CSR                                          05260015
052700*    END-EXEC.                                                    05270015
052800*                                                                 05280015
052900*    EVALUATE TRUE                                                05290015
053000*        WHEN SQLWARN0 NOT = SPACE                                05300015
053100*        WHEN SQLCODE < ZERO                                      05310015
053200*        WHEN SQLCODE > ZERO                                      05320015
053300*            PERFORM 9100-SQL-ABEND                               05330015
053400*        WHEN SQLCODE = ZERO                                      05340015
053500*            CONTINUE                                             05350015
053600*    END-EVALUATE.                                                05360015
053700*                                                                 05370015
053800*3200-FETCH-DETAIL-CSR.                                           05380015
053900*                                                                 05390015
054000*    MOVE '3200-FETCH-DETAIL-CSR'                                 05400015
054100*        TO PV-ABEND-PARAGRAPH.                                   05410015
054200*    MOVE 'FETCH THE DETAIL-CSR'                                  05420015
054300*        TO PV-DB2-OPERATION-ATTEMPTED.                           05430015
054400*                                                                 05440015
054500*    INITIALIZE DCLTRECDIS.                                       05450015
054600*                                                                 05460015
054700*    EXEC SQL                                                     05470015
054800*        FETCH  DETAIL-CSR                                        05480015
054900*         INTO  :RECDIS-EXPTED-ITM-QTY,                           05490015
055000*               :RECDIS-VERIFY-ITM-QTY,                           05500015
055100*               :RECDIS-AP-VERIFY-ITM-QTY,                        05510015
055200*               :PURITM-UNT-RTL-PR-AMT                            05520015
055300*    END-EXEC.                                                    05530015
055400*                                                                 05540015
055500*    EVALUATE TRUE                                                05550015
055600*        WHEN SQLCODE = ZERO                                      05560015
055700*            MOVE ZEROS TO PV-EXPTED-EXT-RETAIL                   05570015
055800*                          PV-VERIFY-EXT-RETAIL                   05580015
055900*                          PV-AP-VERIFY-EXT-RETAIL                05590015
056000*            COMPUTE PV-EXPTED-EXT-RETAIL =                       05600015
056100*                    RECDIS-EXPTED-ITM-QTY *                      05610015
056200*                    PURITM-UNT-RTL-PR-AMT                        05620015
056300*            ADD PV-EXPTED-EXT-RETAIL TO                          05630015
056400*                OR-EXPTED-EXT-RETAIL                             05640015
056500*            COMPUTE PV-VERIFY-EXT-RETAIL =                       05650015
056600*                    RECDIS-VERIFY-ITM-QTY *                      05660015
056700*                    PURITM-UNT-RTL-PR-AMT                        05670015
056800*            ADD PV-VERIFY-EXT-RETAIL TO                          05680015
056900*                OR-VERIFY-EXT-RETAIL                             05690015
057000*            COMPUTE PV-AP-VERIFY-EXT-RETAIL =                    05700015
057100*                    RECDIS-AP-VERIFY-ITM-QTY *                   05710015
057200*                    PURITM-UNT-RTL-PR-AMT                        05720015
057300*            ADD PV-AP-VERIFY-EXT-RETAIL TO                       05730015
057400*                OR-AP-VERIFY-EXT-RETAIL                          05740015
057500*            ADD RECDIS-EXPTED-ITM-QTY TO                         05750015
057600*                OR-EXPTED-ITM-QTY                                05760015
057700*            ADD RECDIS-VERIFY-ITM-QTY TO                         05770015
057800*                OR-VERIFY-ITM-QTY                                05780015
057900*            ADD RECDIS-AP-VERIFY-ITM-QTY TO                      05790015
058000*                OR-AP-VERIFY-ITM-QTY                             05800015
058100*        WHEN SQLCODE = +100                                      05810015
058200*            SET PS-END-OF-DETAIL-CSR TO TRUE                     05820015
058300*        WHEN SQLWARN0 NOT = SPACE                                05830015
058400*        WHEN SQLCODE < ZERO                                      05840015
058500*        WHEN SQLCODE > ZERO                                      05850015
058600*            PERFORM 9100-SQL-ABEND                               05860015
058700*    END-EVALUATE.                                                05870015
058800*                                                                 05880015
058900*3300-CLOSE-DETAIL-CSR.                                           05890015
059000*    MOVE '3300-CLOSE-DETAIL-CSR'                                 05900015
059100*        TO PV-ABEND-PARAGRAPH.                                   05910015
059200*    MOVE 'CLOSE THE DETAIL-CSR'                                  05920015
059300*        TO PV-DB2-OPERATION-ATTEMPTED.                           05930015
059400*                                                                 05940015
059500*    EXEC SQL                                                     05950015
059600*        CLOSE DETAIL-CSR                                         05960015
059700*    END-EXEC.                                                    05970015
059800*                                                                 05980015
059900*    EVALUATE TRUE                                                05990015
060000*        WHEN SQLWARN0 NOT = SPACE                                06000015
060100*        WHEN SQLCODE < ZERO                                      06010015
060200*        WHEN SQLCODE > ZERO                                      06020015
060300*            PERFORM 9100-SQL-ABEND                               06030015
060400*        WHEN SQLCODE = ZERO                                      06040015
060500*            CONTINUE                                             06050015
060600*    END-EVALUATE.                                                06060015
060700                                                                  06070010
060800******************************************************************06080026
060900 7200-SELECT-TCOCNTL.                                             06090026
061000******************************************************************06100026
061100*                                                                 06110026
061200     EXEC SQL                                                     06120026
061300         SELECT                                                   06130026
061400                (BTCH_PRC_DTE - 14 DAYS)                          06140027
061500         INTO  :COCNTL-BTCH-PRC-DTE                               06150026
061600         FROM TCOCNTL                                             06160026
061700         WHERE OPER_UNT_ID = 90                                   06170026
061800     END-EXEC.                                                    06180026
061900                                                                  06190026
062000     EVALUATE TRUE                                                06200026
062100         WHEN SQLCODE = +0                                        06210026
062200         WHEN SQLCODE = +100                                      06220026
062300         WHEN SQLCODE = -811                                      06230026
062400             CONTINUE                                             06240026
062500         WHEN SQLCODE < ZERO                                      06250026
062600             MOVE '7200-SELECT-TCOCNTL'                           06260026
062700                                     TO PV-ABEND-PARAGRAPH        06270029
062800             MOVE 'SELECT'         TO PV-DB2-OPERATION-ATTEMPTED  06280029
062900             PERFORM 9100-SQL-ABEND                               06290026
063000         WHEN SQLCODE > ZERO                                      06300026
063100         WHEN SQLWARN0 NOT = SPACES                               06310026
063200             MOVE '7200-SELECT-TCOCNTL'                           06320026
063300                                      TO PV-ABEND-PARAGRAPH       06330029
063400             MOVE 'SELECT'         TO PV-DB2-OPERATION-ATTEMPTED  06340029
063500             PERFORM 9300-SQL-WARNING                             06350029
063600     END-EVALUATE.                                                06360026
063700/                                                                 06370026
063800******************************************************************06380027
063900 7300-SELECT-TDTATTR.                                             06390027
064000******************************************************************06400027
064100*                                                                 06410027
064200     EXEC SQL                                                     06420027
064300         SELECT                                                   06430027
064400                 FSCL_YR_NBR                                      06440027
064500               , FSCL_MN_NBR                                      06450027
064600               , FSCL_MN_BEG_DTE                                  06460027
064700               , FSCL_MN_END_DTE                                  06470027
064800               , FSCL_MN_BEG_DTE - 1 DAY                          06480028
064900               , FSCL_MN_END_DTE + 1 DAY                          06490028
065000         INTO   :PV-FISCAL-YEAR                                   06500028
065100               ,:PV-FISCAL-MONTH                                  06510028
065200               ,:DTATTR-FSCL-MN-BEG-DTE                           06520028
065300               ,:DTATTR-FSCL-MN-END-DTE                           06530028
065400               ,:PV-START-DATE2                                   06540028
065500               ,:PV-END-DATE2                                     06550028
065600         FROM TDTATTR                                             06560028
065700         WHERE KY_DTE  = :COCNTL-BTCH-PRC-DTE                     06570028
065800     END-EXEC.                                                    06580028
065900                                                                  06590028
066000     EVALUATE TRUE                                                06600028
066100         WHEN SQLCODE = +0                                        06610028
066200             CONTINUE                                             06620028
066300         WHEN SQLCODE = +100                                      06630028
066400         WHEN SQLCODE = -811                                      06640028
066500         WHEN SQLCODE < ZERO                                      06650028
066600             MOVE '7300-SELECT-TDTATTR'                           06660028
066700                                      TO PV-ABEND-PARAGRAPH       06670029
066800             MOVE 'SELECT'          TO PV-DB2-OPERATION-ATTEMPTED 06680029
066900             PERFORM 9100-SQL-ABEND                               06690028
067000         WHEN SQLCODE > ZERO                                      06700028
067100         WHEN SQLWARN0 NOT = SPACES                               06710028
067200             MOVE '7300-SELECT-TDTATTR'                           06720028
067300                                      TO PV-ABEND-PARAGRAPH       06730029
067400             MOVE 'SELECT'          TO PV-DB2-OPERATION-ATTEMPTED 06740029
067500             PERFORM 9300-SQL-WARNING                             06750028
067600     END-EVALUATE.                                                06760028
067700/                                                                 06770028
067800******************************************************************06780028
067900 7400-SELECT-TDTATTR.                                             06790028
068000******************************************************************06800028
068100*                                                                 06810028
068200     EXEC SQL                                                     06820028
068300         SELECT                                                   06830028
068400                 FSCL_MN_BEG_DTE                                  06840028
068500               , FSCL_MN_END_DTE                                  06850028
068600               , FSCL_MN_BEG_DTE - 1 DAY                          06860028
068700               , FSCL_MN_END_DTE + 1 DAY                          06870028
068800         INTO   :DTATTR-FSCL-MN-BEG-DTE                           06880028
068900               ,:DTATTR-FSCL-MN-END-DTE                           06890028
069000               ,:PV-START-DATE2                                   06900028
069100               ,:PV-END-DATE2                                     06910028
069200         FROM TDTATTR                                             06920028
069300         WHERE FSCL_YR_NBR = :CC-FISCAL-YY                        06930028
069400           AND FSCL_MN_NBR = :CC-FISCAL-MM                        06940031
069500     END-EXEC.                                                    06950028
069600                                                                  06960028
069700     EVALUATE TRUE                                                06970028
069800         WHEN SQLCODE = +0                                        06980028
069900         WHEN SQLCODE = -811                                      06990035
070000             MOVE CC-FISCAL-YY      TO  PV-FISCAL-YEAR            07000035
070100             MOVE CC-FISCAL-MM      TO  PV-FISCAL-MONTH           07010035
070200         WHEN SQLCODE = +100                                      07020035
070300             MOVE '7400-SELECT-TDTATTR'                           07030035
070400                                      TO PV-ABEND-PARAGRAPH       07040035
070500             MOVE 'BAD CONTROL CARD' TO PV-DB2-OPERATION-ATTEMPTED07050035
070600             PERFORM 9100-SQL-ABEND                               07060035
070700         WHEN SQLCODE < ZERO                                      07070035
070800             MOVE '7400-SELECT-TDTATTR'                           07080035
070900                                      TO PV-ABEND-PARAGRAPH       07090035
071000             MOVE 'SELECT'           TO PV-DB2-OPERATION-ATTEMPTED07100035
071100             PERFORM 9100-SQL-ABEND                               07110035
071200         WHEN SQLCODE > ZERO                                      07120035
071300         WHEN SQLWARN0 NOT = SPACES                               07130035
071400             MOVE '7400-SELECT-TDTATTR'                           07140035
071500                                      TO PV-ABEND-PARAGRAPH       07150035
071600             MOVE 'SELECT'           TO PV-DB2-OPERATION-ATTEMPTED07160035
071700             PERFORM 9300-SQL-WARNING                             07170035
071800     END-EVALUATE.                                                07180035
071900/                                                                 07190035
072000******************************************************************07200035
072100 9100-SQL-ABEND.                                                  07210035
072200******************************************************************07220035
072300*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    07230000
072400*  ERROR OR WARNING CODE OCCURS.                                  07240000
072500******************************************************************07250000
072600     DISPLAY '9100-SQL-ABEND'.                                    07260000
072700     DISPLAY '** ABEND     **'.                                   07270000
072800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07280000
072900     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             07290000
073000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     07300000
073100                                                                  07310000
073200******************************************************************07320000
073300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    07330000
073400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         07340000
073500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     07350000
073600* FORMAT.                                                         07360000
073700******************************************************************07370000
073800     COPY DPPD004.                                                07380037
073900                                                                  07390000
074000     MOVE +4013                  TO ABEND-CODE.                   07400000
074100     CALL 'ILBOABN0' USING ABEND-CODE.                            07410000
074200*9100-EXIT.                                                       07420000
074300******************************************************************07430029
074400 9300-SQL-WARNING.                                                07440029
074500******************************************************************07450029
074600                                                                  07460029
074700     DISPLAY '9300-SQL-WARNING'.                                  07470029
074800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07480029
074900     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             07490029
075000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED      07500029
075100                                                                  07510029
075200     MOVE SQLCODE                     TO SQLCODE2.                07520029
075300     MOVE SQLERRD(3)                  TO SQLERRD3.                07530029
075400     DISPLAY '** ABEND **       ** = SQLWARNING'.                 07540029
075500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  07550029
075600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  07560029
075700     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  07570029
075800     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  07580029
075900     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  07590029
076000     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  07600029
076100     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  07610029
076200     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  07620029
076300     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  07630029
076400     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  07640029
076500                                                                  07650029
076600     MOVE +4013                       TO PV-ABEND-CODE.           07660029
076700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07670029
076800*                                                                 07680029
