000100*-----------------------*                                         11/02/93
000200 IDENTIFICATION DIVISION.                                         CNKCS201
000300*-----------------------*                                            LV001
000400 PROGRAM-ID.    CNKCS201.                                         CNKCS201
000500 AUTHOR.        ANNE YEKO.                                        CNKCS201
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          CNKCS201
000700 DATE-WRITTEN.  04-19-93.                                         CNKCS201
000800 DATE-COMPILED.                                                   CNKCS201
000900*----------------------------------------------------------------*CNKCS201
001000*    Y201 - FACILITY LOCATION/TICKET FORMAT CRITERIA             *CNKCS201
001100*                                                                *CNKCS201
001200*    THIS PROGRAM ALLOWS THE USER TO ENTER DATA TO BE USED BY    *CNKCS201
001300*    SUBSEQUENT PROGRAMS TO CREATE UPDATABLE LIST SCREENS.       *CNKCS201
001400*    THE OPER UNIT IS A REQUIRED FIELD AND MUST EXIST ON THE     *   CL**2
001500*    FACLTY TABLE.  ALL OTHER FIELDS ARE OPTIONAL, BUT WILL BE   *   CL**2
001600*    VALIDATED.                                                  *CNKCS201
001700*----------------------------------------------------------------*CNKCS201
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455                 
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263455* MAKING THE CALL DYNAMIC VS STATIC.                                      
263455*----------------------------------------------------------------*        
CICS  * CHANGED 10/24/2022    BY JIM HUNTER      WR: CHG0276961                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001800                                                                  CNKCS201
001900                                                                  CNKCS201
002000 ENVIRONMENT DIVISION.                                            CNKCS201
002100                                                                  CNKCS201
002200 DATA DIVISION.                                                   CNKCS201
002300                                                                  CNKCS201
002400                                                                  CNKCS201
002500 WORKING-STORAGE SECTION.                                         CNKCS201
002600                                                                  CNKCS201
002700 01  DK-DB2-KEYS.                                                    CL*11
002800     05  DK-OPER-UNT-ID            PIC  S9(04) COMP.                 CL*11
002900     05  DK-FCLTY-ID               PIC  S9(04) COMP.                 CL*11
003000                                                                     CL*11
003100 01  PC-PROGRAM-CONSTANTS.                                        CNKCS201
003200     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'CN201A  '. CNKCS201
003300     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'CNKM201 '. CNKCS201
003400     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'CNKCS201'. CNKCS201
003500     05  PC-MAX-RETRIES            PIC  9(01)  VALUE  3.          CNKCS201
003600     05  PC-TSYMSG-NUMBERS.                                       CNKCS201
003700         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.      CNKCS201
003800*            INVALID VALUE                                        CNKCS201
003900         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      CNKCS201
004000*            REQUIRED ENTRY                                       CNKCS201
004100         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      CNKCS201
004200*            MUST BE NUMERIC                                      CNKCS201
004300         10  PC-TSYMSG-00032       PIC  9(05)  VALUE  00032.      CNKCS201
004400*            DEPARTMENT DOES NOT EXIST                            CNKCS201
004500                                                                  CNKCS201
004600 01  PV-PROGRAM-VARIABLES.                                        CNKCS201
004700     05  PV-RETRY-COUNTER          PIC  9(03)  VALUE  0           CNKCS201
004800                                               COMP-3.            CNKCS201
004900                                                                  CNKCS201
005000 01  PS-PROGRAM-SWITCHES.                                         CNKCS201
005100     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        CNKCS201
005200         88  PS-ERROR                          VALUE  'Y'.        CNKCS201
005300         88  PS-NO-ERROR                       VALUE  'N'.        CNKCS201
005400                                                                  CNKCS201
005500*----------------------------------------------------------------*CNKCS201
005600*    MAP LAYOUT                                                  *CNKCS201
005700*----------------------------------------------------------------*CNKCS201
005800                                                                  CNKCS201
005900     COPY CNKM201.                                                CNKCS201
006000     EJECT                                                        CNKCS201
006100*----------------------------------------------------------------*CNKCS201
006200*    ATTRIBUTE SETTINGS COPYBOOK.                                *CNKCS201
006300*----------------------------------------------------------------*CNKCS201
006400                                                                  CNKCS201
006500     COPY DPWS015.                                                CNKCS201
006600                                                                  CNKCS201
006700*----------------------------------------------------------------*CNKCS201
006800*    FUNCTION KEYS COPYBOOK                                      *CNKCS201
006900*----------------------------------------------------------------*CNKCS201
007000                                                                  CNKCS201
007100     COPY DPWS016.                                                CNKCS201
007200 EJECT                                                            CNKCS201
007300******************************************************************CNKCS201
007400** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **CNKCS201
007500** SUB-ROUTINE (DPKUT100).                                      **CNKCS201
007600******************************************************************CNKCS201
007700     COPY DPWS010I.                                               CNKCS201
007800 EJECT                                                            CNKCS201
007900******************************************************************CNKCS201
008000** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **CNKCS201
008100** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **CNKCS201
008200******************************************************************CNKCS201
008300     COPY DPWS030.                                                CNKCS201
CICS       COPY DPWS930.                                                        
008400 EJECT                                                            CNKCS201
008500***************************************************************** CNKCS201
008600*    STANDARD COMMAREA.                                           CNKCS201
008700***************************************************************** CNKCS201
008800                                                                  CNKCS201
008900     COPY DPWS020.                                                CNKCS201
009000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                CNKCS201
009100                                                                  CNKCS201
009200***************************************************************** CNKCS201
009300*    INTER-APPLICATION COMMAREA.                                  CNKCS201
009400***************************************************************** CNKCS201
009500                                                                  CNKCS201
009600         10  INTER-APPL-COMM-AREA PIC X(200).                     CNKCS201
009700     COPY CNWS001.                                                   CL*24
009800***************************************************************** CNKCS201
009900*    SPECIFIC COMMMAREA FOR CNKCS201.                             CNKCS201
010000***************************************************************** CNKCS201
010100         10  ASC-SPECIFIC-COMMAREA.                               CNKCS201
010200             15  ASC-OPER-UNT-ID             PIC  X(04).             CL**8
010300             15  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID         CL**8
010400                                             PIC  9(04).             CL**2
010500             15  ASC-FCLTY-ID                PIC  X(04).             CL**8
010600             15  ASC-FCLTY-ID-N  REDEFINES  ASC-FCLTY-ID             CL**8
010700                                             PIC  9(04).             CL**2
010800             15  ASC-FCLTY-NME               PIC  X(25).             CL*19
010900             15  ASC-DEPT-NBR                PIC  X(03).             CL**8
011000             15  ASC-DEPT-NBR-N REDEFINES ASC-DEPT-NBR               CL**8
011100                                             PIC  9(03).          CNKCS201
011200             15  ASC-AREA-ID                 PIC  X(06).             CL**8
011300             15  ASC-LOC-TYPE                PIC  X(02).          CNKCS201
011400             15  ASC-TKT-FMT-ID              PIC  X(06).             CL**8
011500             15  ASC-SEL-UNASSIGNED          PIC  X(01).          CNKCS201
011600     EJECT                                                        CNKCS201
011700*----------------------------------------------------------------*CNKCS201
011800*    ABEND PROCESSING COPYBOOK.                                  *CNKCS201
011900*----------------------------------------------------------------*CNKCS201
012000                                                                  CNKCS201
012100     COPY DPWS013.                                                CNKCS201
012200                                                                  CNKCS201
012300*----------------------------------------------------------------*CNKCS201
012400*    COMMAREA FOR XLKUT071                                       *CNKCS201
012500*----------------------------------------------------------------*CNKCS201
012600                                                                  CNKCS201
012700     COPY XLWS071.                                                CNKCS201
012800                                                                  CNKCS201
012900*----------------------------------------------------------------*CNKCS201
013000*    DB2 AREA FOR THE FACILITY LOCATION TABLE                    *CNKCS201
013100*----------------------------------------------------------------*CNKCS201
013200                                                                  CNKCS201
013300     EXEC SQL                                                     CNKCS201
013400         INCLUDE TFLAREA                                             CL**2
013500     END-EXEC.                                                    CNKCS201
013600                                                                  CNKCS201
013700*----------------------------------------------------------------*CNKCS201
013800*    DB2 AREA FOR THE TICKET FORMAT TABLE                        *CNKCS201
013900*----------------------------------------------------------------*CNKCS201
014000                                                                  CNKCS201
014100     EXEC SQL                                                     CNKCS201
014200         INCLUDE TTKTFMT                                             CL*22
014300     END-EXEC.                                                    CNKCS201
014400                                                                  CNKCS201
014500*----------------------------------------------------------------*CNKCS201
014600*    DB2 AREA FOR THE DEPARTMENT/CLASS TICKET FORMAT TABLE       *CNKCS201
014700*----------------------------------------------------------------*CNKCS201
014800                                                                  CNKCS201
014900     EXEC SQL                                                     CNKCS201
015000         INCLUDE TDCTFAS                                             CL*22
015100     END-EXEC.                                                    CNKCS201
015200                                                                  CNKCS201
015300*----------------------------------------------------------------*CNKCS201
015400*    DB2 AREA FOR THE FACILITY LOCATION TYPE TABLE               *CNKCS201
015500*----------------------------------------------------------------*CNKCS201
015600                                                                  CNKCS201
015700     EXEC SQL                                                     CNKCS201
015800         INCLUDE TFLTYPE                                          CNKCS201
015900     END-EXEC.                                                    CNKCS201
016000                                                                  CNKCS201
016100*----------------------------------------------------------------*CNKCS201
016200*    DB2 AREA FOR COMMUNICATIONS                                 *CNKCS201
016300*----------------------------------------------------------------*CNKCS201
016400                                                                  CNKCS201
016500     EXEC SQL                                                     CNKCS201
016600         INCLUDE SQLCA                                            CNKCS201
016700     END-EXEC.                                                    CNKCS201
016800                                                                  CNKCS201
016900 EJECT                                                            CNKCS201
017000 LINKAGE SECTION.                                                 CNKCS201
017100                                                                  CNKCS201
017200 01  DFHCOMMAREA.                                                 CNKCS201
017300     05  FILLER                         OCCURS  1 TO 4072 TIMES   CNKCS201
017400                                        DEPENDING ON EIBCALEN.    CNKCS201
017500         10  FILLER                     PIC X.                    CNKCS201
017600                                                                  CNKCS201
017700                                                                  CNKCS201
017800 PROCEDURE DIVISION.                                              CNKCS201
017900                                                                  CNKCS201
018000***************************************************************** CNKCS201
018100** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** CNKCS201
018200** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** CNKCS201
018300** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** CNKCS201
018400**                                                             ** CNKCS201
018500** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** CNKCS201
018600** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** CNKCS201
018700***************************************************************** CNKCS201
018800                                                                  CNKCS201
018900 0000-MAIN-MODULE.                                                CNKCS201
019000                                                                  CNKCS201
019100     INITIALIZE DP030-CICS-API-FIELDS.                            CNKCS201
019200     MOVE +1                     TO DP030-NUMBER-OF-MAPS.         CNKCS201
019300     MOVE PC-CURRENT-MAPSET-NAME TO DP030-MAPSET-NAME.            CNKCS201
019400     MOVE PC-CURRENT-MAP-NAME    TO DP030-MAP-NAME (1).           CNKCS201
019500     SET DP030-RECEIVE-APPL-MAP  TO TRUE.                         CNKCS201
019600     MOVE LENGTH OF CN201AI      TO DP030-MAP-LENGTH (1).         CNKCS201
019700     MOVE 'PROGRAM ENTRY CALL'   TO DP013-MESSAGE-TEXT (1).       CNKCS201
019800                                                                  CNKCS201
019900     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS201
020000     PERFORM 1000-CONTROL-PROCESSING                              CNKCS201
020100                                                                  CNKCS201
020200     MOVE 'PROGRAM EXIT CALL'    TO DP013-MESSAGE-TEXT (1).       CNKCS201
020300     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS201
020400                                                                  CNKCS201
020500                                                                  CNKCS201
020600 0001-CALL-CICS-ARCH-API.                                         CNKCS201
020700                                                                  CNKCS201
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
020900                                    DFHCOMMAREA                           
021000                                    DP030-CICS-API-FIELDS                 
021100                                    DP020-STANDARD-COMMAREA               
021200                                    CN201AI.                              
021300                                                                  CNKCS201
021400     IF  DP030-RC-CALL-SUCCESSFUL                                 CNKCS201
021500         CONTINUE                                                 CNKCS201
021600     ELSE                                                         CNKCS201
021700         SET DP013-NO-ROLLBACK                                    CNKCS201
021800             DP013-XCTL-DISPLAY-RESTART                           CNKCS201
021900             DP013-CICS-ABEND    TO TRUE                          CNKCS201
022000         MOVE 'BEFORE 0000-MAIN-MODULE'                           CNKCS201
022100                                 TO DP013-PARAGRAPH               CNKCS201
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
022400         MOVE DP030-RETURN-CODE  TO DP013-MESSAGE-TEXT (3)        CNKCS201
022500         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS201
022600     END-IF.                                                      CNKCS201
022700 EJECT                                                            CNKCS201
022800                                                                  CNKCS201
022900*----------------------------------------------------------------*CNKCS201
023000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *CNKCS201
023100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *CNKCS201
023200*----------------------------------------------------------------*CNKCS201
023300                                                                  CNKCS201
023400 1000-CONTROL-PROCESSING.                                         CNKCS201
023500                                                                  CNKCS201
023600     EVALUATE TRUE                                                CNKCS201
023700         WHEN DP020-NEXT-ACT-INITIAL                              CNKCS201
023800             INITIALIZE ASC-SPECIFIC-COMMAREA                     CNKCS201
023900             PERFORM 4000-BUILD-INITIAL-PANEL                     CNKCS201
024000                                                                  CNKCS201
024100         WHEN DP020-NEXT-ACT-READ-MAP                             CNKCS201
024200             PERFORM 2000-FKEY-PROCESSING                         CNKCS201
024300                                                                  CNKCS201
024400         WHEN DP020-NEXT-ACT-RETURN                               CNKCS201
024500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS201
024600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS201
024700                                                                  CNKCS201
024800         WHEN OTHER                                               CNKCS201
024900             SET DP013-LOGIC-ABEND                                CNKCS201
025000                 DP013-NO-ROLLBACK                                CNKCS201
025100                                 TO TRUE                          CNKCS201
025200             MOVE '1000-CONTROL-PROCESSING'                       CNKCS201
025300                                 TO  DP013-PARAGRAPH              CNKCS201
025400             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   CNKCS201
025500                                 TO  DP013-MESSAGE-TEXT(1)        CNKCS201
025600             MOVE DP020-NEXT-APPL-ACTIVITY                        CNKCS201
025700                                 TO DP013-MESSAGE-TEXT(2)         CNKCS201
025800             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS201
025900     END-EVALUATE.                                                CNKCS201
026000                                                                  CNKCS201
026100*----------------------------------------------------------------*CNKCS201
026200* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*CNKCS201
026300* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*CNKCS201
026400* EDITS.                                                         *CNKCS201
026500*----------------------------------------------------------------*CNKCS201
026600                                                                  CNKCS201
026700 2000-FKEY-PROCESSING.                                            CNKCS201
026800                                                                  CNKCS201
026900     EVALUATE TRUE                                                CNKCS201
027000                                                                  CNKCS201
027100         WHEN DP020-SRC-AID = DP016-CLEAR                         CNKCS201
027200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS201
027300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS201
027400                                                                  CNKCS201
027500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     CNKCS201
027600             INITIALIZE ASC-SPECIFIC-COMMAREA                     CNKCS201
027700             PERFORM 4000-BUILD-INITIAL-PANEL                     CNKCS201
027800             PERFORM 3100-RESET-ATTRIBUTES                        CNKCS201
027900                                                                  CNKCS201
028000         WHEN OTHER                                               CNKCS201
028100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 CNKCS201
028200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS201
028300             IF  PS-NO-ERROR                                      CNKCS201
028400                 SET DP030-CONTINUE-GO                            CNKCS201
028500                                 TO TRUE                          CNKCS201
028600                 PERFORM 2100-CHECK-FUNCTION-KEY                  CNKCS201
028700             ELSE                                                 CNKCS201
028800                 SET DP030-OVERRIDE-GO                            CNKCS201
028900                                 TO TRUE                          CNKCS201
029000             END-IF                                               CNKCS201
029100     END-EVALUATE.                                                CNKCS201
029200                                                                  CNKCS201
029300******************************************************************CNKCS201
029400** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **CNKCS201
029500** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **CNKCS201
029600** FROM THE CICS ARCHITECTURE API.                              **CNKCS201
029700******************************************************************CNKCS201
029800                                                                  CNKCS201
029900 2100-CHECK-FUNCTION-KEY.                                         CNKCS201
030000                                                                  CNKCS201
030100     EVALUATE TRUE                                                CNKCS201
030200         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 CNKCS201
030300             PERFORM 2110-PREPARE-INTER-APPL-COMM                 CNKCS201
030400                                                                  CNKCS201
030500         WHEN DP020-SRC-AID = DP016-ENTER                         CNKCS201
030600             CONTINUE                                             CNKCS201
030700                                                                  CNKCS201
030800         WHEN OTHER                                               CNKCS201
030900             SET DP013-NO-ROLLBACK                                CNKCS201
031000                 DP013-XCTL-DISPLAY-RESTART                       CNKCS201
031100                 DP013-CICS-ABEND                                 CNKCS201
031200                                 TO TRUE                          CNKCS201
031300             MOVE '2100-CHECK-FUNCTION-KEY'                       CNKCS201
031400                                 TO DP013-PARAGRAPH               CNKCS201
031500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      CNKCS201
031600                                 TO DP013-MESSAGE-TEXT (1)        CNKCS201
031700             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS201
031800     END-EVALUATE.                                                CNKCS201
031900                                                                  CNKCS201
032000******************************************************************CNKCS201
032100** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **CNKCS201
032200** INTER-APPLICATION COMMAREA.                                  **CNKCS201
032300******************************************************************CNKCS201
032400                                                                  CNKCS201
032500 2110-PREPARE-INTER-APPL-COMM.                                    CNKCS201
032600                                                                  CNKCS201
032700     MOVE ASC-OPER-UNT-ID        TO CN001-OPER-UNT-ID.               CL**8
032800     MOVE ASC-FCLTY-ID           TO CN001-FCLTY-ID.                  CL**8
032900     MOVE ASC-DEPT-NBR           TO CN001-DEPT-NBR.                  CL**8
033000     MOVE ASC-AREA-ID            TO CN001-AREA-ID.                   CL**8
033100     MOVE ASC-LOC-TYPE           TO CN001-LOC-TYPE.               CNKCS201
033200     MOVE ASC-TKT-FMT-ID         TO CN001-TKT-FMT-ID.                CL**8
033300     MOVE ASC-SEL-UNASSIGNED     TO CN001-SEL-UNASSIGNED.         CNKCS201
033400 EJECT                                                            CNKCS201
033500                                                                  CNKCS201
033600*----------------------------------------------------------------*CNKCS201
033700* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*CNKCS201
033800* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *CNKCS201
033900* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *CNKCS201
034000*----------------------------------------------------------------*CNKCS201
034100                                                                  CNKCS201
034200 2200-MOVE-SCREEN-TO-COMMAREA.                                    CNKCS201
034300                                                                  CNKCS201
034400     IF  AOPERL > ZERO                                               CL**2
034500         MOVE AOPERI               TO ASC-OPER-UNT-ID                CL**8
034600     ELSE                                                         CNKCS201
034700         IF  AOPERF = DP015-ERASE-EOF                                CL**2
034800             MOVE SPACE            TO ASC-OPER-UNT-ID                CL**8
034900         END-IF                                                   CNKCS201
035000     END-IF.                                                      CNKCS201
035100                                                                     CL**2
035200     IF  AFCLTYL > ZERO                                              CL**2
035300         MOVE AFCLTYI              TO ASC-FCLTY-ID                   CL**8
035400     ELSE                                                            CL**2
035500         IF  AFCLTYF = DP015-ERASE-EOF                               CL**2
035600             MOVE SPACE            TO ASC-FCLTY-ID                   CL**8
035700         END-IF                                                      CL**2
035800     END-IF.                                                         CL**2
035900                                                                  CNKCS201
036000     IF  ADEPTL > ZERO                                            CNKCS201
036100         MOVE ADEPTI               TO ASC-DEPT-NBR                   CL**8
036200     ELSE                                                         CNKCS201
036300         IF  ADEPTF = DP015-ERASE-EOF                             CNKCS201
036400             MOVE SPACE            TO ASC-DEPT-NBR                   CL**8
036500         END-IF                                                   CNKCS201
036600     END-IF.                                                      CNKCS201
036700                                                                  CNKCS201
036800     IF  ALOCL > ZERO                                             CNKCS201
036900         MOVE ALOCI                TO ASC-AREA-ID                    CL**8
037000     ELSE                                                         CNKCS201
037100         IF  ALOCF = DP015-ERASE-EOF                              CNKCS201
037200             MOVE SPACE            TO ASC-AREA-ID                    CL**8
037300         END-IF                                                   CNKCS201
037400     END-IF.                                                      CNKCS201
037500                                                                  CNKCS201
037600     IF  ATYPEL > ZERO                                            CNKCS201
037700         MOVE ATYPEI               TO ASC-LOC-TYPE                CNKCS201
037800     ELSE                                                         CNKCS201
037900         IF  ATYPEF = DP015-ERASE-EOF                             CNKCS201
038000             MOVE SPACE            TO ASC-LOC-TYPE                CNKCS201
038100         END-IF                                                   CNKCS201
038200     END-IF.                                                      CNKCS201
038300                                                                  CNKCS201
038400     IF  AFMTL > ZERO                                             CNKCS201
038500         MOVE AFMTI                TO ASC-TKT-FMT-ID                 CL**8
038600     ELSE                                                         CNKCS201
038700         IF  AFMTF = DP015-ERASE-EOF                              CNKCS201
038800             MOVE SPACE            TO ASC-TKT-FMT-ID                 CL**8
038900         END-IF                                                   CNKCS201
039000     END-IF.                                                      CNKCS201
039100                                                                  CNKCS201
039200     IF  ASALLL > ZERO                                            CNKCS201
039300         MOVE ASALLI               TO ASC-SEL-UNASSIGNED          CNKCS201
039400     ELSE                                                         CNKCS201
039500         IF  ASALLF = DP015-ERASE-EOF                             CNKCS201
039600             MOVE SPACE            TO ASC-SEL-UNASSIGNED          CNKCS201
039700         END-IF                                                   CNKCS201
039800     END-IF.                                                      CNKCS201
039900                                                                  CNKCS201
040000*----------------------------------------------------------------*CNKCS201
040100* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *CNKCS201
040200* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *CNKCS201
040300* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*CNKCS201
040400* IN THE DESTINATION PROGRAM, NOT HERE.                          *CNKCS201
040500*----------------------------------------------------------------*CNKCS201
040600                                                                  CNKCS201
040700 3000-EDIT-DATA-IN-COMMAREA.                                      CNKCS201
040800                                                                  CNKCS201
040900     PERFORM 3100-RESET-ATTRIBUTES.                               CNKCS201
041000                                                                  CNKCS201
041100     IF  ASC-SEL-UNASSIGNED > SPACE                               CNKCS201
041200         IF  ASC-SEL-UNASSIGNED NOT = 'Y' AND 'N'                 CNKCS201
041300             SET PS-ERROR                                         CNKCS201
041400                 DP020-MSG-FATAL  TO TRUE                         CNKCS201
041500             MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER             CNKCS201
041600             MOVE DP015-UNP-ALP-BRT-OFF                              CL**2
041700                                  TO ASALLA                       CNKCS201
041800             MOVE DP015-RED       TO ASALLC                       CNKCS201
041900             MOVE DP015-REVERSE   TO ASALLH                       CNKCS201
042000             MOVE -1              TO ASALLL                       CNKCS201
042100             SET DP030-SET-CURSOR-APPL-1                          CNKCS201
042200                                  TO TRUE                         CNKCS201
042300         END-IF                                                   CNKCS201
042400     END-IF.                                                      CNKCS201
042500                                                                  CNKCS201
042600     IF  ASC-OPER-UNT-ID = SPACES OR ZEROES                          CL*15
042700         SET PS-ERROR                                                CL*11
042800             DP020-MSG-FATAL     TO TRUE                             CL*11
042900         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER                 CL*11
043000         MOVE DP015-UNP-ALP-BRT-OFF                                  CL*11
043100                                 TO AOPERA                           CL*11
043200         MOVE DP015-RED          TO AOPERC                           CL*11
043300         MOVE DP015-REVERSE      TO AOPERH                           CL*11
043400         MOVE -1                 TO AOPERL                           CL*11
043500         SET DP030-SET-CURSOR-APPL-1                                 CL*11
043600                                 TO TRUE                             CL*11
043700     ELSE                                                            CL*11
043800         MOVE ASC-OPER-UNT-ID    TO DP010I-UNEDITED-FIELD            CL*11
043900         MOVE LENGTH OF ASC-OPER-UNT-ID                              CL*11
044000                                 TO DP010I-MAXIMUM-DIGITS            CL*11
044100         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS          CL*11
044200         SET DP010I-NEGATIVE-NOT-ALLOWED                             CL*11
044300                                 TO TRUE                             CL*11
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263455              USING DP010I-NUMERIC-EDIT-AREA                              
044500         IF  DP010I-ERROR-DETECTED                                   CL*11
044600             SET PS-ERROR                                            CL*11
044700                 DP020-MSG-FATAL TO TRUE                             CL*11
044800             MOVE PC-TSYMSG-00008                                    CL*11
044900                                 TO DP020-MSG-NUMBER                 CL*11
045000             MOVE DP015-UNP-ALP-BRT-OFF                              CL*11
045100                                 TO AOPERA                           CL*11
045200             MOVE DP015-RED      TO AOPERC                           CL*11
045300             MOVE DP015-REVERSE  TO AOPERH                           CL*11
045400             MOVE -1             TO AOPERL                           CL*11
045500             SET DP030-SET-CURSOR-APPL-1                             CL*11
045600                                 TO TRUE                             CL*11
045700         ELSE                                                        CL*11
045800             MOVE DP010I-NUMERIC-FIELD                               CL*11
045900                                 TO ASC-OPER-UNT-ID-N                CL*11
046000                                    DK-OPER-UNT-ID                   CL*11
046100             MOVE ASC-OPER-UNT-ID TO AOPERO                          CL*11
046200             PERFORM 3700-VALIDATE-OPER-UNT-ID                       CL*11
046300         END-IF                                                      CL*11
046400     END-IF.                                                         CL*11
046500                                                                     CL*11
046600     IF  ASC-FCLTY-ID = SPACES OR ZEROES                             CL*20
046700         MOVE ZEROES             TO ASC-FCLTY-ID-N                   CL*20
046800                                    DK-FCLTY-ID                      CL*20
046900     ELSE                                                            CL*20
047000         MOVE ASC-FCLTY-ID       TO DP010I-UNEDITED-FIELD            CL*20
047100         MOVE LENGTH OF ASC-FCLTY-ID                                 CL*20
047200                                 TO DP010I-MAXIMUM-DIGITS            CL*20
047300         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS          CL*20
047400         SET DP010I-NEGATIVE-NOT-ALLOWED                             CL*20
047500                                 TO TRUE                             CL*20
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263455              USING DP010I-NUMERIC-EDIT-AREA                              
047700         IF  DP010I-ERROR-DETECTED                                   CL*20
047800             SET PS-ERROR                                            CL*20
047900                 DP020-MSG-FATAL TO TRUE                             CL*20
048000             MOVE PC-TSYMSG-00008                                    CL*20
048100                                 TO DP020-MSG-NUMBER                 CL*20
048200             MOVE DP015-UNP-ALP-BRT-OFF                              CL*20
048300                                 TO AFCLTYA                          CL*20
048400             MOVE DP015-RED      TO AFCLTYC                          CL*20
048500             MOVE DP015-REVERSE  TO AFCLTYH                          CL*20
048600             MOVE -1             TO AFCLTYL                          CL*20
048700             SET DP030-SET-CURSOR-APPL-1                             CL*20
048800                                 TO TRUE                             CL*20
048900         ELSE                                                        CL*20
049000             MOVE DP010I-NUMERIC-FIELD                               CL*20
049100                                 TO ASC-FCLTY-ID-N                   CL*20
049200                                    DK-FCLTY-ID                      CL*20
049300             MOVE ASC-FCLTY-ID   TO AFCLTYO                          CL*20
049400         END-IF                                                      CL*20
049500     END-IF.                                                         CL*20
049600                                                                     CL*20
049700**?? PERFORM 3600-VALIDATE-FCLTY-ID.                                 CL*20
049800                                                                     CL*20
049900     IF  ASC-TKT-FMT-ID > SPACE                                      CL*11
050000     AND PS-NO-ERROR                                                 CL*11
050100         PERFORM 3200-VALIDATE-TKT-FMT-ID                            CL**8
050200     END-IF.                                                      CNKCS201
050300                                                                  CNKCS201
050400     IF ASC-LOC-TYPE > SPACES                                     CNKCS201
050500     AND PS-NO-ERROR                                                 CL*11
050600         PERFORM 3300-VALIDATE-LOC-TYPE                           CNKCS201
050700     END-IF.                                                      CNKCS201
050800                                                                  CNKCS201
050900     IF ASC-AREA-ID > SPACES                                         CL**8
051000     AND PS-NO-ERROR                                                 CL*11
051100         PERFORM 3400-VALIDATE-AREA-ID                               CL**8
051200     END-IF.                                                      CNKCS201
051300                                                                  CNKCS201
051400     IF  ASC-DEPT-NBR > SPACE                                        CL**8
051500     AND PS-NO-ERROR                                                 CL*11
051600         MOVE ASC-DEPT-NBR       TO DP010I-UNEDITED-FIELD            CL**8
051700         MOVE LENGTH OF ASC-DEPT-NBR TO DP010I-MAXIMUM-DIGITS        CL**8
051800         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       CNKCS201
051900         SET DP010I-NEGATIVE-NOT-ALLOWED                          CNKCS201
052000                                 TO TRUE                          CNKCS201
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263455              USING DP010I-NUMERIC-EDIT-AREA                              
052200         IF  DP010I-ERROR-DETECTED                                CNKCS201
052300             SET PS-ERROR                                         CNKCS201
052400                 DP020-MSG-FATAL TO TRUE                          CNKCS201
052500             MOVE PC-TSYMSG-00008                                 CNKCS201
052600                                 TO DP020-MSG-NUMBER              CNKCS201
052700             MOVE DP015-UNP-ALP-BRT-OFF                              CL**2
052800                                 TO ADEPTA                        CNKCS201
052900             MOVE DP015-RED      TO ADEPTC                        CNKCS201
053000             MOVE DP015-REVERSE  TO ADEPTH                        CNKCS201
053100             MOVE -1             TO ADEPTL                        CNKCS201
053200             SET DP030-SET-CURSOR-APPL-1                          CNKCS201
053300                                 TO TRUE                          CNKCS201
053400         ELSE                                                     CNKCS201
053500             MOVE DP010I-NUMERIC-FIELD                            CNKCS201
053600                                 TO ASC-DEPT-NBR-N                   CL**8
053700             MOVE ASC-DEPT-NBR   TO ADEPTO                           CL**8
053800             PERFORM 3500-VALIDATE-DEPT-NBR                          CL**8
053900         END-IF                                                   CNKCS201
054000     END-IF.                                                      CNKCS201
054100                                                                  CNKCS201
054200     IF  PS-NO-ERROR                                              CNKCS201
054300         MOVE -1                 TO AFCLTYL                       CNKCS201
054400         SET DP030-SET-CURSOR-APPL-1                              CNKCS201
054500                                 TO TRUE                          CNKCS201
054600     END-IF.                                                      CNKCS201
054700                                                                  CNKCS201
054800*----------------------------------------------------------------*CNKCS201
054900*  MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE  *CNKCS201
055000*  MAP.                                                          *CNKCS201
055100*----------------------------------------------------------------*CNKCS201
055200                                                                  CNKCS201
055300 3100-RESET-ATTRIBUTES.                                           CNKCS201
055400                                                                  CNKCS201
055500     MOVE DP015-UNP-ALP-NOR-OFF    TO AOPERA                         CL**2
055600                                      AFCLTYA                        CL**2
055700                                      ADEPTA                         CL**2
055800                                      ALOCA                          CL**2
055900                                      ATYPEA                      CNKCS201
056000                                      AFMTA                       CNKCS201
056100                                      ASALLA.                     CNKCS201
056200     MOVE DP015-GREEN              TO AOPERC                         CL**6
056300                                      AFCLTYC                        CL**6
056400                                      ADEPTC                      CNKCS201
056500                                      ALOCC                       CNKCS201
056600                                      ATYPEC                      CNKCS201
056700                                      AFMTC                       CNKCS201
056800                                      ASALLC.                     CNKCS201
056900     MOVE DP015-UNDERLINE          TO AOPERH                         CL**6
057000                                      AFCLTYH                        CL**6
057100                                      ADEPTH                      CNKCS201
057200                                      ALOCH                       CNKCS201
057300                                      ATYPEH                      CNKCS201
057400                                      AFMTH                       CNKCS201
057500                                      ASALLH.                     CNKCS201
057600                                                                  CNKCS201
057700*----------------------------------------------------------------*CNKCS201
057800*  CHECK THE TICKET FORMAT TABLE TO VERIFY THAT THE FORMAT       *CNKCS201
057900*  ENTERED ON THE MAP IS VALID.                                  *CNKCS201
058000*----------------------------------------------------------------*CNKCS201
058100                                                                  CNKCS201
058200 3200-VALIDATE-TKT-FMT-ID.                                           CL**8
058300                                                                  CNKCS201
058400     PERFORM                                                      CNKCS201
058500         WITH TEST AFTER                                          CNKCS201
058600         VARYING PV-RETRY-COUNTER                                 CNKCS201
058700         FROM 1 BY 1                                              CNKCS201
058800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS201
058900                   OR (SQLCODE = ZERO)                            CNKCS201
059000                   OR (SQLCODE = +100))                           CNKCS201
059100                                                                  CNKCS201
059200         EXEC SQL                                                 CNKCS201
059300            SELECT  TKT_FMT_ID                                       CL**8
059400              INTO :TKTFMT-TKT-FMT-ID                                CL*23
059500              FROM  TTKTFMT                                          CL*22
059600             WHERE  OPER_UNT_ID = :DK-OPER-UNT-ID                    CL*11
059700               AND  FCLTY_ID    = :DK-FCLTY-ID                       CL*11
059800               AND  TKT_FMT_ID  = :ASC-TKT-FMT-ID                    CL*10
059900         END-EXEC                                                 CNKCS201
060000                                                                  CNKCS201
060100         EVALUATE TRUE                                            CNKCS201
060200             WHEN SQLCODE = ZERO                                  CNKCS201
060300             WHEN SQLCODE = +100                                  CNKCS201
060400             WHEN SQLCODE = -904                                  CNKCS201
060500             WHEN SQLCODE = -913                                  CNKCS201
060600                 CONTINUE                                         CNKCS201
060700             WHEN SQLWARN0 NOT = SPACES                           CNKCS201
060800             WHEN SQLCODE < ZERO                                  CNKCS201
060900             WHEN SQLCODE > ZERO                                  CNKCS201
061000                 MOVE '3200-VALIDATE-TKT-FMT-ID'                     CL**8
061100                                 TO DP013-PARAGRAPH               CNKCS201
061200                 MOVE 'SELECT TICKET FORMAT'                      CNKCS201
061300                                 TO DP013-MESSAGE-TEXT (1)        CNKCS201
061400                 MOVE SQLCA      TO DP013-SQLCA                   CNKCS201
061500                 MOVE 'TTKTFMT'  TO DP013-DB2-TABLE-NAME (1)         CL*22
061600                 SET DP013-DB2-ABEND                              CNKCS201
061700                                 TO TRUE                          CNKCS201
061800                 SET DP013-XCTL-DISPLAY-RESTART                   CNKCS201
061900                                 TO TRUE                          CNKCS201
062000                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS201
062100         END-EVALUATE                                             CNKCS201
062200     END-PERFORM.                                                 CNKCS201
062300                                                                  CNKCS201
062400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS201
062500         MOVE '3200-VALIDATE-TKT-FMT-ID'                             CL**8
062600                                 TO DP013-PARAGRAPH               CNKCS201
062700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     CNKCS201
062800                                 TO DP013-MESSAGE-TEXT (1)        CNKCS201
062900         MOVE 'TICKET FORMAT '   TO DP013-MESSAGE-TEXT (2)        CNKCS201
063000         MOVE SQLCA              TO DP013-SQLCA                   CNKCS201
063100         MOVE 'TTKTFMT'          TO DP013-DB2-TABLE-NAME (1)         CL*22
063200         SET DP013-DB2-ABEND     TO TRUE                          CNKCS201
063300         SET DP013-XCTL-DISPLAY-RESTART                           CNKCS201
063400                                 TO TRUE                          CNKCS201
063500         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS201
063600     END-IF.                                                      CNKCS201
063700                                                                  CNKCS201
063800     IF SQLCODE = +100                                            CNKCS201
063900         SET PS-ERROR                                             CNKCS201
064000             DP020-MSG-FATAL     TO TRUE                          CNKCS201
064100         MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER              CNKCS201
064200         MOVE DP015-UNP-ALP-BRT-OFF                               CNKCS201
064300                                 TO AFMTA                         CNKCS201
064400         MOVE DP015-RED          TO AFMTC                         CNKCS201
064500         MOVE DP015-REVERSE      TO AFMTH                         CNKCS201
064600         MOVE -1                 TO AFMTL                         CNKCS201
064700         SET DP030-SET-CURSOR-APPL-1                              CNKCS201
064800                                 TO TRUE                          CNKCS201
064900     END-IF.                                                      CNKCS201
065000                                                                  CNKCS201
065100                                                                  CNKCS201
065200*----------------------------------------------------------------*CNKCS201
065300*  CHECK THE LOCATION TYPE TABLE TO VERIFY THAT THE TYPE         *CNKCS201
065400*  ENTERED ON THE MAP IS VALID.                                  *CNKCS201
065500*----------------------------------------------------------------*CNKCS201
065600                                                                  CNKCS201
065700 3300-VALIDATE-LOC-TYPE.                                          CNKCS201
065800                                                                  CNKCS201
065900     PERFORM                                                      CNKCS201
066000         WITH TEST AFTER                                          CNKCS201
066100         VARYING PV-RETRY-COUNTER                                 CNKCS201
066200         FROM 1 BY 1                                              CNKCS201
066300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS201
066400                   OR (SQLCODE = ZERO)                            CNKCS201
066500                   OR (SQLCODE = +100))                           CNKCS201
066600                                                                  CNKCS201
066700         EXEC SQL                                                 CNKCS201
066800            SELECT  FCLTY_LOC_TYPE_CDE                               CL**8
066900              INTO :FLTYPE-FCLTY-LOC-TYPE-CDE                        CL**8
067000              FROM  TFLTYPE                                       CNKCS201
067100             WHERE  FCLTY_LOC_TYPE_CDE = :ASC-LOC-TYPE               CL**8
067200         END-EXEC                                                 CNKCS201
067300                                                                  CNKCS201
067400         EVALUATE TRUE                                            CNKCS201
067500             WHEN SQLCODE = ZERO                                  CNKCS201
067600             WHEN SQLCODE = +100                                  CNKCS201
067700             WHEN SQLCODE = -904                                  CNKCS201
067800             WHEN SQLCODE = -913                                  CNKCS201
067900                 CONTINUE                                         CNKCS201
068000             WHEN SQLWARN0 NOT = SPACES                           CNKCS201
068100             WHEN SQLCODE < ZERO                                  CNKCS201
068200             WHEN SQLCODE > ZERO                                  CNKCS201
068300                 MOVE '3300-VALIDATE-LOC-TYPE'                    CNKCS201
068400                                 TO DP013-PARAGRAPH               CNKCS201
068500                 MOVE 'SELECT LOCATION TYPE'                      CNKCS201
068600                                 TO DP013-MESSAGE-TEXT (1)        CNKCS201
068700                 MOVE SQLCA      TO DP013-SQLCA                   CNKCS201
068800                 MOVE 'TFLTYPE'  TO DP013-DB2-TABLE-NAME (1)      CNKCS201
068900                 SET DP013-DB2-ABEND                              CNKCS201
069000                                 TO TRUE                          CNKCS201
069100                 SET DP013-XCTL-DISPLAY-RESTART                   CNKCS201
069200                                 TO TRUE                          CNKCS201
069300                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS201
069400         END-EVALUATE                                             CNKCS201
069500     END-PERFORM.                                                 CNKCS201
069600                                                                  CNKCS201
069700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS201
069800         MOVE '3300-VALIDATE-LOC-TYPE'                            CNKCS201
069900                                 TO DP013-PARAGRAPH               CNKCS201
070000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     CNKCS201
070100                                 TO DP013-MESSAGE-TEXT (1)        CNKCS201
070200         MOVE 'LOCATION TYPE '   TO DP013-MESSAGE-TEXT (2)        CNKCS201
070300         MOVE SQLCA              TO DP013-SQLCA                   CNKCS201
070400         MOVE 'TFLTYPE'          TO DP013-DB2-TABLE-NAME (1)      CNKCS201
070500         SET DP013-DB2-ABEND     TO TRUE                          CNKCS201
070600         SET DP013-XCTL-DISPLAY-RESTART                           CNKCS201
070700                                 TO TRUE                          CNKCS201
070800         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS201
070900     END-IF.                                                      CNKCS201
071000                                                                  CNKCS201
071100     IF SQLCODE = +100                                            CNKCS201
071200         SET PS-ERROR                                             CNKCS201
071300             DP020-MSG-FATAL     TO TRUE                          CNKCS201
071400         MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER              CNKCS201
071500         MOVE DP015-UNP-ALP-BRT-OFF                               CNKCS201
071600                                 TO ATYPEA                        CNKCS201
071700         MOVE DP015-RED          TO ATYPEC                        CNKCS201
071800         MOVE DP015-REVERSE      TO ATYPEH                        CNKCS201
071900         MOVE -1                 TO ATYPEL                        CNKCS201
072000         SET DP030-SET-CURSOR-APPL-1                              CNKCS201
072100                                 TO TRUE                          CNKCS201
072200     END-IF.                                                      CNKCS201
072300                                                                  CNKCS201
072400                                                                  CNKCS201
072500*----------------------------------------------------------------*CNKCS201
072600*  CHECK THE LOCATION TABLE TO VERIFY THAT THE LOCATION          *CNKCS201
072700*  ENTERED ON THE MAP IS VALID.                                  *CNKCS201
072800*----------------------------------------------------------------*CNKCS201
072900                                                                  CNKCS201
073000 3400-VALIDATE-AREA-ID.                                              CL**8
073100                                                                  CNKCS201
073200     PERFORM                                                      CNKCS201
073300         WITH TEST AFTER                                          CNKCS201
073400         VARYING PV-RETRY-COUNTER                                 CNKCS201
073500         FROM 1 BY 1                                              CNKCS201
073600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS201
073700                   OR (SQLCODE = ZERO)                            CNKCS201
073800                   OR (SQLCODE = +100))                           CNKCS201
073900                                                                  CNKCS201
074000         EXEC SQL                                                 CNKCS201
074100            SELECT  FCLTY_AREA_ID                                    CL**5
074200              INTO :FLAREA-FCLTY-AREA-ID                             CL**9
074300              FROM  TFLAREA                                          CL**2
074400             WHERE  OPER_UNT_ID   = :DK-OPER-UNT-ID                  CL*11
074500               AND  FCLTY_ID      = :DK-FCLTY-ID                     CL*11
074600               AND  FCLTY_AREA_ID = :ASC-AREA-ID                     CL**8
074700         END-EXEC                                                 CNKCS201
074800                                                                  CNKCS201
074900         EVALUATE TRUE                                            CNKCS201
075000             WHEN SQLCODE = ZERO                                  CNKCS201
075100             WHEN SQLCODE = +100                                  CNKCS201
075200             WHEN SQLCODE = -904                                  CNKCS201
075300             WHEN SQLCODE = -913                                  CNKCS201
075400                 CONTINUE                                         CNKCS201
075500             WHEN SQLWARN0 NOT = SPACES                           CNKCS201
075600             WHEN SQLCODE < ZERO                                  CNKCS201
075700             WHEN SQLCODE > ZERO                                  CNKCS201
075800                 MOVE '3400-VALIDATE-AREA-ID'                        CL**8
075900                                 TO DP013-PARAGRAPH               CNKCS201
076000                 MOVE 'SELECT LOCATION'                           CNKCS201
076100                                 TO DP013-MESSAGE-TEXT (1)        CNKCS201
076200                 MOVE SQLCA      TO DP013-SQLCA                   CNKCS201
076300                 MOVE 'TFLAREA'  TO DP013-DB2-TABLE-NAME (1)         CL**2
076400                 SET DP013-DB2-ABEND                              CNKCS201
076500                                 TO TRUE                          CNKCS201
076600                 SET DP013-XCTL-DISPLAY-RESTART                   CNKCS201
076700                                 TO TRUE                          CNKCS201
076800                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS201
076900         END-EVALUATE                                             CNKCS201
077000     END-PERFORM.                                                 CNKCS201
077100                                                                  CNKCS201
077200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS201
077300         MOVE '3400-VALIDATE-AREA-ID'                                CL**8
077400                                 TO DP013-PARAGRAPH               CNKCS201
077500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     CNKCS201
077600                                 TO DP013-MESSAGE-TEXT (1)        CNKCS201
077700         MOVE 'LOCATION      '   TO DP013-MESSAGE-TEXT (2)        CNKCS201
077800         MOVE SQLCA              TO DP013-SQLCA                   CNKCS201
077900         MOVE 'TFLAREA'          TO DP013-DB2-TABLE-NAME (1)         CL**2
078000         SET DP013-DB2-ABEND     TO TRUE                          CNKCS201
078100         SET DP013-XCTL-DISPLAY-RESTART                           CNKCS201
078200                                 TO TRUE                          CNKCS201
078300         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS201
078400     END-IF.                                                      CNKCS201
078500                                                                  CNKCS201
078600     IF SQLCODE = +100                                            CNKCS201
078700         SET PS-ERROR                                             CNKCS201
078800             DP020-MSG-FATAL     TO TRUE                          CNKCS201
078900         MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER              CNKCS201
079000         MOVE DP015-UNP-ALP-BRT-OFF                               CNKCS201
079100                                 TO ALOCA                         CNKCS201
079200         MOVE DP015-RED          TO ALOCC                         CNKCS201
079300         MOVE DP015-REVERSE      TO ALOCH                         CNKCS201
079400         MOVE -1                 TO ALOCL                         CNKCS201
079500         SET DP030-SET-CURSOR-APPL-1                              CNKCS201
079600                                 TO TRUE                          CNKCS201
079700     END-IF.                                                      CNKCS201
079800                                                                  CNKCS201
079900                                                                  CNKCS201
080000*----------------------------------------------------------------*CNKCS201
080100*  CHECK THE DEPARTMENT/CLASS TICKET FORMAT TABLE TO VERIFY      *CNKCS201
080200*  THAT THE DEPARTMENT ENTERED ON THE MAP IS VALID.              *CNKCS201
080300*  A -811 MEANS THAT MULTIPLE RECORDS EXIST FOR THAT DEPARTMENT. *CNKCS201
080400*----------------------------------------------------------------*CNKCS201
080500                                                                  CNKCS201
080600 3500-VALIDATE-DEPT-NBR.                                             CL**8
080700                                                                  CNKCS201
080800     PERFORM                                                      CNKCS201
080900         WITH TEST AFTER                                          CNKCS201
081000         VARYING PV-RETRY-COUNTER                                 CNKCS201
081100         FROM 1 BY 1                                              CNKCS201
081200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS201
081300                   OR (SQLCODE = ZERO)                            CNKCS201
081400                   OR (SQLCODE = +100)                            CNKCS201
081500                   OR (SQLCODE = -811))                           CNKCS201
081600                                                                  CNKCS201
081700         EXEC SQL                                                 CNKCS201
081800            SELECT  DEPT_NBR                                      CNKCS201
081900              INTO :DCTFAS-DEPT-NBR                                  CL*23
082000              FROM  TDCTFAS                                          CL*22
082100             WHERE  OPER_UNT_ID = :DK-OPER-UNT-ID                    CL*11
082200               AND  FCLTY_ID    = :DK-FCLTY-ID                       CL*11
082300               AND  DEPT_NBR    = :ASC-DEPT-NBR                      CL*10
082400         END-EXEC                                                 CNKCS201
082500                                                                  CNKCS201
082600         EVALUATE TRUE                                            CNKCS201
082700             WHEN SQLCODE = ZERO                                  CNKCS201
082800             WHEN SQLCODE = +100                                  CNKCS201
082900             WHEN SQLCODE = -811                                  CNKCS201
083000             WHEN SQLCODE = -904                                  CNKCS201
083100             WHEN SQLCODE = -913                                  CNKCS201
083200                 CONTINUE                                         CNKCS201
083300             WHEN SQLWARN0 NOT = SPACES                           CNKCS201
083400             WHEN SQLCODE < ZERO                                  CNKCS201
083500             WHEN SQLCODE > ZERO                                  CNKCS201
083600                 MOVE '3500-VALIDATE-DEPT-NBR'                       CL**8
083700                                 TO DP013-PARAGRAPH               CNKCS201
083800                 MOVE 'SELECT DEPARTMENT'                         CNKCS201
083900                                 TO DP013-MESSAGE-TEXT (1)        CNKCS201
084000                 MOVE SQLCA      TO DP013-SQLCA                   CNKCS201
084100                 MOVE 'TDCTFAS'  TO DP013-DB2-TABLE-NAME (1)         CL*22
084200                 SET DP013-DB2-ABEND                              CNKCS201
084300                                 TO TRUE                          CNKCS201
084400                 SET DP013-XCTL-DISPLAY-RESTART                   CNKCS201
084500                                 TO TRUE                          CNKCS201
084600                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS201
084700         END-EVALUATE                                             CNKCS201
084800     END-PERFORM.                                                 CNKCS201
084900                                                                  CNKCS201
085000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS201
085100         MOVE '3500-VALIDATE-DEPT-NBR'                               CL**8
085200                                 TO DP013-PARAGRAPH               CNKCS201
085300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     CNKCS201
085400                                 TO DP013-MESSAGE-TEXT (1)        CNKCS201
085500         MOVE 'DEPARTMENT    '   TO DP013-MESSAGE-TEXT (2)        CNKCS201
085600         MOVE SQLCA              TO DP013-SQLCA                   CNKCS201
085700         MOVE 'TDCTFAS'          TO DP013-DB2-TABLE-NAME (1)         CL*22
085800         SET DP013-DB2-ABEND     TO TRUE                          CNKCS201
085900         SET DP013-XCTL-DISPLAY-RESTART                           CNKCS201
086000                                 TO TRUE                          CNKCS201
086100         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS201
086200     END-IF.                                                      CNKCS201
086300                                                                  CNKCS201
086400     IF SQLCODE = +100                                            CNKCS201
086500         SET PS-ERROR                                             CNKCS201
086600             DP020-MSG-FATAL     TO TRUE                          CNKCS201
086700         MOVE PC-TSYMSG-00032    TO DP020-MSG-NUMBER              CNKCS201
086800         MOVE DP015-UNP-ALP-BRT-OFF                                  CL**2
086900                                 TO ADEPTA                        CNKCS201
087000         MOVE DP015-RED          TO ADEPTC                        CNKCS201
087100         MOVE DP015-REVERSE      TO ADEPTH                        CNKCS201
087200         MOVE -1                 TO ADEPTL                        CNKCS201
087300         SET DP030-SET-CURSOR-APPL-1                              CNKCS201
087400                                 TO TRUE                          CNKCS201
087500     END-IF.                                                      CNKCS201
087600                                                                  CNKCS201
087700                                                                  CNKCS201
087800*----------------------------------------------------------------*CNKCS201
087900*  CHECK THE STORE TABLE TO VERIFY THAT THE FACILITY             *CNKCS201
088000*  ENTERED ON THE MAP IS VALID.                                  *CNKCS201
088100*----------------------------------------------------------------*CNKCS201
088200                                                                          
088300*****?? 3600-VALIDATE-FCLTY-ID.                                         *8
088400 3700-VALIDATE-OPER-UNT-ID.                                               
088500                                                                          
088600     INITIALIZE XL071-COMMAREA.                                           
088700     MOVE DK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.                      11
088800                                                                          
088900     CALL XL071-LOCATION-MODULE USING                                     
089000                                DFHEIBLK                                  
089100                                XL071-COMMAREA                            
089200                                XL071-COMMAREA-REC.                       
089300                                                                          
089400     EVALUATE TRUE                                                        
089500         WHEN XL071-NO-ERRORS                                             
089600         WHEN XL071-DC-ASGMT-NOT-FND                                      
089700              MOVE XL071-LOC-NM     TO ASC-FCLTY-NME                      
089800                                       AFDESCO                            
089900                                                                          
090000         WHEN XL071-LOC-NOT-FOUND                                         
090100              SET PS-ERROR                                             CNK
090200                  DP020-MSG-FATAL     TO TRUE                          CNK
090300              MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER              CNK
090400              MOVE DP015-UNP-ALP-BRT-OFF                                  
090500                                      TO AFCLTYA                       CNK
090600              MOVE DP015-RED          TO AFCLTYC                       CNK
090700              MOVE DP015-REVERSE      TO AFCLTYH                       CNK
090800              MOVE -1                 TO AFCLTYL                       CNK
090900              SET DP030-SET-CURSOR-APPL-1                              CNK
091000                                      TO TRUE                          CNK
091100                                                                          
091200         WHEN XL071-SQLCODE = '      -805'                                
091300              CONTINUE                                                    
091400                                                                          
091500         WHEN OTHER                                                       
091600              MOVE '3600-VALIDATE-FCLTY-ID'                               
091700                              TO DP013-PARAGRAPH                          
091800              STRING 'SELECT STORE NUMBER - '                             
091900                      XL071-LOCATION-NUMBER                               
092000                     ' - BAD RETURN CODE FROM XLKUT071 - '                
092100                      XL071-RETURN-CODE                                   
092200                      DELIMITED BY SIZE                                   
092300                      INTO DP013-MESSAGE-TEXT (1)                         
092400              STRING 'BAD SQLCODE - '                                     
092500                      XL071-SQLCODE                                       
092600                     ' - '                                                
092700                      XL071-DB2-TABLE                                     
092800                      DELIMITED BY SIZE                                   
092900                      INTO DP013-MESSAGE-TEXT (2)                         
093000              MOVE XL071-SQLCA     TO DP013-SQLCA                         
093100              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)            
093200              SET DP013-DB2-ABEND                                         
093300                              TO TRUE                                     
093400              SET DP013-XCTL-DISPLAY-RESTART                              
093500                              TO TRUE                                     
093600              PERFORM DP013-0000-PROCESS-ABEND                            
093700                                                                          
093800     END-EVALUATE.                                                        
093900                                                                     CL**2
094000                                                                     CL**2
094100*----------------------------------------------------------------*CNKCS201
094200*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *CNKCS201
094300*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *CNKCS201
094400*  IT HERE.                                                      *CNKCS201
094500*----------------------------------------------------------------*CNKCS201
094600                                                                  CNKCS201
094700 4000-BUILD-INITIAL-PANEL.                                        CNKCS201
094800                                                                  CNKCS201
094900     SET DP030-SET-CURSOR-APPL-1 TO TRUE                          CNKCS201
095000     MOVE -1                     TO AOPERL.                          CL*14
095100                                                                  CNKCS201
095200*----------------------------------------------------------------*CNKCS201
095300*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *CNKCS201
095400*----------------------------------------------------------------*CNKCS201
095500                                                                  CNKCS201
095600 4400-MOVE-COMMAREA-TO-SCREEN.                                    CNKCS201
095700                                                                  CNKCS201
095800     MOVE ASC-OPER-UNT-ID        TO AOPERO.                          CL*13
095900     MOVE ASC-FCLTY-ID           TO AFCLTYO.                         CL**8
096000     MOVE ASC-FCLTY-NME          TO AFDESCO.                         CL*19
096100     MOVE ASC-DEPT-NBR           TO ADEPTO.                          CL**8
096200     MOVE ASC-AREA-ID            TO ALOCO.                           CL**8
096300     MOVE ASC-LOC-TYPE           TO ATYPEO.                       CNKCS201
096400     MOVE ASC-TKT-FMT-ID         TO AFMTO.                           CL**8
096500     MOVE ASC-SEL-UNASSIGNED     TO ASALLO.                       CNKCS201
096600 EJECT                                                            CNKCS201
096700*----------------------------------------------------------------*CNKCS201
096800*    ABEND PROCESSOR MODULE                                      *CNKCS201
096900*----------------------------------------------------------------*CNKCS201
097000                                                                  CNKCS201
097100     COPY DPPD013.                                                CNKCS201
