000100*----------------------------------------------------------       00010012
000200 IDENTIFICATION DIVISION.                                         00020012
000300*----------------------------------------------------------       00030012
000400 PROGRAM-ID.    XSKRP025.                                         00040012
000500 AUTHOR.        JOSEPH MENYAH.                                    00050012
000600 DATE-WRITTEN.  OCTOBER , 2002.                                   00060012
000700                                                                  00070012
000800*----------------------------------------------------------       00080012
000900*            PRICE VERSION EVENT INTEGRITY CHECK                  00090012
001000*----------------------------------------------------------       00100012
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00110012
001020* INTEGRITY CHECK FOR THE PROMOTION BSINESS EVENT.                00120012
001124*                                                                 00130012
001125*----------------------------------------------------------       00140012
001126* HISTORY LOG:                                                    00150012
001127*                                                                 00160012
001128*----------------------------------------------------------       00170012
C98396* DATE: 11/04/2014                                                00180013
C98396* WR/IR#:CHG0098396                                               00190013
C98396* CODING TAG: C98396                                              00191013
C98396* PROGRAMMER: COGNIZANT                                           00200013
C98396* DESCRIPTION: MODIFIED THE LOGIC TO REPORT THE CORRECT MISSING   00210013
C98396* RECORD EITHER IN XS OR PM.                                      00220013
C98396*----------------------------------------------------------       00230013
001170 ENVIRONMENT DIVISION.                                            00240012
001180*----------------------------------------------------------       00250012
001190 CONFIGURATION SECTION.                                           00260012
001200 SOURCE-COMPUTER. IBM-3090.                                       00270012
001300 OBJECT-COMPUTER. IBM-3090.                                       00280012
001400                                                                  00290012
001500 INPUT-OUTPUT SECTION.                                            00300012
001600                                                                  00310012
001700 FILE-CONTROL.                                                    00320012
004900     SELECT CONTROL-CARD                                          00330012
005000         ASSIGN TO INP00.                                         00340012
                                                                        00350012
004900     SELECT PROMO-EXTRACT-FILE                                    00360012
005000         ASSIGN TO INP01.                                         00370012
                                                                        00380012
004900     SELECT DOMAIN-EXTRACT-FILE                                   00390012
005000         ASSIGN TO INP02.                                         00400012
                                                                        00410012
                                                                        00420012
004900     SELECT ERROR-FILE                                            00430012
005000         ASSIGN TO OUT01.                                         00440012
                                                                        00450012
004900     SELECT REPORT-FILE                                           00460012
005000         ASSIGN TO RPT01.                                         00470012
                                                                        00480012
001900*----------------------------------------------------------       00490012
002000 DATA DIVISION.                                                   00500012
002100*----------------------------------------------------------       00510012
002200 FILE SECTION.                                                    00520012
002300                                                                  00530012
008000 FD  PROMO-EXTRACT-FILE                                           00540012
008100     RECORDING MODE IS F                                          00550012
008200     LABEL RECORDS ARE OMITTED                                    00560012
008300     RECORD CONTAINS 080 CHARACTERS                               00570012
008400     DATA RECORD IS PROMO-EVNT-RECORD.                            00580012
008500 01  PROMO-EVNT-REC              PIC X(080).                      00590012
008600                                                                  00600012
008000 FD  DOMAIN-EXTRACT-FILE                                          00610012
008100     RECORDING MODE IS F                                          00620012
008200     LABEL RECORDS ARE OMITTED                                    00630012
008300     RECORD CONTAINS 080 CHARACTERS                               00640012
008400     DATA RECORD IS DOMAIN-EVNT-RECORD.                           00650012
008500 01  DOMAIN-EVNT-REC              PIC X(080).                     00660012
006500                                                                  00670012
       FD  CONTROL-CARD                                                 00680012
           RECORDING MODE F                                             00690012
           BLOCK CONTAINS 0 RECORDS                                     00700012
           LABEL RECORDS ARE OMITTED                                    00710012
           DATA RECORD IS CONTROL-CARD-RECORD.                          00720012
       01  CONTROL-CARD-RECORD             PIC X(080).                  00730012
                                                                        00740012
       FD  REPORT-FILE                                                  00750012
           RECORDING MODE F                                             00760012
           BLOCK CONTAINS 0 RECORDS                                     00770012
           LABEL RECORDS ARE OMITTED                                    00780012
009600     RECORD CONTAINS 132 CHARACTERS                               00790012
           DATA RECORD IS REPORT-RECORD.                                00800012
       01  REPORT-RECORD                   PIC X(132).                  00810012
                                                                        00820012
       FD  ERROR-FILE                                                   00830012
           RECORDING MODE F                                             00840012
           BLOCK CONTAINS 0 RECORDS                                     00850012
           LABEL RECORDS ARE OMITTED                                    00860012
           DATA RECORD IS DIFFERENCES-RECORD.                           00870012
       01  DIFFERENCES-RECORD              PIC X(080).                  00880012
                                                                        00890012
002500*---------------------------------------------------------        00900012
002600                                                                  00910012
002700 WORKING-STORAGE SECTION.                                         00920012
002800*---------------------------------------------------------        00930012
003500* PC- PROGRAM CONSTANTS                                           00940012
003600*----------------------------------------------------------       00950012
003700 01  PC-PROGRAM-CONSTANTS.                                        00960012
003800     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKRP025'. 00970012
003900     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00980012
004000                                                                  00990012
097700 01  CD-CPU-DATE.                                                 01000012
097800     03  CD-CPU-YEAR             PIC 99.                          01010012
097900     03  CD-CPU-MONTH            PIC 99.                          01020012
098000     03  CD-CPU-DAY              PIC 99.                          01030012
098100                                                                  01040012
098200 01  CD-CPU-DATE-CC.                                              01050012
098300     03  CD-CPU-CENT             PIC 99.                          01060012
098400     03  CD-CPU-YYMMDD           PIC 9(6).                        01070012
                                                                        01080012
084800 01  PC-REPORT-NO                PIC  9(5)          VALUE 00001.  01090012
                                                                        01100012
011200 01  CT-CPU-TIME.                                                 01110012
011300     03  CT-HOUR                 PIC 99.                          01120012
011400     03  CT-MINUTE               PIC 99.                          01130012
011500     03  FILLER                  PIC 9(4).                        01140012
      *----------------------------------------------------------       01150012
      **PROGRAM                                                         01160012
      *----------------------------------------------------------       01170012
       01  PC-PROGRAM-COUNTER.                                          01180012
           05  PC-RECORD-COUNT                 PIC S9(09) VALUE ZEROS   01190012
                                                          COMP-3.       01200012
           05  PC-PROMO-EXTRACT-RECS-READ      PIC 9(09) VALUE ZEROS.   01210012
           05  PC-DOMAIN-EXTRACT-RECS-READ     PIC 9(09) VALUE ZEROS.   01220012
           05  PC-ERROR-RECORD-WRITTEN         PIC 9(09) VALUE ZEROS.   01230012
           05  PC-ERROR-REPORT-WRITTEN         PIC 9(09) VALUE ZEROS.   01240012
           05  PC-PAGE-CNT                     PIC 9(09) VALUE ZEROS.   01250012
004100*----------------------------------------------------------       01260012
004200* PS- PROGRAM SWITCHES                                            01270012
004300*----------------------------------------------------------       01280012
004400 01  PS-PROGRAM-SWITCHES.                                         01290012
004500     05  PS-EOF-PROMO-EXTRACT-SW          PIC X(01)  VALUE SPACE. 01300012
004600         88  PS-EOF-PROMO                        VALUE 'Y'.       01310012
004600         88  PS-NOT-EOF-PROMO                    VALUE 'N'.       01320012
004800                                                                  01330012
004500     05  PS-EOF-DOMAIN-EXTRACT-SW         PIC X(01)  VALUE SPACE. 01340012
004600         88  PS-EOF-DOMAIN                       VALUE 'Y'.       01350012
004600         88  PS-NOT-EOF-DOMAIN                   VALUE 'N'.       01360012
004800                                                                  01370012
004500     05  PS-NEW-RECORD-SW                 PIC X(01)  VALUE SPACE. 01380012
004600         88  PS-NEW-RECORD                       VALUE 'Y'.       01390012
004600         88  PS-NOT-NEW-RECORD                   VALUE 'N'.       01400012
004800                                                                  01410012
004900*----------------------------------------------------------       01420012
      *    CONTROL-CARD-LAYOUT.                                         01430012
004900*----------------------------------------------------------       01440012
       01  CONTROL-CARD-LAYOUT.                                         01450012
           05  CC-START-POINT                  PIC 9(05) VALUE ZEROS.   01460012
           05  FILLER                          PIC X(01) VALUE SPACES.  01470012
           05  CC-READ-FREQUENCY               PIC 9(05) VALUE ZEROS.   01480012
           05  FILLER                          PIC X(69) VALUE SPACES.  01490012
004900*----------------------------------------------------------       01500012
005000* PV- PROGRAM VARIABLES                                           01510012
005100*----------------------------------------------------------       01520012
005200 01 PV-PROGRAM-VARIABLES.                                         01530012
013800    05  ABEND-CODE              PIC S9(4)  VALUE ZEROS COMP SYNC. 01540012
005500    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   01550012
005600    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         01560012
005710    05  PV-PROMO-PRIC-VER-ID-HLD      PIC 9(10) VALUE 0.          01570012
005800    05  PV-ACTION-CODE                PIC X(01).                  01580012
005810        88  PV-INSERT-DATA                       VALUE 'I'.       01590012
005820        88  PV-UPDATE-DATA                       VALUE 'U'.       01600012
                                                                        01610012
006000    05  PV-RECORD-COUNT               PIC 9(05) VALUE ZEROS.      01620012
006000    05  PV-LD-STATUS-CDE              PIC X(02).                  01630012
006100        88  PV-NO-ERROR                          VALUE '00'.      01640012
006200        88  PV-CRITICAL-ERROR                    VALUE '01'.      01650012
006300        88  PV-NOT-CRITICAL-ERROR                VALUE '02'.      01660012
007000                                                                  01670012
           05  PS-ERROR-FOUND-SW               PIC X(01) VALUE 'N'.     01680012
               88  PS-ERROR-FOUND                        VALUE 'Y'.     01690012
               88  PS-ERROR-NOT-FOUND                    VALUE 'N'.     01700012
                                                                        01710012
007100    05  PV-STRT-PARM.                                             01720012
007200        10  PV-STRT-DTE-CC            PIC X(02).                  01730012
007200        10  PV-STRT-DTE-YY            PIC X(02).                  01740012
007400        10  PV-STRT-DTE-MM            PIC X(02).                  01750012
007600        10  PV-STRT-DTE-DD            PIC X(02).                  01760012
007400        10  FILLER                    PIC X.                      01770012
007400        10  PV-DECREMENT              PIC X(02).                  01780012
007400        10  FILLER                    PIC X(69).                  01790012
007700                                                                  01800012
008600    05  PV-PROMO-KEY.                                             01810012
008700        10  PV-PM-PRIC-VER-ID             PIC 9(10).              01820012
                                                                        01830012
008600    05  PV-DOMAIN-KEY.                                            01840012
008700        10  PV-XS-PRIC-VER-ID             PIC 9(10).              01850012
                                                                        01860012
007100    05  PV-PROMO-STRT-DTE           PIC X(10).                    01870012
007100    05  PV-PROMO-END-DTE            PIC X(10).                    01880012
                                                                        01890012
008600    05  PV-AD-EVNT-END-DTE-TM.                                    01900012
008700        10  PV-AD-EVNT-END-DTE.                                   01910012
008800            15  PV-AD-EVNT-DTE-TM2-CCYY   PIC X(04).              01920012
008900            15  FILLER                    PIC X(01).              01930012
009000            15  PV-AD-EVNT-DTE-TM2-MM     PIC X(02).              01940012
009100            15  FILLER                    PIC X(01).              01950012
009200            15  PV-AD-EVNT-DTE-TM2-DD     PIC X(02).              01960012
009300        10  PV-AD-EVNT-END-TM             PIC X(16).              01970012
009400                                                                  01980012
008600    05  PV-PROMO-SOURCE              PIC X(40) VALUE              01990012
              'DATA SOURCE IS THE PROMO DATABASE'.                      02000012
                                                                        02010012
008600    05  PV-PROMO-NF                  PIC X(40) VALUE              02020012
              'RECORD NOT FOUND IN XS DOMAIN'.                          02030012
                                                                        02040012
008600    05  PV-DOMAIN-SOURCE             PIC X(40) VALUE              02050012
              'DATA SOURCE IS THE XS DOMAIN DATABASE'.                  02060012
                                                                        02070012
008600    05  PV-DOMAIN-NF                  PIC X(40) VALUE             02080012
              'RECORD NOT FOUND IN PROMO TABLES'.                       02090012
                                                                        02100012
       01  PV-PM-TOTAL-RECORD.                                          02110012
           05 PV-PM-BUSINESS-EVNT-ID           PIC 9(03) VALUE ZERO.    02120012
           05 PV-PM-ACTION-CDE                 PIC X(01) VALUE 'T'.     02130012
           05 PV-PM-TOTAL-NBR-OF-RECS          PIC 9(11) VALUE ZERO.    02140012
                                                                        02150012
       01  PV-XS-TOTAL-RECORD.                                          02160012
           05 PV-XS-BUSINESS-EVNT-ID           PIC 9(03) VALUE ZERO.    02170012
           05 PV-XS-ACTION-CDE                 PIC X(01) VALUE 'T'.     02180012
           05 PV-XS-TOTAL-NBR-OF-RECS          PIC 9(11) VALUE ZERO.    02190012
                                                                        02200012
000700 01  ERROR-RECORD                    PIC X(80) VALUE SPACES.      02210012
                                                                        02220012
042700     COPY DPWS132O.                                               02230012
042900                                                                  02240012
                                                                        02250012
043100 01  DR-HEAD2.                                                    02260012
043200     05  FILLER                 PIC X(41)    VALUE SPACES.        02270012
043300     05  DR-TITLE               PIC X(55)    VALUE                02280012
043400      'INTEGRITY CHECK PROGRAM  - PRICE VERSION EVENT'.           02290012
                                                                        02300012
043500                                                                  02310012
043100 01  DR-HEAD3.                                                    02320012
043200     05  FILLER                 PIC X(03)    VALUE                02330012
            'KEY'.                                                      02340012
043200     05  FILLER                 PIC X(15)    VALUE SPACES.        02350012
043200     05  FILLER                 PIC X(10)    VALUE                02360012
            'FIELD NAME'.                                               02370012
043200     05  FILLER                 PIC X(14)    VALUE SPACES.        02380012
043200     05  FILLER                 PIC X(05)    VALUE                02390012
            'VALUE'.                                                    02400012
043200     05  FILLER                 PIC X(31)    VALUE SPACES.        02410012
043200     05  FILLER                 PIC X(16)    VALUE                02420012
            'SOURCE / MESSAGE'.                                         02430012
043200     05  FILLER                 PIC X(35)    VALUE SPACES.        02440012
043500                                                                  02450012
043100 01  DR-HEAD5.                                                    02460012
043200     05  FILLER                 PIC X(132)   VALUE ALL '='.       02470012
000700 01  REPORT-DETAIL.                                               02480012
000800   05 PROMO-RPT-INFO.                                             02490012
000800      10 PROMO-EVNT-KEY.                                          02500012
000800         15 PROMO-EVNT-ID            PIC 9(10) VALUE ZERO.        02510012
 00800      10 FILLER                      PIC X(5).                    02520012
 00800      10 PROMO-RPT-DATA-NAME         PIC X(20).                   02530012
 00800      10 FILLER                      PIC X(2).                    02540012
 00800      10 PROMO-RPT-DATA-VALUE        PIC X(40).                   02550012
000800   05 REPORT-NOTES                   PIC X(40).                   02560012
010900*----------------------------------------------------------       02570012
011000* DOMAIN PRICE VERSION EVENT RECORD LAYOUT                        02580012
011100*----------------------------------------------------------       02590012
011200     COPY XSRD017.                                                02600012
011800                                                                  02610012
004900*----------------------------------------------------------       02620012
005000* PROMO PRICE VERSION  COPY BOOK.                                 02630012
005100*----------------------------------------------------------       02640012
           COPY PMRD703.                                                02650012
011800                                                                  02660012
030310                                                                  02670012
031400*----------------------------------------------------------       02680012
031500 PROCEDURE DIVISION.                                              02690012
032100*----------------------------------------------------------       02700012
032200 0000-MAINLINE.                                                   02710012
128200     ACCEPT CD-CPU-DATE FROM DATE.                                02720012
128300     IF CD-CPU-YEAR > 80                                          02730012
128400         MOVE 19 TO CD-CPU-CENT                                   02740012
128500     ELSE                                                         02750012
128600         MOVE 20 TO CD-CPU-CENT.                                  02760012
128700     MOVE CD-CPU-DATE TO CD-CPU-YYMMDD.                           02770012
128800                                                                  02780012
128900     ACCEPT CT-CPU-TIME FROM TIME.                                02790012
032300                                                                  02800012
032400     PERFORM 1000-INITIALIZATION.                                 02810012
032500                                                                  02820012
032600     PERFORM 2000-PROCESS-EXTRACT-DATA                            02830012
032700             UNTIL PS-EOF-DOMAIN                                  02840012
032700                OR PS-EOF-PROMO.                                  02850012
                                                                        02860012
           PERFORM 3000-PROCESS-EXTRA-RECORDS                           02870012
032700             UNTIL PS-EOF-DOMAIN                                  02880012
032700               AND PS-EOF-PROMO.                                  02890012
035000                                                                  02900012
035100     PERFORM 9999-WRAPUP.                                         02910012
035200                                                                  02920012
035500     GOBACK.                                                      02930012
035700                                                                  02940012
035701*0000-EXIT.                                                       02950012
035702 EJECT.                                                           02960012
035703                                                                  02970012
035800*----------------------------------------------------------       02980012
035900* 1000-INITIALIZATION.                                            02990012
036000*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            03000012
036100*     UPDATE OR INSERT A RECORD.                                  03010012
036200*----------------------------------------------------------       03020012
036300 1000-INITIALIZATION.                                             03030012
                                                                        03040012
132408     MOVE CD-CPU-YEAR  TO DP132O-RUN-YEAR.                        03050012
132409     MOVE CD-CPU-MONTH TO DP132O-RUN-MONTH.                       03060012
132410     MOVE CD-CPU-DAY   TO DP132O-RUN-DAY.                         03070012
132420     MOVE CT-HOUR    TO DP132O-RUN-HOUR.                          03080012
132430     MOVE CT-MINUTE  TO DP132O-RUN-MINUTE.                        03090012
132440     MOVE 'XSKRP025' TO DP132O-PROGRAM-NAME.                      03100012
132450     MOVE 1          TO DP132O-REPORT-NUMBER.                     03110012
           SET PS-NOT-EOF-PROMO TO TRUE.                                03120012
           SET PS-NOT-EOF-DOMAIN TO TRUE.                               03130012
026600     OPEN INPUT  PROMO-EXTRACT-FILE                               03140012
026600                 DOMAIN-EXTRACT-FILE                              03150012
026600                 CONTROL-CARD                                     03160012
026600          OUTPUT ERROR-FILE                                       03170012
026600                 REPORT-FILE.                                     03180012
                                                                        03190012
           PERFORM 9999-PRINT-HEADINGS.                                 03200012
           PERFORM 9999-READ-CONTROL-CARD.                              03210012
           READ DOMAIN-EXTRACT-FILE INTO PV-XS-TOTAL-RECORD             03220012
           READ PROMO-EXTRACT-FILE INTO PV-PM-TOTAL-RECORD              03230012
      *    PERFORM 9999-READ-PROMO-EXTRACT.                             03240012
      *    PERFORM 9999-READ-DOMAIN-EXTRACT.                            03250012
                                                                        03260012
           IF PV-PM-TOTAL-NBR-OF-RECS NOT EQUAL TO                      03270012
              PV-XS-TOTAL-NBR-OF-RECS                                   03280012
             MOVE 1 TO CC-START-POINT                                   03290012
             MOVE 1 TO CC-READ-FREQUENCY                                03300012
           END-IF.                                                      03310012
                                                                        03320012
           PERFORM 9999-READ-PROMO-EXTRACT CC-START-POINT TIMES.        03330012
           PERFORM 9999-READ-DOMAIN-EXTRACT  CC-START-POINT TIMES.      03340012
                                                                        03350012
056500                                                                  03360012
037240*1100-EXIT.                                                       03370012
037250 EJECT.                                                           03380012
037251                                                                  03390012
037260*----------------------------------------------------------       03400012
037300* 2000-PROCESS-EXTRACT-DATA.                                      03410012
037400*     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            03420012
037500*     SHOULD BE INSERTED INTO THE AD EVENT TABLE OR UPDATED.      03430012
037600*     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          03440012
037700*     PROCESS AN ERROR AND EXIT THE PROGRAM.                      03450012
037800*----------------------------------------------------------       03460012
037900 2000-PROCESS-EXTRACT-DATA.                                       03470012
           IF PM703-PROMO-PRIC-VER-ID = XS017-PROMO-PRIC-VER-ID         03480012
                PERFORM 2100-COMPARE-FIELDS                             03490012
                PERFORM 9999-READ-DOMAIN-EXTRACT                        03500012
                        CC-READ-FREQUENCY TIMES                         03510012
                PERFORM 9999-READ-PROMO-EXTRACT                         03520012
                        CC-READ-FREQUENCY TIMES                         03530012
                                                                        03540012
           ELSE                                                         03550012
             IF PM703-PROMO-PRIC-VER-ID  > XS017-PROMO-PRIC-VER-ID      03560012
C98396          MOVE PV-DOMAIN-NF TO REPORT-NOTES                       03570013
C98396          MOVE PV-DOMAIN-KEY TO PROMO-EVNT-KEY                    03580013
                PERFORM 9999-WRITE-ERROR-REPORT                         03590012
                MOVE XS017-PRICE-VERSION-RECORD TO ERROR-RECORD         03610012
                PERFORM 9999-WRITE-ERROR-RECORD                         03620012
                PERFORM 9999-READ-DOMAIN-EXTRACT                        03630012
C98396       ELSE                                                       03640013
C98396          MOVE PV-PROMO-NF TO REPORT-NOTES                        03650013
C98396          MOVE PV-PROMO-KEY TO PROMO-EVNT-KEY                     03660013
                PERFORM 9999-WRITE-ERROR-REPORT                         03670012
C98396          MOVE PM703-PRICE-VERSION-RECORD TO ERROR-RECORD         03680013
                PERFORM 9999-WRITE-ERROR-RECORD                         03690012
                PERFORM 9999-READ-PROMO-EXTRACT                         03700012
C98396       END-IF                                                     03710013
           END-IF.                                                      03720012
038000                                                                  03730012
038110*2000-EXIT.                                                       03740012
038200 EJECT.                                                           03750012
                                                                        03760012
038300*------------------------------------------------------           03770012
038400* 2100-COMPARE-FIELDS.                                            03780012
038500*     COMPARES THE EXTRACT FILES AND NOTES ANY DIFFERENCES        03790012
038600*------------------------------------------------------           03800012
038210                                                                  03810012
054400 2100-COMPARE-FIELDS.                                             03820012
036600     IF PM703-BUSINESS-EVNT-ID NOT EQUAL XS017-BUSINESS-EVNT-ID   03830012
              MOVE 'PM703-BUSINESS-EVNT-ID' TO PROMO-RPT-DATA-NAME      03840012
              MOVE PM703-BUSINESS-EVNT-ID   TO PROMO-RPT-DATA-VALUE     03850012
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             03860012
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           03870012
              PERFORM 9999-WRITE-ERROR-REPORT                           03880012
              MOVE 'XS017-BUSINESS-EVNT-ID' TO PROMO-RPT-DATA-NAME      03890012
              MOVE XS017-BUSINESS-EVNT-ID   TO PROMO-RPT-DATA-VALUE     03900012
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             03910012
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           03920012
              PERFORM 9999-WRITE-ERROR-REPORT                           03930012
              SET PS-ERROR-FOUND     TO TRUE                            03940012
           END-IF.                                                      03950012
                                                                        03960012
036600     IF PM703-PROMO-ID         NOT EQUAL XS017-PROMO-ID           03970012
              MOVE 'PM703-PROMO-ID'         TO PROMO-RPT-DATA-NAME      03980012
              MOVE PM703-PROMO-ID           TO PROMO-RPT-DATA-VALUE     03990012
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             04000012
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           04010012
              PERFORM 9999-WRITE-ERROR-REPORT                           04020012
              MOVE 'XS017-PROMO-ID'         TO PROMO-RPT-DATA-NAME      04030012
              MOVE XS017-PROMO-ID           TO PROMO-RPT-DATA-VALUE     04040012
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             04050012
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           04060012
              PERFORM 9999-WRITE-ERROR-REPORT                           04070012
              SET PS-ERROR-FOUND     TO TRUE                            04080012
           END-IF.                                                      04090012
                                                                        04100012
036600     IF PM703-STAT-CDE    NOT EQUAL XS017-STAT-CDE                04110012
              MOVE 'PM703-STAT-CDE'         TO PROMO-RPT-DATA-NAME      04120012
              MOVE PM703-STAT-CDE           TO PROMO-RPT-DATA-VALUE     04130012
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             04140012
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           04150012
              PERFORM 9999-WRITE-ERROR-REPORT                           04160012
              MOVE 'XS017-STAT-CDE'         TO PROMO-RPT-DATA-NAME      04170012
              MOVE XS017-STAT-CDE           TO PROMO-RPT-DATA-VALUE     04180012
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             04190012
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           04200012
              PERFORM 9999-WRITE-ERROR-REPORT                           04210012
              SET PS-ERROR-FOUND     TO TRUE                            04220012
           END-IF.                                                      04230012
                                                                        04240012
036600     IF PM703-PRIC-VER-ABBR-NM  NOT EQUAL XS017-PRIC-VER-ABBR-NM  04250012
              MOVE 'PM703-PRIC-VER-ABBR-NM'  TO PROMO-RPT-DATA-NAME     04260012
              MOVE PM703-PRIC-VER-ABBR-NM   TO PROMO-RPT-DATA-VALUE     04270012
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             04280012
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           04290012
              PERFORM 9999-WRITE-ERROR-REPORT                           04300012
              MOVE 'XS017-PRIC-VER-ABBR-NM' TO PROMO-RPT-DATA-NAME      04310012
              MOVE XS017-PRIC-VER-ABBR-NM   TO PROMO-RPT-DATA-VALUE     04320012
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             04330012
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           04340012
              PERFORM 9999-WRITE-ERROR-REPORT                           04350012
              SET PS-ERROR-FOUND     TO TRUE                            04360012
           END-IF.                                                      04370012
                                                                        04380012
                                                                        04390012
                                                                        04400012
                                                                        04410012
           IF  PS-ERROR-FOUND                                           04420012
037200        IF PM703-LAST-UPD-TMST  > XS017-LAST-UPD-TMST             04430012
                  PERFORM 9999-FORMAT-ERROR-RECORD                      04440012
                  PERFORM 9999-WRITE-ERROR-RECORD                       04450012
              END-IF                                                    04460012
           END-IF.                                                      04470012
054500                                                                  04480012
056900 2100-EXIT.                                                       04490012
057000     EXIT.                                                        04500012
043600 EJECT.                                                           04510012
043610                                                                  04520012
                                                                        04530012
      ******************************************************************04540012
      **COMPARES FIELDS BETWEEN FILES TO SEE IF ANY DIFFERENCES EXIST   04550012
      ******************************************************************04560012
       3000-PROCESS-EXTRA-RECORDS.                                      04570012
                                                                        04580012
           IF  PS-NOT-EOF-PROMO                                         04590012
               INITIALIZE REPORT-DETAIL                                 04600012
               MOVE PV-PROMO-KEY            TO PROMO-EVNT-KEY           04610012
               MOVE PV-PROMO-NF             TO REPORT-NOTES             04620012
               PERFORM 9999-WRITE-ERROR-REPORT                          04630012
               MOVE PM703-PRICE-VERSION-RECORD TO ERROR-RECORD          04640012
               PERFORM 9999-WRITE-ERROR-RECORD                          04650012
               PERFORM 9999-READ-PROMO-EXTRACT                          04660012
           END-IF.                                                      04670012
                                                                        04680012
           IF  PS-NOT-EOF-DOMAIN                                        04690012
               INITIALIZE REPORT-DETAIL                                 04700012
               MOVE PV-DOMAIN-NF             TO REPORT-NOTES            04710012
               MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY          04720012
               PERFORM 9999-WRITE-ERROR-REPORT                          04730012
               MOVE XS017-PRICE-VERSION-RECORD TO ERROR-RECORD          04740012
               PERFORM 9999-WRITE-ERROR-RECORD                          04750012
               PERFORM 9999-READ-DOMAIN-EXTRACT                         04760012
           END-IF.                                                      04770012
                                                                        04780012
056900 3000-EXIT.                                                       04790012
057000     EXIT.                                                        04800012
                                                                        04810012
       EJECT.                                                           04820012
059800*----------------------------------------------------------       04830012
059900* 9999-WRAPUP.                                                    04840012
059910*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           04850012
059920*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           04860012
059930*     PROGRAM.                                                    04870012
060000*----------------------------------------------------------       04880012
060100 9999-WRAPUP.                                                     04890012
026600     CLOSE PROMO-EXTRACT-FILE                                     04900012
026600           DOMAIN-EXTRACT-FILE                                    04910012
026600           ERROR-FILE                                             04920012
026600           REPORT-FILE.                                           04930012
                                                                        04940012
           IF  PC-ERROR-RECORD-WRITTEN > 0                              04950012
               MOVE 04               TO RETURN-CODE                     04960012
           END-IF.                                                      04970012
                                                                        04980012
                                                                        04990012
060500                                                                  05000012
060710*9999-EXIT.                                                       05010012
060800 EJECT.                                                           05020012
      ***************************************************************** 05030012
      **FORMAT ERROR-RECORD                                             05040012
      ***************************************************************** 05050012
       9999-FORMAT-ERROR-RECORD.                                        05060012
           MOVE PM703-PRICE-VERSION-RECORD TO ERROR-RECORD.             05070012
                                                                        05080012
       EJECT.                                                           05090012
      ***************************************************************** 05100012
      **READ PROMO  EXTRACT FILE                                        05110012
      ***************************************************************** 05120012
       9999-READ-PROMO-EXTRACT.                                         05130012
           IF  PS-NOT-EOF-PROMO                                         05140012
               READ PROMO-EXTRACT-FILE INTO PM703-PRICE-VERSION-RECORD  05150012
                    AT END                                              05160012
                       SET PS-EOF-PROMO TO TRUE                         05170012
               END-READ                                                 05180012
           END-IF.                                                      05190012
                                                                        05200012
           IF  PS-NOT-EOF-PROMO                                         05210012
               ADD +1                  TO PC-PROMO-EXTRACT-RECS-READ    05220012
               MOVE PM703-PROMO-PRIC-VER-ID TO PV-PM-PRIC-VER-ID        05230012
           END-IF.                                                      05240012
                                                                        05250012
       EJECT.                                                           05260012
      ***************************************************************** 05270012
      **READ XS EXTRACT FILE                                            05280012
      ***************************************************************** 05290012
       9999-READ-DOMAIN-EXTRACT.                                        05300012
           IF  PS-NOT-EOF-DOMAIN                                        05310012
               READ DOMAIN-EXTRACT-FILE INTO XS017-PRICE-VERSION-RECORD 05320012
                    AT END                                              05330012
                       SET PS-EOF-DOMAIN TO TRUE                        05340012
               END-READ                                                 05350012
           END-IF.                                                      05360012
                                                                        05370012
           IF  PS-NOT-EOF-DOMAIN                                        05380012
               ADD +1              TO PC-DOMAIN-EXTRACT-RECS-READ       05390012
               MOVE XS017-PROMO-PRIC-VER-ID TO PV-XS-PRIC-VER-ID        05400012
           END-IF.                                                      05410012
                                                                        05420012
       EJECT.                                                           05430012
      ***************************************************************** 05440012
      **READ CONTROL CARD FOR FREQUENCY OF COMPARE                      05450012
      ***************************************************************** 05460012
       9999-READ-CONTROL-CARD.                                          05470012
                                                                        05480012
           READ CONTROL-CARD INTO CONTROL-CARD-LAYOUT.                  05490012
                                                                        05500012
       EJECT.                                                           05510012
      ***************************************************************** 05520012
      **WRITE ERROR RECORD                                              05530012
      ***************************************************************** 05540012
       9999-WRITE-ERROR-RECORD.                                         05550012
                                                                        05560012
           WRITE DIFFERENCES-RECORD FROM ERROR-RECORD.                  05570012
                                                                        05580012
           ADD +1                       TO PC-ERROR-RECORD-WRITTEN.     05590012
                                                                        05600012
       EJECT.                                                           05610012
      ***************************************************************** 05620012
      **WRITE ERROR REPORT                                              05630012
      ***************************************************************** 05640012
       9999-WRITE-ERROR-REPORT.                                         05650012
           IF PC-ERROR-REPORT-WRITTEN > 66                              05660012
              PERFORM 9999-PRINT-HEADINGS                               05670012
           ELSE                                                         05680012
              WRITE REPORT-RECORD FROM REPORT-DETAIL                    05690012
              INITIALIZE REPORT-DETAIL                                  05700012
              ADD +1 TO PC-ERROR-REPORT-WRITTEN                         05710012
           END-IF.                                                      05720012
                                                                        05730012
       EJECT.                                                           05740012
      ***************************************************************** 05750012
      **PRINT HEADINGS                                                  05760012
      ***************************************************************** 05770012
       9999-PRINT-HEADINGS.                                             05780012
           ADD 1 TO PC-PAGE-CNT.                                        05790012
           MOVE PC-PAGE-CNT TO DP132O-PAGE-NUMBER.                      05800012
           MOVE ZEROS TO PC-ERROR-REPORT-WRITTEN.                       05810012
                                                                        05820012
491700     WRITE REPORT-RECORD                                          05830012
491800         FROM DP132O-STANDRD-HEADER-132-COLS                      05840012
491900         AFTER ADVANCING PAGE.                                    05850012
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     05860012
                                                                        05870012
491700     WRITE REPORT-RECORD                                          05880012
491800         FROM DR-HEAD2                                            05890012
491900         AFTER ADVANCING 1 LINE.                                  05900012
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     05910012
                                                                        05920012
491700     WRITE REPORT-RECORD                                          05930012
491800         FROM DR-HEAD3                                            05940012
491900         AFTER ADVANCING 2 LINE.                                  05950012
           ADD +2                       TO PC-ERROR-REPORT-WRITTEN.     05960012
                                                                        05970012
491700     WRITE REPORT-RECORD                                          05980012
491800         FROM DR-HEAD5                                            05990012
491900         AFTER ADVANCING 1 LINE.                                  06000012
                                                                        06010012
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     06020012
                                                                        06030012
       EJECT.                                                           06040012
