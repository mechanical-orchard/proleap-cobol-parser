000100 TITLE 'RESTORE XL.PURCHASE.ORDER.Q FROM EXTRACT'.                        
000200 IDENTIFICATION DIVISION.                                                 
000300 PROGRAM-ID.    XLKUT301.                                                 
000400 AUTHOR.        DENNIS STEFFEN.                                           
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  MAY 2007.                                                 
000700 DATE-COMPILED.                                                           
000800                                                                          
000900*     INPUT:                                                              
001000*        MESSAGE QUEUE EXTRACT CREATED BY XLKUT102                        
001100*        FILE CONTAINING QUE MANAGER NAME                                 
001200*        FILE CONTAINING QUE NAME                                         
001300*     OUTPUTS:                                                            
001400*        XL.PURCHASE.ORDER.Q0                                             
001500*        XL.PURCHASE.ORDER.Q1                                             
001600*        XL.PURCHASE.ORDER.Q2                                             
001700*        XL.PURCHASE.ORDER.Q3                                             
001800*        XL.PURCHASE.ORDER.Q4                                             
001900*        XL.PURCHASE.ORDER.Q5                                             
002000*        XL.PURCHASE.ORDER.Q6                                             
002100*        XL.PURCHASE.ORDER.Q7                                             
002200*        XL.PURCHASE.ORDER.Q8                                             
002300*        XL.PURCHASE.ORDER.Q9                                             
002400*                                                                         
002500*    NOTE:  AS OF 10/31/2007 ONLY THE Q0 AND Q1 QUEUES ARE ACTIVE         
002600*                                                                         
002700*                                                                         
002800 ENVIRONMENT DIVISION.                                                    
002900 CONFIGURATION SECTION.                                                   
003000 SOURCE-COMPUTER.  IBM-3090.                                              
003100 OBJECT-COMPUTER.  IBM-3090.                                              
003200                                                                          
003300 INPUT-OUTPUT SECTION.                                                    
003400                                                                          
003500 FILE-CONTROL.                                                            
003600                                                                          
003700*    THIS CONTAINS THE MESSAGES TO BE RESTORED                            
003800     SELECT EXTRACT-FILE                                                  
003900             ASSIGN TO INP01.                                             
004000                                                                          
004100     SELECT QMGR-FILE                                                     
004200             ASSIGN TO INP02.                                             
004300                                                                          
004400*    THESE ARE THE OUTPUT QUEUE NAMES                                     
004500*    Q0                                                                   
004600     SELECT QNAME-FILE-0                                                  
004700             ASSIGN TO INP03.                                             
004800                                                                          
004900*    Q1                                                                   
005000     SELECT QNAME-FILE-1                                                  
005100             ASSIGN TO INP04.                                             
005200                                                                          
005300*    Q2                                                                   
005400     SELECT QNAME-FILE-2                                                  
005500             ASSIGN TO INP05.                                             
005600                                                                          
005700*    Q3                                                                   
005800     SELECT QNAME-FILE-3                                                  
005900             ASSIGN TO INP06.                                             
006000                                                                          
006100*    Q4                                                                   
006200     SELECT QNAME-FILE-4                                                  
006300             ASSIGN TO INP07.                                             
006400                                                                          
006500*    SELECT QNAME-FILE-5                                                  
006600*            ASSIGN TO INP08.                                             
006700*                                                                         
006800*    SELECT QNAME-FILE-6                                                  
006900*            ASSIGN TO INP09.                                             
007000*                                                                         
007100*    SELECT QNAME-FILE-7                                                  
007200*            ASSIGN TO INP10.                                             
007300*                                                                         
007400*    SELECT QNAME-FILE-8                                                  
007500*            ASSIGN TO INP11.                                             
007600*                                                                         
007700*    SELECT QNAME-FILE-9                                                  
007800*            ASSIGN TO INP12.                                             
007900                                                                          
008000 DATA DIVISION.                                                           
008100 FILE SECTION.                                                            
008200                                                                          
008300 FD  EXTRACT-FILE                                                         
008400     RECORDING MODE F                                                     
008500     BLOCK CONTAINS 0 RECORDS                                             
008600     LABEL RECORDS ARE OMITTED.                                           
008700 01  EXTRACT-REC                      PIC X(0528).                        
008800                                                                          
008900 FD  QMGR-FILE                                                            
009000     RECORDING MODE F                                                     
009100     BLOCK CONTAINS 0 RECORDS                                             
009200     LABEL RECORDS ARE OMITTED.                                           
009300 01  QMGR-CARD                        PIC  X(80).                         
009400                                                                          
009500 FD  QNAME-FILE-0                                                         
009600     RECORDING MODE F                                                     
009700     BLOCK CONTAINS 0 RECORDS                                             
009800     LABEL RECORDS ARE OMITTED.                                           
009900 01  QNAME-CARD-0                     PIC  X(80).                         
010000                                                                          
010100 FD  QNAME-FILE-1                                                         
010200     RECORDING MODE F                                                     
010300     BLOCK CONTAINS 0 RECORDS                                             
010400     LABEL RECORDS ARE OMITTED.                                           
010500 01  QNAME-CARD-1                     PIC  X(80).                         
010600                                                                          
010700 FD  QNAME-FILE-2                                                         
010800     RECORDING MODE F                                                     
010900     BLOCK CONTAINS 0 RECORDS                                             
011000     LABEL RECORDS ARE OMITTED.                                           
011100 01  QNAME-CARD-2                     PIC  X(80).                         
011200                                                                          
011300 FD  QNAME-FILE-3                                                         
011400     RECORDING MODE F                                                     
011500     BLOCK CONTAINS 0 RECORDS                                             
011600     LABEL RECORDS ARE OMITTED.                                           
011700 01  QNAME-CARD-3                     PIC  X(80).                         
011800                                                                          
011900 FD  QNAME-FILE-4                                                         
012000     RECORDING MODE F                                                     
012100     BLOCK CONTAINS 0 RECORDS                                             
012200     LABEL RECORDS ARE OMITTED.                                           
012300 01  QNAME-CARD-4                     PIC  X(80).                         
012400*                                                                         
012500*FD  QNAME-FILE-5                                                         
012600*    RECORDING MODE F                                                     
012700*    BLOCK CONTAINS 0 RECORDS                                             
012800*    LABEL RECORDS ARE OMITTED.                                           
012900*01  QNAME-CARD-5                     PIC  X(80).                         
013000*                                                                         
013100*FD  QNAME-FILE-6                                                         
013200*    RECORDING MODE F                                                     
013300*    BLOCK CONTAINS 0 RECORDS                                             
013400*    LABEL RECORDS ARE OMITTED.                                           
013500*01  QNAME-CARD-6                     PIC  X(80).                         
013600*                                                                         
013700*FD  QNAME-FILE-7                                                         
013800*    RECORDING MODE F                                                     
013900*    BLOCK CONTAINS 0 RECORDS                                             
014000*    LABEL RECORDS ARE OMITTED.                                           
014100*01  QNAME-CARD-7                     PIC  X(80).                         
014200*                                                                         
014300*FD  QNAME-FILE-8                                                         
014400*    RECORDING MODE F                                                     
014500*    BLOCK CONTAINS 0 RECORDS                                             
014600*    LABEL RECORDS ARE OMITTED.                                           
014700*01  QNAME-CARD-8                     PIC  X(80).                         
014800*                                                                         
014900*FD  QNAME-FILE-9                                                         
015000*    RECORDING MODE F                                                     
015100*    BLOCK CONTAINS 0 RECORDS                                             
015200*    LABEL RECORDS ARE OMITTED.                                           
015300*01  QNAME-CARD-9                     PIC  X(80).                         
015400                                                                          
015500/                                                                         
015600 WORKING-STORAGE SECTION.                                                 
015700                                                                          
015800 01  PS-SWITCHES.                                                         
015900     05  PS-ERROR-SW                  PIC X(01) VALUE 'N'.                
016000         88  PS-ERROR-NO                        VALUE 'N'.                
016100         88  PS-ERROR-YES                       VALUE 'Y'.                
016200     05  PS-END-OF-EXTRACT-SW         PIC X(01) VALUE 'N'.                
016300         88  PS-END-OF-EXTRACT-NO               VALUE 'N'.                
016400         88  PS-END-OF-EXTRACT-YES              VALUE 'Y'.                
016500     05  PS-PACK-SW                   PIC X(01) VALUE SPACE.              
016600         88  PS-PACK-NO                         VALUE SPACE.              
016700         88  PS-PACK-YES                        VALUE 'P'.                
016800                                                                          
      *CHG0182536                                                               
           05  PS-MSG-TYPE-SW               PIC X(01) VALUE 'Y'.                
               88  PS-CORRECT-MSG-TYPE-YES            VALUE 'Y'.                
               88  PS-CORRECT-MSG-TYPE-NO             VALUE 'N'.                
007200     05  PS-RET-CODE-SW               PIC X(01) VALUE 'N'.                
007300         88  PS-GOOD-RET-CODE                   VALUE 'Y'.                
007400         88  PS-BAD-RET-CODE                    VALUE 'N'.                
      *CHG0182536                                                               
016900 01  PV-QMGR-CARD.                                                        
017000     05  PV-QMGR-NAME              PIC X(48).                             
017100     05  FILLER                    PIC X(32).                             
017200                                                                          
017300 01  PV-QNAME-CARD-0.                                                     
017400     05  PV-QNAME-0                PIC X(48).                             
017500     05  FILLER                    PIC X(32).                             
017600 01  PV-QNAME-CARD-1.                                                     
017700     05  PV-QNAME-1                PIC X(48).                             
017800     05  FILLER                    PIC X(32).                             
017900 01  PV-QNAME-CARD-2.                                                     
018000     05  PV-QNAME-2                PIC X(48).                             
018100     05  FILLER                    PIC X(32).                             
018200 01  PV-QNAME-CARD-3.                                                     
018300     05  PV-QNAME-3                PIC X(48).                             
018400     05  FILLER                    PIC X(32).                             
018500 01  PV-QNAME-CARD-4.                                                     
018600     05  PV-QNAME-4                PIC X(48).                             
018700     05  FILLER                    PIC X(32).                             
018800*01  PV-QNAME-CARD-5.                                                     
018900*    05  PV-QNAME-5                PIC X(48).                             
019000*    05  FILLER                    PIC X(32).                             
019100*01  PV-QNAME-CARD-6.                                                     
019200*    05  PV-QNAME-6                PIC X(48).                             
019300*    05  FILLER                    PIC X(32).                             
019400*01  PV-QNAME-CARD-7.                                                     
019500*    05  PV-QNAME-7                PIC X(48).                             
019600*    05  FILLER                    PIC X(32).                             
019700*01  PV-QNAME-CARD-8.                                                     
019800*    05  PV-QNAME-8                PIC X(48).                             
019900*    05  FILLER                    PIC X(32).                             
020000*01  PV-QNAME-CARD-9.                                                     
020100*    05  PV-QNAME-9                PIC X(48).                             
020200*    05  FILLER                    PIC X(32).                             
020300                                                                          
020400 01  XLRD011-RECORD.                                                      
020500     COPY XLRD011.                                                        
020600                                                                          
020700 01  PV-CRAPOLA.                                                          
020800     05  PV-QNAME                     PIC X(48) VALUE SPACES.             
020900     05  PV-QUE-NBR                   PIC X(02) VALUE ZERO.               
021000     05  PV-START                     PIC S9(05) COMP-3                   
021100                                             VALUE ZERO.                  
021200     05  PV-LENGTH                    PIC S9(05) COMP-3                   
021300                                             VALUE ZERO.                  
021400     05  PV-COMMIT                    PIC S9(09) COMP-3                   
021500                                             VALUE ZERO.                  
021600     05  PV-PO-NBR-X.                                                     
021700         10  PV-PO-NBR-N              PIC 9(08) VALUE ZERO.               
021800     05  PV-DIGIT-X.                                                      
021900         10  PV-DIGIT-N               PIC 9(01) VALUE ZERO.               
022000     05  PV-TOTAL-PUT-COUNT           PIC S9(09) COMP-3                   
022100                                             VALUE ZERO.                  
022200     05  PV-READ-COUNT                PIC S9(09) COMP-3                   
022300                                             VALUE ZERO.                  
022400     05  PV-DISP-NUM                  PIC Z,ZZZ,ZZZ,ZZ9.                  
022500                                                                          
022600     05  ERROR-MESSAGE                PIC X(48) VALUE SPACES.             
022700     05  PV-MQ-TEXT-REASON            PIC X(30) VALUE SPACES.             
022800     05  PV-PARAGRAPH                 PIC X(48) VALUE SPACES.             
022900                                                                          
023000     05  PV-PUT-0-COUNT              PIC S9(09) COMP-3                    
023100                                             VALUE ZERO.                  
023200     05  PV-PUT-1-COUNT              PIC S9(09) COMP-3                    
023300                                             VALUE ZERO.                  
023400     05  PV-PUT-2-COUNT              PIC S9(09) COMP-3                    
023500                                             VALUE ZERO.                  
023600     05  PV-PUT-3-COUNT              PIC S9(09) COMP-3                    
023700                                             VALUE ZERO.                  
023800     05  PV-PUT-4-COUNT              PIC S9(09) COMP-3                    
023900                                             VALUE ZERO.                  
024000     05  PV-PUT-5-COUNT              PIC S9(09) COMP-3                    
024100                                             VALUE ZERO.                  
024200     05  PV-PUT-6-COUNT              PIC S9(09) COMP-3                    
024300                                             VALUE ZERO.                  
024400     05  PV-PUT-7-COUNT              PIC S9(09) COMP-3                    
024500                                             VALUE ZERO.                  
024600     05  PV-PUT-8-COUNT              PIC S9(09) COMP-3                    
024700                                             VALUE ZERO.                  
024800     05  PV-PUT-9-COUNT              PIC S9(09) COMP-3                    
024900                                             VALUE ZERO.                  
025000*CHG0182536                                                               
024800     05  PV-SKIP-MSG-COUNT           PIC S9(09) COMP-3                    
024900                                             VALUE ZERO.                  
025000*CHG0182536                                                               
025100                                                                          
025200*   MQ-SERIES PARAMETER VARIABLES                                         
025300                                                                          
025400 01  QM-NAME                          PIC X(48).                          
025500 01  QNAME                            PIC X(48).                          
025600 01  MSGBUFFER                        PIC X(1000000) VALUE SPACES.        
025700 01  PV-MSGLENGTH                     PIC S9(9) BINARY.                   
025800 01  MQ-REASON-TEXT                   PIC X(30) VALUE SPACES.             
025900 01  HOLD-REASON           PIC S9(9) BINARY.                              
026000 01  HOLD-COMPLETION-CODE  PIC S9(9) BINARY.                              
026100                                                                          
026200*    MQSERIES API FIELDS                                                  
026300                                                                          
026400 01  HCONN                   PIC S9(9) BINARY VALUE 0.                    
026500                                                                          
026600 01  PQ-HANDLE-0             PIC S9(9) BINARY VALUE 0.                    
026700 01  PQ-HANDLE-1             PIC S9(9) BINARY VALUE 0.                    
026800 01  PQ-HANDLE-2             PIC S9(9) BINARY VALUE 0.                    
026900 01  PQ-HANDLE-3             PIC S9(9) BINARY VALUE 0.                    
027000 01  PQ-HANDLE-4             PIC S9(9) BINARY VALUE 0.                    
027100                                                                          
027200 01  OPEN-OPTIONS            PIC S9(9) BINARY.                            
027300 01  COMPLETION-CODE         PIC S9(9) BINARY.                            
027400 01  REASON                  PIC S9(9) BINARY.                            
027500 01  CON-REASON              PIC S9(9) BINARY.                            
027600*                                                                         
027700*    API CONTROL BLOCKS                                                   
027800*                                                                         
027900 01  MQM-OBJECT-DESCRIPTOR.                                               
028000     COPY CMQODV.                                                         
028100 01  MQM-MESSAGE-DESCRIPTOR.                                              
028200     COPY CMQMDV.                                                         
028300 01  MQM-PUT-MESSAGE-OPTIONS.                                             
028400     COPY CMQPMOV.                                                        
028500*                                                                         
028600*    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)           
028700*    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)                  
028800*                                                                         
028900 01  MQM-CONSTANTS.                                                       
029000     COPY CMQV.                                                           
029100                                                                          
029200 01  PV-ABEND-VARIABLES.                                                  
029300     05  PV-ABEND-CODE              PIC S9(04) VALUE +0 COMP SYNC.        
029400         88 ABEND-4001-WRITE-ERROR                   VALUE +4001.         
029500         88 ABEND-4002-READ-ERROR                    VALUE +4002.         
029600         88 ABEND-4003-CTRL-CARD-ERROR               VALUE +4003.         
029700         88 ABEND-4004-TABLE-ERROR                   VALUE +4004.         
029800         88 ABEND-4005-OPEN-ERROR                    VALUE +4005.         
029900         88 ABEND-4006-CLOSE-ERROR                   VALUE +4006.         
030000         88 ABEND-4007-SEQUENCE-ERROR                VALUE +4007.         
030100         88 ABEND-4008-DATA-ERROR                    VALUE +4008.         
030200         88 ABEND-4009-KEY-DATA-ERROR                VALUE +4009.         
030300         88 ABEND-4013-DB2-ERROR                     VALUE +4013.         
030400         88 ABEND-4019-CAL-SUB-ERROR                 VALUE +4019.         
030500         88 ABEND-4020-MQ-ERROR                      VALUE +4020.         
030600         88 ABEND-4444-FORCED-ABEND                  VALUE +4444.         
030700                                                                          
030800                                                                          
030900 01  PE-MQ-ABEND-VARIABLES.                                               
031000     10  PE-MQ-QMANAGER           PIC X(05) VALUE SPACES.                 
031100     10  PE-MQ-QNAME              PIC X(30) VALUE SPACES.                 
031200     10  PE-MQ-COMPLETION-CODE    PIC 9(04) VALUE ZEROS.                  
031300     10  PE-MQ-REASON-CODE        PIC 9(04) VALUE ZEROS.                  
031400                                                                          
031500 01  MQ-CONSTANTS.                                                        
031600     05 WS-MQCONN            PIC X(8)  VALUE 'CSQBCONN'.                  
031700     05 WS-MQOPEN            PIC X(8)  VALUE 'CSQBOPEN'.                  
031800     05 WS-MQINQ             PIC X(8)  VALUE 'CSQBINQ'.                   
031900     05 WS-MQPUT             PIC X(8)  VALUE 'CSQBPUT'.                   
032000     05 WS-MQCLOSE           PIC X(8)  VALUE 'CSQBCLOS'.                  
032100     05 WS-MQDISC            PIC X(8)  VALUE 'CSQBDISC'.                  
032200     05 WS-MQCHECK           PIC X(8)  VALUE 'MQR2C'.                     
032300     05 WS-MQCMIT            PIC X(8)  VALUE 'CSQBCOMM'.                  
032400     05 WS-MQBACK            PIC X(8)  VALUE 'CSQBBACK'.                  
032500                                                                          
032600************************************************************              
032700* END OF MQ-SERIES STUFF                                                  
032800************************************************************              
032900                                                                          
033000 LINKAGE SECTION.                                                         
033100 01  RUN-PARMS.                                                           
033200     05  PARM-LENGTH                  PIC S9(04) COMP.                    
033300     05  PARM-USERID                  PIC X(07).                          
033400/                                                                         
033500 PROCEDURE DIVISION USING RUN-PARMS.                                      
033600                                                                          
033700     PERFORM 1000-INITIALIZE.                                             
033600                                                                          
033700*CHG0182536                                                               
033800     SET PS-GOOD-RET-CODE TO TRUE.                                        
033700*CHG0182536                                                               
033600                                                                          
033900     PERFORM 2000-PROCESS                                                 
034000         UNTIL PS-END-OF-EXTRACT-YES                                      
034100               OR PS-ERROR-YES                                            
034200                                                                          
034300     PERFORM 9999-END.                                                    
034400                                                                          
033700*CHG0182536                                                               
034400     IF PS-BAD-RET-CODE                                                   
034400        MOVE 4095 TO RETURN-CODE                                          
034400     END-IF.                                                              
033700*CHG0182536                                                               
034500     GOBACK.                                                              
034500                                                                          
034700 1000-INITIALIZE.                                                         
034800                                                                          
034900     DISPLAY SPACES                                                       
035000     DISPLAY '***********  XLKUT301  ***************'                     
035100     DISPLAY '***********  VERSION 1 ***************'                     
035200                                                                          
035300     OPEN INPUT                                                           
035400            EXTRACT-FILE                                                  
035500            QMGR-FILE                                                     
035600            QNAME-FILE-0                                                  
035700            QNAME-FILE-1                                                  
035800            QNAME-FILE-2                                                  
035900            QNAME-FILE-3                                                  
036000            QNAME-FILE-4                                                  
036100                                                                          
036200*           QNAME-FILE-5                                                  
036300*           QNAME-FILE-6                                                  
036400*           QNAME-FILE-7                                                  
036500*           QNAME-FILE-8                                                  
036600*           QNAME-FILE-9                                                  
036700                                                                          
036800     READ QMGR-FILE                                                       
036900         INTO PV-QMGR-CARD                                                
037000     AT END                                                               
037100         DISPLAY 'ERROR - QMGR NAME MISSING'                              
037200         SET PS-ERROR-YES             TO TRUE                             
037300     END-READ                                                             
037400                                                                          
037500     IF PS-ERROR-NO                                                       
037600         PERFORM 1001-READ-QUE-CARDS                                      
037700     END-IF.                                                              
037800                                                                          
037900     IF PS-ERROR-NO                                                       
038000         PERFORM 1100-CONNECT                                             
038100     END-IF                                                               
038200                                                                          
038300     IF PS-ERROR-NO                                                       
038400         PERFORM 1200-OPEN-OUTPUT-QUE                                     
038500     END-IF.                                                              
038600                                                                          
038700     IF PS-ERROR-NO                                                       
038800         PERFORM 8000-READ-EXTRACT                                        
038900     END-IF.                                                              
039000                                                                          
039100 1001-READ-QUE-CARDS.                                                     
039200                                                                          
039300     READ QNAME-FILE-0                                                    
039400     INTO PV-QNAME-CARD-0                                                 
039500     AT END                                                               
039600         DISPLAY 'ERROR - QUEUE-0 NAME MISSING'                           
039700         SET PS-ERROR-YES         TO TRUE                                 
039800     END-READ                                                             
039900                                                                          
040000     READ QNAME-FILE-1                                                    
040100     INTO PV-QNAME-CARD-1                                                 
040200     AT END                                                               
040300         DISPLAY 'ERROR - QUEUE-1 NAME MISSING'                           
040400         SET PS-ERROR-YES         TO TRUE                                 
040500     END-READ.                                                            
040600                                                                          
040700     READ QNAME-FILE-2                                                    
040800     INTO PV-QNAME-CARD-2                                                 
040900     AT END                                                               
041000         DISPLAY 'ERROR - QUEUE-2 NAME MISSING'                           
041100         SET PS-ERROR-YES         TO TRUE                                 
041200     END-READ                                                             
041300                                                                          
041400     READ QNAME-FILE-3                                                    
041500     INTO PV-QNAME-CARD-3                                                 
041600     AT END                                                               
041700         DISPLAY 'ERROR - QUEUE-3 NAME MISSING'                           
041800         SET PS-ERROR-YES         TO TRUE                                 
041900     END-READ                                                             
042000                                                                          
042100     READ QNAME-FILE-4                                                    
042200     INTO PV-QNAME-CARD-4                                                 
042300     AT END                                                               
042400         DISPLAY 'ERROR - QUEUE-4 NAME MISSING'                           
042500         SET PS-ERROR-YES         TO TRUE                                 
042600     END-READ.                                                            
042700*                                                                         
042800*    READ QNAME-FILE-5                                                    
042900*    INTO PV-QNAME-CARD-5                                                 
043000*    AT END                                                               
043100*        DISPLAY 'ERROR - QUEUE-5 NAME MISSING'                           
043200*        SET PS-ERROR-YES         TO TRUE                                 
043300*    END-READ                                                             
043400*                                                                         
043500*    READ QNAME-FILE-6                                                    
043600*    INTO PV-QNAME-CARD-6                                                 
043700*    AT END                                                               
043800*        DISPLAY 'ERROR - QUEUE-6 NAME MISSING'                           
043900*        SET PS-ERROR-YES         TO TRUE                                 
044000*    END-READ                                                             
044100*                                                                         
044200*    READ QNAME-FILE-7                                                    
044300*    INTO PV-QNAME-CARD-7                                                 
044400*    AT END                                                               
044500*        DISPLAY 'ERROR - QUEUE-7 NAME MISSING'                           
044600*        SET PS-ERROR-YES         TO TRUE                                 
044700*    END-READ                                                             
044800*                                                                         
044900*    READ QNAME-FILE-8                                                    
045000*    INTO PV-QNAME-CARD-8                                                 
045100*    AT END                                                               
045200*        DISPLAY 'ERROR - QUEUE-8 NAME MISSING'                           
045300*        SET PS-ERROR-YES         TO TRUE                                 
045400*    END-READ                                                             
045500*                                                                         
045600*    READ QNAME-FILE-9                                                    
045700*    INTO PV-QNAME-CARD-9                                                 
045800*    AT END                                                               
045900*        DISPLAY 'ERROR - QUEUE-9 NAME MISSING'                           
046000*        SET PS-ERROR-YES         TO TRUE                                 
046100*    END-READ.                                                            
046200/                                                                         
046300 1100-CONNECT.                                                            
046400*    CONNECT TO THE QUEUE MANAGER                                         
046500*                                                                         
046600     MOVE PV-QMGR-NAME TO QM-NAME.                                        
046700     CALL WS-MQCONN USING QM-NAME                                         
046800                         HCONN                                            
046900                         COMPLETION-CODE                                  
047000                         REASON.                                          
047100*                                                                         
047200*    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE                      
047300*    AND EXIT                                                             
047400                                                                          
047500     MOVE REASON TO CON-REASON.                                           
047600     IF COMPLETION-CODE = MQCC-OK                                         
047700         DISPLAY 'MQCONN SUCCESSFUL   TO '  QM-NAME                       
047800     ELSE                                                                 
047900         MOVE 'MQCONN ERROR'          TO ERROR-MESSAGE                    
048000         PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
048100         SET PS-ERROR-YES             TO TRUE                             
048200     END-IF.                                                              
048300/                                                                         
048400 1200-OPEN-OUTPUT-QUE.                                                    
048500*    OPEN THE QUEUES FOR OUTPUT                                           
048600                                                                          
048700     MOVE PV-QNAME-0               TO PV-QNAME                            
048800                                                                          
048900     MOVE 0                        TO PV-QUE-NBR                          
049000     PERFORM 1201-OPEN-DA-QUEUE                                           
049100                                                                          
049200     MOVE PV-QNAME-1               TO PV-QNAME                            
049300     MOVE 1                        TO PV-QUE-NBR                          
049400     PERFORM 1201-OPEN-DA-QUEUE.                                          
049500                                                                          
049600     MOVE PV-QNAME-2               TO PV-QNAME                            
049700     MOVE 2                        TO PV-QUE-NBR                          
049800     PERFORM 1201-OPEN-DA-QUEUE                                           
049900                                                                          
050000     MOVE PV-QNAME-3               TO PV-QNAME                            
050100     MOVE 3                        TO PV-QUE-NBR                          
050200     PERFORM 1201-OPEN-DA-QUEUE                                           
050300                                                                          
050400     MOVE PV-QNAME-4               TO PV-QNAME                            
050500     MOVE 4                        TO PV-QUE-NBR                          
050600     PERFORM 1201-OPEN-DA-QUEUE.                                          
050700                                                                          
050800 1201-OPEN-DA-QUEUE.                                                      
050900                                                                          
051000     COMPUTE OPEN-OPTIONS = MQOO-OUTPUT +                                 
051100                            MQOO-FAIL-IF-QUIESCING +                      
051200                            MQOO-SET-IDENTITY-CONTEXT.                    
051300     MOVE PV-QNAME                 TO MQOD-OBJECTNAME.                    
051400     MOVE QM-NAME                  TO MQOD-OBJECTQMGRNAME.                
051500                                                                          
051600     EVALUATE PV-QUE-NBR                                                  
051700     WHEN 0                                                               
051800         CALL WS-MQOPEN USING HCONN                                       
051900                             MQM-OBJECT-DESCRIPTOR                        
052000                             OPEN-OPTIONS                                 
052100                             PQ-HANDLE-0                                  
052200                             COMPLETION-CODE                              
052300                             REASON                                       
052400     WHEN 1                                                               
052500         CALL WS-MQOPEN USING HCONN                                       
052600                             MQM-OBJECT-DESCRIPTOR                        
052700                             OPEN-OPTIONS                                 
052800                             PQ-HANDLE-1                                  
052900                             COMPLETION-CODE                              
053000                             REASON                                       
053100     WHEN 2                                                               
053200         CALL WS-MQOPEN USING HCONN                                       
053300                             MQM-OBJECT-DESCRIPTOR                        
053400                             OPEN-OPTIONS                                 
053500                             PQ-HANDLE-2                                  
053600                             COMPLETION-CODE                              
053700                             REASON                                       
053800     WHEN 3                                                               
053900         CALL WS-MQOPEN USING HCONN                                       
054000                             MQM-OBJECT-DESCRIPTOR                        
054100                             OPEN-OPTIONS                                 
054200                             PQ-HANDLE-3                                  
054300                             COMPLETION-CODE                              
054400                             REASON                                       
054500     WHEN 4                                                               
054600         CALL WS-MQOPEN USING HCONN                                       
054700                             MQM-OBJECT-DESCRIPTOR                        
054800                             OPEN-OPTIONS                                 
054900                             PQ-HANDLE-4                                  
055000                             COMPLETION-CODE                              
055100                             REASON                                       
055200     END-EVALUATE                                                         
055300                                                                          
055400*                                                                         
055500*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                            
055600*    AND EXIT.                                                            
055700*                                                                         
055800     IF COMPLETION-CODE = MQCC-OK                                         
055900         DISPLAY PV-QNAME  ' OPENED SUCCESSFULLY FOR OUTPUT'              
056000     ELSE                                                                 
056100         DISPLAY PV-QNAME  ' OPEN ERROR'                                  
056200         SET PS-ERROR-YES             TO TRUE                             
056300         CALL WS-MQCHECK USING REASON                                     
056400                              PV-MQ-TEXT-REASON                           
056500         MOVE 'MQOPEN ERROR'          TO ERROR-MESSAGE                    
056600         PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
056700*        PERFORM 1300-DISCONNECT-QMGR                                     
056800     END-IF.                                                              
056900                                                                          
057000 1300-DISCONNECT-QMGR.                                                    
057100                                                                          
057200     CALL WS-MQDISC USING HCONN                                           
057300                          COMPLETION-CODE                                 
057400                          REASON                                          
057500     IF COMPLETION-CODE = MQCC-OK                                         
057600         DISPLAY 'MQDISC SUCCESSFUL'                                      
057700     ELSE                                                                 
057800         SET PS-ERROR-YES             TO TRUE                             
057900         MOVE 'MQDISC ERROR'          TO ERROR-MESSAGE                    
058000         PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
058100     END-IF.                                                              
058200                                                                          
058300 1400-CLOSE-QUE.                                                          
058400                                                                          
058500     CALL WS-MQCLOSE USING HCONN                                          
058600                          PQ-HANDLE-0                                     
058700                          MQCO-NONE                                       
058800                          COMPLETION-CODE                                 
058900                          REASON.                                         
059000                                                                          
059100     IF COMPLETION-CODE = MQCC-OK                                         
059200        DISPLAY PV-QNAME-0 ' MQCLOSE SUCCESSFUL'                          
059300     ELSE                                                                 
059400         SET PS-ERROR-YES             TO TRUE                             
059500         CALL WS-MQCHECK USING REASON                                     
059600                              PV-MQ-TEXT-REASON                           
059700         MOVE 'MQCLOSE ERROR Q0'  TO ERROR-MESSAGE                        
059800         PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
059900     END-IF.                                                              
060000                                                                          
060100     CALL WS-MQCLOSE USING HCONN                                          
060200                          PQ-HANDLE-1                                     
060300                          MQCO-NONE                                       
060400                          COMPLETION-CODE                                 
060500                          REASON.                                         
060600                                                                          
060700     IF COMPLETION-CODE = MQCC-OK                                         
060800        DISPLAY PV-QNAME-1 ' MQCLOSE SUCCESSFUL'                          
060900     ELSE                                                                 
061000         SET PS-ERROR-YES             TO TRUE                             
061100         CALL WS-MQCHECK USING REASON                                     
061200                              PV-MQ-TEXT-REASON                           
061300         MOVE 'MQCLOSE ERROR'  TO ERROR-MESSAGE                           
061400         PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
061500     END-IF.                                                              
061600                                                                          
061700     CALL WS-MQCLOSE USING HCONN                                          
061800                          PQ-HANDLE-2                                     
061900                          MQCO-NONE                                       
062000                          COMPLETION-CODE                                 
062100                          REASON.                                         
062200                                                                          
062300     IF COMPLETION-CODE = MQCC-OK                                         
062400        DISPLAY PV-QNAME-2 ' MQCLOSE SUCCESSFUL'                          
062500     ELSE                                                                 
062600         SET PS-ERROR-YES             TO TRUE                             
062700         CALL WS-MQCHECK USING REASON                                     
062800                              PV-MQ-TEXT-REASON                           
062900         MOVE 'MQCLOSE ERROR'  TO ERROR-MESSAGE                           
063000         PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
063100     END-IF.                                                              
063200                                                                          
063300     CALL WS-MQCLOSE USING HCONN                                          
063400                          PQ-HANDLE-3                                     
063500                          MQCO-NONE                                       
063600                          COMPLETION-CODE                                 
063700                          REASON.                                         
063800                                                                          
063900     IF COMPLETION-CODE = MQCC-OK                                         
064000        DISPLAY PV-QNAME-4 ' MQCLOSE SUCCESSFUL'                          
064100     ELSE                                                                 
064200         SET PS-ERROR-YES             TO TRUE                             
064300         CALL WS-MQCHECK USING REASON                                     
064400                              PV-MQ-TEXT-REASON                           
064500         MOVE 'MQCLOSE ERROR'  TO ERROR-MESSAGE                           
064600         PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
064700     END-IF.                                                              
064800                                                                          
064900     CALL WS-MQCLOSE USING HCONN                                          
065000                          PQ-HANDLE-4                                     
065100                          MQCO-NONE                                       
065200                          COMPLETION-CODE                                 
065300                          REASON.                                         
065400                                                                          
065500     IF COMPLETION-CODE = MQCC-OK                                         
065600        DISPLAY PV-QNAME-4 ' MQCLOSE SUCCESSFUL'                          
065700     ELSE                                                                 
065800         SET PS-ERROR-YES             TO TRUE                             
065900         CALL WS-MQCHECK USING REASON                                     
066000                              PV-MQ-TEXT-REASON                           
066100         MOVE 'MQCLOSE ERROR'  TO ERROR-MESSAGE                           
066200         PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
066300     END-IF.                                                              
066400                                                                          
066500*    CALL WS-MQCLOSE USING HCONN                                          
066600*                         PQ-HANDLE-5                                     
066700*                         MQCO-NONE                                       
066800*                         COMPLETION-CODE                                 
066900*                         REASON.                                         
067000*                                                                         
067100*    IF COMPLETION-CODE = MQCC-OK                                         
067200*       DISPLAY PV-QNAME-6 ' MQCLOSE SUCCESSFUL'                          
067300*    ELSE                                                                 
067400*        SET PS-ERROR-YES             TO TRUE                             
067500*        CALL WS-MQCHECK USING REASON                                     
067600*                             PV-MQ-TEXT-REASON                           
067700*        MOVE 'MQCLOSE ERROR'  TO ERROR-MESSAGE                           
067800*        PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
067900*    END-IF.                                                              
068000*                                                                         
068100*    CALL WS-MQCLOSE USING HCONN                                          
068200*                         PQ-HANDLE-6                                     
068300*                         MQCO-NONE                                       
068400*                         COMPLETION-CODE                                 
068500*                         REASON.                                         
068600*                                                                         
068700*    IF COMPLETION-CODE = MQCC-OK                                         
068800*       DISPLAY PV-QNAME-7 ' MQCLOSE SUCCESSFUL'                          
068900*    ELSE                                                                 
069000*        SET PS-ERROR-YES             TO TRUE                             
069100*        CALL WS-MQCHECK USING REASON                                     
069200*                             PV-MQ-TEXT-REASON                           
069300*        MOVE 'MQCLOSE ERROR'  TO ERROR-MESSAGE                           
069400*        PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
069500*    END-IF.                                                              
069600*                                                                         
069700*    CALL WS-MQCLOSE USING HCONN                                          
069800*                         PQ-HANDLE-7                                     
069900*                         MQCO-NONE                                       
070000*                         COMPLETION-CODE                                 
070100*                         REASON.                                         
070200*                                                                         
070300*    IF COMPLETION-CODE = MQCC-OK                                         
070400*       DISPLAY PV-QNAME-8 ' MQCLOSE SUCCESSFUL'                          
070500*    ELSE                                                                 
070600*        SET PS-ERROR-YES             TO TRUE                             
070700*        CALL WS-MQCHECK USING REASON                                     
070800*                             PV-MQ-TEXT-REASON                           
070900*        MOVE 'MQCLOSE ERROR'  TO ERROR-MESSAGE                           
071000*        PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
071100*    END-IF.                                                              
071200*                                                                         
071300*    CALL WS-MQCLOSE USING HCONN                                          
071400*                         PQ-HANDLE-8                                     
071500*                         MQCO-NONE                                       
071600*                         COMPLETION-CODE                                 
071700*                         REASON.                                         
071800*                                                                         
071900*    IF COMPLETION-CODE = MQCC-OK                                         
072000*       DISPLAY PV-QNAME-8 ' MQCLOSE SUCCESSFUL'                          
072100*    ELSE                                                                 
072200*        SET PS-ERROR-YES             TO TRUE                             
072300*        CALL WS-MQCHECK USING REASON                                     
072400*                             PV-MQ-TEXT-REASON                           
072500*        MOVE 'MQCLOSE ERROR'  TO ERROR-MESSAGE                           
072600*        PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
072700*    END-IF.                                                              
072800*                                                                         
072900*    CALL WS-MQCLOSE USING HCONN                                          
073000*                         PQ-HANDLE-9                                     
073100*                         MQCO-NONE                                       
073200*                         COMPLETION-CODE                                 
073300*                         REASON.                                         
073400*                                                                         
073500*    IF COMPLETION-CODE = MQCC-OK                                         
073600*       DISPLAY PV-QNAME-9  ' MQCLOSE SUCCESSFUL'                         
073700*    ELSE                                                                 
073800*        SET PS-ERROR-YES             TO TRUE                             
073900*        CALL WS-MQCHECK USING REASON                                     
074000*                             PV-MQ-TEXT-REASON                           
074100*        MOVE 'MQCLOSE ERROR'  TO ERROR-MESSAGE                           
074200*        PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
074300*    END-IF.                                                              
074400/                                                                         
074500 2000-PROCESS.                                                            
074600                                                                          
      *CHG0182536                                                               
           IF PS-CORRECT-MSG-TYPE-YES                                           
      *CHG0182536                                                               
074700      PERFORM 2100-IS-THIS-A-PACK                                         
074800      IF PS-PACK-YES                                                      
074900          PERFORM 6000-RECONSTRUCT-PACK                                   
075000          PERFORM 8200-PUT                                                
075100      ELSE                                                                
075200          INITIALIZE MSGBUFFER                                            
075300          PERFORM 2200-FIND-SEGMENT-LENGTH                                
075400          MOVE PV-LENGTH               TO PV-MSGLENGTH                    
075500          MOVE XL011-DATA              TO MSGBUFFER                       
075600          PERFORM 8200-PUT                                                
075700      END-IF                                                              
      *CHG0182536                                                               
           ELSE                                                                 
              ADD +1 TO PV-SKIP-MSG-COUNT                                       
           END-IF.                                                              
      *CHG0182536                                                               
075800                                                                          
075900     PERFORM 8000-READ-EXTRACT.                                           
076000                                                                          
076100                                                                          
076200 2100-IS-THIS-A-PACK.                                                     
076300*    PACK SEGMENTS HAVE TO BE RECONSTRUCTED INTO THEIR ORIGINAL           
076400*    STRING.  NON-PACKS ARE WRITTEN TO THE QUEUE ONE AT A TIME.           
076500     EVALUATE XL011-MSG-ID                                                
076600         WHEN 'ORD_PACK_ADD'                                              
076700         WHEN 'ORD_PACK_REPLACE'                                          
076800         WHEN 'ORD_PACK_COST_CHANGE'                                      
076900         WHEN 'ORD_PACK_RTL_CHANGE'                                       
077000             SET PS-PACK-YES          TO TRUE                             
077100         WHEN OTHER                                                       
077200             SET PS-PACK-NO           TO TRUE                             
077300         END-EVALUATE.                                                    
077400                                                                          
077500 2200-FIND-SEGMENT-LENGTH.                                                
077600                                                                          
077700     EVALUATE XL011-MSG-ID                                                
077800         WHEN 'HDR_ADD'                                                   
077900             MOVE LENGTH OF XL011-HDR-ADD          TO PV-LENGTH           
078000         WHEN 'HDR_CHANGE'                                                
078100             MOVE LENGTH OF XL011-HDR-CHANGE       TO PV-LENGTH           
078200         WHEN 'HDR_ATTR_CHANGE'                                           
078300             MOVE LENGTH OF XL011-HDR-ATTR-CHG     TO PV-LENGTH           
078400         WHEN 'HDR_IMPRT_CHANGE'                                          
078500             MOVE LENGTH OF XL011-IMPRT-CHG        TO PV-LENGTH           
078600         WHEN 'HDR_IMPRT_ATT_CHANGE'                                      
078700             MOVE LENGTH OF XL011-IMPRT-ATT-CHG    TO PV-LENGTH           
078800         WHEN 'HDR_STATUS_CHANGE'                                         
078900             MOVE LENGTH OF XL011-STATUS-CHG       TO PV-LENGTH           
079000         WHEN 'HDR_ORIG_CTRY_CHANGE'                                      
079100             MOVE LENGTH OF XL011-HDR-ORIG-CTY-CHG TO PV-LENGTH           
079200         WHEN 'HDR_DELETE'                                                
079300             MOVE ZERO                             TO PV-LENGTH           
079400         WHEN 'ORD_DISCOUNT_ADD'                                          
079500             MOVE LENGTH OF XL011-ORD-DISC-ADD     TO PV-LENGTH           
079600         WHEN 'ORD_DISCOUNT_CHANGE'                                       
079700             MOVE LENGTH OF XL011-ORD-DISC-CHG     TO PV-LENGTH           
079800         WHEN 'ORD_DISCOUNT_DELETE'                                       
079900             MOVE LENGTH OF XL011-ORD-DISC-DEL     TO PV-LENGTH           
080000         WHEN 'SPECIAL_INSTR_ADD'                                         
080100             MOVE LENGTH OF XL011-SPEC-INSTR-ADD   TO PV-LENGTH           
080200         WHEN 'SPECIAL_INSTR_DELETE'                                      
080300             MOVE LENGTH OF XL011-SPEC-INSTR-DEL   TO PV-LENGTH           
080400         WHEN 'ORD_SKU_ADD'                                               
080500             MOVE LENGTH OF XL011-SKU-ADD          TO PV-LENGTH           
080600         WHEN 'ORD_SKU_COST_CHANGE'                                       
080700             MOVE LENGTH OF XL011-SKU-COST-CHG     TO PV-LENGTH           
080800         WHEN 'ORD_SKU_ATTR_CHANGE'                                       
080900             MOVE LENGTH OF XL011-SKU-ATTR-CHG     TO PV-LENGTH           
081000         WHEN 'ORD_QTY_CHANGE'                                            
081100             MOVE LENGTH OF XL011-SKU-QTY-CHG      TO PV-LENGTH           
081200         WHEN 'ORD_SKU_DELETE'                                            
081300             MOVE LENGTH OF XL011-SKU-DEL          TO PV-LENGTH           
081400         WHEN 'ORD_LOCATION_ADD'                                          
081500             MOVE LENGTH OF XL011-LOCATION-ADD     TO PV-LENGTH           
081600         WHEN 'ORD_LOC_QTY_CHANGE'                                        
081700             MOVE LENGTH OF XL011-LOC-QTY-CHNG     TO PV-LENGTH           
081800         WHEN 'ORD_LOC_ATT_CHANGE'                                        
081900             MOVE LENGTH OF XL011-LOC-ATT-CHG      TO PV-LENGTH           
082000         WHEN 'ORD_LOCATION_DELETE'                                       
082100             MOVE LENGTH OF XL011-LOC-DEL          TO PV-LENGTH           
082200         WHEN 'STORE_ADD'                                                 
082300             MOVE LENGTH OF XL011-STORE-ADD        TO PV-LENGTH           
082400         WHEN 'STORE_QTY_CHANGE'                                          
082500             MOVE LENGTH OF XL011-STORE-QTY-CHG    TO PV-LENGTH           
082600         WHEN 'STORE_ATTR_CHANGE'                                         
082700             MOVE LENGTH OF XL011-STORE-ATTR-CHG   TO PV-LENGTH           
082800         WHEN 'STORE_DELETE'                                              
082900             MOVE LENGTH OF XL011-STORE-DEL        TO PV-LENGTH           
083000         WHEN 'ORD_PACK_HDR_CHANGE'                                       
083100             MOVE LENGTH OF XL011-PK-HDR-CHG       TO PV-LENGTH           
083200         WHEN 'PACK_COMP_ADD'                                             
083300             MOVE LENGTH OF XL011-PACK-COMP-ADD    TO PV-LENGTH           
083400         WHEN 'PACK_COMP_CHANGE'                                          
083500             MOVE LENGTH OF XL011-PK-COMP-CHG      TO PV-LENGTH           
083600         WHEN 'ORD_PACK_LOC_RTL'                                          
083700             MOVE ZERO                             TO PV-LENGTH           
083800         WHEN OTHER                                                       
083900             MOVE ZERO                             TO PV-LENGTH           
084000     END-EVALUATE.                                                        
084100     ADD 28                           TO PV-LENGTH.                       
084200/                                                                         
084300 3600-MQ-COMMIT.                                                          
084400                                                                          
084500     CALL WS-MQCMIT USING HCONN                                           
084600                          COMPLETION-CODE                                 
084700                          REASON.                                         
084800                                                                          
084900     IF COMPLETION-CODE = MQCC-OK                                         
085000         CONTINUE                                                         
085100     ELSE                                                                 
085200         CALL WS-MQCHECK USING REASON                                     
085300                               MQ-REASON-TEXT                             
085400        MOVE '3600-COMMIT-MQ'   TO PV-PARAGRAPH                           
085500        MOVE 'MQCMIT ERROR'     TO ERROR-MESSAGE                          
085600        MOVE COMPLETION-CODE    TO HOLD-COMPLETION-CODE                   
085700        MOVE REASON             TO HOLD-REASON                            
085800        PERFORM 3700-BACK-OUT-MQ                                          
085900        MOVE HOLD-COMPLETION-CODE TO COMPLETION-CODE                      
086000                                        PE-MQ-COMPLETION-CODE             
086100        MOVE HOLD-REASON          TO REASON                               
086200                                        PE-MQ-REASON-CODE                 
086300        PERFORM 9200-MQ-ABEND                                             
086400     END-IF.                                                              
086500                                                                          
086600 3700-BACK-OUT-MQ.                                                        
086700                                                                          
086800     CALL WS-MQBACK USING HCONN                                           
086900                          COMPLETION-CODE                                 
087000                          REASON.                                         
087100                                                                          
087200     IF (COMPLETION-CODE NOT = MQCC-OK) THEN                              
087300         CALL WS-MQCHECK USING REASON                                     
087400                            MQ-REASON-TEXT                                
087500        MOVE '3700-BACK-OUT-MQ'  TO PV-PARAGRAPH                          
087600        MOVE 'MQBACK ERROR'      TO ERROR-MESSAGE                         
087700        PERFORM 9200-MQ-ABEND                                             
087800     END-IF.                                                              
087900/                                                                         
088000 6000-RECONSTRUCT-PACK.                                                   
088100                                                                          
088200     MOVE 1                           TO PV-START                         
088300     INITIALIZE MSGBUFFER                                                 
088400                PV-MSGLENGTH                                              
088500                                                                          
088600     PERFORM UNTIL XL011-MSG-ID = 'END OF PACK MESSAGE'                   
088700                             OR PS-END-OF-EXTRACT-YES                     
088800         PERFORM 2200-FIND-SEGMENT-LENGTH                                 
088900                                                                          
089000         MOVE XL011-DATA              TO MSGBUFFER                        
089100                                      (PV-START:PV-LENGTH)                
089200                                                                          
089300         ADD PV-LENGTH                TO PV-MSGLENGTH                     
089400                                         PV-START                         
089500         PERFORM 8000-READ-EXTRACT                                        
089600                                                                          
089700     END-PERFORM.                                                         
089800                                                                          
089900 8000-READ-EXTRACT.                                                       
090000                                                                          
090100     READ EXTRACT-FILE                                                    
090200         INTO XL011-DATA                                                  
090300     AT END                                                               
090400         SET PS-END-OF-EXTRACT-YES    TO TRUE                             
090500     NOT AT END                                                           
090600         SET PS-END-OF-EXTRACT-NO     TO TRUE                             
090700         ADD 1                        TO PV-READ-COUNT                    
090800     END-READ.                                                            
      *CHG0182536                                                               
           PERFORM 8100-VALIDATE-MESSAGE-TYPE.                                  
                                                                                
       8100-VALIDATE-MESSAGE-TYPE.                                              
                                                                                
           SET PS-CORRECT-MSG-TYPE-NO TO TRUE                                   
                                                                                
077700     EVALUATE XL011-MSG-ID                                                
077800         WHEN 'HDR_ADD'                                                   
077900             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
078000         WHEN 'HDR_CHANGE'                                                
078100             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
078200         WHEN 'HDR_ATTR_CHANGE'                                           
078300             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
078400         WHEN 'HDR_IMPRT_CHANGE'                                          
078500             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
078600         WHEN 'HDR_IMPRT_ATT_CHANGE'                                      
078700             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
078800         WHEN 'HDR_STATUS_CHANGE'                                         
078900             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
079000         WHEN 'HDR_ORIG_CTRY_CHANGE'                                      
079100             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
079200         WHEN 'HDR_DELETE'                                                
079300             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
079400         WHEN 'ORD_DISCOUNT_ADD'                                          
079500             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
079600         WHEN 'ORD_DISCOUNT_CHANGE'                                       
079700             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
079800         WHEN 'ORD_DISCOUNT_DELETE'                                       
079900             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
080000         WHEN 'SPECIAL_INSTR_ADD'                                         
080100             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
080200         WHEN 'SPECIAL_INSTR_DELETE'                                      
080300             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
080400         WHEN 'ORD_SKU_ADD'                                               
080500             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
080600         WHEN 'ORD_SKU_COST_CHANGE'                                       
080700             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
080800         WHEN 'ORD_SKU_ATTR_CHANGE'                                       
080900             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
081000         WHEN 'ORD_QTY_CHANGE'                                            
081100             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
081200         WHEN 'ORD_SKU_DELETE'                                            
081300             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
081400         WHEN 'ORD_LOCATION_ADD'                                          
081500             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
081600         WHEN 'ORD_LOC_QTY_CHANGE'                                        
081700             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
081800         WHEN 'ORD_LOC_ATT_CHANGE'                                        
081900             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
082000         WHEN 'ORD_LOCATION_DELETE'                                       
082100             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
082200         WHEN 'STORE_ADD'                                                 
082300             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
082400         WHEN 'STORE_QTY_CHANGE'                                          
082500             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
082600         WHEN 'STORE_ATTR_CHANGE'                                         
082700             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
082800         WHEN 'STORE_DELETE'                                              
082900             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
083000         WHEN 'ORD_PACK_HDR_CHANGE'                                       
083100             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
083200         WHEN 'PACK_COMP_ADD'                                             
083300             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
083400         WHEN 'PACK_COMP_CHANGE'                                          
083500             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
083600         WHEN 'ORD_PACK_LOC_RTL'                                          
083700             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
076600         WHEN 'ORD_PACK_ADD'                                              
083700             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
076700         WHEN 'ORD_PACK_REPLACE'                                          
083700             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
076800         WHEN 'ORD_PACK_COST_CHANGE'                                      
083700             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
076900         WHEN 'ORD_PACK_RTL_CHANGE'                                       
083700             SET PS-CORRECT-MSG-TYPE-YES TO TRUE                          
083800         WHEN OTHER                                                       
083900             SET PS-CORRECT-MSG-TYPE-NO TO TRUE                           
                   SET        PS-BAD-RET-CODE TO TRUE                           
                   DISPLAY 'INCORRECT MESSAGE FORMAT :' XL011-DATA              
084000     END-EVALUATE.                                                        
      *CHG0182536                                                               
                                                                                
090900/                                                                         
091000 8200-PUT.                                                                
091100                                                                          
091200     MOVE MQMI-NONE                   TO MQMD-MSGID                       
091300                                                                          
091400     IF PARM-LENGTH = ZERO                                                
091500         MOVE MQCI-NONE               TO MQMD-CORRELID                    
091600     ELSE                                                                 
091700         MOVE PARM-USERID             TO MQMD-CORRELID                    
091800     END-IF                                                               
091900                                                                          
092000     MOVE 'USERIDENTFIR'              TO MQMD-USERIDENTIFIER              
092100     MOVE 'PUTAPPLNAME'               TO MQMD-PUTAPPLNAME                 
092200     MOVE 'APPLIDENTITYDATA'          TO MQMD-APPLIDENTITYDATA            
092300                                                                          
092400     MOVE '5'                         TO MQMD-PRIORITY                    
092500     MOVE MQFMT-STRING                TO MQMD-FORMAT                      
092600     MOVE MQPER-PERSISTENT            TO MQMD-PERSISTENCE                 
092700     COMPUTE MQPMO-OPTIONS  = MQPMO-SYNCPOINT +                           
092800                              MQPMO-SET-IDENTITY-CONTEXT                  
092900                                                                          
093000     MOVE XL011-ORDER-NBR    TO PV-PO-NBR-N                               
093100     MOVE PV-PO-NBR-X (7:1)  TO PV-DIGIT-X                                
093200*    MOVE PV-DIGIT-N         TO PV-QUE-NBR                                
093300                                                                          
093400     EVALUATE PV-DIGIT-N                                                  
093500     WHEN 0                                                               
093600     WHEN 1                                                               
093700         CALL WS-MQPUT USING HCONN                                        
093800                             PQ-HANDLE-0                                  
093900                             MQMD                                         
094000                             MQPMO                                        
094100                             PV-MSGLENGTH                                 
094200                             MSGBUFFER                                    
094300                             COMPLETION-CODE                              
094400                             REASON                                       
094500         ADD 1               TO PV-PUT-0-COUNT                            
094600     WHEN 2                                                               
094700     WHEN 3                                                               
094800         CALL WS-MQPUT USING HCONN                                        
094900                             PQ-HANDLE-1                                  
095000                             MQMD                                         
095100                             MQPMO                                        
095200                             PV-MSGLENGTH                                 
095300                             MSGBUFFER                                    
095400                             COMPLETION-CODE                              
095500                             REASON                                       
095600         ADD 1               TO PV-PUT-2-COUNT                            
095700     WHEN 4                                                               
095800     WHEN 5                                                               
095900         CALL WS-MQPUT USING HCONN                                        
096000                             PQ-HANDLE-2                                  
096100                             MQMD                                         
096200                             MQPMO                                        
096300                             PV-MSGLENGTH                                 
096400                             MSGBUFFER                                    
096500                             COMPLETION-CODE                              
096600                             REASON                                       
096700         ADD 1               TO PV-PUT-4-COUNT                            
096800     WHEN 6                                                               
096900     WHEN 7                                                               
097000         CALL WS-MQPUT USING HCONN                                        
097100                             PQ-HANDLE-3                                  
097200                             MQMD                                         
097300                             MQPMO                                        
097400                             PV-MSGLENGTH                                 
097500                             MSGBUFFER                                    
097600                             COMPLETION-CODE                              
097700                             REASON                                       
097800         ADD 1               TO PV-PUT-6-COUNT                            
097900     WHEN 8                                                               
098000     WHEN 9                                                               
098100         CALL WS-MQPUT USING HCONN                                        
098200                             PQ-HANDLE-4                                  
098300                             MQMD                                         
098400                             MQPMO                                        
098500                             PV-MSGLENGTH                                 
098600                             MSGBUFFER                                    
098700                             COMPLETION-CODE                              
098800                             REASON                                       
098900         ADD 1               TO PV-PUT-8-COUNT                            
099000     END-EVALUATE                                                         
099100                                                                          
099200     IF COMPLETION-CODE = MQCC-OK                                         
099300        ADD 1                         TO PV-COMMIT                        
099400                                         PV-TOTAL-PUT-COUNT               
099500            IF PV-COMMIT > 100                                            
099600                PERFORM 3600-MQ-COMMIT                                    
099700                MOVE ZERO             TO PV-COMMIT                        
099800            END-IF                                                        
099900     ELSE                                                                 
100000         SET PS-ERROR-YES             TO TRUE                             
100100         CALL WS-MQCHECK USING REASON                                     
100200                               PV-MQ-TEXT-REASON                          
100300         MOVE 'MQPUT ERROR'           TO ERROR-MESSAGE                    
100400         PERFORM 9100-DISPLAY-ERROR-MESSAGE                               
100500     END-IF.                                                              
100600/                                                                         
100700 9100-DISPLAY-ERROR-MESSAGE.                                              
100800*                                                                         
100900     DISPLAY '**** ABEND *************************************'.          
101000     DISPLAY '* ', 'XLKUT301'                                             
101100     DISPLAY '* ', ERROR-MESSAGE.                                         
101200     DISPLAY '* COMPLETION CODE : ', COMPLETION-CODE.                     
101300     DISPLAY '* REASON CODE     : ', REASON.                              
101400     DISPLAY '* TEXT REASON     : ', PV-MQ-TEXT-REASON.                   
101500     DISPLAY '************************************************'.          
101600*    MOVE +4020 TO PV-ABEND-CODE.                                         
101700*    CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
101800*                                                                         
101900****************************************************************          
102000** PERFORM MQ-SERIES ABEND PROCESSING                                     
102100****************************************************************          
102200 9200-MQ-ABEND.                                                           
102300                                                                          
102400*    DISPLAY '**** ABEND *************************************'.          
102500*    DISPLAY '** MQSERIES ERROR **'.                                      
102600*    DISPLAY '** PROGRAM:    ', 'XLKUT301'.                               
102700*    DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                            
102800*    DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH.                             
102900*    DISPLAY '** MESSAGE:    ', ERROR-MESSAGE.                            
103000*    DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.                    
103100*    DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                        
103200*    DISPLAY '** RSN TEXT:   ', MQ-REASON-TEXT.                           
103300*                                                                         
103400                                                                          
103500     MOVE +4013 TO PV-ABEND-CODE.                                         
103600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
103700/                                                                         
103800 9999-END.                                                                
103900                                                                          
104000     PERFORM 3600-MQ-COMMIT                                               
104100                                                                          
104200     DISPLAY SPACES                                                       
104300     MOVE PV-READ-COUNT               TO PV-DISP-NUM                      
104400     DISPLAY ' EXTRACTS READ     = ' PV-DISP-NUM                          
104500                                                                          
104600     MOVE PV-TOTAL-PUT-COUNT         TO PV-DISP-NUM                       
104700     DISPLAY ' QUE RECS WRITTEN  = ' PV-DISP-NUM                          
104800                                                                          
104900     MOVE PV-PUT-0-COUNT             TO PV-DISP-NUM                       
105000     DISPLAY ' QUE 0 RECS        = ' PV-DISP-NUM                          
105100                                                                          
105200     MOVE PV-PUT-2-COUNT             TO PV-DISP-NUM                       
105300     DISPLAY ' QUE 2 RECS        = ' PV-DISP-NUM                          
105400                                                                          
105500     MOVE PV-PUT-4-COUNT             TO PV-DISP-NUM                       
105600     DISPLAY ' QUE 4 RECS        = ' PV-DISP-NUM                          
105700                                                                          
105800     MOVE PV-PUT-6-COUNT             TO PV-DISP-NUM                       
105900     DISPLAY ' QUE 6 RECS        = ' PV-DISP-NUM                          
106000                                                                          
106100     MOVE PV-PUT-8-COUNT             TO PV-DISP-NUM                       
106200     DISPLAY ' QUE 8 RECS        = ' PV-DISP-NUM.                         
106300                                                                          
      *CHG0182536                                                               
106100     MOVE PV-SKIP-MSG-COUNT          TO PV-DISP-NUM                       
106200     DISPLAY ' SKIPPED MSG COUNT = ' PV-DISP-NUM.                         
      *CHG0182536                                                               
106300                                                                          
106400*    MOVE PV-PUT-8-COUNT             TO PV-DISP-NUM                       
106500*    DISPLAY ' QUE 8 RECS       = ' PV-DISP-NUM                           
106600*                                                                         
106700*    MOVE PV-PUT-6-COUNT             TO PV-DISP-NUM                       
106800*    DISPLAY ' QUE 6 RECS       = ' PV-DISP-NUM                           
106900*                                                                         
107000*    MOVE PV-PUT-7-COUNT             TO PV-DISP-NUM                       
107100*    DISPLAY ' QUE 7 RECS       = ' PV-DISP-NUM                           
107200*                                                                         
107300*    MOVE PV-PUT-8-COUNT             TO PV-DISP-NUM                       
107400*    DISPLAY ' QUE 8 RECS       = ' PV-DISP-NUM                           
107500*                                                                         
107600*    MOVE PV-PUT-9-COUNT            TO PV-DISP-NUM                        
107700*    DISPLAY ' QUE 9 RECS       = ' PV-DISP-NUM                           
107800                                                                          
107900     DISPLAY SPACES                                                       
108000                                                                          
108100     PERFORM 1400-CLOSE-QUE.                                              
108200                                                                          
108300     PERFORM 1300-DISCONNECT-QMGR                                         
108400                                                                          
108500     CLOSE  EXTRACT-FILE                                                  
108600            QMGR-FILE                                                     
108700            QNAME-FILE-0                                                  
108800            QNAME-FILE-1                                                  
108900                                                                          
109000            QNAME-FILE-2                                                  
109100            QNAME-FILE-3                                                  
109200            QNAME-FILE-4.                                                 
109300                                                                          
109400*           QNAME-FILE-5                                                  
109500*           QNAME-FILE-6                                                  
109600*           QNAME-FILE-7                                                  
109700*           QNAME-FILE-8                                                  
109800*           QNAME-FILE-9.                                                 
