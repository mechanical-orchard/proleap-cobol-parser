000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    APKUP253.                                         00040000
000500 AUTHOR.        SUSAN OLSON - OMNI.                               00050000
000600 DATE-WRITTEN.  JULY, 1994.                                       00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*                                                               * 00090000
001000*    COBOL II WITH SQL                                          * 00100000
001100*                                                               * 00110000
001200*  COMPILE OPEN TO PAY TRANSACTIONS                             * 00120000
001300*                                                               * 00130000
001400* DB2 TABLES:                                                   * 00140000
001500*  1. AP CONTROL TABLE                 (TAPCNTL)                * 00150000
001600*  2. INVOICE TABLE                    (TINVOIC)                * 00160000
001700*  3. MERCHANDISE INVOICE TABLE        (TMDINVC)                * 00170000
001800*  4. MERCHANDISE INVOICE ITEM         (TMIITEM)                * 00180000
001900*  5. PURCHASE ORDER AGREEMENT TABLE   (TPOAGMT)                * 00190000
002000*  6. PAYMENT TERMS TABLE              (TPAYTRM)                * 00200000
002100*  7. INVOICE TERMS TABLE              (TINVCTM)                * 00210000
002200*  8. PURCHASE ORDER HEADER            (TPURCHS)                * 00220000
002300*  9. VENDOR/DEPARTMENT TABLE          (TVNDDPT)                * 00230000
002400* 10. INVOICE CHARGES/ALLOWANCES TABLE (TALCHRG)                * 00240000
002500* 11. EXTERNAL ENTERPRISE NAME         (TENTNME)                * 00250000
002600* 12. EXTERNAL ENTERPRISE              (TEXTENT)                * 00260000
002700* 13. AP-RELEASED PO/STORES            (TPOSTRR)                * 00270000
002800* 14. AP-PRICE CLAIM ADJUSTMENTS       (TPRCCLM)                * 00280000
002900* 15. PURCHASE ITEM                    (TPURITM)                * 00290000
003000* 16. PAYMENT REQUEST ITEM             (TPREQIT)                * 00300000
003100* 17. VENDOR SPECIFICATIONS            (TAPVNDS)                * 00310000
003200* 18. TRANSACTION CODE TABLE           (TTRNCDE)                * 00320000
003300* 19. FS UPC:SKU XREF                  (TUPCSKU)                * 00330000
003400* 20. CHECKPOINT RESTART CONTROL TABLE (TCKRSTCNTL)             * 00340000
003500* 21. CHECKPOINT RESTART INFO TABLE    (TCKRSTINF)              * 00350000
003510* 22. MERCHANDISE AREA                 (TMDSEAR)                * 00351000
003520* 22. VENDOR AGREEMENT                 (TVNDAGR)                * 00352000
003530* 22. VNDR CAPABILITIES (VNT_VND_CBPL) (VNT00001)               * 00353000
003540*                                                               * 00354000
003550* OUTPUT:                                                       * 00355000
003560*  1. PEOPLESOFT TRANSACTION TABLE     (TOUTAPE) (APRD040)      * 00356000
003570*  2. RECONCILIATION RESULTS TABLE     (TOUTAP2) (APRD263)      * 00357000
003580*  3. OPEN TO PAY UPDATE TABLE         (TOUTAPI) (APRD252)      * 00358000
003590*  4. PO STORE INVOICE TABLE           (TOUTAPJ) (APRD058)      * 00359000
003600*  5. AP DISCREPANCY REPORT TABLE      (TAPDSRP) (APWSA12)      * 00360000
003700*                                                               * 00370000
003800*---------------------------------------------------------------* 00380000
003900*---------------------------------------------------------------* 00390000
004000*                                                               * 00400000
004100*    THIS PROGRAM COMPILES ALL THE INFORMATION NECESSARY TO     * 00410000
004200*    RELEASE AN INVOICE AND RELATED ADJUSTMENTS FOR PAYMENT     * 00420000
004300*    AND LOAD TO THE PAYMENT HISTORY DATABASE.  THE PURCHASE    * 00430000
004400*    ORDER WILL BE USED TO LOCATE THE INVOICES RELEASED FOR     * 00440000
004500*    PAYMENT.  THERE WILL BE FOUR SOURCES FOR THE ADJUSTMENTS   * 00450000
004600*    RESULTING FROM RECONCILIATION:                             * 00460000
004700*                                                               * 00470000
004800*    1.  THE DEBIT MEMOS WILL BE GENERATED FROM REMAINDER       * 00480000
004900*        INVOICES.                                              * 00490000
005000*    2.  THE PRICE CLAIM CREDIT ADJUSTMENTS ARE PASSED DIRECTLY * 00500000
005100*        FROM THE RECONCILIATION PROCESS BY PURCHASE ORDER LINE.* 00510000
005200*    3.  THE PRICE CLAIM DEBIT ADJUSTMENTS ARE PASSED DIRECTLY  * 00520000
005300*        FROM THE RECONCILIATION PROCESS BY PURCHASE ORDER LINE.* 00530000
005400*    4.  MISCELLANEOUS CHARGES WILL BE GENERATED AS ADJUSTMENTS * 00540000
005500*        TO THE INVOICE.  THESE ARE LOCATED ON THE ALLOWANCE/   * 00550000
005600*        CHAGE TABLE AND A SEPARATE ADJUSTMENT WILL BE SET UP   * 00560000
005700*        FOR EACH CHARGE FOUND.                                 * 00570000
005800*                                                               * 00580000
005900*    RECONCILIATION REPORT ENTRIES WILL BE GENERATED FOR ALL    * 00590000
006000*    RECEIVERS, INVOICES, AND ADJUSTMENTS RELATED TO A          * 00600000
006100*    PURCHASE ORDER BY STORE, WHICH HAVE BEEN PASSED FROM THE   * 00610000
006200*    RECONCILIATION PROCESS.  FREIGHT AND DNP ADJUSTMENTS ARE   * 00620000
006300*    EXCLUDED.  THE REPORT FILE WILL BE READ DURING NIGHTLY     * 00630000
006400*    BATCH PROCESS TO PRODUCE THE RECONCILIATION RESULTS REPORT.* 00640000
006500*                                                               * 00650000
006600*    A KEYED BARCODE RECORD WILL ALSO BE GENERATED.  THIS FILE  * 00660000
006700*    WILL BE USED AS INPUT TO THE DOCUTRAC PROCESSING.  THE     * 00670000
006800*    INVOICES RELEASED FOR PAYMENT WILL BE SCANNED AND LOADED   * 00680000
006900*    INTO DOCUTRAC.  THE KEYED BARCODE RECORD WILL BE USED FOR  * 00690000
007000*    VERIFYING THAT ALL INVOICES RELEASED FOR PAYMENT HAVE      * 00700000
007100*    BEEN SCANNED AND AVAILABLE FOR REFERENCE.                  * 00710000
007200*                                                               * 00720000
007300*    A BATCH CONTROL FILE WILL BE GENERATED FOR EACH INVOICE AND* 00730000
007400*    ADJUSTMENT SET UP ON THE PAYMENT HISTORY.  THIS FILE WILL  * 00740000
007500*    BE USED AS INPUT TO THE BATCH CONTROL REPORT.  THIS        * 00750000
007600*    INFORMATION WILL BE COMPARED TO THE PURCHASE JOURNAL       * 00760000
007700*    CONTROL REPORT FOR DAILY BALANCING.                        * 00770000
007800*                                                               * 00780000
007900*    THE OPEN TO PAY UPDATE FILE WILL BE GENERATED FOR EACH     * 00790000
008000*    INVOICE THAT IS RELEASED FOR PAYMENT.  AFTER ALL OPEN TO   * 00800000
008100*    PAY PROCESSING IS COMPLETE, THIS FILE WILL BE USED TO      * 00810000
008200*    UPDATE THE INVOICE TABLE.  THIS FILE WILL ALSO CONTAIN THE * 00820000
008300*    PURCHASE ORDER NUMBER, WHICH WILL POINT TO ALL NON-INVOICED* 00830000
008400*    RECEIPTS THAT WERE CREATED FROM TODAY'S RECONCILIATION     * 00840000
008500*    WHICH SHOULD ALSO BE JOURNALIZED.                          * 00850000
008600*---------------------------------------------------------------* 00860000
008700***************************************************************** 00870000
008800*   CHANGES:                                                    * 00880000
008900*                                                               * 00890000
009000*   THE CHANGE LOG ENTRIES FROM 10/25/94 TO 8/25/97             * 00900000
009100*   HAVE BEEN REMOVED, BECAUSE THE MODIFICATIONS FOR            * 00910000
009200*   THE PEOPLESOFT INSTALLATION WERE SO ENCOMPASSING THAT       * 00920000
009300*   THE PRIOR CHANGES WERE NO LONGER MEANINGFUL.  THE FEW       * 00930000
009400*   ENTRIES THAT WERE RETAINED ARE SITLL APPLICABLE TO THE      * 00940000
009500*   REMAINING LOGIC.                                            * 00950000
009600*                                                               * 00960000
009700*   12/18/97  MIKE BESKE                         WR#4164        * 00970000
009800*             ADDED CODE TO COMPLETELY REVERSE THE MISC AMT     * 00980000
009900*             AND DISC AMT FOR IMPORT POS.  PARA P200- WAS      * 00990000
010000*             MODIFIED FOR THE 'WHEN IMPORT-PO' CLAUSE TO       * 01000000
010100*             CALCULATE THE PH1-AMTDUE AND PH1-AMTPAID IN       * 01010000
010200*             FOLLOWING MANNER:                                 * 01020000
010300*              INVOIC-GRO-COST-AMT + APPD052-FREIGHT-CHARGES    * 01030000
010400*              +  APPD052-MISC-CHARGES  -  PV-CALC-DISC-AMT.    * 01040000
010500*             A CHECK FOR PH1-TRANCDE = '74' WAS ADDED IN       * 01050000
010600*             P200- ALSO.  THIS CODE WILL TAKE CARE OF THE      * 01060000
010700*             DISC PCT AND MISC AMT REVERSALS.                  * 01070000
010800*                                                               * 01080000
010900*   01/05/98  MIKE BESKE                         IR#145097      * 01090000
011000*             WRITE OFF INVOICES FOR IMPORT POS WERE BEING      * 01100000
011100*             HANDLED AS IMPORTS AND CREATING 74 TRANS IN-      * 01110000
011200*             STEAD OF AS WRITE OFFS AND CREATING 87 TRANS.     * 01120000
011300*             LOGIC FOR CREATING WRITE OFF ENTRIES WAS          * 01130000
011400*             CHANGED TO SUPERCEDE LOGIC CREATING IMPORT        * 01140000
011500*             ENTRIES.  THE FOLLOWING PARAS WERE MODIFIED       * 01150000
011600*             TO DO THIS: D400-, P100- AND P200-.               * 01160000
011700*                                                               * 01170000
011800*   05/05/98  ROBIN BERNOSKI                     IR#4164        * 01180000
011900*             MODIFIED TO POPULATE THE TWO NEW FIELDS IN        * 01190000
012000*             APRD252 WHEN WRITING THESE RECORDS.  THIS         * 01200000
012100*             CHANGE WILL GUARANTEE THAT ALL MI'S THAT ARE      * 01210000
012200*             PROCESSED THROUGH THIS PROGRAM NOT ONLY HAVE      * 01220000
012300*             THEIR STATUS SET TO EITHER 'OP' OR 'PD', BUT      * 01230000
012400*             WILL ALSO HAVE THE PA-PRC-CDE SET TO              * 01240000
012500*             'JOURNALIZED'.                                    * 01250000
012600*             LOGIC WAS ADDED TO MOVE A VALUE OF 'J' INTO       * 01260000
012700*             THE AP252-AP-PRC-CDE AND THE APCNTL-BTCH-PRC-     * 01270000
012800*             DTE INTO AP252-AP-PRC-DTE FOR EVERY RECORD        * 01280000
012900*             PROCESSED.                                        * 01290000
013000*                                                               * 01300000
013100*   01/11/99  MIKE BESKE                         WR#5998        * 01310000
013200*             PEOPLESOFT CONVERSION.  REMOVED ALL IMS CODE.     * 01320000
013300*             ADDED THE PEOPLESOFT AP MEMO TABLE TO REPLACE     * 01330000
013400*             THE PAYMENT HISTORY IMS DATABASE.  REMOVED ALL    * 01340000
013500*             JULIAN DATE PROCESSING AND REFERENCES.  ADDED     * 01350000
013600*             CHECKPOINT RESTART LOGIC.  ADDED A CALL TO THE    * 01360000
013700*             PROGRAM DPKUP151 TO GET THE NEXT AVAILABLE DOC    * 01370000
013800*             NUMBER FROM THE TAPCNTL TABLE IN PLACE OF THE     * 01380000
013900*             MEMO NUMBER IMS DATABASE.  REPLACED THE APTRAN    * 01390000
014000*             COPYBOOK WITH APRD040 FOR CREATING THE BATCH      * 01400000
014100*             CONTROL RECORDS.  REPLACED ALL FOUR OF THE        * 01410000
014200*             OUTPUT FLAT FILES WITH FOUR DB2 OUTPUT TABLES.    * 01420000
014300*                                                               * 01430000
014400*   05/14/99  MARK BURNSIDE                WR/IR #:   5998      * 01440000
014500*             MODIFIED INTERNAL TABLE SO IF A DUE DATE          * 01450000
014600*             IS CALCULATED TO BE A FRIDAY THE PROGRAM          * 01460000
014700*             WILL NOW SUBTRACT TWO DAYS TO LOOK FOR THE        * 01470000
014800*             PREVIOUS CHECK DATE INSTEAD OF                    * 01480000
014900*             AUTOMATICALLY LOOKING FOR A FUTURE CHECK          * 01490000
015000*             DATE.                                             * 01500000
015100*                                                               * 01510000
015200*   08/13/99  MIKE BESKE                   WR/IR #:   5998      * 01520000
015300*             REINSTATED THE USE OF PV-INVAMT TO BE USED FOR    * 01530000
015400*             THE AP263-EXTD-COST FIELD.  THIS IS USED WHEN     * 01540000
015500*             INVOICE PRICE CLAIM ADJUSTMENTS ARE CREATED.      * 01550000
015600*             PARA M200-.                                       * 01560000
015700*                                                               * 01570000
015800*   08/17/99  MIKE BESKE                   WR/IR #:   5998      * 01580000
015900*             REINSTATED THE USE OF PV-HOLD-DUE-DATE-CCYYMMDD   * 01590000
016000*             FOR MOVING THE CALC_DUE_DTE TO THE AP040-PYMT-    * 01600000
016100*             DUE-DTE.  THIS INSURES THAT THE DATE IS IN THE    * 01610000
016200*             CORRECT FORMAT FOR THE COPYBOOK (CCYY-MM-DD)      * 01620000
016300*             AND FURTHER PROCESSING IN THE BATCH RUN.          * 01630000
016400*             PARAS P700, P750-.                                * 01640000
016500*                                                               * 01650000
016600*   08/23/99  MIKE BESKE                   WR/IR #:   5998      * 01660000
016700*             MODIFIED THE RI_NULL_CSR TO NOT JOIN THE          * 01670000
016800*             TPURITM TABLE.  THIS IS BECAUSE THERE WILL NOT    * 01680000
016900*             BE A MATCHING ROW ON THIS TABLE IF THE PO LINE    * 01690000
017000*             NUMBER IS NULL.  ALSO STOPPED MOVING THE          * 01700000
017100*             PURITM-UNT-CST-AMT TO AP263-REC-COST FIELD.       * 01710000
017200*             PARAS P450- P460-.                                * 01720000
017300*             A MODIFICATION WAS MADE TO THE SUFFIX THAT WAS    * 01730000
017400*             BEING ADDED TO 48 TRANS BEING CREATED FOR         * 01740000
017500*             SHORTAGES AND REMAINDER INVOICES.  A '*' WILL     * 01750000
017600*             NOW BE ADDED AT THE END OF THE TRD OR NSD SUF-    * 01760000
017700*             FIXES.  THIS WILL AVOID THE 'DUPLICATE' DOC       * 01770000
017800*             NUMBERS FROM BEING CREATED.                       * 01780000
017900*             PARAS Q100-.                                      * 01790000
018000*                                                               * 01800000
018100*   08/25/99  MIKE BESKE                   WR/IR #:   5998      * 01810000
018200*             MODIFIED CODE TO USE THE NEW DATE RETURNED        * 01820000
018300*             FROM THE APPD051 COPYBOOK ROUTINE.  THE DATE      * 01830000
018400*             RETURNED WILL BE IN THE FOLLOWING FORMAT          * 01840000
018500*             CCYY-MM-DD INSTEAD OF MMDDYY.  THIS IS A Y2K      * 01850000
018600*             RELATED CHANGE.  REMOVED A W/S DATE THAT WAS      * 01860000
018700*             NOT BEING REFERENCED IN THE PROCEDURE AREA.       * 01870000
018800*             PARA D350-.                                       * 01880000
018900*                                                               * 01890000
019000*   09/13/99  MIKE BESKE                   WR/IR #:   5998      * 01900000
019100*             CORRECTED THE CODE TO COMPUTE THE PSA12-          * 01910000
019200*             KC-TOT-COST-AMT WITH THE CORRESPONDING UNIT       * 01920000
019300*             COST AMOUNT AND QUANTITY DEPENDING ON THE PARA    * 01930000
019400*             BEING PERFORMED (P450-,P460-).  MOVED THE PV-     * 01940000
019500*             PRCCLM-COST TO PSA12-KC-TOT-COST-AMT IN P400-.    * 01950000
019600*             USED PV-TRANCDE TO CREATE THE PSA12-ORIGIN        * 01960000
019700*             P460-).  ADDED A PERFORM OF E300- IN C200-.       * 01970000
019800*             THIS WILL ENSURE THAT THE RI INVOICE ID IS        * 01980000
019900*             USED WHEN THE PSA12- AND AP040- RECORDS ARE       * 01990000
020000*             CREATED.                                          * 02000000
020100*                                                               * 02010000
020200*   09/21/99  MIKE BESKE                   WR/IR #:   5998      * 02020000
020300*             CORRECTED THE CODE TO CORRECTLY SIGN THE PSA12    * 02030000
020400*             KC-TOT-COST-AMT AS NEGATIVE WHEN THE TRANCODE     * 02040000
020500*             IS A CREDIT (PARAS P400-, P450-, P460-).  ALSO    * 02050000
020600*             MOVED ZEROES TO THE PSA12-KC-ORD-COST-AMT IN      * 02060000
020700*             P450- FOR SHORTAGES.                              * 02070000
020800*                                                               * 02080000
020900*   10/11/99  MIKE BESKE                   WR/IR #:   5998      * 02090000
021000*             CORRECTED THE CODE TO MOVE THE PV-NEXT-DOC-NBR    * 02100000
021100*             TO PSA12-INVOICE-ID.  THIS REPLACES THE FORMER    * 02110000
021200*             MOVE OF HOLD-DOC-NO TO PSA12-INVOICE-ID.  THIS    * 02120000
021300*             WILL ENSURE THAT THE CORRECT NUMBER WILL          * 02130000
021400*             APPEAR ON THE AP MEMORANDUMS.  (PARAS P400-,      * 02140000
021500*             P450-, P460-).                                    * 02150000
021600*                                                               * 02160000
021700*   01/11/00  CAROLYN GIFFORD              WR/IR#:  20704       * 02170000
021800*             ADDED STORE NUMBER TO CHECKPOINT/RESTART.         * 02180000
021900*             A PROGRAM ABEND MIDWAY THROUGH PROCESSING A       * 02190000
022000*             PO BY STORE AND RESTART BEGAN FROM BEGINNING      * 02200000
022100*             OF PO STORE COMBINATION, SOME INVOICES FOR        * 02210000
022200*             THIS PO WERE REPROCESSED AND DOLLARS WERE         * 02220000
022300*             DOUBLED UP. ALSO, MOVED INITIAL FETCH TO          * 02230000
022400*             INITIALIZATION SECTION AND FETCH IN               * 02240000
022500*             B200-PROCESS WAS MOVED AFTER PERFORM OF B300-.    * 02250000
022600*                                                               * 02260000
022700*   04/11/00  MIKE BESKE                   WR/IR#:  20997       * 02270000
022800*             ADDED PC-ECOM-IMPORT-PO (IE) AS A VALID IMPORT    * 02280000
022900*             PO TYPE CODE.  THIS IS PART OF THE PO TEAMS       * 02290000
023000*             ADDITION OF 4 NEW PO TYPE CODES TO TPURCHS.       * 02300000
023100*                                                               * 02310000
023200*   04/11/00  MIKE BESKE                   WR/IR#:  20997       * 02320000
023300*             ADDED PC-ECOM-IMPORT-PO (IF) AS A VALID IMPORT    * 02330000
023400*             PO TYPE CODE.                                     * 02340000
023500*                                                               * 02350000
023600*   09/08/2000 JILL JUEL                   WR/IR#:  20224       * 02360000
023700*      THE PROGRAM WAS CHANGED TO ALLOW THE NEW MARK OUT        * 02370000
023800*      OF STOCK(MOS), ADVERTISING(ADV), AND TRADE DISCOUNTS     * 02380000
023900*      THAT ARE BEING ADDED TO THE VENDOR MANAGEMENT AND        * 02390000
024000*      PO SYSTEMS TO BE PROCESSED THROUGH AP, ALONG WITH        * 02400000
024100*      THE ADDITIONAL EXTENDED THAT CAN BE ADDED TO THE PO      * 02410000
024200*      PAYMENTS TERMS. THIS WILL ENSURE THAT THESE NEW          * 02420000
024300*      DISCOUNTS GET PASSED AS SEPARATE TRANSACTIONS INTO       * 02430000
024400*      PEOPLESOFT, THAT THE NEW EXTENDED DAYS GET INCLUDED      * 02440000
024500*      IN THE DUE DATE CALCULATION, AND THAT THE ADVERTISING    * 02450000
024600*      DISCOUNT GETS CALCULATED SEPARATELY AND PASSED ALONG     * 02460000
024700*      TO THE CLASS DISTRIBUTION PROCESS SO IT CAN CREATE       * 02470000
024800*      AN EXPENSE ACCOUNT ADJUSTMENT. ADDED ADV_DISC_CSR,       * 02480000
024900*      MODIFIED THE ALW_CHRG_CSR, AND MADE CHANGES TO C100-     * 02490000
025000*      C200- P700- P750- Q100- P950- P955- AND R600.            * 02500000
025100*                                                               * 02510000
025200*   11/15/00  MIKE BESKE                   WR/IR#:  20224       * 02520000
025300*             MODIFIED CODE TO ADD THE ADVERTISING DISC         * 02530000
025400*             PERCENT WITH THE WEIGHTED DISC PERCENT TO MAKE    * 02540000
025500*             UP THE AP040-TERM-DISC-PCT WHEN A PRICE CLAIM     * 02550000
025600*             TRANSACTION IS CREATED IN PARAGRAPH P750-.        * 02560000
025700*                                                               * 02570000
025800*   03/28/01  NANCY EILBES                 WR/IR#:  20704       * 02580000
025900*             REPLACED INSERTS TO THE PSA12 TABLE WITH          * 02590000
026000*             INSERTS TO THE TAPDSRP TABLE USING APWSA12        * 02600000
026100*             COPYBOOK.  THIS CHANGE WAS MADE TO REMOVE THE     * 02610000
026200*             PEOPLESOFT DEPENDENCY FOR THIS PROGRAM.  THE      * 02620000
026300*             RECORDS WILL BE UNLOADED FROM THE TAPDSRP         * 02630000
026400*             TABLE AND INSERTED TO THE PSA12 TABLE AT A        * 02640000
026500*             LATER POINT IN THE PROCESSING.                    * 02650000
026600*                                                               * 02660000
026700*   07/23/01  ALEXIS KEIKER                WR/IR#:  22467       * 02670000
026800*             INCREASED PC-AP040-LEN FROM VALUE 400 TO 500.     * 02680000
026900*             THIS CHANGE WAS MADE BECAUSE COPYBOOK APRD040     * 02690000
027000*             WAS CHANGED FROM 400 TO 500.                      * 02700000
027100*                                                               * 02710000
027200*   08/07/01  L SCHALLHORN                 WR/IR#:  20704       * 02720000
027300*             ADD MOVE OF HOLD-EARLIEST-DATE TO HOLD-DUE-DT     * 02730000
027400*             SO THAT THE RI USES THE SAME CALC-DUE-DATE AS     * 02740000
027500*             ORIGINAL INVOICES.                                * 02750000
027600*                                                               * 02760000
027700*   08/08/01  NANCY EILBES                 WR/IR#: 416364       * 02770000
027800*        CHANGED WHERE THE EARLIEST-DUE-DATE WAS BEING          * 02780000
027900*        INITIALIZED AND CHANGED THE LOGIC MAINTAINING THE      * 02790000
028000*        EARLIEST DATE TO LOOK FOR SPACES INSTEAD OF ZERO.      * 02800000
028100*                                                               * 02810000
028200*   09/11/01  NANCY EILBES                 WR/IR#:  20704       * 02820000
028300*       ADDED HARDCODING OF DUE DATES FOR MATTEL INVOICES       * 02830000
028400*       DATED BETWEEN 09/19/01 AND 10/31/01 AND BETWEEN         * 02840000
028500*       11/01/01 AND 12/31/01.                                  * 02850000
028600*                                                               * 02860000
028700*   11/05/01  MIKE BESKE                   WR/IR#: 430362       * 02870000
028800*       ADDED HARDCODING OF DUE DATES FOR MATTEL INVOICES       * 02880000
028900*       DATED BETWEEN 09/19/01 AND 10/31/01 AND BETWEEN         * 02890000
029000*       11/01/01 AND 12/31/01 TO THE HOLD-EARLIEST-DUE-DATE.    * 02900000
029100*       THIS WILL ENSURE THAT MATTEL RI ADJUSMENTS WILL GET     * 02910000
029200*       THEIR DUE DATES POPULATED WITH THE ABOVE HARD DATES.    * 02920000
029300*                                                               * 02930000
029400*   11/26/01  NANCY EILBES                 WR/IR#: 434375       * 02940000
029500*       ADDED LOGIC TO ZERO OUT THE HOLD DISCOUNT PERCENT       * 02950000
029600*       WHEN PROCESSING MATTEL INVOICES (ABOVE HARD-CODING).    * 02960000
029700*       FIELD HOLD-DISC-PCT-DEC WAS NOT BEING INITIALIZED       * 02970000
029800*       AND THE MATTEL INVOICES WERE GETTING THE TERMS DISC     * 02980000
029900*       PERCENT FROM THE PREVIOUS INVOICE APPLIED TO THEM.      * 02990000
030000*                                                               * 03000000
030100*   02/13/02  NANCY EILBES                 WR/IR#: 22902        * 03010000
030200*       REMOVED PARAGRAPHS T100 AND T200, WHICH WERE DOING      * 03020000
030300*       SELECT COUNT(*) TO DETERMINE EXISTENCE OF CERTAIN       * 03030000
030400*       CONDITIONS.  THE SWITCHES/CODES THAT WERE BEING SET     * 03040000
030500*       WERE NO LONGER BEING REFERENCED ELSEWHERE IN THE        * 03050000
030600*       PROGRAM, SO IT WAS DETERMINED THAT THESE CALLS COULD    * 03060000
030700*       BE REMOVED.  ALSO, IN B300, MOVED THE LOGIC GETTING     * 03070000
030800*       THE DEPARTMENT AND VENDOR INFO SO THAT IT WAS ONLY      * 03080000
030900*       PERFORMED WHEN THE PO NUMBER CHANGED INSTEAD OF FOR     * 03090000
031000*       EVERY PO/STORE.                                         * 03100000
031100*                                                               * 03110000
031200*   05/16/2002  KEVIN CATLIN               WR# 21278            * 03120000
031300*       NI-SKU CHANGES.  THE 3 BYTE SKU-SEQ FIELD IS            * 03130000
031400*       REPLACED WITH A NUMERIC 8 BYTE SKU FIELD.  MOVE         * 03140000
031500*       STATEMENTS WERE MODIFIED IN PARAGRAPHS P400, P450,      * 03150000
031600*       AND P460.                                               * 03160000
031700*                                                               * 03170000
031800*   06/17/2002  KEVIN CATLIN               WR# 23500            * 03180000
031900*       ARK PO PROJECT PHASE 1.  REMOVE TABLE TPAYREQ FROM      * 03190000
032000*       INVOICE_CSR AND IN SELECT (PARA R400) AND USE PO_NBR    * 03200000
032100*       AND INVC_ID ON JOINS.  REMOVED UNUSED COLUMNS ON RI_CSR * 03210000
032200*       AND IN SELECT (PARA R910).  MOVE PO-NBR TO APRD252      * 03220000
032300*       COPYBOOK, REPLACING PAYT-REQ-SEQ-NBR.  REMOVE ALL       * 03230000
032400*       REFERENCES TO ENTR-TRMNL-ID AND TO ANY TPAYREQ COLUMNS  * 03240000
032500*       OR DCLGENS.  REMOVED PROCEDURE DIVISION COPYBOOK APPD053* 03250000
032600*       AND CONVERTED IT INTO A PERMANENT PARAGRAPH (S600 AND   * 03260000
032700*       T300).  REMOVED COPYBOOK APWS053 AND INCORPORATED INTO  * 03270000
032800*       WORKING STORAGE UNDER AP-WS-AREA.                       * 03280000
032900*                                                               * 03290000
033000*   06/25/2002  KEVIN CATLIN               WR# 23839            * 03300000
033100*       RECOMPILE TO INCLUDE CHANGES TO APPD052 AND APWS052     * 03310000
033200*       COPYBOOKS.  ADDED CHECK FOR VENDOR, ANDEL JEWELRY, BY   * 03320000
033300*       MODIFYING PARAGRAPHS C100 AND C200 TO MOVE THE          * 03330000
033400*       HOLD-DUNS-NO TO NEW VARIABLE APPD052-VENDOR-EXCEPTION.  * 03340000
033500*       IF THE VALUE OF APPD052-DNP-MISC = 'INS' FOR THIS       * 03350000
033600*       VENDOR, NO SEPARATE '15' TRANSACTION WILL BE CREATED.   * 03360000
033700*       THE AMOUNT (APPD052-MISC-CHARGES) WILL BE ADDED TO THE  * 03370000
033800*       AP040-MISC-CHRG-AMT.                                    * 03380000
033900*                                                               * 03390000
034000*   08/08/2002 COLBY HANGER EXPENSE PROCESSING.  RECOMPILE FROM * 03400000
034100*              PRODUCTION TO INCORPORATE COPYBOOK CHANGES.      * 03410000
034200*          BY: KEVIN CATLIN                   WR#: 23254        * 03420000
034300*                                                               * 03430000
034400*  08/24/2002 ARK PO PROJECT PHASE 2.  REPLACE REFERENCES TO    * 03440000
034500*             PAYT_REQ_SEQ_NBR WITH THE NEW INDEX OF PO_NBR AND * 03450000
034600*             INVC_ID.  CURSORS CHANGED ARE ALW_CHRG_CSR AND    * 03460000
034700*             ADC_CHRG_CSR.  PARAGRAPHS MODIFIED ARE S600 AND   * 03470000
034800*             R700.                                             * 03480000
034900*         BY: KEVIN CATLIN                   WR#: 23500         * 03490000
035000*                                                               * 03500000
035100*  09/11/2002 CORRECTED HOST VARIABLES FOR ALW_CHRG_CSR AND     * 03510000
035200*             ADV_DISC_CSR AND SELECT FROM TINVCTM.  HOST       * 03520000
035300*             VARIABLE SHOULD BE PV-PO-BEING-PROCESSED.         * 03530000
035400*         BY: KEVIN CATLIN                   WR#: 23500         * 03540000
035500*                                                               * 03550000
035600*  11/04/2002 COLBY DATING PROJECT.  MODIFIED CODE IN P900- TO  * 03560000
035700*           DEAL WITH THE CHANGES OF COPYBOOK APRD252.  ADDED   * 03570000
035800*           PAYT_DTE TO THE INVOICE_CSR AND ALSO CREATED A NEW  * 03580000
035900*           PV- FIELD TO GROUP ALL OF THE IMPORT PO TYPE CODES  * 03590000
036000*           TOGETHER.                                           * 03600000
036100*           MODIFIED ALL OF THE AMOUNT FIELDS FROM 9(7)V99      * 03610000
036200*           TO S9(9)V99 COMP-3 IN COPYBOOK APWS052.THIS WAS DONE* 03620000
036300*           TO CORRECT A DISCOUNT BALANCING ISSUE.  INCREASED   * 03630000
036400*           PV-INVAMT FROM S9(7)V99 COMP-3 TO S9(9)V99 COMP-3.  * 03640000
036500*         BY: MIKE BESKE                     WR#: 23750         * 03650000
036600*                                                               * 03660000
036700* 02/05/2003                                                    * 03670000
036800*    CHANGE MADE: ARKPO PHASE3 PROJECT.                         * 03680000
036900*    UPDATED THE PROGRAM TITLE TO MATCH THE SPEC TITLE.         * 03690000
037000*    UPDATED AP058-PURCHASE-ORDER TO AP058-PO-NBR.              * 03700000
037100*    UPDATED AP263-PURCHASE-ORDER TO AP263-PO-NBR.              * 03710000
037200*    REMOVE STATEMENTS REFERENCING AP058-INVOIC-ENTR-MTHD-CDE.  * 03720000
037300* MADE BY:  MIKE BESKE                          WR#: 23500      * 03730000
037400*                                                               * 03740000
037500* DATE  03/20/2003                                              * 03750000
037600*     CHANGE MADE: PEOPLESOFT 8 UPGRADE.  RECOMPILE PROGRAM TO  * 03760000
037700*     PICK UP CHANGED COPYBOOK APWSA12.                         * 03770000
037800*     MADE BY: L SCHALLHORN            WR/IR #: WR23417         * 03780000
037900*                                                               * 03790000
038000* DATE  03/25/2003                                              * 03800000
038100*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGE  * 03810000
038200*     TO COPYBOOK APWS052.                                      * 03820000
038300*     MADE BY: KEVIN CATLIN            WR/IR #: WR24481         * 03830000
038400*                                                               * 03840000
038500* DATE  12/10/2003                                              * 03850000
038600*     CHANGE MADE: ADDED TUPCSKU TABLE IN ORDER TO SELECT THE   * 03860000
038700*     UPC_NBR FOR PURITM-ITM-NBR BEING PROCESSED (PARA S700-).  * 03870000
038800*     THE UPC_NBR WILL BE MOVED TO THE APWSA12 COPYBOOK INSTEAD * 03880000
038900*     OF PASSING THE SKU NUMBER TO IT (PARAS P400- P450-).      * 03890000
039000*     CODE CHANGE TO PARA P460- WILL MOVE SPACES TO WSA12-KC-   * 03900000
039100*     SKU-NBR AND '000000000000000' TO WSA12-UPC-ID.  ADDED     * 03910000
039200*     ITM_NBR TO THE SQL IN PARAS R910- AND R920-(RI_CSR FETCH).* 03920000
039300*     MADE BY: MIKE BESKE              WR/IR #: WR24077         * 03930000
039400*                                                               * 03940000
039500* DATE  01/30/2004                                              * 03950000
039600*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGE  * 03960000
039700*     TO COPYBOOKS APWS052 AND APPD052. THIS INVOLVES THE VENDOR* 03970000
039800*     INSURANCE EXCEPTION OF NOT CHARGING BACK THE VENDOR FOR   * 03980000
039900*     INSURANCE CHARGE CODES: 'INS' AND '445'.  THE VENDORS ARE * 03990000
040000*     ANDEL JEWELRY '117498121' AND CITIZEN WATCH '078822863'.  * 04000000
040100*     MADE BY: MIKE BESKE              WR/IR #: P000628860      * 04010000
040200*                                                               * 04020000
040300* DATE  04/22/2004                                              * 04030000
040400*     CHANGE MADE: CHANGED THE PIC DEFN OF PV-NUMERIC-STORE FROM* 04040000
040500*     9(3) TO 9(4).  CHANGED PC-WO-STORNO AND PC-STORE-NBR FROM * 04050000
040600*     X(3) TO 9(5).  THIS IS PART OF THE STORE CONSTRAINTS PROJ.* 04060000
040700*     MADE BY: MIKE BESKE              WR/IR #: WR25805         * 04070000
040800*                                                               * 04080000
040900* DATE  06/21/2004                                              * 04090000
041000*     CHANGE MADE: CHANGED P950 TO POPULATE THE AP058 FIELDS    * 04100000
041100*     WITH HOLD INDICATOR AND PAYMENT DUE DATE, WHICH REPLACED  * 04110000
041200*     TERMS SELECT AND ENTER DATE, WHICH WERE NO LONGER BEING   * 04120000
041300*     USED. HOLD INDICATOR AND DUE DATE NEED TO BE PASSED TO    * 04130000
041400*     APKUP254 TO BE USED WHEN NSD DEDUCTIONS ARE CREATED.      * 04140000
041500*     MADE BY: NANCY EILBES            WR/IR #: WR26679         * 04150000
041600*                                                               * 04160000
041700* DATE  03/21/2005                                              * 04170000
041800*     CHANGE MADE: E-COMM DIRECT TO CONSUMER PROJECT            * 04180000
041900*     ADDED LOGIC TO PARAGRAPH P950- TO INCLUDE GIFT WRAP AND   * 04190000
042000*     HANDLING CHARGES IN THE INSERT TO THE PO/STORE INVOICE    * 04200000
042100*     TABLE (TOUTAPJ).  ALSO SUBTRACTED THESE TWO CHARGES FROM  * 04210000
042200*     THE TOTAL MISCELLANEOUS CHARGE.  ADDED FIELDS             * 04220000
042300*     AP058-CD-HANDLING-AMT AND AP058-CD-GIFT-WRAP-AMT TO       * 04230000
042400*     COPYBOOK APRD058 AND INCREASED ITS LENGTH FROM 66 TO 100. * 04240000
042500*     MADE BY: KRYSTEN LEARY           WR/IR #: WR28461         * 04250000
042600*                                                               * 04260000
042700* DATE  04/20/2005                                              * 04270000
042800*     CHANGE MADE: OFF-INVOICE CO-OP ADVERTISING ALLOWANCES     * 04280000
042900*     ADDED COPYBOOK APRD012 TO THE PROGRAM ALONG WITH THE      * 04290000
043000*     FOLLOWING WORK FIELDS:                                    * 04300000
043100*        PC-NSD-CDE     PC-ADV-CDE       PV-START-POINT         * 04310000
043200*        PC-TRD-CDE     PC-SAM-CDE       PV-VENDOR-CHECK        * 04320000
043300*        PC-MOS-CDE     PC-COOP-CDE      COMMENT-BLOCK          * 04330000
043400*     ALSO ADDED THE FIELD WS-APDSRP-OUT-RECORD, WHICH IS A     * 04340000
043500*     GROUP OF THREE WORK FIELDS THAT WILL BE USED TO INSERT    * 04350000
043600*     APRD012 RECORDS INTO THE TAPDSRP TABLE.  MODIFIED         * 04360000
043700*     PARAGRAPHS C100- AND C200- TO SUBTRACT                    * 04370000
043800*     APPD052-COOP-ADV-ALLOW-AMT FROM THE PV-DISC-GROSS-COST.   * 04380000
043900*     REMOVED THE STATEMENTS THAT MOVED/CALCULATED THE NSD,     * 04390000
044000*     MOS, TRD, AND ADV DISCOUNT AMOUNT/PERCENT FIELDS FROM     * 04400000
044100*     PARAGRAPH P700- AND REPLACED WITH A CALL TO Q100-.        * 04410000
044200*     ADDED THE PARAGRAPHS P725-CREATE-RI-IMPORT-ADJS,          * 04420000
044300*     Q100-PROCESS-DISCOUNT, T100-FORMAT-ALLOWANCE-TRAN, AND    * 04430000
044400*     AND T200-PROCESS-COMMENT-BLOCK TO THE PROGRAM.  REMOVED   * 04440000
044500*     LOGIC FROM PARAGRAPH P750- PERTAINING TO REMAINDER        * 04450000
044600*     INVOICES AND IMPORT POS AND ADDED LOGIC TO PARAGRAPHS     * 04460000
044700*     P950- AND P955- TO INCLUDE CO-OP ALLOWANCE AMOUNTS.  ALSO * 04470000
044800*     ADDED THE FIELDS AP058-COOP-ADV-ALLOW-AMT AND             * 04480000
044900*     AP058-RI-COOP-ADV-ALLOW-AMT TO THE APRD058 COPYBOOK.      * 04490000
045000*     MADE BY: KRYSTEN LEARY           WR/IR #: WR28651         * 04500000
045100*                                                               * 04510000
045200* DATE  05/06/2005                                              * 04520000
045300*     CHANGE MADE: ADDED A STATEMENT TO MOVE THE MISCELLANEOUS  * 04530000
045400*     CHARGES (APPD052-MISC-CHARGES) TO THE OUTPUT FILE         * 04540000
045500*     (AP040-MISC-CHRG-AMT) IN PARAGRAPH P750- FOR IMPORT POS.  * 04550000
045600*     MADE BY: KRYSTEN LEARY           WR/IR #: WR28651         * 04560000
045700*                                                               * 04570000
045800* DATE  07/14/2005                                              * 04580000
045900*     CHANGE MADE: REMOVED THE ADVERTISING DISCOUNT FROM THE    * 04590000
046000*     CALCULATION OF THE AP040-TERM-DISC-PCT.  THIS WILL NOW BE * 04600000
046100*     THE VALUE OF THE WEIGHTED DISC PERCENT FOUND ON TPOSTRR.  * 04610000
046200*     THIS CHANGE WAS MADE IN PARA 7650-CREATE-ADJ-PS-INTERFACE * 04620000
046300*     WHERE TRANSACTIONS ARE CREATED FOR PRICE CLAIMS.  THIS    * 04630000
046400*     CORRECTION WAS MADE TO RESOLVE AN BALANCE ISSUE IN AP.    * 04640000
046500*     MADE BY: MIKE BESKE              WR/IR #: P000779916      * 04650000
046600*                                                               * 04660000
046700* DATE  08/24/2005                                              * 04670000
046800*     CHANGE MADE: BROADCAST CALCULATION CHANGES.               * 04680000
046900*     REMOVED THE DECLARE FOR THE ADV_DISC_CSR CURSOR AND CODE  * 04690000
047000*     IN PARAGRAPHS R950-, Y700-, AND Y710- RELATING TO IT.     * 04700000
047100*     CHANGED THE WHERE CLAUSE OF THE ALW_CHRG_CSR CURSOR TO    * 04710000
047200*     EXCLUDE THE CONDITION ALW_CHRG_CDE  ^= 'ADV'.             * 04720000
047300*     INCLUDED APPD052-ADV-AMT IN THE CALCULATION OF THE        * 04730000
047400*     PV-DISC-GROSS-COST IN PARAGRAPHS C100- AND C200-.  ALL OF * 04740000
047500*     THESE CHANGES WERE MADE TO CALCULATE BROADCAST OFF        * 04750000
047600*     INVOICE FROM GROSS COST RATHER THAN FROM NET COST.        * 04760000
047700*     MADE BY: KRYSTEN LEARY           WR/IR #: WR29100         * 04770000
047800*                                                               * 04780000
047900* DATE  03/13/2006                                              * 04790000
048000*     CHANGE MADE: VENDOR ALLOWANCE - INDIVIDUALITY OF          * 04800000
048100*     OFF-INVOICE ALLOWANCES.  POPULATE NEW FIELDS ON THE       * 04810000
048200*     APRD058 COPYBOOK, ALSO CHANGE THE HANDLING OF DISCOUNTS   * 04820000
048300*     ON THE REMAINDER INVOICE AND PRICE CLAIM ADJUSTMENTS      * 04830000
048400*     BECAUSE OF CHANGES MADE TO THE PAY-RELEASE PROGRAMS       * 04840000
048500*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR30028         * 04850000
048600*                                                               * 04860000
048700* DATE  09/26/2006                                              * 04870000
048800*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP THE NEW * 04880000
048900*     FIELD AP040-SEPARATE-CHCK IN THE APRD040 COPYBOOK.        * 04890000
049000*     MADE BY: KRYSTEN LEARY           WR/IR #: WR31177         * 04900000
049100*                                                               * 04910000
049200* DATE  03/11/2007                                              * 04920000
049300*     CHANGE MADE: MATCH BY DC PROJECT.                         * 04930000
049400*                                                               * 04940000
049500*     MODIFIED INVOICE_CSR WHERE CLAUSE BY REPLACING STR-NBR =  * 04950000
049600*     STORE-IN-PROCESS TO MTCH-LVL-CDE = POSTRR-MTCH-LVL-CDE;   * 04960000
049700*     STR-NBR BETWEEN STR-NBR-LOW AND STR-NBR-HIGH; DC-NBR      * 04970000
049800*     BETWEEN DC-NBR-LOW AND DC-NBR-HIGH.                       * 04980000
049900*                                                               * 04990000
050000*     MODIFIED PO_CSR TO INCLUDE THE FETCH OF THE MTCH_LVL_CDE. * 05000000
050100*                                                               * 05010000
050200*     CREATED U800-UPDATE-INVOIC TO UPDATE THE CALC-DUE-DATE    * 05020000
050300*     THAT IS BEING CREATED VIA D350-.                          * 05030000
050400*                                                               * 05040000
050500*     MODIFIED P700 TO ONLY SET THE AP040-AP-TRN-CDE TO '01'.   * 05050000
050600*                                                               * 05060000
050700*     MODIFIED LOGIC THAT WAS MOVING PV-NUMERIC-STORE TO        * 05070000
050800*     AP040-STR-NBR TO NOW MOVE TINVOIC-STR-NBR INSTEAD.        * 05080000
050900*                                                               * 05090000
051000*     MODIFIED B300- TO SET UP THE STR-NBR-LOW, STR-NBR-HIGH,   * 05100000
051100*     DC-NBR-LOW AND DC-NBR-HIGH BEFORE OPENING THE INVOICE_CSR.* 05110000
051200*                                                               * 05120000
051300*     MODIFIED THE SELECT IN R400- TO INCLUDE IN THE WHERE      * 05130000
051400*     CLAUSE STR-NBR BETWEEN STR-NBR-LOW AND STR-NBR-HIGH,      * 05140000
051500*     DC-NBR BETWEEN DC-NBR-LOW AND DC-NBR-HIGH AND             * 05150000
051600*     MTCH-LVL-CDE = POSTRR-MTCH-LVL-CDE.                       * 05160000
051700*                                                               * 05170000
051800*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR21578         * 05180000
051900*                                                               * 05190000
052000* DATE  03/22/2007                                              * 05200000
052100*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP THE NEW * 05210000
052200*     FIELDS AP040-WTHD-SETID, AP040-WTHD-SW, AND AP040-WTHD-CD * 05220000
052300*     IN THE APRD040 COPYBOOK.                                  * 05230000
052400*     MADE BY: KRYSTEN LEARY           WR/IR #: WR32060         * 05240000
052500*                                                               * 05250000
052600* DATE  05/17/2007                                              * 05260000
052700*     CHANGE MADE: INSTALL AN AUTOMATED DO NOT PAY TRANS CODE   * 05270000
052800*     15 TO TRAN CODE 6C AND A NEW REVERSAL TRAN CODE, 6K, FOR  * 05280000
052900*     CUSTOMER DIRECT GIFTWRAP CHARGES, (CDG).                  * 05290000
053000*     MADE BY: ROLF NOHE               WR/IR #: WR31075         * 05300000
053100*                                                               * 05310000
053200* DATE  08/16/2007                                              * 05320000
053300*     CHANGE MADE: CREATE CHARGE BACK RECORDS IF CONSUMER DIRECT* 05330000
053400*     CHARGES EXCEED VENDOR AGREEMENT                           * 05340000
053500*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR32604         * 05350000
053600*                                                               * 05360000
053700* DATE  08/16/2007                                              * 05370000
053800*     CHANGE MADE: FIX PRODUCTION PROBLEM FOR TRAN CODE ISSUE   * 05380000
053900*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR32604         * 05390000
054000*                                                               * 05400000
054100* DATE  08/27/2007                                              * 05410000
054200*     CHANGE MADE: FIX PRODUCTION PROBLEM FOR FREIGHT ISSUE     * 05420000
054300*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR32604         * 05430000
054400*                                                               * 05440000
054500* DATE  09/13/2007                                              * 05450000
054600*     CHANGE MADE: FIX PRODUCTION PROBLEM FOR FREIGHT ISSUE     * 05460000
054700*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR32604         * 05470000
054800*                                                               * 05480000
054900* DATE  12/21/2007                                              * 05490000
055000*     CHANGE MADE: FIX PRODUCTION PROBLEM FOR DUPLICATE M15S    * 05500000
055100*     MADE BY: GREG WISIALOWSKI        WR/IR #: INC000000199177 * 05510000
055200*                                                               * 05520000
055300* DATE  12/28/2007                                              * 05530000
055400*     CHANGE MADE: FIXED ISSUE WITH M0E & M15 CHARGES.          * 05540000
055500*                  UPDATED DIVIDE TO MULTIPLY IN E700.          * 05550000
055600*     MADE BY: SCOTT KRUSCHKA          WR/IR #: INC000000205763 * 05560000
055700*                                                               * 05570000
055800* DATE  01/03/2008                                              * 05580000
055900*     CHANGE MADE: FIXED ISSUE WITH M0E & M15 CHARGES.          * 05590000
056000*                  UPDATED P950 TO MOVE WHOLE HANDLING AMOUNT   * 05600000
056100*     MADE BY: GREG WISIALOWSKI        WR/IR #: INC000000211504 * 05610000
056200*                                                               * 05620000
056300* DATE  09/27/2008                                              * 05630000
056400*     CHANGE MADE: ADDED CODE TO HANDLE -811 IN PARA S700-.     * 05640000
056500*     MADE BY: MIKE BESKE              WR/IR #: INC000000536394 * 05650000
056600*                                                               * 05660000
056700* DATE  03/30/2009                                              * 05670000
056800*     CHANGE MADE: CHANGED CODE IN D400- THAT HANDLES DNP       * 05680000
056900*     CHARGES.  WHEN A CONSUMER DIRECT INVOICE HAD BOTH GIFT    * 05690000
057000*     WRAP CHARGE AND HAD AN EXCESSIVE HANDLING CHARGE TO BE    * 05700000
057100*     CHARGED BACK, THE DNP DEDUCTION WAS CREATED TWICE. THE    * 05710000
057200*     LOGIC WAS CHANGED TO CHECK ALL 3 POSSIBLE DNP SCENARIOS   * 05720000
057210*     IN ONE PLACE TO PREVENT THE DUPLICATION.                  * 05721000
057220*     MADE BY: NANCY EILBES            WR/IR #: INC000000753839 * 05722000
057230*                                                               * 05723000
057240* DATE  08/31/2010                                              * 05724000
057250*     CHANGE MADE: RECOMPILE TO PICK UP CHANGES IN APRD058.     * 05725000
057260*     MADE BY: ROLF NOHE               WR/IR #: WR38002         * 05726000
057270*                                                               * 05727000
057280* DATE  05/17/2016                                              * 05728000
057290*     CHANGE MADE: INCLUDED VNT_VND_CPBL TABLE TO SELECT ALL    * 05729000
057291*     ENT_ID WITH CPBL CODE 'CSV'.                              * 05729100
057292*     PUT ALL CONSIGNMENT VENDOR VOUCHERS ON HOLD.              * 05729200
057293*     ADDED NEW ENT-CSV-TABLE TABLE TO STORE ENT ID AND THEN    * 05729300
057294*     APPLY SEARCH ON IT TO MATCH WITH PURCHASE ENT ID.         * 05729400
057295*     MADE BY: NEHA BAGRODIA           WR/IR #: CHG0135353      * 05729500
057296*                                                               * 05729600
057297* DATE  03/27/2019                                              * 05729700
057298*     CHANGE MADE: REMOVED LOGIC THAT WAS ROLLING ALL DISCOUNTS * 05729800
057299*     INTO THE TERMS DISCOUNT FIELD.  ADDED LOGIC TO POPULATE   * 05729900
057300*     DISCOUNTS FOR COOP, ALW AND MISC TO NEW FIELDS ON THE     * 05730000
057301*     APRD040 COPYBOOK.  REMOVED APRD012 AND ALL RELATED LOGIC. * 05730100
057302*     MADE BY: NANCY EILBES            WR/IR #: CHG0220043      * 05730200
057303*                                                               * 05730300
057304* DATE  09/25/2020                                              * 05730400
057305*     CHANGE MADE: ADDED LOGIC IN B300-PROCESS-INPUT-POS RIGHT  * 05730500
057306*     AFTER THE FREIGHT DISTRIBUTION HAS BEEN CALCULATED TO SEE * 05730600
057307*     IF THE PO BEING PROCESSED IS A CONSUMER DIRECT PO. WHEN IT* 05730700
057308*     IS, THE VENDOR FREIGHT AMOUNTS WILL BE ZEROED SO THAT ALL * 05730800
057309*     FREIGHT IS PAID BY KOHLS REGARDLESS OF THE FREIGHT TERMS  * 05730900
057310*     SET UP IN VENDOR AGREEMENTS.  THIS INCLUDES THE FREIGHT   * 05731000
057311*     AMOUNT THAT IS PASSED TO PROGRAM APKUP254 ON THE APRD058  * 05731100
057312*     FILE.  THAT PROGRAM WILL CONTROL WHERE THE FREIGHT COSTS  * 05731200
057313*     ARE POSTED BASED ON THE TRANSACTIONS IT GENERATES.        * 05731300
057314*     MADE BY: NANCY EILBES            WR/IR #: CHG0249255      * 05731400
057315*                                                               * 05731500
057316* DATE  05/11/2021                                              * 05731600
057317*     CHANGE MADE: ADDED LOGIC FOR SEPHORA INVOICES             * 05731700
057318*     MADE BY: JEAN KURK               WR/IR #: CHG0256545      * 05731800
057319*                                                               * 05731900
057320* DATE  10/25/2021                                              * 05732000
057330*     CHANGE MADE: ADDED LOGIC TO CHECK IF BOTH THE GROSS COST  * 05733000
057331*     AMOUNT AND THE NET COST AMOUNT ARE EQUAL TO ZERO, THEN WE * 05733100
057332*     DON'T INSERT THE TRANSACTION.  THIS IS TO PREVENT ZERO    * 05733200
057333*     COST TRANSACTIONS FROM BRIDGING TO ORACLE.                * 05733300
057334*     MADE BY: BARB SCHULTZ            WR/IR #: CHG0263291      * 05733400
057335*                                                               * 05733500
057336* DATE  01/28/2023                                              * 05733600
057337*     CHANGE MADE: POPULATE REASON CODE WITH 'INVALID INVOICE   * 05733700
057338*     CHARGE' FOR TRAN CODE 15                                  * 05733800
057339*     MADE BY: JEAN KURK               WR/IR #: CHG0279333      * 05733900
057340*                                                               * 05734007
057341* DATE  09/19/2023                                              * 05734107
057342*     CHANGE MADE: MODIFY CALCULATION OF ALLOWED CD HANDLING    * 05734207
057343*     CHARGE AMOUNT SO THE RESULT WILL BE ROUNDED INSTEAD OF    * 05734307
057344*     TRUNCATED. ELIMINATES UNNECESSARY 1 CENT M15 CHARGEBACKS. * 05734407
057345*     MADE BY: NANCY EILBES            WR/IR #: CHG0293509      * 05734507
057346*                                                               * 05734614
057347* DATE  03/13/2024                                              * 05734714
057348*     CHANGE MADE: ALLOW FOR PEPSI BOTTLE DEPOSIT.  IN 950-     * 05734808
057349*     SUBTRACT BOTTLE-DEP-AMT FROM MISC-CHARGES                 * 05734908
057351*     MADE BY: JEAN KURK               WR/IR #: CHG0301938      * 05735108
057352*                                                               * 05735215
057353* DATE  03/14/2024                                              * 05735315
057354*     CHANGE MADE: RECOMPILE BECAUSE THE ABOVE MOVE DID NOT     * 05735415
057355*     PICK UP THE UPDATED DCLGEN FOR TOUTAPJ                    * 05735515
057356*     MADE BY: NANCY EILBES            WR/IR #: CHG0305168      * 05735616
057357***************************************************************** 05735715
057358/                                                                 05735815
057360 ENVIRONMENT DIVISION.                                            05736000
057370 CONFIGURATION SECTION.                                           05737000
057380 SOURCE-COMPUTER. IBM-3090.                                       05738000
057390 OBJECT-COMPUTER. IBM-3090.                                       05739000
057400                                                                  05740000
057500*                                                                 05750000
057600 INPUT-OUTPUT SECTION.                                            05760000
057700 FILE-CONTROL.                                                    05770000
057800*                                                                 05780000
057900 DATA DIVISION.                                                   05790000
058000 FILE SECTION.                                                    05800000
058100*                                                                 05810000
058200/                                                                 05820000
058300 WORKING-STORAGE SECTION.                                         05830000
058400                                                                  05840000
058500 01  PV-PROGRAM-VARIABLES.                                        05850000
058600     05  FILLER                  PIC  X(31)  VALUE                05860000
058700         '** BEGINNING OF APKUP253 W/S **'.                       05870000
058800     05  PV-CURRENT-PARAGRAPH    PIC  X(35).                      05880000
058900     05  PV-CURRENT-TMST         PIC  X(26)  VALUE SPACES.        05890000
059000     05  PV-CURRENT-CCYYMMDD.                                     05900000
059100         10  PV-CURRENT-CC       PIC  X(02)  VALUE SPACE.         05910000
059200         10  PV-CURRENT-YY       PIC  X(02)  VALUE SPACE.         05920000
059300         10  FILLER              PIC  X(01)  VALUE '-'.           05930000
059400         10  PV-CURRENT-MM       PIC  X(02)  VALUE SPACE.         05940000
059500         10  FILLER              PIC  X(01)  VALUE '-'.           05950000
059600         10  PV-CURRENT-DD       PIC  X(02)  VALUE SPACE.         05960000
059700     05  PV-CURRENT-MMDDCCYY.                                     05970000
059800         10  PV-CURRENT-DATE-MM  PIC  9(02)  VALUE ZEROS.         05980000
059900         10  PV-CURRENT-DATE-DD  PIC  9(02)  VALUE ZEROS.         05990000
060000         10  PV-CURRENT-DATE-CC  PIC  9(02)  VALUE ZEROS.         06000000
060100         10  PV-CURRENT-DATE-YY  PIC  9(02)  VALUE ZEROS.         06010000
060200     05  PV-HOLD-DUE-DATE-CCYYMMDD.                               06020000
060300         10  PV-HOLD-DUE-DATE-CC PIC  X(02)  VALUE SPACE.         06030000
060400         10  PV-HOLD-DUE-DATE-YY PIC  X(02)  VALUE SPACE.         06040000
060500         10  FILLER              PIC  X(01)  VALUE '-'.           06050000
060600         10  PV-HOLD-DUE-DATE-MM PIC  X(02)  VALUE SPACE.         06060000
060700         10  FILLER              PIC  X(01)  VALUE '-'.           06070000
060800         10  PV-HOLD-DUE-DATE-DD PIC  X(02)  VALUE SPACE.         06080000
060900     05  PV-START                PIC S9(04)  VALUE +0             06090000
061000                                             COMP.                06100000
061100     05  PV-PO-BEING-PROCESSED   PIC S9(09)  VALUE ZEROS          06110000
061200                                             COMP.                06120000
061300     05  PV-PO-BEING-PROCESSED-9 PIC  9(09).                      06130000
061400     05  PV-PO-BEING-PROCESSED-X REDEFINES                        06140000
061500         PV-PO-BEING-PROCESSED-9 PIC  X(09).                      06150000
061600     05  PV-STORE-BEING-PROCESSED PIC S9(4)  VALUE ZEROS          06160000
061700                                             COMP.                06170000
061800     05  PV-STORE-BEING-PROCESSED-9                               06180000
061900                                 PIC 9(4)    VALUE ZEROS.         06190000
062000     05  PV-MTCH-LVL-BEING-PROCESSED                              06200000
062100                                 PIC X(01)   VALUE SPACE.         06210000
062200     05  PV-INVC-ID-BEING-PROCESSED                               06220000
062300                                 PIC X(22)   VALUE SPACES.        06230000
062400     05  PV-CR-PO-NBR            PIC 9(09)   VALUE ZEROS.         06240000
062500     05  PV-CR-STR-NBR           PIC 9(04)   VALUE ZEROS.         06250000
062600     05  PV-NUMERIC-STORE        PIC 9(4)    VALUE ZEROS.         06260000
062700     05  PV-HOLD-DEPT            PIC X(3)    VALUE SPACE.         06270000
062800     05  PV-HOLD-VENDOR-ID       PIC 9(9)    VALUE ZERO COMP.     06280000
062900     05  PV-LINENO               PIC 999     VALUE ZEROS.         06290000
063000     05  PV-DEFAULT-LINE-NBR     PIC 9(3)    VALUE 999.           06300000
063100     05  PV-NUMERIC-LINE-NBR     PIC 9(4)    VALUE ZEROS.         06310000
063200     05  PV-CHAR-LINE-NBR REDEFINES PV-NUMERIC-LINE-NBR           06320000
063300                                 PIC X(4).                        06330000
063400     05  PV-UPC-NBR-9            PIC S9(15)  VALUE +0.            06340000
063500     05  PV-PRCCLM-DIFFERENCE    PIC S9(07)V9(3) VALUE ZEROS      06350000
063600                                              COMP-3.             06360000
063700     05  PV-PRCCLM-COST          PIC S9(07)V9(2) VALUE ZEROS      06370000
063800                                              COMP-3.             06380000
063900     05  PV-INVAMT               PIC S9(09)V9(2) VALUE ZEROS      06390000
064000                                              COMP-3.             06400000
064100     05  PV-CALC-DISC-AMT        PIC S9(07)V9(2) VALUE ZEROS      06410000
064200                                              COMP-3.             06420000
064300     05  PV-POUNCST              PIC S9(07)V9(2) VALUE ZEROS      06430000
064400                                              COMP-3.             06440000
064500     05  PV-NW-STR-DISC-AMT      PIC S9(9)V99 VALUE ZEROS         06450000
064600                                              COMP-3.             06460000
064700     05  PV-TRD-DISC-AMT         PIC S9(9)V99 VALUE ZEROS         06470000
064800                                              COMP-3.             06480000
064900     05  PV-DATE-SUB             PIC S9(4)    VALUE ZERO          06490000
065000                                              COMP.               06500000
065100     05  HOLD-DISC-PCT-DEC       PIC S9(1)V9(4)                   06510000
065200                                              VALUE ZEROS.        06520000
065300     05  PV-TRANCDE              PIC X(2)     VALUE SPACES.       06530000
065400     05  PV-NEXT-DOC-NBR         PIC X(16)    VALUE SPACES.       06540000
065500     05  PV-NEXT-DOC-NBR-PC      PIC X(16)    VALUE SPACES.       06550000
065600     05  PV-CKPT-STAT-CODE       PIC X(01)    VALUE SPACE.        06560000
065700     05  PV-RI-TMST              PIC X(26)    VALUE               06570000
065800                   '9999-09-09-09.09.09.999999'.                  06580000
065900     05  PV-DB2-CURRENT-DATE     PIC X(10)    VALUE SPACE.        06590000
066000     05  PV-DEFAULT-TMST         PIC X(26)    VALUE               06600000
066100                   '9999-09-09-09.09.09.999999'.                  06610000
066200     05  PV-UNJ-WRITE-OFF-DESC   PIC X(25)    VALUE               06620000
066300         'UNJOURNALIZED W/O - AUTO '.                             06630000
066400     05  PV-NIR-WRITE-OFF-DESC   PIC X(25)    VALUE               06640000
066500         'NIR WRITE/OFF - AUTO     '.                             06650000
066600     05  PV-DISC-DOC-NBR-SUFFIX  PIC X(4)    VALUE SPACES.        06660000
066700     05  PV-DISC-GROSS-COST      PIC S9(9)V99 VALUE ZEROS         06670000
066800                                              COMP-3.             06680000
066900     05  PV-DISC-EXTENDED-DAYS   PIC S9(4)     COMP.              06690000
067000     05  PV-START-POINT          PIC S9(03)  VALUE +0.            06700000
067100     05  PV-PO-TYP-CDE           PIC X(2).                        06710000
067200         88  PV-PO-TYP-IMPORT    VALUES 'IM' 'IE' 'IF'.           06720000
067300     05  PV-PRCCLM-AMT           PIC S9(20)V999999 VALUE ZEROS    06730000
067400                                              COMP-3.             06740000
067500     05  PV-NEW-STORE-TOT        PIC S9(9)V99 VALUE ZEROS.        06750000
067600     05  PV-MOS-TOT              PIC S9(9)V99 VALUE ZEROS.        06760000
067700     05  PV-ADV-TOT              PIC S9(9)V99 VALUE ZEROS.        06770000
067800     05  PV-COOP-ADV-TOT         PIC S9(9)V99 VALUE ZEROS.        06780000
067900     05  PV-TRADE-TOT            PIC S9(9)V99 VALUE ZEROS.        06790000
068000     05  PV-ALW-TOT              PIC S9(9)V99 VALUE ZEROS.        06800000
068100     05  PV-MISC-TOT             PIC S9(9)V99 VALUE ZEROS.        06810000
068200                                                                  06820000
068300     05  PV-TOT-PRCCLM           PIC S9(9)V99 VALUE ZEROS.        06830000
068400     05  PV-STR-NBR-HIGH         PIC S9(04) VALUE ZEROS COMP.     06840000
068500     05  PV-STR-NBR-LOW          PIC S9(04) VALUE ZEROS COMP.     06850000
068600     05  PV-DC-NBR-HIGH          PIC S9(04) VALUE ZEROS COMP.     06860000
068700     05  PV-DC-NBR-LOW           PIC S9(04) VALUE ZEROS COMP.     06870000
068800     05  PV-DS-ALLOWED-AMT       PIC S9(9)V99 VALUE ZEROS.        06880000
068900     05  PV-DS-DIFFERENCE-AMT    PIC S9(9)V99 VALUE ZEROS.        06890000
069000                                                                  06900000
069100 01  PS-PROGRAM-SWITCHES.                                         06910000
069200     05  PS-INVOICED-BY-SW       PIC  X(01)  VALUE 'B'.           06920000
069300         88  INVOICED-BY-BULK                VALUE 'B'.           06930000
069400         88  INVOICED-BY-STORE               VALUE 'S'.           06940000
069500     05  PS-REMAINDER-INV-SW     PIC  X(01)  VALUE ' '.           06950000
069600         88  REMAINDER-INV-FOUND             VALUE 'Y'.           06960000
069700         88  REMAINDER-INV-NF                VALUE ' '.           06970000
069800     05  PS-OUT-OF-POS-SW        PIC  X(01)  VALUE ' '.           06980000
069900         88  OUT-OF-POS                      VALUE 'Y'.           06990000
070000         88  MORE-POS                        VALUE ' '.           07000000
070100     05  PS-OUT-OF-RI-PO-SW      PIC  X(01)  VALUE ' '.           07010000
070200         88  OUT-OF-RI-PO-LINES              VALUE 'Y'.           07020000
070300         88  MORE-RI-PO-LINES                VALUE ' '.           07030000
070400     05  PS-OUT-OF-RI-NULL-SW    PIC  X(01)  VALUE ' '.           07040000
070500         88  OUT-OF-RI-NULL-LINES            VALUE 'Y'.           07050000
070600         88  MORE-RI-NULL-LINES              VALUE ' '.           07060000
070700     05  PS-OUT-OF-INVOICES-SW   PIC  X(01)  VALUE ' '.           07070000
070800         88  OUT-OF-INVOICES                 VALUE 'Y'.           07080000
070900         88  MORE-INVOICES                   VALUE ' '.           07090000
071000     05  PS-ALW-CHRG-PROCESS-SW  PIC  X(01)  VALUE ' '.           07100000
071100         88  ALW-CHRG-PROCESS                VALUE 'Y'.           07110000
071200         88  ALW-CHRG-NOT-PROCESSED          VALUE ' '.           07120000
071300         88  ALW-CHRG-NOT-FOUND              VALUE 'N'.           07130000
071400     05  PS-ADV-DISC-CSR-SW      PIC  X(01)  VALUE 'N'.           07140000
071500         88  NOT-END-OF-ADV-DISC-CSR         VALUE 'N'.           07150000
071600         88  END-OF-ADV-DISC-CSR             VALUE 'Y'.           07160000
071700     05  PS-END-OF-MONTH-SW      PIC  X(01)  VALUE ' '.           07170000
071800         88  END-OF-MONTH                    VALUE 'Y'.           07180000
071900         88  NOT-END-OF-MONTH                VALUE 'N'.           07190000
072000         88  INIT-END-OF-MONTH               VALUE ' '.           07200000
072100     05  PS-WRITE-RECON-RESLTS-SW PIC X(01)  VALUE ' '.           07210000
072200         88  WRITE-RECON-RESULTS             VALUE 'Y'.           07220000
072300         88  DO-NOT-WRITE-RECON-RESULTS      VALUE ' '.           07230000
072400     05  PS-OUT-OF-PRCCLMS-SW    PIC  X(01)  VALUE ' '.           07240000
072500         88  OUT-OF-PRCCLMS                  VALUE 'Y'.           07250000
072600         88  MORE-PRCCLMS                    VALUE ' '.           07260000
072700     05  PS-PRCCLM-SW            PIC  X(01)  VALUE ' '.           07270000
072800         88  PRCCLM-RECORD                   VALUE 'Y'.           07280000
072900         88  OUT-OF-PRCCLM-RECORDS           VALUE 'N'.           07290000
073000     05  PS-PRCCLM-FOUND-SW      PIC  X(01)  VALUE ' '.           07300000
073100         88  PRCCLM-FOUND                    VALUE 'Y'.           07310000
073200         88  NO-PRCCLM-FOUND                 VALUE 'N'.           07320000
073300     05  PS-ADJUSTMENT-SW        PIC  X(01)  VALUE ' '.           07330000
073400         88  PRCCLM-ADJUST                   VALUE 'P'.           07340000
073500         88  FREIGHT-ADJUST                  VALUE 'F'.           07350000
073600         88  DNP-CHARGE                      VALUE 'D'.           07360000
073700         88  REMAINDER-INVOICE               VALUE 'R'.           07370000
073800         88  UNJ-WRITE-OFF                   VALUE 'W'.           07380000
073900         88  INIT-ADJUSTMENTS                VALUE ' '.           07390000
074000         88  IMPORT-PO                       VALUE 'I'.           07400000
074100         88  DIRECT-SHIP-CHARGE              VALUE 'C'.           07410000
074200     05  PS-ALW-IND              PIC X(01).                       07420000
074300         88  PS-ALLOWANCES-EXIST             VALUE 'Y'.           07430000
074400         88  PS-NO-ALLOWANCES-EXIST          VALUE 'N'.           07440000
074500     05  VENDOR-CONTROL-SW       PIC X(01)   VALUE 'N'.           07450000
074600         88  VENDOR-CONTROLS                 VALUE 'Y'.           07460000
074700         88  NO-VENDOR-CONTROLS              VALUE 'N'.           07470000
074800     05  VENDOR-CSV-SW           PIC X(01)   VALUE 'N'.           07480000
074900         88  CSV-DATA-FOUND                  VALUE 'Y'.           07490000
075000         88  CSV-DATA-NOT-FOUND              VALUE 'N'.           07500000
075100                                                                  07510000
075200 01  WS-CALL-DPKUP151                PIC X(08) VALUE 'DPKUP151'.  07520000
075300 01  PS-CSV-VENDOR-SW                PIC  X(01)  VALUE 'N'.       07530000
075400         88  PS-CSV-VENDOR                   VALUE 'Y'.           07540000
075500         88  PS-NOT-CSV-VENDOR               VALUE 'N'.           07550000
075600                                                                  07560000
075700 01  ENT-CSV-TABLE.                                               07570000
075800     05 PV-ENT-CSV-ENTRIES  OCCURS 100 TIMES  INDEXED BY IDX.     07580000
075900       15 TBL-ENT-ID      PIC 9(9)    VALUE ZERO COMP.            07590000
076000                                                                  07600000
076100 01  PS-PROGRAM-SWITCHES-II.                                      07610000
076200     05  PS-RUN-TYPE-SW          PIC  X(01)  VALUE ' '.           07620000
076300         88  NORMAL-RUN                      VALUE '0'.           07630000
076400         88  RESTART-RUN                     VALUE '9'.           07640000
076500/                                                                 07650000
076600 01  PA-PROGRAM-AMOUNTS.                                          07660000
076700     05  PA-PAY-REQ-QTY-TOT       PIC S9(9)  VALUE ZEROS          07670000
076800                                             COMP.                07680000
076900     05  PA-PAY-REQ-QTY-NULL-IND  PIC S9(04) VALUE ZEROS          07690000
077000                                             COMP.                07700000
077100     05  PA-MANUAL-ENTRY-CNT      PIC S9(9)  VALUE ZEROS          07710000
077200                                             COMP.                07720000
077300     05  PA-EDI-ENTRY-CNT         PIC S9(9)  VALUE ZEROS          07730000
077400                                             COMP.                07740000
077500     05  PA-HOLD-IND-CNT          PIC S9(9)  VALUE ZEROS          07750000
077600                                             COMP.                07760000
077700     05  PA-INVOICE-COUNT         PIC S9(9)  VALUE ZEROS          07770000
077800                                             COMP.                07780000
077900     05  PA-PO-COUNT              PIC S9(9)  VALUE ZEROS          07790000
078000                                             COMP.                07800000
078100     05  PA-INVOICE-COUNT-9       PIC  9(9)  VALUE ZEROS.         07810000
078200     05  PA-PO-COUNT-9            PIC  9(9)  VALUE ZEROS.         07820000
078300     05  PA-UPC-NOT-FOUND-CNT     PIC  9(9)  VALUE ZEROS.         07830000
078400                                                                  07840000
078500/                                                                 07850000
078600 01  PC-PROGRAM-CONSTANTS.                                        07860000
078700     05  PC-AP040-LEN            PIC S9(04)  VALUE 500    COMP.   07870000
078800     05  PC-STORE-ZEROS          PIC  S9(4)  VALUE ZEROS          07880000
078900                                             COMP.                07890000
079000     05  PC-IN-PROCESS-CODE      PIC  X(01)  VALUE '9'.           07900000
079100     05  PC-RUN-COMPLETE-CODE    PIC  X(01)  VALUE '0'.           07910000
079200     05  PC-CC-2000              PIC  X(02)  VALUE '20'.          07920000
079300     05  PC-CC-1900              PIC  X(02)  VALUE '19'.          07930000
079400     05  PC-PURCHASE-TERMS       PIC  X(01)  VALUE 'P'.           07940000
079500     05  PC-INVOICE-TERMS        PIC  X(01)  VALUE 'I'.           07950000
079600     05  PC-AUTO                 PIC  X(01)  VALUE 'A'.           07960000
079700     05  PC-BATCH                PIC  X(01)  VALUE 'B'.           07970000
079800     05  PC-ONLINE               PIC  X(01)  VALUE 'O'.           07980000
079900     05  PC-INVOICE-RL-STAT      PIC  X(02)  VALUE 'RL'.          07990000
080000     05  PC-INVOICE-RI-CODE      PIC  X(02)  VALUE 'RI'.          08000000
080100     05  PC-INVOICE-RC-CODE      PIC  X(02)  VALUE 'RC'.          08010000
080200     05  PC-INVOICE-EN-CODE      PIC  X(02)  VALUE 'EN'.          08020000
080300     05  PC-MI-TYPE              PIC  X(02)  VALUE 'MI'.          08030000
080400     05  PC-WO-TYPE              PIC  X(02)  VALUE 'WO'.          08040000
080500     05  PC-WO-EXPENSE-ACCT      PIC  X(07)  VALUE '0001290'.     08050000
080600     05  PC-WO-STORNO            PIC  9(05)  VALUE 90.            08060000
080700     05  PC-WO-PRTIND            PIC  X(01)  VALUE '1'.           08070000
080800     05  PC-WO-DELETE-OTP-IND    PIC  X(01)  VALUE '1'.           08080000
080900     05  PC-CLEARING-ACCT-NBR    PIC  X(07)  VALUE '0001330'.     08090000
081000     05  PC-STORE-NBR            PIC  9(05)  VALUE 90.            08100000
081100     05  PC-PRINT-IND            PIC  X(01)  VALUE '1'.           08110000
081200     05  PC-DELETE-IND           PIC  X(01)  VALUE '1'.           08120000
081300     05  PC-REGION03             PIC  X(02)  VALUE '03'.          08130000
081400     05  PC-PROGRAM              PIC  X(08)  VALUE 'APKUP253'.    08140000
081500     05  PC-VENDOR-NF            PIC  X(15)  VALUE                08150000
081600                                             'VENDR NOT FOUND'.   08160000
081700     05  PC-15-DESC-TXT          PIC  X(50)  VALUE                08170000
081800                                 'INVALID INVOICE CHARGE'.        08180000
081900 01  CKPT-RESTART-INFO.                                           08190000
082000     05  CR-PO-NBR                PIC S9(9)   VALUE ZEROS  COMP.  08200000
082100     05  CR-STR-NBR               PIC S9(4)   VALUE ZEROS  COMP.  08210000
082200     05  CR-INVOICE-COUNT         PIC S9(9)   VALUE ZEROS  COMP.  08220000
082300                                                                  08230000
082400 01  CKPT-RESTART-TMST.                                           08240000
082500     05  CR-CURR-TMST             PIC X(26)     VALUE SPACES.     08250000
082600     05  CR-NEXT-TMST             PIC X(26)     VALUE SPACES.     08260000
082700                                                                  08270000
082800/                                                                 08280000
082900***************************************************************** 08290000
083000*  THIS IS THE WORKING STORAGE FOR THE ALLOWANCE/CHARGE         * 08300000
083100*  CALCULATIONS.                                                * 08310000
083200***************************************************************** 08320000
083300 01  AP-WS-AREA.                                                  08330000
083400     05  AP-WS-PO-NBR               PIC S9(9) VALUE ZEROS COMP.   08340000
083500     05  AP-WS-STR-NBR              PIC S9(4) VALUE ZEROS COMP.   08350000
083600     05  AP-WS-VEND-FRT             PIC S9(8)V99 VALUE ZEROS      08360000
083700                                                      COMP-3.     08370000
083800     05  AP-WS-VEND-FRT-NULL        PIC S9(4) VALUE ZEROS COMP.   08380000
083900     05  AP-WS-TOTAL-FRT            PIC S9(8)V99 VALUE ZEROS      08390000
084000                                                      COMP-3.     08400000
084100     05  AP-WS-TOTAL-FRT-NULL       PIC S9(4) VALUE ZEROS COMP.   08410000
084200     05  AP-WS-VEND-FRT-PCT         PIC S9V9(4)  VALUE ZEROS.     08420000
084300     05  AP-WS-KOHLS-FRT-PCT        PIC S9V9(4)  VALUE ZEROS.     08430000
084400     05  AP-WS-SQLCODE-SW           PIC X        VALUE 'G'.       08440000
084500         88  AP-WS-GOOD-SQLCODE                  VALUE 'G'.       08450000
084600         88  AP-WS-BAD-SQLCODE                   VALUE 'B'.       08460000
084700                                                                  08470000
084800***************************************************************** 08480000
084900*  THIS COPYBOOK IS THE WORKING STORAGE HOLD AREA FOR THE       * 08490000
085000*  SUBROUTINE  (APKUP253).                                      * 08500000
085100***************************************************************** 08510000
085200 01  WS-HOLD-AREA.                                                08520000
085300     05  HOLD-PO-AREA.                                            08530000
085400         10  HOLD-DEPT                          PIC X(03).        08540000
085500         10  HOLD-DUNS-NO                       PIC X(09).        08550000
085600             88  HOLD-MATTEL                    VALUE '008286643'.08560000
085700         10  HOLD-VENDOR-NAME                   PIC X(30).        08570000
085800         10  HOLD-VENDOR-ID                     PIC 9(09).        08580000
085900         10  HOLD-EARLIEST-DUE-DATE             PIC X(10).        08590000
086000     05  HOLD-INVOICE-AREA.                                       08600000
086100         10  HOLD-DOC-NO                        PIC X(16).        08610000
086200         10  HOLD-ENTR-DTE                      PIC X(10).        08620000
086300         10  HOLD-PYMT-IND                      PIC X(01).        08630000
086400             88  HOLD-PYMT-HOLD                     VALUE 'Y'.    08640000
086500             88  HOLD-NO-PYMT-HOLD                  VALUE 'N'.    08650000
086600         10  HOLD-DOC-DATE-MMDDCCYY.                              08660000
086700             15  HOLD-DOC-DATE-MM               PIC 9(02).        08670000
086800             15  HOLD-DOC-DATE-DD               PIC 9(02).        08680000
086900             15  HOLD-DOC-DATE-CC               PIC 9(02).        08690000
087000             15  HOLD-DOC-DATE-YY               PIC 9(02).        08700000
087100         10  HOLD-DOC-DATE-CCYYMMDD.                              08710000
087200             15  HOLD-DOC-DATE-CN               PIC X(02).        08720000
087300             15  HOLD-DOC-DATE-YR               PIC X(02).        08730000
087400             15  FILLER                         PIC X(01).        08740000
087500             15  HOLD-DOC-DATE-MO               PIC X(02).        08750000
087600             15  FILLER                         PIC X(01).        08760000
087700             15  HOLD-DOC-DATE-DA               PIC X(02).        08770000
087800         10  HOLD-DUE-DATE-CCYYMMDD.                              08780000
087900             15  HOLD-DUE-DATE-CN               PIC X(02).        08790000
088000             15  HOLD-DUE-DATE-YR               PIC X(02).        08800000
088100             15  FILLER                         PIC X(01).        08810000
088200             15  HOLD-DUE-DATE-MO               PIC X(02).        08820000
088300             15  FILLER                         PIC X(01).        08830000
088400             15  HOLD-DUE-DATE-DA               PIC X(02).        08840000
088500         10  HOLD-DUE-DATE-MMDDYY.                                08850000
088600             15  HOLD-DUE-DATE-MM               PIC 9(02).        08860000
088700             15  HOLD-DUE-DATE-DD               PIC 9(02).        08870000
088800             15  HOLD-DUE-DATE-YY               PIC 9(02).        08880000
088900         10  HOLD-TERMS-AREA.                                     08890000
089000             15  HOLD-DISC-PCT                  PIC 9(03)V99.     08900000
089100             15  HOLD-TERMS-DISC-AMT            PIC S9(07)V99.    08910000
089200             15  HOLD-DISC-DAYS                 PIC 9(03).        08920000
089300             15  HOLD-EXTD-DAYS                 PIC 9(03).        08930000
089400             15  HOLD-DISC-EOM                  PIC X(01).        08940000
089500/                                                                 08950000
089600*                                                                 08960000
089700*    BATCH CONTROL                                                08970000
089800*                                                                 08980000
089900     COPY APRD040.                                                08990000
090000/                                                                 09000000
090100*                                                                 09010000
090200*    RECONCILIATION RESULTS                                       09020000
090300*                                                                 09030000
090400     COPY APRD263.                                                09040000
090500/                                                                 09050000
090600*                                                                 09060000
090700*    OPEN TO PAY UPDATE                                           09070000
090800*                                                                 09080000
090900     COPY APRD252.                                                09090000
091000/                                                                 09100000
091100*                                                                 09110000
091200*    PO/STORE INVOICE FILE                                        09120000
091300*                                                                 09130000
091400     COPY APRD058.                                                09140000
091500/                                                                 09150000
091600*                                                                 09160000
091700*    MEMORANDUM WORK RECORD                                       09170000
091800*                                                                 09180000
091900     COPY APWSA12.                                                09190000
092000/                                                                 09200000
092100*                                                                 09210000
092200*    TPOSTRR DCLGEN                                               09220000
092300*                                                                 09230000
092400     EXEC SQL                                                     09240000
092500         INCLUDE TPOSTRR                                          09250000
092600     END-EXEC.                                                    09260000
092700/                                                                 09270000
092800*                                                                 09280000
092900*    TPRCCLM DCLGEN                                               09290000
093000*                                                                 09300000
093100     EXEC SQL                                                     09310000
093200         INCLUDE TPRCCLM                                          09320000
093300     END-EXEC.                                                    09330000
093400/                                                                 09340000
093500*                                                                 09350000
093600*    TPURCHS DCLGEN                                               09360000
093700*                                                                 09370000
093800     EXEC SQL                                                     09380000
093900         INCLUDE TPURCHS                                          09390000
094000     END-EXEC.                                                    09400000
094100/                                                                 09410000
094200*                                                                 09420000
094300*    TMDSEAR DCLGEN                                               09430000
094400*                                                                 09440000
094500     EXEC SQL                                                     09450000
094600         INCLUDE TMDSEAR                                          09460000
094700     END-EXEC.                                                    09470000
094800/                                                                 09480000
094900*                                                                 09490000
095000*    TPURITM DCLGEN                                               09500000
095100*                                                                 09510000
095200     EXEC SQL                                                     09520000
095300         INCLUDE TPURITM                                          09530000
095400     END-EXEC.                                                    09540000
095500/                                                                 09550000
095600*                                                                 09560000
095700*    TPREQIT DCLGEN                                               09570000
095800*                                                                 09580000
095900     EXEC SQL                                                     09590000
096000         INCLUDE TPREQIT                                          09600000
096100     END-EXEC.                                                    09610000
096200/                                                                 09620000
096300*                                                                 09630000
096400*    TPOAGMT DCLGEN                                               09640000
096500*                                                                 09650000
096600     EXEC SQL                                                     09660000
096700         INCLUDE TPOAGMT                                          09670000
096800     END-EXEC.                                                    09680000
096900/                                                                 09690000
097000*                                                                 09700000
097100*    TPAYTRM DCLGEN                                               09710000
097200*                                                                 09720000
097300     EXEC SQL                                                     09730000
097400         INCLUDE TPAYTRM                                          09740000
097500     END-EXEC.                                                    09750000
097600/                                                                 09760000
097700*                                                                 09770000
097800*    TEXTENT DCLGEN                                               09780000
097900*                                                                 09790000
098000     EXEC SQL                                                     09800000
098100         INCLUDE TEXTENT                                          09810000
098200     END-EXEC.                                                    09820000
098300/                                                                 09830000
098400*                                                                 09840000
098500*    TVNDDPT DCLGEN                                               09850000
098600*                                                                 09860000
098700     EXEC SQL                                                     09870000
098800         INCLUDE TVNDDPT                                          09880000
098900     END-EXEC.                                                    09890000
099000/                                                                 09900000
099100*                                                                 09910000
099200*    TENTNME DCLGEN                                               09920000
099300*                                                                 09930000
099400     EXEC SQL                                                     09940000
099500         INCLUDE TENTNME                                          09950000
099600     END-EXEC.                                                    09960000
099700/                                                                 09970000
099800*                                                                 09980000
099900*    TINVOIC DCLGEN                                               09990000
100000*                                                                 10000000
100100     EXEC SQL                                                     10010000
100200         INCLUDE TINVOIC                                          10020000
100300     END-EXEC.                                                    10030000
100400/                                                                 10040000
100500*                                                                 10050000
100600*    TVNDAGR DCLGEN                                               10060000
100700*                                                                 10070000
100800     EXEC SQL                                                     10080000
100900         INCLUDE TVNDAGR                                          10090000
101000     END-EXEC.                                                    10100000
101100/                                                                 10110000
101200*                                                                 10120000
101300*    TMDINVC DCLGEN                                               10130000
101400*                                                                 10140000
101500     EXEC SQL                                                     10150000
101600         INCLUDE TMDINVC                                          10160000
101700     END-EXEC.                                                    10170000
101800/                                                                 10180000
101900*                                                                 10190000
102000*    TAPCNTL DCLGEN                                               10200000
102100*                                                                 10210000
102200     EXEC SQL                                                     10220000
102300         INCLUDE TAPCNTL                                          10230000
102400     END-EXEC.                                                    10240000
102500/                                                                 10250000
102600*                                                                 10260000
102700*    TMIITEM DCLGEN                                               10270000
102800*                                                                 10280000
102900     EXEC SQL                                                     10290000
103000         INCLUDE TMIITEM                                          10300000
103100     END-EXEC.                                                    10310000
103200/                                                                 10320000
103300*                                                                 10330000
103400*    TALCHRG DCLGEN                                               10340000
103500*                                                                 10350000
103600     EXEC SQL                                                     10360000
103700         INCLUDE TALCHRG                                          10370000
103800     END-EXEC.                                                    10380000
103900/                                                                 10390000
104000*                                                                 10400000
104100*    TINVCTM DCLGEN                                               10410000
104200*                                                                 10420000
104300     EXEC SQL                                                     10430000
104400         INCLUDE TINVCTM                                          10440000
104500     END-EXEC.                                                    10450000
104600/                                                                 10460000
104700*                                                                 10470000
104800*    TAPVNDS DCLGEN                                               10480000
104900*                                                                 10490000
105000     EXEC SQL                                                     10500000
105100         INCLUDE TAPVNDS                                          10510000
105200     END-EXEC.                                                    10520000
105300/                                                                 10530000
105400*                                                                 10540000
105500*    TTRNCDE DCLGEN                                               10550000
105600*                                                                 10560000
105700     EXEC SQL                                                     10570000
105800         INCLUDE TTRNCDE                                          10580000
105900     END-EXEC.                                                    10590000
106000/                                                                 10600000
106100*                                                                 10610000
106200*    TUPCSKU DCLGEN                                               10620000
106300*                                                                 10630000
106400     EXEC SQL                                                     10640000
106500         INCLUDE TUPCSKU                                          10650000
106600     END-EXEC.                                                    10660000
106700/                                                                 10670000
106800*                                                                 10680000
106900*    PS_A12_AP_MEMO DCLGEN                                        10690000
107000*                                                                 10700000
107100     EXEC SQL                                                     10710000
107200         INCLUDE TAPDSRP                                          10720000
107300     END-EXEC.                                                    10730000
107400/                                                                 10740000
107500*                                                                 10750000
107600*    VNT_VND_CPBL  DCLGEN                                         10760000
107700*                                                                 10770000
107800     EXEC SQL                                                     10780000
107900         INCLUDE VNT00001                                         10790000
108000     END-EXEC.                                                    10800000
108100/                                                                 10810000
108200*                                                                 10820000
108300*    SQL COMMUNICATIONS AREA DCLGEN                               10830000
108400*                                                                 10840000
108500     EXEC SQL                                                     10850000
108600         INCLUDE SQLCA                                            10860000
108700     END-EXEC.                                                    10870000
108800/                                                                 10880000
108900*                                                                 10890000
109000*    TCKRSTCNTL TABLE LAYOUT                                      10900000
109100*                                                                 10910000
109200     EXEC SQL                                                     10920000
109300         INCLUDE TCKRSTCN                                         10930000
109400     END-EXEC.                                                    10940000
109500/                                                                 10950000
109600*                                                                 10960000
109700*    TCKRSTINF TABLE LAYOUT                                       10970000
109800*                                                                 10980000
109900     EXEC SQL                                                     10990000
110000         INCLUDE TCKRSTIN                                         11000000
110100     END-EXEC.                                                    11010000
110200/                                                                 11020000
110300*                                                                 11030000
110400*    TOUTAPE TABLE LAYOUT                                         11040000
110500*                                                                 11050000
110600     EXEC SQL                                                     11060000
110700         INCLUDE TOUTAPE                                          11070000
110800     END-EXEC.                                                    11080000
110900/                                                                 11090000
111000*                                                                 11100000
111100*    TOUTAP2 TABLE LAYOUT                                         11110000
111200*                                                                 11120000
111300     EXEC SQL                                                     11130000
111400         INCLUDE TOUTAP2                                          11140000
111500     END-EXEC.                                                    11150000
111600/                                                                 11160000
111700*                                                                 11170000
111800*    TOUTAPI TABLE LAYOUT                                         11180000
111900*                                                                 11190000
112000     EXEC SQL                                                     11200000
112100         INCLUDE TOUTAPI                                          11210000
112200     END-EXEC.                                                    11220000
112300/                                                                 11230000
112400*                                                                 11240000
112500*    TOUTAPJ TABLE LAYOUT                                         11250000
112600*                                                                 11260000
112700     EXEC SQL                                                     11270000
112800         INCLUDE TOUTAPJ                                          11280000
112900     END-EXEC.                                                    11290000
113000/                                                                 11300000
113100*---------------------------------------------------------------- 11310000
113200*    CURSOR DECLARATIONS                                          11320000
113300*---------------------------------------------------------------- 11330000
113400*---------------------------------------------------------------- 11340000
113500* PO_CSR RETURNS THE PURCHASE ORDERS TO BE PROCESSED.             11350000
113600*---------------------------------------------------------------- 11360000
113700     EXEC SQL                                                     11370000
113800         DECLARE PO_CSR CURSOR WITH HOLD                          11380000
113900             FOR SELECT                                           11390000
114000                 PO_NBR                                           11400000
114100                ,STR_NBR                                          11410000
114200                ,PAYT_RLSE_TMST                                   11420000
114300                ,CRE_PRC_CDE                                      11430000
114400                ,MTCH_LVL_CDE                                     11440000
114500             FROM                                                 11450000
114600                 TPOSTRR                                          11460000
114700             WHERE                                                11470000
114800                  STATUS_CDE = ' '                                11480000
114900             ORDER BY                                             11490000
115000                   PO_NBR                                         11500000
115100                  ,STR_NBR                                        11510000
115200                  ,PAYT_RLSE_TMST                                 11520000
115300     END-EXEC.                                                    11530000
115400/                                                                 11540000
115500*---------------------------------------------------------------- 11550000
115600* PRCCLM_CSR RETRIEVES ALL PRICE CLAIM ROWS ASSOCIATED WITH A     11560000
115700* PO/STORE. NOTE: THE STORE ON TPRCCLM WILL BE THE MATCH LOCATION 11570000
115800*---------------------------------------------------------------- 11580000
115900     EXEC SQL                                                     11590000
116000         DECLARE PRCCLM_CSR CURSOR                                11600000
116100             FOR SELECT                                           11610000
116200                 PO_LNE_NBR                                       11620000
116300                ,INVC_ID                                          11630000
116400                ,DOC_TYP_CDE                                      11640000
116500                ,UNT_QTY                                          11650000
116600                ,UNT_COST_AMT                                     11660000
116700                ,ADJ_COST_AMT                                     11670000
116800             FROM                                                 11680000
116900                 TPRCCLM                                          11690000
117000             WHERE                                                11700000
117100                  PO_NBR  = :PV-PO-BEING-PROCESSED                11710000
117200              AND STR_NBR = :PV-STORE-BEING-PROCESSED             11720000
117300              AND INVC_ID = :INVOIC-INVC-ID                       11730000
117400              AND (DOC_TYP_CDE = 'CM'                             11740000
117500               OR DOC_TYP_CDE = 'DM')                             11750000
117600              AND PAYT_RLSE_TMST = :POSTRR-PAYT-RLSE-TMST         11760000
117700             ORDER BY                                             11770000
117800                   INVC_ID                                        11780000
117900                  ,PO_LNE_NBR                                     11790000
118000     END-EXEC.                                                    11800000
118100*---------------------------------------------------------------- 11810000
118200* INVOICE_CSR RETURNS INVOICES RELEASED FOR PAYMENT FOR THE       11820000
118300* PURCHASE ORDER AND STORE NUMBER BEING PROCESSED. THEY ARE       11830000
118400* RETRIEVED IN ORDER BY INVOICE NUMBER.  THE STORE NUMBER IS      11840000
118500* ZEROES FOR BULK INVOICES.                                       11850000
118600*---------------------------------------------------------------- 11860000
118700     EXEC SQL                                                     11870000
118800         DECLARE INVOICE_CSR CURSOR                               11880000
118900             FOR SELECT                                           11890000
119000                 IV.INVC_ID                                       11900000
119100                ,IV.PAYT_REQ_SEQ_NBR                              11910000
119200                ,IV.CRE_DTE                                       11920000
119300                ,IV.STR_NBR                                       11930000
119400                ,IV.INVC_TYP_CDE                                  11940000
119500                ,IV.STATUS_CDE                                    11950000
119600                ,IV.INVC_DTE                                      11960000
119700                ,IV.HOLD_IND                                      11970000
119800                ,IV.ENTR_MTHD_CDE                                 11980000
119900                ,IV.PAYT_RLSE_TMST                                11990000
120000                ,IV.GRO_COST_AMT                                  12000000
120100                ,IV.BAR_CDE                                       12010000
120200                ,IV.CALC_DUE_DTE                                  12020000
120300                ,IV.PAYT_DTE                                      12030000
120400                ,MI.TERM_SEL_CDE                                  12040000
120500                ,MI.VEND_FRGT_PCT                                 12050000
120600                ,MI.KOHLS_FRGT_PCT                                12060000
120700                ,MI.TOT_INVC_PC_QTY                               12070000
120800                ,IV.DC_NBR                                        12080000
120900                ,IV.MTCH_LVL_CDE                                  12090000
121000             FROM                                                 12100000
121100                 TINVOIC IV                                       12110000
121200                ,TMDINVC MI                                       12120000
121300             WHERE                                                12130000
121400                  IV.PO_NBR     = :PV-PO-BEING-PROCESSED          12140000
121500             AND  IV.PO_NBR     = MI.PO_NBR                       12150000
121600             AND  IV.INVC_ID    = MI.INVC_ID                      12160000
121700             AND  IV.STR_NBR BETWEEN :PV-STR-NBR-LOW              12170000
121800                                 AND :PV-STR-NBR-HIGH             12180000
121900             AND  IV.DC_NBR  BETWEEN :PV-DC-NBR-LOW               12190000
122000                                 AND :PV-DC-NBR-HIGH              12200000
122100             AND  IV.STATUS_CDE = :PC-INVOICE-RL-STAT             12210000
122200             AND  IV.MTCH_LVL_CDE = :POSTRR-MTCH-LVL-CDE          12220000
122300             AND  IV.GRO_COST_AMT >= 0                            12230000
122400             ORDER BY                                             12240000
122500                   IV.INVC_ID                                     12250000
122600     END-EXEC.                                                    12260000
122700/                                                                 12270000
122800*---------------------------------------------------------------- 12280000
122900* ALW_CHRG_CSR GETS ALL ALLOWANCE/CHARGE INFO FOR THE INVOICE     12290000
123000*---------------------------------------------------------------- 12300000
123100     EXEC SQL                                                     12310000
123200       DECLARE ALW_CHRG_CSR CURSOR FOR                            12320000
123300         SELECT ALW_CHRG_TYP_CDE                                  12330000
123400               ,ALW_CHRG_CDE                                      12340000
123500               ,ALW_CHRG_PCT                                      12350000
123600               ,ALW_CHRG_AMT                                      12360000
123700            FROM TALCHRG                                          12370000
123800            WHERE PO_NBR         = :PV-PO-BEING-PROCESSED         12380000
123900              AND INVC_ID        = :INVOIC-INVC-ID                12390000
124000     END-EXEC.                                                    12400000
124100/                                                                 12410000
124200*---------------------------------------------------------------- 12420000
124300* RI_CSR GETS ALL THE PURCHASE ITEM INFORMATION FOR THE REMAINDER 12430000
124400*        INVOICE WHERE THERE IS A VALID PO LINE NBR.              12440000
124500*---------------------------------------------------------------- 12450000
124600     EXEC SQL                                                     12460000
124700       DECLARE RI_CSR CURSOR FOR                                  12470000
124800         SELECT                                                   12480000
124900                PI.SKU_SEQ_NBR                                    12490000
125000               ,PI.APP_PO_LNE_NBR                                 12500000
125100               ,PI.CL_NBR                                         12510000
125200               ,PI.VEND_STYL_NAME                                 12520000
125300               ,PI.ITM_NBR                                        12530000
125400               ,PQ.PAY_REQ_LNE_QTY                                12540000
125500               ,PQ.UNT_COST_AMT                                   12550000
125600               ,PQ.PAYT_REQ_LNE_NBR                               12560000
125700           FROM TPURITM PI                                        12570000
125800               ,TPREQIT PQ                                        12580000
125900               ,TMIITEM II                                        12590000
126000           WHERE PI.PO_NBR = :PV-PO-BEING-PROCESSED               12600000
126100             AND PQ.PAYT_REQ_SEQ_NBR = :INVOIC-PAYT-REQ-SEQ-NBR   12610000
126200             AND PQ.PAYT_REQ_SEQ_NBR = II.PAYT_REQ_SEQ_NBR        12620000
126300             AND PQ.PAYT_REQ_LNE_NBR = II.PAYT_REQ_LNE_NBR        12630000
126400             AND PI.VER_STATUS_CDE = 'A'                          12640000
126500             AND PI.PO_LNE_NBR = II.PO_LNE_NBR                    12650000
126600             AND II.PO_LNE_NBR IS NOT NULL                        12660000
126700     END-EXEC.                                                    12670000
126800/                                                                 12680000
126900*---------------------------------------------------------------- 12690000
127000* RI_NULL_CSR GETS ALL THE PURCHASE ITEM INFORMATION FOR THE      12700000
127100*        REMAINDER INVOICE AND THE UPC CODE FROM THE VENDOR       12710000
127200*        INVOICE TABLE WHERE THE PO LINE NUMBER IS NULL.          12720000
127300*---------------------------------------------------------------- 12730000
127400     EXEC SQL                                                     12740000
127500       DECLARE RI_NULL_CSR CURSOR FOR                             12750000
127600         SELECT                                                   12760000
127700                PQ.PAY_REQ_LNE_QTY                                12770000
127800               ,PQ.UNT_COST_AMT                                   12780000
127900               ,PQ.PAYT_REQ_LNE_NBR                               12790000
128000           FROM TPREQIT PQ                                        12800000
128100               ,TMIITEM II                                        12810000
128200           WHERE PQ.PAYT_REQ_SEQ_NBR = :INVOIC-PAYT-REQ-SEQ-NBR   12820000
128300             AND PQ.PAYT_REQ_SEQ_NBR = II.PAYT_REQ_SEQ_NBR        12830000
128400             AND PQ.PAYT_REQ_LNE_NBR = II.PAYT_REQ_LNE_NBR        12840000
128500             AND II.PO_LNE_NBR IS NULL                            12850000
128600     END-EXEC.                                                    12860000
128700/                                                                 12870000
128800*---------------------------------------------------------------- 12880000
128900*  VND_CSV_CSR GETS ALL THE ENT_ID FROM VNT_VND_CPBL TABLE        12890000
129000*  WHICH HAS THE CPBL CODE AS CSV                                 12900000
129100*---------------------------------------------------------------- 12910000
129200     EXEC SQL                                                     12920000
129300       DECLARE VND_CSV_CSR CURSOR FOR                             12930000
129400         SELECT A.ENT_ID                                          12940000
129500           FROM VNT_VND_CPBL A                                    12950000
129600         WHERE VND_CPBL_CDE = 'CSV'                               12960000
129700         AND EFF_BEG_DTE <= CURRENT DATE                          12970000
129800         AND EFF_END_DTE >= CURRENT DATE                          12980000
129900     END-EXEC.                                                    12990000
130000/                                                                 13000000
130100*---------------------------------------------------------------- 13010000
130200*  WORKING STORAGE AREA FOR APPD052                               13020000
130300*---------------------------------------------------------------- 13030000
130400     COPY APWS052.                                                13040000
130500/                                                                 13050000
130600*---------------------------------------------------------------- 13060000
130700*  WORKING STORAGE AREA FOR APPD051                               13070000
130800*---------------------------------------------------------------- 13080000
130900     COPY APWS051.                                                13090000
131000/                                                                 13100000
131100*---------------------------------------------------------------- 13110000
131200*  WORKING STORAGE AREA FOR DPKUP151                              13120000
131300*---------------------------------------------------------------- 13130000
131400     COPY APWS151.                                                13140000
131500/                                                                 13150000
131600*---------------------------------------------------------------- 13160000
131700*  WORKING STORAGE AREA FOR DPKUT500                              13170000
131800*---------------------------------------------------------------- 13180000
131900     COPY DPWS500.                                                13190000
132000*---------------------------------------------------------------- 13200000
132100*  WORKING STORAGE AREA SEPHORA AT KOHLS CODE                     13210000
132200*---------------------------------------------------------------- 13220000
132300     COPY APWS021.                                                13230000
132400*---------------------------------------------------------------- 13240000
132500*  ABEND DATA AREAS                                               13250000
132600*---------------------------------------------------------------- 13260000
132700 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          13270000
132800                                             COMP SYNC.           13280000
132900     88  AC-BAD-DATA                         VALUES +4008.        13290000
133000     88  AC-TABLE-OVERFLOW                   VALUE +4004.         13300000
133100     88  AC-DB2-ERROR                        VALUE +4013.         13310000
133200     88  AC-NO-INVOICES-ERROR                VALUE +4020.         13320000
133300                                                                  13330000
133400                                                                  13340000
133500 01  ABEND-AREAS.                                                 13350000
133600     05  AA-ABEND-LIT            PIC  X(40)  VALUE                13360000
133700             '*****       ABEND'.                                 13370000
133800     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                13380000
133900             '*****   PROGRAM: APKUP253'.                         13390000
134000     05  AA-PARAGRAPH-LIT.                                        13400000
134100         10  FILLER              PIC  X(17)  VALUE                13410000
134200             '***** PARAGRAPH: '.                                 13420000
134300         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        13430000
134400     05  AA-MESSAGE-LINE.                                         13440000
134500         10  FILLER              PIC  X(06)  VALUE '*****'.       13450000
134600         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        13460000
134700         10  FILLER REDEFINES AA-MESSAGE.                         13470000
134800             15 AA-MESSAGE-1     PIC  X(45).                      13480000
134900             15 AA-MESSAGE-2     PIC  X(45).                      13490000
135000             15 AA-MESSAGE-3     PIC  X(37).                      13500000
135100     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                13510000
135200             '*****    DB2 ERROR'.                                13520000
135300     05  AA-DB2-OPERATION-LIT.                                    13530000
135400         10  FILLER              PIC  X(17)  VALUE                13540000
135500             '***** OPERATION: '.                                 13550000
135600         10  AA-DB2-OPERATION.                                    13560000
135700             15  AA-DB2-OP-1     PIC  X(50)  VALUE SPACES.        13570000
135800             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        13580000
135900     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        13590000
136000     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        13600000
136100     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        13610000
136200     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        13620000
136300     05  AA-DB2-TABLE-5          PIC  X(08)  VALUE SPACES.        13630000
136400                                                                  13640000
136500/                                                                 13650000
136600     COPY DPWS004.                                                13660000
136700 01  FILLER                      PIC  X(25)  VALUE                13670000
136800     '** END OF APKUP253 W/S **'.                                 13680000
136900/                                                                 13690000
137000 PROCEDURE DIVISION.                                              13700000
137100                                                                  13710000
137200     PERFORM A100-MAINLINE.                                       13720000
137300     GOBACK.                                                      13730000
137400                                                                  13740000
137500/                                                                 13750000
137600 A100-MAINLINE.                                                   13760000
137700                                                                  13770000
137800     MOVE 'A100-MAINLINE' TO PV-CURRENT-PARAGRAPH.                13780000
137900                                                                  13790000
138000     PERFORM B100-INITIALIZE.                                     13800000
138100                                                                  13810000
138200     PERFORM B200-RETRIEVE-INPUT-POS                              13820000
138300       UNTIL OUT-OF-POS.                                          13830000
138400                                                                  13840000
138500     PERFORM B500-END-PROGRAM.                                    13850000
138600                                                                  13860000
138700/                                                                 13870000
138800*---------------------------------------------------------------- 13880000
138900*    INITIALIZATION PROCESSING                                    13890000
139000*    CALLED FROM A100-MAIN                                        13900000
139100*---------------------------------------------------------------- 13910000
139200 B100-INITIALIZE.                                                 13920000
139300                                                                  13930000
139400     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              13940000
139500                                                                  13950000
139600     INITIALIZE DCLTAPCNTL                                        13960000
139700                DCLTPOSTRR                                        13970000
139800                DCLTPRCCLM                                        13980000
139900                DCLTINVOIC                                        13990000
140000                DCLTMDINVC                                        14000000
140100                DCLTMIITEM                                        14010000
140200                DCLTPOAGMT                                        14020000
140300                DCLTPAYTRM                                        14030000
140400                DCLTINVCTM                                        14040000
140500                DCLTALCHRG                                        14050000
140600                DCLTPURCHS                                        14060000
140700                DCLTPURITM                                        14070000
140800                DCLTPREQIT                                        14080000
140900                DCLTENTNME                                        14090000
141000                DCLTEXTENT                                        14100000
141100                DCLTVNDDPT                                        14110000
141200                DCLTAPVNDS                                        14120000
141300                DCLTTRNCDE                                        14130000
141400                DCLTAPDSRP                                        14140000
141500                DCLTUPCSKU                                        14150000
141600                DCLTCKRSTCNTL                                     14160000
141700                DCLTCKRSTINF                                      14170000
141800                DCLTOUTAPE                                        14180000
141900                DCLTOUTAP2                                        14190000
142000                DCLTOUTAPI                                        14200000
142100                DCLTOUTAPJ                                        14210000
142110                DCLVNT00001.                                      14211000
142120                                                                  14212000
142130     INITIALIZE WS-HOLD-AREA                                      14213000
142140                PS-PROGRAM-SWITCHES.                              14214000
142150                                                                  14215000
142160     PERFORM R100-SELECT-CONTROL-DATA.                            14216000
142170                                                                  14217000
142180     MOVE APCNTL-BTCH-PRC-DTE TO PV-DB2-CURRENT-DATE              14218000
142190                                 PV-CURRENT-CCYYMMDD.             14219000
142200                                                                  14220000
142300     PERFORM Y300-OPEN-PO-CSR.                                    14230000
142400                                                                  14240000
142500     PERFORM Y950-GET-CSV-DATA.                                   14250000
142600*                                                                 14260000
142700*  SET UP FOR SEPHORA @ KOHLS                                     14270000
142800     MOVE PC-PROGRAM        TO SA-PROGRAM-NAME.                   14280000
142900     PERFORM S100-GET-SEPHORA-DEPT.                               14290000
143000                                                                  14300000
143100     PERFORM S400-GET-CHECKPOINT-CNTL.                            14310000
143200     MOVE PV-CKPT-STAT-CODE TO PS-RUN-TYPE-SW.                    14320000
143300                                                                  14330000
143400     IF RESTART-RUN                                               14340000
143500        PERFORM X200-CHECKPOINT-RESTART                           14350000
143600     ELSE                                                         14360000
143700        PERFORM R200-FETCH-RELEASED-POS                           14370000
143800     END-IF.                                                      14380000
143900                                                                  14390000
144000/                                                                 14400000
144100*---------------------------------------------------------------- 14410000
144200*  FETCHES THE PURCHASE ORDERS TO BE PROCESSED FROM POSTRR.       14420000
144300*---------------------------------------------------------------- 14430000
144400 B200-RETRIEVE-INPUT-POS.                                         14440000
144500                                                                  14450000
144600     MOVE 'B200-RETRIEVE-INPUT-POS' TO PV-CURRENT-PARAGRAPH.      14460000
144700                                                                  14470000
144800     IF MORE-POS                                                  14480000
144900         PERFORM B300-PROCESS-INPUT-POS                           14490000
145000     END-IF.                                                      14500000
145100                                                                  14510000
145200     INITIALIZE PS-PROGRAM-SWITCHES.                              14520000
145300                                                                  14530000
145400     PERFORM R200-FETCH-RELEASED-POS.                             14540000
145500/                                                                 14550000
145600*---------------------------------------------------------------- 14560000
145700*    CONTROLS THE PROCESSING OF EACH PO.                          14570000
145800*---------------------------------------------------------------- 14580000
145900 B300-PROCESS-INPUT-POS.                                          14590000
146000                                                                  14600000
146100     MOVE 'B300-PROCESS-INPUT-POS' TO PV-CURRENT-PARAGRAPH.       14610000
146200                                                                  14620000
146300                                                                  14630000
146400     IF  POSTRR-PO-NBR = PV-PO-BEING-PROCESSED                    14640000
146500         CONTINUE                                                 14650000
146600     ELSE                                                         14660000
146700         INITIALIZE HOLD-PO-AREA                                  14670000
146800         MOVE POSTRR-PO-NBR  TO PV-PO-BEING-PROCESSED             14680000
146900         PERFORM R800-GET-DEPT-DUNS-DATA                          14690000
147000         PERFORM R850-GET-VENDOR-NAME                             14700000
147100         PERFORM Y940-SET-CONSIGNMENT-SW                          14710000
147110         MOVE PURCHS-ENT-ID        TO PV-ENT-ID                   14711000
147120         MOVE PURCHS-DEPT-NBR      TO PV-DEPT-NBR                 14712000
147130         PERFORM S500-CHECK-FOR-SEPHORA                           14713000
147140     END-IF.                                                      14714000
147150                                                                  14715000
147160     MOVE POSTRR-STR-NBR TO PV-STORE-BEING-PROCESSED.             14716000
147170     MOVE POSTRR-STR-NBR TO PV-NUMERIC-STORE.                     14717000
147180     MOVE POSTRR-MTCH-LVL-CDE                                     14718000
147190                          TO PV-MTCH-LVL-BEING-PROCESSED.         14719000
147200                                                                  14720000
147300     PERFORM T300-SET-FREIGHT-DISTRO.                             14730000
147400                                                                  14740000
147500* LOGIC ADDED FOR DIRECT SHIP COST TO SHIP PROJECT TO ENSURE      14750000
147600* ALL CONSUMER DIRECT SHIPPING CHARGES ARE PAID BY KOHLS.         14760000
147700* APKUP254 WILL ENSURE THESE COSTS ARE POSTED TO GL EXPENSE.      14770000
147800     IF PURCHS-PO-TYP-CDE = 'CD'                                  14780000
147900        MOVE ZERO TO AP-WS-VEND-FRT-PCT                           14790000
147910                     APPD052-VENDOR-FRT-AMT                       14791000
147920     END-IF.                                                      14792000
147930                                                                  14793000
147940     IF POSTRR-MTCH-LVL-CDE = 'P'                                 14794000
147950         MOVE +0     TO PV-STR-NBR-LOW                            14795000
147960                        PV-DC-NBR-LOW                             14796000
147970         MOVE +9999  TO PV-STR-NBR-HIGH                           14797000
147980                        PV-DC-NBR-HIGH                            14798000
147990     ELSE                                                         14799000
148000         IF POSTRR-MTCH-LVL-CDE = 'S'                             14800000
148100             MOVE POSTRR-STR-NBR   TO PV-STR-NBR-LOW              14810000
148200                                      PV-STR-NBR-HIGH             14820000
148300             MOVE +0               TO PV-DC-NBR-LOW               14830000
148400             MOVE +9999            TO PV-DC-NBR-HIGH              14840000
148500         ELSE                                                     14850000
148600             MOVE POSTRR-STR-NBR   TO PV-DC-NBR-LOW               14860000
148700                                      PV-DC-NBR-HIGH              14870000
148800             MOVE +0               TO PV-STR-NBR-LOW              14880000
148900             MOVE +9999            TO PV-STR-NBR-HIGH             14890000
149000         END-IF                                                   14900000
149100     END-IF.                                                      14910000
149200                                                                  14920000
149300     PERFORM Y100-OPEN-INVOICE-CSR.                               14930000
149400                                                                  14940000
149500     PERFORM R300-FETCH-INVOICES.                                 14950000
149600*                                                                 14960000
149700*    THE FIRST FETCH SHOULD ALWAYS RETURN AN INVOICE.             14970000
149800*    IF NO INVOICE RETRIEVED FOR A PO, ABEND.                     14980000
149900*                                                                 14990000
150000     IF OUT-OF-INVOICES                                           15000000
150100         MOVE PV-CURRENT-PARAGRAPH           TO AA-PARAGRAPH-NAME 15010000
150200         MOVE 'NO INVOICES RETRIEVED FOR PO' TO AA-DB2-OP-1       15020000
150300         MOVE PV-PO-BEING-PROCESSED          TO AA-DB2-OP-2       15030000
150400         MOVE 'TINVOIC'                      TO AA-DB2-TABLE-1    15040000
150500         MOVE 'TMDINVC'                      TO AA-DB2-TABLE-2    15050000
150600         SET AC-NO-INVOICES-ERROR TO TRUE                         15060000
150700         PERFORM Z994-NO-INVOICES-ABEND                           15070000
150800     ELSE                                                         15080000
150900         IF POSTRR-CRE-PRC-CDE = PC-ONLINE OR PC-AUTO             15090000
151000             SET WRITE-RECON-RESULTS TO TRUE                      15100000
151100             PERFORM P800-CREATE-RECON-RESULTS-VEND               15110000
151200         ELSE                                                     15120000
151300             SET DO-NOT-WRITE-RECON-RESULTS TO TRUE               15130000
151400         END-IF                                                   15140000
151500         PERFORM C100-PROCESS-INVOICES                            15150000
151600           UNTIL OUT-OF-INVOICES                                  15160000
151700     END-IF.                                                      15170000
151800                                                                  15180000
151900     PERFORM Y110-CLOSE-INVOICE-CSR.                              15190000
152000                                                                  15200000
152100     IF POSTRR-CRE-PRC-CDE = PC-ONLINE OR PC-AUTO                 15210000
152200         IF PRCCLM-FOUND                                          15220000
152300             PERFORM P960-CREATE-POSTR-PRCLM-RECORD               15230000
152400         END-IF                                                   15240000
152500     END-IF.                                                      15250000
152600                                                                  15260000
152700     SET NO-PRCCLM-FOUND TO TRUE.                                 15270000
152800                                                                  15280000
152900     PERFORM C200-PROCESS-REMAINDER-INV.                          15290000
153000     PERFORM X100-CHECKPOINT-COMMIT.                              15300000
153100                                                                  15310000
153200/                                                                 15320000
153300*---------------------------------------------------------------- 15330000
153400*    ENDING PROCESSING: DISPLAYS COUNT OF POS AND CLOSES FILES.   15340000
153500*    CALLED FROM A100-MAIN                                        15350000
153600*---------------------------------------------------------------- 15360000
153700 B500-END-PROGRAM.                                                15370000
153800                                                                  15380000
153900     MOVE 'B500-END-PROGRAM' TO PV-CURRENT-PARAGRAPH.             15390000
154000                                                                  15400000
154100     MOVE PA-PO-COUNT      TO PA-PO-COUNT-9.                      15410000
154200     MOVE PA-INVOICE-COUNT TO PA-INVOICE-COUNT-9.                 15420000
154300                                                                  15430000
154400     DISPLAY 'NBR OF POS READ FROM TPOSTRR = ' PA-PO-COUNT-9.     15440000
154500     DISPLAY 'NBR OF INVOICES PROCESSED    = ' PA-INVOICE-COUNT-9.15450000
154600     DISPLAY '                               '.                   15460000
154700     DISPLAY 'NBR OF UPCS NOT FOUND      = ' PA-UPC-NOT-FOUND-CNT.15470000
154800                                                                  15480000
154900     PERFORM Y310-CLOSE-PO-CSR.                                   15490000
155000                                                                  15500000
155100     MOVE PC-RUN-COMPLETE-CODE TO PV-CKPT-STAT-CODE.              15510000
155200     PERFORM U100-UPDATE-TCKRSTCNTL.                              15520000
155300     PERFORM U200-UPDATE-TCKRSTINF.                               15530000
155400     PERFORM U300-COMMIT.                                         15540000
155500                                                                  15550000
155600/                                                                 15560000
155700*---------------------------------------------------------------- 15570000
155800*    CONTROLS THE PROCESSING OF EACH PO INVOICE                   15580000
155900*---------------------------------------------------------------- 15590000
156000 C100-PROCESS-INVOICES.                                           15600000
156100                                                                  15610000
156200     MOVE 'C100-PROCESS-INVOICES' TO PV-CURRENT-PARAGRAPH.        15620000
156300                                                                  15630000
156400     PERFORM D100-HOLD-INVOICE-DATA.                              15640000
156500                                                                  15650000
156600     INITIALIZE APPD052-VARIABLES.                                15660000
156700     MOVE AP-WS-VEND-FRT-PCT    TO APPD052-CALC-FRT-PCT.          15670000
156800     MOVE INVOIC-GRO-COST-AMT   TO APPD052-GROSS-INVOICE-COST.    15680000
156900     MOVE HOLD-DUNS-NO          TO APPD052-VENDOR-EXCEPTION.      15690000
157000     SET ALW-CHRG-NOT-PROCESSED TO TRUE.                          15700000
157100                                                                  15710000
157200     PERFORM Y200-OPEN-CHARGE-CODE-CSR.                           15720000
157300                                                                  15730000
157400     PERFORM D200-PROCESS-ALW-CHRG                                15740000
157500       UNTIL ALW-CHRG-NOT-FOUND.                                  15750000
157600                                                                  15760000
157700     PERFORM Y210-CLOSE-CHARGE-CODE-CSR.                          15770000
157800                                                                  15780000
157900     IF POSTRR-CRE-PRC-CDE = PC-ONLINE                            15790000
158000         PERFORM D350-GET-PAYT-DUE-DATE-ONLINE                    15800000
158100     ELSE                                                         15810000
158200         PERFORM D300-GET-PAYT-DUE-DATE                           15820000
158300     END-IF.                                                      15830000
158400                                                                  15840000
158500     MOVE ZERO TO PV-DATE-SUB.                                    15850000
158600                                                                  15860000
158700     IF WRITE-RECON-RESULTS                                       15870000
158800         PERFORM D500-SUM-PREQIT-QTY                              15880000
158900         IF PA-PAY-REQ-QTY-NULL-IND = +1                          15890000
159000            MOVE ZEROS TO PA-PAY-REQ-QTY-TOT                      15900000
159100         END-IF                                                   15910000
159200         PERFORM P810-CREATE-RECON-RESULTS-INV                    15920000
159300     END-IF.                                                      15930000
159400                                                                  15940000
159500     PERFORM P700-CREATE-INV-PS-INTERFACE.                        15950000
159600                                                                  15960000
159700     PERFORM P900-CREATE-STATUS-UPDT-RECORD.                      15970000
159800     PERFORM P950-CREATE-POSTR-INV-RECORD.                        15980000
159900                                                                  15990000
160000     IF POSTRR-CRE-PRC-CDE = PC-ONLINE OR PC-AUTO                 16000000
160100         PERFORM R960-SELECT-PRICE-CLAIM-ADJ                      16010000
160200         IF PRCCLM-RECORD                                         16020000
160300             SET PRCCLM-ADJUST TO TRUE                            16030000
160400             PERFORM Q200-PROCESS-PRCCLM-DISCOUNTS                16040000
160500             PERFORM P725-CREATE-RI-IMPORT-ADJS                   16050000
160600             ADD PV-PRCCLM-AMT   TO PV-TOT-PRCCLM                 16060000
160700         END-IF                                                   16070000
160800     END-IF.                                                      16080000
160900                                                                  16090000
161000     PERFORM D400-INVOICE-ADJUSTMENTS.                            16100000
161100     PERFORM R300-FETCH-INVOICES.                                 16110000
161200/                                                                 16120000
161300*---------------------------------------------------------------- 16130000
161400*    PROCESSES ANY REMAINDER INVOICE ADJUSTMENTS.                 16140000
161500*---------------------------------------------------------------- 16150000
161600 C200-PROCESS-REMAINDER-INV.                                      16160000
161700                                                                  16170000
161800     MOVE 'C200-PROCESS-REMAINDER-INV' TO PV-CURRENT-PARAGRAPH.   16180000
161900                                                                  16190000
162000     MOVE HOLD-EARLIEST-DUE-DATE TO HOLD-DUE-DATE-CCYYMMDD.       16200000
162100                                                                  16210000
162200     PERFORM R400-SELECT-REMAINDER-INV.                           16220000
162300                                                                  16230000
162400     IF REMAINDER-INV-FOUND                                       16240000
162500         SET REMAINDER-INVOICE TO TRUE                            16250000
162600                                                                  16260000
162700* GET THE ALW/CHG AMOUNTS RELEVANT TO THE REMAINDER INVOICE       16270000
162800         INITIALIZE APPD052-VARIABLES                             16280000
162900         MOVE AP-WS-VEND-FRT-PCT    TO APPD052-CALC-FRT-PCT       16290000
163000         MOVE INVOIC-GRO-COST-AMT   TO APPD052-GROSS-INVOICE-COST 16300000
163100         MOVE HOLD-DUNS-NO          TO APPD052-VENDOR-EXCEPTION   16310000
163200         SET ALW-CHRG-NOT-PROCESSED TO TRUE                       16320000
163300         PERFORM Y200-OPEN-CHARGE-CODE-CSR                        16330000
163400         PERFORM D200-PROCESS-ALW-CHRG                            16340000
163500           UNTIL ALW-CHRG-NOT-FOUND                               16350000
163600         PERFORM Y210-CLOSE-CHARGE-CODE-CSR                       16360000
163700                                                                  16370000
163800         PERFORM E550-PROCESS-INVOICE-TERMS                       16380000
163900                                                                  16390000
164000         MOVE 999 TO PV-DEFAULT-LINE-NBR                          16400000
164100         PERFORM E300-CONVERT-INVOICE-ID                          16410000
164200         PERFORM P725-CREATE-RI-IMPORT-ADJS                       16420000
164300         PERFORM Y500-OPEN-RI-CSR                                 16430000
164400         PERFORM P450-CREATE-RI-LINE-NBR-SEG                      16440000
164500           UNTIL OUT-OF-RI-PO-LINES                               16450000
164600         PERFORM Y510-CLOSE-RI-CSR                                16460000
164700         PERFORM Y600-OPEN-RI-NULL-CSR                            16470000
164800         PERFORM P460-CREATE-RI-NULL-LINE-SEG                     16480000
164900           UNTIL OUT-OF-RI-NULL-LINES                             16490000
165000         PERFORM Y610-CLOSE-RI-NULL-CSR                           16500000
165100         PERFORM P955-CREATE-POSTR-RINV-RECORD                    16510000
165200     END-IF.                                                      16520000
165300                                                                  16530000
165400/                                                                 16540000
165500*---------------------------------------------------------------- 16550000
165600*    CONTROLS THE PROCESSING FOR EACH RELEASED FOR PAYMENT        16560000
165700*    INVOICE.                                                     16570000
165800*---------------------------------------------------------------- 16580000
165900 D100-HOLD-INVOICE-DATA.                                          16590000
166000                                                                  16600000
166100     MOVE 'D100-HOLD-INVOICE-DATA' TO PV-CURRENT-PARAGRAPH.       16610000
166200                                                                  16620000
166300     INITIALIZE HOLD-INVOICE-AREA.                                16630000
166400                                                                  16640000
166500     MOVE INVOIC-INVC-ID  TO PV-INVC-ID-BEING-PROCESSED.          16650000
166600     MOVE INVOIC-INVC-DTE TO HOLD-DOC-DATE-CCYYMMDD.              16660000
166700                                                                  16670000
166800                                                                  16680000
166900     PERFORM E300-CONVERT-INVOICE-ID.                             16690000
167000                                                                  16700000
167100     IF INVOIC-HOLD-IND = 'Y' OR PS-CSV-VENDOR                    16710000
167200         SET HOLD-PYMT-HOLD TO TRUE                               16720000
167300     ELSE                                                         16730000
167400         SET HOLD-NO-PYMT-HOLD TO TRUE                            16740000
167500     END-IF.                                                      16750000
167600                                                                  16760000
167700/                                                                 16770000
167800*---------------------------------------------------------------- 16780000
167900*    CONTROLS THE PROCESSING FOR EACH ALLOWANCE/CHARGE RETRIEVED  16790000
168000*    FOR THE INVOICE.                                             16800000
168100*---------------------------------------------------------------- 16810000
168200 D200-PROCESS-ALW-CHRG.                                           16820000
168300                                                                  16830000
168400     MOVE 'D200-PROCESS-ALW-CHRG' TO PV-CURRENT-PARAGRAPH.        16840000
168500                                                                  16850000
168600     PERFORM R500-FETCH-ALW-CHRG.                                 16860000
168700                                                                  16870000
168800     IF ALW-CHRG-PROCESS                                          16880000
168900         PERFORM E100-CALC-ALW-CHRG                               16890000
169000     END-IF.                                                      16900000
169100                                                                  16910000
169200/                                                                 16920000
169300*---------------------------------------------------------------- 16930000
169400*    CALLS ROUTINES TO GET THE TERMS, PAYMENT DUE DATE, AND       16940000
169500*    RECONCILIATION CUTOFF DATE FOR PO/STORES RECONCILED VIA      16950000
169600*    THE BATCH RUN PROCESSING.                                    16960000
169700*---------------------------------------------------------------- 16970000
169800 D300-GET-PAYT-DUE-DATE.                                          16980000
169900                                                                  16990000
170000     MOVE INVOIC-CALC-DUE-DTE       TO HOLD-DUE-DATE-CCYYMMDD.    17000000
170100     MOVE HOLD-DUE-DATE-MO          TO HOLD-DUE-DATE-MM.          17010000
170200     MOVE HOLD-DUE-DATE-DA          TO HOLD-DUE-DATE-DD.          17020000
170300     MOVE HOLD-DUE-DATE-YR          TO HOLD-DUE-DATE-YY.          17030000
170400                                                                  17040000
170500     IF HOLD-EARLIEST-DUE-DATE > HOLD-DUE-DATE-CCYYMMDD           17050000
170600       OR HOLD-EARLIEST-DUE-DATE = SPACES                         17060000
170700         MOVE HOLD-DUE-DATE-CCYYMMDD TO HOLD-EARLIEST-DUE-DATE    17070000
170800     END-IF.                                                      17080000
170900                                                                  17090000
171000     IF MDINVC-TERM-SEL-CDE = PC-PURCHASE-TERMS                   17100000
171100         PERFORM E500-PROCESS-PO-TERMS                            17110000
171200     ELSE                                                         17120000
171300         IF MDINVC-TERM-SEL-CDE = PC-INVOICE-TERMS                17130000
171400             PERFORM E550-PROCESS-INVOICE-TERMS                   17140000
171500         END-IF                                                   17150000
171600     END-IF.                                                      17160000
171700                                                                  17170000
171800/                                                                 17180000
171900*---------------------------------------------------------------- 17190000
172000*    CALLS ROUTINES TO GET THE TERMS, PAYMENT DUE DATE, AND       17200000
172100*    RECONCILIATION CUTOFF DATE FOR PO/STORES RECONCILED ONLINE   17210000
172200*    SINCE THE CALC-DUE-DTE FIELD IS NOT CALCULATED IN THE ONLINE.17220000
172300*---------------------------------------------------------------- 17230000
172400 D350-GET-PAYT-DUE-DATE-ONLINE.                                   17240000
172500                                                                  17250000
172600     IF MDINVC-TERM-SEL-CDE = PC-PURCHASE-TERMS                   17260000
172700         PERFORM E500-PROCESS-PO-TERMS                            17270000
172800     ELSE                                                         17280000
172900         IF MDINVC-TERM-SEL-CDE = PC-INVOICE-TERMS                17290000
173000             PERFORM E550-PROCESS-INVOICE-TERMS                   17300000
173100         END-IF                                                   17310000
173200     END-IF.                                                      17320000
173300                                                                  17330000
173400     MOVE INVOIC-INVC-DTE            TO APPD051-INVOICE-DATE.     17340000
173500     MOVE PS-END-OF-MONTH-SW         TO APPD051-EOM-IND.          17350000
173600     MOVE PS-END-OF-MONTH-SW         TO HOLD-DISC-EOM.            17360000
173700                                                                  17370000
173800     SET NO-VENDOR-CONTROLS         TO TRUE                       17380000
173900     PERFORM R940-CHECK-VENDOR-CONTROLS.                          17390000
174000                                                                  17400000
174100     IF VENDOR-CONTROLS                                           17410000
174200         MOVE APVNDS-PAYT-FLOAT-DAY-QTY TO APPD051-FLOAT-DAYS     17420000
174300     ELSE                                                         17430000
174400         MOVE APCNTL-PAYT-FLOAT-DAY-QTY TO APPD051-FLOAT-DAYS     17440000
174500     END-IF.                                                      17450000
174600                                                                  17460000
174700     PERFORM E600-CALC-DUE-DATE.                                  17470000
174800                                                                  17480000
174900     MOVE APPD051-RETURN-DATE-CCYY-MM-DD TO                       17490000
175000                                     HOLD-DUE-DATE-CCYYMMDD.      17500000
175100                                                                  17510000
175200     MOVE HOLD-DUE-DATE-MO           TO HOLD-DUE-DATE-MM.         17520000
175300     MOVE HOLD-DUE-DATE-DA           TO HOLD-DUE-DATE-DD.         17530000
175400     MOVE HOLD-DUE-DATE-YR           TO HOLD-DUE-DATE-YY.         17540000
175500                                                                  17550000
175600     IF HOLD-EARLIEST-DUE-DATE > HOLD-DUE-DATE-CCYYMMDD           17560000
175700       OR HOLD-EARLIEST-DUE-DATE = SPACES                         17570000
175800         MOVE HOLD-DUE-DATE-CCYYMMDD TO HOLD-EARLIEST-DUE-DATE    17580000
175900     END-IF.                                                      17590000
176000     PERFORM U800-UPDATE-TINVOIC.                                 17600000
176100                                                                  17610000
176200/                                                                 17620000
176300*---------------------------------------------------------------- 17630000
176400*    CONTROLS THE PROCESSING OF THE INVOICE RELATED ADJUSTMENTS:  17640000
176500*    (1) PRICE CLAIM ADJUSTMENTS, (2) FREIGHT ADJUSTMENTS,        17650000
176600*    (3) DNP ADJUSTMENTS, (4) WRITE-OFFS AND (5) IMPORT POS.      17660000
176700*---------------------------------------------------------------- 17670000
176800 D400-INVOICE-ADJUSTMENTS.                                        17680000
176900                                                                  17690000
177000     MOVE 'D400-INVOICE-ADJUSTMENTS' TO PV-CURRENT-PARAGRAPH.     17700000
177100                                                                  17710000
177200     SET INIT-ADJUSTMENTS                                         17720000
177300         MORE-PRCCLMS     TO TRUE.                                17730000
177400                                                                  17740000
177500     IF POSTRR-CRE-PRC-CDE = PC-ONLINE OR PC-AUTO                 17750000
177600         PERFORM Y400-OPEN-PRCCLM-CSR                             17760000
177700         EVALUATE TRUE                                            17770000
177800             WHEN OUT-OF-PRCCLMS                                  17780000
177900                 PERFORM Y410-CLOSE-PRCCLM-CSR                    17790000
178000             WHEN MORE-PRCCLMS                                    17800000
178100                 PERFORM E400-PROCESS-PRCCLM                      17810000
178200                   UNTIL OUT-OF-PRCCLMS                           17820000
178300                 PERFORM Y410-CLOSE-PRCCLM-CSR                    17830000
178400         END-EVALUATE                                             17840000
178500     END-IF.                                                      17850000
178600                                                                  17860000
178700     IF APPD052-VENDOR-FRT-AMT > ZEROES                           17870000
178800        SET FREIGHT-ADJUST TO TRUE                                17880000
178900        PERFORM P750-CREATE-ADJ-PS-INTERFACE                      17890000
179000     END-IF.                                                      17900000
179100                                                                  17910000
179200*---------------------------------------------------------------- 17920000
179300*  REMOVED THIS BECAUSE THE CALCULATION IS ALREADY BEING DONE IN  17930000
179400*  P950 WHEN THE AP058 RECORD IS CREATED.  GROUPED THE CONDITION  17940000
179500*  OF PV-DS-DIFFERENCE-AMT > ZERO WITH THE OTHER DNP CHARGES BELOW17950000
179600*  BECAUSE WHEN THERE WAS BOTH A DIFFERENCE AND A GIFT WRAP CHARGE17960000
179700*  THE DNP DEDUCTION WAS BEING CREATED TWICE.  INC000000753839    17970000
179800*                                                                 17980000
179810*    IF APPD052-CD-HANDLING-AMT > ZERO                            17981000
179820*       PERFORM E700-DIRECT-SHIP-CALCULATION                      17982000
179830*       IF APPD052-CD-HANDLING-AMT > PV-DS-ALLOWED-AMT            17983000
179840*          SUBTRACT PV-DS-ALLOWED-AMT FROM APPD052-CD-HANDLING-AMT17984000
179850*            GIVING PV-DS-DIFFERENCE-AMT                          17985000
179860*          SET DNP-CHARGE             TO TRUE                     17986000
179870*          PERFORM P750-CREATE-ADJ-PS-INTERFACE                   17987000
179880*       END-IF                                                    17988000
179890*    END-IF.                                                      17989000
179900                                                                  17990000
180000     IF APPD052-DNP-CHARGES > ZERO                                18000000
180100     OR PV-DS-DIFFERENCE-AMT > ZERO                               18010000
180200     OR APPD052-CD-GIFT-WRAP-AMT > ZERO                           18020000
180300        SET DNP-CHARGE     TO TRUE                                18030000
180400        PERFORM P750-CREATE-ADJ-PS-INTERFACE                      18040000
180500     END-IF.                                                      18050000
180600                                                                  18060000
180700     MOVE ZERO TO PV-DS-ALLOWED-AMT.                              18070000
180800     MOVE ZERO TO PV-DS-DIFFERENCE-AMT.                           18080000
180900                                                                  18090000
181000     IF INVOIC-INVC-TYP-CDE = PC-WO-TYPE                          18100000
181100        SET UNJ-WRITE-OFF  TO TRUE                                18110000
181200        PERFORM P750-CREATE-ADJ-PS-INTERFACE                      18120000
181300     ELSE                                                         18130000
181400        IF PV-PO-TYP-IMPORT                                       18140000
181500           SET IMPORT-PO      TO TRUE                             18150000
181600           PERFORM P725-CREATE-RI-IMPORT-ADJS                     18160000
181700        END-IF                                                    18170000
181800     END-IF.                                                      18180000
181900                                                                  18190000
182000/                                                                 18200000
182100*---------------------------------------------------------------- 18210000
182200*    RETRIEVES THE SUM OF THE LINE QUANTITY ON THE TPREQIT TABLE. 18220000
182300*---------------------------------------------------------------- 18230000
182400 D500-SUM-PREQIT-QTY.                                             18240000
182500                                                                  18250000
182600     EXEC SQL                                                     18260000
182700         SELECT  SUM(PAY_REQ_LNE_QTY)                             18270000
182800         INTO                                                     18280000
182900             :PA-PAY-REQ-QTY-TOT                                  18290000
183000                 :PA-PAY-REQ-QTY-NULL-IND                         18300000
183100         FROM TPREQIT                                             18310000
183200         WHERE                                                    18320000
183300            PAYT_REQ_SEQ_NBR =  :INVOIC-PAYT-REQ-SEQ-NBR          18330000
183400     END-EXEC.                                                    18340000
183500                                                                  18350000
183600     EVALUATE TRUE                                                18360000
183700         WHEN SQLCODE = ZERO                                      18370000
183800              CONTINUE                                            18380000
183900                                                                  18390000
184000         WHEN SQLWARN0 NOT = SPACES                               18400000
184100         WHEN SQLCODE  NOT = ZERO                                 18410000
184200         MOVE PV-CURRENT-PARAGRAPH                                18420000
184300                            TO AA-PARAGRAPH-NAME                  18430000
184400         MOVE 'UNSUCCESSFUL SELECT OF PREQIT TBL         '        18440000
184500                            TO AA-DB2-OP-1                        18450000
184600         MOVE 'TPREQIT'     TO AA-DB2-TABLE-1                     18460000
184700         MOVE SPACES        TO AA-DB2-TABLE-2                     18470000
184800                               AA-DB2-TABLE-3                     18480000
184900                               AA-DB2-TABLE-4                     18490000
185000                               AA-DB2-TABLE-5                     18500000
185100         PERFORM Z998-DB2-ABEND                                   18510000
185200     END-EVALUATE.                                                18520000
185300                                                                  18530000
185400/                                                                 18540000
185500*---------------------------------------------------------------- 18550000
185600*    PERFORMS THE COPYBOOK SUBROUTINE THAT IS USED TO CALCULATE   18560000
185700*    THE NEW STORE DISCOUNT PERCENT, TRADE DISCOUNT PERCENT,      18570000
185800*    ALLOWANCE AMOUNT, DNP CHARGES, MISCELLANEOUS CHARGES AND     18580000
185900*    FREIGHT CHARGES.                                             18590000
186000*---------------------------------------------------------------- 18600000
186100 E100-CALC-ALW-CHRG.                                              18610000
186200                                                                  18620000
186300     MOVE 'E100-CALC-ALW-CHRG' TO PV-CURRENT-PARAGRAPH.           18630000
186400                                                                  18640000
186500     PERFORM CALC-ALW-CHRG.                                       18650000
186600                                                                  18660000
186700     COPY APPD052.                                                18670000
186800/                                                                 18680000
186900*---------------------------------------------------------------- 18690000
187000*    CONVERTS THE INVOICE ID FOR THE USE AS THE DOC NUMBER FOR    18700000
187100*    ADJUSTMENTS.  IT LEFT-JUSTIFIES THE NUMBER AND USES THE FIRST18710000
187200*    16 CHARACTERS OF THE INVOICE ID.  THIS IS BECAUSE THE DOC    18720000
187300*    NUMBER IS ONLY 16 CHARACTERS LONG.                           18730000
187400*---------------------------------------------------------------- 18740000
187500 E300-CONVERT-INVOICE-ID.                                         18750000
187600                                                                  18760000
187700     MOVE 'E300-CONVERT-INVOICE-ID' TO PV-CURRENT-PARAGRAPH.      18770000
187800                                                                  18780000
187900     MOVE LENGTH OF INVOIC-INVC-ID   TO PV-START.                 18790000
188000     PERFORM                                                      18800000
188100         UNTIL INVOIC-INVC-ID (PV-START:1) > SPACES OR            18810000
188200               PV-START = +0                                      18820000
188300         COMPUTE PV-START = PV-START - 1                          18830000
188400     END-PERFORM.                                                 18840000
188500     IF PV-START < 16                                             18850000
188600         MOVE +1 TO PV-START                                      18860000
188700     ELSE                                                         18870000
188800         SUBTRACT +15 FROM PV-START                               18880000
188900     END-IF.                                                      18890000
189000     MOVE INVOIC-INVC-ID (PV-START:16)  TO HOLD-DOC-NO.           18900000
189100                                                                  18910000
189200/                                                                 18920000
189300*---------------------------------------------------------------- 18930000
189400*    PRICE CLAIM ADJUSTMENTS ARE EVALUATED AND RECORDS ARE        18940000
189500*    WRITTEN TO TABLE TAPDSRP FOR THE MEMORANDUMS AND THE         18950000
189600*    RECONCILIATION RESULTS OUTPUT TABLE (TOUTAP2).               18960000
189700*---------------------------------------------------------------- 18970000
189800 E400-PROCESS-PRCCLM.                                             18980000
189900                                                                  18990000
190000     MOVE 'E400-PROCESS-PRCCLM     ' TO PV-CURRENT-PARAGRAPH.     19000000
190100                                                                  19010000
190200     PERFORM R900-FETCH-PRICE-CLAIM-ADJ.                          19020000
190300                                                                  19030000
190400     IF OUT-OF-PRCCLMS                                            19040000
190500         CONTINUE                                                 19050000
190600     ELSE                                                         19060000
190700         COMPUTE PV-PRCCLM-DIFFERENCE = PRCCLM-ADJ-COST-AMT -     19070000
190800               PRCCLM-UNT-COST-AMT                                19080000
190900         IF PV-PRCCLM-DIFFERENCE < 0                              19090000
191000             COMPUTE PV-PRCCLM-DIFFERENCE =  -1 *                 19100000
191100                   PV-PRCCLM-DIFFERENCE                           19110000
191200         END-IF                                                   19120000
191300         MULTIPLY PRCCLM-UNT-QTY BY PV-PRCCLM-DIFFERENCE          19130000
191400             GIVING PV-PRCCLM-COST                                19140000
191500         PERFORM P400-CREATE-PRCCLM-LINE-NBR                      19150000
191600         PERFORM P820-CREATE-PRCCLM-RECON-RSLT                    19160000
191700     END-IF.                                                      19170000
191800                                                                  19180000
191900/                                                                 19190000
192000*---------------------------------------------------------------- 19200000
192100*    PREPARES THE PURCHASE ORDERS PAYMENT TERMS NEEDED TO         19210000
192200*    CALCULATE THE PAYMENT DUE DATE.                              19220000
192300*---------------------------------------------------------------- 19230000
192400 E500-PROCESS-PO-TERMS.                                           19240000
192500                                                                  19250000
192600     MOVE 'E500-PROCESS-PO-TERMS' TO PV-CURRENT-PARAGRAPH.        19260000
192700                                                                  19270000
192800     PERFORM R600-GET-PO-TERMS.                                   19280000
192900                                                                  19290000
193000     IF PAYTRM-DISCOUNT-PCT = ZERO                                19300000
193100         MOVE PAYTRM-DUE-DAY-QTY TO APPD051-DISCOUNT-DAYS         19310000
193200     ELSE                                                         19320000
193300         MOVE PAYTRM-DISCOUNT-DAYS-QTY TO APPD051-DISCOUNT-DAYS.  19330000
193400                                                                  19340000
193500     IF PAYTRM-DUE-DAY-FR-DTE-TXT = 'EOM'                         19350000
193600         SET END-OF-MONTH TO TRUE                                 19360000
193700     ELSE                                                         19370000
193800         SET NOT-END-OF-MONTH TO TRUE                             19380000
193900     END-IF.                                                      19390000
194000                                                                  19400000
194100     MOVE POAGMT-DISC-PAY-DAY-QTY  TO APPD051-EXTENDED-DAYS.      19410000
194200     MOVE PAYTRM-DISCOUNT-PCT      TO HOLD-DISC-PCT-DEC.          19420000
194300                                                                  19430000
194400/                                                                 19440000
194500*---------------------------------------------------------------- 19450000
194600*    PREPARES THE INVOICE PAYMENT TERMS NEEDED TO CALCULATE       19460000
194700*    THE PAYMENT DUE DATE.                                        19470000
194800*---------------------------------------------------------------- 19480000
194900 E550-PROCESS-INVOICE-TERMS.                                      19490000
195000                                                                  19500000
195100     MOVE 'E550-PROCESS-INVOICE-TERMS' TO PV-CURRENT-PARAGRAPH.   19510000
195200                                                                  19520000
195300     PERFORM R700-GET-INVOICE-TERMS.                              19530000
195400                                                                  19540000
195500     IF INVCTM-DISC-PCT = ZERO                                    19550000
195600         MOVE INVCTM-NET-DUE-DAY-QTY  TO APPD051-DISCOUNT-DAYS    19560000
195700     ELSE                                                         19570000
195800         MOVE INVCTM-DISC-DUE-DAY-QTY TO APPD051-DISCOUNT-DAYS.   19580000
195900                                                                  19590000
196000     IF INVCTM-TERM-TYP-CDE = '02'                                19600000
196100         SET END-OF-MONTH TO TRUE                                 19610000
196200     ELSE                                                         19620000
196300         SET NOT-END-OF-MONTH TO TRUE                             19630000
196400     END-IF.                                                      19640000
196500                                                                  19650000
196600     MOVE INVCTM-EXTD-DAYS-QTY    TO APPD051-EXTENDED-DAYS.       19660000
196700     MOVE INVCTM-DISC-PCT         TO HOLD-DISC-PCT-DEC.           19670000
196800/                                                                 19680000
196900*---------------------------------------------------------------- 19690000
197000*    PERFORMS THE COPYBOOK ROUTINE THAT CALCULATES THE PAYMENT    19700000
197100*    DUE DATE.                                                    19710000
197200*---------------------------------------------------------------- 19720000
197300 E600-CALC-DUE-DATE.                                              19730000
197400                                                                  19740000
197500     MOVE 'E600-CALC-DUE-DATE' TO PV-CURRENT-PARAGRAPH.           19750000
197600                                                                  19760000
197700     PERFORM CALC-PAYMENT-DUE-DATE.                               19770000
197800                                                                  19780000
197900     COPY APPD051.                                                19790000
198000/                                                                 19800000
198100                                                                  19810000
198200*---------------------------------------------------------------- 19820000
198300*    CALCULATE THE ALLOWED AMOUNT FROM VENDOR AGREEMENT BASED ON  19830000
198400*    FLAT RATE OR PERCENTAGE OF COST.                             19840000
198500*---------------------------------------------------------------- 19850000
198600 E700-DIRECT-SHIP-CALCULATION.                                    19860000
198700                                                                  19870000
198800     MOVE 'E700-DIRECT-SHIP-CALCULATION   ' TO                    19880000
198900            PV-CURRENT-PARAGRAPH.                                 19890000
199000                                                                  19900000
199100     EXEC SQL                                                     19910000
199200         SELECT  VN.CHRG_PCT,                                     19920000
199300                 VN.CHRG_FCTR_CDE,                                19930000
199400                 VN.CHRG_AMT                                      19940000
199500           INTO :VNDAGR-CHRG-PCT,                                 19950000
199600                :VNDAGR-CHRG-FCTR-CDE,                            19960000
199700                :VNDAGR-CHRG-AMT                                  19970000
199800           FROM  TVNDAGR VN                                       19980000
199900           WHERE VN.ENT_ID = :PURCHS-ENT-ID                       19990000
200000             AND VN.DEPT_NBR = :PURCHS-DEPT-NBR                   20000000
200100             AND VN.AGRMT_TYP_ID   = '4'                          20010000
200200             AND VN.TYP_CDE        =  10                          20020000
200300             AND :APCNTL-BTCH-PRC-DTE BETWEEN VN.EFFECTIVE_DATE   20030000
200400                                          AND VN.EXPIRATION_DATE  20040000
200500             AND VN.SEQ_NBR =                                     20050000
200600                 (SELECT MAX(VN.SEQ_NBR)                          20060000
200700                  FROM TVNDAGR VN                                 20070000
200800                  WHERE VN.ENT_ID = :PURCHS-ENT-ID                20080000
200900                  AND VN.DEPT_NBR = :PURCHS-DEPT-NBR              20090000
201000                  AND VN.AGRMT_TYP_ID   = '4'                     20100000
201100                  AND VN.TYP_CDE        =  10                     20110000
201200                AND :APCNTL-BTCH-PRC-DTE BETWEEN                  20120000
201300                                              VN.EFFECTIVE_DATE   20130000
201400                                          AND VN.EXPIRATION_DATE) 20140000
201500     END-EXEC.                                                    20150000
201600                                                                  20160000
201700     EVALUATE TRUE                                                20170000
201800        WHEN SQLCODE = ZERO                                       20180000
201900             IF VNDAGR-CHRG-FCTR-CDE = 'I'                        20190000
202000                MULTIPLY VNDAGR-CHRG-AMT BY                       20200000
202100                         MDINVC-TOT-INVC-PC-QTY                   20210000
202200                GIVING PV-DS-ALLOWED-AMT                          20220000
202300             ELSE                                                 20230000
202600                COMPUTE PV-DS-ALLOWED-AMT =                       20260005
202700                  (INVOIC-GRO-COST-AMT * VNDAGR-CHRG-PCT) + .005  20270005
202800             END-IF                                               20280000
202900        WHEN SQLCODE = +100                                       20290000
203000             CONTINUE                                             20300000
203100        WHEN SQLWARN0 NOT = SPACES                                20310000
203200        WHEN SQLCODE  NOT = ZERO                                  20320000
203300             MOVE PV-CURRENT-PARAGRAPH   TO AA-PARAGRAPH-NAME     20330000
203400             MOVE 'UNSUCCESSFUL SELECT'  TO AA-DB2-OPERATION      20340000
203500             MOVE 'TVNDAGR'              TO AA-DB2-TABLE-1        20350000
203600             MOVE SPACES                 TO AA-DB2-TABLE-2        20360000
203700             MOVE SPACES                 TO AA-DB2-TABLE-3        20370000
203800             PERFORM Z998-DB2-ABEND                               20380000
203900     END-EVALUATE.                                                20390000
204000*---------------------------------------------------------------- 20400000
204100*    FILL IN THE APWSA12 FIELDS FOR THE MEMOS FOR PRICE CLAIM     20410000
204200*    ADJUSTMENTS AND INSERT IT INTO THE TAPDSRP TABLE.            20420000
204300*---------------------------------------------------------------- 20430000
204400 P400-CREATE-PRCCLM-LINE-NBR.                                     20440000
204500                                                                  20450000
204600     MOVE 'P400-CREATE-PRCCLM-LINE-NBR    ' TO                    20460000
204700            PV-CURRENT-PARAGRAPH.                                 20470000
204800                                                                  20480000
204900     MOVE ZEROS                    TO PV-POUNCST                  20490000
205000                                      PV-LINENO.                  20500000
205100                                                                  20510000
205200     PERFORM R910-GET-PURITM.                                     20520000
205300                                                                  20530000
205400     MOVE PC-PROGRAM                 TO WSA12-CRE-PROGRAM.        20540000
205500     MOVE PURITM-APP-PO-LNE-NBR      TO PV-LINENO.                20550000
205600     MOVE PRCCLM-ADJ-COST-AMT        TO PV-POUNCST.               20560000
205700     MOVE HOLD-DUNS-NO               TO WSA12-VENDOR-ID.          20570000
205800     MOVE PV-STORE-BEING-PROCESSED   TO PV-STORE-BEING-PROCESSED-920580000
205900     MOVE PV-STORE-BEING-PROCESSED-9 TO WSA12-DEPTID.             20590000
206000     MOVE SPACES                     TO WSA12-KC-SKU-NBR          20600000
206100                                        WSA12-UPC-ID.             20610000
206200     PERFORM S700-SELECT-UPC-NBR.                                 20620000
206300     MOVE TUPCSKU-UPC-NBR            TO PV-UPC-NBR-9.             20630000
206400     MOVE PV-UPC-NBR-9               TO WSA12-UPC-ID.             20640000
206500     MOVE PV-PO-BEING-PROCESSED      TO WSA12-KC-PO-NBR.          20650000
206600     MOVE PV-NEXT-DOC-NBR            TO WSA12-INVOICE-ID.         20660000
206700     MOVE PURITM-VEND-STYL-NAME      TO WSA12-KC-VS-NBR.          20670000
206800     MOVE PRCCLM-UNT-QTY             TO WSA12-KC-INVC-QTY.        20680000
206900     MOVE PRCCLM-UNT-COST-AMT        TO WSA12-KC-INVC-COST-AMT.   20690000
207000     MOVE PRCCLM-ADJ-COST-AMT        TO WSA12-KC-ORD-COST-AMT.    20700000
207100     MOVE PV-PRCCLM-COST             TO WSA12-KC-TOT-COST-AMT.    20710000
207200     IF TRNCDE-PSTG-TYP-CDE = 'CR'                                20720000
207300        IF WSA12-KC-TOT-COST-AMT > 0                              20730000
207400           MULTIPLY -1 BY WSA12-KC-TOT-COST-AMT                   20740000
207500        END-IF                                                    20750000
207600     END-IF.                                                      20760000
207700     MOVE ZEROS                      TO WSA12-KC-RCVD-QTY.        20770000
207800     MOVE PV-DB2-CURRENT-DATE        TO WSA12-KC-CRE-DTE.         20780000
207900     MOVE PV-DEFAULT-TMST            TO WSA12-KC-AP-MEMO-TMST.    20790000
208000                                                                  20800000
208100     MOVE AP040-ORGN-CDE             TO WSA12-ORIGIN (1:1).       20810000
208200     MOVE PV-TRANCDE                 TO WSA12-ORIGIN (2:2).       20820000
208300                                                                  20830000
208400     MOVE WSA12-MEMO-WORK-RECORD     TO APDSRP-DSCRP-RPT-ODR.     20840000
208500                                                                  20850000
208600     PERFORM S300-ISRT-PO-LINE-INFO.                              20860000
208700                                                                  20870000
208800/                                                                 20880000
208900*---------------------------------------------------------------- 20890000
209000*    FILL IN THE PEOPLESOFT AP MEMO TABLE FIELDS FOR REMAINDER    20900000
209100*    INVOICES WITH PO LINE NUMBERS AND INSERT IT INTO THE PSA12   20910000
209200*    TABLE.                                                       20920000
209300*---------------------------------------------------------------- 20930000
209400 P450-CREATE-RI-LINE-NBR-SEG.                                     20940000
209500                                                                  20950000
209600     MOVE 'P450-CREATE-RI-LINE-NBR-SEG' TO PV-CURRENT-PARAGRAPH.  20960000
209700                                                                  20970000
209800     MOVE ZEROS                       TO PV-POUNCST               20980000
209900                                         PV-LINENO.               20990000
210000                                                                  21000000
210100     PERFORM R920-FETCH-PURITM-PREQIT.                            21010000
210200                                                                  21020000
210300     IF MORE-RI-PO-LINES                                          21030000
210400        MOVE PC-PROGRAM                 TO WSA12-CRE-PROGRAM      21040000
210500        MOVE PURITM-APP-PO-LNE-NBR      TO PV-LINENO              21050000
210600        MOVE HOLD-DUNS-NO               TO WSA12-VENDOR-ID        21060000
210700        MOVE PV-STORE-BEING-PROCESSED   TO                        21070000
210800                                        PV-STORE-BEING-PROCESSED-921080000
210900        MOVE PV-STORE-BEING-PROCESSED-9 TO WSA12-DEPTID           21090000
211000        MOVE SPACES                     TO WSA12-KC-SKU-NBR       21100000
211100                                           WSA12-UPC-ID           21110000
211200        PERFORM S700-SELECT-UPC-NBR                               21120000
211300        MOVE TUPCSKU-UPC-NBR            TO PV-UPC-NBR-9           21130000
211400        MOVE PV-UPC-NBR-9               TO WSA12-UPC-ID           21140000
211500        MOVE PV-PO-BEING-PROCESSED      TO WSA12-KC-PO-NBR        21150000
211600        MOVE PV-NEXT-DOC-NBR            TO WSA12-INVOICE-ID       21160000
211700        MOVE PURITM-VEND-STYL-NAME      TO WSA12-KC-VS-NBR        21170000
211800        MOVE PREQIT-PAY-REQ-LNE-QTY     TO WSA12-KC-INVC-QTY      21180000
211900        MOVE PREQIT-UNT-COST-AMT        TO WSA12-KC-INVC-COST-AMT 21190000
212000        MOVE ZEROES                     TO WSA12-KC-ORD-COST-AMT  21200000
212100        MOVE ZEROES                     TO WSA12-KC-RCVD-QTY      21210000
212200        COMPUTE WSA12-KC-TOT-COST-AMT = (PREQIT-PAY-REQ-LNE-QTY * 21220000
212300                                         PREQIT-UNT-COST-AMT)     21230000
212400                                         + .005                   21240000
212500        MULTIPLY -1 BY WSA12-KC-TOT-COST-AMT                      21250000
212600        MOVE PV-DB2-CURRENT-DATE        TO WSA12-KC-CRE-DTE       21260000
212700        MOVE PV-DEFAULT-TMST            TO WSA12-KC-AP-MEMO-TMST  21270000
212800        MOVE AP040-ORGN-CDE             TO WSA12-ORIGIN (1:1)     21280000
212900        MOVE PV-TRANCDE                 TO WSA12-ORIGIN (2:2)     21290000
213000        MOVE WSA12-MEMO-WORK-RECORD     TO APDSRP-DSCRP-RPT-ODR   21300000
213100        PERFORM S300-ISRT-PO-LINE-INFO                            21310000
213200        PERFORM P830-CREATE-RI-RECON-RESULTS                      21320000
213300     END-IF.                                                      21330000
213400                                                                  21340000
213500/                                                                 21350000
213600*---------------------------------------------------------------- 21360000
213700*    FILL IN THE PEOPLESOFT AP MEMO TABLE FIELDS FOR REMAINDER    21370000
213800*    INVOICES WITH NULL PO LINE NUMBERS AND INSERT IT INTO THE    21380000
213900*    PSA12 TABLE.                                                 21390000
214000*---------------------------------------------------------------- 21400000
214100 P460-CREATE-RI-NULL-LINE-SEG.                                    21410000
214200                                                                  21420000
214300     MOVE 'P460-CREATE-RI-NULL-LINE-SEG' TO PV-CURRENT-PARAGRAPH. 21430000
214400                                                                  21440000
214500     MOVE ZEROS                       TO PV-POUNCST               21450000
214600                                         PV-LINENO.               21460000
214700                                                                  21470000
214800     PERFORM R930-FETCH-NULL-PURITM-PREQIT.                       21480000
214900                                                                  21490000
215000     IF MORE-RI-NULL-LINES                                        21500000
215100        MOVE PC-PROGRAM                 TO WSA12-CRE-PROGRAM      21510000
215200        MOVE PV-DEFAULT-LINE-NBR        TO PV-LINENO              21520000
215300        SUBTRACT 1 FROM PV-DEFAULT-LINE-NBR                       21530000
215400        MOVE HOLD-DUNS-NO               TO WSA12-VENDOR-ID        21540000
215500        MOVE PV-STORE-BEING-PROCESSED   TO                        21550000
215600                                       PV-STORE-BEING-PROCESSED-9 21560000
215700        MOVE PV-STORE-BEING-PROCESSED-9 TO WSA12-DEPTID           21570000
215800        MOVE PV-PO-BEING-PROCESSED      TO WSA12-KC-PO-NBR        21580000
215900        MOVE PV-NEXT-DOC-NBR            TO WSA12-INVOICE-ID       21590000
216000        MOVE SPACES                     TO WSA12-KC-VS-NBR        21600000
216100                                           WSA12-KC-SKU-NBR       21610000
216200        MOVE PREQIT-PAY-REQ-LNE-QTY     TO WSA12-KC-INVC-QTY      21620000
216300        MOVE PREQIT-UNT-COST-AMT        TO WSA12-KC-INVC-COST-AMT 21630000
216400        MOVE ZEROES                     TO WSA12-KC-ORD-COST-AMT  21640000
216500                                           WSA12-KC-RCVD-QTY      21650000
216600        MOVE '000000000000000'          TO WSA12-UPC-ID           21660000
216700        COMPUTE WSA12-KC-TOT-COST-AMT = (PREQIT-PAY-REQ-LNE-QTY * 21670000
216800                                         PREQIT-UNT-COST-AMT)     21680000
216900                                         + .005                   21690000
217000        MULTIPLY -1 BY WSA12-KC-TOT-COST-AMT                      21700000
217100        MOVE PV-DB2-CURRENT-DATE        TO WSA12-KC-CRE-DTE       21710000
217200        MOVE PV-DEFAULT-TMST            TO WSA12-KC-AP-MEMO-TMST  21720000
217300        MOVE AP040-ORGN-CDE             TO WSA12-ORIGIN (1:1)     21730000
217400        MOVE PV-TRANCDE                 TO WSA12-ORIGIN (2:2)     21740000
217500        MOVE WSA12-MEMO-WORK-RECORD     TO APDSRP-DSCRP-RPT-ODR   21750000
217600        PERFORM S300-ISRT-PO-LINE-INFO                            21760000
217700        PERFORM P830-CREATE-RI-RECON-RESULTS                      21770000
217800     END-IF.                                                      21780000
217900                                                                  21790000
218000/                                                                 21800000
218100*---------------------------------------------------------------- 21810000
218200*    THIS ROUTINE WILL SET UP THE PEOPLESOFT TRANSACTION RECORDS  21820000
218300*    FOR INVOICE UPDATES.                                         21830000
218400*---------------------------------------------------------------- 21840000
218500 P700-CREATE-INV-PS-INTERFACE.                                    21850000
218600                                                                  21860000
218700     INITIALIZE AP040-TRANSACTION-FILE.                           21870000
218800                                                                  21880000
218900     MOVE ZEROS TO PV-NW-STR-DISC-AMT, PV-TRD-DISC-AMT.           21890000
219000                                                                  21900000
219100     SET AP040-ORGN-MDSE             TO TRUE.                     21910000
219200                                                                  21920000
219300     MOVE '01'                       TO AP040-AP-TRN-CDE.         21930000
219400                                                                  21940000
219500     PERFORM S100-SELECT-TTRNCDE-DATA.                            21950000
219600                                                                  21960000
219700     MOVE TRNCDE-TRN-TYP-CDE         TO AP040-TRN-TYP-CDE.        21970000
219800     MOVE TRNCDE-PSTG-TYP-CDE        TO AP040-PSTG-TYP-CDE.       21980000
219900     MOVE PV-DB2-CURRENT-DATE        TO AP040-PS-BTCH-DTE.        21990000
220000     MOVE TRNCDE-BTCH-SRC-CDE        TO AP040-PS-BTCH-SRC-CDE.    22000000
220100     MOVE TRNCDE-AP-PSTG-IND         TO AP040-AP-PSTG-IND.        22010000
220200     MOVE '00'                       TO AP040-PS-BTCH-SEQ-NBR.    22020000
220300                                                                  22030000
220400     MOVE HOLD-DUNS-NO               TO AP040-VND-NBR.            22040000
220500     MOVE HOLD-DOC-NO                TO AP040-DOC-NBR.            22050000
220600     MOVE INVOIC-STR-NBR             TO AP040-STR-NBR.            22060000
220700     MOVE PV-PO-BEING-PROCESSED      TO PV-PO-BEING-PROCESSED-9.  22070000
220800     MOVE PV-PO-BEING-PROCESSED-X    TO AP040-PO-NBR.             22080000
220900     MOVE HOLD-DEPT                  TO AP040-DEPT-NBR.           22090000
221000     MOVE INVOIC-BAR-CDE             TO AP040-BAR-CDE.            22100000
221100     MOVE HOLD-DOC-DATE-CCYYMMDD     TO AP040-DOC-DTE.            22110000
221200     MOVE PC-PROGRAM                 TO AP040-ENTR-ID.            22120000
221300     MOVE '-21.00.00.000000'         TO AP040-ENTR-TME.           22130000
221400     MOVE PV-CURRENT-CCYYMMDD        TO AP040-ENTR-DTE.           22140000
221500     MOVE HOLD-DUE-DATE-CN           TO PV-HOLD-DUE-DATE-CC.      22150000
221600     MOVE HOLD-DUE-DATE-YR           TO PV-HOLD-DUE-DATE-YY.      22160000
221700     MOVE HOLD-DUE-DATE-MO           TO PV-HOLD-DUE-DATE-MM.      22170000
221800     MOVE HOLD-DUE-DATE-DA           TO PV-HOLD-DUE-DATE-DD.      22180000
221900     MOVE PV-HOLD-DUE-DATE-CCYYMMDD  TO AP040-PYMT-DUE-DTE.       22190000
222000     MOVE HOLD-VENDOR-NAME           TO AP040-ENT-NME-DESC.       22200000
222100     MOVE HOLD-VENDOR-ID             TO AP040-ENT-ID.             22210000
222200     IF HOLD-PYMT-HOLD                                            22220000
222300        SET AP040-DOC-HLD    TO TRUE                              22230000
222400     ELSE                                                         22240000
222500        SET AP040-NOT-ON-HLD TO TRUE                              22250000
222600     END-IF.                                                      22260000
222700                                                                  22270000
222800                                                                  22280000
222900     IF (INVOIC-INVC-TYP-CDE = PC-WO-TYPE) OR                     22290000
223000        (PV-PO-TYP-IMPORT)                                        22300000
223100        MOVE 'N' TO AP040-AUTO-OTP-PSTG-IND                       22310000
223200     ELSE                                                         22320000
223300        MOVE 'Y' TO AP040-AUTO-OTP-PSTG-IND                       22330000
223400     END-IF.                                                      22340000
223500*    SEPHORA INVOICES ARE NOT AUTO OTP PSTG AS THEY ARE PREPAID   22350000
223600     IF INVOIC-INVC-TYP-CDE = PC-MI-TYPE AND                      22360000
223700        PS-SEPHORA-AT-KOHLS                                       22370000
223800        MOVE 'N' TO AP040-AUTO-OTP-PSTG-IND                       22380000
223900     END-IF.                                                      22390000
224000                                                                  22400000
224100     MOVE INVOIC-GRO-COST-AMT        TO AP040-GRO-COST-AMT.       22410000
224200     MOVE APPD052-MISC-CHARGES       TO AP040-MISC-CHRG-AMT.      22420000
224300     MOVE APPD052-FREIGHT-CHARGES    TO AP040-FRGT-AMT.           22430000
224400                                                                  22440000
224500     MOVE HOLD-DISC-PCT-DEC          TO AP040-TERM-DISC-PCT.      22450000
224600     COMPUTE AP040-TERM-DISC-AMT = (AP040-GRO-COST-AMT *          22460000
224700                                    AP040-TERM-DISC-PCT) + .005.  22470000
224800                                                                  22480000
224900     PERFORM Q100-PROCESS-DISCOUNTS.                              22490000
225000                                                                  22500000
225100     COMPUTE AP040-NET-COST-AMT = (AP040-GRO-COST-AMT             22510000
225200                                 + AP040-FRGT-AMT                 22520000
225300                                 + AP040-MISC-CHRG-AMT            22530000
225400                                 - AP040-TERM-DISC-AMT            22540000
225500                                 - AP040-MOS-DISC-AMT             22550000
225600                                 - AP040-ADV-DISC-AMT             22560000
225700                                 - AP040-TRD-DISC-AMT             22570000
225800                                 - AP040-COOP-DISC-AMT            22580000
225900                                 - AP040-ALW-DISC-AMT             22590000
226000                                 - AP040-MSC-DISC-AMT             22600000
226100                                 - AP040-NW-STR-DISC-AMT).        22610000
226200     IF AP040-GRO-COST-AMT = ZERO AND                             22620000
226300        AP040-NET-COST-AMT = ZERO                                 22630000
226400           CONTINUE                                               22640000
226500     ELSE                                                         22650000
226600        PERFORM U400-INSERT-PS-TRANSACTION                        22660000
226700     END-IF.                                                      22670000
226800                                                                  22680000
226900/                                                                 22690000
227000*---------------------------------------------------------------- 22700000
227100*  THIS ROUTINE WILL SET UP THE PEOPLESOFT TRANSACTION RECORDS    22710000
227200*  FOR REMAINDER AND IMPORT ADJUSTMENTS.                          22720000
227300*---------------------------------------------------------------- 22730000
227400 P725-CREATE-RI-IMPORT-ADJS.                                      22740000
227500                                                                  22750000
227600     INITIALIZE AP040-TRANSACTION-FILE.                           22760000
227700                                                                  22770000
227800     MOVE ZEROES                        TO PV-INVAMT.             22780000
227900     MOVE SPACES                        TO PV-TRANCDE             22790000
228000                                           PV-NEXT-DOC-NBR.       22800000
228100                                                                  22810000
228200     IF REMAINDER-INVOICE                                         22820000
228300        PERFORM S250-CREATE-RI-DOC-NBR                            22830000
228400     ELSE                                                         22840000
228500        PERFORM S200-GET-NEXT-DOC-NBR                             22850000
228600        MOVE WS151-NEXT-DOC-NBR         TO PV-NEXT-DOC-NBR        22860000
228700     END-IF.                                                      22870000
228800     EVALUATE TRUE                                                22880000
228900        WHEN PRCCLM-ADJUST                                        22890000
229000           MOVE '10'                    TO PV-TRANCDE             22900000
229100           MOVE 'Y'                     TO AP040-AUTO-OTP-PSTG-IND22910000
229200           MOVE PV-PRCCLM-AMT           TO AP040-GRO-COST-AMT     22920000
229300           MOVE HOLD-DISC-PCT-DEC       TO AP040-TERM-DISC-PCT    22930000
229400        WHEN REMAINDER-INVOICE                                    22940000
229500           MOVE '12'                    TO PV-TRANCDE             22950000
229600           MOVE 'Y'                     TO AP040-AUTO-OTP-PSTG-IND22960000
229700           MOVE INVOIC-GRO-COST-AMT     TO AP040-GRO-COST-AMT,    22970000
229800                                           PV-INVAMT              22980000
229900           MOVE HOLD-DISC-PCT-DEC       TO AP040-TERM-DISC-PCT    22990000
230000        WHEN IMPORT-PO                                            23000000
230100           MOVE '74'                    TO PV-TRANCDE             23010000
230200           MOVE 'N'                     TO AP040-AUTO-OTP-PSTG-IND23020000
230300           MOVE INVOIC-GRO-COST-AMT     TO AP040-GRO-COST-AMT,    23030000
230400                                           PV-INVAMT              23040000
230500           MOVE HOLD-DISC-PCT-DEC       TO AP040-TERM-DISC-PCT    23050000
230600           MOVE APPD052-MISC-CHARGES    TO AP040-MISC-CHRG-AMT    23060000
230700     END-EVALUATE.                                                23070000
230800                                                                  23080000
230900     MOVE PV-TRANCDE                     TO AP040-AP-TRN-CDE.     23090000
231000     PERFORM S100-SELECT-TTRNCDE-DATA.                            23100000
231100                                                                  23110000
231200     MOVE HOLD-DUNS-NO                   TO AP040-VND-NBR.        23120000
231300     MOVE PV-NEXT-DOC-NBR                TO AP040-DOC-NBR.        23130000
231400     MOVE PV-PO-BEING-PROCESSED          TO                       23140000
231500                                        PV-PO-BEING-PROCESSED-9.  23150000
231600     MOVE PV-PO-BEING-PROCESSED-X        TO AP040-PO-NBR.         23160000
231700     SET AP040-ORGN-MDSE                 TO TRUE.                 23170000
231800                                                                  23180000
231900     IF INVOIC-INVC-TYP-CDE = PC-WO-TYPE                          23190000
232000        MOVE PC-WO-STORNO                TO AP040-STR-NBR         23200000
232100     ELSE                                                         23210000
232200        IF PV-PO-TYP-IMPORT                                       23220000
232300           MOVE PC-STORE-NBR             TO AP040-STR-NBR         23230000
232400           SET AP040-ORGN-IMPORT         TO TRUE                  23240000
232500        ELSE                                                      23250000
232600           MOVE INVOIC-STR-NBR           TO AP040-STR-NBR         23260000
232700        END-IF                                                    23270000
232800     END-IF.                                                      23280000
232900                                                                  23290000
233000     MOVE TRNCDE-TRN-TYP-CDE             TO AP040-TRN-TYP-CDE.    23300000
233100     MOVE TRNCDE-PSTG-TYP-CDE            TO AP040-PSTG-TYP-CDE.   23310000
233200                                                                  23320000
233300     IF AP040-EXPENSE                                             23330000
233400        MOVE TRNCDE-GL-ACCT-NBR          TO AP040-GL-ACCT-NBR     23340000
233500     ELSE                                                         23350000
233600        MOVE HOLD-DEPT                   TO AP040-DEPT-NBR        23360000
233700     END-IF.                                                      23370000
233800                                                                  23380000
233900     MOVE PV-DB2-CURRENT-DATE            TO AP040-PS-BTCH-DTE.    23390000
234000     MOVE TRNCDE-BTCH-SRC-CDE            TO AP040-PS-BTCH-SRC-CDE.23400000
234100     MOVE TRNCDE-AP-PSTG-IND             TO AP040-AP-PSTG-IND.    23410000
234200     MOVE '00'                           TO AP040-PS-BTCH-SEQ-NBR.23420000
234300                                                                  23430000
234400     MOVE PV-CURRENT-CCYYMMDD            TO AP040-DOC-DTE         23440000
234500                                            AP040-ENTR-DTE.       23450000
234600     MOVE '-21.00.00.000000'             TO AP040-ENTR-TME.       23460000
234700     MOVE HOLD-DUE-DATE-CN               TO PV-HOLD-DUE-DATE-CC.  23470000
234800     MOVE HOLD-DUE-DATE-YR               TO PV-HOLD-DUE-DATE-YY.  23480000
234900     MOVE HOLD-DUE-DATE-MO               TO PV-HOLD-DUE-DATE-MM.  23490000
235000     MOVE HOLD-DUE-DATE-DA               TO PV-HOLD-DUE-DATE-DD.  23500000
235100     MOVE PV-HOLD-DUE-DATE-CCYYMMDD      TO AP040-PYMT-DUE-DTE.   23510000
235200     MOVE PC-PROGRAM                     TO AP040-ENTR-ID.        23520000
235300     MOVE HOLD-VENDOR-NAME               TO AP040-ENT-NME-DESC.   23530000
235400     MOVE HOLD-VENDOR-ID                 TO AP040-ENT-ID.         23540000
235500     IF HOLD-PYMT-HOLD                                            23550000
235600        SET AP040-DOC-HLD    TO TRUE                              23560000
235700     ELSE                                                         23570000
235800        SET AP040-NOT-ON-HLD TO TRUE                              23580000
235900     END-IF.                                                      23590000
236000                                                                  23600000
236100     COMPUTE AP040-TERM-DISC-AMT = (AP040-GRO-COST-AMT *          23610000
236200                                    AP040-TERM-DISC-PCT) + .005.  23620000
236300                                                                  23630000
236400     PERFORM Q100-PROCESS-DISCOUNTS.                              23640000
236500                                                                  23650000
236600     COMPUTE AP040-NET-COST-AMT = (AP040-GRO-COST-AMT             23660000
236700                                 + AP040-FRGT-AMT                 23670000
236800                                 + AP040-MISC-CHRG-AMT            23680000
236900                                 - AP040-TERM-DISC-AMT            23690000
237000                                 - AP040-NW-STR-DISC-AMT          23700000
237100                                 - AP040-TRD-DISC-AMT             23710000
237200                                 - AP040-COOP-DISC-AMT            23720000
237300                                 - AP040-ALW-DISC-AMT             23730000
237400                                 - AP040-MSC-DISC-AMT             23740000
237500                                 - AP040-MOS-DISC-AMT             23750000
237600                                 - AP040-ADV-DISC-AMT).           23760000
237700                                                                  23770000
237800     IF AP040-CREDIT                                              23780000
237900        IF AP040-NET-COST-AMT > 0                                 23790000
238000           MULTIPLY -1 BY AP040-NET-COST-AMT                      23800000
238100        END-IF                                                    23810000
238200        IF AP040-GRO-COST-AMT > 0                                 23820000
238300           MULTIPLY -1 BY AP040-GRO-COST-AMT                      23830000
238400        END-IF                                                    23840000
238500        IF AP040-FRGT-AMT > 0                                     23850000
238600           MULTIPLY -1 BY AP040-FRGT-AMT                          23860000
238700        END-IF                                                    23870000
238800        IF AP040-MISC-CHRG-AMT > 0                                23880000
238900           MULTIPLY -1 BY AP040-MISC-CHRG-AMT                     23890000
239000        END-IF                                                    23900000
239100        IF AP040-TERM-DISC-AMT > 0                                23910000
239200           MULTIPLY -1 BY AP040-TERM-DISC-AMT                     23920000
239300        END-IF                                                    23930000
239400        IF AP040-NW-STR-DISC-AMT > 0                              23940000
239500           MULTIPLY -1 BY AP040-NW-STR-DISC-AMT                   23950000
239600        END-IF                                                    23960000
239700        IF AP040-TRD-DISC-AMT > 0                                 23970000
239800           MULTIPLY -1 BY AP040-TRD-DISC-AMT                      23980000
239900        END-IF                                                    23990000
240000        IF AP040-MOS-DISC-AMT > 0                                 24000000
240100           MULTIPLY -1 BY AP040-MOS-DISC-AMT                      24010000
240200        END-IF                                                    24020000
240300        IF AP040-ADV-DISC-AMT > 0                                 24030000
240400           MULTIPLY -1 BY AP040-ADV-DISC-AMT                      24040000
240500        END-IF                                                    24050000
240600        IF AP040-COOP-DISC-AMT > 0                                24060000
240700           MULTIPLY -1 BY AP040-COOP-DISC-AMT                     24070000
240800        END-IF                                                    24080000
240900        IF AP040-ALW-DISC-AMT > 0                                 24090000
241000           MULTIPLY -1 BY AP040-ALW-DISC-AMT                      24100000
241100        END-IF                                                    24110000
241200        IF AP040-MSC-DISC-AMT > 0                                 24120000
241300           MULTIPLY -1 BY AP040-MSC-DISC-AMT                      24130000
241400        END-IF                                                    24140000
241500     END-IF.                                                      24150000
241600                                                                  24160000
241700     IF AP040-GRO-COST-AMT = ZERO AND                             24170000
241800        AP040-NET-COST-AMT = ZERO                                 24180000
241900           CONTINUE                                               24190000
242000     ELSE                                                         24200000
242100        PERFORM U400-INSERT-PS-TRANSACTION                        24210000
242200     END-IF.                                                      24220000
242300                                                                  24230000
242400/                                                                 24240000
242500*---------------------------------------------------------------- 24250000
242600*   THIS ROUTINE WILL SET UP THE PEOPLESOFT TRANSACTION RECORDS   24260000
242700*   FOR ALL ADJUSTMENTS EXCEPT REMAINDER INVOICES AND IMPORT POS. 24270000
242800*   ALL OFF-INVIOCE ALLOWANCE LOGIC WAS REMOVED FOR CLARITY AS    24280000
242900*   THESE TRANSACTION TYPES WILL NOT HAVE ALLOWANCES.             24290000
243000*---------------------------------------------------------------- 24300000
243100 P750-CREATE-ADJ-PS-INTERFACE.                                    24310000
243200                                                                  24320000
243300     INITIALIZE AP040-TRANSACTION-FILE.                           24330000
243400                                                                  24340000
243500     MOVE ZEROES                        TO PV-INVAMT.             24350000
243600     MOVE SPACES                        TO PV-TRANCDE             24360000
243700                                           PV-NEXT-DOC-NBR.       24370000
243800     PERFORM S200-GET-NEXT-DOC-NBR.                               24380000
243900     MOVE WS151-NEXT-DOC-NBR            TO PV-NEXT-DOC-NBR.       24390000
244000     EVALUATE TRUE                                                24400000
244100        WHEN FREIGHT-ADJUST                                       24410000
244200           MOVE '13'                    TO PV-TRANCDE             24420000
244300           MOVE 'Y'                     TO AP040-AUTO-OTP-PSTG-IND24430000
244400           MOVE APPD052-VENDOR-FRT-AMT  TO AP040-FRGT-AMT,        24440000
244500                                           PV-INVAMT              24450000
244600        WHEN DNP-CHARGE                                           24460000
244700           MOVE '15'                    TO PV-TRANCDE             24470000
244800           MOVE 'Y'                     TO AP040-AUTO-OTP-PSTG-IND24480000
244900           MOVE APPD052-DNP-CHARGES     TO AP040-MISC-CHRG-AMT,   24490000
245000                                           PV-INVAMT              24500000
245100           ADD APPD052-CD-GIFT-WRAP-AMT TO AP040-MISC-CHRG-AMT,   24510000
245200                                           PV-INVAMT              24520000
245300           ADD PV-DS-DIFFERENCE-AMT     TO AP040-MISC-CHRG-AMT,   24530000
245400                                           PV-INVAMT              24540000
245500           MOVE PC-15-DESC-TXT          TO AP040-RSN-1ST-LNE-TXT  24550000
245600*       WHEN DIRECT-SHIP-CHARGE                                   24560000
245700*          MOVE '0N'                    TO PV-TRANCDE             24570000
245800*          MOVE 'Y'                     TO AP040-AUTO-OTP-PSTG-IND24580000
245900*          MOVE PV-DS-DIFFERENCE-AMT    TO AP040-MISC-CHRG-AMT,   24590000
246000*                                          PV-INVAMT              24600000
246100        WHEN UNJ-WRITE-OFF                                        24610000
246200           MOVE '72'                    TO PV-TRANCDE             24620000
246300           MOVE 'N'                     TO AP040-AUTO-OTP-PSTG-IND24630000
246400           MOVE INVOIC-GRO-COST-AMT     TO AP040-GRO-COST-AMT,    24640000
246500                                           PV-INVAMT              24650000
246600     END-EVALUATE.                                                24660000
246700                                                                  24670000
246800     MOVE PV-TRANCDE                    TO AP040-AP-TRN-CDE.      24680000
246900     PERFORM S100-SELECT-TTRNCDE-DATA.                            24690000
247000                                                                  24700000
247100     MOVE HOLD-DUNS-NO                  TO AP040-VND-NBR.         24710000
247200     MOVE PV-NEXT-DOC-NBR               TO AP040-DOC-NBR.         24720000
247300     MOVE PV-PO-BEING-PROCESSED         TO                        24730000
247400                                        PV-PO-BEING-PROCESSED-9.  24740000
247500     MOVE PV-PO-BEING-PROCESSED-X       TO AP040-PO-NBR.          24750000
247600     SET AP040-ORGN-MDSE                TO TRUE.                  24760000
247700                                                                  24770000
247800     IF INVOIC-INVC-TYP-CDE = PC-WO-TYPE                          24780000
247900        MOVE PC-WO-STORNO               TO AP040-STR-NBR          24790000
248000     ELSE                                                         24800000
248100        IF PV-PO-TYP-IMPORT                                       24810000
248200           MOVE PC-STORE-NBR            TO AP040-STR-NBR          24820000
248300           SET AP040-ORGN-IMPORT        TO TRUE                   24830000
248400        ELSE                                                      24840000
248500           MOVE INVOIC-STR-NBR          TO AP040-STR-NBR          24850000
248600        END-IF                                                    24860000
248700     END-IF.                                                      24870000
248800                                                                  24880000
248900     MOVE TRNCDE-TRN-TYP-CDE            TO AP040-TRN-TYP-CDE.     24890000
249000     MOVE TRNCDE-PSTG-TYP-CDE           TO AP040-PSTG-TYP-CDE.    24900000
249100                                                                  24910000
249200     IF AP040-EXPENSE                                             24920000
249300        MOVE TRNCDE-GL-ACCT-NBR         TO AP040-GL-ACCT-NBR      24930000
249400     ELSE                                                         24940000
249500        MOVE HOLD-DEPT                  TO AP040-DEPT-NBR         24950000
249600     END-IF.                                                      24960000
249700                                                                  24970000
249800     MOVE PV-DB2-CURRENT-DATE           TO AP040-PS-BTCH-DTE.     24980000
249900     MOVE TRNCDE-BTCH-SRC-CDE           TO AP040-PS-BTCH-SRC-CDE. 24990000
250000     MOVE TRNCDE-AP-PSTG-IND            TO AP040-AP-PSTG-IND.     25000000
250100     MOVE '00'                          TO AP040-PS-BTCH-SEQ-NBR. 25010000
250200                                                                  25020000
250300     MOVE PV-CURRENT-CCYYMMDD           TO AP040-DOC-DTE          25030000
250400                                           AP040-ENTR-DTE.        25040000
250500     MOVE '-21.00.00.000000'            TO AP040-ENTR-TME.        25050000
250600     MOVE HOLD-DUE-DATE-CN              TO PV-HOLD-DUE-DATE-CC.   25060000
250700     MOVE HOLD-DUE-DATE-YR              TO PV-HOLD-DUE-DATE-YY.   25070000
250800     MOVE HOLD-DUE-DATE-MO              TO PV-HOLD-DUE-DATE-MM.   25080000
250900     MOVE HOLD-DUE-DATE-DA              TO PV-HOLD-DUE-DATE-DD.   25090000
251000     MOVE PV-HOLD-DUE-DATE-CCYYMMDD     TO AP040-PYMT-DUE-DTE.    25100000
251100     MOVE PC-PROGRAM                    TO AP040-ENTR-ID.         25110000
251200     MOVE HOLD-VENDOR-NAME              TO AP040-ENT-NME-DESC.    25120000
251300     MOVE HOLD-VENDOR-ID                TO AP040-ENT-ID.          25130000
251400     IF HOLD-PYMT-HOLD                                            25140000
251500        SET AP040-DOC-HLD    TO TRUE                              25150000
251600     ELSE                                                         25160000
251700        SET AP040-NOT-ON-HLD TO TRUE                              25170000
251800     END-IF.                                                      25180000
251900                                                                  25190000
252000     COMPUTE AP040-TERM-DISC-AMT = (AP040-GRO-COST-AMT *          25200000
252100                                    AP040-TERM-DISC-PCT) + .005.  25210000
252200                                                                  25220000
252300     COMPUTE AP040-NET-COST-AMT = (AP040-GRO-COST-AMT             25230000
252400                           + AP040-FRGT-AMT                       25240000
252500                           + AP040-MISC-CHRG-AMT                  25250000
252600                           - AP040-TERM-DISC-AMT).                25260000
252700                                                                  25270000
252800     IF AP040-CREDIT                                              25280000
252900        IF AP040-NET-COST-AMT > 0                                 25290000
253000           MULTIPLY -1 BY AP040-NET-COST-AMT                      25300000
253100        END-IF                                                    25310000
253200        IF AP040-GRO-COST-AMT > 0                                 25320000
253300           MULTIPLY -1 BY AP040-GRO-COST-AMT                      25330000
253400        END-IF                                                    25340000
253500        IF AP040-FRGT-AMT > 0                                     25350000
253600           MULTIPLY -1 BY AP040-FRGT-AMT                          25360000
253700        END-IF                                                    25370000
253800        IF AP040-MISC-CHRG-AMT > 0                                25380000
253900           MULTIPLY -1 BY AP040-MISC-CHRG-AMT                     25390000
254000        END-IF                                                    25400000
254100        IF AP040-TERM-DISC-AMT > 0                                25410000
254200           MULTIPLY -1 BY AP040-TERM-DISC-AMT                     25420000
254300        END-IF                                                    25430000
254400     END-IF.                                                      25440000
254500                                                                  25450000
254600     IF AP040-GRO-COST-AMT = ZERO AND                             25460000
254700        AP040-NET-COST-AMT = ZERO                                 25470000
254800           CONTINUE                                               25480000
254900     ELSE                                                         25490000
255000        PERFORM U400-INSERT-PS-TRANSACTION                        25500000
255100     END-IF.                                                      25510000
255200                                                                  25520000
255300/                                                                 25530000
255400*---------------------------------------------------------------- 25540000
255500*    CREATES THE RECONCILIATION RESULTS FILE VENDOR RECORD.       25550000
255600*---------------------------------------------------------------- 25560000
255700 P800-CREATE-RECON-RESULTS-VEND.                                  25570000
255800                                                                  25580000
255900     MOVE 'P800-CREATE-RECON-RESULTS VEND' TO                     25590000
256000           PV-CURRENT-PARAGRAPH.                                  25600000
256100                                                                  25610000
256200     MOVE SPACES TO AP263-RECORD.                                 25620000
256300                                                                  25630000
256400     MOVE PURCHS-DEPT-NBR          TO AP263-DEPT-NBR.             25640000
256500     MOVE PV-PO-BEING-PROCESSED    TO AP263-PO-NBR.               25650000
256600     MOVE PV-STORE-BEING-PROCESSED TO AP263-STR-NBR.              25660000
256700     MOVE PV-MTCH-LVL-BEING-PROCESSED                             25670000
256800                                   TO AP263-MTCH-LVL-CDE.         25680000
256900     MOVE HOLD-VENDOR-NAME         TO AP263-VENDOR-NAME.          25690000
257000     MOVE HOLD-DUNS-NO             TO AP263-VENDOR-NBR.           25700000
257100     MOVE POSTRR-CRE-PRC-CDE       TO AP263-POSTRR-CRE-PRC-CDE.   25710000
257200                                                                  25720000
257300     SET VENDOR-RECORD             TO TRUE.                       25730000
257400                                                                  25740000
257500     PERFORM U500-INSERT-RECON-RESULTS.                           25750000
257600/                                                                 25760000
257700*---------------------------------------------------------------- 25770000
257800*    CREATES THE RECONCILIATION RESULTS FILE INVOICE RECORD.      25780000
257900*---------------------------------------------------------------- 25790000
258000 P810-CREATE-RECON-RESULTS-INV.                                   25800000
258100                                                                  25810000
258200     MOVE 'P810-CREATE-RECON-RESULTS INV   ' TO                   25820000
258300           PV-CURRENT-PARAGRAPH.                                  25830000
258400                                                                  25840000
258500     MOVE SPACES TO AP263-INVOICE-RECORD.                         25850000
258600                                                                  25860000
258700     SET INVOICE-RECORD            TO TRUE.                       25870000
258800                                                                  25880000
258900     MOVE INVOIC-INVC-ID           TO AP263-INVOICE-NBR.          25890000
259000     MOVE INVOIC-INVC-TYP-CDE      TO AP263-INVOICE-TYPE.         25900000
259100                                                                  25910000
259200     IF INVOIC-ENTR-MTHD-CDE EQUAL 'ED'                           25920000
259300         SET EDI-ENTRY             TO TRUE                        25930000
259400     ELSE                                                         25940000
259500         SET MANUAL-ENTRY          TO TRUE                        25950000
259600     END-IF.                                                      25960000
259700                                                                  25970000
259800     MOVE HOLD-DUE-DATE-MMDDYY     TO AP263-DUE-DATE.             25980000
259900     MOVE PA-PAY-REQ-QTY-TOT       TO AP263-INVOICE-QTY.          25990000
260000     MOVE INVOIC-GRO-COST-AMT      TO AP263-GROSS-INVOICE-AMT.    26000000
260100     MOVE HOLD-DISC-PCT            TO AP263-TERMS-PCT.            26010000
260200                                                                  26020000
260300     IF PS-ALLOWANCES-EXIST                                       26030000
260400         SET ALLOWANCES-EXIST      TO TRUE                        26040000
260500     ELSE                                                         26050000
260600         SET NO-ALLOWANCES-EXIST   TO TRUE                        26060000
260700     END-IF.                                                      26070000
260800                                                                  26080000
260900     PERFORM U500-INSERT-RECON-RESULTS.                           26090000
261000                                                                  26100000
261100     SET PS-NO-ALLOWANCES-EXIST    TO TRUE.                       26110000
261200/                                                                 26120000
261300*---------------------------------------------------------------- 26130000
261400*    CREATES THE RECONCILIATION RESULTS FILE PRCCLM RECORD.       26140000
261500*---------------------------------------------------------------- 26150000
261600 P820-CREATE-PRCCLM-RECON-RSLT.                                   26160000
261700                                                                  26170000
261800     MOVE 'P820-CREATE-PRCCLM-RECON-RSLT' TO                      26180000
261900           PV-CURRENT-PARAGRAPH.                                  26190000
262000                                                                  26200000
262100     MOVE SPACES TO AP263-ADJ-RECORD.                             26210000
262200                                                                  26220000
262300     IF PRCCLM-DOC-TYP-CDE = 'CM'                                 26230000
262400         SET INVOICE-ADJ-RECORD TO TRUE                           26240000
262500         SET CREDIT-ADJ         TO TRUE                           26250000
262600     ELSE                                                         26260000
262700         SET INVOICE-ADJ-RECORD TO TRUE                           26270000
262800         SET DEBIT-ADJ          TO TRUE                           26280000
262900     END-IF.                                                      26290000
263000                                                                  26300000
263100     MOVE PV-NEXT-DOC-NBR       TO AP263-DOC-NBR.                 26310000
263200     MOVE INVOIC-INVC-ID        TO AP263-RELATED-INV-NBR.         26320000
263300     MOVE PURITM-APP-PO-LNE-NBR TO PV-NUMERIC-LINE-NBR.           26330000
263400     MOVE PV-CHAR-LINE-NBR      TO AP263-PO-LINE-NBR.             26340000
263500     MOVE PRCCLM-UNT-QTY        TO AP263-UNIT-QTY.                26350000
263600     MOVE PRCCLM-UNT-COST-AMT   TO AP263-UNIT-COST.               26360000
263700     MOVE PRCCLM-ADJ-COST-AMT   TO AP263-REC-COST.                26370000
263800     MOVE PV-PRCCLM-COST        TO AP263-EXTD-COST.               26380000
263900     MOVE PV-TRANCDE            TO AP263-TRAN-CODE.               26390000
264000                                                                  26400000
264100     PERFORM U500-INSERT-RECON-RESULTS.                           26410000
264200/                                                                 26420000
264300*---------------------------------------------------------------- 26430000
264400*    CREATES THE RECONCILIATION RESULTS FILE REMAINDER INV RECORD 26440000
264500*---------------------------------------------------------------- 26450000
264600 P830-CREATE-RI-RECON-RESULTS.                                    26460000
264700                                                                  26470000
264800     MOVE 'P830-CREATE-RI-RECON-RESULTS' TO                       26480000
264900           PV-CURRENT-PARAGRAPH.                                  26490000
265000                                                                  26500000
265100     MOVE SPACES TO AP263-ADJ-RECORD.                             26510000
265200                                                                  26520000
265300     SET INVOICE-ADJ-RECORD       TO TRUE.                        26530000
265400     SET DEBIT-ADJ                TO TRUE.                        26540000
265500                                                                  26550000
265600     MOVE PV-NEXT-DOC-NBR         TO AP263-DOC-NBR.               26560000
265700     MOVE INVOIC-INVC-ID          TO AP263-RELATED-INV-NBR.       26570000
265800     MOVE PV-LINENO               TO PV-NUMERIC-LINE-NBR.         26580000
265900     MOVE PV-CHAR-LINE-NBR        TO AP263-PO-LINE-NBR.           26590000
266000     MOVE PREQIT-PAY-REQ-LNE-QTY  TO AP263-UNIT-QTY.              26600000
266100     MOVE PREQIT-UNT-COST-AMT     TO AP263-UNIT-COST.             26610000
266200     MOVE PV-POUNCST              TO AP263-REC-COST.              26620000
266300     MOVE PV-TRANCDE              TO AP263-TRAN-CODE.             26630000
266400     COMPUTE AP263-EXTD-COST = PREQIT-UNT-COST-AMT *              26640000
266500            PREQIT-PAY-REQ-LNE-QTY.                               26650000
266600                                                                  26660000
266700     PERFORM U500-INSERT-RECON-RESULTS.                           26670000
266800/                                                                 26680000
266900*---------------------------------------------------------------- 26690000
267000*    FILL IN THE OPEN TO PAY UPDATE RECORD FOR INVOICE RECORDS    26700000
267100*---------------------------------------------------------------- 26710000
267200 P900-CREATE-STATUS-UPDT-RECORD.                                  26720000
267300                                                                  26730000
267400     MOVE 'P900-CREATE-STATUS-UPDT-RECORD' TO                     26740000
267500             PV-CURRENT-PARAGRAPH.                                26750000
267600                                                                  26760000
267700     MOVE SPACES                  TO AP252-RECORD.                26770000
267800     MOVE INVOIC-INVC-ID          TO AP252-INVOICE-ID.            26780000
267900     MOVE PV-PO-BEING-PROCESSED   TO PV-PO-BEING-PROCESSED-9.     26790000
268000     MOVE PV-PO-BEING-PROCESSED-9 TO AP252-PO-NBR.                26800000
268100                                                                  26810000
268200     MOVE 'J'                     TO AP252-AP-PRC-CDE.            26820000
268300     MOVE APCNTL-BTCH-PRC-DTE     TO AP252-AP-PRC-DTE.            26830000
268400     MOVE INVOIC-PAYT-DTE         TO AP252-PAYT-DTE.              26840000
268500                                                                  26850000
268600     IF (PV-PO-TYP-IMPORT) OR                                     26860000
268700        (INVOIC-INVC-TYP-CDE = PC-WO-TYPE)                        26870000
268800         SET AP252-PAID           TO TRUE                         26880000
268900     ELSE                                                         26890000
269000         SET AP252-OPEN-TO-PAY    TO TRUE                         26900000
269100     END-IF.                                                      26910000
269200                                                                  26920000
269300     IF (PV-PO-TYP-IMPORT) AND                                    26930000
269400        (INVOIC-PAYT-DTE = '9999-09-09') AND                      26940000
269500        (HOLD-DUNS-NO = '009206194')                              26950000
269600         SET AP252-OPEN-TO-PAY    TO TRUE                         26960000
269700     END-IF.                                                      26970000
269800                                                                  26980000
269900*    IF 'SEPHORA AT KOHLS' AND NOT YET PAID, SET TO OPEN TO PAY   26990000
270000     IF PS-SEPHORA-AT-KOHLS                                       27000000
270100        IF INVOIC-PAYT-DTE = '9999-09-09'                         27010000
270200            SET AP252-OPEN-TO-PAY    TO TRUE                      27020000
270300        ELSE                                                      27030000
270400            SET AP252-PAID           TO TRUE                      27040000
270500        END-IF                                                    27050000
270600     END-IF.                                                      27060000
270700                                                                  27070000
270800     PERFORM U600-INSERT-OTP-UPDATE.                              27080000
270900     MOVE SPACES TO AP252-RECORD.                                 27090000
271000/                                                                 27100000
271100*---------------------------------------------------------------- 27110000
271200*   FILL IN THE PO/STORE INVOICE FILE RECORD FOR INVOICE RECORDS. 27120000
271300*---------------------------------------------------------------- 27130000
271400 P950-CREATE-POSTR-INV-RECORD.                                    27140000
271500                                                                  27150000
271600     MOVE 'P950-CREATE-POSTR-INV-RECORD' TO                       27160000
271700             PV-CURRENT-PARAGRAPH.                                27170000
271800                                                                  27180000
271900     MOVE SPACES                    TO AP058-RECORD.              27190000
272000     MOVE PV-PO-BEING-PROCESSED     TO PV-PO-BEING-PROCESSED-9.   27200000
272100     MOVE PV-PO-BEING-PROCESSED-9   TO AP058-PO-NBR.              27210000
272200     MOVE PV-NUMERIC-STORE          TO AP058-STORE-NUMBER.        27220000
272300     MOVE '1'                       TO AP058-RECORD-TYPE.         27230000
272400     MOVE HOLD-PYMT-IND             TO AP058-PYMT-HOLD-CDE.       27240000
272500     MOVE INVOIC-GRO-COST-AMT       TO AP058-INVOIC-GRO-COST-AMT. 27250000
272600     MOVE PV-HOLD-DUE-DATE-CCYYMMDD TO AP058-PYMT-DUE-DTE.        27260000
272700     MOVE APPD052-FREIGHT-CHARGES   TO AP058-TOTAL-FREIGHT-CHRG.  27270000
272800     MOVE HOLD-DISC-PCT-DEC         TO AP058-TERM-DISC-PCT.       27280000
272810     MOVE APPD052-BOTTLE-DEP-AMT    TO AP058-BOTTLE-DEPOSIT-AMT.  27281013
272900     SUBTRACT APPD052-CD-GIFT-WRAP-AMT FROM APPD052-MISC-CHARGES. 27290000
273000     SUBTRACT APPD052-CD-HANDLING-AMT  FROM APPD052-MISC-CHARGES. 27300000
273010     SUBTRACT APPD052-BOTTLE-DEP-AMT   FROM APPD052-MISC-CHARGES. 27301008
273100     IF APPD052-CD-HANDLING-AMT > ZERO                            27310000
273200        PERFORM E700-DIRECT-SHIP-CALCULATION                      27320000
273300        IF APPD052-CD-HANDLING-AMT > PV-DS-ALLOWED-AMT            27330000
273400           SUBTRACT PV-DS-ALLOWED-AMT FROM APPD052-CD-HANDLING-AMT27340000
273500             GIVING PV-DS-DIFFERENCE-AMT                          27350000
273600        END-IF                                                    27360000
273700     END-IF.                                                      27370000
273800     MOVE APPD052-MISC-CHARGES      TO AP058-TOTAL-MISC-CHRG.     27380000
273900     MOVE APPD052-DNP-CHARGES       TO AP058-TOTAL-DNP-CHRG.      27390000
274000     IF PV-DS-DIFFERENCE-AMT > ZERO                               27400000
274100        ADD  PV-DS-DIFFERENCE-AMT   TO AP058-TOTAL-DNP-CHRG       27410000
274200     END-IF.                                                      27420000
274300     MOVE APPD052-VENDOR-FRT-AMT    TO AP058-TOTAL-VENDOR-FRT.    27430000
274400     MOVE APPD052-ADV-DISC-AMT      TO AP058-ADV-DISC-AMT.        27440000
274500     MOVE APPD052-COOP-ADV-ALLOW-AMT TO AP058-COOP-ADV-ALLOW-AMT. 27450000
274600     MOVE APPD052-NEW-STORE-AMT      TO AP058-NEW-STR-ALLOW-AMT.  27460000
274700     MOVE APPD052-TRADE-AMT          TO AP058-TRD-DISC-ALLOW-AMT. 27470000
274800     MOVE APPD052-MOS-DISC-AMT       TO AP058-MOS-DISC-ALLOW-AMT. 27480000
274900     MOVE APPD052-PRFT-ASST-COOP-AMT TO AP058-ALW-DISC-ALLOW-AMT. 27490000
275000     MOVE APPD052-MISC-DISC-AMT      TO AP058-MISC-DISC-ALLOW-AMT.27500000
275100** WR28461 - ADDED MOVES TO CD-GIFT-WRAP-AMT & CD-HANDLING-AMT    27510000
275200     MOVE APPD052-CD-GIFT-WRAP-AMT  TO AP058-CD-GIFT-WRAP-AMT.    27520000
275300***  IF APPD052-CD-HANDLING-AMT > PV-DS-ALLOWED-AMT               27530000
275400***      MOVE PV-DS-ALLOWED-AMT     TO AP058-CD-HANDLING-AMT      27540000
275500***  ELSE                                                         27550000
275600     MOVE APPD052-CD-HANDLING-AMT TO AP058-CD-HANDLING-AMT.       27560000
275700*    IF INVOIC-INVC-TYP-CDE = PC-WO-TYPE                          27570000
275800*       MOVE 'Y'                    TO AP058-WRITE-OFF-IND        27580000
275900*    ELSE                                                         27590000
276000*       MOVE 'N'                    TO AP058-WRITE-OFF-IND        27600000
276100*    END-IF.                                                      27610000
276200*                                                                 27620000
276300     EVALUATE TRUE                                                27630000
276400         WHEN INVOIC-INVC-TYP-CDE = PC-WO-TYPE                    27640000
276500              SET AP058-WRITE-OFF-INVC    TO TRUE                 27650000
276510         WHEN INVOIC-INVC-TYP-CDE = PC-MI-TYPE                    27651000
276520              SET AP058-MERCH-INVC        TO TRUE                 27652000
276530         WHEN INVOIC-INVC-TYP-CDE = PC-INVOICE-RI-CODE            27653000
276540              SET AP058-REMAINDER-INVC    TO TRUE                 27654000
276550     END-EVALUATE.                                                27655000
276560                                                                  27656000
276570     PERFORM U700-INSERT-PO-STR-INVC.                             27657000
276580     MOVE SPACES TO AP058-RECORD.                                 27658000
276590/                                                                 27659000
276600*---------------------------------------------------------------- 27660000
276700*   FILL IN THE PO/STORE INVOICE FILE RECORD FOR REMAINDER        27670000
276800*   INVOICE RECORDS.                                              27680000
276900*---------------------------------------------------------------- 27690000
277000 P955-CREATE-POSTR-RINV-RECORD.                                   27700000
277100                                                                  27710000
277200     MOVE 'P955-CREATE-POSTR-RINV-RECORD' TO                      27720000
277300             PV-CURRENT-PARAGRAPH.                                27730000
277400                                                                  27740000
277500     MOVE SPACES                  TO AP058-RECORD.                27750000
277600     MOVE PV-PO-BEING-PROCESSED   TO PV-PO-BEING-PROCESSED-9.     27760000
277700     MOVE PV-PO-BEING-PROCESSED-9 TO AP058-PO-NBR.                27770000
277800     MOVE PV-NUMERIC-STORE        TO AP058-STORE-NUMBER.          27780000
277900     MOVE '3'                     TO AP058-RECORD-TYPE.           27790000
278000     MOVE INVOIC-GRO-COST-AMT     TO AP058-RI-GRO-COST-AMT.       27800000
278100     MOVE APPD052-NEW-STORE-AMT   TO AP058-RI-NEW-STR-ALLOW-AMT.  27810000
278200     MOVE APPD052-TRADE-AMT       TO AP058-RI-TRD-DISC-ALLOW-AMT. 27820000
278300     MOVE APPD052-MOS-DISC-AMT    TO AP058-RI-MOS-DISC-ALLOW-AMT. 27830000
278400     MOVE APPD052-ADV-DISC-AMT    TO AP058-RI-ADV-DISC-AMT.       27840000
278500     MOVE APPD052-MISC-DISC-AMT   TO AP058-RI-MISC-DISC-ALLOW-AMT.27850000
278600     MOVE APPD052-COOP-ADV-ALLOW-AMT                              27860000
278700                                  TO AP058-RI-COOP-ADV-ALLOW-AMT. 27870000
278800     MOVE APPD052-PRFT-ASST-COOP-AMT                              27880000
278900                                  TO AP058-RI-ALW-DISC-ALLOW-AMT. 27890000
279000                                                                  27900000
279100     PERFORM U700-INSERT-PO-STR-INVC.                             27910000
279200     MOVE SPACES TO AP058-RECORD.                                 27920000
279300/                                                                 27930000
279400*---------------------------------------------------------------- 27940000
279500*   FILL IN THE PO/STORE INVOICE FILE RECORD FOR PRICE            27950000
279600*   CLAIM RECORDS.                                                27960000
279700*---------------------------------------------------------------- 27970000
279800 P960-CREATE-POSTR-PRCLM-RECORD.                                  27980000
279900                                                                  27990000
280000     MOVE 'P960-CREATE-POSTR-PRCLM-RECORD' TO                     28000000
280100             PV-CURRENT-PARAGRAPH.                                28010000
280200                                                                  28020000
280300     MOVE SPACES                  TO AP058-RECORD.                28030000
280400     MOVE PV-PO-BEING-PROCESSED   TO PV-PO-BEING-PROCESSED-9.     28040000
280500     MOVE PV-PO-BEING-PROCESSED-9 TO AP058-PO-NBR.                28050000
280600     MOVE PV-NUMERIC-STORE        TO AP058-STORE-NUMBER.          28060000
280700     MOVE '2'                     TO AP058-RECORD-TYPE.           28070000
280800     MOVE PV-TOT-PRCCLM           TO AP058-PC-GRO-COST-AMT.       28080000
280900     MOVE PV-ADV-TOT              TO AP058-PC-ADV-DISC-AMT.       28090000
281000     MOVE PV-COOP-ADV-TOT         TO AP058-PC-COOP-ADV-ALLOW-AMT. 28100000
281100     MOVE PV-NEW-STORE-TOT        TO AP058-PC-NEW-STR-ALLOW-AMT.  28110000
281200     MOVE PV-TRADE-TOT            TO AP058-PC-TRD-DISC-ALLOW-AMT. 28120000
281300     MOVE PV-MOS-TOT              TO AP058-PC-MOS-DISC-ALLOW-AMT. 28130000
281400     MOVE PV-ALW-TOT              TO AP058-PC-ALW-DISC-ALLOW-AMT. 28140000
281500     MOVE PV-MISC-TOT             TO AP058-PC-MISC-DISC-ALLOW-AMT.28150000
281600                                                                  28160000
281700     PERFORM U700-INSERT-PO-STR-INVC.                             28170000
281800     MOVE SPACES TO AP058-RECORD.                                 28180000
281900     MOVE ZEROS  TO PV-ADV-TOT                                    28190000
282000                    PV-COOP-ADV-TOT                               28200000
282100                    PV-NEW-STORE-TOT                              28210000
282200                    PV-MOS-TOT                                    28220000
282300                    PV-TRADE-TOT                                  28230000
282400                    PV-ALW-TOT                                    28240000
282500                    PV-MISC-TOT                                   28250000
282600                    PV-TOT-PRCCLM.                                28260000
282700/                                                                 28270000
282800*---------------------------------------------------------------- 28280000
282900*   MOVE ALL DISCOUNT FIELDS FROM THE APWS052 WORK FIELDS INTO    28290000
283000*   THE APPROPRIATE APRD040 FIELDS.                               28300000
283100*---------------------------------------------------------------- 28310000
283200 Q100-PROCESS-DISCOUNTS.                                          28320000
283300                                                                  28330000
283400     MOVE APPD052-NEW-STORE-AMT      TO AP040-NW-STR-DISC-AMT.    28340000
283500     COMPUTE AP040-NW-STR-DISC-PCT =                              28350000
283600                          APPD052-NEW-STORE-DISC-PCT / 100.       28360000
283700                                                                  28370000
283800     MOVE APPD052-TRADE-AMT          TO AP040-TRD-DISC-AMT.       28380000
283900     COMPUTE AP040-TRD-DISC-PCT = APPD052-TRADE-DISC-PCT / 100.   28390000
284000                                                                  28400000
284100     MOVE APPD052-MOS-DISC-AMT       TO AP040-MOS-DISC-AMT.       28410000
284200     COMPUTE AP040-MOS-DISC-PCT = APPD052-MOS-DISC-PCT / 100.     28420000
284300                                                                  28430000
284400     MOVE APPD052-ADV-DISC-AMT       TO AP040-ADV-DISC-AMT.       28440000
284500     COMPUTE AP040-ADV-DISC-PCT = APPD052-ADV-DISC-PCT / 100.     28450000
284600                                                                  28460000
284700     MOVE APPD052-COOP-ADV-ALLOW-AMT TO AP040-COOP-DISC-AMT.      28470000
284800     COMPUTE AP040-COOP-DISC-PCT =                                28480000
284900                          APPD052-COOP-ADV-ALLOW-PCT / 100.       28490000
285000                                                                  28500000
285100     MOVE APPD052-PRFT-ASST-COOP-AMT TO AP040-ALW-DISC-AMT.       28510000
285200     COMPUTE AP040-ALW-DISC-PCT =                                 28520000
285300                          APPD052-PRFT-ASST-COOP-PCT / 100.       28530000
285400                                                                  28540000
285500     MOVE APPD052-MISC-DISC-AMT      TO AP040-MSC-DISC-AMT.       28550000
285600     COMPUTE AP040-MSC-DISC-PCT = APPD052-MISC-DISC-PCT / 100.    28560000
285700                                                                  28570000
285800/                                                                 28580000
285900*---------------------------------------------------------------- 28590000
286000*                                                                 28600000
286100* CREATE THE AMOUNTS AND PERCENTAGES FOR PRICE CLAIM TRANSACTIONS 28610000
286200*---------------------------------------------------------------- 28620000
286300 Q200-PROCESS-PRCCLM-DISCOUNTS.                                   28630000
286400                                                                  28640000
286500     COMPUTE APPD052-NEW-STORE-AMT =                              28650000
286600            PV-PRCCLM-AMT * (APPD052-NEW-STORE-DISC-PCT / 100).   28660000
286700     ADD  APPD052-NEW-STORE-AMT TO PV-NEW-STORE-TOT.              28670000
286800                                                                  28680000
286900     COMPUTE APPD052-TRADE-AMT =                                  28690000
287000            PV-PRCCLM-AMT * (APPD052-TRADE-DISC-PCT / 100).       28700000
287100     ADD  APPD052-TRADE-AMT TO PV-TRADE-TOT.                      28710000
287200                                                                  28720000
287300     COMPUTE APPD052-MOS-DISC-AMT =                               28730000
287400            PV-PRCCLM-AMT * (APPD052-MOS-DISC-PCT / 100).         28740000
287500     ADD  APPD052-MOS-DISC-AMT TO PV-MOS-TOT.                     28750000
287600                                                                  28760000
287700     COMPUTE APPD052-ADV-DISC-AMT =                               28770000
287800            PV-PRCCLM-AMT * (APPD052-ADV-DISC-PCT / 100).         28780000
287900     ADD  APPD052-ADV-DISC-AMT TO PV-ADV-TOT.                     28790000
288000                                                                  28800000
288100     COMPUTE APPD052-COOP-ADV-ALLOW-AMT =                         28810000
288200            PV-PRCCLM-AMT * (APPD052-COOP-ADV-ALLOW-PCT / 100).   28820000
288300     ADD  APPD052-COOP-ADV-ALLOW-AMT TO PV-COOP-ADV-TOT.          28830000
288400                                                                  28840000
288500     COMPUTE APPD052-PRFT-ASST-COOP-AMT =                         28850000
288600            PV-PRCCLM-AMT * (APPD052-PRFT-ASST-COOP-PCT / 100).   28860000
288700     ADD  APPD052-PRFT-ASST-COOP-AMT TO PV-ALW-TOT.               28870000
288800                                                                  28880000
288900     COMPUTE APPD052-MISC-DISC-AMT =                              28890000
289000            PV-PRCCLM-AMT * (APPD052-MISC-DISC-PCT / 100).        28900000
289100     ADD  APPD052-MISC-DISC-AMT TO PV-MISC-TOT.                   28910000
289200                                                                  28920000
289300/                                                                 28930000
289400*---------------------------------------------------------------- 28940000
289500*    RETRIEVES THE PAYMENT FLOAT DAYS FROM THE AP PAYMENT         28950000
289600*    CONTROL TABLE.                                               28960000
289700*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE PREVENTS THE   28970000
289800*           CALCULATION OF WITHIN TOLERANCE AMOUNTS AND PAYMENT   28980000
289900*           DUE AND CUTOFF DATES SO PROCESSING CANNOT PROCEED     28990000
290000*           AND THE PROGRAM MUST ABEND.                           29000000
290100*---------------------------------------------------------------- 29010000
290200 R100-SELECT-CONTROL-DATA.                                        29020000
290300                                                                  29030000
290400     MOVE 'R100-SELECT-CONTROL-DATA' TO PV-CURRENT-PARAGRAPH.     29040000
290500                                                                  29050000
290600     EXEC SQL                                                     29060000
290700         SELECT PAYT_FLOAT_DAY_QTY                                29070000
290800               ,BTCH_PRC_DTE                                      29080000
290900         INTO   :APCNTL-PAYT-FLOAT-DAY-QTY                        29090000
291000               ,:APCNTL-BTCH-PRC-DTE                              29100000
291100         FROM TAPCNTL                                             29110000
291200     END-EXEC.                                                    29120000
291300                                                                  29130000
291400     EVALUATE TRUE                                                29140000
291500         WHEN SQLCODE = ZERO                                      29150000
291600              CONTINUE                                            29160000
291700                                                                  29170000
291800         WHEN SQLWARN0 NOT = SPACES                               29180000
291900         WHEN SQLCODE  NOT = ZERO                                 29190000
292000         MOVE PV-CURRENT-PARAGRAPH                                29200000
292100                            TO AA-PARAGRAPH-NAME                  29210000
292200         MOVE 'UNSUCCESSFUL SELECT OF PAYMENT CONTROL TBL'        29220000
292300                            TO AA-DB2-OP-1                        29230000
292400         MOVE 'TAPCNTL'     TO AA-DB2-TABLE-1                     29240000
292500         MOVE SPACES        TO AA-DB2-TABLE-2                     29250000
292600                               AA-DB2-TABLE-3                     29260000
292700                               AA-DB2-TABLE-4                     29270000
292800                               AA-DB2-TABLE-5                     29280000
292900         PERFORM Z998-DB2-ABEND                                   29290000
293000     END-EVALUATE.                                                29300000
293100/                                                                 29310000
293200*---------------------------------------------------------------- 29320000
293300*    RETRIEVES THE PURCHASE ORDERS TO BE PROCESSED.               29330000
293400*---------------------------------------------------------------- 29340000
293500 R200-FETCH-RELEASED-POS.                                         29350000
293600                                                                  29360000
293700     MOVE 'R200-FETCH-RELEASED-POS' TO PV-CURRENT-PARAGRAPH.      29370000
293800                                                                  29380000
293900     EXEC SQL                                                     29390000
294000         FETCH PO_CSR                                             29400000
294100         INTO :POSTRR-PO-NBR                                      29410000
294200             ,:POSTRR-STR-NBR                                     29420000
294300             ,:POSTRR-PAYT-RLSE-TMST                              29430000
294400             ,:POSTRR-CRE-PRC-CDE                                 29440000
294500             ,:POSTRR-MTCH-LVL-CDE                                29450000
294600     END-EXEC.                                                    29460000
294700                                                                  29470000
294800     EVALUATE TRUE                                                29480000
294900         WHEN SQLCODE = ZERO                                      29490000
295000              ADD 1 TO PA-PO-COUNT                                29500000
295100                                                                  29510000
295200         WHEN SQLCODE = +100                                      29520000
295300              SET OUT-OF-POS TO TRUE                              29530000
295400                                                                  29540000
295500         WHEN SQLWARN0 NOT = SPACES                               29550000
295600         WHEN SQLCODE  NOT = ZERO                                 29560000
295700             MOVE PV-CURRENT-PARAGRAPH                            29570000
295800                              TO AA-PARAGRAPH-NAME                29580000
295900             MOVE 'UNSUCCESSFUL FETCH WITH PO_CSR'                29590000
296000                              TO AA-DB2-OP-1                      29600000
296100             MOVE 'TPOSTRR'   TO AA-DB2-TABLE-1                   29610000
296200             MOVE SPACES      TO AA-DB2-TABLE-2                   29620000
296300                                 AA-DB2-TABLE-3                   29630000
296400                                 AA-DB2-TABLE-4                   29640000
296500                                 AA-DB2-TABLE-5                   29650000
296600             PERFORM Z998-DB2-ABEND                               29660000
296700     END-EVALUATE.                                                29670000
296800/                                                                 29680000
296900*---------------------------------------------------------------- 29690000
297000*    RETRIEVES THE ENTERED AND IN RECONCILIATION INVOICES FOR     29700000
297100*    THE PURCHASE ORDER BEING PROCESSED.                          29710000
297200*---------------------------------------------------------------- 29720000
297300 R300-FETCH-INVOICES.                                             29730000
297400                                                                  29740000
297500     MOVE 'R300-FETCH-INVOICES     ' TO PV-CURRENT-PARAGRAPH.     29750000
297600                                                                  29760000
297700     EXEC SQL                                                     29770000
297800         FETCH INVOICE_CSR                                        29780000
297900         INTO :INVOIC-INVC-ID                                     29790000
298000             ,:INVOIC-PAYT-REQ-SEQ-NBR                            29800000
298100             ,:INVOIC-CRE-DTE                                     29810000
298200             ,:INVOIC-STR-NBR                                     29820000
298300             ,:INVOIC-INVC-TYP-CDE                                29830000
298400             ,:INVOIC-STATUS-CDE                                  29840000
298500             ,:INVOIC-INVC-DTE                                    29850000
298600             ,:INVOIC-HOLD-IND                                    29860000
298700             ,:INVOIC-ENTR-MTHD-CDE                               29870000
298800             ,:INVOIC-PAYT-RLSE-TMST                              29880000
298900             ,:INVOIC-GRO-COST-AMT                                29890000
299000             ,:INVOIC-BAR-CDE                                     29900000
299100             ,:INVOIC-CALC-DUE-DTE                                29910000
299200             ,:INVOIC-PAYT-DTE                                    29920000
299300             ,:MDINVC-TERM-SEL-CDE                                29930000
299400             ,:MDINVC-VEND-FRGT-PCT                               29940000
299500             ,:MDINVC-KOHLS-FRGT-PCT                              29950000
299600             ,:MDINVC-TOT-INVC-PC-QTY                             29960000
299700             ,:INVOIC-DC-NBR                                      29970000
299800             ,:INVOIC-MTCH-LVL-CDE                                29980000
299900     END-EXEC.                                                    29990000
300000                                                                  30000000
300100     EVALUATE TRUE                                                30010000
300200         WHEN SQLCODE = ZERO                                      30020000
300300              ADD 1 TO PA-INVOICE-COUNT                           30030000
300400                                                                  30040000
300500         WHEN SQLCODE = +100                                      30050000
300600              SET OUT-OF-INVOICES TO TRUE                         30060000
300700                                                                  30070000
300800         WHEN SQLWARN0 NOT = SPACES                               30080000
300900         WHEN SQLCODE  NOT = ZERO                                 30090000
301000             MOVE PV-CURRENT-PARAGRAPH                            30100000
301100                                TO AA-PARAGRAPH-NAME              30110000
301200             MOVE 'BAD FETCH WITH INVOICE_STORE_CSR'              30120000
301300                                TO AA-DB2-OP-1                    30130000
301400             MOVE 'TINVOIC'     TO AA-DB2-TABLE-1                 30140000
301500             MOVE 'TMDINVC'     TO AA-DB2-TABLE-2                 30150000
301600             MOVE SPACES        TO AA-DB2-TABLE-3                 30160000
301700                                   AA-DB2-TABLE-4                 30170000
301800                                   AA-DB2-TABLE-5                 30180000
301900             PERFORM Z998-DB2-ABEND                               30190000
302000     END-EVALUATE.                                                30200000
302100/                                                                 30210000
302200*---------------------------------------------------------------- 30220000
302300*    SELECT IS MADE TO SEE IF THERE IS A REMAINDER INVOICE FOR    30230000
302400*    THE INPUT PO.                                                30240000
302500*---------------------------------------------------------------- 30250000
302600 R400-SELECT-REMAINDER-INV.                                       30260000
302700                                                                  30270000
302800     MOVE 'R400-SELECT-REMAINDER-INV' TO PV-CURRENT-PARAGRAPH.    30280000
302900                                                                  30290000
303000     EXEC SQL                                                     30300000
303100         SELECT                                                   30310000
303200             IV.INVC_ID                                           30320000
303300            ,IV.PAYT_REQ_SEQ_NBR                                  30330000
303400            ,IV.CRE_DTE                                           30340000
303500            ,IV.STR_NBR                                           30350000
303600            ,IV.INVC_TYP_CDE                                      30360000
303700            ,IV.STATUS_CDE                                        30370000
303800            ,IV.INVC_DTE                                          30380000
303900            ,IV.HOLD_IND                                          30390000
304000            ,IV.ENTR_MTHD_CDE                                     30400000
304100            ,IV.PAYT_RLSE_TMST                                    30410000
304200            ,IV.GRO_COST_AMT                                      30420000
304300            ,IV.BAR_CDE                                           30430000
304400            ,MI.TERM_SEL_CDE                                      30440000
304500            ,MI.VEND_FRGT_PCT                                     30450000
304600            ,MI.KOHLS_FRGT_PCT                                    30460000
304700         INTO :INVOIC-INVC-ID                                     30470000
304800             ,:INVOIC-PAYT-REQ-SEQ-NBR                            30480000
304900             ,:INVOIC-CRE-DTE                                     30490000
305000             ,:INVOIC-STR-NBR                                     30500000
305100             ,:INVOIC-INVC-TYP-CDE                                30510000
305200             ,:INVOIC-STATUS-CDE                                  30520000
305300             ,:INVOIC-INVC-DTE                                    30530000
305400             ,:INVOIC-HOLD-IND                                    30540000
305500             ,:INVOIC-ENTR-MTHD-CDE                               30550000
305600             ,:INVOIC-PAYT-RLSE-TMST                              30560000
305700             ,:INVOIC-GRO-COST-AMT                                30570000
305800             ,:INVOIC-BAR-CDE                                     30580000
305900             ,:MDINVC-TERM-SEL-CDE                                30590000
306000             ,:MDINVC-VEND-FRGT-PCT                               30600000
306100             ,:MDINVC-KOHLS-FRGT-PCT                              30610000
306200         FROM                                                     30620000
306300             TINVOIC IV                                           30630000
306400            ,TMDINVC MI                                           30640000
306500         WHERE                                                    30650000
306600              IV.PO_NBR          = :PV-PO-BEING-PROCESSED         30660000
306700         AND  IV.PO_NBR          = MI.PO_NBR                      30670000
306800         AND  IV.INVC_ID         = MI.INVC_ID                     30680000
306900         AND  IV.INVC_TYP_CDE    = :PC-INVOICE-RI-CODE            30690000
307000         AND  IV.STR_NBR         = :PV-STORE-BEING-PROCESSED      30700000
307100         AND  IV.STR_NBR BETWEEN :PV-STR-NBR-LOW                  30710000
307200                             AND :PV-STR-NBR-HIGH                 30720000
307300         AND  IV.DC_NBR  BETWEEN :PV-DC-NBR-LOW                   30730000
307400                             AND :PV-DC-NBR-HIGH                  30740000
307500         AND  IV.STATUS_CDE      IN (:PC-INVOICE-EN-CODE,         30750000
307600                                     :PC-INVOICE-RC-CODE)         30760000
307700         AND  IV.MTCH_LVL_CDE    = :POSTRR-MTCH-LVL-CDE           30770000
307800         AND  IV.PAYT_RLSE_TMST  = :PV-RI-TMST                    30780000
307900     END-EXEC.                                                    30790000
308000                                                                  30800000
308100     EVALUATE TRUE                                                30810000
308200         WHEN SQLCODE = ZERO                                      30820000
308300             SET REMAINDER-INV-FOUND TO TRUE                      30830000
308400                                                                  30840000
308500         WHEN SQLCODE = +100                                      30850000
308600             SET REMAINDER-INV-NF    TO TRUE                      30860000
308700                                                                  30870000
308800         WHEN SQLWARN0 NOT = SPACES                               30880000
308900         WHEN SQLCODE  NOT = ZERO                                 30890000
309000             MOVE PV-CURRENT-PARAGRAPH                            30900000
309100                                 TO AA-PARAGRAPH-NAME             30910000
309200             MOVE 'UNSUCCESSFUL FETCH WITH RECEIPTS_CSR'          30920000
309300                                 TO AA-DB2-OPERATION              30930000
309400             MOVE 'TMDINVC'      TO AA-DB2-TABLE-1                30940000
309500             MOVE 'TINVOIC'      TO AA-DB2-TABLE-2                30950000
309600             MOVE SPACES         TO AA-DB2-TABLE-3                30960000
309700                                    AA-DB2-TABLE-4                30970000
309800                                    AA-DB2-TABLE-5                30980000
309900             PERFORM Z998-DB2-ABEND                               30990000
310000     END-EVALUATE.                                                31000000
310100/                                                                 31010000
310200*---------------------------------------------------------------- 31020000
310300*    RETRIEVES THE ALLOWANCE/CHARGE INFORMATION                   31030000
310400*---------------------------------------------------------------- 31040000
310500 R500-FETCH-ALW-CHRG.                                             31050000
310600                                                                  31060000
310700     MOVE 'R500-FETCH-ALW-CHRG' TO PV-CURRENT-PARAGRAPH.          31070000
310800                                                                  31080000
310900     EXEC SQL                                                     31090000
311000         FETCH ALW_CHRG_CSR                                       31100000
311100         INTO :ALCHRG-ALW-CHRG-TYP-CDE                            31110000
311200             ,:ALCHRG-ALW-CHRG-CDE                                31120000
311300             ,:ALCHRG-ALW-CHRG-PCT                                31130000
311400             ,:ALCHRG-ALW-CHRG-AMT                                31140000
311500     END-EXEC.                                                    31150000
311600                                                                  31160000
311700     EVALUATE TRUE                                                31170000
311800         WHEN SQLCODE = +100                                      31180000
311900              SET ALW-CHRG-NOT-FOUND TO TRUE                      31190000
312000                                                                  31200000
312100         WHEN SQLCODE = ZERO                                      31210000
312200              SET ALW-CHRG-PROCESS TO TRUE                        31220000
312300              IF ALCHRG-ALW-CHRG-TYP-CDE EQUAL 'A'                31230000
312400                  SET PS-ALLOWANCES-EXIST TO TRUE                 31240000
312500              END-IF                                              31250000
312600                                                                  31260000
312700         WHEN SQLWARN0 NOT = SPACES                               31270000
312800         WHEN SQLCODE  NOT = ZERO                                 31280000
312900             MOVE PV-CURRENT-PARAGRAPH                            31290000
313000                                 TO AA-PARAGRAPH-NAME             31300000
313100             MOVE                                                 31310000
313200               'UNSUCCESSFUL FETCH WITH ALW_CHRG_CSR'             31320000
313300                                 TO AA-DB2-OPERATION              31330000
313400             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                31340000
313500             MOVE SPACES         TO AA-DB2-TABLE-2                31350000
313600                                    AA-DB2-TABLE-3                31360000
313700                                    AA-DB2-TABLE-4                31370000
313800                                    AA-DB2-TABLE-5                31380000
313900             PERFORM Z998-DB2-ABEND                               31390000
314000     END-EVALUATE.                                                31400000
314100/                                                                 31410000
314200*---------------------------------------------------------------- 31420000
314300*    RETRIEVES THE TERMS WHEN THE TERM SELECT CODE INDICATES      31430000
314400*    THEY EXIST ON THE PURCHASE ORDER TABLES.                     31440000
314500*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE PREVENTS THE   31450000
314600*           CALCULATION OF THE PAYMENT DUE DATE SO PROCESSING     31460000
314700*           CANNOT PROCEED AND THE PROGRAM MUST ABEND.            31470000
314800*---------------------------------------------------------------- 31480000
314900 R600-GET-PO-TERMS.                                               31490000
315000                                                                  31500000
315100     MOVE 'R600-GET-PO-TERMS' TO PV-CURRENT-PARAGRAPH.            31510000
315200                                                                  31520000
315300     EXEC SQL                                                     31530000
315400         SELECT                                                   31540000
315500             PA.DISC_PAY_DAY_QTY                                  31550000
315600            ,PT.DISCOUNT_PCT                                      31560000
315700            ,PT.DUE_DAY_QTY                                       31570000
315800            ,PT.DISCOUNT_DAYS_QTY                                 31580000
315900            ,PT.DUE_DAY_FR_DTE_TXT                                31590000
316000         INTO                                                     31600000
316100             :POAGMT-DISC-PAY-DAY-QTY                             31610000
316200            ,:PAYTRM-DISCOUNT-PCT                                 31620000
316300            ,:PAYTRM-DUE-DAY-QTY                                  31630000
316400            ,:PAYTRM-DISCOUNT-DAYS-QTY                            31640000
316500            ,:PAYTRM-DUE-DAY-FR-DTE-TXT                           31650000
316600         FROM                                                     31660000
316700             TPOAGMT PA                                           31670000
316800            ,TPAYTRM PT                                           31680000
316900         WHERE PA.PO_NBR         = :PV-PO-BEING-PROCESSED         31690000
317000           AND PA.PAYT_TERM_ID   = PT.PAY_TERM_ID                 31700000
317100           AND PA.AGRMT_TYP_ID   = '2'                            31710000
317200           AND PA.VER_STATUS_CDE = 'A'                            31720000
317300     END-EXEC.                                                    31730000
317400                                                                  31740000
317500     EVALUATE TRUE                                                31750000
317600         WHEN SQLCODE = ZERO                                      31760000
317700         WHEN SQLCODE = +100                                      31770000
317800              CONTINUE                                            31780000
317900                                                                  31790000
318000         WHEN SQLWARN0 NOT = SPACES                               31800000
318100         WHEN SQLCODE  NOT = ZERO                                 31810000
318200             MOVE PV-CURRENT-PARAGRAPH                            31820000
318300                                 TO AA-PARAGRAPH-NAME             31830000
318400             MOVE 'UNSUCCESSFUL SELECT'                           31840000
318500                                 TO AA-DB2-OPERATION              31850000
318600             MOVE 'TPOAGMT'      TO AA-DB2-TABLE-1                31860000
318700             MOVE 'TPAYTRM'      TO AA-DB2-TABLE-2                31870000
318800             MOVE SPACES         TO AA-DB2-TABLE-3                31880000
318900                                    AA-DB2-TABLE-4                31890000
319000                                    AA-DB2-TABLE-5                31900000
319100             PERFORM Z998-DB2-ABEND                               31910000
319200     END-EVALUATE.                                                31920000
319300                                                                  31930000
319400     EXEC SQL                                                     31940000
319500         SELECT  PA.DISC_PAY_DAY_QTY                              31950000
319600           INTO :PV-DISC-EXTENDED-DAYS                            31960000
319700           FROM  TPOAGMT PA                                       31970000
319800          WHERE  PA.PO_NBR         = :PV-PO-BEING-PROCESSED       31980000
319900            AND  PA.VER_STATUS_CDE = 'A'                          31990000
320000            AND  PA.AGRMT_TYP_ID   = '5'                          32000000
320100            AND  PA.TYP_CDE        =  1                           32010000
320200     END-EXEC.                                                    32020000
320300                                                                  32030000
320400     EVALUATE TRUE                                                32040000
320500        WHEN SQLCODE = ZERO                                       32050000
320600             ADD PV-DISC-EXTENDED-DAYS TO POAGMT-DISC-PAY-DAY-QTY 32060000
320700        WHEN SQLCODE = +100                                       32070000
320800             CONTINUE                                             32080000
320900        WHEN SQLWARN0 NOT = SPACES                                32090000
321000        WHEN SQLCODE  NOT = ZERO                                  32100000
321100             MOVE PV-CURRENT-PARAGRAPH   TO AA-PARAGRAPH-NAME     32110000
321200             MOVE 'UNSUCCESSFUL SELECT'  TO AA-DB2-OPERATION      32120000
321300             MOVE 'TPOAGMT'              TO AA-DB2-TABLE-1        32130000
321400             MOVE SPACES                 TO AA-DB2-TABLE-2        32140000
321500             MOVE SPACES                 TO AA-DB2-TABLE-3        32150000
321600             PERFORM Z998-DB2-ABEND                               32160000
321700     END-EVALUATE.                                                32170000
321800/                                                                 32180000
321900*---------------------------------------------------------------- 32190000
322000*    RETRIEVES THE TERMS WHEN THE TERM SELECT CODE INDICATES      32200000
322100*    THEY EXIST ON THE INVOICE TERMS TABLE.                       32210000
322200*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE PREVENTS THE   32220000
322300*           CALCULATION OF THE PAYMENT DUE DATE SO PROCESSING     32230000
322400*           CANNOT PROCEED AND THE PROGRAM MUST ABEND.            32240000
322500*---------------------------------------------------------------- 32250000
322600 R700-GET-INVOICE-TERMS.                                          32260000
322700                                                                  32270000
322800     MOVE 'R700-GET-INVOICE-TERMS' TO PV-CURRENT-PARAGRAPH.       32280000
322900                                                                  32290000
323000     EXEC SQL                                                     32300000
323100         SELECT                                                   32310000
323200             DISC_PCT                                             32320000
323300            ,DISC_DUE_DAY_QTY                                     32330000
323400            ,EXTD_DAYS_QTY                                        32340000
323500            ,TERM_TYP_CDE                                         32350000
323600            ,NET_DUE_DAY_QTY                                      32360000
323700         INTO                                                     32370000
323800             :INVCTM-DISC-PCT                                     32380000
323900            ,:INVCTM-DISC-DUE-DAY-QTY                             32390000
324000            ,:INVCTM-EXTD-DAYS-QTY                                32400000
324100            ,:INVCTM-TERM-TYP-CDE                                 32410000
324200            ,:INVCTM-NET-DUE-DAY-QTY                              32420000
324300         FROM TINVCTM                                             32430000
324400        WHERE PO_NBR        = :PV-PO-BEING-PROCESSED              32440000
324500          AND INVC_ID       = :INVOIC-INVC-ID                     32450000
324600          AND TERM_SEQ_NBR  = 1                                   32460000
324700     END-EXEC.                                                    32470000
324800                                                                  32480000
324900     EVALUATE TRUE                                                32490000
325000         WHEN SQLCODE = ZERO                                      32500000
325100         WHEN SQLCODE = +100                                      32510000
325200              CONTINUE                                            32520000
325300                                                                  32530000
325400         WHEN SQLWARN0 NOT = SPACES                               32540000
325500         WHEN SQLCODE  NOT = ZERO                                 32550000
325600             MOVE PV-CURRENT-PARAGRAPH                            32560000
325700                                 TO AA-PARAGRAPH-NAME             32570000
325800             MOVE 'UNSUCCESSFUL SELECT'                           32580000
325900                                 TO AA-DB2-OPERATION              32590000
326000             MOVE 'TINVCTM'      TO AA-DB2-TABLE-1                32600000
326100             MOVE SPACES         TO AA-DB2-TABLE-2                32610000
326200                                    AA-DB2-TABLE-3                32620000
326300                                    AA-DB2-TABLE-4                32630000
326400                                    AA-DB2-TABLE-5                32640000
326500             PERFORM Z998-DB2-ABEND                               32650000
326600     END-EVALUATE.                                                32660000
326700/                                                                 32670000
326800*---------------------------------------------------------------- 32680000
326900*    RETRIEVES THE PURCHASE ORDER DEPARTMENT AND DUNNS NUMBER.    32690000
327000*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE RESULTS IN     32700000
327100*           AN ABEND.  DUNNS NUMBER IS A KEY FIELD FOR PAYMENT    32710000
327200*           HISTORY AND MUST BE FILLED IN.                        32720000
327300*---------------------------------------------------------------- 32730000
327400 R800-GET-DEPT-DUNS-DATA.                                         32740000
327500                                                                  32750000
327600     MOVE 'R800-GET-DEPT-DUNS-DATA' TO PV-CURRENT-PARAGRAPH.      32760000
327700                                                                  32770000
327800     EXEC SQL                                                     32780000
327900         SELECT                                                   32790000
328000             PU.PO_TYP_CDE                                        32800000
328100            ,PU.ENT_ID                                            32810000
328200            ,PU.DEPT_NBR                                          32820000
328300            ,EE.DUN_NBR                                           32830000
328400         INTO                                                     32840000
328500             :PURCHS-PO-TYP-CDE                                   32850000
328600            ,:PURCHS-ENT-ID                                       32860000
328700            ,:PURCHS-DEPT-NBR                                     32870000
328800            ,:EXTENT-DUN-NBR                                      32880000
328900         FROM TPURCHS PU                                          32890000
329000             ,TEXTENT EE                                          32900000
329100         WHERE PU.PO_NBR         = :PV-PO-BEING-PROCESSED         32910000
329200           AND PU.ENT_ID         = EE.ENT_ID                      32920000
329300           AND PU.VER_STATUS_CDE = 'A'                            32930000
329400     END-EXEC.                                                    32940000
329500                                                                  32950000
329600     EVALUATE TRUE                                                32960000
329700         WHEN SQLCODE = ZERO                                      32970000
329800             MOVE PURCHS-DEPT-NBR   TO HOLD-DEPT                  32980000
329900                                       PV-HOLD-DEPT               32990000
330000             MOVE EXTENT-DUN-NBR    TO HOLD-DUNS-NO               33000000
330100             MOVE PURCHS-PO-TYP-CDE TO PV-PO-TYP-CDE              33010000
330200                                                                  33020000
330300         WHEN SQLCODE = +100                                      33030000
330400             MOVE PV-CURRENT-PARAGRAPH                            33040000
330500                                 TO AA-PARAGRAPH-NAME             33050000
330600             MOVE 'DUNS NBR NOT FOUND ON TEXTENT TABLE'           33060000
330700                                 TO AA-DB2-OPERATION              33070000
330800             MOVE 'TPURCHS'      TO AA-DB2-TABLE-1                33080000
330900             MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                33090000
331000             MOVE SPACES         TO AA-DB2-TABLE-3                33100000
331100                                    AA-DB2-TABLE-4                33110000
331200                                    AA-DB2-TABLE-5                33120000
331300             PERFORM Z998-DB2-ABEND                               33130000
331400                                                                  33140000
331500         WHEN SQLWARN0 NOT = SPACES                               33150000
331600         WHEN SQLCODE  NOT = ZERO                                 33160000
331700             MOVE PV-CURRENT-PARAGRAPH                            33170000
331800                                 TO AA-PARAGRAPH-NAME             33180000
331900             MOVE 'UNSUCCESSFUL SELECT FOR DEPT/DUNS  '           33190000
332000                                 TO AA-DB2-OPERATION              33200000
332100             MOVE 'TPURCHS'      TO AA-DB2-TABLE-1                33210000
332200             MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                33220000
332300             MOVE SPACES         TO AA-DB2-TABLE-3                33230000
332400                                    AA-DB2-TABLE-4                33240000
332500                                    AA-DB2-TABLE-5                33250000
332600             PERFORM Z998-DB2-ABEND                               33260000
332700     END-EVALUATE.                                                33270000
332800/                                                                 33280000
332900*---------------------------------------------------------------- 33290000
333000*    RETRIEVES THE VENDER NAME AND INHOUSE NUMBER.                33300000
333100*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE RESULTS IN     33310000
333200*           THE VENDOR NAME BEING FILLED WITH 'VENDOR NOT FOUND'. 33320000
333300*           INHOUSE NBR.                                          33330000
333400*---------------------------------------------------------------- 33340000
333500 R850-GET-VENDOR-NAME.                                            33350000
333600                                                                  33360000
333700     MOVE 'R850-GET-VENDOR-NAME' TO PV-CURRENT-PARAGRAPH.         33370000
333800                                                                  33380000
333900     EXEC SQL                                                     33390000
334000         SELECT                                                   33400000
334100             EN.ENT_NAME_DESC                                     33410000
334200            ,EN.ENT_ID                                            33420000
334300            ,VN.INHOUSE_NBR                                       33430000
334400         INTO                                                     33440000
334500             :ENTNME-ENT-NAME-DESC                                33450000
334600            ,:ENTNME-ENT-ID                                       33460000
334700            ,:VNDDPT-INHOUSE-NBR                                  33470000
334800         FROM TENTNME EN                                          33480000
334900             ,TVNDDPT VN                                          33490000
335000         WHERE VN.ENT_ID   = :PURCHS-ENT-ID                       33500000
335100           AND VN.DEPT_NBR = :PURCHS-DEPT-NBR                     33510000
335200           AND EN.ENT_ID   = VN.ENT_ID                            33520000
335300           AND EN.TYPE_CDE = '01'                                 33530000
335400     END-EXEC.                                                    33540000
335500                                                                  33550000
335600     EVALUATE TRUE                                                33560000
335700         WHEN SQLCODE = ZERO                                      33570000
335800            MOVE ENTNME-ENT-NAME-DESC TO HOLD-VENDOR-NAME         33580000
335900            MOVE PURCHS-ENT-ID        TO HOLD-VENDOR-ID           33590000
336000                                         PV-HOLD-VENDOR-ID        33600000
336100                                                                  33610000
336200         WHEN SQLCODE = +100                                      33620000
336300            MOVE PC-VENDOR-NF TO HOLD-VENDOR-NAME                 33630000
336400            MOVE ZEROS        TO VNDDPT-INHOUSE-NBR               33640000
336500                                                                  33650000
336600         WHEN SQLWARN0 NOT = SPACES                               33660000
336700         WHEN SQLCODE  NOT = ZERO                                 33670000
336800             MOVE PV-CURRENT-PARAGRAPH                            33680000
336900                                 TO AA-PARAGRAPH-NAME             33690000
337000             MOVE 'UNSUCCESSFUL SELECT FOR VENDOR NAME'           33700000
337100                                 TO AA-DB2-OPERATION              33710000
337200             MOVE 'TENTNME'      TO AA-DB2-TABLE-1                33720000
337300             MOVE 'TVNDDPT'      TO AA-DB2-TABLE-2                33730000
337400             MOVE SPACES         TO AA-DB2-TABLE-3                33740000
337500                                    AA-DB2-TABLE-4                33750000
337600                                    AA-DB2-TABLE-5                33760000
337700             PERFORM Z998-DB2-ABEND                               33770000
337800     END-EVALUATE.                                                33780000
337900/                                                                 33790000
338000*---------------------------------------------------------------- 33800000
338100*    RETRIEVES THE PRICE CLAIM ADJUSTMENTS.                       33810000
338200*---------------------------------------------------------------- 33820000
338300 R900-FETCH-PRICE-CLAIM-ADJ.                                      33830000
338400                                                                  33840000
338500     MOVE 'R900-FETCH-PRICE-CLAIM-ADJ' TO PV-CURRENT-PARAGRAPH.   33850000
338600                                                                  33860000
338700     EXEC SQL                                                     33870000
338800         FETCH PRCCLM_CSR                                         33880000
338900         INTO :PRCCLM-PO-LNE-NBR                                  33890000
339000             ,:PRCCLM-INVC-ID                                     33900000
339100             ,:PRCCLM-DOC-TYP-CDE                                 33910000
339200             ,:PRCCLM-UNT-QTY                                     33920000
339300             ,:PRCCLM-UNT-COST-AMT                                33930000
339400             ,:PRCCLM-ADJ-COST-AMT                                33940000
339500     END-EXEC.                                                    33950000
339600                                                                  33960000
339700     EVALUATE TRUE                                                33970000
339800         WHEN SQLCODE = +100                                      33980000
339900              SET OUT-OF-PRCCLMS TO TRUE                          33990000
340000                                                                  34000000
340100         WHEN SQLCODE = ZERO                                      34010000
340200              CONTINUE                                            34020000
340300                                                                  34030000
340400         WHEN SQLWARN0 NOT = SPACES                               34040000
340500         WHEN SQLCODE  NOT = ZERO                                 34050000
340600             MOVE PV-CURRENT-PARAGRAPH                            34060000
340700                              TO AA-PARAGRAPH-NAME                34070000
340800             MOVE 'UNSUCCESSFUL FETCH WITH PRCCLMS CSR'           34080000
340900                              TO AA-DB2-OP-1                      34090000
341000             MOVE 'TPRCCLM'   TO AA-DB2-TABLE-1                   34100000
341100             MOVE SPACES      TO AA-DB2-TABLE-2                   34110000
341200                                 AA-DB2-TABLE-3                   34120000
341300                                 AA-DB2-TABLE-4                   34130000
341400                                 AA-DB2-TABLE-5                   34140000
341500             PERFORM Z998-DB2-ABEND                               34150000
341600     END-EVALUATE.                                                34160000
341700/                                                                 34170000
341800*---------------------------------------------------------------- 34180000
341900*    RETRIEVES THE PURCHASE ITEM WHICH MATCHES THE PRICE CLAIM    34190000
342000*    LINE NUMBER.                                                 34200000
342100*---------------------------------------------------------------- 34210000
342200 R910-GET-PURITM.                                                 34220000
342300                                                                  34230000
342400     MOVE 'R910-GET-PURITM           ' TO PV-CURRENT-PARAGRAPH.   34240000
342500                                                                  34250000
342600     EXEC SQL                                                     34260000
342700         SELECT                                                   34270000
342800             SKU_SEQ_NBR                                          34280000
342900            ,APP_PO_LNE_NBR                                       34290000
343000            ,CL_NBR                                               34300000
343100            ,VEND_STYL_NAME                                       34310000
343200            ,ITM_NBR                                              34320000
343300         INTO                                                     34330000
343400             :PURITM-SKU-SEQ-NBR                                  34340000
343500            ,:PURITM-APP-PO-LNE-NBR                               34350000
343600            ,:PURITM-CL-NBR                                       34360000
343700            ,:PURITM-VEND-STYL-NAME                               34370000
343800            ,:PURITM-ITM-NBR                                      34380000
343900         FROM TPURITM                                             34390000
344000         WHERE PO_NBR         = :PV-PO-BEING-PROCESSED            34400000
344100           AND VER_STATUS_CDE = 'A'                               34410000
344200           AND APP_PO_LNE_NBR = :PRCCLM-PO-LNE-NBR                34420000
344300     END-EXEC.                                                    34430000
344400                                                                  34440000
344500     EVALUATE TRUE                                                34450000
344600         WHEN SQLCODE = ZERO                                      34460000
344700              CONTINUE                                            34470000
344800                                                                  34480000
344900         WHEN SQLWARN0 NOT = SPACES                               34490000
345000         WHEN SQLCODE  NOT = ZERO                                 34500000
345100             MOVE PV-CURRENT-PARAGRAPH                            34510000
345200                              TO AA-PARAGRAPH-NAME                34520000
345300             MOVE 'UNSUCCESSFUL SELECT OF PURITM '                34530000
345400                              TO AA-DB2-OP-1                      34540000
345500             MOVE 'TPURITM'   TO AA-DB2-TABLE-1                   34550000
345600             MOVE SPACES      TO AA-DB2-TABLE-2                   34560000
345700                                 AA-DB2-TABLE-3                   34570000
345800                                 AA-DB2-TABLE-4                   34580000
345900                                 AA-DB2-TABLE-5                   34590000
346000             PERFORM Z998-DB2-ABEND                               34600000
346100     END-EVALUATE.                                                34610000
346200/                                                                 34620000
346300*---------------------------------------------------------------- 34630000
346400*    RETRIEVES THE PURCHASE ITEM WHICH MATCHES THE REMAINDER      34640000
346500*    INVOICE PAYMENT REQUEST ITEM.                                34650000
346600*---------------------------------------------------------------- 34660000
346700 R920-FETCH-PURITM-PREQIT.                                        34670000
346800                                                                  34680000
346900     MOVE 'R920-FETCH-PURITM-PREQIT    ' TO PV-CURRENT-PARAGRAPH. 34690000
347000                                                                  34700000
347100     EXEC SQL                                                     34710000
347200         FETCH RI_CSR                                             34720000
347300         INTO                                                     34730000
347400             :PURITM-SKU-SEQ-NBR                                  34740000
347500            ,:PURITM-APP-PO-LNE-NBR                               34750000
347600            ,:PURITM-CL-NBR                                       34760000
347700            ,:PURITM-VEND-STYL-NAME                               34770000
347800            ,:PURITM-ITM-NBR                                      34780000
347900            ,:PREQIT-PAY-REQ-LNE-QTY                              34790000
348000            ,:PREQIT-UNT-COST-AMT                                 34800000
348100            ,:PREQIT-PAYT-REQ-LNE-NBR                             34810000
348200     END-EXEC.                                                    34820000
348300                                                                  34830000
348400     EVALUATE TRUE                                                34840000
348500         WHEN SQLCODE = ZERO                                      34850000
348600              CONTINUE                                            34860000
348700                                                                  34870000
348800         WHEN SQLCODE = +100                                      34880000
348900              SET OUT-OF-RI-PO-LINES TO TRUE                      34890000
349000                                                                  34900000
349100         WHEN SQLWARN0 NOT = SPACES                               34910000
349200         WHEN SQLCODE  NOT = ZERO                                 34920000
349300             MOVE PV-CURRENT-PARAGRAPH                            34930000
349400                              TO AA-PARAGRAPH-NAME                34940000
349500             MOVE 'UNSUCCESSFUL FETCH OF PURITM PREQIT'           34950000
349600                              TO AA-DB2-OP-1                      34960000
349700             MOVE 'TPURITM'   TO AA-DB2-TABLE-1                   34970000
349800             MOVE 'TPREQIT'   TO AA-DB2-TABLE-2                   34980000
349900             MOVE 'TMIITEM'   TO AA-DB2-TABLE-3                   34990000
350000             MOVE SPACES      TO AA-DB2-TABLE-4                   35000000
350100                                 AA-DB2-TABLE-5                   35010000
350200             PERFORM Z998-DB2-ABEND                               35020000
350300     END-EVALUATE.                                                35030000
350400/                                                                 35040000
350500*---------------------------------------------------------------- 35050000
350600*    RETRIEVES THE PURCHASE ITEM WHICH MATCHES THE REMAINDER      35060000
350700*    INVOICE PAYMENT REQUEST ITEM FOR PO LINE NUMBER OF NULL.     35070000
350800*---------------------------------------------------------------- 35080000
350900 R930-FETCH-NULL-PURITM-PREQIT.                                   35090000
351000                                                                  35100000
351100     MOVE 'R930-FETCH-NULL-PURITM-PREQIT' TO PV-CURRENT-PARAGRAPH.35110000
351200                                                                  35120000
351300     EXEC SQL                                                     35130000
351400         FETCH RI_NULL_CSR                                        35140000
351500         INTO                                                     35150000
351600             :PREQIT-PAY-REQ-LNE-QTY                              35160000
351700            ,:PREQIT-UNT-COST-AMT                                 35170000
351800            ,:PREQIT-PAYT-REQ-LNE-NBR                             35180000
351900     END-EXEC.                                                    35190000
352000                                                                  35200000
352100     EVALUATE TRUE                                                35210000
352200         WHEN SQLCODE = ZERO                                      35220000
352300              CONTINUE                                            35230000
352400                                                                  35240000
352500         WHEN SQLCODE = +100                                      35250000
352600              SET OUT-OF-RI-NULL-LINES TO TRUE                    35260000
352700                                                                  35270000
352800         WHEN SQLWARN0 NOT = SPACES                               35280000
352900         WHEN SQLCODE  NOT = ZERO                                 35290000
353000             MOVE PV-CURRENT-PARAGRAPH                            35300000
353100                              TO AA-PARAGRAPH-NAME                35310000
353200             MOVE 'UNSUCCESSFUL FETCH OF PURITM PREQIT'           35320000
353300                              TO AA-DB2-OP-1                      35330000
353400             MOVE 'TPURITM'   TO AA-DB2-TABLE-1                   35340000
353500             MOVE 'TPREQIT'   TO AA-DB2-TABLE-2                   35350000
353600             MOVE 'TMIITEM'   TO AA-DB2-TABLE-3                   35360000
353700             MOVE SPACES      TO AA-DB2-TABLE-4                   35370000
353800                                 AA-DB2-TABLE-5                   35380000
353900             PERFORM Z998-DB2-ABEND                               35390000
354000     END-EVALUATE.                                                35400000
354100/                                                                 35410000
354200*---------------------------------------------------------------* 35420000
354300*     CHECK IF THIS VENDOR HAS CONTROL DAYS DEFINED               35430000
354400*---------------------------------------------------------------* 35440000
354500 R940-CHECK-VENDOR-CONTROLS.                                      35450000
354600                                                                  35460000
354700     MOVE 'R940-CHECK-VENDOR-CONTROLS  ' TO PV-CURRENT-PARAGRAPH. 35470000
354800                                                                  35480000
354900     EXEC SQL                                                     35490000
355000         SELECT                                                   35500000
355100             PAYT_FLOAT_DAY_QTY                                   35510000
355200         INTO                                                     35520000
355300             :APVNDS-PAYT-FLOAT-DAY-QTY                           35530000
355400         FROM TAPVNDS AV                                          35540000
355500         WHERE AV.ENT_ID          = :PURCHS-ENT-ID                35550000
355600           AND AV.VND_FLT_DAY_IND = 'V'                           35560000
355700     END-EXEC.                                                    35570000
355800                                                                  35580000
355900     EVALUATE TRUE                                                35590000
356000         WHEN SQLCODE = ZEROS                                     35600000
356100              SET VENDOR-CONTROLS         TO TRUE                 35610000
356200         WHEN SQLCODE = +100                                      35620000
356300              SET NO-VENDOR-CONTROLS      TO TRUE                 35630000
356400         WHEN OTHER                                               35640000
356500               MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME    35650000
356600               MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OP-1          35660000
356700               MOVE 'TAPVNDS'             TO AA-DB2-TABLE-1       35670000
356800               MOVE SPACES                TO AA-DB2-TABLE-2       35680000
356900                                             AA-DB2-TABLE-3       35690000
357000                                             AA-DB2-TABLE-4       35700000
357100               PERFORM Z998-DB2-ABEND                             35710000
357200      END-EVALUATE.                                               35720000
357300                                                                  35730000
357400/                                                                 35740000
357500*---------------------------------------------------------------- 35750000
357600*    RETRIEVES THE PRICE CLAIM-1 ADJUSTMENTS.                     35760000
357700*---------------------------------------------------------------- 35770000
357800 R960-SELECT-PRICE-CLAIM-ADJ.                                     35780000
357900                                                                  35790000
358000     MOVE 'R960-SELECT-PRICE-CLAIM-ADJ' TO PV-CURRENT-PARAGRAPH.  35800000
358100                                                                  35810000
358200     EXEC SQL                                                     35820000
358300         SELECT                                                   35830000
358400                 PO_NBR                                           35840000
358500                ,STR_NBR                                          35850000
358600                ,INVC_ID                                          35860000
358700                ,SUM(UNT_QTY * (UNT_COST_AMT - ADJ_COST_AMT))     35870000
358800                ,DOC_TYP_CDE                                      35880000
358900         INTO :PRCCLM-PO-NBR                                      35890000
359000             ,:PRCCLM-STR-NBR                                     35900000
359100             ,:PRCCLM-INVC-ID                                     35910000
359200             ,:PV-PRCCLM-AMT                                      35920000
359300             ,:PRCCLM-DOC-TYP-CDE                                 35930000
359400         FROM                                                     35940000
359500          TPRCCLM                                                 35950000
359600         WHERE                                                    35960000
359700              PO_NBR  = :PV-PO-BEING-PROCESSED                    35970000
359800          AND STR_NBR = :PV-STORE-BEING-PROCESSED                 35980000
359900          AND INVC_ID = :INVOIC-INVC-ID                           35990000
360000          AND (DOC_TYP_CDE = 'CM'                                 36000000
360100           OR DOC_TYP_CDE = 'DM')                                 36010000
360200          AND PAYT_RLSE_TMST = :POSTRR-PAYT-RLSE-TMST             36020000
360300         GROUP BY                                                 36030000
360400              PO_NBR                                              36040000
360500             ,STR_NBR                                             36050000
360600             ,INVC_ID                                             36060000
360700             ,DOC_TYP_CDE                                         36070000
360800         WITH UR                                                  36080000
360900     END-EXEC.                                                    36090000
361000                                                                  36100000
361100     EVALUATE TRUE                                                36110000
361200         WHEN SQLCODE = +100                                      36120000
361300              SET OUT-OF-PRCCLM-RECORDS TO TRUE                   36130000
361400                                                                  36140000
361500         WHEN SQLCODE = ZERO                                      36150000
361600              SET PRCCLM-RECORD TO TRUE                           36160000
361700              SET PRCCLM-FOUND  TO TRUE                           36170000
361800                                                                  36180000
361900         WHEN SQLWARN0 NOT = SPACES                               36190000
362000         WHEN SQLCODE  NOT = ZERO                                 36200000
362100             MOVE PV-CURRENT-PARAGRAPH                            36210000
362200                              TO AA-PARAGRAPH-NAME                36220000
362300             MOVE 'UNSUCCESSFUL SELECT FOR PRCCLM1'               36230000
362400                              TO AA-DB2-OP-1                      36240000
362500             MOVE 'TPRCCLM'   TO AA-DB2-TABLE-1                   36250000
362600             MOVE SPACES      TO AA-DB2-TABLE-2                   36260000
362700                                 AA-DB2-TABLE-3                   36270000
362800                                 AA-DB2-TABLE-4                   36280000
362900                                 AA-DB2-TABLE-5                   36290000
363000             PERFORM Z998-DB2-ABEND                               36300000
363100     END-EVALUATE.                                                36310000
363200/                                                                 36320000
363300*----------------------------------------------------------------*36330000
363400*    RETRIEVES THE FOLLOWING DATA FROM THE TTRNCDE TABLE:        *36340000
363500*      1) POSTING TYPE CODE                                      *36350000
363600*      2) TRANSACTION TYPE CODE                                  *36360000
363700*      3) GL ACCOUNT NUMBER                                      *36370000
363800*      4) BATCH SOURCE CODE                                      *36380000
363900*      5) AP POSTING INDICATOR                                   *36390000
364000*----------------------------------------------------------------*36400000
364100 S100-SELECT-TTRNCDE-DATA.                                        36410000
364200                                                                  36420000
364300     MOVE 'S100-SELECT-TTRNCDE-DATA' TO  PV-CURRENT-PARAGRAPH.    36430000
364400                                                                  36440000
364500     EXEC SQL                                                     36450000
364600         SELECT                                                   36460000
364700             PSTG_TYP_CDE                                         36470000
364800            ,TRN_TYP_CDE                                          36480000
364900            ,GL_ACCT_NBR                                          36490000
365000            ,BTCH_SRC_CDE                                         36500000
365100            ,AP_PSTG_IND                                          36510000
365200         INTO                                                     36520000
365300             :TRNCDE-PSTG-TYP-CDE                                 36530000
365400            ,:TRNCDE-TRN-TYP-CDE                                  36540000
365500            ,:TRNCDE-GL-ACCT-NBR                                  36550000
365600            ,:TRNCDE-BTCH-SRC-CDE                                 36560000
365700            ,:TRNCDE-AP-PSTG-IND                                  36570000
365800         FROM                                                     36580000
365900              TTRNCDE                                             36590000
366000         WHERE AP_TRN_CDE   =  :AP040-AP-TRN-CDE                  36600000
366100           AND EFF_STRT_DTE <= :PV-DB2-CURRENT-DATE               36610000
366200           AND EFF_END_DTE  >  :PV-DB2-CURRENT-DATE               36620000
366300     END-EXEC                                                     36630000
366400                                                                  36640000
366500                                                                  36650000
366600     EVALUATE TRUE                                                36660000
366700         WHEN SQLCODE = ZEROS                                     36670000
366800             CONTINUE                                             36680000
366900         WHEN OTHER                                               36690000
367000             DISPLAY 'TRAN CODE = ' AP040-AP-TRN-CDE              36700000
367100             DISPLAY 'DOC NBR   = ' AP040-DOC-NBR                 36710000
367200             DISPLAY 'STORE NBR = ' AP040-STR-NBR                 36720000
367300             MOVE PV-CURRENT-PARAGRAPH                            36730000
367400                                 TO AA-PARAGRAPH-NAME             36740000
367500             MOVE 'UNSUCCESSFUL SELECT'                           36750000
367600                                 TO AA-DB2-OPERATION              36760000
367700             MOVE 'TTRNCDE'      TO AA-DB2-TABLE-1                36770000
367800             MOVE '       '      TO AA-DB2-TABLE-2                36780000
367900             MOVE '       '      TO AA-DB2-TABLE-3                36790000
368000             MOVE SPACES         TO AA-DB2-TABLE-4                36800000
368100                                    AA-DB2-TABLE-5                36810000
368200             PERFORM Z998-DB2-ABEND                               36820000
368300     END-EVALUATE.                                                36830000
368400                                                                  36840000
368500/                                                                 36850000
368600*---------------------------------------------------------------* 36860000
368700*  GET NEXT DOCUMENT NUMBER FROM TAPCNTL TABLE                  * 36870000
368800*---------------------------------------------------------------* 36880000
368900 S200-GET-NEXT-DOC-NBR.                                           36890000
369000                                                                  36900000
369100     MOVE 'S200-GET-NEXT-DOC-NBR   ' TO                           36910000
369200             PV-CURRENT-PARAGRAPH.                                36920000
369300                                                                  36930000
369400     CALL WS-CALL-DPKUP151 USING WS151-DOC-NBR-PARAMETERS.        36940000
369500                                                                  36950000
369600     IF WS151-ERRORS-FOUND                                        36960000
369700        SET AC-BAD-DATA TO TRUE                                   36970000
369800        MOVE 'S200-GET-NEXT-DOC-NBR     '                         36980000
369900                                   TO AA-PARAGRAPH-NAME           36990000
370000        MOVE WS151-ERROR-MESSAGE                                  37000000
370100                                   TO AA-MESSAGE-1                37010000
370200        MOVE WS151-SQLCODE         TO AA-MESSAGE-2                37020000
370300        PERFORM Z999-ABEND                                        37030000
370400     END-IF.                                                      37040000
370500                                                                  37050000
370600/                                                                 37060000
370700*---------------------------------------------------------------* 37070000
370800*  CREATE THE DOC NUMBER FOR REMAINDER INVOICE ADJUSTMENTS        37080000
370900*  (SHORTAGE)                                                     37090000
371000*---------------------------------------------------------------* 37100000
371100 S250-CREATE-RI-DOC-NBR.                                          37110000
371200                                                                  37120000
371300     MOVE SPACES TO PV-NEXT-DOC-NBR.                              37130000
371400     STRING INVOIC-INVC-ID, 'SHTG '                               37140000
371500       DELIMITED BY ' '                                           37150000
371600       INTO PV-NEXT-DOC-NBR                                       37160000
371700     END-STRING.                                                  37170000
371800                                                                  37180000
371900/                                                                 37190000
372000*---------------------------------------------------------------- 37200000
372100*    INSERT PO LINE INFORMATION INTO PEOPLESOFT AP MEMO TABLE     37210000
372200*---------------------------------------------------------------- 37220000
372300 S300-ISRT-PO-LINE-INFO.                                          37230000
372400                                                                  37240000
372500     MOVE 'S300-ISRT-PO-LINE-INFO  ' TO                           37250000
372600             PV-CURRENT-PARAGRAPH.                                37260000
372700                                                                  37270000
372800     EXEC SQL                                                     37280000
372900         INSERT INTO TAPDSRP                                      37290000
373000             (DSCRP_RPT_ODR)                                      37300000
373100         VALUES                                                   37310000
373200             (:APDSRP-DSCRP-RPT-ODR)                              37320000
373300     END-EXEC.                                                    37330000
373400                                                                  37340000
373500     EVALUATE TRUE                                                37350000
373600        WHEN SQLCODE = ZEROS                                      37360000
373700             CONTINUE                                             37370000
373800        WHEN OTHER                                                37380000
373900             MOVE PV-CURRENT-PARAGRAPH     TO AA-PARAGRAPH-NAME   37390000
374000             MOVE 'UNSUCCESSFUL INSERT TAPDSRP ROW'               37400000
374100                              TO AA-DB2-OP-1                      37410000
374200             MOVE 'TAPDSRP'   TO AA-DB2-TABLE-1                   37420000
374300             MOVE SPACES      TO AA-DB2-TABLE-2                   37430000
374400                                 AA-DB2-TABLE-3                   37440000
374500                                 AA-DB2-TABLE-4                   37450000
374600                                 AA-DB2-TABLE-5                   37460000
374700             PERFORM Z998-DB2-ABEND                               37470000
374800     END-EVALUATE.                                                37480000
374900                                                                  37490000
375000/                                                                 37500000
375100*----------------------------------------------------------------*37510000
375200*    SELECT CHECKPOINT RESTART CONTROL INFO.                     *37520000
375300*----------------------------------------------------------------*37530000
375400 S400-GET-CHECKPOINT-CNTL.                                        37540000
375500                                                                  37550000
375600     MOVE 'S400-GET-CHECKPOINT-CNTL' TO PV-CURRENT-PARAGRAPH.     37560000
375700                                                                  37570000
375800     EXEC SQL                                                     37580000
375900      SELECT CKPT_STAT_CODE                                       37590000
376000       INTO :PV-CKPT-STAT-CODE                                    37600000
376100       FROM TCKRSTCNTL                                            37610000
376200       WHERE PLAN_NAME = :PC-PROGRAM                              37620000
376300     END-EXEC.                                                    37630000
376400                                                                  37640000
376500     EVALUATE TRUE                                                37650000
376600         WHEN SQLCODE = ZERO                                      37660000
376700             CONTINUE                                             37670000
376800                                                                  37680000
376900         WHEN SQLWARN0 NOT = SPACES                               37690000
377000         WHEN SQLCODE  NOT = ZERO                                 37700000
377100             MOVE PV-CURRENT-PARAGRAPH                            37710000
377200                                 TO AA-PARAGRAPH-NAME             37720000
377300             DISPLAY '******** PLAN_NAME:'                        37730000
377400                      PC-PROGRAM                                  37740000
377500             MOVE 'UNSUCCESSFUL SELECT'                           37750000
377600                                 TO AA-DB2-OPERATION              37760000
377700             MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE-1                37770000
377800             MOVE SPACES         TO AA-DB2-TABLE-2                37780000
377900                                    AA-DB2-TABLE-3                37790000
378000             PERFORM Z998-DB2-ABEND                               37800000
378100     END-EVALUATE.                                                37810000
378200                                                                  37820000
378300/                                                                 37830000
378400*----------------------------------------------------------------*37840000
378500*    SELECT CHECKPOINT RESTART WORKING STORAGE DESCRIPTION INFO.  37850000
378600*----------------------------------------------------------------*37860000
378700 S500-GET-CHECKPOINT-INFO.                                        37870000
378800                                                                  37880000
378900     MOVE 'S500-GET-CHECKPOINT-INFO' TO PV-CURRENT-PARAGRAPH.     37890000
379000                                                                  37900000
379100     EXEC SQL                                                     37910000
379200      SELECT WORK_STRG_DESC                                       37920000
379300       INTO :TCKRSTINF-WORK-STRG-DESC                             37930000
379400       FROM TCKRSTINF                                             37940000
379500       WHERE PLAN_NAME = :PC-PROGRAM                              37950000
379600     END-EXEC.                                                    37960000
379700                                                                  37970000
379800     EVALUATE TRUE                                                37980000
379900         WHEN SQLCODE = ZERO                                      37990000
380000              CONTINUE                                            38000000
380100                                                                  38010000
380200         WHEN SQLWARN0 NOT = SPACES                               38020000
380300         WHEN SQLCODE  NOT = ZERO                                 38030000
380400             MOVE PV-CURRENT-PARAGRAPH                            38040000
380500                                 TO AA-PARAGRAPH-NAME             38050000
380600             DISPLAY '******** PLAN_NAME:'                        38060000
380700                      PC-PROGRAM                                  38070000
380800             MOVE 'UNSUCCESSFUL SELECT'                           38080000
380900                                 TO AA-DB2-OPERATION              38090000
381000             MOVE 'TCKRSTINF'    TO AA-DB2-TABLE-1                38100000
381100             MOVE SPACES         TO AA-DB2-TABLE-2                38110000
381200                                    AA-DB2-TABLE-3                38120000
381300             PERFORM Z998-DB2-ABEND                               38130000
381400     END-EVALUATE.                                                38140000
381500                                                                  38150000
381600/                                                                 38160000
381700*----------------------------------------------------------------*38170000
381800*    SELECT FREIGHT TOTALS FOR PO AND STORE.                      38180000
381900*----------------------------------------------------------------*38190000
382000 S600-CALC-VEND-FRT-PCT.                                          38200000
382100                                                                  38210000
382200     MOVE 'S600-CALC-VEND-FRT-PCT' TO PV-CURRENT-PARAGRAPH.       38220000
382300                                                                  38230000
382400     EXEC SQL                                                     38240000
382500       SELECT                                                     38250000
382600         SUM ((TA.ALW_CHRG_AMT * MI.VEND_FRGT_PCT)                38260000
382700             + (MI.VEND_FRGT_PCT                                  38270000
382800                * (TA.ALW_CHRG_PCT * IV.GRO_COST_AMT)))           38280000
382900        ,SUM (TA.ALW_CHRG_AMT                                     38290000
383000             + (TA.ALW_CHRG_PCT * IV.GRO_COST_AMT))               38300000
383100         INTO                                                     38310000
383200             :AP-WS-VEND-FRT    :AP-WS-VEND-FRT-NULL              38320000
383300            ,:AP-WS-TOTAL-FRT :AP-WS-TOTAL-FRT-NULL               38330000
383400         FROM                                                     38340000
383500             TALCHRG TA,                                          38350000
383600             TMDINVC MI,                                          38360000
383700             TINVOIC IV                                           38370000
383800         WHERE IV.PO_NBR          = :AP-WS-PO-NBR                 38380000
383900           AND IV.STR_NBR         = :AP-WS-STR-NBR                38390000
384000           AND IV.PO_NBR          = MI.PO_NBR                     38400000
384100           AND IV.INVC_ID         = MI.INVC_ID                    38410000
384200           AND IV.PO_NBR          = TA.PO_NBR                     38420000
384300           AND IV.INVC_ID         = TA.INVC_ID                    38430000
384400           AND IV.STATUS_CDE      = 'RL'                          38440000
384500           AND TA.ALW_CHRG_CDE IN                                 38450000
384600               ('400', 'FFC', 'PAB', 'SAB', 'PST', 'UUC')         38460000
384700     END-EXEC.                                                    38470000
384800                                                                  38480000
384900     EVALUATE TRUE                                                38490000
385000         WHEN SQLCODE = ZERO                                      38500000
385100             SET AP-WS-GOOD-SQLCODE TO TRUE                       38510000
385200         WHEN SQLWARN0 NOT = SPACES                               38520000
385300         WHEN SQLCODE  NOT = ZERO                                 38530000
385400             SET AP-WS-BAD-SQLCODE TO TRUE                        38540000
385500             MOVE PV-CURRENT-PARAGRAPH                            38550000
385600                                TO AA-PARAGRAPH-NAME              38560000
385700             MOVE 'UNSUCCESSFUL SUMS FOR FREIGHT'                 38570000
385800                                TO AA-DB2-OP-1                    38580000
385900             MOVE 'TALCHRG'     TO AA-DB2-TABLE-1                 38590000
386000             MOVE 'TMDINVC'     TO AA-DB2-TABLE-2                 38600000
386100             MOVE 'TINVOIC'     TO AA-DB2-TABLE-3                 38610000
386200             MOVE SPACES        TO AA-DB2-TABLE-4                 38620000
386300                                   AA-DB2-TABLE-5                 38630000
386400             PERFORM Z998-DB2-ABEND                               38640000
386500     END-EVALUATE.                                                38650000
386600                                                                  38660000
386700/                                                                 38670000
386800*----------------------------------------------------------------*38680000
386900*    SELECT UPC NUMBER FOR THE ITEM NUMBER FROM TPURITM.          38690000
387000*----------------------------------------------------------------*38700000
387100 S700-SELECT-UPC-NBR.                                             38710000
387200                                                                  38720000
387300     MOVE 'S700-SELECT-UPC-NBR   ' TO PV-CURRENT-PARAGRAPH.       38730000
387400                                                                  38740000
387500     EXEC SQL                                                     38750000
387600       SELECT A.UPC_NBR                                           38760000
387700         INTO :TUPCSKU-UPC-NBR                                    38770000
387800         FROM TUPCSKU A                                           38780000
387900         WHERE A.ITEM_NBR    = :PURITM-ITM-NBR                    38790000
388000           AND A.EDI_ORD_IND = 'Y'                                38800000
388100     END-EXEC.                                                    38810000
388200                                                                  38820000
388300     EVALUATE TRUE                                                38830000
388400         WHEN SQLCODE = ZERO                                      38840000
388500         WHEN SQLCODE = -811                                      38850000
388600             CONTINUE                                             38860000
388700         WHEN SQLCODE = +100                                      38870000
388800             MOVE ZERO TO TUPCSKU-UPC-NBR                         38880000
388900             ADD 1 TO PA-UPC-NOT-FOUND-CNT                        38890000
389000         WHEN SQLWARN0 NOT = SPACES                               38900000
389100         WHEN SQLCODE  NOT = ZERO                                 38910000
389200             MOVE PV-CURRENT-PARAGRAPH                            38920000
389300                                TO AA-PARAGRAPH-NAME              38930000
389400             MOVE 'UNSUCCESSFUL SELECT'                           38940000
389500                                TO AA-DB2-OPERATION               38950000
389600             MOVE 'TUPCSKU'     TO AA-DB2-TABLE-1                 38960000
389700             MOVE SPACES        TO AA-DB2-TABLE-2                 38970000
389800                                   AA-DB2-TABLE-3                 38980000
389900                                   AA-DB2-TABLE-4                 38990000
390000                                   AA-DB2-TABLE-5                 39000000
390100             PERFORM Z998-DB2-ABEND                               39010000
390200     END-EVALUATE.                                                39020000
390300                                                                  39030000
390400*---------------------------------------------------------------- 39040000
390500*    DETERMINE THE FREIGHT DISTRIBUTION FOR THE PURCHASE ORDER.   39050000
390600*---------------------------------------------------------------- 39060000
390700 T300-SET-FREIGHT-DISTRO.                                         39070000
390800                                                                  39080000
390900     INITIALIZE AP-WS-AREA.                                       39090000
391000     MOVE POSTRR-PO-NBR  TO AP-WS-PO-NBR.                         39100000
391100     MOVE POSTRR-STR-NBR TO AP-WS-STR-NBR.                        39110000
391200                                                                  39120000
391300     PERFORM S600-CALC-VEND-FRT-PCT.                              39130000
391400                                                                  39140000
391500     IF AP-WS-GOOD-SQLCODE                                        39150000
391600         IF AP-WS-VEND-FRT-NULL = 0                               39160000
391700             IF AP-WS-TOTAL-FRT-NULL = 0                          39170000
391800                 IF AP-WS-TOTAL-FRT NOT = 0                       39180000
391900                     COMPUTE AP-WS-VEND-FRT-PCT ROUNDED =         39190000
392000                         AP-WS-VEND-FRT / AP-WS-TOTAL-FRT         39200000
392100                     COMPUTE AP-WS-KOHLS-FRT-PCT ROUNDED =        39210000
392200                         1 - AP-WS-VEND-FRT-PCT                   39220000
392300                 END-IF                                           39230000
392400             END-IF                                               39240000
392500         END-IF                                                   39250000
392600     END-IF.                                                      39260000
392700                                                                  39270000
392800/                                                                 39280000
392900*----------------------------------------------------------------*39290000
393000*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS   *39300000
393100*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE). *39310000
393200*----------------------------------------------------------------*39320000
393300 U100-UPDATE-TCKRSTCNTL.                                          39330000
393400                                                                  39340000
393500     MOVE 'U100-UPDATE-TCKRSTCNTL' TO PV-CURRENT-PARAGRAPH.       39350000
393600                                                                  39360000
393700     EXEC SQL                                                     39370000
393800         UPDATE TCKRSTCNTL                                        39380000
393900         SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE                  39390000
394000         WHERE PLAN_NAME      = :PC-PROGRAM                       39400000
394100     END-EXEC.                                                    39410000
394200                                                                  39420000
394300     EVALUATE TRUE                                                39430000
394400         WHEN SQLCODE = ZERO                                      39440000
394500              CONTINUE                                            39450000
394600                                                                  39460000
394700         WHEN SQLWARN0 NOT = SPACES                               39470000
394800         WHEN SQLCODE  NOT = ZERO                                 39480000
394900             MOVE PV-CURRENT-PARAGRAPH                            39490000
395000                                 TO AA-PARAGRAPH-NAME             39500000
395100             DISPLAY '******** PLAN_NAME:'                        39510000
395200                      PC-PROGRAM                                  39520000
395300             MOVE 'UNSUCCESSFUL UPDATE'                           39530000
395400                                 TO AA-DB2-OPERATION              39540000
395500             MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE-1                39550000
395600             MOVE SPACES         TO AA-DB2-TABLE-2                39560000
395700                                    AA-DB2-TABLE-3                39570000
395800             PERFORM Z998-DB2-ABEND                               39580000
395900     END-EVALUATE.                                                39590000
396000                                                                  39600000
396100/                                                                 39610000
396200*----------------------------------------------------------------*39620000
396300*    UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING     *39630000
396400*    STORAGE DESCRIPTION FIELD IS UPDATED WITH THE CURRENT INPUT *39640000
396500*    FILE RECORD COUNTS AND THE FILE PROCESSOR INDICATOR.        *39650000
396600*----------------------------------------------------------------*39660000
396700 U200-UPDATE-TCKRSTINF.                                           39670000
396800                                                                  39680000
396900     MOVE 'U200-UPDATE-TCKRSTINF' TO PV-CURRENT-PARAGRAPH.        39690000
397000                                                                  39700000
397100     MOVE POSTRR-PO-NBR      TO CR-PO-NBR.                        39710000
397200     MOVE POSTRR-STR-NBR     TO CR-STR-NBR.                       39720000
397300     MOVE PA-INVOICE-COUNT   TO CR-INVOICE-COUNT.                 39730000
397400     MOVE CKPT-RESTART-INFO  TO TCKRSTINF-WORK-STRG-DESC-TEXT.    39740000
397500     MOVE 4022               TO TCKRSTINF-WORK-STRG-DESC-LEN.     39750000
397600                                                                  39760000
397700     EXEC SQL                                                     39770000
397800         UPDATE TCKRSTINF                                         39780000
397900         SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC         39790000
398000         WHERE PLAN_NAME      = :PC-PROGRAM                       39800000
398100     END-EXEC.                                                    39810000
398200                                                                  39820000
398300     EVALUATE TRUE                                                39830000
398400         WHEN SQLCODE = ZERO                                      39840000
398500              CONTINUE                                            39850000
398600                                                                  39860000
398700         WHEN SQLWARN0 NOT = SPACES                               39870000
398800         WHEN SQLCODE  NOT = ZERO                                 39880000
398900             MOVE PV-CURRENT-PARAGRAPH                            39890000
399000                         TO AA-PARAGRAPH-NAME                     39900000
399100             DISPLAY '******** PLAN_NAME:'                        39910000
399200                      PC-PROGRAM                                  39920000
399300             MOVE 'UNSUCCESSFUL UPDATE'                           39930000
399400                                 TO AA-DB2-OPERATION              39940000
399500             MOVE 'TCKRSTINF'    TO AA-DB2-TABLE-1                39950000
399600             MOVE SPACES         TO AA-DB2-TABLE-2                39960000
399700                                    AA-DB2-TABLE-3                39970000
399800             PERFORM Z998-DB2-ABEND                               39980000
399900     END-EVALUATE.                                                39990000
400000                                                                  40000000
400100/                                                                 40010000
400200*----------------------------------------------------------------*40020000
400300*    COMMITS DB2 UPDATES FOR THE PO PROCESSED.                   *40030000
400400*----------------------------------------------------------------*40040000
400500 U300-COMMIT.                                                     40050000
400600                                                                  40060000
400700     MOVE 'U300-COMMIT'         TO PV-CURRENT-PARAGRAPH.          40070000
400800                                                                  40080000
400900     EXEC SQL                                                     40090000
401000         COMMIT                                                   40100000
401100     END-EXEC.                                                    40110000
401200                                                                  40120000
401300     EVALUATE TRUE                                                40130000
401400         WHEN SQLCODE = ZEROS                                     40140000
401500              CONTINUE                                            40150000
401600         WHEN OTHER                                               40160000
401700             MOVE PV-CURRENT-PARAGRAPH                            40170000
401800                                 TO AA-PARAGRAPH-NAME             40180000
401900             MOVE 'UNSUCCESSFUL COMMIT'                           40190000
402000                                 TO AA-DB2-OPERATION              40200000
402100             MOVE SPACES         TO AA-DB2-TABLE-1                40210000
402200                                    AA-DB2-TABLE-2                40220000
402300                                    AA-DB2-TABLE-3                40230000
402400             PERFORM Z998-DB2-ABEND                               40240000
402500     END-EVALUATE.                                                40250000
402600                                                                  40260000
402700/                                                                 40270000
402800*----------------------------------------------------------------*40280000
402900*    INSERTS A PEOPLESOFT TRANSACTION RECORD TO THE PEOPLESOFT   *40290000
403000*    TRANSACTIONS TABLE (TOUTAPE).                               *40300000
403100*    CALLED FROM P700-CREATE-INV-PS-INTERFACE                    *40310000
403200*                P750-CREATE-ADJ-PS-INTERFACE                    *40320000
403300*----------------------------------------------------------------*40330000
403400 U400-INSERT-PS-TRANSACTION.                                      40340000
403500                                                                  40350000
403600     MOVE 'U400-INSERT-PS-TRANSACTION' TO PV-CURRENT-PARAGRAPH.   40360000
403700                                                                  40370000
403800     MOVE PC-AP040-LEN               TO OUTAPE-PS-TRN-ODR-LEN.    40380000
403900     MOVE AP040-TRANSACTION-FILE     TO OUTAPE-PS-TRN-ODR-TEXT.   40390000
404000                                                                  40400000
404100     EXEC SQL                                                     40410000
404200         INSERT INTO TOUTAPE                                      40420000
404300                 (PS_TRN_ODR)                                     40430000
404400         VALUES  (:OUTAPE-PS-TRN-ODR)                             40440000
404500     END-EXEC.                                                    40450000
404600                                                                  40460000
404700     EVALUATE TRUE                                                40470000
404800         WHEN SQLCODE = ZERO                                      40480000
404900                      CONTINUE                                    40490000
405000                                                                  40500000
405100         WHEN SQLWARN0 NOT = SPACES                               40510000
405200         WHEN SQLCODE  NOT = ZERO                                 40520000
405300             MOVE PV-CURRENT-PARAGRAPH                            40530000
405400                                 TO AA-PARAGRAPH-NAME             40540000
405500             MOVE 'UNSUCCESSFUL INSERT'                           40550000
405600                                 TO AA-DB2-OPERATION              40560000
405700             MOVE 'TOUTAPE'      TO AA-DB2-TABLE-1                40570000
405800             MOVE SPACES         TO AA-DB2-TABLE-2                40580000
405900                                    AA-DB2-TABLE-3                40590000
406000                                    AA-DB2-TABLE-4                40600000
406100                                    AA-DB2-TABLE-5                40610000
406200             PERFORM Z998-DB2-ABEND                               40620000
406300     END-EVALUATE.                                                40630000
406400                                                                  40640000
406500/                                                                 40650000
406600*----------------------------------------------------------------*40660000
406700*    INSERTS A RECONCILIATION RESULTS RECORD TO THE              *40670000
406800*    RECONCILIATION RESULTS FILE TABLE (TOUTAP2).                *40680000
406900*    CALLED FROM P800-CREATE-RECON-RESULTS-VEND                  *40690000
407000*                P810-CREATE-RECON-RESULTS-INV                   *40700000
407100*                P820-CREATE-PRCCLM-RECON-RSLT                   *40710000
407200*                P830-CREATE-RI-RECON-RESULTS                     40720000
407300*----------------------------------------------------------------*40730000
407400 U500-INSERT-RECON-RESULTS.                                       40740000
407500                                                                  40750000
407600     MOVE 'U500-INSERT-RECON-RESULTS' TO PV-CURRENT-PARAGRAPH.    40760000
407700                                                                  40770000
407800     MOVE AP263-RECORD        TO OUTAP2-RECNCL-RSLT-ODR.          40780000
407900                                                                  40790000
408000     EXEC SQL                                                     40800000
408100         INSERT INTO TOUTAP2                                      40810000
408200                 (RECNCL_RSLT_ODR)                                40820000
408300         VALUES  (:OUTAP2-RECNCL-RSLT-ODR)                        40830000
408400     END-EXEC.                                                    40840000
408500                                                                  40850000
408600     EVALUATE TRUE                                                40860000
408700         WHEN SQLCODE = ZERO                                      40870000
408800              CONTINUE                                            40880000
408900                                                                  40890000
409000         WHEN SQLWARN0 NOT = SPACES                               40900000
409100         WHEN SQLCODE  NOT = ZERO                                 40910000
409200             MOVE PV-CURRENT-PARAGRAPH                            40920000
409300                                 TO AA-PARAGRAPH-NAME             40930000
409400             MOVE 'UNSUCCESSFUL INSERT'                           40940000
409500                                 TO AA-DB2-OPERATION              40950000
409600             MOVE 'TOUTAP2'      TO AA-DB2-TABLE-1                40960000
409700     MOVE SPACES                 TO AA-DB2-TABLE-2                40970000
409800                                    AA-DB2-TABLE-3                40980000
409900                                    AA-DB2-TABLE-4                40990000
410000                                    AA-DB2-TABLE-5                41000000
410100             PERFORM Z998-DB2-ABEND                               41010000
410200     END-EVALUATE.                                                41020000
410300                                                                  41030000
410400/                                                                 41040000
410500*----------------------------------------------------------------*41050000
410600*    INSERTS AN OPEN TO PAY UPDATE RECORD TO THE OPEN TO PAY     *41060000
410700*    UPDATE TABLE (TOUTAPI).                                     *41070000
410800*    CALLED FROM P900-CREATE-STATUS-UPDT-RECORD                  *41080000
410900*----------------------------------------------------------------*41090000
411000 U600-INSERT-OTP-UPDATE.                                          41100000
411100                                                                  41110000
411200     MOVE 'U600-INSERT-OTP-UPDATE   ' TO PV-CURRENT-PARAGRAPH.    41120000
411300                                                                  41130000
411400     MOVE AP252-RECORD        TO OUTAPI-OTP-UPD-ODR.              41140000
411500                                                                  41150000
411600     EXEC SQL                                                     41160000
411700         INSERT INTO TOUTAPI                                      41170000
411800                 (OTP_UPD_ODR)                                    41180000
411900         VALUES  (:OUTAPI-OTP-UPD-ODR)                            41190000
412000     END-EXEC.                                                    41200000
412100                                                                  41210000
412200     EVALUATE TRUE                                                41220000
412300         WHEN SQLCODE = ZERO                                      41230000
412400              CONTINUE                                            41240000
412500                                                                  41250000
412600         WHEN SQLWARN0 NOT = SPACES                               41260000
412700         WHEN SQLCODE  NOT = ZERO                                 41270000
412800             MOVE PV-CURRENT-PARAGRAPH                            41280000
412900                                 TO AA-PARAGRAPH-NAME             41290000
413000             MOVE 'UNSUCCESSFUL INSERT'                           41300000
413100                                 TO AA-DB2-OPERATION              41310000
413200             MOVE 'TOUTAPI'      TO AA-DB2-TABLE-1                41320000
413300             MOVE SPACES         TO AA-DB2-TABLE-2                41330000
413400                                    AA-DB2-TABLE-3                41340000
413500                                    AA-DB2-TABLE-4                41350000
413600                                    AA-DB2-TABLE-5                41360000
413700             PERFORM Z998-DB2-ABEND                               41370000
413800             END-EVALUATE.                                        41380000
413900                                                                  41390000
414000/                                                                 41400000
414100*----------------------------------------------------------------*41410000
414200*    INSERTS A PO/STORE INVOICE RECORD TO THE PO/STORE INVOICE   *41420000
414300*    TABLE (TOUTAPJ).                                            *41430000
414400*    CALLED FROM P950-CREATE-POSTR-INV-RECORD                    *41440000
414500*                P955-CREATE-POSTR-RINV-RECORD                   *41450000
414600*----------------------------------------------------------------*41460000
414700 U700-INSERT-PO-STR-INVC.                                         41470000
414800                                                                  41480000
414900     MOVE 'U700-INSERT-PO-STR-INVC  ' TO PV-CURRENT-PARAGRAPH.    41490000
415000                                                                  41500000
415100     MOVE AP058-RECORD        TO OUTAPJ-PO-STR-INVC-ODR.          41510000
415200                                                                  41520000
415300     EXEC SQL                                                     41530000
415400         INSERT INTO TOUTAPJ                                      41540000
415500                 (PO_STR_INVC_ODR)                                41550000
415600         VALUES  (:OUTAPJ-PO-STR-INVC-ODR)                        41560000
415700     END-EXEC.                                                    41570000
415800                                                                  41580000
415900     EVALUATE TRUE                                                41590000
416000         WHEN SQLCODE = ZERO                                      41600000
416100              CONTINUE                                            41610000
416200                                                                  41620000
416300         WHEN SQLWARN0 NOT = SPACES                               41630000
416400         WHEN SQLCODE  NOT = ZERO                                 41640000
416500             MOVE PV-CURRENT-PARAGRAPH                            41650000
416600                                 TO AA-PARAGRAPH-NAME             41660000
416700             MOVE 'UNSUCCESSFUL INSERT'                           41670000
416800                                 TO AA-DB2-OPERATION              41680000
416900             MOVE 'TOUTAPJ'      TO AA-DB2-TABLE-1                41690000
417000             MOVE SPACES         TO AA-DB2-TABLE-2                41700000
417100                                    AA-DB2-TABLE-3                41710000
417200                                    AA-DB2-TABLE-4                41720000
417300                                    AA-DB2-TABLE-5                41730000
417400             PERFORM Z998-DB2-ABEND                               41740000
417500     END-EVALUATE.                                                41750000
417600                                                                  41760000
417700/                                                                 41770000
417800*----------------------------------------------------------------*41780000
417900*    UPDATES THE CALC-DUE-DATE ON TINVOIC FOR THE INVOICES       *41790000
418000*    BEING PROCESSED.  THIS IS BEING DONE SO THE DATE WILL BE    *41800000
418100*    AVAILABLE FOR ON-LINE PROCESSING.                           *41810000
418200*----------------------------------------------------------------*41820000
418300 U800-UPDATE-TINVOIC.                                             41830000
418400                                                                  41840000
418500     MOVE 'U800-UPDATE-TINVOIC' TO PV-CURRENT-PARAGRAPH.          41850000
418600                                                                  41860000
418700     MOVE PV-PO-BEING-PROCESSED      TO INVOIC-PO-NBR.            41870000
418800     MOVE PV-INVC-ID-BEING-PROCESSED TO INVOIC-INVC-ID.           41880000
418900     MOVE HOLD-DUE-DATE-CCYYMMDD     TO INVOIC-CALC-DUE-DTE.      41890000
419000                                                                  41900000
419100     EXEC SQL                                                     41910000
419200         UPDATE TINVOIC                                           41920000
419300             SET CALC_DUE_DTE = :INVOIC-CALC-DUE-DTE              41930000
419400               , DUE_DTE_SRC_CDE = 'I'                            41940000
419500         WHERE PO_NBR  = :INVOIC-PO-NBR                           41950000
419600           AND INVC_ID = :INVOIC-INVC-ID                          41960000
419700     END-EXEC.                                                    41970000
419800                                                                  41980000
419900     EVALUATE TRUE                                                41990000
420000         WHEN SQLCODE = ZERO                                      42000000
420100              CONTINUE                                            42010000
420200                                                                  42020000
420300         WHEN SQLWARN0 NOT = SPACES                               42030000
420400         WHEN SQLCODE  NOT = ZERO                                 42040000
420500             MOVE PV-CURRENT-PARAGRAPH                            42050000
420600                                 TO AA-PARAGRAPH-NAME             42060000
420700             MOVE 'UNSUCCESSFUL UPDATE: TINVOIC'                  42070000
420800                                 TO AA-DB2-OPERATION              42080000
420900             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                42090000
421000             MOVE SPACES         TO AA-DB2-TABLE-2                42100000
421100                                    AA-DB2-TABLE-3                42110000
421200             PERFORM Z998-DB2-ABEND                               42120000
421300     END-EVALUATE.                                                42130000
421400                                                                  42140000
421500/                                                                 42150000
421600*----------------------------------------------------------------*42160000
421700*    DO THE CHECKPOINT RESTART AND THE COMMIT.                   *42170000
421800*----------------------------------------------------------------*42180000
421900 X100-CHECKPOINT-COMMIT.                                          42190000
422000                                                                  42200000
422100     MOVE 'X100-CHECKPOINT-COMMIT' TO PV-CURRENT-PARAGRAPH.       42210000
422200                                                                  42220000
422300     EXEC SQL                                                     42230000
422400       SET :CR-CURR-TMST = CURRENT TIMESTAMP                      42240000
422500     END-EXEC.                                                    42250000
422600                                                                  42260000
422700     EVALUATE TRUE                                                42270000
422800         WHEN SQLCODE = ZERO                                      42280000
422900              CONTINUE                                            42290000
423000                                                                  42300000
423100        WHEN SQLWARN0 NOT = SPACES                                42310000
423200        WHEN SQLCODE  NOT = ZERO                                  42320000
423300            MOVE 'UNSUCCESSFUL SET TMST'                          42330000
423400                                TO AA-DB2-OPERATION               42340000
423500            PERFORM Z998-DB2-ABEND                                42350000
423600     END-EVALUATE.                                                42360000
423700                                                                  42370000
423800     IF CR-CURR-TMST > CR-NEXT-TMST                               42380000
423900        MOVE PC-IN-PROCESS-CODE      TO PV-CKPT-STAT-CODE         42390000
424000        PERFORM U100-UPDATE-TCKRSTCNTL                            42400000
424100        PERFORM U200-UPDATE-TCKRSTINF                             42410000
424200        PERFORM U300-COMMIT                                       42420000
424300                                                                  42430000
424400        EXEC SQL                                                  42440000
424500         SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)     42450000
424600          INTO :CR-NEXT-TMST                                      42460000
424700          FROM TCKRSTCNTL                                         42470000
424800          WHERE PLAN_NAME = :PC-PROGRAM                           42480000
424900        END-EXEC                                                  42490000
425000                                                                  42500000
425100          EVALUATE TRUE                                           42510000
425200              WHEN SQLCODE = ZERO                                 42520000
425300                   CONTINUE                                       42530000
425400                                                                  42540000
425500          WHEN SQLWARN0 NOT = SPACES                              42550000
425600          WHEN SQLCODE  NOT = ZERO                                42560000
425700              MOVE 'UNSUCCESSFUL NEXT TMST'                       42570000
425800                                  TO AA-DB2-OPERATION             42580000
425900              PERFORM Z998-DB2-ABEND                              42590000
426000       END-EVALUATE                                               42600000
426100     END-IF.                                                      42610000
426200                                                                  42620000
426300*----------------------------------------------------------------*42630000
426400*    GET THE RESTART INFO.                                       *42640000
426500*----------------------------------------------------------------*42650000
426600 X200-CHECKPOINT-RESTART.                                         42660000
426700                                                                  42670000
426800     MOVE 'X200-CHECKPOINT-RESTART' TO PV-CURRENT-PARAGRAPH.      42680000
426900                                                                  42690000
427000     PERFORM S500-GET-CHECKPOINT-INFO.                            42700000
427100     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CKPT-RESTART-INFO.     42710000
427200                                                                  42720000
427300     MOVE CR-PO-NBR      TO PV-CR-PO-NBR.                         42730000
427400     MOVE CR-STR-NBR     TO PV-CR-STR-NBR.                        42740000
427500                                                                  42750000
427600     DISPLAY '***********************************************'.   42760000
427700     DISPLAY '** APKUP253 CHECKPOINT RESTART **'                  42770000
427800     DISPLAY '** CURSOR PO NUMBER ON RESTART = ' PV-CR-PO-NBR.    42780000
427900     DISPLAY '** CURSOR STORE # ON RESTART   = ' PV-CR-STR-NBR.   42790000
428000     DISPLAY '***********************************************'.   42800000
428100                                                                  42810000
428200     PERFORM R200-FETCH-RELEASED-POS                              42820000
428300           WITH TEST AFTER                                        42830000
428400                UNTIL OUT-OF-POS                                  42840000
428500                  OR  POSTRR-PO-NBR > CR-PO-NBR                   42850000
428600                  OR (POSTRR-PO-NBR = CR-PO-NBR AND               42860000
428700                      POSTRR-STR-NBR > CR-STR-NBR)                42870000
428800                                                                  42880000
428900     MOVE ZEROS             TO PA-INVOICE-COUNT.                  42890000
429000                                                                  42900000
429100     MOVE CR-INVOICE-COUNT  TO PA-INVOICE-COUNT.                  42910000
429200                                                                  42920000
429300/                                                                 42930000
429400*---------------------------------------------------------------- 42940000
429500*    OPENS THE INVOICES CURSOR.                                   42950000
429600*---------------------------------------------------------------- 42960000
429700 Y100-OPEN-INVOICE-CSR.                                           42970000
429800                                                                  42980000
429900     MOVE 'Y100-OPEN-INVOICE-CSR '      TO PV-CURRENT-PARAGRAPH.  42990000
430000                                                                  43000000
430100     EXEC SQL                                                     43010000
430200         OPEN INVOICE_CSR                                         43020000
430300     END-EXEC.                                                    43030000
430400                                                                  43040000
430500     EVALUATE TRUE                                                43050000
430600         WHEN SQLCODE = ZERO                                      43060000
430700              CONTINUE                                            43070000
430800                                                                  43080000
430900         WHEN SQLCODE = +100                                      43090000
431000             MOVE PV-CURRENT-PARAGRAPH                            43100000
431100                                TO AA-PARAGRAPH-NAME              43110000
431200             MOVE 'NO INVOICE FOUND FOR RELEASE FOR PO/STORE'     43120000
431300                                TO AA-DB2-OP-1                    43130000
431400             MOVE 'TMDINVC'     TO AA-DB2-TABLE-1                 43140000
431500             MOVE 'TINVOIC'     TO AA-DB2-TABLE-2                 43150000
431600             MOVE SPACES        TO AA-DB2-TABLE-3                 43160000
431700                                   AA-DB2-TABLE-4                 43170000
431800                                   AA-DB2-TABLE-5                 43180000
431900             PERFORM Z998-DB2-ABEND                               43190000
432000                                                                  43200000
432100         WHEN SQLWARN0 NOT = SPACES                               43210000
432200         WHEN SQLCODE  NOT = ZERO                                 43220000
432300             MOVE PV-CURRENT-PARAGRAPH                            43230000
432400                                TO AA-PARAGRAPH-NAME              43240000
432500             MOVE 'UNSUCCESSFUL OPEN ON INVOICE_STORE_CSR'        43250000
432600                                TO AA-DB2-OP-1                    43260000
432700             MOVE 'TMDINVC'     TO AA-DB2-TABLE-1                 43270000
432800             MOVE 'TINVOIC'     TO AA-DB2-TABLE-2                 43280000
432900             MOVE SPACES        TO AA-DB2-TABLE-3                 43290000
433000                                   AA-DB2-TABLE-4                 43300000
433100                                   AA-DB2-TABLE-5                 43310000
433200             PERFORM Z998-DB2-ABEND                               43320000
433300     END-EVALUATE.                                                43330000
433400/                                                                 43340000
433500*---------------------------------------------------------------- 43350000
433600*    CLOSES THE INVOICE STORE CURSOR.                             43360000
433700*---------------------------------------------------------------- 43370000
433800 Y110-CLOSE-INVOICE-CSR.                                          43380000
433900                                                                  43390000
434000     MOVE 'Y110-CLOSE-INVOICE-CSR'       TO PV-CURRENT-PARAGRAPH. 43400000
434100                                                                  43410000
434200     EXEC SQL                                                     43420000
434300         CLOSE INVOICE_CSR                                        43430000
434400     END-EXEC.                                                    43440000
434500                                                                  43450000
434600     EVALUATE TRUE                                                43460000
434700         WHEN SQLCODE = ZERO                                      43470000
434800              CONTINUE                                            43480000
434900                                                                  43490000
435000         WHEN SQLWARN0 NOT = SPACES                               43500000
435100         WHEN SQLCODE  NOT = ZERO                                 43510000
435200             MOVE PV-CURRENT-PARAGRAPH                            43520000
435300                                   TO AA-PARAGRAPH-NAME           43530000
435400             MOVE 'UNSUCCESSFUL CLOSE OF INVOICE STORE CURSOR'    43540000
435500                                   TO AA-DB2-OP-1                 43550000
435600             MOVE 'TMDINVC'        TO AA-DB2-TABLE-1              43560000
435700             MOVE 'TINVOIC'        TO AA-DB2-TABLE-2              43570000
435800             MOVE SPACES           TO AA-DB2-TABLE-3              43580000
435900                                      AA-DB2-TABLE-4              43590000
436000                                      AA-DB2-TABLE-5              43600000
436100             PERFORM Z998-DB2-ABEND                               43610000
436200     END-EVALUATE.                                                43620000
436300/                                                                 43630000
436400*---------------------------------------------------------------- 43640000
436500*    OPENS THE CHARGE CODE CURSOR.                                43650000
436600*---------------------------------------------------------------- 43660000
436700 Y200-OPEN-CHARGE-CODE-CSR.                                       43670000
436800                                                                  43680000
436900     MOVE 'Y200-OPEN-CHARGE-CODE-CSR' TO PV-CURRENT-PARAGRAPH.    43690000
437000                                                                  43700000
437100     EXEC SQL                                                     43710000
437200         OPEN ALW_CHRG_CSR                                        43720000
437300     END-EXEC.                                                    43730000
437400                                                                  43740000
437500     EVALUATE TRUE                                                43750000
437600         WHEN SQLCODE = ZERO                                      43760000
437700              CONTINUE                                            43770000
437800                                                                  43780000
437900         WHEN SQLWARN0 NOT = SPACES                               43790000
438000         WHEN SQLCODE  NOT = ZERO                                 43800000
438100             MOVE PV-CURRENT-PARAGRAPH                            43810000
438200                                 TO AA-PARAGRAPH-NAME             43820000
438300             MOVE 'UNSUCCESSFUL OPEN ON ALW_CHRG_CSR'             43830000
438400                                 TO AA-DB2-OPERATION              43840000
438500             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                43850000
438600             MOVE SPACES         TO AA-DB2-TABLE-2                43860000
438700                                    AA-DB2-TABLE-3                43870000
438800                                    AA-DB2-TABLE-4                43880000
438900                                    AA-DB2-TABLE-5                43890000
439000             PERFORM Z998-DB2-ABEND                               43900000
439100     END-EVALUATE.                                                43910000
439200/                                                                 43920000
439300*---------------------------------------------------------------- 43930000
439400*    CLOSES THE CHARGE CODE CURSOR.                               43940000
439500*---------------------------------------------------------------- 43950000
439600 Y210-CLOSE-CHARGE-CODE-CSR.                                      43960000
439700                                                                  43970000
439800     MOVE 'Y210-CLOSE-CHARGE-CODE-CSR' TO PV-CURRENT-PARAGRAPH.   43980000
439900                                                                  43990000
440000     EXEC SQL                                                     44000000
440100         CLOSE ALW_CHRG_CSR                                       44010000
440200     END-EXEC.                                                    44020000
440300                                                                  44030000
440400     EVALUATE TRUE                                                44040000
440500         WHEN SQLCODE = ZERO                                      44050000
440600              CONTINUE                                            44060000
440700                                                                  44070000
440800         WHEN SQLWARN0 NOT = SPACES                               44080000
440900         WHEN SQLCODE  NOT = ZERO                                 44090000
441000             MOVE PV-CURRENT-PARAGRAPH                            44100000
441100                                 TO AA-PARAGRAPH-NAME             44110000
441200             MOVE 'UNSUCCESSFUL CLOSE ON ALW_CHRG_CSR'            44120000
441300                                 TO AA-DB2-OPERATION              44130000
441400             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                44140000
441500             MOVE SPACES         TO AA-DB2-TABLE-2                44150000
441600                                    AA-DB2-TABLE-3                44160000
441700                                    AA-DB2-TABLE-4                44170000
441800                                    AA-DB2-TABLE-5                44180000
441900             PERFORM Z998-DB2-ABEND                               44190000
442000     END-EVALUATE.                                                44200000
442100/                                                                 44210000
442200*---------------------------------------------------------------- 44220000
442300*    OPENS THE PURCHASE ORDER CURSOR.                             44230000
442400*---------------------------------------------------------------- 44240000
442500 Y300-OPEN-PO-CSR.                                                44250000
442600                                                                  44260000
442700     MOVE 'Y300-OPEN-PO-CSR' TO PV-CURRENT-PARAGRAPH.             44270000
442800                                                                  44280000
442900     EXEC SQL                                                     44290000
443000         OPEN PO_CSR                                              44300000
443100     END-EXEC.                                                    44310000
443200                                                                  44320000
443300     EVALUATE TRUE                                                44330000
443400         WHEN SQLCODE = ZERO                                      44340000
443500              CONTINUE                                            44350000
443600                                                                  44360000
443700         WHEN SQLCODE = +100                                      44370000
443800             MOVE PV-CURRENT-PARAGRAPH                            44380000
443900                                 TO AA-PARAGRAPH-NAME             44390000
444000             MOVE 'NO POS TO BE PROCESSED'                        44400000
444100                                 TO AA-DB2-OPERATION              44410000
444200             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                44420000
444300             SET OUT-OF-POS      TO TRUE                          44430000
444400             PERFORM Z996-DISPLAY-ERROR-MSG                       44440000
444500                                                                  44450000
444600         WHEN SQLWARN0 NOT = SPACES                               44460000
444700         WHEN SQLCODE  NOT = ZERO                                 44470000
444800             MOVE PV-CURRENT-PARAGRAPH                            44480000
444900                                 TO AA-PARAGRAPH-NAME             44490000
445000             MOVE 'UNSUCCESSFUL OPEN ON PO_CSR'                   44500000
445100                                 TO AA-DB2-OPERATION              44510000
445200             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                44520000
445300             MOVE SPACES         TO AA-DB2-TABLE-2                44530000
445400                                    AA-DB2-TABLE-3                44540000
445500                                    AA-DB2-TABLE-4                44550000
445600                                    AA-DB2-TABLE-5                44560000
445700             PERFORM Z998-DB2-ABEND                               44570000
445800     END-EVALUATE.                                                44580000
445900/                                                                 44590000
446000*---------------------------------------------------------------- 44600000
446100*    CLOSES THE PURCHASE ORDER CURSOR                             44610000
446200*---------------------------------------------------------------- 44620000
446300 Y310-CLOSE-PO-CSR.                                               44630000
446400                                                                  44640000
446500     MOVE 'Y310-CLOSE-PO-CSR' TO PV-CURRENT-PARAGRAPH.            44650000
446600                                                                  44660000
446700     EXEC SQL                                                     44670000
446800         CLOSE PO_CSR                                             44680000
446900     END-EXEC.                                                    44690000
447000                                                                  44700000
447100     EVALUATE TRUE                                                44710000
447200         WHEN SQLCODE = ZERO                                      44720000
447300              CONTINUE                                            44730000
447400                                                                  44740000
447500         WHEN SQLWARN0 NOT = SPACES                               44750000
447600         WHEN SQLCODE  NOT = ZERO                                 44760000
447700             MOVE PV-CURRENT-PARAGRAPH                            44770000
447800                                 TO AA-PARAGRAPH-NAME             44780000
447900             MOVE 'UNSUCCESSFUL CLOSE ON PO_CSR'                  44790000
448000                                 TO AA-DB2-OPERATION              44800000
448100             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                44810000
448200             MOVE SPACES         TO AA-DB2-TABLE-2                44820000
448300                                    AA-DB2-TABLE-3                44830000
448400                                    AA-DB2-TABLE-4                44840000
448500                                    AA-DB2-TABLE-5                44850000
448600             PERFORM Z998-DB2-ABEND                               44860000
448700     END-EVALUATE.                                                44870000
448800/                                                                 44880000
448900*---------------------------------------------------------------- 44890000
449000*    OPENS THE PRICE CLAIM ADJUSTMENT CURSOR.                     44900000
449100*---------------------------------------------------------------- 44910000
449200 Y400-OPEN-PRCCLM-CSR.                                            44920000
449300                                                                  44930000
449400     MOVE 'Y400-OPEN-PRCCLM-CSR' TO PV-CURRENT-PARAGRAPH.         44940000
449500                                                                  44950000
449600     EXEC SQL                                                     44960000
449700         OPEN PRCCLM_CSR                                          44970000
449800     END-EXEC.                                                    44980000
449900                                                                  44990000
450000     EVALUATE TRUE                                                45000000
450100         WHEN SQLCODE = ZERO                                      45010000
450200             CONTINUE                                             45020000
450300                                                                  45030000
450400         WHEN SQLWARN0 NOT = SPACES                               45040000
450500         WHEN SQLCODE  NOT = ZERO                                 45050000
450600             MOVE PV-CURRENT-PARAGRAPH                            45060000
450700                                 TO AA-PARAGRAPH-NAME             45070000
450800             MOVE 'UNSUCCESSFUL OPEN ON PRCCLM_CSR'               45080000
450900                                 TO AA-DB2-OPERATION              45090000
451000             MOVE 'TPRCCLM'      TO AA-DB2-TABLE-1                45100000
451100             MOVE SPACES         TO AA-DB2-TABLE-2                45110000
451200                                    AA-DB2-TABLE-3                45120000
451300                                    AA-DB2-TABLE-4                45130000
451400                                    AA-DB2-TABLE-5                45140000
451500             PERFORM Z998-DB2-ABEND                               45150000
451600     END-EVALUATE.                                                45160000
451700/                                                                 45170000
451800*---------------------------------------------------------------- 45180000
451900*    CLOSES THE ADJUSTMENT CURSOR                                 45190000
452000*---------------------------------------------------------------- 45200000
452100 Y410-CLOSE-PRCCLM-CSR.                                           45210000
452200                                                                  45220000
452300     MOVE 'Y410-CLOSE-PRCCLM-CSR' TO PV-CURRENT-PARAGRAPH.        45230000
452400                                                                  45240000
452500     EXEC SQL                                                     45250000
452600         CLOSE PRCCLM_CSR                                         45260000
452700     END-EXEC.                                                    45270000
452800                                                                  45280000
452900     EVALUATE TRUE                                                45290000
453000         WHEN SQLCODE = ZERO                                      45300000
453100              CONTINUE                                            45310000
453200                                                                  45320000
453300         WHEN SQLWARN0 NOT = SPACES                               45330000
453400         WHEN SQLCODE  NOT = ZERO                                 45340000
453500             MOVE PV-CURRENT-PARAGRAPH                            45350000
453600                                 TO AA-PARAGRAPH-NAME             45360000
453700             MOVE 'UNSUCCESSFUL CLOSE ON PRCCLM_CSR'              45370000
453800                                 TO AA-DB2-OPERATION              45380000
453900             MOVE 'TPRCCLM'      TO AA-DB2-TABLE-1                45390000
454000             MOVE SPACES         TO AA-DB2-TABLE-2                45400000
454100                                    AA-DB2-TABLE-3                45410000
454200                                    AA-DB2-TABLE-4                45420000
454300                                    AA-DB2-TABLE-5                45430000
454400             PERFORM Z998-DB2-ABEND                               45440000
454500     END-EVALUATE.                                                45450000
454600/                                                                 45460000
454700*---------------------------------------------------------------- 45470000
454800*    OPENS THE REMAINDER INVOICE CURSOR.                          45480000
454900*---------------------------------------------------------------- 45490000
455000 Y500-OPEN-RI-CSR.                                                45500000
455100                                                                  45510000
455200     MOVE 'Y500-OPEN-RI-CSR'     TO PV-CURRENT-PARAGRAPH.         45520000
455300                                                                  45530000
455400     EXEC SQL                                                     45540000
455500         OPEN RI_CSR                                              45550000
455600     END-EXEC.                                                    45560000
455700                                                                  45570000
455800     EVALUATE TRUE                                                45580000
455900         WHEN SQLCODE = ZERO                                      45590000
456000             CONTINUE                                             45600000
456100                                                                  45610000
456200         WHEN SQLWARN0 NOT = SPACES                               45620000
456300         WHEN SQLCODE  NOT = ZERO                                 45630000
456400             MOVE PV-CURRENT-PARAGRAPH                            45640000
456500                                 TO AA-PARAGRAPH-NAME             45650000
456600             MOVE 'UNSUCCESSFUL OPEN ON RI_CSR'                   45660000
456700                                 TO AA-DB2-OPERATION              45670000
456800             MOVE 'TPURITM'      TO AA-DB2-TABLE-1                45680000
456900             MOVE 'TPREQIT'      TO AA-DB2-TABLE-2                45690000
457000             MOVE 'TMIITEM'      TO AA-DB2-TABLE-3                45700000
457100             MOVE SPACES         TO AA-DB2-TABLE-4                45710000
457200                                    AA-DB2-TABLE-5                45720000
457300             PERFORM Z998-DB2-ABEND                               45730000
457400     END-EVALUATE.                                                45740000
457500/                                                                 45750000
457600*---------------------------------------------------------------- 45760000
457700*    CLOSES THE REMAINDER INVOICE CURSOR                          45770000
457800*---------------------------------------------------------------- 45780000
457900 Y510-CLOSE-RI-CSR.                                               45790000
458000                                                                  45800000
458100     MOVE 'Y510-CLOSE-RI-CSR'     TO PV-CURRENT-PARAGRAPH.        45810000
458200                                                                  45820000
458300     EXEC SQL                                                     45830000
458400         CLOSE RI_CSR                                             45840000
458500     END-EXEC.                                                    45850000
458600                                                                  45860000
458700     EVALUATE TRUE                                                45870000
458800         WHEN SQLCODE = ZERO                                      45880000
458900              CONTINUE                                            45890000
459000                                                                  45900000
459100         WHEN SQLWARN0 NOT = SPACES                               45910000
459200         WHEN SQLCODE  NOT = ZERO                                 45920000
459300             MOVE PV-CURRENT-PARAGRAPH                            45930000
459400                                 TO AA-PARAGRAPH-NAME             45940000
459500             MOVE 'UNSUCCESSFUL CLOSE ON RI_CSR'                  45950000
459600                                 TO AA-DB2-OPERATION              45960000
459700             MOVE 'TPURITM'      TO AA-DB2-TABLE-1                45970000
459800             MOVE 'TPREQIT'      TO AA-DB2-TABLE-2                45980000
459900             MOVE 'TMIITEM'      TO AA-DB2-TABLE-3                45990000
460000             MOVE SPACES         TO AA-DB2-TABLE-4                46000000
460100                                    AA-DB2-TABLE-5                46010000
460200             PERFORM Z998-DB2-ABEND                               46020000
460300     END-EVALUATE.                                                46030000
460400/                                                                 46040000
460500*---------------------------------------------------------------- 46050000
460600*    OPENS THE REMAINDER INVOICE CURSOR FOR NULL PO LINE NBRS.    46060000
460700*---------------------------------------------------------------- 46070000
460800 Y600-OPEN-RI-NULL-CSR.                                           46080000
460900                                                                  46090000
461000     MOVE 'Y600-OPEN-RI-NULL-CSR' TO PV-CURRENT-PARAGRAPH.        46100000
461100                                                                  46110000
461200     EXEC SQL                                                     46120000
461300         OPEN RI_NULL_CSR                                         46130000
461400     END-EXEC.                                                    46140000
461500                                                                  46150000
461600     EVALUATE TRUE                                                46160000
461700         WHEN SQLCODE = ZERO                                      46170000
461800             CONTINUE                                             46180000
461900                                                                  46190000
462000         WHEN SQLWARN0 NOT = SPACES                               46200000
462100         WHEN SQLCODE  NOT = ZERO                                 46210000
462200             MOVE PV-CURRENT-PARAGRAPH                            46220000
462300                                 TO AA-PARAGRAPH-NAME             46230000
462400             MOVE 'UNSUCCESSFUL OPEN ON RI_NULL_CSR'              46240000
462500                                 TO AA-DB2-OPERATION              46250000
462600             MOVE 'TPREQIT'      TO AA-DB2-TABLE-1                46260000
462700             MOVE 'TMIITEM'      TO AA-DB2-TABLE-2                46270000
462800             MOVE 'TPURITM'      TO AA-DB2-TABLE-3                46280000
462900             MOVE SPACES         TO AA-DB2-TABLE-4                46290000
463000                                    AA-DB2-TABLE-5                46300000
463100             PERFORM Z998-DB2-ABEND                               46310000
463200     END-EVALUATE.                                                46320000
463300/                                                                 46330000
463400*---------------------------------------------------------------- 46340000
463500*    CLOSES THE REMAINDER INVOICE CURSOR FOR NULL PO LINE NBRS.   46350000
463600*---------------------------------------------------------------- 46360000
463700 Y610-CLOSE-RI-NULL-CSR.                                          46370000
463800                                                                  46380000
463900     MOVE 'Y610-CLOSE-RI-NULL-CSR' TO PV-CURRENT-PARAGRAPH.       46390000
464000                                                                  46400000
464100     EXEC SQL                                                     46410000
464200         CLOSE RI_NULL_CSR                                        46420000
464300     END-EXEC.                                                    46430000
464400                                                                  46440000
464500     EVALUATE TRUE                                                46450000
464600         WHEN SQLCODE = ZERO                                      46460000
464700              CONTINUE                                            46470000
464800                                                                  46480000
464900         WHEN SQLWARN0 NOT = SPACES                               46490000
465000         WHEN SQLCODE  NOT = ZERO                                 46500000
465100             MOVE PV-CURRENT-PARAGRAPH                            46510000
465200                                 TO AA-PARAGRAPH-NAME             46520000
465300             MOVE 'UNSUCCESSFUL CLOSE ON RI_NULL_CSR'             46530000
465400                                 TO AA-DB2-OPERATION              46540000
465500             MOVE 'TPREQIT'      TO AA-DB2-TABLE-1                46550000
465600             MOVE 'TMIITEM'      TO AA-DB2-TABLE-2                46560000
465700             MOVE 'TPURITM'      TO AA-DB2-TABLE-3                46570000
465800             MOVE SPACES         TO AA-DB2-TABLE-4                46580000
465900                                    AA-DB2-TABLE-5                46590000
466000             PERFORM Z998-DB2-ABEND                               46600000
466100     END-EVALUATE.                                                46610000
466200/                                                                 46620000
466300*---------------------------------------------------------------- 46630000
466400*  Y940-SET-CONSIGNMENT-SW                                        46640000
466500*---------------------------------------------------------------- 46650000
466600 Y940-SET-CONSIGNMENT-SW.                                         46660000
466700                                                                  46670000
466800     MOVE 'Y940-SET-CONSIGNMENT-SW' TO PV-CURRENT-PARAGRAPH.      46680000
466900                                                                  46690000
467000     SET IDX TO 1.                                                46700000
467100     SEARCH PV-ENT-CSV-ENTRIES                                    46710000
467200       VARYING IDX                                                46720000
467300        AT END                                                    46730000
467400           SET PS-NOT-CSV-VENDOR TO TRUE                          46740000
467500        WHEN TBL-ENT-ID(IDX) = PURCHS-ENT-ID                      46750000
467600            SET PS-CSV-VENDOR TO TRUE                             46760000
467700     END-SEARCH.                                                  46770000
467800/                                                                 46780000
467900*---------------------------------------------------------------- 46790000
468000*   Y950-GET-CSV-DATA                                             46800000
468100*---------------------------------------------------------------- 46810000
468200 Y950-GET-CSV-DATA.                                               46820000
468300                                                                  46830000
468400     MOVE 'R950-GET-CSV-DATA '      TO PV-CURRENT-PARAGRAPH.      46840000
468500                                                                  46850000
468600     SET IDX TO 1.                                                46860000
468700     PERFORM Y960-OPEN-CSV-CSR.                                   46870000
468800     PERFORM Y970-FETCH-CSV-CSR UNTIL                             46880000
468900                                CSV-DATA-NOT-FOUND OR             46890000
469000                                IDX > 100.                        46900000
469100       IF IDX > 100                                               46910000
469200          SET AC-TABLE-OVERFLOW      TO TRUE                      46920000
469300          MOVE 'Y970-FETCH-CSV-CSR' TO AA-PARAGRAPH-NAME          46930000
469400          MOVE 'ENT ID ARRAY EXCEEDS LIMIT' TO AA-MESSAGE         46940000
469500          PERFORM Z999-ABEND                                      46950000
469600       END-IF                                                     46960000
469700     PERFORM Y980-CLOSE-CSV-CSR.                                  46970000
469800/                                                                 46980000
469900*---------------------------------------------------------------  46990000
470000*   Y960-OPEN-CSV-CSR                                             47000000
470100*---------------------------------------------------------------  47010000
470200 Y960-OPEN-CSV-CSR.                                               47020000
470300                                                                  47030000
470400     MOVE 'R950-OPEN-CSV-CSR '      TO PV-CURRENT-PARAGRAPH.      47040000
470500                                                                  47050000
470600     EXEC SQL                                                     47060000
470700         OPEN VND_CSV_CSR                                         47070000
470800     END-EXEC.                                                    47080000
470900                                                                  47090000
471000     EVALUATE TRUE                                                47100000
471100         WHEN SQLCODE = ZERO                                      47110000
471200              CONTINUE                                            47120000
471300                                                                  47130000
471400         WHEN SQLCODE = +100                                      47140000
471500             MOVE PV-CURRENT-PARAGRAPH                            47150000
471600                                TO AA-PARAGRAPH-NAME              47160000
471700             MOVE 'NO ENT ID FOUND FOR CPBL CODE CSV'             47170000
471800                                 TO AA-DB2-OP-1                   47180000
471900             MOVE 'VNT00001'     TO AA-DB2-TABLE-1                47190000
472000             MOVE SPACES         TO AA-DB2-TABLE-2                47200000
472100                                    AA-DB2-TABLE-3                47210000
472200                                    AA-DB2-TABLE-4                47220000
472300                                    AA-DB2-TABLE-5                47230000
472400             PERFORM Z998-DB2-ABEND                               47240000
472500                                                                  47250000
472600         WHEN SQLWARN0 NOT = SPACES                               47260000
472700         WHEN SQLCODE  NOT = ZERO                                 47270000
472800             MOVE PV-CURRENT-PARAGRAPH                            47280000
472900                                TO AA-PARAGRAPH-NAME              47290000
473000             MOVE 'UNSUCCESSFUL OPEN ON VND_CSV_CSR'              47300000
473100                                TO AA-DB2-OP-1                    47310000
473200             MOVE 'VNT00001'    TO AA-DB2-TABLE-1                 47320000
473300             MOVE SPACES        TO AA-DB2-TABLE-2                 47330000
473400                                   AA-DB2-TABLE-3                 47340000
473500                                   AA-DB2-TABLE-4                 47350000
473600                                   AA-DB2-TABLE-5                 47360000
473700             PERFORM Z998-DB2-ABEND                               47370000
473800     END-EVALUATE.                                                47380000
473900                                                                  47390000
474000/                                                                 47400000
474100*---------------------------------------------------------------- 47410000
474200* Y970-FETCH-CSV-CSR                                              47420000
474300*---------------------------------------------------------------- 47430000
474400  Y970-FETCH-CSV-CSR.                                             47440000
474500                                                                  47450000
474600     MOVE 'Y970-FETCH-CSV-CSR' TO PV-CURRENT-PARAGRAPH.           47460000
474700                                                                  47470000
474800*    SET IDX TO 1.                                                47480000
474900                                                                  47490000
475000     EXEC SQL                                                     47500000
475100         FETCH VND_CSV_CSR                                        47510000
475200         INTO :VNT00001-ENT-ID                                    47520000
475300     END-EXEC.                                                    47530000
475400                                                                  47540000
475500     EVALUATE TRUE                                                47550000
475600         WHEN SQLCODE = +100                                      47560000
475700           SET CSV-DATA-NOT-FOUND TO TRUE                         47570000
475800         WHEN SQLCODE = ZERO                                      47580000
475900           SET CSV-DATA-FOUND TO TRUE                             47590000
476000           MOVE VNT00001-ENT-ID TO TBL-ENT-ID(IDX)                47600000
476100           SET IDX UP BY 1                                        47610000
476200         WHEN SQLWARN0 NOT = SPACES                               47620000
476300         WHEN SQLCODE  NOT = ZERO                                 47630000
476400           MOVE PV-CURRENT-PARAGRAPH                              47640000
476500                               TO AA-PARAGRAPH-NAME               47650000
476600           MOVE                                                   47660000
476700             'UNSUCCESSFUL FETCH WITH VND_CSV_CSR'                47670000
476800                               TO AA-DB2-OPERATION                47680000
476900           MOVE 'VNT00001'     TO AA-DB2-TABLE-1                  47690000
477000           MOVE SPACES         TO AA-DB2-TABLE-2                  47700000
477100                                  AA-DB2-TABLE-3                  47710000
477200                                  AA-DB2-TABLE-4                  47720000
477300                                  AA-DB2-TABLE-5                  47730000
477400           PERFORM Z998-DB2-ABEND                                 47740000
477500     END-EVALUATE.                                                47750000
477600/                                                                 47760000
477700*---------------------------------------------------------------- 47770000
477800* Y980-CLOSE-CSV-CSR                                              47780000
477900*---------------------------------------------------------------- 47790000
478000  Y980-CLOSE-CSV-CSR.                                             47800000
478100                                                                  47810000
478200     MOVE 'R950-CLOSE-CSV-CSR' TO PV-CURRENT-PARAGRAPH.           47820000
478300                                                                  47830000
478400     EXEC SQL                                                     47840000
478500         CLOSE VND_CSV_CSR                                        47850000
478600     END-EXEC.                                                    47860000
478700                                                                  47870000
478800     EVALUATE TRUE                                                47880000
478900         WHEN SQLCODE = ZERO                                      47890000
479000              CONTINUE                                            47900000
479100                                                                  47910000
479200         WHEN SQLWARN0 NOT = SPACES                               47920000
479300         WHEN SQLCODE  NOT = ZERO                                 47930000
479400             MOVE PV-CURRENT-PARAGRAPH                            47940000
479500                                 TO AA-PARAGRAPH-NAME             47950000
479600             MOVE 'UNSUCCESSFUL CLOSE ON VND_CSV_CSR'             47960000
479700                                 TO AA-DB2-OPERATION              47970000
479800             MOVE 'VNT00001'     TO AA-DB2-TABLE-1                47980000
479900             MOVE SPACES         TO AA-DB2-TABLE-2                47990000
480000                                    AA-DB2-TABLE-3                48000000
480100                                    AA-DB2-TABLE-4                48010000
480200                                    AA-DB2-TABLE-5                48020000
480300             PERFORM Z998-DB2-ABEND                               48030000
480400     END-EVALUATE.                                                48040000
480500/                                                                 48050000
480600*---------------------------------------------------------------- 48060000
480700*    ABEND ROUTINE FOR PO WITH NO INVOICES                        48070000
480800*---------------------------------------------------------------- 48080000
480900 Z994-NO-INVOICES-ABEND.                                          48090000
481000                                                                  48100000
481100     DISPLAY 'PO BEING PROCESSED = ' PV-PO-BEING-PROCESSED.       48110000
481200     DISPLAY 'STORE BEING PROCESSED = ' PV-STORE-BEING-PROCESSED. 48120000
481300     DISPLAY AA-ABEND-LIT.                                        48130000
481400     DISPLAY AA-DB2-ERROR-LIT.                                    48140000
481500     DISPLAY AA-PROGRAM-LIT.                                      48150000
481600     DISPLAY AA-PARAGRAPH-LIT.                                    48160000
481700     DISPLAY AA-DB2-OPERATION-LIT.                                48170000
481800     DISPLAY AA-DB2-TABLE-1.                                      48180000
481900     DISPLAY AA-DB2-TABLE-2.                                      48190000
482000     DISPLAY AA-DB2-TABLE-3.                                      48200000
482100     CALL 'ILBOABN0' USING ABEND-CODE.                            48210000
482200/                                                                 48220000
482300*---------------------------------------------------------------- 48230000
482400*    ERROR MESSAGE ROUTINE FOR DISPLAYING ERRORS                  48240000
482500*---------------------------------------------------------------- 48250000
482600 Z996-DISPLAY-ERROR-MSG.                                          48260000
482700                                                                  48270000
482800     DISPLAY 'PO BEING PROCESSED = ' PV-PO-BEING-PROCESSED.       48280000
482900     DISPLAY 'STORE BEING PROCESSED = ' PV-STORE-BEING-PROCESSED. 48290000
483000     DISPLAY AA-ABEND-LIT.                                        48300000
483100     DISPLAY AA-DB2-ERROR-LIT.                                    48310000
483200     DISPLAY AA-PROGRAM-LIT.                                      48320000
483300     DISPLAY AA-PARAGRAPH-LIT.                                    48330000
483400     DISPLAY AA-DB2-OPERATION-LIT.                                48340000
483500     DISPLAY AA-DB2-TABLE-1.                                      48350000
483600/                                                                 48360000
483700                                                                  48370000
483800*---------------------------------------------------------------- 48380000
483900*    ABEND ROUTINE FOR DB2 ERRORS                                 48390000
484000*---------------------------------------------------------------- 48400000
484100 Z998-DB2-ABEND.                                                  48410000
484200                                                                  48420000
484300     DISPLAY 'PO BEING PROCESSED = ' PV-PO-BEING-PROCESSED.       48430000
484400     DISPLAY 'STORE BEING PROCESSED = ' PV-STORE-BEING-PROCESSED. 48440000
484500     DISPLAY AA-ABEND-LIT.                                        48450000
484600     DISPLAY AA-DB2-ERROR-LIT.                                    48460000
484700     DISPLAY AA-PROGRAM-LIT.                                      48470000
484800     DISPLAY AA-PARAGRAPH-LIT.                                    48480000
484900     DISPLAY AA-DB2-OPERATION-LIT.                                48490000
485000     DISPLAY AA-DB2-TABLE-1.                                      48500000
485100     DISPLAY AA-DB2-TABLE-2.                                      48510000
485200     DISPLAY AA-DB2-TABLE-3.                                      48520000
485300     DISPLAY AA-DB2-TABLE-4.                                      48530000
485400     SET AC-DB2-ERROR TO TRUE.                                    48540000
485500                                                                  48550000
485600     COPY DPPD004.                                                48560000
485700                                                                  48570000
485800     CALL 'ILBOABN0' USING ABEND-CODE.                            48580000
485900 SKIP3                                                            48590000
486000*---------------------------------------------------------------- 48600000
486100*    ABEND ROUTINE                                                48610000
486200*---------------------------------------------------------------- 48620000
486300 Z999-ABEND.                                                      48630000
486400                                                                  48640000
486500     DISPLAY AA-ABEND-LIT.                                        48650000
486600     DISPLAY AA-PROGRAM-LIT.                                      48660000
486700     DISPLAY AA-PARAGRAPH-LIT.                                    48670000
486800     DISPLAY AA-MESSAGE-LINE.                                     48680000
486900     DISPLAY 'PO BEING PROCESSED    = ' PV-PO-BEING-PROCESSED.    48690000
487000     DISPLAY 'STORE BEING PROCESSED = ' PV-STORE-BEING-PROCESSED. 48700000
487100     CALL 'ILBOABN0' USING ABEND-CODE.                            48710000
487200                                                                  48720000
487300*---------------------------------------------------------------- 48730000
487400*    PROCEDURE DIVISION FOR SEPHORA & KOHLS                       48740000
487500*---------------------------------------------------------------- 48750000
487600                                                                  48760000
487700     COPY APPD021.                                                48770000
