000100*-----------------------*                                         00010015
000200 IDENTIFICATION DIVISION.                                         00020015
000300*-----------------------*                                         00030015
000400 PROGRAM-ID.    RCKCS276.                                         00040015
000500 AUTHOR.        MARY SARDINA.                                     00050015
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060015
000700 DATE-WRITTEN.  02-02-96.                                         00070015
000800 DATE-COMPILED.                                                   00080015
000900*----------------------------------------------------------------*00090015
001000*    E276 - POSTED VERIFY RECEIPT ADJ SELECT CRIT                *00100015
001100*    THIS IS A SELECTION CRITERIA PANEL WHICH ALLOWS ACCESS TO    00110015
001200*    VERIFIED RECEIVERS FOR THE PURPOSE OF UPDATING VERIFIED     *00120015
001300*     POSTED COUNTS.                                             *00130015
001400*                                                                *00140015
001500*    THIS PROGRAM REQUIRES THE OP ID, PURCHASE ORDER NUMBER AND  *00150015
001600*    OPTIONALLY THE RECEIVER SEQUENCE NUMBER FOR THE AUDIT LIST. *00160015
001700*----------------------------------------------------------------*00170015
001710* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00171061
001720* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00172062
001730* MAKING THE CALL DYNAMIC VS STATIC.                              00173062
001740*---------------------------------------------------------------* 00174062
001800                                                                  00180015
001900                                                                  00190015
002000 ENVIRONMENT DIVISION.                                            00200015
002100                                                                  00210015
002200                                                                  00220015
002300                                                                  00230015
002400 DATA DIVISION.                                                   00240015
002500                                                                  00250015
002600                                                                  00260015
002700 WORKING-STORAGE SECTION.                                         00270015
002800                                                                  00280015
002900 01  DK-DB2-KEYS.                                                 00290015
003000     05  DK-DEPT-NBR                    PIC X(03)   VALUE SPACES. 00300015
003100     05  DK-PO-NBR                      PIC S9(09)  COMP VALUE +0.00310015
003200     05  DK-RCVR-NBR                    PIC S9(09)  COMP VALUE +0.00320015
003300     05  DK-OPER-UNT-ID                 PIC S9(04)  VALUE ZERO    00330015
003400                                                    COMP.         00340015
003500                                                                  00350062
003600 01  PC-PROGRAM-CONSTANTS.                                        00360062
003700     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'RC276A  '. 00370062
003800     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'RCKM276 '. 00380062
003900     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'RCKCS276'. 00390062
004000     05  PC-LOCATION-MODULE        PIC  X(08)  VALUE  'XLKUT071'. 00400062
004100                                                                  00410062
004200******************************************************************00420062
004300*00005 - INVALID VALUE                                           *00430041
004400*00007 - REQUIRED ENTRY                                          *00440041
004500*00008 - MUST BE NUMERIC                                         *00450041
004600*00083 - PURCHASE ORDER DOES NOT EXIST                           *00460041
004700*00148 - DATA DOES NOT EXIST                                     *00470041
004800*00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN: UNSUCCESSFULL CALL*00480041
004900*00954 - PO/RECEIVER SEQUENCE NOT FOUND                          *00490041
005000*01057 - RECEIVER IS IN PRE-RECEIVER STATUS                      *00500041
005100*01058 - FREIGHT BILL IS MISSING ON THE RECEIVER                 *00510041
005200*03076 - PRE-PACK CREATED PRIOR TO NEW PACK SCREENS - USE F17    *00520041
005300*03079 - RECEIVER IS PRE-PACK.  USE THE F17 OR F24 KEYS FOR      *00530041
005400*03080 - RECEIVER IS NOT PRE-PACK.  USE THE F22 OR F23 KEYS      *00540041
005500*03179 - PO/RECEIVER IS NOT ELIGIBLE FOR POST VERIFICATION ADJ   *00550041
005600*03179 - UNABLE TO UPDATE VE UNITS - WRK ORD INFO REQUIRED       *00560041
005700******************************************************************00570041
005800     05  PC-TSYMSG-NUMBERS.                                       00580015
005900         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.      00590015
006000         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00600015
006100         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00610015
006200         10  PC-TSYMSG-00083       PIC  9(05)  VALUE  00083.      00620015
006300         10  PC-TSYMSG-00148       PIC  9(05)  VALUE  00083.      00630015
006400         10  PC-TSYMSG-00551       PIC  9(05)  VALUE  00551.      00640041
006500         10  PC-TSYMSG-00954       PIC  9(05)  VALUE  00954.      00650019
006600         10  PC-TSYMSG-01057       PIC  9(05)  VALUE  01057.      00660015
006700         10  PC-TSYMSG-01058       PIC  9(05)  VALUE  01058.      00670015
006800         10  PC-TSYMSG-03076       PIC  9(05)  VALUE  03076.      00680041
006900         10  PC-TSYMSG-03079       PIC  9(05)  VALUE  03079.      00690019
007000         10  PC-TSYMSG-03080       PIC  9(05)  VALUE  03080.      00700019
007100         10  PC-TSYMSG-03179       PIC  9(05)  VALUE  03179.      00710021
007200         10  PC-TSYMSG-03706       PIC  9(05)  VALUE  03706.      00720041
007300                                                                  00730041
007400******************************************************************00740041
007500                                                                  00750041
007600     05  PC-ACTIVE                 PIC  X(01)  VALUE  'A'.        00760015
007700     05  PC-X                      PIC  X(01)  VALUE  'X'.        00770015
007800     05  PC-AC                     PIC  X(02)  VALUE  'AC'.       00780015
007900     05  PC-CM                     PIC  X(02)  VALUE  'CM'.       00790015
008000     05  PC-IN                     PIC  X(02)  VALUE  'IN'.       00800015
008100     05  PC-IP                     PIC  X(02)  VALUE  'IP'.       00810015
008200     05  PC-SPACES                 PIC  X(22)  VALUE  SPACES.     00820015
008300     05  PC-MAX-RETRIES            PIC S9(03)  VALUE  +3          00830015
008400                                               COMP-3.            00840015
008500     05  PC-1                      PIC S9(04)  VALUE  +1          00850015
008600                                               COMP.              00860015
008700     05  PC-DEFAULT-TMST           PIC  X(26)  VALUE              00870015
008800                                  '9999-09-09-09.09.09.999999'.   00880015
008900                                                                  00890021
009000     05  PC-AUTOVE-MODULE           PIC  X(08) VALUE 'RCKUT127'.  00900021
009100     05  PC-AUTOVE-MODULE-LENGTH    PIC S9(04) VALUE  +400        00910021
009200                                                    COMP SYNC.    00920021
009300                                                                  00930015
009400 01  PS-PROGRAM-SWITCHES.                                         00940015
009500     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00950015
009600         88  PS-ERROR                          VALUE  'Y'.        00960015
009700         88  PS-NO-ERROR                       VALUE  'N'.        00970015
009800     05  PS-RACF-OVERRIDE-SW       PIC  X(01)  VALUE  'N'.        00980038
009900         88  PS-RACF-OVERRIDE-YES              VALUE  'Y'.        00990038
010000         88  PS-RACF-OVERRIDE-NO               VALUE  'N'.        01000038
010100     05  PS-CURR-OPER-EFC-SW       PIC  X(01)  VALUE  'N'.        01010038
010200         88  PS-CURR-OPER-EFC-YES              VALUE  'Y'.        01020038
010300         88  PS-CURR-OPER-EFC-NO               VALUE  'N'.        01030038
010400     05  PS-HAS-WORK-ORDER-INST-SW PIC  X(01)  VALUE  'N'.        01040044
010500         88  PS-HAS-WORK-ORDER-INST            VALUE  'Y'.        01050044
010600         88  PS-HAS-WORK-ORDER-INST-NO         VALUE  'N'.        01060044
010700     05  PS-TOSOPFA-CURSOR-SW      PIC  X(01)  VALUE  'N'.        01070046
010800         88  PS-EOF-TOSOPFA-CSR                VALUE  'Y'.        01080046
010900     05  PS-INSTRUCTION-SW         PIC  X(01)  VALUE  'N'.        01090046
011000         88  PS-FIRST-INSTRUCTION              VALUE  'Y'.        01100046
011100                                                                  01110015
011200 01  PS-PROGRAM-VARIABLES.                                        01120015
011300     05  PV-RETRY-COUNTER          PIC S9(04)  VALUE +0           01130015
011400                                               COMP SYNC.         01140015
011500     05  PV-OPER-UNT-ID            PIC 9(04)   VALUE ZEROES.      01150029
011600     05  PV-DB2-COUNT              PIC S9(9)   VALUE +0           01160029
011700                                               COMP-3.            01170015
011800     05  PV-NULL-IND               PIC S9(04)  VALUE +0           01180015
011900                                               COMP SYNC.         01190015
012000     05  PV-DISP-PO-NBR                 PIC  9(09).               01200016
012100     05  PV-DISP-OPER-UNT-ID            PIC  9(04).               01210016
012200     05  PV-DISP-FCLTY-ID               PIC  9(04).               01220016
012300     05  PV-DISP-REC-SEQ-NBR            PIC  9(09).               01230016
012400     05  PV-CICS-RESPONSE               PIC S9(09)  VALUE ZEROS   01240022
012500                                                    COMP SYNC.    01250027
012600     05  PV-CICS-MSG-AREA               PIC  X(100) VALUE SPACE.  01260026
012700     05  PV-COMMAREA-LENGTH             PIC S9(04)  VALUE +0      01270027
012800                                                    COMP SYNC.    01280027
012900     05  PV-WORK-ORDER-INSTR-COUNT      PIC S9(9)   VALUE +0      01290047
013000                                                    COMP-3.       01300047
013100     05  PV-WO-INSTR-SEQ-NBR             PIC S9(04) VALUE +0      01310047
013200                                                    COMP.         01320047
013300     05  PV-DISP-WO-SEQ-NBR              PIC  9(04).              01330047
013400     05  PV-DISP-WO-INSTR-SEQ-NBR        PIC  9(04).              01340047
013500     05  PV-DISP-LNE-NBR                 PIC  9(09).              01350047
013600     05  PV-DISP-SQLCODE                 PIC -9(05) VALUE ZEROES. 01360047
013700     05  PV-DISP-OPER-SET                PIC  9(04).              01370048
013800                                                                  01380015
013900*----------------------------------------------------------------*01390015
014000*    MAP LAYOUT                                                  *01400015
014100*----------------------------------------------------------------*01410015
014200                                                                  01420015
014300     COPY RCKM276.                                                01430015
014400                                                                  01440033
014500                                                                  01450033
014600***************************************************************** 01460033
014700*   XLWS071 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 01470033
014800*             LOCATION MODULE (XLKUT071)                        * 01480033
014900***************************************************************** 01490033
015000     COPY XLWS071.                                                01500033
015100                                                                  01510033
015200*----------------------------------------------------------------*01520038
015300**  SECURITY SUBROUTINE PARAMETERS                                01530038
015400*----------------------------------------------------------------*01540038
015500     COPY DPWS008.                                                01550038
015600                                                                  01560038
015700                                                                  01570038
015800*----------------------------------------------------------------*01580015
015900*    ATTRIBUTE SETTINGS COPYBOOK.                                *01590015
016000*----------------------------------------------------------------*01600015
016100                                                                  01610015
016200     COPY DPWS015.                                                01620021
016300                                                                  01630015
016400*----------------------------------------------------------------*01640015
016500*    FUNCTION KEYS COPYBOOK                                      *01650015
016600*----------------------------------------------------------------*01660015
016700                                                                  01670015
016800     COPY DPWS016.                                                01680021
016900/                                                                 01690015
017000******************************************************************01700015
017100** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01710015
017200** SUB-ROUTINE (DPKUT100).                                      **01720015
017300******************************************************************01730015
017400     COPY DPWS010I.                                               01740021
017500/                                                                 01750015
017600******************************************************************01760015
017700** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **01770063
017800** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01780015
017900******************************************************************01790015
018000     COPY DPWS030.                                                01800021
018010     COPY DPWS930.                                                01801063
018100/                                                                 01810015
018200***************************************************************** 01820015
018300*    STANDARD COMMAREA.                                           01830015
018400***************************************************************** 01840015
018500                                                                  01850015
018600     COPY DPWS020.                                                01860021
018700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01870015
018800                                                                  01880015
018900***************************************************************** 01890015
019000*    INTER-APPLICATION COMMAREA.                                  01900015
019100***************************************************************** 01910015
019200                                                                  01920015
019300         10  INTER-APPL-COMM-AREA PIC X(200).                     01930015
019400     COPY RCWS012.                                                01940021
019500***************************************************************** 01950015
019600*    SPECIFIC COMMMAREA FOR RCKCS276.                             01960015
019700***************************************************************** 01970015
019800         10  ASC-SPECIFIC-COMMAREA.                               01980015
019900             15  ASC-OPER-UNT-ID.                                 01990015
020000                 20  ASC-OPER-UNT-ID-N       PIC  9(04).          02000015
020100             15  ASC-FACILITY-NAME           PIC  X(30).          02010015
020200             15  ASC-FCLTY-NME               PIC  X(30).          02020015
020300             15  ASC-PO-NBR.                                      02030015
020400                 20  ASC-PO-NBR-N            PIC  9(08).          02040015
020500             15  ASC-REC-SEQ-NBR.                                 02050015
020600                 20  ASC-REC-SEQ-NBR-N       PIC  9(04).          02060015
020700             15  ASC-PO-LINE-NBR.                                 02070015
020800                 20  ASC-PO-LINE-NBR-N       PIC  9(04).          02080015
020900             15  ASC-STORE-NBR.                                   02090015
021000                 20  ASC-STORE-NBR-N         PIC  9(04).          02100031
021100             15  ASC-PACKAGE-TYP-IND         PIC  X(03).          02110017
021200                 88  ASC-PACK-BY-STORE         VALUE 'PBS'.       02120017
021300                 88  ASC-BULK                  VALUE 'BLK'.       02130017
021400                 88  ASC-PREPACK               VALUE 'PRE'.       02140017
021500             15  ASC-PREPACK-B4-CONVERSION   PIC  X(01).          02150016
021600                 88  ASC-OLD-PREPACK           VALUE 'O'.         02160016
021700                 88  ASC-NEW-PREPACK           VALUE 'N'.         02170016
021800             15  ASC-HOLD-INTER-APPL         PIC  X(200).         02180015
021900         10  FILLER                          PIC  X(196).         02190017
022000/                                                                 02200015
022100*----------------------------------------------------------------*02210015
022200*    ABEND PROCESSING COPYBOOK.                                  *02220015
022300*----------------------------------------------------------------*02230015
022400                                                                  02240015
022500     COPY DPWS013.                                                02250021
022600                                                                  02260015
022700***************************************************************** 02270021
022800*   RCWS040 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 02280021
022900*             AUTOVERIFY (AUTOVE) ELIGIBILITY MODULE (RCKUT127).* 02290021
023000***************************************************************** 02300021
023100     COPY RCWS040.                                                02310021
023200/                                                                 02320021
023300*---------------------------------------------------------------* 02330015
023400*    XLT_LOC DATABASE                                           * 02340039
023500*---------------------------------------------------------------* 02350015
023600     EXEC SQL                                                     02360015
023700          INCLUDE XLT00010                                        02370039
023800     END-EXEC.                                                    02380015
023900                                                                  02390039
024000*---------------------------------------------------------------* 02400039
024100*    DB2 AREA FOR RECEIPT HEADER TABLE                          * 02410039
024200*---------------------------------------------------------------* 02420039
024300     EXEC SQL                                                     02430039
024400          INCLUDE TRECEIV                                         02440039
024500     END-EXEC.                                                    02450039
024600                                                                  02460042
024700*---------------------------------------------------------------* 02470016
024800*    DB2 AREA FOR RECEIPT ITEM TABLE                            * 02480016
024900*---------------------------------------------------------------* 02490016
025000     EXEC SQL                                                     02500016
025100          INCLUDE TRECITM                                         02510016
025200     END-EXEC.                                                    02520016
025300                                                                  02530042
025400******************************************************************02540016
025500*  SQL AND COBOL DECLARATIONS FOR THE KOHLS/RETEK PARMS (TKRPRPM) 02550016
025600******************************************************************02560016
025700     EXEC SQL                                                     02570016
025800          INCLUDE TKRPRPM                                         02580016
025900     END-EXEC.                                                    02590016
026000                                                                  02600016
026100******************************************************************02610041
026200*  WORK ORDER INSTRUCTIONS                                        02620041
026300******************************************************************02630041
026400     EXEC SQL                                                     02640041
026500          INCLUDE TWKORIN                                         02650041
026600     END-EXEC.                                                    02660041
026700                                                                  02670041
026800******************************************************************02680041
026900*  WORK ORDER                                                     02690041
027000******************************************************************02700041
027100     EXEC SQL                                                     02710041
027200          INCLUDE TWRKORD                                         02720041
027300     END-EXEC.                                                    02730041
027400                                                                  02740041
027500******************************************************************02750041
027600*  OPERSET TABLE                                                  02760041
027700******************************************************************02770041
027800     EXEC SQL                                                     02780041
027900          INCLUDE TOSOPFA                                         02790041
028000     END-EXEC.                                                    02800041
028100                                                                  02810041
028200******************************************************************02820041
028300*  COMPANY CONTROL TABLE                                          02830041
028400******************************************************************02840041
028500     EXEC SQL                                                     02850041
028600          INCLUDE TCOCNTL                                         02860041
028700     END-EXEC.                                                    02870041
028800                                                                  02880041
028900*----------------------------------------------------------------*02890015
029000*    DB2 AREA FOR COMMUNICATIONS                                 *02900015
029100*----------------------------------------------------------------*02910015
029200                                                                  02920015
029300     EXEC SQL                                                     02930015
029400         INCLUDE SQLCA                                            02940015
029500     END-EXEC.                                                    02950015
029600                                                                  02960015
029700                                                                  02970015
029800 EJECT                                                            02980015
029900 LINKAGE SECTION.                                                 02990015
030000                                                                  03000015
030100 01  DFHCOMMAREA.                                                 03010015
030200     05  FILLER                         OCCURS  1 TO 4072 TIMES   03020015
030300                                        DEPENDING ON EIBCALEN.    03030015
030400         10  FILLER                     PIC X.                    03040015
030500                                                                  03050015
030600                                                                  03060015
030700 PROCEDURE DIVISION.                                              03070015
030800***************************************************************** 03080015
030900** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03090015
031000** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03100015
031100** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03110015
031200**                                                             ** 03120015
031300** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03130015
031400** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03140015
031500***************************************************************** 03150015
031600                                                                  03160015
031700 0000-MAIN-MODULE.                                                03170015
031800                                                                  03180015
031900     INITIALIZE DP030-CICS-API-FIELDS.                            03190015
032000                                                                  03200015
032100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03210015
032200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03220015
032300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03230015
032400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03240015
032500     MOVE LENGTH OF RC276AI        TO DP030-MAP-LENGTH (1).       03250015
032600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03260015
032700     PERFORM 0001-CALL-CICS-ARCH-API.                             03270015
032800                                                                  03280015
032900     PERFORM 1000-CONTROL-PROCESSING                              03290015
033000                                                                  03300015
033100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03310015
033200     PERFORM 0001-CALL-CICS-ARCH-API.                             03320015
033300                                                                  03330015
033400 0001-CALL-CICS-ARCH-API.                                         03340015
033500                                                                  03350015
033610     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03361062
033700                                    DFHCOMMAREA                   03370062
033800                                    DP030-CICS-API-FIELDS         03380062
033900                                    DP020-STANDARD-COMMAREA       03390062
034000                                    RC276AI.                      03400062
034100                                                                  03410015
034200     IF  DP030-RC-CALL-SUCCESSFUL                                 03420015
034300         CONTINUE                                                 03430015
034400     ELSE                                                         03440015
034500         SET DP013-NO-ROLLBACK                                    03450015
034600             DP013-XCTL-DISPLAY-RESTART                           03460015
034700             DP013-CICS-ABEND      TO TRUE                        03470015
034800         MOVE 'BEFORE 0000-MAIN-MODULE'                           03480015
034900                                   TO DP013-PARAGRAPH             03490015
034920         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O03492062
034930-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03493062
035200         MOVE DP030-RETURN-CODE                                   03520015
035300                                   TO DP013-MESSAGE-TEXT (3)      03530015
035400         PERFORM DP013-0000-PROCESS-ABEND                         03540015
035500     END-IF.                                                      03550015
035600 EJECT                                                            03560015
035700*----------------------------------------------------------------*03570015
035800*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03580015
035900*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03590015
036000*----------------------------------------------------------------*03600015
036100                                                                  03610015
036200 1000-CONTROL-PROCESSING.                                         03620015
036300                                                                  03630015
036400     EVALUATE TRUE                                                03640015
036500         WHEN DP020-NEXT-ACT-INITIAL                              03650015
036600              MOVE SPACES         TO  ASC-SPECIFIC-COMMAREA       03660015
036700              PERFORM 4000-BUILD-INITIAL-PANEL                    03670015
036800                                                                  03680015
036900         WHEN DP020-NEXT-ACT-READ-MAP                             03690015
037000              PERFORM 2000-PROCESS-PANEL                          03700015
037100                                                                  03710015
037200         WHEN DP020-NEXT-ACT-RETURN                               03720015
037300              MOVE ASC-HOLD-INTER-APPL                            03730015
037400                     TO INTER-APPL-COMM-AREA                      03740015
037500             IF (ASC-PO-LINE-NBR = SPACES OR ZEROES)              03750015
037600                 AND (ASC-STORE-NBR = SPACES OR ZEROES)           03760015
037700                 MOVE SPACES          TO ASC-PO-NBR               03770015
037800                                         ASC-REC-SEQ-NBR          03780015
037900                                         ASC-STORE-NBR            03790015
038000             END-IF                                               03800015
038100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03810015
038200             MOVE -1                       TO  APONBRL            03820015
038300             SET DP030-SET-CURSOR-APPL-1   TO  TRUE               03830015
038400                                                                  03840015
038500                                                                  03850015
038600         WHEN OTHER                                               03860015
038700             SET DP013-LOGIC-ABEND                                03870015
038800                 DP013-NO-ROLLBACK TO TRUE                        03880015
038900             MOVE '1000-CONTROL-PROCESSING'                       03890015
039000                                   TO  DP013-PARAGRAPH            03900015
039100             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03910015
039200                                   TO  DP013-MESSAGE-TEXT(1)      03920015
039300             MOVE DP020-NEXT-APPL-ACTIVITY                        03930015
039400                                   TO DP013-MESSAGE-TEXT(2)       03940015
039500             PERFORM DP013-0000-PROCESS-ABEND                     03950015
039600     END-EVALUATE.                                                03960015
039700                                                                  03970015
039800*----------------------------------------------------------------*03980015
039900* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*03990015
040000* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*04000015
040100* EDITS.                                                         *04010015
040200*----------------------------------------------------------------*04020015
040300                                                                  04030015
040400 2000-PROCESS-PANEL.                                              04040015
040500                                                                  04050015
040600     MOVE ASC-HOLD-INTER-APPL      TO  INTER-APPL-COMM-AREA.      04060015
040700     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      04070015
040800                                                                  04080015
040900     EVALUATE TRUE                                                04090015
041000                                                                  04100015
041100         WHEN DP020-SRC-AID = DP016-CLEAR                         04110015
041200              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  04120015
041300              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                04130015
041400                                                                  04140015
041500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04150015
041600              MOVE SPACES          TO  ASC-SPECIFIC-COMMAREA      04160015
041700              PERFORM 4000-BUILD-INITIAL-PANEL                    04170015
041800              PERFORM 3200-RESET-ATTRIBUTES                       04180015
041900                                                                  04190015
042000         WHEN OTHER                                               04200015
042100              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                04210015
042200              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  04220015
042300              IF  PS-NO-ERROR                                     04230015
042400                  SET DP030-CONTINUE-GO                           04240015
042500                                   TO  TRUE                       04250015
042600                  PERFORM 2100-CHECK-FUNCTION-KEY                 04260015
042700              ELSE                                                04270015
042800                  SET DP030-OVERRIDE-GO                           04280015
042900                                   TO  TRUE                       04290015
043000             END-IF                                               04300015
043100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04310015
043200     END-EVALUATE.                                                04320015
043300*----------------------------------------------------------------*04330015
043400*  ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED      *04340015
043500*  FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED  *04350015
043600*  FROM THE CICS ARCHITECTURE API.                               *04360015
043700*----------------------------------------------------------------*04370015
043800                                                                  04380015
043900 2100-CHECK-FUNCTION-KEY.                                         04390015
044000                                                                  04400015
044100     EVALUATE TRUE                                                04410015
044200         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 04420015
044300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04430016
044400         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              04440016
044500              PERFORM 2110-PREPARE-INTER-APPL-COMM                04450015
044600              MOVE INTER-APPL-COMM-AREA                           04460015
044700                                   TO  ASC-HOLD-INTER-APPL        04470015
044800              IF  PS-ERROR                                        04480015
044900                  SET DP030-OVERRIDE-GO                           04490015
045000                                   TO  TRUE                       04500015
045100              END-IF                                              04510015
045200                                                                  04520015
045300         WHEN DP020-SRC-AID = DP016-ENTER                         04530015
045400              CONTINUE                                            04540015
045500                                                                  04550015
045600         WHEN OTHER                                               04560015
045700              SET DP013-NO-ROLLBACK                               04570015
045800                  DP013-XCTL-DISPLAY-RESTART                      04580015
045900                  DP013-CICS-ABEND TO  TRUE                       04590015
046000              MOVE '2100-CHECK-FUNCTION-KEY'                      04600015
046100                                   TO  DP013-PARAGRAPH            04610015
046200              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     04620015
046300                                   TO  DP013-MESSAGE-TEXT (1)     04630015
046400              PERFORM DP013-0000-PROCESS-ABEND                    04640015
046500     END-EVALUATE.                                                04650015
046600                                                                  04660015
046700*----------------------------------------------------------------*04670015
046800*  MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE    *04680015
046900*  INTER-APPLICATION COMMAREA.                                   *04690015
047000*----------------------------------------------------------------*04700015
047100                                                                  04710015
047200 2110-PREPARE-INTER-APPL-COMM.                                    04720015
047300                                                                  04730015
047400     MOVE ASC-PO-NBR-N         TO DK-PO-NBR.                      04740016
047500     MOVE ASC-REC-SEQ-NBR-N    TO DK-RCVR-NBR.                    04750016
047600     MOVE ASC-OPER-UNT-ID-N    TO DK-OPER-UNT-ID.                 04760016
047700                                                                  04770016
047800     PERFORM 2160-SELECT-MIN-TRECITM.                             04780016
047900     PERFORM 3120-SELECT-PREPACK-DATE.                            04790016
048000                                                                  04800016
048100     IF  DP020-SRC-AID EQUAL DP016-PF23 OR                        04810016
048200         DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                   04820016
048300         IF  ASC-STORE-NBR-N   NOT GREATER THAN ZERO              04830015
048400             SET PS-ERROR                                         04840015
048500                 DP020-MSG-FATAL   TO TRUE                        04850015
048600             MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            04860015
048700             MOVE DP015-UNP-NUM-BRT-OFF                           04870015
048800                                   TO ASTRNBRA                    04880015
048900             MOVE DP015-RED        TO ASTRNBRC                    04890015
049000             MOVE DP015-REVERSE    TO ASTRNBRH                    04900015
049100             MOVE -1               TO ASTRNBRL                    04910015
049200             MOVE ZERO             TO AOPERL                      04920015
049300         END-IF                                                   04930015
049400     END-IF.                                                      04940015
049500                                                                  04950015
049600     IF  DP020-SRC-AID EQUAL DP016-PF22 OR                        04960015
049700         DP020-SRC-AID EQUAL DP016-PF23 OR                        04970016
049800         DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) OR                04980016
049900         DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                   04990016
050000         MOVE ZERO TO PV-DB2-COUNT                                05000015
050100         MOVE ASC-PO-NBR-N         TO DK-PO-NBR                   05010015
050200         MOVE ASC-REC-SEQ-NBR-N    TO DK-RCVR-NBR                 05020015
050300         MOVE ASC-OPER-UNT-ID-N    TO DK-OPER-UNT-ID              05030015
050400                                                                  05040015
050500         MOVE ASC-REC-SEQ-NBR-N    TO  RC012-REC-SEQ-NBR          05050015
050600         PERFORM 2150-SELECT-TRECEIV                              05060015
050700         IF PV-DB2-COUNT > ZERO                                   05070015
050800             SET PS-ERROR                                         05080015
050900                 DP020-MSG-FATAL   TO TRUE                        05090015
051000             MOVE PC-TSYMSG-01057  TO DP020-MSG-NUMBER            05100015
051100             MOVE DP015-UNP-NUM-BRT-OFF                           05110015
051200                                   TO ARCNBRA                     05120015
051300             MOVE DP015-RED        TO ARCNBRC                     05130015
051400             MOVE DP015-REVERSE    TO ARCNBRH                     05140015
051500             MOVE -1               TO ARCNBRL                     05150015
051600         ELSE                                                     05160015
051700             MOVE ZERO TO PV-DB2-COUNT                            05170015
051800             IF PV-DB2-COUNT > ZERO                               05180015
051900                 SET PS-ERROR                                     05190015
052000                     DP020-MSG-FATAL   TO TRUE                    05200015
052100                 MOVE PC-TSYMSG-01058  TO DP020-MSG-NUMBER        05210015
052200                 MOVE DP015-UNP-NUM-BRT-OFF                       05220015
052300                                       TO ARCNBRA                 05230015
052400                 MOVE DP015-RED        TO ARCNBRC                 05240015
052500                 MOVE DP015-REVERSE    TO ARCNBRH                 05250015
052600                 MOVE -1               TO ARCNBRL                 05260015
052700             END-IF                                               05270015
052800         END-IF                                                   05280015
052900     END-IF.                                                      05290015
053000                                                                  05300015
053100     IF DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                       05310019
053200         IF ASC-PREPACK AND                                       05320019
053300            ASC-NEW-PREPACK                                       05330019
053400             SET PS-ERROR                                         05340019
053500                 DP020-MSG-FATAL   TO TRUE                        05350019
053600             MOVE PC-TSYMSG-03079  TO DP020-MSG-NUMBER            05360019
053700             MOVE DP015-UNP-NUM-BRT-OFF                           05370019
053800                                   TO ASTRNBRA                    05380019
053900             MOVE DP015-RED        TO ASTRNBRC                    05390019
054000             MOVE DP015-REVERSE    TO ASTRNBRH                    05400019
054100             MOVE -1               TO ASTRNBRL                    05410019
054200             MOVE ZERO             TO AOPERL                      05420019
054300         END-IF                                                   05430019
054400     END-IF.                                                      05440016
054500                                                                  05450016
054600     IF (DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) OR                05460016
054700         DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID) )                 05470019
054800         IF ASC-PREPACK AND                                       05480019
054900            ASC-OLD-PREPACK                                       05490019
055000             SET PS-ERROR                                         05500019
055100                 DP020-MSG-FATAL   TO TRUE                        05510019
055200             MOVE PC-TSYMSG-03076  TO DP020-MSG-NUMBER            05520019
055300             MOVE DP015-UNP-NUM-BRT-OFF                           05530019
055400                                   TO ASTRNBRA                    05540019
055500             MOVE DP015-RED        TO ASTRNBRC                    05550019
055600             MOVE DP015-REVERSE    TO ASTRNBRH                    05560019
055700             MOVE -1               TO ASTRNBRL                    05570019
055800             MOVE ZERO             TO AOPERL                      05580019
055900         ELSE                                                     05590019
056000             IF NOT ASC-PREPACK                                   05600019
056100                 SET PS-ERROR                                     05610019
056200                     DP020-MSG-FATAL   TO TRUE                    05620019
056300                 MOVE PC-TSYMSG-03080  TO DP020-MSG-NUMBER        05630019
056400                 MOVE DP015-UNP-NUM-BRT-OFF                       05640019
056500                                       TO ASTRNBRA                05650019
056600                 MOVE DP015-RED        TO ASTRNBRC                05660019
056700                 MOVE DP015-REVERSE    TO ASTRNBRH                05670019
056800                 MOVE -1               TO ASTRNBRL                05680019
056900                 MOVE ZERO             TO AOPERL                  05690019
057000             END-IF                                               05700019
057100         END-IF                                                   05710019
057200     END-IF.                                                      05720016
057300                                                                  05730016
057400     MOVE ASC-OPER-UNT-ID-N        TO  RC012-OPER-UNT-ID.         05740015
057500     MOVE 1                        TO  RC012-FCLTY-ID.            05750032
057600     MOVE ASC-FACILITY-NAME        TO  RC012-FCLTY-NME.           05760015
057700     MOVE ASC-PO-NBR-N             TO  RC012-PO-NBR.              05770015
057800                                                                  05780015
057900     MOVE ASC-REC-SEQ-NBR-N        TO  RC012-REC-SEQ-NBR.         05790015
058000     MOVE ASC-PO-LINE-NBR-N        TO  RC012-PO-LNE-NBR.          05800015
058100     MOVE ASC-STORE-NBR-N          TO  RC012-STR-NBR.             05810015
058200                                                                  05820015
058300 2150-SELECT-TRECEIV.                                             05830015
058400                                                                  05840015
058500         EXEC SQL                                                 05850015
058600              SELECT COUNT(*)                                     05860015
058700                INTO :PV-DB2-COUNT :PV-NULL-IND                   05870015
058800                FROM TRECEIV                                      05880015
058900               WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID             05890015
059000                 AND ORD_NBR        = :DK-PO-NBR                  05900015
059100                 AND REC_SEQ_NBR    = :DK-RCVR-NBR                05910015
059200                 AND VER_STATUS_CDE = 'A'                         05920015
059300                 AND REC_TMST       = :PC-DEFAULT-TMST            05930015
059400         END-EXEC.                                                05940015
059500                                                                  05950015
059600         EVALUATE TRUE                                            05960015
059700             WHEN SQLCODE = +0                                    05970015
059800             WHEN SQLCODE = +100                                  05980015
059900                  CONTINUE                                        05990015
060000             WHEN SQLCODE = -904                                  06000015
060100             WHEN SQLCODE = -911                                  06010015
060200             WHEN SQLCODE = -913                                  06020015
060300                  PERFORM 9900-SOFT-ABORT                         06030015
060400                                                                  06040015
060500             WHEN SQLWARN0 NOT = SPACES                           06050015
060600             WHEN SQLCODE < +0                                    06060015
060700             WHEN SQLCODE > +0                                    06070015
060800                  MOVE '2150-SELECT-TRECEIV'                      06080015
060900                                  TO DP013-PARAGRAPH              06090015
061000                  MOVE 'UNSUCCESSFUL SELECT ON TRECEIV  '         06100015
061100                                  TO DP013-MESSAGE-TEXT (1)       06110015
061200                  MOVE SQLCA      TO DP013-SQLCA                  06120015
061300                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     06130015
061400                  SET DP013-DB2-ABEND                             06140015
061500                      DP013-XCTL-DISPLAY-RESTART                  06150015
061600                                  TO TRUE                         06160015
061700                  PERFORM DP013-0000-PROCESS-ABEND                06170015
061800         END-EVALUATE.                                            06180015
061900                                                                  06190016
062000 2160-SELECT-MIN-TRECITM.                                         06200016
062100                                                                  06210016
062200     EXEC SQL                                                     06220016
062300          SELECT DISTINCT                                         06230016
062400                MIN (LAST_TRSCP_TMST)                             06240016
062500          INTO                                                    06250016
062600                :RECITM-LAST-TRSCP-TMST                           06260016
062700          FROM                                                    06270016
062800                TRECITM                                           06280016
062900          WHERE                                                   06290016
063000                ORD_NBR            =  :DK-PO-NBR                  06300016
063100          AND   REC_SEQ_NBR        =  :DK-RCVR-NBR                06310016
063200          AND   OPER_UNT_ID        =  :DK-OPER-UNT-ID             06320016
063300          AND   VER_STATUS_CDE     =  'A'                         06330016
063400     END-EXEC.                                                    06340016
063500                                                                  06350016
063600     EVALUATE TRUE                                                06360016
063700         WHEN SQLCODE = ZERO                                      06370016
063800         WHEN SQLCODE = +100                                      06380016
063900              CONTINUE                                            06390016
064000         WHEN SQLCODE = -904                                      06400016
064100         WHEN SQLCODE = -911                                      06410016
064200         WHEN SQLCODE = -913                                      06420016
064300              PERFORM 9900-SOFT-ABORT                             06430016
064400         WHEN SQLWARN0 NOT = SPACE                                06440016
064500         WHEN SQLCODE NOT = ZERO                                  06450016
064600              MOVE '2160-SELECT-MIN-TRECITM'                      06460016
064700                               TO DP013-PARAGRAPH                 06470016
064800              MOVE 'SELECT MAX LAST-TRSCP-TMST ROW'               06480016
064900                               TO DP013-MESSAGE-TEXT (1)          06490016
065000              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             06500016
065100              MOVE DK-RCVR-NBR      TO PV-DISP-REC-SEQ-NBR        06510016
065200              MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID        06520016
065300              STRING ' PO = '                                     06530016
065400                     PV-DISP-PO-NBR                               06540016
065500                     ' RECV ='                                    06550016
065600                     PV-DISP-REC-SEQ-NBR                          06560016
065700                     ' OPER ='                                    06570016
065800                     PV-DISP-OPER-UNT-ID                          06580016
065900                                         DELIMITED BY SIZE        06590016
066000                              INTO DP013-MESSAGE-TEXT (2)         06600016
066100              MOVE SQLCA        TO DP013-SQLCA                    06610016
066200              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        06620016
066300              MOVE SQLCA       TO DP013-SQLCA                     06630016
066400              SET DP013-DB2-ABEND                                 06640016
066500                               TO TRUE                            06650016
066600              PERFORM DP013-0000-PROCESS-ABEND                    06660016
066700     END-EVALUATE.                                                06670016
066800/                                                                 06680015
066900*----------------------------------------------------------------*06690015
067000* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*06700015
067100* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *06710015
067200* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *06720015
067300*----------------------------------------------------------------*06730015
067400                                                                  06740015
067500 2200-MOVE-SCREEN-TO-COMMAREA.                                    06750015
067600                                                                  06760015
067700     IF  AOPERL > ZERO                                            06770015
067800         MOVE AOPERI               TO ASC-OPER-UNT-ID             06780015
067900     ELSE                                                         06790015
068000         IF  AOPERF = DP015-ERASE-EOF                             06800015
068100             MOVE SPACES           TO ASC-OPER-UNT-ID             06810015
068200         END-IF                                                   06820015
068300     END-IF.                                                      06830015
068400                                                                  06840015
068500     IF  APONBRL > ZERO                                           06850015
068600         MOVE APONBRI              TO  ASC-PO-NBR                 06860015
068700     ELSE                                                         06870015
068800         IF  APONBRF = DP015-ERASE-EOF                            06880015
068900             MOVE SPACES           TO  ASC-PO-NBR                 06890015
069000         END-IF                                                   06900015
069100     END-IF.                                                      06910015
069200                                                                  06920015
069300     IF  ARCNBRL  > ZERO                                          06930015
069400         MOVE ARCNBRI              TO ASC-REC-SEQ-NBR             06940015
069500     ELSE                                                         06950015
069600         IF  ARCNBRF  = DP015-ERASE-EOF                           06960015
069700             MOVE SPACES           TO ASC-REC-SEQ-NBR             06970015
069800         END-IF                                                   06980015
069900     END-IF.                                                      06990015
070000                                                                  07000015
070100     IF  APOLNBRL > ZERO                                          07010015
070200         MOVE APOLNBRI             TO ASC-PO-LINE-NBR             07020015
070300     ELSE                                                         07030015
070400         IF  APOLNBRF = DP015-ERASE-EOF                           07040015
070500             MOVE SPACES           TO ASC-PO-LINE-NBR             07050015
070600         END-IF                                                   07060015
070700     END-IF.                                                      07070015
070800                                                                  07080015
070900     IF  ASTRNBRL > ZERO                                          07090015
071000         MOVE ASTRNBRI             TO ASC-STORE-NBR               07100015
071100     ELSE                                                         07110015
071200         IF  ASTRNBRF = DP015-ERASE-EOF                           07120015
071300             MOVE SPACES           TO ASC-STORE-NBR               07130015
071400         END-IF                                                   07140015
071500     END-IF.                                                      07150015
071600                                                                  07160015
071700*----------------------------------------------------------------*07170015
071800* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *07180015
071900* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *07190015
072000* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*07200015
072100* IN THE DESTINATION PROGRAM, NOT HERE.                          *07210015
072200*----------------------------------------------------------------*07220015
072300                                                                  07230015
072400 3000-EDIT-DATA-IN-COMMAREA.                                      07240015
072500                                                                  07250015
072600     PERFORM 3200-RESET-ATTRIBUTES.                               07260015
072700     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07270015
072800                                                                  07280015
072900     IF  ASC-STORE-NBR GREATER THAN SPACES                        07290015
073000         MOVE ASC-STORE-NBR        TO DP010I-UNEDITED-FIELD       07300015
073100         MOVE LENGTH OF ASC-STORE-NBR                             07310015
073200                                   TO DP010I-MAXIMUM-DIGITS       07320015
073300         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     07330015
073400         SET DP010I-NEGATIVE-NOT-ALLOWED                          07340015
073500                                   TO TRUE                        07350015
073610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07361061
073620              USING DP010I-NUMERIC-EDIT-AREA                      07362061
073700                                                                  07370015
073800         IF  DP010I-ERROR-DETECTED                                07380015
073900             SET PS-ERROR                                         07390015
074000                 DP020-MSG-FATAL   TO TRUE                        07400015
074100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07410015
074200             MOVE DP015-UNP-NUM-BRT-OFF                           07420015
074300                                   TO ASTRNBRA                    07430015
074400             MOVE DP015-RED        TO ASTRNBRC                    07440015
074500             MOVE DP015-REVERSE    TO ASTRNBRH                    07450015
074600             MOVE -1               TO ASTRNBRL                    07460015
074700         ELSE                                                     07470015
074800             MOVE DP010I-NUMERIC-FIELD                            07480015
074900                                   TO ASC-STORE-NBR-N             07490015
075000         END-IF                                                   07500015
075100     END-IF.                                                      07510015
075200                                                                  07520015
075300     IF  ASC-PO-LINE-NBR GREATER THAN SPACES                      07530015
075400         MOVE ASC-PO-LINE-NBR      TO DP010I-UNEDITED-FIELD       07540015
075500         MOVE LENGTH OF ASC-PO-LINE-NBR                           07550015
075600                                   TO DP010I-MAXIMUM-DIGITS       07560015
075700         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     07570015
075800         SET DP010I-NEGATIVE-NOT-ALLOWED                          07580015
075900                                   TO TRUE                        07590015
076010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07601061
076020              USING DP010I-NUMERIC-EDIT-AREA                      07602061
076100                                                                  07610015
076200         IF  DP010I-ERROR-DETECTED                                07620015
076300             SET PS-ERROR                                         07630015
076400                 DP020-MSG-FATAL   TO TRUE                        07640015
076500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07650015
076600             MOVE DP015-UNP-NUM-BRT-OFF                           07660015
076700                                   TO APOLNBRA                    07670015
076800             MOVE DP015-RED        TO APOLNBRC                    07680015
076900             MOVE DP015-REVERSE    TO APOLNBRH                    07690015
077000             MOVE -1               TO APOLNBRL                    07700015
077100         ELSE                                                     07710015
077200             MOVE DP010I-NUMERIC-FIELD                            07720015
077300                                   TO ASC-PO-LINE-NBR-N           07730015
077400         END-IF                                                   07740015
077500     END-IF.                                                      07750015
077600                                                                  07760015
077700     IF  ASC-REC-SEQ-NBR > SPACES                                 07770015
077800         MOVE ASC-REC-SEQ-NBR      TO DP010I-UNEDITED-FIELD       07780015
077900         MOVE LENGTH OF ASC-REC-SEQ-NBR                           07790015
078000                                   TO DP010I-MAXIMUM-DIGITS       07800015
078100         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     07810015
078200         SET DP010I-NEGATIVE-NOT-ALLOWED                          07820015
078300                                   TO TRUE                        07830015
078410         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07841061
078420              USING DP010I-NUMERIC-EDIT-AREA                      07842061
078500                                                                  07850015
078600         IF  DP010I-ERROR-DETECTED                                07860015
078700             SET PS-ERROR                                         07870015
078800                 DP020-MSG-FATAL   TO TRUE                        07880015
078900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07890015
079000             MOVE DP015-UNP-NUM-BRT-OFF                           07900015
079100                                   TO ARCNBRA                     07910015
079200             MOVE DP015-RED        TO ARCNBRC                     07920015
079300             MOVE DP015-REVERSE    TO ARCNBRH                     07930015
079400             MOVE -1               TO ARCNBRL                     07940015
079500         ELSE                                                     07950015
079600             MOVE DP010I-NUMERIC-FIELD                            07960015
079700                                   TO ASC-REC-SEQ-NBR-N           07970015
079800         END-IF                                                   07980015
079900     ELSE                                                         07990015
080000         SET PS-ERROR                                             08000015
080100             DP020-MSG-FATAL       TO TRUE                        08010015
080200         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            08020015
080300         MOVE DP015-UNP-NUM-BRT-OFF                               08030015
080400                                   TO ARCNBRA                     08040015
080500         MOVE DP015-RED            TO ARCNBRC                     08050015
080600         MOVE DP015-REVERSE        TO ARCNBRH                     08060015
080700         MOVE -1                   TO ARCNBRL                     08070015
080800     END-IF.                                                      08080015
080900                                                                  08090015
081000     IF  ASC-PO-NBR > SPACES                                      08100015
081100         MOVE ASC-PO-NBR           TO DP010I-UNEDITED-FIELD       08110015
081200         MOVE LENGTH OF ASC-PO-NBR TO DP010I-MAXIMUM-DIGITS       08120015
081300         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08130015
081400         SET DP010I-NEGATIVE-NOT-ALLOWED                          08140015
081500                                   TO TRUE                        08150015
081610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08161061
081620              USING DP010I-NUMERIC-EDIT-AREA                      08162061
081700                                                                  08170015
081800         IF  DP010I-ERROR-DETECTED                                08180015
081900             SET PS-ERROR                                         08190015
082000                 DP020-MSG-FATAL   TO TRUE                        08200015
082100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08210015
082200             MOVE DP015-UNP-NUM-BRT-OFF                           08220015
082300                                   TO APONBRA                     08230015
082400             MOVE DP015-RED        TO APONBRC                     08240015
082500             MOVE DP015-REVERSE    TO APONBRH                     08250015
082600             MOVE -1               TO APONBRL                     08260015
082700         ELSE                                                     08270015
082800             MOVE DP010I-NUMERIC-FIELD                            08280015
082900                                   TO ASC-PO-NBR-N                08290015
083000         END-IF                                                   08300015
083100     ELSE                                                         08310015
083200         SET PS-ERROR                                             08320015
083300         DP020-MSG-FATAL           TO TRUE                        08330015
083400         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            08340015
083500         MOVE DP015-UNP-NUM-BRT-OFF                               08350015
083600                                   TO APONBRA                     08360015
083700         MOVE DP015-RED            TO APONBRC                     08370015
083800         MOVE DP015-REVERSE        TO APONBRH                     08380015
083900         MOVE -1                   TO APONBRL                     08390015
084000     END-IF.                                                      08400015
084100                                                                  08410015
084200                                                                  08420015
084300     IF  ASC-OPER-UNT-ID > SPACES                                 08430015
084400         MOVE ASC-OPER-UNT-ID      TO DP010I-UNEDITED-FIELD       08440015
084500         MOVE LENGTH OF ASC-OPER-UNT-ID                           08450015
084600                                   TO DP010I-MAXIMUM-DIGITS       08460015
084700         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08470015
084800         SET DP010I-NEGATIVE-NOT-ALLOWED                          08480015
084900                                   TO TRUE                        08490015
085010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08501061
085020              USING DP010I-NUMERIC-EDIT-AREA                      08502061
085100                                                                  08510015
085200         IF  DP010I-ERROR-DETECTED                                08520015
085300             SET PS-ERROR                                         08530015
085400                 DP020-MSG-FATAL   TO TRUE                        08540015
085500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08550015
085600             MOVE DP015-UNP-NUM-BRT-OFF                           08560015
085700                                   TO AOPERA                      08570015
085800             MOVE DP015-RED        TO AOPERC                      08580015
085900             MOVE DP015-REVERSE    TO AOPERH                      08590015
086000             MOVE -1               TO AOPERL                      08600015
086100             SET DP030-SET-CURSOR-APPL-1                          08610015
086200                                   TO TRUE                        08620015
086300         ELSE                                                     08630015
086400             MOVE DP010I-NUMERIC-FIELD                            08640015
086500                                   TO ASC-OPER-UNT-ID-N           08650015
086600         END-IF                                                   08660015
086700     ELSE                                                         08670015
086800         SET PS-ERROR                                             08680015
086900             DP020-MSG-FATAL       TO TRUE                        08690015
087000         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            08700015
087100         MOVE DP015-UNP-NUM-BRT-OFF                               08710015
087200                                   TO AOPERA                      08720015
087300         MOVE DP015-RED            TO AOPERC                      08730015
087400         MOVE DP015-REVERSE        TO AOPERH                      08740015
087500         MOVE -1                   TO AOPERL                      08750015
087600     END-IF.                                                      08760015
087700                                                                  08770015
087800     IF (AOPERC  EQUAL DP015-RED)                                 08780032
087900         CONTINUE                                                 08790015
088000     ELSE                                                         08800015
088100         PERFORM 3100-VALIDATE-OPER-FCLTY                         08810015
088200     END-IF.                                                      08820017
088300                                                                  08830017
088400     IF  PS-NO-ERROR                                              08840017
088500         MOVE ASC-PO-NBR-N         TO DK-PO-NBR                   08850017
088600         MOVE ASC-REC-SEQ-NBR-N    TO DK-RCVR-NBR                 08860017
088700         MOVE ASC-OPER-UNT-ID-N    TO DK-OPER-UNT-ID              08870017
088800                                                                  08880017
088900         PERFORM 3050-SELECT-TRECEIV                              08890017
089000         IF SQLCODE = +100                                        08900017
089100             MOVE SPACES           TO APKGTYPO                    08910017
089200             SET PS-ERROR                                         08920019
089300                 DP020-MSG-FATAL   TO TRUE                        08930019
089400             MOVE PC-TSYMSG-00954  TO DP020-MSG-NUMBER            08940019
089500             MOVE DP015-UNP-NUM-BRT-OFF                           08950019
089600                                   TO APONBRA                     08960019
089700                                      ARCNBRA                     08970019
089800             MOVE DP015-RED        TO APONBRC                     08980019
089900                                      ARCNBRC                     08990019
090000             MOVE DP015-REVERSE    TO APONBRH                     09000019
090100                                      ARCNBRH                     09010019
090200             MOVE -1               TO APONBRL                     09020019
090300         ELSE                                                     09030017
090400             IF RECEIV-PACK-BY-ST-IND = 'Y'                       09040017
090500                 MOVE '(PBS)'          TO APKGTYPO                09050017
090600                 SET ASC-PACK-BY-STORE TO TRUE                    09060017
090700             ELSE                                                 09070017
090800             IF RECEIV-PKGNG-CDE = 'M'                            09080020
090900                 MOVE '(MULTI)'        TO APKGTYPO                09090020
091000                 SET ASC-PREPACK TO TRUE                          09100020
091100             ELSE                                                 09110020
091200             IF RECEIV-PKGNG-CDE = 'I'                            09120020
091300                 MOVE '(INNER)'        TO APKGTYPO                09130020
091400                 SET ASC-PREPACK TO TRUE                          09140020
091500             ELSE                                                 09150020
091600             IF RECEIV-PKGNG-CDE = 'B'                            09160020
091700                 MOVE '(BULK)'         TO APKGTYPO                09170020
091800                 SET ASC-BULK    TO TRUE                          09180020
091900             ELSE                                                 09190020
092000             IF RECEIV-PKGNG-CDE = 'C'                            09200020
092100                 MOVE '(CASE)'         TO APKGTYPO                09210020
092200                 SET ASC-BULK    TO TRUE                          09220020
092300             ELSE                                                 09230020
092400             IF RECEIV-PKGNG-CDE = 'S'                            09240020
092500                 MOVE '(SINGLE)'       TO APKGTYPO                09250020
092600                 SET ASC-BULK    TO TRUE                          09260020
092700             ELSE                                                 09270020
092800                 MOVE '(BULK)'         TO APKGTYPO                09280020
092900                 SET ASC-BULK    TO TRUE                          09290020
093000             END-IF                                               09300020
093100             END-IF                                               09310020
093200             END-IF                                               09320020
093300             END-IF                                               09330020
093400             END-IF                                               09340020
093500             END-IF                                               09350017
093600         END-IF                                                   09360017
093700     END-IF.                                                      09370015
093800                                                                  09380015
093900     IF  PS-NO-ERROR                                              09390015
094000         MOVE -1                   TO APONBRL                     09400015
094100     END-IF.                                                      09410015
094200                                                                  09420015
094300     IF  PS-NO-ERROR  AND                                         09430028
094400         (DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)  OR              09440028
094500          DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)  OR              09450028
094600          DP020-FK-LOCAL-GOTO (DP020-SRC-AID))                    09460028
094700         PERFORM 3020-CALL-AUTOVE-MODULE                          09470025
094800         IF RC040-AUTO-VE-NO                                      09480059
094900            CONTINUE                                              09490021
095000         ELSE                                                     09500036
095100                                                                  09510036
095200* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 09520036
095300* ISSUE AT EFC'S OVER VERIFYING WMOS-IF EFC ORDER ALLOW SELECT  * 09530036
095400* ASSOCIATES TO CREATE POST VERIFICATION ADJUSTMENTS            * 09540036
095500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 09550036
095600* DMH - 11-29-11 - BEGIN                                          09560036
095700             PERFORM 3025-RACF-OVERRIDE                           09570044
095800             SET  PS-HAS-WORK-ORDER-INST-NO TO TRUE               09580044
095900             IF  PS-RACF-OVERRIDE-YES                             09590036
096000                 PERFORM 3030-CHECK-EFC-CURR-OPER                 09600036
096100             END-IF                                               09610036
096200             IF  PS-RACF-OVERRIDE-YES  AND                        09620036
096300                 PS-CURR-OPER-EFC-YES                             09630036
096400                 IF  PS-HAS-WORK-ORDER-INST                       09640041
096500                     CONTINUE                                     09650041
096600                 ELSE                                             09660041
096700                     SET PS-ERROR                                 09670041
096800                         DP020-MSG-FATAL   TO TRUE                09680041
096900                     MOVE PC-TSYMSG-03706  TO DP020-MSG-NUMBER    09690041
097000                 END-IF                                           09700041
097100             ELSE                                                 09710036
097200* DMH - 11-29-11 - END                                            09720036
097300                                                                  09730036
097400                 SET PS-ERROR                                     09740036
097500                     DP020-MSG-FATAL   TO TRUE                    09750036
097600                 MOVE PC-TSYMSG-03179  TO DP020-MSG-NUMBER        09760036
097700             END-IF                                               09770036
097800         END-IF                                                   09780036
097900     END-IF.                                                      09790036
098000                                                                  09800036
098100*----------------------------------------------------------------*09810021
098200*    CALL TO (AUTOVE) AUTOVERIFICATION MODULE (RCKUT127)          09820025
098300*----------------------------------------------------------------*09830021
098400 3020-CALL-AUTOVE-MODULE.                                         09840025
098500                                                                  09850021
098600     INITIALIZE RC040-FIELDS.                                     09860025
098700     MOVE ASC-OPER-UNT-ID-N  TO RC040-SIGNON-LOCATION.            09870034
098800     MOVE DK-PO-NBR          TO RC040-PO-NBR                      09880029
098900     MOVE DK-RCVR-NBR        TO RC040-PO-RCVR                     09890029
099000     MOVE DP020-USERID       TO RC040-USER-ID.                    09900029
099100     MOVE 'RCKCS276'         TO RC040-CALLING-PROGRAM.            09910029
099200                                                                  09920021
099300     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  09930025
099400                                        RC040-COMMAREA            09940025
099500                                        RC040-FIELDS.             09950025
099600                                                                  09960021
099700     EVALUATE TRUE                                                09970021
099800         WHEN RC040-SUCCESSFUL                                    09980025
099900             IF  RC040-INVALID-SQL     OR                         09990021
100000                 RC040-DATABASE-BUSY                              10000021
100100                 STRING ' RCKUT127 - '        DELIMITED BY SIZE   10010021
100200                   '3020-CALL-AUTOVE-MODULE ' DELIMITED BY SIZE   10020025
100300                        ' RETURN MESSAGE - '  DELIMITED BY SIZE   10030021
100400                        RC040-SUCCESS-IND     DELIMITED BY SIZE   10040021
100500                                         INTO PV-CICS-MSG-AREA    10050026
100600                    MOVE LENGTH OF PV-CICS-MSG-AREA               10060026
100700                                        TO PV-COMMAREA-LENGTH     10070023
100800                    EXEC CICS                                     10080023
100900                         WRITEQ TD                                10090023
101000                          QUEUE  ('CSSL')                         10100023
101100                           FROM  (PV-CICS-MSG-AREA)               10110023
101200                         LENGTH  (PV-COMMAREA-LENGTH)             10120023
101300                           RESP  (PV-CICS-RESPONSE)               10130026
101400                    END-EXEC                                      10140023
101500                    PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG        10150026
101600                    INITIALIZE PV-CICS-MSG-AREA                   10160026
101700                    MOVE RC040-CRA-RET-MSG TO PV-CICS-MSG-AREA    10170026
101800                    MOVE LENGTH OF PV-CICS-MSG-AREA               10180026
101900                                        TO PV-COMMAREA-LENGTH     10190026
102000                    EXEC CICS                                     10200023
102100                         WRITEQ TD                                10210023
102200                          QUEUE  ('CSSL')                         10220023
102300                           FROM  (PV-CICS-MSG-AREA)               10230023
102400                         LENGTH  (PV-COMMAREA-LENGTH)             10240023
102500                           RESP  (PV-CICS-RESPONSE)               10250026
102600                    END-EXEC                                      10260023
102700             END-IF                                               10270021
102800         WHEN OTHER                                               10280021
102900             STRING ' RCKUT127 (OTHER) -' DELIMITED BY SIZE       10290021
103000               '3020-CALL-AUTOVE-MODULE ' DELIMITED BY SIZE       10300025
103100                    ' RETURN MESSAGE - '  DELIMITED BY SIZE       10310021
103200                    RC040-SUCCESS-IND     DELIMITED BY SIZE       10320021
103300                                         INTO RC040-CRA-RET-MSG   10330021
103400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               10340021
103500                                                                  10350021
103600     END-EVALUATE.                                                10360021
103700                                                                  10370036
103800                                                                  10380036
103900*----------------------------------------------------------------*10390038
104000* CHECK TO SEE IF USER HAS RACF AUTHORIZATION FOR EFC POST VE    *10400038
104100*----------------------------------------------------------------*10410038
104200 3025-RACF-OVERRIDE.                                              10420036
104300                                                                  10430037
104400      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  10440037
104500      MOVE 'EFCVEADJ'                    TO DP008-FUNCTION-NAME   10450037
104600      SET DP008-ACCESS-TYPE-USE          TO TRUE                  10460037
104700                                                                  10470037
104800      EXEC CICS                                                   10480037
104900         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 10490037
105000              COMMAREA (DP008-SECURITY-COMMAREA)                  10500037
105100              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             10510037
105200      END-EXEC                                                    10520037
105300                                                                  10530037
105400      IF DP008-CALL-SUCCESSFUL                                    10540037
105500         IF DP008-ACCESS-ALLOWED                                  10550037
105600             SET PS-RACF-OVERRIDE-YES  TO  TRUE                   10560037
105700         ELSE                                                     10570037
105800             SET PS-RACF-OVERRIDE-NO   TO TRUE                    10580037
105900         END-IF                                                   10590037
106000     ELSE                                                         10600037
106100             SET PS-RACF-OVERRIDE-NO   TO TRUE                    10610038
106200      END-IF.                                                     10620037
106300                                                                  10630036
106400                                                                  10640036
106500*----------------------------------------------------------------*10650038
106600* CHECK TO SEE CURR OPER ON RECEIVER IS FOR EFC                  *10660038
106700*----------------------------------------------------------------*10670038
106800 3030-CHECK-EFC-CURR-OPER.                                        10680036
106900                                                                  10690038
107000         EXEC SQL                                                 10700038
107100              SELECT  B.E_BUS_IND                                 10710038
107200                    , A.CURR_OPER_UNT_ID                          10720041
107300                INTO :XLT00010-E-BUS-IND                          10730041
107400                    ,:RECEIV-CURR-OPER-UNT-ID                     10740042
107500                FROM  TRECEIV A                                   10750041
107600                    , XLT_LOC B                                   10760041
107700               WHERE  A.ORD_NBR           =  :DK-PO-NBR           10770041
107800                 AND  A.REC_SEQ_NBR       =  :DK-RCVR-NBR         10780041
107900                 AND  A.VER_STATUS_CDE    =  'A'                  10790041
108000                 AND  A.CURR_OPER_UNT_ID  =   B.LOC_NBR           10800041
108100                 AND  B.LOC_TYP_CDE       =  'DC'                 10810041
108200                 AND  B.E_BUS_IND         =  'Y'                  10820041
108300         END-EXEC.                                                10830038
108400                                                                  10840038
108500         EVALUATE TRUE                                            10850038
108600             WHEN SQLCODE = +0                                    10860038
108700                  SET  PS-CURR-OPER-EFC-YES  TO  TRUE             10870038
108800                  PERFORM 3035-CHECK-WORK-ORDER-INST              10880041
108900             WHEN SQLCODE = +100                                  10890038
109000                  SET  PS-CURR-OPER-EFC-NO   TO  TRUE             10900038
109100             WHEN SQLCODE = -904                                  10910038
109200             WHEN SQLCODE = -911                                  10920038
109300             WHEN SQLCODE = -913                                  10930038
109400                  PERFORM 9900-SOFT-ABORT                         10940038
109500                                                                  10950038
109600             WHEN SQLWARN0 NOT = SPACES                           10960038
109700             WHEN SQLCODE < +0                                    10970038
109800             WHEN SQLCODE > +0                                    10980038
109900                  MOVE '3030-CHECK-EFC-CURR-OPER'                 10990038
110000                                  TO DP013-PARAGRAPH              11000038
110100                  MOVE 'CHECK CURR OPER FOR E-BUS-IND   '         11010038
110200                                  TO DP013-MESSAGE-TEXT (1)       11020038
110300                  MOVE SQLCA      TO DP013-SQLCA                  11030038
110400                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     11040038
110500                  MOVE 'XLT00010' TO DP013-DB2-TABLE-NAME (2)     11050038
110600                  SET DP013-DB2-ABEND                             11060038
110700                      DP013-XCTL-DISPLAY-RESTART                  11070038
110800                                  TO TRUE                         11080038
110900                  PERFORM DP013-0000-PROCESS-ABEND                11090038
111000         END-EVALUATE.                                            11100038
111100                                                                  11110038
111200                                                                  11120038
111300*----------------------------------------------------------------*11130041
111400* CHECK TO SEE IF THERE ARE WORK ORDER INSTRUCTIONS              *11140041
111500*----------------------------------------------------------------*11150041
111600 3035-CHECK-WORK-ORDER-INST.                                      11160041
111700                                                                  11170041
111800         EXEC SQL                                                 11180041
111900              SELECT  COUNT(*)                                    11190041
112000                INTO :PV-WORK-ORDER-INSTR-COUNT                   11200041
112100                FROM  TWKORIN                                     11210041
112200               WHERE  ORD_NBR         = :DK-PO-NBR                11220041
112300                 AND  RCVR_SEQ_NBR    = :DK-RCVR-NBR              11230041
112400                 AND  VER_STATUS_CDE  =  'A'                      11240041
112500                                                                  11250041
112600         END-EXEC.                                                11260041
112700                                                                  11270041
112800         EVALUATE TRUE                                            11280041
112900             WHEN SQLCODE = +0                                    11290041
113000                  IF  PV-WORK-ORDER-INSTR-COUNT  > 0              11300041
113100                      SET  PS-HAS-WORK-ORDER-INST TO  TRUE        11310041
113200                  ELSE                                            11320041
113300                      PERFORM 3040-CHECK-WORK-ORDER               11330041
113400                  END-IF                                          11340041
113500                                                                  11350041
113600             WHEN SQLCODE = +100                                  11360041
113700                  PERFORM 3040-CHECK-WORK-ORDER                   11370041
113800                                                                  11380041
113900             WHEN SQLCODE = -904                                  11390041
114000             WHEN SQLCODE = -911                                  11400041
114100             WHEN SQLCODE = -913                                  11410041
114200                  PERFORM 9900-SOFT-ABORT                         11420041
114300                                                                  11430041
114400             WHEN SQLWARN0 NOT = SPACES                           11440041
114500             WHEN SQLCODE < +0                                    11450041
114600             WHEN SQLCODE > +0                                    11460041
114700                  MOVE '3035-CHECK-WORK-ORDER-INST'               11470041
114800                                  TO DP013-PARAGRAPH              11480041
114900                  MOVE 'CHECK FOR WORK ORDER INSTRUCTION'         11490041
115000                                  TO DP013-MESSAGE-TEXT (1)       11500041
115100                  MOVE SQLCA      TO DP013-SQLCA                  11510041
115200                  MOVE 'TWKORIN ' TO DP013-DB2-TABLE-NAME (1)     11520041
115300                  SET DP013-DB2-ABEND                             11530041
115400                      DP013-XCTL-DISPLAY-RESTART                  11540041
115500                                  TO TRUE                         11550041
115600                  PERFORM DP013-0000-PROCESS-ABEND                11560041
115700         END-EVALUATE.                                            11570041
115800                                                                  11580041
115900                                                                  11590041
116000*----------------------------------------------------------------*11600041
116100* CHECK TO SEE IF THERE IS A WORK ORDER                          *11610041
116200*----------------------------------------------------------------*11620041
116300 3040-CHECK-WORK-ORDER.                                           11630041
116400                                                                  11640041
116500         EXEC SQL                                                 11650041
116600              SELECT  A.OPER_SET_ID                               11660041
116700                    , DFLT_OPER_SET_ID                            11670049
116800                INTO :WRKORD-OPER-SET-ID                          11680049
116900                    ,:COCNTL-DFLT-OPER-SET-ID                     11690049
117000                FROM  TWRKORD A                                   11700049
117100                    , TCOCNTL B                                   11710049
117200               WHERE  A.ORD_NBR        = :DK-PO-NBR               11720049
117300                 AND  A.RCVR_SEQ_NBR   = :DK-RCVR-NBR             11730049
117400                 AND  A.VER_STATUS_CDE =  'A'                     11740049
117500                 AND  B.OPER_UNT_ID    = :RECEIV-CURR-OPER-UNT-ID 11750049
117600                                                                  11760041
117700         END-EXEC.                                                11770041
117800                                                                  11780041
117900         EVALUATE TRUE                                            11790041
118000             WHEN SQLCODE = +0                                    11800041
118100                  IF  WRKORD-OPER-SET-ID  >  0                    11810049
118200                      PERFORM 3045-INSERT-WORK-ORD-INST           11820049
118300                  ELSE                                            11830049
118400                      PERFORM 3042-INACTIVATE-0-WRKORD            11840049
118500                      PERFORM 3043-INSERT-TWRKORD                 11850049
118600                      PERFORM 3045-INSERT-WORK-ORD-INST           11860049
118700                  END-IF                                          11870049
118800                                                                  11880049
118900             WHEN SQLCODE = +100                                  11890049
119000                      PERFORM 3041-GET-DEFAULT-OP-SET             11900049
119100                      PERFORM 3043-INSERT-TWRKORD                 11910049
119200                      PERFORM 3045-INSERT-WORK-ORD-INST           11920049
119300                                                                  11930049
119400             WHEN SQLCODE = -904                                  11940049
119500             WHEN SQLCODE = -911                                  11950049
119600             WHEN SQLCODE = -913                                  11960049
119700                  PERFORM 9900-SOFT-ABORT                         11970049
119800                                                                  11980049
119900             WHEN SQLWARN0 NOT = SPACES                           11990049
120000             WHEN SQLCODE < +0                                    12000049
120100             WHEN SQLCODE > +0                                    12010049
120200                  MOVE '3040-CHECK-WORK-ORDER'                    12020049
120300                                  TO DP013-PARAGRAPH              12030049
120400                  MOVE 'CHECK FOR WORK ORDER '                    12040049
120500                                  TO DP013-MESSAGE-TEXT (1)       12050049
120600                  MOVE SQLCA      TO DP013-SQLCA                  12060049
120700                  MOVE 'TWRKORD ' TO DP013-DB2-TABLE-NAME (1)     12070049
120800                  SET DP013-DB2-ABEND                             12080049
120900                      DP013-XCTL-DISPLAY-RESTART                  12090049
121000                                  TO TRUE                         12100049
121100                  PERFORM DP013-0000-PROCESS-ABEND                12110049
121200         END-EVALUATE.                                            12120049
121300                                                                  12130049
121400                                                                  12140049
121500*----------------------------------------------------------------*12150049
121600* GET THE DEFAULT OP SET FROM TCOCNTL FOR WORK ORDER             *12160049
121700*----------------------------------------------------------------*12170049
121800 3041-GET-DEFAULT-OP-SET.                                         12180049
121900                                                                  12190049
122000         EXEC SQL                                                 12200049
122100              SELECT                                              12210049
122200                      DFLT_OPER_SET_ID                            12220049
122300                INTO                                              12230049
122400                     :COCNTL-DFLT-OPER-SET-ID                     12240049
122500                FROM                                              12250049
122600                      TCOCNTL B                                   12260050
122700               WHERE                                              12270049
122800                      B.OPER_UNT_ID    = :RECEIV-CURR-OPER-UNT-ID 12280049
122900         END-EXEC.                                                12290049
123000                                                                  12300049
123100         EVALUATE TRUE                                            12310049
123200             WHEN SQLCODE = +0                                    12320049
123300                  CONTINUE                                        12330049
123400                                                                  12340049
123500             WHEN SQLCODE = -904                                  12350049
123600             WHEN SQLCODE = -911                                  12360049
123700             WHEN SQLCODE = -913                                  12370049
123800                  PERFORM 9900-SOFT-ABORT                         12380049
123900                                                                  12390049
124000             WHEN SQLWARN0 NOT = SPACES                           12400049
124100             WHEN SQLCODE < +0                                    12410049
124200             WHEN SQLCODE > +0                                    12420049
124300                  MOVE '3041-GET-DEFAULT-OP-SET'                  12430049
124400                                  TO DP013-PARAGRAPH              12440049
124500                  MOVE 'DEFAULT OP SET FROM TCOCNTL'              12450049
124600                                  TO DP013-MESSAGE-TEXT (1)       12460049
124700                  MOVE SQLCA      TO DP013-SQLCA                  12470049
124800                  MOVE 'TCOCNTL ' TO DP013-DB2-TABLE-NAME (1)     12480049
124900                  SET DP013-DB2-ABEND                             12490049
125000                      DP013-XCTL-DISPLAY-RESTART                  12500049
125100                                  TO TRUE                         12510049
125200                  PERFORM DP013-0000-PROCESS-ABEND                12520049
125300         END-EVALUATE.                                            12530049
125400                                                                  12540049
125500                                                                  12550049
125600*----------------------------------------------------------------*12560049
125700* INACTIVATE 0 OPER SET ID WORK ORDER                            *12570049
125800*----------------------------------------------------------------*12580049
125900 3042-INACTIVATE-0-WRKORD.                                        12590049
126000                                                                  12600049
126100         EXEC SQL                                                 12610049
126200              UPDATE  TWRKORD                                     12620049
126300                 SET  VER_STATUS_CDE  =  'I'                      12630049
126400               WHERE  ORD_NBR         = :DK-PO-NBR                12640049
126500                 AND  RCVR_SEQ_NBR    = :DK-RCVR-NBR              12650049
126600                 AND  OPER_SET_ID     = :WRKORD-OPER-SET-ID       12660051
126700                 AND  OPER_UNT_ID     = :RECEIV-CURR-OPER-UNT-ID  12670049
126800                 AND  FCLTY_ID        =  1                        12680050
126900         END-EXEC.                                                12690049
127000                                                                  12700049
127100         EVALUATE TRUE                                            12710049
127200             WHEN SQLCODE = +0                                    12720049
127300             WHEN SQLCODE = +100                                  12730049
127400                  CONTINUE                                        12740049
127500                                                                  12750049
127600             WHEN SQLCODE = -904                                  12760049
127700             WHEN SQLCODE = -911                                  12770049
127800             WHEN SQLCODE = -913                                  12780049
127900                  PERFORM 9900-SOFT-ABORT                         12790049
128000                                                                  12800049
128100             WHEN SQLWARN0 NOT = SPACES                           12810049
128200             WHEN SQLCODE < +0                                    12820049
128300             WHEN SQLCODE > +0                                    12830049
128400                  MOVE '3042-INACTIVATE-0-WRKORD'                 12840049
128500                                  TO DP013-PARAGRAPH              12850049
128600                  MOVE 'INACTIVATE - WORKORDER'                   12860049
128700                                  TO DP013-MESSAGE-TEXT (1)       12870049
128800                  MOVE SQLCA      TO DP013-SQLCA                  12880049
128900                  MOVE 'TWRKORD ' TO DP013-DB2-TABLE-NAME (1)     12890049
129000                  SET DP013-DB2-ABEND                             12900049
129100                      DP013-XCTL-DISPLAY-RESTART                  12910049
129200                                  TO TRUE                         12920049
129300                  PERFORM DP013-0000-PROCESS-ABEND                12930049
129400         END-EVALUATE.                                            12940049
129500                                                                  12950049
129600                                                                  12960049
129700 3043-INSERT-TWRKORD.                                             12970049
129800                                                                  12980049
129900     INITIALIZE DCLTWRKORD.                                       12990049
130000                                                                  13000049
130100     MOVE RECEIV-CURR-OPER-UNT-ID  TO WRKORD-OPER-UNT-ID.         13010049
130200     MOVE COCNTL-DFLT-OPER-SET-ID  TO WRKORD-OPER-SET-ID.         13020054
130300                                                                  13030049
130400     MOVE DK-PO-NBR              TO WRKORD-ORD-NBR.               13040052
130500     MOVE DK-RCVR-NBR            TO WRKORD-RCVR-SEQ-NBR.          13050052
130600                                                                  13060049
130700     MOVE 1                      TO WRKORD-FCLTY-ID.              13070049
130800     MOVE +1                     TO WRKORD-WORK-ORD-SEQ-NBR.      13080049
130900     MOVE ZERO                   TO WRKORD-ACTL-CART-CNT.         13090049
131000     MOVE +1                     TO WRKORD-EXPTED-CART-CNT.       13100049
131100     MOVE 'A'                    TO WRKORD-VER-STATUS-CDE.        13110049
131200     MOVE 'IP'                   TO WRKORD-STAT-CDE.              13120049
131300     MOVE 'N'                    TO WRKORD-WORK-ORD-DISTR-IND.    13130049
131400                                                                  13140049
131500     PERFORM 5700-INSERT-TWRKORD.                                 13150049
131600                                                                  13160049
131700                                                                  13170049
131800*----------------------------------------------------------------*13180049
131900* INSERT WORK ORDER INSTRUCTION                                  *13190049
132000*----------------------------------------------------------------*13200049
132100 3045-INSERT-WORK-ORD-INST.                                       13210049
132200                                                                  13220049
132300     MOVE +0                     TO PV-WO-INSTR-SEQ-NBR.          13230049
132400     MOVE 'N'                    TO PS-TOSOPFA-CURSOR-SW.         13240049
132500     MOVE 'Y'                    TO PS-INSTRUCTION-SW.            13250049
132600                                                                  13260049
132700     PERFORM 5800-OPEN-TOSOPFA-CSR.                               13270049
132800     PERFORM 5820-FETCH-TOSOPFA-CSR.                              13280049
132900                                                                  13290049
133000     PERFORM UNTIL PS-EOF-TOSOPFA-CSR                             13300049
133100        PERFORM 5900-BUILD-WORK-ORDER-INSTR                       13310049
133200        PERFORM 5820-FETCH-TOSOPFA-CSR                            13320049
133300     END-PERFORM.                                                 13330049
133400                                                                  13340049
133500     PERFORM 5840-CLOSE-TOSOPFA-CSR.                              13350049
133600                                                                  13360049
133700                                                                  13370049
133800 3050-SELECT-TRECEIV.                                             13380049
133900                                                                  13390049
134000         EXEC SQL                                                 13400049
134100              SELECT PKGNG_CDE                                    13410018
134200                   , PACK_BY_ST_IND                               13420018
134300                INTO :RECEIV-PKGNG-CDE                            13430018
134400                   , :RECEIV-PACK-BY-ST-IND                       13440018
134500                FROM TRECEIV                                      13450018
134600               WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID             13460018
134700                 AND ORD_NBR        = :DK-PO-NBR                  13470018
134800                 AND REC_SEQ_NBR    = :DK-RCVR-NBR                13480018
134900                 AND VER_STATUS_CDE = 'A'                         13490018
135000         END-EXEC.                                                13500018
135100                                                                  13510018
135200         EVALUATE TRUE                                            13520018
135300             WHEN SQLCODE = +0                                    13530018
135400             WHEN SQLCODE = +100                                  13540018
135500                  CONTINUE                                        13550018
135600             WHEN SQLCODE = -904                                  13560018
135700             WHEN SQLCODE = -911                                  13570018
135800             WHEN SQLCODE = -913                                  13580018
135900                  PERFORM 9900-SOFT-ABORT                         13590018
136000                                                                  13600018
136100             WHEN SQLWARN0 NOT = SPACES                           13610018
136200             WHEN SQLCODE < +0                                    13620018
136300             WHEN SQLCODE > +0                                    13630018
136400                  MOVE '3050-SELECT-TRECEIV'                      13640018
136500                                  TO DP013-PARAGRAPH              13650018
136600                  MOVE 'UNSUCCESSFUL SELECT ON TRECEIV  '         13660018
136700                                  TO DP013-MESSAGE-TEXT (1)       13670018
136800                  MOVE SQLCA      TO DP013-SQLCA                  13680018
136900                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     13690018
137000                  SET DP013-DB2-ABEND                             13700018
137100                      DP013-XCTL-DISPLAY-RESTART                  13710018
137200                                  TO TRUE                         13720018
137300                  PERFORM DP013-0000-PROCESS-ABEND                13730018
137400         END-EVALUATE.                                            13740018
137500                                                                  13750018
137600*----------------------------------------------------------------*13760015
137700*    ENSURE THE OPER ID AND FACILITY ARE VALID.                  *13770015
137800*----------------------------------------------------------------*13780015
137900 3100-VALIDATE-OPER-FCLTY.                                        13790015
138000                                                                  13800015
138100     INITIALIZE XL071-COMMAREA-REC.                               13810033
138200     MOVE ASC-OPER-UNT-ID-N       TO  XL071-LOCATION-NUMBER.      13820033
138300                                                                  13830033
138400     CALL PC-LOCATION-MODULE  USING                               13840033
138500                                    DFHEIBLK                      13850033
138600                                    XL071-COMMAREA                13860033
138700                                    XL071-COMMAREA-REC.           13870033
138800                                                                  13880033
138900                                                                  13890015
139000     EVALUATE TRUE                                                13900015
139100         WHEN XL071-NO-ERRORS                                     13910033
139200         WHEN XL071-DC-ASGMT-NOT-FND                              13920033
139300              MOVE XL071-LOC-NM    TO ASC-FACILITY-NAME           13930033
139400                                                                  13940033
139500         WHEN XL071-LOC-NOT-FOUND                                 13950033
139600              SET PS-ERROR                                        13960015
139700                  DP020-MSG-FATAL  TO TRUE                        13970015
139800              MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER            13980015
139900              MOVE DP015-UNP-NUM-BRT-OFF                          13990015
140000                                   TO AOPERA                      14000015
140100              MOVE DP015-RED       TO AOPERC                      14010015
140200              MOVE DP015-REVERSE   TO AOPERH                      14020015
140300              MOVE -1              TO AOPERL                      14030015
140400                                                                  14040033
140500         WHEN OTHER                                               14050033
140600              INITIALIZE PV-CICS-MSG-AREA                         14060033
140700              STRING ' RCKCS276 - CALL XLTUT071 -'                14070033
140800                     ' SQLCODE=' XL071-SQLCODE                    14080033
140900                     ' TABLE='   XL071-DB2-TABLE                  14090033
141000                                              DELIMITED BY SIZE   14100033
141100                                         INTO PV-CICS-MSG-AREA    14110033
141200              MOVE LENGTH OF PV-CICS-MSG-AREA                     14120033
141300                                        TO PV-COMMAREA-LENGTH     14130033
141400              EXEC CICS                                           14140033
141500                   WRITEQ TD                                      14150033
141600                    QUEUE  ('CSSL')                               14160033
141700                     FROM  (PV-CICS-MSG-AREA)                     14170033
141800                   LENGTH  (PV-COMMAREA-LENGTH)                   14180033
141900                     RESP  (PV-CICS-RESPONSE)                     14190033
142000              END-EXEC                                            14200033
142100              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              14210033
142200              PERFORM 9900-SOFT-ABORT                             14220015
142300                                                                  14230033
142400     END-EVALUATE.                                                14240015
142500                                                                  14250015
142600***************************************************************** 14260016
142700 3120-SELECT-PREPACK-DATE.                                        14270016
142800                                                                  14280016
142900     EXEC SQL                                                     14290016
143000         SELECT FUNC_BEG_TMST                                     14300016
143100           INTO :KRPRPM-FUNC-BEG-TMST                             14310016
143200           FROM TKRPRPM                                           14320016
143300          WHERE SYS_PRC_FUNC_CDE  = 'PRPKDT'                      14330016
143400            AND LOC_ID            = 90                            14340016
143500            AND INTFC_SYS_CDE     = 'KHL'                         14350016
143600            AND FUNC_PRC_STAT_CDE = 'AC'                          14360016
143700     END-EXEC.                                                    14370016
143800                                                                  14380016
143900     EVALUATE SQLCODE                                             14390016
144000         WHEN ZERO                                                14400016
144100             IF RECITM-LAST-TRSCP-TMST                            14410016
144200                                   < KRPRPM-FUNC-BEG-TMST         14420016
144300                 SET ASC-OLD-PREPACK TO TRUE                      14430016
144400             ELSE                                                 14440016
144500                 SET ASC-NEW-PREPACK TO TRUE                      14450016
144600             END-IF                                               14460016
144700         WHEN OTHER                                               14470016
144800              MOVE '3120-SELECT-PREPACK-DATE'                     14480016
144900                               TO DP013-PARAGRAPH                 14490016
145000              MOVE 'SELECT CARTON BUILD IND'                      14500016
145100                               TO DP013-MESSAGE-TEXT (1)          14510016
145200              MOVE SQLCA       TO DP013-SQLCA                     14520016
145300              SET DP013-DB2-ABEND                                 14530016
145400                      DP013-XCTL-DISPLAY-RESTART                  14540016
145500                               TO TRUE                            14550016
145600              PERFORM DP013-0000-PROCESS-ABEND                    14560016
145700     END-EVALUATE.                                                14570016
145800                                                                  14580016
145900*----------------------------------------------------------------*14590015
146000*  MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE  *14600015
146100*  MAP.                                                          *14610015
146200*----------------------------------------------------------------*14620015
146300                                                                  14630015
146400 3200-RESET-ATTRIBUTES.                                           14640015
146500                                                                  14650015
146600     MOVE DP015-UNP-NUM-NOR-OFF   TO  AOPERA                      14660015
146700                                      APONBRA                     14670015
146800                                      ARCNBRA                     14680015
146900                                      APOLNBRA                    14690015
147000                                      ASTRNBRA.                   14700015
147100                                                                  14710015
147200     MOVE DP015-GREEN             TO  AOPERC                      14720015
147300                                      APONBRC                     14730015
147400                                      ARCNBRC                     14740015
147500                                      APOLNBRC                    14750015
147600                                      ASTRNBRC.                   14760015
147700                                                                  14770015
147800     MOVE DP015-UNDERLINE         TO  AOPERH                      14780015
147900                                      APONBRH                     14790015
148000                                      ARCNBRH                     14800015
148100                                      APOLNBRH                    14810015
148200                                      ASTRNBRH.                   14820015
148300*----------------------------------------------------------------*14830015
148400*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *14840015
148500*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *14850015
148600*  IT HERE.                                                      *14860015
148700*----------------------------------------------------------------*14870015
148800                                                                  14880015
148900 4000-BUILD-INITIAL-PANEL.                                        14890015
149000                                                                  14900015
149100     MOVE DP020-LOCATION-NBR       TO  PV-OPER-UNT-ID.            14910029
149200     MOVE PV-OPER-UNT-ID           TO  ASC-OPER-UNT-ID-N          14920029
149300                                       AOPERO.                    14930015
149400     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      14940015
149500     MOVE -1                       TO  APONBRL.                   14950015
149600                                                                  14960015
149700*----------------------------------------------------------------*14970015
149800*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *14980015
149900*----------------------------------------------------------------*14990015
150000                                                                  15000015
150100 4400-MOVE-COMMAREA-TO-SCREEN.                                    15010015
150200                                                                  15020015
150300     MOVE ASC-OPER-UNT-ID          TO  AOPERO.                    15030015
150400     MOVE ASC-FACILITY-NAME        TO  AOPNAMEO.                  15040015
150500                                                                  15050015
150600     MOVE ASC-PO-NBR-N             TO  APONBRO.                   15060015
150700     MOVE ASC-REC-SEQ-NBR-N        TO  ARCNBRO.                   15070015
150800     MOVE ASC-PO-LINE-NBR-N        TO  APOLNBRO.                  15080015
150900     MOVE ASC-STORE-NBR-N          TO  ASTRNBRO.                  15090015
151000                                                                  15100041
151100                                                                  15110041
151200*----------------------------------------------------------------*15120049
151300* INSERT WORK ORDER                                              *15130049
151400*----------------------------------------------------------------*15140049
151500 5700-INSERT-TWRKORD.                                             15150049
151600                                                                  15160049
151700     PERFORM                                                      15170049
151800         WITH TEST AFTER                                          15180049
151900         VARYING PV-RETRY-COUNTER                                 15190049
152000         FROM 1 BY 1                                              15200049
152100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15210049
152200             OR (SQLCODE = +0))                                   15220049
152300                                                                  15230049
152400         EXEC SQL                                                 15240049
152500              INSERT INTO TWRKORD                                 15250049
152600                     ( ORD_NBR                                    15260049
152700                      ,RCVR_SEQ_NBR                               15270049
152800                      ,ORD_LNE_NBR                                15280049
152900                      ,WORK_ORD_SEQ_NBR                           15290049
153000                      ,OPER_UNT_ID                                15300049
153100                      ,FCLTY_ID                                   15310049
153200                      ,CRE_TMST                                   15320049
153300                      ,VER_STATUS_CDE                             15330049
153400                      ,CRE_UID_ID                                 15340049
153500                      ,EXPTED_CART_CNT                            15350049
153600                      ,ACTL_CART_CNT                              15360049
153700                      ,EXPTED_ITM_CNT                             15370049
153800                      ,ACTL_ITM_CNT                               15380049
153900                      ,STAT_CDE                                   15390049
154000                      ,WORK_ORD_DISTR_IND                         15400049
154100                      ,OPER_SET_ID )                              15410049
154200              VALUES ( :WRKORD-ORD-NBR                            15420049
154300                      ,:WRKORD-RCVR-SEQ-NBR                       15430049
154400                      ,:WRKORD-ORD-LNE-NBR                        15440049
154500                      ,:WRKORD-WORK-ORD-SEQ-NBR                   15450049
154600                      ,:WRKORD-OPER-UNT-ID                        15460049
154700                      ,:WRKORD-FCLTY-ID                           15470049
154800                      ,CURRENT TIMESTAMP                          15480049
154900                      ,:WRKORD-VER-STATUS-CDE                     15490049
155000                      ,:DP020-USERID                              15500050
155100                      ,:WRKORD-EXPTED-CART-CNT                    15510049
155200                      ,:WRKORD-ACTL-CART-CNT                      15520049
155300                      ,:WRKORD-EXPTED-ITM-CNT                     15530049
155400                      ,:WRKORD-ACTL-ITM-CNT                       15540049
155500                      ,:WRKORD-STAT-CDE                           15550049
155600                      ,:WRKORD-WORK-ORD-DISTR-IND                 15560049
155700                      ,:WRKORD-OPER-SET-ID )                      15570049
155800         END-EXEC                                                 15580049
155900                                                                  15590049
156000         EVALUATE TRUE                                            15600049
156100             WHEN SQLCODE = +0                                    15610049
156200             WHEN SQLCODE = -904                                  15620049
156300             WHEN SQLCODE = -913                                  15630049
156400                 CONTINUE                                         15640049
156500                                                                  15650049
156600             WHEN SQLWARN0 NOT = SPACE                            15660049
156700             WHEN SQLCODE < +0                                    15670049
156800             WHEN SQLCODE > +0                                    15680049
156900                 MOVE WRKORD-ORD-NBR  TO PV-DISP-PO-NBR           15690049
157000                 MOVE WRKORD-RCVR-SEQ-NBR                         15700049
157100                                      TO PV-DISP-REC-SEQ-NBR      15710052
157200                 MOVE WRKORD-ORD-LNE-NBR                          15720049
157300                                      TO PV-DISP-LNE-NBR          15730049
157400                 MOVE WRKORD-OPER-UNT-ID                          15740049
157500                                      TO PV-DISP-OPER-UNT-ID      15750049
157600                 MOVE WRKORD-FCLTY-ID TO PV-DISP-FCLTY-ID         15760049
157700                 MOVE SQLCODE TO PV-DISP-SQLCODE                  15770049
157800                 STRING                                           15780049
157900                      ' 5700- SQL = '                             15790049
158000                      PV-DISP-SQLCODE                             15800049
158100                      ' PO= '                                     15810049
158200                      PV-DISP-PO-NBR                              15820049
158300                      ' SEQ= '                                    15830049
158400                      PV-DISP-REC-SEQ-NBR                         15840052
158500                      ' LINE= '                                   15850049
158600                      PV-DISP-LNE-NBR                             15860049
158700                      ' OPER= '                                   15870049
158800                      PV-DISP-OPER-UNT-ID                         15880049
158900                      ' FCLTY= '                                  15890049
159000                      PV-DISP-FCLTY-ID                            15900049
159100                                 DELIMITED BY SIZE                15910049
159200                               INTO DP013-MESSAGE-TEXT (1)        15920049
159300                 MOVE ' 5700-INSERT-TWRKORD  '                    15930049
159400                                  TO DP013-PARAGRAPH              15940049
159500                 MOVE SQLCA       TO DP013-SQLCA                  15950049
159600                 SET DP013-DB2-ABEND                              15960049
159700                     DP013-XCTL-DISPLAY-RESTART                   15970049
159800                                  TO TRUE                         15980049
159900                 PERFORM DP013-0000-PROCESS-ABEND                 15990049
160000         END-EVALUATE                                             16000049
160100     END-PERFORM.                                                 16010049
160200                                                                  16020049
160300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16030049
160400             AND (SQLCODE NOT = +0)                               16040049
160500         MOVE WRKORD-ORD-NBR  TO PV-DISP-PO-NBR                   16050049
160600         MOVE WRKORD-RCVR-SEQ-NBR                                 16060049
160700                              TO PV-DISP-REC-SEQ-NBR              16070053
160800         MOVE WRKORD-ORD-LNE-NBR                                  16080049
160900                              TO PV-DISP-LNE-NBR                  16090049
161000         MOVE WRKORD-OPER-UNT-ID                                  16100049
161100                              TO PV-DISP-OPER-UNT-ID              16110049
161200         MOVE WRKORD-FCLTY-ID TO PV-DISP-FCLTY-ID                 16120049
161300         MOVE SQLCODE TO PV-DISP-SQLCODE                          16130049
161400         STRING                                                   16140049
161500              ' 5700- SQL = '                                     16150049
161600              PV-DISP-SQLCODE                                     16160049
161700              ' PO= '                                             16170049
161800              PV-DISP-PO-NBR                                      16180049
161900              ' SEQ= '                                            16190049
162000              PV-DISP-REC-SEQ-NBR                                 16200053
162100              ' LINE= '                                           16210049
162200              PV-DISP-LNE-NBR                                     16220049
162300              ' OPER= '                                           16230049
162400              PV-DISP-OPER-UNT-ID                                 16240049
162500              ' FCLTY= '                                          16250049
162600              PV-DISP-FCLTY-ID                                    16260049
162700                         DELIMITED BY SIZE                        16270049
162800                               INTO DP013-MESSAGE-TEXT (1)        16280049
162900                 MOVE ' 5700-INSERT-TWRKORD  '                    16290049
163000                                  TO DP013-PARAGRAPH              16300049
163100                 MOVE SQLCA       TO DP013-SQLCA                  16310049
163200                 SET DP013-DB2-ABEND                              16320049
163300                     DP013-XCTL-DISPLAY-RESTART                   16330049
163400                                  TO TRUE                         16340049
163500                 PERFORM DP013-0000-PROCESS-ABEND                 16350049
163600     END-IF.                                                      16360049
163700                                                                  16370049
163800                                                                  16380049
163900*----------------------------------------------------------------*16390041
164000* OPEN THE TOSOPFA CURSOR                                        *16400041
164100*----------------------------------------------------------------*16410041
164200                                                                  16420041
164300 5800-OPEN-TOSOPFA-CSR.                                           16430041
164400                                                                  16440041
164500     EXEC SQL                                                     16450041
164600          DECLARE TOSOPFA-CSR CURSOR FOR                          16460041
164700           SELECT OPER_SET_ID                                     16470041
164800                 ,OPER_ID                                         16480041
164900                 ,OPER_UNT_ID                                     16490041
165000                 ,FCLTY_ID                                        16500041
165100                 ,FCLTY_AREA_ID                                   16510041
165200                 ,PRC_FCLTY_AREA_ID                               16520041
165300                 ,SCRN_SEQ_NBR                                    16530041
165400           FROM   TOSOPFA                                         16540041
165500           WHERE  OPER_SET_ID    = :WRKORD-OPER-SET-ID            16550042
165600             AND  OPER_UNT_ID    = :RECEIV-CURR-OPER-UNT-ID       16560042
165700             AND  FCLTY_ID       =  1                             16570042
165800             AND  VER_STATUS_CDE = 'A'                            16580041
165900           ORDER BY SCRN_SEQ_NBR                                  16590041
166000     END-EXEC.                                                    16600041
166100                                                                  16610041
166200     PERFORM                                                      16620041
166300         WITH TEST AFTER                                          16630041
166400         VARYING PV-RETRY-COUNTER                                 16640041
166500         FROM 1 BY 1                                              16650041
166600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16660041
166700            OR (SQLCODE = +0))                                    16670041
166800                                                                  16680041
166900         EXEC SQL                                                 16690041
167000              OPEN TOSOPFA-CSR                                    16700041
167100         END-EXEC                                                 16710041
167200                                                                  16720041
167300         EVALUATE TRUE                                            16730041
167400             WHEN SQLCODE = +0                                    16740041
167500                  CONTINUE                                        16750041
167600             WHEN SQLCODE = -904                                  16760041
167700             WHEN SQLCODE = -913                                  16770041
167800                  CONTINUE                                        16780041
167900             WHEN SQLWARN0 NOT = SPACE                            16790041
168000             WHEN SQLCODE  NOT = +0                               16800041
168100                 MOVE WRKORD-OPER-SET-ID TO PV-DISP-OPER-SET      16810042
168200                 MOVE SQLCODE TO PV-DISP-SQLCODE                  16820041
168300                 STRING                                           16830041
168400                      ' 5800- SQL = '                             16840041
168500                      PV-DISP-SQLCODE                             16850041
168600                      ' OPER SET = '                              16860041
168700                      PV-DISP-OPER-SET                            16870041
168800                                 DELIMITED BY SIZE                16880041
168900                               INTO DP013-MESSAGE-TEXT (1)        16890041
169000                 MOVE ' 5800-OPEN-TOSOPFA-CSR'                    16900041
169100                                  TO DP013-PARAGRAPH              16910041
169200                 MOVE SQLCA       TO DP013-SQLCA                  16920041
169300                 SET DP013-DB2-ABEND                              16930041
169400                     DP013-XCTL-DISPLAY-RESTART                   16940041
169500                                  TO TRUE                         16950041
169600                 PERFORM DP013-0000-PROCESS-ABEND                 16960041
169700         END-EVALUATE                                             16970041
169800     END-PERFORM.                                                 16980041
169900                                                                  16990041
170000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17000041
170100             AND (SQLCODE NOT = +0)                               17010041
170200         MOVE WRKORD-OPER-SET-ID TO PV-DISP-OPER-SET              17020042
170300         MOVE SQLCODE TO PV-DISP-SQLCODE                          17030041
170400         STRING                                                   17040041
170500              ' 5800- SQL = '                                     17050041
170600              PV-DISP-SQLCODE                                     17060041
170700              ' OPER SET = '                                      17070041
170800              PV-DISP-OPER-SET                                    17080041
170900                         DELIMITED BY SIZE                        17090041
171000                               INTO DP013-MESSAGE-TEXT (1)        17100041
171100                 MOVE ' 5800-OPEN-TOSOPFA-CSR'                    17110041
171200                                  TO DP013-PARAGRAPH              17120041
171300                 MOVE SQLCA       TO DP013-SQLCA                  17130041
171400                 SET DP013-DB2-ABEND                              17140041
171500                     DP013-XCTL-DISPLAY-RESTART                   17150041
171600                                  TO TRUE                         17160041
171700                 PERFORM DP013-0000-PROCESS-ABEND                 17170041
171800     END-IF.                                                      17180041
171900                                                                  17190041
172000/                                                                 17200041
172100*----------------------------------------------------------------*17210041
172200*    FETCH A TOSOPFA ROW                                         *17220041
172300*----------------------------------------------------------------*17230041
172400                                                                  17240041
172500 5820-FETCH-TOSOPFA-CSR.                                          17250041
172600                                                                  17260041
172700     EXEC SQL                                                     17270041
172800          FETCH TOSOPFA-CSR                                       17280041
172900          INTO :OSOPFA-OPER-SET-ID                                17290041
173000              ,:OSOPFA-OPER-ID                                    17300041
173100              ,:OSOPFA-OPER-UNT-ID                                17310041
173200              ,:OSOPFA-FCLTY-ID                                   17320041
173300              ,:OSOPFA-FCLTY-AREA-ID                              17330041
173400              ,:OSOPFA-PRC-FCLTY-AREA-ID                          17340041
173500              ,:OSOPFA-SCRN-SEQ-NBR                               17350041
173600     END-EXEC                                                     17360041
173700                                                                  17370041
173800     EVALUATE TRUE                                                17380041
173900         WHEN SQLCODE = +0                                        17390041
174000              CONTINUE                                            17400041
174100                                                                  17410041
174200         WHEN SQLCODE = +100                                      17420041
174300              SET PS-EOF-TOSOPFA-CSR TO TRUE                      17430041
174400                                                                  17440041
174500         WHEN SQLWARN0 NOT = SPACE                                17450041
174600         WHEN SQLCODE < +0                                        17460041
174700         WHEN SQLCODE > +0                                        17470041
174800             MOVE WRKORD-OPER-SET-ID TO PV-DISP-OPER-SET          17480042
174900             MOVE SQLCODE TO PV-DISP-SQLCODE                      17490041
175000             STRING                                               17500041
175100                  ' 5820- SQL = '                                 17510041
175200                  PV-DISP-SQLCODE                                 17520041
175300                  ' OPER SET = '                                  17530041
175400                  PV-DISP-OPER-SET                                17540041
175500                             DELIMITED BY SIZE                    17550041
175600                               INTO DP013-MESSAGE-TEXT (1)        17560041
175700                 MOVE ' 5820-FETCH-TOSOPFA-CSR'                   17570041
175800                                  TO DP013-PARAGRAPH              17580041
175900                 MOVE SQLCA       TO DP013-SQLCA                  17590041
176000                 SET DP013-DB2-ABEND                              17600041
176100                     DP013-XCTL-DISPLAY-RESTART                   17610041
176200                                  TO TRUE                         17620041
176300                 PERFORM DP013-0000-PROCESS-ABEND                 17630041
176400     END-EVALUATE.                                                17640041
176500                                                                  17650041
176600/                                                                 17660041
176700*----------------------------------------------------------------*17670041
176800* CLOSE THE TOSOPFA CURSOR                                       *17680041
176900*----------------------------------------------------------------*17690041
177000                                                                  17700041
177100 5840-CLOSE-TOSOPFA-CSR.                                          17710041
177200                                                                  17720041
177300     EXEC SQL                                                     17730041
177400          CLOSE TOSOPFA-CSR                                       17740041
177500     END-EXEC                                                     17750041
177600                                                                  17760041
177700     EVALUATE TRUE                                                17770041
177800         WHEN SQLCODE = +0                                        17780041
177900              CONTINUE                                            17790041
178000         WHEN SQLWARN0 NOT = SPACE                                17800041
178100         WHEN SQLCODE  NOT = +0                                   17810041
178200             MOVE WRKORD-OPER-SET-ID  TO PV-DISP-OPER-SET         17820042
178300             MOVE SQLCODE TO PV-DISP-SQLCODE                      17830041
178400             STRING                                               17840041
178500                  ' 5840- SQL = '                                 17850041
178600                  PV-DISP-SQLCODE                                 17860041
178700                  ' OPER SET = '                                  17870041
178800                  PV-DISP-OPER-SET                                17880041
178900                             DELIMITED BY SIZE                    17890041
179000                               INTO DP013-MESSAGE-TEXT (1)        17900041
179100                 MOVE ' 5840-CLOSE-TOSOPFA-CSR'                   17910041
179200                                  TO DP013-PARAGRAPH              17920041
179300                 MOVE SQLCA       TO DP013-SQLCA                  17930041
179400                 SET DP013-DB2-ABEND                              17940041
179500                     DP013-XCTL-DISPLAY-RESTART                   17950041
179600                                  TO TRUE                         17960041
179700                 PERFORM DP013-0000-PROCESS-ABEND                 17970041
179800     END-EVALUATE.                                                17980041
179900                                                                  17990041
180000                                                                  18000041
180100 5900-BUILD-WORK-ORDER-INSTR.                                     18010041
180200                                                                  18020041
180300     INITIALIZE DCLTWKORIN.                                       18030041
180400                                                                  18040041
180500     MOVE DK-PO-NBR              TO WKORIN-ORD-NBR.               18050043
180600     MOVE DK-RCVR-NBR            TO WKORIN-RCVR-SEQ-NBR.          18060043
180700     MOVE +1                     TO WKORIN-WORK-ORD-SEQ-NBR.      18070041
180800     ADD +1                      TO PV-WO-INSTR-SEQ-NBR.          18080041
180900     MOVE PV-WO-INSTR-SEQ-NBR    TO WKORIN-WO-INSTR-SEQ-NBR.      18090041
181000     MOVE 'A'                    TO WKORIN-VER-STATUS-CDE.        18100041
181100     MOVE WRKORD-OPER-UNT-ID     TO WKORIN-OPER-UNT-ID.           18110041
181200     MOVE 1                      TO WKORIN-FCLTY-ID.              18120041
181300     MOVE OSOPFA-OPER-ID         TO WKORIN-OPER-ID.               18130041
181400     MOVE OSOPFA-FCLTY-AREA-ID   TO WKORIN-FCLTY-AREA-ID.         18140041
181500     MOVE OSOPFA-PRC-FCLTY-AREA-ID                                18150041
181600                                 TO WKORIN-PRC-FCLTY-AREA-ID.     18160041
181700     MOVE OSOPFA-SCRN-SEQ-NBR    TO WKORIN-SCREEN-SEQ-NBR.        18170041
181800     MOVE 'N'                    TO PS-INSTRUCTION-SW.            18180041
181900     MOVE 1                      TO WKORIN-EXPTED-CART-CNT.       18190041
182000     MOVE ZERO                   TO WKORIN-ACTL-CART-CNT.         18200041
182100     MOVE 'N'                    TO WKORIN-ALLOC-IND              18210041
182200                                    WKORIN-REPACK-IND.            18220041
182300     MOVE '9999-09-09-09.09.09.000000'                            18230041
182400                                 TO WKORIN-STRT-TMST              18240041
182500                                    WKORIN-STOP-TMST.             18250041
182600                                                                  18260041
182700     PERFORM 5940-INSERT-TWKORIN.                                 18270041
182800                                                                  18280041
182900                                                                  18290041
183000 5940-INSERT-TWKORIN.                                             18300041
183100                                                                  18310041
183200     PERFORM                                                      18320041
183300         WITH TEST AFTER                                          18330041
183400         VARYING PV-RETRY-COUNTER                                 18340041
183500         FROM 1 BY 1                                              18350041
183600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18360041
183700             OR (SQLCODE = +0))                                   18370041
183800                                                                  18380041
183900         EXEC SQL                                                 18390041
184000              INSERT INTO TWKORIN                                 18400041
184100                     ( ORD_NBR                                    18410041
184200                      ,RCVR_SEQ_NBR                               18420041
184300                      ,ORD_LNE_NBR                                18430041
184400                      ,WORK_ORD_SEQ_NBR                           18440041
184500                      ,OPER_UNT_ID                                18450041
184600                      ,FCLTY_ID                                   18460041
184700                      ,WO_INSTR_SEQ_NBR                           18470041
184800                      ,CRE_TMST                                   18480041
184900                      ,VER_STATUS_CDE                             18490041
185000                      ,CRE_UID_ID                                 18500041
185100                      ,OPER_ID                                    18510041
185200                      ,FCLTY_AREA_ID                              18520041
185300                      ,PRC_FCLTY_AREA_ID                          18530041
185400                      ,EXPTED_CART_CNT                            18540041
185500                      ,ACTL_CART_CNT                              18550041
185600                      ,ALLOC_IND                                  18560041
185700                      ,REPACK_IND                                 18570041
185800                      ,STRT_TMST                                  18580041
185900                      ,STOP_TMST                                  18590041
186000                      ,SCREEN_SEQ_NBR                             18600041
186100                      ,LNE_LOC_CDE                                18610041
186200                      ,REC_SEL_IND )                              18620041
186300              VALUES ( :WKORIN-ORD-NBR                            18630041
186400                      ,:WKORIN-RCVR-SEQ-NBR                       18640041
186500                      ,:WKORIN-ORD-LNE-NBR                        18650041
186600                      ,:WKORIN-WORK-ORD-SEQ-NBR                   18660041
186700                      ,:WKORIN-OPER-UNT-ID                        18670041
186800                      ,:WKORIN-FCLTY-ID                           18680041
186900                      ,:WKORIN-WO-INSTR-SEQ-NBR                   18690041
187000                      ,CURRENT TIMESTAMP                          18700041
187100                      ,:WKORIN-VER-STATUS-CDE                     18710041
187200                      ,:DP020-USERID                              18720043
187300                      ,:WKORIN-OPER-ID                            18730041
187400                      ,:WKORIN-FCLTY-AREA-ID                      18740041
187500                      ,:WKORIN-PRC-FCLTY-AREA-ID                  18750041
187600                      ,:WKORIN-EXPTED-CART-CNT                    18760041
187700                      ,:WKORIN-ACTL-CART-CNT                      18770041
187800                      ,:WKORIN-ALLOC-IND                          18780041
187900                      ,:WKORIN-REPACK-IND                         18790041
188000                      ,:WKORIN-STRT-TMST                          18800041
188100                      ,:WKORIN-STOP-TMST                          18810041
188200                      ,:WKORIN-SCREEN-SEQ-NBR                     18820041
188300                      ,:WKORIN-LNE-LOC-CDE                        18830041
188400                      ,:WKORIN-REC-SEL-IND )                      18840041
188500         END-EXEC                                                 18850041
188600                                                                  18860041
188700         EVALUATE TRUE                                            18870041
188800             WHEN SQLCODE = +0                                    18880041
188900                  SET  PS-HAS-WORK-ORDER-INST TO  TRUE            18890041
189000                                                                  18900041
189100             WHEN SQLCODE = -904                                  18910041
189200             WHEN SQLCODE = -913                                  18920041
189300                 CONTINUE                                         18930041
189400                                                                  18940041
189500             WHEN SQLWARN0 NOT = SPACE                            18950041
189600             WHEN SQLCODE < +0                                    18960041
189700             WHEN SQLCODE > +0                                    18970041
189800                 MOVE WKORIN-ORD-NBR      TO PV-DISP-PO-NBR       18980041
189900                 MOVE WKORIN-RCVR-SEQ-NBR TO PV-DISP-REC-SEQ-NBR  18990048
190000                 MOVE WKORIN-ORD-LNE-NBR  TO PV-DISP-LNE-NBR      19000041
190100                 MOVE WKORIN-WORK-ORD-SEQ-NBR                     19010041
190200                                      TO PV-DISP-WO-SEQ-NBR       19020041
190300                 MOVE WKORIN-WO-INSTR-SEQ-NBR                     19030041
190400                                      TO PV-DISP-WO-INSTR-SEQ-NBR 19040041
190500                 MOVE SQLCODE TO PV-DISP-SQLCODE                  19050041
190600                 STRING                                           19060041
190700                      ' 5940- SQL = '                             19070041
190800                      PV-DISP-SQLCODE                             19080041
190900                      ' PO= '                                     19090041
191000                      PV-DISP-PO-NBR                              19100041
191100                      ' '                                         19110041
191200                      PV-DISP-REC-SEQ-NBR                         19120048
191300                      ' '                                         19130041
191400                      PV-DISP-LNE-NBR                             19140041
191500                      ' '                                         19150041
191600                      PV-DISP-WO-SEQ-NBR                          19160041
191700                      ' '                                         19170041
191800                      PV-DISP-WO-INSTR-SEQ-NBR                    19180041
191900                                 DELIMITED BY SIZE                19190041
192000                               INTO DP013-MESSAGE-TEXT (1)        19200041
192100                 MOVE ' 5940-INSERT-TWKORIN'                      19210041
192200                                  TO DP013-PARAGRAPH              19220041
192300                 MOVE SQLCA       TO DP013-SQLCA                  19230041
192400                 SET DP013-DB2-ABEND                              19240041
192500                     DP013-XCTL-DISPLAY-RESTART                   19250041
192600                                  TO TRUE                         19260041
192700                 PERFORM DP013-0000-PROCESS-ABEND                 19270041
192800         END-EVALUATE                                             19280041
192900     END-PERFORM.                                                 19290041
193000                                                                  19300041
193100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19310041
193200             AND (SQLCODE NOT = +0)                               19320041
193300         STRING                                                   19330041
193400              '5940-INSERT-TWKORIN '                              19340041
193500              'MAX RETRIES EXCEEDED ON INSERT ON TWKORIN'         19350041
193600                                 DELIMITED BY SIZE                19360041
193700                               INTO DP013-MESSAGE-TEXT (1)        19370041
193800                 MOVE ' 5940-INSERT-TWKORIN'                      19380041
193900                                  TO DP013-PARAGRAPH              19390041
194000                 MOVE SQLCA       TO DP013-SQLCA                  19400041
194100                 SET DP013-DB2-ABEND                              19410041
194200                     DP013-XCTL-DISPLAY-RESTART                   19420041
194300                                  TO TRUE                         19430041
194400                 PERFORM DP013-0000-PROCESS-ABEND                 19440041
194500     END-IF.                                                      19450041
194600                                                                  19460041
194700*----------------------------------------------------------------*19470015
194800*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *19480015
194900*    AND THE ERROR SWITCHES.                                     *19490015
195000*----------------------------------------------------------------*19500015
195100 9900-SOFT-ABORT.                                                 19510015
195200     SET PS-ERROR         TO TRUE.                                19520015
195300     SET DP020-MSG-FATAL  TO TRUE.                                19530015
195400     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    19540015
195500     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE.                       19550015
195600     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          19560015
195700     PERFORM 0001-CALL-CICS-ARCH-API.                             19570015
195800                                                                  19580021
195900******************************************************************19590021
196000 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  19600021
196100                                                                  19610021
196200     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           19620021
196300     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          19630021
196400     INITIALIZE DP013-SRC-TASK-NUMBER                             19640021
196500                DP013-STACK.                                      19650021
196600     SET DP013-LINK-RETURN            TO TRUE.                    19660021
196700                                                                  19670021
196800     EXEC CICS                                                    19680021
196900         LINK                                                     19690021
197000             PROGRAM   (DP013-NAME)                               19700021
197100             COMMAREA  (DP013-PARAMETERS)                         19710021
197200             LENGTH    (DP013-LENGTH)                             19720021
197300     END-EXEC.                                                    19730021
197400/                                                                 19740021
197500*----------------------------------------------------------------*19750015
197600*    ABEND PROCESSOR MODULE                                      *19760015
197700*----------------------------------------------------------------*19770015
197800                                                                  19780015
197900     COPY DPPD013.                                                19790021
