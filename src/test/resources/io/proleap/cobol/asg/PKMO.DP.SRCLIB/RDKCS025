000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    RDKCS025.                                         00040001
000500 AUTHOR.        PAT DOYLE - IBS.                                  00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  04-18-96.                                         00070001
000800 DATE-COMPILED.                                                   00080001
000900                                                                  00090001
001000*---------------------------------------------------------------* 00100001
001100*    U025 - KMC INQUIRY SCREEN.                                 * 00110001
001200*                                                               * 00120001
001300*---------------------------------------------------------------* 00130001
001400*- AJR - 08/19/96 - ADDED CONTROL NUMBER TO THE SCREEN.       --* 00140001
001500*---------------------------------------------------------------* 00150001
001600* 12/09/97 - KARI SUTTON - WR# 4197                             * 00160001
001700* - ADDED LOGIC TO TRANSFER TO THE COMMENT SCREEN (RDKCS027) IN * 00170001
001800*   INQUIRY MODE.                                               * 00180001
001900* - REARRANGED THE SCREEN TO MAKE THE APPROVAL NUMBER A PART OF * 00190001
002000*   THE SCROLLABLE LIST.                                        * 00200001
002100* - ADDED MESSAGES 01499 AND 01500 FOR CARDS THAT HAVE NO       * 00210001
002200*   ACTIVITY.                                                   * 00220001
002300*---------------------------------------------------------------* 00230001
002400* 06/20/97 - AJR - WR 5220 - GIFT CARD                        --* 00240001
002500* - INCREASED THE SIZE OF THE CARD ID AND CONTROL NUMBER FIELD--* 00250001
002600*   FOR GIFT CARDS.  ADDED CARD TYPE TO THE SCREEN.           --* 00260001
002700*---------------------------------------------------------------* 00270001
002800*   12/22/98 - DAVE MUSKAT (COMPUWARE) - WR# 6041               * 00280001
002900*     CHANGES FOR Y2K:                                          * 00290001
003000*     ADDED A CENTURY FIELD (PV-TRAN-CC) TO THE DATE DEFINED    * 00300001
003100*     UNDER PV-TRAN-ID.  ADDED CODE TO POPULATE THE NEW CENTURY * 00310001
003200*     FIELD WITH EXISTING FIELD PV-DB2-CC.  THE MAPSET FIELDS   * 00320001
003300*     THAT DISPLAY PV-TRAN-ID WERE EXPANDED TO DISPLAY THE NEW  * 00330001
003400*     CENTURY FIELD.                                            * 00340001
003500*     REMOVED NON-STANDARD KOHLS CALENDAR ROUTINE WORKING       * 00350001
003600*     STORAGE FIELD THAT WAS UNUSED IN THE PROGRAM.             * 00360001
003700*---------------------------------------------------------------* 00370001
003800*   03/29/00 - DAVID COLOMBO (COMPUWARE) - WR# 20760            * 00380001
003900*     CHANGES FOR FEE PROCESSING:                               * 00390001
004000*     ADDED A FIELD TO THE LEFT OF THE BALANCE FIELD ON THE     * 00400001
004100*     SCREEN TO SHOW THE TOTAL FEE AMOUNT.                      * 00410001
004200*---------------------------------------------------------------* 00420001
004300******************************************************************00430001
004400*  09/19/01 - ARCHIVE PROJECT - GREG SHEFF                       *00440001
004500*   IF CARD NUMBER IS NOT FOUND IN TABLES TKMCTBL AND TKMCACT    *00450001
004600*   THEN SEARCH HISTORY TABLES TKMCHTB AND TKMCHAC FOR THAT CARD.*00460001
004700******************************************************************00470001
004800* 9/19/15        JIM ARENDT   CHG0124679                          00480005
004900*  AS PART OF THE LP REFUND REMEDIATION PROJECT USERS CAN NOW     00490005
005000*  ENTER EITHER THE FULL ENCRYPTED OR UN-ENCRYPTED DRIVERS LICENSE00500005
005001*  NUMBER.                                                        00500105
005002******************************************************************00500201
005003* 9/20/18        JIM HUNTER   CHG0208819                          00500305
005004*  MAINFRAME REFACTORING - REPLACE CGU042MC WITH DPWS036.         00500405
005005******************************************************************00500505
005006* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00500607
005007*            - CHANGE CALL OF DPKUT100 TO                       * 00500707
005008*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00500807
005009*              MAKING THE CALL DYNAMIC VS STATIC                * 00500907
005010*                                                               * 00501007
005011*---------------------------------------------------------------* 00501107
CICS  * CHANGED 10/27/2022    BY JIM HUNTER      WR: CHG0277293         00501208
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00501308
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00501408
CICS  ******************************************************************00501508
005012 ENVIRONMENT DIVISION.                                            00501601
005013                                                                  00501701
005020 DATA DIVISION.                                                   00502001
005100                                                                  00510001
005200 WORKING-STORAGE SECTION.                                         00520001
005300                                                                  00530001
005400 01  DK-DB2-KEYS.                                                 00540001
005500     05  DK-CARD-ID                     PIC S9(12)V VALUE ZEROS   00550001
005600                                                    COMP-3.       00560001
005700                                                                  00570001
005800 01  PC-PROGRAM-CONSTANTS.                                        00580001
005900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00590001
006000                                                    'RD025A  '.   00600001
006100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00610001
006200                                                    'RDKM025 '.   00620001
006300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00630001
006400                                                    'RDKCS025'.   00640001
006500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00650001
006600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00660001
006700     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '2'.    00670001
006800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00680001
006820                                                    COMP SYNC.    00682001
006830     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00683001
006840                                                    COMP SYNC.    00684001
006850     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00685001
006860                                                    +1000000      00686001
006870                                                    COMP-3.       00687001
006880     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00688001
006890                                                    COMP SYNC.    00689001
006900     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00690001
007000                                                                  00700001
007100     05  PC-MAX-TRIES                   PIC S9(03)  VALUE 7       00710001
007200                                                    COMP-3.       00720001
007300     05  PC-TSYMSG-NUMBERS.                                       00730001
007400         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00740001
007500         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00750001
007600         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00760001
007700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00770001
007800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00780001
007900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00790001
008000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00800001
008100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00810001
008200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00820001
008300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00830001
008400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00840001
008500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00850001
008600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00860001
008700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00870001
008800         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  00880001
008900         10  PC-TSYMSG-00778            PIC  9(05)  VALUE 00778.  00890001
009000         10  PC-TSYMSG-01210            PIC  9(05)  VALUE 01210.  00900001
009100         10  PC-TSYMSG-01499            PIC  9(05)  VALUE 01499.  00910001
009200         10  PC-TSYMSG-01500            PIC  9(05)  VALUE 01500.  00920001
009300     05  PC-1                           PIC  9(01)  VALUE 1.      00930001
009400 01  PS-PROGRAM-SWITCHES.                                         00940001
009500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00950001
009600         88  PS-NO-ERROR                            VALUE 'Y'.    00960001
009700         88  PS-ERROR                               VALUE 'N'.    00970001
009800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00980001
009900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00990001
010000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01000001
010100     05  PS-ITEMS-SW                    PIC  X(01)  VALUE 'N'.    01010001
010200         88  PS-ITEMS-FOUND                         VALUE 'Y'.    01020001
010300         88  PS-ITEMS-NOT-FOUND                     VALUE 'N'.    01030001
010400                                                                  01040001
010500 01  PV-PROGRAM-VARIABLES.                                        01050001
010600     05  PV-CONTROL-NBR.                                          01060001
010700        10  PV-CRD-PROD-YR              PIC  9(04).               01070001
010800        10  PV-SHIPT-REQ-NBR            PIC  9(04).               01080001
010900        10  PV-CNTL-NBR                 PIC  9(06).               01090001
011000     05  PV-SUB                         PIC S9(04)  VALUE +0      01100001
011100                                                    COMP SYNC.    01110001
011200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01120001
011300                                                    COMP SYNC.    01130001
011400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01140001
011500                                                    COMP-3.       01150001
011600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01160001
011700                                                    COMP-3.       01170001
011800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01180001
011900                                                    COMP-3.       01190001
012000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01200001
012100                                                    COMP-3.       01210001
012200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01220001
012300                                                    COMP-3.       01230001
012400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01240001
012500                                                    COMP-3.       01250001
012600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01260001
012700                                                    COMP-3.       01270001
012800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01280001
012900                                                    COMP SYNC.    01290001
013000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01300001
013100                                                    COMP SYNC.    01310001
013200     05  PV-ITEM                        PIC S9(04)  VALUE +0      01320001
013300                                                    COMP SYNC.    01330001
013400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01340001
013500                                                    COMP SYNC.    01350001
013600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01360001
013700                                                    COMP SYNC.    01370001
013800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01380001
013900                                                    COMP SYNC.    01390001
014000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01400001
014100                                                    COMP SYNC.    01410001
014200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01420001
014300                                                    COMP SYNC.    01430001
014400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01440001
014500                                                    COMP SYNC.    01450001
014600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01460001
014700                                                    COMP SYNC.    01470001
014800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01480001
014900                                                    COMP SYNC.    01490001
015000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01500001
015100                                                    COMP SYNC.    01510001
015200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01520001
015300                                                    COMP SYNC.    01530001
015400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01540001
015500                                                    COMP SYNC.    01550001
015600     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01560001
015700                                                    COMP SYNC.    01570001
015800     05  PV-NUMBER-OF-TRIES             PIC S9(04)  VALUE +0      01580001
015900                                                    COMP SYNC.    01590001
016000     05  PV-TRAN-ID.                                              01600001
016100         10  PV-TRAN-CC                 PIC X(02).                01610001
016200         10  PV-TRAN-YY                 PIC X(02).                01620001
016300         10  PV-TRAN-MM                 PIC X(02).                01630001
016400         10  PV-TRAN-DD                 PIC X(02).                01640001
016500         10  PV-TRAN-S1                 PIC X(01).                01650001
016600         10  PV-TRAN-STR-NBR            PIC 9(04).                01660001
016700         10  PV-TRAN-S2                 PIC X(01).                01670001
016800         10  PV-TRAN-TRMNL-NBR          PIC X(04).                01680001
016900         10  PV-TRAN-S3                 PIC X(01).                01690001
017000         10  PV-TRAN-TRN-NBR            PIC X(04).                01700001
017100     05  PV-DB2-DATE.                                             01710001
017200         10  PV-DB2-CC                  PIC X(02).                01720001
017300         10  PV-DB2-YY                  PIC X(02).                01730001
017400         10  FILLER                     PIC X(01).                01740001
017500         10  PV-DB2-MM                  PIC X(02).                01750001
017600         10  FILLER                     PIC X(01).                01760001
017700         10  PV-DB2-DD                  PIC X(02).                01770001
017800     05  PV-USERID                      PIC 9(11).                01780001
017900     05  PV-RESP                        PIC S9(4)   COMP.         01790001
018900*----------------------------------------------------------------*01890001
019000*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *01900001
019100*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *01910001
019200*   APPLICATION-SPECIFIC COMMAREA.                               *01920001
019300*----------------------------------------------------------------*01930001
019400 01  LQW-LIST-QUEUE-WORK-AREA.                                    01940001
019500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01950001
019600     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01960001
019700                                        INDEXED BY LQW-IDX.       01970001
019800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01980001
019900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01990001
020000         10  LQW-SELECTED-SW            PIC  X(01).               02000001
020100             88  LQW-SELECT                         VALUE 'S'     02010001
020110                                                          's'.    02011005
020200             88  LQW-DESELECT                       VALUE ' '.    02020001
020300         10  LQW-POS-DATE-ISO           PIC  X(10).               02030001
020400         10  LQW-STORE-NBR              PIC  9(04).               02040001
020500         10  LQW-TERMINAL               PIC  X(04).               02050001
020600         10  LQW-TRANSACTION            PIC  X(04).               02060001
020700         10  LQW-REVERSAL-IND           PIC  X(01).               02070001
020800         10  LQW-VOID-IND               PIC  X(01).               02080001
020900         10  LQW-ACTIVITY-TYPE-DESC     PIC  X(07).               02090001
021000         10  LQW-AMOUNT                 PIC S9(07)V99.            02100001
021100         10  LQW-AUTO-MANUAL            PIC  X(01).               02110001
021200         10  LQW-USERID                 PIC  X(11).               02120001
021300         10  LQW-APPROVAL-NUMBER        PIC  X(06).               02130001
021400         10  LQW-ACTIVITY-STATUS        PIC  X(13).               02140001
021500         10  LQW-TRN-AUTH-TMST          PIC  X(26).               02150001
021600                                                                  02160001
021700*---------------------------------------------------------------* 02170001
021800*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.          * 02180001
021900*---------------------------------------------------------------* 02190001
022000                                                                  02200001
022100     COPY RDWS022.                                                02210001
022200                                                                  02220001
022300*---------------------------------------------------------------* 02230001
022400*    MAP LAYOUT                                                 * 02240001
022500*---------------------------------------------------------------* 02250001
022600                                                                  02260001
022700     COPY RDKM025.                                                02270001
022800                                                                  02280001
022900 01  MR-OCCURS-LAYOUT                   REDEFINES  RD025AO.       02290001
023010     05  FILLER                         PIC X(151).               02301005
023100     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          02310001
023200         10  MR-SELECTL                 PIC S9(04) COMP.          02320001
023300         10  MR-SELECTA                 PIC  X(01).               02330001
023400         10  MR-SELECTC                 PIC  X(01).               02340001
023500         10  MR-SELECTH                 PIC  X(01).               02350001
023600         10  MR-SELECTI                 PIC  X(01).               02360001
023700                                                                  02370001
023800         10  MR-TRAN-IDL                PIC S9(04) COMP.          02380001
023900         10  MR-TRAN-IDA                PIC  X(01).               02390001
024000         10  MR-TRAN-IDC                PIC  X(01).               02400001
024100         10  MR-TRAN-IDH                PIC  X(01).               02410001
024200         10  MR-TRAN-ID                 PIC  X(23).               02420001
024300                                                                  02430001
024400         10  MR-REVERSAL-INDL           PIC S9(04) COMP.          02440001
024500         10  MR-REVERSAL-INDA           PIC  X(01).               02450001
024600         10  MR-REVERSAL-INDC           PIC  X(01).               02460001
024700         10  MR-REVERSAL-INDH           PIC  X(01).               02470001
024800         10  MR-REVERSAL-IND            PIC  X(01).               02480001
024900                                                                  02490001
025000         10  MR-VOID-INDL               PIC S9(04) COMP.          02500001
025100         10  MR-VOID-INDA               PIC  X(01).               02510001
025200         10  MR-VOID-INDC               PIC  X(01).               02520001
025300         10  MR-VOID-INDH               PIC  X(01).               02530001
025400         10  MR-VOID-IND                PIC  X(01).               02540001
025500                                                                  02550001
025600         10  MR-ACTIVITY-TYPEL          PIC S9(04) COMP.          02560001
025700         10  MR-ACTIVITY-TYPEA          PIC  X(01).               02570001
025800         10  MR-ACTIVITY-TYPEC          PIC  X(01).               02580001
025900         10  MR-ACTIVITY-TYPEH          PIC  X(01).               02590001
026000         10  MR-ACTIVITY-TYPE-DESC      PIC  X(06).               02600001
026100                                                                  02610001
026200         10  MR-AMOUNTL                 PIC S9(04) COMP.          02620001
026300         10  MR-AMOUNTA                 PIC  X(01).               02630001
026400         10  MR-AMOUNTC                 PIC  X(01).               02640001
026500         10  MR-AMOUNTH                 PIC  X(01).               02650001
026600         10  MR-AMOUNT-X.                                         02660001
026700             15  MR-AMOUNT              PIC ZZZZ.99-.             02670001
026800                                                                  02680001
026900         10  MR-AUTO-MANUALL            PIC S9(04) COMP.          02690001
027000         10  MR-AUTO-MANUALA            PIC  X(01).               02700001
027100         10  MR-AUTO-MANUALC            PIC  X(01).               02710001
027200         10  MR-AUTO-MANUALH            PIC  X(01).               02720001
027300         10  MR-AUTO-MANUAL             PIC  X(01).               02730001
027400                                                                  02740001
027500         10  MR-USERIDL                 PIC S9(04) COMP.          02750001
027600         10  MR-USERIDA                 PIC  X(01).               02760001
027700         10  MR-USERIDC                 PIC  X(01).               02770001
027800         10  MR-USERIDH                 PIC  X(01).               02780001
027900         10  MR-USERID                  PIC  X(11).               02790001
028000                                                                  02800001
028100         10  MR-APPROVAL-NUMBERL        PIC S9(04) COMP.          02810001
028200         10  MR-APPROVAL-NUMBERA        PIC  X(01).               02820001
028300         10  MR-APPROVAL-NUMBERC        PIC  X(01).               02830001
028400         10  MR-APPROVAL-NUMBERH        PIC  X(01).               02840001
028500         10  MR-APPROVAL-NUMBER         PIC  X(06).               02850001
028600                                                                  02860001
028700         10  MR-ACTIVITY-STATUSL        PIC S9(04) COMP.          02870001
028800         10  MR-ACTIVITY-STATUSA        PIC  X(01).               02880001
028900         10  MR-ACTIVITY-STATUSC        PIC  X(01).               02890001
029000         10  MR-ACTIVITY-STATUSH        PIC  X(01).               02900001
029100         10  MR-ACTIVITY-STATUS         PIC  X(10).               02910001
029200                                                                  02920001
029300******************************************************************02930001
029400** WORKING STORAGE FOR CONVERSION TO CARD NUMBER                 *02940001
029500******************************************************************02950001
029600     COPY SVWS007.                                                02960001
029700******************************************************************02970001
029800** WORKING STORAGE CONSTANT LIST FOR STORED VALUE SYSTEM         *02980001
029900******************************************************************02990001
030000     COPY SVWS004.                                                03000001
030100*---------------------------------------------------------------* 03010001
030200*    KMC APPROVAL NUMBER COPYBOOK.                              * 03020001
030300*---------------------------------------------------------------* 03030001
030400     COPY SVWS006.                                                03040001
030500                                                                  03050001
030600*---------------------------------------------------------------* 03060001
030700*    CHECK DIGIT ROUTINE COPYBOOK.                              * 03070001
030800*---------------------------------------------------------------* 03080001
030900     COPY DPWS036.                                                03090001
031000                                                                  03100001
031100*---------------------------------------------------------------* 03110001
031200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03120001
031300*---------------------------------------------------------------* 03130001
031400                                                                  03140001
031500     COPY DPWS015.                                                03150001
031600                                                                  03160001
031700*---------------------------------------------------------------* 03170001
031800*    FUNCTION KEYS COPYBOOK.                                    * 03180001
031900*---------------------------------------------------------------* 03190001
032000                                                                  03200001
032100     COPY DPWS016.                                                03210001
032200                                                                  03220001
032300*---------------------------------------------------------------* 03230001
032400*    NUMERIC EDIT LAYOUT.                                       * 03240001
032500*---------------------------------------------------------------* 03250001
032600                                                                  03260001
032700     COPY DPWS010I.                                               03270001
032800*---------------------------------------------------------------* 03280001
032900*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03290008
033000*---------------------------------------------------------------* 03300001
033100                                                                  03310001
033200     COPY DPWS030.                                                03320001
CICS       COPY DPWS930.                                                03321008
033300*---------------------------------------------------------------* 03330001
033400*    STANDARD COMMAREA.                                         * 03340001
033500*---------------------------------------------------------------* 03350001
033600                                                                  03360001
033700     COPY DPWS020.                                                03370001
033800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03380001
033900                                                                  03390001
034000*---------------------------------------------------------------* 03400001
034100* INTER-APPLICATION COMMAREA.                                   * 03410001
034200*   RDWS020 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03420001
034300*             SPEC SCREEN.                                      * 03430001
034400*   RDWS021 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03440001
034500*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03450001
034600*   RDWS023 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03460001
034700*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION     * 03470001
034800*             TO THE COMMENT SCREEN.                            * 03480001
034900*   SAWS031 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03490001
035000*             THIS LIST PROGRAM TO SAKCS426                     * 03500001
035100*---------------------------------------------------------------* 03510001
035110                                                                  03511001
035120         10  INTER-APPL-COMM-AREA       PIC X(200).               03512001
035130     COPY RDWS020.                                                03513001
035140     COPY RDWS021.                                                03514001
035150     COPY RDWS023.                                                03515001
035160     COPY SAWS031.                                                03516001
035170*---------------------------------------------------------------* 03517001
035180*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03518001
035190*---------------------------------------------------------------* 03519001
035200         10  ASC-SPECIFIC-COMMAREA.                               03520001
035300             15  ASC-LIST-KEYS.                                   03530001
035400                 20  ASC-KEY-CARD-ID                 PIC  9(13).  03540001
035500                 20  ASC-NAV-CARD-ID  REDEFINES                   03550001
035600                                           ASC-KEY-CARD-ID.       03560001
035700                     25  ASC-NAV-10-DIGIT            PIC  9(10).  03570001
035800                     25  ASC-NAV-3-DIGIT             PIC  9(03).  03580001
035900             15  ASC-SHORT-CARD-ID                   PIC  9(12).  03590001
036000             15  ASC-CONTROL-NBR                     PIC  9(14).  03600001
036100             15  ASC-ASSIGNED-STORE                  PIC  9(04).  03610001
036200             15  ASC-CARD-STATUS                     PIC  X(02).  03620001
036300             15  ASC-CARD-STATUS-DESC                PIC  X(14).  03630001
036400             15  ASC-CARD-TYPE-CDE                   PIC  X(01).  03640001
036500             15  ASC-CARD-TYPE-DESC                  PIC  X(10).  03650001
036600             15  ASC-BALANCE                         PIC          03660001
036700                                                    S9(07)V99.    03670001
036800             15  ASC-FEES                            PIC          03680001
036900                                                    S9(06)V99.    03690001
037000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03700001
037100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03710001
037200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03720001
037300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03730001
037400                                                                  03740001
037500                 20  ASC-ITEM-ARRAY.                              03750001
037600                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        03760001
037700                         30  ASC-LIST-ITEM-NUMBER                 03770001
037800                                                     PIC S9(09)   03780001
037900                                                     COMP-3.      03790001
038000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03800001
038100                             88  ASC-VALID-SELECT    VALUE ' '    03810001
038200                                                           'S'    03820001
038210                                                           's'    03821005
038300                                                           'B'    03830001
038310                                                           'b'    03831005
038400                                                           'E'    03840001
038410                                                           'e'.   03841005
038500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03850001
038600                             88  ASC-TEMP-SELECT     VALUE 'S'    03860001
038610                                                           's'.   03861005
038700                             88  ASC-TEMP-BEGIN      VALUE 'B'    03870001
038710                                                           'b'.   03871005
038800                             88  ASC-TEMP-END        VALUE 'E'    03880001
038810                                                           'e'.   03881005
038900                         30  ASC-SELECTED-SW         PIC  X(01).  03890001
039000                             88  ASC-NO-SELECT       VALUE ' '.   03900001
039100                             88  ASC-SELECT          VALUE 'S'    03910001
039110                                                           's'.   03911005
039200                             88  ASC-BEGIN           VALUE 'B'    03920001
039210                                                           'b'.   03921005
039300                             88  ASC-END             VALUE 'E'    03930001
039310                                                           'e'.   03931005
039400                         30  ASC-POS-DATE-ISO        PIC  X(10).  03940001
039500                         30  ASC-STORE-NBR           PIC  9(04).  03950001
039600                         30  ASC-TERMINAL            PIC  X(04).  03960001
039700                         30  ASC-TRANSACTION         PIC  X(04).  03970001
039800                         30  ASC-REVERSAL-IND        PIC  9(01).  03980001
039900                         30  ASC-VOID-IND            PIC  X(01).  03990001
040000                         30  ASC-ACTIVITY-TYPE-DESC  PIC  X(07).  04000001
040100                         30  ASC-AMOUNT              PIC          04010001
040200                                                     S9(07)V99.   04020001
040300                         30  ASC-AUTO-MANUAL         PIC  X(01).  04030001
040400                         30  ASC-USERID              PIC  X(11).  04040001
040500                         30  ASC-APPROVAL-NUMBER     PIC  X(06).  04050001
040600                         30  ASC-ACTIVITY-STATUS     PIC  X(13).  04060001
040700                         30  ASC-TRN-AUTH-TMST       PIC  X(26).  04070001
040800                                                                  04080001
040900             15  ASC-BLK-SUB                         PIC S9(04)   04090001
041000                                                          COMP    04100001
041100                                                          SYNC.   04110001
041200             15  ASC-ITEM-SUB                        PIC S9(04)   04120001
041300                                                          COMP    04130001
041400                                                          SYNC.   04140001
041500             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04150001
041600                                                          COMP-3. 04160001
041700             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04170001
041800                                                          COMP-3. 04180001
041900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04190001
042000                                                          COMP-3. 04200001
042100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04210001
042200                                                          COMP-3. 04220001
042300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04230001
042400                                                          COMP-3. 04240001
042500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04250001
042600                                                          COMP    04260001
042700                                                          SYNC.   04270001
042800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04280001
042900                                                          COMP-3. 04290001
043000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04300001
043100                                                          COMP-3. 04310001
043200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04320001
043300                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04330001
043400                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04340001
043500             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04350001
043600                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04360001
043700                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04370001
043800             15  ASC-LIST-QUEUE-NAME.                             04380001
043900                 20  ASC-LIST-TERM-ID                PIC  X(04).  04390001
044000                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04400001
044100                                                          COMP-3. 04410001
044200                 20  ASC-LIST-SEQ                    PIC  9(01).  04420001
044300             15  ASC-SEL-QUEUE-NAME.                              04430001
044400                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04440001
044500                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04450001
044600                                                          COMP-3. 04460001
044700                 20  ASC-SEL-SEQ                     PIC  9(01).  04470001
044800                                                                  04480001
044900             15  ASC-START-ITEM-REQUEST.                          04490001
045000                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04500001
045100             15  ASC-CLOSED-DATE                     PIC  X(10).  04510001
045200             15  ASC-FORMAT-IND                      PIC  X(01).  04520001
045300             15  ASC-30-DIGIT-CARD-NBR               PIC  X(30).  04530001
045310         10  FILLER                                  PIC  X(178). 04531005
045400*----------------------------------------------------------------*04540001
045500*    DATE/TIME COPYBOOK.                                         *04550001
045600*----------------------------------------------------------------*04560001
045700                                                                  04570001
045800     COPY DPWS017.                                                04580001
045900*---------------------------------------------------------------* 04590001
046000*    ABEND PROCESSING COPYBOOK.                                 * 04600001
046100*---------------------------------------------------------------* 04610001
046200                                                                  04620001
046300     COPY DPWS013.                                                04630001
046400                                                                  04640001
046500*---------------------------------------------------------------* 04650001
046600*    DB2 AREA FOR SVT_KOHLS_CRD_ACCT                            * 04660001
046700*---------------------------------------------------------------* 04670001
046800     EXEC SQL                                                     04680001
046900          INCLUDE SVT00001                                        04690001
047000     END-EXEC.                                                    04700001
047100*---------------------------------------------------------------* 04710001
047200*    DB2 AREA FOR SVT_KOHLS_CRD_TXN                             * 04720001
047300*---------------------------------------------------------------* 04730001
047400     EXEC SQL                                                     04740001
047500          INCLUDE SVT00002                                        04750001
047600     END-EXEC.                                                    04760001
047700*---------------------------------------------------------------* 04770001
047800*    DB2 AREA FOR SVT_CRD_ACCT_HIST                             * 04780001
047900*---------------------------------------------------------------* 04790001
048000     EXEC SQL                                                     04800001
048100          INCLUDE SVT00005                                        04810001
048200     END-EXEC.                                                    04820001
048300*---------------------------------------------------------------* 04830001
048400*    DB2 AREA FOR SVT_CRD_TXN_HIST                              * 04840001
048500*---------------------------------------------------------------* 04850001
048600     EXEC SQL                                                     04860001
048700          INCLUDE SVT00006                                        04870001
048800     END-EXEC.                                                    04880001
048900*---------------------------------------------------------------* 04890001
049000*    DB2 AREA FOR COMMUNICATIONS                                * 04900001
049100*---------------------------------------------------------------* 04910001
049200     EXEC SQL                                                     04920001
049300          INCLUDE SQLCA                                           04930001
049400     END-EXEC.                                                    04940001
049500                                                                  04950001
049600*---------------------------------------------------------------* 04960001
049700*    CURSOR TO DISPLAY THE CARD ACTIVITY HISTORY.               * 04970001
049800*---------------------------------------------------------------* 04980001
049900                                                                  04990001
050000     EXEC SQL                                                     05000001
050100          DECLARE CARD-CSR CURSOR                                 05010001
050200          FOR SELECT                                              05020001
050300                TRN_AUTH_TMST                                     05030001
050400              , TRN_RVRSL_CDE                                     05040001
050500              , TRN_VOID_IND                                      05050001
050600              , ACTVY_TYP_CDE                                     05060001
050700              , POS_DTE                                           05070001
050800              , STR_NBR                                           05080001
050900              , POS_TRMNL_NBR                                     05090001
051000              , POS_TRN_NBR                                       05100001
051100              , APP_AUTH_AMT                                      05110001
051200              , POS_OPRT_ID                                       05120001
051300              , APVL_USR_ID                                       05130001
051400              , ACTVY_STAT_CDE                                    05140001
051500          FROM                                                    05150001
051600                SVT_KOHLS_CRD_TXN                                 05160001
051700          WHERE                                                   05170001
051800                CRD_NBR        = :DK-CARD-ID                      05180001
051900          ORDER BY                                                05190001
052000                TRN_AUTH_TMST DESC                                05200001
052010          WITH UR                                                 05201005
052100     END-EXEC.                                                    05210001
052200*---------------------------------------------------------------* 05220001
052300*    CURSOR TO DISPLAY THE CARD HISTORY ACTIVITY                * 05230001
052400*---------------------------------------------------------------* 05240001
052500                                                                  05250001
052600     EXEC SQL                                                     05260001
052700          DECLARE HIST-CSR CURSOR                                 05270001
052800          FOR SELECT                                              05280001
052900                TRN_AUTH_TMST                                     05290001
053000              , TRN_RVRSL_CDE                                     05300001
053100              , TRN_VOID_IND                                      05310001
053200              , ACTVY_TYP_CDE                                     05320001
053300              , POS_DTE                                           05330001
053400              , STR_NBR                                           05340001
053500              , POS_TRMNL_NBR                                     05350001
053600              , POS_TRN_NBR                                       05360001
053700              , APP_AUTH_AMT                                      05370001
053800              , POS_OPRT_ID                                       05380001
053900              , APVL_USR_ID                                       05390001
054000              , ACTVY_STAT_CDE                                    05400001
054100          FROM                                                    05410001
054200                SVT_CRD_TXN_HIST                                  05420001
054300          WHERE                                                   05430001
054400                CRD_NBR        = :DK-CARD-ID                      05440001
054500          ORDER BY                                                05450001
054600                TRN_AUTH_TMST DESC                                05460001
054610          WITH UR                                                 05461005
054700     END-EXEC.                                                    05470001
054800                                                                  05480001
054900 LINKAGE SECTION.                                                 05490001
055000                                                                  05500001
055100 01  DFHCOMMAREA.                                                 05510001
055200     05  FILLER                         OCCURS  1 TO 4072 TIMES   05520001
055300                                        DEPENDING ON EIBCALEN.    05530001
055400         10  FILLER                     PIC X.                    05540001
055500                                                                  05550001
055600 PROCEDURE DIVISION.                                              05560001
055700*----------------------------------------------------------------*05570001
055800*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *05580001
055900*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *05590001
056000*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *05600001
056100*----------------------------------------------------------------*05610001
056200 0000-MAIN-MODULE.                                                05620001
056300     INITIALIZE DP030-CICS-API-FIELDS.                            05630001
056400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05640001
056500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05650001
056600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05660001
056700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05670001
056800     MOVE LENGTH OF RD025AI        TO DP030-MAP-LENGTH (1).       05680001
056900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05690001
057000     PERFORM 0001-CALL-CICS-ARCH-API.                             05700001
057100                                                                  05710001
057200     PERFORM 1000-CONTROL-PROCESSING.                             05720001
057300                                                                  05730001
057400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05740001
057500     PERFORM 0001-CALL-CICS-ARCH-API.                             05750001
057600                                                                  05760001
057700*----------------------------------------------------------------*05770001
057800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *05780001
057900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *05790001
058000*----------------------------------------------------------------*05800001
058100 0001-CALL-CICS-ARCH-API.                                         05810001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05820008
058300                                    DFHCOMMAREA                   05830008
058400                                    DP030-CICS-API-FIELDS         05840008
058500                                    DP020-STANDARD-COMMAREA       05850008
058600                                    RD025AI.                      05860008
058700                                                                  05870001
058800     IF  DP030-RC-CALL-SUCCESSFUL                                 05880001
058900         CONTINUE                                                 05890001
059000     ELSE                                                         05900001
059100         SET DP013-NO-ROLLBACK                                    05910001
059200             DP013-XCTL-DISPLAY-RESTART                           05920001
059300             DP013-CICS-ABEND      TO TRUE                        05930001
059400         MOVE '0001-CALL-CICS-ARCH-API'                           05940001
059500                                   TO DP013-PARAGRAPH             05950001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05951008
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05952008
059800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05980001
059900         PERFORM DP013-0000-PROCESS-ABEND                         05990001
060000     END-IF.                                                      06000001
060100*----------------------------------------------------------------*06010001
060200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06020001
060300* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06030001
060400*                                                                *06040001
060500* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06050001
060600*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06060001
060700*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06070001
060800*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06080001
060900*----------------------------------------------------------------*06090001
061000                                                                  06100001
061100 1000-CONTROL-PROCESSING.                                         06110001
061200                                                                  06120001
061300     EVALUATE TRUE                                                06130001
061400         WHEN DP020-NEXT-ACT-INITIAL                              06140001
061500             INITIALIZE ASC-SPECIFIC-COMMAREA                     06150001
061600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06160001
061700                                      ASC-SEL-TERM-ID             06170001
061800             MOVE DP020-SRC-TASK-NUMBER                           06180001
061900                                   TO ASC-LIST-TASK-NUMBER        06190001
062000                                      ASC-SEL-TASK-NUMBER         06200001
062100             MOVE PC-LIST-QUEUE-SEQ                               06210001
062200                                   TO ASC-LIST-SEQ                06220001
062300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06230001
062400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06240001
062500***-----$TEMPLATE NOTE$-------------------------------------------06250001
062600*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06260001
062700*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06270001
062800*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06280001
062900***---------------------------------------------------------------06290001
063000             IF  PS-COMMAREA-NOT-VALID                            06300001
063100                 SET DP020-MSG-FATAL                              06310001
063200                                   TO TRUE                        06320001
063300                 SET DP020-NEXT-ACT-APPL-ERROR                    06330001
063400                                   TO TRUE                        06340001
063500             ELSE                                                 06350001
063600                 PERFORM 4000-BUILD-INITIAL-PANEL                 06360001
063700             END-IF                                               06370001
063800                                                                  06380001
063900         WHEN DP020-NEXT-ACT-READ-MAP                             06390001
064000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06400001
064100                                   TO PV-TOP-ITEM                 06410001
064200             PERFORM 2000-PROCESS-PANEL                           06420001
064300                                                                  06430001
064400         WHEN DP020-NEXT-ACT-RETURN                               06440001
064500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06450001
064600                                   TO PV-TOP-ITEM                 06460001
064700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06470001
064800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06480001
064900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06490001
065000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06500001
065100                                                                  06510001
065200         WHEN OTHER                                               06520001
065300             SET DP013-LOGIC-ABEND TO TRUE                        06530001
065400             SET DP013-NO-ROLLBACK TO TRUE                        06540001
065500             MOVE '1000-CONTROL-PROCESSING'                       06550001
065600                                   TO DP013-PARAGRAPH             06560001
065700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06570001
065800                                   TO DP013-MESSAGE-TEXT(1)       06580001
065900             PERFORM DP013-0000-PROCESS-ABEND                     06590001
066000     END-EVALUATE.                                                06600001
066100                                                                  06610001
066200*----------------------------------------------------------------*06620001
066300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06630001
066400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06640001
066500*----------------------------------------------------------------*06650001
066600                                                                  06660001
066700 1100-PROCESS-INTER-APPL-COMM.                                    06670001
066800                                                                  06680001
066900     SET PS-COMMAREA-VALID         TO TRUE.                       06690001
067000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06700001
067100                                                                  06710001
067200     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT           06720001
067300         IF RD020-CARD-ID = ZERO                                  06730001
067400             SET PS-COMMAREA-NOT-VALID                            06740001
067500                                   TO  TRUE                       06750001
067600*            --- ENTRY OF FIELD IS REQUIRED ---                   06760001
067700             MOVE PC-TSYMSG-00330  TO DP020-MSG-NUMBER            06770001
067800         END-IF                                                   06780001
067900         MOVE RD020-CARD-ID        TO ASC-KEY-CARD-ID             06790001
068000         IF RD020-30-DIGIT-CARD-NBR = ZERO                        06800005
068100           MOVE RD020-CARD-ID      TO SV007-CARD-NUMBER-IN9       06810005
068101         ELSE                                                     06810105
068102         MOVE RD020-30-DIGIT-CARD-NBR                             06810201
068103                                   TO SV007-CARD-NUMBER-IN        06810301
068104         END-IF                                                   06810405
068120     ELSE                                                         06812001
068130         MOVE DP020-NAV-KEY-DATA   TO SV007-CARD-NUMBER-IN        06813005
069500     END-IF.                                                      06950001
069600                                                                  06960005
069700     MOVE 0                        TO SV007-CARD-NUMBER-LENGTH    06970005
069800     SET SV007-FORMAT-IN           TO TRUE                        06980005
069900     PERFORM SV007-FORMAT-CARD                                    06990005
070000     MOVE SV007-CARD-NUMBER        TO ASC-30-DIGIT-CARD-NBR       07000005
070100     MOVE SV007-CARD-NBR           TO DK-CARD-ID                  07010005
070200                                      ASC-SHORT-CARD-ID           07020005
070201                                      ASC-KEY-CARD-ID.            07020105
070202                                                                  07020205
070203     IF PS-COMMAREA-VALID                                         07020301
070204         SET PS-ITEMS-FOUND TO TRUE                               07020401
070205         PERFORM 1150-GET-CARD-INFO                               07020501
070206         IF PS-ITEMS-NOT-FOUND                                    07020601
070207            PERFORM 1160-GET-HIST-INFO                            07020701
070208         END-IF                                                   07020801
070300     END-IF.                                                      07030001
070400                                                                  07040001
070500*----------------------------------------------------------------*07050001
070600*    FETCH THE CARD STATUS AND CONTROL NUMBER FROM TKMCTBL       *07060001
070700*----------------------------------------------------------------*07070001
070800                                                                  07080001
070900 1150-GET-CARD-INFO.                                              07090001
071000                                                                  07100001
071100     EXEC SQL                                                     07110001
071200         SELECT CRD_STAT_CDE                                      07120001
071300               ,CRD_PROD_YR                                       07130001
071400               ,SHIPT_REQ_NBR                                     07140001
071500               ,CNTL_NBR                                          07150001
071600               ,STR_NBR                                           07160001
071700               ,CRD_TYP_CDE                                       07170001
071800               ,CRD_CLO_DTE                                       07180001
071900           INTO :SVT00001-CRD-STAT-CDE                            07190001
072000               ,:SVT00001-CRD-PROD-YR                             07200001
072100               ,:SVT00001-SHIPT-REQ-NBR                           07210001
072200               ,:SVT00001-CNTL-NBR                                07220001
072300               ,:SVT00001-STR-NBR                                 07230001
072400               ,:SVT00001-CRD-TYP-CDE                             07240001
072500               ,:SVT00001-CRD-CLO-DTE                             07250001
072600           FROM SVT_KOHLS_CRD_ACCT                                07260001
072700          WHERE CRD_NBR = :DK-CARD-ID                             07270001
072710          WITH UR                                                 07271005
072800     END-EXEC.                                                    07280001
072900                                                                  07290001
073000     EVALUATE TRUE                                                07300001
073100       WHEN SQLCODE = ZERO                                        07310001
073200           MOVE SVT00001-CRD-CLO-DTE    TO ASC-CLOSED-DATE        07320001
073300           MOVE SVT00001-CRD-STAT-CDE                             07330001
073400                                   TO ASC-CARD-STATUS             07340001
073500           MOVE SVT00001-CNTL-NBR       TO PV-CNTL-NBR            07350001
073600           MOVE SVT00001-CRD-PROD-YR    TO PV-CRD-PROD-YR         07360001
073700           MOVE SVT00001-SHIPT-REQ-NBR  TO PV-SHIPT-REQ-NBR       07370001
073800           MOVE PV-CONTROL-NBR          TO ASC-CONTROL-NBR        07380001
073900           MOVE SVT00001-STR-NBR   TO ASC-ASSIGNED-STORE          07390001
074000           MOVE SVT00001-CRD-TYP-CDE TO ASC-CARD-TYPE-CDE         07400001
074100           SET SV004-CARD-ST-IDX   TO 1                           07410001
074200           SEARCH SV004-CARD-ST-OCC                               07420001
074300               AT END                                             07430001
074400                   MOVE SPACES     TO ASC-CARD-STATUS-DESC        07440001
074500               WHEN SV004-CARD-ST-CD (SV004-CARD-ST-IDX)          07450001
074600                                   = SVT00001-CRD-STAT-CDE        07460001
074700                   MOVE SV004-CARD-ST-SDESC (SV004-CARD-ST-IDX)   07470001
074800                                   TO ASC-CARD-STATUS-DESC        07480001
074900           END-SEARCH                                             07490001
075000           SET SV004-CARD-TYP-IDX  TO 1                           07500001
075100           IF SVT00001-CRD-STAT-CDE = 'HQ'                        07510001
075200              MOVE SVT00001-CRD-CLO-DTE TO ASC-CLOSED-DATE        07520001
075300           ELSE                                                   07530001
075400              MOVE SPACES               TO ASC-CLOSED-DATE        07540001
075500           END-IF                                                 07550001
075600           SEARCH SV004-CARD-TYP-OCC                              07560001
075700               AT END                                             07570001
075800                   MOVE SPACES     TO ASC-CARD-TYPE-DESC          07580001
075900               WHEN SV004-CARD-TYP-CD (SV004-CARD-TYP-IDX)        07590001
076000                                   = SVT00001-CRD-TYP-CDE         07600001
076100                   MOVE SV004-CARD-TYP-DESC (SV004-CARD-TYP-IDX)  07610001
076200                                   TO ASC-CARD-TYPE-DESC          07620001
076300           END-SEARCH                                             07630001
076400       WHEN SQLCODE = +100                                        07640001
076500*         SET PS-COMMAREA-NOT-VALID TO  TRUE                      07650001
076600*         --- CARD ID NOT FOUND ---                               07660001
076700          SET PS-ITEMS-NOT-FOUND TO TRUE                          07670001
076800*         MOVE PC-TSYMSG-01210      TO DP020-MSG-NUMBER           07680001
076900       WHEN OTHER                                                 07690001
077000          MOVE '1150-GET-CARD-STATUS'                             07700001
077100                                   TO DP013-PARAGRAPH             07710001
077200          MOVE 'UNABLE TO SELECT CARD ID'                         07720001
077300                                   TO DP013-MESSAGE-TEXT (1)      07730001
077400          MOVE SQLCA               TO DP013-SQLCA                 07740001
077500          MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)   07750001
077600          SET DP013-DB2-ABEND      TO TRUE                        07760001
077700          PERFORM DP013-0000-PROCESS-ABEND                        07770001
077800     END-EVALUATE.                                                07780001
077900*                                                                 07790001
078000*----------------------------------------------------------------*07800001
078100*    FETCH THE CARD STATUS AND CONTROL NUMBER FROM TKMCHTB       *07810001
078200*----------------------------------------------------------------*07820001
078300                                                                  07830001
078400 1160-GET-HIST-INFO.                                              07840001
078500                                                                  07850001
078600     EXEC SQL                                                     07860001
078700         SELECT CRD_STAT_CDE                                      07870001
078800               ,CRD_PROD_YR                                       07880001
078900               ,SHIPT_REQ_NBR                                     07890001
079000               ,CNTL_NBR                                          07900001
079100               ,STR_NBR                                           07910001
079200               ,CRD_TYP_CDE                                       07920001
079300               ,CRD_CLO_DTE                                       07930001
079400           INTO :SVT00005-CRD-STAT-CDE                            07940001
079500               ,:SVT00005-CRD-PROD-YR                             07950001
079600               ,:SVT00005-SHIPT-REQ-NBR                           07960001
079700               ,:SVT00005-CNTL-NBR                                07970001
079800               ,:SVT00005-STR-NBR                                 07980001
079900               ,:SVT00005-CRD-TYP-CDE                             07990001
080000               ,:SVT00005-CRD-CLO-DTE                             08000001
080100           FROM SVT_CRD_ACCT_HIST                                 08010001
080200          WHERE CRD_NBR = :DK-CARD-ID                             08020001
080210          WITH UR                                                 08021005
080300     END-EXEC.                                                    08030001
080400                                                                  08040001
080500     EVALUATE TRUE                                                08050001
080600       WHEN SQLCODE = ZERO                                        08060001
080700           MOVE SVT00005-CRD-STAT-CDE                             08070001
080800                                   TO ASC-CARD-STATUS             08080001
080900           MOVE SVT00005-CNTL-NBR       TO PV-CNTL-NBR            08090001
081000           MOVE SVT00005-CRD-PROD-YR    TO PV-CRD-PROD-YR         08100001
081100           MOVE SVT00005-SHIPT-REQ-NBR  TO PV-SHIPT-REQ-NBR       08110001
081200           MOVE PV-CONTROL-NBR          TO ASC-CONTROL-NBR        08120001
081300           MOVE SVT00005-STR-NBR   TO ASC-ASSIGNED-STORE          08130001
081400           MOVE SVT00005-CRD-TYP-CDE TO ASC-CARD-TYPE-CDE         08140001
081500           SET SV004-CARD-ST-IDX   TO 1                           08150001
081600           SEARCH SV004-CARD-ST-OCC                               08160001
081700               AT END                                             08170001
081800                   MOVE SPACES     TO ASC-CARD-STATUS-DESC        08180001
081900               WHEN SV004-CARD-ST-CD (SV004-CARD-ST-IDX)          08190001
082000                                   = SVT00005-CRD-STAT-CDE        08200001
082100                   MOVE SV004-CARD-ST-SDESC (SV004-CARD-ST-IDX)   08210001
082200                                   TO ASC-CARD-STATUS-DESC        08220001
082300           END-SEARCH                                             08230001
082400           SET SV004-CARD-TYP-IDX  TO 1                           08240001
082500           MOVE SVT00005-CRD-CLO-DTE TO ASC-CLOSED-DATE           08250001
082600           SEARCH SV004-CARD-TYP-OCC                              08260001
082700               AT END                                             08270001
082800                   MOVE SPACES     TO ASC-CARD-TYPE-DESC          08280001
082900               WHEN SV004-CARD-TYP-CD (SV004-CARD-TYP-IDX)        08290001
083000                                   = SVT00005-CRD-TYP-CDE         08300001
083100                   MOVE SV004-CARD-TYP-DESC (SV004-CARD-TYP-IDX)  08310001
083200                                   TO ASC-CARD-TYPE-DESC          08320001
083300           END-SEARCH                                             08330001
083400       WHEN SQLCODE = +100                                        08340001
083500          SET PS-COMMAREA-NOT-VALID TO  TRUE                      08350001
083600*         --- CARD ID NOT FOUND ---                               08360001
083700          MOVE PC-TSYMSG-01210      TO DP020-MSG-NUMBER           08370001
083800       WHEN OTHER                                                 08380001
083900          MOVE '1160-GET-HIST-STATUS'                             08390001
084000                                   TO DP013-PARAGRAPH             08400001
084100          MOVE 'UNABLE TO SELECT CARD ID'                         08410001
084200                                   TO DP013-MESSAGE-TEXT (1)      08420001
084300          MOVE SQLCA               TO DP013-SQLCA                 08430001
084400          MOVE 'SVT_CRD_ACCT_HIST' TO DP013-DB2-TABLE-NAME (1)    08440001
084500          SET DP013-DB2-ABEND      TO TRUE                        08450001
084600          PERFORM DP013-0000-PROCESS-ABEND                        08460001
084700     END-EVALUATE.                                                08470001
084800                                                                  08480001
086000*----------------------------------------------------------------*08600001
086100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITING OF THE DATA    *08610001
086200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08620001
086300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08630001
086400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08640001
086500* FUNCTION KEYS CAN GET THIS FAR.                                *08650001
086600*----------------------------------------------------------------*08660001
086700                                                                  08670001
086800 2000-PROCESS-PANEL.                                              08680001
086900     EVALUATE TRUE                                                08690001
087000         WHEN DP020-SRC-AID = DP016-CLEAR                         08700001
087100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08710001
087200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08720001
087300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08730001
087400                                                                  08740001
087500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08750001
087600             PERFORM 2050-DELETE-LIST-QUEUE                       08760001
087700             PERFORM 4000-BUILD-INITIAL-PANEL                     08770001
087800                                                                  08780001
087900         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    08790001
088000             PERFORM 2140-DESELECT-ALL-ITEMS                      08800001
088100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08810001
088200                                                                  08820001
088300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08830001
088400             PERFORM 2150-SELECT-ALL-ITEMS                        08840001
088500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08850001
088600                                                                  08860001
088700         WHEN OTHER                                               08870001
088800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08880001
088900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08890001
089000             IF  PS-NO-ERROR                                      08900001
089100                 SET DP030-CONTINUE-GO                            08910001
089200                                   TO TRUE                        08920001
089300                 PERFORM 2100-CHECK-FUNCTION-KEY                  08930001
089400             ELSE                                                 08940001
089500                 SET DP030-OVERRIDE-GO                            08950001
089600                                   TO TRUE                        08960001
089700             END-IF                                               08970001
089800     END-EVALUATE.                                                08980001
089900*----------------------------------------------------------------*08990001
090000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *09000001
090100*----------------------------------------------------------------*09010001
090200 2050-DELETE-LIST-QUEUE.                                          09020001
090300                                                                  09030001
090400     EXEC CICS                                                    09040001
090500         DELETEQ TS                                               09050001
090600             QUEUE (ASC-LIST-QUEUE-NAME)                          09060001
090700             RESP  (PV-CICS-RESP)                                 09070001
090800     END-EXEC.                                                    09080001
090900                                                                  09090001
091000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09100001
091100        (PV-CICS-RESP = DFHRESP(QIDERR))                          09110001
091200         CONTINUE                                                 09120001
091300     ELSE                                                         09130001
091400         SET DP013-CICS-ABEND      TO TRUE                        09140001
091500         SET DP013-NO-ROLLBACK     TO TRUE                        09150001
091600                                                                  09160001
091700         MOVE '2050-DELETE-LIST-QUEUE'                            09170001
091800                                   TO DP013-PARAGRAPH             09180001
091900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09190001
092000                                   TO DP013-MESSAGE-TEXT (1)      09200001
092100         PERFORM DP013-0000-PROCESS-ABEND                         09210001
092200     END-IF.                                                      09220001
092300                                                                  09230001
092400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09240001
092500*----------------------------------------------------------------*09250001
092600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09260001
092700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09270001
092800* CICS ARCHITECTURE API.                                         *09280001
092900*----------------------------------------------------------------*09290001
093000 2100-CHECK-FUNCTION-KEY.                                         09300001
093100                                                                  09310001
093200     EVALUATE TRUE                                                09320001
093300                                                                  09330001
093400*----------------------------------------------------------------*09340001
093500*    LOCAL GO TO COMMENT INQUIRY SCREEN                          *09350001
093600*----------------------------------------------------------------*09360001
093700         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               09370001
093800                                                                  09380001
093900             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO               09390001
094000                 SET DP030-OVERRIDE-GO                            09400001
094100                               TO TRUE                            09410001
094200*                --- NO LIST ITEMS CAN BE SELECTED ---            09420001
094300                 MOVE PC-TSYMSG-00778                             09430001
094400                               TO DP020-MSG-NUMBER                09440001
094500                 SET DP020-MSG-FATAL                              09450001
094600                               TO TRUE                            09460001
094700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09470001
094800             ELSE                                                 09480001
094900                 INITIALIZE RD023-INTER-APPL-COMMAREA             09490001
095000                 MOVE ASC-KEY-CARD-ID TO RD023-CARD-ID            09500001
095100                 MOVE ASC-30-DIGIT-CARD-NBR                       09510005
095101                   TO RD023-30-DIGIT-CARD-NBR                     09510105
095102             END-IF                                               09510201
095200                                                                  09520001
095300*----------------------------------------------------------------*09530001
095400*    LOCAL GO TO CORPORATE EJ SCREEN                             *09540001
095500*----------------------------------------------------------------*09550001
095600         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               09560001
095700                                                                  09570001
095800          IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO                 09580001
095900            SET DP030-OVERRIDE-GO TO TRUE                         09590001
096000*           --  A LIST ITEM MUST BE SELECTED --                   09600001
096100            MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER             09610001
096200            SET DP020-MSG-FATAL   TO TRUE                         09620001
096210          ELSE                                                    09621001
096220            IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1                  09622001
096221              SET DP030-OVERRIDE-GO TO TRUE                       09622101
096222*             --  ONLY ONE LIST ITEM MAY BE SELECTED --           09622201
096223              MOVE PC-TSYMSG-00047                                09622301
096224                                  TO DP020-MSG-NUMBER             09622401
096225              SET DP020-MSG-FATAL TO TRUE                         09622501
096226            ELSE                                                  09622601
096227              INITIALIZE SA031-INTER-APPL-COMMAREA                09622701
096228              MOVE +1             TO ASC-BLK-SUB                  09622801
096229                                     ASC-ITEM-SUB                 09622901
096230              PERFORM 2105-MOVE-EJ-FIELDS                         09623001
096240                VARYING ASC-ITEM-SUB                              09624001
096241                FROM +1 BY +1                                     09624101
096242                UNTIL ASC-ITEM-SUB > +12                          09624201
096243            END-IF                                                09624301
096244         END-IF                                                   09624401
096245*----------------------------------------------------------------*09624501
096246*    LOCAL GO TO DETAIL INQUIRY SCREEN                           *09624601
096247*----------------------------------------------------------------*09624701
096248         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  09624801
096249                                                                  09624901
096250             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              09625001
096260                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 1              09626001
096270                     SET DP030-OVERRIDE-GO                        09627001
096280                               TO TRUE                            09628001
096290*                    --- ONLY ONE LIST ITEM MAY BE SELECTED ---   09629001
096300                     MOVE PC-TSYMSG-00047                         09630001
096400                               TO DP020-MSG-NUMBER                09640001
096500                     SET DP020-MSG-FATAL                          09650001
096600                               TO TRUE                            09660001
096700                 ELSE                                             09670001
096800                     INITIALIZE RD021-INTER-APPL-COMMAREA         09680001
096900                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            09690001
097000                               TO RD021-NUMBER-OF-SELECTED-ITEMS  09700001
097100                     PERFORM 5000-PREPARE-SEL-QUEUE               09710001
097200                 END-IF                                           09720001
097300             ELSE                                                 09730001
097400                 SET DP030-OVERRIDE-GO                            09740001
097500                               TO TRUE                            09750001
097600*                --- A LIST ITEM MUST BE SELECTED ---             09760001
097700                 MOVE PC-TSYMSG-00057                             09770001
097800                               TO DP020-MSG-NUMBER                09780001
097900                 SET DP020-MSG-FATAL                              09790001
098000                               TO TRUE                            09800001
098100             END-IF                                               09810001
098200                                                                  09820001
098300*----------------------------------------------------------------*09830001
098400*    OTHER KEYS                                                  *09840001
098500*----------------------------------------------------------------*09850001
098600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09860001
098700             MOVE +1               TO PV-TOP-ITEM                 09870001
098800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09880001
098900                                                                  09890001
099000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09900001
099100             PERFORM 2110-BROWSE-BACKWARD                         09910001
099200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09920001
099300                                                                  09930001
099400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09940001
099500             PERFORM 2120-BROWSE-FORWARD                          09950001
099600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09960001
099700                                                                  09970001
099800         WHEN DP020-SRC-AID = DP016-ENTER                         09980001
099900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09990001
100000             IF  PS-ERROR                                         10000001
100100                 CONTINUE                                         10010001
100200             ELSE                                                 10020001
100300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10030001
100400             END-IF                                               10040001
100500                                                                  10050001
100600         WHEN OTHER                                               10060001
100700             SET DP013-NO-ROLLBACK                                10070001
100800                 DP013-XCTL-DISPLAY-RESTART                       10080001
100900                 DP013-CICS-ABEND  TO TRUE                        10090001
101000             MOVE '2100-CHECK-FUNCTION-KEY'                       10100001
101100                                   TO DP013-PARAGRAPH             10110001
101200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10120001
101300                                   TO DP013-MESSAGE-TEXT (1)      10130001
101400             PERFORM DP013-0000-PROCESS-ABEND                     10140001
101500     END-EVALUATE.                                                10150001
101600*----------------------------------------------------------------*10160001
101700*    MOVE FIELDS TO THE COMMAREA TO JUMP TO THE EJ SCREEN -      *10170001
101800*    SAKCS426                                                    *10180001
101900*----------------------------------------------------------------*10190001
102000 2105-MOVE-EJ-FIELDS.                                             10200001
102100     IF ASC-TEMP-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                10210001
102200         MOVE ASC-POS-DATE-ISO (ASC-BLK-SUB ASC-ITEM-SUB)         10220001
102300                               TO SA031-SALES-DATE-FROM           10230001
102400                                  SA031-SALES-DATE-TO             10240001
102500         MOVE 'N'              TO SA031-SAME-DATE-SW              10250001
102600         MOVE ASC-STORE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)            10260001
102610                               TO SA031-STORE                     10261001
102620         MOVE ASC-TERMINAL  (ASC-BLK-SUB ASC-ITEM-SUB)            10262001
102630                               TO SA031-REGISTER                  10263001
102640         MOVE ASC-TRANSACTION (ASC-BLK-SUB ASC-ITEM-SUB)          10264001
102650                               TO SA031-TRANSACTION               10265001
102660     END-IF.                                                      10266001
102670                                                                  10267001
102680*----------------------------------------------------------------*10268001
102690*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10269001
102691*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10269101
102692*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10269201
102693*    MESSAGE.                                                    *10269301
102694*----------------------------------------------------------------*10269401
102695                                                                  10269501
102696 2110-BROWSE-BACKWARD.                                            10269601
102697     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10269701
102698         GIVING PV-TOP-ITEM.                                      10269801
102699                                                                  10269901
102700     IF  ((PV-TOP-ITEM < +1)                                      10270001
102800       OR (PV-TOP-ITEM = +1))                                     10280001
102900         MOVE +1                   TO PV-TOP-ITEM                 10290001
103000*        -- TOP OF LIST --                                        10300001
103100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10310001
103200         SET DP020-MSG-INFORMATIONAL                              10320001
103300                                   TO TRUE                        10330001
103400     END-IF.                                                      10340001
103500                                                                  10350001
103600*----------------------------------------------------------------*10360001
103700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10370001
103800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10380001
103900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10390001
104000*----------------------------------------------------------------*10400001
104100                                                                  10410001
104200 2120-BROWSE-FORWARD.                                             10420001
104300                                                                  10430001
104400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10440001
104500         GIVING PV-TOP-ITEM.                                      10450001
104600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10460001
104700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10470001
104800                                   TO PV-TOP-ITEM                 10480001
104900*        -- BOTTOM OF LIST --                                     10490001
105000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10500001
105100         SET DP020-MSG-INFORMATIONAL                              10510001
105200                                   TO TRUE                        10520001
105300     ELSE                                                         10530001
105400         COMPUTE PV-BOTTOM-ITEM =                                 10540001
105500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10550001
105600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10560001
105700*            -- BOTTOM OF LIST --                                 10570001
105800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            10580001
105900             SET DP020-MSG-INFORMATIONAL                          10590001
106000                                   TO TRUE                        10600001
106100         END-IF                                                   10610001
106200     END-IF.                                                      10620001
106300*----------------------------------------------------------------*10630001
106400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *10640001
106500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *10650001
106600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *10660001
106700*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10670001
106800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10680001
106900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10690001
107000*----------------------------------------------------------------*10700001
107100                                                                  10710001
107200 2130-CHECK-FOR-JUMP-BROWSE.                                      10720001
107300     SET PS-NO-ERROR               TO TRUE.                       10730001
107400     IF (ASC-START-ITEM-REQUEST = SPACE)                          10740001
107500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10750001
107600                                   TO PV-TOP-ITEM                 10760001
107700     ELSE                                                         10770001
107800         MOVE ASC-START-ITEM-REQUEST                              10780001
107900                                   TO DP010I-UNEDITED-FIELD       10790001
108000         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       10800001
108100         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10810001
108200         SET DP010I-NEGATIVE-NOT-ALLOWED                          10820001
108300                                   TO TRUE                        10830001
108410         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10841006
108420                         USING DP010I-NUMERIC-EDIT-AREA           10842006
108500                                                                  10850001
108600         IF  NOT DP010I-ERROR-DETECTED                            10860001
108700             MOVE DP010I-NUMERIC-FIELD                            10870001
108800                                   TO  ASC-START-ITEM-REQUEST-N   10880001
108900             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10890001
109000                 IF  ASC-START-ITEM-REQUEST-N >                   10900001
109100                                          ASC-NUMBER-OF-ITEMS-READ10910001
109200                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10920001
109300                     COMPUTE PV-TOP-ITEM =                        10930001
109400                             ASC-NUMBER-OF-ITEMS-READ             10940001
109500                             - PC-ITEMS-PER-PANEL + 1             10950001
109600                     IF  PV-TOP-ITEM < +1                         10960001
109700                         MOVE +1   TO PV-TOP-ITEM                 10970001
109800                         MOVE PC-TSYMSG-00070                     10980001
109900                                   TO DP020-MSG-NUMBER            10990001
110000                         SET DP020-MSG-INFORMATIONAL              11000001
110100                                   TO TRUE                        11010001
110200                     END-IF                                       11020001
110300                 ELSE                                             11030001
110400                     MOVE ASC-START-ITEM-REQUEST-N                11040001
110500                                   TO PV-TOP-ITEM                 11050001
110600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11060001
110700                     COMPUTE PV-BOTTOM-ITEM =                     11070001
110800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11080001
110900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11090001
111000*                        -- BOTTOM OF LIST --                     11100001
111100                         MOVE PC-TSYMSG-00070                     11110001
111200                                   TO DP020-MSG-NUMBER            11120001
111300                         SET DP020-MSG-INFORMATIONAL              11130001
111400                                   TO TRUE                        11140001
111500                     END-IF                                       11150001
111600                 END-IF                                           11160001
111700             ELSE                                                 11170001
111800*                --- VALUE OUT OF RANGE ----                      11180001
111900                 MOVE PC-TSYMSG-00101                             11190001
112000                                   TO DP020-MSG-NUMBER            11200001
112100                 MOVE -1           TO ASTRTITL                    11210001
112200                 SET DP030-SET-CURSOR-APPL-1                      11220001
112300                                   TO TRUE                        11230001
112400                 MOVE DP015-REVERSE                               11240001
112500                                   TO ASTRTITH                    11250001
112600                 MOVE DP015-RED    TO ASTRTITC                    11260001
112700                 MOVE DP015-UNP-NUM-BRT-MDT                       11270001
112800                                   TO ASTRTITA                    11280001
112900                 SET DP020-MSG-FATAL                              11290001
113000                                   TO TRUE                        11300001
113100                 SET PS-ERROR      TO TRUE                        11310001
113200             END-IF                                               11320001
113300                                                                  11330001
113400         ELSE                                                     11340001
113500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11350001
113600             MOVE -1               TO ASTRTITL                    11360001
113700             SET DP030-SET-CURSOR-APPL-1                          11370001
113800                                   TO TRUE                        11380001
113900             MOVE DP015-REVERSE    TO ASTRTITH                    11390001
114000             MOVE DP015-RED        TO ASTRTITC                    11400001
114100             MOVE DP015-UNP-NUM-BRT-MDT                           11410001
114200                                   TO ASTRTITA                    11420001
114300             SET DP020-MSG-FATAL   TO TRUE                        11430001
114400             SET PS-ERROR          TO TRUE                        11440001
114500         END-IF                                                   11450001
114600     END-IF.                                                      11460001
114700*----------------------------------------------------------------*11470001
114800*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *11480001
114900*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *11490001
115000*----------------------------------------------------------------*11500001
115100 2140-DESELECT-ALL-ITEMS.                                         11510001
115200     MOVE +1                       TO ASC-BLK-SUB.                11520001
115300                                                                  11530001
115400     PERFORM 2141-CLEAR-SELECTED-INDS                             11540001
115500         VARYING ASC-ITEM-SUB                                     11550001
115600         FROM 1 BY 1                                              11560001
115700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11570001
115800                                                                  11580001
115900     ADD +1                        TO ASC-BLK-SUB.                11590001
116000                                                                  11600001
116100     PERFORM 2141-CLEAR-SELECTED-INDS                             11610001
116200         VARYING ASC-ITEM-SUB                                     11620001
116300         FROM 1 BY 1                                              11630001
116400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11640001
116500                                                                  11650001
116600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11660001
116700                                   TO PV-LIST-ITEM-NUMBER.        11670001
116800                                                                  11680001
116900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11690001
117000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11700001
117100                                                                  11710001
117200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11720001
117300        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      11730001
117400         MOVE +1                   TO ASC-BLK-SUB                 11740001
117500                                                                  11750001
117600         PERFORM 5100-WRITE-TEMP-STORAGE                          11760001
117700                                                                  11770001
117800         MOVE +1                   TO PV-BLOCK-NUMBER             11780001
117900                                                                  11790001
118000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11800001
118100             PV-FIRST-BLOCK-IN-ARRAY - 1                          11810001
118200                                                                  11820001
118300         PERFORM                                                  11830001
118400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11840001
118500                                                                  11850001
118600             PERFORM 4410-READ-TEMP-STORAGE                       11860001
118700                                                                  11870001
118800             PERFORM 2141-CLEAR-SELECTED-INDS                     11880001
118900                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11890001
119000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11900001
119100                                                                  11910001
119200             PERFORM 5100-WRITE-TEMP-STORAGE                      11920001
119300                                                                  11930001
119400             ADD +1                TO PV-BLOCK-NUMBER             11940001
119500                                                                  11950001
119600         END-PERFORM                                              11960001
119700                                                                  11970001
119800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11980001
119900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11990001
120000                                                                  12000001
120100         PERFORM                                                  12010001
120200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12020001
120300                   ASC-HIGHEST-BLOCK-WRITTEN                      12030001
120400                                                                  12040001
120500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12050001
120600                                   TO PV-BLOCK-NUMBER             12060001
120700                                                                  12070001
120800             PERFORM 4410-READ-TEMP-STORAGE                       12080001
120900                                                                  12090001
121000             PERFORM 2141-CLEAR-SELECTED-INDS                     12100001
121100                 VARYING ASC-ITEM-SUB                             12110001
121200                 FROM 1 BY 1                                      12120001
121300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12130001
121400                                                                  12140001
121500             PERFORM 5100-WRITE-TEMP-STORAGE                      12150001
121600                                                                  12160001
121700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12170001
121800                                                                  12180001
121900         END-PERFORM                                              12190001
122000                                                                  12200001
122100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12210001
122200                                   TO PV-BLOCK-NUMBER             12220001
122300                                                                  12230001
122400         PERFORM 4410-READ-TEMP-STORAGE                           12240001
122500     END-IF.                                                      12250001
122600                                                                  12260001
122700                                                                  12270001
122800     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 12280001
122900     MOVE +0                     TO ASC-START-OF-SELECTED-RANGE.  12290001
123000     MOVE +0                     TO ASC-END-OF-SELECTED-RANGE.    12300001
123100                                                                  12310001
123200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12320001
123300                                                                  12330001
123400*----------------------------------------------------------------*12340001
123500*    MARK EACH ITEM AS BEING NOT SELECTED.                       *12350001
123600*----------------------------------------------------------------*12360001
123700                                                                  12370001
123800 2141-CLEAR-SELECTED-INDS.                                        12380001
123900                                                                  12390001
124000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12400001
124100             NOT EQUAL ZERO                                       12410001
124200         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12420001
124300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12430001
124400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12440001
124500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12450001
124600                                   TO TRUE                        12460001
124700         END-IF                                                   12470001
124800     END-IF.                                                      12480001
124900                                                                  12490001
125000*----------------------------------------------------------------*12500001
125100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *12510001
125200*  FOR ALL ITEMS.                                                *12520001
125300*----------------------------------------------------------------*12530001
125400                                                                  12540001
125500 2150-SELECT-ALL-ITEMS.                                           12550001
125600                                                                  12560001
125700     MOVE +1                       TO ASC-BLK-SUB.                12570001
125800                                                                  12580001
125900     PERFORM 2151-SET-SELECTED-INDS                               12590001
126000         VARYING ASC-ITEM-SUB                                     12600001
126100         FROM 1 BY 1                                              12610001
126200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12620001
126300                                                                  12630001
126400     ADD +1                        TO ASC-BLK-SUB.                12640001
126500                                                                  12650001
126600     PERFORM 2151-SET-SELECTED-INDS                               12660001
126700         VARYING ASC-ITEM-SUB                                     12670001
126800         FROM 1 BY 1                                              12680001
126900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12690001
127000                                                                  12700001
127100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12710001
127200                                   TO PV-LIST-ITEM-NUMBER.        12720001
127300                                                                  12730001
127400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12740001
127500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12750001
127600                                                                  12760001
127700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12770001
127800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    12780001
127900         MOVE +1                   TO ASC-BLK-SUB                 12790001
128000                                                                  12800001
128100         PERFORM 5100-WRITE-TEMP-STORAGE                          12810001
128200                                                                  12820001
128300         MOVE +1                   TO PV-BLOCK-NUMBER             12830001
128400                                                                  12840001
128500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12850001
128600             PV-FIRST-BLOCK-IN-ARRAY - 1                          12860001
128700                                                                  12870001
128800         PERFORM                                                  12880001
128900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12890001
129000                                                                  12900001
129100             PERFORM 4410-READ-TEMP-STORAGE                       12910001
129200                                                                  12920001
129300             PERFORM 2151-SET-SELECTED-INDS                       12930001
129400                 VARYING ASC-ITEM-SUB                             12940001
129500                 FROM 1 BY 1                                      12950001
129600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12960001
129700                                                                  12970001
129800             PERFORM 5100-WRITE-TEMP-STORAGE                      12980001
129900                                                                  12990001
130000             ADD +1                TO PV-BLOCK-NUMBER             13000001
130100                                                                  13010001
130200         END-PERFORM                                              13020001
130300                                                                  13030001
130400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13040001
130500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13050001
130600                                                                  13060001
130700         PERFORM                                                  13070001
130800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13080001
130900                   ASC-HIGHEST-BLOCK-WRITTEN                      13090001
131000                                                                  13100001
131100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13110001
131200                                   TO PV-BLOCK-NUMBER             13120001
131300                                                                  13130001
131400             PERFORM 4410-READ-TEMP-STORAGE                       13140001
131500                                                                  13150001
131600             PERFORM 2151-SET-SELECTED-INDS                       13160001
131700                 VARYING ASC-ITEM-SUB                             13170001
131800                 FROM 1 BY 1                                      13180001
131900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13190001
132000                                                                  13200001
132100             PERFORM 5100-WRITE-TEMP-STORAGE                      13210001
132200                                                                  13220001
132300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13230001
132400                                                                  13240001
132500         END-PERFORM                                              13250001
132600                                                                  13260001
132700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13270001
132800                                   TO PV-BLOCK-NUMBER             13280001
132900                                                                  13290001
133000         PERFORM 4410-READ-TEMP-STORAGE                           13300001
133100     END-IF.                                                      13310001
133200                                                                  13320001
133300                                                                  13330001
133400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             13340001
133500                       ASC-NUMBER-OF-SELECTED-ITEMS.              13350001
133600                                                                  13360001
133700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13370001
133800                                                                  13380001
133900*----------------------------------------------------------------*13390001
134000*    MARK EACH ITEM AS BEING SELECTED.                           *13400001
134100*----------------------------------------------------------------*13410001
134200                                                                  13420001
134300 2151-SET-SELECTED-INDS.                                          13430001
134400                                                                  13440001
134500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           13450001
134600             NOT EQUAL ZERO                                       13460001
134700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13470001
134800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13480001
134900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        13490001
135000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13500001
135100                               TO  TRUE                           13510001
135200         END-IF                                                   13520001
135300     END-IF.                                                      13530001
135400*----------------------------------------------------------------*13540001
135500*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *13550001
135600*  SCREEN INTO THE COMMAREA.  ALL EDITING IS DONE IN THE COMM.   *13560001
135700*----------------------------------------------------------------*13570001
135800 2200-MOVE-SCREEN-TO-COMMAREA.                                    13580001
135900                                                                  13590001
136000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13600001
136100     MOVE +1                       TO PV-SUB.                     13610001
136200                                                                  13620001
136300     PERFORM 3100-SET-SUBSCRIPTS.                                 13630001
136400     IF  ASTRTITL > ZERO                                          13640001
136500         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      13650001
136600     ELSE                                                         13660001
136700         IF  ASTRTITF = DP015-ERASE-EOF                           13670001
136800             INITIALIZE ASC-START-ITEM-REQUEST                    13680001
136900         END-IF                                                   13690001
137000     END-IF.                                                      13700001
137100     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13710001
137200         VARYING PV-SUB                                           13720001
137300         FROM 1 BY 1                                              13730001
137400         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13740001
137500*----------------------------------------------------------------*13750001
137600*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *13760001
137700*----------------------------------------------------------------*13770001
137800 2210-MOVE-LINES-TO-COMMAREA.                                     13780001
137900     IF  MR-SELECTL (PV-SUB) > ZERO                               13790001
138000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             13800001
138100         MOVE MR-SELECTI (PV-SUB)                                 13810001
138200                                   TO ASC-TEMP-SELECTED-SW        13820001
138300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13830001
138400     ELSE                                                         13840001
138500         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13850001
138600                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     13860001
138700                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        13870001
138800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13880001
138900         END-IF                                                   13890001
139000     END-IF.                                                      13900001
139100     ADD +1                        TO ASC-ITEM-SUB.               13910001
139200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13920001
139300         ADD +1                    TO ASC-BLK-SUB                 13930001
139400         MOVE +1                   TO ASC-ITEM-SUB                13940001
139500     END-IF.                                                      13950001
139600*----------------------------------------------------------------*13960001
139700*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *13970001
139800*  COMMAREA (EDITING IS NOT DONE AGAINST THE SCREEN DIRECTLY).   *13980001
139900*----------------------------------------------------------------*13990001
140000 3000-EDIT-DATA-IN-COMMAREA.                                      14000001
140100     SET PS-NO-ERROR               TO TRUE.                       14010001
140200     PERFORM 3200-RESET-ATTRIBUTES.                               14020001
140300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14030001
140400**                                                                14040001
140500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14050001
140600* EDITING IS DONE FROM THE BOTTOM UP.                             14060001
140700**                                                                14070001
140800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14080001
140900         ASC-ITEMS-DISPLAYED - 1.                                 14090001
141000     PERFORM 3100-SET-SUBSCRIPTS.                                 14100001
141100     PERFORM 3300-EDIT-SELECTIONS                                 14110001
141200         VARYING PV-SUB                                           14120001
141300         FROM PV-SUB BY -1                                        14130001
141400         UNTIL PV-SUB < +1                                        14140001
141500                                                                  14150001
141600     IF  PS-NO-ERROR                                              14160001
141700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14170001
141800     END-IF.                                                      14180001
141900                                                                  14190001
142000     IF  ((PS-NO-ERROR)                                           14200001
142100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14210001
142200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14220001
142300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14230001
142400     END-IF.                                                      14240001
142500*----------------------------------------------------------------*14250001
142600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14260001
142700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14270001
142800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14280001
142900*                                                                *14290001
143000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14300001
143100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14310001
143200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14320001
143300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14330001
143400*----------------------------------------------------------------*14340001
143500                                                                  14350001
143600 3100-SET-SUBSCRIPTS.                                             14360001
143700                                                                  14370001
143800     COMPUTE ASC-ITEM-SUB =                                       14380001
143900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14390001
144000                                                                  14400001
144100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14410001
144200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14420001
144300                                                                  14430001
144400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14440001
144500     ELSE                                                         14450001
144600         MOVE +1                     TO ASC-BLK-SUB               14460001
144700     END-IF.                                                      14470001
144800*----------------------------------------------------------------*14480001
144900*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *14490001
145000*----------------------------------------------------------------*14500001
145100                                                                  14510001
145200 3200-RESET-ATTRIBUTES.                                           14520001
145300     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   14530001
145400     MOVE DP015-GREEN              TO ASTRTITC.                   14540001
145500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14550001
145600                                                                  14560001
145700     PERFORM                                                      14570001
145800         VARYING PV-SUB                                           14580001
145900         FROM 1 BY 1                                              14590001
146000         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        14600001
146100         MOVE DP015-UNP-ALP-NOR-OFF                               14610001
146200                                   TO MR-SELECTA (PV-SUB)         14620001
146300         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         14630001
146400         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         14640001
146500     END-PERFORM.                                                 14650001
146600*----------------------------------------------------------------*14660001
146700*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *14670001
146800*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *14680001
146900*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *14690001
147000*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *14700001
147100*----------------------------------------------------------------*14710001
147200 3300-EDIT-SELECTIONS.                                            14720001
147300     EVALUATE TRUE                                                14730001
147400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14740001
147500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14750001
147600                 CONTINUE                                         14760001
147700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14770001
147800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14780001
147900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   14790001
148000                 MOVE ASC-TEMP-SELECTED-SW                        14800001
148100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14810001
148200                                TO ASC-SELECTED-SW                14820001
148300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14830001
148400             END-IF                                               14840001
148500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14850001
148600                 = SPACE                                          14860001
148700             EVALUATE TRUE                                        14870001
148800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14880001
148900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14890001
149000                     MOVE SPACE TO ASC-SELECTED-SW                14900001
149100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14910001
149200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14920001
149300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14930001
149400                     MOVE SPACE TO ASC-SELECTED-SW                14940001
149500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14950001
149600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14960001
149700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14970001
149800                     MOVE SPACE TO ASC-SELECTED-SW                14980001
149900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14990001
150000             END-EVALUATE                                         15000001
150100*        WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           15010001
150200*            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15020001
150300*                SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15030001
150400*            END-IF                                               15040001
150500*            PERFORM 3310-EDIT-RANGE                              15050001
150600*        WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15060001
150700*            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15070001
150800*                SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15080001
150900*            END-IF                                               15090001
151000*            PERFORM 3310-EDIT-RANGE                              15100001
151100         WHEN OTHER                                               15110001
151200             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15120001
151300             SET DP020-MSG-FATAL    TO TRUE                       15130001
151400             MOVE -1                TO MR-SELECTL (PV-SUB)        15140001
151500             SET DP030-SET-CURSOR-APPL-1                          15150001
151600                                    TO TRUE                       15160001
151700             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15170001
151800             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15180001
151900             SET PS-ERROR TO TRUE                                 15190001
152000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15200001
152100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15210001
152200                 MOVE SPACE         TO ASC-SELECTED-SW            15220001
152300                                        (ASC-BLK-SUB ASC-ITEM-SUB)15230001
152400             END-IF                                               15240001
152500     END-EVALUATE.                                                15250001
152600                                                                  15260001
152700     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 15270001
152800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15280001
152900     IF  ASC-ITEM-SUB < 1                                         15290001
153000         SUBTRACT +1 FROM ASC-BLK-SUB                             15300001
153100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15310001
153200     END-IF.                                                      15320001
153300*----------------------------------------------------------------*15330001
153400*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *15340001
153500*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *15350001
153600*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *15360001
153700*  THE ENDING.                                                   *15370001
153800*----------------------------------------------------------------*15380001
153900 3310-EDIT-RANGE.                                                 15390001
154000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15400001
154100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15410001
154200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15420001
154300                                   TO ASC-SELECTED-SW             15430001
154400                                        (ASC-BLK-SUB ASC-ITEM-SUB)15440001
154500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15450001
154600         ELSE                                                     15460001
154700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15470001
154800                 CONTINUE                                         15480001
154900             ELSE                                                 15490001
155000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15500001
155100                 MOVE PC-TSYMSG-00054                             15510001
155200                                   TO DP020-MSG-NUMBER            15520001
155300                 SET DP020-MSG-FATAL                              15530001
155400                                   TO TRUE                        15540001
155500                 MOVE -1           TO MR-SELECTL (PV-SUB)         15550001
155600                 SET DP030-SET-CURSOR-APPL-1                      15560001
155700                                   TO TRUE                        15570001
155800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15580001
155900                 MOVE DP015-UNDERLINE                             15590001
156000                                   TO MR-SELECTH (PV-SUB)         15600001
156100                 SET PS-ERROR      TO TRUE                        15610001
156200             END-IF                                               15620001
156300         END-IF                                                   15630001
156400     ELSE                                                         15640001
156500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15650001
156600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15660001
156700                                   TO ASC-SELECTED-SW             15670001
156800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15680001
156900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15690001
157000         ELSE                                                     15700001
157100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15710001
157200                 CONTINUE                                         15720001
157300             ELSE                                                 15730001
157400*                -- ONLY ONE END-OF-RANGE ALLOWED --              15740001
157500                 MOVE PC-TSYMSG-00055                             15750001
157600                                   TO DP020-MSG-NUMBER            15760001
157700                 SET DP020-MSG-FATAL                              15770001
157800                                   TO TRUE                        15780001
157900                 MOVE -1           TO MR-SELECTL (PV-SUB)         15790001
158000                 SET DP030-SET-CURSOR-APPL-1                      15800001
158100                                   TO TRUE                        15810001
158200                 SET PS-ERROR      TO TRUE                        15820001
158300             END-IF                                               15830001
158400         END-IF                                                   15840001
158500     END-IF.                                                      15850001
158600                                                                  15860001
158700*----------------------------------------------------------------*15870001
158800*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *15880001
158900*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *15890001
159000*----------------------------------------------------------------*15900001
159100 3400-CHECK-RANGE-SEQUENCE.                                       15910001
159200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15920001
159300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15930001
159400       AND  ASC-START-OF-SELECTED-RANGE >                         15940001
159500                                         ASC-END-OF-SELECTED-RANGE15950001
159600*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15960001
159700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15970001
159800         SET DP020-MSG-FATAL TO TRUE                              15980001
159900         SET PS-ERROR TO TRUE                                     15990001
160000         PERFORM 3410-POSITION-AT-ERROR                           16000001
160100     END-IF.                                                      16010001
160200*----------------------------------------------------------------*16020001
160300*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *16030001
160400*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *16040001
160500*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *16050001
160600*----------------------------------------------------------------*16060001
160700 3410-POSITION-AT-ERROR.                                          16070001
160800     SET DP030-SET-CURSOR-APPL-1                                  16080001
160900                                   TO TRUE.                       16090001
161000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16100001
161100                    - PV-TOP-ITEM + 1.                            16110001
161200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16120001
161300         CONTINUE                                                 16130001
161400     ELSE                                                         16140001
161500         MOVE -1                   TO MR-SELECTL (PV-SUB)         16150001
161600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16160001
161700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16170001
161800     END-IF.                                                      16180001
161900                                                                  16190001
162000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16200001
162100                    - PV-TOP-ITEM + 1.                            16210001
162200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16220001
162300         CONTINUE                                                 16230001
162400     ELSE                                                         16240001
162500         MOVE -1                   TO MR-SELECTL (PV-SUB)         16250001
162600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16260001
162700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16270001
162800     END-IF.                                                      16280001
162900*----------------------------------------------------------------*16290001
163000*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16300001
163100*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16310001
163200*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16320001
163300*----------------------------------------------------------------*16330001
163400                                                                  16340001
163500 3500-MARK-RANGE-AS-SELECTED.                                     16350001
163600     MOVE +1                       TO  ASC-BLK-SUB.               16360001
163700     PERFORM 3510-MARK-SELECTED-INDS                              16370001
163800         VARYING ASC-ITEM-SUB                                     16380001
163900         FROM 1 BY 1                                              16390001
164000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16400001
164100                                                                  16410001
164200     ADD +1                        TO ASC-BLK-SUB.                16420001
164300     PERFORM 3510-MARK-SELECTED-INDS                              16430001
164400         VARYING ASC-ITEM-SUB                                     16440001
164500         FROM 1 BY 1                                              16450001
164600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16460001
164700                                                                  16470001
164800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16480001
164900                                   TO  PV-LIST-ITEM-NUMBER.       16490001
165000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16500001
165100         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16510001
165200               PC-ITEMS-PER-PANEL).                               16520001
165300                                                                  16530001
165400     MOVE ASC-START-OF-SELECTED-RANGE                             16540001
165500                                   TO PV-START-OF-SELECTED-RANGE. 16550001
165600     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16560001
165700         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16570001
165800               PC-ITEMS-PER-PANEL).                               16580001
165900                                                                  16590001
166000     MOVE ASC-END-OF-SELECTED-RANGE                               16600001
166100                                   TO  PV-END-OF-SELECTED-RANGE.  16610001
166200     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16620001
166300         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16630001
166400               PC-ITEMS-PER-PANEL).                               16640001
166500     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16650001
166600         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16660001
166700                                                                  16670001
166800     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16680001
166900        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16690001
167000         MOVE +1                   TO ASC-BLK-SUB                 16700001
167100         PERFORM 5100-WRITE-TEMP-STORAGE                          16710001
167200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16720001
167300             PV-FIRST-BLOCK-IN-ARRAY - 1                          16730001
167400                                                                  16740001
167500         PERFORM                                                  16750001
167600             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16760001
167700                   PV-PREV-BLOCK-IN-ARRAY                         16770001
167800             MOVE PV-FIRST-BLOCK-IN-RANGE                         16780001
167900                                   TO PV-BLOCK-NUMBER             16790001
168000             PERFORM 4410-READ-TEMP-STORAGE                       16800001
168100             PERFORM 3510-MARK-SELECTED-INDS                      16810001
168200                 VARYING ASC-ITEM-SUB                             16820001
168300                 FROM 1 BY 1                                      16830001
168400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16840001
168500             PERFORM 5100-WRITE-TEMP-STORAGE                      16850001
168600             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16860001
168700         END-PERFORM                                              16870001
168800                                                                  16880001
168900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16890001
169000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16900001
169100         PERFORM                                                  16910001
169200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16920001
169300                   PV-LAST-BLOCK-IN-RANGE                         16930001
169400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16940001
169500                                   TO PV-BLOCK-NUMBER             16950001
169600             PERFORM 4410-READ-TEMP-STORAGE                       16960001
169700             PERFORM 3510-MARK-SELECTED-INDS                      16970001
169800                 VARYING ASC-ITEM-SUB                             16980001
169900                 FROM 1 BY 1                                      16990001
170000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17000001
170100             PERFORM 5100-WRITE-TEMP-STORAGE                      17010001
170200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17020001
170300         END-PERFORM                                              17030001
170400                                                                  17040001
170500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17050001
170600                                   TO PV-BLOCK-NUMBER             17060001
170700         PERFORM 4410-READ-TEMP-STORAGE                           17070001
170800     END-IF.                                                      17080001
170900                                                                  17090001
171000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17100001
171100                                      ASC-END-OF-SELECTED-RANGE.  17110001
171200                                                                  17120001
171300*----------------------------------------------------------------*17130001
171400* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17140001
171500*----------------------------------------------------------------*17150001
171600                                                                  17160001
171700 3510-MARK-SELECTED-INDS.                                         17170001
171800                                                                  17180001
171900     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17190001
172000                                ASC-ITEM-SUB) >                   17200001
172100         ASC-START-OF-SELECTED-RANGE)                             17210001
172200     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17220001
172300                                ASC-ITEM-SUB) =                   17230001
172400         ASC-START-OF-SELECTED-RANGE)                             17240001
172500                                                                  17250001
172600         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17260001
172700                                    ASC-ITEM-SUB) <               17270001
172800             ASC-END-OF-SELECTED-RANGE)                           17280001
172900         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17290001
173000                                    ASC-ITEM-SUB) =               17300001
173100             ASC-END-OF-SELECTED-RANGE)                           17310001
173200                                                                  17320001
173300             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17330001
173400                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17340001
173500                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17350001
173600                               TO TRUE                            17360001
173700                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17370001
173800                               TO TRUE                            17380001
173900                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    17390001
174000             END-IF                                               17400001
174100         END-IF                                                   17410001
174200     END-IF.                                                      17420001
174300                                                                  17430001
174400*----------------------------------------------------------------*17440001
174500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17450001
174600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *17460001
174700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *17470001
174800*    DISPLAY THE PANEL TO USER.                                  *17480001
174900*----------------------------------------------------------------*17490001
175000                                                                  17500001
175100 4000-BUILD-INITIAL-PANEL.                                        17510001
175200                                                                  17520001
175300     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             17530001
175400                                ASC-BLOCK-ENTRIES (2).            17540001
175500     MOVE +1                 TO ASC-BLK-SUB.                      17550001
175600     SET ASC-ITEMS-LEFT-ON-DB                                     17560001
175700                             TO TRUE.                             17570001
175800                                                                  17580001
175900     MOVE +0                 TO ASC-ITEM-SUB                      17590001
176000                                ASC-NUMBER-OF-ITEMS-READ          17600001
176100                                ASC-NUMBER-OF-SELECTED-ITEMS      17610001
176200                                ASC-HIGHEST-BLOCK-WRITTEN         17620001
176300                                ASC-START-OF-SELECTED-RANGE       17630001
176400                                ASC-END-OF-SELECTED-RANGE         17640001
176500                                ASC-ITEM-AT-TOP-OF-PANEL.         17650001
176600                                                                  17660001
176700     MOVE ZERO               TO ASC-BALANCE                       17670001
176800                                ASC-FEES.                         17680001
176900                                                                  17690001
177000     PERFORM 4010-OPEN-CURSOR.                                    17700001
177100                                                                  17710001
177200     SET PS-ITEMS-FOUND TO TRUE.                                  17720001
177300     PERFORM 4300-READ-ITEMS-FROM-DB.                             17730001
177400                                                                  17740001
177500     IF PS-ITEMS-NOT-FOUND                                        17750001
177600        SET ASC-ITEMS-LEFT-ON-DB TO TRUE                          17760001
177700        PERFORM 4015-OPEN-CURSOR-HIST                             17770001
177800        PERFORM 4305-READ-ITEMS-HIST-DB                           17780001
177900        PERFORM 4025-CLOSE-CURSOR-HIST                            17790001
178000     END-IF.                                                      17800001
178100                                                                  17810001
178200     PERFORM 4020-CLOSE-CURSOR.                                   17820001
178300                                                                  17830001
178400     MOVE +1                   TO  PV-TOP-ITEM.                   17840001
178500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17850001
178600         SET DP020-NEXT-ACT-APPL-ERROR                            17860001
178700                               TO TRUE                            17870001
178800         SET DP020-MSG-INFORMATIONAL                              17880001
178900                               TO  TRUE                           17890001
179000         IF ASC-CARD-STATUS = SV004-CRD-STAT-TYP-AVAILABLE        17900001
179100*            --- CARD REQUESTED IS AVAILABLE TO BE ISSUED         17910001
179200*                     BY STORE &VAR ---                           17920001
179300             MOVE ASC-ASSIGNED-STORE                              17930001
179400                               TO  DP020-MSG-TEXT                 17940001
179500             MOVE PC-TSYMSG-01499                                 17950001
179600                               TO  DP020-MSG-NUMBER               17960001
179700         ELSE                                                     17970001
179800*            --- CARD REQUESTED IS IN &VAR STATUS ---             17980001
179900                 IF ASC-CARD-STATUS-DESC = SPACES                 17990001
180000                     MOVE 'INVALID   '                            18000001
180100                               TO  DP020-MSG-TEXT                 18010001
180200                 ELSE                                             18020001
180300                     MOVE ASC-CARD-STATUS-DESC                    18030001
180400                               TO  DP020-MSG-TEXT                 18040001
180500                 END-IF                                           18050001
180600             MOVE PC-TSYMSG-01500                                 18060001
180700                               TO  DP020-MSG-NUMBER               18070001
180800         END-IF                                                   18080001
180900     ELSE                                                         18090001
181000         MOVE -1               TO MR-SELECTL (1)                  18100001
181100         SET DP030-SET-CURSOR-APPL-1                              18110001
181200                               TO TRUE                            18120001
181300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     18130001
181400     END-IF.                                                      18140001
181500                                                                  18150001
181600*----------------------------------------------------------------*18160001
181700* OPEN THE CARD CURSOR.                                          *18170001
181800*----------------------------------------------------------------*18180001
181900                                                                  18190001
182000 4010-OPEN-CURSOR.                                                18200001
182100     EXEC SQL                                                     18210001
182200         OPEN CARD-CSR                                            18220001
182300     END-EXEC.                                                    18230001
182400     EVALUATE TRUE                                                18240001
182500         WHEN SQLCODE = ZERO                                      18250001
182600             CONTINUE                                             18260001
182700         WHEN OTHER                                               18270001
182800             MOVE '4010-OPEN-CURSOR'                              18280001
182900                               TO DP013-PARAGRAPH                 18290001
183000             MOVE 'OPEN CARD CURSOR - '                           18300001
183100                               TO DP013-MESSAGE-TEXT (1)          18310001
183200             MOVE SQLCA        TO DP013-SQLCA                     18320001
183300             MOVE 'SVT_KOHLS_CRD_TXN ' TO DP013-DB2-TABLE-NAME (1)18330001
183400             SET DP013-DB2-ABEND                                  18340001
183500                 DP013-XCTL-DISPLAY-RESTART                       18350001
183600                               TO TRUE                            18360001
183700             PERFORM DP013-0000-PROCESS-ABEND                     18370001
183800     END-EVALUATE.                                                18380001
183900*----------------------------------------------------------------*18390001
184000* OPEN THE HIST CURSOR.                                          *18400001
184100*----------------------------------------------------------------*18410001
184200                                                                  18420001
184300 4015-OPEN-CURSOR-HIST.                                           18430001
184400     EXEC SQL                                                     18440001
184500         OPEN HIST-CSR                                            18450001
184600     END-EXEC.                                                    18460001
184700     EVALUATE TRUE                                                18470001
184800         WHEN SQLCODE = ZERO                                      18480001
184900             CONTINUE                                             18490001
185000         WHEN OTHER                                               18500001
185100             MOVE '4015-OPEN-CURSOR-HIST'                         18510001
185200                               TO DP013-PARAGRAPH                 18520001
185300             MOVE 'OPEN HIST CURSOR - '                           18530001
185400                               TO DP013-MESSAGE-TEXT (1)          18540001
185500             MOVE SQLCA        TO DP013-SQLCA                     18550001
185600             MOVE 'SVT_CRD_TXN_HIST ' TO DP013-DB2-TABLE-NAME (1) 18560001
185700             SET DP013-DB2-ABEND                                  18570001
185800                 DP013-XCTL-DISPLAY-RESTART                       18580001
185900                               TO TRUE                            18590001
186000             PERFORM DP013-0000-PROCESS-ABEND                     18600001
186100     END-EVALUATE.                                                18610001
186200                                                                  18620001
186300*----------------------------------------------------------------*18630001
186400* CLOSE THE TMESSAGE CURSOR.                                     *18640001
186500*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *18650001
186600*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *18660001
186700*   USER.                                                        *18670001
186800*----------------------------------------------------------------*18680001
186900                                                                  18690001
187000 4020-CLOSE-CURSOR.                                               18700001
187100     EXEC SQL                                                     18710001
187200         CLOSE CARD-CSR                                           18720001
187300     END-EXEC.                                                    18730001
187400                                                                  18740001
187500     EVALUATE TRUE                                                18750001
187600         WHEN SQLCODE = ZERO                                      18760001
187700             CONTINUE                                             18770001
187800         WHEN OTHER                                               18780001
187900             MOVE '4020-CLOSE-CURSOR'                             18790001
188000                               TO DP013-PARAGRAPH                 18800001
188100             MOVE 'CLOSE CARD CURSOR '                            18810001
188200                               TO DP013-MESSAGE-TEXT (1)          18820001
188300             MOVE SQLCA        TO DP013-SQLCA                     18830001
188400             MOVE 'SVT_KOHLS_CRD_TXN ' TO DP013-DB2-TABLE-NAME (1)18840001
188500             SET DP013-DB2-ABEND                                  18850001
188600                 DP013-XCTL-DISPLAY-RESTART                       18860001
188700                               TO TRUE                            18870001
188800             PERFORM DP013-0000-PROCESS-ABEND                     18880001
188900     END-EVALUATE.                                                18890001
189000                                                                  18900001
189100*----------------------------------------------------------------*18910001
189200* CLOSE THE TMESSAGE CURSOR.                                     *18920001
189300*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *18930001
189400*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *18940001
189500*   USER.                                                        *18950001
189600*----------------------------------------------------------------*18960001
189700                                                                  18970001
189800 4025-CLOSE-CURSOR-HIST.                                          18980001
189900     EXEC SQL                                                     18990001
190000         CLOSE HIST-CSR                                           19000001
190100     END-EXEC.                                                    19010001
190200                                                                  19020001
190300     EVALUATE TRUE                                                19030001
190400         WHEN SQLCODE = ZERO                                      19040001
190500             CONTINUE                                             19050001
190600         WHEN OTHER                                               19060001
190700             MOVE '4025-CLOSE-CURSOR-HIST'                        19070001
190800                               TO DP013-PARAGRAPH                 19080001
190900             MOVE 'CLOSE CARD CURSOR '                            19090001
191000                               TO DP013-MESSAGE-TEXT (1)          19100001
191100             MOVE SQLCA        TO DP013-SQLCA                     19110001
191200             MOVE 'SVT_CRD_TXN_HIST ' TO DP013-DB2-TABLE-NAME (1) 19120001
191300             SET DP013-DB2-ABEND                                  19130001
191400                 DP013-XCTL-DISPLAY-RESTART                       19140001
191500                               TO TRUE                            19150001
191600             PERFORM DP013-0000-PROCESS-ABEND                     19160001
191700     END-EVALUATE.                                                19170001
191800                                                                  19180001
191900*----------------------------------------------------------------*19190001
192000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *19200001
192100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *19210001
192200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *19220001
192300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *19230001
192400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *19240001
192500*                                                                *19250001
192600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19260001
192700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19270001
192800*    UPON INITIALIZATION.                                        *19280001
192900*----------------------------------------------------------------*19290001
193000                                                                  19300001
193100 4300-READ-ITEMS-FROM-DB.                                         19310001
193200                                                                  19320001
193300     PERFORM                                                      19330001
193400         VARYING PV-READ-COUNT                                    19340001
193500         FROM 1 BY 1                                              19350001
193600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19360001
193700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19370001
193800                                                                  19380001
193900         PERFORM 4310-FETCH                                       19390001
194000                                                                  19400001
194100         IF  ASC-ITEMS-LEFT-ON-DB                                 19410001
194200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19420001
194300                 ADD +1        TO ASC-ITEM-SUB                    19430001
194400             ELSE                                                 19440001
194500                 ADD +1        TO ASC-BLK-SUB                     19450001
194600                 MOVE +1       TO ASC-ITEM-SUB                    19460001
194700                                                                  19470001
194800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19480001
194900                     MOVE +1   TO ASC-BLK-SUB                     19490001
195000                     SET ASC-BLOCK-MODIFIED (1)                   19500001
195100                               TO TRUE                            19510001
195200                     PERFORM 5100-WRITE-TEMP-STORAGE              19520001
195300                     MOVE ASC-BLOCK-ENTRIES                       19530001
195400                               (PC-MAX-BLOCKS-IN-ARRAY)           19540001
195500                               TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)  19550001
195600                     ADD +1    TO ASC-BLK-SUB                     19560001
195700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19570001
195800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19580001
195900                               TO TRUE                            19590001
196000                 END-IF                                           19600001
196100             END-IF                                               19610001
196200             ADD +1            TO ASC-NUMBER-OF-ITEMS-READ        19620001
196300             MOVE ASC-NUMBER-OF-ITEMS-READ                        19630001
196400                               TO ASC-LIST-ITEM-NUMBER            19640001
196500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19650001
196600             MOVE SVT00002-POS-DTE                                19660001
196700                               TO ASC-POS-DATE-ISO                19670001
196800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19680001
196900             MOVE SVT00002-STR-NBR                                19690001
197000                               TO ASC-STORE-NBR                   19700001
197100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19710001
197200             MOVE SVT00002-POS-TRMNL-NBR                          19720001
197300                               TO ASC-TERMINAL                    19730001
197400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19740001
197500             MOVE SVT00002-POS-TRN-NBR                            19750001
197600                               TO ASC-TRANSACTION                 19760001
197700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19770001
197800             MOVE SVT00002-TRN-RVRSL-CDE                          19780001
197900                               TO ASC-REVERSAL-IND                19790001
198000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19800001
198100             SET SV004-ACT-TYP-IDX TO 1                           19810001
198200             SEARCH SV004-ACT-TYP-OCC                             19820001
198300                 AT END                                           19830001
198400                     MOVE SPACES                                  19840001
198500                               TO ASC-ACTIVITY-TYPE-DESC          19850001
198600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19860001
198700                 WHEN SV004-ACT-TYP-CD (SV004-ACT-TYP-IDX)        19870001
198800                               = SVT00002-ACTVY-TYP-CDE           19880001
198900                     MOVE SV004-ACT-TYP-SDESC (SV004-ACT-TYP-IDX) 19890001
199000                               TO ASC-ACTIVITY-TYPE-DESC          19900001
199100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19910001
199200             END-SEARCH                                           19920001
199300             MOVE SVT00002-APP-AUTH-AMT                           19930001
199400                               TO ASC-AMOUNT                      19940001
199500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19950001
199600             IF SVT00002-APVL-USR-ID = SPACES                     19960001
199700                 MOVE SV004-AUTO-IND                              19970001
199800                               TO ASC-AUTO-MANUAL                 19980001
199900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19990001
200000                 MOVE SVT00002-POS-OPRT-ID                        20000001
200100                               TO PV-USERID                       20010001
200200                 MOVE PV-USERID                                   20020001
200300                               TO ASC-USERID                      20030001
200400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20040001
200500             ELSE                                                 20050001
200600                 MOVE SV004-MANUAL-IND                            20060001
200700                               TO ASC-AUTO-MANUAL                 20070001
200800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20080001
200900                 MOVE SVT00002-APVL-USR-ID                        20090001
201000                               TO ASC-USERID                      20100001
201100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20110001
201200             END-IF                                               20120001
201300             PERFORM 4320-CALC-APPROVAL-NUMBER                    20130001
201400             SET SV004-ACT-ST-IDX TO 1                            20140001
201500             SEARCH SV004-ACT-ST-OCC                              20150001
201600                 AT END                                           20160001
201700                     MOVE SPACES                                  20170001
201800                               TO ASC-ACTIVITY-STATUS             20180001
201900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20190001
202000                 WHEN SV004-ACT-ST-CD (SV004-ACT-ST-IDX)          20200001
202100                               = SVT00002-ACTVY-STAT-CDE          20210001
202200                     MOVE SV004-ACT-ST-DESC (SV004-ACT-ST-IDX)    20220001
202300                               TO ASC-ACTIVITY-STATUS             20230001
202400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20240001
202500             END-SEARCH                                           20250001
202600             MOVE SVT00002-TRN-VOID-IND                           20260001
202700                               TO ASC-VOID-IND                    20270001
202800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20280001
202900             MOVE SVT00002-TRN-AUTH-TMST                          20290001
203000                               TO ASC-TRN-AUTH-TMST               20300001
203100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20310001
203200             IF SVT00002-TRN-VOID-IND = SV004-NOT-VOID-TRANS      20320001
203300                 ADD SVT00002-APP-AUTH-AMT                        20330001
203400                               TO ASC-BALANCE                     20340001
203500                 IF SVT00002-ACTVY-TYP-CDE =                      20350001
203600                    SV004-SRV-FEE-ACT-TYP-N                       20360001
203700                     ADD SVT00002-APP-AUTH-AMT                    20370001
203800                               TO ASC-FEES                        20380001
203900                 END-IF                                           20390001
204000             END-IF                                               20400001
204100         END-IF                                                   20410001
204200     END-PERFORM.                                                 20420001
204300                                                                  20430001
204400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          20440001
204500         MOVE +1               TO ASC-BLK-SUB                     20450001
204600         PERFORM 5100-WRITE-TEMP-STORAGE                          20460001
204700         ADD +1                TO ASC-BLK-SUB                     20470001
204800         PERFORM 5100-WRITE-TEMP-STORAGE                          20480001
204900                                                                  20490001
205000         MOVE 1                TO ASC-BLK-SUB                     20500001
205100                                  PV-BLOCK-NUMBER                 20510001
205200         PERFORM 4410-READ-TEMP-STORAGE                           20520001
205300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20530001
205400             MOVE 2            TO ASC-BLK-SUB                     20540001
205500                                  PV-BLOCK-NUMBER                 20550001
205600             PERFORM 4410-READ-TEMP-STORAGE                       20560001
205700         END-IF                                                   20570001
205800     END-IF.                                                      20580001
205900*----------------------------------------------------------------*20590001
206000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20600001
206100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20610001
206200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20620001
206300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *20630001
206400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *20640001
206500*                                                                *20650001
206600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *20660001
206700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *20670001
206800*    UPON INITIALIZATION.                                        *20680001
206900*----------------------------------------------------------------*20690001
207000                                                                  20700001
207100 4305-READ-ITEMS-HIST-DB.                                         20710001
207200                                                                  20720001
207300     PERFORM                                                      20730001
207400         VARYING PV-READ-COUNT                                    20740001
207500         FROM 1 BY 1                                              20750001
207600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    20760001
207700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         20770001
207800                                                                  20780001
207900         PERFORM 4315-FETCH-HIST                                  20790001
208000                                                                  20800001
208100         IF  ASC-ITEMS-LEFT-ON-DB                                 20810001
208200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                20820001
208300                 ADD +1        TO ASC-ITEM-SUB                    20830001
208400             ELSE                                                 20840001
208500                 ADD +1        TO ASC-BLK-SUB                     20850001
208600                 MOVE +1       TO ASC-ITEM-SUB                    20860001
208700                                                                  20870001
208800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         20880001
208900                     MOVE +1   TO ASC-BLK-SUB                     20890001
209000                     SET ASC-BLOCK-MODIFIED (1)                   20900001
209100                               TO TRUE                            20910001
209200                     PERFORM 5100-WRITE-TEMP-STORAGE              20920001
209300                     MOVE ASC-BLOCK-ENTRIES                       20930001
209400                               (PC-MAX-BLOCKS-IN-ARRAY)           20940001
209500                               TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)  20950001
209600                     ADD +1    TO ASC-BLK-SUB                     20960001
209700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   20970001
209800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      20980001
209900                               TO TRUE                            20990001
210000                 END-IF                                           21000001
210100             END-IF                                               21010001
210200             ADD +1            TO ASC-NUMBER-OF-ITEMS-READ        21020001
210300             MOVE ASC-NUMBER-OF-ITEMS-READ                        21030001
210400                               TO ASC-LIST-ITEM-NUMBER            21040001
210500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21050001
210600             MOVE SVT00006-POS-DTE                                21060001
210700                               TO ASC-POS-DATE-ISO                21070001
210800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21080001
210900             MOVE SVT00006-STR-NBR                                21090001
211000                               TO ASC-STORE-NBR                   21100001
211100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21110001
211200             MOVE SVT00006-POS-TRMNL-NBR                          21120001
211300                               TO ASC-TERMINAL                    21130001
211400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21140001
211500             MOVE SVT00006-POS-TRN-NBR                            21150001
211600                               TO ASC-TRANSACTION                 21160001
211700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21170001
211800             IF SVT00006-TRN-RVRSL-CDE = SV004-REV-CDE-NORMAL     21180001
211900                 MOVE SV004-REV-CDE-NORMAL                        21190001
212000                               TO ASC-REVERSAL-IND                21200001
212100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21210001
212200             ELSE                                                 21220001
212300                 MOVE SVT00006-TRN-RVRSL-CDE                      21230001
212400                               TO ASC-REVERSAL-IND                21240001
212500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21250001
212600             END-IF                                               21260001
212700             SET SV004-ACT-TYP-IDX TO 1                           21270001
212800             SEARCH SV004-ACT-TYP-OCC                             21280001
212900                 AT END                                           21290001
213000                     MOVE SPACES                                  21300001
213100                               TO ASC-ACTIVITY-TYPE-DESC          21310001
213200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21320001
213300                 WHEN SV004-ACT-TYP-CD (SV004-ACT-TYP-IDX)        21330001
213400                               = SVT00006-ACTVY-TYP-CDE           21340001
213500                     MOVE SV004-ACT-TYP-SDESC (SV004-ACT-TYP-IDX) 21350001
213600                               TO ASC-ACTIVITY-TYPE-DESC          21360001
213700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21370001
213800             END-SEARCH                                           21380001
213900             MOVE SVT00006-APP-AUTH-AMT                           21390001
214000                               TO ASC-AMOUNT                      21400001
214100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21410001
214200             IF SVT00006-APVL-USR-ID = SPACES                     21420001
214300                 MOVE SV004-AUTO-IND                              21430001
214400                               TO ASC-AUTO-MANUAL                 21440001
214500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21450001
214600                 MOVE SVT00006-POS-OPRT-ID                        21460001
214700                               TO PV-USERID                       21470001
214800                 MOVE PV-USERID                                   21480001
214900                               TO ASC-USERID                      21490001
215000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21500001
215100             ELSE                                                 21510001
215200                 MOVE SV004-MANUAL-IND                            21520001
215300                               TO ASC-AUTO-MANUAL                 21530001
215400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21540001
215500                 MOVE SVT00006-APVL-USR-ID                        21550001
215600                               TO ASC-USERID                      21560001
215700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21570001
215800             END-IF                                               21580001
215900             PERFORM 4325-CALC-APP-HIST-NUMBER                    21590001
216000             SET SV004-ACT-ST-IDX TO 1                            21600001
216100             SEARCH SV004-ACT-ST-OCC                              21610001
216200                 AT END                                           21620001
216300                     MOVE SPACES                                  21630001
216400                               TO ASC-ACTIVITY-STATUS             21640001
216500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21650001
216600                 WHEN SV004-ACT-ST-CD (SV004-ACT-ST-IDX)          21660001
216700                               = SVT00006-ACTVY-STAT-CDE          21670001
216800                     MOVE SV004-ACT-ST-DESC (SV004-ACT-ST-IDX)    21680001
216900                               TO ASC-ACTIVITY-STATUS             21690001
217000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21700001
217100             END-SEARCH                                           21710001
217200             MOVE SVT00006-TRN-VOID-IND                           21720001
217300                               TO ASC-VOID-IND                    21730001
217400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21740001
217500             MOVE SVT00006-TRN-AUTH-TMST                          21750001
217600                               TO ASC-TRN-AUTH-TMST               21760001
217700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21770001
217800             IF SVT00006-TRN-VOID-IND = SV004-NOT-VOID-TRANS      21780001
217900                 ADD SVT00006-APP-AUTH-AMT                        21790001
218000                               TO ASC-BALANCE                     21800001
218100                 IF SVT00006-ACTVY-TYP-CDE =                      21810001
218200                    SV004-SRV-FEE-ACT-TYP-N                       21820001
218300                     ADD SVT00006-APP-AUTH-AMT                    21830001
218400                               TO ASC-FEES                        21840001
218500                 END-IF                                           21850001
218600             END-IF                                               21860001
218700         END-IF                                                   21870001
218800     END-PERFORM.                                                 21880001
218900                                                                  21890001
219000     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          21900001
219100         MOVE +1               TO ASC-BLK-SUB                     21910001
219200         PERFORM 5100-WRITE-TEMP-STORAGE                          21920001
219300         ADD +1                TO ASC-BLK-SUB                     21930001
219400         PERFORM 5100-WRITE-TEMP-STORAGE                          21940001
219500                                                                  21950001
219600         MOVE 1                TO ASC-BLK-SUB                     21960001
219700                                  PV-BLOCK-NUMBER                 21970001
219800         PERFORM 4410-READ-TEMP-STORAGE                           21980001
219900         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             21990001
220000             MOVE 2            TO ASC-BLK-SUB                     22000001
220100                                  PV-BLOCK-NUMBER                 22010001
220200             PERFORM 4410-READ-TEMP-STORAGE                       22020001
220300         END-IF                                                   22030001
220400     END-IF.                                                      22040001
220500*    FETCH THE CARD CURSOR.                                      *22050001
220600*----------------------------------------------------------------*22060001
220700                                                                  22070001
220800 4310-FETCH.                                                      22080001
220900                                                                  22090001
221000     EXEC SQL                                                     22100001
221100          FETCH CARD-CSR                                          22110001
221200          INTO  :SVT00002-TRN-AUTH-TMST                           22120001
221300              , :SVT00002-TRN-RVRSL-CDE                           22130001
221400              , :SVT00002-TRN-VOID-IND                            22140001
221500              , :SVT00002-ACTVY-TYP-CDE                           22150001
221600              , :SVT00002-POS-DTE                                 22160001
221700              , :SVT00002-STR-NBR                                 22170001
221800              , :SVT00002-POS-TRMNL-NBR                           22180001
221900              , :SVT00002-POS-TRN-NBR                             22190001
222000              , :SVT00002-APP-AUTH-AMT                            22200001
222100              , :SVT00002-POS-OPRT-ID                             22210001
222200              , :SVT00002-APVL-USR-ID                             22220001
222300              , :SVT00002-ACTVY-STAT-CDE                          22230001
222400     END-EXEC.                                                    22240001
222500     IF PV-READ-COUNT =  1                                        22250001
222600         IF SQLCODE = +100                                        22260001
222700            SET PS-ITEMS-NOT-FOUND TO TRUE                        22270001
222800         END-IF                                                   22280001
222900     END-IF.                                                      22290001
223000                                                                  22300001
223100     EVALUATE TRUE                                                22310001
223200         WHEN SQLCODE = ZERO                                      22320001
223300         WHEN SQLCODE = +100                                      22330001
223400              CONTINUE                                            22340001
223500         WHEN OTHER                                               22350001
223600              MOVE '4310-FETCH-CURSOR'                            22360001
223700                               TO DP013-PARAGRAPH                 22370001
223800              MOVE 'FETCH CARD CURSOR'                            22380001
223900                               TO DP013-MESSAGE-TEXT (1)          22390001
224000              MOVE SQLCA       TO DP013-SQLCA                     22400001
224100              MOVE 'SVT_KOHLS_CRD_TXN '                           22410001
224200                               TO DP013-DB2-TABLE-NAME (1)        22420001
224300              SET DP013-DB2-ABEND                                 22430001
224400                               TO TRUE                            22440001
224500              PERFORM DP013-0000-PROCESS-ABEND                    22450001
224600     END-EVALUATE.                                                22460001
224700                                                                  22470001
224800     IF  SQLCODE EQUAL +100                                       22480001
224900         SET ASC-NO-ITEMS-LEFT-ON-DB                              22490001
225000                                   TO TRUE                        22500001
225100     END-IF.                                                      22510001
225200*    FETCH THE CARD CURSOR.                                      *22520001
225300*----------------------------------------------------------------*22530001
225400                                                                  22540001
225500 4315-FETCH-HIST.                                                 22550001
225600                                                                  22560001
225700     EXEC SQL                                                     22570001
225800          FETCH HIST-CSR                                          22580001
225900          INTO  :SVT00006-TRN-AUTH-TMST                           22590001
226000              , :SVT00006-TRN-RVRSL-CDE                           22600001
226100              , :SVT00006-TRN-VOID-IND                            22610001
226200              , :SVT00006-ACTVY-TYP-CDE                           22620001
226300              , :SVT00006-POS-DTE                                 22630001
226400              , :SVT00006-STR-NBR                                 22640001
226500              , :SVT00006-POS-TRMNL-NBR                           22650001
226600              , :SVT00006-POS-TRN-NBR                             22660001
226700              , :SVT00006-APP-AUTH-AMT                            22670001
226800              , :SVT00006-POS-OPRT-ID                             22680001
226900              , :SVT00006-APVL-USR-ID                             22690001
227000              , :SVT00006-ACTVY-STAT-CDE                          22700001
227100     END-EXEC.                                                    22710001
227200                                                                  22720001
227300     EVALUATE TRUE                                                22730001
227400         WHEN SQLCODE = ZERO                                      22740001
227500         WHEN SQLCODE = +100                                      22750001
227600              CONTINUE                                            22760001
227700         WHEN OTHER                                               22770001
227800              MOVE '4315-FETCH-CURSOR-HIST'                       22780001
227900                               TO DP013-PARAGRAPH                 22790001
228000              MOVE 'FETCH HIST CURSOR'                            22800001
228100                               TO DP013-MESSAGE-TEXT (1)          22810001
228200              MOVE SQLCA       TO DP013-SQLCA                     22820001
228300              MOVE 'SVT_CRD_TXN_HIST ' TO DP013-DB2-TABLE-NAME (1)22830001
228400              SET DP013-DB2-ABEND                                 22840001
228500                               TO TRUE                            22850001
228600              PERFORM DP013-0000-PROCESS-ABEND                    22860001
228700     END-EVALUATE.                                                22870001
228800                                                                  22880001
228900     IF  SQLCODE EQUAL +100                                       22890001
229000         SET ASC-NO-ITEMS-LEFT-ON-DB                              22900001
229100                                   TO TRUE                        22910001
229200     END-IF.                                                      22920001
229300                                                                  22930001
229400*----------------------------------------------------------------*22940001
229500*    CALCULATE THE APPROVAL NUMBER TO DISPLAY ON THE SCREEN.     *22950001
229600*----------------------------------------------------------------*22960001
229700                                                                  22970001
229800 4320-CALC-APPROVAL-NUMBER.                                       22980001
229900                                                                  22990001
230000     MOVE ASC-SHORT-CARD-ID     TO SV006-KMC-ID.                  23000001
230100     MOVE SVT00002-APP-AUTH-AMT TO SV006-TENDER-AMT.              23010001
230200     MOVE ASC-TERMINAL (ASC-BLK-SUB ASC-ITEM-SUB)                 23020001
230300                                TO SV006-TERMINAL-NBR.            23030001
230400     MOVE ASC-TRANSACTION (ASC-BLK-SUB ASC-ITEM-SUB)              23040001
230500                                TO SV006-TRANSACTION-NBR.         23050001
230600     PERFORM SV006-A100-MAINLINE.                                 23060001
230700     MOVE SV006-KMC-APPROVAL-NBR                                  23070001
230800                                TO ASC-APPROVAL-NUMBER            23080001
230900                                     (ASC-BLK-SUB ASC-ITEM-SUB).  23090001
231000                                                                  23100001
231100*----------------------------------------------------------------*23110001
231200*    CALCULATE THE APPROVAL NUMBER TO DISPLAY ON THE SCREEN.     *23120001
231300*----------------------------------------------------------------*23130001
231400                                                                  23140001
231500 4325-CALC-APP-HIST-NUMBER.                                       23150001
231600                                                                  23160001
231700     MOVE ASC-SHORT-CARD-ID    TO SV006-KMC-ID.                   23170001
231800     MOVE SVT00006-APP-AUTH-AMT TO SV006-TENDER-AMT.              23180001
231900     MOVE ASC-TERMINAL (ASC-BLK-SUB ASC-ITEM-SUB)                 23190001
232000                                TO SV006-TERMINAL-NBR.            23200001
232100     MOVE ASC-TRANSACTION (ASC-BLK-SUB ASC-ITEM-SUB)              23210001
232200                                TO SV006-TRANSACTION-NBR.         23220001
232300     PERFORM SV006-A100-MAINLINE.                                 23230001
232400     MOVE SV006-KMC-APPROVAL-NBR                                  23240001
232500                               TO ASC-APPROVAL-NUMBER             23250001
232600                                     (ASC-BLK-SUB ASC-ITEM-SUB).  23260001
232700                                                                  23270001
232800*----------------------------------------------------------------*23280001
232900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *23290001
233000*----------------------------------------------------------------*23300001
233100                                                                  23310001
233200 4400-MOVE-COMMAREA-TO-SCREEN.                                    23320001
233300*    MOVE ASC-30-DIGIT-CARD-NBR     TO ACARDIDO.                  23330001
233400     MOVE ASC-30-DIGIT-CARD-NBR     TO SV007-CARD-NUMBER          23340005
233500     SET SV007-FORMAT-DISPLAY       TO TRUE                       23350005
233600     PERFORM SV007-FORMAT-CARD                                    23360005
233601     MOVE SV007-CARD-NUMBER-DISPLAY TO ACARDIDO                   23360105
233602     MOVE ASC-CONTROL-NBR           TO ACNTLIDO.                  23360201
233603     MOVE ASC-CARD-STATUS-DESC      TO ASTATUSO.                  23360301
233700     MOVE ASC-CLOSED-DATE           TO ACLSDTEO.                  23370001
233800     MOVE ASC-CARD-TYPE-DESC        TO ACRDDESO.                  23380001
233900     MOVE ASC-BALANCE               TO ABALO.                     23390001
234000     MOVE ASC-FEES                  TO AFEEO.                     23400001
234100                                                                  23410001
234200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             23420001
234300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          23430001
234400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          23440001
234500             MOVE +1                TO ASC-BLK-SUB                23450001
234600             PERFORM 5100-WRITE-TEMP-STORAGE                      23460001
234700             ADD +1                 TO ASC-BLK-SUB                23470001
234800             PERFORM 5100-WRITE-TEMP-STORAGE                      23480001
234900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             23490001
235000                 GIVING PV-BLOCK-NUMBER                           23500001
235100                 REMAINDER PV-REMAINDER                           23510001
235200             IF  PV-REMAINDER > ZERO                              23520001
235300                 ADD +1             TO PV-BLOCK-NUMBER            23530001
235400             END-IF                                               23540001
235500             MOVE +1                TO ASC-BLK-SUB                23550001
235600             PERFORM 4410-READ-TEMP-STORAGE                       23560001
235700             ADD +1                 TO ASC-BLK-SUB                23570001
235800                                       PV-BLOCK-NUMBER            23580001
235900             PERFORM 4410-READ-TEMP-STORAGE                       23590001
236000     END-IF.                                                      23600001
236100     MOVE +1                        TO ASC-BLK-SUB.               23610001
236200     COMPUTE ASC-ITEM-SUB =                                       23620001
236300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              23630001
236400         + PC-ITEMS-PER-PANEL).                                   23640001
236500                                                                  23650001
236600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23660001
236700         ADD +1                     TO ASC-BLK-SUB                23670001
236800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            23680001
236900     END-IF.                                                      23690001
237000                                                                  23700001
237100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           23710001
237200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                23720001
237300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        23730001
237400     PERFORM 4420-FORMAT-LIST-LINES                               23740001
237500         VARYING PV-SUB                                           23750001
237600         FROM PC-ITEMS-PER-PANEL BY -1                            23760001
237700         UNTIL PV-SUB < +1.                                       23770001
237800                                                                  23780001
237900     COMPUTE ASC-ITEMS-DISPLAYED =                                23790001
238000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          23800001
238100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    23810001
238200                                      ASTRTITO.                   23820001
238300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    23830001
238400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    23840001
238500*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23850001
238600*                                  TO ASELITO.                    23860001
238700*                                                                 23870001
238800     IF  DP020-MSG-NUMBER-X = SPACE                               23880001
238900         IF  ASC-ITEM-AT-BOT-OF-PANEL                             23890001
239000                                  < ASC-NUMBER-OF-ITEMS-READ      23900001
239100*            --- MORE ITEMS TO DISPLAY ----                       23910001
239200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            23920001
239300             SET DP020-MSG-INFORMATIONAL                          23930001
239400                                   TO TRUE                        23940001
239500         END-IF                                                   23950001
239600     END-IF.                                                      23960001
239700                                                                  23970001
239800*----------------------------------------------------------------*23980001
239900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23990001
240000*----------------------------------------------------------------*24000001
240100                                                                  24010001
240200 4410-READ-TEMP-STORAGE.                                          24020001
240300                                                                  24030001
240400     EXEC CICS                                                    24040001
240500         READQ TS                                                 24050001
240600             QUEUE (ASC-LIST-QUEUE-NAME)                          24060001
240700             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24070001
240800             ITEM  (PV-BLOCK-NUMBER)                              24080001
240900             RESP  (PV-CICS-RESP)                                 24090001
241000     END-EXEC.                                                    24100001
241100                                                                  24110001
241200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       24120001
241300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     24130001
241400         CONTINUE                                                 24140001
241500     ELSE                                                         24150001
241600         SET DP013-CICS-ABEND     TO TRUE                         24160001
241700         SET DP013-NO-ROLLBACK    TO TRUE                         24170001
241800         MOVE '4410-READ-TEMP-STORAGE'                            24180001
241900                                  TO DP013-PARAGRAPH              24190001
242000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      24200001
242100                                  TO DP013-MESSAGE-TEXT(1)        24210001
242200         PERFORM DP013-0000-PROCESS-ABEND                         24220001
242300     END-IF.                                                      24230001
242400                                                                  24240001
242500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      24250001
242600                                  TO TRUE.                        24260001
242700                                                                  24270001
242800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         24280001
242900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               24290001
243000     END-IF.                                                      24300001
243100*----------------------------------------------------------------*24310001
243200*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *24320001
243300*----------------------------------------------------------------*24330001
243400                                                                  24340001
243500 4420-FORMAT-LIST-LINES.                                          24350001
243600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      24360001
243700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                24370001
243800         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           24380001
243900         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           24390001
244000         MOVE SPACE              TO MR-SELECTI (PV-SUB)           24400001
244100                                    MR-TRAN-ID (PV-SUB)           24410001
244200                                    MR-REVERSAL-IND (PV-SUB)      24420001
244300                                    MR-VOID-IND (PV-SUB)          24430001
244400                                    MR-ACTIVITY-TYPE-DESC         24440001
244500                                                     (PV-SUB)     24450001
244600                                    MR-AMOUNT-X (PV-SUB)          24460001
244700                                    MR-AUTO-MANUAL (PV-SUB)       24470001
244800                                    MR-USERID (PV-SUB)            24480001
244900                                    MR-APPROVAL-NUMBER (PV-SUB)   24490001
245000                                    MR-ACTIVITY-STATUS (PV-SUB)   24500001
245100     ELSE                                                         24510001
245200         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24520001
245300                                                   > SPACE        24530001
245400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24540001
245500                                 TO MR-SELECTI (PV-SUB)           24550001
245600         ELSE                                                     24560001
245700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24570001
245800                                 TO MR-SELECTI (PV-SUB)           24580001
245900         END-IF                                                   24590001
246000                                                                  24600001
246100         IF  DP030-SET-CURSOR-TRAILER                             24610001
246200             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)24620001
246300                 > SPACE)                                         24630001
246400               OR (PV-SUB = 1))                                   24640001
246500                SET DP030-SET-CURSOR-APPL-1 TO TRUE               24650001
246600                MOVE -1          TO MR-SELECTL (PV-SUB)           24660001
246700             END-IF                                               24670001
246800         END-IF                                                   24680001
246900                                                                  24690001
247000         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           24700001
247100             MOVE ASC-POS-DATE-ISO (ASC-BLK-SUB ASC-ITEM-SUB)     24710001
247200                               TO PV-DB2-DATE                     24720001
247300             MOVE PV-DB2-CC    TO PV-TRAN-CC                      24730001
247400             MOVE PV-DB2-YY    TO PV-TRAN-YY                      24740001
247500             MOVE PV-DB2-MM    TO PV-TRAN-MM                      24750001
247600             MOVE PV-DB2-DD    TO PV-TRAN-DD                      24760001
247700             MOVE ASC-STORE-NBR   (ASC-BLK-SUB ASC-ITEM-SUB)      24770001
247800                               TO PV-TRAN-STR-NBR                 24780001
247900             MOVE ASC-TERMINAL    (ASC-BLK-SUB ASC-ITEM-SUB)      24790001
248000                               TO PV-TRAN-TRMNL-NBR               24800001
248100             MOVE ASC-TRANSACTION (ASC-BLK-SUB ASC-ITEM-SUB)      24810001
248200                               TO PV-TRAN-TRN-NBR                 24820001
248300             MOVE '/'          TO PV-TRAN-S1                      24830001
248400                                  PV-TRAN-S2                      24840001
248500                                  PV-TRAN-S3                      24850001
248600             MOVE PV-TRAN-ID   TO MR-TRAN-ID (PV-SUB)             24860001
248700             IF ASC-REVERSAL-IND (ASC-BLK-SUB ASC-ITEM-SUB)       24870001
248800                                 = SV004-REV-CDE-NORMAL           24880001
248900                 MOVE SV004-REV-CDE-NORMAL-DISPLAY                24890001
249000                                 TO MR-REVERSAL-IND (PV-SUB)      24900001
249100             ELSE                                                 24910001
249200                 MOVE ASC-REVERSAL-IND                            24920001
249300                                   (ASC-BLK-SUB ASC-ITEM-SUB)     24930001
249400                                 TO MR-REVERSAL-IND (PV-SUB)      24940001
249500             END-IF                                               24950001
249600             IF ASC-VOID-IND (ASC-BLK-SUB ASC-ITEM-SUB)           24960001
249700                                  = SV004-VOID-TRANS              24970001
249800                 MOVE SV004-VOID-DISPLAY                          24980001
249900                                 TO MR-VOID-IND (PV-SUB)          24990001
250000             ELSE                                                 25000001
250100                 MOVE SPACE      TO MR-VOID-IND (PV-SUB)          25010001
250200             END-IF                                               25020001
250300             MOVE ASC-ACTIVITY-TYPE-DESC                          25030001
250400                                    (ASC-BLK-SUB ASC-ITEM-SUB)    25040001
250500                                 TO MR-ACTIVITY-TYPE-DESC (PV-SUB)25050001
250600             MOVE ASC-AMOUNT (ASC-BLK-SUB ASC-ITEM-SUB)           25060001
250700                                 TO MR-AMOUNT (PV-SUB)            25070001
250800             MOVE ASC-AUTO-MANUAL (ASC-BLK-SUB ASC-ITEM-SUB)      25080001
250900                                 TO MR-AUTO-MANUAL (PV-SUB)       25090001
251000             MOVE ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB)           25100001
251100                                 TO MR-USERID (PV-SUB)            25110001
251200             MOVE ASC-APPROVAL-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)  25120001
251300                                 TO MR-APPROVAL-NUMBER (PV-SUB)   25130001
251400             MOVE ASC-ACTIVITY-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)  25140001
251500                                 TO MR-ACTIVITY-STATUS (PV-SUB)   25150001
251600         END-IF                                                   25160001
251700     END-IF.                                                      25170001
251800     SUBTRACT +1 FROM ASC-ITEM-SUB                                25180001
251900     IF  ASC-ITEM-SUB < + 1                                       25190001
252000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  25200001
252100         MOVE +1                 TO ASC-BLK-SUB                   25210001
252200     END-IF.                                                      25220001
252300*----------------------------------------------------------------*25230001
252400*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *25240001
252500*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *25250001
252600*  ISSUE A WARNING.                                              *25260001
252700*----------------------------------------------------------------*25270001
252800 4430-CHECK-FOR-BEGIN-AND-END.                                    25280001
252900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       25290001
253000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     25300001
253100*            -- NO END-OF-RANGE SPECFIED ---                      25310001
253200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            25320001
253300             SET DP020-MSG-WARNING TO TRUE                        25330001
253400             PERFORM 4431-POSITION-AT-WARNING                     25340001
253500         END-IF                                                   25350001
253600     ELSE                                                         25360001
253700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     25370001
253800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                25380001
253900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            25390001
254000             SET DP020-MSG-WARNING TO TRUE                        25400001
254100             PERFORM 4431-POSITION-AT-WARNING                     25410001
254200         END-IF                                                   25420001
254300     END-IF.                                                      25430001
254400*----------------------------------------------------------------*25440001
254500*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *25450001
254600*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *25460001
254700*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *25470001
254800*  POSITION THE CURSOR THERE.                                    *25480001
254900*----------------------------------------------------------------*25490001
255000 4431-POSITION-AT-WARNING.                                        25500001
255100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 25510001
255200                    - PV-TOP-ITEM + 1.                            25520001
255300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25530001
255400         CONTINUE                                                 25540001
255500     ELSE                                                         25550001
255600         SET DP030-SET-CURSOR-APPL-1                              25560001
255700                                   TO TRUE                        25570001
255800         MOVE -1                   TO MR-SELECTL (PV-SUB)         25580001
255900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25590001
256000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25600001
256100     END-IF.                                                      25610001
256200                                                                  25620001
256300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   25630001
256400                    - PV-TOP-ITEM + 1.                            25640001
256500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25650001
256600         CONTINUE                                                 25660001
256700     ELSE                                                         25670001
256800         SET DP030-SET-CURSOR-APPL-1                              25680001
256900                                   TO TRUE                        25690001
257000         MOVE -1                   TO MR-SELECTL (PV-SUB)         25700001
257100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25710001
257200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25720001
257300     END-IF.                                                      25730001
257400*----------------------------------------------------------------*25740001
257500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *25750001
257600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *25760001
257700* FOR THE SELECTED ITEMS QUEUE.                                  *25770001
257800*                                                                *25780001
257900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *25790001
258000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *25800001
258100* THE ARRAY IS FULL.                                             *25810001
258200*----------------------------------------------------------------*25820001
258300                                                                  25830001
258400 5000-PREPARE-SEL-QUEUE.                                          25840001
258500                                                                  25850001
258600     MOVE +1                   TO  ASC-BLK-SUB.                   25860001
258700     PERFORM 5100-WRITE-TEMP-STORAGE.                             25870001
258800     ADD +1                    TO  ASC-BLK-SUB.                   25880001
258900     PERFORM 5100-WRITE-TEMP-STORAGE.                             25890001
259000                                                                  25900001
259100     MOVE ASC-SEL-QUEUE-NAME   TO  RD021-SEL-QUEUE-NAME.          25910001
259200     PERFORM 6010-DELETE-SEL-QUEUE.                               25920001
259300                                                                  25930001
259400     SET ASC-UPDATE-TSQ        TO  TRUE.                          25940001
259500                                                                  25950001
259600     SET RD022-IDX             TO  1.                             25960001
259700     MOVE ZERO                 TO RD021-NUMBER-OF-TS-ITEMS.       25970001
259800     INITIALIZE RD022-SELECTED-ITEM-ARRAY.                        25980001
259900                                                                  25990001
260000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           26000001
260100             VARYING PV-ITEM                                      26010001
260200             FROM 1 BY 1                                          26020001
260300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     26030001
260400                                                                  26040001
260500     IF  RD022-IDX > 1                                            26050001
260600         PERFORM 5205-WRITE-SEL-QUEUE                             26060001
260700         ADD +1                TO RD021-NUMBER-OF-TS-ITEMS        26070001
260800     END-IF.                                                      26080001
260900*----------------------------------------------------------------*26090001
261000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *26100001
261100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *26110001
261200*----------------------------------------------------------------*26120001
261300                                                                  26130001
261400 5100-WRITE-TEMP-STORAGE.                                         26140001
261500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     26150001
261600                                   TO PV-LIST-ITEM-NUMBER.        26160001
261700     COMPUTE PV-BLOCK-NUMBER =                                    26170001
261800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    26180001
261900                                                                  26190001
262000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             26200001
262100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             26210001
262200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      26220001
262300             PERFORM 5105-REWRITE-ASC-LISTQ                       26230001
262400         END-IF                                                   26240001
262500     ELSE                                                         26250001
262600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       26260001
262700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            26270001
262800         PERFORM 5110-WRITE-ASC-LISTQ                             26280001
262900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   26290001
263000     END-IF.                                                      26300001
263100                                                                  26310001
263200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             26320001
263300*----------------------------------------------------------------*26330001
263400*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *26340001
263500*  SPECIFIC COMMAREA.                                            *26350001
263600*----------------------------------------------------------------*26360001
263700 5105-REWRITE-ASC-LISTQ.                                          26370001
263800     EXEC CICS                                                    26380001
263900         WRITEQ TS                                                26390001
264000             QUEUE (ASC-LIST-QUEUE-NAME)                          26400001
264100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26410001
264200             ITEM  (PV-BLOCK-NUMBER)                              26420001
264300             REWRITE                                              26430001
264400             RESP  (PV-CICS-RESP)                                 26440001
264500     END-EXEC.                                                    26450001
264600                                                                  26460001
264700     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           26470001
264800         CONTINUE                                                 26480001
264900     ELSE                                                         26490001
265000         SET DP013-CICS-ABEND            TO TRUE                  26500001
265100         SET DP013-NO-ROLLBACK           TO TRUE                  26510001
265200         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       26520001
265300         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     26530001
265400                                         TO DP013-MESSAGE-TEXT(1) 26540001
265500         PERFORM DP013-0000-PROCESS-ABEND                         26550001
265600     END-IF.                                                      26560001
265700                                                                  26570001
265800*----------------------------------------------------------------*26580001
265900*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *26590001
266000*  SPECIFIC COMMAREA.                                            *26600001
266100*----------------------------------------------------------------*26610001
266200 5110-WRITE-ASC-LISTQ.                                            26620001
266300     EXEC CICS                                                    26630001
266400         WRITEQ TS                                                26640001
266500             QUEUE (ASC-LIST-QUEUE-NAME)                          26650001
266600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26660001
266700             ITEM  (PV-BLOCK-NUMBER)                              26670001
266800             RESP  (PV-CICS-RESP)                                 26680001
266900     END-EXEC.                                                    26690001
267000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      26700001
267100         SET DP013-CICS-ABEND      TO TRUE                        26710001
267200         SET DP013-NO-ROLLBACK     TO TRUE                        26720001
267300         MOVE '5110-WRITE-ASC-LISTQ'                              26730001
267400                                   TO DP013-PARAGRAPH             26740001
267500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           26750001
267600                                   TO DP013-MESSAGE-TEXT(1)       26760001
267700         PERFORM DP013-0000-PROCESS-ABEND                         26770001
267800     END-IF.                                                      26780001
267900*----------------------------------------------------------------*26790001
268000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *26800001
268100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *26810001
268200*----------------------------------------------------------------*26820001
268300                                                                  26830001
268400 5200-FILL-SEL-QUEUE-RECORD.                                      26840001
268500                                                                  26850001
268600     PERFORM 6112-READ-LIST-QUEUE.                                26860001
268700                                                                  26870001
268800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26880001
268900         PERFORM                                                  26890001
269000         VARYING LQW-IDX                                          26900001
269100         FROM 1 BY 1                                              26910001
269200         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            26920001
269300           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          26930001
269400                                                                  26940001
269500             IF  LQW-SELECT (LQW-IDX)                             26950001
269600                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              26960001
269700                                   TO RD022-ITEM (RD022-IDX)      26970001
269800                 MOVE ASC-KEY-CARD-ID                             26980001
269900                                   TO RD022-CARD-ID (RD022-IDX)   26990001
270000                 MOVE ASC-CONTROL-NBR                             27000001
270100                                   TO RD022-CNTL-NBR(RD022-IDX)   27010001
270200                 MOVE LQW-TRN-AUTH-TMST (LQW-IDX)                 27020001
270300                                   TO RD022-TRN-AUTH-TMST         27030001
270400                                        (RD022-IDX)               27040001
270500                 MOVE ASC-CARD-TYPE-CDE                           27050001
270600                                   TO RD022-CARD-TYPE             27060001
270700                                        (RD022-IDX)               27070001
270800                 SET RD022-IDX UP BY 1                            27080001
270900                 IF  RD022-IDX > RD022-MAX-ITEMS                  27090001
271000                     PERFORM 5205-WRITE-SEL-QUEUE                 27100001
271100                     ADD +1        TO RD021-NUMBER-OF-TS-ITEMS    27110001
271200                     INITIALIZE RD022-SELECTED-ITEM-ARRAY         27120001
271300                     SET RD022-IDX TO  1                          27130001
271400                 END-IF                                           27140001
271500             END-IF                                               27150001
271600         END-PERFORM                                              27160001
271700     END-IF.                                                      27170001
271800                                                                  27180001
271900*----------------------------------------------------------------*27190001
272000*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *27200001
272100*----------------------------------------------------------------*27210001
272200                                                                  27220001
272300 5205-WRITE-SEL-QUEUE.                                            27230001
272400                                                                  27240001
272500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            27250001
272600                                   TO RD022-SELECTED-ITEMS.       27260001
272700                                                                  27270001
272800     EXEC CICS                                                    27280001
272900          WRITEQ TS                                               27290001
273000              QUEUE (ASC-SEL-QUEUE-NAME)                          27300001
273100              FROM  (RD022-MESSAGE-SEL-REC)                       27310001
273200              ITEM  (PV-SEL-QUEUE-ITEM)                           27320001
273300              RESP  (PV-CICS-RESP)                                27330001
273400     END-EXEC.                                                    27340001
273500                                                                  27350001
273600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27360001
273700         CONTINUE                                                 27370001
273800     ELSE                                                         27380001
273900         SET DP013-CICS-ABEND      TO TRUE                        27390001
274000         SET DP013-NO-ROLLBACK     TO TRUE                        27400001
274100         MOVE '5205-WRITE-SEL-QUEUE'                              27410001
274200                                   TO DP013-PARAGRAPH             27420001
274300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          27430001
274400                                   TO DP013-MESSAGE-TEXT(1)       27440001
274500         PERFORM DP013-0000-PROCESS-ABEND                         27450001
274600     END-IF.                                                      27460001
274700                                                                  27470001
274800*----------------------------------------------------------------*27480001
274900*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *27490001
275000*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *27500001
275100*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *27510001
275200*  THE USER.                                                     *27520001
275300*----------------------------------------------------------------*27530001
275400 6000-REFRESH-PANEL-FROM-TEMP.                                    27540001
275500     IF  ASC-UPDATE-TSQ                                           27550001
275600         SET ASC-NO-TSQ-UPDATE     TO TRUE                        27560001
275700         MOVE ZERO                 TO PV-SAVE-ITEM                27570001
275800                                      PV-SEL-QUEUE-ITEM           27580001
275900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        27590001
276000                                   TO PV-HOLD-SELECTED-ITEMS      27600001
276100         MOVE +1                   TO PV-ITEMS-PROCESSED          27610001
276200         PERFORM 6100-UPDATE-TSQ                                  27620001
276300             UNTIL PV-ITEMS-PROCESSED >                           27630001
276400                                     PV-HOLD-SELECTED-ITEMS       27640001
276500         PERFORM 6010-DELETE-SEL-QUEUE                            27650001
276600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         27660001
276700                    ASC-BLOCK-ENTRIES (2)                         27670001
276800     END-IF.                                                      27680001
276900                                                                  27690001
277000*----------------------------------------------------------------*27700001
277100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *27710001
277200*----------------------------------------------------------------*27720001
277300 6010-DELETE-SEL-QUEUE.                                           27730001
277400                                                                  27740001
277500     EXEC CICS                                                    27750001
277600         DELETEQ TS                                               27760001
277700             QUEUE (ASC-SEL-QUEUE-NAME)                           27770001
277800             RESP  (PV-CICS-RESP)                                 27780001
277900     END-EXEC.                                                    27790001
278000                                                                  27800001
278100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      27810001
278200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         27820001
278300         CONTINUE                                                 27830001
278400     ELSE                                                         27840001
278500         SET DP013-CICS-ABEND  TO TRUE                            27850001
278600         SET DP013-NO-ROLLBACK TO TRUE                            27860001
278700         MOVE '6010-DELETE-SEL-QUEUE'                             27870001
278800                               TO DP013-PARAGRAPH                 27880001
278900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         27890001
279000                               TO DP013-MESSAGE-TEXT (1)          27900001
279100         PERFORM DP013-0000-PROCESS-ABEND                         27910001
279200     END-IF.                                                      27920001
279300                                                                  27930001
279400*----------------------------------------------------------------*27940001
279500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *27950001
279600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *27960001
279700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *27970001
279800*    THE TEMP QUEUE.                                             *27980001
279900*----------------------------------------------------------------*27990001
280000                                                                  28000001
280100 6100-UPDATE-TSQ.                                                 28010001
280200                                                                  28020001
280300     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             28030001
280400     PERFORM 6105-READ-SEL-QUEUE.                                 28040001
280500     PERFORM                                                      28050001
280600         VARYING RD022-IDX                                        28060001
280700         FROM 1 BY 1                                              28070001
280800         UNTIL ((PV-ITEMS-PROCESSED >                             28080001
280900                              PV-HOLD-SELECTED-ITEMS)             28090001
281000         OR (RD022-IDX GREATER THAN RD022-MAX-ITEMS))             28100001
281100         IF  RD022-ACTION-SW (RD022-IDX) > SPACE                  28110001
281200             PERFORM 6110-PROCESS-ITEMS                           28120001
281300         END-IF                                                   28130001
281400         ADD +1                TO PV-ITEMS-PROCESSED              28140001
281500     END-PERFORM.                                                 28150001
281600     PERFORM 6111-WRITE-LIST-QUEUE.                               28160001
281700                                                                  28170001
281800*----------------------------------------------------------------*28180001
281900*    READ THE LIST QUEUE RECORD.                                 *28190001
282000*----------------------------------------------------------------*28200001
282100                                                                  28210001
282200 6105-READ-SEL-QUEUE.                                             28220001
282300                                                                  28230001
282400     EXEC CICS                                                    28240001
282500          READQ TS                                                28250001
282600              QUEUE (ASC-SEL-QUEUE-NAME)                          28260001
282700              INTO  (RD022-MESSAGE-SEL-REC)                       28270001
282800              ITEM  (PV-SEL-QUEUE-ITEM)                           28280001
282900              RESP  (PV-CICS-RESP)                                28290001
283000     END-EXEC.                                                    28300001
283100                                                                  28310001
283200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28320001
283300         CONTINUE                                                 28330001
283400     ELSE                                                         28340001
283500         SET DP013-CICS-ABEND      TO  TRUE                       28350001
283600         SET DP013-NO-ROLLBACK     TO  TRUE                       28360001
283700         MOVE '6105-READ-SEL-QUEUE'                               28370001
283800                                   TO  DP013-PARAGRAPH            28380001
283900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           28390001
284000                                   TO  DP013-MESSAGE-TEXT(1)      28400001
284100         PERFORM DP013-0000-PROCESS-ABEND                         28410001
284200     END-IF.                                                      28420001
284300*----------------------------------------------------------------*28430001
284400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*28440001
284500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*28450001
284600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *28460001
284700*----------------------------------------------------------------*28470001
284800                                                                  28480001
284900 6110-PROCESS-ITEMS.                                              28490001
285000                                                                  28500001
285100     COMPUTE PV-ITEM = 1 + ((RD022-ITEM (RD022-IDX) - 1)          28510001
285200                     / PC-ITEMS-PER-PANEL).                       28520001
285300                                                                  28530001
285400     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           28540001
285500         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          28550001
285600             PERFORM 6111-WRITE-LIST-QUEUE                        28560001
285700         END-IF                                                   28570001
285800         MOVE PV-ITEM          TO PV-SAVE-ITEM                    28580001
285900                                                                  28590001
286000         PERFORM 6112-READ-LIST-QUEUE                             28600001
286100         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               28610001
286200             CONTINUE                                             28620001
286300         END-IF                                                   28630001
286400     END-IF.                                                      28640001
286500                                                                  28650001
286600     COMPUTE PV-SUB = (RD022-ITEM (RD022-IDX)                     28660001
286700                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              28670001
286800     SET LQW-DESELECT (PV-SUB) TO    TRUE                         28680001
286900     MOVE LQW-SELECTED-SW (PV-SUB)                                28690001
287000                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  28700001
287100                                                                  28710001
287200     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                28720001
287300                                                                  28730001
287400*----------------------------------------------------------------*28740001
287500*    WRITE THE TS QUEUE RECORD JUST UPDATED.                     *28750001
287600*----------------------------------------------------------------*28760001
287700                                                                  28770001
287800 6111-WRITE-LIST-QUEUE.                                           28780001
287900                                                                  28790001
288000     EXEC CICS                                                    28800001
288100         WRITEQ TS                                                28810001
288200             QUEUE (ASC-LIST-QUEUE-NAME)                          28820001
288300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     28830001
288400             ITEM  (PV-SAVE-ITEM)                                 28840001
288500             REWRITE                                              28850001
288600             RESP  (PV-CICS-RESP)                                 28860001
288700     END-EXEC.                                                    28870001
288800                                                                  28880001
288900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28890001
289000         CONTINUE                                                 28900001
289100     ELSE                                                         28910001
289200         SET DP013-CICS-ABEND  TO  TRUE                           28920001
289300         SET DP013-NO-ROLLBACK TO  TRUE                           28930001
289400         MOVE '6111-WRITE-LIST-QUEUE'                             28940001
289500                               TO  DP013-PARAGRAPH                28950001
289600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28960001
289700                               TO  DP013-MESSAGE-TEXT(1)          28970001
289800         PERFORM DP013-0000-PROCESS-ABEND                         28980001
289900     END-IF.                                                      28990001
290000                                                                  29000001
290100*----------------------------------------------------------------*29010001
290200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*29020001
290300*----------------------------------------------------------------*29030001
290400                                                                  29040001
290500 6112-READ-LIST-QUEUE.                                            29050001
290600                                                                  29060001
290700     EXEC CICS                                                    29070001
290800         READQ TS                                                 29080001
290900             QUEUE (ASC-LIST-QUEUE-NAME)                          29090001
291000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     29100001
291100             ITEM  (PV-ITEM)                                      29110001
291200             RESP  (PV-CICS-RESP)                                 29120001
291300     END-EXEC.                                                    29130001
291400                                                                  29140001
291500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          29150001
291600         CONTINUE                                                 29160001
291700     ELSE                                                         29170001
291800         SET DP013-CICS-ABEND        TO TRUE                      29180001
291900         SET DP013-NO-ROLLBACK       TO TRUE                      29190001
292000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           29200001
292100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    29210001
292200                                     TO DP013-MESSAGE-TEXT(1)     29220001
292300         PERFORM DP013-0000-PROCESS-ABEND                         29230001
292400     END-IF.                                                      29240001
292500*----------------------------------------------------------------*29250001
292600*----------------------------------------------------------------*29260001
292700*    KMC APPROVAL NUMBER PROCEDURE                               *29270001
292800*----------------------------------------------------------------*29280001
292900                                                                  29290001
293000     COPY SVPD006.                                                29300001
293100******************************************************************29310001
293200**  CONVERSION OF CARD NUMBER                                    *29320001
293300******************************************************************29330001
293400     COPY SVPD007.                                                29340001
293500*----------------------------------------------------------------*29350001
293600*    ABEND PROCESSOR MODULE                                      *29360001
293700*----------------------------------------------------------------*29370001
293800                                                                  29380001
293900     COPY DPPD013.                                                29390001
294000                                                                  29400001
