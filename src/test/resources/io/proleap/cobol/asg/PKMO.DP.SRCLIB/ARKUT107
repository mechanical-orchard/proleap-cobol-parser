000100******************************************************************00010053
000200 IDENTIFICATION DIVISION.                                         00020053
000300******************************************************************00030053
000400                                                                  00040053
000500 PROGRAM-ID.             ARKUT107.                                00050053
000600 AUTHOR.                 COGNIZANT.                               00060053
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070053
000800 DATE-WRITTEN            09-26-2013.                              00080053
000900 DATE-COMPILED.                                                   00090053
001000                                                                  00100053
001100*************************************************************     00110053
001200*   READS THE INPUT FILE CONTAINING THE CHECK NUMBERS AND   *     00120053
001300*   FETCH THE DETAILS PERTAINING TO THE CHECK NUMBER FROM   *     00130053
001400*   THE CHECK REFUND TABLE(TCRRFND). THEN WRITE THE DETAILS *     00140053
001500*   INTO A OUTPUT FILE WITH THE PIPE DELIMITED.             *     00150053
001600*                                                           *     00160053
001700*   INPUT:                                                  *     00170053
001800*        CHECK REGISTER FILE FROM BANK RECON                *     00180053
001900*                                                           *     00190053
002000*   OUTPUT:                                                 *     00200053
002100*        CHECK EXTRACT REGISTER FILE                        *     00210053
002200*        EMAIL CAPTURE FILE                                 *     00220053
002300*************************************************************     00230053
002400**  PROD DATE  INIT  CHNG CNTL   DESCRIPTION               **     00240053
002500**  ---------- ----  ---------   ----------------------------     00250053
002600**  09/26/2013  CTS  CHG0063666  NEW PROGRAM               **     00260053
C67243**  10/31/2013  CTS  CHG0067243  CHANGED THE PATH FROM     **     00270054
C67243**                               S: SHARE TO G: SHARE      **     00280054
C76270**  03/11/2014  CTS  CHG0076270  CHANGED THE PATH of EMAIL **     00290069
C76270**                               CONTENT file IN G: SHARE  **     00300069
002900*************************************************************     00310053
003000 ENVIRONMENT DIVISION.                                            00320053
003100******************************************************************00330053
003200                                                                  00340053
003300 CONFIGURATION SECTION.                                           00350053
003400                                                                  00360053
003500 SOURCE-COMPUTER.        IBM-3090.                                00370053
003600 OBJECT-COMPUTER.        IBM-3090.                                00380053
003700                                                                  00390053
003800 INPUT-OUTPUT SECTION.                                            00400053
003900                                                                  00410053
004000 FILE-CONTROL.                                                    00420053
004100                                                                  00430053
004200     SELECT CHECK-INPUT   ASSIGN TO INP01.                        00440053
004300     SELECT OUTPUT-FILE   ASSIGN TO OUT01.                        00450053
004400     SELECT EMAIL-FILE    ASSIGN TO OUT02.                        00460053
004500                                                                  00470053
004600******************************************************************00480053
004700 DATA DIVISION.                                                   00490053
004800******************************************************************00500053
004900                                                                  00510053
005000 FILE SECTION.                                                    00520053
005100                                                                  00530053
005200 FD CHECK-INPUT                                                   00540053
005300     RECORDING MODE IS F                                          00550053
005400     BLOCK CONTAINS 0 RECORDS                                     00560053
005500     LABEL RECORDS ARE STANDARD.                                  00570053
005600                                                                  00580053
005700 01 CHECK-INPUT-REC                   PIC X(80).                  00590053
005800                                                                  00600053
005900 FD OUTPUT-FILE                                                   00610053
006000     RECORDING MODE IS F                                          00620053
006100     BLOCK CONTAINS 0 RECORDS                                     00630053
006200     LABEL RECORDS ARE STANDARD.                                  00640053
006300 01 OUTPUT-RECORD                     PIC X(240).                 00650053
006400                                                                  00660053
006500 FD EMAIL-FILE                                                    00670053
006600     RECORDING MODE IS F                                          00680053
006700     BLOCK CONTAINS 0 RECORDS                                     00690053
006800     LABEL RECORDS ARE STANDARD.                                  00700053
006900                                                                  00710053
007000 01 EMAIL-RECORD                      PIC X(80).                  00720053
007100                                                                  00730053
007200 WORKING-STORAGE SECTION.                                         00740053
007300******************************************************************00750053
007400*                        ABEND CODES                              00760053
007500******************************************************************00770053
007600     COPY ARWS052.                                                00780053
007700******************************************************************00790053
007800*                        SWITCHES                                 00800053
007900******************************************************************00810053
008000 01 PS-PROGRAM-SWITCHES.                                          00820053
008100    05 PS-CHK-FILE-SW                 PIC X(01)  VALUE 'N'.       00830053
008200       88 PS-CHK-EOF                             VALUE 'Y'.       00840053
008300       88 PS-CHK-NOT-EOF                         VALUE 'N'.       00850053
008400                                                                  00860053
008500******************************************************************00870053
008600*                        CONSTANTS                                00880053
008700******************************************************************00890053
008800 01 PC-PROGRAM-CONSTANTS.                                         00900053
008900    05 PC-PROGRAM-NAME                PIC X(08)  VALUE 'ARKUT107'.00910053
009000    05 PC-ROW-NOT-FOUND-SQLCODE       PIC S9(09) VALUE +100       00920053
009100                                                 COMP.            00930053
009200    05 PC-SUCCESSFUL-SQLCODE          PIC S9(09) VALUE ZEROES     00940053
009300                                                 COMP.            00950053
009400    05 PC-NUM-52                      PIC 9(02)  VALUE 52.        00960053
009500    05 PC-OUT-ACCT-NUM                PIC X(06)  VALUE '639305'.  00970053
009600                                                                  00980053
009700******************************************************************00990053
009800*                        VARIABLES                                01000053
009900******************************************************************01010053
010000 01 PV-PROGRAM-VARIABLES.                                         01020053
010100    05 PV-NOT-FOUND                   PIC S9(09) VALUE ZEROES     01030053
010200                                                 COMP.            01040053
010300    05 PV-INP-READ                    PIC S9(10) VALUE ZEROES     01050053
010400                                                 COMP.            01060053
010500    05 PV-WRITTEN-COUNT               PIC S9(09) VALUE ZEROES     01070053
010600                                                 COMP.            01080053
010700    05 PV-INV-CHK-COUNT               PIC S9(09) VALUE ZEROES     01090053
010800                                                 COMP.            01100053
010900    05 PV-OPERATION-MSG               PIC X(30)  VALUE SPACES.    01110053
011000    05 PV-PARAGRAPH-NAME              PIC X(30)  VALUE SPACES.    01120053
011100    05 PV-DB2-TABLE-NAME              PIC X(30)  VALUE SPACES.    01130053
011200    05 PV-CRRFND-ACCT-NBR             PIC X(12)  VALUE SPACE.     01140053
011300    05 PV-RFND-AMT-ZERO-COUNT         PIC S9(02) VALUE ZEROES     01150053
011400                                                 COMP.            01160053
011500    05 PV-OUT-RFND-AMT-TEMP           PIC 9(12).9(2).             01170053
011600    05 PV-OUT-RFND-AMT-TEMP1          PIC X(15).                  01180053
011700    05 PV-OUT-CK-NO-TEMP              PIC X(09).                  01190053
011800    05 PV-STRING-VAR1                 PIC X(15).                  01200053
011900    05 PV-STRING-VAR2.                                            01210053
012000       07 OUT-ACCT-NBR-C.                                         01220053
012100          08 OUT-ACCT-NBR-CNST        PIC X(06).                  01230053
012200          08 OUT-ACCT-NBR-VAR         PIC X(10).                  01240053
012300       07 FILLER                      PIC X(01)  VALUE ','.       01250053
012400       07 OUT-CK-NO-C                 PIC 9(08).                  01260070
012500       07 FILLER                      PIC X(01)  VALUE ','.       01270053
012600       07 OUT-CK-DTE-MM-C             PIC X(02).                  01280053
012700       07 OUT-CK-DTE-DD-C             PIC X(02).                  01290053
012800       07 OUT-CK-DTE-YY-C             PIC X(02).                  01300053
012900       07 FILLER                      PIC X(01)  VALUE ','.       01310053
013000       07 OUT-RFND-AMT-C              PIC X(15)  VALUE SPACES.    01320053
013100******************************************************************01330053
013200*                       INPUT FILE LAYOUT                         01340053
013300******************************************************************01350053
013400 01 PV-INPUT-RECORD.                                              01360053
013500    02 INP-CK-NO                      PIC 9(08).                  01370070
013600    02 FILLER                         PIC X(72)  VALUE SPACES.    01380070
013700******************************************************************01390053
013800*                        OUTPUT FILE LAYOUT                       01400053
013900******************************************************************01410053
014000******************************************************************01420053
014100* TRANS FILE LAYOUT                                               01430053
014200******************************************************************01440053
014300 01 PV-OUTPUT-RECORD.                                             01450053
014400    02 OUT-CK-NO                      PIC 9(08).                  01460070
014500    02 FILLER                         PIC X(01)  VALUE '|'.       01470053
014600    02 OUT-CK-DTE-MM                  PIC X(02).                  01480053
014700    02 OUT-CK-DTE-DD                  PIC X(02).                  01490053
014800    02 OUT-CK-DTE-YY                  PIC X(02).                  01500053
014900    02 FILLER                         PIC X(01)  VALUE '|'.       01510053
015000    02 OUT-ACCT-NBR                   PIC X(09).                  01520053
015100    02 FILLER                         PIC X(01)  VALUE '|'.       01530053
015200    02 OUT-CUST-NAME                  PIC X(30).                  01540053
015300    02 FILLER                         PIC X(01)  VALUE '|'.       01550053
015400    02 OUT-CUST-ADR-LNE1              PIC X(30).                  01560053
015500    02 FILLER                         PIC X(01)  VALUE '|'.       01570053
015600    02 OUT-CUST-ADR-LNE2              PIC X(30).                  01580053
015700    02 FILLER                         PIC X(01)  VALUE '|'.       01590053
015800    02 OUT-CUST-ADR-LNE3              PIC X(30).                  01600053
015900    02 FILLER                         PIC X(01)  VALUE '|'.       01610053
016000    02 OUT-PHN-NBR                    PIC X(12).                  01620053
016100    02 FILLER                         PIC X(01)  VALUE '|'.       01630053
016200    02 OUT-STRING-VAR3                PIC X(63)  VALUE SPACES.    01640053
016300    02 FILLER                         PIC X(12)  VALUE SPACES.    01650070
016400******************************************************************01660053
016500*               OUTPUT FILE HEADER LAYOUT                         01670053
016600******************************************************************01680053
016700 01 HR-OUTPUT-RECORD.                                             01690053
016800    05 HR-CHK-NBR                     PIC X(08)  VALUE  'CHK NBR'.01700070
016900    05 FILLER                         PIC X(01)  VALUE '|'.       01710053
017000    05 HR-CHK-DTE                     PIC X(06)  VALUE            01720053
017100                                                     'CHK DT'.    01730053
017200    05 FILLER                         PIC X(01)  VALUE '|'.       01740053
017300    05 HR-ACCT-NBR                    PIC X(09)  VALUE            01750053
017400                                                     'ACCT NBR '. 01760053
017500    05 FILLER                         PIC X(01)  VALUE '|'.       01770053
017600    05 HR-CUST-NAME                   PIC X(30)  VALUE            01780053
017700                                                     'Cust name'. 01790053
017800    05 FILLER                         PIC X(01)  VALUE '|'.       01800053
017900    05 HR-ADDR-LINE-1                 PIC X(30)  VALUE            01810053
018000                                               'Cust Addr Line 1'.01820053
018100    05 FILLER                         PIC X(01)  VALUE '|'.       01830053
018200    05 HR-ADDR-LINE-2                 PIC X(30)  VALUE            01840053
018300                                               'Cust Addr Line 2'.01850053
018400    05 FILLER                         PIC X(01)  VALUE '|'.       01860053
018500    05 HR-ADDR-LINE-3                 PIC X(30)  VALUE            01870053
018600                                               'Cust Addr Line 3'.01880053
018700    05 FILLER                         PIC X(01)  VALUE '|'.       01890053
018800    05 HR-PHONE-NBR                   PIC X(12)  VALUE            01900053
018900                                                   'PHONE NBR   '.01910053
019000    05 FILLER                         PIC X(01)  VALUE '|'.       01920053
019100    05 HR-RFND-AMT                    PIC X(04)  VALUE 'RAMT'.    01930053
019200    05 FILLER                         PIC X(01)  VALUE '|'.       01940053
019300    05 HR-CONCATENATED-FIELD          PIC X(46)  VALUE            01950070
019400                  'Account Number  ,ChK Nbr,Chk Dt,Refund Amount'.01960053
019500                                                                  01970053
019600 01 HR-DASH-LINE                      PIC X(214) VALUE ALL '-'.   01980053
019700                                                                  01990053
019800******************************************************************02000053
019900*        SUCESS EMAIL LAYOUT SECTION                       *      02010053
020000******************************************************************02020053
020100 01 EMAIL-CONTENT-LINE1               PIC X(03)  VALUE 'Hi,'.     02030053
020200                                                                  02040053
020300 01 EMAIL-CONTENT-LINE2.                                          02050053
020400    05 EMAIL-CONTENT-SECTION1         PIC X(45)  VALUE            02060053
020500       'The Check Register Data has been successfully'.           02070053
020600    05 EMAIL-CONTENT-SECTION2         PIC X(22)  VALUE            02080053
020700       ' processed and sent to'.                                  02090053
020800                                                                  02100053
020900 01 EMAIL-CONTENT-LINE3               PIC X(76)  VALUE            02110053
C76270                  'G:\share\IS\Credit Finance\Check Register\Check02120069
C76270-       'Register'.                                               02130069
021200                                                                  02140053
021300 01 EMAIL-CONTENT-LINE4               PIC X(50)  VALUE SPACES.    02150053
021400                                                                  02160053
021500 01 EMAIL-FOOTER-LINE1                PIC X(24)  VALUE            02170053
021600       'PFB THE JOB STATISTICS:'.                                 02180053
021700                                                                  02190053
021800 01 EMAIL-FOOTER-LINE2.                                           02200053
021900    05 EMAIL-FOOTER-TEXT2             PIC X(34)  VALUE            02210053
022000       'No of Records read              : '.                      02220053
022100    05 PV-REPORT-COUNT2               PIC 9(10)  VALUE ZEROES.    02230053
022200                                                                  02240053
022300 01 EMAIL-FOOTER-LINE3.                                           02250053
022400    05 EMAIL-FOOTER-TEXT3             PIC X(31)  VALUE            02260053
022500       'No of CheckNo not found      : '.                         02270053
022600    05 PV-REPORT-COUNT1               PIC 9(9)   VALUE ZEROES.    02280053
022700                                                                  02290053
022800 01 EMAIL-FOOTER-LINE4.                                           02300053
022900    05 EMAIL-FOOTER-TEXT4             PIC X(35)  VALUE            02310053
023000       'No of records written            : '.                     02320053
023100    05 PV-REPORT-COUNT3               PIC 9(9)   VALUE ZEROES.    02330053
023200                                                                  02340053
023300 01 EMAIL-FOOTER-LINE5.                                           02350053
023400    05 EMAIL-FOOTER-TEXT5             PIC X(37)  VALUE            02360053
023500       'No of invalid check numbers found   :'.                   02370053
023600    05 PV-REPORT-COUNT4               PIC 9(9)   VALUE ZEROES.    02380053
023700                                                                  02390053
023800 01 EMAIL-CONTENT-LINE5               PIC X(50)  VALUE SPACES.    02400053
023900                                                                  02410053
024000 01 EMAIL-CONTENT-LINE6               PIC X(8)   VALUE            02420053
024100       'Regards,'.                                                02430053
024200                                                                  02440053
024300 01 EMAIL-CONTENT-LINE7               PIC X(14)  VALUE            02450053
024400       'Firstdata team'.                                          02460053
024500                                                                  02470053
024600 01 EMAIL-DISC-LINE1                  PIC X(46)  VALUE            02480053
024700       'This is an automated mail,please do not reply'.           02490053
024800                                                                  02500053
024900 01 EMAIL-DISC-LINE2                  PIC X(52)  VALUE            02510053
025000       'For any questions contact it-firstdatateam@kohls.com'.    02520053
025100                                                                  02530053
025200******************************************************************02540053
025300* DPWS004 VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004 02550053
025400******************************************************************02560053
025500     COPY DPWS004.                                                02570053
025600                                                                  02580053
025700******************************************************************02590053
025800* DB2 MESSAGE AREA                                                02600053
025900******************************************************************02610053
026000     COPY SQLCA2.                                                 02620053
026100                                                                  02630053
026200******************************************************************02640053
026300*                     SQL DECLARATIONS                            02650053
026400******************************************************************02660053
026500                                                                  02670053
026600******************************************************************02680053
026700*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                02690053
026800******************************************************************02700053
026900     EXEC SQL                                                     02710053
027000         INCLUDE SQLCA                                            02720053
027100     END-EXEC.                                                    02730053
027200******************************************************************02740053
027300*                     TCRRFND  AR-CREDIT REFUND TABLE             02750053
027400******************************************************************02760053
027500     EXEC SQL                                                     02770053
027600         INCLUDE TCRRFND                                          02780053
027700     END-EXEC.                                                    02790053
027800                                                                  02800053
027900******************************************************************02810053
028000 PROCEDURE DIVISION.                                              02820053
028100******************************************************************02830053
028200*--------------*                                                  02840053
028300 0000-MAINLINE.                                                   02850053
028400*--------------*                                                  02860053
028500                                                                  02870053
028600     PERFORM 1000-INITIALIZE.                                     02880053
028700                                                                  02890053
028800     PERFORM 2000-PROCESS-FILE                                    02900053
028900       UNTIL PS-CHK-EOF.                                          02910053
029000                                                                  02920053
029100     PERFORM 3000-END-PROC.                                       02930053
029200                                                                  02940053
029300     STOP RUN.                                                    02950053
029400                                                                  02960053
029500******************************************************************02970053
029600* 1000 - INITIALIZE                                               02980053
029700******************************************************************02990053
029800 1000-INITIALIZE.                                                 03000053
029900                                                                  03010053
030000     OPEN INPUT  CHECK-INPUT.                                     03020053
030100     OPEN OUTPUT OUTPUT-FILE                                      03030053
030200                 EMAIL-FILE.                                      03040053
030300     WRITE OUTPUT-RECORD FROM HR-OUTPUT-RECORD.                   03050053
030400     WRITE OUTPUT-RECORD FROM HR-DASH-LINE.                       03060053
030500     SET PS-CHK-NOT-EOF          TO TRUE.                         03070053
030600     PERFORM 1500-READ-CHECK-INPUT.                               03080053
030700                                                                  03090053
030800******************************************************************03100053
030900* 1500 - READ CHECK INPUT FILE                                    03110053
031000******************************************************************03120053
031100 1500-READ-CHECK-INPUT.                                           03130053
031200     READ CHECK-INPUT INTO PV-INPUT-RECORD                        03140053
031300        AT END SET PS-CHK-EOF    TO TRUE.                         03150053
031400     ADD 1                       TO PV-INP-READ.                  03160053
031500                                                                  03170053
031600******************************************************************03180053
031700* 2000- CHECK PROCESS PARA                                        03190053
031800******************************************************************03200053
031900 2000-PROCESS-FILE.                                               03210053
032000     IF  INP-CK-NO IS NUMERIC                                     03220053
032100         PERFORM 2100-FETCH-CHECK-DATA                            03230053
032200     ELSE                                                         03240053
032300         ADD 1                   TO PV-INV-CHK-COUNT              03250053
032400     END-IF                                                       03260053
032500     PERFORM 1500-READ-CHECK-INPUT.                               03270053
032600                                                                  03280053
032700******************************************************************03290053
032800* 2100 - FETCH CHECK DETAILS FROM THE CREDIT REFUND TABLE         03300053
032900******************************************************************03310053
033000 2100-FETCH-CHECK-DATA.                                           03320053
033100                                                                  03330053
033200     MOVE INP-CK-NO              TO CRRFND-CK-NBR.                03340053
033300     INITIALIZE PV-OUTPUT-RECORD.                                 03350053
033400     EXEC SQL                                                     03360053
033500         SELECT CK_DTE                                            03370053
033600               ,ACCT_NBR                                          03380053
033700               ,CUST_NAME                                         03390053
033800               ,CUST_ADR_LNE1                                     03400053
033900               ,CUST_ADR_LNE2                                     03410053
034000               ,CUST_ADR_LNE3                                     03420053
034100               ,PHN_NBR                                           03430053
034200               ,RFND_AMT                                          03440053
034300           INTO :CRRFND-CK-DTE                                    03450053
034400               ,:CRRFND-ACCT-NBR                                  03460053
034500               ,:CRRFND-CUST-NAME                                 03470053
034600               ,:CRRFND-CUST-ADR-LNE1                             03480053
034700               ,:CRRFND-CUST-ADR-LNE2                             03490053
034800               ,:CRRFND-CUST-ADR-LNE3                             03500053
034900               ,:CRRFND-PHN-NBR                                   03510053
035000               ,:CRRFND-RFND-AMT                                  03520053
035100         FROM TCRRFND                                             03530053
035200         WHERE CK_NBR     = :CRRFND-CK-NBR                        03540053
035300         WITH UR                                                  03550053
035400     END-EXEC.                                                    03560053
035500                                                                  03570053
035600     EVALUATE TRUE                                                03580053
035700          WHEN SQLCODE = PC-SUCCESSFUL-SQLCODE                    03590053
035800            PERFORM 2150-TRIM-ACCT-DATA                           03600053
035900            PERFORM 2200-REFORMAT-RFND-AMT-PARA                   03610053
036000            PERFORM 2250-MOVE-CHECK-DATA                          03620053
036100            PERFORM 2300-WRITE-CHECK-DATA                         03630053
036200          WHEN SQLCODE = PC-ROW-NOT-FOUND-SQLCODE                 03640053
036300            MOVE INP-CK-NO       TO OUT-CK-NO                     03650053
036400            WRITE OUTPUT-RECORD  FROM PV-OUTPUT-RECORD            03660053
036500            ADD 1                TO PV-NOT-FOUND                  03670053
036600          WHEN OTHER                                              03680053
036700            MOVE '2100-FETCH-CHECK-DATA'                          03690053
036800                                 TO PV-PARAGRAPH-NAME             03700053
036900            MOVE 'TCRRFND  '     TO PV-DB2-TABLE-NAME             03710053
037000            MOVE 'SELECT ERROR'  TO PV-OPERATION-MSG              03720053
037100            SET ABEND-4013-DB2-ERROR                              03730053
037200                                 TO TRUE                          03740053
037300            PERFORM 9999-ABEND                                    03750053
037400     END-EVALUATE.                                                03760053
037500******************************************************************03770053
037600* 2110 -  TRIM THE ACCOUNT FIELD BEFORE POPULATING THE OUTPUT     03780053
037700******************************************************************03790053
037800 2150-TRIM-ACCT-DATA.                                             03800053
037900                                                                  03810053
038000     MOVE PC-OUT-ACCT-NUM        TO OUT-ACCT-NBR-CNST.            03820053
038100     MOVE CRRFND-ACCT-NBR        TO PV-CRRFND-ACCT-NBR.           03830053
038200                                                                  03840053
038300     EVALUATE TRUE                                                03850053
038400        WHEN PV-CRRFND-ACCT-NBR(11:2) = '52' AND                  03860053
038500             PV-CRRFND-ACCT-NBR(1:1)  = '0'                       03870053
038600             IF PV-CRRFND-ACCT-NBR(1:3) = '000' OR '001'          03880071
038700                MOVE PV-CRRFND-ACCT-NBR(4:9)                      03890053
038800                                 TO OUT-ACCT-NBR                  03900053
038900                MOVE PV-CRRFND-ACCT-NBR(3:10)                     03910053
039000                                 TO OUT-ACCT-NBR-VAR              03920053
039100             ELSE                                                 03930053
039200                MOVE PV-CRRFND-ACCT-NBR(2:9)                      03940053
039300                                 TO OUT-ACCT-NBR                  03950053
039400                MOVE PV-CRRFND-ACCT-NBR(1:10)                     03960053
039500                                 TO OUT-ACCT-NBR-VAR              03970053
039600             END-IF                                               03980053
039700        WHEN PV-CRRFND-ACCT-NBR(11:2)                             03990053
039800                       NOT EQUAL TO '52' AND                      04000053
039900             PV-CRRFND-ACCT-NBR(1:3) = '000' OR '001'             04010071
040000             MOVE PV-CRRFND-ACCT-NBR(4:9)                         04020053
040100                                 TO OUT-ACCT-NBR                  04030053
040200             MOVE PV-CRRFND-ACCT-NBR(3:10)                        04040053
040300                                 TO OUT-ACCT-NBR-VAR              04050053
040400     END-EVALUATE.                                                04060053
040500                                                                  04070053
040600******************************************************************04080053
040700* 2050- REFORMATS REFUND AMNT BEFORE MOVING IT TO OUTPUT VARIABLE 04090053
040800******************************************************************04100053
040900  2200-REFORMAT-RFND-AMT-PARA.                                    04110053
041000      INITIALIZE PV-OUT-RFND-AMT-TEMP                             04120053
041100                 PV-OUT-RFND-AMT-TEMP1.                           04130053
041200      MOVE CRRFND-RFND-AMT       TO PV-OUT-RFND-AMT-TEMP.         04140053
041300      MOVE PV-OUT-RFND-AMT-TEMP  TO PV-OUT-RFND-AMT-TEMP1.        04150053
041400      MOVE ZEROES                TO PV-RFND-AMT-ZERO-COUNT.       04160053
041500      INSPECT PV-OUT-RFND-AMT-TEMP1                               04170053
041600              TALLYING PV-RFND-AMT-ZERO-COUNT                     04180053
041700                                   FOR LEADING ZEROES             04190053
041800              BEFORE INITIAL '.'                                  04200053
041900      ADD 1                      TO PV-RFND-AMT-ZERO-COUNT        04210053
042000      MOVE PV-OUT-RFND-AMT-TEMP1 (PV-RFND-AMT-ZERO-COUNT:)        04220053
042100                                 TO    PV-STRING-VAR1             04230053
042200                                       OUT-RFND-AMT-C.            04240053
042300******************************************************************04250053
042400* 2150 - POPULATE THE OUTPUT RECORD WITH CHECK DETAILS            04260053
042500******************************************************************04270053
042600 2250-MOVE-CHECK-DATA.                                            04280053
042700                                                                  04290053
042800     MOVE CRRFND-CK-NBR          TO OUT-CK-NO                     04300053
042900                                    OUT-CK-NO-C.                  04310053
043000     MOVE CRRFND-CK-DTE(6:2)     TO OUT-CK-DTE-MM                 04320053
043100                                    OUT-CK-DTE-MM-C.              04330053
043200     MOVE CRRFND-CK-DTE(9:2)     TO OUT-CK-DTE-DD                 04340053
043300                                    OUT-CK-DTE-DD-C.              04350053
043400     MOVE CRRFND-CK-DTE(3:2)     TO OUT-CK-DTE-YY                 04360053
043500                                    OUT-CK-DTE-YY-C.              04370053
043600     MOVE CRRFND-CUST-NAME       TO OUT-CUST-NAME                 04380053
043700     MOVE CRRFND-CUST-ADR-LNE1   TO OUT-CUST-ADR-LNE1.            04390053
043800     MOVE CRRFND-CUST-ADR-LNE2   TO OUT-CUST-ADR-LNE2.            04400053
043900     MOVE CRRFND-CUST-ADR-LNE3   TO OUT-CUST-ADR-LNE3.            04410053
044000     MOVE CRRFND-PHN-NBR         TO OUT-PHN-NBR.                  04420053
044100******************************************************************04430053
044200* 2200 - WRITE THE CHECK DETAILS INTO OUTPUT FILE                 04440053
044300******************************************************************04450053
044400 2300-WRITE-CHECK-DATA.                                           04460053
044500     STRING PV-STRING-VAR1 DELIMITED BY SPACE                     04470053
044600                       '|' DELIMITED BY SIZE                      04480053
044700            PV-STRING-VAR2 DELIMITED BY SIZE                      04490053
044800       INTO OUT-STRING-VAR3.                                      04500053
044900     WRITE OUTPUT-RECORD         FROM PV-OUTPUT-RECORD.           04510053
045000     INITIALIZE PV-STRING-VAR1                                    04520053
045100                PV-STRING-VAR2.                                   04530053
045200     ADD 1                       TO PV-WRITTEN-COUNT.             04540053
045300                                                                  04550053
045400******************************************************************04560053
045500* 2500 - PERFORMS EMAIL PARA TO WRITE THE EMAIL FILE              04570053
045600******************************************************************04580053
045700 2500-EMAIL-WRITE-PARA.                                           04590053
045800     WRITE EMAIL-RECORD    FROM EMAIL-CONTENT-LINE1.              04600053
045900     WRITE EMAIL-RECORD    FROM EMAIL-CONTENT-LINE2.              04610053
046000     WRITE EMAIL-RECORD    FROM EMAIL-CONTENT-LINE3.              04620053
046100     WRITE EMAIL-RECORD    FROM EMAIL-CONTENT-LINE4.              04630053
046200     WRITE EMAIL-RECORD    FROM EMAIL-FOOTER-LINE1.               04640053
046300     MOVE PV-INP-READ            TO PV-REPORT-COUNT2.             04650053
046400     WRITE EMAIL-RECORD    FROM EMAIL-FOOTER-LINE2.               04660053
046500     MOVE PV-NOT-FOUND           TO PV-REPORT-COUNT1.             04670053
046600     WRITE EMAIL-RECORD    FROM EMAIL-FOOTER-LINE3.               04680053
046700     MOVE PV-WRITTEN-COUNT       TO PV-REPORT-COUNT3.             04690053
046800     WRITE EMAIL-RECORD    FROM EMAIL-FOOTER-LINE4.               04700053
046900     MOVE PV-INV-CHK-COUNT       TO PV-REPORT-COUNT4.             04710053
047000     WRITE EMAIL-RECORD    FROM EMAIL-FOOTER-LINE5.               04720053
047100     WRITE EMAIL-RECORD    FROM EMAIL-CONTENT-LINE5.              04730053
047200     WRITE EMAIL-RECORD    FROM EMAIL-CONTENT-LINE6.              04740053
047300     WRITE EMAIL-RECORD    FROM EMAIL-CONTENT-LINE7.              04750053
047400     WRITE EMAIL-RECORD    FROM EMAIL-DISC-LINE1.                 04760053
047500     WRITE EMAIL-RECORD    FROM EMAIL-DISC-LINE2.                 04770053
047600******************************************************************04780053
047700* 3000 - PERFORMS TASK TERMINATION PROCESSING                     04790053
047800******************************************************************04800053
047900 3000-END-PROC.                                                   04810053
048000     COMPUTE PV-INP-READ = PV-INP-READ - 1.                       04820053
048100     DISPLAY ' '.                                                 04830053
048200     DISPLAY '**********************'.                            04840053
048300     DISPLAY '   ARKUT107 SUMMARY   '.                            04850053
048400     DISPLAY '**********************'.                            04860053
048500     DISPLAY '   '                                                04870053
048600     DISPLAY 'RECORDS READ    '  PV-INP-READ.                     04880053
048700     DISPLAY 'RECORDS WRITTEN '  PV-WRITTEN-COUNT.                04890053
048800     DISPLAY 'CHECK NOT FOUND '  PV-NOT-FOUND.                    04900053
048900     DISPLAY 'INVALID CHECK NO.' PV-INV-CHK-COUNT.                04910053
049000     PERFORM 2500-EMAIL-WRITE-PARA.                               04920053
049100                                                                  04930053
049200     CLOSE CHECK-INPUT                                            04940053
049300           OUTPUT-FILE                                            04950053
049400           EMAIL-FILE.                                            04960053
049500                                                                  04970053
049600******************************************************************04980053
049700* 9999 - ABEND ROUTINE                                            04990053
049800******************************************************************05000053
049900 9999-ABEND.                                                      05010053
050000                                                                  05020053
050100     IF ABEND-4013-DB2-ERROR                                      05030053
050200                                                                  05040053
050300        PERFORM D999-DISPLAY-SQLCA                                05050053
050400                                                                  05060053
050500        MOVE SQLCODE             TO SQLCODE2                      05070053
050600        MOVE SQLERRD(3)          TO SQLERRD3                      05080053
050700                                                                  05090053
050800        DISPLAY '** ABEND           ** = SQLABEND'                05100053
050900        DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME        05110053
051000        DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME      05120053
051100        DISPLAY '** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME      05130053
051200        DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG       05140053
051300        DISPLAY '** SQLCODE         ** = ' SQLCODE2               05150053
051400        DISPLAY '** ROWS PROCESSED  ** = ' SQLERRD3               05160053
051500        DISPLAY '** SQLERRM         ** = ' SQLERRM                05170053
051600        DISPLAY '** SQLERRMC        ** = ' SQLERRMC               05180053
051700     END-IF                                                       05190053
051800     CALL 'ILBOABN0' USING ABEND-CODE.                            05200053
051900                                                                  05210053
052000******************************************************************05220053
052100* D999 - DISPLAY SQL INFORMATION IN READABLE FORMAT               05230053
052200******************************************************************05240053
052300 D999-DISPLAY-SQLCA.                                              05250053
052400******************************************************************05260053
052500*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   05270053
052600*  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        05280053
052700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05290053
052800*  FORMAT.                                                        05300053
052900******************************************************************05310053
053000        COPY DPPD004.                                             05320053
