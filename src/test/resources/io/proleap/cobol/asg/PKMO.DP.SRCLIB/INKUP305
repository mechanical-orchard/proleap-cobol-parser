       IDENTIFICATION DIVISION.                                         00010099
       PROGRAM-ID.     INKUP305.                                        00020099
       INSTALLATION.   KOHLS DEPARTMENT STORES.                         00030099
       DATE-WRITTEN.   09/06/2005.                                      00040099
       DATE-COMPILED.                                                   00050099
                                                                        00060099
      ******************************************************************00070099
      *PURPOSE:  THE MODULE TAKES IN THE DAILY FAST TRANSFER SYSTEM     00080099
      *          ADJUSTMENT FILE, FOR ASSUMPTIVE RECEVIED ADJUSTMENT, TO00090099
      *          BE APPLIED TO THE INVENTORY DETAIL ADJUSTMENT TABLE.   00100099
      *                 (SEE THE FLOW SECTION FOR MORE DETAILS)         00110099
      *                                                                 00120099
      *CHG ID/                                                          00130099
      *WR/PROJ DATE       PGMR        DESCRIPTION                       00140099
      *------- ---------- ----------- ----------------------------------00150099
W28545*W28545  08-22-2005 ROD JANSSEN THE NEW TRANSFER PROCESS          00160099
W28545*                               (CREATION)                        00170099
29908 *W29908  01-30-2006 ROD JANSSEN IF THE SKU/LOC DOES NOT EXIST IN  00180099
29908 *                               TSUMINV OR TADJADD, ADD TO TADJADD00190099
30272 *W30272  03-28-2006 ROD JANSSEN THE DKEY_NBR FROM THE ORIGINAL    00200099
30272 *                               SNAPSHEET SHEET ENTRY NEEDS TO BE 00210099
30272 *                               USED TO KEEP THE INTEGRITY FOR THE00220099
30272 *                               FAST TRANSFER ADJUSTMENT. (LIKE A 00230099
30272 *                               NORMAL INVENTORY ADJUSTMENT!!!)   00240099
P28545*W28545  03-24-2006 ROD JANSSEN CYCLE INVENTORY PRICE MODULE SETUP00241099
D28545*W28545  04-11-2006 ROD JANSSEN DUMMY SKU & RETURN CODES.         00242099
974649*974649  01-24-2007 ROD JANSSEN REPORT GENERATION ISSUE....       00243099
W33304*W33304  09-18-2008 VINOD /     HOLDING INVENTORY LEDGER OPEN             
W33304*                    INFOSYS    (HILO).                                   
PM3403*PM3403  04-20-2012 S.JACKSON LG RETAIL RECOMPILE ONLY(TFRD054)      CL**6
      ******************************************************************00250099
                                                                        00260099
       ENVIRONMENT DIVISION.                                            00270099
       CONFIGURATION SECTION.                                           00280099
       INPUT-OUTPUT SECTION.                                            00290099
       FILE-CONTROL.                                                    00300099
                                                                        00310099
           SELECT TRANSFER-DATA-FILE                                    00320099
               ASSIGN TO INP01.                                         00330099
                                                                        00340099
           SELECT TRANSFER-DATA-ERROR-FILE                              00350099
               ASSIGN TO OUT01.                                         00360099
                                                                        00370099
           SELECT FASHION-ADJUSTMENTS                                   00380099
               ASSIGN TO OUT02.                                         00390099
                                                                        00400099
W33304     SELECT TRANSFER-INPUT-ERROR-FILE                                     
W33304         ASSIGN TO OUT03.                                                 
W33304                                                                          
           SELECT TRANSFER-REPORT                                       00410099
W33304         ASSIGN TO OUT04.                                         00420099
                                                                        00430099
       DATA DIVISION.                                                   00440099
       FILE SECTION.                                                    00450099
                                                                        00460099
       FD  TRANSFER-DATA-FILE                                           00470099
           RECORDING MODE IS F                                          00480099
           LABEL RECORDS ARE STANDARD                                   00490099
           BLOCK CONTAINS 0 RECORDS.                                    00500099
       01  TRANSFER-DATA-RECORD     PIC X(120).                         00510099
                                                                        00520099
       FD  TRANSFER-DATA-ERROR-FILE                                     00530099
           LABEL RECORDS ARE OMITTED                                    00540099
           RECORDING MODE IS F                                          00550099
           BLOCK CONTAINS 0 RECORDS.                                    00560099
       01  TFR-DATA-ERROR-RECORD    PIC X(120).                         00570099
                                                                        00580099
       FD  FASHION-ADJUSTMENTS                                          00590099
           LABEL RECORDS ARE STANDARD                                   00600099
           RECORDING MODE IS F                                          00610099
           BLOCK CONTAINS 0 RECORDS.                                    00620099
       01  FASHION-ADJUST-RECORD    PIC X(200).                         00630099
                                                                        00640099
       FD  TRANSFER-REPORT                                              00650099
           LABEL RECORDS ARE OMITTED                                    00660099
           RECORD CONTAINS 132 CHARACTERS                               00670099
           RECORDING MODE IS F                                          00680099
           DATA RECORD IS REPORT-LINE.                                  00690099
       01  REPORT-LINE              PIC X(132).                         00700099
                                                                        00710099
W33304 FD  TRANSFER-INPUT-ERROR-FILE                                            
W33304     LABEL RECORDS ARE OMITTED                                            
W33304     RECORDING MODE IS F                                                  
W33304     BLOCK CONTAINS 0 RECORDS.                                            
W33304 01  TFR-INPUT-ERROR-RECD     PIC X(120).                                 
W33304                                                                          
      /*****************************************************************00720099
       WORKING-STORAGE SECTION.                                         00730099
      ******************************************************************00740099
                                                                        00750099
       01  PA-PROGRAM-ACCUMULATORS.                                     00760099
           05  PA-FS-WRITE-COUNT       PIC 9(09) VALUE ZEROES.          00770099
           05  PA-COMMIT-COUNT         PIC 9(09) VALUE ZEROES.          00780099
           05  PA-INSERT-COUNT         PIC 9(09) VALUE ZEROES.          00790099
           05  PA-UPDATE-COUNT         PIC 9(09) VALUE ZEROES.          00800099
           05  PA-EXTRACT-RECS-READ    PIC 9(09) VALUE ZEROES.          00810099
           05  PA-ZERO-REC-DROPPED     PIC 9(09) VALUE ZEROES.          00820099
           05  PA-DUPLICATE-REC        PIC 9(09) VALUE ZEROES.          00830099
                                                                        00990099
       01  PC-PROGRAM-CONSTANTS-AREA.                                   01000099
           05  PC-PROGRAM-NAME      PIC X(08)  VALUE 'INKUP305'.        01010099
           05  PC-JOB-NAME          PIC X(08)  VALUE 'INK331  '.        01020099
           05  PC-MAX-RETRIES       PIC S9(04) VALUE +3 COMP SYNC.      01040099
           05  PC-OPERCO-NBR        PIC X(02)  VALUE '03'.              01050099
           05  PC-11                PIC S9(04) COMP VALUE 11.           01060099
           05  PC-ONE-BILLION       PIC S9(11) COMP-3 VALUE +1000000000.01070099
           05  PC-PRIME1            PIC S9(05) COMP-3 VALUE +38543.     01080099
           05  PC-PRIME2            PIC S9(05) COMP-3 VALUE +58889.     01090099
           05  PC-SUB-CL-CDE        PIC X(03)  VALUE '000'.             01100099
           05  PC-APLSYS-CDE        PIC X(02)  VALUE 'IN'.              01110099
           05  PC-MDSELV-CDE        PIC X(03)  VALUE 'SCL'.             01120099
                                                                        01130099
       01  PE-PROGRAM-ERROR-MESSAGES.                                   01140099
           05  PE-MSG-07                       PIC X(30) VALUE          01150099
                'ERROR IN SELECT - TCKRSTCNTL '.                        01160099
           05  PE-MSG-08                       PIC X(30) VALUE          01170099
                'UPDATE WORK_STRG - TCKRSTINF '.                        01180099
           05  PE-MSG-09                       PIC X(30) VALUE          01190099
                'PGM ABEND DURING A COMMIT    '.                        01200099
           05  PE-MSG-10                       PIC X(30) VALUE          01210099
                'UPDATE OF TCKRSTCNTL FAILED  '.                        01220099
           05  PE-MSG-11                       PIC X(30) VALUE          01230099
                'ERROR IN SELECT - TCKRSTINF  '.                        01240099
           05  PE-MSG-12                       PIC X(30) VALUE          01250099
                'UNABLE TO OBTAIN TIMESTAMP   '.                        01260099
                                                                        01270099
       01  PV-PROGRAM-VARIABLES-AREA.                                   01280099
29908      05  PV-COUNT                 PIC S9(04) COMP VALUE ZEROS.    01290099
           05  PV-EDIT-SKU-NBR          PIC 9(08).                      01300099
           05  FILLER REDEFINES PV-EDIT-SKU-NBR.                        01310099
               10  PV-EDIT-SKU-NBR-DPT  PIC 9(03).                      01320099
               10  PV-EDIT-SKU-NBR-CLS  PIC 9(02).                      01330099
               10  PV-EDIT-REMAINDER    PIC 9(03).                      01340099
           05  FILLER REDEFINES PV-EDIT-SKU-NBR.                        01350099
               10  PV-EDIT-SKU-NBR-P1   PIC X(05).                      01360099
               10  PV-EDIT-SKU-NBR-P2   PIC X(03).                      01370099
                   88  PV-ZERO-SEQUENCE-SKU  VALUES '000' '999'.        01380099
           05  PV-MAJ-CL-NBR.                                           01390099
               10 PV-MAJ-CL-NBR-1      PIC X(01)  VALUE SPACES.         01400099
               10 PV-MAJ-CL-NBR-2      PIC X(01)  VALUE SPACES.         01410099
           05  PV-MAJ-CL-NBR-9 REDEFINES                                01420099
               PV-MAJ-CL-NBR           PIC 9(02).                       01430099
           05  PV-SUB-CL-NBR.                                           01440099
               10 PV-SUB-CL-NBR-1      PIC X(01)  VALUE SPACES.         01450099
               10 PV-SUB-CL-NBR-2-3    PIC X(02)    VALUE SPACES.       01460099
           05  PV-WORK-FIELD           PIC S9(17) COMP-3 VALUE ZERO.    01470099
           05  PV-WORK-FIELD2          PIC S9(17) COMP-3 VALUE ZERO.    01480099
           05  PV-SEED                 PIC S9(11) COMP-3 VALUE ZERO.    01490099
           05  PV-ADD-NUM              PIC S9(04) COMP VALUE ZERO.      01500099
           05  PV-RANDOM-NUMBER        PIC S9(11) COMP-3 VALUE +0.      01510099
           05  PV-TODAYS-DATE       PIC 9(06)  VALUE ZERO.              01520099
           05  FILLER REDEFINES PV-TODAYS-DATE.                         01530099
               10  PV-CD-YY         PIC XX.                             01540099
               10  PV-CD-MM         PIC XX.                             01550099
               10  PV-CD-DD         PIC XX.                             01560099
           05  PV-TODAYS-TIME       PIC 9(08)  VALUE ZERO.              01570099
           05  FILLER REDEFINES PV-TODAYS-TIME.                         01580099
               10  PV-HH            PIC 9(02).                          01590099
               10  PV-MIN           PIC 9(02).                          01600099
               10  PV-SEC           PIC 9(02).                          01610099
               10  PV-HUND-SEC      PIC 9(02).                          01620099
           05  PV-CURRENT-TIME.                                         01630099
               10  PV-CT-HH            PIC XX.                          01640099
               10  PV-CT-MM            PIC XX.                          01650099
               10  PV-CT-REMAINDER     PIC XXXX.                        01660099
           05  PV-INITIAL-SEED      PIC 9(08)    VALUE ZERO.            01670099
           05  FILLER REDEFINES PV-INITIAL-SEED.                        01680099
               10  PV-SEED-BYTE-1-2 PIC 9(02).                          01690099
               10  PV-SEED-BYTE-3-4 PIC 9(02).                          01700099
               10  PV-SEED-BYTE-5-6 PIC 9(02).                          01710099
               10  PV-SEED-BYTE-7-8 PIC 9(02).                          01720099
           05  PV-SKU-NBR           PIC 9(8).                           01730099
           05  PV-SKU-NBR-ALPH REDEFINES                                01740099
               PV-SKU-NBR           PIC X(8).                           01750099
           05  PV-CURRENT-TIMESTAMP        PIC  X(26)      VALUE SPACES.01850099
           05  PV-COMMIT-TIMESTAMP         PIC  X(26)      VALUE SPACES.01860099
           05  PV-PARAGRAPH-NAME           PIC  X(30)      VALUE SPACES.01870099
           05  PV-ABEND-MESSAGE            PIC  X(75)      VALUE SPACES.01880099
           05  PV-OPERATION-ATTEMPTED      PIC  X(30)      VALUE SPACES.01890099
           05  PV-STR-NBR-SAVE             PIC S9(04) COMP VALUE ZEROS. 01900099
           05  PV-DOC-NBR-SAVE.                                         01910099
               10  PV-DOC-DOC-FROM-LOC-NBR PIC S9(04) COMP VALUE ZEROS. 01920099
               10  PV-DOC-DOC-SEQ-NBR      PIC S9(09) COMP VALUE ZEROS. 01930099
           05  PV-ITEM-QTY                 PIC S9(04) COMP VALUE ZEROS. 01940099
           05  PV-SKU-NBR-SAVE             PIC S9(09) COMP VALUE ZEROS. 01950099
           05  PV-EXTD-AMOUNT       PIC S9(09)V99 COMP-3 VALUE ZEROS.   01960099
           05  PV-AREA-NBR          PIC 9(06) VALUE ZEROS.              01970099
           05  PV-RETRY-COUNT       PIC S9(04) COMP VALUE ZEROS.        01980099
           05  PV-OPER-ATTEMPTED    PIC X(25)  VALUE SPACES.            01990099
           05  PV-RECORDS-READ      PIC S9(15) COMP-3 VALUE ZEROS.      02000099
           05  PV-STORE-ISSUE-COUNT PIC S9(15) COMP-3 VALUE ZEROS.      02010099
           05  PV-NO-UNIT-COUNT     PIC S9(15) COMP-3 VALUE ZEROS.      02020099
           05  PV-NO-PRICE-COUNT    PIC S9(15) COMP-3 VALUE ZEROS.      02030099
           05  PV-NO-UPC-NBR-COUNT  PIC S9(15) COMP-3 VALUE ZEROS.      02040099
           05  PV-CLEARANCE-COUNT   PIC S9(15) COMP-3 VALUE ZEROS.      02050099
           05  PV-RED-COUNT         PIC S9(15) COMP-3 VALUE ZEROS.      02060099
           05  PV-GROUP-PRICE-COUNT PIC S9(15) COMP-3 VALUE ZEROS.      02070099
           05  PV-RECORDS-ACCEPTED  PIC S9(15) COMP-3 VALUE ZEROS.      02080099
           05  PV-UNT-RTL-AMT-HOLD  PIC S9(15)V99 COMP-3 VALUE ZEROS.   02090099
           05  PV-UPC-STAT-CHG-DTE  PIC X(10)  VALUE SPACES.            02100099
           05  PV-UNT-RTL-CHG-DTE   PIC X(10)  VALUE SPACES.            02110099
           05  PV-UNT-QTY-COUNT     PIC S9(15) COMP-3 VALUE ZEROS.      02120099
           05  PV-UNT-RTL-AMT-COUNT PIC S9(15)V99 COMP-3 VALUE ZEROS.   02130099
           05  PV-TFR-QTY-COUNT     PIC S9(15) COMP-3 VALUE ZEROS.      02140099
           05  PV-TFR-RTL-AMT-COUNT PIC S9(15)V99 COMP-3 VALUE ZEROS.   02150099
           05  PV-STR-QTY-COUNT     PIC S9(15) COMP-3 VALUE ZEROS.      02160099
           05  PV-STR-RTL-AMT-COUNT PIC S9(15)V99 COMP-3 VALUE ZEROS.   02170099
           05  PV-TOT-QTY-COUNT     PIC S9(15) COMP-3 VALUE ZEROS.      02180099
           05  PV-TOT-RTL-AMT-COUNT PIC S9(15)V99 COMP-3 VALUE ZEROS.   02190099
           05  PV-DISPLAY      PIC ZZZZZZZZZZZZZZZZZ9.99 VALUE ZEROS.   02200099
           05  PV-DISPLAY-2    PIC ZZZZZZZZZZZZZZ  VALUE ZEROS.         02210099
           05  PV-EDIT-DOC-NBR.                                         02220099
               10  PV-EDIT-DOC-FROM-LOC-NBR  PIC 9(05) VALUE ZEROS.     02230099
               10  FILLER REDEFINES PV-EDIT-DOC-FROM-LOC-NBR.           02240099
                   15  PV-EDIT-DOC-FR-LOC-P1 PIC 9(01).                 02250099
                   15  PV-EDIT-DOC-FR-LOC-P2 PIC 9(04).                 02260099
               10  PV-EDIT-DOC-SEQ-NBR       PIC 9(09) VALUE ZEROS.     02270099
               10  PV-EDIT-DOC-SEQ-NBR-RED REDEFINES                    02280099
                   PV-EDIT-DOC-SEQ-NBR.                                 02290099
                   15  PV-EDIT-DOC-1ST-3     PIC 9(03).                 02300099
                   15  PV-EDIT-DOC-LAST-6.                              02310099
                       20  PV-EDIT-DOC-PART1     PIC 9(01).             02320099
                       20  PV-EDIT-DOC-PART2     PIC 9(05).             02330099
           05  PV-PLND-INV-TMST            PIC  X(26) VALUE SPACES.     02340099
           05  PV-PLND-INV-TIMESTAMP.                                   02350099
               10  PV-PLND-INV-DTE         PIC  X(10)  VALUE SPACES.    02360099
               10  PV-DASH                 PIC  X(01)  VALUE '-'.       02370099
               10  PV-PLND-DTE-HOUR        PIC  X(02)  VALUE '23'.      02380099
               10  PV-SEPARATOR            PIC  X(01)  VALUE '.'.       02390099
               10  PV-PLND-DTE-MINUTE      PIC  X(02)  VALUE '59'.      02400099
               10  PV-SEPARATOR            PIC  X(01)  VALUE '.'.       02410099
               10  PV-PLND-DTE-SECOND      PIC  X(02)  VALUE '59'.      02420099
               10  PV-SEPARATOR            PIC  X(01)  VALUE '.'.       02430099
               10  PV-PLND-DTE-MSEC        PIC  X(06)  VALUE '999999'.  02440099
                                                                        02450099
       01  PS-SWITCHES-AREA.                                            02460099
           05  PS-END-OF-TRANSFER-DATA     PIC X           VALUE 'N'.   02470099
               88  END-OF-TRANSFER-DATA                    VALUE 'Y'.   02480099
           05  PS-PRICE-FOUND-STATUS       PIC X           VALUE 'N'.   02490099
               88  PS-PRICE-NOT-FOUND                      VALUE 'N'.   02500099
               88  PS-PRICE-FOUND                          VALUE 'Y'.   02510099
           05  PS-UPC-NBR-FOUND-STATUS     PIC X           VALUE 'N'.   02520099
               88  PS-UPC-NBR-NOT-FOUND                    VALUE 'N'.   02530099
               88  PS-UPC-NBR-FOUND                        VALUE 'Y'.   02540099
           05  PS-FIRST-COMMIT-SW          PIC X           VALUE 'N'.   02550099
               88  PS-FIRST-COMMIT                         VALUE 'Y'.   02560099
           05  PS-COMMIT-TAKEN-SW          PIC X           VALUE 'N'.   02570099
               88  PS-COMMIT-TAKEN                         VALUE 'Y'.   02580099
30272      05  PS-DKEY-NBR-FOUND-SW        PIC X           VALUE 'N'.   02590099
30272          88  PS-DKEY-NBR-FOUND                       VALUE 'Y'.   02600099
30272          88  PS-DKEY-NBR-NOT-FOUND                   VALUE 'N'.   02610099
W33304     05  PS-VALID-STORE-SWITCH       PIC X           VALUE 'N'.           
W33304         88  PS-VALID-STORE-YES                      VALUE 'Y'.           
W33304         88  PS-VALID-STORE-NO                       VALUE 'N'.           
                                                                        02620099
       01  ABEND-CODE                      PIC S9(04)      VALUE ZEROES 02630099
                               COMP SYNC.                               02640099
           88  ABEND-4004                                  VALUE +4004. 02650099
           88  ABEND-4013                                  VALUE +4013. 02660099
                                                                        02670099
      ******************************************************************03610099
      * COPYBOOK - FASHION SALES FS035-ADJUSTMENT-RECORD                03620099
      ******************************************************************03630099
           COPY FSRD035.                                                03640099
                                                                        03650099
      ******************************************************************03660099
      * COPYBOOK - INVENTORY SNAPSHOT TO ML FILE FORMAT                 03670099
      ******************************************************************03680099
           COPY TFRD054.                                                03690099
                                                                        03700099
W33304******************************************************************03660099
W33304* COPYBOOK - REPORT FILE LAYOUT                                   03670099
W33304******************************************************************03680099
W33304     COPY INRD031.                                                03690099
W33304                                                                  03700099
      ******************************************************************03710099
      * COPYBOOK -                                                      03720099
      *    DPWS004 CONTAINS THE FIELDS NECESSARY TO CALL THE SQLCA      03730099
      * MESSAGE MODULE 'DSNTIAR' AND DISPLAY THE FORMATTED RESULTS.     03740099
      ******************************************************************03750099
           COPY DPWS004.                                                03760099
                                                                        03770099
      ******************************************************************03780099
           EXEC SQL                                                     03790099
               INCLUDE SQLCA                                            03800099
           END-EXEC.                                                    03810099
                                                                        03820099
P28545******************************************************************03830099
P28545*    TUPC    - UPC FOUNDATION TABLE                               03840099
P28545******************************************************************03850099
P28545*    EXEC SQL                                                     03860099
P28545*        INCLUDE TUPC                                             03870099
P28545*    END-EXEC.                                                    03880099
P28545*                                                                 03890099
P28545******************************************************************03900099
P28545*    TUPCPLS - PRICE LISTING FOR STORE TABLE                      03910099
P28545******************************************************************03920099
P28545*    EXEC SQL                                                     03930099
P28545*        INCLUDE TUPCPLS                                          03940099
P28545*    END-EXEC.                                                    03950099
P28545*                                                                 03960099
P28545******************************************************************03970099
P28545*    TSKXREF - THE SKU CROSS REFERENCE TABLE                      03980099
P28545******************************************************************03990099
P28545*    EXEC SQL                                                     04000099
P28545*        INCLUDE TSKXREF                                          04010099
P28545*    END-EXEC.                                                    04020099
P28545*                                                                 04030099
      ******************************************************************04040099
      *    TADJDTL - INVENTORY ADJUSTMENT DETAIL TABLE.                 04050099
      ******************************************************************04060099
           EXEC SQL                                                     04070099
               INCLUDE TADJDTL                                          04080099
           END-EXEC.                                                    04090099
                                                                        04100099
29908 ******************************************************************04110099
 |    *    TADJADD - INVENTORY ADJUSTMENT ADD TABLE.                    04120099
 |    ******************************************************************04130099
 |         EXEC SQL                                                     04140099
 |             INCLUDE TADJADD                                          04150099
 |         END-EXEC.                                                    04160099
 |                                                                      04170099
 |    ******************************************************************04180099
 |    *    TSUMINV - INVENTORY SUMMARIZED INVENTORY DETAIL TABLE.       04190099
 |    ******************************************************************04200099
 |         EXEC SQL                                                     04210099
 |             INCLUDE TSUMINV                                          04220099
 |         END-EXEC.                                                    04230099
29908                                                                   04240099
P28545******************************************************************04250099
P28545*    TMITGPL - GROUP PRICE LISTING TABLE                          04260099
P28545******************************************************************04270099
P28545*    EXEC SQL                                                     04280099
P28545*        INCLUDE TMITGPL                                          04290099
P28545*    END-EXEC.                                                    04300099
P28545*                                                                 04310099
      ******************************************************************04320099
      *    TINVPAR - INVENTORY PARAMATERS TABLE                         04330099
      ******************************************************************04340099
           EXEC SQL                                                     04350099
               INCLUDE TINVPAR                                          04360099
           END-EXEC.                                                    04370099
                                                                        04380099
P28545******************************************************************04381099
P28545*    TINCNTL - INVENTORY CONTROL MASTER TABLE                     04382099
P28545******************************************************************04383099
P28545     EXEC SQL                                                     04384099
P28545         INCLUDE TINCNTL                                          04385099
P28545     END-EXEC.                                                    04386099
P28545                                                                  04387099
      ******************************************************************04390099
      *    TMDSEAR - DB2 MERCHANDISE AREA TABLE DCLGEN                  04400099
      ******************************************************************04410099
P28545*    EXEC SQL                                                     04420099
P28545*        INCLUDE TMDSEAR                                          04430099
P28545*    END-EXEC.                                                    04440099
P28545*                                                                 04450099
      ******************************************************************04460099
      *    TAPLAVL - DB2 APPLICATION AVAILABILITY TABLE DCLGEN          04470099
      ******************************************************************04480099
D28545*    EXEC SQL                                                     04490099
D28545*        INCLUDE TAPLAVL                                          04500099
D28545*    END-EXEC.                                                    04510099
D28545*                                                                 04520099
      ******************************************************************04530099
      *CHECKPOINT RESTART CONTROL AND INFORMATION TABLES *              04540099
      ******************************************************************04550099
           EXEC SQL                                                     04560099
               INCLUDE TCKRSTCN                                         04570099
           END-EXEC.                                                    04580099
                                                                        04590099
           EXEC SQL                                                     04600099
               INCLUDE TCKRSTIN                                         04610099
           END-EXEC.                                                    04620099
                                                                        04630099
P28545******************************************************************04631099
P28545* COPYBOOK - PRICING MODULE                                       04632099
P28545******************************************************************04633099
P28545     COPY INWS400.                                                04634099
P28545                                                                  04635099
      ******************************************************************04640099
      * CHECKPOINT RESTART VARIABLES                                   *04650099
      ******************************************************************04660099
       01  CR-CHECKPOINT-RESTART-AREA.                                  04670099
           05  CR-AREA-LEN                 PIC S9(04) VALUE +87 COMP.   04680099
           05  CR-CHECKPOINT-RESTART-VAR.                               04690099
               10  CR-PREV-DTL-KEY         PIC X(26)      VALUE SPACES. 04700099
               10  FILLER REDEFINES CR-PREV-DTL-KEY.                    04710099
                   15  CR-KEY.                                          04720099
                       20  CR-BATCH-NBR                PIC S9(04) COMP. 04730099
                       20  CR-TRANSFER-DOC-INFO.                        04740099
                           25  CR-ORIG-TO-LOC-NBR      PIC S9(04) COMP. 04750099
                           25  CR-DOC-NBR.                              04760099
                               30  CR-DOC-FROM-LOC-NBR PIC S9(04) COMP. 04770099
                               30  CR-DOC-SEQ-NBR      PIC S9(09) COMP. 04780099
                           25  CR-CREATE-DATE.                          04790099
                               30  CR-CREATE-DATE-YY   PIC 9(04).       04800099
                               30  CR-FILLER1          PIC X(01).       04810099
                               30  CR-CREATE-DATE-MM   PIC 9(02).       04820099
                               30  CR-FILLER2          PIC X(01).       04830099
                               30  CR-CREATE-DATE-DD   PIC 9(02).       04840099
                       20  CR-TRANSFER-ITEM-INFO.                       04850099
                           25  CR-LNE-NBR          PIC S9(04) COMP-4.   04860099
                           25  CR-SKU-NBR          PIC S9(09) COMP.     04870099
               10  FILLER                   PIC  X(01) VALUE SPACES.    04880099
               10  CR-UPDATE-COUNT          PIC  9(09) VALUE ZEROES.    04890099
               10  FILLER                   PIC  X(01) VALUE SPACES.    04900099
               10  CR-INSERT-COUNT          PIC  9(09) VALUE ZEROES.    04910099
               10  FILLER                   PIC  X(01) VALUE SPACES.    04920099
               10  CR-COMMIT-COUNT          PIC  9(09) VALUE ZEROES.    04930099
               10  FILLER                   PIC  X(01) VALUE SPACES.    04940099
               10  CR-INPUT-COUNT           PIC  9(09) VALUE ZEROES.    04950099
               10  FILLER                   PIC  X(01) VALUE SPACES.    04960099
               10  CR-ZERO-REC-DROPPED      PIC  9(09) VALUE ZEROES.    04970099
               10  FILLER                   PIC  X(01) VALUE SPACES.    04980099
               10  CR-DUPLICATE-REC         PIC  9(09) VALUE ZEROES.    04990099
               10  FILLER                   PIC  X(01) VALUE SPACES.    05000099
                                                                        05010099
      ******************************************************************05020099
      *FLOW:    THE MODULE SEQUENTIALLY READS THE DAILY FAST TRANSFER   05030099
      *      ADJUSTMENT FILE(S) FOR ASSUMPTIVE RECEIVE TRANSFERS.       05040099
      *                                                                 05050099
      *      CHECKPOINT RESTART LOGIC IS PRESENT.                       05060099
      *                                                                 05070099
      *         BREAKS OCCUR AT THE LOCATION, DOCUMENT, AND SKU LEVELS. 05080099
      *      ACCUMULATE TOTALS AND INTERNAL CONTROLS AT THESE LEVELS.   05090099
      *      WRITE REPORT DETAIL, SUBTOTALS, AND TOTALS ACCORDINGLY.    05100099
      *                                                                 05110099
      *         DEVELOP PRICE BASED ON THE SKU USING TUPC AND TUPCPLS   05120099
      *      FIRST AT THE CORPROATE LEVEL, THEN AT STORE LEVEL BASED ON 05130099
      *      THE SKU STATUS. SPECIAL CONSIDERATIONS FOR ITEMS IN A RED  05140099
      *      STATUS HAVE BEEN MADE TO USE THE LAST YELLOW PRICE.        05150099
      *                                                                 05160099
      *         FORMAT AN ADJUSTMENT DTL TABLE RECORD AND INSERT INTO   05170099
      *      THE TABLE TADJDTL.                                         05180099
      *                                                                 05190099
      *         IF THE STORE HAS UNIT BOOKED, WE MAY NEED TO PASS AN    05200099
      *      ADJUSTMENT TO FASHION SALES. (IF APPLICABLE)               05210099
      *                                                                 05220099
      *      OUTPUT:                                                    05230099
      *         TADJDTL - INSERT ASSUMPTY RCV FAST TRANSFER ADJUSTMENTS 05240099
      *         OUT01 - FAST TRANSFER TRANSACTION(S) ERRORED            05250099
      *                 1.  NO UNIT COUNTS                              05260099
      *                 2.  PRICE CANNOT BE DETERMINED.                 05270099
      *                 3.  THE ITEM IS NOT FOUND IN VSM                05280099
      *         OUT02 - FASHION SALES AFTER UNIT BOOKING ADJUSTMENTS    05290099
      *                 1.  ACTL_UNIT_BK_DTE NOT EQUAL '9999-09-09'     05300099
      *                 2.  ADJUSTING ENTRY TO FASHION BASED ON ITEM NBR05310099
W33304*         OUT03 - TRANSER INPUT ERROR FILE                        05290099
W33304*         OUT04 - ADJUSTMENT TO PHYSICAL INVENTORY FROM TRANSFER  05320099
      *                                                                 05330099
      *      TABLES USED:                                               05340099
      *         TADJDTL    - INVENTORY ADJUSTMENT DETAIL                05350099
P28545*****     TUPC       - VSM UPC TABLE (PRICING)                    05360099
P28545*****     TUPCPLS    - VSM UPCPLS TABLE (PRICING)                 05370099
P28545*****     TMITGPL    - GROUP PRICING TABLE                        05380099
P28545*****     TSKXREF    - CROSS REFERENCE TABLE.                     05390099
      *         TINVPAR    - INVENTORY PARM TABLE.                      05400099
P28545*         TINCNTL    - INVENTORY CONTROL TABLE.                   05401099
      *         TMDSEAR    - MERCHANDISE AREA TABLE DCLGEN              05410099
      *         TAPLAVL    - APPLICATION AVAILABILITY TABLE DCLGEN      05420099
      *         TCKRSTINF  - CHECKPOINT/RESTART INFORMATION TABLE       05430099
      *         TCKRSTCNTL - CHECKPOINT/RESTART CONTROL TABLE           05440099
      *                                                                 05450099
      ******************************************************************05460099
       PROCEDURE DIVISION.                                              05470099
      ******************************************************************05480099
       0000-MAINLINE-DRIVER-SECTION.                                    05490099
                                                                        05500099
           PERFORM 1000-INITIALIZATION.                                 05510099
                                                                        05520099
           PERFORM 2000-PROCESS-TRANSFER-STORE                          05530099
               UNTIL END-OF-TRANSFER-DATA.                              05540099
                                                                        05550099
           PERFORM 9000-END-OF-JOB-TASKS.                               05560099
                                                                        05570099
       9999-EXIT-PROGRAM.                                               05580099
           STOP RUN.                                                    05590099
                                                                        05600099
      /*****************************************************************05610099
      * 1000-INITIALIZATION.                                            05620099
      ******************************************************************05630099
       1000-INITIALIZATION.                                             05640099
                                                                        05650099
           OPEN  INPUT TRANSFER-DATA-FILE                               05660099
                OUTPUT TRANSFER-DATA-ERROR-FILE                         05670099
                OUTPUT FASHION-ADJUSTMENTS                              05680099
W33304          OUTPUT TRANSFER-INPUT-ERROR-FILE                                
                OUTPUT TRANSFER-REPORT.                                 05690099
                                                                        05700099
           ACCEPT PV-TODAYS-DATE    FROM DATE.                          05710099
           ACCEPT PV-CURRENT-TIME   FROM TIME.                          05720099
                                                                        05730099
           MOVE ZEROS          TO PV-RECORDS-READ                       05830099
                                  PV-STR-NBR-SAVE                       05840099
                                  PV-STORE-ISSUE-COUNT                  05850099
                                  PV-NO-UNIT-COUNT                      05860099
                                  PV-NO-PRICE-COUNT                     05870099
                                  PV-NO-UPC-NBR-COUNT                   05880099
                                  PV-CLEARANCE-COUNT                    05890099
                                  PV-GROUP-PRICE-COUNT                  05900099
                                  PV-RECORDS-ACCEPTED.                  05910099
                                                                        05920099
      *** TEST FOR A RESTART OF THIS PROGRAM....                        05930099
           PERFORM 7650-INIT-CHECKPOINT-SELECT.                         05940099
           IF TCKRSTCNTL-CKPT-STAT-CODE = '9'                           05950099
                PERFORM 7700-SELECT-RESTART-INFO                        05960099
                MOVE TCKRSTINF-WORK-STRG-DESC-TEXT                      05970099
                                    TO CR-CHECKPOINT-RESTART-VAR        05980099
                DISPLAY ' '                                             05990099
                DISPLAY '--------------------------------------------'  06000099
                DISPLAY 'RESTART-LAST INKUP305 FILE COMMIT: ',          06010099
                         'CR-BATCH-NBR       : ' CR-BATCH-NBR           06020099
                         ' CR-ORIG-TO-LOC-NBR : ' CR-ORIG-TO-LOC-NBR    06030099
                         ' CR-DOC-FROM-LOC-NBR: ' CR-DOC-FROM-LOC-NBR   06040099
                         ' CR-DOC-SEQ-NBR     : ' CR-DOC-SEQ-NBR        06050099
                         ' CR-CREATE-DATE     : ' CR-CREATE-DATE        06060099
                         ' CR-LNE-NBR         : ' CR-LNE-NBR            06070099
                         ' CR-SKU-NBR         : ' CR-SKU-NBR            06080099
                DISPLAY '--------------------------------------------'  06090099
                DISPLAY ' '                                             06100099
                MOVE CR-INPUT-COUNT            TO PA-EXTRACT-RECS-READ  06110099
                MOVE CR-UPDATE-COUNT           TO PA-UPDATE-COUNT       06120099
                MOVE CR-INSERT-COUNT           TO PA-INSERT-COUNT       06130099
                MOVE CR-COMMIT-COUNT           TO PA-COMMIT-COUNT       06140099
                MOVE CR-ZERO-REC-DROPPED       TO PA-ZERO-REC-DROPPED   06150099
                MOVE CR-DUPLICATE-REC          TO PA-DUPLICATE-REC      06160099
           ELSE                                                         06170099
               SET PS-FIRST-COMMIT TO TRUE                              06180099
               INITIALIZE CR-CHECKPOINT-RESTART-VAR                     06190099
               DISPLAY 'COMMITS WILL BE TAKEN EVERY ',                  06200099
                                 TCKRSTCNTL-CKPT-FRQNCY-QTY, ' SECONDS.'06210099
               PERFORM 7600-GET-COMMIT-TIMESTAMP                        06220099
           END-IF.                                                      06230099
                                                                        06240099
      *** READ THE RECALC EXTRACT FILE...                               06250099
           INITIALIZE PA-PROGRAM-ACCUMULATORS.                          06260099
                                                                        06270099
           IF TCKRSTCNTL-CKPT-STAT-CODE = '9'                           06280099
             PERFORM 8100-READ-TRANSFER-DATA                            06290099
               UNTIL (TFRD054-BATCH-NBR        = CR-BATCH-NBR           06300099
                 AND  TFRD054-ORIG-TO-LOC-NBR  = CR-ORIG-TO-LOC-NBR     06310099
                 AND  TFRD054-DOC-FROM-LOC-NBR = CR-DOC-FROM-LOC-NBR    06320099
                 AND  TFRD054-DOC-SEQ-NBR      = CR-DOC-SEQ-NBR         06330099
                 AND  TFRD054-CREATE-DATE      = CR-CREATE-DATE         06340099
                 AND  TFRD054-LNE-NBR          = CR-LNE-NBR             06350099
                 AND  TFRD054-SKU-NBR          = CR-SKU-NBR)            06360099
                  OR (END-OF-TRANSFER-DATA)                             06370099
           END-IF.                                                      06380099
                                                                        06390099
      *** END OF FILE PROCESSING...                                     06400099
           IF END-OF-TRANSFER-DATA                                      06410099
             IF TCKRSTCNTL-CKPT-STAT-CODE = '9'                         06420099
               DISPLAY 'NO RECORDS TO PROCESS AFTER RESTART'            06430099
             ELSE                                                       06440099
               IF TCKRSTCNTL-CKPT-STAT-CODE = '0'                       06450099
                 DISPLAY 'NO RECORDS TO PROCESS,            '           06460099
                 DISPLAY 'CHECK IF INPUT FILE IS EMPTY      '           06470099
               END-IF                                                   06480099
             END-IF                                                     06490099
           ELSE                                                         06500099
      *** GET THE NEXT RECORD...                                        06510099
      * FOR RESTARTING, THIS WILL CONTINUE AFTER THE LAST COMMITED REC  06520099
      * THIS IS IMPORTANT WHEN RUNNING UNDER ADJUSTMENT MODE, SEE CNTL  06530099
             PERFORM 8100-READ-TRANSFER-DATA                            06540099
             IF (NOT END-OF-TRANSFER-DATA)                              06550099
               INITIALIZE INCNTL-INV-NM-TEXT                                    
               PERFORM 8300-READ-TINVPAR                                06560099
               MOVE TFRD054-ORIG-TO-LOC-NBR TO PV-STR-NBR-SAVE          06570099
               MOVE TFRD054-DOC-NBR      TO PV-DOC-NBR-SAVE             06580099
               MOVE TFRD054-SKU-NBR      TO PV-SKU-NBR-SAVE             06590099
             END-IF                                                     06600099
           END-IF.                                                      06610099
                                                                        06620099
                                                                        06640099
      /*****************************************************************06650099
      * 2000-PROCESS-TRANSFER-STORE.                                    06660099
      ******************************************************************06670099
       2000-PROCESS-TRANSFER-STORE.                                     06680099
                                                                        06690099
           ADD 1               TO PV-RECORDS-READ.                      06700099
           ADD 1               TO PA-EXTRACT-RECS-READ.                 06710099
                                                                        06720099
      *** BREAK LOGIC PERFORMED AT LOCATION, DOCUMENT, AND SKU LEVEL....06730099
           IF TFRD054-ORIG-TO-LOC-NBR EQUAL PV-STR-NBR-SAVE             06740099
             IF TFRD054-DOC-NBR EQUAL PV-DOC-NBR-SAVE                   06750099
               IF TFRD054-SKU-NBR EQUAL PV-SKU-NBR-SAVE                 06760099
                 NEXT SENTENCE                                          06770099
               ELSE                                                     06780099
      *** SKU BREAK....                                                 06790099
                 MOVE TFRD054-SKU-NBR   TO PV-SKU-NBR-SAVE              06800099
                 MOVE ZEROS             TO PV-UNT-QTY-COUNT             06810099
                 MOVE ZEROS             TO PV-UNT-RTL-AMT-COUNT         06820099
             ELSE                                                       06830099
      *** TRANSFER DOCUMENT BREAK.....                                  06840099
               MOVE TFRD054-DOC-NBR     TO PV-DOC-NBR-SAVE              06860099
               MOVE TFRD054-SKU-NBR     TO PV-SKU-NBR-SAVE              06870099
               MOVE ZEROS               TO PV-UNT-QTY-COUNT             06880099
               MOVE ZEROS               TO PV-UNT-RTL-AMT-COUNT         06890099
               MOVE ZEROS               TO PV-TFR-QTY-COUNT             06900099
               MOVE ZEROS               TO PV-TFR-RTL-AMT-COUNT         06910099
           ELSE                                                         06920099
      *** LOCATION BREAK....                                            06930099
             INITIALIZE INCNTL-INV-NM-TEXT                                      
             PERFORM 8300-READ-TINVPAR                                  06960099
             MOVE TFRD054-ORIG-TO-LOC-NBR TO PV-STR-NBR-SAVE            06970099
             MOVE TFRD054-DOC-NBR     TO PV-DOC-NBR-SAVE                06980099
             MOVE TFRD054-SKU-NBR     TO PV-SKU-NBR-SAVE                06990099
                                                                        07000099
             MOVE ZEROS               TO PV-UNT-QTY-COUNT               07060099
             MOVE ZEROS               TO PV-UNT-RTL-AMT-COUNT           07070099
             MOVE ZEROS               TO PV-TFR-QTY-COUNT               07080099
             MOVE ZEROS               TO PV-TFR-RTL-AMT-COUNT           07090099
             MOVE ZEROS               TO PV-STR-QTY-COUNT               07100099
             MOVE ZEROS               TO PV-STR-RTL-AMT-COUNT           07110099
           END-IF.                                                      07120099
                                                                        07130099
W33304     IF  PS-VALID-STORE-YES                                               
W33304         PERFORM 3000-GATHER-VSM-INFORMATION                              
W33304         PERFORM 7800-COMMIT-PROCESSING                                   
W33304     END-IF.                                                              
                                                                        07170099
           PERFORM 8100-READ-TRANSFER-DATA.                             07180099
                                                                        07190099
      /*****************************************************************07200099
      * 3000-GATHER-VSM-INFORMATION.                                    07210099
      *     EDIT AND GATHER UPC INFORMATION FOR PRICING & UPDATES TO    07220099
      * TADJDTL (BASED ON THE TRANSFER SKU NBR)                         07230099
      ******************************************************************07240099
       3000-GATHER-VSM-INFORMATION.                                     07250099
                                                                        07260099
D28545     INITIALIZE IN400-PV-INPUT-AREA.                              07270099
D28545                                                                  07280099
D28545     SET IN400-PV-SKU-LOOKUP  TO TRUE.                            07300099
D28545                                                                  07311099
D28545     MOVE TFRD054-ORIG-TO-LOC-NBR TO IN400-CONVERT-LOC.           07312099
D28545     MOVE IN400-CONVERT-LOC   TO IN400-PV-LOC-IN.                 07313099
D28545                                                                  07314099
D28545     MOVE PV-PLND-INV-DTE     TO IN400-PV-EFF-DTE-IN.             07315099
D28545                                                                  07315199
D28545     MOVE TFRD054-SKU-NBR     TO PV-EDIT-SKU-NBR.                 07315299
D28545     MOVE PV-EDIT-SKU-NBR     TO IN400-PV-SKU-IN.                 07316099
D28545                                                                  07317099
D28545     PERFORM IN400-LOOKUP-RETAIL.                                 07318099
D28545                                                                  07318199
D28545*** A.  INVALID KEY CONDITION..                                   07318299
D28545     IF IN400-PV-INVALID-KEY-INPUT                                07318399
D28545         DISPLAY 'INVALID - ', PV-EDIT-SKU-NBR,                   07318499
D28545                 ' PRC SQL - ', IN400-PV-PRC-SQLCDE,              07318599
D28545                 ' ATT SQL - ', IN400-PV-ATT-SQLCDE,              07318699
D28545                 '  ', IN400-PV-RETURN-RSN                        07318799
D28545         DISPLAY IN400-PV-PARAGRAPH                               07318899
D28545         PERFORM 4100-BUILD-ERROR-TRANSFER                        07318999
D28545         ADD 1                        TO PV-NO-UNIT-COUNT         07319099
D28545     ELSE                                                         07319199
D28545*** B.  ZERO SEQUENCE SKU EDITS.                                  07319299
D28545     IF IN400-PS-DUMMY-SKU                                        07320099
D28545         IF TFRD054-ITEM-QTY GREATER ZERO                         07340099
D28545             MOVE ZEROS               TO IN400-PRC-UPC-OUT        07351099
D28545             MOVE TFRD054-ITEM-PRICE  TO PV-UNT-RTL-AMT-HOLD      07360099
D28545*            MOVE PV-EDIT-SKU-NBR-DPT TO IN400-ATT-DEPT-OUT       07370099
D28545*            MOVE PV-EDIT-SKU-NBR-CLS TO IN400-ATT-SCL-OUT        07380099
D28545             PERFORM 4000-MAKE-ADJUSTMENT                         07390099
D28545             PERFORM 4200-BUILD-FASH-SALES-ADJUST                 07400099
D28545         ELSE                                                     07410099
D28545             PERFORM 4100-BUILD-ERROR-TRANSFER                    07420099
D28545             ADD 1        TO PV-NO-UNIT-COUNT                     07430099
D28545         END-IF                                                   07440099
D28545     ELSE                                                         07450099
D28545*** C.  REGULAR SKU EDITS.                                        07510099
D28545     IF IN400-PS-RTL-FOUND                                        07529499
D28545         MOVE IN400-PRC-UNIT-RTL-OUT     TO PV-UNT-RTL-AMT-HOLD   07529599
D28545         MOVE IN400-PRC-UPC-CHG-DTE-OUT  TO PV-UNT-RTL-CHG-DTE    07529699
D28545         MOVE IN400-PRC-STAT-CHG-DTE-OUT TO PV-UPC-STAT-CHG-DTE   07529799
D28545         SET PS-PRICE-FOUND  TO TRUE                              07540099
P28545                                                                  07541099
P28545***  CLEARANCE...                                                 07550099
P28545         IF IN400-PRC-STATUS-OUT = '25' OR                        07560099
P28545            IN400-PRC-STATUS-OUT = '30'                           07570099
P28545             ADD 1                   TO PV-CLEARANCE-COUNT        07580099
P28545         END-IF                                                   07640099
P28545                                                                  07650099
P28545***  RED TICKET CLEARANCE (RTL DTE GREATER CHG DTE)               07660099
P28545***    USE THE TRANSFER ITEM PRICE                                07670099
P28545         IF IN400-PRC-STATUS-OUT = '30'                           07680099
P28545             IF PV-UNT-RTL-CHG-DTE GREATER PV-UPC-STAT-CHG-DTE    07690099
P28545               ADD 1                   TO PV-RED-COUNT            07700099
P28545               MOVE TFRD054-ITEM-PRICE TO PV-UNT-RTL-AMT-HOLD     07710099
P28545             END-IF                                               07750099
P28545         END-IF                                                   07760099
P28545                                                                  07770099
D28545***  BUILD THE ADJUSTMENT ENTRY.....                              07820099
D28545         IF TFRD054-ITEM-QTY NOT EQUAL ZEROS                      07840099
D28545             PERFORM 4000-MAKE-ADJUSTMENT                         07850099
D28545             PERFORM 4200-BUILD-FASH-SALES-ADJUST                 07860099
D28545         ELSE                                                     07870099
D28545             PERFORM 4100-BUILD-ERROR-TRANSFER                    07880099
D28545             ADD 1        TO PV-NO-UNIT-COUNT                     07890099
D28545         END-IF                                                   07900099
D28545     ELSE                                                         07910099
D28545         PERFORM 4100-BUILD-ERROR-TRANSFER                        07920099
D28545         ADD 1            TO PV-NO-PRICE-COUNT                    07930099
D28545     END-IF.                                                      07940099
D28545                                                                  08000099
P28545*** A.  ZERO SEQUENCE SKU EDITS.                                  08001099
P28545*    MOVE TFRD054-SKU-NBR     TO PV-EDIT-SKU-NBR.                 08002099
P28545*                                                                 08003099
P28545*    IF PV-ZERO-SEQUENCE-SKU                                      08004099
P28545*      PERFORM 8900-GET-MBS-STRUCTURE                             08005099
P28545*                                                                 08006099
P28545*      IF PS-PRICE-FOUND                                          08007099
P28545*          IF TFRD054-ITEM-QTY GREATER ZERO                       08008099
P28545*            MOVE ZEROS               TO UPC-UPC-NBR              08009099
P28545*            MOVE TFRD054-ITEM-PRICE  TO PV-UNT-RTL-AMT-HOLD      08009199
P28545*            MOVE PV-EDIT-SKU-NBR-DPT TO SKXREF-DEPT              08009299
P28545*            MOVE PV-EDIT-SKU-NBR-CLS TO SKXREF-SUBCLASS          08009399
P28545*            PERFORM 4000-MAKE-ADJUSTMENT                         08009499
P28545*            PERFORM 4200-BUILD-FASH-SALES-ADJUST                 08009599
P28545*          ELSE                                                   08009699
P28545*            PERFORM 4100-BUILD-ERROR-TRANSFER                    08009799
P28545*            ADD 1        TO PV-NO-UNIT-COUNT                     08009899
P28545*          END-IF                                                 08009999
P28545*      ELSE                                                       08010099
P28545*        PERFORM 4100-BUILD-ERROR-TRANSFER                        08010199
P28545*        ADD 1            TO PV-NO-PRICE-COUNT                    08010299
P28545*      END-IF                                                     08010399
P28545*                                                                 08010499
P28545*    ELSE                                                         08010599
P28545*** B.  REGULAR SKU EDITS.                                        08010699
P28545***  GET THE CORPORATE PRICE AND STATUS....                       08010799
P28545*      PERFORM 8000-GET-INTR-UPC-ID                               08010899
P28545*                                                                 08010999
P28545*      PERFORM 8400-GET-UPC-NBR                                   08011099
P28545*      IF PS-UPC-NBR-FOUND                                        08011199
P28545*          MOVE ZEROES                 TO UPCPLS-STR-NBR          08011299
P28545*          PERFORM 8500-GET-PRICE                                 08011399
P28545***  CLEARANCE...                                                 08011499
P28545*          IF UPCPLS-UPC-STAT-CDE = '25' OR                       08011599
P28545*             UPCPLS-UPC-STAT-CDE = '30'                          08011699
P28545*              ADD 1                   TO PV-CLEARANCE-COUNT      08011799
P28545*              MOVE TFRD054-ORIG-TO-LOC-NBR TO UPCPLS-STR-NBR     08011899
P28545*              PERFORM 8500-GET-PRICE                             08011999
P28545*              IF PS-PRICE-NOT-FOUND                              08012099
P28545*                  SET PS-PRICE-FOUND  TO TRUE                    08012199
P28545*              END-IF                                             08012299
P28545*          END-IF                                                 08012399
P28545*                                                                 08012499
P28545***  RED TICKET CLEARANCE (RTL DTE GREATER CHG DTE)               08012599
P28545***    USE THE TRANSFER ITEM PRICE                                08012699
P28545*          IF UPCPLS-UPC-STAT-CDE = '30'                          08012799
P28545*            IF PV-UNT-RTL-CHG-DTE GREATER PV-UPC-STAT-CHG-DTE    08012899
P28545*              ADD 1                   TO PV-RED-COUNT            08012999
P28545*              MOVE TFRD054-ITEM-PRICE TO PV-UNT-RTL-AMT-HOLD     08013099
P28545*              IF PS-PRICE-NOT-FOUND                              08013199
P28545*                  SET PS-PRICE-FOUND  TO TRUE                    08013299
P28545*              END-IF                                             08013399
P28545*            END-IF                                               08013499
P28545*          END-IF                                                 08013599
P28545*                                                                 08013699
P28545***  BUILD THE SHEET TABLE ENTRY.....                             08013799
P28545*          IF PS-PRICE-FOUND                                      08013899
P28545*              IF TFRD054-ITEM-QTY NOT EQUAL ZEROS                08013999
P28545*                  PERFORM 4000-MAKE-ADJUSTMENT                   08014099
P28545*                  PERFORM 4200-BUILD-FASH-SALES-ADJUST           08014199
P28545*              ELSE                                               08014299
P28545*                  PERFORM 4100-BUILD-ERROR-TRANSFER              08014399
P28545*                  ADD 1        TO PV-NO-UNIT-COUNT               08014499
P28545*              END-IF                                             08014599
P28545*          ELSE                                                   08014699
P28545*              PERFORM 4100-BUILD-ERROR-TRANSFER                  08014799
P28545*              ADD 1            TO PV-NO-PRICE-COUNT              08014899
P28545*          END-IF                                                 08014999
P28545*      ELSE                                                       08015099
P28545*          PERFORM 4100-BUILD-ERROR-TRANSFER                      08015199
P28545*          ADD 1                TO PV-NO-UPC-NBR-COUNT            08015299
P28545*      END-IF                                                     08015399
P28545*    END-IF.                                                      08015499
P28545*                                                                 08015599
29908 ******************************************************************08016099
 |    * 4000-MAKE-ADJUSTMENT.                                           08020099
 |    ******************************************************************08030099
 |     4000-MAKE-ADJUSTMENT.                                            08040099
 |                                                                      08050099
 |         MOVE ZEROS                   TO PV-COUNT.                    08060099
 |                                                                      08070099
 |         MOVE TFRD054-ORIG-TO-LOC-NBR TO SUMINV-LOC-NBR.              08080099
 |         MOVE TFRD054-SKU-NBR         TO SUMINV-SKU-NBR.              08090099
 |                                                                      08100099
 |         MOVE TFRD054-ORIG-TO-LOC-NBR TO ADJADD-LOC-NBR.              08110099
 |         MOVE TFRD054-SKU-NBR         TO ADJADD-SKU-NBR.              08120099
29908                                                                   08130099
30272      MOVE TFRD054-DOC-SEQ-NBR TO PV-EDIT-DOC-SEQ-NBR.             08140099
30272      MOVE 7                   TO PV-EDIT-DOC-PART1.               08150099
30272      MOVE PV-EDIT-DOC-LAST-6  TO PV-AREA-NBR.                     08160099
30272      MOVE PV-AREA-NBR         TO SUMINV-AREA-NBR.                 08170099
30272      MOVE PV-AREA-NBR         TO ADJADD-AREA-NBR.                 08180099
30272                                                                   08190099
29908      PERFORM                                                      08200099
 |             WITH TEST AFTER                                          08210099
 |             VARYING PV-RETRY-COUNT FROM 1 BY 1                       08220099
 |             UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  08230099
 |                 OR (SQLCODE = 0)                                     08240099
 |                 OR (SQLCODE = +100)                                  08250099
 |                                                                      08260099
 |             EXEC SQL                                                 08270099
 |                 SELECT 1                                             08280099
 |                 INTO :PV-COUNT                                       08290099
 |                 FROM TSUMINV                                         08300099
 |                 WHERE LOC_NBR = :SUMINV-LOC-NBR                      08310099
29908                AND SKU_NBR = :SUMINV-SKU-NBR                      08320099
30272                AND AREA_NBR = :SUMINV-AREA-NBR                    08330099
29908              UNION                                                08340099
 |                 SELECT 1                                             08350099
 |                 INTO :PV-COUNT                                       08360099
 |                 FROM TADJADD                                         08370099
 |                 WHERE LOC_NBR = :ADJADD-LOC-NBR                      08380099
29908                AND SKU_NBR = :ADJADD-SKU-NBR                      08390099
30272                AND AREA_NBR = :ADJADD-AREA-NBR                    08400099
29908              WITH UR                                              08410099
 |             END-EXEC                                                 08420099
 |                                                                      08430099
 |             EVALUATE TRUE                                            08440099
 |                 WHEN SQLCODE = 0                                     08450099
 |                   IF PV-COUNT IS GREATER THAN ZEROS                  08460099
 |                     PERFORM 6000-BUILD-ADJUST-TADJDTL                08470099
 |                   ELSE                                               08480099
 |                     PERFORM 6100-BUILD-ADJUST-TADJADD                08490099
 |                   END-IF                                             08500099
 |                 WHEN SQLCODE = -904                                  08510099
 |                 WHEN SQLCODE = -911                                  08520099
 |                     CONTINUE                                         08530099
 |                 WHEN SQLCODE = +100                                  08540099
 |                     PERFORM 6100-BUILD-ADJUST-TADJADD                08550099
 |                 WHEN OTHER                                           08560099
 |                     DISPLAY '***PARAGRAPH - 4000-MAKE-ADJUSTMENT ***'08570099
 |                     DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR 08580099
 |                     DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR    08590099
 |                     ' ' TFRD054-DOC-SEQ-NBR                          08600099
 |                     DISPLAY ' SKU    :     ' TFRD054-SKU-NBR         08610099
 |                     DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                08620099
 |                             ' STORE:  ' UPCPLS-STR-NBR               08630099
 |                             ' GROUP PRICE ID: ' UPCPLS-MEITGP-NBR    08640099
 |                     PERFORM 9900-SQL-ERROR                           08650099
 |             END-EVALUATE                                             08660099
 |         END-PERFORM.                                                 08670099
 |                                                                      08680099
 |         IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          08690099
 |             DISPLAY '*** MAX RETRIES - 4000-MAKE-ADJUSTMENT ***'     08700099
 |             DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR         08710099
 |             DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR            08720099
 |             ' ' TFRD054-DOC-SEQ-NBR                                  08730099
 |             DISPLAY ' SKU    :     ' TFRD054-SKU-NBR                 08740099
 |             DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                        08750099
 |                     ' STORE:  ' UPCPLS-STR-NBR                       08760099
 |                     ' GROUP PRICE ID: ' UPCPLS-MEITGP-NBR            08770099
 |             PERFORM 9900-SQL-ERROR                                   08780099
 |         END-IF.                                                      08790099
29908                                                                   08800099
      ******************************************************************08810099
      * 4100-BUILD-ERROR-TRANSFER.                                      08820099
      ******************************************************************08830099
       4100-BUILD-ERROR-TRANSFER.                                       08840099
                                                                        08850099
           WRITE TFR-DATA-ERROR-RECORD FROM TRANSFER-DATA-RECORD.       08860099
                                                                        08870099
      ******************************************************************08880099
      * 4200-BUILD-FASH-SALES-ADJUST.                                   08890099
      ******************************************************************08900099
       4200-BUILD-FASH-SALES-ADJUST.                                    08910099
                                                                        08920099
           IF INVPAR-ACTL-UNIT-BK-DTE NOT EQUAL '9999-09-09'            08930099
               MOVE SPACES               TO FS035-ADJUSTMENT-RECORD     08940099
                                                                        08950099
               MOVE TFRD054-SKU-NBR      TO PV-SKU-NBR                  08960099
               IF PV-SKU-NBR-ALPH (6:3) IS EQUAL TO '000' OR '999'      08970099
                   MOVE ZEROES           TO FS035-ITM-NBR               08980099
               ELSE                                                     08990099
P28545             MOVE IN400-ATT-ITM-NBR-OUT TO FS035-ITM-NBR          09000099
               END-IF                                                   09010099
                                                                        09020099
               MOVE PC-PROGRAM-NAME      TO FS035-ADJ-SRC-PGM-NM        09030099
               MOVE TFRD054-ORIG-TO-LOC-NBR TO FS035-LOC-NBR            09040099
               MOVE '123'                TO FS035-ADJ-TYP               09050099
                                                                        09060099
               IF TFRD054-ORIG-TO-LOC-NBR EQUAL TFRD054-TO-LOC-NBR      09070099
                   MOVE '+'              TO FS035-ACTN-CDE              09080099
               ELSE                                                     09090099
               IF TFRD054-ORIG-TO-LOC-NBR EQUAL TFRD054-FROM-LOC-NBR    09100099
                   MOVE '-'              TO FS035-ACTN-CDE              09110099
               ELSE                                                     09120099
                   DISPLAY '*** ERROR - 4200-BUILD-FASH-SALES-AD ***'   09130099
                   DISPLAY '** ORIGINAL LOC DOESNT MATCH TO/FR LOC *'   09140099
                   DISPLAY ' STORE  :   ' TFRD054-ORIG-TO-LOC-NBR       09150099
                   DISPLAY ' TO/FROM:   ' TFRD054-TO-LOC-NBR            09160099
                   ' ' TFRD054-FROM-LOC-NBR                             09170099
                   DISPLAY ' SKU    :     ' TFRD054-SKU-NBR             09180099
                   DISPLAY ' INTR-UPC-ID: ' IN400-ATT-UPCID-OUT         09190099
                   PERFORM 9900-SQL-ERROR                               09200099
               END-IF                                                   09210099
                                                                        09220099
               MOVE TFRD054-ITEM-QTY     TO FS035-ADJ-QTY               09230099
               MOVE 'INOL'               TO FS035-BTCH-NBR              09240099
               MOVE 'Y'                  TO FS035-UNT-BKG-IND           09250099
                                                                        09260099
               WRITE FASHION-ADJUST-RECORD                              09270099
                                         FROM FS035-ADJUSTMENT-RECORD   09280099
                                                                        09290099
               ADD 1                     TO PA-FS-WRITE-COUNT           09300099
                                                                        09310099
           END-IF.                                                      09320099
                                                                        09330099
W33304******************************************************************        
W33304* 4300-WRITE ERROR INPUT TO ERROR FILE                                    
W33304******************************************************************        
W33304 4300-WRITE-ERROR-RECORD.                                                 
W33304                                                                          
W33304     WRITE TFR-INPUT-ERROR-RECD  FROM TRANSFER-DATA-RECORD.               
W33304                                                                          
      ******************************************************************09340099
      * 5000-FORMAT-DETAIL-LINE.                                        09350099
      ******************************************************************09360099
       5000-FORMAT-DETAIL-LINE.                                         09370099
                                                                        09380099
W33304     MOVE TFRD054-ORIG-TO-LOC-NBR  TO IN031-LOC-NBR.                      
W33304     MOVE PV-AREA-NBR              TO IN031-SHEET-NBR.                    
W33304     MOVE IN400-ATT-DEPT-OUT       TO IN031-DEPT-NBR.                     
W33304     MOVE IN400-ATT-SCL-OUT        TO IN031-SUBCLASS-NBR.                 
W33304     MOVE INVPAR-INV-ID            TO IN031-INV-ID.                       
W33304     MOVE INCNTL-INV-NM-TEXT       TO IN031-INV-NAME.                     
P28545*    MOVE SKXREF-DEPT           TO DL-DEPT-NBR.                   09461099
P28545*    MOVE SKXREF-SUBCLASS       TO DL-SUBCLASS-NBR.               09462099
P28545                                                                  09463099
W33304     MOVE TFRD054-SKU-NBR          TO IN031-SKU-NBR.                      
                                                                        09480099
           IF TFRD054-ORIG-TO-LOC-NBR EQUAL TFRD054-TO-LOC-NBR          09490099
               COMPUTE PV-ITEM-QTY  = TFRD054-ITEM-QTY * 1              09500099
W33304         MOVE TFRD054-ITEM-QTY     TO IN031-UNIT-QTY                      
           ELSE                                                         09520099
           IF TFRD054-ORIG-TO-LOC-NBR EQUAL TFRD054-FROM-LOC-NBR        09530099
               COMPUTE PV-ITEM-QTY  = TFRD054-ITEM-QTY * -1             09540099
W33304         MOVE PV-ITEM-QTY          TO IN031-UNIT-QTY                      
           END-IF.                                                      09560099
                                                                        09570099
W33304     MOVE PV-UNT-RTL-AMT-HOLD      TO IN031-UNIT-RTL-AMT.                 
W33304     MOVE TFRD054-ITEM-PRICE       TO IN031-TFR-RTL-AMT.                  
                                                                        09600099
           COMPUTE PV-EXTD-AMOUNT   = PV-UNT-RTL-AMT-HOLD               09680099
                                    * PV-ITEM-QTY.                      09690099
W33304     MOVE PV-EXTD-AMOUNT           TO IN031-EXTD-RTL-AMT.                 
                                                                        09740099
           COMPUTE PV-EXTD-AMOUNT   = TFRD054-ITEM-PRICE                09750099
                                    * PV-ITEM-QTY.                      09760099
W33304     MOVE PV-EXTD-AMOUNT           TO IN031-EXTD-TFR-RTL-AMT.             
                                                                        09810099
           COMPUTE PV-EXTD-AMOUNT   = (TFRD054-ITEM-PRICE               09820099
                                    *  PV-ITEM-QTY)                     09830099
                                    - (PV-UNT-RTL-AMT-HOLD              09840099
                                    *  PV-ITEM-QTY).                    09850099
W33304     MOVE PV-EXTD-AMOUNT           TO IN031-DIFF-RTL-AMT.                 
                                                                        09870099
W33304     WRITE REPORT-LINE             FROM IN031-RECORD.                     
                                                                        09930099
      /*****************************************************************10720099
29908 * 6000-BUILD-ADJUST-TADJDTL.                                      10730099
      ******************************************************************10740099
29908  6000-BUILD-ADJUST-TADJDTL.                                       10750099
                                                                        10760099
      *** FORMAT THE TRANSFER AS AN INVENTORY ADJUSTMENT TO TADJDTL...  10770099
           MOVE TFRD054-ORIG-TO-LOC-NBR TO ADJDTL-LOC-NBR.              10780099
                                                                        10790099
           MOVE TFRD054-DOC-FROM-LOC-NBR  TO PV-EDIT-DOC-FROM-LOC-NBR.  10800099
           MOVE TFRD054-DOC-SEQ-NBR TO PV-EDIT-DOC-SEQ-NBR.             10810099
                                                                        10820099
           STRING 'TF AR ' DELIMITED BY SIZE                            10830099
                  PV-EDIT-DOC-FR-LOC-P2 DELIMITED BY SIZE               10840099
                  ' ' DELIMITED BY SIZE                                 10850099
29908             PV-EDIT-DOC-LAST-6 DELIMITED BY SIZE                  10860099
                                    INTO ADJDTL-ADJ-RSN-TXT             10870099
                                                                        10880099
           MOVE 7                   TO PV-EDIT-DOC-PART1.               10890099
           MOVE PV-EDIT-DOC-LAST-6  TO PV-AREA-NBR.                     10900099
           MOVE PV-AREA-NBR         TO ADJDTL-AREA-NBR.                 10910099
                                                                        10920099
P28545     IF IN400-PS-RENUMBER-SKU                                     10921099
P28545         MOVE IN400-PRC-SKU-OUT   TO ADJDTL-SKU-NBR               10921199
P28545         MOVE IN400-PRC-UPC-OUT   TO ADJDTL-UPC-NBR               10921299
P28545     ELSE                                                         10922099
               MOVE TFRD054-SKU-NBR     TO ADJDTL-SKU-NBR               10930099
P28545         MOVE IN400-PRC-UPC-OUT   TO ADJDTL-UPC-NBR               10940099
P28545     END-IF.                                                      10941099
P28545                                                                  10950099
           MOVE PC-PROGRAM-NAME     TO ADJDTL-CRE-ID-NBR.               10960099
           MOVE 'SI'                TO ADJDTL-ADJ-TYPE-CDE.             10970099
                                                                        10980099
      *** PRICE, QUANTITY, EXTENDED RETAIL...                           10990099
           IF TFRD054-ORIG-TO-LOC-NBR EQUAL TFRD054-TO-LOC-NBR          11000099
               MOVE TFRD054-ITEM-QTY  TO ADJDTL-ADJ-QTY                 11010099
           ELSE                                                         11020099
           IF TFRD054-ORIG-TO-LOC-NBR EQUAL TFRD054-FROM-LOC-NBR        11030099
               COMPUTE PV-ITEM-QTY    = TFRD054-ITEM-QTY * -1           11040099
               MOVE PV-ITEM-QTY       TO ADJDTL-ADJ-QTY                 11050099
           ELSE                                                         11060099
29908          DISPLAY '*** ERROR - 6000-BUILD-ADJUST-TADJDTL ***'      11070099
               DISPLAY '** ORIGINAL LOC DOESNT MATCH TO/FR LOC *'       11080099
               DISPLAY ' STORE  :   ' TFRD054-ORIG-TO-LOC-NBR           11090099
               DISPLAY ' TO/FROM:   ' TFRD054-TO-LOC-NBR                11100099
               ' ' TFRD054-FROM-LOC-NBR                                 11110099
               DISPLAY ' SKU    :     ' TFRD054-SKU-NBR                 11120099
               DISPLAY ' INTR-UPC-ID: ' IN400-ATT-UPCID-OUT             11130099
               PERFORM 9900-SQL-ERROR                                   11140099
           END-IF.                                                      11150099
                                                                        11160099
           MOVE PV-UNT-RTL-AMT-HOLD TO ADJDTL-ADJ-UNIT-PR-AMT.          11170099
                                                                        11180099
           COMPUTE PV-EXTD-AMOUNT   = ADJDTL-ADJ-UNIT-PR-AMT            11190099
                                    * ADJDTL-ADJ-QTY.                   11200099
           MOVE PV-EXTD-AMOUNT      TO ADJDTL-ADJ-EXTD-AMT.             11210099
                                                                        11220099
30272 *** DEFINE THE ITEM'S DKEY NBR.....                               11230099
  |        PERFORM 6200-DEFINE-DKEY.                                    11240099
  |   *    ADD 11                   TO PV-ADD-NUM.                      11250099
  |   *    ACCEPT PV-TODAYS-TIME    FROM TIME.                          11260099
  |   *    COMPUTE PV-TODAYS-TIME   = (PV-TODAYS-DATE                   11270099
  |   *                             + PV-ADD-NUM)                       11280099
  |   *                             * 11.                               11290099
  |   *    MOVE PV-HUND-SEC         TO PV-SEED-BYTE-1-2.                11300099
  |   *    MOVE PV-SEC              TO PV-SEED-BYTE-3-4.                11310099
  |   *    MOVE PV-MIN              TO PV-SEED-BYTE-5-6.                11320099
  |   *    MOVE PV-HH               TO PV-SEED-BYTE-7-8.                11330099
  |   *    MOVE PV-INITIAL-SEED     TO PV-SEED.                         11340099
  |   *                                                                 11350099
  |   *    COMPUTE PV-WORK-FIELD = ((PV-SEED + PC-PRIME1)               11360099
  |   *                          * PC-PRIME2).                          11370099
  |   *                                                                 11380099
  |   *    DIVIDE PV-WORK-FIELD BY  PC-ONE-BILLION                      11390099
  |   *        GIVING PV-WORK-FIELD2                                    11400099
  |   *        REMAINDER PV-RANDOM-NUMBER.                              11410099
   |  *                                                                 11420099
   |  *    MOVE PV-RANDOM-NUMBER    TO ADJDTL-DKEY-NBR.                 11430099
   |  *                                                                 11440099
30272 *** ADD THE DAILY TRANSFER ASSUMPT RECEIVE ADJUSTMENT TO TADJDTL. 11450099
           PERFORM 8200-INSERT-INTO-TADJDTL.                            11460099
           IF SQLCODE IS EQUAL TO -803                                  11470099
             PERFORM                                                    11480099
               UNTIL SQLCODE = 0                                        11490099
                  OR SQLCODE = +100                                     11500099
                                                                        11510099
                 MOVE ZEROS              TO SQLCODE                     11520099
                                                                        11530099
                 ADD 11                   TO PV-ADD-NUM                 11540099
                 ACCEPT PV-TODAYS-TIME    FROM TIME                     11550099
                 COMPUTE PV-TODAYS-TIME   = (PV-TODAYS-DATE             11560099
                                          + PV-ADD-NUM)                 11570099
                                          * 11                          11580099
                 MOVE PV-HUND-SEC         TO PV-SEED-BYTE-1-2           11590099
                 MOVE PV-SEC              TO PV-SEED-BYTE-3-4           11600099
                 MOVE PV-MIN              TO PV-SEED-BYTE-5-6           11610099
                 MOVE PV-HH               TO PV-SEED-BYTE-7-8           11620099
                 MOVE PV-INITIAL-SEED     TO PV-SEED                    11630099
                                                                        11640099
                 COMPUTE PV-WORK-FIELD = ((PV-SEED + PC-PRIME1)         11650099
                                       * PC-PRIME2)                     11660099
                                                                        11670099
                 DIVIDE PV-WORK-FIELD BY  PC-ONE-BILLION                11680099
                     GIVING PV-WORK-FIELD2                              11690099
                     REMAINDER PV-RANDOM-NUMBER                         11700099
                                                                        11710099
                 MOVE PV-RANDOM-NUMBER    TO ADJDTL-DKEY-NBR            11720099
                                                                        11730099
                 PERFORM 8200-INSERT-INTO-TADJDTL                       11740099
                                                                        11750099
             END-PERFORM                                                11760099
           END-IF.                                                      11770099
                                                                        11780099
      *** WRITE DETAIL REPORT INFORMATION....                           11790099
           PERFORM 5000-FORMAT-DETAIL-LINE.                             11800099
                                                                        11810099
           ADD ADJDTL-ADJ-QTY       TO PV-UNT-QTY-COUNT.                11820099
           ADD ADJDTL-ADJ-QTY       TO PV-TFR-QTY-COUNT.                11830099
           ADD ADJDTL-ADJ-QTY       TO PV-STR-QTY-COUNT.                11840099
           ADD ADJDTL-ADJ-QTY       TO PV-TOT-QTY-COUNT.                11850099
                                                                        11860099
           ADD PV-EXTD-AMOUNT       TO PV-UNT-RTL-AMT-COUNT.            11870099
           ADD PV-EXTD-AMOUNT       TO PV-TFR-RTL-AMT-COUNT.            11880099
           ADD PV-EXTD-AMOUNT       TO PV-STR-RTL-AMT-COUNT.            11890099
           ADD PV-EXTD-AMOUNT       TO PV-TOT-RTL-AMT-COUNT.            11900099
                                                                        11910099
29908 ******************************************************************11920099
 |    * 6100-BUILD-ADJUST-TADJADD.                                      11930099
 |    ******************************************************************11940099
 |     6100-BUILD-ADJUST-TADJADD.                                       11950099
 |                                                                      11960099
 |    *** FORMAT THE TRANSFER AS AN INVENTORY ADJUSTMENT TO TADJADD...  11970099
 |         MOVE TFRD054-ORIG-TO-LOC-NBR TO ADJADD-LOC-NBR.              11980099
 |                                                                      11990099
 |         MOVE TFRD054-DOC-FROM-LOC-NBR  TO PV-EDIT-DOC-FROM-LOC-NBR.  12000099
 |         MOVE TFRD054-DOC-SEQ-NBR TO PV-EDIT-DOC-SEQ-NBR.             12010099
 |                                                                      12020099
 |         STRING 'TF AR ' DELIMITED BY SIZE                            12030099
 |                PV-EDIT-DOC-FR-LOC-P2 DELIMITED BY SIZE               12040099
 |                ' ' DELIMITED BY SIZE                                 12050099
 |                PV-EDIT-DOC-LAST-6 DELIMITED BY SIZE                  12060099
 |                                  INTO ADJADD-ADJ-RSN-TXT             12070099
 |                                                                      12080099
 |         MOVE 7                   TO PV-EDIT-DOC-PART1.               12090099
 |         MOVE PV-EDIT-DOC-LAST-6  TO PV-AREA-NBR.                     12100099
 |         MOVE PV-AREA-NBR         TO ADJADD-AREA-NBR.                 12110099
29908                                                                   12120099
P28545     IF IN400-PS-RENUMBER-SKU                                     12141099
P28545         MOVE IN400-PRC-SKU-OUT   TO ADJADD-SKU-NBR               12142099
P28545         MOVE IN400-PRC-UPC-OUT   TO ADJADD-UPC-NBR               12143099
P28545     ELSE                                                         12144099
29908          MOVE TFRD054-SKU-NBR     TO ADJADD-SKU-NBR               12145099
P28545         MOVE IN400-PRC-UPC-OUT   TO ADJADD-UPC-NBR               12146099
P28545     END-IF.                                                      12147099
29908                                                                   12150099
 |         MOVE PC-PROGRAM-NAME     TO ADJADD-CHG-ID-NBR.               12160099
 |         MOVE 'N'                 TO ADJADD-MISSED-MD-IND             12170099
 |                                                                      12180099
 |    *** PRICE, QUANTITY, EXTENDED RETAIL...                           12190099
 |         IF TFRD054-ORIG-TO-LOC-NBR EQUAL TFRD054-TO-LOC-NBR          12200099
 |             MOVE TFRD054-ITEM-QTY  TO ADJADD-ADJ-QTY                 12210099
 |         ELSE                                                         12220099
 |         IF TFRD054-ORIG-TO-LOC-NBR EQUAL TFRD054-FROM-LOC-NBR        12230099
 |             COMPUTE PV-ITEM-QTY    = TFRD054-ITEM-QTY * -1           12240099
 |             MOVE PV-ITEM-QTY       TO ADJADD-ADJ-QTY                 12250099
 |         ELSE                                                         12260099
 |             DISPLAY '*** ERROR - 6100-BUILD-ADJUST-TADJADD ***'      12270099
 |             DISPLAY '** ORIGINAL LOC DOESNT MATCH TO/FR LOC *'       12280099
 |             DISPLAY ' STORE  :   ' TFRD054-ORIG-TO-LOC-NBR           12290099
 |             DISPLAY ' TO/FROM:   ' TFRD054-TO-LOC-NBR                12300099
 |             ' ' TFRD054-FROM-LOC-NBR                                 12310099
 |             DISPLAY ' SKU    :     ' TFRD054-SKU-NBR                 12320099
 |             DISPLAY ' INTR-UPC-ID: ' IN400-ATT-UPCID-OUT             12330099
 |             PERFORM 9900-SQL-ERROR                                   12340099
 |         END-IF.                                                      12350099
 |                                                                      12360099
 |         MOVE PV-UNT-RTL-AMT-HOLD TO ADJADD-ADJ-UNIT-PR-AMT.          12370099
 |                                                                      12380099
 |         COMPUTE PV-EXTD-AMOUNT   = ADJADD-ADJ-UNIT-PR-AMT            12390099
 |                                  * ADJADD-ADJ-QTY.                   12400099
 |         MOVE PV-EXTD-AMOUNT      TO ADJADD-ADJ-EXTD-AMT.             12410099
 |                                                                      12420099
 |    *** GENERATE A RANDOM NUMBER FOR THE DKEY.....                    12430099
 |         ADD 11                   TO PV-ADD-NUM.                      12440099
 |         ACCEPT PV-TODAYS-TIME    FROM TIME.                          12450099
 |         COMPUTE PV-TODAYS-TIME   = (PV-TODAYS-DATE                   12460099
 |                                  + PV-ADD-NUM)                       12470099
 |                                  * 11.                               12480099
 |         MOVE PV-HUND-SEC         TO PV-SEED-BYTE-1-2.                12490099
 |         MOVE PV-SEC              TO PV-SEED-BYTE-3-4.                12500099
 |         MOVE PV-MIN              TO PV-SEED-BYTE-5-6.                12510099
 |         MOVE PV-HH               TO PV-SEED-BYTE-7-8.                12520099
 |         MOVE PV-INITIAL-SEED     TO PV-SEED.                         12530099
 |                                                                      12540099
 |         COMPUTE PV-WORK-FIELD = ((PV-SEED + PC-PRIME1)               12550099
 |                               * PC-PRIME2).                          12560099
 |                                                                      12570099
 |         DIVIDE PV-WORK-FIELD BY  PC-ONE-BILLION                      12580099
 |             GIVING PV-WORK-FIELD2                                    12590099
 |             REMAINDER PV-RANDOM-NUMBER.                              12600099
 |                                                                      12610099
 |         MOVE PV-RANDOM-NUMBER    TO ADJADD-DKEY-NBR.                 12620099
 |                                                                      12630099
 |    *** ADD THE DAILY TRANSFER ASSUMPT RECEIVE ADJUSTMENT TO TADJADD. 12640099
 |         PERFORM 8700-INSERT-INTO-TADJADD.                            12650099
 |         IF SQLCODE IS EQUAL TO -803                                  12660099
 |           PERFORM                                                    12670099
 |             UNTIL SQLCODE = 0                                        12680099
 |                OR SQLCODE = +100                                     12690099
 |                                                                      12700099
 |               MOVE ZEROS              TO SQLCODE                     12710099
 |                                                                      12720099
 |               ADD 11                   TO PV-ADD-NUM                 12730099
 |               ACCEPT PV-TODAYS-TIME    FROM TIME                     12740099
 |               COMPUTE PV-TODAYS-TIME   = (PV-TODAYS-DATE             12750099
 |                                        + PV-ADD-NUM)                 12760099
 |                                        * 11                          12770099
 |               MOVE PV-HUND-SEC         TO PV-SEED-BYTE-1-2           12780099
 |               MOVE PV-SEC              TO PV-SEED-BYTE-3-4           12790099
 |               MOVE PV-MIN              TO PV-SEED-BYTE-5-6           12800099
 |               MOVE PV-HH               TO PV-SEED-BYTE-7-8           12810099
 |               MOVE PV-INITIAL-SEED     TO PV-SEED                    12820099
 |                                                                      12830099
 |               COMPUTE PV-WORK-FIELD = ((PV-SEED + PC-PRIME1)         12840099
 |                                     * PC-PRIME2)                     12850099
 |                                                                      12860099
 |               DIVIDE PV-WORK-FIELD BY  PC-ONE-BILLION                12870099
 |                   GIVING PV-WORK-FIELD2                              12880099
 |                   REMAINDER PV-RANDOM-NUMBER                         12890099
 |                                                                      12900099
 |               MOVE PV-RANDOM-NUMBER    TO ADJADD-DKEY-NBR            12910099
 |                                                                      12920099
 |               PERFORM 8700-INSERT-INTO-TADJADD                       12930099
 |                                                                      12940099
 |           END-PERFORM                                                12950099
 |         END-IF.                                                      12960099
 |                                                                      12970099
 |    *** WRITE DETAIL REPORT INFORMATION....                           12980099
 |         PERFORM 5000-FORMAT-DETAIL-LINE.                             12990099
 |                                                                      13000099
 |         ADD ADJADD-ADJ-QTY       TO PV-UNT-QTY-COUNT.                13010099
 |         ADD ADJADD-ADJ-QTY       TO PV-TFR-QTY-COUNT.                13020099
 |         ADD ADJADD-ADJ-QTY       TO PV-STR-QTY-COUNT.                13030099
 |         ADD ADJADD-ADJ-QTY       TO PV-TOT-QTY-COUNT.                13040099
 |                                                                      13050099
 |         ADD PV-EXTD-AMOUNT       TO PV-UNT-RTL-AMT-COUNT.            13060099
 |         ADD PV-EXTD-AMOUNT       TO PV-TFR-RTL-AMT-COUNT.            13070099
 |         ADD PV-EXTD-AMOUNT       TO PV-STR-RTL-AMT-COUNT.            13080099
 |         ADD PV-EXTD-AMOUNT       TO PV-TOT-RTL-AMT-COUNT.            13090099
29908                                                                   13100099
30272 ******************************************************************13110099
  |   * 6200-DEFINE-DKEY.                                               13120099
  |   ******************************************************************13130099
  |    6200-DEFINE-DKEY.                                                13140099
   |                                                                    13150099
   |       MOVE 'N'            TO PS-DKEY-NBR-FOUND-SW.                 13160099
   |                                                                    13170099
   |       PERFORM 7100-GET-TSUMINV-DKEY.                               13180099
   |       IF PS-DKEY-NBR-NOT-FOUND                                     13190099
   |           PERFORM 7200-GET-TADJADD-DKEY                            13200099
   |       END-IF.                                                      13210099
30272                                                                   13220099
30272 ******************************************************************13450099
  |   * 7100-GET-TSUMINV-DKEY.                                          13460099
  |   ******************************************************************13470099
  |    7100-GET-TSUMINV-DKEY.                                           13480099
  |                                                                     13490099
  |        MOVE TFRD054-ORIG-TO-LOC-NBR TO SUMINV-LOC-NBR.              13520099
  |        MOVE TFRD054-SKU-NBR         TO SUMINV-SKU-NBR.              13530099
  |                                                                     13540099
  |        MOVE TFRD054-DOC-SEQ-NBR TO PV-EDIT-DOC-SEQ-NBR.             13550099
  |        MOVE 7                   TO PV-EDIT-DOC-PART1.               13560099
  |        MOVE PV-EDIT-DOC-LAST-6  TO PV-AREA-NBR.                     13570099
  |        MOVE PV-AREA-NBR         TO SUMINV-AREA-NBR.                 13580099
  |                                                                     13590099
  |        EXEC SQL                                                     13600099
  |            SELECT DISTINCT DKEY_NBR                                 13610099
  |            INTO :SUMINV-DKEY-NBR                                    13620099
  |            FROM TSUMINV                                             13630099
  |            WHERE LOC_NBR = :SUMINV-LOC-NBR                          13640099
  |              AND SKU_NBR = :SUMINV-SKU-NBR                          13650099
  |              AND AREA_NBR = :SUMINV-AREA-NBR                        13660099
  |            WITH UR                                                  13670099
  |        END-EXEC.                                                    13680099
  |                                                                     13690099
  |        EVALUATE TRUE                                                13700099
  |          WHEN SQLCODE = 0                                           13710099
  |            MOVE SUMINV-DKEY-NBR     TO ADJDTL-DKEY-NBR              13720099
  |            MOVE 'Y'                 TO PS-DKEY-NBR-FOUND-SW         13730099
  |          WHEN OTHER                                                 13740099
  |            MOVE 'N'                 TO PS-DKEY-NBR-FOUND-SW         13750099
  |        END-EVALUATE.                                                13760099
  |                                                                     13770099
30272 ******************************************************************13780099
  |   * 7200-GET-TADJADD-DKEY.                                          13790099
  |   ******************************************************************13800099
  |    7200-GET-TADJADD-DKEY.                                           13810099
  |                                                                     13820099
  |        MOVE TFRD054-ORIG-TO-LOC-NBR TO ADJADD-LOC-NBR.              13850099
  |        MOVE TFRD054-SKU-NBR         TO ADJADD-SKU-NBR.              13860099
  |                                                                     13870099
  |        MOVE TFRD054-DOC-SEQ-NBR TO PV-EDIT-DOC-SEQ-NBR.             13880099
  |        MOVE 7                   TO PV-EDIT-DOC-PART1.               13890099
  |        MOVE PV-EDIT-DOC-LAST-6  TO PV-AREA-NBR.                     13900099
  |        MOVE PV-AREA-NBR         TO ADJADD-AREA-NBR.                 13910099
  |                                                                     13920099
  |        EXEC SQL                                                     13930099
  |            SELECT DISTINCT DKEY_NBR                                 13940099
  |            INTO :ADJADD-DKEY-NBR                                    13950099
  |            FROM TADJADD                                             13960099
  |            WHERE LOC_NBR = :ADJADD-LOC-NBR                          13970099
  |              AND SKU_NBR = :ADJADD-SKU-NBR                          13980099
  |              AND AREA_NBR = :ADJADD-AREA-NBR                        13990099
  |            WITH UR                                                  14000099
  |        END-EXEC.                                                    14010099
  |                                                                     14020099
  |        EVALUATE TRUE                                                14030099
  |          WHEN SQLCODE = 0                                           14040099
  |            MOVE ADJADD-DKEY-NBR     TO ADJDTL-DKEY-NBR              14050099
  |            MOVE 'Y'                 TO PS-DKEY-NBR-FOUND-SW         14060099
  |          WHEN OTHER                                                 14070099
  |            ADD 11                   TO PV-ADD-NUM                   14080099
  |            ACCEPT PV-TODAYS-TIME    FROM TIME                       14090099
  |            COMPUTE PV-TODAYS-TIME   = (PV-TODAYS-DATE               14100099
  |                                     + PV-ADD-NUM)                   14110099
  |                                     * 11                            14120099
  |            MOVE PV-HUND-SEC         TO PV-SEED-BYTE-1-2             14130099
  |            MOVE PV-SEC              TO PV-SEED-BYTE-3-4             14140099
  |            MOVE PV-MIN              TO PV-SEED-BYTE-5-6             14150099
  |            MOVE PV-HH               TO PV-SEED-BYTE-7-8             14160099
  |            MOVE PV-INITIAL-SEED     TO PV-SEED                      14170099
  |            COMPUTE PV-WORK-FIELD = ((PV-SEED + PC-PRIME1)           14180099
  |                                  * PC-PRIME2)                       14190099
  |            DIVIDE PV-WORK-FIELD BY  PC-ONE-BILLION                  14200099
  |              GIVING PV-WORK-FIELD2                                  14210099
  |              REMAINDER PV-RANDOM-NUMBER                             14220099
  |            MOVE PV-RANDOM-NUMBER    TO ADJDTL-DKEY-NBR              14230099
  |        END-EVALUATE.                                                14240099
30272                                                                   14250099
      ******************************************************************14260099
      * 7600-GET-COMMIT-TIMESTAMP.                                     *14270099
      *   GET THE TIMESTAMP FROM THE CHECKPOINT TABLE FOR NEXT COMMIT  *14280099
      ******************************************************************14290099
       7600-GET-COMMIT-TIMESTAMP.                                       14300099
                                                                        14310099
           EXEC SQL                                                     14320099
             SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)       14330099
               INTO :PV-COMMIT-TIMESTAMP                                14340099
               FROM TCKRSTCNTL                                          14350099
              WHERE JOB_NAME  = :PC-JOB-NAME                            14360099
                AND PLAN_NAME = :PC-PROGRAM-NAME                        14370099
           END-EXEC.                                                    14380099
                                                                        14390099
           EVALUATE TRUE                                                14400099
               WHEN SQLCODE = 0                                         14410099
                   CONTINUE                                             14420099
               WHEN SQLCODE NOT EQUAL ZERO                              14430099
                   DISPLAY ' JOB:     ' PC-JOB-NAME                     14440099
                           ' PROGRAM: ' PC-PROGRAM-NAME                 14450099
                   MOVE '7600-GET-COMMIT-TIMESTAMP' TO PV-PARAGRAPH-NAME14460099
                   MOVE PE-MSG-07             TO PV-OPERATION-ATTEMPTED 14470099
                   PERFORM 9900-SQL-ERROR                               14480099
           END-EVALUATE.                                                14490099
      *                                                                 14500099
      ******************************************************************14510099
      * 7650-INIT-CHECKPOINT-SELECT                                    *14520099
      * CHECK STATUS CODE TO SEE IF THIS IS A RESTART CONDITION        *14530099
      ******************************************************************14540099
       7650-INIT-CHECKPOINT-SELECT.                                     14550099
                                                                        14560099
           EXEC SQL                                                     14570099
             SELECT  CKPT_STAT_CODE                                     14580099
                    ,CKPT_FRQNCY_QTY                                    14590099
               INTO  :TCKRSTCNTL-CKPT-STAT-CODE                         14600099
                    ,:TCKRSTCNTL-CKPT-FRQNCY-QTY                        14610099
               FROM  TCKRSTCNTL                                         14620099
              WHERE  JOB_NAME  = :PC-JOB-NAME                           14630099
                AND  PLAN_NAME = :PC-PROGRAM-NAME                       14640099
           END-EXEC.                                                    14650099
                                                                        14660099
           IF SQLCODE = 0                                               14670099
               CONTINUE                                                 14680099
           ELSE                                                         14690099
               DISPLAY ' JOB: ' PC-JOB-NAME                             14700099
                       ' PROGRAM: ' PC-PROGRAM-NAME                     14710099
               MOVE '7650-INIT-CHECKPOINT-SELECT' TO PV-PARAGRAPH-NAME  14720099
               MOVE PE-MSG-07             TO PV-OPERATION-ATTEMPTED     14730099
               PERFORM 9900-SQL-ERROR                                   14740099
           END-IF.                                                      14750099
                                                                        14760099
      ******************************************************************14770099
      * 7700-SELECT-RESTART-INFO                                       *14780099
      * OBTAIN INFORMATION REGARDING WHERE TO RESTART TABLE PROCESSING *14790099
      ******************************************************************14800099
       7700-SELECT-RESTART-INFO.                                        14810099
                                                                        14820099
           EXEC SQL                                                     14830099
             SELECT  WORK_STRG_DESC                                     14840099
               INTO  :TCKRSTINF-WORK-STRG-DESC                          14850099
               FROM  TCKRSTINF                                          14860099
              WHERE  JOB_NAME  = :PC-JOB-NAME                           14870099
                AND  PLAN_NAME = :PC-PROGRAM-NAME                       14880099
           END-EXEC.                                                    14890099
                                                                        14900099
           IF SQLCODE = 0                                               14910099
               CONTINUE                                                 14920099
           ELSE                                                         14930099
               DISPLAY ' JOB:     ' PC-JOB-NAME                         14940099
                       ' PROGRAM: ' PC-PROGRAM-NAME                     14950099
               MOVE '*7700-SELECT-RESTART-INFO*' TO PV-PARAGRAPH-NAME   14960099
               MOVE PE-MSG-11             TO PV-OPERATION-ATTEMPTED     14970099
               PERFORM 9900-SQL-ERROR                                   14980099
           END-IF.                                                      14990099
                                                                        15000099
      ******************************************************************15010099
      * 7750-SET-CURRENT-TIMESTAMP.                                    *15020099
      * CURRENT TIMESTAMP SET TO BE COMPARED TO COMMIT TIMESTAMP       *15030099
      ******************************************************************15040099
       7750-SET-CURRENT-TIMESTAMP.                                      15050099
                                                                        15060099
           EXEC SQL                                                     15070099
                SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           15080099
           END-EXEC.                                                    15090099
                                                                        15100099
           IF SQLCODE = 0                                               15110099
               CONTINUE                                                 15120099
           ELSE                                                         15130099
               MOVE PE-MSG-12             TO PV-OPERATION-ATTEMPTED     15140099
               MOVE '*7750-SET-CURRENT-TIMESTAMP*' TO PV-PARAGRAPH-NAME 15150099
               PERFORM 9900-SQL-ERROR                                   15160099
           END-IF.                                                      15170099
                                                                        15180099
      ******************************************************************15190099
      * 7800-COMMIT-PROCESSING.                                        *15200099
      * COMPARE COMMIT TIMESTAMP TO CURRENT TO DETERMINE IF COMMIT REQD*15210099
      ******************************************************************15220099
       7800-COMMIT-PROCESSING.                                          15230099
           MOVE '*7800-COMMIT-PROCESSING*'    TO PV-PARAGRAPH-NAME.     15240099
                                                                        15250099
           PERFORM 7750-SET-CURRENT-TIMESTAMP.                          15260099
                                                                        15270099
           IF (PV-CURRENT-TIMESTAMP > PV-COMMIT-TIMESTAMP)  OR          15280099
              (END-OF-TRANSFER-DATA)                                    15290099
      * PREPARE COMMIT RECORD FOR UPDATE                                15300099
               ADD 1                          TO PA-COMMIT-COUNT        15310099
               MOVE TFRD054-BATCH-NBR         TO CR-BATCH-NBR           15320099
               MOVE TFRD054-ORIG-TO-LOC-NBR   TO CR-ORIG-TO-LOC-NBR     15330099
               MOVE TFRD054-DOC-FROM-LOC-NBR  TO CR-DOC-FROM-LOC-NBR    15340099
               MOVE TFRD054-DOC-SEQ-NBR       TO CR-DOC-SEQ-NBR         15350099
               MOVE TFRD054-CREATE-DATE       TO CR-CREATE-DATE         15360099
               MOVE TFRD054-LNE-NBR           TO CR-LNE-NBR             15370099
               MOVE TFRD054-SKU-NBR           TO CR-SKU-NBR             15380099
               MOVE PA-EXTRACT-RECS-READ      TO CR-INPUT-COUNT         15390099
               MOVE PA-UPDATE-COUNT           TO CR-UPDATE-COUNT        15400099
               MOVE PA-INSERT-COUNT           TO CR-INSERT-COUNT        15410099
               MOVE PA-COMMIT-COUNT           TO CR-COMMIT-COUNT        15420099
               MOVE PA-ZERO-REC-DROPPED       TO CR-ZERO-REC-DROPPED    15430099
               MOVE PA-DUPLICATE-REC          TO CR-DUPLICATE-REC       15440099
      * MOVE COMMIT INFO TO WORKING STORAGE ROW                         15450099
               MOVE CR-CHECKPOINT-RESTART-AREA TO                       15460099
                                                TCKRSTINF-WORK-STRG-DESC15470099
               MOVE 'Y' TO PS-COMMIT-TAKEN-SW                           15480099
               IF PS-FIRST-COMMIT                                       15490099
                   MOVE '9' TO TCKRSTCNTL-CKPT-STAT-CODE                15500099
                   PERFORM 7900-UPDATE-CHECKPOINT-STATUS                15510099
                   MOVE 'N' TO PS-FIRST-COMMIT-SW                       15520099
               END-IF                                                   15530099
                                                                        15540099
               PERFORM 7850-COMMIT-CHANGES                              15550099
                                                                        15560099
               PERFORM 7600-GET-COMMIT-TIMESTAMP                        15570099
                                                                        15580099
           END-IF.                                                      15590099
                                                                        15600099
      ******************************************************************15610099
      * 7850-COMMIT-CHANGES.                                            15620099
      * UPDATE CHECKPOINT INFORMATION TABLE. TAKE A COMMIT.             15630099
      ******************************************************************15640099
       7850-COMMIT-CHANGES.                                             15650099
                                                                        15660099
           EXEC SQL                                                     15670099
             UPDATE TCKRSTINF                                           15680099
                SET WORK_STRG_DESC = :TCKRSTINF-WORK-STRG-DESC          15690099
              WHERE JOB_NAME       = :PC-JOB-NAME                       15700099
                AND PLAN_NAME      = :PC-PROGRAM-NAME                   15710099
           END-EXEC.                                                    15720099
                                                                        15730099
           IF SQLCODE = 0                                               15740099
               CONTINUE                                                 15750099
           ELSE                                                         15760099
               DISPLAY ' JOB:     ' PC-JOB-NAME                         15770099
                       ' PROGRAM: ' PC-PROGRAM-NAME                     15780099
               MOVE PE-MSG-08                  TO PV-OPERATION-ATTEMPTED15790099
               MOVE  '* 7850-COMMIT-CHANGES *' TO PV-PARAGRAPH-NAME     15800099
               PERFORM 9900-SQL-ERROR                                   15810099
           END-IF.                                                      15820099
                                                                        15830099
           EXEC SQL                                                     15840099
               COMMIT                                                   15850099
           END-EXEC.                                                    15860099
                                                                        15870099
           IF SQLCODE = 0                                               15880099
               CONTINUE                                                 15890099
           ELSE                                                         15900099
               MOVE PE-MSG-09                  TO PV-OPERATION-ATTEMPTED15910099
               MOVE  '* 7850-COMMIT-CHANGES *' TO PV-PARAGRAPH-NAME     15920099
               PERFORM 9900-SQL-ERROR                                   15930099
           END-IF.                                                      15940099
                                                                        15950099
      ******************************************************************15960099
      * UPDATE CHECKPOINT STATUS                                        15970099
      ******************************************************************15980099
       7900-UPDATE-CHECKPOINT-STATUS.                                   15990099
                                                                        16000099
           EXEC SQL                                                     16010099
             UPDATE  TCKRSTCNTL                                         16020099
                SET  CKPT_STAT_CODE = :TCKRSTCNTL-CKPT-STAT-CODE        16030099
              WHERE  JOB_NAME  = :PC-JOB-NAME                           16040099
                AND  PLAN_NAME = :PC-PROGRAM-NAME                       16050099
           END-EXEC.                                                    16060099
                                                                        16070099
           IF SQLCODE = 0                                               16080099
               CONTINUE                                                 16090099
           ELSE                                                         16100099
               DISPLAY ' JOB:     ' PC-JOB-NAME                         16110099
                       ' PROGRAM: ' PC-PROGRAM-NAME                     16120099
               MOVE '7900-UPDATE-CHECKPOINT-STATUS' TO PV-PARAGRAPH-NAME16130099
               MOVE PE-MSG-10                  TO PV-OPERATION-ATTEMPTED16140099
               PERFORM 9900-SQL-ERROR                                   16150099
           END-IF.                                                      16160099
                                                                        16170099
      /*****************************************************************16180099
      * 8000-GET-INTR-UPC-ID.                                           16190099
      *     USED TO GET THE SKU NUMBER OF THE ACTIVE ROW FOR THE        16200099
      * INTERNAL UPC PASSED FROM RECEIVING.                             16210099
      ******************************************************************16220099
P28545*8000-GET-INTR-UPC-ID.                                            16230099
P28545*                                                                 16240099
P28545*    MOVE TFRD054-SKU-NBR   TO SKXREF-SKU.                        16250099
P28545*                                                                 16260099
P28545*    PERFORM                                                      16270099
P28545*        WITH TEST AFTER                                          16280099
P28545*        VARYING PV-RETRY-COUNT FROM 1 BY 1                       16290099
P28545*        UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  16300099
P28545*            OR (SQLCODE = 0)                                     16310099
P28545*            OR (SQLCODE = +100)                                  16320099
P28545*                                                                 16330099
P28545*        EXEC SQL                                                 16340099
P28545*            SELECT INTR_UPC_ID                                   16350099
P28545*                  ,ITM_NBR                                       16360099
P28545*                  ,DEPT                                          16370099
P28545*                  ,SUBCLASS                                      16380099
P28545*            INTO :SKXREF-INTR-UPC-ID                             16390099
P28545*                ,:SKXREF-ITM-NBR                                 16400099
P28545*                ,:SKXREF-DEPT                                    16410099
P28545*                ,:SKXREF-SUBCLASS                                16420099
P28545*            FROM TSKXREF                                         16430099
P28545*            WHERE SKU = :SKXREF-SKU                              16440099
P28545*              AND SKU_STAT_CDE <> '98'                           16450099
P28545*            WITH UR                                              16460099
P28545*        END-EXEC                                                 16470099
P28545*                                                                 16480099
P28545*        EVALUATE TRUE                                            16490099
P28545*            WHEN SQLCODE = 0                                     16500099
P28545*                CONTINUE                                         16510099
P28545*            WHEN SQLCODE = -904                                  16520099
P28545*            WHEN SQLCODE = -911                                  16530099
P28545*            WHEN SQLCODE = +100                                  16540099
P28545*                DISPLAY '*** NOT FOUND  8000-GET-INTR-UPC-ID ***'16550099
P28545*                DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR 16560099
P28545*                DISPLAY ' TFR DOC:   ' TFRD054-DOC-FROM-LOC-NBR  16570099
P28545*                ' ' TFRD054-DOC-SEQ-NBR                          16580099
P28545*                DISPLAY ' SKU    :     ' TFRD054-SKU-NBR         16590099
P28545*                DISPLAY ' INTR-UPC-ID: ' SKXREF-INTR-UPC-ID      16600099
P28545*                PERFORM 9900-SQL-ERROR                           16610099
P28545*            WHEN OTHER                                           16620099
P28545*                DISPLAY '*** OTHER - 8000-GET-INTR-UPC-ID ***'   16630099
P28545*                DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR 16640099
P28545*                DISPLAY ' TFR DOC:   ' TFRD054-DOC-FROM-LOC-NBR  16650099
P28545*                ' ' TFRD054-DOC-SEQ-NBR                          16660099
P28545*                DISPLAY ' SKU    :     ' TFRD054-SKU-NBR         16670099
P28545*                DISPLAY ' INTR-UPC-ID: ' SKXREF-INTR-UPC-ID      16680099
P28545*                PERFORM 9900-SQL-ERROR                           16690099
P28545*        END-EVALUATE                                             16700099
P28545*    END-PERFORM.                                                 16710099
P28545*                                                                 16720099
P28545*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          16730099
P28545*        DISPLAY '*** MAX RETRIES - 8000-GET-INTR-UPC-ID ***'     16740099
P28545*        DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR         16750099
P28545*        DISPLAY ' TFR DOC:   ' TFRD054-DOC-FROM-LOC-NBR          16760099
P28545*                ' ' TFRD054-DOC-SEQ-NBR                          16770099
P28545*        DISPLAY ' SKU    :     ' TFRD054-SKU-NBR                 16780099
P28545*        DISPLAY ' INTR-UPC-ID: ' SKXREF-INTR-UPC-ID              16790099
P28545*        PERFORM 9900-SQL-ERROR                                   16800099
P28545*    END-IF.                                                      16810099
P28545*                                                                 16820099
      ******************************************************************16830099
      * 8100-READ-TRANSFER-DATA.                                        16840099
      *     READ THE INTRANSIT FILE PASSED FROM THE RECEIVING TEAM.     16850099
      ******************************************************************16860099
       8100-READ-TRANSFER-DATA.                                         16870099
                                                                        16880099
           READ TRANSFER-DATA-FILE NEXT                                 16890099
               INTO TFRD054-ML-DAILY-TRANSFER-FILE                      16900099
               AT END  SET END-OF-TRANSFER-DATA TO TRUE.                16910099
                                                                        16920099
      ******************************************************************16930099
      * 8200-INSERT-INTO-TADJDTL.                                       16940099
      ******************************************************************16950099
       8200-INSERT-INTO-TADJDTL.                                        16960099
                                                                        16970099
           PERFORM WITH TEST AFTER                                      16980099
              VARYING PV-RETRY-COUNT FROM 1 BY 1                        16990099
               UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  17000099
                   OR (SQLCODE = 0)                                     17010099
                   OR (SQLCODE = +100)                                  17020099
                   OR (SQLCODE = -803)                                  17030099
                                                                        17040099
             EXEC SQL                                                   17050099
               INSERT INTO TADJDTL                                      17060099
                    ( LOC_NBR                                           17070099
                     ,AREA_NBR                                          17080099
                     ,SKU_NBR                                           17090099
                     ,UPC_NBR                                           17100099
                     ,CRE_TMST                                          17110099
                     ,ADJ_RSN_TXT                                       17120099
                     ,ADJ_TYPE_CDE                                      17130099
                     ,ADJ_UNIT_PR_AMT                                   17140099
                     ,ADJ_QTY                                           17150099
                     ,ADJ_EXTD_AMT                                      17160099
                     ,DKEY_NBR                                          17170099
                     ,CRE_ID_NBR )                                      17180099
               VALUES                                                   17190099
                   (:ADJDTL-LOC-NBR                                     17200099
                   ,:ADJDTL-AREA-NBR                                    17210099
                   ,:ADJDTL-SKU-NBR                                     17220099
                   ,:ADJDTL-UPC-NBR                                     17230099
                   ,CURRENT TIMESTAMP                                   17240099
                   ,:ADJDTL-ADJ-RSN-TXT                                 17250099
                   ,:ADJDTL-ADJ-TYPE-CDE                                17260099
                   ,:ADJDTL-ADJ-UNIT-PR-AMT                             17270099
                   ,:ADJDTL-ADJ-QTY                                     17280099
                   ,:ADJDTL-ADJ-EXTD-AMT                                17290099
                   ,:ADJDTL-DKEY-NBR                                    17300099
                   ,:ADJDTL-CRE-ID-NBR)                                 17310099
             END-EXEC                                                   17320099
                                                                        17330099
             EVALUATE TRUE                                              17340099
               WHEN SQLCODE = ZERO                                      17350099
                   ADD 1            TO PV-RECORDS-ACCEPTED              17360099
                   ADD 1            TO PA-INSERT-COUNT                  17370099
               WHEN SQLCODE = -803                                      17380099
                   ADD 1            TO PA-DUPLICATE-REC                 17390099
               WHEN SQLCODE = -904                                      17400099
               WHEN SQLCODE = -911                                      17410099
                   CONTINUE                                             17420099
               WHEN OTHER                                               17430099
                       DISPLAY '***PARAGRAPH - 8200-INSERT-INTO ***'    17440099
                       DISPLAY ' STORE  : ' TFRD054-ORIG-TO-LOC-NBR     17450099
                       DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR    17460099
                       ' ' TFRD054-DOC-SEQ-NBR                          17470099
                       DISPLAY ' SKU    : ' TFRD054-SKU-NBR             17480099
                       DISPLAY 'SHEET   : ' ADJDTL-AREA-NBR             17490099
                       PERFORM 9900-SQL-ERROR                           17500099
               END-EVALUATE                                             17510099
           END-PERFORM.                                                 17520099
                                                                        17530099
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          17540099
               DISPLAY '*** MAX RETRIES - 8200-INSERT-INTO ***'         17550099
               DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR         17560099
               DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR            17570099
                       ' ' TFRD054-DOC-SEQ-NBR                          17580099
               DISPLAY ' SKU    :     ' TFRD054-SKU-NBR                 17590099
               DISPLAY 'SHEET   : ' ADJDTL-AREA-NBR                     17600099
               PERFORM 9900-SQL-ERROR                                   17610099
           END-IF.                                                      17620099
                                                                        17630099
      ******************************************************************17640099
      * 8300-READ-TINVPAR.                                              17650099
      ******************************************************************17660099
       8300-READ-TINVPAR.                                               17670099
                                                                        17680099
           MOVE TFRD054-ORIG-TO-LOC-NBR TO INVPAR-LOC-NBR.              17690099
                                                                        17700099
           PERFORM                                                      17710099
               WITH TEST AFTER                                          17720099
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       17730099
               UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  17740099
                   OR (SQLCODE = 0)                                     17750099
                   OR (SQLCODE = +100)                                  17760099
                                                                        17770099
               EXEC SQL                                                 17780099
                   SELECT PLND_INV_DTE                                  17790099
                         ,ACTL_UNIT_BK_DTE                              17800099
W33304                   ,A.INV_ID                                              
W33304                   ,B.INV_NM                                              
                   INTO :INVPAR-PLND-INV-DTE                            17810099
                       ,:INVPAR-ACTL-UNIT-BK-DTE                        17820099
W33304                 ,:INVPAR-INV-ID                                          
W33304                 ,:INCNTL-INV-NM                                          
P28545             FROM TINVPAR A,                                      17830099
P28545                  TINCNTL B                                       17831099
P28545             WHERE B.ACTV_IND = 'Y'                               17832099
P28545               AND A.INV_ID = B.INV_ID                            17833099
P28545               AND LOC_NBR = :INVPAR-LOC-NBR                      17840099
                     AND ACTL_FIN_BK_DTE = '9999-09-09'                 17850099
W33304               AND LOC_INV_STAT_CDE = 'IN'                                
                   WITH UR                                              17860099
               END-EXEC                                                 17870099
                                                                        17880099
               EVALUATE TRUE                                            17890099
               WHEN SQLCODE = 0                                         17900099
                   MOVE INVPAR-PLND-INV-DTE   TO PV-PLND-INV-DTE        17910099
                   MOVE PV-PLND-INV-TIMESTAMP TO PV-PLND-INV-TMST       17920099
W33304             SET PS-VALID-STORE-YES     TO TRUE                           
               WHEN SQLCODE = -913                                      17930099
               WHEN SQLCODE = -904                                      17940099
               WHEN SQLCODE = -911                                      17950099
W33304             CONTINUE                                                     
               WHEN SQLCODE = +100                                      17960099
W33304             SET PS-VALID-STORE-NO      TO TRUE                           
W33304             PERFORM 4300-WRITE-ERROR-RECORD                              
               WHEN SQLWARN NOT = SPACE                                 18020099
               WHEN SQLCODE NOT = ZERO                                  18030099
                   DISPLAY '** PARAGRAPH - 8300-READ-TINVPAR **'        18040099
                   DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR     18050099
                   PERFORM 9900-SQL-ERROR                               18060099
               END-EVALUATE                                             18070099
           END-PERFORM.                                                 18080099
                                                                        18090099
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          18100099
               DISPLAY '** MAX RETRIES - 8300-READ-TINVPAR **'          18110099
               DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR         18120099
               PERFORM 9900-SQL-ERROR                                   18130099
           END-IF.                                                      18140099
                                                                        18150099
      ******************************************************************18160099
      * 8400-GET-UPC-NBR.                                               18170099
      *     GET THE UPC NUMBER TO AID IN DEVELOPING THE PRICE.          18180099
      ******************************************************************18190099
P28545*8400-GET-UPC-NBR.                                                18200099
P28545*                                                                 18210099
P28545*    SET PS-UPC-NBR-NOT-FOUND TO TRUE.                            18220099
P28545*                                                                 18230099
P28545*    MOVE SKXREF-INTR-UPC-ID  TO UPC-UPC-ID.                      18240099
P28545*    MOVE PV-PLND-INV-TMST    TO UPC-EFF-BEG-DTE.                 18250099
P28545*                                                                 18260099
P28545*    PERFORM                                                      18270099
P28545*        WITH TEST AFTER                                          18280099
P28545*        VARYING PV-RETRY-COUNT FROM 1 BY 1                       18290099
P28545*        UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  18300099
P28545*            OR (SQLCODE = 0)                                     18310099
P28545*            OR (SQLCODE = +100)                                  18320099
P28545*                                                                 18330099
P28545*        EXEC SQL                                                 18340099
P28545*            SELECT UPC_NBR                                       18350099
P28545*            INTO :UPC-UPC-NBR                                    18360099
P28545*            FROM TUPC                                            18370099
P28545*            WHERE UPC_ID             = :UPC-UPC-ID               18380099
P28545*              AND EFF_BEG_DTE       <= :UPC-EFF-BEG-DTE          18390099
P28545*              AND (EFF_END_DTE      >= :UPC-EFF-BEG-DTE          18400099
P28545*                   OR EFF_END_DTE IS NULL)                       18410099
P28545*            WITH UR                                              18420099
P28545*        END-EXEC                                                 18430099
P28545*                                                                 18440099
P28545*        EVALUATE TRUE                                            18450099
P28545*            WHEN SQLCODE = 0                                     18460099
P28545*                 SET PS-UPC-NBR-FOUND  TO TRUE                   18470099
P28545*            WHEN SQLCODE = -904                                  18480099
P28545*            WHEN SQLCODE = -911                                  18490099
P28545*            WHEN SQLCODE = +100                                  18500099
P28545*                CONTINUE                                         18510099
P28545*            WHEN OTHER                                           18520099
P28545*                DISPLAY '***PARAGRAPH - 8400-GET-UPC-NBR ***'    18530099
P28545*                DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR 18540099
P28545*                DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR    18550099
P28545*                ' ' TFRD054-DOC-SEQ-NBR                          18560099
P28545*                DISPLAY ' SKU    :     ' TFRD054-SKU-NBR         18570099
P28545*                DISPLAY ' UPC-ID: ' UPC-UPC-ID                   18580099
P28545*                        ' EFF DATE: ' UPC-EFF-BEG-DTE            18590099
P28545*                PERFORM 9900-SQL-ERROR                           18600099
P28545*        END-EVALUATE                                             18610099
P28545*    END-PERFORM.                                                 18620099
P28545*                                                                 18630099
P28545*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          18640099
P28545*        DISPLAY '*** MAX RETRIES - 8400-GET-UPC-NBR ***'         18650099
P28545*        DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR         18660099
P28545*        DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR            18670099
P28545*                ' ' TFRD054-DOC-SEQ-NBR                          18680099
P28545*        DISPLAY ' SKU    :     ' TFRD054-SKU-NBR                 18690099
P28545*        DISPLAY ' UPC-ID: ' UPC-UPC-ID                           18700099
P28545*                ' EFF DATE: ' UPC-EFF-BEG-DTE                    18710099
P28545*        PERFORM 9900-SQL-ERROR                                   18720099
P28545*    END-IF.                                                      18730099
P28545*                                                                 18740099
      ******************************************************************18750099
      * 8500-GET-PRICE.                                                 18760099
      ******************************************************************18770099
P28545*8500-GET-PRICE.                                                  18780099
P28545*                                                                 18790099
P28545*    SET PS-PRICE-NOT-FOUND  TO TRUE.                             18800099
P28545*    MOVE SKXREF-INTR-UPC-ID TO UPCPLS-UPC-ID.                    18810099
P28545*    MOVE PV-PLND-INV-TMST   TO UPCPLS-EFF-BEG-TMST.              18820099
P28545*                                                                 18830099
P28545*    PERFORM                                                      18840099
P28545*        WITH TEST AFTER                                          18850099
P28545*        VARYING PV-RETRY-COUNT FROM 1 BY 1                       18860099
P28545*        UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  18870099
P28545*            OR (SQLCODE = 0)                                     18880099
P28545*            OR (SQLCODE = +100)                                  18890099
P28545*                                                                 18900099
P28545*        EXEC SQL                                                 18910099
P28545*            SELECT  UNT_RTL_AMT                                  18920099
P28545*                   ,UPC_STAT_CDE                                 18930099
P28545*                   ,MEITGP_NBR                                   18940099
P28545*                   ,UPC_STAT_CHG_DTE                             18950099
P28545*                   ,UNT_RTL_CHG_DTE                              18960099
P28545*            INTO   :UPCPLS-UNT-RTL-AMT                           18970099
P28545*                  ,:UPCPLS-UPC-STAT-CDE                          18980099
P28545*                  ,:UPCPLS-MEITGP-NBR                            18990099
P28545*                  ,:UPCPLS-UPC-STAT-CHG-DTE                      19000099
P28545*                  ,:UPCPLS-UNT-RTL-CHG-DTE                       19010099
P28545*            FROM  TUPCPLS                                        19020099
P28545*            WHERE UPC_ID = :UPCPLS-UPC-ID                        19030099
P28545*              AND OPERCO_NBR = :PC-OPERCO-NBR                    19040099
P28545*              AND STR_NBR = :UPCPLS-STR-NBR                      19050099
P28545*              AND EFF_BEG_TMST <= :UPCPLS-EFF-BEG-TMST           19060099
P28545*              AND (EFF_END_TMST >= :UPCPLS-EFF-BEG-TMST          19070099
P28545*                   OR EFF_END_TMST IS NULL)                      19080099
P28545*            WITH UR                                              19090099
P28545*        END-EXEC                                                 19100099
P28545*                                                                 19110099
P28545*        EVALUATE TRUE                                            19120099
P28545*          WHEN SQLCODE = 0                                       19130099
P28545*            SET PS-PRICE-FOUND    TO TRUE                        19140099
P28545*            IF UPCPLS-MEITGP-NBR NOT = ZEROES                    19150099
P28545*              PERFORM 8600-GET-GROUP-PRICE                       19160099
P28545*              ADD 1 TO PV-GROUP-PRICE-COUNT                      19170099
P28545*            END-IF                                               19180099
P28545*            MOVE UPCPLS-UNT-RTL-AMT      TO PV-UNT-RTL-AMT-HOLD  19190099
P28545*            MOVE UPCPLS-UPC-STAT-CHG-DTE TO PV-UPC-STAT-CHG-DTE  19200099
P28545*            MOVE UPCPLS-UNT-RTL-CHG-DTE  TO PV-UNT-RTL-CHG-DTE   19210099
P28545*          WHEN SQLCODE = -904                                    19220099
P28545*          WHEN SQLCODE = -911                                    19230099
P28545*          WHEN SQLCODE = +100                                    19240099
P28545*            CONTINUE                                             19250099
P28545*          WHEN OTHER                                             19260099
P28545*                DISPLAY '***PARAGRAPH - 8500-GET-PRICE ***'      19270099
P28545*                DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR 19280099
P28545*                DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR    19290099
P28545*                ' ' TFRD054-DOC-SEQ-NBR                          19300099
P28545*                DISPLAY ' SKU    :     ' TFRD054-SKU-NBR         19310099
P28545*                DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                19320099
P28545*                        ' EFF TIMESTAMP: ' UPCPLS-EFF-BEG-TMST   19330099
P28545*                PERFORM 9900-SQL-ERROR                           19340099
P28545*        END-EVALUATE                                             19350099
P28545*    END-PERFORM.                                                 19360099
P28545*                                                                 19370099
P28545*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          19380099
P28545*        DISPLAY '*** MAX RETRIES - 8500-GET-PRICE ***'           19390099
P28545*        DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR         19400099
P28545*        DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR            19410099
P28545*                ' ' TFRD054-DOC-SEQ-NBR                          19420099
P28545*        DISPLAY ' SKU    :     ' TFRD054-SKU-NBR                 19430099
P28545*        DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                        19440099
P28545*                ' EFF TIMESTAMP: ' UPCPLS-EFF-BEG-TMST           19450099
P28545*        PERFORM 9900-SQL-ERROR                                   19460099
P28545*    END-IF.                                                      19470099
P28545*                                                                 19480099
      ******************************************************************19490099
      * 8600-GET-GROUP-PRICE.                                           19500099
      ******************************************************************19510099
P28545*8600-GET-GROUP-PRICE.                                            19520099
P28545*                                                                 19530099
P28545*    PERFORM                                                      19540099
P28545*        WITH TEST AFTER                                          19550099
P28545*        VARYING PV-RETRY-COUNT FROM 1 BY 1                       19560099
P28545*        UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  19570099
P28545*            OR (SQLCODE = 0)                                     19580099
P28545*            OR (SQLCODE = +100)                                  19590099
P28545*                                                                 19600099
P28545*        EXEC SQL                                                 19610099
P28545*            SELECT  MITGPL_QTY                                   19620099
P28545*                   ,GP_AMT                                       19630099
P28545*            INTO    :MITGPL-MITGPL-QTY                           19640099
P28545*                   ,:MITGPL-GP-AMT                               19650099
P28545*            FROM   TMITGPL                                       19660099
P28545*            WHERE  OPERCO_NBR    = :PC-OPERCO-NBR                19670099
P28545*              AND  MEITGP_NBR    = :UPCPLS-MEITGP-NBR            19680099
P28545*              AND  ADLOC_ID      = '   '                         19690099
P28545*              AND  (CURRENT DATE BETWEEN BEG_DTE AND END_DTE)    19700099
P28545*            WITH UR                                              19710099
P28545*        END-EXEC                                                 19720099
P28545*                                                                 19730099
P28545*        EVALUATE TRUE                                            19740099
P28545*            WHEN SQLCODE = 0                                     19750099
P28545*                 COMPUTE UPCPLS-UNT-RTL-AMT ROUNDED =            19760099
P28545*                       (MITGPL-GP-AMT /                          19770099
P28545*                        MITGPL-MITGPL-QTY )                      19780099
P28545*            WHEN SQLCODE = -904                                  19790099
P28545*            WHEN SQLCODE = -911                                  19800099
P28545*            WHEN SQLCODE = +100                                  19810099
P28545*                CONTINUE                                         19820099
P28545*            WHEN OTHER                                           19830099
P28545*                DISPLAY '***PARAGRAPH - 8600-GET-GROUP-PRICE ***'19840099
P28545*                DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR 19850099
P28545*                DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR    19860099
P28545*                ' ' TFRD054-DOC-SEQ-NBR                          19870099
P28545*                DISPLAY ' SKU    :     ' TFRD054-SKU-NBR         19880099
P28545*                DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                19890099
P28545*                        ' STORE:  ' UPCPLS-STR-NBR               19900099
P28545*                        ' GROUP PRICE ID: ' UPCPLS-MEITGP-NBR    19910099
P28545*                PERFORM 9900-SQL-ERROR                           19920099
P28545*        END-EVALUATE                                             19930099
P28545*    END-PERFORM.                                                 19940099
P28545*                                                                 19950099
P28545*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          19960099
P28545*        DISPLAY '*** MAX RETRIES - 8600-GET-GROUP-PRICE ***'     19970099
P28545*        DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR         19980099
P28545*        DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR            19990099
P28545*                ' ' TFRD054-DOC-SEQ-NBR                          20000099
P28545*        DISPLAY ' SKU    :     ' TFRD054-SKU-NBR                 20010099
P28545*        DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                        20020099
P28545*                ' STORE:  ' UPCPLS-STR-NBR                       20030099
P28545*                ' GROUP PRICE ID: ' UPCPLS-MEITGP-NBR            20040099
P28545*        PERFORM 9900-SQL-ERROR                                   20050099
P28545*    END-IF.                                                      20060099
P28545*                                                                 20070099
29908 ******************************************************************20080099
 |    * 8700-INSERT-INTO-TADJADD.                                       20090099
 |    ******************************************************************20100099
 |     8700-INSERT-INTO-TADJADD.                                        20110099
 |                                                                      20120099
 |         PERFORM WITH TEST AFTER                                      20130099
 |            VARYING PV-RETRY-COUNT FROM 1 BY 1                        20140099
 |             UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  20150099
 |                 OR (SQLCODE = 0)                                     20160099
 |                 OR (SQLCODE = +100)                                  20170099
 |                 OR (SQLCODE = -803)                                  20180099
 |                                                                      20190099
 |           EXEC SQL                                                   20200099
 |             INSERT INTO TADJADD                                      20210099
 |                       (LOC_NBR                                       20220099
 |                      , AREA_NBR                                      20230099
 |                      , SKU_NBR                                       20240099
 |                      , UPC_NBR                                       20250099
 |                      , ADJ_UNIT_PR_AMT                               20260099
 |                      , ADJ_QTY                                       20270099
 |                      , MISSED_MD_IND                                 20280099
 |                      , DKEY_NBR                                      20290099
 |                      , CHG_TMST                                      20300099
 |                      , CHG_ID_NBR                                    20310099
 |                      , ADJ_RSN_TXT                                   20320099
 |                      , ADJ_EXTD_AMT)                                 20330099
 |                 VALUES                                               20340099
 |                       (:ADJADD-LOC-NBR                               20350099
 |                      , :ADJADD-AREA-NBR                              20360099
 |                      , :ADJADD-SKU-NBR                               20370099
 |                      , :ADJADD-UPC-NBR                               20380099
 |                      , :ADJADD-ADJ-UNIT-PR-AMT                       20390099
 |                      , :ADJADD-ADJ-QTY                               20400099
 |                      , :ADJADD-MISSED-MD-IND                         20410099
 |                      , :ADJADD-DKEY-NBR                              20420099
 |                      ,  CURRENT TIMESTAMP                            20430099
 |                      , :ADJADD-CHG-ID-NBR                            20440099
 |                      , :ADJADD-ADJ-RSN-TXT                           20450099
 |                      , :ADJADD-ADJ-EXTD-AMT)                         20460099
 |           END-EXEC                                                   20470099
 |                                                                      20480099
 |           EVALUATE TRUE                                              20490099
 |             WHEN SQLCODE = ZERO                                      20500099
 |                 ADD 1            TO PV-RECORDS-ACCEPTED              20510099
 |                 ADD 1            TO PA-INSERT-COUNT                  20520099
 |             WHEN SQLCODE = -803                                      20530099
 |                 ADD 1            TO PA-DUPLICATE-REC                 20540099
 |             WHEN SQLCODE = -904                                      20550099
 |             WHEN SQLCODE = -911                                      20560099
 |                 CONTINUE                                             20570099
 |             WHEN OTHER                                               20580099
 |                     DISPLAY '***PARAGRAPH - 8700-INSERT-INTO ***'    20590099
 |                     DISPLAY ' STORE  : ' TFRD054-ORIG-TO-LOC-NBR     20600099
 |                     DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR    20610099
 |                     ' ' TFRD054-DOC-SEQ-NBR                          20620099
 |                     DISPLAY ' SKU    : ' TFRD054-SKU-NBR             20630099
 |                     DISPLAY 'SHEET   : ' ADJADD-AREA-NBR             20640099
 |                     PERFORM 9900-SQL-ERROR                           20650099
 |             END-EVALUATE                                             20660099
 |         END-PERFORM.                                                 20670099
 |                                                                      20680099
 |         IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          20690099
 |             DISPLAY '*** MAX RETRIES - 8700-INSERT-INTO ***'         20700099
 |             DISPLAY ' STORE  :     ' TFRD054-ORIG-TO-LOC-NBR         20710099
 |             DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR            20720099
 |                     ' ' TFRD054-DOC-SEQ-NBR                          20730099
 |             DISPLAY ' SKU    :     ' TFRD054-SKU-NBR                 20740099
 |             DISPLAY 'AREA    : ' ADJADD-AREA-NBR                     20750099
 |             PERFORM 9900-SQL-ERROR                                   20760099
 |         END-IF.                                                      20770099
29908                                                                   20780099
      ******************************************************************20790099
      * 8900-GET-MBS-STRUCTURE.                                         20800099
      ******************************************************************20810099
       8900-GET-MBS-STRUCTURE.                                          20820099
D28545*                                                                 20830099
D28545*    SET PS-PRICE-NOT-FOUND  TO TRUE.                             20840099
D28545*                                                                 20850099
D28545*    PERFORM                                                      20860099
D28545*      WITH TEST AFTER                                            20870099
D28545*      VARYING PV-RETRY-COUNT FROM 1 BY 1                         20880099
D28545*      UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES                     20890099
D28545*             OR SQLCODE = 0 OR +100)                             20900099
D28545*                                                                 20910099
D28545*        MOVE ZEROS             TO PV-COUNT                       20911099
D28545*                                                                 20912099
D28545*        MOVE PC-OPERCO-NBR     TO MDSEAR-OPERCO-NBR              20920099
D28545*        MOVE PC-MDSELV-CDE     TO MDSEAR-MDSELV-CDE              20930099
D28545*        MOVE PC-APLSYS-CDE     TO APLAVL-APLSYS-CDE              20940099
D28545*                                                                 20950099
D28545*        MOVE PV-EDIT-SKU-NBR-DPT TO MDSEAR-DEPT-NBR              20960099
D28545*        MOVE PV-EDIT-SKU-NBR-CLS TO PV-MAJ-CL-NBR                20970099
D28545*                                    PV-SUB-CL-NBR-2-3            20980099
D28545*        MOVE '0'               TO PV-MAJ-CL-NBR-2                20990099
D28545*        MOVE PV-MAJ-CL-NBR     TO MDSEAR-MAJ-CL-NBR              21020099
D28545*                                                                 21030099
D28545*        EXEC SQL                                                 21040099
D28545*           SELECT 1                                              21050099
D28545*           INTO :PV-COUNT                                        21090099
D28545*           FROM TMDSEAR A,                                       21130099
D28545*                TAPLAVL B                                        21140099
D28545*           WHERE (A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR)   AND      21150099
D28545*                 (A.DEPT_NBR    = :MDSEAR-DEPT-NBR)     AND      21160099
D28545*                 (A.MAJ_CL_NBR  = :MDSEAR-MAJ-CL-NBR)   AND      21170099
D28545*                 (A.SUB_CL_NBR  = :MDSEAR-SUB-CL-NBR)   AND      21180099
D28545*                 (A.MDSEAR_DKEY = B.MDSEAR_DKEY)        AND      21190099
D28545*                 (MDSELV_CDE    = :MDSEAR-MDSELV-CDE)   AND      21200099
D28545*                 (APLSYS_CDE    = :APLAVL-APLSYS-CDE)   AND      21210099
D28545*                 (DATE(CURRENT_TIMESTAMP) BETWEEN                21251099
D28545*                                     STRT_DTE AND END_DTE) AND   21252099
D28545*                 (DATE(CURRENT_TIMESTAMP) BETWEEN                21253099
D28545*                      MDSEAR_STRT_DTE AND MDSEAR_END_DTE)        21254099
D28545*           WITH UR                                               21255099
D28545*        END-EXEC                                                 21260099
D28545*                                                                 21270099
D28545*        EVALUATE TRUE                                            21280099
D28545*          WHEN SQLCODE = 0                                       21290099
D28545*            IF PV-COUNT IS GREATER THAN ZEROS                    21291099
D28545*                SET PS-PRICE-FOUND    TO TRUE                    21300099
D28545*            END-IF                                               21301099
D28545*          WHEN SQLCODE = +100                                    21310099
D28545*          WHEN SQLCODE = -904                                    21320099
D28545*          WHEN SQLCODE = -911                                    21330099
D28545*              CONTINUE                                           21340099
D28545*          WHEN OTHER                                             21350099
D28545*            MOVE '8900-GET-MBS-STRUCTURE' TO PV-PARAGRAPH-NAME   21360099
D28545*            DISPLAY ' ORIG STORE  :' TFRD054-ORIG-TO-LOC-NBR     21370099
D28545*            DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR        21380099
D28545*                    ' ' TFRD054-DOC-SEQ-NBR                      21390099
D28545*            DISPLAY ' SKU    :     ' TFRD054-SKU-NBR             21400099
D28545*            DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                    21410099
D28545*                    ' STORE:  ' UPCPLS-STR-NBR                   21420099
D28545*            DISPLAY ' SQLCODE:     ' SQLCODE                     21430099
D28545*            PERFORM 9900-SQL-ERROR                               21440099
D28545*        END-EVALUATE                                             21450099
D28545*                                                                 21460099
D28545*    END-PERFORM.                                                 21470099
D28545*                                                                 21480099
D28545*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          21490099
D28545*        MOVE '8900-GET-MBS-STRUCTURE' TO PV-PARAGRAPH-NAME       21500099
D28545*        DISPLAY '*** MAX RETRIES - 8900-GET-MBS-STRUCTURE ***'   21510099
D28545*        DISPLAY ' ORIG STORE  :' TFRD054-ORIG-TO-LOC-NBR         21520099
D28545*        DISPLAY ' TFR DOC: ' TFRD054-DOC-FROM-LOC-NBR            21530099
D28545*                ' ' TFRD054-DOC-SEQ-NBR                          21540099
D28545*        DISPLAY ' SKU    :     ' TFRD054-SKU-NBR                 21550099
D28545*        DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                        21560099
D28545*                ' STORE:  ' UPCPLS-STR-NBR                       21570099
D28545*        PERFORM 9900-SQL-ERROR                                   21580099
D28545*    END-IF.                                                      21590099
D28545*                                                                 21600099
      /*****************************************************************21610099
      * 9000-END-OF-JOB-TASKS.                                          21620099
      ******************************************************************21630099
       9000-END-OF-JOB-TASKS.                                           21640099
                                                                        21650099
      *** THE FINAL COMMIT...                                           21660099
           PERFORM 7800-COMMIT-PROCESSING                               21670099
                                                                        21680099
           MOVE '0' TO TCKRSTCNTL-CKPT-STAT-CODE.                       21690099
           PERFORM 7900-UPDATE-CHECKPOINT-STATUS.                       21700099
                                                                        21710099
      *** STORE TOTALS.....                                             21720099
974649*    IF PV-TOT-QTY-COUNT IS EQUAL TO ZEROS     AND                21730099
974649*       PV-TOT-RTL-AMT-COUNT IS EQUAL TO ZEROS                    21740099
                                                                        21810099
      *** FINAL TOTALS.....                                             21820099
           DISPLAY '***********************'.                           21830099
           DISPLAY '* ' PC-PROGRAM-NAME ' SUMMARY    *'.                21840099
           DISPLAY '***********************'.                           21850099
           DISPLAY ' '.                                                 21860099
           DISPLAY ' RECORDS READ:       ' PV-RECORDS-READ.             21870099
           DISPLAY '   NO UNIT COUNT:      ' PV-NO-UNIT-COUNT.          21880099
           DISPLAY '   NO PRICE COUNT:     ' PV-NO-PRICE-COUNT.         21890099
           DISPLAY '   NO UPC NBR COUNT:   ' PV-NO-UPC-NBR-COUNT.       21900099
           DISPLAY ' RECORDS ACCEPTED:   ' PV-RECORDS-ACCEPTED.         21910099
           DISPLAY '   CLEARANCE COUNT:    ' PV-CLEARANCE-COUNT.        21920099
           DISPLAY '   TFR PRICE COUNT:    ' PV-RED-COUNT.              21930099
           DISPLAY '   GROUP PRICE COUNT:  ' PV-GROUP-PRICE-COUNT.      21940099
           DISPLAY ' FASH SALES ADJUSTS: ' PA-FS-WRITE-COUNT.           21950099
           DISPLAY ' '.                                                 21960099
           DISPLAY '***********************'.                           21970099
           DISPLAY '*** TABLE COMMIT STATISTICS      ***'.              21980099
           DISPLAY '                                             '.     21990099
           DISPLAY 'INPUT EXTRACT RECORDS READ ' PA-EXTRACT-RECS-READ.  22000099
           DISPLAY '  ROWS UPDATED   ', PA-UPDATE-COUNT.                22010099
           DISPLAY '  ROWS INSERTED  ', PA-INSERT-COUNT.                22020099
           DISPLAY '  DROP(S)        ', PA-ZERO-REC-DROPPED.            22030099
           DISPLAY '  DUPLICATE(S)   ', PA-DUPLICATE-REC.               22040099
           DISPLAY '                                             '.     22050099
           DISPLAY '  COMMITS TAKEN  ', PA-COMMIT-COUNT.                22060099
           DISPLAY '                                             '.     22070099
           DISPLAY '***********************'.                           22080099
                                                                        22090099
           CLOSE TRANSFER-DATA-FILE                                     22100099
                 TRANSFER-DATA-ERROR-FILE                               22110099
                 FASHION-ADJUSTMENTS                                    22120099
W33304           TRANSFER-INPUT-ERROR-FILE                                      
                 TRANSFER-REPORT.                                       22130099
                                                                        22140099
      ******************************************************************22150099
      * 9900-SQL-ERROR.                                                 22160099
      ******************************************************************22170099
       9900-SQL-ERROR.                                                  22180099
                                                                        22190099
           SET ABEND-4013            TO TRUE.                           22200099
           DISPLAY '**  ABEND     **'.                                  22210099
           DISPLAY '**  PROGRAM   **  =  ' PC-PROGRAM-NAME              22220099
           DISPLAY '**  OPERATION **  = '  PV-OPER-ATTEMPTED            22230099
                                                                        22240099
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         22250099
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        22260099
                                                                        22270099
           COPY DPPD004.                                                22280099
                                                                        22290099
           PERFORM 9990-ABEND.                                          22300099
                                                                        22310099
       9990-ABEND.                                                      22320099
                                                                        22330099
           DISPLAY '**  PROGRAM   ** => ' PC-PROGRAM-NAME.              22340099
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            22350099
           CALL 'ILBOABN0'  USING ABEND-CODE.                           22360099
                                                                        22370099
P28545******************************************************************22380099
P28545*  PRICING MODULE.                                                22390099
P28545******************************************************************22400099
P28545     COPY INPD400.                                                22410099
P28545                                                                  22420099
